const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./editingSupport-jXJnJOwD.js","./index-DftRe4XB.js","./index-Coh0xJcG.css","./EditBusLayer-BgdJx3cp.js","./infoFor3D-DhzudQro.js"])))=>i.map(i=>d[i]);
import{bH as E,bL as B,_ as i,m as a,bO as I,b as M,dq as q,mu as N,bK as z,B as u,bI as k,v as L,bG as j,mv as R,mw as $,mx as G,c9 as H,my as V,mz as Q,gS as Z,mA as W,mB as J,mC as U,b5 as b,bR as T}from"./index-DftRe4XB.js";import{r as K}from"./featureQueryAll-Cv_ymA5k.js";import{p as X}from"./SimpleRenderer-DJ96tQpE.js";import{$ as Y}from"./UniqueValueRenderer-D4xrKReF.js";import{n as tt}from"./NormalizationBinParametersMixin-IezX-_OV.js";var S,g;let c=(g=class extends E{constructor(e){super(e),this.attachmentTypes=null,this.attachmentsWhere=null,this.cacheHint=void 0,this.keywords=null,this.globalIds=null,this.name=null,this.num=null,this.objectIds=null,this.orderByFields=null,this.returnMetadata=!1,this.size=null,this.start=null,this.where=null}writeStart(e,r){r.resultOffset=this.start,r.resultRecordCount=this.num||10}clone(){return new S(B({attachmentTypes:this.attachmentTypes,attachmentsWhere:this.attachmentsWhere,cacheHint:this.cacheHint,keywords:this.keywords,where:this.where,globalIds:this.globalIds,name:this.name,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,returnMetadata:this.returnMetadata,size:this.size,start:this.start}))}},S=g,g);i([a({type:[String],json:{write:!0}})],c.prototype,"attachmentTypes",void 0),i([a({type:String,json:{read:{source:"attachmentsDefinitionExpression"},write:{target:"attachmentsDefinitionExpression"}}})],c.prototype,"attachmentsWhere",void 0),i([a({type:Boolean,json:{write:!0}})],c.prototype,"cacheHint",void 0),i([a({type:[String],json:{write:!0}})],c.prototype,"keywords",void 0),i([a({type:[String],json:{write:!0}})],c.prototype,"globalIds",void 0),i([a({json:{write:!0}})],c.prototype,"name",void 0),i([a({type:Number,json:{read:{source:"resultRecordCount"}}})],c.prototype,"num",void 0),i([a({type:[Number],json:{write:!0}})],c.prototype,"objectIds",void 0),i([a({type:[String],json:{write:!0}})],c.prototype,"orderByFields",void 0),i([a({type:Boolean,json:{default:!1,write:!0}})],c.prototype,"returnMetadata",void 0),i([a({type:[Number],json:{write:!0}})],c.prototype,"size",void 0),i([a({type:Number,json:{read:{source:"resultOffset"}}})],c.prototype,"start",void 0),i([I("start"),I("num")],c.prototype,"writeStart",null),i([a({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],c.prototype,"where",void 0),c=S=i([M("esri.rest.support.AttachmentQuery")],c),c.from=q(c);var x,v;let l=(v=class extends E{constructor(e){super(e),this.cacheHint=void 0,this.dynamicDataSource=void 0,this.gdbVersion=null,this.geometryPrecision=void 0,this.historicMoment=null,this.maxAllowableOffset=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.relationshipId=void 0,this.start=void 0,this.num=void 0,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.where=null}_writeHistoricMoment(e,r){r.historicMoment=e&&e.getTime()}writeStart(e,r){r.resultOffset=this.start,r.resultRecordCount=this.num||10,this.start>0&&this.where==null&&(r.definitionExpression="1=1")}clone(){return new x(B({cacheHint:this.cacheHint,dynamicDataSource:this.dynamicDataSource,gdbVersion:this.gdbVersion,geometryPrecision:this.geometryPrecision,historicMoment:this.historicMoment&&new Date(this.historicMoment),maxAllowableOffset:this.maxAllowableOffset,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,relationshipId:this.relationshipId,start:this.start,num:this.num,returnGeometry:this.returnGeometry,where:this.where,returnZ:this.returnZ,returnM:this.returnM}))}},x=v,v);i([a({type:Boolean,json:{write:!0}})],l.prototype,"cacheHint",void 0),i([a({type:N,json:{write:!0}})],l.prototype,"dynamicDataSource",void 0),i([a({type:String,json:{write:!0}})],l.prototype,"gdbVersion",void 0),i([a({type:Number,json:{write:!0}})],l.prototype,"geometryPrecision",void 0),i([a({type:Date})],l.prototype,"historicMoment",void 0),i([I("historicMoment")],l.prototype,"_writeHistoricMoment",null),i([a({type:Number,json:{write:!0}})],l.prototype,"maxAllowableOffset",void 0),i([a({json:{write:!0}})],l.prototype,"objectIds",void 0),i([a({type:[String],json:{write:!0}})],l.prototype,"orderByFields",void 0),i([a({type:[String],json:{write:!0}})],l.prototype,"outFields",void 0),i([a({type:z,json:{read:{source:"outSR"},write:{target:"outSR"}}})],l.prototype,"outSpatialReference",void 0),i([a({json:{write:!0}})],l.prototype,"relationshipId",void 0),i([a({type:Number,json:{read:{source:"resultOffset"}}})],l.prototype,"start",void 0),i([I("start"),I("num")],l.prototype,"writeStart",null),i([a({type:Number,json:{read:{source:"resultRecordCount"}}})],l.prototype,"num",void 0),i([a({json:{write:!0}})],l.prototype,"returnGeometry",void 0),i([a({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],l.prototype,"returnM",void 0),i([a({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],l.prototype,"returnZ",void 0),i([a({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],l.prototype,"where",void 0),l=x=i([M("esri.rest.support.RelationshipQuery")],l),l.from=q(l);const ft=Object.freeze(Object.defineProperty({__proto__:null,get default(){return l}},Symbol.toStringTag,{value:"Module"})),mt=new k({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"});async function wt(t,e,r,n){const o=await w(t);if(await O(t,e,n),!o.addAttachment)throw new u(n,"Layer source does not support addAttachment capability");return o.addAttachment(e,r)}function O(t,e,r){const{attributes:n}=e,{objectIdField:o}=t;return t.capabilities?.data?.supportsAttachment?e?n?o&&n[o]?Promise.resolve():Promise.reject(new u(r,`feature is missing the identifying attribute ${o}`)):Promise.reject(new u(r,"'attributes' are required on a feature to query attachments")):Promise.reject(new u(r,"A feature is required to add/delete/update attachments")):Promise.reject(new u(r,"this layer doesn't support attachments"))}async function bt(t,e,r,n,o){const s=await w(t);if(await O(t,e,o),!s.updateAttachment)throw new u(o,"Layer source does not support updateAttachment capability");return s.updateAttachment(e,r,n)}async function gt(t,e,r){const{applyEdits:n}=await L(()=>import("./editingSupport-jXJnJOwD.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url),o=await t.load();let s=r;return o.type==="feature"&&o.infoFor3D&&e.deleteFeatures!=null&&o.globalIdField!=null&&(s={...s,globalIdToObjectId:await st(o,e.deleteFeatures,o.globalIdField)}),n(o,o.source,e,r)}async function vt(t,e,r){const{uploadAssets:n}=await L(()=>import("./editingSupport-jXJnJOwD.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url),o=await t.load();return n(o,o.source,e,r)}async function It(t,e,r,n){const o=await w(t);if(await O(t,e,n),!o.deleteAttachments)throw new u(n,"Layer source does not support deleteAttachments capability");return o.deleteAttachments(e,r)}async function jt(t,e,r){const n=(await t.load({signal:e?.signal})).source;if(!n.fetchRecomputedExtents)throw new u(r,"Layer source does not support fetchUpdates capability");return n.fetchRecomputedExtents(e)}async function Ft(t,e,r,n){e=c.from(e),await t.load();const o=t.source,s=t.capabilities;if(!s?.data?.supportsAttachment)throw new u(n,"this layer doesn't support attachments");const{attachmentTypes:d,objectIds:y,globalIds:p,num:h,size:f,start:m,where:P}=e;if(!s?.operations?.supportsQueryAttachments&&(d?.length>0||p?.length>0||f?.length>0||h||m||P))throw new u(n,"when 'capabilities.operations.supportsQueryAttachments' is false, only objectIds is supported",e);if(!(y?.length||p?.length||P))throw new u(n,"'objectIds', 'globalIds', or 'where' are required to perform attachment query",e);if(!o.queryAttachments)throw new u(n,"Layer source does not support queryAttachments capability",e);return!s?.attachment?.supportsOrderByFields&&e.orderByFields?.length&&((e=e.clone()).orderByFields=null),o.queryAttachments(e)}async function St(t,e,r,n){const o=await w(t);if(!o.queryObjectIds)throw new u(n,"Layer source does not support queryObjectIds capability");return o.queryObjectIds(j.from(e)??t.createQuery(),r)}async function xt(t,e,r,n){const o=await w(t);if(!o.queryFeatureCount)throw new u(n,"Layer source does not support queryFeatureCount capability");return o.queryFeatureCount(j.from(e)??t.createQuery(),r)}async function Ot(t,e,r,n){const o=await w(t);if(!o.queryExtent)throw new u(n,"Layer source does not support queryExtent capability");return o.queryExtent(j.from(e)??t.createQuery(),r)}async function Pt(t,e,r,n){const o=await w(t);if(!o.queryRelatedFeatures)throw new u(n,"Layer source does not support queryRelatedFeatures capability");return o.queryRelatedFeatures(l.from(e),r)}async function At(t,e,r,n){const o=await w(t);if(!o.queryRelatedFeaturesCount)throw new u(n,"Layer source does not support queryRelatedFeaturesCount capability");return o.queryRelatedFeaturesCount(l.from(e),r)}async function Dt(t){const e=t.source;if(e?.refresh)try{const{dataChanged:r,updates:n}=await e.refresh();if(n!=null&&(t.sourceJSON={...t.sourceJSON,...n},t.read(n,{origin:"service",url:t.parsedUrl})),r)return!0}catch{}if(t.definitionExpression)try{return(await G(t.definitionExpression,t.fieldsIndex)).hasDateFunctions}catch{}return!1}function Et(t){const e=new j;e.historicMoment=t.historicMoment,e.gdbVersion=t.gdbVersion,e.returnGeometry=!0,e.outFields=["*"],e.multipatchOption=t.geometryType==="multipatch"?"xyFootprint":null;const r=t.capabilities?.query;r&&(e.compactGeometryEnabled=r.supportsCompactGeometry,e.defaultSpatialReferenceEnabled=r.supportsDefaultSpatialReference);const n=t.capabilities?.data;n?.supportsZ&&t.returnZ!=null&&(e.returnZ=t.returnZ),n?.supportsM&&t.returnM!=null&&(e.returnM=t.returnM);const{timeOffset:o,timeExtent:s}=t;return e.timeExtent=o!=null&&s!=null?s.offset(-o.value,o.unit):s||null,e}function Bt(t){const{globalIdField:e,fields:r}=t;if(e)return e;if(r){for(const n of r)if(n.type==="esriFieldTypeGlobalID")return n.name}}function Mt(t){const{objectIdField:e,fields:r}=t;if(e)return e;if(r){for(const n of r)if(n.type==="esriFieldTypeOID")return n.name}}function qt(t){return t.currentVersion?t.currentVersion:t.hasOwnProperty("capabilities")||t.hasOwnProperty("drawingInfo")||t.hasOwnProperty("hasAttachments")||t.hasOwnProperty("htmlPopupType")||t.hasOwnProperty("relationships")||t.hasOwnProperty("timeInfo")||t.hasOwnProperty("typeIdField")||t.hasOwnProperty("types")?10:9.3}function Lt(t,e,r,n){const o=r?.feature,s=!!t.subtypes?.length;if(s&&!r?.excludeImpliedDomains){const p=rt(t,e);if(p)return p}const d=s&&et(t,o);if(d){const p=d?.domains?.[e];return p?.type==="inherited"?n:p}const y=at(t.types,t.typeIdField,o);if(y){const p=y.domains&&y.domains[e];if(p&&p?.type!=="inherited")return p}if(n)return n;if(!r?.excludeImpliedDomains){const p=nt(t,e);if(p)return p}return null}function et(t,e){const{subtypes:r,subtypeField:n}=t;if(!e?.attributes||!r?.length||!n)return null;const o=e.attributes[n];return o==null?null:r.find(s=>s.code===o)}function rt(t,e){const{fieldsIndex:r,subtypeField:n}=t,{name:o,type:s}=r.get(e)??{};if(!o)return null;if((n&&r.get(n)?.name)===o&&t.subtypes?.length){const d=t.subtypes.map(y=>new R({code:_(y.code,s),name:y.name}));if(d?.length)return new $({codedValues:d})}return null}function nt(t,e){const{fieldsIndex:r}=t,{name:n,type:o}=r.get(e)??{};if(!n)return null;if(("typeIdField"in t?r.get(t.typeIdField)?.name:null)===n&&"types"in t&&t.types?.length){const s=t.types.map(d=>new R({code:_(d.id,o),name:d.name}));return new $({codedValues:s})}return null}function _(t,e){return e?Z({type:e})&&typeof t=="number"?`${t}`:W({type:e})&&typeof t=="string"?Number.parseInt(t,10):t:t}async function w(t){return(await t.load()).source}async function Rt(t,e){if(!b)return;const r=b.findCredential(t);if(r)return r.userId;let n;try{const o=await T(t,e);o&&(n=await b.checkSignInStatus(`${o}/sharing`))}catch{}return n?n.userId:null}async function C(t,e){if(!b||b.findCredential(t))return;let r;try{const n=await T(t,e);n&&(r=await b.checkSignInStatus(`${n}/sharing`))}catch{}if(r)try{const n=e!=null?e.signal:null;await b.getCredential(t,{signal:n})}catch{}}async function $t(t,e,r){const n=t.parsedUrl?.path;n&&t.authenticationTriggerEvent===e&&await C(n,r)}async function Tt(t){const e=t.parsedUrl?.path;e&&ot(t)&&await C(e)}function ot(t){return it(t)&&("serviceDefinitionExpression"in t&&A(t.serviceDefinitionExpression)||"definitionExpression"in t&&A(t.definitionExpression))}function it(t){return!(!U(t)||!t.capabilities?.query.supportsCurrentUser)}function A(t){return!!t?.toLowerCase().includes("current_user")}function _t(t){return!ut(t)&&(t.userHasUpdateItemPrivileges||t.editingEnabled)}const F=H({types:J});function Ct(t,e){if(t.defaultSymbol)return t.types?.length?new Y({defaultSymbol:F(t.defaultSymbol,t,e),field:t.typeIdField,uniqueValueInfos:t.types.map(r=>({id:r.id,symbol:F(r.symbol,r,e)}))}):new X({symbol:F(t.defaultSymbol,t,e)})}function Nt(t){let e=t.sourceJSON?.cacheMaxAge;if(!e)return!1;const r=t.editingInfo?.lastEditDate?.getTime();return r==null||(e*=1e3,Date.now()-r<e)}async function st(t,e,r){if(e==null)return null;const n=[],{objectIdField:o}=t;if(e.forEach(h=>{let f=null;if("attributes"in h){const{attributes:m}=h;f={globalId:m[r],objectId:m[o]!=null&&m[o]!==-1?m[o]:null}}else f={globalId:h.globalId,objectId:h.objectId!=null&&h.objectId!==-1?h.objectId:null};f.globalId!=null&&(f.objectId!=null&&f.objectId!==-1||n.push(f.globalId))}),n.length===0)return null;const s=t.createQuery();s.where=n.map(h=>`${r}='${h}'`).join(" OR "),s.returnGeometry=!1,s.outFields=[o,r],s.cacheHint=!1;const d=await V(K(t,s));if(!d.ok)return null;const y=new Map,p=d.value.features;for(const h of p){const f=h.attributes[r],m=h.attributes[o];f!=null&&m!=null&&m!==-1&&y.set(Q(f),m)}return y}function at(t,e,r){if(!e||!r||!t)return null;const n=r.getAttribute(e);return n==null?null:t.find(o=>{const{id:s}=o;return s!=null&&s.toString()===n.toString()})??null}function ut(t){return t.sourceJSON?.isMultiServicesView||lt(t)}function lt(t){return!!t.sourceJSON?.capabilities?.toLowerCase().split(",").map(e=>e.trim()).includes("map")}function zt(t,e,r){const n=e?.queryAttributeBins;if(!e?.operations?.supportsQueryBins||!n)throw new u(r,"Layer source does not support binning");switch(t.binParameters.type){case"auto-interval":if(!n.supportsAutoInterval)throw new u(r,"Layer source does not support auto-interval binning");if(t.binParameters.normalizationType&&(!n.supportsNormalization||!D(t.binParameters.normalizationType,n.supportedNormalizationTypes)))throw new u(r,"Layer source does not support normalization binning");break;case"date":if(!n.supportsDate)throw new u(r,"Layer source does not support date binning");if(t.binParameters.snapToData&&!n.supportsSnapToData)throw new u(r,"Layer source does not support snapToData binning");if(t.binParameters.returnFullIntervalBin&&!n.supportsReturnFullIntervalBin)throw new u(r,"Layer source does not support returnFullIntervalBin binning");break;case"fixed-boundaries":if(!n.supportsFixedBoundaries)throw new u(r,"Layer source does not support fixed-boundaries binning");break;case"fixed-interval":if(!n.supportsFixedInterval)throw new u(r,"Layer source does not support fixed-interval binning");if(t.binParameters.normalizationType&&(!n.supportsNormalization||!D(t.binParameters.normalizationType,n.supportedNormalizationTypes)))throw new u(r,"Layer source does not support normalization binning")}if(t.binParameters.stackBy&&!n.supportsStackBy)throw new u(r,"Layer source does not support stackBy binning");if(t.binParameters.splitBy&&!n.supportsSplitBy)throw new u(r,"Layer source does not support splitBy binning");if(t.binParameters.firstDayOfWeek&&!n.supportsFirstDayOfWeek)throw new u(r,"Layer source does not support firstDayOfWeek binning");const o=n?.supportedStatistics;if(t.outStatistics&&o){const s=new Map([["count","count"],["sum","sum"],["min","min"],["max","max"],["avg","avg"],["stddev","stddev"],["var","var"],["percentile-continuous","percentileContinuous"],["percentile-discrete","percentileDiscrete"],["centroid-aggregate","centroid"],["convex-hull-aggregate","convexHull"],["envelope-aggregate","envelope"]]);for(const{statisticType:d}of t.outStatistics){const y=s.get(d);if(y&&!o[y])throw new u(r,`Layer source does not support ${d} statistic type`)}}}function D(t,e){return t!=null&&!!e?.[tt.toJSON(t)]}export{Ft as A,Dt as B,At as C,Ot as D,xt as E,wt as F,$t as H,Rt as J,St as L,Bt as M,Lt as N,jt as O,bt as P,et as Q,Et as R,vt as S,Pt as T,rt as U,Tt as W,A as X,_t as Y,zt as a,ft as b,ut as i,mt as j,Mt as k,st as n,at as o,c as p,gt as q,Nt as r,Ct as t,l as u,It as v,qt as z};
