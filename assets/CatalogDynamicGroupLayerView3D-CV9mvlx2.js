import{_ as e,m as a,b as L,Y as g,f6 as _,jf as U,D as x,f5 as H,bl as O,d3 as w}from"./index-CKCoitmB.js";import{l as I}from"./LayerView3D-DY-dQWKR.js";import{d as C}from"./LayerView-CpWMQEu1.js";const c=Symbol(),D=V=>{const $=V;let r=class extends ${constructor(...i){super(...i),this.layerViews=new g,this._debouncedUpdate=_(async()=>{const{layer:d,parent:l}=this,n=l?.footprintLayerView;let p=[];const y=this._createQuery();if(y&&n){const{features:m}=await n.queryFeatures(y);this.suspended||(p=m.map(o=>d.acquireLayer(o)))}this.removeHandles(c),this.addHandles(p,c)})}get creatingLayerViews(){return this.view?.layerViewManager.isCreatingLayerViewsForLayer(this.layer)??!1}isUpdating(){return this.creatingLayerViews||this.layer.updating||this.layerViews.some(i=>i.updating)}enableLayerUpdates(){return U([this._updatingHandles.addWhen(()=>this.parent?.footprintLayerView?.dataUpdating===!1,()=>this.updateLayers()),this._updatingHandles.add(()=>[this.layer.maximumVisibleSublayers,this.layer.parent?.orderBy,this.parent?.footprintLayerView?.filter,this.parent?.footprintLayerView?.timeExtent,this.suspended],()=>this.updateLayers()),x(()=>this.removeHandles(c))])}updateLayers(){this.suspended?this.removeHandles(c):this._updatingHandles.addPromise(H(this._debouncedUpdate()).catch(i=>{O.getLogger(this).error(i)}))}_createQuery(){const i=this.parent?.footprintLayerView,d=this.layer?.parent;if(!i||!d||d.destroyed)return null;const{layer:{maximumVisibleSublayers:l},view:{scale:n}}=this;if(!l)return null;const{itemTypeField:p,itemSourceField:y,itemNameField:m,minScaleField:o,maxScaleField:f,objectIdField:v,orderBy:b}=d,F=w(`${o} IS NULL OR ${n} <= ${o} OR ${o} = 0`,`${f} IS NULL OR ${n} >= ${f}`),u=b?.find(h=>h.field&&!h.valueExpression),t=i.createQuery();if(t.returnGeometry=!1,t.num=l,t.outFields=[v,y,m],t.where=w(t.where,F),this.unsupportedItemTypes!=null){const h=`${p} NOT IN (${this.unsupportedItemTypes.map(S=>`'${S}'`)})`;t.where=w(t.where,h)}return u?.field&&(t.orderByFields=[`${u.field} ${u.order==="descending"?"DESC":"ASC"}`],t.outFields.push(u.field)),t}};return e([a({readOnly:!0})],r.prototype,"creatingLayerViews",null),e([a()],r.prototype,"layer",void 0),e([a()],r.prototype,"layerViews",void 0),e([a({readOnly:!0})],r.prototype,"unsupportedItemTypes",void 0),e([a()],r.prototype,"parent",void 0),e([a({readOnly:!0})],r.prototype,"isUpdating",null),r=e([L("esri.views.layers.CatalogDynamicGroupLayerView")],r),r};let s=class extends D(I(C)){constructor(){super(...arguments),this.type="catalog-dynamic-group-3d",this.layerViews=new g}initialize(){this.addHandles([this.enableLayerUpdates()])}};e([a()],s.prototype,"layerViews",void 0),e([a()],s.prototype,"parent",void 0),e([a()],s.prototype,"view",void 0),s=e([L("esri.views.3d.layers.CatalogDynamicGroupLayerView3D")],s);const E=s;export{E as default};
