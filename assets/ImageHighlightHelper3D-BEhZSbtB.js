const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/GraphicsView3D-BzKqoFe0.js","assets/index-DqWSGd-C.js","assets/index-y22qu0zN.css","assets/GraphicsProcessor-B4-BkNX2.js","assets/diffUtils-dlx1hyz5.js","assets/renderingInfoUtils-CkU1ZLYp.js","assets/visualVariableUtils-CKDgrt_E.js","assets/ExtentSet-B4GS0syW.js","assets/UniqueValueRenderer-D8FXMIac.js","assets/colorRamps-BC86CaxM.js","assets/ColorStop-B27HPRLO.js","assets/jsonUtils-D26B10Vs.js","assets/defaults3D-pEIlFskG.js","assets/defaults-Dzq_hxxB.js","assets/defaultsJSON-GKolV7NZ.js","assets/styleUtils-BGmFhuFo.js","assets/optimizedFeatureQueryEngineAdapter-D2QjPy7w.js","assets/popupUtils-CFL_PbOi.js","assets/Graphics3DObjectStates-nwfpSi6P.js","assets/highlightUtils-D0u2y1H8.js","assets/highlightOptionsUtils-hGBu8SuW.js"])))=>i.map(i=>d[i]);
import{ae as u,Y as d,c6 as c,S as y,jZ as w,V as _,ao as m,ap as f,T as v,D as g,v as V,C as H,a4 as $,a8 as G,h9 as C,ha as D,_ as a,m as o,b}from"./index-DqWSGd-C.js";function x(t){if(!t)return[];let e=u(t)?[t]:d.isCollection(t)?t.toArray():Array.isArray(t)?t:[];return e=e?.filter(c),(e?.length??0)===0?[]:e}let r=class extends y{get updating(){return this.graphicsView?.updating??!1}constructor(t){super(t),this._highlightCounts=new Map,this._graphicsViewLoader=null,this.graphics=new w,this.graphicsView=null,this.suspended=!1;const e=new _([255,255,255,1/255]);this._symbols=new Map([["point",new m({size:"2px",style:"square",color:e})],["polyline",new f({width:"2px",color:e})],["polygon",new v({outline:null,color:e})]])}highlight(t,e){const i=x(t);if(i.length===0)return g();let n,s=!1;return this.updatingHandles.addPromise(Promise.all([this._createHighlightGraphics(i),this._ensureGraphicsView3D()]).then(([h,l])=>{!s&&l&&(n=this._addHighlightGraphics(l,h,e))})),g(()=>{s=!0,n?.remove()})}preload(){this._ensureGraphicsView3D()}_addHighlightGraphics(t,e,i){for(const s of e)this._highlightCounts.set(s,(this._highlightCounts.get(s)??0)+1);this.graphics.addMany(e);const n=t.highlight(e,i);return g(()=>{this._removeHighlightGraphics(e),n.remove()})}_removeHighlightGraphics(t){this.graphics.removeMany(t.filter(e=>{const i=Math.max(0,(this._highlightCounts.get(e)??0)-1);return i===0?(this._highlightCounts.delete(e),!0):(this._highlightCounts.set(e,i),!1)}))}async _ensureGraphicsView3D(){if(this.graphicsView)return this.graphicsView;this._graphicsViewLoader||(this._graphicsViewLoader=V(()=>import("./GraphicsView3D-BzKqoFe0.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20])));const{default:t}=await this._graphicsViewLoader;if(this.destroyed)return null;const e=new t({view:this.view,layer:{type:"graphics-view-3d-dummy",id:this.layer.id,uid:this.layer.uid,elevationInfo:{mode:"on-the-ground"}},getGraphics:()=>this.graphics,drapeSourcePriorityOffset:.5});return this._set("graphicsView",e),this.addHandles([H(this.graphicsView),$(()=>this.suspended,i=>{e.suspended=i},G)]),e}async _createHighlightGraphics(t){const e=t.map(({geometry:s})=>s?.spatialReference).filter(c).reduce((s,h)=>(s.length!==0&&s.at(-1)?.equals(h)||s.push(h),s),[]),i=this.view.spatialReference,n=e.map(s=>({source:s,dest:i}));try{await C(n)}catch{return[]}return t.map(s=>{const{geometry:h}=s;try{const l=h?D(h,i):null,p=s.cloneShallow();return p.geometry=l,p.symbol=this._symbols.get(l?.type),p}catch{return s}})}};a([o()],r.prototype,"graphics",void 0),a([o()],r.prototype,"graphicsView",void 0),a([o()],r.prototype,"view",void 0),a([o()],r.prototype,"layer",void 0),a([o()],r.prototype,"updatingHandles",void 0),a([o()],r.prototype,"suspended",void 0),a([o()],r.prototype,"updating",null),r=a([b("esri.views.3d.layers.support.ImageHighlightHelper3D")],r);export{r as w};
