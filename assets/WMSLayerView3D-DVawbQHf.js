import{_ as s,m as h,b as y,K as g,B as u,a$ as P,ar as v}from"./index-C5z1JKvU.js";import{m as E}from"./DynamicLayerView3D-BiVY_PTF.js";import{a as I}from"./ExportWMSImageParameters-DaRayt1v.js";import{i as b}from"./timeSupport-CbcRXgPC.js";import"./SubView3D-DRyq2Rqu.js";import"./ImageMaterial.glsl-DGOvOXBx.js";import"./TriangleMaterial-CHWD7zez.js";import"./DefaultLayouts-DYd9x0qO.js";import"./LayerView3D-B5OxV6GV.js";import"./LayerView-C0GrN07u.js";import"./RefreshableLayerView-DE3W49d8.js";const F=o=>{const n=o;let e=class extends n{initialize(){this.exportImageParameters=new I({layer:this.layer})}destroy(){this.exportImageParameters=g(this.exportImageParameters)}get exportImageVersion(){return this.exportImageParameters?.commitProperty("version"),this.commitProperty("timeExtent"),(this._get("exportImageVersion")||0)+1}get timeExtent(){return b(this.layer,this.view?.timeExtent,this._get("timeExtent"))}async fetchPopupFeaturesAtLocation(t,r){const{layer:i}=this;if(!t)throw new u("wmslayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:i});const{popupEnabled:p}=i;if(!p)throw new u("wmslayerview:fetchPopupFeatures","popupEnabled should be true",{popupEnabled:p});const m=this.createFetchPopupFeaturesQuery(t);if(!m)return[];const{extent:a,width:c,height:l,x:w,y:f}=m;if(!(a&&c&&l))throw new u("wmslayerview:fetchPopupFeatures","WMSLayer does not support fetching features.",{extent:a,width:c,height:l});const x=await i.fetchFeatureInfo(a,c,l,w,f);return P(r),x}};return s([h()],e.prototype,"exportImageParameters",void 0),s([h({readOnly:!0})],e.prototype,"exportImageVersion",null),s([h()],e.prototype,"layer",void 0),s([h({readOnly:!0})],e.prototype,"timeExtent",null),e=s([y("esri.views.layers.WMSLayerView")],e),e};let d=class extends F(E){constructor(){super(...arguments),this.type="wms-3d"}initialize(){this.layer.serviceSupportsSpatialReference(this.view.spatialReference)||this.addResolvingPromise(Promise.reject(new u("layerview:spatial-reference-incompatible","The spatial references supported by this WMS layer are incompatible with the spatial reference of the view"))),this._updatingHandles.add(()=>this.exportImageParameters?.version,()=>{this._updatingHandles.addPromise(this.refreshDebounced())})}createFetchPopupFeaturesQuery(o){const{subView:n}=this;if(n.type!=="draped")return null;const e=n.findExtentInfoAt(o),t=e.extent,r=new v(t[0],t[1],t[2],t[3],n.spatialReference),i=e.imageSize,p=i.width,m=i.height,a=r.width/p;return{extent:r,width:p,height:m,x:Math.round((o.x-r.xmin)/a),y:Math.round((r.ymax-o.y)/a)}}getFetchOptions(){return{timeExtent:this.timeExtent}}};d=s([y("esri.views.3d.layers.WMSLayerView3D")],d);const D=d;export{D as default};
