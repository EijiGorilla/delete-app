const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/WhereClauseCache-BrP5D2-t.js","assets/WhereClause-D6yiTzzY.js","assets/statsWorker-Di09XtDy.js","assets/utils-LYT8G6z6.js","assets/heatmapUtils-DWN8dC4s.js","assets/utils-Bsgx9qCx.js","assets/utils-CuZ63QwN.js","assets/ClassBreaksDefinition-DyUVWH9a.js","assets/geometryEngineWorker-BkMQzpX8.js","assets/geometryEngineJSON-B_JiqPb-.js","assets/geometryEngineBase-BQTefT4Y.js","assets/_commonjsHelpers-DCkdB7M8.js","assets/CSVSourceWorker-BrTMi2sR.js","assets/date-DCujAECq.js","assets/FeatureStore-CzMyM8SA.js","assets/BoundsStore-BOFx7Ub_.js","assets/QueryEngine-VDBLmcUp.js","assets/FixedIntervalBinParameters-CL9HXq0s.js","assets/NormalizationBinParametersMixin-D2K-v_MU.js","assets/QueryEngineCapabilities-DJC_YILC.js","assets/SnappingCandidate-DGkpYqI6.js","assets/optimizedFeatureQueryEngineAdapter-BEFNdBpS.js","assets/number-BV0h2E5h.js","assets/locationUtils-Ba5a53RV.js","assets/clientSideDefaults-DMYMCoJR.js","assets/defaultsJSON-GKolV7NZ.js","assets/EdgeProcessingWorker-BEvxxIVD.js","assets/workerHelper-Ba4Tq_D5.js","assets/bufferLayouts-Dp2_bRf1.js","assets/edgeProcessing-DSSE0mj0.js","assets/deduplicate-CYXSu8lG.js","assets/ElevationSamplerWorker-CAb_oG52.js","assets/vertexSpaceConversion-vIHC8HjO.js","assets/vec4-DVyjDkcu.js","assets/FeatureServiceSnappingSourceWorker-BbvIsLn-.js","assets/symbologySnappingCandidates-DotB589L.js","assets/pbfQueryUtils-B9Lld-Vj.js","assets/pbf-BB2NLJBf.js","assets/query-BmNPuBmy.js","assets/queryZScale-C5z07jDE.js","assets/GeoJSONSourceWorker-Bo4BHrfZ.js","assets/geojson-B_UqB4ON.js","assets/sourceUtils-CyEE4FAF.js","assets/MemorySourceWorker-CWvsmBih.js","assets/objectIdUtils-BmFjqQA3.js","assets/PBFDecoderWorker-BZf01dxN.js","assets/FeaturePipelineWorker-B_5RqENs.js","assets/diffUtils-B5XdCkTt.js","assets/streamLayerUtils-DFlbJ4P1.js","assets/DictionaryScriptEvaluator-BnTZ7kFU.js","assets/labelPoint-BfNX5v8y.js","assets/rasterizingUtils-BSUiKD3J.js","assets/CIMSymbolHelper-BsSCGUvy.js","assets/BidiEngine-BvER9tXK.js","assets/utils-DX2muIr3.js","assets/mat2d-DtyqYgD7.js","assets/mat2df32-Dpt2CT5P.js","assets/defaults-CTJiDWqC.js","assets/TurboLine-Uj-bY_Oh.js","assets/Rect-BAnET0xx.js","assets/QueueProcessor-rNTqujp4.js","assets/SourceChunkStore-i9e76qIV.js","assets/parquet-BD7LShdL.js","assets/operatorGeodeticDensify-DlwDjkQJ.js","assets/SimpleGeometryCursor-B92kdZ15.js","assets/normalizeUtilsSync-CdEsI1V3.js","assets/displayFilterUtils-thFexvlE.js","assets/ogcFeatureUtils-CjUyqEj8.js","assets/FeatureIdInfo-iL5WjyEH.js","assets/StreamFeatureManager-CVlkpic2.js","assets/createConnection-B9Dwwmf8.js","assets/PointCloudWorker-CdbBkYVP.js","assets/PointCloudWorkerUtil-DGnATya2.js","assets/PointCloudUniqueValueRenderer-CHWKyzMo.js","assets/ColorStop-C_85dveK.js","assets/I3SBinaryReader-Dn6QLrHF.js","assets/RasterWorker-Dm_5XHhd.js","assets/PixelBlock--uA3RUqK.js","assets/RasterSymbolizer-BgjXO7D2.js","assets/rasterFunctionHelper-CFZBb4pe.js","assets/rasterProjectionHelper-BSURBNiE.js","assets/colorRamps-BW57d0KD.js","assets/PolynomialTransform-tW2_Oqs2.js","assets/dataUtils-Cpg4NQEL.js","assets/SceneLayerSnappingSourceWorker-Cr36Y7uq.js","assets/SceneLayerWorker--vnaiPQK.js","assets/I3SMeshWorkerHandle-CgjlXALq.js","assets/WFSSourceWorker-CnDlc91D.js","assets/wfsUtils-CAR7Y8RD.js","assets/xmlUtils-CtUoQO7q.js","assets/WorkerTileHandler-Cpkrx0FT.js","assets/StyleRepository-z3Bo-0Yj.js","assets/Lyr3DWorker-gVpmQAlq.js","assets/Lyr3DModule-CrEv5iJh.js","assets/Feature3DPipelineWorker-bY0uf8NL.js","assets/jsonUtils-DcstmEiw.js","assets/typeUtils-C2GLYYl1.js","assets/ClassBreaksRenderer-BDiA-Drn.js","assets/UniqueValueRenderer-BMQY77l4.js","assets/visualVariableUtils-h_Tmmqp9.js","assets/jsonUtils-BZU5Dvhl.js","assets/defaults3D-3yqVa8pA.js","assets/styleUtils-B4S5xfsI.js","assets/SimpleRenderer-BX0M3XNR.js","assets/utils-CsrV0E4h.js","assets/FlowWorker-CIS0gBnf.js","assets/loadUtils-hq6L9s4O.js","assets/FeatureTileDescriptor-DHt7VGzF.js","assets/ParquetSourceWorker-DKtyG2rV.js","assets/parquetUtils-WjLUV2i4.js","assets/PanoramicMeshWorker-JdZEXH6k.js","assets/projectOperator-CCFAEDl9.js","assets/operatorProject-DLBJBuVS.js","assets/projectOperator-CMdPtVOo.js","assets/portalLayers-Dncruciv.js","assets/associatedFeatureServiceUtils-DmXwxx7s.js","assets/fetchService-Co9gWfcp.js","assets/loadUtils-1o0Mn7-J.js","assets/lazyLayerLoader-Lgyg-Qzb.js","assets/arcgisLayers-DMT9ufk4.js","assets/Popup-mYMs8l3k.js","assets/AttachmentInfo-Bk4XhpFk.js","assets/featureLayerUtils-CvlCDMtv.js","assets/featureQueryAll-CuepyJ9P.js","assets/featureUtils-DFF3ONlp.js","assets/a11yUtils-UiZxAJkv.js","assets/utils-CoSafYCF.js","assets/cimSymbolUtils-2bUpOO3t.js","assets/executeQueryJSON-n6XLGO2u.js","assets/FeatureSet-GXjD2HRm.js","assets/shared-B4ENUi6p.js","assets/isImageryGraphicOrigin-Ccuhb4eK.js","assets/isImageryTileGraphicOrigin-ZR-gBf9D.js","assets/FeatureLayer-ZoVMlOGb.js","assets/FormTemplate-BY1MvaAR.js","assets/GraphicOrigin-DIPyE6mP.js","assets/isFeatureGraphicOrigin-YA2hudPe.js","assets/editsZScale-DC3jCCvY.js","assets/APIKeyMixin-DzT5HKTw.js","assets/ArcGISService-Cz-bAQ0r.js","assets/CustomParametersMixin-Csc4j4JF.js","assets/DisplayFilteredLayer-6GpezYMs.js","assets/EditBusLayer-CjFPWiIe.js","assets/FeatureEffectLayer-C6cVd6gx.js","assets/FeatureEffect-D45WJRZ3.js","assets/FeatureFilter-Ahlf3ACz.js","assets/FeatureLayerBase-yicfge73.js","assets/OperationalLayer-BlL5LgQc.js","assets/LayerFloorInfo-Bnf7sa1I.js","assets/multiLayerServiceUtils-BuMsL_uG.js","assets/Relationship-BVGX06bB.js","assets/serviceCapabilitiesUtils-xb2wDijM.js","assets/infoFor3D-DhzudQro.js","assets/FeatureReductionLayer-DnqOePJH.js","assets/FeatureReductionSelection-C1VP0Xhw.js","assets/labelingInfo-CcgOsGf-.js","assets/OrderedLayer-qTkV1eUh.js","assets/PortalLayer-SWWwLi8m.js","assets/RefreshableLayer-T4lVCLXb.js","assets/TemporalLayer-Cg7nKZKH.js","assets/TimeInfo-Cj5ASrOl.js","assets/TrackableLayer-BEbSV7yv.js","assets/FeatureTemplate-CdFEkXbf.js","assets/FeatureType-BRLbFAxI.js","assets/fieldProperties-BH6OBObn.js","assets/TitleCreator-C2G0GY_d.js","assets/versionUtils-zCFLssHd.js","assets/styleUtils-9b4vRTVs.js","assets/popupUtils-DRW6bD7O.js","assets/NetworkElement-CgPLaoX3.js","assets/AnchorElementViewModel-CtA1N9zC.js","assets/symbolUtils-CG6cy22z.js","assets/ElevationLayer-CAVA8EvU.js","assets/ArcGISCachedService-CP-_HXEs.js","assets/TileInfoTilemapCache-Cs2gHwY7.js","assets/LercDecoder-LhdoCgmz.js","assets/layersCreator-i2Z_AdV6.js","assets/arcadeUtils-Cd2Zxk3x.js","assets/arcade-qQvVRZMX.js","assets/arcadeEnvironment-B5jrPAJv.js","assets/Dictionary-qsYwWuH-.js","assets/ImmutableArray-BPVd6ESQ.js","assets/Feature-DQEhgR4g.js","assets/aiServices-BzS84jLp.js","assets/commonProperties-DHiB1uzW.js","assets/unitConversion-18uyULSW.js","assets/hash-CcEbRgUF.js","assets/rasterFieldUtils-CxxtTZ6K.js","assets/batchExec-D5eBKOxd.js","assets/webStyleSymbolUtils-BACwhvKO.js","assets/devEnvironmentUtils-8WtPGj6h.js","assets/TileLayerView3D-C3ykbYHQ.js","assets/LayerView3D-DY-dQWKR.js","assets/TiledLayerView3D-CZKTfaEc.js","assets/fetchTile-CRkCkowU.js","assets/SublayerPopupHighlightHelper3D-DCOEpv8-.js","assets/ImageHighlightHelper3D-DwQQsegu.js","assets/floorFilterUtils-DKzVzLpH.js","assets/sublayerUtils-BEQnBRaB.js","assets/popupUtils-C-TWwit2.js","assets/LayerView-CpWMQEu1.js","assets/RefreshableLayerView-AETBkdO_.js","assets/ElevationLayerView3D-BQADmj_O.js","assets/BaseDynamicLayerView3D-CyUDo_fG.js","assets/DynamicLayerView3D-D1Dymqpa.js","assets/SubView3D-CYQ1pzsA.js","assets/ImageMaterial.glsl-6RqxyHjK.js","assets/TriangleMaterial-BhdZcH_8.js","assets/DefaultLayouts-D6jpwH5a.js","assets/BuildingSceneLayerView3D-BNbOEqBJ.js","assets/BuildingComponentSublayer-BeNTaXa9.js","assets/capabilities-Cs4k8cuT.js","assets/I3SIndexInfo-BYKhdMIM.js","assets/I3SLayerDefinitions-D63142gX.js","assets/I3SUtil-DyHiqH_I.js","assets/featurePopupQueryUtils-iWuFRiad.js","assets/BuildingGroupSublayer-EjP2WE0w.js","assets/I3SMeshView3D-DYC05Njc.js","assets/Transform-BKU6OTvI.js","assets/projectBoundingSphere-CW1JYnh6.js","assets/I3SOverrides-7R4ZTFVI.js","assets/resourceUtils-Dp01soQb.js","assets/EllipsoidMode-Bx0t-7iS.js","assets/SceneModification-Ca8E5f6t.js","assets/ExtentSet-BO8Wja-T.js","assets/attributeUtils-Dc8--CBJ.js","assets/highlightUtils-BcpjQYgX.js","assets/highlightOptionsUtils-Vhqp3jB7.js","assets/I3SQueryFeatureAdapter-BCDhCyKP.js","assets/TemporalSceneLayerView-CwkXoIKx.js","assets/timeSupport-CrIpMrc5.js","assets/I3SQueryFeatureStore-C8GNbF4-.js","assets/CatalogLayerView3D-B3kzPIzR.js","assets/CatalogDynamicGroupLayerView3D-CV9mvlx2.js","assets/CatalogFootprintLayerView3D-BeIeBk9L.js","assets/FeatureLayerViewBase3D-luLoxQHD.js","assets/HeatmapDensity.glsl-CVmSbvYX.js","assets/AttributeBinsQuery-B_dy4cEf.js","assets/dehydratedFeatureComparison-DVcLKO_z.js","assets/queryForSymbologySnapping-D7VNITF-.js","assets/Graphics3DFeatureProcessor-DxRP_jjY.js","assets/renderingInfoUtils-D_7e1BLU.js","assets/Graphics3DObjectStates-OWH-NNzU.js","assets/AttributeBinsFeatureSet-Cn73wG-v.js","assets/EventedSet-C9796qz7.js","assets/constants-SxxbBSOD.js","assets/CSVLayerView3D-CIpNszv_.js","assets/DimensionLayerView3D-AlFv4Pj4.js","assets/LayerViewAnalysisViewManager-CW8yLaDI.js","assets/FeatureLayerView3D-DyWG0Kls.js","assets/GaussianSplatLayerView3D-CVVpBq-w.js","assets/tiles3DUtils-CbP3t0zF.js","assets/GeoJSONLayerView3D-BWooyiLO.js","assets/GraphicsLayerView3D-CQLAnRDF.js","assets/GraphicsProcessor-D14ujDzu.js","assets/GroupLayerView3D-BwWaQTXU.js","assets/ImageryLayerView3D-Cd6CTTUP.js","assets/FlowSubView3D-BG0xBke4.js","assets/line-Dm9lPQ28.js","assets/IntegratedMeshLayerView3D-DSBT2vk5.js","assets/IntegratedMesh3DTilesLayerView3D-CvYEArLX.js","assets/LineOfSightLayerView3D-DoQ3iQf1.js","assets/MapImageLayerView3D-qtkRv1lS.js","assets/ExportImageParameters-DOZrUYhi.js","assets/MediaLayerView3D-GlNYNFoX.js","assets/MediaElementView-Cm8Pizrk.js","assets/mat2df64-DFLy2zOC.js","assets/EditGeometryOperations-DkaQQ_tV.js","assets/rotate-uO2TpdoL.js","assets/curveOperationUtils-c7oYf-sC.js","assets/SnappingManagerPool-DVIBhB9t.js","assets/allLayerSnapping-7LRGHbTS.js","assets/OGCFeatureLayerView3D-wsp6f2lq.js","assets/PointCloudLayerView3D-23tBfkAe.js","assets/PopupSceneLayerView-Bh1Y1p0M.js","assets/ViewshedLayerView3D-BXHxxllb.js","assets/VoxelLayerView3D-DPh-x7_t.js","assets/VoxelGraphic-BFbAgjkg.js","assets/RouteLayerView3D-DFZsK7l6.js","assets/Stop-BcOwoqB4.js","assets/networkEnums-DSO1MDlR.js","assets/SceneLayerView3D-D-LHwWYp.js","assets/SceneLayerView-vQk9epXP.js","assets/SceneLayerGraphicsView3D-D2HP9xwN.js","assets/StreamLayerView3D-C1oJU0uS.js","assets/ImageryTileLayerView3D-7nOOY56T.js","assets/datasetUtils-DdDUWBI2.js","assets/VectorTileLayerView3D-BAQhK1rI.js","assets/WFSLayerView3D-CFINV5Ga.js","assets/WMSLayerView3D-DH4mLrfJ.js","assets/ExportWMSImageParameters-BQg2xf5a.js","assets/WMTSLayerView3D-BIQ-b_Nm.js","assets/AreaMeasurementAnalysisView3D-qxrykYF6.js","assets/AnalysisView3D-DhfzU6WZ.js","assets/measurementUtils-DGstebbJ.js","assets/ShadedColorMaterial.glsl-DYAiNJzP.js","assets/VisualElement-BLlgHkJ9.js","assets/ColorMaterial.glsl-IP3XuXfX.js","assets/quantityFormatUtils-BoquAKQA.js","assets/Segment-Bw5SP-Y5.js","assets/TextOverlayItem-CLOZ02Rf.js","assets/lineStippleUtils-CCavR4OV.js","assets/SnappingVisualizer3D-CNP2JT4S.js","assets/ExtendedLineVisualElement-C0jo5oSB.js","assets/EngineVisualElement-C-orlapT.js","assets/LaserlinePath.glsl-Dqs7aO_w.js","assets/PointVisualElement-jmmJ-sxo.js","assets/SnappingContext-C3tB4VpL.js","assets/PointSnappingHint-BW64llec.js","assets/dragEventPipeline3D-DsNJvEw9.js","assets/InteractiveToolBase-D0r-NsYb.js","assets/ToolIntersector-BuQ7wMHf.js","assets/analysisViewUtils-B1wpk_6Q.js","assets/SnappingDragPipelineStep-DfW1fzmJ.js","assets/SnappingOperation-rFjqxQSJ.js","assets/DimensionAnalysisView3D-CcpDwkMk.js","assets/LengthDimension-BozyOzYv.js","assets/Factory-DPm2FjD8.js","assets/VerticesVisualElement-DVofDPcs.js","assets/LineMarker.glsl-IjyxR9bg.js","assets/DirectLineMeasurementAnalysisView3D-CZkUt73o.js","assets/ElevationProfileAnalysisView3D-CItFX3ke.js","assets/settings-BcfJ2aRT.js","assets/OutlineVisualElement-BF3UskRL.js","assets/line-D3il1QUT.js","assets/triangulationUtils-BHzqTKh0.js","assets/createUtils-Ch_oOgx5.js","assets/distanceOperator-Db1TULc-.js","assets/Point2D-CITflfBj.js","assets/Distance2DCalculator-CXhBP-8I-COm7yLCO.js","assets/ProjectionTransformation-ySeecDBA.js","assets/Envelope2D-DxAWzC7Q.js","assets/Transformation2D-1iR8LGx8.js","assets/OperatorDefinitions-DP7_WWTp.js","assets/apiConverter-CjKzmSWX.js","assets/jsonConverter-Bk6Zhxnv.js","assets/simplifyOperator-DQdSMC-C.js","assets/operatorSimplify-BpJRPqv-.js","assets/ExclusiveOperationManager-TG28JTUV.js","assets/LineOfSightAnalysisView3D-sIFpk1Mp.js","assets/featureReferenceUtils-Ce2ossBP.js","assets/LineOfSightAnalysisTarget-SbDLf58d.js","assets/IViewEvents-CmZbREsE.js","assets/SliceAnalysisView3D-NTFHH9p-.js","assets/SlicePlane-BC4WuJHl.js","assets/SlicePlaneMaterial.glsl-CyWjuSWn.js","assets/sliceToolConfig-Bp-CGF1y.js","assets/RotateManipulator-DpMxwr0e.js","assets/ViewshedAnalysisView3D-BsB_Tei9.js","assets/Viewshed-bdnZN8OR.js","assets/MoveManipulation-Dw3UC8T5.js","assets/VolumeMeasurementAnalysisView3D-ZlC7w3iv.js","assets/Graphics3DExtrudeSymbolLayer-D7A2bnKV.js","assets/SketchTooltipInfo-94-FDD33.js","assets/MeshTransform-KQnpQ98Z.js","assets/angularMeasurementUtils-_ixAycTg.js","assets/TooltipInfoWithCoordinates-CK9MDWjs.js","assets/VoxelWasmPerSceneView-Dp9w0HoK.js","assets/Graphics3DSymbolLayerFactory-DfLWPFhx.js","assets/MeshComponent-BHMdsVwA.js","assets/meshProperties-DWLWd_LJ.js","assets/projectMeshVertexPositions-7qdS0Uny.js","assets/objectResourceUtils-CGmpDgmE.js","assets/indexUtils-C8rhztHn.js","assets/LodRenderer-CewVOxHM.js","assets/loader-D76-4GSr.js","assets/TerrainTileTree3DDebugger-DAiUujml.js","assets/TileTreeDebugger-DYJz3oTk.js","assets/EdgeView-B1fsha5-.js","assets/EdgeWorkerHandle-vd56NiZ5.js","assets/apng-DlHvO5H3.js","assets/Lyr3DWasmPerSceneView-DcYURmqY.js","assets/index-Bqoy6DTr.js","assets/index-Fus-u8VC.js","assets/guid-LcV_DAvu.js","assets/form-B0nAZmEi.js","assets/label-B2UoLWDU.js","assets/FeatureTileTree3DDebugger-BYUhEwbV.js","assets/GraphicsView3D-ClZ3AD8P.js","assets/FocusAreasView-VdEdISLd.js","assets/operatorDensify-CzGEJRrc.js","assets/FeatureTileTree3D-CtaKqhwB.js","assets/SliceAnalysis--DtWfgy-.js","assets/Analysis-DTQ4A5DS.js","assets/lengthOperator-xl-ca8hZ.js","assets/OperatorGeodeticLength-DfoIzJ_S.js","assets/OperatorShapePreservingLength-DIY-UR0H.js","assets/SelfSnappingEngine-CNTZE1Lj.js","assets/FeatureSnappingEngine-Cy08axzf.js","assets/geometryEngine-CezsK1kp.js","assets/editingTools-BwzpzWIp.js","assets/SnappingVisualizer2D-mjhgcp6D.js","assets/editPlaneUtils-DCw371QT.js","assets/GraphicManipulator-DQqX3CO9.js","assets/drawUtils-CFJWGTVy.js","assets/editingTools-WbUUs8iX.js","assets/GraphicState-BLszFnu-.js","assets/SelectedVertexTooltipInfo-BcUInJHm.js","assets/TranslateTooltipInfo-C0wB9nBt.js","assets/ExtentScaleTooltipInfo-DbDgMK_f.js","assets/GraphicMover-BHQMTlBr.js","assets/Box-DNuWVAPS.js","assets/settings-D6NMMBkA.js","assets/Reshape-DcThRwVo.js","assets/ElevationProfileView2D-D9X7LvBw.js","assets/visualizationUtils-DHi7t-ZE.js","assets/ElevationProfileView3D-DtJed9v8.js","assets/index-C5dSpmXR.js","assets/index-C-J18bUg.js","assets/InternalLabel-o39CfHJW.js","assets/index-CzpEcA6h.js","assets/index-rtBdrGAc.js","assets/index-8f7PrXGt.js","assets/Validation-BTLs1p4R.js","assets/index-Dos8U69S.js","assets/floating-ui-BVSZEkz7.js","assets/debounce-D0Dr7phT.js","assets/FloatingArrow-BkUzzAsA.js","assets/chartUtils-CAqnrRRA.js","assets/ResponsiveTheme-Byemke2A.js","assets/Theme-CSLSE7tF.js","assets/chartUtilsAm5-_9JrRPu3.js","assets/Tooltip-CPIh3r1P.js","assets/DefaultTheme-CzyYbDuP.js","assets/LineSeries-D2VuN9Ti.js","assets/ColorSet-DaeLsKer.js","assets/Tick-CHbnDDcj.js","assets/Button-Dqc4GZwb.js"])))=>i.map(i=>d[i]);
var s6e=Object.getPrototypeOf;var n6e=Reflect.get;var Kle=t=>{throw TypeError(t)};var g9=(t,e,i)=>e.has(t)||Kle("Cannot "+i);var Ur=(t,e,i)=>(g9(t,e,"read from private field"),i?i.call(t):e.get(t)),dd=(t,e,i)=>e.has(t)?Kle("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,i),pd=(t,e,i,r)=>(g9(t,e,"write to private field"),r?r.call(t,i):e.set(t,i),i),TE=(t,e,i)=>(g9(t,e,"access private method"),i);var ece=(t,e,i)=>n6e(s6e(t),i,e);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function i(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(s){if(s.ep)return;s.ep=!0;const n=i(s);fetch(s.href,n)}})();var y9={exports:{}},$E={};var tce;function a6e(){if(tce)return $E;tce=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function i(r,s,n){var a=null;if(n!==void 0&&(a=""+n),s.key!==void 0&&(a=""+s.key),"key"in s){n={};for(var o in s)o!=="key"&&(n[o]=s[o])}else n=s;return s=n.ref,{$$typeof:t,type:r,key:a,ref:s!==void 0?s:null,props:n}}return $E.Fragment=e,$E.jsx=i,$E.jsxs=i,$E}var ice;function o6e(){return ice||(ice=1,y9.exports=a6e()),y9.exports}var fw=o6e(),_9={exports:{}},pi={};var rce;function l6e(){if(rce)return pi;rce=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),n=Symbol.for("react.consumer"),a=Symbol.for("react.context"),o=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),c=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),f=Symbol.for("react.activity"),y=Symbol.iterator;function _(q){return q===null||typeof q!="object"?null:(q=y&&q[y]||q["@@iterator"],typeof q=="function"?q:null)}var w={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},x=Object.assign,S={};function $(q,ne,ce){this.props=q,this.context=ne,this.refs=S,this.updater=ce||w}$.prototype.isReactComponent={},$.prototype.setState=function(q,ne){if(typeof q!="object"&&typeof q!="function"&&q!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,q,ne,"setState")},$.prototype.forceUpdate=function(q){this.updater.enqueueForceUpdate(this,q,"forceUpdate")};function A(){}A.prototype=$.prototype;function M(q,ne,ce){this.props=q,this.context=ne,this.refs=S,this.updater=ce||w}var P=M.prototype=new A;P.constructor=M,x(P,$.prototype),P.isPureReactComponent=!0;var O=Array.isArray;function D(){}var L={H:null,A:null,T:null,S:null},F=Object.prototype.hasOwnProperty;function U(q,ne,ce){var be=ce.ref;return{$$typeof:t,type:q,key:ne,ref:be!==void 0?be:null,props:ce}}function N(q,ne){return U(q.type,ne,q.props)}function j(q){return typeof q=="object"&&q!==null&&q.$$typeof===t}function B(q){var ne={"=":"=0",":":"=2"};return"$"+q.replace(/[=:]/g,function(ce){return ne[ce]})}var Y=/\/+/g;function G(q,ne){return typeof q=="object"&&q!==null&&q.key!=null?B(""+q.key):ne.toString(36)}function Z(q){switch(q.status){case"fulfilled":return q.value;case"rejected":throw q.reason;default:switch(typeof q.status=="string"?q.then(D,D):(q.status="pending",q.then(function(ne){q.status==="pending"&&(q.status="fulfilled",q.value=ne)},function(ne){q.status==="pending"&&(q.status="rejected",q.reason=ne)})),q.status){case"fulfilled":return q.value;case"rejected":throw q.reason}}throw q}function H(q,ne,ce,be,ze){var Ne=typeof q;(Ne==="undefined"||Ne==="boolean")&&(q=null);var at=!1;if(q===null)at=!0;else switch(Ne){case"bigint":case"string":case"number":at=!0;break;case"object":switch(q.$$typeof){case t:case e:at=!0;break;case h:return at=q._init,H(at(q._payload),ne,ce,be,ze)}}if(at)return ze=ze(q),at=be===""?"."+G(q,0):be,O(ze)?(ce="",at!=null&&(ce=at.replace(Y,"$&/")+"/"),H(ze,ne,ce,"",function(It){return It})):ze!=null&&(j(ze)&&(ze=N(ze,ce+(ze.key==null||q&&q.key===ze.key?"":(""+ze.key).replace(Y,"$&/")+"/")+at)),ne.push(ze)),1;at=0;var Tt=be===""?".":be+":";if(O(q))for(var et=0;et<q.length;et++)be=q[et],Ne=Tt+G(be,et),at+=H(be,ne,ce,Ne,ze);else if(et=_(q),typeof et=="function")for(q=et.call(q),et=0;!(be=q.next()).done;)be=be.value,Ne=Tt+G(be,et++),at+=H(be,ne,ce,Ne,ze);else if(Ne==="object"){if(typeof q.then=="function")return H(Z(q),ne,ce,be,ze);throw ne=String(q),Error("Objects are not valid as a React child (found: "+(ne==="[object Object]"?"object with keys {"+Object.keys(q).join(", ")+"}":ne)+"). If you meant to render a collection of children, use an array instead.")}return at}function Q(q,ne,ce){if(q==null)return q;var be=[],ze=0;return H(q,be,"","",function(Ne){return ne.call(ce,Ne,ze++)}),be}function X(q){if(q._status===-1){var ne=q._result;ne=ne(),ne.then(function(ce){(q._status===0||q._status===-1)&&(q._status=1,q._result=ce)},function(ce){(q._status===0||q._status===-1)&&(q._status=2,q._result=ce)}),q._status===-1&&(q._status=0,q._result=ne)}if(q._status===1)return q._result.default;throw q._result}var ye=typeof reportError=="function"?reportError:function(q){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var ne=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof q=="object"&&q!==null&&typeof q.message=="string"?String(q.message):String(q),error:q});if(!window.dispatchEvent(ne))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",q);return}console.error(q)},De={map:Q,forEach:function(q,ne,ce){Q(q,function(){ne.apply(this,arguments)},ce)},count:function(q){var ne=0;return Q(q,function(){ne++}),ne},toArray:function(q){return Q(q,function(ne){return ne})||[]},only:function(q){if(!j(q))throw Error("React.Children.only expected to receive a single React element child.");return q}};return pi.Activity=f,pi.Children=De,pi.Component=$,pi.Fragment=i,pi.Profiler=s,pi.PureComponent=M,pi.StrictMode=r,pi.Suspense=l,pi.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=L,pi.__COMPILER_RUNTIME={__proto__:null,c:function(q){return L.H.useMemoCache(q)}},pi.cache=function(q){return function(){return q.apply(null,arguments)}},pi.cacheSignal=function(){return null},pi.cloneElement=function(q,ne,ce){if(q==null)throw Error("The argument must be a React element, but you passed "+q+".");var be=x({},q.props),ze=q.key;if(ne!=null)for(Ne in ne.key!==void 0&&(ze=""+ne.key),ne)!F.call(ne,Ne)||Ne==="key"||Ne==="__self"||Ne==="__source"||Ne==="ref"&&ne.ref===void 0||(be[Ne]=ne[Ne]);var Ne=arguments.length-2;if(Ne===1)be.children=ce;else if(1<Ne){for(var at=Array(Ne),Tt=0;Tt<Ne;Tt++)at[Tt]=arguments[Tt+2];be.children=at}return U(q.type,ze,be)},pi.createContext=function(q){return q={$$typeof:a,_currentValue:q,_currentValue2:q,_threadCount:0,Provider:null,Consumer:null},q.Provider=q,q.Consumer={$$typeof:n,_context:q},q},pi.createElement=function(q,ne,ce){var be,ze={},Ne=null;if(ne!=null)for(be in ne.key!==void 0&&(Ne=""+ne.key),ne)F.call(ne,be)&&be!=="key"&&be!=="__self"&&be!=="__source"&&(ze[be]=ne[be]);var at=arguments.length-2;if(at===1)ze.children=ce;else if(1<at){for(var Tt=Array(at),et=0;et<at;et++)Tt[et]=arguments[et+2];ze.children=Tt}if(q&&q.defaultProps)for(be in at=q.defaultProps,at)ze[be]===void 0&&(ze[be]=at[be]);return U(q,Ne,ze)},pi.createRef=function(){return{current:null}},pi.forwardRef=function(q){return{$$typeof:o,render:q}},pi.isValidElement=j,pi.lazy=function(q){return{$$typeof:h,_payload:{_status:-1,_result:q},_init:X}},pi.memo=function(q,ne){return{$$typeof:c,type:q,compare:ne===void 0?null:ne}},pi.startTransition=function(q){var ne=L.T,ce={};L.T=ce;try{var be=q(),ze=L.S;ze!==null&&ze(ce,be),typeof be=="object"&&be!==null&&typeof be.then=="function"&&be.then(D,ye)}catch(Ne){ye(Ne)}finally{ne!==null&&ce.types!==null&&(ne.types=ce.types),L.T=ne}},pi.unstable_useCacheRefresh=function(){return L.H.useCacheRefresh()},pi.use=function(q){return L.H.use(q)},pi.useActionState=function(q,ne,ce){return L.H.useActionState(q,ne,ce)},pi.useCallback=function(q,ne){return L.H.useCallback(q,ne)},pi.useContext=function(q){return L.H.useContext(q)},pi.useDebugValue=function(){},pi.useDeferredValue=function(q,ne){return L.H.useDeferredValue(q,ne)},pi.useEffect=function(q,ne){return L.H.useEffect(q,ne)},pi.useEffectEvent=function(q){return L.H.useEffectEvent(q)},pi.useId=function(){return L.H.useId()},pi.useImperativeHandle=function(q,ne,ce){return L.H.useImperativeHandle(q,ne,ce)},pi.useInsertionEffect=function(q,ne){return L.H.useInsertionEffect(q,ne)},pi.useLayoutEffect=function(q,ne){return L.H.useLayoutEffect(q,ne)},pi.useMemo=function(q,ne){return L.H.useMemo(q,ne)},pi.useOptimistic=function(q,ne){return L.H.useOptimistic(q,ne)},pi.useReducer=function(q,ne,ce){return L.H.useReducer(q,ne,ce)},pi.useRef=function(q){return L.H.useRef(q)},pi.useState=function(q){return L.H.useState(q)},pi.useSyncExternalStore=function(q,ne,ce){return L.H.useSyncExternalStore(q,ne,ce)},pi.useTransition=function(){return L.H.useTransition()},pi.version="19.2.3",pi}var sce;function NJ(){return sce||(sce=1,_9.exports=l6e()),_9.exports}var z1e=NJ(),v9={exports:{}},CE={},b9={exports:{}},w9={};var nce;function c6e(){return nce||(nce=1,(function(t){function e(H,Q){var X=H.length;H.push(Q);e:for(;0<X;){var ye=X-1>>>1,De=H[ye];if(0<s(De,Q))H[ye]=Q,H[X]=De,X=ye;else break e}}function i(H){return H.length===0?null:H[0]}function r(H){if(H.length===0)return null;var Q=H[0],X=H.pop();if(X!==Q){H[0]=X;e:for(var ye=0,De=H.length,q=De>>>1;ye<q;){var ne=2*(ye+1)-1,ce=H[ne],be=ne+1,ze=H[be];if(0>s(ce,X))be<De&&0>s(ze,ce)?(H[ye]=ze,H[be]=X,ye=be):(H[ye]=ce,H[ne]=X,ye=ne);else if(be<De&&0>s(ze,X))H[ye]=ze,H[be]=X,ye=be;else break e}}return Q}function s(H,Q){var X=H.sortIndex-Q.sortIndex;return X!==0?X:H.id-Q.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var n=performance;t.unstable_now=function(){return n.now()}}else{var a=Date,o=a.now();t.unstable_now=function(){return a.now()-o}}var l=[],c=[],h=1,f=null,y=3,_=!1,w=!1,x=!1,S=!1,$=typeof setTimeout=="function"?setTimeout:null,A=typeof clearTimeout=="function"?clearTimeout:null,M=typeof setImmediate<"u"?setImmediate:null;function P(H){for(var Q=i(c);Q!==null;){if(Q.callback===null)r(c);else if(Q.startTime<=H)r(c),Q.sortIndex=Q.expirationTime,e(l,Q);else break;Q=i(c)}}function O(H){if(x=!1,P(H),!w)if(i(l)!==null)w=!0,D||(D=!0,B());else{var Q=i(c);Q!==null&&Z(O,Q.startTime-H)}}var D=!1,L=-1,F=5,U=-1;function N(){return S?!0:!(t.unstable_now()-U<F)}function j(){if(S=!1,D){var H=t.unstable_now();U=H;var Q=!0;try{e:{w=!1,x&&(x=!1,A(L),L=-1),_=!0;var X=y;try{t:{for(P(H),f=i(l);f!==null&&!(f.expirationTime>H&&N());){var ye=f.callback;if(typeof ye=="function"){f.callback=null,y=f.priorityLevel;var De=ye(f.expirationTime<=H);if(H=t.unstable_now(),typeof De=="function"){f.callback=De,P(H),Q=!0;break t}f===i(l)&&r(l),P(H)}else r(l);f=i(l)}if(f!==null)Q=!0;else{var q=i(c);q!==null&&Z(O,q.startTime-H),Q=!1}}break e}finally{f=null,y=X,_=!1}Q=void 0}}finally{Q?B():D=!1}}}var B;if(typeof M=="function")B=function(){M(j)};else if(typeof MessageChannel<"u"){var Y=new MessageChannel,G=Y.port2;Y.port1.onmessage=j,B=function(){G.postMessage(null)}}else B=function(){$(j,0)};function Z(H,Q){L=$(function(){H(t.unstable_now())},Q)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(H){H.callback=null},t.unstable_forceFrameRate=function(H){0>H||125<H?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):F=0<H?Math.floor(1e3/H):5},t.unstable_getCurrentPriorityLevel=function(){return y},t.unstable_next=function(H){switch(y){case 1:case 2:case 3:var Q=3;break;default:Q=y}var X=y;y=Q;try{return H()}finally{y=X}},t.unstable_requestPaint=function(){S=!0},t.unstable_runWithPriority=function(H,Q){switch(H){case 1:case 2:case 3:case 4:case 5:break;default:H=3}var X=y;y=H;try{return Q()}finally{y=X}},t.unstable_scheduleCallback=function(H,Q,X){var ye=t.unstable_now();switch(typeof X=="object"&&X!==null?(X=X.delay,X=typeof X=="number"&&0<X?ye+X:ye):X=ye,H){case 1:var De=-1;break;case 2:De=250;break;case 5:De=1073741823;break;case 4:De=1e4;break;default:De=5e3}return De=X+De,H={id:h++,callback:Q,priorityLevel:H,startTime:X,expirationTime:De,sortIndex:-1},X>ye?(H.sortIndex=X,e(c,H),i(l)===null&&H===i(c)&&(x?(A(L),L=-1):x=!0,Z(O,X-ye))):(H.sortIndex=De,e(l,H),w||_||(w=!0,D||(D=!0,B()))),H},t.unstable_shouldYield=N,t.unstable_wrapCallback=function(H){var Q=y;return function(){var X=y;y=Q;try{return H.apply(this,arguments)}finally{y=X}}}})(w9)),w9}var ace;function u6e(){return ace||(ace=1,b9.exports=c6e()),b9.exports}var x9={exports:{}},Uo={};var oce;function h6e(){if(oce)return Uo;oce=1;var t=NJ();function e(l){var c="https://react.dev/errors/"+l;if(1<arguments.length){c+="?args[]="+encodeURIComponent(arguments[1]);for(var h=2;h<arguments.length;h++)c+="&args[]="+encodeURIComponent(arguments[h])}return"Minified React error #"+l+"; visit "+c+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(){}var r={d:{f:i,r:function(){throw Error(e(522))},D:i,C:i,L:i,m:i,X:i,S:i,M:i},p:0,findDOMNode:null},s=Symbol.for("react.portal");function n(l,c,h){var f=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:s,key:f==null?null:""+f,children:l,containerInfo:c,implementation:h}}var a=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function o(l,c){if(l==="font")return"";if(typeof c=="string")return c==="use-credentials"?c:""}return Uo.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,Uo.createPortal=function(l,c){var h=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!c||c.nodeType!==1&&c.nodeType!==9&&c.nodeType!==11)throw Error(e(299));return n(l,c,null,h)},Uo.flushSync=function(l){var c=a.T,h=r.p;try{if(a.T=null,r.p=2,l)return l()}finally{a.T=c,r.p=h,r.d.f()}},Uo.preconnect=function(l,c){typeof l=="string"&&(c?(c=c.crossOrigin,c=typeof c=="string"?c==="use-credentials"?c:"":void 0):c=null,r.d.C(l,c))},Uo.prefetchDNS=function(l){typeof l=="string"&&r.d.D(l)},Uo.preinit=function(l,c){if(typeof l=="string"&&c&&typeof c.as=="string"){var h=c.as,f=o(h,c.crossOrigin),y=typeof c.integrity=="string"?c.integrity:void 0,_=typeof c.fetchPriority=="string"?c.fetchPriority:void 0;h==="style"?r.d.S(l,typeof c.precedence=="string"?c.precedence:void 0,{crossOrigin:f,integrity:y,fetchPriority:_}):h==="script"&&r.d.X(l,{crossOrigin:f,integrity:y,fetchPriority:_,nonce:typeof c.nonce=="string"?c.nonce:void 0})}},Uo.preinitModule=function(l,c){if(typeof l=="string")if(typeof c=="object"&&c!==null){if(c.as==null||c.as==="script"){var h=o(c.as,c.crossOrigin);r.d.M(l,{crossOrigin:h,integrity:typeof c.integrity=="string"?c.integrity:void 0,nonce:typeof c.nonce=="string"?c.nonce:void 0})}}else c==null&&r.d.M(l)},Uo.preload=function(l,c){if(typeof l=="string"&&typeof c=="object"&&c!==null&&typeof c.as=="string"){var h=c.as,f=o(h,c.crossOrigin);r.d.L(l,h,{crossOrigin:f,integrity:typeof c.integrity=="string"?c.integrity:void 0,nonce:typeof c.nonce=="string"?c.nonce:void 0,type:typeof c.type=="string"?c.type:void 0,fetchPriority:typeof c.fetchPriority=="string"?c.fetchPriority:void 0,referrerPolicy:typeof c.referrerPolicy=="string"?c.referrerPolicy:void 0,imageSrcSet:typeof c.imageSrcSet=="string"?c.imageSrcSet:void 0,imageSizes:typeof c.imageSizes=="string"?c.imageSizes:void 0,media:typeof c.media=="string"?c.media:void 0})}},Uo.preloadModule=function(l,c){if(typeof l=="string")if(c){var h=o(c.as,c.crossOrigin);r.d.m(l,{as:typeof c.as=="string"&&c.as!=="script"?c.as:void 0,crossOrigin:h,integrity:typeof c.integrity=="string"?c.integrity:void 0})}else r.d.m(l)},Uo.requestFormReset=function(l){r.d.r(l)},Uo.unstable_batchedUpdates=function(l,c){return l(c)},Uo.useFormState=function(l,c,h){return a.H.useFormState(l,c,h)},Uo.useFormStatus=function(){return a.H.useHostTransitionStatus()},Uo.version="19.2.3",Uo}var lce;function d6e(){if(lce)return x9.exports;lce=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),x9.exports=h6e(),x9.exports}var cce;function p6e(){if(cce)return CE;cce=1;var t=u6e(),e=NJ(),i=d6e();function r(u){var p="https://react.dev/errors/"+u;if(1<arguments.length){p+="?args[]="+encodeURIComponent(arguments[1]);for(var g=2;g<arguments.length;g++)p+="&args[]="+encodeURIComponent(arguments[g])}return"Minified React error #"+u+"; visit "+p+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(u){return!(!u||u.nodeType!==1&&u.nodeType!==9&&u.nodeType!==11)}function n(u){var p=u,g=u;if(u.alternate)for(;p.return;)p=p.return;else{u=p;do p=u,(p.flags&4098)!==0&&(g=p.return),u=p.return;while(u)}return p.tag===3?g:null}function a(u){if(u.tag===13){var p=u.memoizedState;if(p===null&&(u=u.alternate,u!==null&&(p=u.memoizedState)),p!==null)return p.dehydrated}return null}function o(u){if(u.tag===31){var p=u.memoizedState;if(p===null&&(u=u.alternate,u!==null&&(p=u.memoizedState)),p!==null)return p.dehydrated}return null}function l(u){if(n(u)!==u)throw Error(r(188))}function c(u){var p=u.alternate;if(!p){if(p=n(u),p===null)throw Error(r(188));return p!==u?null:u}for(var g=u,b=p;;){var T=g.return;if(T===null)break;var C=T.alternate;if(C===null){if(b=T.return,b!==null){g=b;continue}break}if(T.child===C.child){for(C=T.child;C;){if(C===g)return l(T),u;if(C===b)return l(T),p;C=C.sibling}throw Error(r(188))}if(g.return!==b.return)g=T,b=C;else{for(var I=!1,V=T.child;V;){if(V===g){I=!0,g=T,b=C;break}if(V===b){I=!0,b=T,g=C;break}V=V.sibling}if(!I){for(V=C.child;V;){if(V===g){I=!0,g=C,b=T;break}if(V===b){I=!0,b=C,g=T;break}V=V.sibling}if(!I)throw Error(r(189))}}if(g.alternate!==b)throw Error(r(190))}if(g.tag!==3)throw Error(r(188));return g.stateNode.current===g?u:p}function h(u){var p=u.tag;if(p===5||p===26||p===27||p===6)return u;for(u=u.child;u!==null;){if(p=h(u),p!==null)return p;u=u.sibling}return null}var f=Object.assign,y=Symbol.for("react.element"),_=Symbol.for("react.transitional.element"),w=Symbol.for("react.portal"),x=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),$=Symbol.for("react.profiler"),A=Symbol.for("react.consumer"),M=Symbol.for("react.context"),P=Symbol.for("react.forward_ref"),O=Symbol.for("react.suspense"),D=Symbol.for("react.suspense_list"),L=Symbol.for("react.memo"),F=Symbol.for("react.lazy"),U=Symbol.for("react.activity"),N=Symbol.for("react.memo_cache_sentinel"),j=Symbol.iterator;function B(u){return u===null||typeof u!="object"?null:(u=j&&u[j]||u["@@iterator"],typeof u=="function"?u:null)}var Y=Symbol.for("react.client.reference");function G(u){if(u==null)return null;if(typeof u=="function")return u.$$typeof===Y?null:u.displayName||u.name||null;if(typeof u=="string")return u;switch(u){case x:return"Fragment";case $:return"Profiler";case S:return"StrictMode";case O:return"Suspense";case D:return"SuspenseList";case U:return"Activity"}if(typeof u=="object")switch(u.$$typeof){case w:return"Portal";case M:return u.displayName||"Context";case A:return(u._context.displayName||"Context")+".Consumer";case P:var p=u.render;return u=u.displayName,u||(u=p.displayName||p.name||"",u=u!==""?"ForwardRef("+u+")":"ForwardRef"),u;case L:return p=u.displayName||null,p!==null?p:G(u.type)||"Memo";case F:p=u._payload,u=u._init;try{return G(u(p))}catch{}}return null}var Z=Array.isArray,H=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Q=i.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,X={pending:!1,data:null,method:null,action:null},ye=[],De=-1;function q(u){return{current:u}}function ne(u){0>De||(u.current=ye[De],ye[De]=null,De--)}function ce(u,p){De++,ye[De]=u.current,u.current=p}var be=q(null),ze=q(null),Ne=q(null),at=q(null);function Tt(u,p){switch(ce(Ne,p),ce(ze,u),ce(be,null),p.nodeType){case 9:case 11:u=(u=p.documentElement)&&(u=u.namespaceURI)?xle(u):0;break;default:if(u=p.tagName,p=p.namespaceURI)p=xle(p),u=Sle(p,u);else switch(u){case"svg":u=1;break;case"math":u=2;break;default:u=0}}ne(be),ce(be,u)}function et(){ne(be),ne(ze),ne(Ne)}function It(u){u.memoizedState!==null&&ce(at,u);var p=be.current,g=Sle(p,u.type);p!==g&&(ce(ze,u),ce(be,g))}function $t(u){ze.current===u&&(ne(be),ne(ze)),at.current===u&&(ne(at),bE._currentValue=X)}var Ct,jt;function Ue(u){if(Ct===void 0)try{throw Error()}catch(g){var p=g.stack.trim().match(/\n( *(at )?)/);Ct=p&&p[1]||"",jt=-1<g.stack.indexOf(`
    at`)?" (<anonymous>)":-1<g.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Ct+u+jt}var Ft=!1;function qe(u,p){if(!u||Ft)return"";Ft=!0;var g=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var b={DetermineComponentFrameRoot:function(){try{if(p){var Pe=function(){throw Error()};if(Object.defineProperty(Pe.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Pe,[])}catch(we){var ge=we}Reflect.construct(u,[],Pe)}else{try{Pe.call()}catch(we){ge=we}u.call(Pe.prototype)}}else{try{throw Error()}catch(we){ge=we}(Pe=u())&&typeof Pe.catch=="function"&&Pe.catch(function(){})}}catch(we){if(we&&ge&&typeof we.stack=="string")return[we.stack,ge.stack]}return[null,null]}};b.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var T=Object.getOwnPropertyDescriptor(b.DetermineComponentFrameRoot,"name");T&&T.configurable&&Object.defineProperty(b.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var C=b.DetermineComponentFrameRoot(),I=C[0],V=C[1];if(I&&V){var J=I.split(`
`),me=V.split(`
`);for(T=b=0;b<J.length&&!J[b].includes("DetermineComponentFrameRoot");)b++;for(;T<me.length&&!me[T].includes("DetermineComponentFrameRoot");)T++;if(b===J.length||T===me.length)for(b=J.length-1,T=me.length-1;1<=b&&0<=T&&J[b]!==me[T];)T--;for(;1<=b&&0<=T;b--,T--)if(J[b]!==me[T]){if(b!==1||T!==1)do if(b--,T--,0>T||J[b]!==me[T]){var $e=`
`+J[b].replace(" at new "," at ");return u.displayName&&$e.includes("<anonymous>")&&($e=$e.replace("<anonymous>",u.displayName)),$e}while(1<=b&&0<=T);break}}}finally{Ft=!1,Error.prepareStackTrace=g}return(g=u?u.displayName||u.name:"")?Ue(g):""}function je(u,p){switch(u.tag){case 26:case 27:case 5:return Ue(u.type);case 16:return Ue("Lazy");case 13:return u.child!==p&&p!==null?Ue("Suspense Fallback"):Ue("Suspense");case 19:return Ue("SuspenseList");case 0:case 15:return qe(u.type,!1);case 11:return qe(u.type.render,!1);case 1:return qe(u.type,!0);case 31:return Ue("Activity");default:return""}}function gt(u){try{var p="",g=null;do p+=je(u,g),g=u,u=u.return;while(u);return p}catch(b){return`
Error generating stack: `+b.message+`
`+b.stack}}var ct=Object.prototype.hasOwnProperty,Ot=t.unstable_scheduleCallback,Xe=t.unstable_cancelCallback,We=t.unstable_shouldYield,Ye=t.unstable_requestPaint,rt=t.unstable_now,Zt=t.unstable_getCurrentPriorityLevel,Li=t.unstable_ImmediatePriority,Ci=t.unstable_UserBlockingPriority,ei=t.unstable_NormalPriority,Gi=t.unstable_LowPriority,Ui=t.unstable_IdlePriority,gi=t.log,yi=t.unstable_setDisableYieldValue,ti=null,wt=null;function Nt(u){if(typeof gi=="function"&&yi(u),wt&&typeof wt.setStrictMode=="function")try{wt.setStrictMode(ti,u)}catch{}}var Vt=Math.clz32?Math.clz32:Bi,Mi=Math.log,Mr=Math.LN2;function Bi(u){return u>>>=0,u===0?32:31-(Mi(u)/Mr|0)|0}var Ei=256,Er=262144,Fr=4194304;function gs(u){var p=u&42;if(p!==0)return p;switch(u&-u){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return u&261888;case 262144:case 524288:case 1048576:case 2097152:return u&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return u&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return u}}function ia(u,p,g){var b=u.pendingLanes;if(b===0)return 0;var T=0,C=u.suspendedLanes,I=u.pingedLanes;u=u.warmLanes;var V=b&134217727;return V!==0?(b=V&~C,b!==0?T=gs(b):(I&=V,I!==0?T=gs(I):g||(g=V&~u,g!==0&&(T=gs(g))))):(V=b&~C,V!==0?T=gs(V):I!==0?T=gs(I):g||(g=b&~u,g!==0&&(T=gs(g)))),T===0?0:p!==0&&p!==T&&(p&C)===0&&(C=T&-T,g=p&-p,C>=g||C===32&&(g&4194048)!==0)?p:T}function ln(u,p){return(u.pendingLanes&~(u.suspendedLanes&~u.pingedLanes)&p)===0}function fo(u,p){switch(u){case 1:case 2:case 4:case 8:case 64:return p+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return p+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ue(){var u=Fr;return Fr<<=1,(Fr&62914560)===0&&(Fr=4194304),u}function ii(u){for(var p=[],g=0;31>g;g++)p.push(u);return p}function Jt(u,p){u.pendingLanes|=p,p!==268435456&&(u.suspendedLanes=0,u.pingedLanes=0,u.warmLanes=0)}function Nr(u,p,g,b,T,C){var I=u.pendingLanes;u.pendingLanes=g,u.suspendedLanes=0,u.pingedLanes=0,u.warmLanes=0,u.expiredLanes&=g,u.entangledLanes&=g,u.errorRecoveryDisabledLanes&=g,u.shellSuspendCounter=0;var V=u.entanglements,J=u.expirationTimes,me=u.hiddenUpdates;for(g=I&~g;0<g;){var $e=31-Vt(g),Pe=1<<$e;V[$e]=0,J[$e]=-1;var ge=me[$e];if(ge!==null)for(me[$e]=null,$e=0;$e<ge.length;$e++){var we=ge[$e];we!==null&&(we.lane&=-536870913)}g&=~Pe}b!==0&&Hi(u,b,0),C!==0&&T===0&&u.tag!==0&&(u.suspendedLanes|=C&~(I&~p))}function Hi(u,p,g){u.pendingLanes|=p,u.suspendedLanes&=~p;var b=31-Vt(p);u.entangledLanes|=p,u.entanglements[b]=u.entanglements[b]|1073741824|g&261930}function Ss(u,p){var g=u.entangledLanes|=p;for(u=u.entanglements;g;){var b=31-Vt(g),T=1<<b;T&p|u[b]&p&&(u[b]|=p),g&=~T}}function Je(u,p){var g=p&-p;return g=(g&42)!==0?1:Ha(g),(g&(u.suspendedLanes|p))!==0?0:g}function Ha(u){switch(u){case 2:u=1;break;case 8:u=4;break;case 32:u=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:u=128;break;case 268435456:u=134217728;break;default:u=0}return u}function mo(u){return u&=-u,2<u?8<u?(u&134217727)!==0?32:268435456:8:2}function er(){var u=Q.p;return u!==0?u:(u=window.event,u===void 0?32:Hle(u.type))}function ra(u,p){var g=Q.p;try{return Q.p=u,p()}finally{Q.p=g}}var Rs=Math.random().toString(36).slice(2),vi="__reactFiber$"+Rs,Pa="__reactProps$"+Rs,nd="__reactContainer$"+Rs,qt="__reactEvents$"+Rs,om="__reactListeners$"+Rs,ad="__reactHandles$"+Rs,lm="__reactResources$"+Rs,Rp="__reactMarker$"+Rs;function Jl(u){delete u[vi],delete u[Pa],delete u[qt],delete u[om],delete u[ad]}function hl(u){var p=u[vi];if(p)return p;for(var g=u.parentNode;g;){if(p=g[nd]||g[vi]){if(g=p.alternate,p.child!==null||g!==null&&g.child!==null)for(u=Ole(u);u!==null;){if(g=u[vi])return g;u=Ole(u)}return p}u=g,g=u.parentNode}return null}function go(u){if(u=u[vi]||u[nd]){var p=u.tag;if(p===5||p===6||p===13||p===31||p===26||p===27||p===3)return u}return null}function ji(u){var p=u.tag;if(p===5||p===26||p===27||p===6)return u.stateNode;throw Error(r(33))}function Ra(u){var p=u[lm];return p||(p=u[lm]={hoistableStyles:new Map,hoistableScripts:new Map}),p}function Vr(u){u[Rp]=!0}var Dn=new Set,qc={};function No(u,p){dl(u,p),dl(u+"Capture",p)}function dl(u,p){for(qc[u]=p,u=0;u<p.length;u++)Dn.add(p[u])}var od=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),sa={},Dp={};function Ip(u){return ct.call(Dp,u)?!0:ct.call(sa,u)?!1:od.test(u)?Dp[u]=!0:(sa[u]=!0,!1)}function ld(u,p,g){if(Ip(p))if(g===null)u.removeAttribute(p);else{switch(typeof g){case"undefined":case"function":case"symbol":u.removeAttribute(p);return;case"boolean":var b=p.toLowerCase().slice(0,5);if(b!=="data-"&&b!=="aria-"){u.removeAttribute(p);return}}u.setAttribute(p,""+g)}}function Lp(u,p,g){if(g===null)u.removeAttribute(p);else{switch(typeof g){case"undefined":case"function":case"symbol":case"boolean":u.removeAttribute(p);return}u.setAttribute(p,""+g)}}function W(u,p,g,b){if(b===null)u.removeAttribute(g);else{switch(typeof b){case"undefined":case"function":case"symbol":case"boolean":u.removeAttribute(g);return}u.setAttributeNS(p,g,""+b)}}function he(u){switch(typeof u){case"bigint":case"boolean":case"number":case"string":case"undefined":return u;case"object":return u;default:return""}}function Ve(u){var p=u.type;return(u=u.nodeName)&&u.toLowerCase()==="input"&&(p==="checkbox"||p==="radio")}function Pt(u,p,g){var b=Object.getOwnPropertyDescriptor(u.constructor.prototype,p);if(!u.hasOwnProperty(p)&&typeof b<"u"&&typeof b.get=="function"&&typeof b.set=="function"){var T=b.get,C=b.set;return Object.defineProperty(u,p,{configurable:!0,get:function(){return T.call(this)},set:function(I){g=""+I,C.call(this,I)}}),Object.defineProperty(u,p,{enumerable:b.enumerable}),{getValue:function(){return g},setValue:function(I){g=""+I},stopTracking:function(){u._valueTracker=null,delete u[p]}}}}function ki(u){if(!u._valueTracker){var p=Ve(u)?"checked":"value";u._valueTracker=Pt(u,p,""+u[p])}}function is(u){if(!u)return!1;var p=u._valueTracker;if(!p)return!0;var g=p.getValue(),b="";return u&&(b=Ve(u)?u.checked?"true":"false":u.value),u=b,u!==g?(p.setValue(u),!0):!1}function ys(u){if(u=u||(typeof document<"u"?document:void 0),typeof u>"u")return null;try{return u.activeElement||u.body}catch{return u.body}}var In=/[\n"\\]/g;function Vo(u){return u.replace(In,function(p){return"\\"+p.charCodeAt(0).toString(16)+" "})}function w2(u,p,g,b,T,C,I,V){u.name="",I!=null&&typeof I!="function"&&typeof I!="symbol"&&typeof I!="boolean"?u.type=I:u.removeAttribute("type"),p!=null?I==="number"?(p===0&&u.value===""||u.value!=p)&&(u.value=""+he(p)):u.value!==""+he(p)&&(u.value=""+he(p)):I!=="submit"&&I!=="reset"||u.removeAttribute("value"),p!=null?x2(u,I,he(p)):g!=null?x2(u,I,he(g)):b!=null&&u.removeAttribute("value"),T==null&&C!=null&&(u.defaultChecked=!!C),T!=null&&(u.checked=T&&typeof T!="function"&&typeof T!="symbol"),V!=null&&typeof V!="function"&&typeof V!="symbol"&&typeof V!="boolean"?u.name=""+he(V):u.removeAttribute("name")}function kM(u,p,g,b,T,C,I,V){if(C!=null&&typeof C!="function"&&typeof C!="symbol"&&typeof C!="boolean"&&(u.type=C),p!=null||g!=null){if(!(C!=="submit"&&C!=="reset"||p!=null)){ki(u);return}g=g!=null?""+he(g):"",p=p!=null?""+he(p):g,V||p===u.value||(u.value=p),u.defaultValue=p}b=b??T,b=typeof b!="function"&&typeof b!="symbol"&&!!b,u.checked=V?u.checked:!!b,u.defaultChecked=!!b,I!=null&&typeof I!="function"&&typeof I!="symbol"&&typeof I!="boolean"&&(u.name=I),ki(u)}function x2(u,p,g){p==="number"&&ys(u.ownerDocument)===u||u.defaultValue===""+g||(u.defaultValue=""+g)}function kp(u,p,g,b){if(u=u.options,p){p={};for(var T=0;T<g.length;T++)p["$"+g[T]]=!0;for(g=0;g<u.length;g++)T=p.hasOwnProperty("$"+u[g].value),u[g].selected!==T&&(u[g].selected=T),T&&b&&(u[g].defaultSelected=!0)}else{for(g=""+he(g),p=null,T=0;T<u.length;T++){if(u[T].value===g){u[T].selected=!0,b&&(u[T].defaultSelected=!0);return}p!==null||u[T].disabled||(p=u[T])}p!==null&&(p.selected=!0)}}function yne(u,p,g){if(p!=null&&(p=""+he(p),p!==u.value&&(u.value=p),g==null)){u.defaultValue!==p&&(u.defaultValue=p);return}u.defaultValue=g!=null?""+he(g):""}function _ne(u,p,g,b){if(p==null){if(b!=null){if(g!=null)throw Error(r(92));if(Z(b)){if(1<b.length)throw Error(r(93));b=b[0]}g=b}g==null&&(g=""),p=g}g=he(p),u.defaultValue=g,b=u.textContent,b===g&&b!==""&&b!==null&&(u.value=b),ki(u)}function S2(u,p){if(p){var g=u.firstChild;if(g&&g===u.lastChild&&g.nodeType===3){g.nodeValue=p;return}}u.textContent=p}var Kze=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function vne(u,p,g){var b=p.indexOf("--")===0;g==null||typeof g=="boolean"||g===""?b?u.setProperty(p,""):p==="float"?u.cssFloat="":u[p]="":b?u.setProperty(p,g):typeof g!="number"||g===0||Kze.has(p)?p==="float"?u.cssFloat=g:u[p]=(""+g).trim():u[p]=g+"px"}function bne(u,p,g){if(p!=null&&typeof p!="object")throw Error(r(62));if(u=u.style,g!=null){for(var b in g)!g.hasOwnProperty(b)||p!=null&&p.hasOwnProperty(b)||(b.indexOf("--")===0?u.setProperty(b,""):b==="float"?u.cssFloat="":u[b]="");for(var T in p)b=p[T],p.hasOwnProperty(T)&&g[T]!==b&&vne(u,T,b)}else for(var C in p)p.hasOwnProperty(C)&&vne(u,C,p[C])}function dB(u){if(u.indexOf("-")===-1)return!1;switch(u){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var eFe=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),tFe=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function B4(u){return tFe.test(""+u)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":u}function cm(){}var pB=null;function fB(u){return u=u.target||u.srcElement||window,u.correspondingUseElement&&(u=u.correspondingUseElement),u.nodeType===3?u.parentNode:u}var T2=null,$2=null;function wne(u){var p=go(u);if(p&&(u=p.stateNode)){var g=u[Pa]||null;e:switch(u=p.stateNode,p.type){case"input":if(w2(u,g.value,g.defaultValue,g.defaultValue,g.checked,g.defaultChecked,g.type,g.name),p=g.name,g.type==="radio"&&p!=null){for(g=u;g.parentNode;)g=g.parentNode;for(g=g.querySelectorAll('input[name="'+Vo(""+p)+'"][type="radio"]'),p=0;p<g.length;p++){var b=g[p];if(b!==u&&b.form===u.form){var T=b[Pa]||null;if(!T)throw Error(r(90));w2(b,T.value,T.defaultValue,T.defaultValue,T.checked,T.defaultChecked,T.type,T.name)}}for(p=0;p<g.length;p++)b=g[p],b.form===u.form&&is(b)}break e;case"textarea":yne(u,g.value,g.defaultValue);break e;case"select":p=g.value,p!=null&&kp(u,!!g.multiple,p,!1)}}}var mB=!1;function xne(u,p,g){if(mB)return u(p,g);mB=!0;try{var b=u(p);return b}finally{if(mB=!1,(T2!==null||$2!==null)&&(AI(),T2&&(p=T2,u=$2,$2=T2=null,wne(p),u)))for(p=0;p<u.length;p++)wne(u[p])}}function zM(u,p){var g=u.stateNode;if(g===null)return null;var b=g[Pa]||null;if(b===null)return null;g=b[p];e:switch(p){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(b=!b.disabled)||(u=u.type,b=!(u==="button"||u==="input"||u==="select"||u==="textarea")),u=!b;break e;default:u=!1}if(u)return null;if(g&&typeof g!="function")throw Error(r(231,p,typeof g));return g}var um=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),gB=!1;if(um)try{var FM={};Object.defineProperty(FM,"passive",{get:function(){gB=!0}}),window.addEventListener("test",FM,FM),window.removeEventListener("test",FM,FM)}catch{gB=!1}var Uy=null,yB=null,j4=null;function Sne(){if(j4)return j4;var u,p=yB,g=p.length,b,T="value"in Uy?Uy.value:Uy.textContent,C=T.length;for(u=0;u<g&&p[u]===T[u];u++);var I=g-u;for(b=1;b<=I&&p[g-b]===T[C-b];b++);return j4=T.slice(u,1<b?1-b:void 0)}function q4(u){var p=u.keyCode;return"charCode"in u?(u=u.charCode,u===0&&p===13&&(u=13)):u=p,u===10&&(u=13),32<=u||u===13?u:0}function G4(){return!0}function Tne(){return!1}function Kl(u){function p(g,b,T,C,I){this._reactName=g,this._targetInst=T,this.type=b,this.nativeEvent=C,this.target=I,this.currentTarget=null;for(var V in u)u.hasOwnProperty(V)&&(g=u[V],this[V]=g?g(C):C[V]);return this.isDefaultPrevented=(C.defaultPrevented!=null?C.defaultPrevented:C.returnValue===!1)?G4:Tne,this.isPropagationStopped=Tne,this}return f(p.prototype,{preventDefault:function(){this.defaultPrevented=!0;var g=this.nativeEvent;g&&(g.preventDefault?g.preventDefault():typeof g.returnValue!="unknown"&&(g.returnValue=!1),this.isDefaultPrevented=G4)},stopPropagation:function(){var g=this.nativeEvent;g&&(g.stopPropagation?g.stopPropagation():typeof g.cancelBubble!="unknown"&&(g.cancelBubble=!0),this.isPropagationStopped=G4)},persist:function(){},isPersistent:G4}),p}var r1={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(u){return u.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},H4=Kl(r1),NM=f({},r1,{view:0,detail:0}),iFe=Kl(NM),_B,vB,VM,W4=f({},NM,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:wB,button:0,buttons:0,relatedTarget:function(u){return u.relatedTarget===void 0?u.fromElement===u.srcElement?u.toElement:u.fromElement:u.relatedTarget},movementX:function(u){return"movementX"in u?u.movementX:(u!==VM&&(VM&&u.type==="mousemove"?(_B=u.screenX-VM.screenX,vB=u.screenY-VM.screenY):vB=_B=0,VM=u),_B)},movementY:function(u){return"movementY"in u?u.movementY:vB}}),$ne=Kl(W4),rFe=f({},W4,{dataTransfer:0}),sFe=Kl(rFe),nFe=f({},NM,{relatedTarget:0}),bB=Kl(nFe),aFe=f({},r1,{animationName:0,elapsedTime:0,pseudoElement:0}),oFe=Kl(aFe),lFe=f({},r1,{clipboardData:function(u){return"clipboardData"in u?u.clipboardData:window.clipboardData}}),cFe=Kl(lFe),uFe=f({},r1,{data:0}),Cne=Kl(uFe),hFe={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},dFe={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},pFe={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function fFe(u){var p=this.nativeEvent;return p.getModifierState?p.getModifierState(u):(u=pFe[u])?!!p[u]:!1}function wB(){return fFe}var mFe=f({},NM,{key:function(u){if(u.key){var p=hFe[u.key]||u.key;if(p!=="Unidentified")return p}return u.type==="keypress"?(u=q4(u),u===13?"Enter":String.fromCharCode(u)):u.type==="keydown"||u.type==="keyup"?dFe[u.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:wB,charCode:function(u){return u.type==="keypress"?q4(u):0},keyCode:function(u){return u.type==="keydown"||u.type==="keyup"?u.keyCode:0},which:function(u){return u.type==="keypress"?q4(u):u.type==="keydown"||u.type==="keyup"?u.keyCode:0}}),gFe=Kl(mFe),yFe=f({},W4,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Mne=Kl(yFe),_Fe=f({},NM,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:wB}),vFe=Kl(_Fe),bFe=f({},r1,{propertyName:0,elapsedTime:0,pseudoElement:0}),wFe=Kl(bFe),xFe=f({},W4,{deltaX:function(u){return"deltaX"in u?u.deltaX:"wheelDeltaX"in u?-u.wheelDeltaX:0},deltaY:function(u){return"deltaY"in u?u.deltaY:"wheelDeltaY"in u?-u.wheelDeltaY:"wheelDelta"in u?-u.wheelDelta:0},deltaZ:0,deltaMode:0}),SFe=Kl(xFe),TFe=f({},r1,{newState:0,oldState:0}),$Fe=Kl(TFe),CFe=[9,13,27,32],xB=um&&"CompositionEvent"in window,UM=null;um&&"documentMode"in document&&(UM=document.documentMode);var MFe=um&&"TextEvent"in window&&!UM,Ene=um&&(!xB||UM&&8<UM&&11>=UM),Ane=" ",One=!1;function Pne(u,p){switch(u){case"keyup":return CFe.indexOf(p.keyCode)!==-1;case"keydown":return p.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Rne(u){return u=u.detail,typeof u=="object"&&"data"in u?u.data:null}var C2=!1;function EFe(u,p){switch(u){case"compositionend":return Rne(p);case"keypress":return p.which!==32?null:(One=!0,Ane);case"textInput":return u=p.data,u===Ane&&One?null:u;default:return null}}function AFe(u,p){if(C2)return u==="compositionend"||!xB&&Pne(u,p)?(u=Sne(),j4=yB=Uy=null,C2=!1,u):null;switch(u){case"paste":return null;case"keypress":if(!(p.ctrlKey||p.altKey||p.metaKey)||p.ctrlKey&&p.altKey){if(p.char&&1<p.char.length)return p.char;if(p.which)return String.fromCharCode(p.which)}return null;case"compositionend":return Ene&&p.locale!=="ko"?null:p.data;default:return null}}var OFe={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Dne(u){var p=u&&u.nodeName&&u.nodeName.toLowerCase();return p==="input"?!!OFe[u.type]:p==="textarea"}function Ine(u,p,g,b){T2?$2?$2.push(b):$2=[b]:T2=b,p=kI(p,"onChange"),0<p.length&&(g=new H4("onChange","change",null,g,b),u.push({event:g,listeners:p}))}var BM=null,jM=null;function PFe(u){gle(u,0)}function Z4(u){var p=ji(u);if(is(p))return u}function Lne(u,p){if(u==="change")return p}var kne=!1;if(um){var SB;if(um){var TB="oninput"in document;if(!TB){var zne=document.createElement("div");zne.setAttribute("oninput","return;"),TB=typeof zne.oninput=="function"}SB=TB}else SB=!1;kne=SB&&(!document.documentMode||9<document.documentMode)}function Fne(){BM&&(BM.detachEvent("onpropertychange",Nne),jM=BM=null)}function Nne(u){if(u.propertyName==="value"&&Z4(jM)){var p=[];Ine(p,jM,u,fB(u)),xne(PFe,p)}}function RFe(u,p,g){u==="focusin"?(Fne(),BM=p,jM=g,BM.attachEvent("onpropertychange",Nne)):u==="focusout"&&Fne()}function DFe(u){if(u==="selectionchange"||u==="keyup"||u==="keydown")return Z4(jM)}function IFe(u,p){if(u==="click")return Z4(p)}function LFe(u,p){if(u==="input"||u==="change")return Z4(p)}function kFe(u,p){return u===p&&(u!==0||1/u===1/p)||u!==u&&p!==p}var Gc=typeof Object.is=="function"?Object.is:kFe;function qM(u,p){if(Gc(u,p))return!0;if(typeof u!="object"||u===null||typeof p!="object"||p===null)return!1;var g=Object.keys(u),b=Object.keys(p);if(g.length!==b.length)return!1;for(b=0;b<g.length;b++){var T=g[b];if(!ct.call(p,T)||!Gc(u[T],p[T]))return!1}return!0}function Vne(u){for(;u&&u.firstChild;)u=u.firstChild;return u}function Une(u,p){var g=Vne(u);u=0;for(var b;g;){if(g.nodeType===3){if(b=u+g.textContent.length,u<=p&&b>=p)return{node:g,offset:p-u};u=b}e:{for(;g;){if(g.nextSibling){g=g.nextSibling;break e}g=g.parentNode}g=void 0}g=Vne(g)}}function Bne(u,p){return u&&p?u===p?!0:u&&u.nodeType===3?!1:p&&p.nodeType===3?Bne(u,p.parentNode):"contains"in u?u.contains(p):u.compareDocumentPosition?!!(u.compareDocumentPosition(p)&16):!1:!1}function jne(u){u=u!=null&&u.ownerDocument!=null&&u.ownerDocument.defaultView!=null?u.ownerDocument.defaultView:window;for(var p=ys(u.document);p instanceof u.HTMLIFrameElement;){try{var g=typeof p.contentWindow.location.href=="string"}catch{g=!1}if(g)u=p.contentWindow;else break;p=ys(u.document)}return p}function $B(u){var p=u&&u.nodeName&&u.nodeName.toLowerCase();return p&&(p==="input"&&(u.type==="text"||u.type==="search"||u.type==="tel"||u.type==="url"||u.type==="password")||p==="textarea"||u.contentEditable==="true")}var zFe=um&&"documentMode"in document&&11>=document.documentMode,M2=null,CB=null,GM=null,MB=!1;function qne(u,p,g){var b=g.window===g?g.document:g.nodeType===9?g:g.ownerDocument;MB||M2==null||M2!==ys(b)||(b=M2,"selectionStart"in b&&$B(b)?b={start:b.selectionStart,end:b.selectionEnd}:(b=(b.ownerDocument&&b.ownerDocument.defaultView||window).getSelection(),b={anchorNode:b.anchorNode,anchorOffset:b.anchorOffset,focusNode:b.focusNode,focusOffset:b.focusOffset}),GM&&qM(GM,b)||(GM=b,b=kI(CB,"onSelect"),0<b.length&&(p=new H4("onSelect","select",null,p,g),u.push({event:p,listeners:b}),p.target=M2)))}function s1(u,p){var g={};return g[u.toLowerCase()]=p.toLowerCase(),g["Webkit"+u]="webkit"+p,g["Moz"+u]="moz"+p,g}var E2={animationend:s1("Animation","AnimationEnd"),animationiteration:s1("Animation","AnimationIteration"),animationstart:s1("Animation","AnimationStart"),transitionrun:s1("Transition","TransitionRun"),transitionstart:s1("Transition","TransitionStart"),transitioncancel:s1("Transition","TransitionCancel"),transitionend:s1("Transition","TransitionEnd")},EB={},Gne={};um&&(Gne=document.createElement("div").style,"AnimationEvent"in window||(delete E2.animationend.animation,delete E2.animationiteration.animation,delete E2.animationstart.animation),"TransitionEvent"in window||delete E2.transitionend.transition);function n1(u){if(EB[u])return EB[u];if(!E2[u])return u;var p=E2[u],g;for(g in p)if(p.hasOwnProperty(g)&&g in Gne)return EB[u]=p[g];return u}var Hne=n1("animationend"),Wne=n1("animationiteration"),Zne=n1("animationstart"),FFe=n1("transitionrun"),NFe=n1("transitionstart"),VFe=n1("transitioncancel"),Yne=n1("transitionend"),Qne=new Map,AB="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");AB.push("scrollEnd");function cd(u,p){Qne.set(u,p),No(p,[u])}var Y4=typeof reportError=="function"?reportError:function(u){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var p=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof u=="object"&&u!==null&&typeof u.message=="string"?String(u.message):String(u),error:u});if(!window.dispatchEvent(p))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",u);return}console.error(u)},Hu=[],A2=0,OB=0;function Q4(){for(var u=A2,p=OB=A2=0;p<u;){var g=Hu[p];Hu[p++]=null;var b=Hu[p];Hu[p++]=null;var T=Hu[p];Hu[p++]=null;var C=Hu[p];if(Hu[p++]=null,b!==null&&T!==null){var I=b.pending;I===null?T.next=T:(T.next=I.next,I.next=T),b.pending=T}C!==0&&Xne(g,T,C)}}function X4(u,p,g,b){Hu[A2++]=u,Hu[A2++]=p,Hu[A2++]=g,Hu[A2++]=b,OB|=b,u.lanes|=b,u=u.alternate,u!==null&&(u.lanes|=b)}function PB(u,p,g,b){return X4(u,p,g,b),J4(u)}function a1(u,p){return X4(u,null,null,p),J4(u)}function Xne(u,p,g){u.lanes|=g;var b=u.alternate;b!==null&&(b.lanes|=g);for(var T=!1,C=u.return;C!==null;)C.childLanes|=g,b=C.alternate,b!==null&&(b.childLanes|=g),C.tag===22&&(u=C.stateNode,u===null||u._visibility&1||(T=!0)),u=C,C=C.return;return u.tag===3?(C=u.stateNode,T&&p!==null&&(T=31-Vt(g),u=C.hiddenUpdates,b=u[T],b===null?u[T]=[p]:b.push(p),p.lane=g|536870912),C):null}function J4(u){if(50<pE)throw pE=0,Vj=null,Error(r(185));for(var p=u.return;p!==null;)u=p,p=u.return;return u.tag===3?u.stateNode:null}var O2={};function UFe(u,p,g,b){this.tag=u,this.key=g,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=p,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=b,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Hc(u,p,g,b){return new UFe(u,p,g,b)}function RB(u){return u=u.prototype,!(!u||!u.isReactComponent)}function hm(u,p){var g=u.alternate;return g===null?(g=Hc(u.tag,p,u.key,u.mode),g.elementType=u.elementType,g.type=u.type,g.stateNode=u.stateNode,g.alternate=u,u.alternate=g):(g.pendingProps=p,g.type=u.type,g.flags=0,g.subtreeFlags=0,g.deletions=null),g.flags=u.flags&65011712,g.childLanes=u.childLanes,g.lanes=u.lanes,g.child=u.child,g.memoizedProps=u.memoizedProps,g.memoizedState=u.memoizedState,g.updateQueue=u.updateQueue,p=u.dependencies,g.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext},g.sibling=u.sibling,g.index=u.index,g.ref=u.ref,g.refCleanup=u.refCleanup,g}function Jne(u,p){u.flags&=65011714;var g=u.alternate;return g===null?(u.childLanes=0,u.lanes=p,u.child=null,u.subtreeFlags=0,u.memoizedProps=null,u.memoizedState=null,u.updateQueue=null,u.dependencies=null,u.stateNode=null):(u.childLanes=g.childLanes,u.lanes=g.lanes,u.child=g.child,u.subtreeFlags=0,u.deletions=null,u.memoizedProps=g.memoizedProps,u.memoizedState=g.memoizedState,u.updateQueue=g.updateQueue,u.type=g.type,p=g.dependencies,u.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext}),u}function K4(u,p,g,b,T,C){var I=0;if(b=u,typeof u=="function")RB(u)&&(I=1);else if(typeof u=="string")I=HNe(u,g,be.current)?26:u==="html"||u==="head"||u==="body"?27:5;else e:switch(u){case U:return u=Hc(31,g,p,T),u.elementType=U,u.lanes=C,u;case x:return o1(g.children,T,C,p);case S:I=8,T|=24;break;case $:return u=Hc(12,g,p,T|2),u.elementType=$,u.lanes=C,u;case O:return u=Hc(13,g,p,T),u.elementType=O,u.lanes=C,u;case D:return u=Hc(19,g,p,T),u.elementType=D,u.lanes=C,u;default:if(typeof u=="object"&&u!==null)switch(u.$$typeof){case M:I=10;break e;case A:I=9;break e;case P:I=11;break e;case L:I=14;break e;case F:I=16,b=null;break e}I=29,g=Error(r(130,u===null?"null":typeof u,"")),b=null}return p=Hc(I,g,p,T),p.elementType=u,p.type=b,p.lanes=C,p}function o1(u,p,g,b){return u=Hc(7,u,b,p),u.lanes=g,u}function DB(u,p,g){return u=Hc(6,u,null,p),u.lanes=g,u}function Kne(u){var p=Hc(18,null,null,0);return p.stateNode=u,p}function IB(u,p,g){return p=Hc(4,u.children!==null?u.children:[],u.key,p),p.lanes=g,p.stateNode={containerInfo:u.containerInfo,pendingChildren:null,implementation:u.implementation},p}var eae=new WeakMap;function Wu(u,p){if(typeof u=="object"&&u!==null){var g=eae.get(u);return g!==void 0?g:(p={value:u,source:p,stack:gt(p)},eae.set(u,p),p)}return{value:u,source:p,stack:gt(p)}}var P2=[],R2=0,eI=null,HM=0,Zu=[],Yu=0,By=null,zp=1,Fp="";function dm(u,p){P2[R2++]=HM,P2[R2++]=eI,eI=u,HM=p}function tae(u,p,g){Zu[Yu++]=zp,Zu[Yu++]=Fp,Zu[Yu++]=By,By=u;var b=zp;u=Fp;var T=32-Vt(b)-1;b&=~(1<<T),g+=1;var C=32-Vt(p)+T;if(30<C){var I=T-T%5;C=(b&(1<<I)-1).toString(32),b>>=I,T-=I,zp=1<<32-Vt(p)+T|g<<T|b,Fp=C+u}else zp=1<<C|g<<T|b,Fp=u}function LB(u){u.return!==null&&(dm(u,1),tae(u,1,0))}function kB(u){for(;u===eI;)eI=P2[--R2],P2[R2]=null,HM=P2[--R2],P2[R2]=null;for(;u===By;)By=Zu[--Yu],Zu[Yu]=null,Fp=Zu[--Yu],Zu[Yu]=null,zp=Zu[--Yu],Zu[Yu]=null}function iae(u,p){Zu[Yu++]=zp,Zu[Yu++]=Fp,Zu[Yu++]=By,zp=p.id,Fp=p.overflow,By=u}var yo=null,Ds=null,dr=!1,jy=null,Qu=!1,zB=Error(r(519));function qy(u){var p=Error(r(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw WM(Wu(p,u)),zB}function rae(u){var p=u.stateNode,g=u.type,b=u.memoizedProps;switch(p[vi]=u,p[Pa]=b,g){case"dialog":Qi("cancel",p),Qi("close",p);break;case"iframe":case"object":case"embed":Qi("load",p);break;case"video":case"audio":for(g=0;g<mE.length;g++)Qi(mE[g],p);break;case"source":Qi("error",p);break;case"img":case"image":case"link":Qi("error",p),Qi("load",p);break;case"details":Qi("toggle",p);break;case"input":Qi("invalid",p),kM(p,b.value,b.defaultValue,b.checked,b.defaultChecked,b.type,b.name,!0);break;case"select":Qi("invalid",p);break;case"textarea":Qi("invalid",p),_ne(p,b.value,b.defaultValue,b.children)}g=b.children,typeof g!="string"&&typeof g!="number"&&typeof g!="bigint"||p.textContent===""+g||b.suppressHydrationWarning===!0||ble(p.textContent,g)?(b.popover!=null&&(Qi("beforetoggle",p),Qi("toggle",p)),b.onScroll!=null&&Qi("scroll",p),b.onScrollEnd!=null&&Qi("scrollend",p),b.onClick!=null&&(p.onclick=cm),p=!0):p=!1,p||qy(u,!0)}function sae(u){for(yo=u.return;yo;)switch(yo.tag){case 5:case 31:case 13:Qu=!1;return;case 27:case 3:Qu=!0;return;default:yo=yo.return}}function D2(u){if(u!==yo)return!1;if(!dr)return sae(u),dr=!0,!1;var p=u.tag,g;if((g=p!==3&&p!==27)&&((g=p===5)&&(g=u.type,g=!(g!=="form"&&g!=="button")||t9(u.type,u.memoizedProps)),g=!g),g&&Ds&&qy(u),sae(u),p===13){if(u=u.memoizedState,u=u!==null?u.dehydrated:null,!u)throw Error(r(317));Ds=Ale(u)}else if(p===31){if(u=u.memoizedState,u=u!==null?u.dehydrated:null,!u)throw Error(r(317));Ds=Ale(u)}else p===27?(p=Ds,s0(u.type)?(u=a9,a9=null,Ds=u):Ds=p):Ds=yo?Ju(u.stateNode.nextSibling):null;return!0}function l1(){Ds=yo=null,dr=!1}function FB(){var u=jy;return u!==null&&(rc===null?rc=u:rc.push.apply(rc,u),jy=null),u}function WM(u){jy===null?jy=[u]:jy.push(u)}var NB=q(null),c1=null,pm=null;function Gy(u,p,g){ce(NB,p._currentValue),p._currentValue=g}function fm(u){u._currentValue=NB.current,ne(NB)}function VB(u,p,g){for(;u!==null;){var b=u.alternate;if((u.childLanes&p)!==p?(u.childLanes|=p,b!==null&&(b.childLanes|=p)):b!==null&&(b.childLanes&p)!==p&&(b.childLanes|=p),u===g)break;u=u.return}}function UB(u,p,g,b){var T=u.child;for(T!==null&&(T.return=u);T!==null;){var C=T.dependencies;if(C!==null){var I=T.child;C=C.firstContext;e:for(;C!==null;){var V=C;C=T;for(var J=0;J<p.length;J++)if(V.context===p[J]){C.lanes|=g,V=C.alternate,V!==null&&(V.lanes|=g),VB(C.return,g,u),b||(I=null);break e}C=V.next}}else if(T.tag===18){if(I=T.return,I===null)throw Error(r(341));I.lanes|=g,C=I.alternate,C!==null&&(C.lanes|=g),VB(I,g,u),I=null}else I=T.child;if(I!==null)I.return=T;else for(I=T;I!==null;){if(I===u){I=null;break}if(T=I.sibling,T!==null){T.return=I.return,I=T;break}I=I.return}T=I}}function I2(u,p,g,b){u=null;for(var T=p,C=!1;T!==null;){if(!C){if((T.flags&524288)!==0)C=!0;else if((T.flags&262144)!==0)break}if(T.tag===10){var I=T.alternate;if(I===null)throw Error(r(387));if(I=I.memoizedProps,I!==null){var V=T.type;Gc(T.pendingProps.value,I.value)||(u!==null?u.push(V):u=[V])}}else if(T===at.current){if(I=T.alternate,I===null)throw Error(r(387));I.memoizedState.memoizedState!==T.memoizedState.memoizedState&&(u!==null?u.push(bE):u=[bE])}T=T.return}u!==null&&UB(p,u,g,b),p.flags|=262144}function tI(u){for(u=u.firstContext;u!==null;){if(!Gc(u.context._currentValue,u.memoizedValue))return!0;u=u.next}return!1}function u1(u){c1=u,pm=null,u=u.dependencies,u!==null&&(u.firstContext=null)}function _o(u){return nae(c1,u)}function iI(u,p){return c1===null&&u1(u),nae(u,p)}function nae(u,p){var g=p._currentValue;if(p={context:p,memoizedValue:g,next:null},pm===null){if(u===null)throw Error(r(308));pm=p,u.dependencies={lanes:0,firstContext:p},u.flags|=524288}else pm=pm.next=p;return g}var BFe=typeof AbortController<"u"?AbortController:function(){var u=[],p=this.signal={aborted:!1,addEventListener:function(g,b){u.push(b)}};this.abort=function(){p.aborted=!0,u.forEach(function(g){return g()})}},jFe=t.unstable_scheduleCallback,qFe=t.unstable_NormalPriority,na={$$typeof:M,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function BB(){return{controller:new BFe,data:new Map,refCount:0}}function ZM(u){u.refCount--,u.refCount===0&&jFe(qFe,function(){u.controller.abort()})}var YM=null,jB=0,L2=0,k2=null;function GFe(u,p){if(YM===null){var g=YM=[];jB=0,L2=Hj(),k2={status:"pending",value:void 0,then:function(b){g.push(b)}}}return jB++,p.then(aae,aae),p}function aae(){if(--jB===0&&YM!==null){k2!==null&&(k2.status="fulfilled");var u=YM;YM=null,L2=0,k2=null;for(var p=0;p<u.length;p++)(0,u[p])()}}function HFe(u,p){var g=[],b={status:"pending",value:null,reason:null,then:function(T){g.push(T)}};return u.then(function(){b.status="fulfilled",b.value=p;for(var T=0;T<g.length;T++)(0,g[T])(p)},function(T){for(b.status="rejected",b.reason=T,T=0;T<g.length;T++)(0,g[T])(void 0)}),b}var oae=H.S;H.S=function(u,p){qoe=rt(),typeof p=="object"&&p!==null&&typeof p.then=="function"&&GFe(u,p),oae!==null&&oae(u,p)};var h1=q(null);function qB(){var u=h1.current;return u!==null?u:_s.pooledCache}function rI(u,p){p===null?ce(h1,h1.current):ce(h1,p.pool)}function lae(){var u=qB();return u===null?null:{parent:na._currentValue,pool:u}}var z2=Error(r(460)),GB=Error(r(474)),sI=Error(r(542)),nI={then:function(){}};function cae(u){return u=u.status,u==="fulfilled"||u==="rejected"}function uae(u,p,g){switch(g=u[g],g===void 0?u.push(p):g!==p&&(p.then(cm,cm),p=g),p.status){case"fulfilled":return p.value;case"rejected":throw u=p.reason,dae(u),u;default:if(typeof p.status=="string")p.then(cm,cm);else{if(u=_s,u!==null&&100<u.shellSuspendCounter)throw Error(r(482));u=p,u.status="pending",u.then(function(b){if(p.status==="pending"){var T=p;T.status="fulfilled",T.value=b}},function(b){if(p.status==="pending"){var T=p;T.status="rejected",T.reason=b}})}switch(p.status){case"fulfilled":return p.value;case"rejected":throw u=p.reason,dae(u),u}throw p1=p,z2}}function d1(u){try{var p=u._init;return p(u._payload)}catch(g){throw g!==null&&typeof g=="object"&&typeof g.then=="function"?(p1=g,z2):g}}var p1=null;function hae(){if(p1===null)throw Error(r(459));var u=p1;return p1=null,u}function dae(u){if(u===z2||u===sI)throw Error(r(483))}var F2=null,QM=0;function aI(u){var p=QM;return QM+=1,F2===null&&(F2=[]),uae(F2,u,p)}function XM(u,p){p=p.props.ref,u.ref=p!==void 0?p:null}function oI(u,p){throw p.$$typeof===y?Error(r(525)):(u=Object.prototype.toString.call(p),Error(r(31,u==="[object Object]"?"object with keys {"+Object.keys(p).join(", ")+"}":u)))}function pae(u){function p(ae,se){if(u){var pe=ae.deletions;pe===null?(ae.deletions=[se],ae.flags|=16):pe.push(se)}}function g(ae,se){if(!u)return null;for(;se!==null;)p(ae,se),se=se.sibling;return null}function b(ae){for(var se=new Map;ae!==null;)ae.key!==null?se.set(ae.key,ae):se.set(ae.index,ae),ae=ae.sibling;return se}function T(ae,se){return ae=hm(ae,se),ae.index=0,ae.sibling=null,ae}function C(ae,se,pe){return ae.index=pe,u?(pe=ae.alternate,pe!==null?(pe=pe.index,pe<se?(ae.flags|=67108866,se):pe):(ae.flags|=67108866,se)):(ae.flags|=1048576,se)}function I(ae){return u&&ae.alternate===null&&(ae.flags|=67108866),ae}function V(ae,se,pe,Ae){return se===null||se.tag!==6?(se=DB(pe,ae.mode,Ae),se.return=ae,se):(se=T(se,pe),se.return=ae,se)}function J(ae,se,pe,Ae){var Ut=pe.type;return Ut===x?$e(ae,se,pe.props.children,Ae,pe.key):se!==null&&(se.elementType===Ut||typeof Ut=="object"&&Ut!==null&&Ut.$$typeof===F&&d1(Ut)===se.type)?(se=T(se,pe.props),XM(se,pe),se.return=ae,se):(se=K4(pe.type,pe.key,pe.props,null,ae.mode,Ae),XM(se,pe),se.return=ae,se)}function me(ae,se,pe,Ae){return se===null||se.tag!==4||se.stateNode.containerInfo!==pe.containerInfo||se.stateNode.implementation!==pe.implementation?(se=IB(pe,ae.mode,Ae),se.return=ae,se):(se=T(se,pe.children||[]),se.return=ae,se)}function $e(ae,se,pe,Ae,Ut){return se===null||se.tag!==7?(se=o1(pe,ae.mode,Ae,Ut),se.return=ae,se):(se=T(se,pe),se.return=ae,se)}function Pe(ae,se,pe){if(typeof se=="string"&&se!==""||typeof se=="number"||typeof se=="bigint")return se=DB(""+se,ae.mode,pe),se.return=ae,se;if(typeof se=="object"&&se!==null){switch(se.$$typeof){case _:return pe=K4(se.type,se.key,se.props,null,ae.mode,pe),XM(pe,se),pe.return=ae,pe;case w:return se=IB(se,ae.mode,pe),se.return=ae,se;case F:return se=d1(se),Pe(ae,se,pe)}if(Z(se)||B(se))return se=o1(se,ae.mode,pe,null),se.return=ae,se;if(typeof se.then=="function")return Pe(ae,aI(se),pe);if(se.$$typeof===M)return Pe(ae,iI(ae,se),pe);oI(ae,se)}return null}function ge(ae,se,pe,Ae){var Ut=se!==null?se.key:null;if(typeof pe=="string"&&pe!==""||typeof pe=="number"||typeof pe=="bigint")return Ut!==null?null:V(ae,se,""+pe,Ae);if(typeof pe=="object"&&pe!==null){switch(pe.$$typeof){case _:return pe.key===Ut?J(ae,se,pe,Ae):null;case w:return pe.key===Ut?me(ae,se,pe,Ae):null;case F:return pe=d1(pe),ge(ae,se,pe,Ae)}if(Z(pe)||B(pe))return Ut!==null?null:$e(ae,se,pe,Ae,null);if(typeof pe.then=="function")return ge(ae,se,aI(pe),Ae);if(pe.$$typeof===M)return ge(ae,se,iI(ae,pe),Ae);oI(ae,pe)}return null}function we(ae,se,pe,Ae,Ut){if(typeof Ae=="string"&&Ae!==""||typeof Ae=="number"||typeof Ae=="bigint")return ae=ae.get(pe)||null,V(se,ae,""+Ae,Ut);if(typeof Ae=="object"&&Ae!==null){switch(Ae.$$typeof){case _:return ae=ae.get(Ae.key===null?pe:Ae.key)||null,J(se,ae,Ae,Ut);case w:return ae=ae.get(Ae.key===null?pe:Ae.key)||null,me(se,ae,Ae,Ut);case F:return Ae=d1(Ae),we(ae,se,pe,Ae,Ut)}if(Z(Ae)||B(Ae))return ae=ae.get(pe)||null,$e(se,ae,Ae,Ut,null);if(typeof Ae.then=="function")return we(ae,se,pe,aI(Ae),Ut);if(Ae.$$typeof===M)return we(ae,se,pe,iI(se,Ae),Ut);oI(se,Ae)}return null}function xt(ae,se,pe,Ae){for(var Ut=null,Ar=null,Dt=se,Ai=se=0,ir=null;Dt!==null&&Ai<pe.length;Ai++){Dt.index>Ai?(ir=Dt,Dt=null):ir=Dt.sibling;var Or=ge(ae,Dt,pe[Ai],Ae);if(Or===null){Dt===null&&(Dt=ir);break}u&&Dt&&Or.alternate===null&&p(ae,Dt),se=C(Or,se,Ai),Ar===null?Ut=Or:Ar.sibling=Or,Ar=Or,Dt=ir}if(Ai===pe.length)return g(ae,Dt),dr&&dm(ae,Ai),Ut;if(Dt===null){for(;Ai<pe.length;Ai++)Dt=Pe(ae,pe[Ai],Ae),Dt!==null&&(se=C(Dt,se,Ai),Ar===null?Ut=Dt:Ar.sibling=Dt,Ar=Dt);return dr&&dm(ae,Ai),Ut}for(Dt=b(Dt);Ai<pe.length;Ai++)ir=we(Dt,ae,Ai,pe[Ai],Ae),ir!==null&&(u&&ir.alternate!==null&&Dt.delete(ir.key===null?Ai:ir.key),se=C(ir,se,Ai),Ar===null?Ut=ir:Ar.sibling=ir,Ar=ir);return u&&Dt.forEach(function(c0){return p(ae,c0)}),dr&&dm(ae,Ai),Ut}function Qt(ae,se,pe,Ae){if(pe==null)throw Error(r(151));for(var Ut=null,Ar=null,Dt=se,Ai=se=0,ir=null,Or=pe.next();Dt!==null&&!Or.done;Ai++,Or=pe.next()){Dt.index>Ai?(ir=Dt,Dt=null):ir=Dt.sibling;var c0=ge(ae,Dt,Or.value,Ae);if(c0===null){Dt===null&&(Dt=ir);break}u&&Dt&&c0.alternate===null&&p(ae,Dt),se=C(c0,se,Ai),Ar===null?Ut=c0:Ar.sibling=c0,Ar=c0,Dt=ir}if(Or.done)return g(ae,Dt),dr&&dm(ae,Ai),Ut;if(Dt===null){for(;!Or.done;Ai++,Or=pe.next())Or=Pe(ae,Or.value,Ae),Or!==null&&(se=C(Or,se,Ai),Ar===null?Ut=Or:Ar.sibling=Or,Ar=Or);return dr&&dm(ae,Ai),Ut}for(Dt=b(Dt);!Or.done;Ai++,Or=pe.next())Or=we(Dt,ae,Ai,Or.value,Ae),Or!==null&&(u&&Or.alternate!==null&&Dt.delete(Or.key===null?Ai:Or.key),se=C(Or,se,Ai),Ar===null?Ut=Or:Ar.sibling=Or,Ar=Or);return u&&Dt.forEach(function(r6e){return p(ae,r6e)}),dr&&dm(ae,Ai),Ut}function ns(ae,se,pe,Ae){if(typeof pe=="object"&&pe!==null&&pe.type===x&&pe.key===null&&(pe=pe.props.children),typeof pe=="object"&&pe!==null){switch(pe.$$typeof){case _:e:{for(var Ut=pe.key;se!==null;){if(se.key===Ut){if(Ut=pe.type,Ut===x){if(se.tag===7){g(ae,se.sibling),Ae=T(se,pe.props.children),Ae.return=ae,ae=Ae;break e}}else if(se.elementType===Ut||typeof Ut=="object"&&Ut!==null&&Ut.$$typeof===F&&d1(Ut)===se.type){g(ae,se.sibling),Ae=T(se,pe.props),XM(Ae,pe),Ae.return=ae,ae=Ae;break e}g(ae,se);break}else p(ae,se);se=se.sibling}pe.type===x?(Ae=o1(pe.props.children,ae.mode,Ae,pe.key),Ae.return=ae,ae=Ae):(Ae=K4(pe.type,pe.key,pe.props,null,ae.mode,Ae),XM(Ae,pe),Ae.return=ae,ae=Ae)}return I(ae);case w:e:{for(Ut=pe.key;se!==null;){if(se.key===Ut)if(se.tag===4&&se.stateNode.containerInfo===pe.containerInfo&&se.stateNode.implementation===pe.implementation){g(ae,se.sibling),Ae=T(se,pe.children||[]),Ae.return=ae,ae=Ae;break e}else{g(ae,se);break}else p(ae,se);se=se.sibling}Ae=IB(pe,ae.mode,Ae),Ae.return=ae,ae=Ae}return I(ae);case F:return pe=d1(pe),ns(ae,se,pe,Ae)}if(Z(pe))return xt(ae,se,pe,Ae);if(B(pe)){if(Ut=B(pe),typeof Ut!="function")throw Error(r(150));return pe=Ut.call(pe),Qt(ae,se,pe,Ae)}if(typeof pe.then=="function")return ns(ae,se,aI(pe),Ae);if(pe.$$typeof===M)return ns(ae,se,iI(ae,pe),Ae);oI(ae,pe)}return typeof pe=="string"&&pe!==""||typeof pe=="number"||typeof pe=="bigint"?(pe=""+pe,se!==null&&se.tag===6?(g(ae,se.sibling),Ae=T(se,pe),Ae.return=ae,ae=Ae):(g(ae,se),Ae=DB(pe,ae.mode,Ae),Ae.return=ae,ae=Ae),I(ae)):g(ae,se)}return function(ae,se,pe,Ae){try{QM=0;var Ut=ns(ae,se,pe,Ae);return F2=null,Ut}catch(Dt){if(Dt===z2||Dt===sI)throw Dt;var Ar=Hc(29,Dt,null,ae.mode);return Ar.lanes=Ae,Ar.return=ae,Ar}}}var f1=pae(!0),fae=pae(!1),Hy=!1;function HB(u){u.updateQueue={baseState:u.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function WB(u,p){u=u.updateQueue,p.updateQueue===u&&(p.updateQueue={baseState:u.baseState,firstBaseUpdate:u.firstBaseUpdate,lastBaseUpdate:u.lastBaseUpdate,shared:u.shared,callbacks:null})}function Wy(u){return{lane:u,tag:0,payload:null,callback:null,next:null}}function Zy(u,p,g){var b=u.updateQueue;if(b===null)return null;if(b=b.shared,(Lr&2)!==0){var T=b.pending;return T===null?p.next=p:(p.next=T.next,T.next=p),b.pending=p,p=J4(u),Xne(u,null,g),p}return X4(u,b,p,g),J4(u)}function JM(u,p,g){if(p=p.updateQueue,p!==null&&(p=p.shared,(g&4194048)!==0)){var b=p.lanes;b&=u.pendingLanes,g|=b,p.lanes=g,Ss(u,g)}}function ZB(u,p){var g=u.updateQueue,b=u.alternate;if(b!==null&&(b=b.updateQueue,g===b)){var T=null,C=null;if(g=g.firstBaseUpdate,g!==null){do{var I={lane:g.lane,tag:g.tag,payload:g.payload,callback:null,next:null};C===null?T=C=I:C=C.next=I,g=g.next}while(g!==null);C===null?T=C=p:C=C.next=p}else T=C=p;g={baseState:b.baseState,firstBaseUpdate:T,lastBaseUpdate:C,shared:b.shared,callbacks:b.callbacks},u.updateQueue=g;return}u=g.lastBaseUpdate,u===null?g.firstBaseUpdate=p:u.next=p,g.lastBaseUpdate=p}var YB=!1;function KM(){if(YB){var u=k2;if(u!==null)throw u}}function eE(u,p,g,b){YB=!1;var T=u.updateQueue;Hy=!1;var C=T.firstBaseUpdate,I=T.lastBaseUpdate,V=T.shared.pending;if(V!==null){T.shared.pending=null;var J=V,me=J.next;J.next=null,I===null?C=me:I.next=me,I=J;var $e=u.alternate;$e!==null&&($e=$e.updateQueue,V=$e.lastBaseUpdate,V!==I&&(V===null?$e.firstBaseUpdate=me:V.next=me,$e.lastBaseUpdate=J))}if(C!==null){var Pe=T.baseState;I=0,$e=me=J=null,V=C;do{var ge=V.lane&-536870913,we=ge!==V.lane;if(we?(tr&ge)===ge:(b&ge)===ge){ge!==0&&ge===L2&&(YB=!0),$e!==null&&($e=$e.next={lane:0,tag:V.tag,payload:V.payload,callback:null,next:null});e:{var xt=u,Qt=V;ge=p;var ns=g;switch(Qt.tag){case 1:if(xt=Qt.payload,typeof xt=="function"){Pe=xt.call(ns,Pe,ge);break e}Pe=xt;break e;case 3:xt.flags=xt.flags&-65537|128;case 0:if(xt=Qt.payload,ge=typeof xt=="function"?xt.call(ns,Pe,ge):xt,ge==null)break e;Pe=f({},Pe,ge);break e;case 2:Hy=!0}}ge=V.callback,ge!==null&&(u.flags|=64,we&&(u.flags|=8192),we=T.callbacks,we===null?T.callbacks=[ge]:we.push(ge))}else we={lane:ge,tag:V.tag,payload:V.payload,callback:V.callback,next:null},$e===null?(me=$e=we,J=Pe):$e=$e.next=we,I|=ge;if(V=V.next,V===null){if(V=T.shared.pending,V===null)break;we=V,V=we.next,we.next=null,T.lastBaseUpdate=we,T.shared.pending=null}}while(!0);$e===null&&(J=Pe),T.baseState=J,T.firstBaseUpdate=me,T.lastBaseUpdate=$e,C===null&&(T.shared.lanes=0),Ky|=I,u.lanes=I,u.memoizedState=Pe}}function mae(u,p){if(typeof u!="function")throw Error(r(191,u));u.call(p)}function gae(u,p){var g=u.callbacks;if(g!==null)for(u.callbacks=null,u=0;u<g.length;u++)mae(g[u],p)}var N2=q(null),lI=q(0);function yae(u,p){u=Sm,ce(lI,u),ce(N2,p),Sm=u|p.baseLanes}function QB(){ce(lI,Sm),ce(N2,N2.current)}function XB(){Sm=lI.current,ne(N2),ne(lI)}var Wc=q(null),Xu=null;function Yy(u){var p=u.alternate;ce(Ln,Ln.current&1),ce(Wc,u),Xu===null&&(p===null||N2.current!==null||p.memoizedState!==null)&&(Xu=u)}function JB(u){ce(Ln,Ln.current),ce(Wc,u),Xu===null&&(Xu=u)}function _ae(u){u.tag===22?(ce(Ln,Ln.current),ce(Wc,u),Xu===null&&(Xu=u)):Qy()}function Qy(){ce(Ln,Ln.current),ce(Wc,Wc.current)}function Zc(u){ne(Wc),Xu===u&&(Xu=null),ne(Ln)}var Ln=q(0);function cI(u){for(var p=u;p!==null;){if(p.tag===13){var g=p.memoizedState;if(g!==null&&(g=g.dehydrated,g===null||s9(g)||n9(g)))return p}else if(p.tag===19&&(p.memoizedProps.revealOrder==="forwards"||p.memoizedProps.revealOrder==="backwards"||p.memoizedProps.revealOrder==="unstable_legacy-backwards"||p.memoizedProps.revealOrder==="together")){if((p.flags&128)!==0)return p}else if(p.child!==null){p.child.return=p,p=p.child;continue}if(p===u)break;for(;p.sibling===null;){if(p.return===null||p.return===u)return null;p=p.return}p.sibling.return=p.return,p=p.sibling}return null}var mm=0,bi=null,rs=null,aa=null,uI=!1,V2=!1,m1=!1,hI=0,tE=0,U2=null,WFe=0;function mn(){throw Error(r(321))}function KB(u,p){if(p===null)return!1;for(var g=0;g<p.length&&g<u.length;g++)if(!Gc(u[g],p[g]))return!1;return!0}function ej(u,p,g,b,T,C){return mm=C,bi=p,p.memoizedState=null,p.updateQueue=null,p.lanes=0,H.H=u===null||u.memoizedState===null?toe:mj,m1=!1,C=g(b,T),m1=!1,V2&&(C=bae(p,g,b,T)),vae(u),C}function vae(u){H.H=sE;var p=rs!==null&&rs.next!==null;if(mm=0,aa=rs=bi=null,uI=!1,tE=0,U2=null,p)throw Error(r(300));u===null||oa||(u=u.dependencies,u!==null&&tI(u)&&(oa=!0))}function bae(u,p,g,b){bi=u;var T=0;do{if(V2&&(U2=null),tE=0,V2=!1,25<=T)throw Error(r(301));if(T+=1,aa=rs=null,u.updateQueue!=null){var C=u.updateQueue;C.lastEffect=null,C.events=null,C.stores=null,C.memoCache!=null&&(C.memoCache.index=0)}H.H=ioe,C=p(g,b)}while(V2);return C}function ZFe(){var u=H.H,p=u.useState()[0];return p=typeof p.then=="function"?iE(p):p,u=u.useState()[0],(rs!==null?rs.memoizedState:null)!==u&&(bi.flags|=1024),p}function tj(){var u=hI!==0;return hI=0,u}function ij(u,p,g){p.updateQueue=u.updateQueue,p.flags&=-2053,u.lanes&=~g}function rj(u){if(uI){for(u=u.memoizedState;u!==null;){var p=u.queue;p!==null&&(p.pending=null),u=u.next}uI=!1}mm=0,aa=rs=bi=null,V2=!1,tE=hI=0,U2=null}function pl(){var u={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return aa===null?bi.memoizedState=aa=u:aa=aa.next=u,aa}function kn(){if(rs===null){var u=bi.alternate;u=u!==null?u.memoizedState:null}else u=rs.next;var p=aa===null?bi.memoizedState:aa.next;if(p!==null)aa=p,rs=u;else{if(u===null)throw bi.alternate===null?Error(r(467)):Error(r(310));rs=u,u={memoizedState:rs.memoizedState,baseState:rs.baseState,baseQueue:rs.baseQueue,queue:rs.queue,next:null},aa===null?bi.memoizedState=aa=u:aa=aa.next=u}return aa}function dI(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function iE(u){var p=tE;return tE+=1,U2===null&&(U2=[]),u=uae(U2,u,p),p=bi,(aa===null?p.memoizedState:aa.next)===null&&(p=p.alternate,H.H=p===null||p.memoizedState===null?toe:mj),u}function pI(u){if(u!==null&&typeof u=="object"){if(typeof u.then=="function")return iE(u);if(u.$$typeof===M)return _o(u)}throw Error(r(438,String(u)))}function sj(u){var p=null,g=bi.updateQueue;if(g!==null&&(p=g.memoCache),p==null){var b=bi.alternate;b!==null&&(b=b.updateQueue,b!==null&&(b=b.memoCache,b!=null&&(p={data:b.data.map(function(T){return T.slice()}),index:0})))}if(p==null&&(p={data:[],index:0}),g===null&&(g=dI(),bi.updateQueue=g),g.memoCache=p,g=p.data[p.index],g===void 0)for(g=p.data[p.index]=Array(u),b=0;b<u;b++)g[b]=N;return p.index++,g}function gm(u,p){return typeof p=="function"?p(u):p}function fI(u){var p=kn();return nj(p,rs,u)}function nj(u,p,g){var b=u.queue;if(b===null)throw Error(r(311));b.lastRenderedReducer=g;var T=u.baseQueue,C=b.pending;if(C!==null){if(T!==null){var I=T.next;T.next=C.next,C.next=I}p.baseQueue=T=C,b.pending=null}if(C=u.baseState,T===null)u.memoizedState=C;else{p=T.next;var V=I=null,J=null,me=p,$e=!1;do{var Pe=me.lane&-536870913;if(Pe!==me.lane?(tr&Pe)===Pe:(mm&Pe)===Pe){var ge=me.revertLane;if(ge===0)J!==null&&(J=J.next={lane:0,revertLane:0,gesture:null,action:me.action,hasEagerState:me.hasEagerState,eagerState:me.eagerState,next:null}),Pe===L2&&($e=!0);else if((mm&ge)===ge){me=me.next,ge===L2&&($e=!0);continue}else Pe={lane:0,revertLane:me.revertLane,gesture:null,action:me.action,hasEagerState:me.hasEagerState,eagerState:me.eagerState,next:null},J===null?(V=J=Pe,I=C):J=J.next=Pe,bi.lanes|=ge,Ky|=ge;Pe=me.action,m1&&g(C,Pe),C=me.hasEagerState?me.eagerState:g(C,Pe)}else ge={lane:Pe,revertLane:me.revertLane,gesture:me.gesture,action:me.action,hasEagerState:me.hasEagerState,eagerState:me.eagerState,next:null},J===null?(V=J=ge,I=C):J=J.next=ge,bi.lanes|=Pe,Ky|=Pe;me=me.next}while(me!==null&&me!==p);if(J===null?I=C:J.next=V,!Gc(C,u.memoizedState)&&(oa=!0,$e&&(g=k2,g!==null)))throw g;u.memoizedState=C,u.baseState=I,u.baseQueue=J,b.lastRenderedState=C}return T===null&&(b.lanes=0),[u.memoizedState,b.dispatch]}function aj(u){var p=kn(),g=p.queue;if(g===null)throw Error(r(311));g.lastRenderedReducer=u;var b=g.dispatch,T=g.pending,C=p.memoizedState;if(T!==null){g.pending=null;var I=T=T.next;do C=u(C,I.action),I=I.next;while(I!==T);Gc(C,p.memoizedState)||(oa=!0),p.memoizedState=C,p.baseQueue===null&&(p.baseState=C),g.lastRenderedState=C}return[C,b]}function wae(u,p,g){var b=bi,T=kn(),C=dr;if(C){if(g===void 0)throw Error(r(407));g=g()}else g=p();var I=!Gc((rs||T).memoizedState,g);if(I&&(T.memoizedState=g,oa=!0),T=T.queue,cj(Tae.bind(null,b,T,u),[u]),T.getSnapshot!==p||I||aa!==null&&aa.memoizedState.tag&1){if(b.flags|=2048,B2(9,{destroy:void 0},Sae.bind(null,b,T,g,p),null),_s===null)throw Error(r(349));C||(mm&127)!==0||xae(b,p,g)}return g}function xae(u,p,g){u.flags|=16384,u={getSnapshot:p,value:g},p=bi.updateQueue,p===null?(p=dI(),bi.updateQueue=p,p.stores=[u]):(g=p.stores,g===null?p.stores=[u]:g.push(u))}function Sae(u,p,g,b){p.value=g,p.getSnapshot=b,$ae(p)&&Cae(u)}function Tae(u,p,g){return g(function(){$ae(p)&&Cae(u)})}function $ae(u){var p=u.getSnapshot;u=u.value;try{var g=p();return!Gc(u,g)}catch{return!0}}function Cae(u){var p=a1(u,2);p!==null&&sc(p,u,2)}function oj(u){var p=pl();if(typeof u=="function"){var g=u;if(u=g(),m1){Nt(!0);try{g()}finally{Nt(!1)}}}return p.memoizedState=p.baseState=u,p.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:gm,lastRenderedState:u},p}function Mae(u,p,g,b){return u.baseState=g,nj(u,rs,typeof b=="function"?b:gm)}function YFe(u,p,g,b,T){if(yI(u))throw Error(r(485));if(u=p.action,u!==null){var C={payload:T,action:u,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(I){C.listeners.push(I)}};H.T!==null?g(!0):C.isTransition=!1,b(C),g=p.pending,g===null?(C.next=p.pending=C,Eae(p,C)):(C.next=g.next,p.pending=g.next=C)}}function Eae(u,p){var g=p.action,b=p.payload,T=u.state;if(p.isTransition){var C=H.T,I={};H.T=I;try{var V=g(T,b),J=H.S;J!==null&&J(I,V),Aae(u,p,V)}catch(me){lj(u,p,me)}finally{C!==null&&I.types!==null&&(C.types=I.types),H.T=C}}else try{C=g(T,b),Aae(u,p,C)}catch(me){lj(u,p,me)}}function Aae(u,p,g){g!==null&&typeof g=="object"&&typeof g.then=="function"?g.then(function(b){Oae(u,p,b)},function(b){return lj(u,p,b)}):Oae(u,p,g)}function Oae(u,p,g){p.status="fulfilled",p.value=g,Pae(p),u.state=g,p=u.pending,p!==null&&(g=p.next,g===p?u.pending=null:(g=g.next,p.next=g,Eae(u,g)))}function lj(u,p,g){var b=u.pending;if(u.pending=null,b!==null){b=b.next;do p.status="rejected",p.reason=g,Pae(p),p=p.next;while(p!==b)}u.action=null}function Pae(u){u=u.listeners;for(var p=0;p<u.length;p++)(0,u[p])()}function Rae(u,p){return p}function Dae(u,p){if(dr){var g=_s.formState;if(g!==null){e:{var b=bi;if(dr){if(Ds){t:{for(var T=Ds,C=Qu;T.nodeType!==8;){if(!C){T=null;break t}if(T=Ju(T.nextSibling),T===null){T=null;break t}}C=T.data,T=C==="F!"||C==="F"?T:null}if(T){Ds=Ju(T.nextSibling),b=T.data==="F!";break e}}qy(b)}b=!1}b&&(p=g[0])}}return g=pl(),g.memoizedState=g.baseState=p,b={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Rae,lastRenderedState:p},g.queue=b,g=Jae.bind(null,bi,b),b.dispatch=g,b=oj(!1),C=fj.bind(null,bi,!1,b.queue),b=pl(),T={state:p,dispatch:null,action:u,pending:null},b.queue=T,g=YFe.bind(null,bi,T,C,g),T.dispatch=g,b.memoizedState=u,[p,g,!1]}function Iae(u){var p=kn();return Lae(p,rs,u)}function Lae(u,p,g){if(p=nj(u,p,Rae)[0],u=fI(gm)[0],typeof p=="object"&&p!==null&&typeof p.then=="function")try{var b=iE(p)}catch(I){throw I===z2?sI:I}else b=p;p=kn();var T=p.queue,C=T.dispatch;return g!==p.memoizedState&&(bi.flags|=2048,B2(9,{destroy:void 0},QFe.bind(null,T,g),null)),[b,C,u]}function QFe(u,p){u.action=p}function kae(u){var p=kn(),g=rs;if(g!==null)return Lae(p,g,u);kn(),p=p.memoizedState,g=kn();var b=g.queue.dispatch;return g.memoizedState=u,[p,b,!1]}function B2(u,p,g,b){return u={tag:u,create:g,deps:b,inst:p,next:null},p=bi.updateQueue,p===null&&(p=dI(),bi.updateQueue=p),g=p.lastEffect,g===null?p.lastEffect=u.next=u:(b=g.next,g.next=u,u.next=b,p.lastEffect=u),u}function zae(){return kn().memoizedState}function mI(u,p,g,b){var T=pl();bi.flags|=u,T.memoizedState=B2(1|p,{destroy:void 0},g,b===void 0?null:b)}function gI(u,p,g,b){var T=kn();b=b===void 0?null:b;var C=T.memoizedState.inst;rs!==null&&b!==null&&KB(b,rs.memoizedState.deps)?T.memoizedState=B2(p,C,g,b):(bi.flags|=u,T.memoizedState=B2(1|p,C,g,b))}function Fae(u,p){mI(8390656,8,u,p)}function cj(u,p){gI(2048,8,u,p)}function XFe(u){bi.flags|=4;var p=bi.updateQueue;if(p===null)p=dI(),bi.updateQueue=p,p.events=[u];else{var g=p.events;g===null?p.events=[u]:g.push(u)}}function Nae(u){var p=kn().memoizedState;return XFe({ref:p,nextImpl:u}),function(){if((Lr&2)!==0)throw Error(r(440));return p.impl.apply(void 0,arguments)}}function Vae(u,p){return gI(4,2,u,p)}function Uae(u,p){return gI(4,4,u,p)}function Bae(u,p){if(typeof p=="function"){u=u();var g=p(u);return function(){typeof g=="function"?g():p(null)}}if(p!=null)return u=u(),p.current=u,function(){p.current=null}}function jae(u,p,g){g=g!=null?g.concat([u]):null,gI(4,4,Bae.bind(null,p,u),g)}function uj(){}function qae(u,p){var g=kn();p=p===void 0?null:p;var b=g.memoizedState;return p!==null&&KB(p,b[1])?b[0]:(g.memoizedState=[u,p],u)}function Gae(u,p){var g=kn();p=p===void 0?null:p;var b=g.memoizedState;if(p!==null&&KB(p,b[1]))return b[0];if(b=u(),m1){Nt(!0);try{u()}finally{Nt(!1)}}return g.memoizedState=[b,p],b}function hj(u,p,g){return g===void 0||(mm&1073741824)!==0&&(tr&261930)===0?u.memoizedState=p:(u.memoizedState=g,u=Hoe(),bi.lanes|=u,Ky|=u,g)}function Hae(u,p,g,b){return Gc(g,p)?g:N2.current!==null?(u=hj(u,g,b),Gc(u,p)||(oa=!0),u):(mm&42)===0||(mm&1073741824)!==0&&(tr&261930)===0?(oa=!0,u.memoizedState=g):(u=Hoe(),bi.lanes|=u,Ky|=u,p)}function Wae(u,p,g,b,T){var C=Q.p;Q.p=C!==0&&8>C?C:8;var I=H.T,V={};H.T=V,fj(u,!1,p,g);try{var J=T(),me=H.S;if(me!==null&&me(V,J),J!==null&&typeof J=="object"&&typeof J.then=="function"){var $e=HFe(J,b);rE(u,p,$e,Xc(u))}else rE(u,p,b,Xc(u))}catch(Pe){rE(u,p,{then:function(){},status:"rejected",reason:Pe},Xc())}finally{Q.p=C,I!==null&&V.types!==null&&(I.types=V.types),H.T=I}}function JFe(){}function dj(u,p,g,b){if(u.tag!==5)throw Error(r(476));var T=Zae(u).queue;Wae(u,T,p,X,g===null?JFe:function(){return Yae(u),g(b)})}function Zae(u){var p=u.memoizedState;if(p!==null)return p;p={memoizedState:X,baseState:X,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:gm,lastRenderedState:X},next:null};var g={};return p.next={memoizedState:g,baseState:g,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:gm,lastRenderedState:g},next:null},u.memoizedState=p,u=u.alternate,u!==null&&(u.memoizedState=p),p}function Yae(u){var p=Zae(u);p.next===null&&(p=u.alternate.memoizedState),rE(u,p.next.queue,{},Xc())}function pj(){return _o(bE)}function Qae(){return kn().memoizedState}function Xae(){return kn().memoizedState}function KFe(u){for(var p=u.return;p!==null;){switch(p.tag){case 24:case 3:var g=Xc();u=Wy(g);var b=Zy(p,u,g);b!==null&&(sc(b,p,g),JM(b,p,g)),p={cache:BB()},u.payload=p;return}p=p.return}}function eNe(u,p,g){var b=Xc();g={lane:b,revertLane:0,gesture:null,action:g,hasEagerState:!1,eagerState:null,next:null},yI(u)?Kae(p,g):(g=PB(u,p,g,b),g!==null&&(sc(g,u,b),eoe(g,p,b)))}function Jae(u,p,g){var b=Xc();rE(u,p,g,b)}function rE(u,p,g,b){var T={lane:b,revertLane:0,gesture:null,action:g,hasEagerState:!1,eagerState:null,next:null};if(yI(u))Kae(p,T);else{var C=u.alternate;if(u.lanes===0&&(C===null||C.lanes===0)&&(C=p.lastRenderedReducer,C!==null))try{var I=p.lastRenderedState,V=C(I,g);if(T.hasEagerState=!0,T.eagerState=V,Gc(V,I))return X4(u,p,T,0),_s===null&&Q4(),!1}catch{}if(g=PB(u,p,T,b),g!==null)return sc(g,u,b),eoe(g,p,b),!0}return!1}function fj(u,p,g,b){if(b={lane:2,revertLane:Hj(),gesture:null,action:b,hasEagerState:!1,eagerState:null,next:null},yI(u)){if(p)throw Error(r(479))}else p=PB(u,g,b,2),p!==null&&sc(p,u,2)}function yI(u){var p=u.alternate;return u===bi||p!==null&&p===bi}function Kae(u,p){V2=uI=!0;var g=u.pending;g===null?p.next=p:(p.next=g.next,g.next=p),u.pending=p}function eoe(u,p,g){if((g&4194048)!==0){var b=p.lanes;b&=u.pendingLanes,g|=b,p.lanes=g,Ss(u,g)}}var sE={readContext:_o,use:pI,useCallback:mn,useContext:mn,useEffect:mn,useImperativeHandle:mn,useLayoutEffect:mn,useInsertionEffect:mn,useMemo:mn,useReducer:mn,useRef:mn,useState:mn,useDebugValue:mn,useDeferredValue:mn,useTransition:mn,useSyncExternalStore:mn,useId:mn,useHostTransitionStatus:mn,useFormState:mn,useActionState:mn,useOptimistic:mn,useMemoCache:mn,useCacheRefresh:mn};sE.useEffectEvent=mn;var toe={readContext:_o,use:pI,useCallback:function(u,p){return pl().memoizedState=[u,p===void 0?null:p],u},useContext:_o,useEffect:Fae,useImperativeHandle:function(u,p,g){g=g!=null?g.concat([u]):null,mI(4194308,4,Bae.bind(null,p,u),g)},useLayoutEffect:function(u,p){return mI(4194308,4,u,p)},useInsertionEffect:function(u,p){mI(4,2,u,p)},useMemo:function(u,p){var g=pl();p=p===void 0?null:p;var b=u();if(m1){Nt(!0);try{u()}finally{Nt(!1)}}return g.memoizedState=[b,p],b},useReducer:function(u,p,g){var b=pl();if(g!==void 0){var T=g(p);if(m1){Nt(!0);try{g(p)}finally{Nt(!1)}}}else T=p;return b.memoizedState=b.baseState=T,u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:u,lastRenderedState:T},b.queue=u,u=u.dispatch=eNe.bind(null,bi,u),[b.memoizedState,u]},useRef:function(u){var p=pl();return u={current:u},p.memoizedState=u},useState:function(u){u=oj(u);var p=u.queue,g=Jae.bind(null,bi,p);return p.dispatch=g,[u.memoizedState,g]},useDebugValue:uj,useDeferredValue:function(u,p){var g=pl();return hj(g,u,p)},useTransition:function(){var u=oj(!1);return u=Wae.bind(null,bi,u.queue,!0,!1),pl().memoizedState=u,[!1,u]},useSyncExternalStore:function(u,p,g){var b=bi,T=pl();if(dr){if(g===void 0)throw Error(r(407));g=g()}else{if(g=p(),_s===null)throw Error(r(349));(tr&127)!==0||xae(b,p,g)}T.memoizedState=g;var C={value:g,getSnapshot:p};return T.queue=C,Fae(Tae.bind(null,b,C,u),[u]),b.flags|=2048,B2(9,{destroy:void 0},Sae.bind(null,b,C,g,p),null),g},useId:function(){var u=pl(),p=_s.identifierPrefix;if(dr){var g=Fp,b=zp;g=(b&~(1<<32-Vt(b)-1)).toString(32)+g,p="_"+p+"R_"+g,g=hI++,0<g&&(p+="H"+g.toString(32)),p+="_"}else g=WFe++,p="_"+p+"r_"+g.toString(32)+"_";return u.memoizedState=p},useHostTransitionStatus:pj,useFormState:Dae,useActionState:Dae,useOptimistic:function(u){var p=pl();p.memoizedState=p.baseState=u;var g={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return p.queue=g,p=fj.bind(null,bi,!0,g),g.dispatch=p,[u,p]},useMemoCache:sj,useCacheRefresh:function(){return pl().memoizedState=KFe.bind(null,bi)},useEffectEvent:function(u){var p=pl(),g={impl:u};return p.memoizedState=g,function(){if((Lr&2)!==0)throw Error(r(440));return g.impl.apply(void 0,arguments)}}},mj={readContext:_o,use:pI,useCallback:qae,useContext:_o,useEffect:cj,useImperativeHandle:jae,useInsertionEffect:Vae,useLayoutEffect:Uae,useMemo:Gae,useReducer:fI,useRef:zae,useState:function(){return fI(gm)},useDebugValue:uj,useDeferredValue:function(u,p){var g=kn();return Hae(g,rs.memoizedState,u,p)},useTransition:function(){var u=fI(gm)[0],p=kn().memoizedState;return[typeof u=="boolean"?u:iE(u),p]},useSyncExternalStore:wae,useId:Qae,useHostTransitionStatus:pj,useFormState:Iae,useActionState:Iae,useOptimistic:function(u,p){var g=kn();return Mae(g,rs,u,p)},useMemoCache:sj,useCacheRefresh:Xae};mj.useEffectEvent=Nae;var ioe={readContext:_o,use:pI,useCallback:qae,useContext:_o,useEffect:cj,useImperativeHandle:jae,useInsertionEffect:Vae,useLayoutEffect:Uae,useMemo:Gae,useReducer:aj,useRef:zae,useState:function(){return aj(gm)},useDebugValue:uj,useDeferredValue:function(u,p){var g=kn();return rs===null?hj(g,u,p):Hae(g,rs.memoizedState,u,p)},useTransition:function(){var u=aj(gm)[0],p=kn().memoizedState;return[typeof u=="boolean"?u:iE(u),p]},useSyncExternalStore:wae,useId:Qae,useHostTransitionStatus:pj,useFormState:kae,useActionState:kae,useOptimistic:function(u,p){var g=kn();return rs!==null?Mae(g,rs,u,p):(g.baseState=u,[u,g.queue.dispatch])},useMemoCache:sj,useCacheRefresh:Xae};ioe.useEffectEvent=Nae;function gj(u,p,g,b){p=u.memoizedState,g=g(b,p),g=g==null?p:f({},p,g),u.memoizedState=g,u.lanes===0&&(u.updateQueue.baseState=g)}var yj={enqueueSetState:function(u,p,g){u=u._reactInternals;var b=Xc(),T=Wy(b);T.payload=p,g!=null&&(T.callback=g),p=Zy(u,T,b),p!==null&&(sc(p,u,b),JM(p,u,b))},enqueueReplaceState:function(u,p,g){u=u._reactInternals;var b=Xc(),T=Wy(b);T.tag=1,T.payload=p,g!=null&&(T.callback=g),p=Zy(u,T,b),p!==null&&(sc(p,u,b),JM(p,u,b))},enqueueForceUpdate:function(u,p){u=u._reactInternals;var g=Xc(),b=Wy(g);b.tag=2,p!=null&&(b.callback=p),p=Zy(u,b,g),p!==null&&(sc(p,u,g),JM(p,u,g))}};function roe(u,p,g,b,T,C,I){return u=u.stateNode,typeof u.shouldComponentUpdate=="function"?u.shouldComponentUpdate(b,C,I):p.prototype&&p.prototype.isPureReactComponent?!qM(g,b)||!qM(T,C):!0}function soe(u,p,g,b){u=p.state,typeof p.componentWillReceiveProps=="function"&&p.componentWillReceiveProps(g,b),typeof p.UNSAFE_componentWillReceiveProps=="function"&&p.UNSAFE_componentWillReceiveProps(g,b),p.state!==u&&yj.enqueueReplaceState(p,p.state,null)}function g1(u,p){var g=p;if("ref"in p){g={};for(var b in p)b!=="ref"&&(g[b]=p[b])}if(u=u.defaultProps){g===p&&(g=f({},g));for(var T in u)g[T]===void 0&&(g[T]=u[T])}return g}function noe(u){Y4(u)}function aoe(u){console.error(u)}function ooe(u){Y4(u)}function _I(u,p){try{var g=u.onUncaughtError;g(p.value,{componentStack:p.stack})}catch(b){setTimeout(function(){throw b})}}function loe(u,p,g){try{var b=u.onCaughtError;b(g.value,{componentStack:g.stack,errorBoundary:p.tag===1?p.stateNode:null})}catch(T){setTimeout(function(){throw T})}}function _j(u,p,g){return g=Wy(g),g.tag=3,g.payload={element:null},g.callback=function(){_I(u,p)},g}function coe(u){return u=Wy(u),u.tag=3,u}function uoe(u,p,g,b){var T=g.type.getDerivedStateFromError;if(typeof T=="function"){var C=b.value;u.payload=function(){return T(C)},u.callback=function(){loe(p,g,b)}}var I=g.stateNode;I!==null&&typeof I.componentDidCatch=="function"&&(u.callback=function(){loe(p,g,b),typeof T!="function"&&(e0===null?e0=new Set([this]):e0.add(this));var V=b.stack;this.componentDidCatch(b.value,{componentStack:V!==null?V:""})})}function tNe(u,p,g,b,T){if(g.flags|=32768,b!==null&&typeof b=="object"&&typeof b.then=="function"){if(p=g.alternate,p!==null&&I2(p,g,T,!0),g=Wc.current,g!==null){switch(g.tag){case 31:case 13:return Xu===null?OI():g.alternate===null&&gn===0&&(gn=3),g.flags&=-257,g.flags|=65536,g.lanes=T,b===nI?g.flags|=16384:(p=g.updateQueue,p===null?g.updateQueue=new Set([b]):p.add(b),jj(u,b,T)),!1;case 22:return g.flags|=65536,b===nI?g.flags|=16384:(p=g.updateQueue,p===null?(p={transitions:null,markerInstances:null,retryQueue:new Set([b])},g.updateQueue=p):(g=p.retryQueue,g===null?p.retryQueue=new Set([b]):g.add(b)),jj(u,b,T)),!1}throw Error(r(435,g.tag))}return jj(u,b,T),OI(),!1}if(dr)return p=Wc.current,p!==null?((p.flags&65536)===0&&(p.flags|=256),p.flags|=65536,p.lanes=T,b!==zB&&(u=Error(r(422),{cause:b}),WM(Wu(u,g)))):(b!==zB&&(p=Error(r(423),{cause:b}),WM(Wu(p,g))),u=u.current.alternate,u.flags|=65536,T&=-T,u.lanes|=T,b=Wu(b,g),T=_j(u.stateNode,b,T),ZB(u,T),gn!==4&&(gn=2)),!1;var C=Error(r(520),{cause:b});if(C=Wu(C,g),dE===null?dE=[C]:dE.push(C),gn!==4&&(gn=2),p===null)return!0;b=Wu(b,g),g=p;do{switch(g.tag){case 3:return g.flags|=65536,u=T&-T,g.lanes|=u,u=_j(g.stateNode,b,u),ZB(g,u),!1;case 1:if(p=g.type,C=g.stateNode,(g.flags&128)===0&&(typeof p.getDerivedStateFromError=="function"||C!==null&&typeof C.componentDidCatch=="function"&&(e0===null||!e0.has(C))))return g.flags|=65536,T&=-T,g.lanes|=T,T=coe(T),uoe(T,u,g,b),ZB(g,T),!1}g=g.return}while(g!==null);return!1}var vj=Error(r(461)),oa=!1;function vo(u,p,g,b){p.child=u===null?fae(p,null,g,b):f1(p,u.child,g,b)}function hoe(u,p,g,b,T){g=g.render;var C=p.ref;if("ref"in b){var I={};for(var V in b)V!=="ref"&&(I[V]=b[V])}else I=b;return u1(p),b=ej(u,p,g,I,C,T),V=tj(),u!==null&&!oa?(ij(u,p,T),ym(u,p,T)):(dr&&V&&LB(p),p.flags|=1,vo(u,p,b,T),p.child)}function doe(u,p,g,b,T){if(u===null){var C=g.type;return typeof C=="function"&&!RB(C)&&C.defaultProps===void 0&&g.compare===null?(p.tag=15,p.type=C,poe(u,p,C,b,T)):(u=K4(g.type,null,b,p,p.mode,T),u.ref=p.ref,u.return=p,p.child=u)}if(C=u.child,!Mj(u,T)){var I=C.memoizedProps;if(g=g.compare,g=g!==null?g:qM,g(I,b)&&u.ref===p.ref)return ym(u,p,T)}return p.flags|=1,u=hm(C,b),u.ref=p.ref,u.return=p,p.child=u}function poe(u,p,g,b,T){if(u!==null){var C=u.memoizedProps;if(qM(C,b)&&u.ref===p.ref)if(oa=!1,p.pendingProps=b=C,Mj(u,T))(u.flags&131072)!==0&&(oa=!0);else return p.lanes=u.lanes,ym(u,p,T)}return bj(u,p,g,b,T)}function foe(u,p,g,b){var T=b.children,C=u!==null?u.memoizedState:null;if(u===null&&p.stateNode===null&&(p.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),b.mode==="hidden"){if((p.flags&128)!==0){if(C=C!==null?C.baseLanes|g:g,u!==null){for(b=p.child=u.child,T=0;b!==null;)T=T|b.lanes|b.childLanes,b=b.sibling;b=T&~C}else b=0,p.child=null;return moe(u,p,C,g,b)}if((g&536870912)!==0)p.memoizedState={baseLanes:0,cachePool:null},u!==null&&rI(p,C!==null?C.cachePool:null),C!==null?yae(p,C):QB(),_ae(p);else return b=p.lanes=536870912,moe(u,p,C!==null?C.baseLanes|g:g,g,b)}else C!==null?(rI(p,C.cachePool),yae(p,C),Qy(),p.memoizedState=null):(u!==null&&rI(p,null),QB(),Qy());return vo(u,p,T,g),p.child}function nE(u,p){return u!==null&&u.tag===22||p.stateNode!==null||(p.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),p.sibling}function moe(u,p,g,b,T){var C=qB();return C=C===null?null:{parent:na._currentValue,pool:C},p.memoizedState={baseLanes:g,cachePool:C},u!==null&&rI(p,null),QB(),_ae(p),u!==null&&I2(u,p,b,!0),p.childLanes=T,null}function vI(u,p){return p=wI({mode:p.mode,children:p.children},u.mode),p.ref=u.ref,u.child=p,p.return=u,p}function goe(u,p,g){return f1(p,u.child,null,g),u=vI(p,p.pendingProps),u.flags|=2,Zc(p),p.memoizedState=null,u}function iNe(u,p,g){var b=p.pendingProps,T=(p.flags&128)!==0;if(p.flags&=-129,u===null){if(dr){if(b.mode==="hidden")return u=vI(p,b),p.lanes=536870912,nE(null,u);if(JB(p),(u=Ds)?(u=Ele(u,Qu),u=u!==null&&u.data==="&"?u:null,u!==null&&(p.memoizedState={dehydrated:u,treeContext:By!==null?{id:zp,overflow:Fp}:null,retryLane:536870912,hydrationErrors:null},g=Kne(u),g.return=p,p.child=g,yo=p,Ds=null)):u=null,u===null)throw qy(p);return p.lanes=536870912,null}return vI(p,b)}var C=u.memoizedState;if(C!==null){var I=C.dehydrated;if(JB(p),T)if(p.flags&256)p.flags&=-257,p=goe(u,p,g);else if(p.memoizedState!==null)p.child=u.child,p.flags|=128,p=null;else throw Error(r(558));else if(oa||I2(u,p,g,!1),T=(g&u.childLanes)!==0,oa||T){if(b=_s,b!==null&&(I=Je(b,g),I!==0&&I!==C.retryLane))throw C.retryLane=I,a1(u,I),sc(b,u,I),vj;OI(),p=goe(u,p,g)}else u=C.treeContext,Ds=Ju(I.nextSibling),yo=p,dr=!0,jy=null,Qu=!1,u!==null&&iae(p,u),p=vI(p,b),p.flags|=4096;return p}return u=hm(u.child,{mode:b.mode,children:b.children}),u.ref=p.ref,p.child=u,u.return=p,u}function bI(u,p){var g=p.ref;if(g===null)u!==null&&u.ref!==null&&(p.flags|=4194816);else{if(typeof g!="function"&&typeof g!="object")throw Error(r(284));(u===null||u.ref!==g)&&(p.flags|=4194816)}}function bj(u,p,g,b,T){return u1(p),g=ej(u,p,g,b,void 0,T),b=tj(),u!==null&&!oa?(ij(u,p,T),ym(u,p,T)):(dr&&b&&LB(p),p.flags|=1,vo(u,p,g,T),p.child)}function yoe(u,p,g,b,T,C){return u1(p),p.updateQueue=null,g=bae(p,b,g,T),vae(u),b=tj(),u!==null&&!oa?(ij(u,p,C),ym(u,p,C)):(dr&&b&&LB(p),p.flags|=1,vo(u,p,g,C),p.child)}function _oe(u,p,g,b,T){if(u1(p),p.stateNode===null){var C=O2,I=g.contextType;typeof I=="object"&&I!==null&&(C=_o(I)),C=new g(b,C),p.memoizedState=C.state!==null&&C.state!==void 0?C.state:null,C.updater=yj,p.stateNode=C,C._reactInternals=p,C=p.stateNode,C.props=b,C.state=p.memoizedState,C.refs={},HB(p),I=g.contextType,C.context=typeof I=="object"&&I!==null?_o(I):O2,C.state=p.memoizedState,I=g.getDerivedStateFromProps,typeof I=="function"&&(gj(p,g,I,b),C.state=p.memoizedState),typeof g.getDerivedStateFromProps=="function"||typeof C.getSnapshotBeforeUpdate=="function"||typeof C.UNSAFE_componentWillMount!="function"&&typeof C.componentWillMount!="function"||(I=C.state,typeof C.componentWillMount=="function"&&C.componentWillMount(),typeof C.UNSAFE_componentWillMount=="function"&&C.UNSAFE_componentWillMount(),I!==C.state&&yj.enqueueReplaceState(C,C.state,null),eE(p,b,C,T),KM(),C.state=p.memoizedState),typeof C.componentDidMount=="function"&&(p.flags|=4194308),b=!0}else if(u===null){C=p.stateNode;var V=p.memoizedProps,J=g1(g,V);C.props=J;var me=C.context,$e=g.contextType;I=O2,typeof $e=="object"&&$e!==null&&(I=_o($e));var Pe=g.getDerivedStateFromProps;$e=typeof Pe=="function"||typeof C.getSnapshotBeforeUpdate=="function",V=p.pendingProps!==V,$e||typeof C.UNSAFE_componentWillReceiveProps!="function"&&typeof C.componentWillReceiveProps!="function"||(V||me!==I)&&soe(p,C,b,I),Hy=!1;var ge=p.memoizedState;C.state=ge,eE(p,b,C,T),KM(),me=p.memoizedState,V||ge!==me||Hy?(typeof Pe=="function"&&(gj(p,g,Pe,b),me=p.memoizedState),(J=Hy||roe(p,g,J,b,ge,me,I))?($e||typeof C.UNSAFE_componentWillMount!="function"&&typeof C.componentWillMount!="function"||(typeof C.componentWillMount=="function"&&C.componentWillMount(),typeof C.UNSAFE_componentWillMount=="function"&&C.UNSAFE_componentWillMount()),typeof C.componentDidMount=="function"&&(p.flags|=4194308)):(typeof C.componentDidMount=="function"&&(p.flags|=4194308),p.memoizedProps=b,p.memoizedState=me),C.props=b,C.state=me,C.context=I,b=J):(typeof C.componentDidMount=="function"&&(p.flags|=4194308),b=!1)}else{C=p.stateNode,WB(u,p),I=p.memoizedProps,$e=g1(g,I),C.props=$e,Pe=p.pendingProps,ge=C.context,me=g.contextType,J=O2,typeof me=="object"&&me!==null&&(J=_o(me)),V=g.getDerivedStateFromProps,(me=typeof V=="function"||typeof C.getSnapshotBeforeUpdate=="function")||typeof C.UNSAFE_componentWillReceiveProps!="function"&&typeof C.componentWillReceiveProps!="function"||(I!==Pe||ge!==J)&&soe(p,C,b,J),Hy=!1,ge=p.memoizedState,C.state=ge,eE(p,b,C,T),KM();var we=p.memoizedState;I!==Pe||ge!==we||Hy||u!==null&&u.dependencies!==null&&tI(u.dependencies)?(typeof V=="function"&&(gj(p,g,V,b),we=p.memoizedState),($e=Hy||roe(p,g,$e,b,ge,we,J)||u!==null&&u.dependencies!==null&&tI(u.dependencies))?(me||typeof C.UNSAFE_componentWillUpdate!="function"&&typeof C.componentWillUpdate!="function"||(typeof C.componentWillUpdate=="function"&&C.componentWillUpdate(b,we,J),typeof C.UNSAFE_componentWillUpdate=="function"&&C.UNSAFE_componentWillUpdate(b,we,J)),typeof C.componentDidUpdate=="function"&&(p.flags|=4),typeof C.getSnapshotBeforeUpdate=="function"&&(p.flags|=1024)):(typeof C.componentDidUpdate!="function"||I===u.memoizedProps&&ge===u.memoizedState||(p.flags|=4),typeof C.getSnapshotBeforeUpdate!="function"||I===u.memoizedProps&&ge===u.memoizedState||(p.flags|=1024),p.memoizedProps=b,p.memoizedState=we),C.props=b,C.state=we,C.context=J,b=$e):(typeof C.componentDidUpdate!="function"||I===u.memoizedProps&&ge===u.memoizedState||(p.flags|=4),typeof C.getSnapshotBeforeUpdate!="function"||I===u.memoizedProps&&ge===u.memoizedState||(p.flags|=1024),b=!1)}return C=b,bI(u,p),b=(p.flags&128)!==0,C||b?(C=p.stateNode,g=b&&typeof g.getDerivedStateFromError!="function"?null:C.render(),p.flags|=1,u!==null&&b?(p.child=f1(p,u.child,null,T),p.child=f1(p,null,g,T)):vo(u,p,g,T),p.memoizedState=C.state,u=p.child):u=ym(u,p,T),u}function voe(u,p,g,b){return l1(),p.flags|=256,vo(u,p,g,b),p.child}var wj={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function xj(u){return{baseLanes:u,cachePool:lae()}}function Sj(u,p,g){return u=u!==null?u.childLanes&~g:0,p&&(u|=Qc),u}function boe(u,p,g){var b=p.pendingProps,T=!1,C=(p.flags&128)!==0,I;if((I=C)||(I=u!==null&&u.memoizedState===null?!1:(Ln.current&2)!==0),I&&(T=!0,p.flags&=-129),I=(p.flags&32)!==0,p.flags&=-33,u===null){if(dr){if(T?Yy(p):Qy(),(u=Ds)?(u=Ele(u,Qu),u=u!==null&&u.data!=="&"?u:null,u!==null&&(p.memoizedState={dehydrated:u,treeContext:By!==null?{id:zp,overflow:Fp}:null,retryLane:536870912,hydrationErrors:null},g=Kne(u),g.return=p,p.child=g,yo=p,Ds=null)):u=null,u===null)throw qy(p);return n9(u)?p.lanes=32:p.lanes=536870912,null}var V=b.children;return b=b.fallback,T?(Qy(),T=p.mode,V=wI({mode:"hidden",children:V},T),b=o1(b,T,g,null),V.return=p,b.return=p,V.sibling=b,p.child=V,b=p.child,b.memoizedState=xj(g),b.childLanes=Sj(u,I,g),p.memoizedState=wj,nE(null,b)):(Yy(p),Tj(p,V))}var J=u.memoizedState;if(J!==null&&(V=J.dehydrated,V!==null)){if(C)p.flags&256?(Yy(p),p.flags&=-257,p=$j(u,p,g)):p.memoizedState!==null?(Qy(),p.child=u.child,p.flags|=128,p=null):(Qy(),V=b.fallback,T=p.mode,b=wI({mode:"visible",children:b.children},T),V=o1(V,T,g,null),V.flags|=2,b.return=p,V.return=p,b.sibling=V,p.child=b,f1(p,u.child,null,g),b=p.child,b.memoizedState=xj(g),b.childLanes=Sj(u,I,g),p.memoizedState=wj,p=nE(null,b));else if(Yy(p),n9(V)){if(I=V.nextSibling&&V.nextSibling.dataset,I)var me=I.dgst;I=me,b=Error(r(419)),b.stack="",b.digest=I,WM({value:b,source:null,stack:null}),p=$j(u,p,g)}else if(oa||I2(u,p,g,!1),I=(g&u.childLanes)!==0,oa||I){if(I=_s,I!==null&&(b=Je(I,g),b!==0&&b!==J.retryLane))throw J.retryLane=b,a1(u,b),sc(I,u,b),vj;s9(V)||OI(),p=$j(u,p,g)}else s9(V)?(p.flags|=192,p.child=u.child,p=null):(u=J.treeContext,Ds=Ju(V.nextSibling),yo=p,dr=!0,jy=null,Qu=!1,u!==null&&iae(p,u),p=Tj(p,b.children),p.flags|=4096);return p}return T?(Qy(),V=b.fallback,T=p.mode,J=u.child,me=J.sibling,b=hm(J,{mode:"hidden",children:b.children}),b.subtreeFlags=J.subtreeFlags&65011712,me!==null?V=hm(me,V):(V=o1(V,T,g,null),V.flags|=2),V.return=p,b.return=p,b.sibling=V,p.child=b,nE(null,b),b=p.child,V=u.child.memoizedState,V===null?V=xj(g):(T=V.cachePool,T!==null?(J=na._currentValue,T=T.parent!==J?{parent:J,pool:J}:T):T=lae(),V={baseLanes:V.baseLanes|g,cachePool:T}),b.memoizedState=V,b.childLanes=Sj(u,I,g),p.memoizedState=wj,nE(u.child,b)):(Yy(p),g=u.child,u=g.sibling,g=hm(g,{mode:"visible",children:b.children}),g.return=p,g.sibling=null,u!==null&&(I=p.deletions,I===null?(p.deletions=[u],p.flags|=16):I.push(u)),p.child=g,p.memoizedState=null,g)}function Tj(u,p){return p=wI({mode:"visible",children:p},u.mode),p.return=u,u.child=p}function wI(u,p){return u=Hc(22,u,null,p),u.lanes=0,u}function $j(u,p,g){return f1(p,u.child,null,g),u=Tj(p,p.pendingProps.children),u.flags|=2,p.memoizedState=null,u}function woe(u,p,g){u.lanes|=p;var b=u.alternate;b!==null&&(b.lanes|=p),VB(u.return,p,g)}function Cj(u,p,g,b,T,C){var I=u.memoizedState;I===null?u.memoizedState={isBackwards:p,rendering:null,renderingStartTime:0,last:b,tail:g,tailMode:T,treeForkCount:C}:(I.isBackwards=p,I.rendering=null,I.renderingStartTime=0,I.last=b,I.tail=g,I.tailMode=T,I.treeForkCount=C)}function xoe(u,p,g){var b=p.pendingProps,T=b.revealOrder,C=b.tail;b=b.children;var I=Ln.current,V=(I&2)!==0;if(V?(I=I&1|2,p.flags|=128):I&=1,ce(Ln,I),vo(u,p,b,g),b=dr?HM:0,!V&&u!==null&&(u.flags&128)!==0)e:for(u=p.child;u!==null;){if(u.tag===13)u.memoizedState!==null&&woe(u,g,p);else if(u.tag===19)woe(u,g,p);else if(u.child!==null){u.child.return=u,u=u.child;continue}if(u===p)break e;for(;u.sibling===null;){if(u.return===null||u.return===p)break e;u=u.return}u.sibling.return=u.return,u=u.sibling}switch(T){case"forwards":for(g=p.child,T=null;g!==null;)u=g.alternate,u!==null&&cI(u)===null&&(T=g),g=g.sibling;g=T,g===null?(T=p.child,p.child=null):(T=g.sibling,g.sibling=null),Cj(p,!1,T,g,C,b);break;case"backwards":case"unstable_legacy-backwards":for(g=null,T=p.child,p.child=null;T!==null;){if(u=T.alternate,u!==null&&cI(u)===null){p.child=T;break}u=T.sibling,T.sibling=g,g=T,T=u}Cj(p,!0,g,null,C,b);break;case"together":Cj(p,!1,null,null,void 0,b);break;default:p.memoizedState=null}return p.child}function ym(u,p,g){if(u!==null&&(p.dependencies=u.dependencies),Ky|=p.lanes,(g&p.childLanes)===0)if(u!==null){if(I2(u,p,g,!1),(g&p.childLanes)===0)return null}else return null;if(u!==null&&p.child!==u.child)throw Error(r(153));if(p.child!==null){for(u=p.child,g=hm(u,u.pendingProps),p.child=g,g.return=p;u.sibling!==null;)u=u.sibling,g=g.sibling=hm(u,u.pendingProps),g.return=p;g.sibling=null}return p.child}function Mj(u,p){return(u.lanes&p)!==0?!0:(u=u.dependencies,!!(u!==null&&tI(u)))}function rNe(u,p,g){switch(p.tag){case 3:Tt(p,p.stateNode.containerInfo),Gy(p,na,u.memoizedState.cache),l1();break;case 27:case 5:It(p);break;case 4:Tt(p,p.stateNode.containerInfo);break;case 10:Gy(p,p.type,p.memoizedProps.value);break;case 31:if(p.memoizedState!==null)return p.flags|=128,JB(p),null;break;case 13:var b=p.memoizedState;if(b!==null)return b.dehydrated!==null?(Yy(p),p.flags|=128,null):(g&p.child.childLanes)!==0?boe(u,p,g):(Yy(p),u=ym(u,p,g),u!==null?u.sibling:null);Yy(p);break;case 19:var T=(u.flags&128)!==0;if(b=(g&p.childLanes)!==0,b||(I2(u,p,g,!1),b=(g&p.childLanes)!==0),T){if(b)return xoe(u,p,g);p.flags|=128}if(T=p.memoizedState,T!==null&&(T.rendering=null,T.tail=null,T.lastEffect=null),ce(Ln,Ln.current),b)break;return null;case 22:return p.lanes=0,foe(u,p,g,p.pendingProps);case 24:Gy(p,na,u.memoizedState.cache)}return ym(u,p,g)}function Soe(u,p,g){if(u!==null)if(u.memoizedProps!==p.pendingProps)oa=!0;else{if(!Mj(u,g)&&(p.flags&128)===0)return oa=!1,rNe(u,p,g);oa=(u.flags&131072)!==0}else oa=!1,dr&&(p.flags&1048576)!==0&&tae(p,HM,p.index);switch(p.lanes=0,p.tag){case 16:e:{var b=p.pendingProps;if(u=d1(p.elementType),p.type=u,typeof u=="function")RB(u)?(b=g1(u,b),p.tag=1,p=_oe(null,p,u,b,g)):(p.tag=0,p=bj(null,p,u,b,g));else{if(u!=null){var T=u.$$typeof;if(T===P){p.tag=11,p=hoe(null,p,u,b,g);break e}else if(T===L){p.tag=14,p=doe(null,p,u,b,g);break e}}throw p=G(u)||u,Error(r(306,p,""))}}return p;case 0:return bj(u,p,p.type,p.pendingProps,g);case 1:return b=p.type,T=g1(b,p.pendingProps),_oe(u,p,b,T,g);case 3:e:{if(Tt(p,p.stateNode.containerInfo),u===null)throw Error(r(387));b=p.pendingProps;var C=p.memoizedState;T=C.element,WB(u,p),eE(p,b,null,g);var I=p.memoizedState;if(b=I.cache,Gy(p,na,b),b!==C.cache&&UB(p,[na],g,!0),KM(),b=I.element,C.isDehydrated)if(C={element:b,isDehydrated:!1,cache:I.cache},p.updateQueue.baseState=C,p.memoizedState=C,p.flags&256){p=voe(u,p,b,g);break e}else if(b!==T){T=Wu(Error(r(424)),p),WM(T),p=voe(u,p,b,g);break e}else for(u=p.stateNode.containerInfo,u.nodeType===9?u=u.body:u=u.nodeName==="HTML"?u.ownerDocument.body:u,Ds=Ju(u.firstChild),yo=p,dr=!0,jy=null,Qu=!0,g=fae(p,null,b,g),p.child=g;g;)g.flags=g.flags&-3|4096,g=g.sibling;else{if(l1(),b===T){p=ym(u,p,g);break e}vo(u,p,b,g)}p=p.child}return p;case 26:return bI(u,p),u===null?(g=Ile(p.type,null,p.pendingProps,null))?p.memoizedState=g:dr||(g=p.type,u=p.pendingProps,b=zI(Ne.current).createElement(g),b[vi]=p,b[Pa]=u,bo(b,g,u),Vr(b),p.stateNode=b):p.memoizedState=Ile(p.type,u.memoizedProps,p.pendingProps,u.memoizedState),null;case 27:return It(p),u===null&&dr&&(b=p.stateNode=Ple(p.type,p.pendingProps,Ne.current),yo=p,Qu=!0,T=Ds,s0(p.type)?(a9=T,Ds=Ju(b.firstChild)):Ds=T),vo(u,p,p.pendingProps.children,g),bI(u,p),u===null&&(p.flags|=4194304),p.child;case 5:return u===null&&dr&&((T=b=Ds)&&(b=DNe(b,p.type,p.pendingProps,Qu),b!==null?(p.stateNode=b,yo=p,Ds=Ju(b.firstChild),Qu=!1,T=!0):T=!1),T||qy(p)),It(p),T=p.type,C=p.pendingProps,I=u!==null?u.memoizedProps:null,b=C.children,t9(T,C)?b=null:I!==null&&t9(T,I)&&(p.flags|=32),p.memoizedState!==null&&(T=ej(u,p,ZFe,null,null,g),bE._currentValue=T),bI(u,p),vo(u,p,b,g),p.child;case 6:return u===null&&dr&&((u=g=Ds)&&(g=INe(g,p.pendingProps,Qu),g!==null?(p.stateNode=g,yo=p,Ds=null,u=!0):u=!1),u||qy(p)),null;case 13:return boe(u,p,g);case 4:return Tt(p,p.stateNode.containerInfo),b=p.pendingProps,u===null?p.child=f1(p,null,b,g):vo(u,p,b,g),p.child;case 11:return hoe(u,p,p.type,p.pendingProps,g);case 7:return vo(u,p,p.pendingProps,g),p.child;case 8:return vo(u,p,p.pendingProps.children,g),p.child;case 12:return vo(u,p,p.pendingProps.children,g),p.child;case 10:return b=p.pendingProps,Gy(p,p.type,b.value),vo(u,p,b.children,g),p.child;case 9:return T=p.type._context,b=p.pendingProps.children,u1(p),T=_o(T),b=b(T),p.flags|=1,vo(u,p,b,g),p.child;case 14:return doe(u,p,p.type,p.pendingProps,g);case 15:return poe(u,p,p.type,p.pendingProps,g);case 19:return xoe(u,p,g);case 31:return iNe(u,p,g);case 22:return foe(u,p,g,p.pendingProps);case 24:return u1(p),b=_o(na),u===null?(T=qB(),T===null&&(T=_s,C=BB(),T.pooledCache=C,C.refCount++,C!==null&&(T.pooledCacheLanes|=g),T=C),p.memoizedState={parent:b,cache:T},HB(p),Gy(p,na,T)):((u.lanes&g)!==0&&(WB(u,p),eE(p,null,null,g),KM()),T=u.memoizedState,C=p.memoizedState,T.parent!==b?(T={parent:b,cache:b},p.memoizedState=T,p.lanes===0&&(p.memoizedState=p.updateQueue.baseState=T),Gy(p,na,b)):(b=C.cache,Gy(p,na,b),b!==T.cache&&UB(p,[na],g,!0))),vo(u,p,p.pendingProps.children,g),p.child;case 29:throw p.pendingProps}throw Error(r(156,p.tag))}function _m(u){u.flags|=4}function Ej(u,p,g,b,T){if((p=(u.mode&32)!==0)&&(p=!1),p){if(u.flags|=16777216,(T&335544128)===T)if(u.stateNode.complete)u.flags|=8192;else if(Qoe())u.flags|=8192;else throw p1=nI,GB}else u.flags&=-16777217}function Toe(u,p){if(p.type!=="stylesheet"||(p.state.loading&4)!==0)u.flags&=-16777217;else if(u.flags|=16777216,!Nle(p))if(Qoe())u.flags|=8192;else throw p1=nI,GB}function xI(u,p){p!==null&&(u.flags|=4),u.flags&16384&&(p=u.tag!==22?ue():536870912,u.lanes|=p,H2|=p)}function aE(u,p){if(!dr)switch(u.tailMode){case"hidden":p=u.tail;for(var g=null;p!==null;)p.alternate!==null&&(g=p),p=p.sibling;g===null?u.tail=null:g.sibling=null;break;case"collapsed":g=u.tail;for(var b=null;g!==null;)g.alternate!==null&&(b=g),g=g.sibling;b===null?p||u.tail===null?u.tail=null:u.tail.sibling=null:b.sibling=null}}function Is(u){var p=u.alternate!==null&&u.alternate.child===u.child,g=0,b=0;if(p)for(var T=u.child;T!==null;)g|=T.lanes|T.childLanes,b|=T.subtreeFlags&65011712,b|=T.flags&65011712,T.return=u,T=T.sibling;else for(T=u.child;T!==null;)g|=T.lanes|T.childLanes,b|=T.subtreeFlags,b|=T.flags,T.return=u,T=T.sibling;return u.subtreeFlags|=b,u.childLanes=g,p}function sNe(u,p,g){var b=p.pendingProps;switch(kB(p),p.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Is(p),null;case 1:return Is(p),null;case 3:return g=p.stateNode,b=null,u!==null&&(b=u.memoizedState.cache),p.memoizedState.cache!==b&&(p.flags|=2048),fm(na),et(),g.pendingContext&&(g.context=g.pendingContext,g.pendingContext=null),(u===null||u.child===null)&&(D2(p)?_m(p):u===null||u.memoizedState.isDehydrated&&(p.flags&256)===0||(p.flags|=1024,FB())),Is(p),null;case 26:var T=p.type,C=p.memoizedState;return u===null?(_m(p),C!==null?(Is(p),Toe(p,C)):(Is(p),Ej(p,T,null,b,g))):C?C!==u.memoizedState?(_m(p),Is(p),Toe(p,C)):(Is(p),p.flags&=-16777217):(u=u.memoizedProps,u!==b&&_m(p),Is(p),Ej(p,T,u,b,g)),null;case 27:if($t(p),g=Ne.current,T=p.type,u!==null&&p.stateNode!=null)u.memoizedProps!==b&&_m(p);else{if(!b){if(p.stateNode===null)throw Error(r(166));return Is(p),null}u=be.current,D2(p)?rae(p):(u=Ple(T,b,g),p.stateNode=u,_m(p))}return Is(p),null;case 5:if($t(p),T=p.type,u!==null&&p.stateNode!=null)u.memoizedProps!==b&&_m(p);else{if(!b){if(p.stateNode===null)throw Error(r(166));return Is(p),null}if(C=be.current,D2(p))rae(p);else{var I=zI(Ne.current);switch(C){case 1:C=I.createElementNS("http://www.w3.org/2000/svg",T);break;case 2:C=I.createElementNS("http://www.w3.org/1998/Math/MathML",T);break;default:switch(T){case"svg":C=I.createElementNS("http://www.w3.org/2000/svg",T);break;case"math":C=I.createElementNS("http://www.w3.org/1998/Math/MathML",T);break;case"script":C=I.createElement("div"),C.innerHTML="<script><\/script>",C=C.removeChild(C.firstChild);break;case"select":C=typeof b.is=="string"?I.createElement("select",{is:b.is}):I.createElement("select"),b.multiple?C.multiple=!0:b.size&&(C.size=b.size);break;default:C=typeof b.is=="string"?I.createElement(T,{is:b.is}):I.createElement(T)}}C[vi]=p,C[Pa]=b;e:for(I=p.child;I!==null;){if(I.tag===5||I.tag===6)C.appendChild(I.stateNode);else if(I.tag!==4&&I.tag!==27&&I.child!==null){I.child.return=I,I=I.child;continue}if(I===p)break e;for(;I.sibling===null;){if(I.return===null||I.return===p)break e;I=I.return}I.sibling.return=I.return,I=I.sibling}p.stateNode=C;e:switch(bo(C,T,b),T){case"button":case"input":case"select":case"textarea":b=!!b.autoFocus;break e;case"img":b=!0;break e;default:b=!1}b&&_m(p)}}return Is(p),Ej(p,p.type,u===null?null:u.memoizedProps,p.pendingProps,g),null;case 6:if(u&&p.stateNode!=null)u.memoizedProps!==b&&_m(p);else{if(typeof b!="string"&&p.stateNode===null)throw Error(r(166));if(u=Ne.current,D2(p)){if(u=p.stateNode,g=p.memoizedProps,b=null,T=yo,T!==null)switch(T.tag){case 27:case 5:b=T.memoizedProps}u[vi]=p,u=!!(u.nodeValue===g||b!==null&&b.suppressHydrationWarning===!0||ble(u.nodeValue,g)),u||qy(p,!0)}else u=zI(u).createTextNode(b),u[vi]=p,p.stateNode=u}return Is(p),null;case 31:if(g=p.memoizedState,u===null||u.memoizedState!==null){if(b=D2(p),g!==null){if(u===null){if(!b)throw Error(r(318));if(u=p.memoizedState,u=u!==null?u.dehydrated:null,!u)throw Error(r(557));u[vi]=p}else l1(),(p.flags&128)===0&&(p.memoizedState=null),p.flags|=4;Is(p),u=!1}else g=FB(),u!==null&&u.memoizedState!==null&&(u.memoizedState.hydrationErrors=g),u=!0;if(!u)return p.flags&256?(Zc(p),p):(Zc(p),null);if((p.flags&128)!==0)throw Error(r(558))}return Is(p),null;case 13:if(b=p.memoizedState,u===null||u.memoizedState!==null&&u.memoizedState.dehydrated!==null){if(T=D2(p),b!==null&&b.dehydrated!==null){if(u===null){if(!T)throw Error(r(318));if(T=p.memoizedState,T=T!==null?T.dehydrated:null,!T)throw Error(r(317));T[vi]=p}else l1(),(p.flags&128)===0&&(p.memoizedState=null),p.flags|=4;Is(p),T=!1}else T=FB(),u!==null&&u.memoizedState!==null&&(u.memoizedState.hydrationErrors=T),T=!0;if(!T)return p.flags&256?(Zc(p),p):(Zc(p),null)}return Zc(p),(p.flags&128)!==0?(p.lanes=g,p):(g=b!==null,u=u!==null&&u.memoizedState!==null,g&&(b=p.child,T=null,b.alternate!==null&&b.alternate.memoizedState!==null&&b.alternate.memoizedState.cachePool!==null&&(T=b.alternate.memoizedState.cachePool.pool),C=null,b.memoizedState!==null&&b.memoizedState.cachePool!==null&&(C=b.memoizedState.cachePool.pool),C!==T&&(b.flags|=2048)),g!==u&&g&&(p.child.flags|=8192),xI(p,p.updateQueue),Is(p),null);case 4:return et(),u===null&&Qj(p.stateNode.containerInfo),Is(p),null;case 10:return fm(p.type),Is(p),null;case 19:if(ne(Ln),b=p.memoizedState,b===null)return Is(p),null;if(T=(p.flags&128)!==0,C=b.rendering,C===null)if(T)aE(b,!1);else{if(gn!==0||u!==null&&(u.flags&128)!==0)for(u=p.child;u!==null;){if(C=cI(u),C!==null){for(p.flags|=128,aE(b,!1),u=C.updateQueue,p.updateQueue=u,xI(p,u),p.subtreeFlags=0,u=g,g=p.child;g!==null;)Jne(g,u),g=g.sibling;return ce(Ln,Ln.current&1|2),dr&&dm(p,b.treeForkCount),p.child}u=u.sibling}b.tail!==null&&rt()>MI&&(p.flags|=128,T=!0,aE(b,!1),p.lanes=4194304)}else{if(!T)if(u=cI(C),u!==null){if(p.flags|=128,T=!0,u=u.updateQueue,p.updateQueue=u,xI(p,u),aE(b,!0),b.tail===null&&b.tailMode==="hidden"&&!C.alternate&&!dr)return Is(p),null}else 2*rt()-b.renderingStartTime>MI&&g!==536870912&&(p.flags|=128,T=!0,aE(b,!1),p.lanes=4194304);b.isBackwards?(C.sibling=p.child,p.child=C):(u=b.last,u!==null?u.sibling=C:p.child=C,b.last=C)}return b.tail!==null?(u=b.tail,b.rendering=u,b.tail=u.sibling,b.renderingStartTime=rt(),u.sibling=null,g=Ln.current,ce(Ln,T?g&1|2:g&1),dr&&dm(p,b.treeForkCount),u):(Is(p),null);case 22:case 23:return Zc(p),XB(),b=p.memoizedState!==null,u!==null?u.memoizedState!==null!==b&&(p.flags|=8192):b&&(p.flags|=8192),b?(g&536870912)!==0&&(p.flags&128)===0&&(Is(p),p.subtreeFlags&6&&(p.flags|=8192)):Is(p),g=p.updateQueue,g!==null&&xI(p,g.retryQueue),g=null,u!==null&&u.memoizedState!==null&&u.memoizedState.cachePool!==null&&(g=u.memoizedState.cachePool.pool),b=null,p.memoizedState!==null&&p.memoizedState.cachePool!==null&&(b=p.memoizedState.cachePool.pool),b!==g&&(p.flags|=2048),u!==null&&ne(h1),null;case 24:return g=null,u!==null&&(g=u.memoizedState.cache),p.memoizedState.cache!==g&&(p.flags|=2048),fm(na),Is(p),null;case 25:return null;case 30:return null}throw Error(r(156,p.tag))}function nNe(u,p){switch(kB(p),p.tag){case 1:return u=p.flags,u&65536?(p.flags=u&-65537|128,p):null;case 3:return fm(na),et(),u=p.flags,(u&65536)!==0&&(u&128)===0?(p.flags=u&-65537|128,p):null;case 26:case 27:case 5:return $t(p),null;case 31:if(p.memoizedState!==null){if(Zc(p),p.alternate===null)throw Error(r(340));l1()}return u=p.flags,u&65536?(p.flags=u&-65537|128,p):null;case 13:if(Zc(p),u=p.memoizedState,u!==null&&u.dehydrated!==null){if(p.alternate===null)throw Error(r(340));l1()}return u=p.flags,u&65536?(p.flags=u&-65537|128,p):null;case 19:return ne(Ln),null;case 4:return et(),null;case 10:return fm(p.type),null;case 22:case 23:return Zc(p),XB(),u!==null&&ne(h1),u=p.flags,u&65536?(p.flags=u&-65537|128,p):null;case 24:return fm(na),null;case 25:return null;default:return null}}function $oe(u,p){switch(kB(p),p.tag){case 3:fm(na),et();break;case 26:case 27:case 5:$t(p);break;case 4:et();break;case 31:p.memoizedState!==null&&Zc(p);break;case 13:Zc(p);break;case 19:ne(Ln);break;case 10:fm(p.type);break;case 22:case 23:Zc(p),XB(),u!==null&&ne(h1);break;case 24:fm(na)}}function oE(u,p){try{var g=p.updateQueue,b=g!==null?g.lastEffect:null;if(b!==null){var T=b.next;g=T;do{if((g.tag&u)===u){b=void 0;var C=g.create,I=g.inst;b=C(),I.destroy=b}g=g.next}while(g!==T)}}catch(V){Yr(p,p.return,V)}}function Xy(u,p,g){try{var b=p.updateQueue,T=b!==null?b.lastEffect:null;if(T!==null){var C=T.next;b=C;do{if((b.tag&u)===u){var I=b.inst,V=I.destroy;if(V!==void 0){I.destroy=void 0,T=p;var J=g,me=V;try{me()}catch($e){Yr(T,J,$e)}}}b=b.next}while(b!==C)}}catch($e){Yr(p,p.return,$e)}}function Coe(u){var p=u.updateQueue;if(p!==null){var g=u.stateNode;try{gae(p,g)}catch(b){Yr(u,u.return,b)}}}function Moe(u,p,g){g.props=g1(u.type,u.memoizedProps),g.state=u.memoizedState;try{g.componentWillUnmount()}catch(b){Yr(u,p,b)}}function lE(u,p){try{var g=u.ref;if(g!==null){switch(u.tag){case 26:case 27:case 5:var b=u.stateNode;break;case 30:b=u.stateNode;break;default:b=u.stateNode}typeof g=="function"?u.refCleanup=g(b):g.current=b}}catch(T){Yr(u,p,T)}}function Np(u,p){var g=u.ref,b=u.refCleanup;if(g!==null)if(typeof b=="function")try{b()}catch(T){Yr(u,p,T)}finally{u.refCleanup=null,u=u.alternate,u!=null&&(u.refCleanup=null)}else if(typeof g=="function")try{g(null)}catch(T){Yr(u,p,T)}else g.current=null}function Eoe(u){var p=u.type,g=u.memoizedProps,b=u.stateNode;try{e:switch(p){case"button":case"input":case"select":case"textarea":g.autoFocus&&b.focus();break e;case"img":g.src?b.src=g.src:g.srcSet&&(b.srcset=g.srcSet)}}catch(T){Yr(u,u.return,T)}}function Aj(u,p,g){try{var b=u.stateNode;MNe(b,u.type,g,p),b[Pa]=p}catch(T){Yr(u,u.return,T)}}function Aoe(u){return u.tag===5||u.tag===3||u.tag===26||u.tag===27&&s0(u.type)||u.tag===4}function Oj(u){e:for(;;){for(;u.sibling===null;){if(u.return===null||Aoe(u.return))return null;u=u.return}for(u.sibling.return=u.return,u=u.sibling;u.tag!==5&&u.tag!==6&&u.tag!==18;){if(u.tag===27&&s0(u.type)||u.flags&2||u.child===null||u.tag===4)continue e;u.child.return=u,u=u.child}if(!(u.flags&2))return u.stateNode}}function Pj(u,p,g){var b=u.tag;if(b===5||b===6)u=u.stateNode,p?(g.nodeType===9?g.body:g.nodeName==="HTML"?g.ownerDocument.body:g).insertBefore(u,p):(p=g.nodeType===9?g.body:g.nodeName==="HTML"?g.ownerDocument.body:g,p.appendChild(u),g=g._reactRootContainer,g!=null||p.onclick!==null||(p.onclick=cm));else if(b!==4&&(b===27&&s0(u.type)&&(g=u.stateNode,p=null),u=u.child,u!==null))for(Pj(u,p,g),u=u.sibling;u!==null;)Pj(u,p,g),u=u.sibling}function SI(u,p,g){var b=u.tag;if(b===5||b===6)u=u.stateNode,p?g.insertBefore(u,p):g.appendChild(u);else if(b!==4&&(b===27&&s0(u.type)&&(g=u.stateNode),u=u.child,u!==null))for(SI(u,p,g),u=u.sibling;u!==null;)SI(u,p,g),u=u.sibling}function Ooe(u){var p=u.stateNode,g=u.memoizedProps;try{for(var b=u.type,T=p.attributes;T.length;)p.removeAttributeNode(T[0]);bo(p,b,g),p[vi]=u,p[Pa]=g}catch(C){Yr(u,u.return,C)}}var vm=!1,la=!1,Rj=!1,Poe=typeof WeakSet=="function"?WeakSet:Set,Wa=null;function aNe(u,p){if(u=u.containerInfo,Kj=qI,u=jne(u),$B(u)){if("selectionStart"in u)var g={start:u.selectionStart,end:u.selectionEnd};else e:{g=(g=u.ownerDocument)&&g.defaultView||window;var b=g.getSelection&&g.getSelection();if(b&&b.rangeCount!==0){g=b.anchorNode;var T=b.anchorOffset,C=b.focusNode;b=b.focusOffset;try{g.nodeType,C.nodeType}catch{g=null;break e}var I=0,V=-1,J=-1,me=0,$e=0,Pe=u,ge=null;t:for(;;){for(var we;Pe!==g||T!==0&&Pe.nodeType!==3||(V=I+T),Pe!==C||b!==0&&Pe.nodeType!==3||(J=I+b),Pe.nodeType===3&&(I+=Pe.nodeValue.length),(we=Pe.firstChild)!==null;)ge=Pe,Pe=we;for(;;){if(Pe===u)break t;if(ge===g&&++me===T&&(V=I),ge===C&&++$e===b&&(J=I),(we=Pe.nextSibling)!==null)break;Pe=ge,ge=Pe.parentNode}Pe=we}g=V===-1||J===-1?null:{start:V,end:J}}else g=null}g=g||{start:0,end:0}}else g=null;for(e9={focusedElem:u,selectionRange:g},qI=!1,Wa=p;Wa!==null;)if(p=Wa,u=p.child,(p.subtreeFlags&1028)!==0&&u!==null)u.return=p,Wa=u;else for(;Wa!==null;){switch(p=Wa,C=p.alternate,u=p.flags,p.tag){case 0:if((u&4)!==0&&(u=p.updateQueue,u=u!==null?u.events:null,u!==null))for(g=0;g<u.length;g++)T=u[g],T.ref.impl=T.nextImpl;break;case 11:case 15:break;case 1:if((u&1024)!==0&&C!==null){u=void 0,g=p,T=C.memoizedProps,C=C.memoizedState,b=g.stateNode;try{var xt=g1(g.type,T);u=b.getSnapshotBeforeUpdate(xt,C),b.__reactInternalSnapshotBeforeUpdate=u}catch(Qt){Yr(g,g.return,Qt)}}break;case 3:if((u&1024)!==0){if(u=p.stateNode.containerInfo,g=u.nodeType,g===9)r9(u);else if(g===1)switch(u.nodeName){case"HEAD":case"HTML":case"BODY":r9(u);break;default:u.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((u&1024)!==0)throw Error(r(163))}if(u=p.sibling,u!==null){u.return=p.return,Wa=u;break}Wa=p.return}}function Roe(u,p,g){var b=g.flags;switch(g.tag){case 0:case 11:case 15:wm(u,g),b&4&&oE(5,g);break;case 1:if(wm(u,g),b&4)if(u=g.stateNode,p===null)try{u.componentDidMount()}catch(I){Yr(g,g.return,I)}else{var T=g1(g.type,p.memoizedProps);p=p.memoizedState;try{u.componentDidUpdate(T,p,u.__reactInternalSnapshotBeforeUpdate)}catch(I){Yr(g,g.return,I)}}b&64&&Coe(g),b&512&&lE(g,g.return);break;case 3:if(wm(u,g),b&64&&(u=g.updateQueue,u!==null)){if(p=null,g.child!==null)switch(g.child.tag){case 27:case 5:p=g.child.stateNode;break;case 1:p=g.child.stateNode}try{gae(u,p)}catch(I){Yr(g,g.return,I)}}break;case 27:p===null&&b&4&&Ooe(g);case 26:case 5:wm(u,g),p===null&&b&4&&Eoe(g),b&512&&lE(g,g.return);break;case 12:wm(u,g);break;case 31:wm(u,g),b&4&&Loe(u,g);break;case 13:wm(u,g),b&4&&koe(u,g),b&64&&(u=g.memoizedState,u!==null&&(u=u.dehydrated,u!==null&&(g=mNe.bind(null,g),LNe(u,g))));break;case 22:if(b=g.memoizedState!==null||vm,!b){p=p!==null&&p.memoizedState!==null||la,T=vm;var C=la;vm=b,(la=p)&&!C?xm(u,g,(g.subtreeFlags&8772)!==0):wm(u,g),vm=T,la=C}break;case 30:break;default:wm(u,g)}}function Doe(u){var p=u.alternate;p!==null&&(u.alternate=null,Doe(p)),u.child=null,u.deletions=null,u.sibling=null,u.tag===5&&(p=u.stateNode,p!==null&&Jl(p)),u.stateNode=null,u.return=null,u.dependencies=null,u.memoizedProps=null,u.memoizedState=null,u.pendingProps=null,u.stateNode=null,u.updateQueue=null}var Xs=null,ec=!1;function bm(u,p,g){for(g=g.child;g!==null;)Ioe(u,p,g),g=g.sibling}function Ioe(u,p,g){if(wt&&typeof wt.onCommitFiberUnmount=="function")try{wt.onCommitFiberUnmount(ti,g)}catch{}switch(g.tag){case 26:la||Np(g,p),bm(u,p,g),g.memoizedState?g.memoizedState.count--:g.stateNode&&(g=g.stateNode,g.parentNode.removeChild(g));break;case 27:la||Np(g,p);var b=Xs,T=ec;s0(g.type)&&(Xs=g.stateNode,ec=!1),bm(u,p,g),yE(g.stateNode),Xs=b,ec=T;break;case 5:la||Np(g,p);case 6:if(b=Xs,T=ec,Xs=null,bm(u,p,g),Xs=b,ec=T,Xs!==null)if(ec)try{(Xs.nodeType===9?Xs.body:Xs.nodeName==="HTML"?Xs.ownerDocument.body:Xs).removeChild(g.stateNode)}catch(C){Yr(g,p,C)}else try{Xs.removeChild(g.stateNode)}catch(C){Yr(g,p,C)}break;case 18:Xs!==null&&(ec?(u=Xs,Cle(u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u,g.stateNode),eS(u)):Cle(Xs,g.stateNode));break;case 4:b=Xs,T=ec,Xs=g.stateNode.containerInfo,ec=!0,bm(u,p,g),Xs=b,ec=T;break;case 0:case 11:case 14:case 15:Xy(2,g,p),la||Xy(4,g,p),bm(u,p,g);break;case 1:la||(Np(g,p),b=g.stateNode,typeof b.componentWillUnmount=="function"&&Moe(g,p,b)),bm(u,p,g);break;case 21:bm(u,p,g);break;case 22:la=(b=la)||g.memoizedState!==null,bm(u,p,g),la=b;break;default:bm(u,p,g)}}function Loe(u,p){if(p.memoizedState===null&&(u=p.alternate,u!==null&&(u=u.memoizedState,u!==null))){u=u.dehydrated;try{eS(u)}catch(g){Yr(p,p.return,g)}}}function koe(u,p){if(p.memoizedState===null&&(u=p.alternate,u!==null&&(u=u.memoizedState,u!==null&&(u=u.dehydrated,u!==null))))try{eS(u)}catch(g){Yr(p,p.return,g)}}function oNe(u){switch(u.tag){case 31:case 13:case 19:var p=u.stateNode;return p===null&&(p=u.stateNode=new Poe),p;case 22:return u=u.stateNode,p=u._retryCache,p===null&&(p=u._retryCache=new Poe),p;default:throw Error(r(435,u.tag))}}function TI(u,p){var g=oNe(u);p.forEach(function(b){if(!g.has(b)){g.add(b);var T=gNe.bind(null,u,b);b.then(T,T)}})}function tc(u,p){var g=p.deletions;if(g!==null)for(var b=0;b<g.length;b++){var T=g[b],C=u,I=p,V=I;e:for(;V!==null;){switch(V.tag){case 27:if(s0(V.type)){Xs=V.stateNode,ec=!1;break e}break;case 5:Xs=V.stateNode,ec=!1;break e;case 3:case 4:Xs=V.stateNode.containerInfo,ec=!0;break e}V=V.return}if(Xs===null)throw Error(r(160));Ioe(C,I,T),Xs=null,ec=!1,C=T.alternate,C!==null&&(C.return=null),T.return=null}if(p.subtreeFlags&13886)for(p=p.child;p!==null;)zoe(p,u),p=p.sibling}var ud=null;function zoe(u,p){var g=u.alternate,b=u.flags;switch(u.tag){case 0:case 11:case 14:case 15:tc(p,u),ic(u),b&4&&(Xy(3,u,u.return),oE(3,u),Xy(5,u,u.return));break;case 1:tc(p,u),ic(u),b&512&&(la||g===null||Np(g,g.return)),b&64&&vm&&(u=u.updateQueue,u!==null&&(b=u.callbacks,b!==null&&(g=u.shared.hiddenCallbacks,u.shared.hiddenCallbacks=g===null?b:g.concat(b))));break;case 26:var T=ud;if(tc(p,u),ic(u),b&512&&(la||g===null||Np(g,g.return)),b&4){var C=g!==null?g.memoizedState:null;if(b=u.memoizedState,g===null)if(b===null)if(u.stateNode===null){e:{b=u.type,g=u.memoizedProps,T=T.ownerDocument||T;t:switch(b){case"title":C=T.getElementsByTagName("title")[0],(!C||C[Rp]||C[vi]||C.namespaceURI==="http://www.w3.org/2000/svg"||C.hasAttribute("itemprop"))&&(C=T.createElement(b),T.head.insertBefore(C,T.querySelector("head > title"))),bo(C,b,g),C[vi]=u,Vr(C),b=C;break e;case"link":var I=zle("link","href",T).get(b+(g.href||""));if(I){for(var V=0;V<I.length;V++)if(C=I[V],C.getAttribute("href")===(g.href==null||g.href===""?null:g.href)&&C.getAttribute("rel")===(g.rel==null?null:g.rel)&&C.getAttribute("title")===(g.title==null?null:g.title)&&C.getAttribute("crossorigin")===(g.crossOrigin==null?null:g.crossOrigin)){I.splice(V,1);break t}}C=T.createElement(b),bo(C,b,g),T.head.appendChild(C);break;case"meta":if(I=zle("meta","content",T).get(b+(g.content||""))){for(V=0;V<I.length;V++)if(C=I[V],C.getAttribute("content")===(g.content==null?null:""+g.content)&&C.getAttribute("name")===(g.name==null?null:g.name)&&C.getAttribute("property")===(g.property==null?null:g.property)&&C.getAttribute("http-equiv")===(g.httpEquiv==null?null:g.httpEquiv)&&C.getAttribute("charset")===(g.charSet==null?null:g.charSet)){I.splice(V,1);break t}}C=T.createElement(b),bo(C,b,g),T.head.appendChild(C);break;default:throw Error(r(468,b))}C[vi]=u,Vr(C),b=C}u.stateNode=b}else Fle(T,u.type,u.stateNode);else u.stateNode=kle(T,b,u.memoizedProps);else C!==b?(C===null?g.stateNode!==null&&(g=g.stateNode,g.parentNode.removeChild(g)):C.count--,b===null?Fle(T,u.type,u.stateNode):kle(T,b,u.memoizedProps)):b===null&&u.stateNode!==null&&Aj(u,u.memoizedProps,g.memoizedProps)}break;case 27:tc(p,u),ic(u),b&512&&(la||g===null||Np(g,g.return)),g!==null&&b&4&&Aj(u,u.memoizedProps,g.memoizedProps);break;case 5:if(tc(p,u),ic(u),b&512&&(la||g===null||Np(g,g.return)),u.flags&32){T=u.stateNode;try{S2(T,"")}catch(xt){Yr(u,u.return,xt)}}b&4&&u.stateNode!=null&&(T=u.memoizedProps,Aj(u,T,g!==null?g.memoizedProps:T)),b&1024&&(Rj=!0);break;case 6:if(tc(p,u),ic(u),b&4){if(u.stateNode===null)throw Error(r(162));b=u.memoizedProps,g=u.stateNode;try{g.nodeValue=b}catch(xt){Yr(u,u.return,xt)}}break;case 3:if(VI=null,T=ud,ud=FI(p.containerInfo),tc(p,u),ud=T,ic(u),b&4&&g!==null&&g.memoizedState.isDehydrated)try{eS(p.containerInfo)}catch(xt){Yr(u,u.return,xt)}Rj&&(Rj=!1,Foe(u));break;case 4:b=ud,ud=FI(u.stateNode.containerInfo),tc(p,u),ic(u),ud=b;break;case 12:tc(p,u),ic(u);break;case 31:tc(p,u),ic(u),b&4&&(b=u.updateQueue,b!==null&&(u.updateQueue=null,TI(u,b)));break;case 13:tc(p,u),ic(u),u.child.flags&8192&&u.memoizedState!==null!=(g!==null&&g.memoizedState!==null)&&(CI=rt()),b&4&&(b=u.updateQueue,b!==null&&(u.updateQueue=null,TI(u,b)));break;case 22:T=u.memoizedState!==null;var J=g!==null&&g.memoizedState!==null,me=vm,$e=la;if(vm=me||T,la=$e||J,tc(p,u),la=$e,vm=me,ic(u),b&8192)e:for(p=u.stateNode,p._visibility=T?p._visibility&-2:p._visibility|1,T&&(g===null||J||vm||la||y1(u)),g=null,p=u;;){if(p.tag===5||p.tag===26){if(g===null){J=g=p;try{if(C=J.stateNode,T)I=C.style,typeof I.setProperty=="function"?I.setProperty("display","none","important"):I.display="none";else{V=J.stateNode;var Pe=J.memoizedProps.style,ge=Pe!=null&&Pe.hasOwnProperty("display")?Pe.display:null;V.style.display=ge==null||typeof ge=="boolean"?"":(""+ge).trim()}}catch(xt){Yr(J,J.return,xt)}}}else if(p.tag===6){if(g===null){J=p;try{J.stateNode.nodeValue=T?"":J.memoizedProps}catch(xt){Yr(J,J.return,xt)}}}else if(p.tag===18){if(g===null){J=p;try{var we=J.stateNode;T?Mle(we,!0):Mle(J.stateNode,!1)}catch(xt){Yr(J,J.return,xt)}}}else if((p.tag!==22&&p.tag!==23||p.memoizedState===null||p===u)&&p.child!==null){p.child.return=p,p=p.child;continue}if(p===u)break e;for(;p.sibling===null;){if(p.return===null||p.return===u)break e;g===p&&(g=null),p=p.return}g===p&&(g=null),p.sibling.return=p.return,p=p.sibling}b&4&&(b=u.updateQueue,b!==null&&(g=b.retryQueue,g!==null&&(b.retryQueue=null,TI(u,g))));break;case 19:tc(p,u),ic(u),b&4&&(b=u.updateQueue,b!==null&&(u.updateQueue=null,TI(u,b)));break;case 30:break;case 21:break;default:tc(p,u),ic(u)}}function ic(u){var p=u.flags;if(p&2){try{for(var g,b=u.return;b!==null;){if(Aoe(b)){g=b;break}b=b.return}if(g==null)throw Error(r(160));switch(g.tag){case 27:var T=g.stateNode,C=Oj(u);SI(u,C,T);break;case 5:var I=g.stateNode;g.flags&32&&(S2(I,""),g.flags&=-33);var V=Oj(u);SI(u,V,I);break;case 3:case 4:var J=g.stateNode.containerInfo,me=Oj(u);Pj(u,me,J);break;default:throw Error(r(161))}}catch($e){Yr(u,u.return,$e)}u.flags&=-3}p&4096&&(u.flags&=-4097)}function Foe(u){if(u.subtreeFlags&1024)for(u=u.child;u!==null;){var p=u;Foe(p),p.tag===5&&p.flags&1024&&p.stateNode.reset(),u=u.sibling}}function wm(u,p){if(p.subtreeFlags&8772)for(p=p.child;p!==null;)Roe(u,p.alternate,p),p=p.sibling}function y1(u){for(u=u.child;u!==null;){var p=u;switch(p.tag){case 0:case 11:case 14:case 15:Xy(4,p,p.return),y1(p);break;case 1:Np(p,p.return);var g=p.stateNode;typeof g.componentWillUnmount=="function"&&Moe(p,p.return,g),y1(p);break;case 27:yE(p.stateNode);case 26:case 5:Np(p,p.return),y1(p);break;case 22:p.memoizedState===null&&y1(p);break;case 30:y1(p);break;default:y1(p)}u=u.sibling}}function xm(u,p,g){for(g=g&&(p.subtreeFlags&8772)!==0,p=p.child;p!==null;){var b=p.alternate,T=u,C=p,I=C.flags;switch(C.tag){case 0:case 11:case 15:xm(T,C,g),oE(4,C);break;case 1:if(xm(T,C,g),b=C,T=b.stateNode,typeof T.componentDidMount=="function")try{T.componentDidMount()}catch(me){Yr(b,b.return,me)}if(b=C,T=b.updateQueue,T!==null){var V=b.stateNode;try{var J=T.shared.hiddenCallbacks;if(J!==null)for(T.shared.hiddenCallbacks=null,T=0;T<J.length;T++)mae(J[T],V)}catch(me){Yr(b,b.return,me)}}g&&I&64&&Coe(C),lE(C,C.return);break;case 27:Ooe(C);case 26:case 5:xm(T,C,g),g&&b===null&&I&4&&Eoe(C),lE(C,C.return);break;case 12:xm(T,C,g);break;case 31:xm(T,C,g),g&&I&4&&Loe(T,C);break;case 13:xm(T,C,g),g&&I&4&&koe(T,C);break;case 22:C.memoizedState===null&&xm(T,C,g),lE(C,C.return);break;case 30:break;default:xm(T,C,g)}p=p.sibling}}function Dj(u,p){var g=null;u!==null&&u.memoizedState!==null&&u.memoizedState.cachePool!==null&&(g=u.memoizedState.cachePool.pool),u=null,p.memoizedState!==null&&p.memoizedState.cachePool!==null&&(u=p.memoizedState.cachePool.pool),u!==g&&(u!=null&&u.refCount++,g!=null&&ZM(g))}function Ij(u,p){u=null,p.alternate!==null&&(u=p.alternate.memoizedState.cache),p=p.memoizedState.cache,p!==u&&(p.refCount++,u!=null&&ZM(u))}function hd(u,p,g,b){if(p.subtreeFlags&10256)for(p=p.child;p!==null;)Noe(u,p,g,b),p=p.sibling}function Noe(u,p,g,b){var T=p.flags;switch(p.tag){case 0:case 11:case 15:hd(u,p,g,b),T&2048&&oE(9,p);break;case 1:hd(u,p,g,b);break;case 3:hd(u,p,g,b),T&2048&&(u=null,p.alternate!==null&&(u=p.alternate.memoizedState.cache),p=p.memoizedState.cache,p!==u&&(p.refCount++,u!=null&&ZM(u)));break;case 12:if(T&2048){hd(u,p,g,b),u=p.stateNode;try{var C=p.memoizedProps,I=C.id,V=C.onPostCommit;typeof V=="function"&&V(I,p.alternate===null?"mount":"update",u.passiveEffectDuration,-0)}catch(J){Yr(p,p.return,J)}}else hd(u,p,g,b);break;case 31:hd(u,p,g,b);break;case 13:hd(u,p,g,b);break;case 23:break;case 22:C=p.stateNode,I=p.alternate,p.memoizedState!==null?C._visibility&2?hd(u,p,g,b):cE(u,p):C._visibility&2?hd(u,p,g,b):(C._visibility|=2,j2(u,p,g,b,(p.subtreeFlags&10256)!==0||!1)),T&2048&&Dj(I,p);break;case 24:hd(u,p,g,b),T&2048&&Ij(p.alternate,p);break;default:hd(u,p,g,b)}}function j2(u,p,g,b,T){for(T=T&&((p.subtreeFlags&10256)!==0||!1),p=p.child;p!==null;){var C=u,I=p,V=g,J=b,me=I.flags;switch(I.tag){case 0:case 11:case 15:j2(C,I,V,J,T),oE(8,I);break;case 23:break;case 22:var $e=I.stateNode;I.memoizedState!==null?$e._visibility&2?j2(C,I,V,J,T):cE(C,I):($e._visibility|=2,j2(C,I,V,J,T)),T&&me&2048&&Dj(I.alternate,I);break;case 24:j2(C,I,V,J,T),T&&me&2048&&Ij(I.alternate,I);break;default:j2(C,I,V,J,T)}p=p.sibling}}function cE(u,p){if(p.subtreeFlags&10256)for(p=p.child;p!==null;){var g=u,b=p,T=b.flags;switch(b.tag){case 22:cE(g,b),T&2048&&Dj(b.alternate,b);break;case 24:cE(g,b),T&2048&&Ij(b.alternate,b);break;default:cE(g,b)}p=p.sibling}}var uE=8192;function q2(u,p,g){if(u.subtreeFlags&uE)for(u=u.child;u!==null;)Voe(u,p,g),u=u.sibling}function Voe(u,p,g){switch(u.tag){case 26:q2(u,p,g),u.flags&uE&&u.memoizedState!==null&&WNe(g,ud,u.memoizedState,u.memoizedProps);break;case 5:q2(u,p,g);break;case 3:case 4:var b=ud;ud=FI(u.stateNode.containerInfo),q2(u,p,g),ud=b;break;case 22:u.memoizedState===null&&(b=u.alternate,b!==null&&b.memoizedState!==null?(b=uE,uE=16777216,q2(u,p,g),uE=b):q2(u,p,g));break;default:q2(u,p,g)}}function Uoe(u){var p=u.alternate;if(p!==null&&(u=p.child,u!==null)){p.child=null;do p=u.sibling,u.sibling=null,u=p;while(u!==null)}}function hE(u){var p=u.deletions;if((u.flags&16)!==0){if(p!==null)for(var g=0;g<p.length;g++){var b=p[g];Wa=b,joe(b,u)}Uoe(u)}if(u.subtreeFlags&10256)for(u=u.child;u!==null;)Boe(u),u=u.sibling}function Boe(u){switch(u.tag){case 0:case 11:case 15:hE(u),u.flags&2048&&Xy(9,u,u.return);break;case 3:hE(u);break;case 12:hE(u);break;case 22:var p=u.stateNode;u.memoizedState!==null&&p._visibility&2&&(u.return===null||u.return.tag!==13)?(p._visibility&=-3,$I(u)):hE(u);break;default:hE(u)}}function $I(u){var p=u.deletions;if((u.flags&16)!==0){if(p!==null)for(var g=0;g<p.length;g++){var b=p[g];Wa=b,joe(b,u)}Uoe(u)}for(u=u.child;u!==null;){switch(p=u,p.tag){case 0:case 11:case 15:Xy(8,p,p.return),$I(p);break;case 22:g=p.stateNode,g._visibility&2&&(g._visibility&=-3,$I(p));break;default:$I(p)}u=u.sibling}}function joe(u,p){for(;Wa!==null;){var g=Wa;switch(g.tag){case 0:case 11:case 15:Xy(8,g,p);break;case 23:case 22:if(g.memoizedState!==null&&g.memoizedState.cachePool!==null){var b=g.memoizedState.cachePool.pool;b!=null&&b.refCount++}break;case 24:ZM(g.memoizedState.cache)}if(b=g.child,b!==null)b.return=g,Wa=b;else e:for(g=u;Wa!==null;){b=Wa;var T=b.sibling,C=b.return;if(Doe(b),b===g){Wa=null;break e}if(T!==null){T.return=C,Wa=T;break e}Wa=C}}}var lNe={getCacheForType:function(u){var p=_o(na),g=p.data.get(u);return g===void 0&&(g=u(),p.data.set(u,g)),g},cacheSignal:function(){return _o(na).controller.signal}},cNe=typeof WeakMap=="function"?WeakMap:Map,Lr=0,_s=null,Yi=null,tr=0,Zr=0,Yc=null,Jy=!1,G2=!1,Lj=!1,Sm=0,gn=0,Ky=0,_1=0,kj=0,Qc=0,H2=0,dE=null,rc=null,zj=!1,CI=0,qoe=0,MI=1/0,EI=null,e0=null,Da=0,t0=null,W2=null,Tm=0,Fj=0,Nj=null,Goe=null,pE=0,Vj=null;function Xc(){return(Lr&2)!==0&&tr!==0?tr&-tr:H.T!==null?Hj():er()}function Hoe(){if(Qc===0)if((tr&536870912)===0||dr){var u=Er;Er<<=1,(Er&3932160)===0&&(Er=262144),Qc=u}else Qc=536870912;return u=Wc.current,u!==null&&(u.flags|=32),Qc}function sc(u,p,g){(u===_s&&(Zr===2||Zr===9)||u.cancelPendingCommit!==null)&&(Z2(u,0),i0(u,tr,Qc,!1)),Jt(u,g),((Lr&2)===0||u!==_s)&&(u===_s&&((Lr&2)===0&&(_1|=g),gn===4&&i0(u,tr,Qc,!1)),Vp(u))}function Woe(u,p,g){if((Lr&6)!==0)throw Error(r(327));var b=!g&&(p&127)===0&&(p&u.expiredLanes)===0||ln(u,p),T=b?dNe(u,p):Bj(u,p,!0),C=b;do{if(T===0){G2&&!b&&i0(u,p,0,!1);break}else{if(g=u.current.alternate,C&&!uNe(g)){T=Bj(u,p,!1),C=!1;continue}if(T===2){if(C=p,u.errorRecoveryDisabledLanes&C)var I=0;else I=u.pendingLanes&-536870913,I=I!==0?I:I&536870912?536870912:0;if(I!==0){p=I;e:{var V=u;T=dE;var J=V.current.memoizedState.isDehydrated;if(J&&(Z2(V,I).flags|=256),I=Bj(V,I,!1),I!==2){if(Lj&&!J){V.errorRecoveryDisabledLanes|=C,_1|=C,T=4;break e}C=rc,rc=T,C!==null&&(rc===null?rc=C:rc.push.apply(rc,C))}T=I}if(C=!1,T!==2)continue}}if(T===1){Z2(u,0),i0(u,p,0,!0);break}e:{switch(b=u,C=T,C){case 0:case 1:throw Error(r(345));case 4:if((p&4194048)!==p)break;case 6:i0(b,p,Qc,!Jy);break e;case 2:rc=null;break;case 3:case 5:break;default:throw Error(r(329))}if((p&62914560)===p&&(T=CI+300-rt(),10<T)){if(i0(b,p,Qc,!Jy),ia(b,0,!0)!==0)break e;Tm=p,b.timeoutHandle=Tle(Zoe.bind(null,b,g,rc,EI,zj,p,Qc,_1,H2,Jy,C,"Throttled",-0,0),T);break e}Zoe(b,g,rc,EI,zj,p,Qc,_1,H2,Jy,C,null,-0,0)}}break}while(!0);Vp(u)}function Zoe(u,p,g,b,T,C,I,V,J,me,$e,Pe,ge,we){if(u.timeoutHandle=-1,Pe=p.subtreeFlags,Pe&8192||(Pe&16785408)===16785408){Pe={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:cm},Voe(p,C,Pe);var xt=(C&62914560)===C?CI-rt():(C&4194048)===C?qoe-rt():0;if(xt=ZNe(Pe,xt),xt!==null){Tm=C,u.cancelPendingCommit=xt(ile.bind(null,u,p,C,g,b,T,I,V,J,$e,Pe,null,ge,we)),i0(u,C,I,!me);return}}ile(u,p,C,g,b,T,I,V,J)}function uNe(u){for(var p=u;;){var g=p.tag;if((g===0||g===11||g===15)&&p.flags&16384&&(g=p.updateQueue,g!==null&&(g=g.stores,g!==null)))for(var b=0;b<g.length;b++){var T=g[b],C=T.getSnapshot;T=T.value;try{if(!Gc(C(),T))return!1}catch{return!1}}if(g=p.child,p.subtreeFlags&16384&&g!==null)g.return=p,p=g;else{if(p===u)break;for(;p.sibling===null;){if(p.return===null||p.return===u)return!0;p=p.return}p.sibling.return=p.return,p=p.sibling}}return!0}function i0(u,p,g,b){p&=~kj,p&=~_1,u.suspendedLanes|=p,u.pingedLanes&=~p,b&&(u.warmLanes|=p),b=u.expirationTimes;for(var T=p;0<T;){var C=31-Vt(T),I=1<<C;b[C]=-1,T&=~I}g!==0&&Hi(u,g,p)}function AI(){return(Lr&6)===0?(fE(0),!1):!0}function Uj(){if(Yi!==null){if(Zr===0)var u=Yi.return;else u=Yi,pm=c1=null,rj(u),F2=null,QM=0,u=Yi;for(;u!==null;)$oe(u.alternate,u),u=u.return;Yi=null}}function Z2(u,p){var g=u.timeoutHandle;g!==-1&&(u.timeoutHandle=-1,ONe(g)),g=u.cancelPendingCommit,g!==null&&(u.cancelPendingCommit=null,g()),Tm=0,Uj(),_s=u,Yi=g=hm(u.current,null),tr=p,Zr=0,Yc=null,Jy=!1,G2=ln(u,p),Lj=!1,H2=Qc=kj=_1=Ky=gn=0,rc=dE=null,zj=!1,(p&8)!==0&&(p|=p&32);var b=u.entangledLanes;if(b!==0)for(u=u.entanglements,b&=p;0<b;){var T=31-Vt(b),C=1<<T;p|=u[T],b&=~C}return Sm=p,Q4(),g}function Yoe(u,p){bi=null,H.H=sE,p===z2||p===sI?(p=hae(),Zr=3):p===GB?(p=hae(),Zr=4):Zr=p===vj?8:p!==null&&typeof p=="object"&&typeof p.then=="function"?6:1,Yc=p,Yi===null&&(gn=1,_I(u,Wu(p,u.current)))}function Qoe(){var u=Wc.current;return u===null?!0:(tr&4194048)===tr?Xu===null:(tr&62914560)===tr||(tr&536870912)!==0?u===Xu:!1}function Xoe(){var u=H.H;return H.H=sE,u===null?sE:u}function Joe(){var u=H.A;return H.A=lNe,u}function OI(){gn=4,Jy||(tr&4194048)!==tr&&Wc.current!==null||(G2=!0),(Ky&134217727)===0&&(_1&134217727)===0||_s===null||i0(_s,tr,Qc,!1)}function Bj(u,p,g){var b=Lr;Lr|=2;var T=Xoe(),C=Joe();(_s!==u||tr!==p)&&(EI=null,Z2(u,p)),p=!1;var I=gn;e:do try{if(Zr!==0&&Yi!==null){var V=Yi,J=Yc;switch(Zr){case 8:Uj(),I=6;break e;case 3:case 2:case 9:case 6:Wc.current===null&&(p=!0);var me=Zr;if(Zr=0,Yc=null,Y2(u,V,J,me),g&&G2){I=0;break e}break;default:me=Zr,Zr=0,Yc=null,Y2(u,V,J,me)}}hNe(),I=gn;break}catch($e){Yoe(u,$e)}while(!0);return p&&u.shellSuspendCounter++,pm=c1=null,Lr=b,H.H=T,H.A=C,Yi===null&&(_s=null,tr=0,Q4()),I}function hNe(){for(;Yi!==null;)Koe(Yi)}function dNe(u,p){var g=Lr;Lr|=2;var b=Xoe(),T=Joe();_s!==u||tr!==p?(EI=null,MI=rt()+500,Z2(u,p)):G2=ln(u,p);e:do try{if(Zr!==0&&Yi!==null){p=Yi;var C=Yc;t:switch(Zr){case 1:Zr=0,Yc=null,Y2(u,p,C,1);break;case 2:case 9:if(cae(C)){Zr=0,Yc=null,ele(p);break}p=function(){Zr!==2&&Zr!==9||_s!==u||(Zr=7),Vp(u)},C.then(p,p);break e;case 3:Zr=7;break e;case 4:Zr=5;break e;case 7:cae(C)?(Zr=0,Yc=null,ele(p)):(Zr=0,Yc=null,Y2(u,p,C,7));break;case 5:var I=null;switch(Yi.tag){case 26:I=Yi.memoizedState;case 5:case 27:var V=Yi;if(I?Nle(I):V.stateNode.complete){Zr=0,Yc=null;var J=V.sibling;if(J!==null)Yi=J;else{var me=V.return;me!==null?(Yi=me,PI(me)):Yi=null}break t}}Zr=0,Yc=null,Y2(u,p,C,5);break;case 6:Zr=0,Yc=null,Y2(u,p,C,6);break;case 8:Uj(),gn=6;break e;default:throw Error(r(462))}}pNe();break}catch($e){Yoe(u,$e)}while(!0);return pm=c1=null,H.H=b,H.A=T,Lr=g,Yi!==null?0:(_s=null,tr=0,Q4(),gn)}function pNe(){for(;Yi!==null&&!We();)Koe(Yi)}function Koe(u){var p=Soe(u.alternate,u,Sm);u.memoizedProps=u.pendingProps,p===null?PI(u):Yi=p}function ele(u){var p=u,g=p.alternate;switch(p.tag){case 15:case 0:p=yoe(g,p,p.pendingProps,p.type,void 0,tr);break;case 11:p=yoe(g,p,p.pendingProps,p.type.render,p.ref,tr);break;case 5:rj(p);default:$oe(g,p),p=Yi=Jne(p,Sm),p=Soe(g,p,Sm)}u.memoizedProps=u.pendingProps,p===null?PI(u):Yi=p}function Y2(u,p,g,b){pm=c1=null,rj(p),F2=null,QM=0;var T=p.return;try{if(tNe(u,T,p,g,tr)){gn=1,_I(u,Wu(g,u.current)),Yi=null;return}}catch(C){if(T!==null)throw Yi=T,C;gn=1,_I(u,Wu(g,u.current)),Yi=null;return}p.flags&32768?(dr||b===1?u=!0:G2||(tr&536870912)!==0?u=!1:(Jy=u=!0,(b===2||b===9||b===3||b===6)&&(b=Wc.current,b!==null&&b.tag===13&&(b.flags|=16384))),tle(p,u)):PI(p)}function PI(u){var p=u;do{if((p.flags&32768)!==0){tle(p,Jy);return}u=p.return;var g=sNe(p.alternate,p,Sm);if(g!==null){Yi=g;return}if(p=p.sibling,p!==null){Yi=p;return}Yi=p=u}while(p!==null);gn===0&&(gn=5)}function tle(u,p){do{var g=nNe(u.alternate,u);if(g!==null){g.flags&=32767,Yi=g;return}if(g=u.return,g!==null&&(g.flags|=32768,g.subtreeFlags=0,g.deletions=null),!p&&(u=u.sibling,u!==null)){Yi=u;return}Yi=u=g}while(u!==null);gn=6,Yi=null}function ile(u,p,g,b,T,C,I,V,J){u.cancelPendingCommit=null;do RI();while(Da!==0);if((Lr&6)!==0)throw Error(r(327));if(p!==null){if(p===u.current)throw Error(r(177));if(C=p.lanes|p.childLanes,C|=OB,Nr(u,g,C,I,V,J),u===_s&&(Yi=_s=null,tr=0),W2=p,t0=u,Tm=g,Fj=C,Nj=T,Goe=b,(p.subtreeFlags&10256)!==0||(p.flags&10256)!==0?(u.callbackNode=null,u.callbackPriority=0,yNe(ei,function(){return ole(),null})):(u.callbackNode=null,u.callbackPriority=0),b=(p.flags&13878)!==0,(p.subtreeFlags&13878)!==0||b){b=H.T,H.T=null,T=Q.p,Q.p=2,I=Lr,Lr|=4;try{aNe(u,p,g)}finally{Lr=I,Q.p=T,H.T=b}}Da=1,rle(),sle(),nle()}}function rle(){if(Da===1){Da=0;var u=t0,p=W2,g=(p.flags&13878)!==0;if((p.subtreeFlags&13878)!==0||g){g=H.T,H.T=null;var b=Q.p;Q.p=2;var T=Lr;Lr|=4;try{zoe(p,u);var C=e9,I=jne(u.containerInfo),V=C.focusedElem,J=C.selectionRange;if(I!==V&&V&&V.ownerDocument&&Bne(V.ownerDocument.documentElement,V)){if(J!==null&&$B(V)){var me=J.start,$e=J.end;if($e===void 0&&($e=me),"selectionStart"in V)V.selectionStart=me,V.selectionEnd=Math.min($e,V.value.length);else{var Pe=V.ownerDocument||document,ge=Pe&&Pe.defaultView||window;if(ge.getSelection){var we=ge.getSelection(),xt=V.textContent.length,Qt=Math.min(J.start,xt),ns=J.end===void 0?Qt:Math.min(J.end,xt);!we.extend&&Qt>ns&&(I=ns,ns=Qt,Qt=I);var ae=Une(V,Qt),se=Une(V,ns);if(ae&&se&&(we.rangeCount!==1||we.anchorNode!==ae.node||we.anchorOffset!==ae.offset||we.focusNode!==se.node||we.focusOffset!==se.offset)){var pe=Pe.createRange();pe.setStart(ae.node,ae.offset),we.removeAllRanges(),Qt>ns?(we.addRange(pe),we.extend(se.node,se.offset)):(pe.setEnd(se.node,se.offset),we.addRange(pe))}}}}for(Pe=[],we=V;we=we.parentNode;)we.nodeType===1&&Pe.push({element:we,left:we.scrollLeft,top:we.scrollTop});for(typeof V.focus=="function"&&V.focus(),V=0;V<Pe.length;V++){var Ae=Pe[V];Ae.element.scrollLeft=Ae.left,Ae.element.scrollTop=Ae.top}}qI=!!Kj,e9=Kj=null}finally{Lr=T,Q.p=b,H.T=g}}u.current=p,Da=2}}function sle(){if(Da===2){Da=0;var u=t0,p=W2,g=(p.flags&8772)!==0;if((p.subtreeFlags&8772)!==0||g){g=H.T,H.T=null;var b=Q.p;Q.p=2;var T=Lr;Lr|=4;try{Roe(u,p.alternate,p)}finally{Lr=T,Q.p=b,H.T=g}}Da=3}}function nle(){if(Da===4||Da===3){Da=0,Ye();var u=t0,p=W2,g=Tm,b=Goe;(p.subtreeFlags&10256)!==0||(p.flags&10256)!==0?Da=5:(Da=0,W2=t0=null,ale(u,u.pendingLanes));var T=u.pendingLanes;if(T===0&&(e0=null),mo(g),p=p.stateNode,wt&&typeof wt.onCommitFiberRoot=="function")try{wt.onCommitFiberRoot(ti,p,void 0,(p.current.flags&128)===128)}catch{}if(b!==null){p=H.T,T=Q.p,Q.p=2,H.T=null;try{for(var C=u.onRecoverableError,I=0;I<b.length;I++){var V=b[I];C(V.value,{componentStack:V.stack})}}finally{H.T=p,Q.p=T}}(Tm&3)!==0&&RI(),Vp(u),T=u.pendingLanes,(g&261930)!==0&&(T&42)!==0?u===Vj?pE++:(pE=0,Vj=u):pE=0,fE(0)}}function ale(u,p){(u.pooledCacheLanes&=p)===0&&(p=u.pooledCache,p!=null&&(u.pooledCache=null,ZM(p)))}function RI(){return rle(),sle(),nle(),ole()}function ole(){if(Da!==5)return!1;var u=t0,p=Fj;Fj=0;var g=mo(Tm),b=H.T,T=Q.p;try{Q.p=32>g?32:g,H.T=null,g=Nj,Nj=null;var C=t0,I=Tm;if(Da=0,W2=t0=null,Tm=0,(Lr&6)!==0)throw Error(r(331));var V=Lr;if(Lr|=4,Boe(C.current),Noe(C,C.current,I,g),Lr=V,fE(0,!1),wt&&typeof wt.onPostCommitFiberRoot=="function")try{wt.onPostCommitFiberRoot(ti,C)}catch{}return!0}finally{Q.p=T,H.T=b,ale(u,p)}}function lle(u,p,g){p=Wu(g,p),p=_j(u.stateNode,p,2),u=Zy(u,p,2),u!==null&&(Jt(u,2),Vp(u))}function Yr(u,p,g){if(u.tag===3)lle(u,u,g);else for(;p!==null;){if(p.tag===3){lle(p,u,g);break}else if(p.tag===1){var b=p.stateNode;if(typeof p.type.getDerivedStateFromError=="function"||typeof b.componentDidCatch=="function"&&(e0===null||!e0.has(b))){u=Wu(g,u),g=coe(2),b=Zy(p,g,2),b!==null&&(uoe(g,b,p,u),Jt(b,2),Vp(b));break}}p=p.return}}function jj(u,p,g){var b=u.pingCache;if(b===null){b=u.pingCache=new cNe;var T=new Set;b.set(p,T)}else T=b.get(p),T===void 0&&(T=new Set,b.set(p,T));T.has(g)||(Lj=!0,T.add(g),u=fNe.bind(null,u,p,g),p.then(u,u))}function fNe(u,p,g){var b=u.pingCache;b!==null&&b.delete(p),u.pingedLanes|=u.suspendedLanes&g,u.warmLanes&=~g,_s===u&&(tr&g)===g&&(gn===4||gn===3&&(tr&62914560)===tr&&300>rt()-CI?(Lr&2)===0&&Z2(u,0):kj|=g,H2===tr&&(H2=0)),Vp(u)}function cle(u,p){p===0&&(p=ue()),u=a1(u,p),u!==null&&(Jt(u,p),Vp(u))}function mNe(u){var p=u.memoizedState,g=0;p!==null&&(g=p.retryLane),cle(u,g)}function gNe(u,p){var g=0;switch(u.tag){case 31:case 13:var b=u.stateNode,T=u.memoizedState;T!==null&&(g=T.retryLane);break;case 19:b=u.stateNode;break;case 22:b=u.stateNode._retryCache;break;default:throw Error(r(314))}b!==null&&b.delete(p),cle(u,g)}function yNe(u,p){return Ot(u,p)}var DI=null,Q2=null,qj=!1,II=!1,Gj=!1,r0=0;function Vp(u){u!==Q2&&u.next===null&&(Q2===null?DI=Q2=u:Q2=Q2.next=u),II=!0,qj||(qj=!0,vNe())}function fE(u,p){if(!Gj&&II){Gj=!0;do for(var g=!1,b=DI;b!==null;){if(u!==0){var T=b.pendingLanes;if(T===0)var C=0;else{var I=b.suspendedLanes,V=b.pingedLanes;C=(1<<31-Vt(42|u)+1)-1,C&=T&~(I&~V),C=C&201326741?C&201326741|1:C?C|2:0}C!==0&&(g=!0,ple(b,C))}else C=tr,C=ia(b,b===_s?C:0,b.cancelPendingCommit!==null||b.timeoutHandle!==-1),(C&3)===0||ln(b,C)||(g=!0,ple(b,C));b=b.next}while(g);Gj=!1}}function _Ne(){ule()}function ule(){II=qj=!1;var u=0;r0!==0&&ANe()&&(u=r0);for(var p=rt(),g=null,b=DI;b!==null;){var T=b.next,C=hle(b,p);C===0?(b.next=null,g===null?DI=T:g.next=T,T===null&&(Q2=g)):(g=b,(u!==0||(C&3)!==0)&&(II=!0)),b=T}Da!==0&&Da!==5||fE(u),r0!==0&&(r0=0)}function hle(u,p){for(var g=u.suspendedLanes,b=u.pingedLanes,T=u.expirationTimes,C=u.pendingLanes&-62914561;0<C;){var I=31-Vt(C),V=1<<I,J=T[I];J===-1?((V&g)===0||(V&b)!==0)&&(T[I]=fo(V,p)):J<=p&&(u.expiredLanes|=V),C&=~V}if(p=_s,g=tr,g=ia(u,u===p?g:0,u.cancelPendingCommit!==null||u.timeoutHandle!==-1),b=u.callbackNode,g===0||u===p&&(Zr===2||Zr===9)||u.cancelPendingCommit!==null)return b!==null&&b!==null&&Xe(b),u.callbackNode=null,u.callbackPriority=0;if((g&3)===0||ln(u,g)){if(p=g&-g,p===u.callbackPriority)return p;switch(b!==null&&Xe(b),mo(g)){case 2:case 8:g=Ci;break;case 32:g=ei;break;case 268435456:g=Ui;break;default:g=ei}return b=dle.bind(null,u),g=Ot(g,b),u.callbackPriority=p,u.callbackNode=g,p}return b!==null&&b!==null&&Xe(b),u.callbackPriority=2,u.callbackNode=null,2}function dle(u,p){if(Da!==0&&Da!==5)return u.callbackNode=null,u.callbackPriority=0,null;var g=u.callbackNode;if(RI()&&u.callbackNode!==g)return null;var b=tr;return b=ia(u,u===_s?b:0,u.cancelPendingCommit!==null||u.timeoutHandle!==-1),b===0?null:(Woe(u,b,p),hle(u,rt()),u.callbackNode!=null&&u.callbackNode===g?dle.bind(null,u):null)}function ple(u,p){if(RI())return null;Woe(u,p,!0)}function vNe(){PNe(function(){(Lr&6)!==0?Ot(Li,_Ne):ule()})}function Hj(){if(r0===0){var u=L2;u===0&&(u=Ei,Ei<<=1,(Ei&261888)===0&&(Ei=256)),r0=u}return r0}function fle(u){return u==null||typeof u=="symbol"||typeof u=="boolean"?null:typeof u=="function"?u:B4(""+u)}function mle(u,p){var g=p.ownerDocument.createElement("input");return g.name=p.name,g.value=p.value,u.id&&g.setAttribute("form",u.id),p.parentNode.insertBefore(g,p),u=new FormData(u),g.parentNode.removeChild(g),u}function bNe(u,p,g,b,T){if(p==="submit"&&g&&g.stateNode===T){var C=fle((T[Pa]||null).action),I=b.submitter;I&&(p=(p=I[Pa]||null)?fle(p.formAction):I.getAttribute("formAction"),p!==null&&(C=p,I=null));var V=new H4("action","action",null,b,T);u.push({event:V,listeners:[{instance:null,listener:function(){if(b.defaultPrevented){if(r0!==0){var J=I?mle(T,I):new FormData(T);dj(g,{pending:!0,data:J,method:T.method,action:C},null,J)}}else typeof C=="function"&&(V.preventDefault(),J=I?mle(T,I):new FormData(T),dj(g,{pending:!0,data:J,method:T.method,action:C},C,J))},currentTarget:T}]})}}for(var Wj=0;Wj<AB.length;Wj++){var Zj=AB[Wj],wNe=Zj.toLowerCase(),xNe=Zj[0].toUpperCase()+Zj.slice(1);cd(wNe,"on"+xNe)}cd(Hne,"onAnimationEnd"),cd(Wne,"onAnimationIteration"),cd(Zne,"onAnimationStart"),cd("dblclick","onDoubleClick"),cd("focusin","onFocus"),cd("focusout","onBlur"),cd(FFe,"onTransitionRun"),cd(NFe,"onTransitionStart"),cd(VFe,"onTransitionCancel"),cd(Yne,"onTransitionEnd"),dl("onMouseEnter",["mouseout","mouseover"]),dl("onMouseLeave",["mouseout","mouseover"]),dl("onPointerEnter",["pointerout","pointerover"]),dl("onPointerLeave",["pointerout","pointerover"]),No("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),No("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),No("onBeforeInput",["compositionend","keypress","textInput","paste"]),No("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),No("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),No("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var mE="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),SNe=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(mE));function gle(u,p){p=(p&4)!==0;for(var g=0;g<u.length;g++){var b=u[g],T=b.event;b=b.listeners;e:{var C=void 0;if(p)for(var I=b.length-1;0<=I;I--){var V=b[I],J=V.instance,me=V.currentTarget;if(V=V.listener,J!==C&&T.isPropagationStopped())break e;C=V,T.currentTarget=me;try{C(T)}catch($e){Y4($e)}T.currentTarget=null,C=J}else for(I=0;I<b.length;I++){if(V=b[I],J=V.instance,me=V.currentTarget,V=V.listener,J!==C&&T.isPropagationStopped())break e;C=V,T.currentTarget=me;try{C(T)}catch($e){Y4($e)}T.currentTarget=null,C=J}}}}function Qi(u,p){var g=p[qt];g===void 0&&(g=p[qt]=new Set);var b=u+"__bubble";g.has(b)||(yle(p,u,2,!1),g.add(b))}function Yj(u,p,g){var b=0;p&&(b|=4),yle(g,u,b,p)}var LI="_reactListening"+Math.random().toString(36).slice(2);function Qj(u){if(!u[LI]){u[LI]=!0,Dn.forEach(function(g){g!=="selectionchange"&&(SNe.has(g)||Yj(g,!1,u),Yj(g,!0,u))});var p=u.nodeType===9?u:u.ownerDocument;p===null||p[LI]||(p[LI]=!0,Yj("selectionchange",!1,p))}}function yle(u,p,g,b){switch(Hle(p)){case 2:var T=XNe;break;case 8:T=JNe;break;default:T=h9}g=T.bind(null,p,g,u),T=void 0,!gB||p!=="touchstart"&&p!=="touchmove"&&p!=="wheel"||(T=!0),b?T!==void 0?u.addEventListener(p,g,{capture:!0,passive:T}):u.addEventListener(p,g,!0):T!==void 0?u.addEventListener(p,g,{passive:T}):u.addEventListener(p,g,!1)}function Xj(u,p,g,b,T){var C=b;if((p&1)===0&&(p&2)===0&&b!==null)e:for(;;){if(b===null)return;var I=b.tag;if(I===3||I===4){var V=b.stateNode.containerInfo;if(V===T)break;if(I===4)for(I=b.return;I!==null;){var J=I.tag;if((J===3||J===4)&&I.stateNode.containerInfo===T)return;I=I.return}for(;V!==null;){if(I=hl(V),I===null)return;if(J=I.tag,J===5||J===6||J===26||J===27){b=C=I;continue e}V=V.parentNode}}b=b.return}xne(function(){var me=C,$e=fB(g),Pe=[];e:{var ge=Qne.get(u);if(ge!==void 0){var we=H4,xt=u;switch(u){case"keypress":if(q4(g)===0)break e;case"keydown":case"keyup":we=gFe;break;case"focusin":xt="focus",we=bB;break;case"focusout":xt="blur",we=bB;break;case"beforeblur":case"afterblur":we=bB;break;case"click":if(g.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":we=$ne;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":we=sFe;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":we=vFe;break;case Hne:case Wne:case Zne:we=oFe;break;case Yne:we=wFe;break;case"scroll":case"scrollend":we=iFe;break;case"wheel":we=SFe;break;case"copy":case"cut":case"paste":we=cFe;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":we=Mne;break;case"toggle":case"beforetoggle":we=$Fe}var Qt=(p&4)!==0,ns=!Qt&&(u==="scroll"||u==="scrollend"),ae=Qt?ge!==null?ge+"Capture":null:ge;Qt=[];for(var se=me,pe;se!==null;){var Ae=se;if(pe=Ae.stateNode,Ae=Ae.tag,Ae!==5&&Ae!==26&&Ae!==27||pe===null||ae===null||(Ae=zM(se,ae),Ae!=null&&Qt.push(gE(se,Ae,pe))),ns)break;se=se.return}0<Qt.length&&(ge=new we(ge,xt,null,g,$e),Pe.push({event:ge,listeners:Qt}))}}if((p&7)===0){e:{if(ge=u==="mouseover"||u==="pointerover",we=u==="mouseout"||u==="pointerout",ge&&g!==pB&&(xt=g.relatedTarget||g.fromElement)&&(hl(xt)||xt[nd]))break e;if((we||ge)&&(ge=$e.window===$e?$e:(ge=$e.ownerDocument)?ge.defaultView||ge.parentWindow:window,we?(xt=g.relatedTarget||g.toElement,we=me,xt=xt?hl(xt):null,xt!==null&&(ns=n(xt),Qt=xt.tag,xt!==ns||Qt!==5&&Qt!==27&&Qt!==6)&&(xt=null)):(we=null,xt=me),we!==xt)){if(Qt=$ne,Ae="onMouseLeave",ae="onMouseEnter",se="mouse",(u==="pointerout"||u==="pointerover")&&(Qt=Mne,Ae="onPointerLeave",ae="onPointerEnter",se="pointer"),ns=we==null?ge:ji(we),pe=xt==null?ge:ji(xt),ge=new Qt(Ae,se+"leave",we,g,$e),ge.target=ns,ge.relatedTarget=pe,Ae=null,hl($e)===me&&(Qt=new Qt(ae,se+"enter",xt,g,$e),Qt.target=pe,Qt.relatedTarget=ns,Ae=Qt),ns=Ae,we&&xt)t:{for(Qt=TNe,ae=we,se=xt,pe=0,Ae=ae;Ae;Ae=Qt(Ae))pe++;Ae=0;for(var Ut=se;Ut;Ut=Qt(Ut))Ae++;for(;0<pe-Ae;)ae=Qt(ae),pe--;for(;0<Ae-pe;)se=Qt(se),Ae--;for(;pe--;){if(ae===se||se!==null&&ae===se.alternate){Qt=ae;break t}ae=Qt(ae),se=Qt(se)}Qt=null}else Qt=null;we!==null&&_le(Pe,ge,we,Qt,!1),xt!==null&&ns!==null&&_le(Pe,ns,xt,Qt,!0)}}e:{if(ge=me?ji(me):window,we=ge.nodeName&&ge.nodeName.toLowerCase(),we==="select"||we==="input"&&ge.type==="file")var Ar=Lne;else if(Dne(ge))if(kne)Ar=LFe;else{Ar=DFe;var Dt=RFe}else we=ge.nodeName,!we||we.toLowerCase()!=="input"||ge.type!=="checkbox"&&ge.type!=="radio"?me&&dB(me.elementType)&&(Ar=Lne):Ar=IFe;if(Ar&&(Ar=Ar(u,me))){Ine(Pe,Ar,g,$e);break e}Dt&&Dt(u,ge,me),u==="focusout"&&me&&ge.type==="number"&&me.memoizedProps.value!=null&&x2(ge,"number",ge.value)}switch(Dt=me?ji(me):window,u){case"focusin":(Dne(Dt)||Dt.contentEditable==="true")&&(M2=Dt,CB=me,GM=null);break;case"focusout":GM=CB=M2=null;break;case"mousedown":MB=!0;break;case"contextmenu":case"mouseup":case"dragend":MB=!1,qne(Pe,g,$e);break;case"selectionchange":if(zFe)break;case"keydown":case"keyup":qne(Pe,g,$e)}var Ai;if(xB)e:{switch(u){case"compositionstart":var ir="onCompositionStart";break e;case"compositionend":ir="onCompositionEnd";break e;case"compositionupdate":ir="onCompositionUpdate";break e}ir=void 0}else C2?Pne(u,g)&&(ir="onCompositionEnd"):u==="keydown"&&g.keyCode===229&&(ir="onCompositionStart");ir&&(Ene&&g.locale!=="ko"&&(C2||ir!=="onCompositionStart"?ir==="onCompositionEnd"&&C2&&(Ai=Sne()):(Uy=$e,yB="value"in Uy?Uy.value:Uy.textContent,C2=!0)),Dt=kI(me,ir),0<Dt.length&&(ir=new Cne(ir,u,null,g,$e),Pe.push({event:ir,listeners:Dt}),Ai?ir.data=Ai:(Ai=Rne(g),Ai!==null&&(ir.data=Ai)))),(Ai=MFe?EFe(u,g):AFe(u,g))&&(ir=kI(me,"onBeforeInput"),0<ir.length&&(Dt=new Cne("onBeforeInput","beforeinput",null,g,$e),Pe.push({event:Dt,listeners:ir}),Dt.data=Ai)),bNe(Pe,u,me,g,$e)}gle(Pe,p)})}function gE(u,p,g){return{instance:u,listener:p,currentTarget:g}}function kI(u,p){for(var g=p+"Capture",b=[];u!==null;){var T=u,C=T.stateNode;if(T=T.tag,T!==5&&T!==26&&T!==27||C===null||(T=zM(u,g),T!=null&&b.unshift(gE(u,T,C)),T=zM(u,p),T!=null&&b.push(gE(u,T,C))),u.tag===3)return b;u=u.return}return[]}function TNe(u){if(u===null)return null;do u=u.return;while(u&&u.tag!==5&&u.tag!==27);return u||null}function _le(u,p,g,b,T){for(var C=p._reactName,I=[];g!==null&&g!==b;){var V=g,J=V.alternate,me=V.stateNode;if(V=V.tag,J!==null&&J===b)break;V!==5&&V!==26&&V!==27||me===null||(J=me,T?(me=zM(g,C),me!=null&&I.unshift(gE(g,me,J))):T||(me=zM(g,C),me!=null&&I.push(gE(g,me,J)))),g=g.return}I.length!==0&&u.push({event:p,listeners:I})}var $Ne=/\r\n?/g,CNe=/\u0000|\uFFFD/g;function vle(u){return(typeof u=="string"?u:""+u).replace($Ne,`
`).replace(CNe,"")}function ble(u,p){return p=vle(p),vle(u)===p}function ss(u,p,g,b,T,C){switch(g){case"children":typeof b=="string"?p==="body"||p==="textarea"&&b===""||S2(u,b):(typeof b=="number"||typeof b=="bigint")&&p!=="body"&&S2(u,""+b);break;case"className":Lp(u,"class",b);break;case"tabIndex":Lp(u,"tabindex",b);break;case"dir":case"role":case"viewBox":case"width":case"height":Lp(u,g,b);break;case"style":bne(u,b,C);break;case"data":if(p!=="object"){Lp(u,"data",b);break}case"src":case"href":if(b===""&&(p!=="a"||g!=="href")){u.removeAttribute(g);break}if(b==null||typeof b=="function"||typeof b=="symbol"||typeof b=="boolean"){u.removeAttribute(g);break}b=B4(""+b),u.setAttribute(g,b);break;case"action":case"formAction":if(typeof b=="function"){u.setAttribute(g,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof C=="function"&&(g==="formAction"?(p!=="input"&&ss(u,p,"name",T.name,T,null),ss(u,p,"formEncType",T.formEncType,T,null),ss(u,p,"formMethod",T.formMethod,T,null),ss(u,p,"formTarget",T.formTarget,T,null)):(ss(u,p,"encType",T.encType,T,null),ss(u,p,"method",T.method,T,null),ss(u,p,"target",T.target,T,null)));if(b==null||typeof b=="symbol"||typeof b=="boolean"){u.removeAttribute(g);break}b=B4(""+b),u.setAttribute(g,b);break;case"onClick":b!=null&&(u.onclick=cm);break;case"onScroll":b!=null&&Qi("scroll",u);break;case"onScrollEnd":b!=null&&Qi("scrollend",u);break;case"dangerouslySetInnerHTML":if(b!=null){if(typeof b!="object"||!("__html"in b))throw Error(r(61));if(g=b.__html,g!=null){if(T.children!=null)throw Error(r(60));u.innerHTML=g}}break;case"multiple":u.multiple=b&&typeof b!="function"&&typeof b!="symbol";break;case"muted":u.muted=b&&typeof b!="function"&&typeof b!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(b==null||typeof b=="function"||typeof b=="boolean"||typeof b=="symbol"){u.removeAttribute("xlink:href");break}g=B4(""+b),u.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",g);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":b!=null&&typeof b!="function"&&typeof b!="symbol"?u.setAttribute(g,""+b):u.removeAttribute(g);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":b&&typeof b!="function"&&typeof b!="symbol"?u.setAttribute(g,""):u.removeAttribute(g);break;case"capture":case"download":b===!0?u.setAttribute(g,""):b!==!1&&b!=null&&typeof b!="function"&&typeof b!="symbol"?u.setAttribute(g,b):u.removeAttribute(g);break;case"cols":case"rows":case"size":case"span":b!=null&&typeof b!="function"&&typeof b!="symbol"&&!isNaN(b)&&1<=b?u.setAttribute(g,b):u.removeAttribute(g);break;case"rowSpan":case"start":b==null||typeof b=="function"||typeof b=="symbol"||isNaN(b)?u.removeAttribute(g):u.setAttribute(g,b);break;case"popover":Qi("beforetoggle",u),Qi("toggle",u),ld(u,"popover",b);break;case"xlinkActuate":W(u,"http://www.w3.org/1999/xlink","xlink:actuate",b);break;case"xlinkArcrole":W(u,"http://www.w3.org/1999/xlink","xlink:arcrole",b);break;case"xlinkRole":W(u,"http://www.w3.org/1999/xlink","xlink:role",b);break;case"xlinkShow":W(u,"http://www.w3.org/1999/xlink","xlink:show",b);break;case"xlinkTitle":W(u,"http://www.w3.org/1999/xlink","xlink:title",b);break;case"xlinkType":W(u,"http://www.w3.org/1999/xlink","xlink:type",b);break;case"xmlBase":W(u,"http://www.w3.org/XML/1998/namespace","xml:base",b);break;case"xmlLang":W(u,"http://www.w3.org/XML/1998/namespace","xml:lang",b);break;case"xmlSpace":W(u,"http://www.w3.org/XML/1998/namespace","xml:space",b);break;case"is":ld(u,"is",b);break;case"innerText":case"textContent":break;default:(!(2<g.length)||g[0]!=="o"&&g[0]!=="O"||g[1]!=="n"&&g[1]!=="N")&&(g=eFe.get(g)||g,ld(u,g,b))}}function Jj(u,p,g,b,T,C){switch(g){case"style":bne(u,b,C);break;case"dangerouslySetInnerHTML":if(b!=null){if(typeof b!="object"||!("__html"in b))throw Error(r(61));if(g=b.__html,g!=null){if(T.children!=null)throw Error(r(60));u.innerHTML=g}}break;case"children":typeof b=="string"?S2(u,b):(typeof b=="number"||typeof b=="bigint")&&S2(u,""+b);break;case"onScroll":b!=null&&Qi("scroll",u);break;case"onScrollEnd":b!=null&&Qi("scrollend",u);break;case"onClick":b!=null&&(u.onclick=cm);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!qc.hasOwnProperty(g))e:{if(g[0]==="o"&&g[1]==="n"&&(T=g.endsWith("Capture"),p=g.slice(2,T?g.length-7:void 0),C=u[Pa]||null,C=C!=null?C[g]:null,typeof C=="function"&&u.removeEventListener(p,C,T),typeof b=="function")){typeof C!="function"&&C!==null&&(g in u?u[g]=null:u.hasAttribute(g)&&u.removeAttribute(g)),u.addEventListener(p,b,T);break e}g in u?u[g]=b:b===!0?u.setAttribute(g,""):ld(u,g,b)}}}function bo(u,p,g){switch(p){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Qi("error",u),Qi("load",u);var b=!1,T=!1,C;for(C in g)if(g.hasOwnProperty(C)){var I=g[C];if(I!=null)switch(C){case"src":b=!0;break;case"srcSet":T=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,p));default:ss(u,p,C,I,g,null)}}T&&ss(u,p,"srcSet",g.srcSet,g,null),b&&ss(u,p,"src",g.src,g,null);return;case"input":Qi("invalid",u);var V=C=I=T=null,J=null,me=null;for(b in g)if(g.hasOwnProperty(b)){var $e=g[b];if($e!=null)switch(b){case"name":T=$e;break;case"type":I=$e;break;case"checked":J=$e;break;case"defaultChecked":me=$e;break;case"value":C=$e;break;case"defaultValue":V=$e;break;case"children":case"dangerouslySetInnerHTML":if($e!=null)throw Error(r(137,p));break;default:ss(u,p,b,$e,g,null)}}kM(u,C,V,J,me,I,T,!1);return;case"select":Qi("invalid",u),b=I=C=null;for(T in g)if(g.hasOwnProperty(T)&&(V=g[T],V!=null))switch(T){case"value":C=V;break;case"defaultValue":I=V;break;case"multiple":b=V;default:ss(u,p,T,V,g,null)}p=C,g=I,u.multiple=!!b,p!=null?kp(u,!!b,p,!1):g!=null&&kp(u,!!b,g,!0);return;case"textarea":Qi("invalid",u),C=T=b=null;for(I in g)if(g.hasOwnProperty(I)&&(V=g[I],V!=null))switch(I){case"value":b=V;break;case"defaultValue":T=V;break;case"children":C=V;break;case"dangerouslySetInnerHTML":if(V!=null)throw Error(r(91));break;default:ss(u,p,I,V,g,null)}_ne(u,b,T,C);return;case"option":for(J in g)g.hasOwnProperty(J)&&(b=g[J],b!=null)&&(J==="selected"?u.selected=b&&typeof b!="function"&&typeof b!="symbol":ss(u,p,J,b,g,null));return;case"dialog":Qi("beforetoggle",u),Qi("toggle",u),Qi("cancel",u),Qi("close",u);break;case"iframe":case"object":Qi("load",u);break;case"video":case"audio":for(b=0;b<mE.length;b++)Qi(mE[b],u);break;case"image":Qi("error",u),Qi("load",u);break;case"details":Qi("toggle",u);break;case"embed":case"source":case"link":Qi("error",u),Qi("load",u);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(me in g)if(g.hasOwnProperty(me)&&(b=g[me],b!=null))switch(me){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,p));default:ss(u,p,me,b,g,null)}return;default:if(dB(p)){for($e in g)g.hasOwnProperty($e)&&(b=g[$e],b!==void 0&&Jj(u,p,$e,b,g,void 0));return}}for(V in g)g.hasOwnProperty(V)&&(b=g[V],b!=null&&ss(u,p,V,b,g,null))}function MNe(u,p,g,b){switch(p){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var T=null,C=null,I=null,V=null,J=null,me=null,$e=null;for(we in g){var Pe=g[we];if(g.hasOwnProperty(we)&&Pe!=null)switch(we){case"checked":break;case"value":break;case"defaultValue":J=Pe;default:b.hasOwnProperty(we)||ss(u,p,we,null,b,Pe)}}for(var ge in b){var we=b[ge];if(Pe=g[ge],b.hasOwnProperty(ge)&&(we!=null||Pe!=null))switch(ge){case"type":C=we;break;case"name":T=we;break;case"checked":me=we;break;case"defaultChecked":$e=we;break;case"value":I=we;break;case"defaultValue":V=we;break;case"children":case"dangerouslySetInnerHTML":if(we!=null)throw Error(r(137,p));break;default:we!==Pe&&ss(u,p,ge,we,b,Pe)}}w2(u,I,V,J,me,$e,C,T);return;case"select":we=I=V=ge=null;for(C in g)if(J=g[C],g.hasOwnProperty(C)&&J!=null)switch(C){case"value":break;case"multiple":we=J;default:b.hasOwnProperty(C)||ss(u,p,C,null,b,J)}for(T in b)if(C=b[T],J=g[T],b.hasOwnProperty(T)&&(C!=null||J!=null))switch(T){case"value":ge=C;break;case"defaultValue":V=C;break;case"multiple":I=C;default:C!==J&&ss(u,p,T,C,b,J)}p=V,g=I,b=we,ge!=null?kp(u,!!g,ge,!1):!!b!=!!g&&(p!=null?kp(u,!!g,p,!0):kp(u,!!g,g?[]:"",!1));return;case"textarea":we=ge=null;for(V in g)if(T=g[V],g.hasOwnProperty(V)&&T!=null&&!b.hasOwnProperty(V))switch(V){case"value":break;case"children":break;default:ss(u,p,V,null,b,T)}for(I in b)if(T=b[I],C=g[I],b.hasOwnProperty(I)&&(T!=null||C!=null))switch(I){case"value":ge=T;break;case"defaultValue":we=T;break;case"children":break;case"dangerouslySetInnerHTML":if(T!=null)throw Error(r(91));break;default:T!==C&&ss(u,p,I,T,b,C)}yne(u,ge,we);return;case"option":for(var xt in g)ge=g[xt],g.hasOwnProperty(xt)&&ge!=null&&!b.hasOwnProperty(xt)&&(xt==="selected"?u.selected=!1:ss(u,p,xt,null,b,ge));for(J in b)ge=b[J],we=g[J],b.hasOwnProperty(J)&&ge!==we&&(ge!=null||we!=null)&&(J==="selected"?u.selected=ge&&typeof ge!="function"&&typeof ge!="symbol":ss(u,p,J,ge,b,we));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Qt in g)ge=g[Qt],g.hasOwnProperty(Qt)&&ge!=null&&!b.hasOwnProperty(Qt)&&ss(u,p,Qt,null,b,ge);for(me in b)if(ge=b[me],we=g[me],b.hasOwnProperty(me)&&ge!==we&&(ge!=null||we!=null))switch(me){case"children":case"dangerouslySetInnerHTML":if(ge!=null)throw Error(r(137,p));break;default:ss(u,p,me,ge,b,we)}return;default:if(dB(p)){for(var ns in g)ge=g[ns],g.hasOwnProperty(ns)&&ge!==void 0&&!b.hasOwnProperty(ns)&&Jj(u,p,ns,void 0,b,ge);for($e in b)ge=b[$e],we=g[$e],!b.hasOwnProperty($e)||ge===we||ge===void 0&&we===void 0||Jj(u,p,$e,ge,b,we);return}}for(var ae in g)ge=g[ae],g.hasOwnProperty(ae)&&ge!=null&&!b.hasOwnProperty(ae)&&ss(u,p,ae,null,b,ge);for(Pe in b)ge=b[Pe],we=g[Pe],!b.hasOwnProperty(Pe)||ge===we||ge==null&&we==null||ss(u,p,Pe,ge,b,we)}function wle(u){switch(u){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function ENe(){if(typeof performance.getEntriesByType=="function"){for(var u=0,p=0,g=performance.getEntriesByType("resource"),b=0;b<g.length;b++){var T=g[b],C=T.transferSize,I=T.initiatorType,V=T.duration;if(C&&V&&wle(I)){for(I=0,V=T.responseEnd,b+=1;b<g.length;b++){var J=g[b],me=J.startTime;if(me>V)break;var $e=J.transferSize,Pe=J.initiatorType;$e&&wle(Pe)&&(J=J.responseEnd,I+=$e*(J<V?1:(V-me)/(J-me)))}if(--b,p+=8*(C+I)/(T.duration/1e3),u++,10<u)break}}if(0<u)return p/u/1e6}return navigator.connection&&(u=navigator.connection.downlink,typeof u=="number")?u:5}var Kj=null,e9=null;function zI(u){return u.nodeType===9?u:u.ownerDocument}function xle(u){switch(u){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Sle(u,p){if(u===0)switch(p){case"svg":return 1;case"math":return 2;default:return 0}return u===1&&p==="foreignObject"?0:u}function t9(u,p){return u==="textarea"||u==="noscript"||typeof p.children=="string"||typeof p.children=="number"||typeof p.children=="bigint"||typeof p.dangerouslySetInnerHTML=="object"&&p.dangerouslySetInnerHTML!==null&&p.dangerouslySetInnerHTML.__html!=null}var i9=null;function ANe(){var u=window.event;return u&&u.type==="popstate"?u===i9?!1:(i9=u,!0):(i9=null,!1)}var Tle=typeof setTimeout=="function"?setTimeout:void 0,ONe=typeof clearTimeout=="function"?clearTimeout:void 0,$le=typeof Promise=="function"?Promise:void 0,PNe=typeof queueMicrotask=="function"?queueMicrotask:typeof $le<"u"?function(u){return $le.resolve(null).then(u).catch(RNe)}:Tle;function RNe(u){setTimeout(function(){throw u})}function s0(u){return u==="head"}function Cle(u,p){var g=p,b=0;do{var T=g.nextSibling;if(u.removeChild(g),T&&T.nodeType===8)if(g=T.data,g==="/$"||g==="/&"){if(b===0){u.removeChild(T),eS(p);return}b--}else if(g==="$"||g==="$?"||g==="$~"||g==="$!"||g==="&")b++;else if(g==="html")yE(u.ownerDocument.documentElement);else if(g==="head"){g=u.ownerDocument.head,yE(g);for(var C=g.firstChild;C;){var I=C.nextSibling,V=C.nodeName;C[Rp]||V==="SCRIPT"||V==="STYLE"||V==="LINK"&&C.rel.toLowerCase()==="stylesheet"||g.removeChild(C),C=I}}else g==="body"&&yE(u.ownerDocument.body);g=T}while(g);eS(p)}function Mle(u,p){var g=u;u=0;do{var b=g.nextSibling;if(g.nodeType===1?p?(g._stashedDisplay=g.style.display,g.style.display="none"):(g.style.display=g._stashedDisplay||"",g.getAttribute("style")===""&&g.removeAttribute("style")):g.nodeType===3&&(p?(g._stashedText=g.nodeValue,g.nodeValue=""):g.nodeValue=g._stashedText||""),b&&b.nodeType===8)if(g=b.data,g==="/$"){if(u===0)break;u--}else g!=="$"&&g!=="$?"&&g!=="$~"&&g!=="$!"||u++;g=b}while(g)}function r9(u){var p=u.firstChild;for(p&&p.nodeType===10&&(p=p.nextSibling);p;){var g=p;switch(p=p.nextSibling,g.nodeName){case"HTML":case"HEAD":case"BODY":r9(g),Jl(g);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(g.rel.toLowerCase()==="stylesheet")continue}u.removeChild(g)}}function DNe(u,p,g,b){for(;u.nodeType===1;){var T=g;if(u.nodeName.toLowerCase()!==p.toLowerCase()){if(!b&&(u.nodeName!=="INPUT"||u.type!=="hidden"))break}else if(b){if(!u[Rp])switch(p){case"meta":if(!u.hasAttribute("itemprop"))break;return u;case"link":if(C=u.getAttribute("rel"),C==="stylesheet"&&u.hasAttribute("data-precedence"))break;if(C!==T.rel||u.getAttribute("href")!==(T.href==null||T.href===""?null:T.href)||u.getAttribute("crossorigin")!==(T.crossOrigin==null?null:T.crossOrigin)||u.getAttribute("title")!==(T.title==null?null:T.title))break;return u;case"style":if(u.hasAttribute("data-precedence"))break;return u;case"script":if(C=u.getAttribute("src"),(C!==(T.src==null?null:T.src)||u.getAttribute("type")!==(T.type==null?null:T.type)||u.getAttribute("crossorigin")!==(T.crossOrigin==null?null:T.crossOrigin))&&C&&u.hasAttribute("async")&&!u.hasAttribute("itemprop"))break;return u;default:return u}}else if(p==="input"&&u.type==="hidden"){var C=T.name==null?null:""+T.name;if(T.type==="hidden"&&u.getAttribute("name")===C)return u}else return u;if(u=Ju(u.nextSibling),u===null)break}return null}function INe(u,p,g){if(p==="")return null;for(;u.nodeType!==3;)if((u.nodeType!==1||u.nodeName!=="INPUT"||u.type!=="hidden")&&!g||(u=Ju(u.nextSibling),u===null))return null;return u}function Ele(u,p){for(;u.nodeType!==8;)if((u.nodeType!==1||u.nodeName!=="INPUT"||u.type!=="hidden")&&!p||(u=Ju(u.nextSibling),u===null))return null;return u}function s9(u){return u.data==="$?"||u.data==="$~"}function n9(u){return u.data==="$!"||u.data==="$?"&&u.ownerDocument.readyState!=="loading"}function LNe(u,p){var g=u.ownerDocument;if(u.data==="$~")u._reactRetry=p;else if(u.data!=="$?"||g.readyState!=="loading")p();else{var b=function(){p(),g.removeEventListener("DOMContentLoaded",b)};g.addEventListener("DOMContentLoaded",b),u._reactRetry=b}}function Ju(u){for(;u!=null;u=u.nextSibling){var p=u.nodeType;if(p===1||p===3)break;if(p===8){if(p=u.data,p==="$"||p==="$!"||p==="$?"||p==="$~"||p==="&"||p==="F!"||p==="F")break;if(p==="/$"||p==="/&")return null}}return u}var a9=null;function Ale(u){u=u.nextSibling;for(var p=0;u;){if(u.nodeType===8){var g=u.data;if(g==="/$"||g==="/&"){if(p===0)return Ju(u.nextSibling);p--}else g!=="$"&&g!=="$!"&&g!=="$?"&&g!=="$~"&&g!=="&"||p++}u=u.nextSibling}return null}function Ole(u){u=u.previousSibling;for(var p=0;u;){if(u.nodeType===8){var g=u.data;if(g==="$"||g==="$!"||g==="$?"||g==="$~"||g==="&"){if(p===0)return u;p--}else g!=="/$"&&g!=="/&"||p++}u=u.previousSibling}return null}function Ple(u,p,g){switch(p=zI(g),u){case"html":if(u=p.documentElement,!u)throw Error(r(452));return u;case"head":if(u=p.head,!u)throw Error(r(453));return u;case"body":if(u=p.body,!u)throw Error(r(454));return u;default:throw Error(r(451))}}function yE(u){for(var p=u.attributes;p.length;)u.removeAttributeNode(p[0]);Jl(u)}var Ku=new Map,Rle=new Set;function FI(u){return typeof u.getRootNode=="function"?u.getRootNode():u.nodeType===9?u:u.ownerDocument}var $m=Q.d;Q.d={f:kNe,r:zNe,D:FNe,C:NNe,L:VNe,m:UNe,X:jNe,S:BNe,M:qNe};function kNe(){var u=$m.f(),p=AI();return u||p}function zNe(u){var p=go(u);p!==null&&p.tag===5&&p.type==="form"?Yae(p):$m.r(u)}var X2=typeof document>"u"?null:document;function Dle(u,p,g){var b=X2;if(b&&typeof p=="string"&&p){var T=Vo(p);T='link[rel="'+u+'"][href="'+T+'"]',typeof g=="string"&&(T+='[crossorigin="'+g+'"]'),Rle.has(T)||(Rle.add(T),u={rel:u,crossOrigin:g,href:p},b.querySelector(T)===null&&(p=b.createElement("link"),bo(p,"link",u),Vr(p),b.head.appendChild(p)))}}function FNe(u){$m.D(u),Dle("dns-prefetch",u,null)}function NNe(u,p){$m.C(u,p),Dle("preconnect",u,p)}function VNe(u,p,g){$m.L(u,p,g);var b=X2;if(b&&u&&p){var T='link[rel="preload"][as="'+Vo(p)+'"]';p==="image"&&g&&g.imageSrcSet?(T+='[imagesrcset="'+Vo(g.imageSrcSet)+'"]',typeof g.imageSizes=="string"&&(T+='[imagesizes="'+Vo(g.imageSizes)+'"]')):T+='[href="'+Vo(u)+'"]';var C=T;switch(p){case"style":C=J2(u);break;case"script":C=K2(u)}Ku.has(C)||(u=f({rel:"preload",href:p==="image"&&g&&g.imageSrcSet?void 0:u,as:p},g),Ku.set(C,u),b.querySelector(T)!==null||p==="style"&&b.querySelector(_E(C))||p==="script"&&b.querySelector(vE(C))||(p=b.createElement("link"),bo(p,"link",u),Vr(p),b.head.appendChild(p)))}}function UNe(u,p){$m.m(u,p);var g=X2;if(g&&u){var b=p&&typeof p.as=="string"?p.as:"script",T='link[rel="modulepreload"][as="'+Vo(b)+'"][href="'+Vo(u)+'"]',C=T;switch(b){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":C=K2(u)}if(!Ku.has(C)&&(u=f({rel:"modulepreload",href:u},p),Ku.set(C,u),g.querySelector(T)===null)){switch(b){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(g.querySelector(vE(C)))return}b=g.createElement("link"),bo(b,"link",u),Vr(b),g.head.appendChild(b)}}}function BNe(u,p,g){$m.S(u,p,g);var b=X2;if(b&&u){var T=Ra(b).hoistableStyles,C=J2(u);p=p||"default";var I=T.get(C);if(!I){var V={loading:0,preload:null};if(I=b.querySelector(_E(C)))V.loading=5;else{u=f({rel:"stylesheet",href:u,"data-precedence":p},g),(g=Ku.get(C))&&o9(u,g);var J=I=b.createElement("link");Vr(J),bo(J,"link",u),J._p=new Promise(function(me,$e){J.onload=me,J.onerror=$e}),J.addEventListener("load",function(){V.loading|=1}),J.addEventListener("error",function(){V.loading|=2}),V.loading|=4,NI(I,p,b)}I={type:"stylesheet",instance:I,count:1,state:V},T.set(C,I)}}}function jNe(u,p){$m.X(u,p);var g=X2;if(g&&u){var b=Ra(g).hoistableScripts,T=K2(u),C=b.get(T);C||(C=g.querySelector(vE(T)),C||(u=f({src:u,async:!0},p),(p=Ku.get(T))&&l9(u,p),C=g.createElement("script"),Vr(C),bo(C,"link",u),g.head.appendChild(C)),C={type:"script",instance:C,count:1,state:null},b.set(T,C))}}function qNe(u,p){$m.M(u,p);var g=X2;if(g&&u){var b=Ra(g).hoistableScripts,T=K2(u),C=b.get(T);C||(C=g.querySelector(vE(T)),C||(u=f({src:u,async:!0,type:"module"},p),(p=Ku.get(T))&&l9(u,p),C=g.createElement("script"),Vr(C),bo(C,"link",u),g.head.appendChild(C)),C={type:"script",instance:C,count:1,state:null},b.set(T,C))}}function Ile(u,p,g,b){var T=(T=Ne.current)?FI(T):null;if(!T)throw Error(r(446));switch(u){case"meta":case"title":return null;case"style":return typeof g.precedence=="string"&&typeof g.href=="string"?(p=J2(g.href),g=Ra(T).hoistableStyles,b=g.get(p),b||(b={type:"style",instance:null,count:0,state:null},g.set(p,b)),b):{type:"void",instance:null,count:0,state:null};case"link":if(g.rel==="stylesheet"&&typeof g.href=="string"&&typeof g.precedence=="string"){u=J2(g.href);var C=Ra(T).hoistableStyles,I=C.get(u);if(I||(T=T.ownerDocument||T,I={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},C.set(u,I),(C=T.querySelector(_E(u)))&&!C._p&&(I.instance=C,I.state.loading=5),Ku.has(u)||(g={rel:"preload",as:"style",href:g.href,crossOrigin:g.crossOrigin,integrity:g.integrity,media:g.media,hrefLang:g.hrefLang,referrerPolicy:g.referrerPolicy},Ku.set(u,g),C||GNe(T,u,g,I.state))),p&&b===null)throw Error(r(528,""));return I}if(p&&b!==null)throw Error(r(529,""));return null;case"script":return p=g.async,g=g.src,typeof g=="string"&&p&&typeof p!="function"&&typeof p!="symbol"?(p=K2(g),g=Ra(T).hoistableScripts,b=g.get(p),b||(b={type:"script",instance:null,count:0,state:null},g.set(p,b)),b):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,u))}}function J2(u){return'href="'+Vo(u)+'"'}function _E(u){return'link[rel="stylesheet"]['+u+"]"}function Lle(u){return f({},u,{"data-precedence":u.precedence,precedence:null})}function GNe(u,p,g,b){u.querySelector('link[rel="preload"][as="style"]['+p+"]")?b.loading=1:(p=u.createElement("link"),b.preload=p,p.addEventListener("load",function(){return b.loading|=1}),p.addEventListener("error",function(){return b.loading|=2}),bo(p,"link",g),Vr(p),u.head.appendChild(p))}function K2(u){return'[src="'+Vo(u)+'"]'}function vE(u){return"script[async]"+u}function kle(u,p,g){if(p.count++,p.instance===null)switch(p.type){case"style":var b=u.querySelector('style[data-href~="'+Vo(g.href)+'"]');if(b)return p.instance=b,Vr(b),b;var T=f({},g,{"data-href":g.href,"data-precedence":g.precedence,href:null,precedence:null});return b=(u.ownerDocument||u).createElement("style"),Vr(b),bo(b,"style",T),NI(b,g.precedence,u),p.instance=b;case"stylesheet":T=J2(g.href);var C=u.querySelector(_E(T));if(C)return p.state.loading|=4,p.instance=C,Vr(C),C;b=Lle(g),(T=Ku.get(T))&&o9(b,T),C=(u.ownerDocument||u).createElement("link"),Vr(C);var I=C;return I._p=new Promise(function(V,J){I.onload=V,I.onerror=J}),bo(C,"link",b),p.state.loading|=4,NI(C,g.precedence,u),p.instance=C;case"script":return C=K2(g.src),(T=u.querySelector(vE(C)))?(p.instance=T,Vr(T),T):(b=g,(T=Ku.get(C))&&(b=f({},g),l9(b,T)),u=u.ownerDocument||u,T=u.createElement("script"),Vr(T),bo(T,"link",b),u.head.appendChild(T),p.instance=T);case"void":return null;default:throw Error(r(443,p.type))}else p.type==="stylesheet"&&(p.state.loading&4)===0&&(b=p.instance,p.state.loading|=4,NI(b,g.precedence,u));return p.instance}function NI(u,p,g){for(var b=g.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),T=b.length?b[b.length-1]:null,C=T,I=0;I<b.length;I++){var V=b[I];if(V.dataset.precedence===p)C=V;else if(C!==T)break}C?C.parentNode.insertBefore(u,C.nextSibling):(p=g.nodeType===9?g.head:g,p.insertBefore(u,p.firstChild))}function o9(u,p){u.crossOrigin==null&&(u.crossOrigin=p.crossOrigin),u.referrerPolicy==null&&(u.referrerPolicy=p.referrerPolicy),u.title==null&&(u.title=p.title)}function l9(u,p){u.crossOrigin==null&&(u.crossOrigin=p.crossOrigin),u.referrerPolicy==null&&(u.referrerPolicy=p.referrerPolicy),u.integrity==null&&(u.integrity=p.integrity)}var VI=null;function zle(u,p,g){if(VI===null){var b=new Map,T=VI=new Map;T.set(g,b)}else T=VI,b=T.get(g),b||(b=new Map,T.set(g,b));if(b.has(u))return b;for(b.set(u,null),g=g.getElementsByTagName(u),T=0;T<g.length;T++){var C=g[T];if(!(C[Rp]||C[vi]||u==="link"&&C.getAttribute("rel")==="stylesheet")&&C.namespaceURI!=="http://www.w3.org/2000/svg"){var I=C.getAttribute(p)||"";I=u+I;var V=b.get(I);V?V.push(C):b.set(I,[C])}}return b}function Fle(u,p,g){u=u.ownerDocument||u,u.head.insertBefore(g,p==="title"?u.querySelector("head > title"):null)}function HNe(u,p,g){if(g===1||p.itemProp!=null)return!1;switch(u){case"meta":case"title":return!0;case"style":if(typeof p.precedence!="string"||typeof p.href!="string"||p.href==="")break;return!0;case"link":if(typeof p.rel!="string"||typeof p.href!="string"||p.href===""||p.onLoad||p.onError)break;return p.rel==="stylesheet"?(u=p.disabled,typeof p.precedence=="string"&&u==null):!0;case"script":if(p.async&&typeof p.async!="function"&&typeof p.async!="symbol"&&!p.onLoad&&!p.onError&&p.src&&typeof p.src=="string")return!0}return!1}function Nle(u){return!(u.type==="stylesheet"&&(u.state.loading&3)===0)}function WNe(u,p,g,b){if(g.type==="stylesheet"&&(typeof b.media!="string"||matchMedia(b.media).matches!==!1)&&(g.state.loading&4)===0){if(g.instance===null){var T=J2(b.href),C=p.querySelector(_E(T));if(C){p=C._p,p!==null&&typeof p=="object"&&typeof p.then=="function"&&(u.count++,u=UI.bind(u),p.then(u,u)),g.state.loading|=4,g.instance=C,Vr(C);return}C=p.ownerDocument||p,b=Lle(b),(T=Ku.get(T))&&o9(b,T),C=C.createElement("link"),Vr(C);var I=C;I._p=new Promise(function(V,J){I.onload=V,I.onerror=J}),bo(C,"link",b),g.instance=C}u.stylesheets===null&&(u.stylesheets=new Map),u.stylesheets.set(g,p),(p=g.state.preload)&&(g.state.loading&3)===0&&(u.count++,g=UI.bind(u),p.addEventListener("load",g),p.addEventListener("error",g))}}var c9=0;function ZNe(u,p){return u.stylesheets&&u.count===0&&jI(u,u.stylesheets),0<u.count||0<u.imgCount?function(g){var b=setTimeout(function(){if(u.stylesheets&&jI(u,u.stylesheets),u.unsuspend){var C=u.unsuspend;u.unsuspend=null,C()}},6e4+p);0<u.imgBytes&&c9===0&&(c9=62500*ENe());var T=setTimeout(function(){if(u.waitingForImages=!1,u.count===0&&(u.stylesheets&&jI(u,u.stylesheets),u.unsuspend)){var C=u.unsuspend;u.unsuspend=null,C()}},(u.imgBytes>c9?50:800)+p);return u.unsuspend=g,function(){u.unsuspend=null,clearTimeout(b),clearTimeout(T)}}:null}function UI(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)jI(this,this.stylesheets);else if(this.unsuspend){var u=this.unsuspend;this.unsuspend=null,u()}}}var BI=null;function jI(u,p){u.stylesheets=null,u.unsuspend!==null&&(u.count++,BI=new Map,p.forEach(YNe,u),BI=null,UI.call(u))}function YNe(u,p){if(!(p.state.loading&4)){var g=BI.get(u);if(g)var b=g.get(null);else{g=new Map,BI.set(u,g);for(var T=u.querySelectorAll("link[data-precedence],style[data-precedence]"),C=0;C<T.length;C++){var I=T[C];(I.nodeName==="LINK"||I.getAttribute("media")!=="not all")&&(g.set(I.dataset.precedence,I),b=I)}b&&g.set(null,b)}T=p.instance,I=T.getAttribute("data-precedence"),C=g.get(I)||b,C===b&&g.set(null,T),g.set(I,T),this.count++,b=UI.bind(this),T.addEventListener("load",b),T.addEventListener("error",b),C?C.parentNode.insertBefore(T,C.nextSibling):(u=u.nodeType===9?u.head:u,u.insertBefore(T,u.firstChild)),p.state.loading|=4}}var bE={$$typeof:M,Provider:null,Consumer:null,_currentValue:X,_currentValue2:X,_threadCount:0};function QNe(u,p,g,b,T,C,I,V,J){this.tag=1,this.containerInfo=u,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=ii(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ii(0),this.hiddenUpdates=ii(null),this.identifierPrefix=b,this.onUncaughtError=T,this.onCaughtError=C,this.onRecoverableError=I,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=J,this.incompleteTransitions=new Map}function Vle(u,p,g,b,T,C,I,V,J,me,$e,Pe){return u=new QNe(u,p,g,I,J,me,$e,Pe,V),p=1,C===!0&&(p|=24),C=Hc(3,null,null,p),u.current=C,C.stateNode=u,p=BB(),p.refCount++,u.pooledCache=p,p.refCount++,C.memoizedState={element:b,isDehydrated:g,cache:p},HB(C),u}function Ule(u){return u?(u=O2,u):O2}function Ble(u,p,g,b,T,C){T=Ule(T),b.context===null?b.context=T:b.pendingContext=T,b=Wy(p),b.payload={element:g},C=C===void 0?null:C,C!==null&&(b.callback=C),g=Zy(u,b,p),g!==null&&(sc(g,u,p),JM(g,u,p))}function jle(u,p){if(u=u.memoizedState,u!==null&&u.dehydrated!==null){var g=u.retryLane;u.retryLane=g!==0&&g<p?g:p}}function u9(u,p){jle(u,p),(u=u.alternate)&&jle(u,p)}function qle(u){if(u.tag===13||u.tag===31){var p=a1(u,67108864);p!==null&&sc(p,u,67108864),u9(u,67108864)}}function Gle(u){if(u.tag===13||u.tag===31){var p=Xc();p=Ha(p);var g=a1(u,p);g!==null&&sc(g,u,p),u9(u,p)}}var qI=!0;function XNe(u,p,g,b){var T=H.T;H.T=null;var C=Q.p;try{Q.p=2,h9(u,p,g,b)}finally{Q.p=C,H.T=T}}function JNe(u,p,g,b){var T=H.T;H.T=null;var C=Q.p;try{Q.p=8,h9(u,p,g,b)}finally{Q.p=C,H.T=T}}function h9(u,p,g,b){if(qI){var T=d9(b);if(T===null)Xj(u,p,b,GI,g),Wle(u,b);else if(e6e(T,u,p,g,b))b.stopPropagation();else if(Wle(u,b),p&4&&-1<KNe.indexOf(u)){for(;T!==null;){var C=go(T);if(C!==null)switch(C.tag){case 3:if(C=C.stateNode,C.current.memoizedState.isDehydrated){var I=gs(C.pendingLanes);if(I!==0){var V=C;for(V.pendingLanes|=2,V.entangledLanes|=2;I;){var J=1<<31-Vt(I);V.entanglements[1]|=J,I&=~J}Vp(C),(Lr&6)===0&&(MI=rt()+500,fE(0))}}break;case 31:case 13:V=a1(C,2),V!==null&&sc(V,C,2),AI(),u9(C,2)}if(C=d9(b),C===null&&Xj(u,p,b,GI,g),C===T)break;T=C}T!==null&&b.stopPropagation()}else Xj(u,p,b,null,g)}}function d9(u){return u=fB(u),p9(u)}var GI=null;function p9(u){if(GI=null,u=hl(u),u!==null){var p=n(u);if(p===null)u=null;else{var g=p.tag;if(g===13){if(u=a(p),u!==null)return u;u=null}else if(g===31){if(u=o(p),u!==null)return u;u=null}else if(g===3){if(p.stateNode.current.memoizedState.isDehydrated)return p.tag===3?p.stateNode.containerInfo:null;u=null}else p!==u&&(u=null)}}return GI=u,null}function Hle(u){switch(u){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Zt()){case Li:return 2;case Ci:return 8;case ei:case Gi:return 32;case Ui:return 268435456;default:return 32}default:return 32}}var f9=!1,n0=null,a0=null,o0=null,wE=new Map,xE=new Map,l0=[],KNe="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Wle(u,p){switch(u){case"focusin":case"focusout":n0=null;break;case"dragenter":case"dragleave":a0=null;break;case"mouseover":case"mouseout":o0=null;break;case"pointerover":case"pointerout":wE.delete(p.pointerId);break;case"gotpointercapture":case"lostpointercapture":xE.delete(p.pointerId)}}function SE(u,p,g,b,T,C){return u===null||u.nativeEvent!==C?(u={blockedOn:p,domEventName:g,eventSystemFlags:b,nativeEvent:C,targetContainers:[T]},p!==null&&(p=go(p),p!==null&&qle(p)),u):(u.eventSystemFlags|=b,p=u.targetContainers,T!==null&&p.indexOf(T)===-1&&p.push(T),u)}function e6e(u,p,g,b,T){switch(p){case"focusin":return n0=SE(n0,u,p,g,b,T),!0;case"dragenter":return a0=SE(a0,u,p,g,b,T),!0;case"mouseover":return o0=SE(o0,u,p,g,b,T),!0;case"pointerover":var C=T.pointerId;return wE.set(C,SE(wE.get(C)||null,u,p,g,b,T)),!0;case"gotpointercapture":return C=T.pointerId,xE.set(C,SE(xE.get(C)||null,u,p,g,b,T)),!0}return!1}function Zle(u){var p=hl(u.target);if(p!==null){var g=n(p);if(g!==null){if(p=g.tag,p===13){if(p=a(g),p!==null){u.blockedOn=p,ra(u.priority,function(){Gle(g)});return}}else if(p===31){if(p=o(g),p!==null){u.blockedOn=p,ra(u.priority,function(){Gle(g)});return}}else if(p===3&&g.stateNode.current.memoizedState.isDehydrated){u.blockedOn=g.tag===3?g.stateNode.containerInfo:null;return}}}u.blockedOn=null}function HI(u){if(u.blockedOn!==null)return!1;for(var p=u.targetContainers;0<p.length;){var g=d9(u.nativeEvent);if(g===null){g=u.nativeEvent;var b=new g.constructor(g.type,g);pB=b,g.target.dispatchEvent(b),pB=null}else return p=go(g),p!==null&&qle(p),u.blockedOn=g,!1;p.shift()}return!0}function Yle(u,p,g){HI(u)&&g.delete(p)}function t6e(){f9=!1,n0!==null&&HI(n0)&&(n0=null),a0!==null&&HI(a0)&&(a0=null),o0!==null&&HI(o0)&&(o0=null),wE.forEach(Yle),xE.forEach(Yle)}function WI(u,p){u.blockedOn===p&&(u.blockedOn=null,f9||(f9=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,t6e)))}var ZI=null;function Qle(u){ZI!==u&&(ZI=u,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){ZI===u&&(ZI=null);for(var p=0;p<u.length;p+=3){var g=u[p],b=u[p+1],T=u[p+2];if(typeof b!="function"){if(p9(b||g)===null)continue;break}var C=go(g);C!==null&&(u.splice(p,3),p-=3,dj(C,{pending:!0,data:T,method:g.method,action:b},b,T))}}))}function eS(u){function p(J){return WI(J,u)}n0!==null&&WI(n0,u),a0!==null&&WI(a0,u),o0!==null&&WI(o0,u),wE.forEach(p),xE.forEach(p);for(var g=0;g<l0.length;g++){var b=l0[g];b.blockedOn===u&&(b.blockedOn=null)}for(;0<l0.length&&(g=l0[0],g.blockedOn===null);)Zle(g),g.blockedOn===null&&l0.shift();if(g=(u.ownerDocument||u).$$reactFormReplay,g!=null)for(b=0;b<g.length;b+=3){var T=g[b],C=g[b+1],I=T[Pa]||null;if(typeof C=="function")I||Qle(g);else if(I){var V=null;if(C&&C.hasAttribute("formAction")){if(T=C,I=C[Pa]||null)V=I.formAction;else if(p9(T)!==null)continue}else V=I.action;typeof V=="function"?g[b+1]=V:(g.splice(b,3),b-=3),Qle(g)}}}function Xle(){function u(C){C.canIntercept&&C.info==="react-transition"&&C.intercept({handler:function(){return new Promise(function(I){return T=I})},focusReset:"manual",scroll:"manual"})}function p(){T!==null&&(T(),T=null),b||setTimeout(g,20)}function g(){if(!b&&!navigation.transition){var C=navigation.currentEntry;C&&C.url!=null&&navigation.navigate(C.url,{state:C.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var b=!1,T=null;return navigation.addEventListener("navigate",u),navigation.addEventListener("navigatesuccess",p),navigation.addEventListener("navigateerror",p),setTimeout(g,100),function(){b=!0,navigation.removeEventListener("navigate",u),navigation.removeEventListener("navigatesuccess",p),navigation.removeEventListener("navigateerror",p),T!==null&&(T(),T=null)}}}function m9(u){this._internalRoot=u}YI.prototype.render=m9.prototype.render=function(u){var p=this._internalRoot;if(p===null)throw Error(r(409));var g=p.current,b=Xc();Ble(g,b,u,p,null,null)},YI.prototype.unmount=m9.prototype.unmount=function(){var u=this._internalRoot;if(u!==null){this._internalRoot=null;var p=u.containerInfo;Ble(u.current,2,null,u,null,null),AI(),p[nd]=null}};function YI(u){this._internalRoot=u}YI.prototype.unstable_scheduleHydration=function(u){if(u){var p=er();u={blockedOn:null,target:u,priority:p};for(var g=0;g<l0.length&&p!==0&&p<l0[g].priority;g++);l0.splice(g,0,u),g===0&&Zle(u)}};var Jle=e.version;if(Jle!=="19.2.3")throw Error(r(527,Jle,"19.2.3"));Q.findDOMNode=function(u){var p=u._reactInternals;if(p===void 0)throw typeof u.render=="function"?Error(r(188)):(u=Object.keys(u).join(","),Error(r(268,u)));return u=c(p),u=u!==null?h(u):null,u=u===null?null:u.stateNode,u};var i6e={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:H,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var QI=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!QI.isDisabled&&QI.supportsFiber)try{ti=QI.inject(i6e),wt=QI}catch{}}return CE.createRoot=function(u,p){if(!s(u))throw Error(r(299));var g=!1,b="",T=noe,C=aoe,I=ooe;return p!=null&&(p.unstable_strictMode===!0&&(g=!0),p.identifierPrefix!==void 0&&(b=p.identifierPrefix),p.onUncaughtError!==void 0&&(T=p.onUncaughtError),p.onCaughtError!==void 0&&(C=p.onCaughtError),p.onRecoverableError!==void 0&&(I=p.onRecoverableError)),p=Vle(u,1,!1,null,null,g,b,null,T,C,I,Xle),u[nd]=p.current,Qj(u),new m9(p)},CE.hydrateRoot=function(u,p,g){if(!s(u))throw Error(r(299));var b=!1,T="",C=noe,I=aoe,V=ooe,J=null;return g!=null&&(g.unstable_strictMode===!0&&(b=!0),g.identifierPrefix!==void 0&&(T=g.identifierPrefix),g.onUncaughtError!==void 0&&(C=g.onUncaughtError),g.onCaughtError!==void 0&&(I=g.onCaughtError),g.onRecoverableError!==void 0&&(V=g.onRecoverableError),g.formState!==void 0&&(J=g.formState)),p=Vle(u,1,!0,p,g??null,b,T,J,C,I,V,Xle),p.context=Ule(null),g=p.current,b=Xc(),b=Ha(b),T=Wy(b),T.callback=null,Zy(g,T,b),g=b,p.current.lanes=g,Jt(p,g),Vp(p),u[nd]=p.current,Qj(u),new YI(p)},CE.version="19.2.3",CE}var uce;function f6e(){if(uce)return v9.exports;uce=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),v9.exports=p6e(),v9.exports}var m6e=f6e();const un=(t,e,...i)=>{try{return t?.call(e,...i)}catch(r){console.error(r,t)}},VH=async(t,e,...i)=>{try{return await t?.call(e,...i)}catch(r){console.error(r,t)}},VJ=Symbol.for("controller"),g6e=t=>typeof t=="object"&&t!==null&&(VJ in t||"hostConnected"in t||"hostDisconnected"in t||"hostUpdate"in t||"hostUpdated"in t),y6e=t=>typeof t?.then=="function",_6e=t=>t.M.length;let qA;const r3=t=>{qA!==t&&(qA=t,queueMicrotask(()=>qA===t?qA=void 0:0))},eM=t=>qA;let Z1=[];const F1e=t=>{if(t===void 0){Z1=[];return}const e=Z1.indexOf(t);Z1=e===-1?[...Z1,t]:Z1.slice(0,e+1),queueMicrotask(()=>Z1=[])},N1e=()=>Z1;let s3;const v6e=t=>{s3!==t&&(s3=t,queueMicrotask(()=>s3===t?s3=void 0:0))},b6e=()=>{const t=s3;return s3=void 0,t},w6e=async(t,e)=>{const i=UJ(t);if(i===void 0)return t;if(await i.ready,typeof e=="function"){const r=i.watchExports(s=>e(s,r))}return i.exports},x6e=async t=>{const e=UJ(t);return await e.ready,e},UJ=t=>{const i=eM().manager.X(t);if(i!==void 0)return i;if(g6e(t))return t;const r=b6e();if(r!==void 0)return r};let UH=!1;const S6e=t=>{UH=!0;try{return t()}finally{UH=!1}};const Vk=globalThis,BJ=Vk.ShadowRoot&&(Vk.ShadyCSS===void 0||Vk.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,jJ=Symbol(),hce=new WeakMap;let V1e=class{constructor(e,i,r){if(this._$cssResult$=!0,r!==jJ)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=i}get styleSheet(){let e=this.o;const i=this.t;if(BJ&&e===void 0){const r=i!==void 0&&i.length===1;r&&(e=hce.get(i)),e===void 0&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),r&&hce.set(i,e))}return e}toString(){return this.cssText}};const T6e=t=>new V1e(typeof t=="string"?t:t+"",void 0,jJ),zv=(t,...e)=>{const i=t.length===1?t[0]:e.reduce((r,s,n)=>r+(a=>{if(a._$cssResult$===!0)return a.cssText;if(typeof a=="number")return a;throw Error("Value passed to 'css' function must be a 'css' function result: "+a+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(s)+t[n+1],t[0]);return new V1e(i,t,jJ)},$6e=(t,e)=>{if(BJ)t.adoptedStyleSheets=e.map(i=>i instanceof CSSStyleSheet?i:i.styleSheet);else for(const i of e){const r=document.createElement("style"),s=Vk.litNonce;s!==void 0&&r.setAttribute("nonce",s),r.textContent=i.cssText,t.appendChild(r)}},dce=BJ?t=>t:t=>t instanceof CSSStyleSheet?(e=>{let i="";for(const r of e.cssRules)i+=r.cssText;return T6e(i)})(t):t;const{is:C6e,defineProperty:M6e,getOwnPropertyDescriptor:E6e,getOwnPropertyNames:A6e,getOwnPropertySymbols:O6e,getPrototypeOf:P6e}=Object,VV=globalThis,pce=VV.trustedTypes,R6e=pce?pce.emptyScript:"",D6e=VV.reactiveElementPolyfillSupport,xP=(t,e)=>t,BH={toAttribute(t,e){switch(e){case Boolean:t=t?R6e:null;break;case Object:case Array:t=t==null?t:JSON.stringify(t)}return t},fromAttribute(t,e){let i=t;switch(e){case Boolean:i=t!==null;break;case Number:i=t===null?null:Number(t);break;case Object:case Array:try{i=JSON.parse(t)}catch{i=null}}return i}},qJ=(t,e)=>!C6e(t,e),fce={attribute:!0,type:String,converter:BH,reflect:!1,useDefault:!1,hasChanged:qJ};Symbol.metadata??=Symbol("metadata"),VV.litPropertyMetadata??=new WeakMap;let rT=class extends HTMLElement{static addInitializer(e){this._$Ei(),(this.l??=[]).push(e)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(e,i=fce){if(i.state&&(i.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(e)&&((i=Object.create(i)).wrapped=!0),this.elementProperties.set(e,i),!i.noAccessor){const r=Symbol(),s=this.getPropertyDescriptor(e,r,i);s!==void 0&&M6e(this.prototype,e,s)}}static getPropertyDescriptor(e,i,r){const{get:s,set:n}=E6e(this.prototype,e)??{get(){return this[i]},set(a){this[i]=a}};return{get:s,set(a){const o=s?.call(this);n?.call(this,a),this.requestUpdate(e,o,r)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)??fce}static _$Ei(){if(this.hasOwnProperty(xP("elementProperties")))return;const e=P6e(this);e.finalize(),e.l!==void 0&&(this.l=[...e.l]),this.elementProperties=new Map(e.elementProperties)}static finalize(){if(this.hasOwnProperty(xP("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(xP("properties"))){const i=this.properties,r=[...A6e(i),...O6e(i)];for(const s of r)this.createProperty(s,i[s])}const e=this[Symbol.metadata];if(e!==null){const i=litPropertyMetadata.get(e);if(i!==void 0)for(const[r,s]of i)this.elementProperties.set(r,s)}this._$Eh=new Map;for(const[i,r]of this.elementProperties){const s=this._$Eu(i,r);s!==void 0&&this._$Eh.set(s,i)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(e){const i=[];if(Array.isArray(e)){const r=new Set(e.flat(1/0).reverse());for(const s of r)i.unshift(dce(s))}else e!==void 0&&i.push(dce(e));return i}static _$Eu(e,i){const r=i.attribute;return r===!1?void 0:typeof r=="string"?r:typeof e=="string"?e.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){this._$ES=new Promise(e=>this.enableUpdating=e),this._$AL=new Map,this._$E_(),this.requestUpdate(),this.constructor.l?.forEach(e=>e(this))}addController(e){(this._$EO??=new Set).add(e),this.renderRoot!==void 0&&this.isConnected&&e.hostConnected?.()}removeController(e){this._$EO?.delete(e)}_$E_(){const e=new Map,i=this.constructor.elementProperties;for(const r of i.keys())this.hasOwnProperty(r)&&(e.set(r,this[r]),delete this[r]);e.size>0&&(this._$Ep=e)}createRenderRoot(){const e=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return $6e(e,this.constructor.elementStyles),e}connectedCallback(){this.renderRoot??=this.createRenderRoot(),this.enableUpdating(!0),this._$EO?.forEach(e=>e.hostConnected?.())}enableUpdating(e){}disconnectedCallback(){this._$EO?.forEach(e=>e.hostDisconnected?.())}attributeChangedCallback(e,i,r){this._$AK(e,r)}_$ET(e,i){const r=this.constructor.elementProperties.get(e),s=this.constructor._$Eu(e,r);if(s!==void 0&&r.reflect===!0){const n=(r.converter?.toAttribute!==void 0?r.converter:BH).toAttribute(i,r.type);this._$Em=e,n==null?this.removeAttribute(s):this.setAttribute(s,n),this._$Em=null}}_$AK(e,i){const r=this.constructor,s=r._$Eh.get(e);if(s!==void 0&&this._$Em!==s){const n=r.getPropertyOptions(s),a=typeof n.converter=="function"?{fromAttribute:n.converter}:n.converter?.fromAttribute!==void 0?n.converter:BH;this._$Em=s;const o=a.fromAttribute(i,n.type);this[s]=o??this._$Ej?.get(s)??o,this._$Em=null}}requestUpdate(e,i,r,s=!1,n){if(e!==void 0){const a=this.constructor;if(s===!1&&(n=this[e]),r??=a.getPropertyOptions(e),!((r.hasChanged??qJ)(n,i)||r.useDefault&&r.reflect&&n===this._$Ej?.get(e)&&!this.hasAttribute(a._$Eu(e,r))))return;this.C(e,i,r)}this.isUpdatePending===!1&&(this._$ES=this._$EP())}C(e,i,{useDefault:r,reflect:s,wrapped:n},a){r&&!(this._$Ej??=new Map).has(e)&&(this._$Ej.set(e,a??i??this[e]),n!==!0||a!==void 0)||(this._$AL.has(e)||(this.hasUpdated||r||(i=void 0),this._$AL.set(e,i)),s===!0&&this._$Em!==e&&(this._$Eq??=new Set).add(e))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(i){Promise.reject(i)}const e=this.scheduleUpdate();return e!=null&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??=this.createRenderRoot(),this._$Ep){for(const[s,n]of this._$Ep)this[s]=n;this._$Ep=void 0}const r=this.constructor.elementProperties;if(r.size>0)for(const[s,n]of r){const{wrapped:a}=n,o=this[s];a!==!0||this._$AL.has(s)||o===void 0||this.C(s,void 0,n,o)}}let e=!1;const i=this._$AL;try{e=this.shouldUpdate(i),e?(this.willUpdate(i),this._$EO?.forEach(r=>r.hostUpdate?.()),this.update(i)):this._$EM()}catch(r){throw e=!1,this._$EM(),r}e&&this._$AE(i)}willUpdate(e){}_$AE(e){this._$EO?.forEach(i=>i.hostUpdated?.()),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(e){return!0}update(e){this._$Eq&&=this._$Eq.forEach(i=>this._$ET(i,this[i])),this._$EM()}updated(e){}firstUpdated(e){}};rT.elementStyles=[],rT.shadowRootOptions={mode:"open"},rT[xP("elementProperties")]=new Map,rT[xP("finalized")]=new Map,D6e?.({ReactiveElement:rT}),(VV.reactiveElementVersions??=[]).push("2.1.2");const GJ=globalThis,mce=t=>t,mN=GJ.trustedTypes,gce=mN?mN.createPolicy("lit-html",{createHTML:t=>t}):void 0,U1e="$lit$",__=`lit$${Math.random().toFixed(9).slice(2)}$`,B1e="?"+__,I6e=`<${B1e}>`,Ox=document,wR=()=>Ox.createComment(""),xR=t=>t===null||typeof t!="object"&&typeof t!="function",HJ=Array.isArray,L6e=t=>HJ(t)||typeof t?.[Symbol.iterator]=="function",S9=`[ 	
\f\r]`,ME=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,yce=/-->/g,_ce=/>/g,v1=RegExp(`>|${S9}(?:([^\\s"'>=/]+)(${S9}*=${S9}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),vce=/'/g,bce=/"/g,j1e=/^(?:script|style|textarea|title)$/i,q1e=t=>(e,...i)=>({_$litType$:t,strings:e,values:i}),En=q1e(1),wce=q1e(2),ov=Symbol.for("lit-noChange"),cs=Symbol.for("lit-nothing"),xce=new WeakMap,Yb=Ox.createTreeWalker(Ox,129);function G1e(t,e){if(!HJ(t)||!t.hasOwnProperty("raw"))throw Error("invalid template strings array");return gce!==void 0?gce.createHTML(e):e}const k6e=(t,e)=>{const i=t.length-1,r=[];let s,n=e===2?"<svg>":e===3?"<math>":"",a=ME;for(let o=0;o<i;o++){const l=t[o];let c,h,f=-1,y=0;for(;y<l.length&&(a.lastIndex=y,h=a.exec(l),h!==null);)y=a.lastIndex,a===ME?h[1]==="!--"?a=yce:h[1]!==void 0?a=_ce:h[2]!==void 0?(j1e.test(h[2])&&(s=RegExp("</"+h[2],"g")),a=v1):h[3]!==void 0&&(a=v1):a===v1?h[0]===">"?(a=s??ME,f=-1):h[1]===void 0?f=-2:(f=a.lastIndex-h[2].length,c=h[1],a=h[3]===void 0?v1:h[3]==='"'?bce:vce):a===bce||a===vce?a=v1:a===yce||a===_ce?a=ME:(a=v1,s=void 0);const _=a===v1&&t[o+1].startsWith("/>")?" ":"";n+=a===ME?l+I6e:f>=0?(r.push(c),l.slice(0,f)+U1e+l.slice(f)+__+_):l+__+(f===-2?o:_)}return[G1e(t,n+(t[i]||"<?>")+(e===2?"</svg>":e===3?"</math>":"")),r]};let jH=class H1e{constructor({strings:e,_$litType$:i},r){let s;this.parts=[];let n=0,a=0;const o=e.length-1,l=this.parts,[c,h]=k6e(e,i);if(this.el=H1e.createElement(c,r),Yb.currentNode=this.el.content,i===2||i===3){const f=this.el.content.firstChild;f.replaceWith(...f.childNodes)}for(;(s=Yb.nextNode())!==null&&l.length<o;){if(s.nodeType===1){if(s.hasAttributes())for(const f of s.getAttributeNames())if(f.endsWith(U1e)){const y=h[a++],_=s.getAttribute(f).split(__),w=/([.?@])?(.*)/.exec(y);l.push({type:1,index:n,name:w[2],strings:_,ctor:w[1]==="."?F6e:w[1]==="?"?N6e:w[1]==="@"?V6e:UV}),s.removeAttribute(f)}else f.startsWith(__)&&(l.push({type:6,index:n}),s.removeAttribute(f));if(j1e.test(s.tagName)){const f=s.textContent.split(__),y=f.length-1;if(y>0){s.textContent=mN?mN.emptyScript:"";for(let _=0;_<y;_++)s.append(f[_],wR()),Yb.nextNode(),l.push({type:2,index:++n});s.append(f[y],wR())}}}else if(s.nodeType===8)if(s.data===B1e)l.push({type:2,index:n});else{let f=-1;for(;(f=s.data.indexOf(__,f+1))!==-1;)l.push({type:7,index:n}),f+=__.length-1}n++}}static createElement(e,i){const r=Ox.createElement("template");return r.innerHTML=e,r}};function tC(t,e,i=t,r){if(e===ov)return e;let s=r!==void 0?i._$Co?.[r]:i._$Cl;const n=xR(e)?void 0:e._$litDirective$;return s?.constructor!==n&&(s?._$AO?.(!1),n===void 0?s=void 0:(s=new n(t),s._$AT(t,i,r)),r!==void 0?(i._$Co??=[])[r]=s:i._$Cl=s),s!==void 0&&(e=tC(t,s._$AS(t,e.values),s,r)),e}let z6e=class{constructor(e,i){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=i}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){const{el:{content:i},parts:r}=this._$AD,s=(e?.creationScope??Ox).importNode(i,!0);Yb.currentNode=s;let n=Yb.nextNode(),a=0,o=0,l=r[0];for(;l!==void 0;){if(a===l.index){let c;l.type===2?c=new WJ(n,n.nextSibling,this,e):l.type===1?c=new l.ctor(n,l.name,l.strings,this,e):l.type===6&&(c=new U6e(n,this,e)),this._$AV.push(c),l=r[++o]}a!==l?.index&&(n=Yb.nextNode(),a++)}return Yb.currentNode=Ox,s}p(e){let i=0;for(const r of this._$AV)r!==void 0&&(r.strings!==void 0?(r._$AI(e,r,i),i+=r.strings.length-2):r._$AI(e[i])),i++}},WJ=class W1e{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(e,i,r,s){this.type=2,this._$AH=cs,this._$AN=void 0,this._$AA=e,this._$AB=i,this._$AM=r,this.options=s,this._$Cv=s?.isConnected??!0}get parentNode(){let e=this._$AA.parentNode;const i=this._$AM;return i!==void 0&&e?.nodeType===11&&(e=i.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,i=this){e=tC(this,e,i),xR(e)?e===cs||e==null||e===""?(this._$AH!==cs&&this._$AR(),this._$AH=cs):e!==this._$AH&&e!==ov&&this._(e):e._$litType$!==void 0?this.$(e):e.nodeType!==void 0?this.T(e):L6e(e)?this.k(e):this._(e)}O(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.O(e))}_(e){this._$AH!==cs&&xR(this._$AH)?this._$AA.nextSibling.data=e:this.T(Ox.createTextNode(e)),this._$AH=e}$(e){const{values:i,_$litType$:r}=e,s=typeof r=="number"?this._$AC(e):(r.el===void 0&&(r.el=jH.createElement(G1e(r.h,r.h[0]),this.options)),r);if(this._$AH?._$AD===s)this._$AH.p(i);else{const n=new z6e(s,this),a=n.u(this.options);n.p(i),this.T(a),this._$AH=n}}_$AC(e){let i=xce.get(e.strings);return i===void 0&&xce.set(e.strings,i=new jH(e)),i}k(e){HJ(this._$AH)||(this._$AH=[],this._$AR());const i=this._$AH;let r,s=0;for(const n of e)s===i.length?i.push(r=new W1e(this.O(wR()),this.O(wR()),this,this.options)):r=i[s],r._$AI(n),s++;s<i.length&&(this._$AR(r&&r._$AB.nextSibling,s),i.length=s)}_$AR(e=this._$AA.nextSibling,i){for(this._$AP?.(!1,!0,i);e!==this._$AB;){const r=mce(e).nextSibling;mce(e).remove(),e=r}}setConnected(e){this._$AM===void 0&&(this._$Cv=e,this._$AP?.(e))}},UV=class{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,i,r,s,n){this.type=1,this._$AH=cs,this._$AN=void 0,this.element=e,this.name=i,this._$AM=s,this.options=n,r.length>2||r[0]!==""||r[1]!==""?(this._$AH=Array(r.length-1).fill(new String),this.strings=r):this._$AH=cs}_$AI(e,i=this,r,s){const n=this.strings;let a=!1;if(n===void 0)e=tC(this,e,i,0),a=!xR(e)||e!==this._$AH&&e!==ov,a&&(this._$AH=e);else{const o=e;let l,c;for(e=n[0],l=0;l<n.length-1;l++)c=tC(this,o[r+l],i,l),c===ov&&(c=this._$AH[l]),a||=!xR(c)||c!==this._$AH[l],c===cs?e=cs:e!==cs&&(e+=(c??"")+n[l+1]),this._$AH[l]=c}a&&!s&&this.j(e)}j(e){e===cs?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}},F6e=class extends UV{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===cs?void 0:e}},N6e=class extends UV{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==cs)}},V6e=class extends UV{constructor(e,i,r,s,n){super(e,i,r,s,n),this.type=5}_$AI(e,i=this){if((e=tC(this,e,i,0)??cs)===ov)return;const r=this._$AH,s=e===cs&&r!==cs||e.capture!==r.capture||e.once!==r.once||e.passive!==r.passive,n=e!==cs&&(r===cs||s);s&&this.element.removeEventListener(this.name,this,r),n&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){typeof this._$AH=="function"?this._$AH.call(this.options?.host??this.element,e):this._$AH.handleEvent(e)}},U6e=class{constructor(e,i,r){this.element=e,this.type=6,this._$AN=void 0,this._$AM=i,this.options=r}get _$AU(){return this._$AM._$AU}_$AI(e){tC(this,e)}};const B6e=GJ.litHtmlPolyfillSupport;B6e?.(jH,WJ),(GJ.litHtmlVersions??=[]).push("3.3.2");const j6e=(t,e,i)=>{const r=i?.renderBefore??e;let s=r._$litPart$;if(s===void 0){const n=i?.renderBefore??null;r._$litPart$=s=new WJ(e.insertBefore(wR(),n),n,void 0,i??{})}return s._$AI(t),s};const ZJ=globalThis;let j3=class extends rT{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){const e=super.createRenderRoot();return this.renderOptions.renderBefore??=e.firstChild,e}update(e){const i=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=j6e(i,this.renderRoot,this.renderOptions)}connectedCallback(){super.connectedCallback(),this._$Do?.setConnected(!0)}disconnectedCallback(){super.disconnectedCallback(),this._$Do?.setConnected(!1)}render(){return ov}};j3._$litElement$=!0,j3.finalized=!0,ZJ.litElementHydrateSupport?.({LitElement:j3});const q6e=ZJ.litElementPolyfillSupport;q6e?.({LitElement:j3});(ZJ.litElementVersions??=[]).push("4.2.2");class SR{constructor(){this.promise=new Promise((e,i)=>{this.resolve=e,this.reject=i})}}const G6e=(t,e)=>{const i=e/H6e;let r=0;const s=setInterval(()=>{r+=i,r>=e&&(clearInterval(s),t())},i);return s},H6e=4,W6e=(t,e,i)=>{const r=Object.keys(t),s=r.length;n3===void 0&&queueMicrotask(BV),n3??=new Map;let n=n3.get(t);return n===void 0&&(n={callbacks:[],keyCount:s},n3.set(t,n)),n.keyCount!==s&&(n.callbacks.forEach(a=>a(r)),n.callbacks=[],n.keyCount=s),n.callbacks.push(a=>{const o=c=>un(e,null,c),l=a[s];l===void 0?o(void 0):t[l]===i?o(l):o(void 0)}),i};let n3;const BV=()=>{n3?.forEach(({callbacks:t},e)=>{const i=Object.keys(e);t.forEach(r=>r(i))}),n3=void 0},YJ=(t,e,i)=>{const r=t.manager;return r.V!==cs&&r.V!==i&&r.S(void 0,void 0),r.T.length===0&&queueMicrotask(()=>r.S(void 0,void 0)),r.V=i,r.T.push((s,n)=>un(e,void 0,i===n?s:void 0)),i},QJ=(t=[eM(),...N1e()],e,i)=>{const r=Array.isArray(t)?t:[t];let s=r.length+1;const n=a=>{s-=1,a!==void 0&&(s=Math.min(s,0)),s===0&&e(a)};r.forEach(a=>W6e(a,o=>n(o===void 0?void 0:{key:o,host:a,isReactive:!1}),i));for(const a of r)if("manager"in a&&a.manager.component===a){YJ(a,o=>n(o===void 0?void 0:{key:o,host:a,isReactive:!0}),i);break}return i},XJ=(t="",e={},i=eM())=>{const r={emit:s=>{t===""&&BV();const n=new CustomEvent(t,{detail:s,cancelable:!0,bubbles:!0,composed:!0,...e});return i.el.dispatchEvent(n),n}};return t===""&&QJ(void 0,s=>t=s.key,r),r},Pc=XJ.bind(null,"");var Z1e;Z1e=VJ;class JJ{constructor(e){this.#e=[],this.#t=[],this.#i=[],this.#a=[],this.#o=[],this.#l=[],this.#h=[],this.#d=[],this.#c=[],this.#u=!1,this.P=new SR,this.connectedCalled=!1,this.loadedCalled=!1,this[Z1e]=!0,this.#n=[];const i=this,r=e??eM();i.#r=r,i.ready=i.P.promise,i.#s=Tce(i),i.component=r,i.#r.addController(i),i.#r.manager===void 0||(F1e(i),queueMicrotask(()=>i.catchUpLifecycle()))}#e;#t;#i;#a;#o;#l;#h;#d;#c;#u;#r;catchUpLifecycle(){const{manager:e}=this.#r;e.connectedCalled&&!this.connectedCalled&&this.triggerConnected(),e.#u&&this.triggerLoad().then(()=>e.loadedCalled&&this.triggerLoaded()).catch(console.error)}#s;get exports(){return this.#s}set exports(e){const i=this.#s;i!==e&&(this.#s=e,this.#n.forEach(un),this.connectedCalled&&this.O!==!1&&this.#r.requestUpdate(this.O,i)),this.P.resolve(e)}setProvisionalExports(e,i=!0){this.#s=i?Tce(e):e,this.#n.forEach(un)}#n;watchExports(e){const i=()=>e(this.#s);return this.#n.push(i),()=>{this.#n.splice(this.#n.indexOf(i),1)}}get use(){return r3(this.#r),w6e}get useRef(){return r3(this.#r),x6e}get useRefSync(){return r3(this.#r),UJ}controllerRemoved(){this.#r.el.isConnected&&this.triggerDisconnected(),this.triggerDestroy()}onConnected(e){this.#e.push(e)}onDisconnected(e){this.#t.push(e)}onLoad(e){this.#i.push(e)}onLoaded(e){this.#a.push(e)}onUpdate(e){this.#o.push(e)}onUpdated(e){this.#l.push(e)}onDestroy(e){this.#h.push(e)}onLifecycle(e){this.#d.push(e),this.connectedCalled&&this.#r.el.isConnected&&this.#p(e)}triggerConnected(){const e=this;e.hostConnected&&un(e.hostConnected,e),e.#e.forEach(un),e.triggerLifecycle(),e.connectedCalled=!0}triggerDisconnected(){const e=this;e.hostDisconnected&&un(e.hostDisconnected,e),e.#t.forEach(un),e.#c.forEach(un),e.#c=[]}async triggerLoad(){if(this.#u)return;this.#u=!0;const e=this;e.hostLoad&&await VH(e.hostLoad,e),this.#i.length>0&&await Promise.allSettled(this.#i.map(VH)),this.P.resolve(this.#s)}triggerLoaded(){this.loadedCalled||(this.hostLoaded&&un(this.hostLoaded,this),this.#a.forEach(un),this.loadedCalled=!0)}triggerUpdate(e){this.hostUpdate&&un(this.hostUpdate,this,e),this.#o.forEach(Sce,e)}triggerUpdated(e){this.hostUpdated&&un(this.hostUpdated,this,e),this.#l.forEach(Sce,e)}triggerDestroy(){this.hostDestroy&&un(this.hostDestroy,this),this.#h.forEach(un)}triggerLifecycle(){this.hostLifecycle&&this.#p(()=>this.hostLifecycle()),this.#d.forEach(this.#p,this)}#p(e){r3(this.#r);const i=un(e);(Array.isArray(i)?i:[i]).forEach(s=>{typeof s=="function"?this.#c.push(s):typeof s=="object"&&typeof s.remove=="function"&&this.#c.push(s.remove)})}}function Sce(t){un(t,void 0,this)}const jV=JJ,Tce=t=>{if(typeof t!="object"&&typeof t!="function"||t===null)return t;const e={get(r,s,n){if(!((s==="exports"||s==="_exports")&&s in r&&r[s]===i)&&(s in r||s in Promise.prototype||typeof s=="symbol"))return typeof r=="function"?r[s]:Reflect.get(r,s,n)}},i=new Proxy(t,e);return i},Z6e=t=>t.replace(Y6e,(e,i)=>`${i===0?"":"-"}${e.toLowerCase()}`),Y6e=/[A-Z]+(?![a-z])|[A-Z]/gu,Q6e=1,X6e=2,J6e=4,K6e=8,eVe=16,tVe=32,iVe=64,Y1e=t=>{let e=t;for(;e=e.parentNode??e.host;)if(e?.constructor?.lumina){const i=e;return i.manager?.loadedCalled||(i.J??i._offspring).push(t),(i.I??i._postLoad).promise}return!1},$ce={};function Q1e(){}const Uk=Object.defineProperty,rVe=globalThis.HTMLElement??Q1e;var mc,kg,w$,RD,qH;const gne=class gne extends rVe{constructor(){var s;super();dd(this,RD);dd(this,mc);dd(this,kg);dd(this,w$);pd(this,kg,{}),pd(this,w$,[]),this.I=new SR,this.H=new SR,this.J=[];const i=this,r=i.constructor;i._offspring=i.J,i._postLoad=i.I,r.C?.forEach(n=>{Object.hasOwn(i,n)&&(Ur(i,kg)[n]=i[n],delete i[n])}),r.A?TE(s=i,RD,qH).call(s,{a:r.A}):r.B.then(async n=>{var a;await r.K.p,TE(a=i,RD,qH).call(a,await(n.default?.then(o=>typeof o=="function"?{a:o}:o)??n))}).catch(n=>{i.H.reject(n),setTimeout(()=>{throw n})})}static F(){for(const i of this.C??[])Uk(this.prototype,i,{configurable:!0,enumerable:!0,get(){return Ur(this,kg)[i]},set(r){Ur(this,kg)[i]=r}});for(const i of this.E??[])Uk(this.prototype,i,{async value(...r){return Ur(this,mc)||await this.H.promise,await Ur(this,mc)[i](...r)},configurable:!0});for(const i of this.D??[])Uk(this.prototype,i,{value(...r){return Ur(this,mc)[i](...r)},configurable:!0})}get manager(){return Ur(this,mc)?.manager}attributeChangedCallback(i,r,s){Ur(this,mc)?.attributeChangedCallback(i,r,s),Ur(this,mc)||Ur(this,w$).push(i)}connectedCallback(){Ur(this,mc)?Ur(this,mc).connectedCallback?.():queueMicrotask(()=>this.G=Y1e(this))}disconnectedCallback(){Ur(this,mc)?.disconnectedCallback?.()}async componentOnReady(){return await this.H.promise,this}addController(){}requestUpdate(){Ur(this,mc)?.requestUpdate()}};mc=new WeakMap,kg=new WeakMap,w$=new WeakMap,RD=new WeakSet,qH=function(i){const r=this.constructor,s=r.L,n=Ur(this,kg),a=Object.values(i).find(y=>y.L===s),o=`${s}--lazy`;let l=a;for(;l&&!Object.hasOwn(l,"lumina");)l=Object.getPrototypeOf(l);nVe(l),!r.A&&(r.A=a,customElements.define(o,a)),a.N=this;const h=document.createElement(o);a.N=void 0,pd(this,mc,h),pd(this,kg,h),Ur(this,w$).forEach(y=>h.attributeChangedCallback(y,null,this.getAttribute(y))),Object.entries(n).forEach(sVe,h);const f=this.isConnected;(f||this.G)&&(h.connectedCallback?.(),f||h.disconnectedCallback())},gne.lumina=!0;let Cce=gne;function sVe([t,e]){this[t]=e}const nVe=t=>{const e=t.prototype,i=Element.prototype;Object.hasOwn(e,"isConnected")||(e.setAttribute=function(s,n){i.setAttribute.call(this.el,s,n)},e.removeAttribute=function(s){i.removeAttribute.call(this.el,s)},Uk(e,"isConnected",{get(){return Reflect.get(i,"isConnected",this.el)}}))};const KJ={ATTRIBUTE:1,CHILD:2,PROPERTY:3,BOOLEAN_ATTRIBUTE:4},qV=t=>(...e)=>({_$litDirective$:t,values:e});let GV=class{constructor(e){}get _$AU(){return this._$AM._$AU}_$AT(e,i,r){this._$Ct=e,this._$AM=i,this._$Ci=r}_$AS(e,i){return this.update(e,i)}update(e,i){return this.render(...i)}};const aVe=qV(class extends GV{constructor(t){if(super(t),t.type!==KJ.ATTRIBUTE||t.name!=="class"||t.strings?.length>2)throw Error("`classMap()` can only be used in the `class` attribute and must be the only part in the attribute.")}render(t){return" "+Object.keys(t).filter(e=>t[e]).join(" ")+" "}update(t,[e]){if(this.st===void 0){this.st=new Set,t.strings!==void 0&&(this.nt=new Set(t.strings.join(" ").split(/\s/).filter(r=>r!=="")));for(const r in e)e[r]&&!this.nt?.has(r)&&this.st.add(r);return this.render(e)}const i=t.element.classList;for(const r of this.st)r in e||(i.remove(r),this.st.delete(r));for(const r in e){const s=!!e[r];s===this.st.has(r)||this.nt?.has(r)||(s?(i.add(r),this.st.add(r)):(i.remove(r),this.st.delete(r)))}return ov}});const X1e="important",oVe=" !"+X1e,lVe=qV(class extends GV{constructor(t){if(super(t),t.type!==KJ.ATTRIBUTE||t.name!=="style"||t.strings?.length>2)throw Error("The `styleMap` directive must be used in the `style` attribute and must be the only part in the attribute.")}render(t){return Object.keys(t).reduce((e,i)=>{const r=t[i];return r==null?e:e+`${i=i.includes("-")?i:i.replace(/(?:^(webkit|moz|ms|o)|)(?=[A-Z])/g,"-$&").toLowerCase()}:${r};`},"")}update(t,[e]){const{style:i}=t.element;if(this.ft===void 0)return this.ft=new Set(Object.keys(e)),this.render(e);for(const r of this.ft)e[r]==null&&(this.ft.delete(r),r.includes("-")?i.removeProperty(r):i[r]=null);for(const r in e){const s=e[r];if(s!=null){this.ft.add(r);const n=typeof s=="string"&&s.endsWith(oVe);r.includes("-")||n?i.setProperty(r,n?s.slice(0,-11):s,n?X1e:""):i[r]=s}}return ov}});const cVe=t=>t.strings===void 0,uVe={},hVe=(t,e=uVe)=>t._$AH=e;const SP=(t,e)=>{const i=t._$AN;if(i===void 0)return!1;for(const r of i)r._$AO?.(e,!1),SP(r,e);return!0},gN=t=>{let e,i;do{if((e=t._$AM)===void 0)break;i=e._$AN,i.delete(t),t=e}while(i?.size===0)},J1e=t=>{for(let e;e=t._$AM;t=e){let i=e._$AN;if(i===void 0)e._$AN=i=new Set;else if(i.has(t))break;i.add(t),fVe(e)}};function dVe(t){this._$AN!==void 0?(gN(this),this._$AM=t,J1e(this)):this._$AM=t}function pVe(t,e=!1,i=0){const r=this._$AH,s=this._$AN;if(s!==void 0&&s.size!==0)if(e)if(Array.isArray(r))for(let n=i;n<r.length;n++)SP(r[n],!1),gN(r[n]);else r!=null&&(SP(r,!1),gN(r));else SP(this,t)}const fVe=t=>{t.type==KJ.CHILD&&(t._$AP??=pVe,t._$AQ??=dVe)};let mVe=class extends GV{constructor(){super(...arguments),this._$AN=void 0}_$AT(e,i,r){super._$AT(e,i,r),J1e(this),this.isConnected=e._$AU}_$AO(e,i=!0){e!==this.isConnected&&(this.isConnected=e,e?this.reconnected?.():this.disconnected?.()),i&&(SP(this,e),gN(this))}setValue(e){if(cVe(this._$Ct))this._$Ct._$AI(e,this);else{const i=[...this._$Ct._$AH];i[this._$Ci]=e,this._$Ct._$AI(i,this,0)}}disconnected(){}reconnected(){}};const TR=()=>new gVe;let gVe=class{};const T9=new WeakMap,iC=qV(class extends mVe{render(t){return cs}update(t,[e]){const i=e!==this.G;return i&&this.G!==void 0&&this.rt(void 0),(i||this.lt!==this.ct)&&(this.G=e,this.ht=t.options?.host,this.rt(this.ct=t.element)),cs}rt(t){if(this.isConnected||(t=void 0),typeof this.G=="function"){const e=this.ht??globalThis;let i=T9.get(e);i===void 0&&(i=new WeakMap,T9.set(e,i)),i.get(this.G)!==void 0&&this.G.call(this.ht,void 0),i.set(this.G,t),t!==void 0&&this.G.call(this.ht,t)}else this.G.value=t}get lt(){return typeof this.G=="function"?T9.get(this.ht??globalThis)?.get(this.G):this.G?.value}disconnected(){this.lt===this.ct&&this.rt(void 0)}reconnected(){this.rt(this.ct)}});class yVe extends jV{constructor(e){super(e),this.destroyed=!1,this.R=!1,this.V=cs,this.T=[],this.#i=new WeakMap,this.#t=e,this.exports=void 0,this.hasDestroy=GH in e&&typeof e.destroy=="function",j3.prototype.addController.call(e,{hostConnected:()=>{if(this.destroyed){const i=e.el.localName;throw e.el.remove(),new Error(`The ${i} component has already been destroyed. It cannot be used again. If you meant to disconnect and reconnect a component without automatic destroy, set the ${GH} prop.`)}this.#e!==void 0&&clearTimeout(this.#e),BV();for(const i of e.M)"triggerConnected"in i?i.triggerConnected():un(i.hostConnected,i)},hostDisconnected:()=>{for(const i of e.M)"triggerDisconnected"in i?i.triggerDisconnected():un(i.hostDisconnected,i);this.hasDestroy&&!this.destroyed&&this.U()},hostUpdate:()=>{for(const i of e.M)"triggerUpdate"in i?i.triggerUpdate(this.Q):un(i.hostUpdate,i,this.Q)},hostUpdated:()=>{for(const i of e.M)"triggerUpdated"in i?i.triggerUpdated(this.Q):un(i.hostUpdated,i,this.Q);this.Q=void 0}}),queueMicrotask(()=>this.R=!0),r3(e)}#e;#t;async destroy(){if(!this.destroyed){this.#t.el.isConnected&&(this.hasDestroy=!1,this.#t.el.remove()),this.#e=void 0,this.destroyed=!0;for(const e of this.#t.M)"triggerDestroy"in e?e.triggerDestroy():un(e.hostDestroy,e);this.#t.M.splice(0)}}U(){if(this.#e!==void 0&&clearTimeout(this.#e),!this.#t.el.isConnected&&!this.#t.autoDestroyDisabled){const e=()=>{this.#t.destroy()};this.#e=G6e(e,_Ve)}}S(e,i){const r=this.T;this.V=cs,this.T=[],r.forEach(s=>s(e,i))}#i;W(e,i){(typeof i=="object"&&i!==null||typeof i=="function")&&this.#i.set(i,e)}X(e){if(typeof e=="object"&&e!==null||typeof e=="function")return this.#i.get(e)}}let _Ve=1e3;const GH="autoDestroyDisabled";var dw,DD,ID,pw,Cf,KC,K1e,ebe;const bR=class bR extends j3{constructor(){super();dd(this,KC);dd(this,dw);dd(this,DD);dd(this,ID);dd(this,pw);dd(this,Cf);this.M=[],this.manager=new yVe(this);const i=this,r=i.constructor,s=r.N,n=r.K.o,a=bR.prototype.shouldUpdate;pd(i,pw,s?.H??new SR),i.I=s?.I??new SR,i.J=s?.J??[],i._offspring=i.J,i._postLoad=i.I,i.el=s??i,pd(i,ID,i.enableUpdating),i.enableUpdating=Q1e,i.shouldUpdate!==a&&(pd(i,DD,i.shouldUpdate),i.shouldUpdate=a),n&&(pd(i,dw,new Map),r.elementProperties.forEach((o,l)=>Ur(i,dw).set(l,n())))}static finalizeStyles(i){const r=super.finalizeStyles(i),s=this.shadowRootOptions===$ce;return this.K?.commonStyles===void 0||s?r:[this.K.commonStyles,...r]}static createProperty(i,r){const s=typeof r=="number"?r:Array.isArray(r)?r[0]:0,n=Array.isArray(r)?r[1]:void 0,a=n?.hasChanged??qJ,o={attribute:s&Q6e&&typeof i=="string"?Z6e(i):!1,reflect:!!(s&X6e),type:s&J6e?Boolean:s&K6e?Number:void 0,state:!!(s&eVe),readOnly:!!(s&tVe),noAccessor:!!(s&iVe),c:!1,...n,hasChanged(l,c){const h=a(l,c);return o.c=h,h}};super.createProperty(i,o)}static getPropertyDescriptor(i,r,s){const n=this.K,a=super.getPropertyDescriptor(i,r,s);return s.d=a,{...a,get(){return n.t?.(Ur(this,dw).get(i)),a.get?.call(this)},set(o){const l=this.manager;if(s.readOnly&&!UH&&(l.R||l.connectedCalled))throw Error(`Cannot assign to read-only property "${i}" of ${this.el.localName}. Trying to assign "${o}"`);a.set.call(this,o??void 0),s.c&&Ur(this,dw)?.get(i)?.notify(),l.T.length>0&&(BV(),l?.S(i,o))}}}connectedCallback(){if(this.el.hasAttribute("defer-hydration"))return;const i=this.constructor.K.c?.(()=>this.requestUpdate());pd(this,Cf,i);const r=!this.manager.connectedCalled;super.connectedCallback(),r?queueMicrotask(()=>TE(this,KC,ebe).call(this).catch(s=>{Ur(this,pw).reject(s),setTimeout(()=>{throw s})})):i&&this.requestUpdate()}disconnectedCallback(){super.disconnectedCallback(),Ur(this,Cf)?.destroy(),pd(this,Cf,void 0)}createRenderRoot(){const i=this.el.shadowRoot,r=this.constructor,s=r.shadowRootOptions,a=i??(s===$ce?this.el:this.el.attachShadow(s));if(this.isConnected){const o=a.getRootNode();o.adoptedStyleSheets=[...o.adoptedStyleSheets,...r.elementStyles.map(l=>"styleSheet"in l?l.styleSheet:l)]}return a}shouldUpdate(i){var r;return this.manager.Q=i,((r=Ur(this,DD))==null?void 0:r.call(this,i))??!0}update(i){Ur(this,Cf)?TE(this,KC,K1e).call(this,i):super.update(i)}listen(i,r,s){const n=r?.bind(this)??r;this.manager.onLifecycle(()=>(this.el.addEventListener(i,n,s),()=>this.el.removeEventListener(i,n,s)))}listenOn(i,r,s,n){const a=s?.bind(this)??s;this.manager.onLifecycle(()=>(i.addEventListener(r,a,n),()=>i.removeEventListener(r,a,n)))}async componentOnReady(){return await Ur(this,pw).promise,this}addController(i){this.M.push(i),!(VJ in i)&&this.renderRoot&&this.el.isConnected&&i.hostConnected?.()}removeController(i){this.M.splice(this.M.indexOf(i),1),i.controllerRemoved?.()}};dw=new WeakMap,DD=new WeakMap,ID=new WeakMap,pw=new WeakMap,Cf=new WeakMap,KC=new WeakSet,K1e=function(i){try{Ur(this,Cf).clear(),this.constructor.K.r(Ur(this,Cf),()=>ece(bR.prototype,this,"update").call(this,i))}catch(r){throw Ur(this,Cf).clear(),r}},ebe=async function(){const i=this.el.G??Y1e(this.el);i&&await i;const r=[];for(const n of this.M)"triggerLoad"in n?r.push(n.triggerLoad()):r.push(VH(n.hostLoad,n));await Promise.all(r),await this.load?.(),this.manager.hasDestroy&&this.manager.onUpdate(n=>n.has(GH)&&this.manager.U()),Ur(this,ID).call(this,!0),this.performUpdate(),this.I.resolve(),await Promise.resolve();const s=this.J.filter(n=>!n.manager?.loadedCalled);s.length&&await Promise.allSettled(s.map(async n=>await n.componentOnReady())),this.J.length=0,this.el.setAttribute(this.constructor.K.hydratedAttribute,"");for(const n of this.M)"triggerLoaded"in n?n.triggerLoaded():un(n.hostLoaded,n);this.loaded?.(),Ur(this,pw).resolve()},bR.lumina=!0;let lv=bR;const tbe=t=>{let e;const i=s=>{e=new URL(s,globalThis.location?.href||void 0).href},r={...t,getAssetPath(s){const n=new URL(s,e);return n.origin!==globalThis.location?.origin?n.href:n.pathname},setAssetPath:i,customElement(s,n){n.K=r,n.L=s,customElements.get(s)||customElements.define(s,n)}};return i(t.defaultAssetPath),r},gr=t=>typeof t=="object"&&t!=null?aVe(t):t,Mzt=t=>typeof t=="object"&&t!=null?lVe(t):t,XI=cs;function Ezt(t,e,i){i==null?t.removeAttribute(e):t.setAttribute(e,i)}const ibe={toAttribute:t=>t===!0?"":t===!1?null:t},vVe="calcite-mode-auto",bVe="calcite-mode-dark",wVe={rtl:"calcite--rtl"},Azt={filter:250,nextTick:0,resize:150,reposition:100},Ozt=25;function Mce(){const{classList:t}=document.body,e=window.matchMedia("(prefers-color-scheme: dark)").matches,i=()=>t.contains(bVe)||t.contains(vVe)&&e?"dark":"light",r=a=>document.body.dispatchEvent(new CustomEvent("calciteModeChange",{bubbles:!0,detail:{mode:a}})),s=a=>{n!==a&&r(a),n=a};let n=i();r(n),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",a=>s(a.matches?"dark":"light")),new MutationObserver(()=>s(i())).observe(document.body,{attributes:!0,attributeFilter:["class"]})}const TP=globalThis.calciteConfig,Pzt=TP?.focusTrapStack||[],xVe=TP?.logLevel||"info",Ece="3.3.3",SVe="2025-10-08",TVe="7391af08e";function $Ve(){if(TP&&TP.version)return;console.info(`Using Calcite Components ${Ece} [Date: ${SVe}, Revision: ${TVe}]`);const t=TP||globalThis.calciteConfig||{};Object.defineProperty(t,"version",{value:Ece,writable:!1}),globalThis.calciteConfig=t}document.readyState==="interactive"?Mce():document.addEventListener("DOMContentLoaded",Mce,{once:!0});queueMicrotask($Ve);const CVe=tbe({defaultAssetPath:"https://js.arcgis.com/calcite-components/3.3.3/",hydratedAttribute:"calcite-hydrated"}),{customElement:HV,getAssetPath:rbe,setAssetPath:MVe}=CVe;var EVe=["input:not([inert])","select:not([inert])","textarea:not([inert])","a[href]:not([inert])","button:not([inert])","[tabindex]:not(slot):not([inert])","audio[controls]:not([inert])","video[controls]:not([inert])",'[contenteditable]:not([contenteditable="false"]):not([inert])',"details>summary:first-of-type:not([inert])","details:not([inert])"],HH=EVe.join(","),sbe=typeof Element>"u",$R=sbe?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,yN=!sbe&&Element.prototype.getRootNode?function(t){var e;return t==null||(e=t.getRootNode)===null||e===void 0?void 0:e.call(t)}:function(t){return t?.ownerDocument},_N=function t(e,i){var r;i===void 0&&(i=!0);var s=e==null||(r=e.getAttribute)===null||r===void 0?void 0:r.call(e,"inert"),n=s===""||s==="true",a=n||i&&e&&t(e.parentNode);return a},AVe=function(e){var i,r=e==null||(i=e.getAttribute)===null||i===void 0?void 0:i.call(e,"contenteditable");return r===""||r==="true"},nbe=function(e,i,r){if(_N(e))return[];var s=Array.prototype.slice.apply(e.querySelectorAll(HH));return i&&$R.call(e,HH)&&s.unshift(e),s=s.filter(r),s},abe=function t(e,i,r){for(var s=[],n=Array.from(e);n.length;){var a=n.shift();if(!_N(a,!1))if(a.tagName==="SLOT"){var o=a.assignedElements(),l=o.length?o:a.children,c=t(l,!0,r);r.flatten?s.push.apply(s,c):s.push({scopeParent:a,candidates:c})}else{var h=$R.call(a,HH);h&&r.filter(a)&&(i||!e.includes(a))&&s.push(a);var f=a.shadowRoot||typeof r.getShadowRoot=="function"&&r.getShadowRoot(a),y=!_N(f,!1)&&(!r.shadowRootFilter||r.shadowRootFilter(a));if(f&&y){var _=t(f===!0?a.children:f.children,!0,r);r.flatten?s.push.apply(s,_):s.push({scopeParent:a,candidates:_})}else n.unshift.apply(n,a.children)}}return s},obe=function(e){return!isNaN(parseInt(e.getAttribute("tabindex"),10))},lbe=function(e){if(!e)throw new Error("No node provided");return e.tabIndex<0&&(/^(AUDIO|VIDEO|DETAILS)$/.test(e.tagName)||AVe(e))&&!obe(e)?0:e.tabIndex},OVe=function(e,i){var r=lbe(e);return r<0&&i&&!obe(e)?0:r},PVe=function(e,i){return e.tabIndex===i.tabIndex?e.documentOrder-i.documentOrder:e.tabIndex-i.tabIndex},cbe=function(e){return e.tagName==="INPUT"},RVe=function(e){return cbe(e)&&e.type==="hidden"},DVe=function(e){var i=e.tagName==="DETAILS"&&Array.prototype.slice.apply(e.children).some(function(r){return r.tagName==="SUMMARY"});return i},IVe=function(e,i){for(var r=0;r<e.length;r++)if(e[r].checked&&e[r].form===i)return e[r]},LVe=function(e){if(!e.name)return!0;var i=e.form||yN(e),r=function(o){return i.querySelectorAll('input[type="radio"][name="'+o+'"]')},s;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")s=r(window.CSS.escape(e.name));else try{s=r(e.name)}catch(a){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",a.message),!1}var n=IVe(s,e.form);return!n||n===e},kVe=function(e){return cbe(e)&&e.type==="radio"},zVe=function(e){return kVe(e)&&!LVe(e)},FVe=function(e){var i,r=e&&yN(e),s=(i=r)===null||i===void 0?void 0:i.host,n=!1;if(r&&r!==e){var a,o,l;for(n=!!((a=s)!==null&&a!==void 0&&(o=a.ownerDocument)!==null&&o!==void 0&&o.contains(s)||e!=null&&(l=e.ownerDocument)!==null&&l!==void 0&&l.contains(e));!n&&s;){var c,h,f;r=yN(s),s=(c=r)===null||c===void 0?void 0:c.host,n=!!((h=s)!==null&&h!==void 0&&(f=h.ownerDocument)!==null&&f!==void 0&&f.contains(s))}}return n},Ace=function(e){var i=e.getBoundingClientRect(),r=i.width,s=i.height;return r===0&&s===0},NVe=function(e,i){var r=i.displayCheck,s=i.getShadowRoot;if(getComputedStyle(e).visibility==="hidden")return!0;var n=$R.call(e,"details>summary:first-of-type"),a=n?e.parentElement:e;if($R.call(a,"details:not([open]) *"))return!0;if(!r||r==="full"||r==="legacy-full"){if(typeof s=="function"){for(var o=e;e;){var l=e.parentElement,c=yN(e);if(l&&!l.shadowRoot&&s(l)===!0)return Ace(e);e.assignedSlot?e=e.assignedSlot:!l&&c!==e.ownerDocument?e=c.host:e=l}e=o}if(FVe(e))return!e.getClientRects().length;if(r!=="legacy-full")return!0}else if(r==="non-zero-area")return Ace(e);return!1},VVe=function(e){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(var i=e.parentElement;i;){if(i.tagName==="FIELDSET"&&i.disabled){for(var r=0;r<i.children.length;r++){var s=i.children.item(r);if(s.tagName==="LEGEND")return $R.call(i,"fieldset[disabled] *")?!0:!s.contains(e)}return!0}i=i.parentElement}return!1},WH=function(e,i){return!(i.disabled||_N(i)||RVe(i)||NVe(i,e)||DVe(i)||VVe(i))},Oce=function(e,i){return!(zVe(i)||lbe(i)<0||!WH(e,i))},UVe=function(e){var i=parseInt(e.getAttribute("tabindex"),10);return!!(isNaN(i)||i>=0)},BVe=function t(e){var i=[],r=[];return e.forEach(function(s,n){var a=!!s.scopeParent,o=a?s.scopeParent:s,l=OVe(o,a),c=a?t(s.candidates):o;l===0?a?i.push.apply(i,c):i.push(o):r.push({documentOrder:n,tabIndex:l,item:s,isScope:a,content:c})}),r.sort(PVe).reduce(function(s,n){return n.isScope?s.push.apply(s,n.content):s.push(n.content),s},[]).concat(i)},jVe=function(e,i){i=i||{};var r;return i.getShadowRoot?r=abe([e],i.includeContainer,{filter:Oce.bind(null,i),flatten:!1,getShadowRoot:i.getShadowRoot,shadowRootFilter:UVe}):r=nbe(e,i.includeContainer,Oce.bind(null,i)),BVe(r)},qVe=function(e,i){i=i||{};var r;return i.getShadowRoot?r=abe([e],i.includeContainer,{filter:WH.bind(null,i),flatten:!0,getShadowRoot:i.getShadowRoot}):r=nbe(e,i.includeContainer,WH.bind(null,i)),r};const ube={getShadowRoot:!0};function hbe(t){const r=pbe(t,"[dir]");return r?r.getAttribute("dir"):"ltr"}function WV(t){return t.getRootNode()}function Rzt(t){const e=WV(t);return"host"in e?e:null}function dbe(t){return t.host||null}function GVe(t,{selector:e,id:i}){if(!t)return null;t.assignedSlot&&(t=t.assignedSlot);const r=WV(t);return(i?"getElementById"in r?r.getElementById(i):null:e?r.querySelector(e):null)||GVe(dbe(r),{selector:e,id:i})}function pbe(t,e){return t?t.closest(e)||pbe(dbe(WV(t)),e):null}function HVe(t){return typeof t?.setFocus=="function"}async function eK(t,e=!1,i="tabbable",r,s){return t?HVe(t)&&r!==t?t.setFocus(s):(i==="tabbable"?ZVe:QVe)(t,e,s):void 0}function WVe(t,e){if(t)return jVe(t,{...ube,includeContainer:e})[0]??t}function ZVe(t,e,i){WVe(t,e)?.focus(i)}function YVe(t,e){if(t)return qVe(t,{...ube,includeContainer:e})[0]??t}function QVe(t,e,i){YVe(t,e)?.focus(i)}function XVe(t,e){return t.filter(i=>i.matches(e))}function JVe(t,e,i){if(typeof e=="string"&&e!=="")return e;if(e===""||e===!0)return t[i]}function KVe(t){return(!!t).toString()}function Dzt(t){return tK(t)||tUe(t)}function eUe(t){return iUe(t).filter(e=>e.nodeType===Node.TEXT_NODE).map(e=>e.textContent).join("").trim()}function Izt(t){for(const e of t.childNodes)if(e.nodeType===Node.TEXT_NODE&&e.textContent?.trim()!==""||e.nodeType===Node.ELEMENT_NODE)return!0;return!1}function tUe(t){return!!eUe(t)}function iUe(t){return t.currentTarget.assignedNodes({flatten:!0})}function tK(t){return!!rUe(t).length}function rUe(t,e){return sUe(t.currentTarget,e)}function sUe(t,e){const i=t.assignedElements({flatten:!0});return e?XVe(i,e):i}function Lzt(t){return!!(t.isPrimary&&t.button===0)}function kzt(t){return t.detail===0}const zzt=(t,e,i,r=!0,s=!0,n=!1)=>{const a=t.indexOf(e),o=a===0,l=a===t.length-1;r&&(i=i==="previous"&&o?"last":i==="next"&&l?"first":i);let c;return i==="previous"?c=t[a-1]||t[r?t.length-1:a]:i==="next"?c=t[a+1]||t[r?0:a]:i==="last"?c=t[t.length-1]:c=t[0],eK(c,s,"tabbable",n?c:void 0),c};function Fzt(t,e){if(t.parentNode!==e.parentNode)return!1;const i=Array.from(t.parentNode.children);return i.indexOf(t)<i.indexOf(e)}async function Nzt(t,e){return fbe(t,e,"animation")}async function nUe(t,e){return fbe(t,e,"transition")}function Pce(t,e,i){const r=e==="transition"?"transitionProperty":"animationName";return t.getAnimations().find(s=>s[r]===i)}async function fbe(t,e,i){let r=Pce(t,i,e);if(r||(await aUe(),r=Pce(t,i,e)),!!r)try{await r.finished}catch{}}async function aUe(){await new Promise(t=>requestAnimationFrame(()=>t()))}function Vzt(t){return t.endsWith("px")?parseFloat(t):t.endsWith("vw")?Rce(parseFloat(t),window.innerWidth):t.endsWith("vh")?Rce(parseFloat(t),window.innerHeight):0}function Rce(t,e){return t*e/100}function oUe(t,e,i){const r=lUe(t);return new r(e,i)}function lUe(t){class e extends window.MutationObserver{constructor(r){super(r),this.observedEntry=[],this.callback=r}observe(r,s){return this.observedEntry.push({target:r,options:s}),super.observe(r,s)}unobserve(r){const s=this.observedEntry.filter(n=>n.target!==r);this.observedEntry=[],this.callback(super.takeRecords(),this),this.disconnect(),s.forEach(n=>this.observe(n.target,n.options))}}return(function(){return t==="intersection"?window.IntersectionObserver:t==="mutation"?e:window.ResizeObserver})()}function Uzt(t,e,i,r){if(t&&(e&&t.unobserve(e),!!i)){if(t instanceof MutationObserver){t.observe(i,r);return}t.observe(i)}}const Dce=new Set,Ice={trace:0,debug:1,info:2,warn:4,error:8,off:10};function cUe(t){return Ice[t]>=Ice[xVe]}function sT(t,...e){if(!cUe(t))return;console[t].call(this,"%ccalcite","background: #007AC2; color: #fff; border-radius: 4px; padding: 2px 4px;",...e)}let $9;const uUe={debug:t=>sT("debug",t),info:t=>sT("info",t),warn:t=>sT("warn",t),error:t=>sT("error",t),trace:t=>sT("trace",t),deprecated:hUe};function hUe(t,{component:e,name:i,suggested:r,removalVersion:s}){const n=`${t}:${t==="component"?"":e}${i}`;if(Dce.has(n))return;Dce.add(n);const a=Array.isArray(r);a&&!$9&&($9=new Intl.ListFormat("en",{style:"long",type:"disjunction"}));const o=`[${i}] ${t} is deprecated and will be removed in ${s==="future"?"a future version":`v${s}`}.${r?` Use ${a?$9.format(r.map(l=>`"${l}"`)):`"${r}"`} instead.`:""}`;sT("warn",o)}const Lce={flipRtl:"flip-rtl",svg:"svg"},mbe={},C9={},gbe={s:16,m:24,l:32};function ybe({icon:t,scale:e}){const i=gbe[e],r=fUe(t),s=r.charAt(r.length-1)==="F";return`${s?r.substring(0,r.length-1):r}${i}${s?"F":""}`}async function dUe(t){const e=ybe(t),i=_be(e);if(i)return i;C9[e]||(C9[e]=fetch(rbe(`./assets/icon/${e}.json`)).then(s=>s.json()).catch(()=>(uUe.error(`${t.icon} (${t.scale}) icon failed to load`),"")));const r=await C9[e];return mbe[e]=r,r}function pUe(t){return _be(ybe(t))}function _be(t){return mbe[t]}function fUe(t){const e=!isNaN(Number(t.charAt(0))),i=t.split("-");if(i.length>0){const s=/[a-z]/i;t=i.map((n,a)=>n.replace(s,function(l,c){return a===0&&c===0?l:l.toUpperCase()})).join("")}return e?`i${t}`:t}const mUe=zv`:host{--calcite-internal-color-focus: var( --calcite-color-focus, var(--calcite-ui-focus-color, var(--calcite-color-brand)) )}:host{display:inline-flex;color:var(--calcite-icon-color, var(--calcite-ui-icon-color, currentColor))}:host([scale=s]){inline-size:16px;block-size:16px;min-inline-size:16px;min-block-size:16px}:host([scale=m]){inline-size:24px;block-size:24px;min-inline-size:24px;min-block-size:24px}:host([scale=l]){inline-size:32px;block-size:32px;min-inline-size:32px;min-block-size:32px}.flip-rtl{transform:scaleX(-1)}.svg{display:block}:host([hidden]){display:none}[hidden]{display:none}`,LV=class LV extends lv{constructor(){super(...arguments),this.visible=!1,this.flipRtl=!1,this.icon=null,this.preload=!1,this.scale="m"}connectedCallback(){if(super.connectedCallback(),this.preload){this.visible=!0,this.loadIconPathData();return}this.visible||this.waitUntilVisible(()=>{this.visible=!0,this.loadIconPathData()})}willUpdate(e){(e.has("icon")&&(this.hasUpdated||this.icon!==null)||e.has("scale")&&(this.hasUpdated||this.scale!=="m"))&&this.loadIconPathData()}disconnectedCallback(){super.disconnectedCallback(),this.intersectionObserver?.disconnect(),this.intersectionObserver=null}async loadIconPathData(){const{icon:e,scale:i,visible:r}=this;if(!e||!r)return;const s={icon:e,scale:i},n=pUe(s)||await dUe(s);e===this.icon&&(this.pathData=n)}waitUntilVisible(e){if(this.intersectionObserver=oUe("intersection",i=>{i.forEach(r=>{r.isIntersecting&&(this.intersectionObserver.disconnect(),this.intersectionObserver=null,e())})},{rootMargin:"50px"}),!this.intersectionObserver){e();return}this.intersectionObserver.observe(this.el)}render(){const{el:e,flipRtl:i,pathData:r,scale:s,textLabel:n}=this,a=hbe(e),o=gbe[s],l=!!n,c=[].concat(r||"");return this.el.ariaHidden=KVe(!l),this.el.ariaLabel=l?n:null,this.el.role=l?"img":null,En`<svg aria-hidden=true class=${gr({[Lce.flipRtl]:a==="rtl"&&i,[Lce.svg]:!0})} fill=currentColor height=100% viewBox=${`0 0 ${o} ${o}`} width=100% xmlns=http://www.w3.org/2000/svg>${c.map(h=>typeof h=="string"?wce`<path d=${h??cs} />`:wce`<path d=${h.d??cs} opacity=${("opacity"in h?h.opacity:1)??cs} />`)}</svg>`}};LV.properties={pathData:[16,{},{state:!0}],visible:[16,{},{state:!0}],flipRtl:[7,{},{reflect:!0,type:Boolean}],icon:[3,{},{reflect:!0}],preload:[7,{},{reflect:!0,type:Boolean}],scale:[3,{},{reflect:!0}],textLabel:1},LV.styles=mUe;let vN=LV;HV("calcite-icon",vN);const vbe=Object.freeze(Object.defineProperty({__proto__:null,Icon:vN},Symbol.toStringTag,{value:"Module"}));function gUe(){const{disabled:t}=this;t||HTMLElement.prototype.click.call(this)}function bbe(t){t.target.disabled&&t.preventDefault()}const wbe=["mousedown","mouseup","click"];function xbe(t){t.target.disabled&&(t.stopImmediatePropagation(),t.preventDefault())}const bN={capture:!0};function Sbe(t){if(t.disabled){t.el.setAttribute("aria-disabled","true"),t.el.contains(document.activeElement)&&document.activeElement.blur(),yUe(t);return}vUe(t),t.el.removeAttribute("aria-disabled")}function yUe(t){t.el.click=gUe,_Ue(t.el)}function _Ue(t){t.addEventListener("pointerdown",bbe,bN),wbe.forEach(e=>t.addEventListener(e,xbe,bN))}function vUe(t){delete t.el.click,bUe(t.el)}function bUe(t){t.removeEventListener("pointerdown",bbe,bN),wbe.forEach(e=>t.removeEventListener(e,xbe,bN))}const wUe={container:"interaction-container"},Tbe=({children:t,disabled:e})=>En`<div class=${gr(wUe.container)} .inert=${e}>${t}</div>`;function xUe(t){return t==="Enter"||t===" "}const iK=["0","1","2","3","4","5","6","7","8","9"];function $P(t){return t==="l"?"m":"s"}async function SUe(t){await t.componentOnReady(),await t.updateComplete}const rK=t=>(...e)=>{const i=N1e(),r=new t(...e),s=r.exports;F1e(i.at(-1));const n=r.component.manager;n.W(r,s),r.watchExports(n.W.bind(n,r)),v6e(r);const a=[r.component,...i].reverse();return QJ(a,o=>o===void 0?void 0:TUe(r,o,s),s)},TUe=(t,{host:e,key:i,isReactive:r},s)=>{const n=e,a=n[i]!==t.exports,o=n[i]!==s,l=s!==t.exports;if(a&&!o&&l&&(n[i]=t.exports),e===t.component){if(r){const f=t.component.manager;o&&f.W(t,n[i]),t.onUpdate(y=>{if(y.has(i)){const _=n[i];_!==t.exports&&f.W(t,_)}})}t.O=r?void 0:i}const h=t.component.constructor.elementProperties.get(i)?.readOnly;t.watchExports(()=>{n[i]!==t.exports&&(h?S6e(()=>{n[i]=t.exports}):n[i]=t.exports)})};function $Ue(t,e){return t.assignedElements({flatten:!0}).filter(r=>r.matches(e))}const CUe=(t,e)=>{let i=t;for(;i;){if(i===e)return!0;if(!i.parentNode)return!1;i.parentNode instanceof ShadowRoot?i=i.parentNode.host:i=i.parentNode}return!1},$be=(t,e,i)=>{const r=MUe(e).subscribe;return r(s=>{s.some(a=>CUe(t,a.target))&&i()})},M9={},MUe=t=>{const e=t.join(","),i=M9[e];if(i!==void 0)return i;const r=new Set,s=new MutationObserver(a=>r.forEach(o=>o(a)));globalThis.document&&s.observe(document.documentElement,{attributes:!0,attributeFilter:t,subtree:!0});const n={subscribe:a=>(r.add(a),()=>{r.delete(a),r.size===0&&(s.disconnect(),M9[e]=void 0)})};return M9[e]=n,n},Cbe=(t,e)=>{let i=t;for(;i;){const r=i.closest?.(e);if(r)return r;const s=i.getRootNode?.();if(s===globalThis.document)return;i=s.host}};function EUe(t){const e=Cbe(t,".calcite-mode-dark, .calcite-mode-light, .calcite-mode-auto");return e?.classList.contains("calcite-mode-dark")||e?.classList.contains("calcite-mode-auto")&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}const Mbe=(t,e,i)=>Cbe(t,`[${e}]`)?.getAttribute(e)??i,AUe="ar,bg,bs,ca,cs,da,de,el,en,es,et,fi,fr,he,hr,hu,id,it,ja,ko,lt,lv,nl,nb,no,pl,pt-BR,pt-PT,ro,ru,sk,sl,sr,sv,th,tr,uk,vi,zh-CN,zh-HK,zh-TW".split(","),OUe=new Set(AUe),wN="en",PUe={pt:"pt-PT",nb:"no",nn:"no",zh:"zh-CN"},RUe=async(t,e,i="")=>{const r=`${e}/${i}`,s=`${r}${t}.json`;return E9[s]??(E9[s]=Ebe(t,r)),await E9[s]},E9={},Ebe=async(t,e)=>{const i=`${e}${t}.json`;try{const r=await fetch(i);if(r.ok)return await r.json()}catch(r){return console.error(r),{}}return t===wN?{}:await Ebe(wN,e)},Abe=t=>{const e=Mbe(t,"lang",globalThis.navigator?.language||wN);return{lang:e,t9nLocale:Obe(e)}},Obe=t=>{const[e,i]=t.split("-"),r=e.toLowerCase();let s=r;return i&&(s=`${r}-${i.toUpperCase()}`),s=PUe[s]??s,OUe.has(s)?s:i?Obe(r):wN},DUe=(t,e,i,r)=>{let s;const n=()=>IUe(t,e(),r).then(a=>{(s?.lang!==a.lang||s.t9nLocale!==a.t9nLocale||s.t9nStrings!==a.t9nStrings)&&i(a),s=a}).catch(console.error);return queueMicrotask(n),$be(t,["lang"],n)},IUe=async(t,e,i=t.localName.split("-").slice(1).join("-"))=>{const{lang:r,t9nLocale:s}=Abe(t),n=`${e}/${i}/t9n`,o=i===null?{}:await RUe(s,n,"messages.");return{lang:r,t9nLocale:s,t9nStrings:o}},Pbe=t=>Rbe(void 0,t),sK=t=>e=>Rbe(e,t);class LUe extends JJ{constructor(e,i){super(e);const r=this.exports;try{r3(this.component);const s=i(this.component,this),n=this.exports!==r;if(y6e(s)){n||this.setProvisionalExports(s);const a=s.then(o=>{this.exports=o,super.catchUpLifecycle()}).catch(o=>{this.P.reject(o),console.error(o)});this.onLoad(async()=>await a)}else(!n||s!==void 0)&&(this.exports=s),queueMicrotask(()=>super.catchUpLifecycle())}catch(s){this.P.reject(s),console.error(s)}}catchUpLifecycle(){}}const Rbe=rK(LUe),Bzt=(t,e)=>new kUe(t,e);class kUe extends JJ{#e;#t;#i;constructor(e,i){super(),this.#t=e,this.#i=i,this.#e=new MutationObserver(r=>{r.forEach(s=>{e.includes(s.attributeName)&&i.call(this.component,this.component.el.getAttribute(s.attributeName),s.oldValue,s.attributeName)})})}hostConnected(){this.#t.forEach(e=>{this.component.el.hasAttribute(e)&&this.#i.call(this.component,null,this.component.el.getAttribute(e),e)}),this.#e.observe(this.component.el,{attributes:!0,attributeOldValue:!0,attributeFilter:this.#t})}hostDisconnected(){this.#e.disconnect()}}const kce="ltr",zUe=()=>Pbe((t,e)=>{e.exports=kce,e.onLifecycle(()=>{const i=()=>{const r=Mbe(t.el,"dir",kce);e.exports=r==="rtl"?"rtl":"ltr"};return i(),$be(t.el,["dir"],i)})}),FUe=t=>(e={})=>Pbe((i,r)=>{const s=Abe(i.el),n={_lang:s.lang,_t9nLocale:s.t9nLocale,_loading:!0},a=i;r.onLifecycle(()=>DUe(i.el,()=>t("./assets"),({t9nLocale:l,t9nStrings:c,lang:h})=>{const f={...c,_lang:h,_t9nLocale:l,_loading:!1};r.exports=f;const y=c.componentLabel;typeof y=="string"&&"label"in i&&i.label==null&&(i.label??=y),o(a.messageOverrides)},e.name));const o=l=>{const c=r.exports,h=c._original??c,f=Dbe(h,l);l&&(f._original=h),r.exports=f};return"messageOverrides"in a&&r.onUpdate(l=>{l.has("messageOverrides")&&o(a.messageOverrides)}),e.blocking?(r.setProvisionalExports(n,!1),r.ready):n}),Dbe=(t,e)=>{if(!e)return t;const i={...t};return Object.entries(e).forEach(([r,s])=>{typeof s=="object"?i[r]=Dbe(t[r],s):i[r]=s??t[r]}),i},NUe=t=>UUe,VUe="arcgisPropertyChange",UUe=(...t)=>{const e=eM(),i=XJ(VUe,void 0,e);let r=!0;return e.manager.onUpdated(s=>{if(r||!e.el.isConnected){r=!1;return}for(const n of t)s.has(n)&&i.emit({name:n})}),i};const Ibe=FUe(rbe);const nK=()=>sK((t,e)=>{let i;function r(){i?.abort()}return e.onLoad(()=>{t.listen("focus",()=>{i=new AbortController,t.el.addEventListener("focusout",r,{signal:i.signal})})}),e.onDisconnected(()=>{t.el.removeEventListener("focusout",r)}),async(s,n)=>{if(t.disabled)return;const a=jUe(s());if(!a)return;const{target:o,includeContainer:l,strategy:c}=a,h=WV(t.el),f=h.activeElement;if(await SUe(t),!(f!==h.activeElement||i&&!i?.signal.aborted))return t.el.removeEventListener("focus",r),eK(o,l,c,t.el,n)}});function BUe(t){return"target"in t&&("includeContainer"in t||"strategy"in t)}function jUe(t){if(t)return BUe(t)?t:{target:t}}const Bo={title:"title",close:"close",imageContainer:"image-container",chipIcon:"chip-icon",textSlotted:"text--slotted",container:"container",imageSlotted:"image--slotted",closable:"closable",multiple:"multiple",single:"single",selectable:"selectable",selectIcon:"select-icon",selectIconActive:"select-icon--active",nonInteractive:"non-interactive",isCircle:"is-circle",selected:"selected"},qUe={image:"image"},JI={close:"x",checkedSingle:"circle-f",uncheckedMultiple:"square",checkedMultiple:"check-square-f"},GUe=zv`:host{--calcite-internal-color-focus: var( --calcite-color-focus, var(--calcite-ui-focus-color, var(--calcite-color-brand)) )}:host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}:host{display:inline-flex;cursor:default;border-radius:var(--calcite-chip-corner-radius, 9999px)}:host([closed]){display:none}:host([appearance=outline]) .container,:host([appearance=outline-fill]) .container{color:var(--calcite-chip-text-color, var(--calcite-color-text-1))}:host([appearance=outline]) .close,:host([appearance=outline-fill]) .close{color:var(--calcite-chip-close-icon-color, var(--calcite-close-icon-color, var(--calcite-color-text-3)))}:host([appearance=outline]):host([kind=brand]),:host([appearance=outline-fill]):host([kind=brand]){--calcite-internal-chip-border-color: var(--calcite-chip-border-color, var(--calcite-color-brand));--calcite-internal-chip-selectable-hover-border-color: var(--calcite-chip-border-color, var(--calcite-color-brand));--calcite-internal-chip-selectable-active-border-color: var( --calcite-chip-border-color, var(--calcite-color-brand) )}:host([appearance=outline]):host([kind=inverse]),:host([appearance=outline-fill]):host([kind=inverse]){--calcite-internal-chip-border-color: var(--calcite-chip-border-color, var(--calcite-color-border-inverse))}:host([appearance=outline]):host([kind=neutral]),:host([appearance=outline-fill]):host([kind=neutral]){--calcite-internal-chip-border-color: var(--calcite-chip-border-color, var(--calcite-color-border-1))}:host([appearance=outline]){--calcite-internal-chip-background-color: transparent}:host([appearance=outline-fill]){--calcite-internal-chip-background-color: var(--calcite-chip-background-color, var(--calcite-color-foreground-1))}:host([appearance=solid]){--calcite-internal-chip-border-color: transparent;--calcite-internal-chip-selectable-hover-border-color: transparent;--calcite-internal-chip-selectable-active-border-color: transparent}:host([appearance=solid]):host([kind=brand]) .container,:host([appearance=solid]):host([kind=inverse]) .container{color:var(--calcite-chip-text-color, var(--calcite-color-text-inverse))}:host([appearance=solid]):host([kind=brand]) .close,:host([appearance=solid]):host([kind=inverse]) .close{outline-color:var(--calcite-color-text-inverse)}:host([appearance=solid]):host([kind=brand]){--calcite-internal-chip-background-color: var(--calcite-chip-background-color, var(--calcite-color-brand))}:host([appearance=solid]):host([kind=inverse]){--calcite-internal-chip-background-color: var(--calcite-chip-background-color, var(--calcite-color-inverse))}:host([appearance=solid]):host([kind=inverse]) .close:hover{background-color:var(--calcite-color-inverse-hover)}:host([appearance=solid]):host([kind=inverse]) .close:active{background-color:var(--calcite-color-inverse-press)}:host([appearance=solid]):host([kind=neutral]){--calcite-internal-chip-background-color: var(--calcite-chip-background-color, var(--calcite-color-foreground-2))}:host([kind=neutral]) .container{color:var(--calcite-chip-text-color, var(--calcite-color-text-1))}:host([kind=neutral]) .close{color:var(--calcite-chip-close-icon-color, var(--calcite-close-icon-color, var(--calcite-color-text-3)))}:host([selected]) .select-icon{opacity:1}:host([appearance=solid]):host([kind=neutral]){--calcite-internal-chip-selectable-hover-background-color: var(--calcite-color-foreground-3);--calcite-internal-chip-selectable-active-background-color: var(--calcite-color-border-3)}:host([appearance=solid]):host([kind=inverse]){--calcite-internal-chip-selectable-hover-background-color: var(--calcite-color-inverse-hover);--calcite-internal-chip-selectable-active-background-color: var(--calcite-color-inverse-press)}:host([appearance=solid]):host([kind=brand]){--calcite-internal-chip-selectable-hover-background-color: var(--calcite-color-brand-hover);--calcite-internal-chip-selectable-active-background-color: var(--calcite-color-brand-press)}:host([appearance=outline-fill]):host([kind=neutral]){--calcite-internal-chip-selectable-hover-background-color: var(--calcite-color-foreground-2);--calcite-internal-chip-selectable-hover-border-color: var(--calcite-color-border-input);--calcite-internal-chip-selectable-active-background-color: var(--calcite-color-foreground-3);--calcite-internal-chip-selectable-active-border-color: var(--calcite-color-text-3)}:host([appearance=outline-fill]):host([kind=inverse]),:host([appearance=outline-fill]):host([kind=brand]){--calcite-internal-chip-selectable-hover-background-color: var(--calcite-color-foreground-2);--calcite-internal-chip-selectable-active-background-color: var(--calcite-color-foreground-3)}:host([appearance=outline]):host([kind=neutral]){--calcite-internal-chip-selectable-hover-background-color: var(--calcite-color-transparent-hover);--calcite-internal-chip-selectable-hover-border-color: var(--calcite-color-border-input);--calcite-internal-chip-selectable-active-background-color: var(--calcite-color-transparent-press);--calcite-internal-chip-selectable-active-border-color: var(--calcite-color-text-3)}:host([appearance=outline]):host([kind=inverse]),:host([appearance=outline]):host([kind=brand]){--calcite-internal-chip-selectable-hover-background-color: var(--calcite-color-transparent-hover);--calcite-internal-chip-selectable-active-background-color: var(--calcite-color-transparent-press)}:host([scale=s]) .container{--calcite-internal-chip-block-size: var(--calcite-size-sm, 1.5rem) ;--calcite-internal-chip-container-space-x-end: var(--calcite-spacing-xxs, .25rem) ;--calcite-internal-chip-container-space-x-start: var(--calcite-spacing-xxs, .25rem) ;--calcite-internal-chip-font-size: var(--calcite-font-size--2);--calcite-internal-chip-icon-size: var(--calcite-size-xs, 1rem) ;--calcite-internal-chip-icon-space: var(--calcite-spacing-xxs, .25rem) ;--calcite-internal-chip-image-size: var(--calcite-spacing-xl, 1.25rem) ;--calcite-internal-chip-title-space: var(--calcite-spacing-xxs, .25rem) ;--calcite-internal-close-size: var(--calcite-size-xs, 1rem) }:host([scale=s]) .container:not(.closable).is-circle{--calcite-internal-chip-container-space-x-start: var(--calcite-spacing-px);--calcite-internal-chip-container-space-x-end: var(--calcite-spacing-px)}:host([scale=s]) .container.image--slotted:has(.chip-icon),:host([scale=s]) .container.image--slotted.text--slotted,:host([scale=s]) .container.image--slotted.closable{--calcite-internal-chip-image-space-x-end: var(--calcite-spacing-xxs, .25rem) }:host([scale=s]) .container.image--slotted:not(.text--slotted,:has(.chip-icon)),:host([scale=s]) .container.image--slotted:not(.selectable){--calcite-internal-chip-container-space-x-start: var(--calcite-spacing-px)}:host([scale=s]) .container.selectable.single:not(.is-circle).image--slotted{--calcite-internal-chip-container-space-x-start: var(--calcite-spacing-px)}:host([scale=s]) .container.selectable.single:not(.is-circle).selected{--calcite-internal-chip-select-space-x-end: var(--calcite-spacing-xs, .375rem) ;--calcite-internal-chip-select-space-x-start: var(--calcite-spacing-none, 0)}:host([scale=s]) .container.selectable.single:not(.is-circle).selected.image--slotted{--calcite-internal-chip-select-space-x-end: .5rem ;--calcite-internal-chip-select-space-x-start: .125rem }:host([scale=s]) .container.multiple:not(.is-circle){--calcite-internal-chip-container-space-x-start: var(--calcite-spacing-xxs, .25rem) ;--calcite-internal-chip-select-space-x-end: var(--calcite-spacing-xxs, .25rem) ;--calcite-internal-chip-select-space-x-start: var(--calcite-spacing-xxs, .25rem) }:host([scale=s]) .container.multiple:not(.is-circle).image--slotted{--calcite-internal-chip-select-space-x-end: .5rem ;--calcite-internal-chip-select-space-x-start: var(--calcite-spacing-xs, .375rem) ;--calcite-internal-chip-container-space-x-start: var(--calcite-spacing-px)}:host([scale=s]) .container.multiple:not(.is-circle).image--slotted:not(.text--slotted){--calcite-internal-chip-select-space-x-start: var(--calcite-spacing-xs, .375rem) }:host([scale=m]) .container{--calcite-internal-chip-block-size: var(--calcite-size-md, 2rem) ;--calcite-internal-chip-container-space-x-end: var(--calcite-spacing-xs, .375rem) ;--calcite-internal-chip-container-space-x-start: var(--calcite-spacing-xs, .375rem) ;--calcite-internal-chip-font-size: var(--calcite-font-size--1);--calcite-internal-chip-icon-size: var(--calcite-size-sm, 1.5rem) ;--calcite-internal-chip-icon-space: var(--calcite-spacing-xs, .375rem) ;--calcite-internal-chip-image-size: var(--calcite-size-sm, 1.5rem) ;--calcite-internal-chip-title-space: var(--calcite-spacing-xs, .375rem) ;--calcite-internal-close-size: var(--calcite-size-sm, 1.5rem) }:host([scale=m]) .container:not(.closable).is-circle{--calcite-internal-chip-container-space-x-end: var(--calcite-spacing-px);--calcite-internal-chip-container-space-x-start: var(--calcite-spacing-px)}:host([scale=m]) .container.image--slotted:not(.is-circle){--calcite-internal-chip-container-space-x-start: var(--calcite-spacing-xxs, .25rem) }:host([scale=m]) .container.image--slotted:has(.chip-icon),:host([scale=m]) .container.image--slotted.text--slotted,:host([scale=m]) .container.image--slotted.closable{--calcite-internal-chip-image-space-x-end: var(--calcite-spacing-xs, .375rem) }:host([scale=m]) .container.selectable.single:not(.is-circle).image--slotted{--calcite-internal-chip-container-space-x-start: var(--calcite-spacing-xxs, .25rem) }:host([scale=m]) .container.selectable.single:not(.is-circle).selected{--calcite-internal-chip-select-space-x-end: var(--calcite-spacing-px);--calcite-internal-chip-select-space-x-start: var(--calcite-spacing-none, 0)}:host([scale=m]) .container.selectable.single:not(.is-circle).selected.image--slotted{--calcite-internal-chip-select-space-x-end: var(--calcite-spacing-xxs, .25rem) ;--calcite-internal-chip-select-space-x-start: var(--calcite-spacing-xs, .375rem) }:host([scale=m]) .container.multiple:not(.is-circle){--calcite-internal-chip-select-space-x-end: .125rem ;--calcite-internal-chip-select-space-x-start: .125rem }:host([scale=m]) .container.multiple:not(.is-circle).image--slotted{--calcite-internal-chip-select-space-x-end: .5rem ;--calcite-internal-chip-select-space-x-start: var(--calcite-spacing-xxs, .25rem) }:host([scale=m]) .container.closable:not(.is-circle){--calcite-internal-chip-container-space-x-end: var(--calcite-spacing-xxs, .25rem) }:host([scale=l]) .container{--calcite-internal-chip-block-size: 2.75rem ;--calcite-internal-chip-container-space-x-end: .5rem ;--calcite-internal-chip-container-space-x-start: .5rem ;--calcite-internal-chip-font-size: var(--calcite-font-size-0);--calcite-internal-chip-icon-size: var(--calcite-size-md, 2rem) ;--calcite-internal-chip-icon-space: .5rem ;--calcite-internal-chip-image-size: var(--calcite-size-md, 2rem) ;--calcite-internal-chip-title-space: .5rem ;--calcite-internal-close-size: var(--calcite-size-md, 2rem) }:host([scale=l]) .container:not(.closable).is-circle{--calcite-internal-chip-container-space-x-end: var(--calcite-spacing-xxs, .25rem) ;--calcite-internal-chip-container-space-x-start: var(--calcite-spacing-xxs, .25rem) }:host([scale=l]) .container.image--slotted:not(.is-circle){--calcite-internal-chip-container-space-x-start: var(--calcite-spacing-xs, .375rem) }:host([scale=l]) .container.image--slotted:has(.chip-icon),:host([scale=l]) .container.image--slotted.text--slotted,:host([scale=l]) .container.image--slotted.closable{--calcite-internal-chip-image-space-x-end: .5rem }:host([scale=l]) .container.selectable.single:not(.is-circle).image--slotted{--calcite-internal-chip-container-space-x-start: var(--calcite-spacing-xs, .375rem) }:host([scale=l]) .container.selectable.single:not(.is-circle).selected{--calcite-internal-chip-select-space-x-end: var(--calcite-spacing-xxs, .25rem) ;--calcite-internal-chip-select-space-x-start: var(--calcite-spacing-none, 0)}:host([scale=l]) .container.selectable.single:not(.is-circle).selected.image--slotted{--calcite-internal-chip-select-space-x-end: var(--calcite-spacing-xs, .375rem) ;--calcite-internal-chip-select-space-x-start: .5rem }:host([scale=l]) .container.multiple:not(.is-circle){--calcite-internal-chip-container-space-x-start: .5rem ;--calcite-internal-chip-select-space-x-end: var(--calcite-spacing-xxs, .25rem) ;--calcite-internal-chip-select-space-x-start: var(--calcite-spacing-xxs, .25rem) }:host([scale=l]) .container.multiple:not(.is-circle).image--slotted{--calcite-internal-chip-select-space-x-end: .75rem }:host([scale=l]) .container.closable:not(.is-circle){--calcite-internal-chip-container-space-x-end: var(--calcite-spacing-xs, .375rem) }.container{box-sizing:border-box;display:inline-flex;block-size:100%;max-inline-size:100%;align-items:center;justify-content:center;font-weight:var(--calcite-font-weight-medium);outline-color:transparent;background-color:var(--calcite-internal-chip-background-color);border-color:var(--calcite-internal-chip-border-color);border-radius:var(--calcite-chip-corner-radius, 9999px);border-width:var(--calcite-border-width-sm);border-style:solid;font-size:var(--calcite-internal-chip-font-size, var(--calcite-font-size));padding-inline-start:var(--calcite-internal-chip-container-space-x-start);padding-inline-end:var(--calcite-internal-chip-container-space-x-end);block-size:var(--calcite-internal-chip-block-size, auto);inline-size:var(--calcite-internal-chip-inline-size, auto);min-inline-size:var(--calcite-internal-chip-block-size, auto)}.container:hover .select-icon--active{opacity:var(--calcite-opacity-full, 1)}.container.selectable{cursor:pointer}.container.selectable:hover{background-color:var(--calcite-internal-chip-selectable-hover-background-color);border-color:var(--calcite-internal-chip-selectable-hover-border-color)}.container.selectable:active{background-color:var(--calcite-internal-chip-selectable-active-background-color);border-color:var(--calcite-internal-chip-selectable-active-border-color)}.container:not(.non-interactive):focus{outline:var(--calcite-border-width-md) solid var(--calcite-color-focus, var(--calcite-ui-focus-color, var(--calcite-color-brand)));outline:var(--calcite-border-width-md) solid var(--calcite-internal-color-focus);outline-offset:calc(var(--calcite-spacing-base) * calc(1 - (2*clamp(0,var(--calcite-offset-invert-focus),1))))}.container.text--slotted .title{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.container:not(.text--slotted) .title,.container:not(.image--slotted) .image-container{display:none}.container.is-circle .chip-icon,.container.is-circle .image-container{padding:var(--calcite-spacing-none, 0)}.title{padding-inline:var(--calcite-internal-chip-title-space)}.image-container{display:inline-flex;overflow:hidden;align-items:center;justify-content:center;pointer-events:none;block-size:var(--calcite-internal-chip-image-size, var(--calcite-spacing-xxl, 1.5rem));inline-size:var(--calcite-internal-chip-image-size, var(--calcite-spacing-xxl, 1.5rem));padding-inline-start:var(--calcite-spacing-none, 0);padding-inline-end:var(--calcite-internal-chip-image-space-x-end, 0)}.chip-icon{position:relative;margin-block:0px;display:inline-flex;transition-timing-function:cubic-bezier(.4,0,.2,1);color:var(--calcite-chip-icon-color, var(--calcite-chip-text-color, var(--calcite-icon-color, currentColor)));padding-inline:var(--calcite-internal-chip-icon-space, var(--calcite-spacing-xs, .375rem))}.select-icon{align-self:center;justify-content:center;align-items:center;display:flex;inset-block-start:-1px;position:absolute;visibility:hidden;inline-size:auto;opacity:0;transition:opacity .15s ease-in-out,inline-size .15s ease-in-out;color:var(--calcite-chip-select-icon-color, currentColor)}.select-icon.select-icon--active{position:relative;visibility:visible;opacity:var(--calcite-opacity-half, .5);color:var(--calcite-chip-select-icon-color-press, var(--calcite-chip-select-icon-color-pressed, var(--calcite-chip-select-icon-color, currentColor)))}.multiple .select-icon{display:flex;align-items:center;justify-content:center}.multiple .select-icon,.single .select-icon--active{padding-inline-start:var(--calcite-internal-chip-select-space-x-start);padding-inline-end:var(--calcite-internal-chip-select-space-x-end);block-size:var(--calcite-internal-chip-icon-size, var(--calcite-spacing-xxl, 1.5rem));inline-size:var(--calcite-internal-chip-icon-size, var(--calcite-spacing-xxl, 1.5rem))}slot[name=image]::slotted(*){display:flex;block-size:100%;inline-size:100%;overflow:hidden;border-radius:50%}.close{margin:0;cursor:pointer;align-items:center;border-radius:50%;border-style:none;transition-property:background-color,block-size,border-color,box-shadow,color,inset-block-end,inset-block-start,inset-inline-end,inset-inline-start,inset-size,opacity,outline-color,transform;transition-duration:var(--calcite-animation-timing);transition-timing-function:ease-in-out;outline-color:transparent;background-color:var(--calcite-close-background-color, var(--calcite-color-transparent));-webkit-appearance:none;display:flex;align-content:center;justify-content:center;color:var(--calcite-chip-close-icon-color, var(--calcite-close-icon-color, currentColor));block-size:var(--calcite-internal-close-size, var(--calcite-spacing-xxl, 1.5rem));inline-size:var(--calcite-internal-close-size, var(--calcite-spacing-xxl, 1.5rem));padding:0}.close:hover,.close:focus{background-color:var(--calcite-close-background-color-hover, var(--calcite-color-transparent-hover))}.close:focus{outline:var(--calcite-border-width-md) solid var(--calcite-color-focus, var(--calcite-ui-focus-color, var(--calcite-color-brand)));outline:var(--calcite-border-width-md) solid var(--calcite-internal-color-focus);outline-offset:calc(calc(-1 * var(--calcite-spacing-base)) * calc(1 - (2*clamp(0,var(--calcite-offset-invert-focus),1))))}.close:active{background-color:var(--calcite-close-background-color-press, var(--calcite-color-transparent-press))}.close calcite-icon{color:inherit}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}.interaction-container{display:contents}:host([hidden]){display:none}[hidden]{display:none}`,kV=class kV extends lv{constructor(){super(),this.closeButtonRef=TR(),this.containerRef=TR(),this.messages=Ibe(),this.focusSetter=nK()(this),this.hasImage=!1,this.hasText=!1,this.appearance="solid",this.closable=!1,this.closed=!1,this.closeOnDelete=!1,this.disabled=!1,this.iconFlipRtl=!1,this.interactive=!1,this.kind="neutral",this.scale="m",this.selected=!1,this.selectionMode="none",this.calciteChipClose=Pc({cancelable:!1}),this.calciteChipSelect=Pc({cancelable:!1}),this.calciteInternalChipKeyEvent=Pc({cancelable:!1}),this.calciteInternalChipSelect=Pc({cancelable:!1}),this.calciteInternalSyncSelectedChips=Pc({cancelable:!1}),this.listen("keydown",this.keyDownHandler),this.listen("click",this.clickHandler)}async setFocus(e){return this.focusSetter(()=>{if(this.interactive)return this.containerRef.value;if(this.closable)return this.closeButtonRef.value},e)}async load(){this.updateHasText()}willUpdate(e){e.has("selected")&&this.hasUpdated&&this.watchSelected(this.selected)}updated(){Sbe(this)}loaded(){this.selectionMode!=="none"&&this.interactive&&this.selected&&this.handleSelectionPropertyChange(this.selected)}watchSelected(e){this.selectionMode!=="none"&&this.handleSelectionPropertyChange(e)}keyDownHandler(e){if(e.target===this.el)switch(e.key){case" ":case"Enter":this.handleEmittingEvent(),e.preventDefault();break;case"Backspace":case"Delete":this.closable&&!this.closed&&this.closeOnDelete&&(e.preventDefault(),this.close());break;case"ArrowRight":case"ArrowLeft":case"Home":case"End":this.calciteInternalChipKeyEvent.emit(e),e.preventDefault();break}}clickHandler(){!this.interactive&&this.closable&&eK(this.closeButtonRef.value)}handleDefaultSlotChange(){this.updateHasText()}close(){this.calciteChipClose.emit(),this.selected=!1,this.closed=!0}closeButtonKeyDownHandler(e){xUe(e.key)&&(e.preventDefault(),this.close())}updateHasText(){this.hasText=this.el.textContent.trim().length>0}handleSlotImageChange(e){this.hasImage=tK(e)}handleEmittingEvent(){this.interactive&&this.calciteChipSelect.emit()}handleSelectionPropertyChange(e){this.selectionMode==="single"&&this.calciteInternalSyncSelectedChips.emit(),!this.parentChipGroup.selectedItems.includes(this.el)&&e&&this.selectionMode!=="multiple"&&this.calciteInternalChipSelect.emit(),this.selectionMode!=="single"&&this.calciteInternalSyncSelectedChips.emit()}renderChipImage(){return En`<div class=${gr(Bo.imageContainer)}><slot name=${qUe.image} @slotchange=${this.handleSlotImageChange}></slot></div>`}renderSelectionIcon(){const e=this.selectionMode==="multiple"?this.selected?JI.checkedMultiple:JI.uncheckedMultiple:this.selected?JI.checkedSingle:void 0;return En`<div class=${gr({[Bo.selectIcon]:!0,[Bo.selectIconActive]:this.selectionMode==="multiple"||this.selected})}>${e?En`<calcite-icon .icon=${e} .scale=${$P(this.scale)}></calcite-icon>`:null}</div>`}renderCloseButton(){return En`<button .ariaLabel=${this.messages.dismissLabel} class=${gr(Bo.close)} @click=${this.close} @keydown=${this.closeButtonKeyDownHandler} .tabIndex=${this.disabled?-1:0} ${iC(this.closeButtonRef)}><calcite-icon .icon=${JI.close} .scale=${$P(this.scale)}></calcite-icon></button>`}renderIcon(){return En`<calcite-icon class=${gr(Bo.chipIcon)} .flipRtl=${this.iconFlipRtl} .icon=${this.icon} .scale=${$P(this.scale)}></calcite-icon>`}render(){const{disabled:e}=this,i=e||!e&&!this.interactive,r=this.selectionMode==="multiple"&&this.interactive?"checkbox":this.selectionMode!=="none"&&this.interactive?"radio":this.interactive?"button":"img";return Tbe({disabled:e,children:En`<div .ariaChecked=${this.selectionMode!=="none"&&this.interactive?this.selected:void 0} .ariaLabel=${this.label} class=${gr({[Bo.container]:!0,[Bo.textSlotted]:this.hasText,[Bo.imageSlotted]:this.hasImage,[Bo.selectable]:this.selectionMode!=="none",[Bo.multiple]:this.selectionMode==="multiple",[Bo.single]:this.selectionMode==="single"||this.selectionMode==="single-persist",[Bo.selected]:this.selected,[Bo.closable]:this.closable,[Bo.nonInteractive]:!this.interactive,[Bo.isCircle]:!this.closable&&!this.hasText&&(!this.icon||!this.hasImage)&&(this.selectionMode==="none"||!!this.selectionMode&&this.selectionMode!=="multiple"&&!this.selected)})} @click=${this.handleEmittingEvent} .role=${r} .tabIndex=${i?-1:0} ${iC(this.containerRef)}>${this.selectionMode!=="none"&&this.renderSelectionIcon()||""}${this.renderChipImage()}${this.icon&&this.renderIcon()||""}<span class=${gr(Bo.title)}><slot @slotchange=${this.handleDefaultSlotChange}></slot></span>${this.closable&&this.renderCloseButton()||""}</div>`})}};kV.properties={hasImage:[16,{},{state:!0}],hasText:[16,{},{state:!0}],appearance:[3,{},{reflect:!0}],closable:[7,{},{reflect:!0,type:Boolean}],closed:[7,{},{reflect:!0,type:Boolean}],closeOnDelete:[7,{},{reflect:!0,type:Boolean}],disabled:[7,{},{reflect:!0,type:Boolean}],icon:[3,{},{reflect:!0}],iconFlipRtl:[7,{},{reflect:!0,type:Boolean}],interactive:[5,{},{type:Boolean}],kind:[3,{},{reflect:!0}],label:1,messageOverrides:[0,{},{attribute:!1}],parentChipGroup:[0,{},{attribute:!1}],scale:[3,{},{reflect:!0}],selected:[7,{},{reflect:!0,type:Boolean}],selectionMode:1,value:1},kV.styles=GUe;let xN=kV;HV("calcite-chip",xN);const jzt=Object.freeze(Object.defineProperty({__proto__:null,Chip:xN},Symbol.toStringTag,{value:"Module"}));const zce=qV(class extends GV{constructor(){super(...arguments),this.key=cs}render(t,e){return this.key=t,e}update(t,[e,i]){return e!==this.key&&(hVe(t),this.key=e),i}});const HUe=new RegExp("\\.(0+)?$"),WUe=new RegExp("0+$"),Jr=class Jr{constructor(e){if(e instanceof Jr)return e;const[i,r]=e8e(e).split(".").concat("");this.value=BigInt(i+r.padEnd(Jr.DECIMALS,"0").slice(0,Jr.DECIMALS))+BigInt(Jr.ROUNDED&&r[Jr.DECIMALS]>="5"),this.isNegative=e.charAt(0)==="-"}getIntegersAndDecimals(){const e=this.value.toString().replace("-","").padStart(Jr.DECIMALS+1,"0"),i=e.slice(0,-Jr.DECIMALS),r=e.slice(-Jr.DECIMALS).replace(WUe,"");return{integers:i,decimals:r}}toString(){const{integers:e,decimals:i}=this.getIntegersAndDecimals();return`${this.isNegative?"-":""}${e}${i.length?"."+i:""}`}formatToParts(e){const{integers:i,decimals:r}=this.getIntegersAndDecimals(),s=e.numberFormatter.formatToParts(BigInt(i));return this.isNegative&&s.unshift({type:"minusSign",value:e.minusSign}),r.length&&(s.push({type:"decimal",value:e.decimal}),r.split("").forEach(n=>s.push({type:"fraction",value:n}))),s}format(e){const{integers:i,decimals:r}=this.getIntegersAndDecimals(),s=`${this.isNegative?e.minusSign:""}${e.numberFormatter.format(BigInt(i))}`,n=r.length?`${e.decimal}${r.split("").map(a=>e.numberFormatter.format(Number(a))).join("")}`:"";return`${s}${n}`}add(e){return Jr.fromBigInt(this.value+new Jr(e).value)}subtract(e){return Jr.fromBigInt(this.value-new Jr(e).value)}multiply(e){return Jr._divRound(this.value*new Jr(e).value,Jr.SHIFT)}divide(e){return Jr._divRound(this.value*Jr.SHIFT,new Jr(e).value)}};Jr.DECIMALS=100,Jr.ROUNDED=!0,Jr.SHIFT=BigInt("1"+"0".repeat(Jr.DECIMALS)),Jr._divRound=(e,i)=>Jr.fromBigInt(e/i+(Jr.ROUNDED?e*BigInt(2)/i%BigInt(2):BigInt(0))),Jr.fromBigInt=e=>Object.assign(Object.create(Jr.prototype),{value:e,isNegative:e<BigInt(0)});let CR=Jr;function aK(t){return!(!t||isNaN(Number(t)))}function qzt(t){return!t||!t8e(t)?"":SN(t,e=>{let i=!1;const r=e.split("").filter((s,n)=>s.match(/\./g)&&!i?(i=!0,!0):s.match(/-/g)&&n===0?!0:iK.includes(s)).join("");return aK(r)?new CR(r).toString():""})}const Lbe=/^([-0])0+(?=\d)/,ZUe=/(?!^\.)\.$/,YUe=/(?!^-)-/g,QUe=/^-\b0\b\.?0*$/,XUe=/0*$/,JUe=new Set(["e","E","-",",",".",...iK]),Gzt=t=>{const e=Array.from(t).filter(i=>JUe.has(i)).join("");return SN(e,i=>{const r=i.replace(YUe,"").replace(ZUe,"").replace(Lbe,"$1");return aK(r)?QUe.test(r)?r:KUe(r):i})};function KUe(t){const e=t.split(".")[1],i=new CR(t).toString(),[r,s]=i.split(".");return e&&s!==e?`${r}.${e}`:i}function SN(t,e){if(!t)return t;const i=t.toLowerCase().indexOf("e")+1;return i?t.replace(/[eE]*$/g,"").substring(0,i).concat(t.slice(i).replace(/[eE]/g,"")).split(/[eE]/).map((r,s)=>e(s===1?r.replace(/\./g,""):r)).join("e").replace(/^e/,"1e"):e(t)}function e8e(t){const e=t.split(/[eE]/);if(e.length===1)return t;const i=+t;if(Number.isSafeInteger(i))return`${i}`;const r=t.charAt(0)==="-",s=+e[1],n=e[0].split("."),a=(r?n[0].substring(1):n[0])||"",o=n[1]||"",l=(f,y)=>{const _=Math.abs(y)-f.length,w=_>0?`${"0".repeat(_)}${f}`:f;return`${w.slice(0,y)}.${w.slice(y)}`},c=(f,y)=>{const _=y>f.length?`${f}${"0".repeat(y-f.length)}`:f;return`${_.slice(0,y)}.${_.slice(y)}`},h=s>0?`${a}${c(o,s)}`:`${l(a,s)}${o}`;return`${r?"-":""}${h.charAt(0)==="."?"0":""}${h.replace(HUe,"").replace(Lbe,"")}`}function t8e(t){return iK.some(e=>t.includes(e))}function Hzt(t,e,i){const r=e.split(".")[1];if(r){const s=r.match(XUe)[0];if(s&&i.delocalize(t).length!==e.length&&r.indexOf("e")===-1){const n=i.decimal;return t=t.includes(n)?t:`${t}${n}`,t.padEnd(t.length+s.length,i.localize("0"))}}return t}const TN="en",i8e=["ar","bg","bs","ca","cs","da","de","de-AT","de-CH","el",TN,"en-AU","en-CA","en-GB","es","es-MX","et","fi","fr","fr-CH","he","hi","hr","hu","id","it","it-CH","ja","ko","lt","lv","mk","no","nl","pl","pt","pt-PT","ro","ru","sk","sl","sr","sv","th","tr","uk","vi","zh-CN","zh-HK","zh-TW"];new Map(Object.entries({bg:{am:"..",pm:".."},bs:{am:"prijepodne",pm:"popodne"},ca:{am:"a.m.",pm:"p.m."},cs:{am:"dop.",pm:"odp."},es:{am:"a.m.",pm:"p.m."},"es-mx":{am:"a.m.",pm:"p.m."},"es-MX":{am:"a.m.",pm:"p.m."},fi:{am:"ap.",pm:"ip."},he:{am:"",pm:""},hu:{am:"de. ",pm:"du."},lt:{am:"priepiet",pm:"popiet"},lv:{am:"priekpusdien",pm:"pcpusdien"},mk:{am:".",pm:"."},no:{am:"a.m.",pm:"p.m."},nl:{am:"a.m.",pm:"p.m."},"pt-pt":{am:"da manh",pm:"da tarde"},"pt-PT":{am:"da manh",pm:"da tarde"},ro:{am:"a.m.",pm:"p.m."},sl:{am:"dop.",pm:"pop."},sv:{am:"fm",pm:"em"},th:{am:"",pm:""},tr:{am:"",pm:"S"},uk:{am:"",pm:""},vi:{am:"SA",pm:"CH"}}));const r8e=["arab","arabext","latn"],A9=[...i8e],kbe=t=>r8e.includes(t),O9=new Intl.NumberFormat().resolvedOptions().numberingSystem,zbe=O9==="arab"||!kbe(O9)?"latn":O9,s8e=t=>kbe(t)?t:zbe;function n8e(t){return t?A9.includes(t)?t:(t=t.toLowerCase(),t.includes("-")&&(t=t.replace(/(\w+)-(\w+)/,(e,i,r)=>`${i}-${r.toUpperCase()}`),A9.includes(t)||(t=t.split("-")[0])),t==="nb"||t==="nn"?"no":t==="zh"?"zh-CN":A9.includes(t)?t:(console.warn(`Translations for the "${t}" locale are not available and will fall back to the default, English (en).`),TN)):TN}class Fbe{constructor(){this.delocalize=e=>this._numberFormatOptions?SN(e,i=>i.replace(new RegExp(`[${this._minusSign}]`,"g"),"-").replace(new RegExp(`[${this._group}]`,"g"),"").replace(new RegExp(`[${this._decimal}]`,"g"),".").replace(new RegExp(`[${this._digits.join("")}]`,"g"),this._getDigitIndex)):e,this.localize=e=>this._numberFormatOptions?SN(e,i=>aK(i.trim())?new CR(i.trim()).format(this).replace(new RegExp(`[${this._actualGroup}]`,"g"),this._group):i):e}get group(){return this._group}get decimal(){return this._decimal}get minusSign(){return this._minusSign}get digits(){return this._digits}get numberFormatter(){return this._numberFormatter}get numberFormatOptions(){return this._numberFormatOptions}set numberFormatOptions(e){if(e.locale=n8e(e?.locale),e.numberingSystem=s8e(e?.numberingSystem),!this._numberFormatOptions&&e.locale===TN&&e.numberingSystem===zbe&&Object.keys(e).length===2||JSON.stringify(this._numberFormatOptions)===JSON.stringify(e))return;this._numberFormatOptions=e,this._numberFormatter=new Intl.NumberFormat(this._numberFormatOptions.locale,this._numberFormatOptions),this._digits=[...new Intl.NumberFormat(this._numberFormatOptions.locale,{useGrouping:!1,numberingSystem:this._numberFormatOptions.numberingSystem}).format(9876543210)].reverse();const i=new Map(this._digits.map((s,n)=>[s,n])),r=new Intl.NumberFormat(this._numberFormatOptions.locale,{numberingSystem:this._numberFormatOptions.numberingSystem}).formatToParts(-123456789e-1);this._actualGroup=r.find(s=>s.type==="group").value,this._group=this._actualGroup.trim().length===0||this._actualGroup==" "?"":this._actualGroup,this._decimal=e.locale==="bs"||e.locale==="mk"?",":r.find(s=>s.type==="decimal").value,this._minusSign=r.find(s=>s.type==="minusSign").value,this._getDigitIndex=s=>i.get(s)}}const Wzt=new Fbe;function Fce(t){return t[t.openProp||"open"]}async function a8e(t){await t.updateComplete,Fce(t)?t.onBeforeOpen():t.onBeforeClose(),await t.updateComplete,t.transitionEl&&await nUe(t.transitionEl,t.transitionProp),Fce(t)?t.onOpen():t.onClose()}const o8e={brand:"lightbulb",danger:"exclamationMarkTriangle",info:"information",success:"checkCircle",warning:"exclamationMarkTriangle"};const P9={slow:14e3,medium:1e4,fast:6e3},KI={actionsEnd:"actions-end",title:"title",message:"message",link:"link"},eh={actionsEnd:"actions-end",close:"close",container:"container",containerActive:"container--active",dismissProgress:"dismiss-progress",icon:"icon",containerEmbedded:"container--embedded",queueCount:"queue-count",queueCountActive:"queue-count--active",textContainer:"text-container",focused:"focused"},l8e=300;class c8e{constructor(){this.registeredElements=[],this.queueTimeoutId=null}registerElement(e){const{registeredElements:i}=this;if(!i.includes(e)){switch(e.queue){case"immediate":i.unshift(e);break;case"next":i.splice(1,0,e);break;case"last":i.push(e);break}this.updateAlerts()}}unregisterElement(e){const{registeredElements:i}=this,r=i.indexOf(e);r!==-1&&i.splice(r,1),e.active=!1,this.updateAlerts()}updateAlerts(){window.clearTimeout(this.queueTimeoutId),this.queueTimeoutId=null,this.registeredElements.forEach((e,i)=>{e.openAlertCount=this.registeredElements.length,i===0?this.queueTimeoutId=window.setTimeout(()=>e.active=!0,l8e):e.active=!1})}}const u8e=zv`:host{--calcite-internal-color-focus: var( --calcite-color-focus, var(--calcite-ui-focus-color, var(--calcite-color-brand)) )}:host{display:block;inline-size:var(--calcite-alert-width)}.container{pointer-events:none;position:fixed;z-index:var(--calcite-z-index-toast);margin-inline:auto;margin-block:0px;box-sizing:border-box;display:flex;inline-size:100%;min-inline-size:min-content;align-items:center;justify-content:center;text-align:start;opacity:0;--tw-shadow: 0 6px 20px -4px rgba(0, 0, 0, .1), 0 4px 12px -2px rgba(0, 0, 0, .08);--tw-shadow-colored: 0 6px 20px -4px var(--tw-shadow-color), 0 4px 12px -2px var(--tw-shadow-color);box-shadow:var(--calcite-alert-shadow, var(--tw-ring-offset-shadow, 0 0 rgba(0, 0, 0, 0)), var(--tw-ring-shadow, 0 0 rgba(0, 0, 0, 0)), var(--tw-shadow));background-color:var(--calcite-alert-background-color, var(--calcite-color-foreground-1));border-radius:var(--calcite-alert-corner-radius, var(--calcite-border-radius));border-block-start:0 solid transparent;border-inline:1px solid var(--calcite-color-border-3);border-block-end:1px solid var(--calcite-color-border-3);max-inline-size:calc(100% - var(--calcite-alert-offset-size, 2rem) * 2);transition:opacity var(--calcite-internal-animation-timing-slow) cubic-bezier(.215,.44,.42,.88),all var(--calcite-animation-timing) ease-in-out}.container--bottom,.container--top{inset-inline-end:0;inset-inline-start:0}.container[class*=bottom]{transform:translate3d(0,var(--calcite-alert-offset-size, 2rem),0);inset-block-end:var(--calcite-alert-offset-size, 2rem)}.container[class*=top]{transform:translate3d(0,calc(-1 * var(--calcite-alert-offset-size, 2rem)),0);inset-block-start:var(--calcite-alert-offset-size, 2rem)}.container[class*=start]{inset-inline-start:var(--calcite-alert-offset-size, 2rem);inset-inline-end:auto}.container[class*=end]{inset-inline-end:var(--calcite-alert-offset-size, 2rem);inset-inline-start:auto}.icon{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:0;margin-block:auto;margin-inline-end:auto}.close{display:flex;cursor:pointer;align-items:center;justify-content:flex-end;align-self:stretch;border-style:none;background-color:transparent;color:var(--calcite-color-text-3);outline:2px solid transparent;outline-offset:2px;-webkit-appearance:none;border-start-end-radius:var(--calcite-alert-corner-radius, var(--calcite-border-radius));border-end-end-radius:var(--calcite-alert-corner-radius, var(--calcite-border-radius));outline-color:transparent}.close:focus{outline:var(--calcite-border-width-md) solid var(--calcite-color-focus, var(--calcite-ui-focus-color, var(--calcite-color-brand)));outline:var(--calcite-border-width-md) solid var(--calcite-internal-color-focus);outline-offset:calc(calc(-1 * var(--calcite-spacing-base)) * calc(1 - (2*clamp(0,var(--calcite-offset-invert-focus),1))))}.close:hover,.close:focus{color:var(--calcite-color-text-1);background-color:var(--calcite-color-foreground-2)}.close:active{background-color:var(--calcite-color-foreground-3)}.queue-count{visibility:hidden;display:flex;min-inline-size:min-content;cursor:default;align-items:center;justify-content:space-around;align-self:stretch;overflow:hidden;text-align:center;font-weight:var(--calcite-font-weight-medium);color:var(--calcite-color-text-2);opacity:0;transition-property:background-color,block-size,border-color,box-shadow,color,inset-block-end,inset-block-start,inset-inline-end,inset-inline-start,inset-size,opacity,outline-color,transform;transition-duration:var(--calcite-animation-timing);transition-timing-function:ease-in-out;border-inline:0 solid transparent;border-start-end-radius:0}.queue-count--active{visibility:visible;opacity:1}.dismiss-progress{position:absolute;display:block;inline-size:100%;overflow:hidden;inset-inline:0;inset-block-start:-2px;block-size:2px;border-radius:var(--calcite-border-radius) var(--calcite-border-radius) 0 0}.dismiss-progress:after{position:absolute;inset-block-start:0px;display:block;block-size:2px;content:"";background-color:var(--calcite-color-transparent-tint);inset-inline-end:0}.actions-end{display:flex;align-self:stretch}.text-container{box-sizing:border-box;display:flex;min-inline-size:0px;flex:1 1 auto;flex-direction:column;overflow-wrap:break-word}.footer{position:relative;display:flex;inline-size:auto;justify-content:flex-end;align-self:stretch;padding-block-start:1px;block-size:inherit}:host([scale=s]) slot[name=title]::slotted(*),:host([scale=s]) *::slotted([slot=title]){font-size:var(--calcite-font-size--1);line-height:1.375}:host([scale=s]) slot[name=message]::slotted(*),:host([scale=s]) *::slotted([slot=message]){font-size:var(--calcite-font-size--2);line-height:1.375}:host([scale=s]) slot[name=link]::slotted(*),:host([scale=s]) *::slotted([slot=link]){font-size:var(--calcite-font-size--2);line-height:1.375}:host([scale=s]) .queue-count{margin-inline:.5rem}:host([scale=s]) .container{--calcite-internal-alert-min-height: 3.5rem;inline-size:var(--calcite-alert-width, 40em)}:host([scale=s]) .close{padding:.75rem}:host([scale=s]) .icon{padding-inline-start:.75rem}:host([scale=s]) .text-container{padding-block:.5rem;padding-inline:.75rem .5rem}:host([scale=m]) slot[name=title]::slotted(*),:host([scale=m]) *::slotted([slot=title]){font-size:var(--calcite-font-size-0);line-height:1.375}:host([scale=m]) slot[name=message]::slotted(*),:host([scale=m]) *::slotted([slot=message]){font-size:var(--calcite-font-size--1);line-height:1.375}:host([scale=m]) slot[name=link]::slotted(*),:host([scale=m]) *::slotted([slot=link]){font-size:var(--calcite-font-size--1);line-height:1.375}:host([scale=m]) .queue-count{margin-inline:.75rem}:host([scale=m]) .container{--calcite-internal-alert-min-height: 4.1875rem;inline-size:var(--calcite-alert-width, 50em)}:host([scale=m]) .close{padding:1rem}:host([scale=m]) .icon{padding-inline-start:1rem}:host([scale=m]) .text-container{padding-block:.75rem;padding-inline:1rem .75rem}:host([scale=l]) slot[name=title]::slotted(*),:host([scale=l]) *::slotted([slot=title]){margin-block-end:.25rem;font-size:var(--calcite-font-size-1);line-height:1.375}:host([scale=l]) slot[name=message]::slotted(*),:host([scale=l]) *::slotted([slot=message]){font-size:var(--calcite-font-size-0);line-height:1.375}:host([scale=l]) slot[name=link]::slotted(*),:host([scale=l]) *::slotted([slot=link]){font-size:var(--calcite-font-size-0);line-height:1.375}:host([scale=l]) .queue-count{margin-inline:1rem}:host([scale=l]) .container{--calcite-internal-alert-min-height: 5.625rem;inline-size:var(--calcite-alert-width, 60em)}:host([scale=l]) .close{padding:1.25rem}:host([scale=l]) .icon{padding-inline-start:1.25rem}:host([scale=l]) .text-container{padding-block:1rem;padding-inline:1.25rem 1rem}:host([open]) .container--active{border-block-start-width:2px;opacity:1;pointer-events:initial}:host([open]) .container--active[class*=bottom]{transform:translate3d(0,calc(-1 * var(--calcite-alert-offset-size, 2rem)),inherit)}:host([open]) .container--active[class*=top]{transform:translate3d(0,var(--calcite-alert-offset-size, 2rem),inherit)}:host([auto-close])>.queue-count{border-inline-end:0 solid transparent}slot[name=title]::slotted(*),*::slotted([slot=title]){font-size:var(--calcite-font-size-0);line-height:1.375;font-weight:var(--calcite-font-weight-medium);color:var(--calcite-color-text-1)}slot[name=message]::slotted(*),*::slotted([slot=message]){margin:0;display:inline;font-size:var(--calcite-font-size--1);line-height:1.375;font-weight:var(--calcite-font-weight-normal);margin-inline-end:.5rem;color:var(--calcite-color-text-2)}slot[name=link]::slotted(*),*::slotted([slot=link]){display:inline-flex;color:var(--calcite-color-text-link)}:host([kind=brand]) .container{border-block-start-color:var(--calcite-color-brand)}:host([kind=brand]) .container .icon{color:var(--calcite-color-brand)}:host([kind=info]) .container{border-block-start-color:var(--calcite-color-status-info)}:host([kind=info]) .container .icon{color:var(--calcite-color-status-info)}:host([kind=danger]) .container{border-block-start-color:var(--calcite-color-status-danger)}:host([kind=danger]) .container .icon{color:var(--calcite-color-status-danger)}:host([kind=success]) .container{border-block-start-color:var(--calcite-color-status-success)}:host([kind=success]) .container .icon{color:var(--calcite-color-status-success)}:host([kind=warning]) .container{border-block-start-color:var(--calcite-color-status-warning)}:host([kind=warning]) .container .icon{color:var(--calcite-color-status-warning)}:host([auto-close-duration=fast]) .dismiss-progress:after{animation:dismissProgress 6s ease-out}:host(:hover[auto-close-duration=fast]) .dismiss-progress:after,:host(:focus[auto-close-duration=fast]) .dismiss-progress:after{animation-play-state:paused}:host([auto-close-duration=medium]) .dismiss-progress:after{animation:dismissProgress 10s ease-out}:host(:hover[auto-close-duration=medium]) .dismiss-progress:after,:host(:focus[auto-close-duration=medium]) .dismiss-progress:after{animation-play-state:paused}:host([auto-close-duration=slow]) .dismiss-progress:after{animation:dismissProgress 14s ease-out}:host(:hover[auto-close-duration=slow]) .dismiss-progress:after,:host(:focus[auto-close-duration=slow]) .dismiss-progress:after{animation-play-state:paused}.container.focused .dismiss-progress:after{animation-play-state:paused}@keyframes dismissProgress{0%{inline-size:0px;opacity:.75}to{inline-size:100%;opacity:1}}.container--embedded{position:absolute}:host([hidden]){display:none}[hidden]{display:none}:host([calcite-hydrated-hidden]){visibility:hidden!important;pointer-events:none}`,tS=new c8e,zV=class zV extends lv{constructor(){super(...arguments),this.autoCloseTimeoutId=null,this.transitionProp="opacity",this.totalHoverTime=0,this.totalOpenTime=0,this.messages=Ibe(),this.focusSetter=nK()(this),this.hasEndActions=!1,this.isFocused=!1,this.numberStringFormatter=new Fbe,this.active=!1,this.autoClose=!1,this.autoCloseDuration="medium",this.embedded=!1,this.iconFlipRtl=!1,this.kind="brand",this.open=!1,this.openAlertCount=0,this.placement="bottom",this.queue="last",this.scale="m",this.calciteAlertBeforeClose=Pc({cancelable:!1}),this.calciteAlertBeforeOpen=Pc({cancelable:!1}),this.calciteAlertClose=Pc({cancelable:!1}),this.calciteAlertOpen=Pc({cancelable:!1})}async setFocus(e){return this.focusSetter(()=>this.el,e)}connectedCallback(){super.connectedCallback(),this.open&&tS.registerElement(this.el),this.numberStringFormatter.numberFormatOptions={locale:this.messages._lang,numberingSystem:this.numberingSystem,signDisplay:"always"}}willUpdate(e){e.has("open")&&(this.hasUpdated||this.open!==!1)&&this.openHandler(),e.has("active")&&(this.hasUpdated||this.active!==!1)&&this.handleActiveChange(),e.has("autoCloseDuration")&&(this.hasUpdated||this.autoCloseDuration!=="medium")&&this.updateDuration(),e.has("queue")&&(this.hasUpdated||this.queue!=="last")&&this.handleQueueChange(),e.has("numberingSystem")&&this.numberingSystemChange(),e.has("messages")&&this.effectiveLocaleChange()}disconnectedCallback(){super.disconnectedCallback(),tS.unregisterElement(this.el),this.clearAutoCloseTimeout(),this.embedded=!1}handleActiveChange(){a8e(this),this.clearAutoCloseTimeout(),this.active&&this.autoClose&&!this.autoCloseTimeoutId&&(this.initialOpenTime=Date.now(),this.autoCloseTimeoutId=window.setTimeout(()=>this.closeAlert(),P9[this.autoCloseDuration]))}openHandler(){this.open?tS.registerElement(this.el):tS.unregisterElement(this.el)}updateDuration(){this.autoClose&&this.autoCloseTimeoutId&&(this.clearAutoCloseTimeout(),this.autoCloseTimeoutId=window.setTimeout(()=>this.closeAlert(),P9[this.autoCloseDuration]))}handleQueueChange(){this.open&&(tS.unregisterElement(this.el),tS.registerElement(this.el))}handleKeyBoardFocus(){this.isFocused=!0,this.handleFocus()}handleKeyBoardBlur(){this.isFocused=!1,this.isHovered||this.handleBlur()}effectiveLocaleChange(){this.numberStringFormatter.numberFormatOptions={locale:this.messages._lang,numberingSystem:this.numberingSystem,signDisplay:"always"}}numberingSystemChange(){this.numberStringFormatter.numberFormatOptions={locale:this.messages._lang,numberingSystem:this.numberingSystem,signDisplay:"always"}}clearAutoCloseTimeout(){window.clearTimeout(this.autoCloseTimeoutId),this.autoCloseTimeoutId=null}setTransitionEl(e){e&&(this.transitionEl=e)}closeAlert(){this.open=!1,this.clearAutoCloseTimeout()}onBeforeOpen(){this.calciteAlertBeforeOpen.emit()}onOpen(){this.calciteAlertOpen.emit()}onBeforeClose(){this.calciteAlertBeforeClose.emit()}onClose(){this.calciteAlertClose.emit()}actionsEndSlotChangeHandler(e){this.hasEndActions=tK(e)}handleMouseOver(){this.isHovered=!0,this.handleFocus()}handleMouseLeave(){this.isHovered=!1,this.isFocused||this.handleBlur()}handleFocus(){this.clearAutoCloseTimeout(),this.totalOpenTime=Date.now()-this.initialOpenTime,this.lastMouseOverBegin=Date.now()}handleBlur(){const e=Date.now()-this.lastMouseOverBegin,i=P9[this.autoCloseDuration]-this.totalOpenTime+this.totalHoverTime;this.totalHoverTime=this.totalHoverTime?e+this.totalHoverTime:e,this.autoCloseTimeoutId=window.setTimeout(()=>this.closeAlert(),i)}render(){const{open:e,autoClose:i,label:r,placement:s,active:n,openAlertCount:a}=this,o=i?"alert":"alertdialog",l=!e,c=JVe(o8e,this.icon,this.kind),h=a>1;return this.el.inert=l,this.el.ariaLabel=r,this.el.toggleAttribute("calcite-hydrated-hidden",l),this.el.role=o,En`<div class=${gr({[eh.container]:!0,[eh.containerActive]:n,[`${eh.container}--${s}`]:!0,[eh.containerEmbedded]:this.embedded,[eh.focused]:this.isFocused})} @pointerenter=${this.autoClose&&this.autoCloseTimeoutId?this.handleMouseOver:null} @pointerleave=${this.autoClose?this.handleMouseLeave:null} ${iC(this.setTransitionEl)}>${c&&this.renderIcon(c)||""}<div class=${gr(eh.textContainer)} @focusin=${this.autoClose&&this.autoCloseTimeoutId?this.handleKeyBoardFocus:null} @focusout=${this.autoClose?this.handleKeyBoardBlur:null}><slot name=${KI.title}></slot><slot name=${KI.message}></slot><slot name=${KI.link}></slot></div>${this.renderActionsEnd()}${h?this.renderQueueCount():null}${this.renderCloseButton()}${e&&n&&i?En`<div class=${gr(eh.dismissProgress)}></div>`:null}</div>`}renderCloseButton(){return zce("close",En`<button .ariaLabel=${this.messages.close} class=${gr(eh.close)} @click=${this.closeAlert} @focusin=${this.autoClose?this.handleKeyBoardFocus:null} @focusout=${this.autoClose?this.handleKeyBoardBlur:null} type=button><calcite-icon icon=x .scale=${$P(this.scale)}></calcite-icon></button>`)}renderQueueCount(){const{openAlertCount:e}=this,i=e>2?e-1:1,r=this.numberStringFormatter.numberFormatter.format(i);return zce("queue-count",En`<div class=${gr({[eh.queueCount]:!0,[eh.queueCountActive]:e>1})}><calcite-chip .label=${r} .scale=${this.scale} .value=${r}>${r}</calcite-chip></div>`)}renderActionsEnd(){return En`<div class=${gr(eh.actionsEnd)}><slot name=${KI.actionsEnd} @slotchange=${this.actionsEndSlotChangeHandler}></slot></div>`}renderIcon(e){return En`<div class=${gr(eh.icon)}><calcite-icon .flipRtl=${this.iconFlipRtl} .icon=${e} .scale=${$P(this.scale)}></calcite-icon></div>`}};zV.properties={hasEndActions:[16,{},{state:!0}],isFocused:[16,{},{state:!0}],numberStringFormatter:[16,{},{state:!0}],active:[5,{},{type:Boolean}],autoClose:[7,{},{reflect:!0,type:Boolean}],autoCloseDuration:[3,{},{reflect:!0}],embedded:[5,{},{type:Boolean}],icon:[3,{converter:ibe},{reflect:!0}],iconFlipRtl:[7,{},{reflect:!0,type:Boolean}],kind:[3,{},{reflect:!0}],label:1,messageOverrides:[0,{},{attribute:!1}],numberingSystem:[3,{},{reflect:!0}],open:[7,{},{reflect:!0,type:Boolean}],openAlertCount:[9,{},{type:Number}],placement:[3,{},{reflect:!0}],queue:[3,{},{reflect:!0}],scale:[3,{},{reflect:!0}]},zV.styles=u8e;let ZH=zV;HV("calcite-alert",ZH);const oK=Symbol.for(""),h8e=t=>{if(t?.r===oK)return t?._$litStatic$},Zzt=t=>({_$litStatic$:t,r:oK}),Nce=(t,...e)=>({_$litStatic$:e.reduce((i,r,s)=>i+(n=>{if(n._$litStatic$!==void 0)return n._$litStatic$;throw Error(`Value passed to 'literal' function must be a 'literal' result: ${n}. Use 'unsafeStatic' to pass non-literal values, but
            take care to ensure page security.`)})(r)+t[s+1],t[0]),r:oK}),Vce=new Map,d8e=t=>(e,...i)=>{const r=i.length;let s,n;const a=[],o=[];let l,c=0,h=!1;for(;c<r;){for(l=e[c];c<r&&(n=i[c],(s=h8e(n))!==void 0);)l+=s+e[++c],h=!0;c!==r&&o.push(n),a.push(l),c++}if(c===r&&a.push(e[r]),h){const f=a.join("$$lit$$");(e=Vce.get(f))===void 0&&(a.raw=a,Vce.set(f,e=a)),i=o}return t(e,...i)},p8e=d8e(En);const f8e=zv`:host{--calcite-internal-color-focus: var( --calcite-color-focus, var(--calcite-ui-focus-color, var(--calcite-color-brand)) )}:host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}:host{display:inline}:host a,:host button{position:relative;display:flex;cursor:pointer;align-items:center;justify-content:center;border-radius:0;border-style:none;font-family:inherit;text-decoration:none;line-height:inherit;font-size:inherit;-webkit-appearance:none}:host a:hover,:host button:hover{text-decoration:none}:host a,:host button{transition-property:background-color,block-size,border-color,box-shadow,color,inset-block-end,inset-block-start,inset-inline-end,inset-inline-start,inset-size,opacity,outline-color,transform,background-size;transition-duration:var(--calcite-animation-timing);transition-timing-function:ease-in-out;outline-color:transparent}:host a:focus,:host button:focus{outline:var(--calcite-border-width-md) solid var(--calcite-color-focus, var(--calcite-ui-focus-color, var(--calcite-color-brand)));outline:var(--calcite-border-width-md) solid var(--calcite-internal-color-focus);outline-offset:calc(var(--calcite-spacing-base) * calc(1 - (2*clamp(0,var(--calcite-offset-invert-focus),1))))}calcite-icon{inline-size:1em;block-size:1em;min-inline-size:unset;min-block-size:unset}.calcite-link--icon{vertical-align:middle;margin-block-start:-.25em}:host .calcite-link--icon.icon-start{margin-inline-end:.5rem}:host .calcite-link--icon.icon-end{margin-inline-start:.5rem}:host button,:host a{position:relative;display:inline;border-style:none;background-color:transparent;padding:0;color:var(--calcite-link-text-color, var(--calcite-color-text-link));line-height:inherit;white-space:initial;background-image:linear-gradient(currentColor,currentColor),linear-gradient(var(--calcite-color-brand-underline),var(--calcite-color-brand-underline));background-position-x:0%,100%;background-position-y:min(1.5em,100%);background-repeat:no-repeat,no-repeat;background-size:0% 1px,100% 1px}:host button:hover,:host button:focus,:host a:hover,:host a:focus{background-size:100% 1px,100% 1px}:host button:active,:host a:active{background-size:100% 2px,100% 2px}:host button.calcite--rtl,:host a.calcite--rtl{background-position:100% 100%,100% 100%}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}.interaction-container{display:contents}:host([hidden]){display:none}[hidden]{display:none}`,e5={calciteLinkIcon:"calcite-link--icon",iconStart:"icon-start",iconEnd:"icon-end"},FV=class FV extends lv{constructor(){super(),this.childRef=TR(),this.focusSetter=nK()(this),this.disabled=!1,this.download=!1,this.listen("click",this.clickHandler)}async setFocus(e){return this.focusSetter(()=>this.childRef.value,e)}updated(){Sbe(this)}clickHandler(e){this.disabled||e.isTrusted||this.childRef.value.click()}childElClickHandler(e){e.isTrusted||e.stopPropagation()}render(){const{download:e,el:i}=this,r=hbe(i),s=this.href?"a":"button",n=En`<calcite-icon class=${gr({[e5.calciteLinkIcon]:!0,[e5.iconStart]:!0})} .flipRtl=${this.iconFlipRtl==="start"||this.iconFlipRtl==="both"} .icon=${this.iconStart} scale=s></calcite-icon>`,a=En`<calcite-icon class=${gr({[e5.calciteLinkIcon]:!0,[e5.iconEnd]:!0})} .flipRtl=${this.iconFlipRtl==="end"||this.iconFlipRtl==="both"} .icon=${this.iconEnd} scale=s></calcite-icon>`,o=s==="button"?Nce`button`:Nce`a`,l=s==="button"?0:null;return this.el.role="presentation",Tbe({disabled:this.disabled,children:p8e`<${o} class=${gr({[wVe.rtl]:r==="rtl"})} download=${(s==="a"?e===!0||e===""?"":e||null:null)??XI} href=${(s==="a"&&this.href)??XI} @click=${this.childElClickHandler} rel=${(s==="a"&&this.rel)??XI} tabindex=${l} target=${(s==="a"&&this.target)??XI} ${iC(this.childRef)}>${En`${this.iconStart?n:null}<slot></slot>${this.iconEnd?a:null}`}</${o}>`})}};FV.properties={disabled:[7,{},{reflect:!0,type:Boolean}],download:[3,{converter:ibe},{reflect:!0}],href:[3,{},{reflect:!0}],iconEnd:[3,{},{reflect:!0}],iconFlipRtl:[3,{},{reflect:!0}],iconStart:[3,{},{reflect:!0}],rel:1,target:1},FV.styles=f8e;let YH=FV;HV("calcite-link",YH);let T_;const xo=globalThis;function ie(t){return typeof T_[t]=="function"?T_[t]=T_[t](xo):T_[t]}T_=xo.dojoConfig?.has||xo.esriConfig?.has?{...xo.dojoConfig?.has,...xo.esriConfig?.has}:{},ie.add=(t,e,i,r)=>{(r||T_[t]===void 0)&&(T_[t]=e),i&&ie(t)},ie.cache=T_,ie.add("big-integer-warning-enabled",!0),ie.add("esri-deprecation-warnings",!0),ie.add("esri-tests-disable-screenshots",!1),ie.add("esri-tests-use-full-window",!1),ie.add("esri-tests-post-to-influx",!0),ie.add("esri-cim-animations-enable-status","enabled"),ie.add("esri-cim-animations-spotlight",!1),ie.add("esri-cim-animations-freeze-time",!1),(()=>{ie.add("host-webworker",xo.WorkerGlobalScope!==void 0&&self instanceof xo.WorkerGlobalScope);const t=typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document;if(ie.add("host-browser",t),ie.add("host-node",!(typeof xo.process!="object"||!xo.process.versions?.node||!xo.process.versions.v8)),ie.add("dom",t),ie("host-browser")){const e=navigator,i=e.userAgent,r=e.appVersion,s=parseFloat(r);if(ie.add("wp",parseFloat(i.split("Windows Phone")[1])||void 0),ie.add("msapp",parseFloat(i.split("MSAppHost/")[1])||void 0),ie.add("khtml",r.includes("Konqueror")?s:void 0),ie.add("edge",parseFloat(i.split("Edge/")[1])||void 0),ie.add("opr",parseFloat(i.split("OPR/")[1])||void 0),ie.add("webkit",!ie("wp")&&!ie("edge")&&parseFloat(i.split("WebKit/")[1])||void 0),ie.add("chrome",!ie("edge")&&!ie("opr")&&parseFloat(i.split("Chrome/")[1])||void 0),ie.add("android",!ie("wp")&&parseFloat(i.split("Android ")[1])||void 0),ie.add("safari",!r.includes("Safari")||ie("wp")||ie("chrome")||ie("android")||ie("edge")||ie("opr")?void 0:parseFloat(r.split("Version/")[1])),ie.add("mac",r.includes("Macintosh")),!ie("wp")&&/(iPhone|iPod|iPad)/.test(i)){const n=RegExp.$1.replace(/P/,"p"),a=/OS ([\d_]+)/.test(i)?RegExp.$1:"1",o=parseFloat(a.replace(/_/,".").replaceAll("_",""));ie.add(n,o),ie.add("ios",o)}ie("webkit")||(!i.includes("Gecko")||ie("wp")||ie("khtml")||ie("edge")||ie.add("mozilla",s),ie("mozilla")&&ie.add("ff",parseFloat(i.split("Firefox/")[1]||i.split("Minefield/")[1])||void 0))}})(),(()=>{if(xo.navigator){const t=navigator.userAgent,e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i.test(t),i=/iPhone/i.test(t);e&&ie.add("esri-mobile",e),i&&ie.add("esri-iPhone",i),ie.add("esri-geolocation",!!navigator.geolocation)}ie.add("esri-wasm","WebAssembly"in xo),ie.add("esri-performance-mode-frames-between-render",20),ie.add("esri-force-performance-mode",!1),ie.add("esri-shared-array-buffer",()=>{const t="SharedArrayBuffer"in xo,e=xo.crossOriginIsolated===!1;return t&&!e}),ie.add("wasm-simd",()=>{const t=[0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11];return WebAssembly.validate(new Uint8Array(t))}),ie.add("esri-atomics","Atomics"in xo),ie.add("esri-workers","Worker"in xo),ie.add("web-feat:cache","caches"in xo),ie.add("esri-workers-arraybuffer-transfer",!ie("safari")||Number(ie("safari"))>=12),ie.add("workers-pool-size",8),ie.add("featurelayer-simplify-thresholds",[.5,.5,.5,.5]),ie.add("featurelayer-simplify-payload-size-factors",[1,1,4]),ie.add("featurelayer-fast-triangulation-enabled",!0),ie.add("featurelayer-animation-enabled",!0),ie.add("featurelayer-snapshot-enabled",!0),ie.add("featurelayer-snapshot-initial-tolerance",0),ie.add("featurelayer-snapshot-point-min-threshold",8e4),ie.add("featurelayer-snapshot-point-max-threshold",4e5),ie.add("featurelayer-snapshot-multipoint-min-threshold",2e4),ie.add("featurelayer-snapshot-multipoint-max-threshold",1e5),ie.add("featurelayer-snapshot-polygon-min-threshold",2e3),ie.add("featurelayer-snapshot-polygon-max-threshold",2e3),ie.add("featurelayer-snapshot-polyline-min-threshold",2e3),ie.add("featurelayer-snapshot-polyline-max-threshold",2e3),ie.add("featurelayer-snapshot-max-vertex-count",25e4),ie.add("featurelayer-snapshot-non-hosted-exceedslimit-enabled",!0),ie.add("featurelayer-snapshot-concurrency",4),ie.add("featurelayer-snapshot-coverage",.1),ie.add("featurelayer-query-max-depth",4),ie.add("featurelayer-query-pausing-enabled",!1),ie.add("featurelayer-query-tile-concurrency",4),ie.add("featurelayer-query-tile-max-features",6e5),ie.add("featurelayer-advanced-symbols",!1),ie.add("featurelayer-pbf",!0),ie.add("featurelayer-pbf-statistics",!1),ie.add("feature-layers-workers",!0),ie.add("feature-polyline-generalization-factor",1),ie.add("parquetlayer-full-query-feature-count",2e4),ie.add("parquetlayer-hittest-max-feature-count",1),ie.add("parquetlayer-persistence-enabled",!1),ie.add("mapview-transitions-duration",200),ie.add("mapview-essential-goto-duration",200),ie.add("mapview-srswitch-adjust-rotation-scale-threshold",24e6),ie.add("mapserver-pbf-version-support",10.81),ie.add("mapservice-popup-identify-max-tolerance",20),ie.add("request-queue-concurrency-hosted",16),ie.add("request-queue-concurrency-non-hosted",4),ie.add("curve-densification-coarse-segments",128),ie.add("curve-densification-max-segments",2e3),ie.add("curve-densification-min-segments",3),ie.add("curve-densification-pixel-deviation",.5),ie.add("view-readyState-waiting-delay",1e3),ie.add("gradient-depth-bias",.01),ie.add("gradient-depth-epsilon",1e-8),ie.add("enable-feature:esri-compress-textures",!0),ie("host-webworker")||ie("host-browser")&&(ie.add("esri-csp-restrictions",()=>{try{new Function}catch{return!0}return!1}),ie.add("esri-url-encodes-apostrophe",()=>{const t=window.document.createElement("a");return t.href="?'",t.href.includes("?%27")}))})();function Yzt(t){}function m8e(t){return()=>t}function Qzt(t){return t}var wc;let g8e=(wc=class{constructor(e=1){this._seed=e}set seed(e){this._seed=e??Math.random()*wc._m}getInt(){return this._seed=(wc._a*this._seed+wc._c)%wc._m,this._seed}getFloat(){return this.getInt()/(wc._m-1)}getIntRange(e,i){return Math.round(this.getFloatRange(e,i))}getFloatRange(e,i){const r=i-e;return e+this.getInt()/wc._m*r}},wc._m=2147483647,wc._a=48271,wc._c=0,wc);const ZV=1.5,y8e=1/ZV,_8e=.5;function Uce(t,e){if(!e)return t;for(const i of e)t.push(i);return t}function Nbe(t){return t}function v8e(t,e=Nbe){if(!t||t.length===0)return;let i=t[0],r=e(i);for(let s=1;s<t.length;++s){const n=t[s],a=Number(e(n));a>r&&(r=a,i=n)}return i}function Vbe(t,e=Nbe){return v8e(t,i=>-e(i))}function q3(t,e){return e?t.filter((i,r,s)=>s.findIndex(e.bind(null,i))===r):Array.from(new Set(t))}function Ube(t,e,i,r,s,n,a){if(t==null&&r==null)return!0;e=Math.max(0,e),s=Math.max(0,s),i=Math.max(0,i<0?(t?.length??0)+i:i),n=Math.max(0,n<0?(r?.length??0)+n:n);const o=i-e;if(t==null||r==null||o!==n-s)return!1;if(a){for(let l=0;l<o;l++)if(!a(t[e+l],r[s+l]))return!1}else for(let l=0;l<o;l++)if(t[e+l]!==r[s+l])return!1;return!0}function sy(t,e,i){return Ube(t,0,t?.length??0,e,0,e?.length??0,i)}function b8e(){return(t,e)=>{if(t==null&&e==null)return!0;if(t==null||e==null||t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}}function w8e(t,e){let i=t.length!==e.length;i&&(t.length=e.length);for(let r=0;r<e.length;++r)t[r]!==e[r]&&(t[r]=e[r],i=!0);return i}function $N(t,e,i){let r,s;return i?(r=e.filter(n=>!t.some(a=>i(a,n))),s=t.filter(n=>!e.some(a=>i(a,n)))):(r=e.filter(n=>!t.includes(n)),s=t.filter(n=>!e.includes(n))),{added:r,removed:s}}function x8e(t){return t&&typeof t.length=="number"}function S8e(t,e){const i=t.length;if(i===0)return[];const r=[];for(let s=0;s<i;s+=e)r.push(t.slice(s,s+e));return r}function Xzt(t,e,i){const r=t.length;let s=0,n=r-1;for(;s<n;){const o=s+Math.floor((n-s)/2);e>t[o]?s=o+1:n=o}const a=t[s];return i?e>=t[r-1]?-1:a===e?s:s-1:a===e?s:-1}let lK=class{constructor(){this.last=0}};const Bbe=new lK;function MR(t,e,i,r){r=r||Bbe;const s=Math.max(0,r.last-10);for(let a=s;a<i;++a)if(t[a]===e)return r.last=a,a;const n=Math.min(s,i);for(let a=0;a<n;++a)if(t[a]===e)return r.last=a,a;return-1}function Ul(t,e,i,r){const s=t.length,n=MR(t,e,s,r);if(n!==-1)return t[n]=t[s-1],t.pop(),e}const fd=new Set;function T8e(t,e,i=t.length,r=e.length,s,n){if(r===0||i===0)return i;fd.clear();for(let o=0;o<r;++o)fd.add(e[o]);s=s||Bbe;const a=Math.max(0,s.last-10);for(let o=a;o<i;++o)if(fd.has(t[o])&&(n?.push(t[o]),fd.delete(t[o]),t[o]=t[i-1],--i,--o,fd.size===0||i===0))return fd.clear(),i;for(let o=0;o<a;++o)if(fd.has(t[o])&&(n?.push(t[o]),fd.delete(t[o]),t[o]=t[i-1],--i,--o,fd.size===0||i===0))return fd.clear(),i;return fd.clear(),i}function YV(t,e){let i=0;for(let r=0;r<t.length;++r){const s=t[r];e(s,r)&&(t[i]=s,i++)}return t.length=i,t}function Kzt(t,e,i){const r=t.length;if(e>=r)return t.slice();const s=cK(i),n=new Set,a=[];for(;a.length<e;){const o=Math.floor(s()*r);n.has(o)||(n.add(o),a.push(t[o]))}return a}function cK(t){return t?(Bce.seed=t,()=>Bce.getFloat()):Math.random}const Bce=new g8e;function jbe(t,e){if(!t)return t;const i=cK(e);for(let r=t.length-1;r>0;r--){const s=Math.floor(i()*(r+1)),n=t[r];t[r]=t[s],t[s]=n}return t}function tM(t,e){const i=t.indexOf(e);return i!==-1?(t.splice(i,1),e):null}function qf(t,e){return t!=null}const $8e=[];function GA(t){return t instanceof ArrayBuffer}function uK(t){return t?.constructor?.name==="Int8Array"}function mw(t){return t?.constructor?.name==="Uint8Array"}function qbe(t){return t?.constructor?.name==="Uint8ClampedArray"}function hK(t){return t?.constructor?.name==="Int16Array"}function QV(t){return t?.constructor?.name==="Uint16Array"}function dK(t){return t?.constructor?.name==="Int32Array"}function pK(t){return t?.constructor?.name==="Uint32Array"}function Gbe(t){return t?.constructor?.name==="Float16Array"}function LD(t){return t?.constructor?.name==="Float32Array"}function kD(t){return t?.constructor?.name==="Float64Array"}function iM(t){return"buffer"in t}const Hl=1024;function eFt(t){return kD(t)||LD(t)||dK(t)||hK(t)||uK(t)}function tFt(t){return kD(t)||LD(t)}function iFt(t){return kD(t)?179769e303:Gbe(t)?65504:LD(t)?3402823e32:pK(t)?4294967295:QV(t)?65535:mw(t)||qbe(t)?255:dK(t)?2147483647:hK(t)?32767:uK(t)?127:256}const rFt=-32768,sFt=-2147483648,An=65535;function C8e(t,e){let i;for(i in t)t.hasOwnProperty(i)&&t[i]===void 0&&delete t[i];return t}function Te(t){if(!t||typeof t!="object"||typeof t=="function")return t;const e=Zbe(t);if(e!=null)return e;if(CP(t))return t.clone();if(Hbe(t))return t.map(Te);if(Wbe(t))throw new Error("Trying to clone an unclonable Accessor instance");const i={};for(const r of Object.getOwnPropertyNames(t))i[r]=Te(t[r]);return i}function QH(t,e){if(!t||typeof t!="object"||typeof t=="function"||"HTMLElement"in globalThis&&t instanceof HTMLElement)return t;const i=Zbe(t);if(i!=null)return i;if(Hbe(t)){let s=!0;const n=t.map(a=>{const o=QH(a,e);return a!=null&&o==null&&(s=!1),o});return s?n:null}if(CP(t))return t.clone(e);if(t instanceof File||t instanceof Blob)return t;if(Wbe(t))return null;const r=new(Object.getPrototypeOf(t)).constructor;for(const s of Object.getOwnPropertyNames(t)){const n=t[s],a=QH(n);if(n!=null&&a==null)return null;r[s]=a}return r}function CP(t){return typeof t.clone=="function"}function Hbe(t){return typeof t.map=="function"&&typeof t.forEach=="function"}function Wbe(t){return typeof t.notifyChange=="function"&&typeof t.watch=="function"}function jce(t){if(Object.prototype.toString.call(t)!=="[object Object]")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype}function Zbe(t){if(uK(t)||mw(t)||qbe(t)||hK(t)||QV(t)||dK(t)||pK(t)||LD(t)||kD(t))return t.slice();if(t instanceof Date)return new Date(t);if(t instanceof ArrayBuffer)return t.slice(0,t.byteLength);if(t instanceof Map){const e=new Map;for(const[i,r]of t)e.set(i,Te(r));return e}if(t instanceof Set){const e=new Set;for(const i of t)e.add(Te(i));return e}return null}function fK(t,e){return t===e||typeof t=="number"&&isNaN(t)&&typeof e=="number"&&isNaN(e)||typeof t?.getTime=="function"&&typeof e?.getTime=="function"&&t.getTime()===e.getTime()||!1}function Ybe(t,e){return t===e||(t==null||typeof t=="string"?t===e:typeof t=="number"?t===e||typeof e=="number"&&isNaN(t)&&isNaN(e):t instanceof Date?e instanceof Date&&t.getTime()===e.getTime():Array.isArray(t)?Array.isArray(e)&&sy(t,e):t instanceof Set?e instanceof Set&&E8e(t,e):t instanceof Map?e instanceof Map&&A8e(t,e):!!jce(t)&&jce(e)&&M8e(t,e))}function M8e(t,e){if(t===null||e===null)return!1;const i=Object.keys(t);if(e===null||Object.keys(e).length!==i.length)return!1;for(const r of i)if(t[r]!==e[r]||!Object.prototype.hasOwnProperty.call(e,r))return!1;return!0}function E8e(t,e){if(t.size!==e.size)return!1;for(const i of t)if(!e.has(i))return!1;return!0}function A8e(t,e){if(t.size!==e.size)return!1;for(const[i,r]of t){const s=e.get(i);if(s!==r||s===void 0&&!e.has(i))return!1}return!0}function O8e(t,e,i=!1){return Xbe(t,e,i)}function zD(t,e){if(e!=null)return e[t]||Qbe(t.split("."),!1,e)}function Uf(t,e,i){const r=t.split("."),s=r.pop(),n=Qbe(r,!0,i);n&&s&&(n[s]=e)}function qce(t,e){if(t==null&&e==null)return!1;if(t==null||e==null)return!0;if(typeof t=="object"){if(Array.isArray(t)){const i=e;if(t.length!==i.length)return!0;for(let r=0;r<t.length;r++)if(qce(t[r],i[r]))return!0;return!1}if(Object.keys(t).length!==Object.keys(e).length)return!0;for(const i in t)if(qce(t[i],e[i]))return!0;return!1}return t!==e}function Qbe(t,e,i){let r=i;for(const s of t){if(r==null)return;if(!(s in r)){if(!e)return;r[s]={}}r=r[s]}return r}function Xbe(t,e,i){return e?Object.keys(e).reduce((r,s)=>{if(s==="__proto__")return r;let n=r[s],a=e[s];return n===a?r:n===void 0?(r[s]=Te(a),r):(Array.isArray(a)||Array.isArray(r)?(n=n?Array.isArray(n)?r[s]=n.slice():r[s]=[n]:r[s]=[],a&&(Array.isArray(a)||(a=[a]),i?a.forEach(o=>{n.includes(o)||n.push(o)}):r[s]=a.slice())):a&&typeof a=="object"?r[s]=Xbe(n,a,i):r.hasOwnProperty(s)&&!e.hasOwnProperty(s)||(r[s]=a),r)},t||{}):t}function P8e(t,e){for(const i of Object.entries(t))if(e===i[1])return i[0]}function XV(t,e){return Object.values(t).includes(e)}const fr={apiKey:void 0,apiKeys:{scopes:[]},applicationName:"",applicationUrl:globalThis.location?.href,assetsPath:"",fontsUrl:"https://static.arcgis.com/fonts",geometryServiceUrl:"https://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",geoRSSServiceUrl:"https://utility.arcgis.com/sharing/rss",kmlServiceUrl:"https://utility.arcgis.com/sharing/kml",userPrivilegesApplied:!0,portalUrl:"https://www.arcgis.com",respectPrefersReducedMotion:!0,routeServiceUrl:"https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",workers:{loaderConfig:{has:{},paths:{},map:{},packages:[]}},request:{crossOriginNoCorsDomains:null,httpsDomains:["arcgis.com","arcgisonline.com","esrikr.com","premiumservices.blackbridge.com","esripremium.accuweather.com","gbm.digitalglobe.com","firstlook.digitalglobe.com","msi.digitalglobe.com"],interceptors:[],internalInterceptors:[],maxUrlLength:2e3,priority:"high",proxyRules:[],proxyUrl:null,timeout:62e3,trustedServers:[],useIdentity:!0},log:{interceptors:[],level:null}};if(globalThis.esriConfig&&(O8e(fr,globalThis.esriConfig,!0),delete fr.has),!fr.assetsPath){{const t="4.34";fr.assetsPath=`https://js.arcgis.com/${t}/@arcgis/core/assets`}fr.defaultAssetsPath=fr.assetsPath}const R8e=/\{([^}]+)\}/g;function Gce(t){return t??""}function Cy(t,e){return e?t.replaceAll(R8e,typeof e=="object"?(i,r)=>Gce(zD(r,e)):(i,r)=>Gce(e(r))):t}function nFt(t,e){return t.replaceAll(/([.$?*|{}()[\]\\/+\-^])/g,i=>e?.includes(i)?i:`\\${i}`)}function Jbe(t){let e=0;for(let i=0;i<t.length;i++)e=(e<<5)-e+t.charCodeAt(i),e|=0;return e}let Hce;function aFt(t){return Hce??=new DOMParser,Hce.parseFromString(t||"","text/html").body.innerText||""}function oFt(t,e){return new RegExp(`{${e}}`,"ig").test(t)}function D8e(t,...e){let i=t[0];for(let r=0;r<e.length;++r)i+=e[r]+t[r+1];return i}const Wce={info:0,warn:1,error:2,none:3};var Un;let fe=(Un=class{constructor(e){this.level=null,this._module="",this._parent=null,this.writer=null,this._loggedMessages={error:new Map,warn:new Map,info:new Map},e.level!=null&&(this.level=e.level),e.writer!=null&&(this.writer=e.writer),this._module=e.module,Un._loggers.set(this.module,this);const i=this.module.lastIndexOf(".");i!==-1&&(this._parent=Un.getLogger(this.module.slice(0,i)))}get module(){return this._module}get parent(){return this._parent}error(...e){this._log("error","always",...e)}warn(...e){this._log("warn","always",...e)}info(...e){this._log("info","always",...e)}errorOnce(...e){this._log("error","once",...e)}warnOnce(...e){this._log("warn","once",...e)}infoOnce(...e){this._log("info","once",...e)}errorOncePerTick(...e){this._log("error","oncePerTick",...e)}warnOncePerTick(...e){this._log("warn","oncePerTick",...e)}infoOncePerTick(...e){this._log("info","oncePerTick",...e)}get test(){}static get test(){}static getLogger(e){return e=typeof e!="string"?e.declaredClass:e,Un._loggers.get(e)||new Un({module:e})}_log(e,i,...r){if(this._matchLevel(e)){if(i!=="always"&&!Un._throttlingDisabled){const s=L8e(r),n=this._loggedMessages[e].get(s);if(i==="once"&&n!=null||i==="oncePerTick"&&n&&n>=Un._tickCounter)return;this._loggedMessages[e].set(s,Un._tickCounter),Un._scheduleTickCounterIncrement()}for(const s of fr.log.interceptors)if(s(e,this.module,...r))return;this._inheritedWriter()(e,this.module,...r)}}_parentWithMember(e,i){let r=this;for(;r!=null;){const s=r[e];if(s!=null)return s;r=r.parent}return i}_inheritedWriter(){return this._parentWithMember("writer",I8e)}_matchLevel(e){const i=fr.log.level||"warn";return Wce[this._parentWithMember("level",i)]<=Wce[e]}static _scheduleTickCounterIncrement(){Un._tickCounterScheduled||(Un._tickCounterScheduled=!0,Promise.resolve().then(()=>{Un._tickCounter++,Un._tickCounterScheduled=!1}))}},Un._loggers=new Map,Un._tickCounter=0,Un._tickCounterScheduled=!1,Un._throttlingDisabled=!1,Un);function I8e(t,e,...i){console[t](`[${e}]`,...i)}function L8e(...t){return Jbe(JSON.stringify(t,(i,r)=>typeof r!="object"||Array.isArray(r)?r:"[Object]"))}const k8e={remove:()=>{}};function ci(t){return t?{remove(){t&&(t(),t=void 0)}}:k8e}function Kbe(t){t.forEach(e=>e?.remove())}function Up(t){Kbe(t),t.length=0}function qu(t){return ci(()=>Kbe(t))}function lFt(t){return ci(()=>t()?.remove())}function z8e(t){return ci(()=>t?.abort())}function JV(t){return ci(t!=null?()=>t.destroy():void 0)}function F8e(t){return typeof t=="object"&&!!t&&"remove"in t&&typeof t.remove=="function"}function N8e(t){F8e(t)&&t.remove()}function cFt(t){return{[Symbol.dispose](){t.remove()}}}function al(t){return t.__accessor__??null}function V8e(t,e){return t?.metadata?.[e]!=null}function Bk(t,e,i){return i?CN(t,e,{policy:i,path:""}):CN(t,e,null)}function CN(t,e,i){return e?Object.keys(e).reduce((r,s)=>{const n=s;if(n==="__proto__")return r;let a=null,o="merge";if(i&&(a=i.path?`${i.path}.${s}`:s,o=i.policy(a)),o==="replace"||o==="replace-arrays"&&Array.isArray(r[n]))return r[n]=e[n],r;if(r[n]===void 0)return r[n]=Te(e[n]),r;let l=r[n],c=e[n];if(l===c)return r;if(Array.isArray(c)||Array.isArray(r))l=l?Array.isArray(l)?r[n]=l.slice():r[n]=[l]:r[n]=[],c&&(Array.isArray(c)||(c=[c]),c.forEach(h=>{l.includes(h)||l.push(h)}));else if(c&&typeof c=="object")if(i){const h=i.path;i.path=a,r[n]=CN(l,c,i),i.path=h}else r[n]=CN(l,c,null);else r.hasOwnProperty(s)&&!e.hasOwnProperty(s)||(r[n]=c);return r},t||{}):t}function ewe(t){return Array.isArray(t)?t:t.split(".")}function Zce(t){return t.includes(",")?t.split(",").map(e=>e.trim()):[t.trim()]}function U8e(t){if(Array.isArray(t)){const e=[];for(const i of t)e.push(...Zce(i));return e}return Zce(t)}function twe(t,e,i,r){const s=U8e(e);if(s.length!==1){const n=s.map(a=>r(t,a,i));return qu(n)}return r(t,s[0],i)}const Us={Dirty:1,Overridden:2,Computing:4,NonNullable:8,HasDefaultValue:16,DepTrackingInitialized:32,AutoTracked:64,ExplicitlyTracking:128};let KV=class{constructor(e){this.accessed=void 0,this._handles=void 0,this._observer=e}destroy(){this.accessed?.clear(),this.clear()}onAccessed(e){this._observer!=null&&e!==this._observer&&(this.accessed==null&&(this.accessed=new Set),this.accessed.add(e))}onTrackingEnd(){this._observer!=null&&(this.clear(),this.accessed!=null&&(this._handles==null&&(this._handles=[]),this.accessed.forEach(e=>{this._handles.push(e.observe(this._observer))}),this.accessed.clear()))}clear(){if(this._handles!=null){for(let e=0;e<this._handles.length;++e)this._handles[e].remove();this._handles.length=0}}};const MN=new KV,HA=[];let MP=MN;function vt(t){MP.onAccessed(t)}let jk=!1,qk=!1;function Gf(t,e,i){if(jk)return mK(t,e,i);let r=null;return iwe(t),r=e.call(i),rwe(),r}function B8e(t,e){return Gf(MN,t,e)}function mK(t,e,i){const r=jk;jk=!0,iwe(t);let s=null;try{s=e.call(i)}catch(n){qk&&fe.getLogger("esri.core.accessorSupport.tracking").error(n)}return rwe(),jk=r,s}function iwe(t){MP=t,HA.push(t)}function rwe(){const t=HA.length;if(t>1){const e=HA.pop();MP=HA[t-2],e.onTrackingEnd()}else if(t===1){const e=HA.pop();MP=MN,e.onTrackingEnd()}else MP=MN}function swe(t,e){if(e.flags&Us.DepTrackingInitialized)return;e.flags|=Us.DepTrackingInitialized;const i=qk;qk=!1,e.flags&Us.AutoTracked?mK(e.trackingTarget,e.metadata.get,t):nwe(t,e),qk=i}const j8e=[];function nwe(t,e){e.flags&Us.ExplicitlyTracking||(e.flags|=Us.ExplicitlyTracking,mK(e.trackingTarget,()=>{const i=e.metadata.dependsOn||j8e;for(const r of i)if(typeof r!="string"||r.includes(".")){const s=ewe(r);for(let n=0,a=t;n<s.length&&a!=null&&typeof a=="object";++n)a=Yce(a,s[n],n!==s.length-1)}else Yce(t,r,!1)}),e.flags&=-129)}function Yce(t,e,i){const r=e.endsWith("?")?e.slice(0,-1):e;if(t.getItemAt!=null||Array.isArray(t)){const n=parseInt(r,10);if(!isNaN(n))return Array.isArray(t)?t[n]:t.at(n)}const s=al(t);if(s){const n=s.propertiesByName.get(r);n&&(vt(n),swe(t,n))}return i?t[r]:void 0}let q8e=class{constructor(e,i){this._observers=e,this._observer=i}remove(){tM(this._observers,this._observer)}},awe=class{constructor(){this._observers=null,this.destroyed=!1}observe(e){if(this.destroyed||e.destroyed)return G8e;this._observers==null&&(this._observers=[]);const i=this._observers;let r=!1,s=!1;const n=i.length;for(let a=0;a<n;++a){const o=i[a];if(o.destroyed)s=!0;else if(o===e){r=!0;break}}return r||(i.push(e),s&&this._removeDestroyedObservers()),new q8e(i,e)}_removeDestroyedObservers(){const e=this._observers;if(!e||e.length===0)return;const i=e.length;let r=0;for(let s=0;s<i;++s){for(;s+r<i&&e[s+r].destroyed;)++r;if(r>0){if(!(s+r<i))break;e[s]=e[s+r]}}e.length=i-r}destroy(){if(this.destroyed)return;this.destroyed=!0;const e=this._observers;if(e!=null){for(const i of e)i.onCommitted();this._observers=null}}};const G8e=ci();let e2=class extends awe{notify(){const e=this._observers;if(e&&e.length>0){const i=e.slice();for(const r of i)r.onInvalidated(),r.onCommitted()}}},H8e=class{constructor(e,i){this._observable=new e2,this._value=e,this._equalityFunction=i}get value(){return vt(this._observable),this._value}set value(e){this._equalityFunction(e,this._value)||(this._value=e,this._observable.notify())}mutate(e){e(this._value),this._observable.notify()}};function Pn(t,e=Ybe){return new H8e(t,e)}let FD=class extends KV{constructor(e){super(new W8e(e)),this._observer&&Qce.register(this,new WeakRef(this._observer),this)}destroy(){this._observer&&Qce.unregister(this._observer),this.accessed?.clear(),this.clear(),this._observer?.destroy()}},W8e=class{constructor(e){this._notify=e,this._invalidCount=0,this.destroyed=!1}onInvalidated(){this._invalidCount++}onCommitted(){if(this.destroyed)return;const e=this._invalidCount;if(e===1)return this._invalidCount=0,void this._notify();this._invalidCount=e>0?e-1:0}destroy(){this.destroyed=!0,this._notify=Z8e}};const Qce=new FinalizationRegistry(t=>{t.deref()?.destroy()});function Z8e(){}function owe(){return new e2}function Y8e(t){return new FD(t)}function lwe(t){vt(t)}function Q8e(t,e){return Gf(t,e)}const X8e=zv`:host{display:block;box-sizing:border-box;*,*:before,*:after{box-sizing:inherit}}:host([hidden]){display:none}:host(:not(arcgis-basemap-gallery-item,arcgis-layer-list-item,arcgis-print-custom-text-elements,arcgis-print-dpi-input,arcgis-print-export-button,arcgis-print-exported-link,arcgis-print-exports-panel,arcgis-print-format-select,arcgis-print-layout-advanced-options,arcgis-print-layout-panel,arcgis-print-main-panel,arcgis-print-map-only-advanced-options,arcgis-print-map-only-panel,arcgis-print-out-spatial-reference-input,arcgis-print-preview-input,arcgis-print-scale-section,arcgis-print-template-select,arcgis-print-template-selector,arcgis-labeled-switch,arcgis-measurement-content,arcgis-version-management-service-item,arcgis-version-management-version-item,arcgis-version-management-version-list,arcgis-version-management-version-properties,arcgis-video-player-action-bar,arcgis-video-player-actions-group,arcgis-video-player-controls-group,arcgis-video-player-metadata,arcgis-video-player-settings,arcgis-video-player-slider)){font-family:var(--calcite-font-family)}`,ND=tbe({defaultAssetPath:"https://js.arcgis.com/4.34/map-components/",hydratedAttribute:"hydrated",commonStyles:X8e}),{customElement:cwe,getAssetPath:yFt,setAssetPath:_Ft}=ND;ND.t=lwe;ND.o=owe;ND.c=Y8e;ND.r=Q8e;function d(t,e,i,r){var s=arguments.length,n=s<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,i):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(a=t[o])&&(n=(s<3?a(n):s>3?a(e,i,n):a(e,i))||n);return s>3&&n&&Object.defineProperty(e,i,n),n}function vFt(t,e,i,r){function s(n){return n instanceof i?n:new i(function(a){a(n)})}return new(i||(i=Promise))(function(n,a){function o(h){try{c(r.next(h))}catch(f){a(f)}}function l(h){try{c(r.throw(h))}catch(f){a(f)}}function c(h){h.done?n(h.value):s(h.value).then(o,l)}c((r=r.apply(t,e||[])).next())})}function bFt(t,e,i){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,s;if(i){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],i&&(s=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");s&&(r=function(){try{s.call(this)}catch(n){return Promise.reject(n)}}),t.stack.push({value:e,dispose:r,async:i})}else i&&t.stack.push({async:!0});return e}var J8e=typeof SuppressedError=="function"?SuppressedError:function(t,e,i){var r=new Error(i);return r.name="SuppressedError",r.error=t,r.suppressed=e,r};function wFt(t){function e(n){t.error=t.hasError?new J8e(n,t.error,"An error was suppressed during disposal."):n,t.hasError=!0}var i,r=0;function s(){for(;i=t.stack.pop();)try{if(!i.async&&r===1)return r=0,t.stack.push(i),Promise.resolve().then(s);if(i.dispose){var n=i.dispose.call(i.value);if(i.async)return r|=2,Promise.resolve(n).then(s,function(a){return e(a),s()})}else r|=1}catch(a){e(a)}if(r===1)return t.hasError?Promise.reject(t.error):Promise.resolve();if(t.hasError)throw t.error}return s()}const Xce=new WeakMap;function K8e(t,e,i=!1){const r=` DEPRECATED - ${e}`;if(!i)return void t.warn(r);let s=Xce.get(t);s||(s=new Set,Xce.set(t,s)),s.has(e)||(s.add(e),t.warn(r))}const EN="https://www.esriurl.com/";function eBe(t,e,i,r={}){ie("esri-deprecation-warnings")&&cv(t,`This widget is deprecated. Use the ${e} component instead.`,{see:[`${e} component reference: ${EN}${i}/`,`Esri's move to web components: ${EN}components-transition-plan/`],replacement:`<${i}></${i}>`,warnOnce:!0,...r})}function tBe(t,e,i,r={}){ie("esri-deprecation-warnings")&&cv(t,`This view model is deprecated. Use the ${e} component directly instead.`,{see:[`${e} component reference: ${EN}${i}/`,`Esri's move to web components: ${EN}components-transition-plan/`],replacement:`<${i}></${i}>`,warnOnce:!0,...r})}function xFt(t,e,i={}){ie("esri-deprecation-warnings")&&cv(t,`Module: ${e}`,i)}function uwe(t,e,i={}){if(ie("esri-deprecation-warnings")){const{moduleName:r}=i;cv(t,`Function: ${(r?r+"::":"")+e+"()"}`,i)}}function XH(t,e,i={}){if(ie("esri-deprecation-warnings")){const{moduleName:r}=i;cv(t,`Property: ${(r?r+"::":"")+e}`,i)}}function iBe(t,e,i={}){ie("esri-deprecation-warnings")&&cv(t,`Multiple argument constructor: ${e}`,{warnOnce:!0,replacement:`new ${e}({ <your properties here> })`,...i})}function cv(t,e,i={}){if(ie("esri-deprecation-warnings")){const{replacement:r,version:s,see:n,warnOnce:a}=i;let o=e;if(r&&(o+=`
	 Replacement: ${r}`),s&&(o+=`
	 Version: ${s}`),n)if(Array.isArray(n)){o+=`
	 See for more details:`;for(const l of n)o+=`
		${l}`}else o+=`
	 See ${n} for more details.`;K8e(t,o,a)}}function SFt(t){const e=[];return function*(){yield*e;let i,r=e.length;for(;!(i=t.next()).done;)for(e.push(i.value),yield i.value;++r<e.length;)yield e[r]}}function rBe(t,e){for(const i of t)if(i!=null&&e(i))return i}function AN(t){return t!=null&&typeof t[Symbol.iterator]=="function"}let Fv=class{constructor(){this._groups=new Map}destroy(){this.removeAll()}get size(){let e=0;return this._groups.forEach(i=>{e+=i.length}),e}add(e,i){if(AN(e)){const r=this._getOrCreateGroup(i);for(const s of e)Kce(s)&&r.push(s)}else Kce(e)&&this._getOrCreateGroup(i).push(e);return this}forEach(e,i){if(typeof e=="function")this._groups.forEach(r=>r.forEach(e));else{const r=this._getGroup(e);r&&i&&r.forEach(i)}}has(e){return this._groups.has(t5(e))}remove(e){if(typeof e!="string"&&AN(e)){for(const i of e)this.remove(i);return this}return this.has(e)?(Jce(this._getGroup(e)),this._groups.delete(t5(e)),this):this}removeAll(){return this._groups.forEach(Jce),this._groups.clear(),this}removeReference(e){return this._groups.delete(e),this}_getOrCreateGroup(e){if(this.has(e))return this._getGroup(e);const i=[];return this._groups.set(t5(e),i),i}_getGroup(e){return this._groups.get(t5(e))}};function t5(t){return t||"_default_"}function Jce(t){for(const e of t)e instanceof Fv?e.removeAll():e.remove()}function Kce(t){return t!=null&&(!!t.remove||t instanceof Fv)}function rM(t,e){if(t==null)throw new Error(e??"value is None")}function Re(t){return t?.destroy(),null}function Rt(t){return t?.dispose(),null}function Ki(t){return t?.remove(),null}function ps(t){return t?.abort(),null}function Sr(t){return t?.release(),null}function sBe(t,e,i){return t!=null&&e!=null?i!=null?i(t,e):t.equals(e):t===e}function eue(t,e){return t?.[e]}function nBe(t,e){let i;return t.some((r,s)=>(i=e(r,s),i!=null)),i??void 0}const hwe=Symbol("Accessor-beforeDestroy");function dwe(t,e){const i=t.endsWith("?")?t.slice(0,-1):t;if(e.getItemAt!=null||Array.isArray(e)){const s=parseInt(i,10);if(!isNaN(s))return Array.isArray(e)?e[s]:e.at(s)}const r=al(e);return V8e(r,i)?r.get(i):e[i]}function pwe(t,e,i){if(t==null)return t;const r=dwe(e[i],t);return!r&&i<e.length-1?void 0:i===e.length-1?r:pwe(r,e,i+1)}function VD(t,e,i=0){return typeof e!="string"||e.includes(".")?pwe(t,ewe(e),i):dwe(e,t)}function tp(t,e){return VD(t,e)}function tue(t,e){return VD(e,t)!==void 0}const wu={INITIALIZING:0,CONSTRUCTING:1,CONSTRUCTED:2,DESTROYING:3,DESTROYED:4};function sM(t){let e=t.constructor.__accessorMetadata__;const i=Object.prototype.hasOwnProperty.call(t.constructor,"__accessorMetadata__");if(e){if(!i){e=Object.create(e);for(const r in e)e[r]=Te(e[r]);Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0})}}else e={},Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0});return t.constructor.__accessorMetadata__}function UD(t,e){const i=sM(t);let r=i[e];return r||(r=i[e]={}),r}function aBe(t,e){return Bk(t,e,lBe)}const oBe=/^(?:[^.]+\.)?(?:value|type|(?:json\.type|json\.origins\.[^.]\.type))$/;function lBe(t){return oBe.test(t)?"replace":"merge"}function cBe(t){return t?.release&&typeof t.release=="function"}function uBe(t){return t?.acquire&&typeof t.acquire=="function"}var J_;let Wl=(J_=class{constructor(e,i,r,s=1,n=0){this._creator=e,this._acquireFunction=i,this._releaseFunction=r,this.allocationSize=s,this._pool=new Array(n),this._initialSize=n;for(let a=0;a<n;a++)this._pool[a]=this._creator();this.allocationSize=Math.max(s,1)}destroy(){this.prune(0)}acquire(...e){let i;if(J_.test.disabled)i=this._creator();else{if(this._pool.length===0){const r=this.allocationSize;for(let s=0;s<r;s++)this._pool[s]=this._creator()}i=this._pool.pop()}return this._acquireFunction?this._acquireFunction(i,...e):uBe(i)&&i.acquire(...e),i}release(e){e&&!J_.test.disabled&&(this._releaseFunction?this._releaseFunction(e):cBe(e)&&e.release(),this._pool.push(e))}prune(e=this._initialSize){if(!(e>=this._pool.length)){for(let i=e;i<this._pool.length;++i){const r=this._pool[i];this._dispose(r)}this._pool.length=e}}_dispose(e){e.dispose&&typeof e.dispose=="function"&&e.dispose()}},J_.test={disabled:!!ie("esri-tests-disable-memory-pools")},J_),iue=class extends awe{constructor(e,i){super(),this.propertyName=e,this.metadata=i,this.trackingTarget=new KV(this),this.flags=0,this.flags=Us.Dirty|(i.nonNullable?Us.NonNullable:0)|(i.hasOwnProperty("value")?Us.HasDefaultValue:0)|(i.get===void 0?Us.DepTrackingInitialized:0)|(i.dependsOn===void 0?Us.AutoTracked:0)}destroy(){this.flags&Us.Dirty&&this.onCommitted(),super.destroy(),this.trackingTarget.destroy()}getComputed(e){e.mutable&&vt(this);const i=e.store,r=this.propertyName,s=this.flags,n=i.get(r);if(s&Us.Computing||~s&Us.Dirty&&i.has(r))return n;this.flags|=Us.Computing;const a=e.host;let o;s&Us.AutoTracked?o=Gf(this.trackingTarget,this.metadata.get,a):(nwe(a,this),o=this.metadata.get.call(a)),this.flags|=Us.DepTrackingInitialized,i.set(r,o,1);const l=i.get(r);return l===n?this.flags&=-2:B8e(this.commit,this),this.flags&=-5,l}notifyChange(){this.onInvalidated(),this.onCommitted()}invalidate(){this.onInvalidated()}commit(){this.flags&=-2,this.onCommitted()}onInvalidated(){~this.flags&Us.Overridden&&(this.flags|=Us.Dirty);const e=this._observers;if(e&&e.length>0)for(const i of e)i.onInvalidated()}onCommitted(){const e=this._observers;if(e&&e.length>0){const i=e.slice();for(const r of i)r.onCommitted()}}};const JH=8;function Ug(t){switch(t){case"defaults":return 0;case"service":return 2;case"portal-item":return 3;case"web-scene":return 4;case"web-map":return 5;case"link-chart":return 6;case"user":return 7;default:return null}}function ON(t){switch(t){case 0:return"defaults";case 2:return"service";case 3:return"portal-item";case 4:return"web-scene";case 5:return"web-map";case 6:return"link-chart";case 7:return"user"}}function hBe(t){return ON(t)}let dBe=class fwe{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const i=new fwe;return this._values.forEach((r,s)=>{e&&e.has(s)||i.set(s,Te(r))}),i}get(e){return this._values.get(e)}originOf(){return 7}keys(){return[...this._values.keys()]}set(e,i){this._values.set(e,i)}delete(e){this._values.delete(e)}has(e){return this._values.has(e)}isAtOrigin(e,i){return this.has(e)}isBelowOrigin(e,i){return!this.has(e)}forEach(e){this._values.forEach(e)}};function iS(t,e,i){return t!==void 0}function rue(t,e,i,r){return t!==void 0&&(!(i==null&&t.flags&Us.NonNullable)||(r.lifecycle,!1))}let pBe=class{constructor(e){this.host=e,this.propertiesByName=new Map,this.ctorArgs=null,this.lifecycle=wu.INITIALIZING,this.store=new dBe,this.mutable=!0,this._origin=7;const i=this.host.constructor.__accessorMetadata__;for(const r in i){const s=new iue(r,i[r]);this.propertiesByName.set(r,s)}this.metadata=i}initialize(){this.lifecycle=wu.CONSTRUCTING}constructed(){this.lifecycle=wu.CONSTRUCTED}destroy(){this.lifecycle=wu.DESTROYED,this.propertiesByName.forEach(e=>e.destroy())}get initialized(){return this.lifecycle!==wu.INITIALIZING}get(e){const i=this.propertiesByName.get(e);if(!iS(i))return;if(i.metadata.get)return i.getComputed(this);this.mutable&&vt(i);const r=this.store;return r.has(e)?r.get(e):i.metadata.value}originOf(e){const i=this.store.originOf(e);if(i===void 0){const r=this.propertiesByName.get(e);if(r!==void 0&&r.flags&Us.HasDefaultValue)return"defaults"}return ON(i)}has(e){return this.propertiesByName.has(e)&&this.store.has(e)}keys(){return[...this.propertiesByName.keys()]}internalGet(e){const i=this.propertiesByName.get(e);if(iS(i))return this.store.has(e)?this.store.get(e):i.metadata.value}internalSet(e,i){const r=this.propertiesByName.get(e);iS(r)&&this._internalSet(r,i)}getDependsInfo(e,i,r){const s=this.propertiesByName.get(i);if(!iS(s))return"";const n=new KV,a=Gf(n,()=>s.metadata.get?.call(e));let o=`${r}${e.declaredClass.split(".").pop()}.${i}: ${a}
`;const l=n.accessed??new Set;if(l.size===0)return o;r+="  ";for(const c of l)c instanceof iue&&(o+=`${r}${c.propertyName}: undefined
`);return o}setAtOrigin(e,i,r){const s=this.propertiesByName.get(e);if(iS(s))return this._setAtOrigin(s,i,r)}isOverridden(e){const i=this.propertiesByName.get(e);return i!==void 0&&!!(i.flags&Us.Overridden)}clearOrigin(e,i){const r=this.store,s=this.propertiesByName.get(e);if(!iS(s))return;const n=r.isAtOrigin(e,i)&&!(s.flags&Us.Overridden);r.delete(e,i),n&&s.notifyChange()}clearOverride(e){const i=this.propertiesByName.get(e);i&&i.flags&Us.Overridden&&(i.flags&=-3,i.notifyChange())}override(e,i){const r=this.propertiesByName.get(e);if(!rue(r,e,i,this))return;const s=r.metadata.cast;if(s){const n=this._cast(s,i),{valid:a,value:o}=n;if(R9.release(n),!a)return;i=o}r.flags|=Us.Overridden,this._internalSet(r,i)}set(e,i){const r=this.propertiesByName.get(e);if(!rue(r,e,i,this))return;const s=r.metadata.cast;if(s){const a=this._cast(s,i),{valid:o,value:l}=a;if(R9.release(a),!o)return;i=l}const n=r.metadata.set;n?n.call(this.host,i):this._internalSet(r,i)}setDefaultOrigin(e){this._origin=Ug(e)}getDefaultOrigin(){return ON(this._origin)}notifyChange(e){const i=this.propertiesByName.get(e);i!==void 0&&i.notifyChange()}invalidate(e){const i=this.propertiesByName.get(e);i!==void 0&&i.invalidate()}commit(e){const i=this.propertiesByName.get(e);i!==void 0&&i.commit()}_internalSet(e,i){const r=this.lifecycle!==wu.INITIALIZING?this._origin:0;this._setAtOrigin(e,i,r)}_setAtOrigin(e,i,r){const s=this.store,n=e.propertyName;if(s.isAtOrigin(n,r)&&fK(i,s.get(n))&&~e.flags&Us.Overridden)return;const a=s.isBelowOrigin(n,r)||s.isAtOrigin(n,r);a&&e.invalidate(),s.set(n,i,r),a&&e.commit(),swe(this.host,e)}_cast(e,i){const r=R9.acquire();return r.valid=!0,r.value=i,e&&(r.value=e.call(this.host,i,r)),r}},fBe=class{constructor(){this.value=null,this.valid=!0}acquire(){this.valid=!0}release(){this.value=null}};const R9=new Wl(()=>new fBe);function mBe(t,e){return t.replaceAll(/\$\{([^\s:}]*)(?::([^\s:}]+))?\}/g,(i,r)=>r===""?"$":(zD(r,e)??"").toString())}let mwe=class{constructor(e,i,r=void 0){this.name=e,this.details=r,this.message=(i&&mBe(i,r))??""}toString(){return"["+this.name+"]: "+this.message}},ee=class gwe extends mwe{constructor(e,i,r){super(e,i,r)}toJSON(){if(this.details!=null)try{return{name:this.name,message:this.message,details:JSON.parse(JSON.stringify(this.details,(e,i)=>{if(i&&typeof i=="object"&&typeof i.toJSON=="function")return i;try{return Te(i)}catch{return"[object]"}}))}}catch(e){throw fe.getLogger("esri.core.Error").error(e),e}return{name:this.name,message:this.message,details:this.details}}static fromJSON(e){return new gwe(e.name,e.message,e.details)}};ee.prototype.type="error";function PN(t,e,i){if(t&&e)if(typeof e=="object")for(const r of Object.getOwnPropertyNames(e))PN(t,r,e[r]);else{if(e.includes(".")){const s=e.split("."),n=s.splice(-1,1)[0];return void PN(tp(t,s),n,i)}const r=t.__accessor__;r!=null&&gBe(e,r),t[e]=i}}function gBe(t,e){if(ie("esri-unknown-property-errors")&&!yBe(t,e))throw new ee("set:unknown-property",_Be(t,e))}function yBe(t,e){return e.metadata[t]!=null}function _Be(t,e){return"setting unknown property '"+t+"' on instance of "+e.host.declaredClass}let vBe;function bBe(){return vBe}function wBe(t){t.length=0}let Mc=class{constructor(e=50,i=50){this._pool=new Wl(()=>[],void 0,wBe,i,e)}acquire(){return this._pool.acquire()}release(e){this._pool.release(e)}prune(){this._pool.prune(0)}static acquire(){return D9.acquire()}static release(e){return D9.release(e)}static prune(){D9.prune()}};const D9=new Mc(100);let ywe=class extends Wl{constructor(){super(...arguments),this._set=new Set}destroy(){super.destroy(),this._set=null}acquire(...e){const i=super.acquire(...e);return this._set.delete(i),i}release(e){e&&!this._set.has(e)&&(super.release(e),this._set.add(e))}_dispose(e){this._set.delete(e),super._dispose(e)}};const i5=[];function rC(t){i5.push(t),i5.length===1&&queueMicrotask(()=>{const e=i5.slice();i5.length=0;for(const i of e)i()})}let Bg=class{constructor(e,i=30){this.name=e,this._counter=0,this._samples=new Array(i)}push(e){e!=null&&(this._samples[++this._counter%this._samples.length]=e)}set(e){e!=null&&(this._samples[this._counter%this._samples.length]=e)}get median(){return this._samples.slice().sort((e,i)=>e-i)[Math.floor(this._samples.length/2)]}get average(){return this._samples.reduce((e,i)=>e+i,0)/this._samples.length}get last(){return this._samples[this._counter%this._samples.length]}};const RN=(t,e,i,r)=>{let s=e,n=e;const a=i>>>1,o=t[s-1];for(;n<=a;){n=s<<1,n<i&&r(t[n-1],t[n])<0&&++n;const l=t[n-1];if(r(l,o)<=0)break;t[s-1]=l,s=n}t[s-1]=o},_we=(t,e)=>t<e?-1:t>e?1:0;function xBe(t,e,i,r){i===void 0&&(i=t.length),r===void 0&&(r=_we);for(let n=i>>>1;n>e;n--)RN(t,n,i,r);const s=e+1;for(let n=i-1;n>e;n--){const a=t[e];t[e]=t[n],t[n]=a,RN(t,s,n,r)}}function*vwe(t,e,i,r){i===void 0&&(i=t.length),r===void 0&&(r=_we);for(let n=i>>>1;n>e;n--)RN(t,n,i,r),yield;const s=e+1;for(let n=i-1;n>e;n--){const a=t[e];t[e]=t[n],t[n]=a,RN(t,s,n,r),yield}}const SBe=1.5,TBe=1.1;let _i=class{constructor(e){this.data=[],this._length=0,this._allocator=void 0,this._deallocator=()=>null,this._shrink=()=>{},this._hint=new lK,e&&(e.initialSize&&(this.data=new Array(e.initialSize)),e.allocator&&(this._allocator=e.allocator),e.deallocator!==void 0&&(this._deallocator=e.deallocator),e.shrink&&(this._shrink=()=>sue(this)))}toArray(){return this.data.slice(0,this.length)}filter(e){const i=new Array;for(let r=0;r<this._length;r++){const s=this.data[r];e(s)&&i.push(s)}return i}at(e){if((e=Math.trunc(e)||0)<0&&(e+=this._length),!(e<0||e>=this._length))return this.data[e]}includes(e,i){const r=this.data.indexOf(e,i);return r!==-1&&r<this.length}get length(){return this._length}set length(e){if(e>this._length){if(this._allocator){for(;this._length<e;)this.data[this._length++]=this._allocator(this.data[this._length]);return}this._length=e}else{if(this._deallocator)for(let i=e;i<this._length;++i)this.data[i]=this._deallocator(this.data[i]);this._length=e,this._shrink()}}clear(){this.length=0}prune(){this.clear(),this.data=[]}push(e){this.data[this._length++]=e}pushArray(e,i=e.length){for(let r=0;r<i;r++)this.data[this._length++]=e[r]}fill(e,i){for(let r=0;r<i;r++)this.data[this._length++]=e}pushNew(){this._allocator&&(this.data[this.length]=this._allocator(this.data[this.length]));const e=this.data[this._length];return++this._length,e}unshift(e){this.data.unshift(e),this._length++,sue(this)}pop(){if(this.length===0)return;const e=this.data[this.length-1];return this.length=this.length-1,this._shrink(),e}remove(e){const i=MR(this.data,e,this.length,this._hint);if(i!==-1)return this.data.splice(i,1),this.length=this.length-1,e}removeUnordered(e){return this.removeUnorderedIndex(MR(this.data,e,this.length,this._hint))}removeUnorderedIndex(e){if(!(e>=this.length||e<0))return this.swapElements(e,this.length-1),this.pop()}removeUnorderedMany(e,i=e.length,r){this.length=T8e(this.data,e,this.length,i,this._hint,r),this._shrink()}front(){if(this.length!==0)return this.data[0]}back(){if(this.length!==0)return this.data[this.length-1]}swapElements(e,i){if(e>=this.length||i>=this.length||e===i)return;const r=this.data[e];this.data[e]=this.data[i],this.data[i]=r}sort(e){xBe(this.data,0,this.length,e)}iterableSort(e){return vwe(this.data,0,this.length,e)}some(e,i){for(let r=0;r<this.length;++r)if(e.call(i,this.data[r],r,this.data))return!0;return!1}find(e,i){const{data:r,length:s}=this;for(let n=0;n<s;++n)if(e.call(i,r[n]))return r[n]}filterInPlace(e,i){let r=0;for(let s=0;s<this._length;++s){const n=this.data[s];e.call(i,n,s,this.data)&&(this.data[s]=this.data[r],this.data[r]=n,r++)}if(this._deallocator)for(let s=r;s<this._length;s++)this.data[s]=this._deallocator(this.data[s]);return this._length=r,this._shrink(),this}forAll(e,i){const{data:r,length:s}=this;for(let n=0;n<s;++n)e.call(i,r[n],n,r)}forEach(e,i){this.data.slice(0,this.length).forEach(e,i)}map(e,i){const r=new Array(this.length);for(let s=0;s<this.length;++s)r[s]=e.call(i,this.data[s],s,this.data);return r}reduce(e,i){let r=i;for(let s=0;s<this.length;++s)r=e(r,this.data[s],s,this.data);return r}has(e){const i=this.length,r=this.data;for(let s=0;s<i;++s)if(r[s]===e)return!0;return!1}*[Symbol.iterator](){for(let e=0;e<this.length;e++)yield this.data[e]}};function sue(t){t.data.length>SBe*t.length&&(t.data.length=Math.floor(t.length*TBe))}function $Be(t){return{setTimeout:(e,i)=>{const r=t.setTimeout(e,i);return ci(()=>t.clearTimeout(r))}}}const nM=$Be(globalThis);function eU(t){return CBe(t)||bwe(t)}function CBe(t){return t!=null&&typeof t=="object"&&"on"in t&&typeof t.on=="function"}function bwe(t){return t!=null&&typeof t=="object"&&"addEventListener"in t&&typeof t.addEventListener=="function"}function aM(t,e,i){if(!eU(t))throw new TypeError("target is not a Evented or EventTarget object");return bwe(t)?MBe(t,e,i):t.on(e,i)}function MBe(t,e,i,r){if(Array.isArray(e)){const s=e.slice();for(const n of s)t.addEventListener(n,i,r);return ci(()=>{for(const n of s)t.removeEventListener(n,i,r)})}return t.addEventListener(e,i,r),ci(()=>t.removeEventListener(e,i,r))}function DN(t,e,i){if(!eU(t))throw new TypeError("target is not a Evented or EventTarget object");if("once"in t)return t.once(e,i);const r=aM(t,e,s=>{r.remove(),i.call(t,s)});return r}function Xt(t="Aborted"){return new ee("AbortError",t)}function st(t,e="Aborted"){if(Rn(t))throw Xt(e)}function EBe(t,e="Aborted"){if(t?.destroyed)throw Xt(e)}function BD(t){return t instanceof AbortSignal?t:t?.signal??void 0}function Rn(t){const e=BD(t);return e!=null&&e.aborted}function My(t){if(Hr(t))throw t}function KH(t){if(!Hr(t))throw t}function qa(t,e){const i=BD(t);if(i!=null){if(!i.aborted)return DN(i,"abort",()=>e());e()}}function jD(t,e){const i=BD(t);if(i!=null)return st(i),DN(i,"abort",()=>e(Xt()))}function Px(t,e){return BD(e)==null?t:new Promise((i,r)=>{let s=qa(e,()=>r(Xt()));const n=()=>{s=Ki(s)};t.then(n,n),t.then(i,r)})}function Hr(t){return t?.name==="AbortError"}async function Hf(t){try{return await t}catch(e){if(!Hr(e))throw e;return}}async function DFt(t,e=fe.getLogger("esri")){try{return await t}catch(i){Hr(i)||e.error(i)}}async function tU(t){if(!t)return;if(typeof t.forEach!="function"){const i=Object.keys(t),r=i.map(a=>t[a]),s=await tU(r),n={};return i.map((a,o)=>n[a]=s[o]),n}const e=t;return Promise.allSettled(e).then(i=>Array.from(e,(r,s)=>{const n=i[s];return n.status==="fulfilled"?{promise:r,value:n.value}:{promise:r,error:n.reason}}))}async function ABe(t){return(await Promise.allSettled(t)).filter(e=>e.status==="fulfilled").map(e=>e.value)}async function OBe(t){return(await Promise.allSettled(t)).filter(e=>e.status==="rejected").map(e=>e.reason)}function iU(t,e=void 0,i){const r=new AbortController;return qa(i,()=>r.abort()),new Promise((s,n)=>{let a=setTimeout(()=>{a=0,s(e)},t);qa(r,()=>{a&&(clearTimeout(a),n(Xt()))})})}function IFt(t,e,i,r){const s=i&&"abort"in i?i:null;r!=null||s||(r=i);let n=setTimeout(()=>{n=0,s?.abort()},e);const a=()=>r||new ee("promiseUtils:timeout","The wrapped promise did not resolve within "+e+" ms");return t.then(o=>{if(n===0)throw a();return clearTimeout(n),o},o=>{throw clearTimeout(n),n===0?a():o})}function PBe(t,e){const i=new AbortController,r=setTimeout(()=>i.abort(),e);return qa(t,()=>{i.abort(),clearTimeout(r)}),{...t,signal:i.signal}}function $a(t){return t&&typeof t.then=="function"}function eW(t){return $a(t)?t:Promise.resolve(t)}function wwe(t,e=-1){let i,r,s,n,a=null;const o=(...l)=>{if(i){r=l,n&&n.reject(Xt()),n=lo();const y=n.promise;if(a){const _=a;a=null,_.abort()}return y}if(s=n||lo(),n=null,e>0){const y=new AbortController;i=eW(t(...l,y.signal));const _=i;iU(e).then(()=>{i===_&&(n?y.abort():a=y)})}else i=1,i=eW(t(...l));const c=()=>{const y=r;r=s=i=a=null,y!=null&&o(...y)},h=i,f=s;return h.then(c,c),h.then(f.resolve,f.reject),f.promise};return o}function lo(){let t,e;const i=new Promise((s,n)=>{t=s,e=n}),r=s=>{t(s)};return r.resolve=s=>t(s),r.reject=s=>e(s),r.timeout=(s,n)=>nM.setTimeout(()=>r.reject(n),s),r.promise=i,r}function LFt(t,e){return t.then(e,e)}function kFt(t,e){e.then(t.resolve,t.reject)}async function nue(t){await Promise.resolve(),st(t)}function zFt(t){return t}function xwe(t){return 1e3*t}function FFt(t){return t}function gK(t){return .001*t}let RBe=class{constructor(e){this.phases=e,this.paused=!1,this.ticks=-1,this.removed=!1}},DBe=class{constructor(e){this.callback=e,this.isActive=!0}remove(){this.isActive=!1}},tW=0,iW=0;const EE={time:0,deltaTime:0,elapsedFrameTime:0,frameDuration:0},rW=["prepare","preRender","render","postRender","update","finish"],sW=[],uv=new _i;let IBe=class{constructor(e){this._task=e}remove(){this._task.removed=!0}pause(){this._task.paused=!0}resume(){this._task.paused=!1,Swe()}};function LBe(){gw!=null&&(cancelAnimationFrame(gw),gw=requestAnimationFrame(yK))}function Swe(){gw==null&&(tW=performance.now(),gw=requestAnimationFrame(yK))}const IN={frameTasks:uv,willDispatch:!1,clearFrameTasks:kBe,dispatch:$we,executeFrameTasks:FBe,reschedule:LBe};function oM(t){const e=new DBe(t);return sW.push(e),IN.willDispatch||(IN.willDispatch=!0,rC($we)),e}function Rx(t){const e=new RBe(t);return uv.push(e),Swe(),new IBe(e)}let gw=null;function kBe(t=!1){uv.forAll(e=>{e.removed=!0}),t&&Twe()}function zBe(t){iW=Math.max(0,t)}function yK(){const t=performance.now();gw=null,gw=uv.some(i=>!i.paused&&!i.removed)?requestAnimationFrame(yK):null,IN.executeFrameTasks(t)}function FBe(t){const e=t-tW;tW=t;const i=iW>0?iW:1e3/60,r=Math.max(0,e-i);EE.time=t,EE.frameDuration=i-r;for(let s=0;s<rW.length;s++){const n=performance.now(),a=rW[s];uv.forAll(o=>{o.paused||o.removed||(s===0&&o.ticks++,o.phases[a]&&(EE.elapsedFrameTime=performance.now()-t,EE.deltaTime=o.ticks===0?0:e,o.phases[a]?.call(o,EE)))}),BBe[s].push(performance.now()-n)}Twe(),jBe.push(performance.now()-t)}const WA=new _i;function Twe(){uv.forAll(t=>{t.removed&&WA.push(t)}),uv.removeUnorderedMany(WA.data,WA.length),WA.clear()}function NBe(){uv.prune(),WA.prune()}function $we(){for(;sW.length;){const t=sW.shift();t.isActive&&t.callback()}IN.willDispatch=!1}function Cwe(t=1,e){const i=lo(),r=()=>{Rn(e)?i.reject(Xt()):t===0?i():(--t,rC(()=>r()))};return r(),i.promise}function VBe(t){return Cwe(1,t)}async function UBe(t){await VBe(t),await new Promise(e=>requestAnimationFrame(()=>{t?.aborted||e()}))}const BBe=rW.map(t=>new Bg(t)),jBe=new Bg("total");function a3(t,e){for(const i of t.values())if(e(i))return!0;return!1}function aue(t,e){if(!e)return t;for(const i of e)i!=null&&t.add(i);return t}function BFt(t,e){return e!=null&&t.add(e),t}function _K(t,e){const i=new Set;return aue(i,t),aue(i,e),i}function Mwe(t,e){const i=new Set;for(const r of e)t.has(r)&&i.add(r);return i}function jFt(t,e){if(!t||!e)return!1;if(t===e)return!0;for(const i of t)if(!e.has(i))return!1;return!0}function qFt(t,e){if(t==null&&e==null)return!0;if(t==null||e==null||t.size!==e.size)return!1;for(const i of t)if(!e.has(i))return!1;return!0}function qBe(t,e){const i=new Set(t);for(const r of e)i.delete(r);return i}function GBe(t,e){return qBe(_K(t,e),Mwe(t,e))}let HBe=0;const EP=0;function ql(){return++HBe}let G3=!1;const LN=[];function Ewe(t,e){let i=new FD(n),r=null,s=!1;function n(){if(!i||s)return;if(G3)return void Owe(n);const o=r;i.clear(),G3=!0,s=!0,r=Gf(i,t),s=!1,G3=!1,e(r,o),vK()}function a(){i&&(i.destroy(),i=null,r=null)}return s=!0,r=Gf(i,t),s=!1,ci(a)}function Awe(t,e){let i=new FD(s),r=null;function s(){e(r,a)}function n(){i&&(i.destroy(),i=null),r=null}function a(){return i?(i.clear(),r=Gf(i,t),r):null}return a(),ci(n)}function WBe(t,e){let i=!1,r=!1;const s=!!e?.sync;let n=new FD(()=>{i||r||(r=!0,s?a():queueMicrotask(a))});function a(){r=!1,n&&!i&&(G3?Owe(a):(n.clear(),G3=!0,i=!0,Gf(n,t),i=!1,G3=!1,vK()))}function o(){n&&(n.destroy(),n=null)}return i=!0,Gf(n,t),i=!1,ci(o)}function Owe(t){LN.includes(t)||LN.unshift(t)}function vK(){for(;LN.length;)LN.pop()()}var Fw;let bK=(Fw=class{constructor(){this.uid=ql(),this.removed=!1,this.type=null,this.oldValue=null,this.callback=null,this.getValue=null,this.target=null,this.path=null,this.equals=null}static acquireUntracked(e,i,r,s,n){return this.pool.acquire(0,e,i,r,s,n,fK)}static acquireTracked(e,i,r,s){return this.pool.acquire(1,e,i,r,null,null,s)}notify(e,i){this.type===0?this.callback.call(this.target,e,i,this.path,this.target):this.callback.call(null,e,i,void 0,void 0)}acquire(e,i,r,s,n,a,o){this.uid=ql(),this.removed=!1,this.type=e,this.oldValue=i,this.callback=r,this.getValue=s,this.target=n,this.path=a,this.equals=o}release(){this.target=this.path=this.oldValue=this.callback=this.getValue=null,this.uid=ql(),this.removed=!0}},Fw.pool=new ywe(()=>new Fw),Fw);const Gk=new Mc,Xg=new Set;let kN;function zN(t){Xg.delete(t),Xg.add(t),Pwe()}function Pwe(){kN||(kN=oM(QBe))}function ZBe(t){if(t.removed)return;const e=t.oldValue,i=t.getValue();t.equals(e,i)||(t.oldValue=i,t.notify(i,e))}function YBe(t){for(const e of Xg.values())e.target===t&&(e.removed=!0)}function QBe(){let t=10;for(;kN&&t--;){kN=null;const e=XBe(),i=Gk.acquire();for(const r of e){const s=r.uid;ZBe(r),s===r.uid&&r.removed&&i.push(r)}for(const r of Xg)r.removed&&(i.push(r),Xg.delete(r));for(const r of i)bK.pool.release(r);Gk.release(i),Gk.release(e),nW.forEach(r=>r())}}function XBe(){const t=Gk.acquire();t.length=Xg.size;let e=0;for(const i of Xg)t[e]=i,++e;return Xg.clear(),t}const nW=new Set;function Rwe(t){return nW.add(t),ci(()=>nW.delete(t))}function JBe(t,e,i){let r=twe(t,e,i,(s,n,a)=>{let o,l,c=Awe(()=>VD(s,n),(h,f)=>{s.__accessor__?.lifecycle===wu.DESTROYED||o&&o.uid!==l?r.remove():(o||(o=bK.acquireUntracked(h,a,f,s,n),l=o.uid),zN(o))});return ci(()=>{c.remove(),o&&(o.uid!==l||o.removed||(o.removed=!0,zN(o)),o=null),r=c=null})});return r}function KBe(t,e,i){const r=twe(t,e,i,(s,n,a)=>{let o=!1;return Ewe(()=>VD(s,n),(l,c)=>{s.__accessor__.lifecycle!==wu.DESTROYED?o||(o=!0,fK(c,l)||a.call(s,l,c,n,s),o=!1):r.remove()})});return r}function eje(t,e,i,r=!1){return t.__accessor__&&t.__accessor__.lifecycle!==wu.DESTROYED?r?KBe(t,e,i):JBe(t,e,i):ci()}function tje(t,e,i){let r,s,n=Awe(t,(a,o)=>{r&&r.uid!==s?n.remove():(r||(r=bK.acquireTracked(a,e,o,i),s=r.uid),zN(r))});return ci(()=>{n.remove(),r&&(r.uid!==s||r.removed||(r.removed=!0,zN(r)),r=null),n=null})}function ije(t,e,i){let r=!1;return Ewe(t,(s,n)=>{r||(r=!0,i(n,s)||e(s,n),r=!1)})}function rje(t,e,i=!1,r=Ybe){return i?ije(t,e,r):tje(t,e,r)}function oue(t){return a3(Xg,e=>e.oldValue===t)}function Qd(t,e){for(const i of t.values())if(e(i))return!0;return!1}function aW(t,e){for(const i of t.values())if(!e(i))return!1;return!0}function GFt(t,e){if(t==null&&e==null)return!0;if(t==null||e==null||t.size!==e.size)return!1;for(const[i,r]of t)if(!e.has(i)||r!==e.get(i))return!1;return!0}function HFt(t,e){for(const i of t.values())if(e(i))return i;return null}function Cu(t,e,i){const r=t.get(e);if(r!==void 0)return r;const s=i();return t.set(e,s),s}function WFt(t){const e=new Map;return i=>(e.has(i)||e.set(i,t(i)),e.get(i))}const yw=()=>fe.getLogger("esri.core.accessorSupport.ensureTypes");function sje(t){if(t==null)return t;const e=new Date(t);return isNaN(e.getTime())?(yw().error("Accessor#set",`Invalid date value: '${t}', falling back to current date`),new Date):e}function nje(t){return t==null?t:!!t}function aje(t){return t==null?t:t.toString()}function xu(t,e=0){return t==null?t:(t=parseFloat(t),isNaN(t)?e:t)}function wK(t){return t==null?t:Math.round(parseFloat(t))}function oje(t){return null}function lje(t,e){return i=>{let r=t(i);return e.step!=null&&(r=Math.round(r/e.step)*e.step),e.min!=null&&(r=Math.max(e.min,r)),e.max!=null&&(r=Math.min(e.max,r)),r}}function Dwe(t){return t?.constructor&&t.constructor.__accessorMetadata__!==void 0}function FN(t,e){return e!=null&&t&&!(e instanceof t)}function Iwe(t){return t&&"isCollection"in t}function lue(t){return t?.Type?typeof t.Type=="function"?t.Type:t.Type.base:null}function cje(t,e){if(!e?.constructor||!Iwe(e.constructor))return oW(t,e)?e:new t(e);const i=lue(t.prototype.itemType),r=lue(e.constructor.prototype.itemType);return i?r?i===r?e:i.prototype.isPrototypeOf(r.prototype)?new t(e):(oW(t,e),e):new t(e):e}function oW(t,e){return!!Dwe(e)&&(yw().error("Accessor#set","Assigning an instance of '"+(e.declaredClass||"unknown")+"' which is not a subclass of '"+rU(t)+"'"),!0)}function qD(t,e){return e==null?e:Iwe(t)?cje(t,e):FN(t,e)?oW(t,e)?e:new t(e):e}function rU(t){return t?.prototype?.declaredClass||"unknown"}const uje=new WeakMap;function hje(t){switch(t){case Number:return e=>xu(e);case qi:return wK;case Boolean:return nje;case String:return aje;case Date:return sje;case GD:return oje;default:return Cu(uje,t,()=>qD.bind(null,t))}}function Ca(t,e){const i=hje(t);return arguments.length===1?i:i(e)}function ER(t,e,i){return arguments.length===1?ER.bind(null,t):e&&(Array.isArray(e)?e.map(r=>t(r,i)):[t(e,i)])}function dje(t,e){return arguments.length===1?ER(i=>Ca(t,i)):ER(i=>Ca(t,i),e)}function Lwe(t,e,i){return e!==0&&Array.isArray(i)?i.map(r=>Lwe(t,e-1,r)):t(i)}function NN(t,e,i){if(arguments.length===2)return n=>NN(t,e,n);if(!i)return i;i=Lwe(t,e,i);let r=e,s=i;for(;r>0&&Array.isArray(s);)r--,s=s[0];if(s!==void 0)for(let n=0;n<r;n++)i=[i];return i}function pje(t,e,i){return arguments.length===2?NN(r=>Ca(t,r),e):NN(r=>Ca(t,r),e,i)}function kwe(t){return!!Array.isArray(t)&&!t.some(e=>{const i=typeof e;return!(i==="string"||i==="number"||i==="function"&&t.length>1)})}function lW(t,e){if(arguments.length===2)return lW(t).call(null,e);const i=new Set,r=t.filter(o=>typeof o!="function"),s=t.filter(o=>typeof o=="function");for(const o of t)typeof o!="string"&&typeof o!="number"||i.add(o);let n=null,a=null;return(o,l)=>{if(o==null)return o;const c=typeof o,h=c==="string"||c==="number";return h&&(i.has(o)||s.some(f=>c==="string"&&f===String||c==="number"&&f===Number))||c==="object"&&s.some(f=>!FN(f,o))?o:(h&&r.length?(n||(n=r.map(f=>typeof f=="string"?`'${f}'`:`${f}`).join(", ")),yw().error("Accessor#set",`'${o}' is not a valid value for this property, only the following values are valid: ${n}`)):typeof o=="object"&&s.length?(a||(a=s.map(f=>rU(f)).join(", ")),yw().error("Accessor#set",`'${o}' is not a valid value for this property, value must be one of ${a}`)):yw().error("Accessor#set",`'${o}' is not a valid value for this property`),l&&(l.valid=!1),null)}}function ny(t,e){if(arguments.length===2)return ny(t).call(null,e);const i={},r=[],s=[];for(const l in t.typeMap){const c=t.typeMap[l];i[l]=Ca(c),r.push(rU(c)),s.push(l)}const n=()=>`'${r.join("', '")}'`,a=()=>`'${s.join("', '")}'`,o=typeof t.key=="string"?l=>l[t.key]:t.key;return l=>{if(t.base&&!FN(t.base,l)||l==null)return l;const c=o(l)||t.defaultKeyValue,h=i[c];if(!h)return yw().error("Accessor#set",`Invalid property value, value needs to be one of ${n()}, or a plain object that can autocast (having .type = ${a()})`),null;if(!FN(t.typeMap[c],l))return l;if(typeof t.key=="string"&&!Dwe(l)){const f={};for(const y in l)y!==t.key&&(f[y]=l[y]);return h(f)}return h(l)}}let qi=class{},GD=class{};const QFt={native:t=>({type:"native",value:t}),array:t=>({type:"array",value:t}),oneOf:t=>({type:"one-of",values:t})};function fje(t){if(!t||!("type"in t))return!1;switch(t.type){case"native":case"array":case"one-of":return!0}return!1}function zwe(t){switch(t.type){case"native":return Ca(t.value);case"array":return ER(zwe(t.value));case"one-of":return mje(t);default:return null}}function mje(t){let e=null;return(i,r)=>uW(i,t)?i:(e==null&&(e=cW(t)),yw().error("Accessor#set",`Invalid property value, value needs to be of type ${e}`),r&&(r.valid=!1),null)}function cW(t){switch(t.type){case"native":switch(t.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case qi:return"integer";case Date:return"date";case GD:return"null";default:return rU(t.value)}case"array":return`array of ${cW(t.value)}`;case"one-of":{const e=t.values.map(i=>cW(i));return`one of ${e.slice(0,-1)} or ${e[e.length-1]}`}}return"unknown"}function uW(t,e){if(t==null)return!0;switch(e.type){case"native":switch(e.value){case Number:case qi:return typeof t=="number";case Boolean:return typeof t=="boolean";case String:return typeof t=="string";case GD:return t===null}return t instanceof e.value;case"array":return!!Array.isArray(t)&&!t.some(i=>!uW(i,e.value));case"one-of":return e.values.some(i=>uW(t,i))}}function m(t={}){return(e,i)=>{if(e===Function.prototype)throw new Error(`Inappropriate use of @property() on a static field: ${e.name}.${i}. Accessor does not support static properties.`);const r=Object.getOwnPropertyDescriptor(e,i),s=UD(e,i);r&&(r.get||r.set?(s.get=r.get||s.get,s.set=r.set||s.set):"value"in r&&("value"in t&&fe.getLogger("esri.core.accessorSupport.decorators.property").warn(`@property() will redefine the value of "${i}" on "${e.constructor.name}" already defined in the metadata`,t),s.value=t.value=r.value)),t.readOnly!=null&&(s.readOnly=t.readOnly);const n=t.aliasOf;if(n){const l=typeof n=="string"?n:n.source,c=typeof n=="string"?null:n.overridable===!0;let h;s.dependsOn=[l],s.get=function(){let f=tp(this,l);if(typeof f=="function"){h||(h=l.split(".").slice(0,-1).join("."));const y=tp(this,h);y&&(f=f.bind(y))}return f},s.readOnly||(s.set=c?function(f){this._override(i,f)}:function(f){PN(this,l,f)})}const a=t.type,o=t.types;if(!s.cast){let l;a?l=gje(a):o&&(l=Array.isArray(o)?ER(ny(o[0])):ny(o)),t.cast=yje(t.cast,l)}aBe(s,t),t.range&&(s.cast=lje(s.cast,t.range))}}function xK(t,e,i){const r=UD(t,i);r.json||(r.json={});let s=r.json;return e!==void 0&&(s.origins||(s.origins={}),s.origins[e]||(s.origins[e]={}),s=s.origins[e]),s}function gje(t){let e=0,i=t;if(fje(t))return zwe(t);for(;Array.isArray(i)&&i.length===1&&typeof i[0]!="string"&&typeof i[0]!="number";)i=i[0],e++;const r=i;if(kwe(r))return e===0?lW(r):NN(lW(r),e);if(e===1)return dje(r);if(e>1)return pje(r,e);const s=t;return s.from?s.from:Ca(s)}function yje(t,e){if(t||e)return t?e?(i,r)=>e(t(i,r),r):t:e}function _je(t){if(t.json&&t.json.origins){const e=t.json.origins,i={"web-document":["web-scene","web-map"]};for(const r in i)if(e[r]){const s=e[r];i[r].forEach(n=>{e[n]=s}),delete e[r]}}}let ay=class extends mwe{constructor(e,i,r){super(e,i,r)}};ay.prototype.type="warning";function Fwe(t){return!!t&&t.prototype?.declaredClass&&t.prototype.declaredClass.indexOf("esri.core.Collection")===0}function vje(t,e){return SK(t,"any",e?.origin)}function VN(t,e){return SK(t,"read",e?.origin)}function Nwe(t,e){return SK(t,"write",e?.origin)}function SK(t,e,i){let r=t?.json;if(r?.origins&&i){let s;s=i==="link-chart"?r.origins[i]&&(e==="any"||e in r.origins[i])?r.origins[i]:r.origins["web-map"]:r.origins[i],s&&(e==="any"||e in s)&&(r=s)}return r}const hW=()=>fe.getLogger("esri.core.accessorSupport.extensions.serializableProperty.reader");function cue(t,e,i){t&&(!i&&!e.read||e.read?.reader||e.read?.enabled===!1||xje(t)&&Uf("read.reader",TK(t),e))}function TK(t){const e=t.ndimArray??0;if(e>1)return wje(t);if(e===1)return uue(t);if("type"in t&&Uwe(t.type)){const i=t.type.prototype?.itemType?.Type,r=uue(typeof i=="function"?{type:i}:{types:i});return(s,n,a)=>{const o=r(s,n,a);return o&&new t.type(o)}}return $K(t)}function $K(t){return"type"in t?bje(t.type):Sje(t.types)}function bje(t){return t.prototype.read?(e,i,r)=>{if(e==null)return e;const s=typeof e;if(s!=="object")return void hW().error(`Expected JSON value of type 'object' to deserialize type '${t.prototype.declaredClass}', but got '${s}'`);const n=new t;return n.read(e,r),n}:t.fromJSON}function Vwe(t,e,i,r){return r!==0&&Array.isArray(e)?e.map(s=>Vwe(t,s,i,r-1)):t(e,void 0,i)}function wje(t){const e=$K(t),i=Vwe.bind(null,e),r=t.ndimArray??0;return(s,n,a)=>{if(s==null)return s;s=i(s,a,r);let o=r,l=s;for(;o>0&&Array.isArray(l);)o--,l=l[0];if(l!==void 0)for(let c=0;c<o;c++)s=[s];return s}}function uue(t){const e=$K(t);return(i,r,s)=>{if(i==null)return i;if(Array.isArray(i)){const a=[];for(const o of i){const l=e(o,void 0,s);l!==void 0&&a.push(l)}return a}const n=e(i,void 0,s);return n!==void 0?[n]:void 0}}function Uwe(t){if(!Fwe(t))return!1;const e=t.prototype.itemType;return!(!e||!e.Type)&&(typeof e.Type=="function"?CK(e.Type):Bwe(e.Type))}function xje(t){return"types"in t?Bwe(t.types):CK(t.type)}function CK(t){return!Array.isArray(t)&&!!t&&t.prototype&&("read"in t.prototype||"fromJSON"in t||Uwe(t))}function Bwe(t){for(const e in t.typeMap)if(!CK(t.typeMap[e]))return!1;return!0}function Sje(t){let e=null;const i=t.errorContext??"type",r=t.validate;return(s,n,a)=>{if(s==null)return s;const o=typeof s;if(o!=="object")return void hW().error(`Expected JSON value of type 'object' to deserialize, but got '${o}'`);e||(e=$je(t));const l=t.key;if(typeof l!="string")return;const c=s[Tje(l,e,a)],h=c?e[c]:t.defaultKeyValue?t.typeMap[t.defaultKeyValue]:void 0;if(!h){const y=`Type '${c||"unknown"}' is not supported`;return a?.messages&&s&&a.messages.push(new ay(`${i}:unsupported`,y,{definition:s,context:a})),void hW().error(y)}const f=new h;return f.read(s,a),r?r(f):f}}function Tje(t,e,i){const r=Object.values(e)[0],s=sM(r.prototype)[t],n=VN(s,i),a=n?.read?.source;return a&&typeof a=="string"?a:t}function $je(t){const e={};for(const i in t.typeMap){const r=t.typeMap[i],s=sM(r.prototype);if(typeof t.key=="function")continue;const n=s[t.key];if(!n)continue;if(n.json?.type&&Array.isArray(n.json.type)&&n.json.type.length===1&&typeof n.json.type[0]=="string"){e[n.json.type[0]]=r;continue}const a=n.json?.write;if(!a?.writer){e[i]=r;continue}const o=a.target,l=typeof o=="string"?o:t.key,c={};a.writer(i,c,l),c[l]&&(e[c[l]]=r)}return e}function Cje(t){if(t.json||(t.json={}),due(t.json),pue(t.json),hue(t.json),t.json.origins)for(const e in t.json.origins)due(t.json.origins[e]),pue(t.json.origins[e]),hue(t.json.origins[e]);return!0}function hue(t){t.name&&(t.read&&typeof t.read=="object"?t.read.source===void 0&&(t.read.source=t.name):t.read={source:t.name},t.write&&typeof t.write=="object"?t.write.target===void 0&&(t.write.target=t.name):t.write={target:t.name})}function due(t){typeof t.read=="boolean"?t.read={enabled:t.read}:typeof t.read=="function"?t.read={enabled:!0,reader:t.read}:t.read&&typeof t.read=="object"&&t.read.enabled===void 0&&(t.read.enabled=!0)}function pue(t){typeof t.write=="boolean"?t.write={enabled:t.write}:typeof t.write=="function"?t.write={enabled:!0,writer:t.write}:t.write&&typeof t.write=="object"&&t.write.enabled===void 0&&(t.write.enabled=!0)}function fue(t,e){if(!e.write||e.write.writer||e.write.enabled===!1&&!e.write.overridePolicy)return;const i=t?.ndimArray??0;t&&(i===1||"type"in t&&Fwe(t.type))?e.write.writer=Aje:i>1?e.write.writer=Oje(i):e.types?Array.isArray(e.types)?e.write.writer=Eje(e.types[0]):e.write.writer=Mje(e.types):e.write.writer=AR}function Mje(t){return(e,i,r,s)=>e?jwe(e,t,s)?AR(e,i,r,s):void 0:AR(e,i,r,s)}function jwe(t,e,i){for(const r in e.typeMap)if(t instanceof e.typeMap[r])return!0;if(i?.messages){const r=e.errorContext??"type",s=`Values of type '${(typeof e.key!="function"?t[e.key]:t.declaredClass)??"Unknown"}' cannot be written`;i&&i.messages&&t&&i.messages.push(new ee(`${r}:unsupported`,s,{definition:t,context:i})),fe.getLogger("esri.core.accessorSupport.extensions.serializableProperty.writer").error(s)}return!1}function Eje(t){return(e,i,r,s)=>!e||!Array.isArray(e)?AR(e,i,r,s):AR(e.filter(n=>jwe(n,t,s)),i,r,s)}function AR(t,e,i,r){Uf(i,UN(t,r),e)}function UN(t,e){return t&&typeof t.write=="function"?t.write({},e):t&&typeof t.toJSON=="function"?t.toJSON():typeof t=="number"?BN(t):t}function BN(t){return t===-1/0?-Number.MAX_VALUE:t===1/0?Number.MAX_VALUE:isNaN(t)?null:t}function Aje(t,e,i,r){let s;t===null?s=null:t&&typeof t.map=="function"?(s=t.map(n=>UN(n,r)),typeof s.toArray=="function"&&(s=s.toArray())):s=[UN(t,r)],Uf(i,s,e)}function qwe(t,e,i){return i!==0&&Array.isArray(t)?t.map(r=>qwe(r,e,i-1)):UN(t,e)}function Oje(t){return(e,i,r,s)=>{let n;if(e===null)n=null;else{n=qwe(e,s,t);let a=t,o=n;for(;a>0&&Array.isArray(o);)a--,o=o[0];if(o!==void 0)for(let l=0;l<a;l++)n=[n]}Uf(r,n,i)}}function Pje(t){const e=Rje(t);if(t.json.origins)for(const i in t.json.origins){const r=t.json.origins[i],s=r.types?Dje(r):e;cue(s,r,!1),r.types&&!r.write&&t.json.write?.enabled&&(r.write={...t.json.write}),fue(s,r)}cue(e,t.json,!0),fue(e,t.json)}function Rje(t){return t.json.types?dW(t.json):t.type?Gwe(t):dW(t)}function Dje(t){return t.type?Gwe(t):dW(t)}function Gwe(t){if(!t.type)return;let e=0,i=t.type;for(;Array.isArray(i)&&!kwe(i);)i=i[0],e++;return{type:i,ndimArray:e}}function dW(t){if(!t.types)return;let e=0,i=t.types;for(;Array.isArray(i);)i=i[0],e++;return{types:i,ndimArray:e}}function Ije(t){Cje(t)&&(_je(t),Pje(t))}const I9=new Set,L9=new Set;function k(t){return e=>{t??="esri.core.Accessor",e.prototype.declaredClass=t,kje(e);const i=[],r=[];let s=e.prototype;for(;s;)s.hasOwnProperty("initialize")&&!I9.has(s.initialize)&&(I9.add(s.initialize),i.push(s.initialize)),s.hasOwnProperty("destroy")&&!L9.has(s.destroy)&&(L9.add(s.destroy),r.push(s.destroy)),s=Object.getPrototypeOf(s);I9.clear(),L9.clear();const n=class extends e{constructor(...o){if(super(...o),this.constructor===n&&typeof this.postscript=="function"){if(i.length&&Object.defineProperty(this,"initialize",{enumerable:!1,configurable:!0,value(){for(let l=i.length-1;l>=0;l--)i[l].call(this)}}),r.length){let l=!1;const c=this[hwe];Object.defineProperty(this,"destroy",{enumerable:!1,configurable:!0,value(){if(!l){this.__accessor__.lifecycle=wu.DESTROYING,l=!0,c.call(this);for(let h=0;h<r.length;h++)r[h].call(this)}}})}Object.defineProperty(this,Symbol.dispose,{enumerable:!1,configurable:!0,value(){this.destroy()}}),this.postscript()}}};n.__accessorMetadata__=sM(e.prototype),n.prototype.declaredClass=t;const a=(t||"AccessorSubclass").split(".").slice(-1)[0];return Object.defineProperty(n,"name",{value:a,configurable:!0}),n}}function Lje(t,e){return e.get==null?function(){const i=this.__accessor__,r=i.propertiesByName.get(t);if(r===void 0)return;i.mutable&&vt(r);const s=i.store;return s.has(t)?s.get(t):r.metadata.value}:function(){const i=this.__accessor__,r=i.propertiesByName.get(t);if(r!==void 0)return r.getComputed(i)}}function kje(t){const e=t.prototype,i=sM(e),r={};for(const s of Object.getOwnPropertyNames(i)){const n=i[s];Ije(n),r[s]={enumerable:!0,configurable:!0,get:Lje(s,n),set(a){const o=this.__accessor__;if(o!==void 0){if(o.mutable)return o.initialized&&n.readOnly?mue("read-only",s):o.lifecycle===wu.CONSTRUCTED&&n.constructOnly?mue("construct-only",s):void o.set(s,a)}else Object.defineProperty(this,s,{enumerable:!0,configurable:!0,writable:!0,value:a})}}}Object.defineProperties(t.prototype,r)}const mue=(t,e)=>{fe.getLogger("esri.core.Accessor").error(`cannot assign to ${t} property '${e}'`)};var gue,yue;function zje(t){if(t==null)return{value:t};if(Array.isArray(t))return{type:[t[0]],value:null};switch(typeof t){case"object":return t.constructor?.__accessorMetadata__||t instanceof Date?{type:t.constructor,value:t}:t;case"boolean":return{type:Boolean,value:t};case"string":return{type:String,value:t};case"number":return{type:Number,value:t};case"function":return{type:t,value:null};default:return}}const u0=Symbol("Accessor-Handles"),k9=Symbol("Accessor-Initialized");var K_;let Me=(K_=class{static createSubclass(e={}){if(Array.isArray(e))throw new Error("Multi-inheritance unsupported since 4.16");const{properties:i,declaredClass:r,constructor:s}=e;delete e.declaredClass,delete e.properties,delete e.constructor;const n=this;class a extends n{constructor(...l){super(...l),this.inherited=null,s&&s.apply(this,l)}}sM(a.prototype);for(const o in e){const l=e[o];a.prototype[o]=typeof l=="function"?function(...c){const h=this.inherited;let f;this.inherited=function(...y){if(n.prototype[o])return n.prototype[o].apply(this,y)};try{f=l.apply(this,c)}catch(y){throw this.inherited=h,y}return this.inherited=h,f}:e[o]}for(const o in i){const l=zje(i[o]);m(l)(a.prototype,o)}return k(r)(a)}static freeze(e){return e instanceof K_?e.__accessor__.mutable=!1:Object.freeze(e),e}static isFrozen(e){return e instanceof K_?!e.__accessor__.mutable:Object.isFrozen(e)}constructor(...e){if(this[gue]=null,this[yue]=!1,this.constructor===K_)throw new Error("[accessor] cannot instantiate Accessor. This can be fixed by creating a subclass of Accessor");const i=new pBe(this);Object.defineProperty(this,"__accessor__",{enumerable:!1,value:i}),e.length>0&&(i.ctorArgs=this.normalizeCtorArgs?.apply(this,e)??e[0])}postscript(){const e=this.__accessor__,i=e.ctorArgs;e.initialize(),i&&(this.set(i),e.ctorArgs=null),e.constructed(),this.initialize(),this[k9]=!0}initialize(){}[hwe](){this[u0]=Re(this[u0])}destroy(){this.destroyed||(YBe(this),this.__accessor__.destroy(),bBe()?.onInstanceDestroy(this))}[Symbol.dispose](){this.destroy()}get constructed(){return this.__accessor__&&this.__accessor__.initialized||!1}get initialized(){return this[k9]}get destroyed(){return this.__accessor__?.lifecycle===wu.DESTROYED||!1}get destroying(){return this.__accessor__?.lifecycle===wu.DESTROYING||!1}commitProperty(e){tp(this,e)}hasOwnProperty(e){return this.__accessor__?this.__accessor__.has(e):Object.prototype.hasOwnProperty.call(this,e)}keys(){return this.__accessor__?this.__accessor__.keys():[]}set(e,i){return PN(this,e,i),this}watch(e,i,r){return uwe(fe.getLogger(this),"`watch` is deprecated in favor of reactiveUtils.watch",{replacement:"reactiveUtils.watch",version:"4.32",see:"https://arcg.is/1vaqf42#watch",warnOnce:!0}),eje(this,e,i,r)}addHandles(e,i){if(this.destroyed){const r=Array.isArray(e)?e:[e];for(const s of r)s.remove();return}(this[u0]??=new Fv).add(e,i)}removeHandles(e){this[u0]?.remove(e)}removeAllHandles(){this[u0]?.removeAll()}removeHandlesReference(e){this[u0]?.removeReference(e)}hasHandles(e){return this[u0]?.has(e)===!0}_override(e,i){i===void 0?this.__accessor__.clearOverride(e):this.__accessor__.override(e,i)}_clearOverride(e){return this.__accessor__.clearOverride(e)}_overrideIfSome(e,i){i==null?this.__accessor__.clearOverride(e):this.__accessor__.override(e,i)}_isOverridden(e){return this.__accessor__.isOverridden(e)}notifyChange(e){this.__accessor__.notifyChange(e)}_get(e){return this.__accessor__.internalGet(e)}_set(e,i){return this.__accessor__.internalSet(e,i),this}},gue=u0,yue=k9,K_);const Fje=Symbol("ClonableMixin"),ur=t=>{var s;var e;const i=t;let r=(s=class extends i{constructor(){super(...arguments),this[e]=!0}clone(n){const a=al(this);rM(a,"unable to clone instance of non-accessor class");const o=a.metadata,l=a.store,c={},h=new Map;for(const y in o){const _=o[y],w=l?.originOf(y),x=_.clonable;if(_.readOnly||x===!1||w!==7&&w!==0&&w!==5&&w!==4)continue;const S=this[y];let $=null;if(typeof x=="function")$=x(S,n);else if(x==="reference")$=S;else if($=QH(S,n),S!=null&&$==null)continue;w===0?h.set(y,$):c[y]=$}const f=new(Object.getPrototypeOf(this)).constructor(c);if(h.size){const y=al(f)?.store;if(y)for(const[_,w]of h)y.set(_,w,0)}return f}},e=Fje,s);return r=d([k("esri.core.Clonable")],r),r},Nv=ur(Me);let Y1=class extends Nv{constructor(e){super(e),this.row=0,this.column=0,this.rows=1,this.columns=1}equals(e){return e!=null&&this.row===e.row&&this.rows===e.rows&&this.column===e.column&&this.columns===e.columns}};d([m({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],Y1.prototype,"row",void 0),d([m({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],Y1.prototype,"column",void 0),d([m({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],Y1.prototype,"rows",void 0),d([m({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],Y1.prototype,"columns",void 0),Y1=d([k("esri.CameraLayout")],Y1);const Hwe=Y1,_ue=new Float32Array(1);function Nje(t){--t;for(let e=1;e<32;e<<=1)t|=t>>e;return t+1}function Se(t,e,i){return Math.min(Math.max(t,e),i)}function Dx(t){return!(t&t-1)}function KFt(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t}function eNt(t){return 10**Math.ceil(Math.LOG10E*Math.log(t))}function ft(t,e,i){return t+(e-t)*i}function Vje(t,e){const i=-t*t/(2*e);return 1/Math.sqrt(2*Math.PI*e)*Math.exp(i)}function tNt(t,e,i,r,s){return ft(r,s,(t-e)/(i-e))}function Lt(t){return t*Math.PI/180}function Ea(t){return 180*t/Math.PI}function iNt(t,e=1e-6){return(t<0?-1:1)/Math.max(Math.abs(t),e)}function Ga(t){return Math.acos(Se(t,-1,1))}function zu(t){return Math.asin(Se(t,-1,1))}function Gl(t,e,i=1e-6){return t===e?!0:!Number.isFinite(t)||!Number.isFinite(e)?!1:(t>e?t-e:e-t)<=i}function rNt(t,e,i=1e-6){return!Gl(t,e,i)&&t>e}function sNt(t,e,i=1e-6){return!Gl(t,e,i)&&t<e}function nNt(t,e,i=1e-6){return Gl(t,e,i)||t>e}const jN=new DataView(new ArrayBuffer(Float64Array.BYTES_PER_ELEMENT));function pW(t){return jN.setFloat64(0,t),jN.getBigInt64(0)}function Uje(t){return jN.setBigInt64(0,t),jN.getFloat64(0)}const Hk=1000000n,Bje=Wwe(1);function Wwe(t){const e=pW(t=Math.abs(t)),i=Uje(e<=Hk?Hk:e-Hk);return Math.abs(t-i)}function jje(t,e,i=Bje){if(t===e)return!0;if(!Number.isFinite(t)||!Number.isFinite(e))return!1;if(i!=null&&Wwe(Math.min(Math.abs(t),Math.abs(e)))<i)return Math.abs(t-e)<=i;const r=pW(t),s=pW(e);return r<0!=s<0?!1:!((r<s?s-r:r-s)>Hk)}function MK(t,e,i=1e-6){if(t===e)return!0;if(!Number.isFinite(t)||!Number.isFinite(e))return!1;const r=Math.abs(t-e),s=Math.abs(t),n=Math.abs(e);if(t===0||e===0||s<1e-12&&n<1e-12){if(r>.01*i)return!1}else if(r/(s+n)>i)return!1;return!0}function qje(t){return Zwe(Math.max(-fW,Math.min(t,fW)))}function Zwe(t){return _ue[0]=t,_ue[0]}function sC(t,e,i){const r=Se((i-t)/(e-t),0,1);return r*r*(3-2*r)}function aNt(t){const e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[3]*t[3]+t[4]*t[4]+t[5]*t[5],r=t[6]*t[6]+t[7]*t[7]+t[8]*t[8];return!(Gl(e,1)&&Gl(i,1)&&Gl(r,1))}function Gje(t,e){return(t%e+e)%e}const fW=Zwe(34028234663852886e22);function oNt(t,e,i){if(i===void 0||+i==0)return Math[t](e);if(e=+e,i=+i,isNaN(e)||typeof i!="number"||i%1!=0)return NaN;let r=e.toString().split("e");return r=(e=Math[t](+(r[0]+"e"+(r[1]?+r[1]-i:-i)))).toString().split("e"),+(r[0]+"e"+(r[1]?+r[1]+i:i))}let sU=class{constructor(e,i){this.min=e,this.max=i,this.range=i-e}normalize(e,i=0,r=!1){return vue(this.range,this.min,this.max,e,i,r)}clamp(e,i=0){return Se(e-i,this.min,this.max)+i}monotonic(e,i,r){return e<i?i:i+mW(this.range,e-i,r)}minimalMonotonic(e,i,r){return vue(this.range,e,e+this.range,i,r)}center(e,i,r){return i=this.monotonic(e,i,r),this.normalize((e+i)/2,r)}diff(e,i,r){return this.monotonic(e,i,r)-e}shortestSignedDiff(e,i){e=this.normalize(e);const r=(i=this.normalize(i))-e,s=i<e?this.minimalMonotonic(e,i)-e:i-this.minimalMonotonic(i,e);return Math.abs(r)<Math.abs(s)?r:s}contains(e,i,r){return i=this.minimalMonotonic(e,i),(r=this.minimalMonotonic(e,r))>e&&r<i}};function vue(t,e,i,r,s=0,n=!1){return(r-=s)<e?r+=mW(t,e-r):r>i&&(r-=mW(t,r-i)),n&&r===i&&(r=e),r+s}function mW(t,e,i=0){return Math.ceil((e-i)/t)*t+i}const Hje=new sU(0,2*Math.PI),hv=new sU(-Math.PI,Math.PI),nU=new sU(0,360);let Wje=class Ywe{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const i=new Ywe;return this._values.forEach((r,s)=>{e&&e.has(s)||i.set(s,Te(r.value),r.origin)}),i}get(e,i){i=this._normalizeOrigin(i);const r=this._values.get(e);return i==null||r?.origin===i?r?.value:void 0}originOf(e){return this._values.get(e)?.origin??7}keys(e){e=this._normalizeOrigin(e);const i=[...this._values.keys()];return e==null?i:i.filter(r=>this._values.get(r)?.origin===e)}set(e,i,r){if((r=this._normalizeOrigin(r))===0){const s=this._values.get(e);if(s?.origin!=null&&s.origin>r)return}this._values.set(e,new Zje(i,r))}delete(e,i){(i=this._normalizeOrigin(i))!=null&&this._values.get(e)?.origin!==i||this._values.delete(e)}has(e,i){return(i=this._normalizeOrigin(i))!=null?this._values.get(e)?.origin===i:this._values.has(e)}isAtOrigin(e,i){return i=this._normalizeOrigin(i),this.has(e,i)&&this.originOf(e)===i}isBelowOrigin(e,i){return i=this._normalizeOrigin(i),!this.has(e)||this.originOf(e)<i}forEach(e){this._values.forEach(({value:i},r)=>e(i,r))}_normalizeOrigin(e){if(e!=null)return e===0?e:7}},Zje=class{constructor(e,i){this.value=e,this.origin=i}};function Qwe(t,e,i){e.keys().forEach(s=>{i.set(s,e.get(s),0)});const r=t.metadata;Object.keys(r).forEach(s=>{t.internalGet(s)&&i.set(s,t.internalGet(s),0)})}function Yje(t,e,i){if(!t?.read||t.read.enabled===!1||!t.read.source)return!1;const r=t.read.source;if(typeof r=="string"){if(r===e||r.includes(".")&&r.startsWith(e)&&tue(r,i))return!0}else for(const s of r)if(s===e||s.includes(".")&&s.startsWith(e)&&tue(s,i))return!0;return!1}function Qje(t){return t&&(!t.read||t.read.enabled!==!1&&!t.read.source)}function Xje(t,e,i,r,s){let n=VN(e[i],s);Qje(n)&&(t[i]=!0);for(const a of Object.getOwnPropertyNames(e))n=VN(e[a],s),Yje(n,i,r)&&(t[a]=!0)}function Jje(t,e,i,r){const s=i.metadata,n=vje(s[e],r),a=n?.default;if(a===void 0)return;const o=typeof a=="function"?a.call(t,e,r):a;o!==void 0&&i.set(e,o)}const Xwe={origin:"service"};function Jwe(t,e,i=Xwe){if(!e||typeof e!="object")return;const r=al(t),s=r.metadata,n={};for(const a of Object.getOwnPropertyNames(e))Xje(n,s,a,e,i);r.setDefaultOrigin(i.origin);for(const a of Object.getOwnPropertyNames(n)){const o=VN(s[a],i).read,l=o?.source;let c;c=l&&typeof l=="string"?VD(e,l):e[a],o?.reader&&(c=o.reader.call(t,c,e,i)),c!==void 0&&r.set(a,c)}if(!i||!i.ignoreDefaults){r.setDefaultOrigin("defaults");for(const a of Object.getOwnPropertyNames(s))n[a]||Jje(t,a,r,i)}r.setDefaultOrigin("user")}function Kje(t,e,i,r=Xwe){const s={...r,messages:[]};i(s),s.messages?.forEach(n=>{n.type!=="warning"||t.loaded?r?.messages&&r.messages.push(n):t.loadWarnings.push(n)})}function e9e(t,e,i,r,s){const n={};return e.write?.writer?.call(t,r,n,i,s),n}function Kwe(t,e,i,r,s,n){if(!r?.write)return!1;const a=tp(t,i);if(!s&&r.write.overridePolicy){const o=r.write.overridePolicy.call(t,a,i,n??void 0);o!==void 0&&(s=o)}if(s||(s=r.write),!s||s.enabled===!1||s.layerContainerTypes&&n?.layerContainerType&&!s.layerContainerTypes.includes(n.layerContainerType))return!1;if((a===null&&!s.allowNull&&!s.writerEnsuresNonNull||a===void 0)&&s.isRequired){const o=new ee("web-document-write:property-required",`Missing value for required property '${i}' on '${t.declaredClass}'`,{propertyName:i,target:t});return o&&n?.messages?n.messages.push(o):o&&!n&&fe.getLogger("esri.core.accessorSupport.write").error(o.name,o.message),!1}return!(a===void 0||a===null&&!s.allowNull&&!s.writerEnsuresNonNull||!s.alwaysWriteDefaults&&(!e.store.multipleOriginsSupported||e.store.originOf(i)===0)&&t9e(t,i,n,r,a)||!s.ignoreOrigin&&n?.origin&&e.store.multipleOriginsSupported&&e.store.originOf(i)<Ug(n.origin))}function t9e(t,e,i,r,s){const n=r.default;if(n===void 0)return!1;if(r.defaultEquals!=null)return r.defaultEquals(s);if(typeof n=="function"){if(Array.isArray(s)){const a=n.call(t,e,i??void 0);return sy(a,s)}return!1}return n===s}function uNt(t,e,i,r){const s=al(t),n=s.metadata,a=Nwe(n[e],r);return!!a&&Kwe(t,s,e,a,i,r)}function exe(t,e,i){if(t&&typeof t.toJSON=="function"&&(!t.toJSON.isDefaultToJSON||!t.write))return Bk(e,t.toJSON(i));const r=al(t),s=r.metadata;for(const n in s){const a=Nwe(s[n],i);if(!Kwe(t,r,n,a,void 0,i))continue;const o=tp(t,n),l=e9e(t,a,a.write&&typeof a.write.target=="string"?a.write.target:n,o,i);Object.keys(l).length>0&&(e=Bk(e,l),i?.resources?.pendingOperations?.length&&i.resources.pendingOperations.push(Promise.all(i.resources.pendingOperations).then(()=>Bk(e,l,()=>"replace-arrays"))),i?.writtenProperties&&i.writtenProperties.push({target:t,propName:n,oldOrigin:hBe(r.store.originOf(n)),newOrigin:i.origin}))}return e}const Vv=t=>{const e=t;let i=class extends e{constructor(...r){super(...r);const s=al(this),n=s.store,a=new Wje;s.store=a,Qwe(s,n,a)}read(r,s){Jwe(this,r,s)}write(r,s){return exe(this,r??{},s)}toJSON(r){return this.write({},r)}static fromJSON(r,s){return i9e.call(this,r,s)}};return i=d([k("esri.core.JSONSupport")],i),i.prototype.toJSON.isDefaultToJSON=!0,i};function i9e(t,e){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const i=new this;return i.read(t,e),i}const ke=Vv(Me),r9e=Object.prototype.toString;function s9e(t){const e="__accessorMetadata__"in t?Ca(t):t;return function(...i){if(i.push(e),typeof i[2]=="number")throw new Error("Using @cast has parameter decorator is not supported since 4.16");return n9e.apply(this,i)}}function n9e(t,e,i,r){UD(t,e).cast=r}function a9e(t){return(e,i)=>{UD(e,t).cast=e[i]}}function qr(...t){if(t.length!==3||typeof t[1]!="string")return t.length===1&&r9e.call(t[0])==="[object Function]"?s9e(t[0]):t.length===1&&typeof t[0]=="string"?a9e(t[0]):void 0}function di(t,e,i){let r,s;return e===void 0||Array.isArray(e)?(s=t,i=e,r=[void 0]):(s=e,r=Array.isArray(t)?t:[t]),(n,a)=>{const o=n.constructor.prototype;r.forEach(l=>{const c=xK(n,l,s);c.read&&typeof c.read=="object"||(c.read={}),c.read.reader=o[a],i&&(c.read.source=(c.read.source||[]).concat(i))})}}function Ht(t,e,i){let r,s;return e===void 0?(s=t,r=[void 0]):typeof e!="string"?(s=t,r=[void 0],i=e):(s=e,r=Array.isArray(t)?t:[t]),(n,a)=>{const o=n.constructor.prototype;for(const l of r){const c=xK(n,l,s);c.write&&typeof c.write=="object"||(c.write={}),i&&(c.write.target=i),c.write.writer=o[a]}}}let ta=class{constructor(e,i={ignoreUnknown:!1,useNumericKeys:!1}){this._jsonToAPI=e,this._options=i,this.apiValues=[],this.jsonValues=[],this._apiToJSON=o9e(e),this.apiValues=bue(this._apiToJSON),this.jsonValues=bue(this._jsonToAPI),this.read=r=>this.fromJSON(r),this.write=(r,s,n)=>{const a=this.toJSON(r);a!==void 0&&Uf(n,a,s)},this.write.isJSONMapWriter=!0}toJSON(e){if(e==null)return null;if(this._apiToJSON.hasOwnProperty(e)){const i=this._apiToJSON[e];return this._options.useNumericKeys?+i:i}return this._options.ignoreUnknown?null:e}fromJSON(e){return e!=null&&this._jsonToAPI.hasOwnProperty(e)?this._jsonToAPI[e]:this._options.ignoreUnknown?void 0:e}};function o9e(t){const e={};for(const i in t)e[t[i]]=i;return e}function bue(t){const e=[];for(const i in t)e.push(i);return e.sort(),e}function cl(){return function(t,e){return new ta(t,{ignoreUnknown:!0,...e})}}let EK=class{constructor(e,i,r,s,n,a){this.semiMajorAxis=e,this.flattening=i,this.outerAtmosphereRimWidth=r,this.atmosphereHeight=s,this.scaleHeight=n;const o=1-this.flattening;this.semiMinorAxis=this.semiMajorAxis*o,this.halfSemiMajorAxis=this.semiMajorAxis/2,this.halfCircumference=Math.PI*this.semiMajorAxis,this.metersPerDegree=this.halfCircumference/180,this.inverseFlattening=1/(1-this.flattening)-1,this.eccentricitySquared=a||2*this.flattening-this.flattening*this.flattening,this.meanRadiusSemiAxes=(2*this.semiMajorAxis+this.semiMinorAxis)/3}get radius(){return this.semiMajorAxis}};const mi=new EK(6378137,1/298.257223563,3e5,1e5,.085,.006694379990137799),dp=new EK(3396190,1/169.8944472236118,23e4,6e4,.111),oy=new EK(1737400,0,0,0,0),l9e="modulepreload",c9e=function(t){return"/delete-app/"+t},wue={},te=function(e,i,r){let s=Promise.resolve();if(i&&i.length>0){let l=function(c){return Promise.all(c.map(h=>Promise.resolve(h).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),o=a?.nonce||a?.getAttribute("nonce");s=l(i.map(c=>{if(c=c9e(c),c in wue)return;wue[c]=!0;const h=c.endsWith(".css"),f=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${f}`))return;const y=document.createElement("link");if(y.rel=h?"stylesheet":l9e,h||(y.as="script"),y.crossOrigin="",y.href=c,o&&y.setAttribute("nonce",o),document.head.appendChild(y),h)return new Promise((_,w)=>{y.addEventListener("load",_),y.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${c}`)))})}))}function n(a){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a}return s.then(a=>{for(const o of a||[])o.status==="rejected"&&n(o.reason);return e().catch(n)})};function OR(t){return t&&typeof t=="object"&&"toJSON"in t&&typeof t.toJSON=="function"}const u9e=/^https:\/\/([a-z\d-]+)(\.maps([^.]*))?\.arcgis\.com/i,h9e={devext:{customBaseUrl:"mapsdevext.arcgis.com",portalHostname:"devext.arcgis.com"},qaext:{customBaseUrl:"mapsqa.arcgis.com",portalHostname:"qaext.arcgis.com"},www:{customBaseUrl:"maps.arcgis.com",portalHostname:"www.arcgis.com"}};function xue(t){const e=t?.match(u9e);if(!e)return null;const[,i,r,s]=e;if(!i)return null;let n=null,a=null,o=null;const{devext:l,qaext:c,www:h}=h9e;if(r)if(n=i,s)switch(s.toLowerCase()){case"devext":({customBaseUrl:a,portalHostname:o}=l);break;case"qa":({customBaseUrl:a,portalHostname:o}=c);break;default:return null}else({customBaseUrl:a,portalHostname:o}=h);else switch(i.toLowerCase()){case"devext":({customBaseUrl:a,portalHostname:o}=l);break;case"qaext":({customBaseUrl:a,portalHostname:o}=c);break;case"www":({customBaseUrl:a,portalHostname:o}=h);break;default:return null}return{customBaseUrl:a,isPortal:!1,portalHostname:o,urlKey:n}}function txe(t){return/\/(sharing|usrsvcs)\/(appservices|servers)\//i.test(t)}function ixe(t){const e=/^https?:\/\/(?:cdn|[a-z\d-]+\.maps)\.arcgis\.com/i,i=/^https?:\/\/(?:cdndev|[a-z\d-]+\.mapsdevext)\.arcgis\.com/i,r=/^https?:\/\/(?:cdnqa|[a-z\d-]+\.mapsqa)\.arcgis\.com/i;return e.test(t)?t=t.replace(e,"https://www.arcgis.com"):i.test(t)?t=t.replace(i,"https://devext.arcgis.com"):r.test(t)&&(t=t.replace(r,"https://qaext.arcgis.com")),t}function rxe(t){const e=atob(t),i=new Uint8Array(e.length);for(let r=0;r<e.length;r++)i[r]=e.charCodeAt(r);return i.buffer}function d9e(t){const e=new Uint8Array(t);let i="";for(let r=0;r<e.length;r++)i+=String.fromCharCode(e[r]);return btoa(i)}const p9e=()=>fe.getLogger("esri.core.urlUtils"),lM=fr.request,Sue="esri/config: esriConfig.request.proxyUrl is not set.",sxe=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,nxe=/^\s*http:/i,f9e=/^\s*https:/i,m9e=/^\s*file:/i,axe=/:\d+$/,g9e=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,y9e=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),_9e=new RegExp("^((([^[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^[:]*))(:([0-9]+))?$");let _w=class{constructor(e=""){this.uri=e,this.scheme=null,this.authority=null,this.path=null,this.query=null,this.fragment=null,this.user=null,this.password=null,this.host=null,this.port=null;let i=this.uri.match(y9e);this.scheme=i[2]||(i[1]?"":null),this.authority=i[4]||(i[3]?"":null),this.path=i[5],this.query=i[7]||(i[6]?"":null),this.fragment=i[9]||(i[8]?"":null),this.authority!=null&&(i=this.authority.match(_9e),this.user=i[3]||null,this.password=i[4]||null,this.host=i[6]||i[7],this.port=i[9]||null)}toString(){return this.uri}};const r5={},v9e=new _w(fr.applicationUrl);let tl=v9e;const b9e=w9e();let AK=b9e;const OK=()=>tl,fNt=()=>AK;function w9e(){const t=tl.path,e=t.slice(0,t.lastIndexOf("/")+1);return`${`${tl.scheme}://${tl.host}${tl.port!=null?`:${tl.port}`:""}`}${e}`}function Ma(t){if(!t)return null;const e={path:null,query:null},i=new _w(t),r=t.indexOf("?");return i.query===null?e.path=t:(e.path=t.slice(0,r),e.query=PK(i.query)),i.fragment&&(e.hash=i.fragment,i.query===null&&(e.path=e.path.slice(0,e.path.length-(i.fragment.length+1)))),e}function PK(t){const e=t.split("&"),i={};for(const r of e){if(!r)continue;const s=r.indexOf("=");let n,a;s<0?(n=decodeURIComponent(r),a=""):(n=decodeURIComponent(r.slice(0,s)),a=decodeURIComponent(r.slice(s+1)));let o=i[n];typeof o=="string"&&(o=i[n]=[o]),Array.isArray(o)?o.push(a):i[n]=a}return i}function nC(t,e){return t?Object.keys(t).map(i=>{const r=t[i];if(r==null)return"";const s=encodeURIComponent(i)+"=",n=e?.[i];return n?s+encodeURIComponent(n(r)):Array.isArray(r)?r.map(a=>OR(a)?s+encodeURIComponent(JSON.stringify(a)):s+encodeURIComponent(a)).join("&"):OR(r)?s+encodeURIComponent(JSON.stringify(r)):s+encodeURIComponent(r)}).filter(i=>i).join("&"):""}function oxe(t=!1){let e,i=lM.proxyUrl;if(typeof t=="string"){e=hxe(t);const r=aU(t);r&&(i=r.proxyUrl)}else e=!!t;if(!i)throw p9e().warn(Sue),new ee("urlUtils:proxy-not-set",Sue);return e&&yW()&&(i=kK(i)),Ma(i)}function mNt(t,e=!1){const i=aU(t);let r,s;if(i){const n=RK(i.proxyUrl);r=n.path,s=n.query?PK(n.query):null}else if(e){const n=oxe(t);r=n.path,s=n.query}if(r){const n=Ma(t);t=r+"?"+n.path;const a=nC({...s,...n.query});a&&(t=`${t}?${a}`)}return t}const AE={path:"",query:""};function RK(t){const e=t.indexOf("?");return e!==-1?(AE.path=t.slice(0,e),AE.query=t.slice(e+1)):(AE.path=t,AE.query=null),AE}function lxe(t){return t=(t=GN(t=R9e(t=RK(t).path),!0)).toLowerCase()}function x9e(t){const e={proxyUrl:t.proxyUrl,urlPrefix:lxe(t.urlPrefix)},i=lM.proxyRules,r=e.urlPrefix;let s=i.length;for(let n=0;n<i.length;n++){const a=i[n].urlPrefix;if(r.startsWith(a)){if(r.length===a.length)return-1;s=n;break}a.startsWith(r)&&(s=n+1)}return i.splice(s,0,e),s}function aU(t){const e=lM.proxyRules,i=lxe(t);for(let r=0;r<e.length;r++)if(i.startsWith(e[r].urlPrefix))return e[r]}function S9e(t,e){if(!t||!e)return!1;t=qN(t),e=qN(e);const i=xue(t),r=xue(e);return i!=null&&r!=null?i.portalHostname===r.portalHostname:i==null&&r==null&&Ix(t,e,!0)}function T9e(t,e){return t=qN(t),e=qN(e),GN(t)===GN(e)}function qN(t){const e=(t=Jg(t)).indexOf("/sharing");return e>0?t.slice(0,e):t.replace(/\/+$/,"")}function gW(t,e=lM.interceptors){const i=r=>r instanceof RegExp?r.test(t):typeof r=="string"?t.startsWith(r):r==null;if(e){for(const r of e)if(Array.isArray(r.urls)){if(r.urls.some(i))return r}else if(i(r.urls))return r}return null}function Ix(t,e,i=!1){if(!t||!e)return!1;const r=vW(t),s=vW(e);return!(!i&&r.scheme!==s.scheme)&&r.host!=null&&s.host!=null&&r.host.toLowerCase()===s.host.toLowerCase()&&r.port===s.port}function DK(t){if(typeof t=="string"){if(!Ic(t))return!0;t=vW(t)}if(Ix(t,tl))return!0;const e=lM.trustedServers||[];for(let i=0;i<e.length;i++){const r=$9e(e[i]);for(let s=0;s<r.length;s++)if(Ix(t,r[s]))return!0}return!1}function $9e(t){return r5[t]||(LK(t)||Wf(t)?r5[t]=[new _w(Tu(t))]:r5[t]=[new _w(`http://${t}`),new _w(`https://${t}`)]),r5[t]}function Tu(t,e=AK,i){return Wf(t)?i?.preserveProtocolRelative?t:tl.scheme==="http"&&tl.authority===Pu(t).slice(2)?`http:${t}`:`https:${t}`:LK(t)?t:Mp(t.startsWith("/")?P9e(e):e,t)}function IK(t,e=AK,i){if(t==null||!Ic(t))return t;const r=Jg(t),s=r.toLowerCase(),n=Jg(e).toLowerCase().replace(/\/+$/,""),a=i?Jg(i).toLowerCase().replace(/\/+$/,""):null;if(a&&!n.startsWith(a))return t;const o=(f,y,_)=>(_=f.indexOf(y,_))===-1?f.length:_;let l=o(s,"/",s.indexOf("//")+2),c=-1;for(;s.slice(0,l+1)===n.slice(0,l)+"/"&&(c=l+1,l!==s.length);)l=o(s,"/",l+1);if(c===-1||a&&c<a.length)return t;t=r.slice(c);const h=n.slice(c-1).replaceAll(/[^/]+/g,"").length;if(h>0)for(let f=0;f<h;f++)t=`../${t}`;else t=`./${t}`;return t}function Jg(t){return t=L9e(t=I9e(t=D9e(t=Tu(t=t.trim()))))}function Mp(...t){const e=t.filter(qf);if(!e?.length)return;const i=[];if(Ic(e[0])){const s=e[0],n=s.indexOf("//");n!==-1&&(i.push(s.slice(0,n+1)),A9e(e[0])&&(i[0]+="/"),e[0]=s.slice(n+2))}else e[0].startsWith("/")&&i.push("");const r=e.reduce((s,n)=>n?s.concat(n.split("/")):s,[]);for(let s=0;s<r.length;s++){const n=r[s];n===".."&&i.length>0&&i[i.length-1]!==".."?i.pop():(!n&&s===r.length-1||n&&(n!=="."||i.length===0))&&i.push(n)}return i.join("/")}function Pu(t,e=!1){if(t==null||Lx(t)||rm(t))return null;let i=t.indexOf("://");if(i===-1&&Wf(t))i=2;else{if(i===-1)return null;i+=3}const r=t.indexOf("/",i);return r!==-1&&(t=t.slice(0,r)),e&&(t=GN(t,!0)),t}function Ic(t){return Wf(t)||LK(t)}function Lx(t){return t!=null&&t.startsWith("blob:")}function rm(t){return t!=null&&t.startsWith("data:")}function cxe(t){const e=aC(t);return e?.isBase64?rxe(e.data):null}function gNt(t){return d9e(t).replaceAll("+","-").replaceAll("/","_").replace(/=+$/,"")}const C9e=/^data:(.*?)(;base64)?,(.*)$/;function aC(t){const e=t.match(C9e);if(!e)return null;const[,i,r,s]=e;return{mediaType:i,isBase64:!!r,data:s}}function uxe(t){return t.isBase64?`data:${t.mediaType};base64,${t.data}`:`data:${t.mediaType},${t.data}`}async function M9e(t){return(await fetch(t)).blob()}function yNt(t){const e=cxe(t);if(!e)return null;const i=aC(t);return new Blob([e],{type:i.mediaType})}function Wf(t){return t!=null&&t.startsWith("/")&&t[1]==="/"}function LK(t){return t!=null&&sxe.test(t)}function hxe(t){return t!=null&&f9e.test(t)||tl.scheme==="https"&&Wf(t)}function E9e(t){return t!=null&&nxe.test(t)||tl.scheme==="http"&&Wf(t)}function A9e(t){return t!=null&&m9e.test(t)}function kK(t){return Wf(t)?`https:${t}`:t.replace(nxe,"https:")}function O9e(){return tl.scheme==="http"}function yW(){return tl.scheme==="https"}function GN(t,e=!1){return Wf(t)?t.slice(2):(t=t.replace(sxe,""),e&&t.length>1&&t.startsWith("/")&&t[1]==="/"&&(t=t.slice(2)),t)}function P9e(t){const e=t.indexOf("//"),i=t.indexOf("/",e+2);return i===-1?t:t.slice(0,i)}function _Nt(t){let e=0;if(Ic(t)){const r=t.indexOf("//");r!==-1&&(e=r+2)}const i=t.lastIndexOf("/");return i<e?t:t.slice(0,i+1)}function vNt(t,e){if(!t)return"";const i=Ma(t).path.replace(/\/+$/,""),r=i.slice(i.lastIndexOf("/")+1);if(!e?.length)return r;const s=new RegExp(`\\.(${e.join("|")})$`,"i");return r.replace(s,"")}function R9e(t){return t.endsWith("/")?t:`${t}/`}function dxe(t){return t.replace(/\/+$/,"")}function D9e(t){if(/^https?:\/\//i.test(t)){const e=RK(t);t=(t=e.path.replaceAll(/\/{2,}/g,"/")).replace("/","//"),e.query&&(t+=`?${e.query}`)}return t}function I9e(t){return t.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")}function L9e(t){const e=lM.httpsDomains;if(!E9e(t))return t;const i=t.indexOf("/",7);let r;if(r=i===-1?t:t.slice(0,i),r=r.toLowerCase().slice(7),axe.test(r)){if(!r.endsWith(":80"))return t;r=r.slice(0,-3),t=t.replace(":80","")}return O9e()&&r===tl.authority&&!g9e.test(t)||(yW()&&r===tl.authority||e&&e.some(s=>r===s||r.endsWith(`.${s}`))||yW()&&!aU(t))&&(t=kK(t)),t}function _W(t,e,i){if(!(e&&i&&t&&Ic(t)))return t;const r=t.indexOf("//"),s=t.indexOf("/",r+2),n=t.indexOf(":",r+2),a=Math.min(s<0?t.length:s,n<0?t.length:n);return t.slice(r+2,a).toLowerCase()!==e.toLowerCase()?t:`${t.slice(0,r+2)}${i}${t.slice(a)}`}function k9e(t,e){const i=new URL(t);return i.host=e,i.port&&!axe.test(e)&&(i.port=""),i.toString()}function bNt(t){return new URL(t).host}function vW(t){return typeof t=="string"?new _w(Tu(t)):(t.scheme||(t.scheme=tl.scheme),t)}function pxe(t){return z9e.test(t)}function fxe(t,e){const i=Ma(t),r=Object.keys(i.query||{});return r.length>0&&e&&e.warn("removeQueryParameters()",`Url query parameters are not supported, the following parameters have been removed: ${r.join(", ")}.`),i.path}function mxe(t,e,i){const r=Ma(t),s=r.query||{};return s[e]=String(i),`${r.path}?${nC(s)}`}function z9(t,e){if(!e)return t;const i=Ma(t),r=i.query||{};for(const[n,a]of Object.entries(e))a!=null&&(r[n]=a);const s=nC(r);return s?`${i.path}?${s}`:i.path}function zK(t){if(t==null)return null;const e=t.match(gxe);return e?e[2]:null}function Tue(t){if(t==null)return null;const e=t.match(gxe);return e?{path:e[1],extension:e[2]}:{path:t,extension:null}}async function wNt(t){return typeof t=="string"?aC(t)??{data:t}:new Promise((e,i)=>{const r=new FileReader;r.readAsDataURL(t),r.onload=()=>e(aC(r.result)),r.onerror=s=>i(s)})}const gxe=/([^.]*)\.([^/]*)$/,z9e=/(^data:image\/svg|\.svg$)/i,yxe="20251114",_xe="ec088c999de2dac6fb9478a47da1bad775545540";Symbol.dispose??=Symbol("Symbol.dispose"),Symbol.asyncDispose??=Symbol("Symbol.asyncDispose");const vxe="4.34";let hs,FK=vxe;function xNt(t){hs=t}function SNt(t){const e=hs?.findCredential(t);return e?.token?mxe(t,"token",e.token):t}FK="4.34.8",ie("host-webworker")||globalThis.$arcgis||Object.defineProperty(globalThis,"$arcgis",{configurable:!1,enumerable:!0,writable:!1,value:{}}),ie("host-webworker");function cM(t,e){const i=e?.url?.path;if(t&&i&&(t=Tu(t,i,{preserveProtocolRelative:!0}),e.portalItem&&e.readResourcePaths)){const r=IK(t,e.portalItem.itemUrl);r!=null&&r.startsWith(F9e)&&e.readResourcePaths.push(e.portalItem.resourceFromPath(r).path)}return(t=bW(t,e?.portal))&&lU.test(t)?NK(t):t}function oC(t,e,i=0){if((t=t&&lU.test(t)?Sxe(t):t)==null)return t;!Ic(t)&&e?.blockedRelativeUrls&&e.blockedRelativeUrls.push(t);let r=Tu(t);if(e){const s=e.verifyItemRelativeUrls?.rootPath||e.url?.path;if(s){const n=bW(s,e.portal),a=bW(r,e.portal);r=IK(a,n,n),r!=null&&r!==a&&r!==t&&e.verifyItemRelativeUrls&&e.verifyItemRelativeUrls.writtenUrls.push(r)}}return r=xxe(r,e?.portal),Ic(r)&&(r=Jg(r)),e?.resources&&e?.portalItem&&!Ic(r)&&!rm(r)&&i===0&&e.resources.toKeep.push({resource:e.portalItem.resourceFromPath(r),compress:!1}),r}function oU(t,e,i){return cM(t,i)}function lC(t,e,i,r){const s=oC(t,r);s!==void 0&&(e[i]=s)}const lU=/\/items\/([^/]+)\/resources\/(.*)/,F9e="./resources/";function bxe(t){return(t?.match(lU)??null)?.[1]??null}function wxe(t){const e=t?.match(lU)??null;if(e==null)return null;const i=e[2],r=i.lastIndexOf("/");if(r===-1){const{path:a,extension:o}=Tue(i);return{prefix:null,filename:a,extension:o}}const{path:s,extension:n}=Tue(i.slice(r+1));return{prefix:i.slice(0,r),filename:s,extension:n}}function xxe(t,e){return e&&!e.isPortal&&e.urlKey&&e.customBaseUrl?_W(t,`${e.urlKey}.${e.customBaseUrl}`,e.portalHostname):t}function bW(t,e){if(!e||e.isPortal||!e.urlKey||!e.customBaseUrl)return t;const i=`${e.urlKey}.${e.customBaseUrl}`,r=OK();return Ix(r,`${r.scheme}://${i}`)?_W(t,e.portalHostname,i):_W(t,i,e.portalHostname)}function NK(t){if(!t)return t||null;let e=t;return e&&hs&&!hs.findCredential(e)&&(e=ixe(e),e=e.replace(/^https?:\/\/www\.arcgis\.com/,"https://cdn.arcgis.com"),e=e.replace(/^https?:\/\/devext\.arcgis\.com/,"https://cdndev.arcgis.com"),e=e.replace(/^https?:\/\/qaext\.arcgis\.com/,"https://cdnqa.arcgis.com")),e}function Sxe(t){if(!t)return t||null;let e=t;return e=e.replace(/^https?:\/\/cdn\.arcgis\.com/,"https://www.arcgis.com"),e=e.replace(/^https?:\/\/cdndev\.arcgis\.com/,"https://devext.arcgis.com"),e=e.replace(/^https?:\/\/cdnqa\.arcgis\.com/,"https://qaext.arcgis.com"),e&&hs&&!hs.findCredential(e)&&(e=ixe(e)),e}const N9e=Object.freeze(Object.defineProperty({__proto__:null,ensureMainOnlineDomain:xxe,fromCDNUrl:Sxe,fromJSON:cM,itemIdFromResourceUrl:bxe,prefixAndFilenameFromResourceUrl:wxe,read:oU,toCDNUrl:NK,toJSON:oC,write:lC},Symbol.toStringTag,{value:"Module"})),Txe={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",knowledgegraphserver:"KnowledgeGraphServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer","3dtilesserver":"3DTilesServer",videoserver:"VideoServer"},$xe=Object.values(Txe),Cxe=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${$xe.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),V9e=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^/\\n]+)\\/(${$xe.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),U9e=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function TNt(t){return Cxe.test(t)}function HD(t){if(t==null)return null;const e=Ma(t),i=e?.path.match(Cxe)||e?.path.match(V9e);if(!i)return null;const[,r,s,n,a]=i,o=s.indexOf("/");return{title:Mxe(o!==-1?s.slice(o+1):s),serverType:Txe[n.toLowerCase()],sublayer:a!=null&&a!==""?parseInt(a,10):null,url:{path:r}}}function B9e(t){const e=Ma(t).path.match(U9e);return e?{serviceUrl:e[1],sublayerId:Number(e[2])}:null}function Mxe(t){return(t=t.replaceAll(/\s*[/_]+\s*/g," "))[0].toUpperCase()+t.slice(1)}function $Nt(t,e){const i=[];if(t){const r=HD(t);r!=null&&r.title&&i.push(r.title)}if(e){const r=Mxe(e);i.push(r)}if(i.length===2){if(i[0].toLowerCase().includes(i[1].toLowerCase()))return i[0];if(i[1].toLowerCase().includes(i[0].toLowerCase()))return i[1]}return i.join(" - ")}function $ue(t){let e=Pu(t,!0);return!!e&&(e=e.toLowerCase(),e.endsWith(".arcgis.com")&&(e.startsWith("services")||e.startsWith("tiles")||e.startsWith("features")||/^[a-z\d-]+\.svcs[a-z\d-]*\./.test(e)))}function CNt(t,e){return t&&dxe(fxe(t,e))}function MNt(t){let{url:e}=t;if(!e)return{url:e};e=fxe(e,t.logger);const i=Ma(e),r=HD(i.path);let s;if(r!=null)r.sublayer!=null&&t.layer.layerId==null&&(s=r.sublayer),e=r.url.path;else if(t.nonStandardUrlAllowed){const n=B9e(i.path);n!=null&&(e=n.serviceUrl,s=n.sublayerId)}return{url:dxe(e),layerId:s}}function ENt(t,e,i,r,s){lC(e,r,"url",s),r.url&&t.layerId!=null&&(r.url=Mp(r.url,i,t.layerId.toString()))}function ANt(t){if(!t)return!1;const e=t.toLowerCase(),i=e.includes("/services/"),r=e.includes("/mapserver/wmsserver"),s=e.includes("/imageserver/wmsserver"),n=e.includes("/wmsserver");return i&&(r||s||n)}const j9e=new Set(["elevation3d.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","static.arcgis.com"]);function VK(t){if(!UK(t))return null;const e=r=>r instanceof RegExp?r.test(t):typeof r=="string"&&t.startsWith(r),i=fr.apiKeys;if(Array.isArray(i.scopes)){for(const r of i.scopes)if(Array.isArray(r.urls)){if(r.urls.some(e))return r.token}else if(e(r.urls))return r.token}return i.basemapStyles&&/^https?:\/\/(i?basemaps|basemapstyles)-api\.arcgis\.com\//i.test(t)?i.basemapStyles:fr.apiKey&&/^https?:\/\/.+\.arcgis\.com(\/|$)/i.test(t)?fr.apiKey:null}function wW(){return fr.apiKey!=null||fr.apiKeys.basemapStyles!=null}function q9e(t,e){return e?UK(t):VK(t)!=null}function UK(t){const e=Pu(t,!0);return!!e&&!j9e.has(e)&&!t.endsWith("/sharing/rest/generateToken")}function Exe(t,e,i=!1,r){return new Promise((s,n)=>{if(Rn(r))return void n(Cue());let a=()=>{c(),n(new Error(`Unable to load ${e}`))},o=async()=>{const h=t;try{await h.decode()}catch{}c(),s(h)},l=()=>{if(!t)return;const h=t;c(),h.src="",n(Cue())};const c=()=>{t&&(t.removeEventListener("error",a),t.removeEventListener("load",o),a=null,o=null,t=null,r?.removeEventListener("abort",l),l=null,i&&URL.revokeObjectURL(e))};r?.addEventListener("abort",l),t.addEventListener("error",a),t.addEventListener("load",o)})}function Cue(){try{return new DOMException("Aborted","AbortError")}catch{const t=new Error;return t.name="AbortError",t}}const Axe="Timeout exceeded";function G9e(){return new Error(Axe)}function ONt(t){return typeof t=="object"&&!!t&&"message"in t&&t.message===Axe}function H9e(t){fr.request.crossOriginNoCorsDomains||(fr.request.crossOriginNoCorsDomains={});const e=fr.request.crossOriginNoCorsDomains;for(let i of t)i=i.toLowerCase(),/^https?:\/\//.test(i)?e[Pu(i)??""]=0:(e[Pu("http://"+i)??""]=0,e[Pu("https://"+i)??""]=0)}function W9e(t){const e=fr.request.crossOriginNoCorsDomains;if(e){let i=Pu(t);if(i)return i=i.toLowerCase(),!Ix(i,OK())&&e[i]<Date.now()-36e5}return!1}async function Z9e(t){const e=Ma(t);t=e.path,e.query?.f==="json"&&(t+="?f=json");try{await fetch(t,{mode:"no-cors",credentials:"include"})}catch{}const i=fr.request.crossOriginNoCorsDomains,r=Pu(t);i&&r&&(i[r.toLowerCase()]=Date.now())}const xW=new Map;function Y9e(t,e){const i=e?.preferredHost;if(!i||Ix(t,`https://${i}`,!0))return;const r=HD(t);if(!r||r.serverType!=="FeatureServer"||txe(t))return;const s=r.url.path.toLowerCase();xW.has(s)||xW.set(s,i)}function Mue(t){const e=HD(t)?.url.path.toLowerCase();if(!e)return t;const i=xW.get(e);return i?k9e(t,i):t}async function $r(t,e){t instanceof URL&&(t=t.toString()),e?.query instanceof URLSearchParams&&(e.query=PK(e.query.toString().replaceAll("+"," ")));const i=rm(t),r=Lx(t);r||i||(t=Jg(t));const s={url:t,requestOptions:{...e}},n=_=>({data:_,getAllHeaders:cC,getHeader:cC,httpStatus:200,requestOptions:s.requestOptions,url:s.url}),a=gW(t,Dh.internalInterceptors);if(a){const _=await Aue(a,s);if(_!=null)return n(_)}let o=gW(t);if(o){const _=await Aue(o,s);if(_!=null)return n(_);o.after||o.error||(o=null)}if(t=s.url,(e=s.requestOptions).responseType==="image"&&(ie("host-webworker")||ie("host-node")))throw pp("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),s);if(e.method==="head"){if(e.body)throw pp("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),s);if(i||r)throw pp("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),s)}if(await e7e(),HN)return HN.execute(t,e);const l=new AbortController,c=qa(e,()=>l.abort()),h={controller:l,credential:void 0,credentialToken:void 0,fetchOptions:void 0,hasToken:!1,interceptor:o,params:s,redoRequest:!1,useIdentity:Dh.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},f=e.useRequestQueue?n7e(h):TW(h),y=await f.finally(()=>c?.remove());return o?.after?.(y),y}let HN,Oxe=!1;const Dh=fr.request,Pxe="FormData"in globalThis,Q9e=new Set([499,498,403,401]),X9e=new Set(["COM_0056","COM_0057","SB_0008"]),J9e=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],cC=()=>null,WN=Symbol();function K9e(t){const e=Pu(t);e&&!$r._corsServers.includes(e)&&$r._corsServers.push(e)}function Eue(t){const e=Pu(t);return!e||e.endsWith(".arcgis.com")||$r._corsServers.includes(e)||DK(e)}function pp(t,e,i,r){let s;const n={url:i.url,requestOptions:i.requestOptions,getAllHeaders:cC,getHeader:cC,ssl:!1};if(e instanceof ee)return e.details?(e.details=Te(e.details),e.details.url=i.url,e.details.requestOptions=i.requestOptions):e.details=n,e;if(e){const a=r&&(()=>Array.from(r.headers)),o=r&&(h=>r.headers.get(h)),l=r?.status,c=e.message;c&&(s=c),a&&o&&(n.getAllHeaders=a,n.getHeader=o),n.httpStatus=(e.httpCode!=null?e.httpCode:e.code)||l||0,n.subCode=e.subcode,n.messageCode=e.messageCode,typeof e.details=="string"?(n.messages=[e.details],s??=e.details):(n.messages=e.details,s??=n.messages?.[0]),n.raw=WN in e?e[WN]:e}return s??="Error",Hr(e)?Xt():new ee(t,s,n)}async function e7e(){ie("host-webworker")&&(!HN&&globalThis.invokeStaticMessage?HN=await te(()=>import("./request-6RDpwrtu.js"),[]):Oxe=!0)}async function SW(){hs||await te(()=>import("./IdentityManager-CinhUBi0.js"),[])}async function t7e(t){const e=t.params.url,i=t.params.requestOptions,r=t.controller.signal,s=i.body;let n=null,a=null;if(Pxe&&"HTMLFormElement"in globalThis&&(s instanceof FormData?n=s:s instanceof HTMLFormElement&&(n=new FormData(s))),typeof s=="string"&&(a=s),t.fetchOptions={cache:i.cacheBust?"no-cache":"default",credentials:"same-origin",headers:i.headers||{},keepalive:i.keepAlive??!1,method:i.method==="head"?"HEAD":"GET",mode:"cors",priority:Dh.priority,redirect:"follow",signal:r},(n||a)&&(t.fetchOptions.body=n||a),(Oxe||i.authMode==="anonymous")&&(t.useIdentity=!1),t.hasToken=!!(/token=/i.test(e)||i.query?.token||n?.get("token")),!t.hasToken){const o=VK(e);o&&(i.query??={},i.query.token=o,t.hasToken=!0)}if(t.useIdentity&&!t.hasToken&&!t.credential&&!t.credentialToken&&!Rxe(e)&&!Rn(r)){let o;i.authMode==="immediate"?(await SW(),o=await hs.getCredential(e,{signal:r})):i.authMode==="no-prompt"?(await SW(),o=await hs.getCredential(e,{prompt:!1,signal:r}).catch(()=>{})):hs&&(o=hs.findCredential(e)),o&&(t.credential=o,t.credentialToken=o.token,t.useSSL=!!o.ssl)}}function Rxe(t){return J9e.some(e=>e.test(t))}async function i7e(t){let e=t.params.url,i=Mue(e);const r=t.params.requestOptions,s=t.fetchOptions??{},n=Lx(e)||rm(e),a=r.responseType||"json",o=n?0:r.timeout!=null?r.timeout:Dh.timeout;let l=!1;if(!n){t.useSSL&&(e=kK(e));let _={...r.query};t.credentialToken&&(_.token=t.credentialToken);let w=nC(_);ie("esri-url-encodes-apostrophe")&&(w=w.replaceAll("'","%27"));const x=i.length+1+w.length;let S;l=r.method==="delete"||r.method==="post"||r.method==="put"||!!r.body||x>Dh.maxUrlLength;const $=r.useProxy||!!aU(e);if($){const A=oxe(e);S=A.path,!l&&S.length+1+x>Dh.maxUrlLength&&(l=!0),A.query&&(_={...A.query,..._})}if(s.method==="HEAD"&&(l||$)){if(l)throw x>Dh.maxUrlLength?pp("request:invalid-parameters",new Error("URL exceeds maximum length"),t.params):pp("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),t.params);if($)throw pp("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),t.params)}l?(s.method=r.method==="delete"?"DELETE":r.method==="put"?"PUT":"POST",r.body?e=z9(e,_):(s.body=nC(_),s.headers||(s.headers={}),s.headers["Content-Type"]="application/x-www-form-urlencoded")):e=z9(e,_),$&&(t.useProxy=!0,e=`${S}?${e}`),_.token&&Pxe&&s.body instanceof FormData&&!txe(e)&&s.body.set("token",_.token),r.hasOwnProperty("withCredentials")?t.withCredentials=r.withCredentials:Ix(e,OK())||(DK(e)||hs&&hs.findServerInfo(e)?.webTierAuth)&&(t.withCredentials=!0),t.withCredentials&&(s.credentials="include",W9e(e)&&await Z9e(l?z9(e,_):e)),i=Mue(e)}let c,h,f=0,y=!1;o>0&&(f=setTimeout(()=>{y=!0,t.controller.abort()},o));try{if(r.responseType==="native-request-init")h=s,h.url=i,r.signal?h.signal=r.signal:delete h.signal;else if(r.responseType!=="image"||s.cache!=="default"||s.keepalive||s.method!=="GET"||l||r7e(r.headers)||!n&&!t.useProxy&&Dh.proxyUrl&&!Eue(e)){if($r._beforeFetch&&await $r._beforeFetch(e,s),c=await fetch(i,s),$r._afterFetch&&await $r._afterFetch(c),t.useProxy||K9e(e),r.responseType==="native")h=c;else if(s.method!=="HEAD")if(c.ok){switch(a){case"array-buffer":h=await c.arrayBuffer();break;case"blob":case"image":h=await c.blob();break;default:h=await c.text()}if(f&&(clearTimeout(f),f=0),a==="json"||a==="xml"||a==="document")if(h)switch(a){case"json":h=JSON.parse(h);break;case"xml":h=Oue(h,"application/xml");break;case"document":h=Oue(h,"text/html")}else h=null;if(h){if(a==="array-buffer"||a==="blob"){const _=c.headers.get("Content-Type");if(_&&/application\/json|text\/plain/i.test(_)&&h[a==="blob"?"size":"byteLength"]<=750)try{const w=await new Response(h).json();w.error&&(h=w)}catch{}}a==="image"&&h instanceof Blob&&(h=await Pue(URL.createObjectURL(h),t,!0))}}else{h=await c.text();try{h=JSON.parse(h)}catch{}}}else h=await Pue(i,t)}catch(_){if(_.name==="AbortError")throw y?G9e():Xt("Request canceled");if(!(!c&&_ instanceof TypeError&&Dh.proxyUrl)||r.body||r.method==="delete"||r.method==="head"||r.method==="post"||r.method==="put"||t.useProxy||Eue(e))throw _;t.redoRequest=!0,x9e({proxyUrl:Dh.proxyUrl,urlPrefix:Pu(e)??""})}finally{f&&clearTimeout(f)}return[c,h]}async function Aue(t,e){if(t.responseData!=null)return t.responseData;if(t.headers&&(e.requestOptions.headers={...e.requestOptions.headers,...t.headers}),t.query&&(e.requestOptions.query={...e.requestOptions.query,...t.query}),t.before){let i,r;try{r=await t.before(e)}catch(s){i=pp("request:interceptor",s,e)}if((r instanceof Error||r instanceof ee)&&(i=pp("request:interceptor",r,e)),i)throw t.error&&t.error(i),i;return r}}function r7e(t){if(t){for(const e of Object.getOwnPropertyNames(t))if(t[e])return!0}return!1}function Oue(t,e){let i;try{i=new DOMParser().parseFromString(t,e)}catch{}if(!i||i.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return i}$r._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"],$r._beforeFetch=void 0,$r._afterFetch=void 0;const s7e=new Map;async function n7e(t){const e=o7e(t.params.url);if(!e)return TW(t);const{QueueProcessor:i}=await te(()=>import("./QueueProcessor-rNTqujp4.js"),[]);return Cu(s7e,e.origin,()=>{const s=e.isHosted?ie("request-queue-concurrency-hosted"):ie("request-queue-concurrency-non-hosted");return new i({concurrency:s,process:n=>{if(Rn(n.params.requestOptions))throw pp("",Xt("Request canceled"),n.params);return TW(n)}})}).push(t)}async function TW(t){let e,i;await t7e(t);try{do[e,i]=await i7e(t);while(!await a7e(t,e,i))}catch(n){const a=pp("request:server",n,t.params,e);throw a.details.ssl=t.useSSL,t.interceptor?.error&&t.interceptor.error(a),a}const r=t.params.url;if(i)if(/\/sharing\/rest\/(accounts|portals)\/self/i.test(r)){if(!t.hasToken&&!t.credentialToken&&i.user?.username&&!DK(r)){const n=Pu(r,!0);n&&Dh.trustedServers.push(n)}Array.isArray(i.authorizedCrossOriginNoCorsDomains)&&H9e(i.authorizedCrossOriginNoCorsDomains)}else(t.params.requestOptions.responseType||"json")==="json"&&Y9e(r,i);const s=t.credential;if(s&&hs){let a=hs.findServerInfo(s.server)?.owningSystemUrl;if(a){a=a.replace(/\/?$/,"/sharing");const o=hs.findCredential(a,s.userId);o&&hs._getIdenticalSvcIdx(a,o)===-1&&o.resources.unshift(a)}}return{data:i,getAllHeaders:e?()=>Array.from(e.headers):cC,getHeader:e?n=>e.headers.get(n):cC,httpStatus:e?.status??200,requestOptions:t.params.requestOptions,ssl:t.useSSL,url:t.params.url}}async function a7e(t,e,i){if(t.redoRequest)return t.redoRequest=!1,!1;const r=t.params.requestOptions;if(!e||r.responseType==="native"||r.responseType==="native-request-init")return!0;let s,n;if(i&&(i.error&&typeof i.error=="object"?s=i.error:i.status==="error"&&Array.isArray(i.messages)&&(s={...i},s[WN]=i,s.details=i.messages)),!s&&!e.ok)throw s=new Error(`Unable to load ${e.url} status: ${e.status}`),s[WN]=i,s;let a,o=null;s&&(n=Number(s.code),o=s.hasOwnProperty("subcode")?Number(s.subcode):null,a=s.messageCode,a=a?.toUpperCase());const l=r.authMode;if(n===403&&(o===4||s.message?.toLowerCase().includes("ssl")&&!s.message.toLowerCase().includes("permission"))){if(!t.useSSL)return t.useSSL=!0,!1}else if(!t.hasToken&&t.useIdentity&&(l!=="no-prompt"||n===498)&&n!==void 0&&Q9e.has(n)&&!Rxe(t.params.url)&&(n!==403||(!a||!X9e.has(a))&&(o==null||o===2&&t.credentialToken))){await SW();try{const c=await hs.getCredential(t.params.url,{error:pp("request:server",s,t.params),credential:t.credential,prompt:l!=="no-prompt",signal:t.controller.signal,token:t.credentialToken});return t.credential=c,t.credentialToken=c.token,t.useSSL=t.useSSL||c.ssl,!1}catch(c){if(l==="no-prompt")return t.credential=void 0,t.credentialToken=void 0,!1;s=c}}if(s)throw s;return!0}function Pue(t,e,i=!1){const r=e.controller.signal,s=new Image;return e.withCredentials?s.crossOrigin="use-credentials":s.crossOrigin="anonymous",s.alt="",s.fetchPriority=Dh.priority,s.src=t,Exe(s,t,i,r)}function o7e(t){let e,i;return typeof t=="string"?(e=Pu(t,!0),i=$ue(t)):(e=t.origin,i=$ue(t.toString())),e==null?null:{origin:e,isHosted:i}}function l7e(t,e){return $r(Es(t),e)}function Es(t){if(!fr.assetsPath)throw fe.getLogger("esri.assets").errorOnce("The API assets location needs to be set using config.assetsPath. More information: https://arcg.is/1OzLe50"),new ee("assets:path-not-set","config.assetsPath is not set");return Mp(fr.assetsPath,t)}let F9,re=null;function Dxe(){return!!re}function c7e(){return!!ie("esri-wasm")}function Ixe(){return F9||(F9=te(async()=>{const{default:t}=await import("./pe-wasm-B87Q3u4k.js");return{default:t}},[]).then(({default:t})=>t({locateFile:e=>Es(`esri/geometry/support/${e}`)})).then(t=>{Vxe(t)}),F9)}const Wk={geogToProj(t,e,i){re.ensureCache.prepare();const r=kx(i),s=i===r,n=re.ensureFloat64(r),a=re._pe_geog_to_proj(re.getPointer(t),e,n);return a&&dv(i,e,n,s),a},projGeog(t,e,i,r){switch(r){case hn.PE_TRANSFORM_P_TO_G:return Wk.projToGeog(t,e,i);case hn.PE_TRANSFORM_G_TO_P:return Wk.geogToProj(t,e,i)}return 0},projToGeog:(t,e,i)=>Wk.projToGeogCenter(t,e,i,0),projToGeogCenter(t,e,i,r){re.ensureCache.prepare();const s=kx(i),n=i===s,a=re.ensureFloat64(s),o=re._pe_proj_to_geog_center(re.getPointer(t),e,a,r);return o&&dv(i,e,a,n),o}};let hn=class vr{static init(){vr.PE_BUFFER_MAX=re.PeDefs.prototype.PE_BUFFER_MAX,vr.PE_NAME_MAX=re.PeDefs.prototype.PE_NAME_MAX,vr.PE_MGRS_MAX=re.PeDefs.prototype.PE_MGRS_MAX,vr.PE_USNG_MAX=re.PeDefs.prototype.PE_USNG_MAX,vr.PE_DD_MAX=re.PeDefs.prototype.PE_DD_MAX,vr.PE_DDM_MAX=re.PeDefs.prototype.PE_DDM_MAX,vr.PE_DMS_MAX=re.PeDefs.prototype.PE_DMS_MAX,vr.PE_UTM_MAX=re.PeDefs.prototype.PE_UTM_MAX,vr.PE_PARM_MAX=re.PeDefs.prototype.PE_PARM_MAX,vr.PE_TYPE_NONE=re.PeDefs.prototype.PE_TYPE_NONE,vr.PE_TYPE_GEOGCS=re.PeDefs.prototype.PE_TYPE_GEOGCS,vr.PE_TYPE_PROJCS=re.PeDefs.prototype.PE_TYPE_PROJCS,vr.PE_TYPE_GEOGTRAN=re.PeDefs.prototype.PE_TYPE_GEOGTRAN,vr.PE_TYPE_COORDSYS=re.PeDefs.prototype.PE_TYPE_COORDSYS,vr.PE_TYPE_UNIT=re.PeDefs.prototype.PE_TYPE_UNIT,vr.PE_TYPE_LINUNIT=re.PeDefs.prototype.PE_TYPE_LINUNIT,vr.PE_STR_OPTS_NONE=re.PeDefs.prototype.PE_STR_OPTS_NONE,vr.PE_STR_AUTH_NONE=re.PeDefs.prototype.PE_STR_AUTH_NONE,vr.PE_STR_AUTH_TOP=re.PeDefs.prototype.PE_STR_AUTH_TOP,vr.PE_STR_NAME_CANON=re.PeDefs.prototype.PE_STR_NAME_CANON,vr.PE_STR_FMT_WKT=re.PeDefs.prototype.PE_STR_FMT_WKT,vr.PE_STR_FMT_WKT2=re.PeDefs.prototype.PE_STR_FMT_WKT2,vr.PE_PARM_X0=re.PeDefs.prototype.PE_PARM_X0,vr.PE_PARM_ND=re.PeDefs.prototype.PE_PARM_ND,vr.PE_TRANSFORM_1_TO_2=re.PeDefs.prototype.PE_TRANSFORM_1_TO_2,vr.PE_TRANSFORM_2_TO_1=re.PeDefs.prototype.PE_TRANSFORM_2_TO_1,vr.PE_TRANSFORM_P_TO_G=re.PeDefs.prototype.PE_TRANSFORM_P_TO_G,vr.PE_TRANSFORM_G_TO_P=re.PeDefs.prototype.PE_TRANSFORM_G_TO_P,vr.PE_HORIZON_RECT=re.PeDefs.prototype.PE_HORIZON_RECT,vr.PE_HORIZON_POLY=re.PeDefs.prototype.PE_HORIZON_POLY,vr.PE_HORIZON_LINE=re.PeDefs.prototype.PE_HORIZON_LINE,vr.PE_HORIZON_DELTA=re.PeDefs.prototype.PE_HORIZON_DELTA}},Lxe=null;const Rue={},Due={},Iue=t=>{const e=t.getType();switch(e){case hn.PE_TYPE_GEOGCS:t=re.castObject(t,re.PeGeogcs);break;case hn.PE_TYPE_PROJCS:t=re.castObject(t,re.PeProjcs);break;case hn.PE_TYPE_GEOGTRAN:t=re.castObject(t,re.PeGeogtran);break;default:e&hn.PE_TYPE_UNIT&&(t=re.castObject(t,re.PeUnit))}return t},nT={initialize(){re.PeFactory.prototype.initialize(null)},coordsys:t=>nT.factoryByType(hn.PE_TYPE_COORDSYS,t),factoryByType(t,e){let i=null,r=Rue[t];if(r||(r={},Rue[t]=r),r.hasOwnProperty(String(e))&&(i=r[e],re.compare(i,re.NULL)&&(i=null)),!i){const s=re.PeFactory.prototype.factoryByType(t,e);re.compare(s,re.NULL)||(i=Iue(s),r[e]=i)}return i},fromString(t,e){let i=null,r=Due[t];if(r||(r={},Due[t]=r),r.hasOwnProperty(e)&&(i=r[e],re.compare(i,re.NULL)&&(i=null)),!i){const s=re.PeFactory.prototype.fromString(t,e);re.compare(s,re.NULL)||(i=Iue(s),r[e]=i)}return i},geogcs:t=>nT.factoryByType(hn.PE_TYPE_GEOGCS,t),geogtran:t=>nT.factoryByType(hn.PE_TYPE_GEOGTRAN,t),getCode:t=>re.PeFactory.prototype.getCode(t),projcs:t=>nT.factoryByType(hn.PE_TYPE_PROJCS,t),unit:t=>nT.factoryByType(hn.PE_TYPE_UNIT,t)};let Lue,kxe=null;const BK={PE_GTLIST_OPTS_COMMON:0,init(){BK.PE_GTLIST_OPTS_COMMON=re.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON,Lue=re._pe_getPeGTlistExtendedEntrySize()},getGTlist(t,e,i,r,s,n){let a=null;const o=new re.PeInteger(n);try{const l=re.PeGTlistExtended.prototype.getGTlist(t,e,i,r,s,o);if((n=o.val)&&(a=[l],n>1)){const c=re.getPointer(l);for(let h=1;h<n;h++)a.push(re.wrapPointer(c+Lue*h,re.PeGTlistExtendedEntry))}}finally{re.destroy(o)}return a}},u7e={destroy(t){if(t?.length){for(const e of t)Nd(e),e.getEntries().forEach(i=>{Nd(i);const r=i.getGeogtran();Nd(r),r.getParameters().forEach(Nd),[r.getGeogcs1(),r.getGeogcs2()].forEach(s=>{Nd(s);const n=s.getDatum();Nd(n),Nd(n.getSpheroid()),Nd(s.getPrimem()),Nd(s.getUnit())})});re.PeGTlistExtendedEntry.prototype.Delete(t[0])}}},h7e={geogToGeog(t,e,i,r,s){re.ensureCache.prepare();const n=kx(i),a=i===n,o=re.ensureFloat64(n);let l=0;r&&(l=re.ensureFloat64(r));const c=re._pe_geog_to_geog(re.getPointer(t),e,o,l,s);return c&&dv(i,e,o,a),c}},d7e={geodesicCoordinate(t,e,i,r,s,n,a,o){re.PeLineType.prototype.geodesic_coordinate(t,e,i,r,s,n,a,o)},geodeticCoordinate(t,e,i,r,s,n,a,o,l){re.PeLineType.prototype.geodetic_coordinate(t,e,i,r,s,n,a,o,l)},geodeticDistance(t,e,i,r,s,n,a,o,l,c){re.PeLineType.prototype.geodetic_distance(t,e,i,r,s,n,a,o,l,c)},greatEllipticDistance(t,e,i,r,s,n,a,o,l){re.PeLineType.prototype.great_elliptic_distance(t,e,i,r,s,n,a,o,l)}},p7e={phiToEta:(t,e)=>re.PeMath.prototype.phi_to_eta(t,e),etaToPhi:(t,e)=>re.PeMath.prototype.eta_to_phi(t,e),phiToPhig:(t,e)=>re.PeMath.prototype.phi_to_phig(t,e),q:(t,e,i)=>re.PeMath.prototype.q(t,e,i),q90:(t,e)=>re.PeMath.prototype.q90(t,e)},N9=(t,e,i,r,s,n)=>{let a,o;switch(re.ensureCache.prepare(),t){case"dd":a=re._pe_geog_to_dd,o=hn.PE_DD_MAX;break;case"ddm":a=re._pe_geog_to_ddm,o=hn.PE_DDM_MAX;break;case"dms":a=re._pe_geog_to_dms,o=hn.PE_DMS_MAX}let l=0;e&&(l=re.getPointer(e));const c=kx(r),h=re.ensureFloat64(c),f=cU(i,o),y=a(l,i,h,s,re.ensureInt32(f));if(y)for(let _=0;_<i;_++)n[_]=re.UTF8ToString(f[_]);return y},V9=(t,e,i,r,s)=>{let n;switch(re.ensureCache.prepare(),t){case"dd":n=re._pe_dd_to_geog;break;case"ddm":n=re._pe_ddm_to_geog;break;case"dms":n=re._pe_dms_to_geog}let a=0;e&&(a=re.getPointer(e));const o=r.map(f=>re.ensureString(f)),l=re.ensureInt32(o),c=re.ensureFloat64(new Array(2*i)),h=n(a,i,l,c);return h&&dv(s,i,c),h},f7e={geogToDms:(t,e,i,r,s)=>N9("dms",t,e,i,r,s),dmsToGeog:(t,e,i,r)=>V9("dms",t,e,i,r),geogToDdm:(t,e,i,r,s)=>N9("ddm",t,e,i,r,s),ddmToGeog:(t,e,i,r)=>V9("ddm",t,e,i,r),geogToDd:(t,e,i,r,s)=>N9("dd",t,e,i,r,s),ddToGeog:(t,e,i,r)=>V9("dd",t,e,i,r)};let zxe=class aT{static init(){aT.PE_MGRS_STYLE_NEW=re.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW,aT.PE_MGRS_STYLE_OLD=re.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD,aT.PE_MGRS_STYLE_AUTO=re.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO,aT.PE_MGRS_180_ZONE_1_PLUS=re.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS,aT.PE_MGRS_ADD_SPACES=re.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES}static geogToMgrsExtended(e,i,r,s,n,a,o){re.ensureCache.prepare();let l=0;e&&(l=re.getPointer(e));const c=kx(r),h=re.ensureFloat64(c),f=cU(i,hn.PE_MGRS_MAX),y=re.ensureInt32(f),_=re._pe_geog_to_mgrs_extended(l,i,h,s,n,a,y);if(_)for(let w=0;w<i;w++)o[w]=re.UTF8ToString(f[w]);return _}static mgrsToGeogExtended(e,i,r,s,n){re.ensureCache.prepare();let a=0;e&&(a=re.getPointer(e));const o=r.map(f=>re.ensureString(f)),l=re.ensureInt32(o),c=re.ensureFloat64(new Array(2*i)),h=re._pe_mgrs_to_geog_extended(a,i,l,s,c);return h&&dv(n,i,c),h}};const m7e={geogToUsng(t,e,i,r,s,n,a){re.ensureCache.prepare();let o=0;t&&(o=re.getPointer(t));const l=kx(i),c=re.ensureFloat64(l),h=cU(e,hn.PE_MGRS_MAX),f=re.ensureInt32(h),y=re._pe_geog_to_usng(o,e,c,r,s,n,f);if(y)for(let _=0;_<e;_++)a[_]=re.UTF8ToString(h[_]);return y},usngToGeog(t,e,i,r){re.ensureCache.prepare();let s=0;t&&(s=re.getPointer(t));const n=i.map(c=>re.ensureString(c)),a=re.ensureInt32(n),o=re.ensureFloat64(new Array(2*e)),l=re._pe_usng_to_geog(s,e,a,o);return l&&dv(r,e,o),l}};let Fxe=class Zk{static init(){Zk.PE_UTM_OPTS_NONE=re.PeNotationUtm.prototype.PE_UTM_OPTS_NONE,Zk.PE_UTM_OPTS_ADD_SPACES=re.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES,Zk.PE_UTM_OPTS_NS=re.PeNotationUtm.prototype.PE_UTM_OPTS_NS}static geogToUtm(e,i,r,s,n){re.ensureCache.prepare();let a=0;e&&(a=re.getPointer(e));const o=kx(r),l=re.ensureFloat64(o),c=cU(i,hn.PE_UTM_MAX),h=re.ensureInt32(c),f=re._pe_geog_to_utm(a,i,l,s,h);if(f)for(let y=0;y<i;y++)n[y]=re.UTF8ToString(c[y]);return f}static utmToGeog(e,i,r,s,n){re.ensureCache.prepare();let a=0;e&&(a=re.getPointer(e));const o=r.map(f=>re.ensureString(f)),l=re.ensureInt32(o),c=re.ensureFloat64(new Array(2*i)),h=re._pe_utm_to_geog(a,i,l,s,c);return h&&dv(n,i,c),h}};var xc;let Nxe=(xc=class{static init(){xc.PE_PCSINFO_OPTION_NONE=re.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE,xc.PE_PCSINFO_OPTION_DOMAIN=re.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN,xc.PE_POLE_OUTSIDE_BOUNDARY=re.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY,xc.PE_POLE_POINT=re.PePCSInfo.prototype.PE_POLE_POINT}static generate(e,i=xc.PE_PCSINFO_OPTION_DOMAIN){let r=null,s=null;return xc.cache.has(e)&&(s=xc.cache.get(e),s[i]&&(r=s[i])),r||(r=re.PePCSInfo.prototype.generate(e,i),s||(s=[],xc.cache.set(e,s)),s[i]=r),r}},xc.cache=new Map,xc);const g7e={versionString:()=>re.PeVersion.prototype.version_string()};function Vxe(t){function e(n,a,o){n[a]=o(n[a])}re=t,hn.init(),BK.init(),zxe.init(),Fxe.init(),Nxe.init(),Lxe=class extends re.PeDouble{constructor(n=NaN){super(n)}destroy(){re.destroy(this)}[Symbol.dispose](){this.destroy()}},kxe=class extends re.PeGCSExtent{destroy(){re.destroy(this)}[Symbol.dispose](){this.destroy()}};const i=[re.PeAngunit,re.PeDatum,re.PeGeogcs,re.PeGeogtran,re.PeObject,re.PeParameter,re.PePrimem,re.PeProjcs,re.PeSpheroid,re.PeUnit];for(const n of i)e(n.prototype,"getName",a=>function(){return a.call(this,new Array(hn.PE_NAME_MAX))});for(const n of[re.PeGeogtran,re.PeProjcs])e(n.prototype,"getParameters",a=>function(){const o=new Array(hn.PE_PARM_MAX);let l=a.call(this);for(let c=0;c<o.length;c++){const h=re.getValue(l,"*");o[c]=h?re.wrapPointer(h,re.PeParameter):null,l+=Int32Array.BYTES_PER_ELEMENT}return o});e(re.PeHorizon.prototype,"getCoord",n=>function(a=!1){const o=this.getSize();if(!o)return null;const l=[];return dv(l,o,n.call(this),a),l}),e(re.PeGTlistExtendedEntry.prototype,"getEntries",n=>{const a=re._pe_getPeGTlistExtendedGTsSize();return function(){let o=null;const l=n.call(this);if(!re.compare(l,re.NULL)){o=[l];const c=this.getSteps();if(c>1){const h=re.getPointer(l);for(let f=1;f<c;f++)o.push(re.wrapPointer(h+a*f,re.PeGTlistExtendedGTs))}}return o}});const r=re._pe_getPeHorizonSize(),s=n=>function(){let a=this._cache;if(a||(a=new Map,this._cache=a),a.has(n))return a.get(n);let o=null;const l=n.call(this);if(!re.compare(l,re.NULL)){o=[l];const c=l.getNump();if(c>1){const h=re.getPointer(l);for(let f=1;f<c;f++)o.push(re.wrapPointer(h+r*f,re.PeHorizon))}}return a.set(n,o),o};e(re.PeProjcs.prototype,"horizonGcsGenerate",s),e(re.PeProjcs.prototype,"horizonPcsGenerate",s),re.PeObject.prototype.toString=function(n=hn.PE_STR_OPTS_NONE){re.ensureCache.prepare();const a=re.getPointer(this),o=re.ensureInt8(new Array(hn.PE_BUFFER_MAX));return re.UTF8ToString(re._pe_object_to_string_ext(a,n,o))},re.PeGeogcs.prototype.destroy=function(){this.Delete(),Nd(this),this.ptr=0},re.PeGeogcs.prototype[Symbol.dispose]=function(){this.destroy()},re.PeProjcs.prototype.destroy=function(){this.Delete(),Nd(this),this.ptr=0},re.PeProjcs.prototype[Symbol.dispose]=function(){this.destroy()}}function Nd(t){if(!t)return;const e=re.getClass(t);if(!e)return;const i=re.getCache(e);if(!i)return;const r=re.getPointer(t);r&&delete i[r]}function cU(t,e){const i=[],r=new Array(e);for(let s=0;s<t;s++)i.push(re.ensureInt8(r));return i}function kx(t){return ArrayBuffer.isView(t)?t:Array.isArray(t[0])?t.flat():t}function dv(t,e,i,r=!1){if(r)for(let s=0;s<2*e;s++)t[s]=re.getValue(i+s*Float64Array.BYTES_PER_ELEMENT,"double");else{const s=t.length===0;for(let n=0;n<e;n++)s&&(t[n]=new Array(2)),t[n][0]=re.getValue(i,"double"),t[n][1]=re.getValue(i+Float64Array.BYTES_PER_ELEMENT,"double"),i+=2*Float64Array.BYTES_PER_ELEMENT}}const y7e=Object.freeze(Object.defineProperty({__proto__:null,PeCSTransformations:Wk,PeDefs:hn,get PeDouble(){return Lxe},PeFactory:nT,get PeGCSExtent(){return kxe},PeGTTransformations:h7e,PeGTlistExtended:BK,PeGTlistExtendedEntry:u7e,PeLineType:d7e,PeMath:p7e,PeNotationDms:f7e,PeNotationMgrs:zxe,PeNotationUsng:m7e,PeNotationUtm:Fxe,PePCSInfo:Nxe,PeVersion:g7e,_init:Vxe,get _pe(){return re},isLoaded:Dxe,isSupported:c7e,load:Ixe},Symbol.toStringTag,{value:"Module"}));let v;const z={values:[1,.3048,.3048006096012192,.3047972654,.9143917962,.201166195164,.9143984146160287,.3047994715386762,20.11676512155263,20.11678249437587,.9143985307444408,.91439523,.3047997101815088,20.1168,20.116756,5e4,15e4],units:["Meter","Foot","Foot_US","Foot_Clarke","Yard_Clarke","Link_Clarke","Yard_Sears","Foot_Sears","Chain_Sears","Chain_Benoit_1895_B","Yard_Indian","Yard_Indian_1937","Foot_Gold_Coast","Chain","Chain_Sears_1922_Truncated","50_Kilometers","150_Kilometers"],2066:5,2136:12,2155:2,2157:0,2158:0,2159:12,2160:12,2204:2,2219:0,2220:0,2254:2,2255:2,2256:1,2265:1,2266:1,2267:2,2268:2,2269:1,2270:1,2271:2,2272:2,2273:1,2294:0,2295:0,2314:3,2899:2,2900:2,2901:1,2909:1,2910:1,2911:2,2912:2,2913:1,2914:1,2992:1,2993:0,2994:1,3080:1,3089:2,3090:0,3091:2,3102:2,3141:0,3142:0,3167:14,3359:2,3360:0,3361:1,3362:0,3363:2,3364:0,3365:2,3366:3,3404:2,3405:0,3406:0,3407:3,3439:0,3440:0,3479:1,3480:0,3481:1,3482:0,3483:1,3484:0,3485:2,3486:0,3487:2,3488:0,3489:0,3490:2,3491:0,3492:2,3493:0,3494:2,3495:0,3496:2,3497:0,3498:2,3499:0,3500:2,3501:0,3502:2,3503:0,3504:2,3505:0,3506:2,3507:0,3508:2,3509:0,3510:2,3511:0,3512:2,3513:0,3514:0,3515:2,3516:0,3517:2,3518:0,3519:2,3520:0,3521:2,3522:0,3523:2,3524:0,3525:2,3526:0,3527:2,3528:0,3529:2,3530:0,3531:2,3532:0,3533:2,3534:0,3535:2,3536:0,3537:2,3538:0,3539:2,3540:0,3541:2,3542:0,3543:2,3544:0,3545:2,3546:0,3547:2,3548:0,3549:2,3550:0,3551:2,3552:0,3553:2,3582:2,3583:0,3584:2,3585:0,3586:2,3587:0,3588:1,3589:0,3590:1,3591:0,3592:0,3593:1,3598:2,3599:0,3600:2,3605:1,3606:0,3607:0,3608:2,3609:0,3610:2,3611:0,3612:2,3613:0,3614:2,3615:0,3616:2,3617:0,3618:2,3619:0,3620:2,3621:0,3622:2,3623:0,3624:2,3625:0,3626:2,3627:0,3628:2,3629:0,3630:2,3631:0,3632:2,3633:0,3634:1,3635:0,3636:1,3640:2,3641:0,3642:2,3643:0,3644:1,3645:0,3646:1,3647:0,3648:1,3649:0,3650:2,3651:0,3652:2,3653:0,3654:2,3655:0,3656:1,3657:0,3658:2,3659:0,3660:2,3661:0,3662:2,3663:0,3664:2,3668:2,3669:0,3670:2,3671:0,3672:2,3673:0,3674:2,3675:0,3676:1,3677:2,3678:0,3679:1,3680:2,3681:0,3682:1,3683:2,3684:0,3685:0,3686:2,3687:0,3688:2,3689:0,3690:2,3691:0,3692:2,3696:2,3697:0,3698:2,3699:0,3700:2,3793:0,3794:0,3812:0,3854:0,3857:0,3920:0,3978:0,3979:0,3991:2,3992:2,4026:0,4037:0,4038:0,4071:0,4082:0,4083:0,4087:0,4088:0,4217:2,4414:0,4415:0,4417:0,4434:0,4437:0,4438:2,4439:2,4462:0,4467:0,4471:0,4474:0,4559:0,4647:0,4822:0,4826:0,4839:0,5018:0,5041:0,5042:0,5048:0,5221:0,5223:0,5234:0,5235:0,5243:0,5247:0,5266:0,5316:0,5320:0,5321:0,5325:0,5337:0,5361:0,5362:0,5367:0,5382:0,5383:0,5396:0,5456:0,5457:0,5469:0,5472:4,5490:0,5513:0,5514:0,5523:0,5559:0,5588:1,5589:3,5596:0,5627:0,5629:0,5641:0,5643:0,5644:0,5646:2,5654:2,5655:2,5659:0,5700:0,5825:0,5836:0,5837:0,5839:0,5842:0,5844:0,5858:0,5879:0,5880:0,5887:0,5890:0,6128:1,6129:1,6141:1,6204:0,6210:0,6211:0,6307:0,6312:0,6316:0,6362:0,6391:1,6405:1,6406:0,6407:1,6408:0,6409:1,6410:0,6411:2,6412:0,6413:2,6414:0,6415:0,6416:2,6417:0,6418:2,6419:0,6420:2,6421:0,6422:2,6423:0,6424:2,6425:0,6426:2,6427:0,6428:2,6429:0,6430:2,6431:0,6432:2,6433:0,6434:2,6435:0,6436:2,6437:0,6438:2,6439:0,6440:0,6441:2,6442:0,6443:2,6444:0,6445:2,6446:0,6447:2,6448:0,6449:2,6450:0,6451:2,6452:0,6453:2,6454:0,6455:2,6456:0,6457:2,6458:0,6459:2,6460:0,6461:2,6462:0,6463:2,6464:0,6465:2,6466:0,6467:2,6468:0,6469:2,6470:0,6471:2,6472:0,6473:2,6474:0,6475:2,6476:0,6477:2,6478:0,6479:2,6484:2,6485:0,6486:2,6487:0,6488:2,6489:0,6490:2,6491:0,6492:2,6493:0,6494:1,6495:0,6496:1,6497:0,6498:0,6499:1,6500:0,6501:2,6502:0,6503:2,6504:0,6505:2,6506:0,6507:2,6508:0,6509:0,6510:2,6515:1,6516:0,6518:0,6519:2,6520:0,6521:2,6522:0,6523:2,6524:0,6525:2,6526:0,6527:2,6528:0,6529:2,6530:0,6531:2,6532:0,6533:2,6534:0,6535:2,6536:0,6537:2,6538:0,6539:2,6540:0,6541:2,6542:0,6543:2,6544:0,6545:1,6546:0,6547:1,6548:0,6549:2,6550:0,6551:2,6552:0,6553:2,6554:0,6555:2,6556:0,6557:1,6558:0,6559:1,6560:0,6561:1,6562:0,6563:2,6564:0,6565:2,6566:0,6567:0,6568:2,6569:0,6570:1,6571:0,6572:2,6573:0,6574:2,6575:0,6576:2,6577:0,6578:2,6582:2,6583:0,6584:2,6585:0,6586:2,6587:0,6588:2,6589:0,6590:2,6591:0,6592:0,6593:2,6594:0,6595:2,6596:0,6597:2,6598:0,6599:2,6600:0,6601:2,6602:0,6603:2,6605:2,6606:0,6607:2,6608:0,6609:2,6610:0,6611:0,6612:2,6613:0,6614:2,6615:0,6616:2,6617:0,6618:2,6633:2,6646:0,6703:0,6784:0,6785:1,6786:0,6787:1,6788:0,6789:1,6790:0,6791:1,6792:0,6793:1,6794:0,6795:1,6796:0,6797:1,6798:0,6799:1,6800:0,6801:1,6802:0,6803:1,6804:0,6805:1,6806:0,6807:1,6808:0,6809:1,6810:0,6811:1,6812:0,6813:1,6814:0,6815:1,6816:0,6817:1,6818:0,6819:1,6820:0,6821:1,6822:0,6823:1,6824:0,6825:1,6826:0,6827:1,6828:0,6829:1,6830:0,6831:1,6832:0,6833:1,6834:0,6835:1,6836:0,6837:1,6838:0,6839:1,6840:0,6841:1,6842:0,6843:1,6844:0,6845:1,6846:0,6847:1,6848:0,6849:1,6850:0,6851:1,6852:0,6853:1,6854:0,6855:1,6856:0,6857:1,6858:0,6859:1,6860:0,6861:1,6862:0,6863:1,6867:0,6868:1,6870:0,6875:0,6876:0,6879:0,6880:2,6884:0,6885:1,6886:0,6887:1,6915:0,6922:0,6923:2,6924:0,6925:2,6962:0,6984:0,6991:0,7128:2,7131:0,7132:2,7142:0,7257:0,7258:2,7259:0,7260:2,7261:0,7262:2,7263:0,7264:2,7265:0,7266:2,7267:0,7268:2,7269:0,7270:2,7271:0,7272:2,7273:0,7274:2,7275:0,7276:2,7277:0,7278:2,7279:0,7280:2,7281:0,7282:2,7283:0,7284:2,7285:0,7286:2,7287:0,7288:2,7289:0,7290:2,7291:0,7292:2,7293:0,7294:2,7295:0,7296:2,7297:0,7298:2,7299:0,7300:2,7301:0,7302:2,7303:0,7304:2,7305:0,7306:2,7307:0,7308:2,7309:0,7310:2,7311:0,7312:2,7313:0,7314:2,7315:0,7316:2,7317:0,7318:2,7319:0,7320:2,7321:0,7322:2,7323:0,7324:2,7325:0,7326:2,7327:0,7328:2,7329:0,7330:2,7331:0,7332:2,7333:0,7334:2,7335:0,7336:2,7337:0,7338:2,7339:0,7340:2,7341:0,7342:2,7343:0,7344:2,7345:0,7346:2,7347:0,7348:2,7349:0,7350:2,7351:0,7352:2,7353:0,7354:2,7355:0,7356:2,7357:0,7358:2,7359:0,7360:2,7361:0,7362:2,7363:0,7364:2,7365:0,7366:2,7367:0,7368:2,7369:0,7370:2,7877:0,7878:0,7882:0,7883:0,7887:0,7899:0,7991:0,7992:0,8035:2,8036:2,8058:0,8059:0,8082:0,8083:0,8088:0,8090:0,8091:2,8092:0,8093:2,8095:0,8096:2,8097:0,8098:2,8099:0,8100:2,8101:0,8102:2,8103:0,8104:2,8105:0,8106:2,8107:0,8108:2,8109:0,8110:2,8111:0,8112:2,8113:0,8114:2,8115:0,8116:2,8117:0,8118:2,8119:0,8120:2,8121:0,8122:2,8123:0,8124:2,8125:0,8126:2,8127:0,8128:2,8129:0,8130:2,8131:0,8132:2,8133:0,8134:2,8135:0,8136:2,8137:0,8138:2,8139:0,8140:2,8141:0,8142:2,8143:0,8144:2,8145:0,8146:2,8147:0,8148:2,8149:0,8150:2,8151:0,8152:2,8153:0,8154:2,8155:0,8156:2,8157:0,8158:2,8159:0,8160:2,8161:0,8162:2,8163:0,8164:2,8165:0,8166:2,8167:0,8168:2,8169:0,8170:2,8171:0,8172:2,8173:0,8177:2,8179:0,8180:2,8181:0,8182:2,8184:0,8185:2,8187:0,8189:2,8191:0,8193:2,8196:0,8197:2,8198:0,8200:2,8201:0,8202:2,8203:0,8204:2,8205:0,8206:2,8207:0,8208:2,8209:0,8210:2,8212:0,8213:2,8214:0,8216:2,8218:0,8220:2,8222:0,8224:2,8225:0,8226:2,8311:0,8312:1,8313:0,8314:1,8315:0,8316:1,8317:0,8318:1,8319:0,8320:1,8321:0,8322:1,8323:0,8324:1,8325:0,8326:1,8327:0,8328:1,8329:0,8330:1,8331:0,8332:1,8333:0,8334:1,8335:0,8336:1,8337:0,8338:1,8339:0,8340:1,8341:0,8342:1,8343:0,8344:1,8345:0,8346:1,8347:0,8348:1,8352:0,8353:0,8379:0,8380:2,8381:0,8382:2,8383:0,8384:2,8385:0,8387:2,8391:0,8395:0,8433:0,8441:0,8455:0,8456:0,8531:2,8682:0,8686:0,8687:0,8692:0,8693:0,8826:0,8903:0,8950:0,8951:0,9039:0,9040:0,9141:0,9149:0,9150:0,9191:0,9221:0,9222:0,9249:0,9250:0,9252:0,9254:0,9265:0,9284:0,9285:0,9300:0,9354:0,9367:0,9373:0,9377:0,9387:0,9391:0,9456:0,9473:0,9498:0,9674:0,9678:0,9680:0,9709:0,9712:0,9713:0,9716:0,9741:0,9748:2,9749:2,9761:0,9766:0,9793:0,9794:0,9869:0,9874:0,9875:0,9880:0,9895:0,9943:0,9945:0,9947:0,9967:0,9972:0,9977:0,10160:0,10183:0,10188:0,10194:0,10199:0,10207:0,10212:0,10217:0,10222:0,10227:0,10235:0,10240:0,10250:0,10254:0,10270:0,10275:0,10280:0,10306:0,10329:0,10471:0,10477:0,10481:2,10516:2,10592:0,10594:0,10596:0,10598:0,10601:0,10603:0,10626:0,10632:0,10641:0,10665:0,10674:0,10744:0,10745:0,10759:0,10773:0,10802:0,10820:0,20002:0,20042:0,20050:1,20499:0,20538:0,20539:0,20790:0,20791:0,21291:0,21292:0,21500:0,21817:0,21818:0,22032:0,22033:0,22091:0,22092:0,22239:0,22240:0,22332:0,22337:0,22338:0,22391:0,22392:0,22639:0,22700:0,22739:0,22770:0,22780:0,22832:0,23090:0,23095:0,23239:0,23240:0,23433:0,23700:0,24047:0,24048:0,24100:3,24200:0,24305:0,24306:0,24382:10,24383:0,24500:0,24547:0,24548:0,24571:9,24600:0,25e3:0,25231:0,25884:0,25932:0,26237:0,26331:0,26332:0,26432:0,26591:0,26592:0,26632:0,26692:0,27120:0,27200:0,27291:6,27292:6,27429:0,27492:0,27493:0,27500:0,28232:0,28600:0,28991:0,28992:0,29100:0,29101:0,29220:0,29221:0,29333:0,29635:0,29636:0,29701:0,29738:0,29739:0,29849:0,29850:0,29871:8,29872:7,29873:0,29874:0,30200:5,30339:0,30340:0,30591:0,30592:0,30791:0,30792:0,30800:0,31028:0,31121:0,31154:0,31170:0,31171:0,31370:0,31528:0,31529:0,31600:0,31700:0,31838:0,31839:0,31900:0,31901:0,32061:0,32062:0,32098:0,32099:2,32100:0,32104:0,32161:0,32766:0,53048:0,53049:0,65061:2,65062:2,102041:2,102064:11,102068:15,102069:16,102118:2,102119:1,102120:2,102121:2,102217:2,102218:0,102219:2,102220:2,102378:1,102379:1,102380:0,102381:1,102589:2,102599:2,102600:2,102604:2,102647:0,102704:2,102705:2,102706:0,102731:0,102732:0,102759:1,102760:1,102761:2,102762:0,102763:2,102764:0,102765:0,102766:2,102970:1,102974:2,102993:0,102994:0,102995:2,102996:2,103015:0,103016:2,103017:0,103018:2,103025:0,103026:0,103027:2,103028:2,103035:0,103036:0,103037:2,103038:2,103039:0,103040:0,103041:2,103042:2,103043:0,103044:0,103045:2,103046:2,103047:0,103048:0,103049:2,103050:2,103051:0,103052:2,103053:0,103054:2,103055:0,103056:2,103057:0,103058:0,103059:2,103060:2,103061:0,103062:0,103063:2,103064:2,103069:2,103070:0,103071:0,103072:2,103073:2,103086:0,103087:0,103088:2,103089:2,103094:1,103095:0,103096:2,103103:0,103104:2,103105:0,103106:2,103121:0,103122:2,103123:0,103124:0,103125:1,103126:1,103127:0,103128:0,103129:2,103130:2,103131:0,103132:0,103133:2,103134:2,103135:0,103136:0,103137:1,103138:1,103139:0,103140:2,103141:0,103142:2,103143:0,103144:2,103145:0,103146:1,103147:0,103148:0,103149:2,103150:2,103151:0,103152:2,103172:0,103173:2,103174:0,103175:0,103176:2,103177:2,103178:0,103179:0,103180:2,103181:2,103182:0,103183:0,103184:2,103185:2,103228:0,103229:0,103230:2,103231:2,103250:0,103251:2,103252:0,103253:2,103260:0,103261:0,103262:2,103263:2,103270:0,103271:0,103272:2,103273:2,103274:0,103275:0,103276:2,103277:2,103278:0,103279:0,103280:2,103281:2,103282:0,103283:0,103284:2,103285:2,103286:0,103287:2,103288:0,103289:2,103290:0,103291:2,103292:0,103293:0,103294:2,103295:2,103296:0,103297:0,103298:2,103299:2,103376:2,103377:0,103378:0,103379:2,103380:2,103393:0,103394:0,103395:2,103396:2,103472:0,103473:1,103474:0,103475:2,103482:0,103483:2,103484:0,103485:2,103500:0,103501:2,103502:0,103503:0,103504:1,103505:1,103506:0,103507:0,103508:2,103509:2,103510:0,103511:0,103512:2,103513:2,103514:0,103515:2,103516:0,103517:2,103518:0,103519:2,103520:0,103521:1,103522:0,103523:0,103524:2,103525:2,103526:0,103527:2,103561:2,103562:2,103563:0,103564:0,103565:2,103566:2,103567:0,103568:0,103569:2,103570:2,103584:0,103585:2,103586:0,103587:2,103588:1,103589:0,103590:2,103591:1,103592:0,103593:2,103594:1,103695:2,103897:1,103978:2,103979:0,103980:2,103981:0};for(v=2e3;v<=2045;v++)z[v]=0;for(v=2056;v<=2065;v++)z[v]=0;for(v=2067;v<=2135;v++)z[v]=0;for(v=2137;v<=2154;v++)z[v]=0;for(v=2161;v<=2170;v++)z[v]=0;for(v=2172;v<=2193;v++)z[v]=0;for(v=2195;v<=2198;v++)z[v]=0;for(v=2200;v<=2203;v++)z[v]=0;for(v=2205;v<=2217;v++)z[v]=0;for(v=2222;v<=2224;v++)z[v]=1;for(v=2225;v<=2250;v++)z[v]=2;for(v=2251;v<=2253;v++)z[v]=1;for(v=2257;v<=2264;v++)z[v]=2;for(v=2274;v<=2279;v++)z[v]=2;for(v=2280;v<=2282;v++)z[v]=1;for(v=2283;v<=2289;v++)z[v]=2;for(v=2290;v<=2292;v++)z[v]=0;for(v=2308;v<=2313;v++)z[v]=0;for(v=2315;v<=2491;v++)z[v]=0;for(v=2494;v<=2866;v++)z[v]=0;for(v=2867;v<=2869;v++)z[v]=1;for(v=2870;v<=2888;v++)z[v]=2;for(v=2891;v<=2895;v++)z[v]=2;for(v=2896;v<=2898;v++)z[v]=1;for(v=2902;v<=2908;v++)z[v]=2;for(v=2915;v<=2920;v++)z[v]=2;for(v=2921;v<=2923;v++)z[v]=1;for(v=2924;v<=2930;v++)z[v]=2;for(v=2931;v<=2962;v++)z[v]=0;for(v=2964;v<=2968;v++)z[v]=2;for(v=2969;v<=2973;v++)z[v]=0;for(v=2975;v<=2991;v++)z[v]=0;for(v=2995;v<=3051;v++)z[v]=0;for(v=3054;v<=3079;v++)z[v]=0;for(v=3081;v<=3088;v++)z[v]=0;for(v=3092;v<=3101;v++)z[v]=0;for(v=3106;v<=3138;v++)z[v]=0;for(v=3146;v<=3151;v++)z[v]=0;for(v=3153;v<=3166;v++)z[v]=0;for(v=3168;v<=3172;v++)z[v]=0;for(v=3174;v<=3203;v++)z[v]=0;for(v=3294;v<=3358;v++)z[v]=0;for(v=3367;v<=3403;v++)z[v]=0;for(v=3408;v<=3416;v++)z[v]=0;for(v=3417;v<=3438;v++)z[v]=2;for(v=3441;v<=3446;v++)z[v]=2;for(v=3447;v<=3450;v++)z[v]=0;for(v=3451;v<=3459;v++)z[v]=2;for(v=3460;v<=3478;v++)z[v]=0;for(v=3554;v<=3559;v++)z[v]=0;for(v=3560;v<=3570;v++)z[v]=2;for(v=3571;v<=3581;v++)z[v]=0;for(v=3594;v<=3597;v++)z[v]=0;for(v=3601;v<=3604;v++)z[v]=0;for(v=3637;v<=3639;v++)z[v]=0;for(v=3665;v<=3667;v++)z[v]=0;for(v=3693;v<=3695;v++)z[v]=0;for(v=3701;v<=3727;v++)z[v]=0;for(v=3728;v<=3739;v++)z[v]=2;for(v=3740;v<=3751;v++)z[v]=0;for(v=3753;v<=3760;v++)z[v]=2;for(v=3761;v<=3773;v++)z[v]=0;for(v=3775;v<=3777;v++)z[v]=0;for(v=3779;v<=3781;v++)z[v]=0;for(v=3783;v<=3785;v++)z[v]=0;for(v=3788;v<=3791;v++)z[v]=0;for(v=3797;v<=3802;v++)z[v]=0;for(v=3814;v<=3816;v++)z[v]=0;for(v=3825;v<=3829;v++)z[v]=0;for(v=3832;v<=3841;v++)z[v]=0;for(v=3844;v<=3852;v++)z[v]=0;for(v=3873;v<=3885;v++)z[v]=0;for(v=3890;v<=3893;v++)z[v]=0;for(v=3907;v<=3912;v++)z[v]=0;for(v=3942;v<=3950;v++)z[v]=0;for(v=3968;v<=3970;v++)z[v]=0;for(v=3973;v<=3976;v++)z[v]=0;for(v=3986;v<=3989;v++)z[v]=0;for(v=3994;v<=3997;v++)z[v]=0;for(v=4048;v<=4051;v++)z[v]=0;for(v=4056;v<=4063;v++)z[v]=0;for(v=4093;v<=4096;v++)z[v]=0;for(v=4390;v<=4398;v++)z[v]=0;for(v=4399;v<=4413;v++)z[v]=2;for(v=4418;v<=4433;v++)z[v]=2;for(v=4455;v<=4457;v++)z[v]=2;for(v=4484;v<=4489;v++)z[v]=0;for(v=4491;v<=4554;v++)z[v]=0;for(v=4568;v<=4589;v++)z[v]=0;for(v=4652;v<=4656;v++)z[v]=0;for(v=4766;v<=4800;v++)z[v]=0;for(v=5014;v<=5016;v++)z[v]=0;for(v=5069;v<=5072;v++)z[v]=0;for(v=5105;v<=5130;v++)z[v]=0;for(v=5167;v<=5188;v++)z[v]=0;for(v=5253;v<=5259;v++)z[v]=0;for(v=5269;v<=5275;v++)z[v]=0;for(v=5292;v<=5311;v++)z[v]=0;for(v=5329;v<=5331;v++)z[v]=0;for(v=5343;v<=5349;v++)z[v]=0;for(v=5355;v<=5357;v++)z[v]=0;for(v=5387;v<=5389;v++)z[v]=0;for(v=5459;v<=5463;v++)z[v]=0;for(v=5479;v<=5482;v++)z[v]=0;for(v=5518;v<=5520;v++)z[v]=0;for(v=5530;v<=5539;v++)z[v]=0;for(v=5550;v<=5552;v++)z[v]=0;for(v=5562;v<=5583;v++)z[v]=0;for(v=5623;v<=5625;v++)z[v]=2;for(v=5631;v<=5639;v++)z[v]=0;for(v=5649;v<=5653;v++)z[v]=0;for(v=5663;v<=5680;v++)z[v]=0;for(v=5682;v<=5685;v++)z[v]=0;for(v=5875;v<=5877;v++)z[v]=0;for(v=5896;v<=5899;v++)z[v]=0;for(v=5921;v<=5940;v++)z[v]=0;for(v=6050;v<=6125;v++)z[v]=0;for(v=6244;v<=6275;v++)z[v]=0;for(v=6328;v<=6348;v++)z[v]=0;for(v=6350;v<=6356;v++)z[v]=0;for(v=6366;v<=6372;v++)z[v]=0;for(v=6381;v<=6387;v++)z[v]=0;for(v=6393;v<=6404;v++)z[v]=0;for(v=6480;v<=6483;v++)z[v]=0;for(v=6511;v<=6514;v++)z[v]=0;for(v=6579;v<=6581;v++)z[v]=0;for(v=6619;v<=6624;v++)z[v]=0;for(v=6625;v<=6627;v++)z[v]=2;for(v=6628;v<=6632;v++)z[v]=0;for(v=6634;v<=6637;v++)z[v]=0;for(v=6669;v<=6692;v++)z[v]=0;for(v=6707;v<=6709;v++)z[v]=0;for(v=6720;v<=6723;v++)z[v]=0;for(v=6732;v<=6738;v++)z[v]=0;for(v=6931;v<=6933;v++)z[v]=0;for(v=6956;v<=6959;v++)z[v]=0;for(v=7005;v<=7007;v++)z[v]=0;for(v=7057;v<=7070;v++)z[v]=2;for(v=7074;v<=7082;v++)z[v]=0;for(v=7109;v<=7118;v++)z[v]=0;for(v=7119;v<=7127;v++)z[v]=1;for(v=7374;v<=7376;v++)z[v]=0;for(v=7528;v<=7586;v++)z[v]=0;for(v=7587;v<=7645;v++)z[v]=2;for(v=7692;v<=7696;v++)z[v]=0;for(v=7755;v<=7787;v++)z[v]=0;for(v=7791;v<=7795;v++)z[v]=0;for(v=7799;v<=7801;v++)z[v]=0;for(v=7803;v<=7805;v++)z[v]=0;for(v=7825;v<=7831;v++)z[v]=0;for(v=7845;v<=7859;v++)z[v]=0;for(v=8013;v<=8032;v++)z[v]=0;for(v=8065;v<=8068;v++)z[v]=1;for(v=8518;v<=8529;v++)z[v]=2;for(v=8533;v<=8536;v++)z[v]=2;for(v=8538;v<=8540;v++)z[v]=2;for(v=8677;v<=8679;v++)z[v]=0;for(v=8836;v<=8840;v++)z[v]=0;for(v=8857;v<=8859;v++)z[v]=0;for(v=8908;v<=8910;v++)z[v]=0;for(v=9154;v<=9159;v++)z[v]=0;for(v=9205;v<=9218;v++)z[v]=0;for(v=9271;v<=9273;v++)z[v]=0;for(v=9295;v<=9297;v++)z[v]=0;for(v=9356;v<=9360;v++)z[v]=0;for(v=9404;v<=9407;v++)z[v]=0;for(v=9476;v<=9482;v++)z[v]=0;for(v=9487;v<=9494;v++)z[v]=0;for(v=9697;v<=9699;v++)z[v]=0;for(v=9821;v<=9865;v++)z[v]=0;for(v=10285;v<=10291;v++)z[v]=0;for(v=10314;v<=10317;v++)z[v]=0;for(v=10448;v<=10465;v++)z[v]=0;for(v=10726;v<=10729;v++)z[v]=0;for(v=10731;v<=10733;v++)z[v]=0;for(v=11114;v<=11118;v++)z[v]=0;for(v=20004;v<=20032;v++)z[v]=0;for(v=20047;v<=20049;v++)z[v]=0;for(v=20062;v<=20092;v++)z[v]=0;for(v=20135;v<=20138;v++)z[v]=0;for(v=20248;v<=20258;v++)z[v]=0;for(v=20348;v<=20358;v++)z[v]=0;for(v=20436;v<=20440;v++)z[v]=0;for(v=20822;v<=20824;v++)z[v]=0;for(v=20904;v<=20932;v++)z[v]=0;for(v=20934;v<=20936;v++)z[v]=0;for(v=21004;v<=21032;v++)z[v]=0;for(v=21035;v<=21037;v++)z[v]=0;for(v=21095;v<=21097;v++)z[v]=0;for(v=21148;v<=21150;v++)z[v]=0;for(v=21207;v<=21264;v++)z[v]=0;for(v=21307;v<=21364;v++)z[v]=0;for(v=21413;v<=21423;v++)z[v]=0;for(v=21453;v<=21463;v++)z[v]=0;for(v=21473;v<=21483;v++)z[v]=0;for(v=21780;v<=21782;v++)z[v]=0;for(v=21891;v<=21894;v++)z[v]=0;for(v=21896;v<=21899;v++)z[v]=0;for(v=22171;v<=22177;v++)z[v]=0;for(v=22181;v<=22187;v++)z[v]=0;for(v=22191;v<=22197;v++)z[v]=0;for(v=22207;v<=22222;v++)z[v]=0;for(v=22229;v<=22232;v++)z[v]=0;for(v=22234;v<=22236;v++)z[v]=0;for(v=22243;v<=22250;v++)z[v]=0;for(v=22262;v<=22265;v++)z[v]=0;for(v=22307;v<=22322;v++)z[v]=0;for(v=22348;v<=22357;v++)z[v]=0;for(v=22407;v<=22422;v++)z[v]=0;for(v=22462;v<=22465;v++)z[v]=0;for(v=22521;v<=22525;v++)z[v]=0;for(v=22607;v<=22622;v++)z[v]=0;for(v=22641;v<=22646;v++)z[v]=0;for(v=22648;v<=22657;v++)z[v]=0;for(v=22707;v<=22722;v++)z[v]=0;for(v=22762;v<=22765;v++)z[v]=0;for(v=22807;v<=22822;v++)z[v]=0;for(v=22991;v<=22994;v++)z[v]=0;for(v=23028;v<=23038;v++)z[v]=0;for(v=23301;v<=23333;v++)z[v]=2;for(v=23830;v<=23853;v++)z[v]=0;for(v=23866;v<=23872;v++)z[v]=0;for(v=23877;v<=23884;v++)z[v]=0;for(v=23886;v<=23894;v++)z[v]=0;for(v=23946;v<=23948;v++)z[v]=0;for(v=24311;v<=24313;v++)z[v]=0;for(v=24342;v<=24347;v++)z[v]=0;for(v=24370;v<=24374;v++)z[v]=10;for(v=24375;v<=24381;v++)z[v]=0;for(v=24718;v<=24721;v++)z[v]=0;for(v=24817;v<=24821;v++)z[v]=0;for(v=24877;v<=24882;v++)z[v]=0;for(v=24891;v<=24893;v++)z[v]=0;for(v=25391;v<=25395;v++)z[v]=0;for(v=25828;v<=25838;v++)z[v]=0;for(v=26191;v<=26195;v++)z[v]=0;for(v=26391;v<=26393;v++)z[v]=0;for(v=26701;v<=26722;v++)z[v]=0;for(v=26729;v<=26799;v++)z[v]=2;for(v=26801;v<=26803;v++)z[v]=2;for(v=26811;v<=26813;v++)z[v]=2;for(v=26847;v<=26870;v++)z[v]=2;for(v=26891;v<=26899;v++)z[v]=0;for(v=26901;v<=26923;v++)z[v]=0;for(v=26929;v<=26946;v++)z[v]=0;for(v=26948;v<=26998;v++)z[v]=0;for(v=27037;v<=27040;v++)z[v]=0;for(v=27205;v<=27232;v++)z[v]=0;for(v=27258;v<=27260;v++)z[v]=0;for(v=27391;v<=27398;v++)z[v]=0;for(v=27561;v<=27564;v++)z[v]=0;for(v=27571;v<=27574;v++)z[v]=0;for(v=27581;v<=27584;v++)z[v]=0;for(v=27591;v<=27594;v++)z[v]=0;for(v=27700;v<=27707;v++)z[v]=0;for(v=28191;v<=28193;v++)z[v]=0;for(v=28348;v<=28358;v++)z[v]=0;for(v=28402;v<=28432;v++)z[v]=0;for(v=28462;v<=28492;v++)z[v]=0;for(v=29118;v<=29122;v++)z[v]=0;for(v=29168;v<=29172;v++)z[v]=0;for(v=29177;v<=29185;v++)z[v]=0;for(v=29187;v<=29195;v++)z[v]=0;for(v=29900;v<=29903;v++)z[v]=0;for(v=30161;v<=30179;v++)z[v]=0;for(v=30491;v<=30494;v++)z[v]=0;for(v=30729;v<=30732;v++)z[v]=0;for(v=31251;v<=31259;v++)z[v]=0;for(v=31265;v<=31268;v++)z[v]=0;for(v=31275;v<=31279;v++)z[v]=0;for(v=31281;v<=31297;v++)z[v]=0;for(v=31461;v<=31469;v++)z[v]=0;for(v=31491;v<=31495;v++)z[v]=0;for(v=31917;v<=31922;v++)z[v]=0;for(v=31965;v<=32e3;v++)z[v]=0;for(v=32001;v<=32003;v++)z[v]=2;for(v=32005;v<=32031;v++)z[v]=2;for(v=32033;v<=32060;v++)z[v]=2;for(v=32064;v<=32067;v++)z[v]=2;for(v=32074;v<=32077;v++)z[v]=2;for(v=32081;v<=32086;v++)z[v]=0;for(v=32107;v<=32130;v++)z[v]=0;for(v=32133;v<=32159;v++)z[v]=0;for(v=32164;v<=32167;v++)z[v]=2;for(v=32180;v<=32199;v++)z[v]=0;for(v=32201;v<=32260;v++)z[v]=0;for(v=32301;v<=32360;v++)z[v]=0;for(v=32401;v<=32460;v++)z[v]=0;for(v=32501;v<=32560;v++)z[v]=0;for(v=32601;v<=32662;v++)z[v]=0;for(v=32664;v<=32667;v++)z[v]=2;for(v=32701;v<=32761;v++)z[v]=0;for(v=53001;v<=53004;v++)z[v]=0;for(v=53008;v<=53019;v++)z[v]=0;for(v=53021;v<=53032;v++)z[v]=0;for(v=53034;v<=53037;v++)z[v]=0;for(v=53042;v<=53046;v++)z[v]=0;for(v=53074;v<=53080;v++)z[v]=0;for(v=54001;v<=54004;v++)z[v]=0;for(v=54008;v<=54019;v++)z[v]=0;for(v=54021;v<=54032;v++)z[v]=0;for(v=54034;v<=54037;v++)z[v]=0;for(v=54042;v<=54046;v++)z[v]=0;for(v=54048;v<=54053;v++)z[v]=0;for(v=54074;v<=54080;v++)z[v]=0;for(v=54090;v<=54096;v++)z[v]=0;for(v=54098;v<=54101;v++)z[v]=0;for(v=65161;v<=65163;v++)z[v]=0;for(v=102001;v<=102040;v++)z[v]=0;for(v=102042;v<=102063;v++)z[v]=0;for(v=102065;v<=102067;v++)z[v]=0;for(v=102070;v<=102117;v++)z[v]=0;for(v=102122;v<=102216;v++)z[v]=0;for(v=102221;v<=102377;v++)z[v]=0;for(v=102382;v<=102388;v++)z[v]=0;for(v=102389;v<=102398;v++)z[v]=2;for(v=102399;v<=102444;v++)z[v]=0;for(v=102445;v<=102447;v++)z[v]=2;for(v=102448;v<=102458;v++)z[v]=0;for(v=102459;v<=102468;v++)z[v]=2;for(v=102469;v<=102499;v++)z[v]=0;for(v=102500;v<=102519;v++)z[v]=1;for(v=102520;v<=102524;v++)z[v]=0;for(v=102525;v<=102529;v++)z[v]=2;for(v=102530;v<=102588;v++)z[v]=0;for(v=102590;v<=102598;v++)z[v]=0;for(v=102601;v<=102603;v++)z[v]=0;for(v=102605;v<=102628;v++)z[v]=0;for(v=102629;v<=102646;v++)z[v]=2;for(v=102648;v<=102700;v++)z[v]=2;for(v=102701;v<=102703;v++)z[v]=0;for(v=102707;v<=102730;v++)z[v]=2;for(v=102733;v<=102758;v++)z[v]=2;for(v=102767;v<=102900;v++)z[v]=0;for(v=102901;v<=102933;v++)z[v]=2;for(v=102934;v<=102950;v++)z[v]=13;for(v=102951;v<=102963;v++)z[v]=0;for(v=102965;v<=102969;v++)z[v]=0;for(v=102971;v<=102973;v++)z[v]=0;for(v=102975;v<=102989;v++)z[v]=0;for(v=102990;v<=102992;v++)z[v]=1;for(v=102997;v<=103002;v++)z[v]=0;for(v=103003;v<=103008;v++)z[v]=2;for(v=103009;v<=103011;v++)z[v]=0;for(v=103012;v<=103014;v++)z[v]=2;for(v=103019;v<=103021;v++)z[v]=0;for(v=103022;v<=103024;v++)z[v]=2;for(v=103029;v<=103031;v++)z[v]=0;for(v=103032;v<=103034;v++)z[v]=2;for(v=103065;v<=103068;v++)z[v]=0;for(v=103074;v<=103076;v++)z[v]=0;for(v=103077;v<=103079;v++)z[v]=1;for(v=103080;v<=103082;v++)z[v]=0;for(v=103083;v<=103085;v++)z[v]=2;for(v=103090;v<=103093;v++)z[v]=0;for(v=103097;v<=103099;v++)z[v]=0;for(v=103100;v<=103102;v++)z[v]=2;for(v=103107;v<=103109;v++)z[v]=0;for(v=103110;v<=103112;v++)z[v]=2;for(v=103113;v<=103116;v++)z[v]=0;for(v=103117;v<=103120;v++)z[v]=2;for(v=103153;v<=103157;v++)z[v]=0;for(v=103158;v<=103162;v++)z[v]=2;for(v=103163;v<=103165;v++)z[v]=0;for(v=103166;v<=103168;v++)z[v]=1;for(v=103169;v<=103171;v++)z[v]=2;for(v=103186;v<=103188;v++)z[v]=0;for(v=103189;v<=103191;v++)z[v]=2;for(v=103192;v<=103195;v++)z[v]=0;for(v=103196;v<=103199;v++)z[v]=2;for(v=103200;v<=103224;v++)z[v]=0;for(v=103225;v<=103227;v++)z[v]=1;for(v=103232;v<=103237;v++)z[v]=0;for(v=103238;v<=103243;v++)z[v]=2;for(v=103244;v<=103246;v++)z[v]=0;for(v=103247;v<=103249;v++)z[v]=2;for(v=103254;v<=103256;v++)z[v]=0;for(v=103257;v<=103259;v++)z[v]=2;for(v=103264;v<=103266;v++)z[v]=0;for(v=103267;v<=103269;v++)z[v]=2;for(v=103300;v<=103375;v++)z[v]=0;for(v=103381;v<=103383;v++)z[v]=0;for(v=103384;v<=103386;v++)z[v]=1;for(v=103387;v<=103389;v++)z[v]=0;for(v=103390;v<=103392;v++)z[v]=2;for(v=103397;v<=103399;v++)z[v]=0;for(v=103400;v<=103471;v++)z[v]=2;for(v=103476;v<=103478;v++)z[v]=0;for(v=103479;v<=103481;v++)z[v]=2;for(v=103486;v<=103488;v++)z[v]=0;for(v=103489;v<=103491;v++)z[v]=2;for(v=103492;v<=103495;v++)z[v]=0;for(v=103496;v<=103499;v++)z[v]=2;for(v=103528;v<=103543;v++)z[v]=0;for(v=103544;v<=103548;v++)z[v]=2;for(v=103549;v<=103551;v++)z[v]=0;for(v=103552;v<=103554;v++)z[v]=1;for(v=103555;v<=103557;v++)z[v]=2;for(v=103558;v<=103560;v++)z[v]=0;for(v=103571;v<=103573;v++)z[v]=0;for(v=103574;v<=103576;v++)z[v]=2;for(v=103577;v<=103580;v++)z[v]=0;for(v=103581;v<=103583;v++)z[v]=2;for(v=103595;v<=103694;v++)z[v]=0;for(v=103696;v<=103699;v++)z[v]=0;for(v=103700;v<=103793;v++)z[v]=2;for(v=103794;v<=103890;v++)z[v]=0;for(v=103891;v<=103896;v++)z[v]=2;for(v=103900;v<=103971;v++)z[v]=2;for(v=103972;v<=103977;v++)z[v]=0;for(v=112e3;v<=112101;v++)z[v]=0;const Uxe=[102100,102113,3857,3785,900913],_7e=[104905,104971],v7e=[104903],b7e=[4326,...Uxe,..._7e,...v7e],PR=[-20037508342788905e-9,20037508342788905e-9],$W=[-20037508342787e-6,20037508342787e-6],U9={wkTemplate:'PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',valid:PR,origin:$W,dx:1e-5},Bxe={102113:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:PR,origin:$W,dx:1e-5},102100:U9,3785:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:PR,origin:$W,dx:1e-5},3857:U9,4326:{wkTemplate:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",{Central_Meridian}],UNIT["Degree",0.0174532925199433]]',altTemplate:'PROJCS["WGS_1984_Plate_Carree",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Plate_Carree"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],UNIT["Degrees",111319.491]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104971:{wkTemplate:'GEOGCS["Mars_2000_(Sphere)",DATUM["Mars_2000_(Sphere)",SPHEROID["Mars_2000_(Sphere)",3396190.0,0.0]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104905:{wkTemplate:'GEOGCS["GCS_Mars_2000",DATUM["D_Mars_2000",SPHEROID["Mars_2000_IAU_IAG",3396190.0,169.8944472236118]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5},900913:U9,104903:{wkTemplate:'GEOGCS["GCS_Moon_2000",DATUM["D_Moon_2000",SPHEROID["Moon_2000_IAU_IAG",1737400,0,AUTHORITY["ESRI","107903"]],AUTHORITY["ESRI","106903"]],PRIMEM["Reference_Meridian",0,AUTHORITY["ESRI","108900"]],UNIT["degree",0.0174532925199433,AUTHORITY["EPSG","9122"]],AUTHORITY["ESRI","104903"]]',valid:[-180,180],origin:[-180,90],dx:1e-5}};function fs(t,e){if(t===e)return!0;if(t==null||e==null)return!1;const i=t.wkid,r=e.wkid;if(i!=null||r!=null){if(i===r||Fu(t)&&Fu(e))return!0;const a=t.latestWkid;if(a!=null&&r===a)return!0;const o=e.latestWkid;return o!=null&&i===o}let s,n;return t.wkt2&&e.wkt2?(s=t.wkt2,n=e.wkt2):t.wkt&&e.wkt&&(s=t.wkt,n=e.wkt),!(!s||!n)&&s.toUpperCase()===n.toUpperCase()}function Ru(t){const e=t?.wkid;return e!=null&&e>=2e3&&Bxe[e]||null}function ZN(t){if(!t)return;const{wkid:e,vcsWkid:i}=t;if(e)return i?JSON.stringify({wkid:e,vcsWkid:i}):String(e);const r=t.wkt||t.wkt2;return JSON.stringify(r?i?{wkt:r,vcsWkid:i}:{wkt:r}:{})}function Uv(t){if(!ip(t))return!1;const{wkid:e}=t;if(e)return z[e]==null;const i=t.wkt2||t.wkt;return!!i&&/^\s*(?:GEOGCS|GEOGCRS|GEOGRAPHICCRS)/i.test(i)}function WD(t){return!(ZD(t)||YD(t))}function ly(t){return t?.wkid===4326}function PNt(t){return/^\s*(?:GEOD|GEODETIC|GEOG|GEOGRAPHIC|PROJ|PROJECTED|VERT|VERTICAL|ENG|ENGINEERING|PARAMETRIC|TIME|DERIVEDPROJ|COMPOUND|BOUND)CRS/i.test(t)}function RR(t){return t?.wkid===4490}function Fu(t){const e=t?.wkid;return e!=null&&e>=2e3&&Uxe.includes(e)}function DR(t){return t?.wkid===32662}function uC(t){return t===104971||t===104905}function ZD(t){return uC(t?.wkid)}function hC(t){return t===104903}function YD(t){return hC(t?.wkid)}function w7e(t){const e=t?.wkid;return e!=null&&e>=2e3&&b7e.includes(e)}function ip(t){if(t==null)return!1;const e=t.wkid;return e!=null&&e>=2e3||t.wkt2!=null||t.wkt!=null}const jxe={wkid:4326,wkt:Cy(Bxe[4326].wkTemplate,{Central_Meridian:"0.0"})},qxe={wkid:102100,latestWkid:3857},x7e={wkid:32662};function jK(t){return{wkt:`GEOCCS["Spherical geocentric",
    DATUM["Not specified",
      SPHEROID["Sphere",${t.radius},0]],
    PRIMEM["Greenwich",0.0,
      AUTHORITY["EPSG","8901"]],
    UNIT["m",1.0],
    AXIS["Geocentric X",OTHER],
    AXIS["Geocentric Y",EAST],
    AXIS["Geocentric Z",NORTH]
  ]`}}const Gxe=jK(mi),uU=jK(dp),hU=jK(oy),Hxe={wkt:`GEOCCS["WGS 84",
  DATUM["WGS_1984",
    SPHEROID["WGS 84",${mi.radius},298.257223563,
      AUTHORITY["EPSG","7030"]],
    AUTHORITY["EPSG","6326"]],
  PRIMEM["Greenwich",0,
    AUTHORITY["EPSG","8901"]],
  UNIT["m",1.0,
    AUTHORITY["EPSG","9001"]],
  AXIS["Geocentric X",OTHER],
  AXIS["Geocentric Y",OTHER],
  AXIS["Geocentric Z",NORTH],
  AUTHORITY["EPSG","4978"]
]`},S7e=uU.wkt.toUpperCase(),T7e=hU.wkt.toUpperCase();function or(t){if(t!=null&&ip(t)){const e=t.wkid,i=t.wkt2??t.wkt;if(uC(e))return dp;const r=i?.toUpperCase();if(i&&r===S7e)return dp;if(hC(e)||r&&r===T7e)return oy}return mi}const Wxe=Math.cos(Math.PI/16/16);function RNt(t){return uC(t)?dp:hC(t)?oy:mi}function IR(t){return fs(t,Gxe)}function pv(t){return IR(t)||fs(t,uU)||fs(t,hU)}const qK=39.37,$7e=mi.radius*Math.PI/200,Zxe=/(?:LENGTH)?UNIT\[([^\]]+)]]$/i,dC=z,Yxe=/UNIT\[([^\]]+)]/i,C7e=new Set([4305,4807,4810,4811,4812,4816,4819,4821,4901,4902,37225,104025,104026,104139,104140]),M7e=cl()({millimeter:"millimeters",centimeter:"centimeters",meter:"meters",meter_german:"german-meters",kilometer:"kilometers",decimeter:"decimeters",micrometer:"micrometers",nanometer:"nanometers","50_kilometers":"50-kilometers","150_kilometers":"150-kilometers",foot:"feet",foot_us:"us-feet",foot_clarke:"clarke-feet",fathom:"fathoms",nautical_mile:"nautical-miles",chain_us:"us-chains",link_us:"us-links",mile_us:"us-miles",yard_clarke:"clarke-yards",chain_clarke:"clarke-chains",link_clarke:"clarke-links",yard_sears:"sears-yards",foot_sears:"sears-feet",chain_sears:"sears-chains",link_sears:"sears-links",yard_benoit_1895_a:"benoit-1895-a-yards",foot_benoit_1895_a:"benoit-1895-a-feet",chain_benoit_1895_a:"benoit-1895-a-chains",link_benoit_1895_a:"benoit-1895-a-links",yard_benoit_1895_b:"benoit-1895-b-yards",foot_benoit_1895_b:"benoit-1895-b-feet",chain_benoit_1895_b:"benoit-1895-b-chains",link_benoit_1895_b:"benoit-1895-b-links",foot_1865:"1865-feet",foot_indian:"indian-feet",foot_indian_1937:"indian-1937-feet",foot_indian_1962:"indian-1962-feet",foot_indian_1975:"indian-1975-feet",yard_indian:"indian-yards",yard_indian_1937:"indian-1937-yards",yard_indian_1962:"indian-1962-yards",yard_indian_1975:"indian-1975-yards",statute_mile:"statute-miles",foot_gold_coast:"gold-coast-feet",foot_british_1936:"british-1936-feet",yard:"yards",chain:"chains",link:"links",yard_sears_1922_truncated:"sears-1922-truncated-yards",foot_sears_1922_truncated:"sears-1922-truncated-feet",chain_sears_1922_truncated:"sears-1922-truncated-chains",link_sears_1922_truncated:"sears-1922-truncated-links",yard_us:"us-yards",inch:"inches",inch_us:"us-inches",rod:"rods",rod_us:"us-rods",nautical_mile_us:"us-nautical-miles",nautical_mile_uk:"uk-nautical-miles",smoot:"smoots",vara_tx:"tx-vara",point:"points"}),md=t=>t*t,h0=t=>t*t*t,LR={length:{baseUnit:"meters",units:{millimeters:{inBaseUnits:.001},centimeters:{inBaseUnits:.01},meters:{inBaseUnits:1},feet:{inBaseUnits:.3048},"us-feet":{inBaseUnits:.3048006096012192},"clarke-feet":{inBaseUnits:.3047972654},fathoms:{inBaseUnits:1.8288},"nautical-miles":{inBaseUnits:1852},"german-meters":{inBaseUnits:1.0000135965},"us-chains":{inBaseUnits:20.11684023368047},"us-links":{inBaseUnits:.2011684023368047},"us-miles":{inBaseUnits:1609.347218694438},kilometers:{inBaseUnits:1e3},"clarke-yards":{inBaseUnits:.9143917962},"clarke-chains":{inBaseUnits:20.1166195164},"clarke-links":{inBaseUnits:.201166195164},"sears-yards":{inBaseUnits:.9143984146160287},"sears-feet":{inBaseUnits:.3047994715386762},"sears-chains":{inBaseUnits:20.11676512155263},"sears-links":{inBaseUnits:.2011676512155263},"benoit-1895-a-yards":{inBaseUnits:.9143992},"benoit-1895-a-feet":{inBaseUnits:.3047997333333333},"benoit-1895-a-chains":{inBaseUnits:20.1167824},"benoit-1895-a-links":{inBaseUnits:.201167824},"benoit-1895-b-yards":{inBaseUnits:.9143992042898124},"benoit-1895-b-feet":{inBaseUnits:.3047997347632708},"benoit-1895-b-chains":{inBaseUnits:20.11678249437587},"benoit-1895-b-links":{inBaseUnits:.2011678249437587},"1865-feet":{inBaseUnits:.3048008333333334},"indian-feet":{inBaseUnits:.3047995102481469},"indian-1937-feet":{inBaseUnits:.30479841},"indian-1962-feet":{inBaseUnits:.3047996},"indian-1975-feet":{inBaseUnits:.3047995},"indian-yards":{inBaseUnits:.9143985307444408},"indian-1937-yards":{inBaseUnits:.91439523},"indian-1962-yards":{inBaseUnits:.9143988},"indian-1975-yards":{inBaseUnits:.9143985},miles:{inBaseUnits:1609.344},"statute-miles":{inBaseUnits:1609.344},"gold-coast-feet":{inBaseUnits:.3047997101815088},"british-1936-feet":{inBaseUnits:.3048007491},yards:{inBaseUnits:.9144},chains:{inBaseUnits:20.1168},links:{inBaseUnits:.201168},"sears-1922-truncated-yards":{inBaseUnits:.914398},"sears-1922-truncated-feet":{inBaseUnits:.3047993333333334},"sears-1922-truncated-chains":{inBaseUnits:20.116756},"sears-1922-truncated-links":{inBaseUnits:.20116756},"us-yards":{inBaseUnits:.9144018288036576},decimeters:{inBaseUnits:.1},inches:{inBaseUnits:.0254},"us-inches":{inBaseUnits:.0254000508001016},rods:{inBaseUnits:5.0292},"us-rods":{inBaseUnits:5.029210058420118},"us-nautical-miles":{inBaseUnits:1853.248},"uk-nautical-miles":{inBaseUnits:1853.184},smoots:{inBaseUnits:1.7018},"tx-vara":{inBaseUnits:.8466683600033867},points:{inBaseUnits:.0003527777777777778},micrometers:{inBaseUnits:1e-6},nanometers:{inBaseUnits:1e-9},"50-kilometers":{inBaseUnits:5e4},"150-kilometers":{inBaseUnits:15e4}}},area:{baseUnit:"square-meters",units:{"square-millimeters":{inBaseUnits:md(.001)},"square-centimeters":{inBaseUnits:md(.01)},"square-decimeters":{inBaseUnits:md(.1)},"square-meters":{inBaseUnits:1},"square-kilometers":{inBaseUnits:md(1e3)},"square-inches":{inBaseUnits:md(.0254)},"square-feet":{inBaseUnits:md(.3048)},"square-yards":{inBaseUnits:md(.9144)},"square-miles":{inBaseUnits:md(1609.344)},"square-nautical-miles":{inBaseUnits:md(1852)},"square-us-feet":{inBaseUnits:md(1200/3937)},acres:{inBaseUnits:.0015625*md(1609.344)},ares:{inBaseUnits:100},hectares:{inBaseUnits:1e4}}},volume:{baseUnit:"liters",units:{liters:{inBaseUnits:1},"cubic-millimeters":{inBaseUnits:1e3*h0(.001)},"cubic-centimeters":{inBaseUnits:1e3*h0(.01)},"cubic-decimeters":{inBaseUnits:1e3*h0(.1)},"cubic-meters":{inBaseUnits:1e3},"cubic-kilometers":{inBaseUnits:1e3*h0(1e3)},"cubic-inches":{inBaseUnits:1e3*h0(.0254)},"cubic-feet":{inBaseUnits:1e3*h0(.3048)},"cubic-yards":{inBaseUnits:1e3*h0(.9144)},"cubic-miles":{inBaseUnits:1e3*h0(1609.344)}}},angle:{baseUnit:"radians",units:{radians:{inBaseUnits:1},degrees:{inBaseUnits:Math.PI/180}}}},E7e=(()=>{const t={};for(const e in LR)for(const i in LR[e].units)t[i]=e;return t})();function A7e(t,e,i){return t*LR[i].units[e].inBaseUnits}function O7e(t,e,i){return t/LR[i].units[e].inBaseUnits}const P7e=["inches","feet","yards","miles","nautical-miles","us-feet","millimeters","centimeters","decimeters","meters","kilometers"],R7e=["metric","imperial"],YN=[...R7e,...P7e],D7e=new Map([["meters","square-meters"],["feet","square-feet"],["us-feet","square-us-feet"]]);function I7e(t){return t==="imperial"||t==="metric"}function fv(t){const e=E7e[t];if(!e)throw new Error("unknown type");return e}function kue(t,e=null){return e=e||fv(t),LR[e].baseUnit===t}function hi(t,e,i){if(e===i)return t;const r=fv(e);if(r!==fv(i))throw new Error("incompatible units");const s=kue(e,r)?t:A7e(t,e,r);return kue(i,r)?s:O7e(s,i,r)}function DNt(t,e,i,r=!1){if(!r&&Uv(e))throw new Error("Unable to convert from an angular unit to a linear unit.");const s=t2(e);return s!==i&&(t=s?hi(t,s,i):hi(t*=Wr(e),"meters",i)),t}function INt(t,e,i,r=!1){if(!r&&Uv(i))throw new Error("Unable to convert from a linear unit to an angular unit.");const s=t2(i);return e!==s&&(t=s?hi(t,e,s):hi(t,e,"meters")/Wr(i)),t}function L7e(t){switch(t){case"metric":return"meters";case"imperial":return"feet";default:return t}}function LNt(t){return L7e(t)}function kNt(t){switch(t){case"metric":return"square-meters";case"imperial":return"square-feet";default:return t}}function k7e(t,e,i){switch(i){case"metric":return GK(t,e);case"imperial":return WK(t,e);default:return i}}function z7e(t,e,i){switch(i){case"metric":return HK(t,e);case"imperial":return ZK(t,e);default:return i}}function GK(t,e){const i=hi(t,e,"meters");return Math.abs(i)<3e3?"meters":"kilometers"}function HK(t,e){const i=hi(t,e,"meters");return Math.abs(i)<1e5?"meters":"kilometers"}function WK(t,e){const i=hi(t,e,"feet");return Math.abs(i)<1e3?"feet":"miles"}function ZK(t,e){const i=hi(t,e,"feet");return Math.abs(i)<1e5?"feet":"miles"}function Qxe(t,e){const i=hi(t,e,"square-meters");return Math.abs(i)<3e6?"square-meters":"square-kilometers"}function Xxe(t,e){const i=hi(t,e,"square-feet");return Math.abs(i)<1e6?"square-feet":"square-miles"}function zNt(t,e,i){switch(i){case"metric":return Qxe(t,e);case"imperial":return Xxe(t,e);default:return i}}function F7e(t,e){const i=hi(t,e,"cubic-meters");return Math.abs(i)<3e8?"cubic-meters":"cubic-kilometers"}function N7e(t,e){const i=hi(t,e,"cubic-feet");return Math.abs(i)<1e8?"cubic-feet":"cubic-miles"}function FNt(t,e,i){switch(i){case"metric":return F7e(t,e);case"imperial":return N7e(t,e);default:return i}}function V7e(t,e,i){return hi(t,e,"meters")/(i*Math.PI/180)}function YK(t){return M7e.fromJSON(t.toLowerCase())||null}function _p(t){if(t!=null&&!WD(t))return 1;const e=Wr(t);return e>1e5?1:e}function Jxe(t){return Wr(t)>=or(t).metersPerDegree?"meters":t2(t)}function Wr(t,e=mi.metersPerDegree){return U7e(t,!0)??e}function U7e(t,e=!1){const i=t?.wkid??null,r=t?.wkt2??t?.wkt??null;let s=null;if(i){if(uC(i))return dp.metersPerDegree;if(hC(i))return oy.metersPerDegree;s=dC.values[dC[i]],!s&&e&&C7e.has(i)&&(s=$7e)}else r&&(r2e(r)?s=Fue(Zxe.exec(r),s):i2e(r)&&(s=Fue(Yxe.exec(r),s)));return s}function zue(t){return Uv(t)?1:Wr(t)}function Fue(t,e){return t?.[1]?Kxe(t[1]):e}function Kxe(t){return parseFloat(t.split(",")[1])}function t2(t){const e=t?.wkid??null,i=t?.wkt2??t?.wkt??null;let r=null;if(e)r=dC.units[dC[e]];else if(i){const s=r2e(i)?Zxe:i2e(i)?Yxe:null;if(s){const n=s.exec(i);n?.[1]&&(r=q7e(n[1]))}}return r!=null?YK(r):null}function e2e(t){const e=t2(t);return e!=null&&YN.includes(e)?e:null}function t2e(t){const e=Jxe(t);return e!=null&&YN.includes(e)?e:null}function B7e(t){const e=t2(t);return e==null?null:D7e.get(e)}function i2e(t){return/^GEOCCS/i.test(t)}function r2e(t){return/^\s*(?:PROJCS|PROJCRS|PROJECTEDCRS)/i.test(t)}const j7e=1e-7;function q7e(t){let i=/[\\"']([^\\"']+)/.exec(t)?.[1];if(!i||!YK(i)){const r=Kxe(t);i=null;const s=dC.values;for(let n=0;n<s.length;++n)if(Math.abs(r-s[n])<j7e){i=dC.units[n];break}}return i}function G7e(t){const e=t2(t);if(e==null)return null;switch(e){case"feet":case"us-feet":case"clarke-feet":case"fathoms":case"nautical-miles":case"us-chains":case"us-links":case"us-miles":case"clarke-yards":case"clarke-chains":case"clarke-links":case"sears-yards":case"sears-feet":case"sears-chains":case"sears-links":case"benoit-1895-a-yards":case"benoit-1895-a-feet":case"benoit-1895-a-chains":case"benoit-1895-a-links":case"benoit-1895-b-yards":case"benoit-1895-b-feet":case"benoit-1895-b-chains":case"benoit-1895-b-links":case"1865-feet":case"indian-feet":case"indian-1937-feet":case"indian-1962-feet":case"indian-1975-feet":case"indian-yards":case"indian-1937-yards":case"indian-1962-yards":case"indian-1975-yards":case"statute-miles":case"gold-coast-feet":case"british-1936-feet":case"yards":case"chains":case"links":case"sears-1922-truncated-yards":case"sears-1922-truncated-feet":case"sears-1922-truncated-chains":case"sears-1922-truncated-links":case"us-yards":case"inches":case"us-inches":case"rods":case"us-rods":case"us-nautical-miles":case"uk-nautical-miles":case"smoots":case"tx-vara":case"points":return"imperial";case"millimeters":case"centimeters":case"meters":case"german-meters":case"kilometers":case"decimeters":case"micrometers":case"nanometers":case"50-kilometers":case"150-kilometers":return"metric"}return null}const H7e={esriAcres:"acres",esriAres:"ares",esriHectares:"hectares",esriSquareCentimeters:"square-centimeters",esriSquareDecimeters:"square-decimeters",esriSquareFeet:"square-feet",esriSquareInches:"square-inches",esriSquareKilometers:"square-kilometers",esriSquareMeters:"square-meters",esriSquareMiles:"square-miles",esriSquareMillimeters:"square-millimeters",esriSquareUsFeet:"square-us-feet",esriSquareYards:"square-yards"},W7e={esriCentimeters:"centimeters",esriDecimeters:"decimeters",esriFeet:"feet",esriInches:"inches",esriKilometers:"kilometers",esriMeters:"meters",esriMiles:"miles",esriMillimeters:"millimeters",esriNauticalMiles:"nautical-miles",esriYards:"yards"},Z7e={esriDUDecimalDegrees:"degrees",esriDURadians:"radians"},NNt=cl()(H7e),VNt=cl()(W7e),UNt=cl()(Z7e);var tf,If;let Ie=(If=class extends ke{static fromJSON(e){if(!e)return null;if(e?.wkid===102100)return tf.WebMercator;if(e?.wkid===4326)return tf.WGS84;const i=new tf;return i.read(e),i}constructor(e){super(e),this.latestWkid=null,this.wkid=null,this.wkt=null,this.wkt2=null,this.vcsWkid=null,this.latestVcsWkid=null,this.imageCoordinateSystem=null}normalizeCtorArgs(e){return e&&typeof e=="object"?e:{[typeof e=="string"?"wkt":"wkid"]:e}}get isWGS84(){return ly(this)}get isWebMercator(){return Fu(this)}get isGeographic(){return Uv(this)}get isWrappable(){return w7e(this)}get metersPerUnit(){return Wr(this)}get unit(){return t2(this)||(this.isGeographic?"degrees":null)}writeWkt(e,i){this.wkid||(i.wkt=e)}clone(){if(this===tf.WGS84)return new tf(jxe);if(this===tf.WebMercator)return new tf(qxe);const e=new tf;return this.wkid!=null?(e.wkid=this.wkid,this.latestWkid!=null&&(e.latestWkid=this.latestWkid),this.vcsWkid!=null&&(e.vcsWkid=this.vcsWkid),this.latestVcsWkid!=null&&(e.latestVcsWkid=this.latestVcsWkid)):(this.wkt!=null&&(e.wkt=this.wkt),this.wkt2!=null&&(e.wkt2=this.wkt2)),this.imageCoordinateSystem&&(e.imageCoordinateSystem=Te(this.imageCoordinateSystem)),e}equals(e){if(e==null)return!1;if(this.imageCoordinateSystem||e.imageCoordinateSystem){if(this.imageCoordinateSystem==null||e.imageCoordinateSystem==null)return!1;const{id:i,referenceServiceName:r}=e.imageCoordinateSystem,{geodataXform:s}=e.imageCoordinateSystem,n=this.imageCoordinateSystem;return i==null||s?JSON.stringify(n)===JSON.stringify(e.imageCoordinateSystem):r?n.id===i&&n.referenceServiceName===r:n.id===i}return fs(this,e)}toJSON(e){return this.write(void 0,e)}},tf=If,If.GCS_NAD_1927=null,If.WGS84=null,If.WebMercator=null,If.PlateCarree=null,If);d([m({readOnly:!0})],Ie.prototype,"isWGS84",null),d([m({readOnly:!0})],Ie.prototype,"isWebMercator",null),d([m({readOnly:!0})],Ie.prototype,"isGeographic",null),d([m({readOnly:!0})],Ie.prototype,"isWrappable",null),d([m({type:qi,json:{write:!0}})],Ie.prototype,"latestWkid",void 0),d([m({readOnly:!0})],Ie.prototype,"metersPerUnit",null),d([m({readOnly:!0})],Ie.prototype,"unit",null),d([m({type:qi,json:{write:!0,origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkt==null}}}}}}})],Ie.prototype,"wkid",void 0),d([m({type:String,json:{origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkid==null}}}}}}})],Ie.prototype,"wkt",void 0),d([Ht("wkt"),Ht("web-scene","wkt")],Ie.prototype,"writeWkt",null),d([m({type:String,json:{write:!1}})],Ie.prototype,"wkt2",void 0),d([m({type:qi,json:{write:!0}})],Ie.prototype,"vcsWkid",void 0),d([m({type:qi,json:{write:!0}})],Ie.prototype,"latestVcsWkid",void 0),d([m()],Ie.prototype,"imageCoordinateSystem",void 0),Ie=tf=d([k("esri.geometry.SpatialReference")],Ie),Ie.prototype.toJSON.isDefaultToJSON=!0,Ie.GCS_NAD_1927=Me.freeze(new Ie({wkid:4267,wkt:'GEOGCS["GCS_North_American_1927",DATUM["D_North_American_1927",SPHEROID["Clarke_1866",6378206.4,294.9786982]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]'})),Ie.WGS84=Me.freeze(new Ie(jxe)),Ie.WebMercator=Me.freeze(new Ie(qxe)),Ie.PlateCarree=Me.freeze(new Ie(x7e));let so=class extends ke{constructor(...e){super(...e),this.type=null,this.hasM=!1,this.hasZ=!1,this.spatialReference=Ie.WGS84}get cache(){return this.commitProperty("spatialReference"),{}}get extent(){return null}readSpatialReference(e,i){if(e instanceof Ie)return e;if(e!=null){const r=new Ie;return r.read(e,i),r}return e}clone(){return console.warn(".clone() is not implemented for "+this.declaredClass),null}clearCache(){this.notifyChange("cache")}getCacheValue(e){return this.cache[e]}setCacheValue(e,i){this.cache[e]=i}};d([m()],so.prototype,"type",void 0),d([m({readOnly:!0})],so.prototype,"cache",null),d([m({readOnly:!0})],so.prototype,"extent",null),d([m({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],so.prototype,"hasM",void 0),d([m({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],so.prototype,"hasZ",void 0),d([m({type:Ie,json:{write:!0},value:Ie.WGS84})],so.prototype,"spatialReference",void 0),d([di("spatialReference")],so.prototype,"readSpatialReference",null),so=d([k("esri.geometry.Geometry")],so);function pC(t){if(t&&typeof t=="object"&&"type"in t&&t.type==="mesh")throw new ee("internal:mesh","Mesh geometries are not supported for this operation")}function Y7e(t){t.forEach(pC)}const Q7e=57.29577951308232,X7e=.017453292519943;function Nue(t){return t*Q7e}function Vue(t){return t*X7e}function Uue(t){return t/mi.radius}function CW(t){return Math.PI/2-2*Math.atan(Math.exp(-t/mi.radius))}function MW(t){return t.wkid!=null||t.wkt!=null}const B9=[0,0];function QN(t,e,i,r,s){const n=t,a=s;if(a.spatialReference=i,"x"in n&&"x"in a)[a.x,a.y]=e(n.x,n.y,B9,r);else if("xmin"in n&&"xmin"in a)[a.xmin,a.ymin]=e(n.xmin,n.ymin,B9,r),[a.xmax,a.ymax]=e(n.xmax,n.ymax,B9,r);else if("paths"in n&&"paths"in a||"rings"in n&&"rings"in a){const o="paths"in n?n.paths:n.rings,l=[];let c;for(let h=0;h<o.length;h++){const f=o[h];c=[],l.push(c);for(let y=0;y<f.length;y++)c.push(e(f[y][0],f[y][1],[0,0],r)),f[y].length>2&&c[y].push(f[y][2]),f[y].length>3&&c[y].push(f[y][3])}"paths"in a?a.paths=l:a.rings=l}else if("points"in n&&"points"in a){const o=n.points,l=[];for(let c=0;c<o.length;c++)l[c]=e(o[c][0],o[c][1],[0,0],r),o[c].length>2&&l[c].push(o[c][2]),o[c].length>3&&l[c].push(o[c][3]);a.points=l}return s}function Yk(t,e){const i=t&&(MW(t)?t:t.spatialReference),r=e&&(MW(e)?e:e.spatialReference);return!(t&&"type"in t&&t.type==="mesh"||e&&"type"in e&&e.type==="mesh"||!i||!r)&&(!!fs(r,i)||Fu(r)&&ly(i)||Fu(i)&&ly(r))}function QD(t,e){if(t==null)return null;const i=t.spatialReference,r=e&&(MW(e)?e:e.spatialReference);return Yk(i,r)?fs(i,r)?Te(t):Fu(r)?QN(t,o3,Ie.WebMercator,!1,Te(t)):ly(r)?QN(t,dU,Ie.WGS84,!1,Te(t)):null:null}function o3(t,e,i=[0,0]){e>89.99999?e=89.99999:e<-89.99999&&(e=-89.99999);const r=Vue(e);return i[0]=Vue(t)*mi.radius,i[1]=mi.halfSemiMajorAxis*Math.log((1+Math.sin(r))/(1-Math.sin(r))),i}function dU(t,e,i=[0,0],r=!1){if(t===PR[0])i[0]=-180;else if(t===PR[1])i[0]=180;else{const s=Nue(t/mi.radius);i[0]=r?s:s-360*Math.floor((s+180)/360)}return i[1]=Nue(Math.PI/2-2*Math.atan(Math.exp(-e/mi.radius))),i}function U_(t,e=!1,i=Te(t)){return pC(t),pC(i),QN(t,o3,Ie.WebMercator,e,i)}function l3(t,e=!1,i=Te(t)){return pC(t),pC(i),QN(t,dU,Ie.WGS84,e,i)}function J7e(t,e){const i=t.x-e.x,r=t.y-e.y,s=t.z!=null&&e.z!=null?t.z-e.z:0;return Math.sqrt(i*i+r*r+s*s)}function K7e(t){return s2e(t,n2e)?.[0]??null}function eqe(t){return s2e(t,n2e)?.[1]??null}function s2e({x:t,y:e,spatialReference:i},r=[0,0]){if(i){if(Fu(i))return dU(t,e,r);if(Uv(i))return r[0]=t,r[1]=e,r}return null}const n2e=[0,0];var Qk;const j9=[0,0];function Bue(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}let Qe=Qk=class extends so{static copy(t,e){e._set("x",t._get("x")),e._set("y",t._get("y")),e._set("z",t._get("z")),e._set("m",t._get("m"));const i=t._get("spatialReference");e._set("spatialReference",Me.isFrozen(i)?i:i.clone())}constructor(...t){super(...t),this.x=0,this.y=0,this.z=void 0,this.m=void 0,this.type="point"}normalizeCtorArgs(t,e,i,r,s){let n;if(Array.isArray(t))n=t,s=e,t=n[0],e=n[1],i=n[2],r=n[3];else if(t&&typeof t=="object"){if(n=t,t=n.x!=null?n.x:n.longitude,e=n.y!=null?n.y:n.latitude,i=n.z,r=n.m,(s=n.spatialReference)&&s.declaredClass!=="esri.geometry.SpatialReference"&&(s=new Ie(s)),n.longitude!=null||n.latitude!=null){if(n.longitude==null)fe.getLogger(this).warn(".longitude=","Latitude was defined without longitude");else if(n.latitude==null)fe.getLogger(this).warn(".latitude=","Longitude was defined without latitude");else if(!n.declaredClass&&s?.isWebMercator){const o=o3(n.longitude,n.latitude,j9);t=o[0],e=o[1]}}}else Bue(i)?(s=i,i=null):Bue(r)&&(s=r,r=null);const a={x:t,y:e};return a.x==null&&a.y!=null?fe.getLogger(this).warn(".y=","Y coordinate was defined without an X coordinate"):a.y==null&&a.x!=null&&fe.getLogger(this).warn(".x=","X coordinate was defined without a Y coordinate"),s!=null&&(a.spatialReference=s),i!=null&&(a.z=i),r!=null&&(a.m=r),a}get cache(){return this.commitProperty("x"),this.commitProperty("y"),this.commitProperty("z"),this.commitProperty("m"),this.commitProperty("spatialReference"),{}}get hasM(){return this.m!==void 0}set hasM(t){t!==(this._get("m")!==void 0)&&(this._set("m",t?0:void 0),this._set("hasM",t))}get hasZ(){return this.z!==void 0}set hasZ(t){t!==(this._get("z")!==void 0)&&(this._set("z",t?0:void 0),this._set("hasZ",t))}get latitude(){return eqe(this)}set latitude(t){const{spatialReference:e,x:i}=this;t!=null&&e&&(e.isWebMercator?this._set("y",o3(i,t,j9)[1]):e.isGeographic&&this._set("y",t),this._set("latitude",t))}get longitude(){return K7e(this)}set longitude(t){const{y:e,spatialReference:i}=this;t!=null&&i&&(i.isWebMercator?this._set("x",o3(t,e,j9)[0]):i.isGeographic&&this._set("x",t),this._set("longitude",t))}writeX(t,e,i){e[i]=isNaN(t)?"NaN":t}readX(t){return typeof t=="string"?NaN:t}clone(){const t=new Qk;return t.x=this.x,t.y=this.y,t.z=this.z,t.m=this.m,t.spatialReference=this.spatialReference,t}copy(t){return Qk.copy(t,this),this}equals(t){if(t==null)return!1;const{x:e,y:i,z:r,m:s,spatialReference:n}=this,{z:a,m:o}=t;let{x:l,y:c,spatialReference:h}=t;if(!n.equals(h))if(n.isWebMercator&&h.isWGS84)[l,c]=o3(l,c),h=n;else{if(!n.isWGS84||!h.isWebMercator)return!1;[l,c]=dU(l,c),h=n}return e===l&&i===c&&r===a&&s===o&&n.wkid===h.wkid}offset(t,e,i){return this.x+=t,this.y+=e,i!=null&&(this.z=(this.z??0)+i),this}normalize(){if(!this.spatialReference)return this;const t=Ru(this.spatialReference);if(!t)return this;let e=this.x;const[i,r]=t.valid,s=2*r;let n;return e>r?(n=Math.ceil(Math.abs(e-r)/s),e-=n*s):e<i&&(n=Math.ceil(Math.abs(e-i)/s),e+=n*s),this._set("x",e),this}distance(t){return J7e(this,t)}toArray(){const t=this.hasZ,e=this.hasM;return t&&e?[this.x,this.y,this.z,this.m]:t?[this.x,this.y,this.z]:e?[this.x,this.y,this.m]:[this.x,this.y]}toJSON(t){return this.write({},t)}};d([m({readOnly:!0})],Qe.prototype,"cache",null),d([m({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],Qe.prototype,"hasM",null),d([m({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],Qe.prototype,"hasZ",null),d([m({type:Number})],Qe.prototype,"latitude",null),d([m({type:Number})],Qe.prototype,"longitude",null),d([m({type:Number,json:{type:[Number,String],write:{isRequired:!0,allowNull:!0}}}),qr(t=>isNaN(t)?t:xu(t))],Qe.prototype,"x",void 0),d([Ht("x")],Qe.prototype,"writeX",null),d([di("x")],Qe.prototype,"readX",null),d([m({type:Number,json:{write:!0}})],Qe.prototype,"y",void 0),d([m({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Qe.prototype,"z",void 0),d([m({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasM}}}}})],Qe.prototype,"m",void 0),Qe=Qk=d([k("esri.geometry.Point")],Qe),Qe.prototype.toJSON.isDefaultToJSON=!0;let rf=class extends ur(ke){constructor(...e){super(...e),this.position=new Qe([0,0,0]),this.heading=0,this.tilt=0,this.fov=55,this.layout=new Hwe}normalizeCtorArgs(e,i,r,s){if(e&&typeof e=="object"&&("x"in e||Array.isArray(e))){const n={position:e};return i!=null&&(n.heading=i),r!=null&&(n.tilt=r),s!=null&&(n.fov=s),n}return e}writePosition(e,i,r,s){const n=e.clone();n.x=xu(e.x||0),n.y=xu(e.y||0),n.z=e.hasZ?xu(e.z||0):e.z,i[r]=n.write({},s)}readPosition(e,i){const r=new Qe;return r.read(e,i),r.x=xu(r.x||0),r.y=xu(r.y||0),r.z=r.hasZ?xu(r.z||0):r.z,r}equals(e){return e!=null&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)&&this.layout.equals(e.layout)}};d([m({type:Qe,json:{write:{isRequired:!0}}})],rf.prototype,"position",void 0),d([Ht("position")],rf.prototype,"writePosition",null),d([di("position")],rf.prototype,"readPosition",null),d([m({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),qr(t=>nU.normalize(xu(t)))],rf.prototype,"heading",void 0),d([m({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),qr(t=>Se(xu(t),-180,180))],rf.prototype,"tilt",void 0),d([m({type:Number,nonNullable:!0,json:{default:55,write:!0}}),qr(t=>Se(xu(t,55),1,170))],rf.prototype,"fov",void 0),d([m({type:Hwe,nonNullable:!0,json:{read:!1,write:!1}})],rf.prototype,"layout",void 0),rf=d([k("esri.Camera")],rf);const ol=rf;function K(t,e,i={}){return QK(t,e,i,a2e)}function Zs(t,e,i={}){return QK(t,e,i,o2e)}function QK(t,e,i={},r){let s=null;const n=i.once?(a,o)=>{r(a)&&(Ki(s),e(a,o))}:(a,o)=>{r(a)&&e(a,o)};if(s=rje(t,n,i.sync,i.equals),i.initial){const a=t();n(a,a)}return s}function Ys(t,e,i,r={}){let s=null,n=null,a=null;function o(){s&&n&&(n.remove(),r.onListenerRemove?.(s),s=null,n=null)}function l(h){r.once&&r.once&&Ki(a),i(h)}const c=K(t,(h,f)=>{o(),eU(h)&&(s=h,n=aM(h,e,l),r.onListenerAdd?.(h))},{sync:r.sync,initial:!0});return a=ci(()=>{c.remove(),o()}),a}function mv(t,e){return tqe(t,o2e,e)}function tqe(t,e,i){if(Rn(i))return Promise.reject(Xt());const r=t();if(e?.(r))return Promise.resolve(r);let s=null;function n(){s=Ki(s)}return new Promise((a,o)=>{s=qu([qa(i,()=>{n(),o(Xt())}),QK(t,l=>{n(),a(l)},{sync:!1,once:!0},e??a2e)])})}function a2e(t){return!0}function o2e(t){return!!t}function qNt(t,e,i={}){let r=!1;const s=K(t,(n,a)=>{r||e(n,a)},i);return{remove(){s.remove()},pause(){r=!0},resume(){r=!1}}}const Yt={sync:!0},Wt={initial:!0},At={sync:!0,initial:!0},q9=[0,0];function XK(t,e){return e!=null&&Mo(t,e.x,e.y,e.z)}function GNt(t,e){if(!e.points?.length)return!1;for(const i of e.points)if(!fC(t,i))return!1;return!0}function iqe(t,e){const{xmin:i,ymin:r,zmin:s,xmax:n,ymax:a,zmax:o}=e;return t.hasZ&&e.hasZ?Mo(t,i,r,s)&&Mo(t,i,a,s)&&Mo(t,n,a,s)&&Mo(t,n,r,s)&&Mo(t,i,r,o)&&Mo(t,i,a,o)&&Mo(t,n,a,o)&&Mo(t,n,r,o):Mo(t,i,r)&&Mo(t,i,a)&&Mo(t,n,a)&&Mo(t,n,r)}function fC(t,e){return Mo(t,e[0],e[1])}function rqe(t,e){return Mo(t,e[0],e[1],e[2])}function Mo(t,e,i,r){return e>=t.xmin&&e<=t.xmax&&i>=t.ymin&&i<=t.ymax&&(r==null||!t.hasZ||r>=t.zmin&&r<=t.zmax)}function sqe(t,e){return q9[1]=e.y,q9[0]=e.x,nqe(t,q9)}function nqe(t,e){return l2e(t.rings,e)}function l2e(t,e){if(!t||t.length<1)return!1;if(aqe(t))return jue(!1,t,e);let i=!1;for(let r=0,s=t.length;r<s;r++)i=jue(i,t[r],e);return i}function aqe(t){return!Array.isArray(t[0][0])}function jue(t,e,i){const[r,s]=i;let n=t,a=0;for(let o=0,l=e.length;o<l;o++){a++,a===l&&(a=0);const[c,h]=e[o],[f,y]=e[a];(h<s&&y>=s||y<s&&h>=s)&&c+(s-h)/(y-h)*(f-c)<r&&(n=!n)}return n}function oqe(t,e){return XK(t,e)}function lqe(t,e){const i=t.hasZ&&e.hasZ;let r,s,n;if(t.xmin<=e.xmin){if(r=e.xmin,t.xmax<r)return!1}else if(r=t.xmin,e.xmax<r)return!1;if(t.ymin<=e.ymin){if(s=e.ymin,t.ymax<s)return!1}else if(s=t.ymin,e.ymax<s)return!1;if(i&&e.hasZ){if(t.zmin<=e.zmin){if(n=e.zmin,t.zmax<n)return!1}else if(n=t.zmin,e.zmax<n)return!1}return!0}function cqe(t,e){const{points:i,hasZ:r}=e,s=r?rqe:fC;for(const n of i)if(s(t,n))return!0;return!1}const zx=[0,0],Fx=[0,0],Nx=[0,0],Vx=[0,0],uqe=[zx,Fx,Nx,Vx],c2e=[[Nx,zx],[zx,Fx],[Fx,Vx],[Vx,Nx]];function hqe(t,e){return dqe(t,e.rings)}function dqe(t,e){zx[0]=t.xmin,zx[1]=t.ymax,Fx[0]=t.xmax,Fx[1]=t.ymax,Nx[0]=t.xmin,Nx[1]=t.ymin,Vx[0]=t.xmax,Vx[1]=t.ymin;for(const i of uqe)if(l2e(e,i))return!0;for(const i of e){if(!i.length)continue;let r=i[0];if(fC(t,r))return!0;for(let s=1;s<i.length;s++){const n=i[s];if(fC(t,n)||u2e(r,n,c2e))return!0;r=n}}return!1}function pqe(t,e){zx[0]=t.xmin,zx[1]=t.ymax,Fx[0]=t.xmax,Fx[1]=t.ymax,Nx[0]=t.xmin,Nx[1]=t.ymin,Vx[0]=t.xmax,Vx[1]=t.ymin;const i=e.paths;for(const r of i){if(!i.length)continue;let s=r[0];if(fC(t,s))return!0;for(let n=1;n<r.length;n++){const a=r[n];if(fC(t,a)||u2e(s,a,c2e))return!0;s=a}}return!1}const Za=[0,0];function fqe(t){for(let e=0;e<t.length;e++){const i=t[e];for(let s=0;s<i.length-1;s++){const n=i[s],a=i[s+1];for(let o=e+1;o<t.length;o++)for(let l=0;l<t[o].length-1;l++){const c=t[o][l],h=t[o][l+1];if(EW(n,a,c,h,Za)&&!(Za[0]===n[0]&&Za[1]===n[1]||Za[0]===c[0]&&Za[1]===c[1]||Za[0]===a[0]&&Za[1]===a[1]||Za[0]===h[0]&&Za[1]===h[1]))return!0}}const r=i.length;if(!(r<=4))for(let s=0;s<r-3;s++){let n=r-1;s===0&&(n=r-2);const a=i[s],o=i[s+1];for(let l=s+2;l<n;l++){const c=i[l],h=i[l+1];if(EW(a,o,c,h,Za)&&!(Za[0]===a[0]&&Za[1]===a[1]||Za[0]===c[0]&&Za[1]===c[1]||Za[0]===o[0]&&Za[1]===o[1]||Za[0]===h[0]&&Za[1]===h[1]))return!0}}}return!1}function u2e(t,e,i){for(let r=0;r<i.length;r++)if(EW(t,e,i[r][0],i[r][1]))return!0;return!1}function EW(t,e,i,r,s){const[n,a]=t,[o,l]=e,[c,h]=i,[f,y]=r,_=f-c,w=n-c,x=o-n,S=y-h,$=a-h,A=l-a,M=S*x-_*A;if(M===0)return!1;const P=(_*$-S*w)/M,O=(x*$-A*w)/M;return P>=0&&P<=1&&O>=0&&O<=1&&(s&&(s[0]=n+P*(o-n),s[1]=a+P*(l-a)),!0)}function mqe(t){switch(t){case"esriGeometryEnvelope":case"extent":return lqe;case"esriGeometryMultipoint":case"multipoint":return cqe;case"esriGeometryPoint":case"point":return oqe;case"esriGeometryMultiPatch":case"multipatch":case"esriGeometryPolygon":case"polygon":return hqe;case"esriGeometryPolyline":case"polyline":return pqe}}var Ad;function gqe(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}function d0(t,e,i){return e==null?i:i==null?e:t(e,i)}let Bt=Ad=class extends so{constructor(...t){super(...t),this.type="extent",this.xmin=0,this.ymin=0,this.mmin=void 0,this.zmin=void 0,this.xmax=0,this.ymax=0,this.mmax=void 0,this.zmax=void 0}normalizeCtorArgs(t,e,i,r,s){return gqe(t)?{spatialReference:t,xmin:0,ymin:0,xmax:0,ymax:0}:typeof t=="object"?(t.spatialReference=t.spatialReference==null?Ie.WGS84:t.spatialReference,t):{xmin:t,ymin:e,xmax:i,ymax:r,spatialReference:s??Ie.WGS84}}static fromPoint(t){return new Ad({xmin:t.x,ymin:t.y,zmin:t.z,xmax:t.x,ymax:t.y,zmax:t.z,spatialReference:t.spatialReference})}get cache(){return this.commitProperty("xmin"),this.commitProperty("ymin"),this.commitProperty("zmin"),this.commitProperty("mmin"),this.commitProperty("xmax"),this.commitProperty("ymax"),this.commitProperty("zmax"),this.commitProperty("mmax"),this.commitProperty("spatialReference"),{}}get center(){const t=new Qe({x:.5*(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),spatialReference:this.spatialReference});return this.hasZ&&(t.z=.5*(this.zmin+this.zmax)),this.hasM&&(t.m=.5*(this.mmin+this.mmax)),t}get extent(){return this.clone()}get hasM(){return this.mmin!=null&&this.mmax!=null}get hasZ(){return this.zmin!=null&&this.zmax!=null}get height(){return Math.abs(this.ymax-this.ymin)}get width(){return Math.abs(this.xmax-this.xmin)}centerAt(t){const e=this.center;return t.z!=null&&this.hasZ?this.offset(t.x-e.x,t.y-e.y,t.z-e.z):this.offset(t.x-e.x,t.y-e.y)}clone(){const t=new Ad;return t.xmin=this.xmin,t.ymin=this.ymin,t.xmax=this.xmax,t.ymax=this.ymax,t.spatialReference=this.spatialReference,this.zmin!=null&&(t.zmin=this.zmin,t.zmax=this.zmax),this.mmin!=null&&(t.mmin=this.mmin,t.mmax=this.mmax),t}contains(t){if(!t)return!1;const e=this.spatialReference,i=t.spatialReference;return e&&i&&!e.equals(i)&&Yk(e,i)&&(t=e.isWebMercator?U_(t):l3(t,!0)),t.type==="point"?XK(this,t):t.type==="extent"&&iqe(this,t)}equals(t){if(this===t)return!0;if(t==null)return!1;const e=this.spatialReference,i=t.spatialReference;return e&&i&&!e.equals(i)&&Yk(e,i)&&(t=e.isWebMercator?U_(t):l3(t,!0)),this.xmin===t.xmin&&this.ymin===t.ymin&&this.zmin===t.zmin&&this.mmin===t.mmin&&this.xmax===t.xmax&&this.ymax===t.ymax&&this.zmax===t.zmax&&this.mmax===t.mmax}expand(t){const e=.5*(1-t),i=this.width*e,r=this.height*e;if(this.xmin+=i,this.ymin+=r,this.xmax-=i,this.ymax-=r,this.hasZ){const s=(this.zmax-this.zmin)*e;this.zmin+=s,this.zmax-=s}if(this.hasM){const s=(this.mmax-this.mmin)*e;this.mmin+=s,this.mmax-=s}return this}intersects(t){if(t==null)return!1;t.type==="mesh"&&(t=t.extent);const e=this.spatialReference,i=t.spatialReference;return e&&i&&!fs(e,i)&&Yk(e,i)&&(t=e.isWebMercator?U_(t):l3(t,!0)),mqe(t.type)(this,t)}normalize(){const t=this._normalize(!1,!0);return Array.isArray(t)?t:[t]}offset(t,e,i){return this.xmin+=t,this.ymin+=e,this.xmax+=t,this.ymax+=e,i!=null&&(this.zmin+=i,this.zmax+=i),this}shiftCentralMeridian(){return this._normalize(!0)}union(t){return this===t||(this.xmin=Math.min(this.xmin,t.xmin),this.ymin=Math.min(this.ymin,t.ymin),this.xmax=Math.max(this.xmax,t.xmax),this.ymax=Math.max(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=d0(Math.min,this.zmin,t.zmin),this.zmax=d0(Math.max,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=d0(Math.min,this.mmin,t.mmin),this.mmax=d0(Math.max,this.mmax,t.mmax))),this}intersection(t){return this===t?this:t!=null&&this.intersects(t)?(this.xmin=Math.max(this.xmin,t.xmin),this.ymin=Math.max(this.ymin,t.ymin),this.xmax=Math.min(this.xmax,t.xmax),this.ymax=Math.min(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=d0(Math.max,this.zmin,t.zmin),this.zmax=d0(Math.min,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=d0(Math.max,this.mmin,t.mmin),this.mmax=d0(Math.min,this.mmax,t.mmax)),this):null}toJSON(t){return this.write({},t)}_shiftCM(t=Ru(this.spatialReference)){if(!t||!this.spatialReference)return this;const e=this.spatialReference,i=this._getCM(t);if(i){const r=e.isWebMercator?l3(i):i;this.xmin-=i.x,this.xmax-=i.x,e.isWebMercator||(r.x=G9(r.x,t).x),this.spatialReference=new Ie(Cy((e.isWGS84?t.altTemplate:null)??t.wkTemplate,{Central_Meridian:r.x}))}return this}_getCM(t){let e=null;const[i,r]=t.valid,s=this.xmin,n=this.xmax;return s>=i&&s<=r&&n>=i&&n<=r||(e=this.center),e}_normalize(t,e,i){const r=this.spatialReference;if(!r)return this;const s=i??Ru(r);if(s==null)return this;const n=this._getParts(s).map(l=>l.extent);if(n.length<2)return n[0]||this;if(n.length>2)return t?this._shiftCM(s):this.set({xmin:s.valid[0],xmax:s.valid[1]});if(t)return this._shiftCM(s);if(e)return n;let a=!0,o=!0;return n.forEach(l=>{l.hasZ||(a=!1),l.hasM||(o=!1)}),{rings:n.map(l=>{const c=[[l.xmin,l.ymin],[l.xmin,l.ymax],[l.xmax,l.ymax],[l.xmax,l.ymin],[l.xmin,l.ymin]];if(a){const h=(l.zmax-l.zmin)/2;for(let f=0;f<c.length;f++)c[f].push(h)}if(o){const h=(l.mmax-l.mmin)/2;for(let f=0;f<c.length;f++)c[f].push(h)}return c}),hasZ:a,hasM:o,spatialReference:r}}_getParts(t){let e=this.cache._parts;if(!e){e=[];const{ymin:s,ymax:n,spatialReference:a}=this,o=this.width,l=this.xmin,c=this.xmax;let h;t=t||Ru(a);const[f,y]=t.valid;h=G9(this.xmin,t);const _=h.x,w=h.frameId;h=G9(this.xmax,t);const x=h.x,S=h.frameId,$=_===x&&o>0;if(o>2*y){const A=new Ad(l<c?_:x,s,y,n,a),M=new Ad(f,s,l<c?x:_,n,a),P=new Ad(0,s,y,n,a),O=new Ad(f,s,0,n,a),D=[],L=[];A.contains(P)&&D.push(w),A.contains(O)&&L.push(w),M.contains(P)&&D.push(S),M.contains(O)&&L.push(S);for(let F=w+1;F<S;F++)D.push(F),L.push(F);e.push({extent:A,frameIds:[w]},{extent:M,frameIds:[S]},{extent:P,frameIds:D},{extent:O,frameIds:L})}else _>x||$?e.push({extent:new Ad(_,s,y,n,a),frameIds:[w]},{extent:new Ad(f,s,x,n,a),frameIds:[S]}):e.push({extent:new Ad(_,s,x,n,a),frameIds:[w]});this.cache._parts=e}const i=this.hasZ,r=this.hasM;if(i||r){const s={};i&&(s.zmin=this.zmin,s.zmax=this.zmax),r&&(s.mmin=this.mmin,s.mmax=this.mmax);for(let n=0;n<e.length;n++)e[n].extent.set(s)}return e}};function G9(t,e){const[i,r]=e.valid,s=2*r;let n,a=0;return t>r?(n=Math.ceil(Math.abs(t-r)/s),t-=n*s,a=n):t<i&&(n=Math.ceil(Math.abs(t-i)/s),t+=n*s,a=-n),{x:t,frameId:a}}d([m({readOnly:!0})],Bt.prototype,"cache",null),d([m({readOnly:!0})],Bt.prototype,"center",null),d([m({readOnly:!0})],Bt.prototype,"extent",null),d([m({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],Bt.prototype,"hasM",null),d([m({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],Bt.prototype,"hasZ",null),d([m({readOnly:!0})],Bt.prototype,"height",null),d([m({readOnly:!0})],Bt.prototype,"width",null),d([m({type:Number,json:{type:[Number,String],write:{enabled:!0,allowNull:!0}}})],Bt.prototype,"xmin",void 0),d([m({type:Number,json:{write:!0}})],Bt.prototype,"ymin",void 0),d([m({type:Number,json:{origins:{"web-scene":{write:!1}},read:t=>t??void 0,write:{overridePolicy(){return{enabled:this.hasM}}}}})],Bt.prototype,"mmin",void 0),d([m({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Bt.prototype,"zmin",void 0),d([m({type:Number,json:{write:!0}})],Bt.prototype,"xmax",void 0),d([m({type:Number,json:{write:!0}})],Bt.prototype,"ymax",void 0),d([m({type:Number,json:{origins:{"web-scene":{write:!1}},read:t=>t??void 0,write:{overridePolicy(){return{enabled:this.hasM}}}}})],Bt.prototype,"mmax",void 0),d([m({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Bt.prototype,"zmax",void 0),Bt=Ad=d([k("esri.geometry.Extent")],Bt),Bt.prototype.toJSON.isDefaultToJSON=!0;function Pi(t=wqe){return[t[0],t[1],t[2],t[3]]}function HNt(t){return[t[0],t[1],t[2],t[3]]}function Bv(t,e){return t!==e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]),t}function pU(t,e,i,r,s=Pi()){return s[0]=t,s[1]=e,s[2]=i,s[3]=r,s}function JK(t,e=Pi()){return e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax,e}function fU(t,e,i=new Bt){return i.xmin=t[0],i.ymin=t[1],i.xmax=t[2],i.ymax=t[3],i.spatialReference=e,i}function $u(t,e){e[0]<t[0]&&(t[0]=e[0]),e[0]>t[2]&&(t[2]=e[0]),e[1]<t[1]&&(t[1]=e[1]),e[1]>t[3]&&(t[3]=e[1])}function yqe(t,e){e<t[0]&&(t[0]=e),e>t[2]&&(t[2]=e)}function _qe(t,e){e<t[1]&&(t[1]=e),e>t[3]&&(t[3]=e)}function H3(t,e,i){if(e!=null)if("length"in e)PW(e)?(i[0]=Math.min(t[0],e[0]),i[1]=Math.min(t[1],e[1]),i[2]=Math.max(t[2],e[2]),i[3]=Math.max(t[3],e[3])):e.length!==2&&e.length!==3||(i[0]=Math.min(t[0],e[0]),i[1]=Math.min(t[1],e[1]),i[2]=Math.max(t[2],e[0]),i[3]=Math.max(t[3],e[1]));else switch(e.type){case"extent":i[0]=Math.min(t[0],e.xmin),i[1]=Math.min(t[1],e.ymin),i[2]=Math.max(t[2],e.xmax),i[3]=Math.max(t[3],e.ymax);break;case"point":i[0]=Math.min(t[0],e.x),i[1]=Math.min(t[1],e.y),i[2]=Math.max(t[2],e.x),i[3]=Math.max(t[3],e.y)}else Bv(i,t)}function H9(t,e,i=t){const r=e.length;let s=t[0],n=t[1],a=t[2],o=t[3];for(let l=0;l<r;l++){const c=e[l];s=Math.min(s,c[0]),n=Math.min(n,c[1]),a=Math.max(a,c[0]),o=Math.max(o,c[1])}return i[0]=s,i[1]=n,i[2]=a,i[3]=o,i}function AW(t){for(let e=0;e<4;e++)if(!isFinite(t[e]))return!1;return!0}function oo(t){return t==null||t[0]>=t[2]?0:t[2]-t[0]}function Bl(t){return t==null||t[1]>=t[3]?0:t[3]-t[1]}function WNt(t){return oo(t)*Bl(t)}function XN(t){return oo(t)>0&&Bl(t)>0}function h2e(t,e=[0,0]){return e[0]=(t[0]+t[2])/2,e[1]=(t[1]+t[3])/2,e}function ZNt(t){const e=oo(t),i=Bl(t);return Math.sqrt(e*e+i*i)}function vqe(t,e){return mC(t,e[0],e[1])}function que(t,e){const i=e[3],r=.5*(t[0]+t[2]),s=Math.abs(e[0]-r),n=.5*(t[2]-t[0]);if(s>i+n)return!1;const a=.5*(t[1]+t[3]),o=.5*(t[3]-t[1]),l=Math.abs(e[1]-a);if(l>i+o)return!1;if(s<n||l<o)return!0;const c=s-n,h=l-o;return c*c+h*h<=i*i}function YNt(t,e,i){const r=t[0],s=t[1],n=t[2],a=t[3],{x:o,y:l}=e,{x:c,y:h}=i,f=(S,$)=>(h-l)*S+(o-c)*$+(c*l-o*h)<0,y=f(r,a),_=f(n,a),w=f(n,s),x=f(r,s);return!(y===_&&_===w&&w===x&&x===y||o<r&&c<r||o>n&&c>n||l>a&&h>a||l<s&&h<s)}function QNt(t,e){return!!t&&mC(t,e.x,e.y)}function mC(t,e,i){return e>=t[0]&&i>=t[1]&&e<=t[2]&&i<=t[3]}function KK(t,e){return Math.max(e[0],t[0])<=Math.min(e[2],t[2])&&Math.max(e[1],t[1])<=Math.min(e[3],t[3])}function XNt(t,e,i){return Math.max(e[0],t[0])-i<=Math.min(e[2],t[2])&&Math.max(e[1],t[1])-i<=Math.min(e[3],t[3])}function mU(t,e){return e[0]>=t[0]&&e[2]<=t[2]&&e[1]>=t[1]&&e[3]<=t[3]}function OW(t,e,i){if(e==null)return Bv(i,t);const r=e[0],s=e[1],n=e[2],a=e[3];return i[0]=Se(t[0],r,n),i[1]=Se(t[1],s,a),i[2]=Se(t[2],r,n),i[3]=Se(t[3],s,a),i}function JNt(t,e){const i=(t[0]+t[2])/2,r=(t[1]+t[3])/2,s=Math.max(Math.abs(e[0]-i)-oo(t)/2,0),n=Math.max(Math.abs(e[1]-r)-Bl(t)/2,0);return Math.sqrt(s*s+n*n)}function JN(t,e,i,r){return r??=t,r[0]=t[0]+e,r[1]=t[1]+i,r[2]=t[2]+e,r[3]=t[3]+i,r}function cy(t){return t?Bv(t,RW):Pi(RW)}function PW(t){return t!=null&&t.length===4}function bqe(t){return!(oo(t)!==0&&isFinite(t[0])||Bl(t)!==0&&isFinite(t[1]))}function vw(t,e){return PW(t)&&PW(e)?t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]:t===e}const KNt=[-1/0,-1/0,1/0,1/0],RW=[1/0,1/0,-1/0,-1/0],wqe=[0,0,0,0];function xqe(t,e,i){return e!=null&&(i?i.contains(t[0],t[2],e[0])&&i.contains(t[0],t[2],e[2])&&e[1]>t[1]&&e[3]<t[3]:mU(t,e))}function Gue(t,e,i){return t!=null&&(i?(i.contains(e[0],e[2],t[0])||i.contains(e[0],e[2],t[2])||i.contains(t[0],t[2],e[0]))&&!(t[1]>e[3]||t[3]<e[1]):KK(t,e))}let eee=1e-6;function nn(){return eee}function Sqe(t){eee=t}const XD=Math.random,Tqe=Math.PI/180,$qe=180/Math.PI;function tee(t){return t*Tqe}function Cqe(t){return t*$qe}function Mqe(t,e){return Math.abs(t-e)<=eee*Math.max(1,Math.abs(t),Math.abs(e))}Object.freeze(Object.defineProperty({__proto__:null,RANDOM:XD,equals:Mqe,getEpsilon:nn,setEpsilon:Sqe,toDegree:Cqe,toRadian:tee},Symbol.toStringTag,{value:"Module"}));function ko(t,e){return t[0]=e[0],t[1]=e[1],t}function Cr(t,e,i){return t[0]=e,t[1]=i,t}function wg(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t}function qs(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t}function d2e(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t}function p2e(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t}function Eqe(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function Aqe(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function Oqe(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t}function Pqe(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t}function Rqe(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function zg(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t}function fp(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t}function Zf(t,e){const i=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(i*i+r*r)}function Ux(t,e){const i=e[0]-t[0],r=e[1]-t[1];return i*i+r*r}function gU(t){const e=t[0],i=t[1];return Math.sqrt(e*e+i*i)}function uy(t){const e=t[0],i=t[1];return e*e+i*i}function f2e(t,e){return t[0]=-e[0],t[1]=-e[1],t}function Dqe(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function KN(t,e){const i=e[0],r=e[1];let s=i*i+r*r;return s>0&&(s=1/Math.sqrt(s),t[0]=e[0]*s,t[1]=e[1]*s),t}function en(t,e){return t[0]*e[0]+t[1]*e[1]}function Iqe(t,e,i){const r=e[0]*i[1]-e[1]*i[0];return t[0]=t[1]=0,t[2]=r,t}function Ec(t,e,i,r){const s=e[0],n=e[1];return t[0]=s+r*(i[0]-s),t[1]=n+r*(i[1]-n),t}function Lqe(t,e=1){const i=2*XD()*Math.PI;return t[0]=Math.cos(i)*e,t[1]=Math.sin(i)*e,t}function kqe(t,e,i){const r=e[0],s=e[1];return t[0]=i[0]*r+i[2]*s,t[1]=i[1]*r+i[3]*s,t}function zqe(t,e,i){const r=e[0],s=e[1];return t[0]=i[0]*r+i[2]*s+i[4],t[1]=i[1]*r+i[3]*s+i[5],t}function Xk(t,e,i){const r=e[0],s=e[1];return t[0]=i[0]*r+i[3]*s+i[6],t[1]=i[1]*r+i[4]*s+i[7],t}function Fqe(t,e,i){const r=e[0],s=e[1];return t[0]=i[0]*r+i[4]*s+i[12],t[1]=i[1]*r+i[5]*s+i[13],t}function m2e(t,e,i,r){const s=e[0]-i[0],n=e[1]-i[1],a=Math.sin(r),o=Math.cos(r);return t[0]=s*o-n*a+i[0],t[1]=s*a+n*o+i[1],t}function Nqe(t,e){const i=t[0],r=t[1],s=e[0],n=e[1];let a=i*i+r*r;a>0&&(a=1/Math.sqrt(a));let o=s*s+n*n;o>0&&(o=1/Math.sqrt(o));const l=(i*s+r*n)*a*o;return l>1?0:l<-1?Math.PI:Math.acos(l)}function Vqe(t){return"vec2("+t[0]+", "+t[1]+")"}function e6(t,e){return t[0]===e[0]&&t[1]===e[1]}function yU(t,e){const i=t[0],r=t[1],s=e[0],n=e[1],a=nn();return Math.abs(i-s)<=a*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(r-n)<=a*Math.max(1,Math.abs(r),Math.abs(n))}function Uqe(t,e,i,r,s){let n=e[0]-i[0],a=e[1]-i[1];const o=(r[0]*n+r[1]*a)*(s-1);return n=r[0]*o,a=r[1]*o,t[0]=e[0]+n,t[1]=e[1]+a,t}const Bqe=gU,g2e=qs,jqe=d2e,qqe=p2e,Gqe=Zf,Hqe=Ux,Wqe=uy;Object.freeze(Object.defineProperty({__proto__:null,add:wg,angle:Nqe,ceil:Eqe,copy:ko,cross:Iqe,dist:Gqe,distance:Zf,div:qqe,divide:p2e,dot:en,equals:yU,exactEquals:e6,floor:Aqe,inverse:Dqe,len:Bqe,length:gU,lerp:Ec,max:Pqe,min:Oqe,mul:jqe,multiply:d2e,negate:f2e,normalize:KN,projectAndScale:Uqe,random:Lqe,rotate:m2e,round:Rqe,scale:zg,scaleAndAdd:fp,set:Cr,sqrDist:Hqe,sqrLen:Wqe,squaredDistance:Ux,squaredLength:uy,str:Vqe,sub:g2e,subtract:qs,transformMat2:kqe,transformMat2d:zqe,transformMat3:Xk,transformMat4:Fqe},Symbol.toStringTag,{value:"Module"}));function Og(t,e,i,r){return t[0]=e[0]*(1-r)+i[0]*r,t[1]=e[1]*(1-r)+i[1]*r,t}function Mu(t,e){return Ux(t,e)}function Zqe(t,e,i,r,s){const[n,a]=e,[o,l]=i,[c,h]=r,[f,y]=s,_=(n-o)*(h-y)-(a-l)*(c-f);if(_===0)return null;const w=(n*l-a*o)*(c-f)-(n-o)*(c*y-h*f),x=(n*l-a*o)*(h-y)-(a-l)*(c*y-h*f);return t[0]=w/_,t[1]=x/_,t}const rp=2*Math.PI;function bw(t,e){const i=Math.atan2(t,e);return i<0?i+rp:i}function y2e(t){return Math.abs(t)%rp}function Hue(t){const e=y2e(t);return e<Math.PI?e:rp-e}function _U(t,e){return{min:Math.min(t,e),max:Math.max(t,e)}}function _2e(t,e,i,r){if(Gl(y2e(t-e),0))return i?[t,t]:[t,r?t-rp:t+rp];const[s,n]=r?[t-rp,t]:[t,t+rp];return[t,JD({min:s,max:n},e)]}function JD({min:t,max:e},i){let r;return r=e-i,r>=rp?(r-=r%rp,i+r):(r=i-t,r>=rp?(r-=r%rp,i-r):i)}function Yqe(t,e){const i=JD(t,e);return i>t.min&&i<t.max?i:Hue(i-t.min)<Hue(i-t.max)?t.min:t.max}function v2e(t,e,i,r=10){return e.map(s=>{let n=s;for(let a=0;a<r;a++){const[o,l,c,h,f,y]=i(n),_=t[0]-o,w=t[1]-l,x=-c,S=-h;n+=-(2*_*x+2*w*S)/(2*x*x+2*_*-f+2*S*S+2*w*-y||1e-6)}return n})}const Qqe=[0,0];function b2e(t){const e=1-t,i=e*e,r=t*t;return[i*e,3*t*i,3*r*e,r*t]}function DW(t,e,i,r,s){const[n,a,o,l]=b2e(s);return[t[0]*n+e[0]*a+i[0]*o+r[0]*l,t[1]*n+e[1]*a+i[1]*o+r[1]*l]}function Wue(t,e,i,r,s){const[n,a,o,l]=b2e(s);return t*n+e*a+i*o+r*l}function e6t(t,e,i){const r=t,[s,n,a]=e.b;return DW(r,n,a,s,i)}function Xqe(t,e,i){const r=t,[s,n,a]=e.b,o=Og([0,0],r,n,i),l=Og(Qqe,n,a,i),c=Og([0,0],a,s,i),h=Og([0,0],o,l,i),f=Og([0,0],l,c,i);return[{b:[Og([],h,f,i),o,h]},{b:[[...s],f,c]}]}function t6t(t,e,i){const r=t,[s,n,a]=e.b,o=v2e(i,[.1,.5,.9],f=>{const y=1-f,[_,w]=DW(r,n,a,s,f);return[_,w,3*y*y*(n[0]-r[0])+6*y*f*(a[0]-n[0])+3*f*f*(s[0]-a[0]),3*y*y*(n[1]-r[1])+6*y*f*(a[1]-n[1])+3*f*f*(s[1]-a[1]),6*y*(a[0]-2*n[0]+r[0])+6*f*(s[0]-2*a[0]+n[0]),6*y*(a[1]-2*n[1]+r[1])+6*f*(s[1]-2*a[1]+n[1])]}).map(f=>Math.min(1,Math.max(0,f)));o.push(0,1);let l=1/0;const c=o.map(f=>{const y=DW(r,n,a,s,f),[_,w]=y,x=i[0]-_,S=i[1]-w,$=Math.sqrt(x*x+S*S);return l=Math.min($,l),{t:f,curvePoint:y,distance:$}}),h=[];for(const f of c){const{t:y,distance:_}=f;MK(_,l)&&!h.some(({t:w})=>Gl(w,y))&&h.push(f)}return h}function Jqe(t,e,i){const r=e,[s,n,a]=i.b;if($u(t,r),$u(t,s),mC(t,n[0],n[1])&&mC(t,a[0],a[1]))return t;for(const o of Zue(r[0],n[0],a[0],s[0]))o>0&&o<1&&yqe(t,Wue(r[0],n[0],a[0],s[0],o));for(const o of Zue(r[1],n[1],a[1],s[1]))o>0&&o<1&&_qe(t,Wue(r[1],n[1],a[1],s[1],o));return t}function Zue(t,e,i,r){const s=3*(3*(e-i)-t+r),n=6*(t-2*e+i),a=3*(e-t);if(s===0)return n!==0?[-a/n]:[];const o=Math.sqrt(n*n-4*s*a);return[(-n+o)/(2*s),(-n-o)/(2*s)]}function i6t(t,e,i){let s=0,n=[e];for(let a=0;a<16;a++){let o=t;const l=[];for(const h of n)l.push(...Xqe(o,h,.5)),o=h.b[0];n=l,o=t,s=0;let c=0;for(const h of n){const[f,y,_]=h.b,w=Math.sqrt(Mu(o,f));s+=(w+(Math.sqrt(Mu(o,y))+Math.sqrt(Mu(y,_))+Math.sqrt(Mu(_,f))))/2,c+=w,o=f}if(s-c<i)return s}return s}function Kqe(t,e,i){const[r,s]=t,[n,a]=e,[o,l]=i,[c,h]=[n-r,a-s];let f=c*(o-r)+h*(l-s);f/=c**2+h**2,f=Se(f,0,1);const y=Og([0,0],t,e,f);return{t:f,curvePoint:y,distance:Math.sqrt(Mu(y,i))}}let w2e=class{constructor(e,i,r,s,n,a){this.cx=e,this.cy=i,this.radius=r,this.thetaStart=s,this.thetaEnd=n,this.isInvalid=a}get startPoint(){const{cx:e,cy:i,radius:r,thetaStart:s}=this;return[e+r*Math.cos(s),i+r*Math.sin(s)]}get endPoint(){const{cx:e,cy:i,radius:r,thetaEnd:s}=this;return[e+r*Math.cos(s),i+r*Math.sin(s)]}};function t6(t,e){const{cx:i,cy:r,radius:s}=t;return[i+s*Math.cos(e),r+s*Math.sin(e)]}function Jk(t,e){if(t.isInvalid)return Og([0,0],t.startPoint,t.endPoint,e);const{thetaStart:i,thetaEnd:r}=t;return t6(t,i*(1-e)+r*e)}function s6t(t,e){if(t.isInvalid)return Kqe(t.startPoint,t.endPoint,e);const{cx:i,cy:r,thetaStart:s,thetaEnd:n}=t,[a,o]=e,l=Yqe(_U(s,n),Math.atan2(o-r,a-i)),c=t6(t,l);return{t:(l-s)/(n-s),curvePoint:c,distance:Math.sqrt(Mu(e,c))}}function Yue(t,e){if(e.isInvalid)return $u(t,e.startPoint),$u(t,e.endPoint),t;const{cx:i,cy:r,radius:s,thetaStart:n,thetaEnd:a}=e;$u(t,t6(e,n)),$u(t,t6(e,a));const o=_U(n,a),l=Math.PI/2;let c=0;for(const h of[[i+s,r],[i,r+s],[i-s,r],[i,r-s]])c=JD(o,c),c>o.min&&c<o.max&&$u(t,h),c+=l;return t}function n6t(t){if(t.isInvalid)return 2*t.radius;const{radius:e,thetaStart:i,thetaEnd:r}=t;return e*Math.abs(r-i)}function jv(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function eGe(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function B_(t,e,i,r,s,n,a,o,l,c){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t[4]=n,t[5]=a,t[6]=o,t[7]=l,t[8]=c,t}function vU(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function qv(t,e){if(t===e){const i=e[1],r=e[2],s=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=r,t[7]=s}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function i2(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],a=e[4],o=e[5],l=e[6],c=e[7],h=e[8],f=h*a-o*c,y=-h*n+o*l,_=c*n-a*l;let w=i*f+r*y+s*_;return w?(w=1/w,t[0]=f*w,t[1]=(-h*r+s*c)*w,t[2]=(o*r-s*a)*w,t[3]=y*w,t[4]=(h*i-s*l)*w,t[5]=(-o*i+s*n)*w,t[6]=_*w,t[7]=(-c*i+r*l)*w,t[8]=(a*i-r*n)*w,t):null}function tGe(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],a=e[4],o=e[5],l=e[6],c=e[7],h=e[8];return t[0]=a*h-o*c,t[1]=s*c-r*h,t[2]=r*o-s*a,t[3]=o*l-n*h,t[4]=i*h-s*l,t[5]=s*n-i*o,t[6]=n*c-a*l,t[7]=r*l-i*c,t[8]=i*a-r*n,t}function Kk(t){const e=t[0],i=t[1],r=t[2],s=t[3],n=t[4],a=t[5],o=t[6],l=t[7],c=t[8];return e*(c*n-a*l)+i*(-c*s+a*o)+r*(l*s-n*o)}function gC(t,e,i){const r=e[0],s=e[1],n=e[2],a=e[3],o=e[4],l=e[5],c=e[6],h=e[7],f=e[8],y=i[0],_=i[1],w=i[2],x=i[3],S=i[4],$=i[5],A=i[6],M=i[7],P=i[8];return t[0]=y*r+_*a+w*c,t[1]=y*s+_*o+w*h,t[2]=y*n+_*l+w*f,t[3]=x*r+S*a+$*c,t[4]=x*s+S*o+$*h,t[5]=x*n+S*l+$*f,t[6]=A*r+M*a+P*c,t[7]=A*s+M*o+P*h,t[8]=A*n+M*l+P*f,t}function yC(t,e,i){const r=e[0],s=e[1],n=e[2],a=e[3],o=e[4],l=e[5],c=e[6],h=e[7],f=e[8],y=i[0],_=i[1];return t[0]=r,t[1]=s,t[2]=n,t[3]=a,t[4]=o,t[5]=l,t[6]=y*r+_*a+c,t[7]=y*s+_*o+h,t[8]=y*n+_*l+f,t}function bU(t,e,i){const r=e[0],s=e[1],n=e[2],a=e[3],o=e[4],l=e[5],c=e[6],h=e[7],f=e[8],y=Math.sin(i),_=Math.cos(i);return t[0]=_*r+y*a,t[1]=_*s+y*o,t[2]=_*n+y*l,t[3]=_*a-y*r,t[4]=_*o-y*s,t[5]=_*l-y*n,t[6]=c,t[7]=h,t[8]=f,t}function KD(t,e,i){const r=i[0],s=i[1],n=i[2];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t[6]=n*e[6],t[7]=n*e[7],t[8]=n*e[8],t}function iGe(t,e,i){const r=i[0],s=i[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t}function rGe(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function sGe(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=0,t[3]=-i,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function nGe(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function aGe(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function kR(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],a=i+i,o=r+r,l=s+s,c=i*a,h=r*a,f=r*o,y=s*a,_=s*o,w=s*l,x=n*a,S=n*o,$=n*l;return t[0]=1-f-w,t[3]=h-$,t[6]=y+S,t[1]=h+$,t[4]=1-c-w,t[7]=_-x,t[2]=y-S,t[5]=_+x,t[8]=1-c-f,t}function x2e(t,e){const i=e[0],r=e[1],s=e[2],n=e[4],a=e[5],o=e[6],l=e[8],c=e[9],h=e[10],f=h*a-o*c,y=-h*n+o*l,_=c*n-a*l,w=i*f+r*y+s*_;if(!w)return null;const x=1/w;return t[0]=f*x,t[1]=(-h*r+s*c)*x,t[2]=(o*r-s*a)*x,t[3]=y*x,t[4]=(h*i-s*l)*x,t[5]=(-o*i+s*n)*x,t[6]=_*x,t[7]=(-c*i+r*l)*x,t[8]=(a*i-r*n)*x,t}function S2e(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],a=e[4],o=e[5],l=e[6],c=e[7],h=e[8],f=e[9],y=e[10],_=e[11],w=e[12],x=e[13],S=e[14],$=e[15],A=i*o-r*a,M=i*l-s*a,P=i*c-n*a,O=r*l-s*o,D=r*c-n*o,L=s*c-n*l,F=h*x-f*w,U=h*S-y*w,N=h*$-_*w,j=f*S-y*x,B=f*$-_*x,Y=y*$-_*S;let G=A*Y-M*B+P*j+O*N-D*U+L*F;return G?(G=1/G,t[0]=(o*Y-l*B+c*j)*G,t[1]=(l*N-a*Y-c*U)*G,t[2]=(a*B-o*N+c*F)*G,t[3]=(s*B-r*Y-n*j)*G,t[4]=(i*Y-s*N+n*U)*G,t[5]=(r*N-i*B-n*F)*G,t[6]=(x*L-S*D+$*O)*G,t[7]=(S*P-w*L-$*M)*G,t[8]=(w*D-x*P+$*A)*G,t):null}function oGe(t,e,i){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/i,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function lGe(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function cGe(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2)}function uGe(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t}function T2e(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t}function hGe(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t}function dGe(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t[6]=e[6]+i[6]*r,t[7]=e[7]+i[7]*r,t[8]=e[8]+i[8]*r,t}function pGe(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function fGe(t,e){const i=t[0],r=t[1],s=t[2],n=t[3],a=t[4],o=t[5],l=t[6],c=t[7],h=t[8],f=e[0],y=e[1],_=e[2],w=e[3],x=e[4],S=e[5],$=e[6],A=e[7],M=e[8],P=nn();return Math.abs(i-f)<=P*Math.max(1,Math.abs(i),Math.abs(f))&&Math.abs(r-y)<=P*Math.max(1,Math.abs(r),Math.abs(y))&&Math.abs(s-_)<=P*Math.max(1,Math.abs(s),Math.abs(_))&&Math.abs(n-w)<=P*Math.max(1,Math.abs(n),Math.abs(w))&&Math.abs(a-x)<=P*Math.max(1,Math.abs(a),Math.abs(x))&&Math.abs(o-S)<=P*Math.max(1,Math.abs(o),Math.abs(S))&&Math.abs(l-$)<=P*Math.max(1,Math.abs(l),Math.abs($))&&Math.abs(c-A)<=P*Math.max(1,Math.abs(c),Math.abs(A))&&Math.abs(h-M)<=P*Math.max(1,Math.abs(h),Math.abs(M))}function mGe(t){const e=nn(),i=t[0],r=t[1],s=t[2],n=t[3],a=t[4],o=t[5],l=t[6],c=t[7],h=t[8];return Math.abs(1-(i*i+n*n+l*l))<=e&&Math.abs(1-(r*r+a*a+c*c))<=e&&Math.abs(1-(s*s+o*o+h*h))<=e}const gGe=gC,yGe=T2e;Object.freeze(Object.defineProperty({__proto__:null,add:uGe,adjoint:tGe,copy:eGe,determinant:Kk,equals:fGe,exactEquals:pGe,frob:cGe,fromMat2d:aGe,fromMat4:jv,fromQuat:kR,fromRotation:sGe,fromScaling:nGe,fromTranslation:rGe,identity:vU,invert:i2,isOrthoNormal:mGe,mul:gGe,multiply:gC,multiplyScalar:hGe,multiplyScalarAndAdd:dGe,normalFromMat4:S2e,normalFromMat4Legacy:x2e,projection:oGe,rotate:bU,scale:KD,scaleByVec2:iGe,set:B_,str:lGe,sub:yGe,subtract:T2e,translate:yC,transpose:qv},Symbol.toStringTag,{value:"Module"}));function Ir(){return[1,0,0,0,1,0,0,0,1]}function $2e(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]]}function C2e(t,e,i,r,s,n,a,o,l){return[t,e,i,r,s,n,a,o,l]}const r2=Ir();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:r2,clone:$2e,create:Ir,fromValues:C2e},Symbol.toStringTag,{value:"Module"}));const rS=Ir();function _Ge(t,e,i){const[r,s]=t,[n,a]=e,[o,l]=i;B_(rS,r,n,o,s,a,l,1,1,1);const c=Kk(rS),h=4*c/(Mu(t,e)+Mu(e,i)+Mu(i,t));if(!isFinite(h)||Math.abs(h)<1e-8)return null;const f=r**2+s**2,y=n**2+a**2,_=o**2+l**2;B_(rS,f,y,_,s,a,l,1,1,1);const w=Kk(rS);return B_(rS,f,y,_,r,n,o,1,1,1),[w/c*.5,Kk(rS)/c*-.5]}function M2e(t,e){const[i,r]=e.c,s=_Ge(t,r,i),n=s==null,a=s??Og([],t,i,.5),[o,l]=t,[c,h]=r,[f,y]=i,[_,w]=a,x=o-_,S=l-w,$=Math.sqrt(x*x+S*S),A=bw(l-w,o-_),M=bw(h-w,c-_);let P=bw(y-w,f-_);return(M-A)*(P-M)<0&&(P+=2*Math.sign(A-P)*Math.PI),new w2e(_,w,$,A,P,n)}function a6t(t,e,i){const r=Jk(t,i/2),s=Jk(t,i),n=Jk(t,(i+1)/2);return[{c:[s,r]},{c:[[...e.c[0]],n]}]}function o6t(t,e){const[i]=e.c,{cx:r,cy:s,thetaStart:n,thetaEnd:a,radius:o,isInvalid:l}=M2e(t,e);return{a:[i,[r,s],Math.abs(a-n)<Math.PI?1:0,n>a?1:0,l?n:0,o,l?0:1]}}function l6t(t){return"curveRings"in t&&!!t.curveRings?.length||"curvePaths"in t&&!!t.curvePaths?.length}function iee(t){return"b"in t}function ree(t){return"c"in t}function wU(t){return Array.isArray(t)}function c6t(t){return"a"in t}function E2e(t){return"a"in t&&t.a.length===4}function vGe(t){return"a"in t&&t.a.length===7}function W9(t){return wU(t)?t:iee(t)?t.b[0]:ree(t)?t.c[0]:t.a[0]}function bGe(t){if(iee(t)){const[e,i,r]=t.b;return{b:[[...e],[...i],[...r]]}}if(ree(t)){const[e,i]=t.c;return{c:[[...e],[...i]]}}if(wU(t))return[...t];if(E2e(t)){const[e,i,r,s]=t.a;return{a:[[...e],[...i],r,s]}}if(vGe(t)){const[e,i,r,s,n,a,o]=t.a;return{a:[[...e],[...i],r,s,n,a,o]}}return t}function wGe(t,e){const[i,r,s,n]=e.a,[a,o]=t,[l,c]=i,[h,f]=r,y=a-h,_=o-f,w=Math.sqrt(y*y+_*_),x=l-h,S=c-f,$=Math.sqrt(x*x+S*S),A=w===0||$===0||!MK(w,$),M=w,[P,O]=_2e(bw(o-f,a-h),Math.atan2(c-f,l-h),s,n);return new w2e(h,f,M,P,O,A)}function u6t(t,e,i){const{cx:r,cy:s,thetaStart:n,thetaEnd:a}=t,[o,l,c,h]=e.a,f=n*(1-i)+a*i;return[{a:[Jk(t,i),[r,s],Math.abs(f-n)<Math.PI?1:0,h]},{a:[[...o],[r,s],Math.abs(a-f)<Math.PI?1:0,h]}]}let xGe=class{constructor(e,i,r,s,n,a,o,l,c){this.cx=e,this.cy=i,this.a=r,this.b=s,this.cosR=n,this.sinR=a,this.u1=o,this.u2=l,this.isInvalid=c}};function see(t,e){const[i,r,s,n,a,o,l]=e.a,[c,h]=t,[f,y]=i,[_,w]=r,x=o*l,S=Math.cos(a),$=Math.sin(a),[A,M]=_2e(bw(1/x*(h-w)*S-1/x*(c-_)*$,1/o*(h-w)*$+1/o*(c-_)*S),Math.atan2(1/x*(y-w)*S-1/x*(f-_)*$,1/o*(y-w)*$+1/o*(f-_)*S),s,n);return new xGe(_,w,o,x,S,$,A,M,o===0||x===0)}function zR(t,e){const{a:i,b:r,cosR:s,sinR:n,cx:a,cy:o}=t,l=Math.cos(e),c=Math.sin(e);return[i*l*s-r*c*n+a,i*l*n+r*c*s+o]}function oT(t,e){const{u1:i,u2:r}=t;return zR(t,i*(1-e)+r*e)}function d6t(t,e,i){if(i<0||i>1)return[];if(i===0||i===1)return[bGe(e)];const[r,[s,n],a,o,l,c,h]=e.a,{u1:f,u2:y}=t,_=f*(1-i)+y*i;return[{a:[[...oT(t,i)],[s,n],Math.abs(_-f)<Math.PI?1:0,o,l,c,h]},{a:[[...r],[s,n],Math.abs(y-_)<Math.PI?1:0,o,l,c,h]}]}function p6t(t,e){const{a:i,b:r,cosR:s,sinR:n,u1:a,u2:o}=t,l=Math.PI/6,c=v2e(e,[1*l,2*l,4*l,5*l,7*l,8*l,10*l,11*l],x=>{const S=Math.cos(x),$=Math.sin(x),[A,M]=zR(t,x);return[A,M,-i*s*$-r*n*S,-i*n*$+r*s*S,-i*s*S+r*n*$,-i*n*S-r*s*$]}),h=_U(a,o),f=new Set(c.map(x=>JD(h,x)).filter(x=>x>h.min&&x<h.max));f.add(a),f.add(o);let y,_,w=1/0;for(const x of f){const S=zR(t,x),[$,A]=S,M=e[0]-$,P=e[1]-A,O=M*M+P*P;O<w&&(y=(x-a)/(o-a),_=S,w=O)}return{t:y,curvePoint:_,distance:Math.sqrt(w)}}function SGe(t,e,i){const r=see(e,i),{a:s,b:n,u1:a,u2:o,cosR:l,sinR:c,isInvalid:h}=r,f=i.a[0];if($u(t,e),$u(t,f),h)return t;const y=Math.atan2(-n*c,s*l),_=y+Math.PI,w=Math.atan2(n*l,s*c),x=w+Math.PI,S=_U(a,o);for(const $ of[y,_,w,x].map(A=>JD(S,A)))$>S.min&&$<S.max&&$u(t,zR(r,$));return t}function f6t(t,e,i){const[r,s,n,a,o,l,c]=e.a,h=see(t,e),{u1:f,u2:y,isInvalid:_}=h,w=y-f;if(_)return Math.sqrt(Mu(t,r));const x=14,S=[0,0];let $=0,A=[oT(h,0),oT(h,.25),oT(h,.5),oT(h,.75),oT(h,1)];for(let M=0;M<x;M++){const P=A.length-1,O=w/(2*P),D=[];for(let F=0;F<P;F++)D.push(A[F]),D.push(zR(h,f+(2*F+1)*O));D.push(A[A.length-1]),A=D,$=0;let L=0;for(let F=1;F<A.length;F++){const U=A[F-1],N=A[F];if($+=Math.sqrt(Mu(U,N)),F>1){const j=A[F-2],B=Zqe(S,j,U,s,N);L+=B?Math.sqrt(Mu(U,B)):Math.abs(N[0]-U[0])+Math.abs(N[1]-U[1])}else L+=$}if(L-$<i)return $}return $}const Que=Ir(),s5=Ir(),Xue=Ir(),p0=Ir();function m6t(t,e,i){const[r,s,n,a,o,l,c]=e.a,h=see(t,e),{cosR:f,sinR:y,a:_,b:w,cx:x,cy:S}=h,$=Xk([0,0],r,i),A=Xk([0,0],s,i),M=i[0]*i[4]<0?1-a:a;{const P=_*_*y*y+w*w*f*f,O=2*(w*w-_*_)*y*f,D=_*_*f*f+w*w*y*y,L=-2*P*x-O*S,F=-O*x-2*D*S;B_(Que,P,O/2,L/2,O/2,D,F/2,L/2,F/2,P*x*x+O*x*S+D*S*S-_*_*w*w)}if(i2(s5,i),s5==null){const P=Xk([0,0],t,i);return{a:[$,A,n,a,bw($[1],$[0]),Math.sqrt(Mu($,P))/2,0]}}qv(Xue,s5),gC(p0,gC(p0,Xue,Que),s5);{const P=p0[0],O=2*p0[1],D=p0[4],L=2*p0[2],F=2*p0[5],U=O*O-4*P*D,N=2*(P*F*F+D*L*L-O*L*F+U*p0[8]),j=Math.sqrt((P-D)**2+O*O),B=-Math.sqrt(N*(P+D+j))/U,Y=-Math.sqrt(N*(P+D-j))/U;return{a:[$,A,n,M,.5*bw(-O,D-P),B,Y/B]}}}function TGe(t,e,i){if(wU(i))return $u(t,e),$u(t,i),t;if(iee(i))return Jqe(t,e,i);if(ree(i)){const r=M2e(e,i);return Yue(t,r)}if(E2e(i)){const r=wGe(e,i);return Yue(t,r)}return SGe(t,e,i)}function A2e(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function O2e(t){return t.points!==void 0}function P2e(t){return t.x!==void 0&&t.y!==void 0}function R2e(t){return t.paths!==void 0}function D2e(t){return t.rings!==void 0}function I2e(t){function e(i,r){return i==null?r:r==null?i:t(i,r)}return e}const $_=I2e(Math.min),C_=I2e(Math.max);function g6t(t,e){return R2e(e)?_C(t,e.curvePaths??e.paths,!1,!1)??t:D2e(e)?_C(t,e.curveRings??e.rings,!1,!1)??t:O2e(e)?nee(t,e.points,!1,!1,!1,!1):A2e(e)?L2e(t,e):(P2e(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.x,t[3]=e.y),t)}function y6t(t){let e,i,r,s;for(t.reset(),e=r=1/0,i=s=-1/0;t.nextPath();){const n=$Ge(t);e=Math.min(n[0],e),r=Math.min(n[1],r),i=Math.max(n[2],i),s=Math.max(n[3],s)}return Pi([e,r,i,s])}function $Ge(t){let e,i,r,s;for(e=r=1/0,i=s=-1/0;t.nextPoint();)e=Math.min(t.x,e),r=Math.min(t.y,r),i=Math.max(t.x,i),s=Math.max(t.y,s);return Pi([e,r,i,s])}function _6t(t,e){return R2e(e)?_C(t,e.curvePaths??e.paths,!0,!1)??t:D2e(e)?_C(t,e.curveRings??e.rings,!0,!1)??t:O2e(e)?nee(t,e.points,!0,!1,!0,!1):A2e(e)?L2e(t,e,!0,!1,!0,!1):(P2e(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.x,t[4]=e.y,t[5]=e.z),t)}function _C(t,e,i,r){const s=i?3:2;if(!e.length||!e[0].length)return null;let n,a,o,l,[c,h]=W9(e[0][0]),f=c,y=h;for(let _=0;_<e.length;_++){const w=e[_];for(let x=0;x<w.length;x++){const S=W9(w[x]),[$,A]=S;if(c=$_(c,$),h=$_(h,A),f=C_(f,$),y=C_(y,A),i&&S.length>2){const D=S[2];n=$_(n,D),a=C_(a,D)}if(r&&S.length>s){const D=S[s];o=$_(n,D),l=C_(a,D)}const M=w[x];if(wU(M)||x<1)continue;const P=W9(w[x-1]),O=pU(c,h,f,y);[c,h,f,y]=TGe(O,P,M)}}return i?r?(t[0]=c,t[1]=h,t[2]=n,t[3]=o,t[4]=f,t[5]=y,t[6]=a,t[7]=l,t.length=8,t):(t[0]=c,t[1]=h,t[2]=n,t[3]=f,t[4]=y,t[5]=a,t.length=6,t):r?(t[0]=c,t[1]=h,t[2]=o,t[3]=f,t[4]=y,t[5]=l,t.length=6,t):(t[0]=c,t[1]=h,t[2]=f,t[3]=y,t.length=4,t)}function L2e(t,e,i,r,s,n){const a=e.xmin,o=e.xmax,l=e.ymin,c=e.ymax;let h=e.zmin,f=e.zmax,y=e.mmin,_=e.mmax;return s?(h=h||0,f=f||0,n?(y=y||0,_=_||0,t[0]=a,t[1]=l,t[2]=h,t[3]=y,t[4]=o,t[5]=c,t[6]=f,t[7]=_,t):(t[0]=a,t[1]=l,t[2]=h,t[3]=o,t[4]=c,t[5]=f,t)):n?(y=y||0,_=_||0,t[0]=a,t[1]=l,t[2]=y,t[3]=o,t[4]=c,t[5]=_,t):(t[0]=a,t[1]=l,t[2]=o,t[3]=c,t)}function nee(t,e,i,r,s,n){const a=i?3:2,o=r&&n,l=i&&s;if(!e.length||!e[0].length)return null;let c,h,f,y,[_,w]=e[0],[x,S]=e[0];for(let $=0;$<e.length;$++){const A=e[$],[M,P]=A;if(_=$_(_,M),w=$_(w,P),x=C_(x,M),S=C_(S,P),l&&A.length>2){const O=A[2];c=$_(c,O),h=C_(h,O)}if(o&&A.length>a){const O=A[a];f=$_(c,O),y=C_(h,O)}}return s?(c=c||0,h=h||0,n?(f=f||0,y=y||0,t[0]=_,t[1]=w,t[2]=c,t[3]=f,t[4]=x,t[5]=S,t[6]=h,t[7]=y,t):(t[0]=_,t[1]=w,t[2]=c,t[3]=x,t[4]=S,t[5]=h,t)):n?(f=f||0,y=y||0,t[0]=_,t[1]=w,t[2]=f,t[3]=x,t[4]=S,t[5]=y,t):(t[0]=_,t[1]=w,t[2]=x,t[3]=S,t)}function CGe(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function MGe(t){return t.points!==void 0}function EGe(t){return t.x!==void 0&&t.y!==void 0}function AGe(t){return t.paths!==void 0}function OGe(t){return t.rings!==void 0}const aee=[];function k2e(t,e,i,r){return{xmin:t,ymin:e,xmax:i,ymax:r}}function z2e(t,e,i,r,s,n){return{xmin:t,ymin:e,zmin:i,xmax:r,ymax:s,zmax:n}}function F2e(t,e,i,r,s,n){return{xmin:t,ymin:e,mmin:i,xmax:r,ymax:s,mmax:n}}function N2e(t,e,i,r,s,n,a,o){return{xmin:t,ymin:e,zmin:i,mmin:r,xmax:s,ymax:n,zmax:a,mmax:o}}function oee(t,e=!1,i=!1){return e?i?N2e(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]):z2e(t[0],t[1],t[2],t[3],t[4],t[5]):i?F2e(t[0],t[1],t[2],t[3],t[4],t[5]):k2e(t[0],t[1],t[2],t[3])}function v6t(t){return t?CGe(t)?t:EGe(t)?PGe(t):OGe(t)?U2e(t):AGe(t)?B2e(t):MGe(t)?V2e(t):null:null}function V2e(t){const{hasZ:e,hasM:i,points:r}=t,s=nee(aee,r,e??!1,i??!1,e??!1,i??!1);return s?oee(s,e,i):null}function PGe(t){const{x:e,y:i,z:r,m:s}=t,n=s!=null;return r!=null?n?N2e(e,i,r,s,e,i,r,s):z2e(e,i,r,e,i,r):n?F2e(e,i,s,e,i,s):k2e(e,i,e,i)}function U2e(t){const{hasZ:e,hasM:i,rings:r,curveRings:s}=t,n=_C(aee,s??r,e??!1,i??!1);return n?oee(n,e,i):null}function B2e(t){const{hasZ:e,hasM:i,paths:r,curvePaths:s}=t,n=_C(aee,s??r,e??!1,i??!1);return n?oee(n,e,i):null}function vC(t,e,i=!1){let{hasM:r,hasZ:s}=t;Array.isArray(e)?e.length!==4||r||s?e.length===3&&i&&!r?(s=!0,r=!1):e.length===3&&r&&s&&(r=!1,s=!1):(r=!0,s=!0):(s=!s&&e.hasZ&&(!r||e.hasM),r=!r&&e.hasM&&(!s||e.hasZ)),t.hasZ=s,t.hasM=r}var IW;function RGe(t){if(!t)return;let{points:e,hasM:i,hasZ:r,spatialReference:s}=t;switch(e??=[],e?.at(0)?.length){case 4:r??=!0,i??=!0;break;case 3:r??=i!==!0,i??=!r;break;default:r??=!1,i??=!1}return s??=Ie.WGS84,{...t,hasM:i,hasZ:r,points:e,spatialReference:s}}let Po=IW=class extends so{constructor(t){super(RGe(t)),this.points=[],this.type="multipoint"}get cache(){return this.commitProperty("points"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const t=V2e(this);return t?new Bt({...t,spatialReference:this.spatialReference}):null}writePoints(t,e){e.points=Te(this.points)}clone(){const{points:t,spatialReference:e,hasM:i,hasZ:r}=this;return new IW({points:Te(t),spatialReference:e.clone(),hasM:i,hasZ:r})}addPoint(t){return vC(this,t),Array.isArray(t)?this.points.push(t):this.points.push(t.toArray()),this.notifyChange("points"),this}getPoint(t){if(!this._validateInputs(t))return null;const e=this.points[t],i={x:e[0],y:e[1],spatialReference:this.spatialReference};let r=2;return this.hasZ&&(i.z=e[2],r=3),this.hasM&&(i.m=e[r]),new Qe(i)}removePoint(t){if(!this._validateInputs(t))return null;const e=new Qe(this.points.splice(t,1)[0],this.spatialReference);return this.notifyChange("points"),e}setPoint(t,e){return this._validateInputs(t)?(vC(this,e),Array.isArray(e)||(e=e.toArray()),this.points[t]=e,this.notifyChange("points"),this):this}toJSON(t){return this.write({},t)}_validateInputs(t){return t!=null&&t>=0&&t<this.points.length}};d([m({readOnly:!0})],Po.prototype,"cache",null),d([m({readOnly:!0})],Po.prototype,"extent",null),d([m({type:[[Number]],json:{write:{isRequired:!0}}})],Po.prototype,"points",void 0),d([Ht("points")],Po.prototype,"writePoints",null),Po=IW=d([k("esri.geometry.Multipoint")],Po),Po.prototype.toJSON.isDefaultToJSON=!0;function b6t(t){const e=[];for(t.reset();t.nextPath();){const i=[];for(;t.nextPoint();)i.push([t.x,t.y]);e.push(i)}return t.reset(),e}function DGe(t){const e=[];for(;t.nextPoint();)e.push([t.x,t.y]);return t.seekPathStart(),e}function Jue(t){if(!t)return null;if(Array.isArray(t))return t;const e=t.hasZ,i=t.hasM;if(t.type==="point")return i&&e?[t.x,t.y,t.z,t.m]:e?[t.x,t.y,t.z]:i?[t.x,t.y,t.m]:[t.x,t.y];if(t.type==="polygon")return t.rings.slice();if(t.type==="polyline")return t.paths.slice();if(t.type==="multipoint")return t.points.map(r=>[r]);if(t.type==="extent"){const r=t.clone().normalize();if(!r)return null;let s=!1,n=!1;return r.forEach(a=>{a.hasZ&&(s=!0),a.hasM&&(n=!0)}),r.map(a=>{const o=[[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]];if(s&&a.hasZ){const l=.5*(a.zmax-a.zmin);for(let c=0;c<o.length;c++)o[c].push(l)}if(n&&a.hasM){const l=.5*(a.mmax-a.mmin);for(let c=0;c<o.length;c++)o[c].push(l)}return o})}return null}function xU(t,e){const i=e[0]-t[0],r=e[1]-t[1];if(t.length>2&&e.length>2){const s=t[2]-e[2];return Math.sqrt(i*i+r*r+s*s)}return Math.sqrt(i*i+r*r)}function j2e(t,e,i){const r=t[0]+i*(e[0]-t[0]),s=t[1]+i*(e[1]-t[1]);return t.length>2&&e.length>2?[r,s,t[2]+i*(e[2]-t[2])]:[r,s]}function w6t(t,e,i,r){const[s,n]=e,[a,o]=i,[l,c]=r,h=l-a,f=c-o,y=h*h+f*f,_=(s-a)*h+(n-o)*f,w=Math.min(1,Math.max(0,_/y));return t[0]=a+h*w,t[1]=o+f*w,t}function IGe(t,e,i,r,s,n){let a=i,o=r,l=s-a,c=n-o;if(l!==0||c!==0){const h=((t-a)*l+(e-o)*c)/(l*l+c*c);h>1?(a=s,o=n):h>0&&(a+=l*h,o+=c*h)}return l=t-a,c=e-o,l*l+c*c}function q2e(t,e){return j2e(t,e,.5)}function G2e(t){const e=t.length;let i=0;for(let r=0;r<e-1;++r)i+=xU(t[r],t[r+1]);return i}function H2e(t,e){if(e<=0)return t[0];const i=t.length;let r=0;for(let s=0;s<i-1;++s){const n=xU(t[s],t[s+1]);if(e-r<n){const a=(e-r)/n;return j2e(t[s],t[s+1],a)}r+=n}return t[i-1]}function SU(t,e=0,i=1){let r=0;const s=t.length;let n=t[0];for(let a=1;a<s;a++){const o=t[a];r+=(o[e]-n[e])*(o[i]+n[i]),n=o}if(W2e(t)){const a=t[0];r+=(a[e]-n[e])*(a[i]+n[i])}return r>=0}function W2e(t){const e=t.length;return e>0&&!sy(t[0],t[e-1])}function x6t(t){"rings"in t&&(Z2e(t),LGe(t))}function Z2e(t){if("rings"in t)for(const e of t.rings)W2e(e)&&e.push(e[0].slice())}function LGe(t){if(!("rings"in t)||t.rings.length===0||SU(t.rings[0]))return!1;for(const e of t.rings)e.reverse();return!0}function S6t(t){return t.type!=="polygon"&&t.type!=="polyline"||kGe(t.type==="polygon"?t.rings:t.paths,t.spatialReference),t}function kGe(t,e){const i=Ru(e);if(!i)return;const r=i.valid[0],s=i.valid[1],n=s-r;for(const a of t){let o=1/0,l=-1/0;for(const h of a){const f=Y2e(h[0],r,s);o=Math.min(o,f),l=Math.max(l,f),h[0]=f}const c=l-o;n-c<c&&a.forEach(h=>{h[0]<0&&(h[0]+=n)})}}function Y2e(t,e,i){const r=i-e;return t<e?i-(e-t)%r:t>i?e+(t-e)%r:t}function T6t(t,e){if(t===e)return!0;if(t.type!==e.type)return!1;if(t.type==="point"||t.type==="mesh"||t.type==="extent")return!0;if(t.type==="multipoint")return t.points.length===e.points.length;const[i,r]=t.type==="polyline"?[t.paths,e.paths]:[t.rings,e.rings];return i.length===r.length&&i.every((s,n)=>s.length===r[n].length)}function $6t(t){return t?t.hasZ?[t.xmax-t.xmin/2,t.ymax-t.ymin/2,t.zmax-t.zmin/2]:[t.xmax-t.xmin/2,t.ymax-t.ymin/2]:null}function zGe(t){return X2e(t.rings,t.hasZ??!1)}function Q2e(t){const e=zGe(t);if(!e)return null;const{hasZ:i,spatialReference:r}=t,[s,n,a]=e;return isNaN(s)||isNaN(n)||i&&isNaN(a)?null:{x:s,y:n,z:i?a:void 0,spatialReference:r}}function X2e(t,e){if(!t?.length)return null;const i=[],r=[],s=e?[1/0,-1/0,1/0,-1/0,1/0,-1/0]:[1/0,-1/0,1/0,-1/0];for(let n=0,a=t.length;n<a;n++){const o=J2e(t[n],e,s);o&&r.push(o)}if(r.sort((n,a)=>{let o=n[2]-a[2];return o===0&&e&&(o=n[4]-a[4]),o}),r.length&&(i[0]=r[0][0],i[1]=r[0][1],e&&(i[2]=r[0][3]),(i[0]<s[0]||i[0]>s[1]||i[1]<s[2]||i[1]>s[3]||e&&(i[2]<s[4]||i[2]>s[5]))&&(i.length=0)),!i.length){const n=t[0]&&t[0].length?FGe(t[0],e):null;if(!n)return null;i[0]=n[0],i[1]=n[1],e&&n.length>2&&(i[2]=n[2])}return i}function J2e(t,e,i){let r=0,s=0,n=0,a=0,o=0;const l=t.length?t[0][0]:0,c=t.length?t[0][1]:0,h=t.length&&e?t[0][2]:0;for(let y=0;y<t.length;y++){const _=t[y],w=t[(y+1)%t.length],[x,S,$]=_,A=x-l,M=S-c,[P,O,D]=w,L=P-l,F=O-c,U=A*F-L*M;if(a+=U,r+=(A+L)*U,s+=(M+F)*U,e&&_.length>2&&w.length>2){const N=$-h,j=D-h,B=A*j-L*N;n+=(N+j)*B,o+=B}x<i[0]&&(i[0]=x),x>i[1]&&(i[1]=x),S<i[2]&&(i[2]=S),S>i[3]&&(i[3]=S),e&&($<i[4]&&(i[4]=$),$>i[5]&&(i[5]=$))}if(a>0&&(a*=-1),o>0&&(o*=-1),!a)return null;a*=.5,o*=.5;const f=[r/(6*a)+l,s/(6*a)+c,a];return e&&(i[4]===i[5]||o===0?(f[3]=(i[4]+i[5])/2,f[4]=0):(f[3]=n/(6*o)+h,f[4]=o)),f}function C6t(t,e){let i=0,r=0,s=0;t.nextPoint();const n=t.pathSize?t.x:0,a=t.pathSize?t.y:0;for(let o=0;o<t.pathSize;o++){t.seekInPath(o);const l=[t.x,t.y];t.seekInPath((o+1)%t.pathSize);const c=[t.x,t.y],[h,f]=l,y=h-n,_=f-a,[w,x]=c,S=w-n,$=x-a,A=y*$-S*_;s+=A,i+=(y+S)*A,r+=(_+$)*A,h<e[0]&&(e[0]=h),h>e[1]&&(e[1]=h),f<e[2]&&(e[2]=f),f>e[3]&&(e[3]=f)}return s>0&&(s*=-1),s?(s*=.5,[i/(6*s)+n,r/(6*s)+a,s]):null}function FGe(t,e){const i=e?[0,0,0]:[0,0],r=e?[0,0,0]:[0,0];let s=0,n=0,a=0,o=0;for(let l=0,c=t.length;l<c-1;l++){const h=t[l],f=t[l+1];if(h&&f){i[0]=h[0],i[1]=h[1],r[0]=f[0],r[1]=f[1],e&&h.length>2&&f.length>2&&(i[2]=h[2],r[2]=f[2]);const y=xU(i,r);if(y){s+=y;const _=q2e(h,f);n+=y*_[0],a+=y*_[1],e&&_.length>2&&(o+=y*_[2])}}}return s>0?e?[n/s,a/s,o/s]:[n/s,a/s]:t.length?t[0]:null}function NGe(t){const{hasZ:e,totalSize:i}=t;if(i===0)return null;const r=[],s=[],n=e?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY];for(t.reset();t.nextPath();){const a=J2e(DGe(t),t.hasZ,n);a&&s.push(a)}if(s.sort((a,o)=>{let l=a[2]-o[2];return l===0&&e&&(l=a[4]-o[4]),l}),s.length&&(r[0]=s[0][0],r[1]=s[0][1],e&&(r[2]=s[0][3]),(r[0]<n[0]||r[0]>n[1]||r[1]<n[2]||r[1]>n[3]||e&&(r[2]<n[4]||r[2]>n[5]))&&(r.length=0)),!r.length){t.reset(),t.nextPath();const a=t.pathSize?VGe(t):null;if(!a)return null;r[0]=a[0],r[1]=a[1],e&&a.length>2&&(r[2]=a[2])}return r}function VGe(t){const{hasZ:e}=t,i=e?[0,0,0]:[0,0],r=e?[0,0,0]:[0,0];let s=0,n=0,a=0,o=0;if(t.nextPoint()){let l=t.x,c=t.y,h=t.z;for(;t.nextPoint();){const f=t.x,y=t.y,_=t.z;i[0]=l,i[1]=c,r[0]=f,r[1]=y,e&&(i[2]=h,r[2]=_);const w=xU(i,r);if(w){s+=w;const x=q2e(i,r);n+=w*x[0],a+=w*x[1],e&&x.length>2&&(o+=w*x[2])}l=f,c=y,h=_}}return s>0?e?[n/s,a/s,o/s]:[n/s,a/s]:t.pathSize?(t.seekPathStart(),t.nextPoint(),[t.x,t.y]):null}const UGe=1e-6;function M6t(t){let e=0;for(t.reset();t.nextPath();)e+=t.getCurrentRingArea();if(e<UGe){const s=NGe(t);return s?[s[0],s[1]]:null}const i=[0,0];if(t.reset(),!t.nextPath()||!t.nextPoint())return null;const r=[t.x,t.y];for(t.reset();t.nextPath();)jGe(i,r,t);return i[0]*=1/e,i[1]*=1/e,i[0]+=r[0],i[1]+=r[1],i}const BGe=1/3;function jGe(t,e,i){if(!t||!i||i.pathSize<3)return null;i.nextPoint();const r=i.x,s=i.y;i.nextPoint();let n,a=i.x-r,o=i.y-s,l=0,c=0;for(;i.nextPoint();)l=i.x-r,c=i.y-s,n=.5*BGe*(l*o-c*a),t[0]+=n*(a+l),t[1]+=n*(o+c),a=l,o=c;const h=i.getCurrentRingArea(),f=[r,s];return f[0]-=e[0],f[1]-=e[1],f[0]*=h,f[1]*=h,t[0]+=f[0],t[1]+=f[1],t}var ez;function Kue(t){return!Array.isArray(t[0])}function qGe(t){return typeof t[0]?.[0]=="number"}function GGe(t){if(!t)return;let{rings:e,hasM:i,hasZ:r,spatialReference:s}=t;switch(e??=[],qGe(e)&&(e=[e]),e[0]?.[0]?.length){case 4:r??=!0,i??=!0;break;case 3:r??=i!==!0,i??=!r;break;default:r??=!1,i??=!1}return s??=Ie.WGS84,{...t,hasM:i,hasZ:r,rings:e,spatialReference:s}}let os=ez=class extends so{static fromExtent(t){const e=t.clone().normalize(),{spatialReference:i}=t;let r=!1,s=!1;for(const a of e)a.hasZ&&(r=!0),a.hasM&&(s=!0);const n={rings:e.map(a=>{const o=[[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]];if(r&&a.hasZ){const l=a.zmin+.5*(a.zmax-a.zmin);for(let c=0;c<o.length;c++)o[c].push(l)}if(s&&a.hasM){const l=a.mmin+.5*(a.mmax-a.mmin);for(let c=0;c<o.length;c++)o[c].push(l)}return o}),spatialReference:i};return r&&(n.hasZ=!0),s&&(n.hasM=!0),new ez(n)}constructor(t){super(GGe(t)),this.curveRings=void 0,this.rings=[],this.type="polygon"}get cache(){return this.commitProperty("curveRings"),this.commitProperty("hasM"),this.commitProperty("hasZ"),this.commitProperty("rings"),this.commitProperty("spatialReference"),{}}get centroid(){XH(fe.getLogger(this),"centroid",{replacement:"Please use centroidOperator.execute() instead.",version:"4.34",warnOnce:!0});const t=Q2e(this);return t?Qe.fromJSON(t):null}writeCurveRings(t,e){e.curveRings=Te(t)}get extent(){const t=U2e(this),{spatialReference:e}=this;return t?new Bt({...t,spatialReference:e}):null}get isSelfIntersecting(){return XH(fe.getLogger(this),"isSelfIntersecting",{replacement:"Please use simplifyOperator.isSimple() instead.",version:"4.33",warnOnce:!0}),fqe(this.rings)}writeRings(t,e){e.rings=Te(this.rings)}addRing(t){if(!t)return;const e=this.rings,i=e.length;if(Kue(t)){const r=[];for(let s=0,n=t.length;s<n;s++)r[s]=t[s].toArray();e[i]=r}else e[i]=t.slice();return this.notifyChange("rings"),this}clone(){const t=new ez;return t.spatialReference=this.spatialReference,t.rings=Te(this.rings),t.curveRings=Te(this.curveRings),t.hasZ=this.hasZ,t.hasM=this.hasM,t}equals(t){if(this===t)return!0;if(t==null)return!1;const e=this.spatialReference,i=t.spatialReference;if(e!=null!=(i!=null)||e!=null&&i!=null&&!e.equals(i)||this.rings.length!==t.rings.length)return!1;const r=([s,n,a,o],[l,c,h,f])=>s===l&&n===c&&(a==null&&h==null||a===h)&&(o==null&&f==null||o===f);for(let s=0;s<this.rings.length;s++){const n=this.rings[s],a=t.rings[s];if(!sy(n,a,r))return!1}return!0}contains(t){if(!t)return!1;const e=QD(t,this.spatialReference);return sqe(this,e??t)}isClockwise(t){const e=Kue(t)?t.map(i=>this.hasZ?this.hasM?[i.x,i.y,i.z,i.m]:[i.x,i.y,i.z]:[i.x,i.y]):t;return SU(e)}getPoint(t,e){if(!this._validateInputs(t,e))return null;const i=this.rings[t][e],r=this.hasZ,s=this.hasM;return r&&!s?new Qe(i[0],i[1],i[2],void 0,this.spatialReference):s&&!r?new Qe(i[0],i[1],void 0,i[2],this.spatialReference):r&&s?new Qe(i[0],i[1],i[2],i[3],this.spatialReference):new Qe(i[0],i[1],this.spatialReference)}insertPoint(t,e,i){return this._validateInputs(t,e,!0)?(vC(this,i),Array.isArray(i)||(i=i.toArray()),this.rings[t].splice(e,0,i),this.notifyChange("rings"),this):this}removePoint(t,e){if(!this._validateInputs(t,e))return null;const i=new Qe(this.rings[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("rings"),i}removeRing(t){if(!this._validateInputs(t,null))return null;const e=this.rings.splice(t,1)[0],i=this.spatialReference,r=e.map(s=>new Qe(s,i));return this.notifyChange("rings"),r}setPoint(t,e,i){return this._validateInputs(t,e)?(vC(this,i),Array.isArray(i)||(i=i.toArray()),this.rings[t][e]=i,this.notifyChange("rings"),this):this}_validateInputs(t,e,i=!1){if(t==null||t<0||t>=this.rings.length)return!1;if(e!=null){const r=this.rings[t];if(i&&(e<0||e>r.length)||!i&&(e<0||e>=r.length))return!1}return!0}toJSON(t){return this.write({},t)}};d([m({readOnly:!0})],os.prototype,"cache",null),d([m({readOnly:!0})],os.prototype,"centroid",null),d([m({json:{write:!0,origins:{"portal-item":{write:!1},"web-map":{write:!1},"web-scene":{write:!1}}}})],os.prototype,"curveRings",void 0),d([Ht("curveRings")],os.prototype,"writeCurveRings",null),d([m({readOnly:!0})],os.prototype,"extent",null),d([m({readOnly:!0})],os.prototype,"isSelfIntersecting",null),d([m({type:[[[Number]]],json:{write:{isRequired:!0}}})],os.prototype,"rings",void 0),d([Ht("rings")],os.prototype,"writeRings",null),os=ez=d([k("esri.geometry.Polygon")],os),os.prototype.toJSON.isDefaultToJSON=!0;var LW;function HGe(t){return!Array.isArray(t[0])}function WGe(t){return typeof t[0]?.[0]=="number"}function ZGe(t){if(!t)return;let{paths:e,hasM:i,hasZ:r,spatialReference:s}=t;switch(e??=[],WGe(e)&&(e=[e]),e[0]?.[0]?.length){case 4:r??=!0,i??=!0;break;case 3:r??=i!==!0,i??=!r;break;default:r??=!1,i??=!1}return s??=Ie.WGS84,{...t,hasM:i,hasZ:r,paths:e,spatialReference:s}}let Ps=LW=class extends so{constructor(t){super(ZGe(t)),this.curvePaths=void 0,this.paths=[],this.type="polyline"}get cache(){return this.commitProperty("curvePaths"),this.commitProperty("hasM"),this.commitProperty("hasZ"),this.commitProperty("paths"),this.commitProperty("spatialReference"),{}}writeCurvePaths(t,e){e.curvePaths=Te(t)}get extent(){const t=B2e(this),{spatialReference:e}=this;return t?new Bt({...t,spatialReference:e}):null}writePaths(t,e){e.paths=Te(this.paths)}addPath(t){if(!t)return;const e=this.paths,i=e.length;if(HGe(t)){const r=[];for(let s=0,n=t.length;s<n;s++)r[s]=t[s].toArray();e[i]=r}else e[i]=t.slice();return this.notifyChange("paths"),this}clone(){const t=new LW;return t.spatialReference=this.spatialReference,t.paths=Te(this.paths),t.curvePaths=Te(this.curvePaths),t.hasZ=this.hasZ,t.hasM=this.hasM,t}getPoint(t,e){if(!this._validateInputs(t,e))return null;const i=this.paths[t][e],r=this.hasZ,s=this.hasM;return r&&!s?new Qe(i[0],i[1],i[2],void 0,this.spatialReference):s&&!r?new Qe(i[0],i[1],void 0,i[2],this.spatialReference):r&&s?new Qe(i[0],i[1],i[2],i[3],this.spatialReference):new Qe(i[0],i[1],this.spatialReference)}insertPoint(t,e,i){return this._validateInputs(t,e,!0)?(vC(this,i),Array.isArray(i)||(i=i.toArray()),this.paths[t].splice(e,0,i),this.notifyChange("paths"),this):this}removePath(t){if(!this._validateInputs(t,null))return null;const e=this.paths.splice(t,1)[0],i=this.spatialReference,r=e.map(s=>new Qe(s,i));return this.notifyChange("paths"),r}removePoint(t,e){if(!this._validateInputs(t,e))return null;const i=new Qe(this.paths[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("paths"),i}setPoint(t,e,i){return this._validateInputs(t,e)?(vC(this,i),Array.isArray(i)||(i=i.toArray()),this.paths[t][e]=i,this.notifyChange("paths"),this):this}_validateInputs(t,e,i=!1){if(t==null||t<0||t>=this.paths.length)return!1;if(e!=null){const r=this.paths[t];if(i&&(e<0||e>r.length)||!i&&(e<0||e>=r.length))return!1}return!0}toJSON(t){return this.write({},t)}};d([m({readOnly:!0})],Ps.prototype,"cache",null),d([m({json:{write:!0,origins:{"portal-item":{write:!1},"web-map":{write:!1},"web-scene":{write:!1}}}})],Ps.prototype,"curvePaths",void 0),d([Ht("curvePaths")],Ps.prototype,"writeCurvePaths",null),d([m({readOnly:!0})],Ps.prototype,"extent",null),d([m({type:[[[Number]]],json:{write:{isRequired:!0}}})],Ps.prototype,"paths",void 0),d([Ht("paths")],Ps.prototype,"writePaths",null),Ps=LW=d([k("esri.geometry.Polyline")],Ps),Ps.prototype.toJSON.isDefaultToJSON=!0;function K2e(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function lee(t){return t.points!==void 0}function cee(t){return t.x!==void 0&&t.y!==void 0}function uee(t){return t.paths!==void 0||t.curvePaths!==void 0}function TU(t){return t.rings!==void 0||t.curveRings!==void 0}function hy(t){return t==null?null:t instanceof so?t:cee(t)?Qe.fromJSON(t):uee(t)?Ps.fromJSON(t):TU(t)?os.fromJSON(t):lee(t)?Po.fromJSON(t):K2e(t)?Bt.fromJSON(t):null}function e4(t){return t?cee(t)?"esriGeometryPoint":uee(t)?"esriGeometryPolyline":TU(t)?"esriGeometryPolygon":K2e(t)?"esriGeometryEnvelope":lee(t)?"esriGeometryMultipoint":null:null}const YGe={esriGeometryPoint:Qe,esriGeometryPolyline:Ps,esriGeometryPolygon:os,esriGeometryEnvelope:Bt,esriGeometryMultipoint:Po,esriGeometryMultiPatch:os};function QGe(t){return t&&YGe[t]||null}const eSe=cl()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon"}),E6t=cl()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh"}),hee={base:so,key:"type",typeMap:{extent:Bt,multipoint:Po,point:Qe,polyline:Ps,polygon:os}};function A6t(t){return t.type==="point"}function O6t(t){return t.type==="multipoint"}function P6t(t){return t.type==="polygon"}function R6t(t){return t.type==="polyline"}var kW;let V0=kW=class extends ke{constructor(t){super(t),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(t){return(t%=360)<0&&(t+=360),t}clone(){return new kW({rotation:this.rotation,scale:this.scale,targetGeometry:this.targetGeometry!=null?this.targetGeometry.clone():null,camera:this.camera!=null?this.camera.clone():null})}};d([m({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:Z9}}}}})],V0.prototype,"rotation",void 0),d([qr("rotation")],V0.prototype,"castRotation",null),d([m({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:Z9}}}}})],V0.prototype,"scale",void 0),d([m({types:hee,json:{read:hy,write:!0,origins:{"web-scene":{read:hy,write:{overridePolicy:Z9}}}}})],V0.prototype,"targetGeometry",void 0),d([m({type:ol,json:{write:!0,origins:{"web-scene":{write:{isRequired:!0}}}}})],V0.prototype,"camera",void 0),V0=kW=d([k("esri.Viewpoint")],V0);const Yf=V0;function Z9(){return{enabled:!this.camera}}const s2=t=>{const e=t;class i extends e{constructor(){super(...arguments),this._listenersMap=null}clearEvents(){this._listenersMap?.clear(),this._listenersMap=null}destroy(){this.clearEvents()}emit(s,n){let a=this._listenersMap?.get(s);if(!a)return!1;let o=!1;for(const l of a.slice()){const c="deref"in l?l.deref():l;c?c?.call(this,n):o=!0}return o&&(a=a.filter(l=>!("deref"in l)||l.deref()!=null),this._listenersMap.set(s,a)),a.length>0}on(s,n){if(Array.isArray(s)){const o=s.map(l=>this.on(l,n));return qu(o)}if(s.includes(","))throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap??=new Map;const a=this._listenersMap.get(s)||[];return a.push(n),this._listenersMap.set(s,a),ci(()=>{const o=this._listenersMap?.get(s),l=o?.indexOf(n)??-1;l>=0&&o.splice(l,1)})}once(s,n){const a=this.on(s,o=>{a.remove(),("deref"in n?n.deref():n)?.call(null,o)});return a}hasEventListener(s){const n=this._listenersMap?.get(s);return n!=null&&n.length>0}}return i},tSe=s2(class{}),Ey=tSe,Uc=s2(Me);function iSe(t){return(e,i)=>{e[i]=t}}var Hm;let XGe=class{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(e){this.defaultPrevented=!1,this.item=e}},JGe=class{constructor(e,i,r,s,n){this.target=e,this.added=i,this.removed=r,this.start=s,this.deleteCount=n}};const th=new Wl(()=>new XGe,void 0,t=>{t.item=null,t.target=null,t.defaultPrevented=!1,t.cancellable=!1});function ehe(t){t&&typeof t=="object"&&"destroy"in t&&typeof t.destroy=="function"&&t.destroy()}function Y9(t){return t?t instanceof c_?t.toArray():t.length?Array.prototype.slice.apply(t):[]:[]}function Q9(t){if(t?.length)return t[0]}function KGe(t,e,i,r){const s=Math.min(t.length-i,e.length-r);let n=0;for(;n<s&&t[i+n]===e[r+n];)n++;return n}function rSe(t,e,i,r){e&&e.forEach((s,n,a)=>{t.push(s),rSe(t,i.call(r,s,n,a),i,r)})}const f0=new Set,m0=new Set,g0=new Set,X9=new Map;let eHe=0,c_=Hm=class extends Uc{static ofType(t){if(!t)return Hm;if(X9.has(t))return X9.get(t);let e=null;if(typeof t=="function")e=t.prototype.declaredClass;else if(t.base)e=t.base.prototype.declaredClass;else for(const r in t.typeMap){const s=t.typeMap[r].prototype.declaredClass;e?e+=` | ${s}`:e=s}let i=class extends Hm{};return d([iSe({Type:t,ensureType:typeof t=="function"?Ca(t):ny(t)})],i.prototype,"itemType",void 0),i=d([k(`esri.core.Collection<${e}>`)],i),X9.set(t,i),i}static isCollection(t){return t!=null&&t instanceof Hm}constructor(t){super(t),this._chgListeners=[],this._notifications=null,this._updating=!1,this._timer=null,this._observable=new e2,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:eHe++})}normalizeCtorArgs(t){return t?Array.isArray(t)||t instanceof Hm?{items:t}:t:{}}destroy(){this._removeAllRaw(),this._timer&&this._timer.remove(),super.destroy(),this._notifications=null}*[Symbol.iterator](){yield*this.items}get items(){return vt(this._observable),this._items}set items(t){this._emitBeforeChanges(1)||(this._splice(0,this.length,Y9(t)),this._emitAfterChanges(1))}hasEventListener(t){return!this.destroyed&&(t==="change"?this._chgListeners.length>0:super.hasEventListener(t))}on(t,e){if(this.destroyed)return ci();if(t==="change"){const i=this._chgListeners,r={removed:!1,callback:e};return i.push(r),this._notifications&&this._notifications.push({listeners:i.slice(),items:this._items.slice(),changes:[]}),ci(()=>{r.removed=!0,i.splice(i.indexOf(r),1)})}return super.on(t,e)}once(t,e){const i="deref"in e?()=>e.deref():()=>e,r=this.on(t,s=>{i()?.call(null,s),r.remove()});return r}add(t,e){if(vt(this._observable),this._emitBeforeChanges(1))return this;const i=this.getNextIndex(e??null);return this._splice(i,0,[t]),this._emitAfterChanges(1),this}addMany(t,e=this._items.length){if(vt(this._observable),!t?.length)return this;if(this._emitBeforeChanges(1))return this;const i=this.getNextIndex(e);return this._splice(i,0,Y9(t)),this._emitAfterChanges(1),this}at(t){if(vt(this._observable),(t=Math.trunc(t)||0)<0&&(t+=this.length),!(t<0||t>=this.length))return this._items[t]}removeAll(){if(vt(this._observable),!this.length||this._emitBeforeChanges(2))return[];const t=this._removeAllRaw();return this._emitAfterChanges(2),t}_removeAllRaw(){return this.length===0?[]:this._splice(0,this.length)||[]}clone(){return vt(this._observable),this._createNewInstance({items:this._items.map(Te)})}concat(...t){vt(this._observable);const e=t.map(Y9);return this._createNewInstance({items:this._items.concat(...e)})}drain(t,e){if(vt(this._observable),!this.length||this._emitBeforeChanges(2))return;const i=this._splice(0,this.length),r=i.length;for(let s=0;s<r;s++)t.call(e,i[s],s,i);this._emitAfterChanges(2)}destroyAll(){this.drain(ehe)}destroyMany(t){const e=this.removeMany(t);return e.forEach(ehe),e}every(t,e){return vt(this._observable),this._items.every(t,e)}filter(t,e){vt(this._observable);const i=arguments.length===2?this._items.filter(t,e):this._items.filter(t);return this._createNewInstance({items:i})}find(t,e){return vt(this._observable),this._items.find(t,e)}findIndex(t,e){return vt(this._observable),this._items.findIndex(t,e)}flatten(t,e){vt(this._observable);const i=[];return rSe(i,this,t,e),new Hm(i)}forEach(t,e){return vt(this._observable),this._items.forEach(t,e)}getItemAt(t){return vt(this._observable),this._items[t]}getNextIndex(t){vt(this._observable);const e=this.length;return(t=t??e)<0?t=0:t>e&&(t=e),t}includes(t,e=0){return vt(this._observable),this._items.includes(t,e)}indexOf(t,e=0){return vt(this._observable),this._items.indexOf(t,e)}join(t=","){return vt(this._observable),this._items.join(t)}lastIndexOf(t,e=this.length-1){return vt(this._observable),this._items.lastIndexOf(t,e)}map(t,e){vt(this._observable);const i=this._items.map(t,e);return new Hm({items:i})}reorder(t,e=this.length-1){vt(this._observable);const i=this.indexOf(t);if(i!==-1){if(e<0?e=0:e>=this.length&&(e=this.length-1),i!==e){if(this._emitBeforeChanges(4))return t;this._splice(i,1),this._splice(e,0,[t]),this._emitAfterChanges(4)}return t}}pop(){if(vt(this._observable),!this.length||this._emitBeforeChanges(2))return;const t=Q9(this._splice(this.length-1,1));return this._emitAfterChanges(2),t}push(...t){return vt(this._observable),this._emitBeforeChanges(1)||(this._splice(this.length,0,t),this._emitAfterChanges(1)),this.length}reduce(t,e){vt(this._observable);const i=this._items;return arguments.length===2?i.reduce(t,e):i.reduce(t)}reduceRight(t,e){vt(this._observable);const i=this._items;return arguments.length===2?i.reduceRight(t,e):i.reduceRight(t)}remove(t){return vt(this._observable),this.removeAt(this.indexOf(t))}removeAt(t){if(vt(this._observable),t<0||t>=this.length||this._emitBeforeChanges(2))return;const e=Q9(this._splice(t,1));return this._emitAfterChanges(2),e}removeMany(t){if(vt(this._observable),!t?.length||this._emitBeforeChanges(2))return[];const e=t instanceof Hm?t.toArray():t,i=this._items,r=[],s=e.length;for(let n=0;n<s;n++){const a=e[n],o=i.indexOf(a);if(o>-1){const l=1+KGe(e,i,n+1,o+1),c=this._splice(o,l);c&&c.length>0&&r.push.apply(r,c),n+=l-1}}return this._emitAfterChanges(2),r}reverse(){if(vt(this._observable),this._emitBeforeChanges(4))return this;const t=this._splice(0,this.length);return t&&(t.reverse(),this._splice(0,0,t)),this._emitAfterChanges(4),this}shift(){if(vt(this._observable),!this.length||this._emitBeforeChanges(2))return;const t=Q9(this._splice(0,1));return this._emitAfterChanges(2),t}slice(t=0,e=this.length){return vt(this._observable),this._createNewInstance({items:this._items.slice(t,e)})}some(t,e){return vt(this._observable),this._items.some(t,e)}sort(t){if(vt(this._observable),!this.length||this._emitBeforeChanges(4)||!this._requiresSort(t))return this;const e=this._splice(0,this.length);return arguments.length?e.sort(t):e.sort(),this._splice(0,0,e),this._emitAfterChanges(4),this}_requiresSort(t=(e,i)=>e===i?0:e<i?-1:1){const e=this.length-1;for(let i=0;i<e;i++)if(t(this.items[i],this.items[i+1])>0)return!0;return!1}splice(t,e,...i){vt(this._observable),arguments.length===1&&(e=this.length),e??=0;const r=(e?2:0)|(i.length?1:0);if(this._emitBeforeChanges(r))return[];const s=this._splice(t,e,i)||[];return this._emitAfterChanges(r),s}toArray(){return vt(this._observable),this._items.slice()}toJSON(t){return vt(this._observable),this.toArray().map(e=>OR(e)?e.toJSON(t):e)}toLocaleString(){return vt(this._observable),this._items.toLocaleString()}toString(){return vt(this._observable),this._items.toString()}unshift(...t){return vt(this._observable),!t.length||this._emitBeforeChanges(1)||(this._splice(0,0,t),this._emitAfterChanges(1)),this.length}_createNewInstance(t){return new this.constructor(t)}_splice(t,e,i){const r=this._items,s=this.itemType;let n,a;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._updating=!0,this._timer=oM(()=>this._dispatchChange())),t<0&&(t+=this.length),e){if(a=r.splice(t,e),this.hasEventListener("before-remove")){const o=th.acquire();o.target=this,o.cancellable=!0;for(let l=0,c=a.length;l<c;l++)n=a[l],o.reset(n),this.emit("before-remove",o),o.defaultPrevented&&(a.splice(l,1),r.splice(t,0,n),t+=1,l-=1,c-=1);th.release(o)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const o=th.acquire();o.target=this,o.cancellable=!1;const l=a.length;for(let c=0;c<l;c++)o.reset(a[c]),this.emit("after-remove",o);th.release(o)}}if(i?.length){if(s){const h=[];for(const f of i){const y=s.ensureType(f);y==null&&f!=null||h.push(y)}i=h}const o=this.hasEventListener("before-add"),l=this.hasEventListener("after-add"),c=t===this.length;if(o||l){const h=th.acquire();h.target=this,h.cancellable=!0;const f=th.acquire();f.target=this,f.cancellable=!1;for(const y of i)o?(h.reset(y),this.emit("before-add",h),h.defaultPrevented||(c?r.push(y):r.splice(t++,0,y),this._set("length",r.length),l&&(f.reset(y),this.emit("after-add",f)))):(c?r.push(y):r.splice(t++,0,y),this._set("length",r.length),f.reset(y),this.emit("after-add",f));th.release(f),th.release(h)}else{if(c)for(const h of i)r.push(h);else r.splice(t,0,...i);this._set("length",r.length)}}if((i?.length||a?.length)&&this._notifyChangeEvent(i,a),this.hasEventListener("after-splice")){const o=new JGe(this,i,a,t,e);this.emit("after-splice",o)}return a}_emitBeforeChanges(t){let e=!1;if(this.hasEventListener("before-changes")){const i=th.acquire();i.target=this,i.cancellable=!0,i.type=t,this.emit("before-changes",i),e=i.defaultPrevented,th.release(i)}return e}_emitAfterChanges(t){if(this.hasEventListener("after-changes")){const e=th.acquire();e.target=this,e.cancellable=!1,e.type=t,this.emit("after-changes",e),th.release(e)}this._observable.notify()}_notifyChangeEvent(t,e){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:t,removed:e})}get updating(){return this._updating}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),this._updating=!1,!this._notifications)return;const t=this._notifications;this._notifications=null;for(const e of t){const i=e.changes;f0.clear(),m0.clear(),g0.clear();for(const{added:l,removed:c}of i){if(l)if(g0.size===0&&m0.size===0)for(const h of l)f0.add(h);else for(const h of l)m0.has(h)?(g0.add(h),m0.delete(h)):g0.has(h)||f0.add(h);if(c)if(g0.size===0&&f0.size===0)for(const h of c)m0.add(h);else for(const h of c)f0.has(h)?f0.delete(h):(g0.delete(h),m0.add(h))}const r=Mc.acquire();f0.forEach(l=>{r.push(l)});const s=Mc.acquire();m0.forEach(l=>{s.push(l)});const n=this._items,a=e.items,o=Mc.acquire();if(g0.forEach(l=>{a.indexOf(l)!==n.indexOf(l)&&o.push(l)}),e.listeners&&(r.length||s.length||o.length)){const l={target:this,added:r,removed:s,moved:o},c=e.listeners.length;for(let h=0;h<c;h++){const f=e.listeners[h];f.removed||f.callback.call(this,l)}}Mc.release(r),Mc.release(s),Mc.release(o)}f0.clear(),m0.clear(),g0.clear()}};d([m()],c_.prototype,"_updating",void 0),d([m()],c_.prototype,"length",void 0),d([m()],c_.prototype,"items",null),d([m({readOnly:!0})],c_.prototype,"updating",null),c_=Hm=d([k("esri.core.Collection")],c_);const He=c_;function $U(t){return typeof t=="string"?document.getElementById(t):t??null}function the(t,e){for(;;){const i=t.firstChild;if(!i)break;e.appendChild(i)}}let tHe=class{constructor(e){this._observable=new e2,this._set=new Set(e)}get size(){return vt(this._observable),this._set.size}add(e){const i=this._set.size;return this._set.add(e),this._set.size!==i&&this._observable.notify(),this}clear(){this._set.size>0&&(this._set.clear(),this._observable.notify())}delete(e){const i=this._set.delete(e);return i&&this._observable.notify(),i}entries(){return vt(this._observable),this._set.entries()}forEach(e,i){vt(this._observable),this._set.forEach((r,s)=>e.call(i,r,s,this),i)}has(e){return vt(this._observable),this._set.has(e)}keys(){return vt(this._observable),this._set.keys()}values(){return vt(this._observable),this._set.values()}[Symbol.iterator](){return vt(this._observable),this._set[Symbol.iterator]()}[Symbol.dispose](){this._observable.destroy()}get[Symbol.toStringTag](){return this._set[Symbol.toStringTag]}};const iHe=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i,rHe="screenUtils.toPt: input not recognized!",sSe=96;function Bx(t){return t?t/72*sSe:0}function gv(t){return t?72*t/sSe:0}function sn(t){if(typeof t=="string"){const e=t.match(iHe);if(e){const i=Number(e[1]),r=e[3]&&e[3].toLowerCase(),s=t.startsWith("-"),n=r==="px"?gv(i):i;return s?-n:n}return console.warn(rHe),null}return t}function Zl(t=0,e=0){return{x:t,y:e}}function k6t(t){return t?Zl(t.x,t.y):null}function Gs(t=0,e=0){return[t,e]}function CU(t=0,e=0){return[t,e]}function zf(t=0,e=0,i=0){return[t,e,i]}function z6t(t){return t}function F6t(t){return t}function N6t(t){return t}function Xd(t,e){return e?(e[0]=t.x,e[1]=t.y,e.length>2&&(e[2]=0),e):[t.x,t.y]}let tz;async function sHe(){return tz==null&&(tz=te(()=>import("./WhereClauseCache-BrP5D2-t.js"),__vite__mapDeps([0,1])).then(t=>new t.WhereClauseCache(500,500))),tz}function nHe(){tz=null}async function nSe(t,e){const i=await sHe(),r=i.get(t,e);if(r==null)throw i.getError(t,e);return r}function aHe(t,e){return t||=null,e||=null,t==="1=1"?e??t:e==="1=1"?t??e:t&&e?`(${t}) AND (${e})`:t??e}function V6t(t,e){return t||=null,e||=null,t==="1=1"||e==="1=1"||t===e?t==="1=1"?t:e:t&&e?`(${t}) OR (${e})`:t??e}function U6t(t,e){return e.length===0?null:`${t} IN (${oHe(e)})`}function oHe(t){return t.map(e=>typeof e=="string"?lHe(e):e).join(",")}function lHe(t){return`'${t.replaceAll("'","''")}'`}let bC=class{constructor(e=i=>i.values().next().value){this._peeker=e,this._observable=new e2,this._items=new Set}get length(){return vt(this._observable),this._items.size}clear(){this.length!==0&&(this._items.clear(),this._observable.notify())}last(){if(this.length===0)return;let e;for(e of this._items);return e}peek(){if(this.length!==0)return this._peeker(this._items)}push(e){this.contains(e)||(this._items.add(e),this._observable.notify())}contains(e){return vt(this._observable),this._items.has(e)}pop(){if(this.length===0)return;const e=this.peek();return this._items.delete(e),this._observable.notify(),e}popLast(){if(this.length===0)return;const e=this.last();return this._items.delete(e),this._observable.notify(),e}remove(e){this.contains(e)&&(this._items.delete(e),this._observable.notify())}filter(e){const i=this.length;return this._items.forEach(r=>{e(r)||this._items.delete(r)}),i!==this._items.size&&this._observable.notify(),this}*[Symbol.iterator](){vt(this._observable),yield*this._items}};const aSe=new FinalizationRegistry(t=>{t.close()});function cHe(t,e){aSe.register(t,e,e)}function uHe(t){aSe.unregister(t)}function oSe(t,e){return new Proxy({},{get:(i,r,s)=>(...n)=>{let a,o;const l=n[n.length-1];return hHe(l)&&(a=l.signal,o=l.transferList,n.pop()),t.apply(e?`${e}.${r.toString()}`:r.toString(),n,{transferList:o,signal:a})}})}function hHe(t){return typeof t=="object"&&!Array.isArray(t)&&t!=null&&("signal"in t||"transferList"in t||Object.keys(t).length===0)}const dHe={statsWorker:()=>te(()=>import("./statsWorker-Di09XtDy.js"),__vite__mapDeps([2,3,4,5,6,7])),geometryEngineWorker:()=>te(()=>import("./geometryEngineWorker-BkMQzpX8.js"),__vite__mapDeps([8,9,10,11])),arcadeGeometryOperatorsWorker:()=>te(()=>import("./operatorsWorker-awAAqDN6.js"),[]),CSVSourceWorker:()=>te(()=>import("./CSVSourceWorker-BrTMi2sR.js"),__vite__mapDeps([12,13,14,15,16,0,1,17,18,19,3,4,5,6,7,20,21,22,23,24,25])),EdgeProcessingWorker:()=>te(()=>import("./EdgeProcessingWorker-BEvxxIVD.js"),__vite__mapDeps([26,27,28,29,30])),ElevationSamplerWorker:()=>te(()=>import("./ElevationSamplerWorker-CAb_oG52.js"),__vite__mapDeps([31,32,33])),FeatureServiceSnappingSourceWorker:()=>te(()=>import("./FeatureServiceSnappingSourceWorker-BbvIsLn-.js"),__vite__mapDeps([34,14,15,16,0,1,17,18,19,3,4,5,6,7,20,21,35,36,37,38,39])),GaussianSplatSortWorker:()=>te(()=>import("./GaussianSplatSortWorker-CkystscD.js"),[]),GeoJSONSourceWorker:()=>te(()=>import("./GeoJSONSourceWorker-Bo4BHrfZ.js"),__vite__mapDeps([40,14,15,16,0,1,17,18,19,3,4,5,6,7,20,21,41,13,24,25,42])),LercWorker:()=>te(()=>import("./LercWorker-kQewUm93.js"),[]),MemorySourceWorker:()=>te(()=>import("./MemorySourceWorker-CWvsmBih.js"),__vite__mapDeps([43,44,14,15,16,0,1,17,18,19,3,4,5,6,7,20,21,24,25,42,13])),PBFDecoderWorker:()=>te(()=>import("./PBFDecoderWorker-BZf01dxN.js"),__vite__mapDeps([45,36,37])),FeaturePipelineWorker:()=>te(()=>import("./FeaturePipelineWorker-B_5RqENs.js"),__vite__mapDeps([46,47,48,49,50,51,52,53,54,55,56,57,25,58,59,60,17,18,21,16,0,1,19,3,4,5,6,7,20,61,62,63,64,65,66,67,41,13,24,42,38,36,37,39,68,69,70])),PointCloudWorker:()=>te(()=>import("./PointCloudWorker-CdbBkYVP.js"),__vite__mapDeps([71,72,73,74,75])),RasterWorker:()=>te(()=>import("./RasterWorker-Dm_5XHhd.js"),__vite__mapDeps([76,77,78,11,79,80,81,82,83])),SceneLayerSnappingSourceWorker:()=>te(()=>import("./SceneLayerSnappingSourceWorker-Cr36Y7uq.js"),__vite__mapDeps([84,29,30,28])),SceneLayerWorker:()=>te(()=>import("./SceneLayerWorker--vnaiPQK.js"),__vite__mapDeps([85,86])),WFSSourceWorker:()=>te(()=>import("./WFSSourceWorker-CnDlc91D.js"),__vite__mapDeps([87,14,15,16,0,1,17,18,19,3,4,5,6,7,20,21,41,13,42,88,89])),WorkerTileHandler:()=>te(()=>import("./WorkerTileHandler-Cpkrx0FT.js"),__vite__mapDeps([90,59,37,58,91,53])),Lyr3DWorker:()=>te(()=>import("./Lyr3DWorker-gVpmQAlq.js"),__vite__mapDeps([92,93])),Feature3DPipelineWorker:()=>te(()=>import("./Feature3DPipelineWorker-bY0uf8NL.js"),__vite__mapDeps([94,16,0,1,17,18,19,3,4,5,6,7,20,95,96,97,98,47,81,74,99,100,101,57,25,102,49,54,103,104,38,36,37,39])),TextureCompressionWorker:()=>te(()=>import("./TextureCompressionWorker-BHSEiusy.js"),[]),FlowWorker:()=>te(()=>import("./FlowWorker-CIS0gBnf.js"),__vite__mapDeps([105,83,106,107])),ParquetSourceWorker:()=>te(()=>import("./ParquetSourceWorker-DKtyG2rV.js"),__vite__mapDeps([108,60,16,0,1,17,18,19,3,4,5,6,7,20,24,25,109,23,62,61,50])),PanoramicMeshWorker:()=>te(()=>import("./PanoramicMeshWorker-JdZEXH6k.js"),__vite__mapDeps([110,77]))},lSe="worker:port-closed",Kg={HANDSHAKE:0,OPEN:1,OPENED:2,RESPONSE:3,INVOKE:4,ABORT:5,CLOSE:6,OPEN_PORT:7,ON:8};let pHe=0;function cSe(){return pHe++}function fHe(t){return t&&typeof t=="object"&&("result"in t||"transferList"in t)}function i6(t){return t?typeof t=="string"?JSON.stringify({name:"message",message:t}):t.toJSON?JSON.stringify(t):JSON.stringify({name:t.name,message:t.message,details:t.details||{stack:t.stack}}):null}function uSe(t,e,i,r){if(e.type===Kg.OPEN_PORT)return void t.postMessage(e,[e.port]);if(e.type!==Kg.INVOKE&&e.type!==Kg.RESPONSE)return void t.postMessage(e);let s;fHe(i)?(s=ihe(i.transferList),e.data=i.result):(s=ihe(r),e.data=i),s?t.postMessage(e,s):t.postMessage(e)}function FR(t){if(!t)return null;const e=t.data;return e?typeof e=="string"?JSON.parse(e):e:null}function ihe(t){if(!t?.length)return null;if(ie("esri-workers-arraybuffer-transfer"))return t;const e=t.filter(i=>!mHe(i));return e.length?e:null}function mHe(t){return t instanceof ArrayBuffer||t?.constructor?.name==="ArrayBuffer"}async function j6t(t){try{return await t}catch(e){const i=e?.name===lSe;if(!(Hr(e)||i))throw e;return}}const{CLOSE:n5,ABORT:zW,INVOKE:rhe,RESPONSE:OE,OPEN_PORT:she,ON:nhe}=Kg,gHe=2;let yHe=class{constructor(e){this._invoke=e,this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._timer=null,this._process=this._process.bind(this)}push(e){e.type===zW?this._cancelledJobIds.add(e.jobId):(this._invokeMessages.push(e),this._timer===null&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const e of this._invokeMessages)this._cancelledJobIds.has(e.jobId)||this._invoke(e);this._cancelledJobIds.clear(),this._invokeMessages.length=0}};var Lh;let wC=(Lh=class{static connect(e,i){const r=new MessageChannel;let s;s=typeof e=="function"?new e:"default"in e&&typeof e.default=="function"?new e.default:e;const n=new Lh(r.port1,{channel:r,client:s,schedule:i});return typeof s=="object"&&"remoteClient"in s&&(s.remoteClient=n),Lh.clients.set(n,s),r.port2}static loadWorker(e){const i=dHe[e];return i?i():Promise.resolve(null)}constructor(e,i,r,s){this._port=e,this._jobQueue=r,this._lowPriorityJobQueue=s,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new yHe(n=>this._onInvokeMessage(n)),this._client=i.client,this._onMessage=this._onMessage.bind(this),this._channel=i.channel,this._schedule=i.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}close(){this._post({type:n5}),this._close()}isBusy(){return this._outJobs.size>0}invoke(e,i,r){return this.apply(e,[i],r)}apply(e,i,r){const s=r?.signal,n=r?.transferList;if(!this._port)return Promise.reject(new ee(lSe,`Cannot call invoke('${e}'), port is closed`,{methodName:e,data:i}));const a=cSe();return new Promise((o,l)=>{if(Rn(s))return this._processWork(),void l(Xt());const c=qa(s,()=>{const f=this._outJobs.get(a);f&&(this._outJobs.delete(a),this._processWork(),Ki(f.abortHandle),this._post({type:zW,jobId:a}),l(Xt()))}),h={resolve:o,reject:l,abortHandle:c,debugInfo:e};this._outJobs.set(a,h),this._post({type:rhe,jobId:a,methodName:e,abortable:s!=null},i,n)})}createInvokeProxy(e){return oSe(this,e)}on(e,i){const r=new MessageChannel;function s(n){i(n.data)}return this._port.postMessage({type:nhe,eventType:e,port:r.port2},[r.port2]),r.port1.addEventListener("message",s),r.port1.start(),ci(()=>{r.port1.postMessage({type:n5}),r.port1.close(),r.port1.removeEventListener("message",s)})}jobAdded(){this._processWork()}openPort(){const e=new MessageChannel;return this._post({type:she,port:e.port2}),e.port1}_processWork(){if(this._outJobs.size>=gHe)return;const e=this._jobQueue?.pop()??this._lowPriorityJobQueue?.pop();if(!e)return;const{methodName:i,data:r,invokeOptions:s,resolver:n}=e;this.apply(i,r,s).then(a=>n.resolve(a)).catch(a=>n.reject(a))}_close(){this._channel&&(this._channel=void 0),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach(e=>{Ki(e.abortHandle),e.reject(Xt(`Worker closing, aborting job calling '${e.debugInfo}'`))}),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=null,this._client=null,this._schedule=null,this._onMessage=null,this._channel=null,this._jobQueue=void 0,this._invokeQueue=void 0,this._lowPriorityJobQueue=void 0}_onMessage(e){this._schedule!=null?this._schedule(()=>this._processMessage(e,!0)):this._processMessage(e,!1)}_processMessage(e,i){const r=FR(e);if(r)switch(r.type){case OE:this._onResponseMessage(r);break;case rhe:i?this._onInvokeMessage(r):this._invokeQueue.push(r);break;case zW:this._onAbortMessage(r);break;case n5:this._onCloseMessage();break;case she:this._onOpenPortMessage(r);break;case nhe:this._onOnMessage(r)}}_onAbortMessage(e){const i=this._inJobs,r=e.jobId,s=i.get(r);this._invokeQueue.push(e),s&&(s.controller&&s.controller.abort(),i.delete(r))}_onCloseMessage(){const e=this._client;this._close(),e&&"destroy"in e&&Lh.clients.get(this)===e&&e.destroy(),Lh.clients.delete(this),e?.remoteClient&&(e.remoteClient=null)}_onInvokeMessage(e){const{methodName:i,jobId:r,data:s=[],abortable:n}=e,a=n?new AbortController:null,o=this._inJobs;let l,c=this._client,h=c[i];try{if(!h&&i&&i.includes(".")){const f=i.split(".");for(let y=0;y<f.length-1;y++)c=c[f[y]],h=c[f[y+1]]}if(typeof h!="function")throw new TypeError(`${i} is not a function`);s.push({client:this,signal:a?a.signal:null}),l=h.apply(c,s)}catch(f){return void this._post({type:OE,jobId:r,error:i6(f)})}$a(l)?(o.set(r,{controller:a,promise:l}),l.then(f=>{o.has(r)&&(o.delete(r),this._post({type:OE,jobId:r},f))},f=>{o.has(r)&&(o.delete(r),Hr(f)||this._post({type:OE,jobId:r,error:i6(f||{message:`Error encountered at method ${i}`})}))})):this._post({type:OE,jobId:r},l)}_onOpenPortMessage(e){new Lh(e.port,{client:this._client})}_onOnMessage(e){const{port:i}=e,r=this._client.on(e.eventType,n=>{i.postMessage(n)}),s=aM(e.port,"message",n=>{FR(n)?.type===n5&&(s.remove(),r.remove(),i.close())})}_onResponseMessage(e){const{jobId:i,error:r,data:s}=e,n=this._outJobs;if(!n.has(i))return;const a=n.get(i);n.delete(i),this._processWork(),Ki(a.abortHandle),r?a.reject(ee.fromJSON(JSON.parse(r))):a.resolve(s)}_post(e,i,r){return uSe(this._port,e,i,r)}},Lh.kernelInfo={buildDate:yxe,fullVersion:FK,revision:_xe},Lh.clients=new Map,Lh),_He=class{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new bC,this._ongoingLowPriorityJobsQueue=new bC}destroy(){this.close()}get closed(){return!this._clients?.length}open(e,i){return new Promise((r,s)=>{let n=!0;const a=o=>{st(i.signal),n&&(n=!1,o())};this._clients.length=e.length,this._clientPromises.length=e.length,this._inUseClients.length=e.length;for(let o=0;o<e.length;++o){const l=e[o];$a(l)?this._clientPromises[o]=l.then(c=>(this._clients[o]=new wC(c,i,this._ongoingJobsQueue,this._ongoingLowPriorityJobsQueue),a(r),this._clients[o]),()=>(a(s),null)):(this._clients[o]=new wC(l,i,this._ongoingJobsQueue,this._ongoingLowPriorityJobsQueue),this._clientPromises[o]=Promise.resolve(this._clients[o]),a(r))}})}broadcast(e,i,r){const s=new Array(this._clientPromises.length);for(let n=0;n<this._clientPromises.length;++n){const a=this._clientPromises[n];s[n]=a.then(o=>o?.invoke(e,i,r))}return s}close(){let e;for(;e=this._ongoingJobsQueue.pop();)e.resolver.reject(Xt(`Worker closing, aborting job calling '${e.methodName}'`));for(;e=this._ongoingLowPriorityJobsQueue.pop();)e.resolver.reject(Xt(`Worker closing, aborting job calling '${e.methodName}'`));for(const i of this._clientPromises)i.then(r=>r?.close());this._clients.length=0,this._clientPromises.length=0,this._inUseClients.length=0,uHe(this)}invoke(e,i,r){return this.apply(e,[i],r)}apply(e,i,r){const s=lo();(r?.priority==="low"?this._ongoingLowPriorityJobsQueue:this._ongoingJobsQueue).push({methodName:e,data:i,invokeOptions:r,resolver:s});for(let n=0;n<this._clientPromises.length;n++){const a=this._clients[n];a?a.jobAdded():this._clientPromises[n].then(o=>o?.jobAdded())}return s.promise}createInvokeProxy(e){return oSe(this,e)}on(e,i){return Promise.all(this._clientPromises).then(()=>qu(this._clients.map(r=>r.on(e,i))))}openPorts(){return new Promise(e=>{const i=new Array(this._clientPromises.length);let r=i.length;for(let s=0;s<this._clientPromises.length;++s)this._clientPromises[s].then(n=>{n&&(i[s]=n.openPort()),--r===0&&e(i)})})}get test(){}};const vHe={async request(t,e){const i=t.options,r=i.responseType;i.signal=e?.signal,i.responseType=r==="native"||r==="native-request-init"?"native-request-init":r&&["blob","json","text"].includes(r)&&gW(t.url)?.after?r:"array-buffer";const s=await $r(t.url,i),n={data:s.data,httpStatus:s.httpStatus,ssl:s.ssl};switch(s.requestOptions?.responseType){case"native-request-init":return delete n.data.signal,n;case"blob":n.data=await n.data.arrayBuffer();break;case"json":n.data=new TextEncoder().encode(JSON.stringify(n.data)).buffer;break;case"text":n.data=new TextEncoder().encode(n.data).buffer}return{result:n,transferList:[n.data]}}};let AP;const bHe=globalThis.esriConfig?.locale??globalThis.dojoConfig?.locale,FW=globalThis.document?.documentElement;function hSe(){const t=FW?.getAttribute("lang"),e=globalThis.navigator?.language;return bHe??t??e??"en"}function Lc(){return AP===void 0&&(AP=hSe()),AP}const wHe=/^(?<language>[a-z]{2,3})(?:-(?<extlang>[a-z]{3}))?(?:-[A-Z][a-z]{3})?(?:-(?<region>[A-Z]{2}|\d{3}))?(?:-.*)?$/;function dee(t=Lc()){return pSe(t)?.language}function dSe(t=Lc()){const e=pSe(t);return e?.language&&e?.extlang?t.replace(`${e.language}-`,""):t}function pSe(t=Lc()){return wHe.exec(t)?.groups}const iz=[];function fSe(t){return iz.push(t),ci(()=>{iz.splice(iz.indexOf(t),1)})}const rz=[];function pee(t){return rz.push(t),ci(()=>rz.splice(rz.indexOf(t),1))}function ahe(){const t=hSe();AP!==t&&([...rz].forEach(e=>e(t)),AP=t,[...iz].forEach(e=>e(t)))}globalThis.addEventListener?.("languagechange",ahe),FW&&new MutationObserver(()=>{ahe()}).observe(FW,{attributeFilter:["lang"]});const vp="system",yv="unknown",_v="UTC",xHe=Intl.DateTimeFormat().resolvedOptions().timeZone,ohe=new Map([["AUS Central Standard Time","Australia/Darwin"],["AUS Eastern Standard Time","Australia/Sydney"],["Afghanistan Standard Time","Asia/Kabul"],["Alaskan Standard Time","America/Anchorage"],["Aleutian Standard Time","America/Adak"],["Altai Standard Time","Asia/Barnaul"],["Arab Standard Time","Asia/Riyadh"],["Arabian Standard Time","Asia/Dubai"],["Arabic Standard Time","Asia/Baghdad"],["Argentina Standard Time","America/Buenos_Aires"],["Astrakhan Standard Time","Europe/Astrakhan"],["Atlantic Standard Time","America/Halifax"],["Aus Central W. Standard Time","Australia/Eucla"],["Azerbaijan Standard Time","Asia/Baku"],["Azores Standard Time","Atlantic/Azores"],["Bahia Standard Time","America/Bahia"],["Bangladesh Standard Time","Asia/Dhaka"],["Belarus Standard Time","Europe/Minsk"],["Bougainville Standard Time","Pacific/Bougainville"],["Canada Central Standard Time","America/Regina"],["Cape Verde Standard Time","Atlantic/Cape_Verde"],["Caucasus Standard Time","Asia/Yerevan"],["Cen. Australia Standard Time","Australia/Adelaide"],["Central America Standard Time","America/Guatemala"],["Central Asia Standard Time","Asia/Bishkek"],["Central Brazilian Standard Time","America/Cuiaba"],["Central Europe Standard Time","Europe/Budapest"],["Central European Standard Time","Europe/Warsaw"],["Central Pacific Standard Time","Pacific/Guadalcanal"],["Central Standard Time","America/Chicago"],["Central Standard Time (Mexico)","America/Mexico_City"],["Chatham Islands Standard Time","Pacific/Chatham"],["China Standard Time","Asia/Shanghai"],["Cuba Standard Time","America/Havana"],["Dateline Standard Time","Etc/GMT+12"],["E. Africa Standard Time","Africa/Nairobi"],["E. Australia Standard Time","Australia/Brisbane"],["E. Europe Standard Time","Europe/Chisinau"],["E. South America Standard Time","America/Sao_Paulo"],["Easter Island Standard Time","Pacific/Easter"],["Eastern Standard Time","America/New_York"],["Eastern Standard Time (Mexico)","America/Cancun"],["Egypt Standard Time","Africa/Cairo"],["Ekaterinburg Standard Time","Asia/Yekaterinburg"],["FLE Standard Time","Europe/Kiev"],["Fiji Standard Time","Pacific/Fiji"],["GMT Standard Time","Europe/London"],["GTB Standard Time","Europe/Bucharest"],["Georgian Standard Time","Asia/Tbilisi"],["Greenland Standard Time","America/Godthab"],["Greenwich Standard Time","Atlantic/Reykjavik"],["Haiti Standard Time","America/Port-au-Prince"],["Hawaiian Standard Time","Pacific/Honolulu"],["India Standard Time","Asia/Calcutta"],["Iran Standard Time","Asia/Tehran"],["Israel Standard Time","Asia/Jerusalem"],["Jordan Standard Time","Asia/Amman"],["Kaliningrad Standard Time","Europe/Kaliningrad"],["Korea Standard Time","Asia/Seoul"],["Libya Standard Time","Africa/Tripoli"],["Line Islands Standard Time","Pacific/Kiritimati"],["Lord Howe Standard Time","Australia/Lord_Howe"],["Magadan Standard Time","Asia/Magadan"],["Magallanes Standard Time","America/Punta_Arenas"],["Marquesas Standard Time","Pacific/Marquesas"],["Mauritius Standard Time","Indian/Mauritius"],["Middle East Standard Time","Asia/Beirut"],["Montevideo Standard Time","America/Montevideo"],["Morocco Standard Time","Africa/Casablanca"],["Mountain Standard Time","America/Denver"],["Mountain Standard Time (Mexico)","America/Mazatlan"],["Myanmar Standard Time","Asia/Rangoon"],["N. Central Asia Standard Time","Asia/Novosibirsk"],["Namibia Standard Time","Africa/Windhoek"],["Nepal Standard Time","Asia/Katmandu"],["New Zealand Standard Time","Pacific/Auckland"],["Newfoundland Standard Time","America/St_Johns"],["Norfolk Standard Time","Pacific/Norfolk"],["North Asia East Standard Time","Asia/Irkutsk"],["North Asia Standard Time","Asia/Krasnoyarsk"],["North Korea Standard Time","Asia/Pyongyang"],["Omsk Standard Time","Asia/Omsk"],["Pacific SA Standard Time","America/Santiago"],["Pacific Standard Time","America/Los_Angeles"],["Pacific Standard Time (Mexico)","America/Tijuana"],["Pakistan Standard Time","Asia/Karachi"],["Paraguay Standard Time","America/Asuncion"],["Qyzylorda Standard Time","Asia/Qyzylorda"],["Romance Standard Time","Europe/Paris"],["Russia Time Zone 10","Asia/Srednekolymsk"],["Russia Time Zone 11","Asia/Kamchatka"],["Russia Time Zone 3","Europe/Samara"],["Russian Standard Time","Europe/Moscow"],["SA Eastern Standard Time","America/Cayenne"],["SA Pacific Standard Time","America/Bogota"],["SA Western Standard Time","America/La_Paz"],["SE Asia Standard Time","Asia/Bangkok"],["Saint Pierre Standard Time","America/Miquelon"],["Sakhalin Standard Time","Asia/Sakhalin"],["Samoa Standard Time","Pacific/Apia"],["Sao Tome Standard Time","Africa/Sao_Tome"],["Saratov Standard Time","Europe/Saratov"],["Singapore Standard Time","Asia/Singapore"],["South Africa Standard Time","Africa/Johannesburg"],["South Sudan Standard Time","Africa/Juba"],["Sri Lanka Standard Time","Asia/Colombo"],["Sudan Standard Time","Africa/Khartoum"],["Syria Standard Time","Asia/Damascus"],["Taipei Standard Time","Asia/Taipei"],["Tasmania Standard Time","Australia/Hobart"],["Tocantins Standard Time","America/Araguaina"],["Tokyo Standard Time","Asia/Tokyo"],["Tomsk Standard Time","Asia/Tomsk"],["Tonga Standard Time","Pacific/Tongatapu"],["Transbaikal Standard Time","Asia/Chita"],["Turkey Standard Time","Europe/Istanbul"],["Turks And Caicos Standard Time","America/Grand_Turk"],["US Eastern Standard Time","America/Indianapolis"],["US Mountain Standard Time","America/Phoenix"],["UTC","Etc/GMT"],["UTC+01","Etc/GMT-1"],["UTC+02","Etc/GMT-2"],["UTC+03","Etc/GMT-3"],["UTC+04","Etc/GMT-4"],["UTC+05","Etc/GMT-5"],["UTC+06","Etc/GMT-6"],["UTC+07","Etc/GMT-7"],["UTC+08","Etc/GMT-8"],["UTC+09","Etc/GMT-9"],["UTC+10","Etc/GMT-10"],["UTC+11","Etc/GMT-11"],["UTC+12","Etc/GMT-12"],["UTC+13","Etc/GMT-13"],["UTC+14","Etc/GMT-14"],["UTC-01","Etc/GMT+1"],["UTC-02","Etc/GMT+2"],["UTC-03","Etc/GMT+3"],["UTC-04","Etc/GMT+4"],["UTC-05","Etc/GMT+5"],["UTC-06","Etc/GMT+6"],["UTC-07","Etc/GMT+7"],["UTC-08","Etc/GMT+8"],["UTC-09","Etc/GMT+9"],["UTC-10","Etc/GMT+10"],["UTC-11","Etc/GMT+11"],["UTC-12","Etc/GMT+12"],["Ulaanbaatar Standard Time","Asia/Ulaanbaatar"],["Venezuela Standard Time","America/Caracas"],["Vladivostok Standard Time","Asia/Vladivostok"],["Volgograd Standard Time","Europe/Volgograd"],["W. Australia Standard Time","Australia/Perth"],["W. Central Africa Standard Time","Africa/Lagos"],["W. Europe Standard Time","Europe/Berlin"],["W. Mongolia Standard Time","Asia/Hovd"],["West Asia Standard Time","Asia/Tashkent"],["West Bank Standard Time","Asia/Hebron"],["West Pacific Standard Time","Pacific/Port_Moresby"],["Yakutsk Standard Time","Asia/Yakutsk"],["Yukon Standard Time","America/Whitehorse"]]);class n2 extends Error{}class SHe extends n2{constructor(e){super(`Invalid DateTime: ${e.toMessage()}`)}}class THe extends n2{constructor(e){super(`Invalid Interval: ${e.toMessage()}`)}}class $He extends n2{constructor(e){super(`Invalid Duration: ${e.toMessage()}`)}}class c3 extends n2{}class mSe extends n2{constructor(e){super(`Invalid unit ${e}`)}}class Xo extends n2{}class y0 extends n2{constructor(){super("Zone is an abstract class")}}const nt="numeric",bp="short",Du="long",r6={year:nt,month:nt,day:nt},gSe={year:nt,month:bp,day:nt},CHe={year:nt,month:bp,day:nt,weekday:bp},ySe={year:nt,month:Du,day:nt},_Se={year:nt,month:Du,day:nt,weekday:Du},vSe={hour:nt,minute:nt},bSe={hour:nt,minute:nt,second:nt},wSe={hour:nt,minute:nt,second:nt,timeZoneName:bp},xSe={hour:nt,minute:nt,second:nt,timeZoneName:Du},SSe={hour:nt,minute:nt,hourCycle:"h23"},TSe={hour:nt,minute:nt,second:nt,hourCycle:"h23"},$Se={hour:nt,minute:nt,second:nt,hourCycle:"h23",timeZoneName:bp},CSe={hour:nt,minute:nt,second:nt,hourCycle:"h23",timeZoneName:Du},MSe={year:nt,month:nt,day:nt,hour:nt,minute:nt},ESe={year:nt,month:nt,day:nt,hour:nt,minute:nt,second:nt},ASe={year:nt,month:bp,day:nt,hour:nt,minute:nt},OSe={year:nt,month:bp,day:nt,hour:nt,minute:nt,second:nt},MHe={year:nt,month:bp,day:nt,weekday:bp,hour:nt,minute:nt},PSe={year:nt,month:Du,day:nt,hour:nt,minute:nt,timeZoneName:bp},RSe={year:nt,month:Du,day:nt,hour:nt,minute:nt,second:nt,timeZoneName:bp},DSe={year:nt,month:Du,day:nt,weekday:Du,hour:nt,minute:nt,timeZoneName:Du},ISe={year:nt,month:Du,day:nt,weekday:Du,hour:nt,minute:nt,second:nt,timeZoneName:Du};class a2{get type(){throw new y0}get name(){throw new y0}get ianaName(){return this.name}get isUniversal(){throw new y0}offsetName(e,i){throw new y0}formatOffset(e,i){throw new y0}offset(e){throw new y0}equals(e){throw new y0}get isValid(){throw new y0}}let J9=null;class MU extends a2{static get instance(){return J9===null&&(J9=new MU),J9}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(e,{format:i,locale:r}){return GSe(e,i,r)}formatOffset(e,i){return OP(this.offset(e),i)}offset(e){return-new Date(e).getTimezoneOffset()}equals(e){return e.type==="system"}get isValid(){return!0}}const NW=new Map;function EHe(t){let e=NW.get(t);return e===void 0&&(e=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:t,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"}),NW.set(t,e)),e}const AHe={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function OHe(t,e){const i=t.format(e).replace(/\u200E/g,""),r=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(i),[,s,n,a,o,l,c,h]=r;return[a,s,n,o,l,c,h]}function PHe(t,e){const i=t.formatToParts(e),r=[];for(let s=0;s<i.length;s++){const{type:n,value:a}=i[s],o=AHe[n];n==="era"?r[o]=a:oi(o)||(r[o]=parseInt(a,10))}return r}const K9=new Map;class Fc extends a2{static create(e){let i=K9.get(e);return i===void 0&&K9.set(e,i=new Fc(e)),i}static resetCache(){K9.clear(),NW.clear()}static isValidSpecifier(e){return this.isValidZone(e)}static isValidZone(e){if(!e)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:e}).format(),!0}catch{return!1}}constructor(e){super(),this.zoneName=e,this.valid=Fc.isValidZone(e)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(e,{format:i,locale:r}){return GSe(e,i,r,this.name)}formatOffset(e,i){return OP(this.offset(e),i)}offset(e){if(!this.valid)return NaN;const i=new Date(e);if(isNaN(i))return NaN;const r=EHe(this.name);let[s,n,a,o,l,c,h]=r.formatToParts?PHe(r,i):OHe(r,i);o==="BC"&&(s=-Math.abs(s)+1);const y=AU({year:s,month:n,day:a,hour:l===24?0:l,minute:c,second:h,millisecond:0});let _=+i;const w=_%1e3;return _-=w>=0?w:1e3+w,(y-_)/(60*1e3)}equals(e){return e.type==="iana"&&e.name===this.name}get isValid(){return this.valid}}let lhe={};function RHe(t,e={}){const i=JSON.stringify([t,e]);let r=lhe[i];return r||(r=new Intl.ListFormat(t,e),lhe[i]=r),r}const VW=new Map;function UW(t,e={}){const i=JSON.stringify([t,e]);let r=VW.get(i);return r===void 0&&(r=new Intl.DateTimeFormat(t,e),VW.set(i,r)),r}const BW=new Map;function DHe(t,e={}){const i=JSON.stringify([t,e]);let r=BW.get(i);return r===void 0&&(r=new Intl.NumberFormat(t,e),BW.set(i,r)),r}const jW=new Map;function IHe(t,e={}){const{base:i,...r}=e,s=JSON.stringify([t,r]);let n=jW.get(s);return n===void 0&&(n=new Intl.RelativeTimeFormat(t,e),jW.set(s,n)),n}let ZA=null;function LHe(){return ZA||(ZA=new Intl.DateTimeFormat().resolvedOptions().locale,ZA)}const qW=new Map;function LSe(t){let e=qW.get(t);return e===void 0&&(e=new Intl.DateTimeFormat(t).resolvedOptions(),qW.set(t,e)),e}const GW=new Map;function kHe(t){let e=GW.get(t);if(!e){const i=new Intl.Locale(t);e="getWeekInfo"in i?i.getWeekInfo():i.weekInfo,"minimalDays"in e||(e={...kSe,...e}),GW.set(t,e)}return e}function zHe(t){const e=t.indexOf("-x-");e!==-1&&(t=t.substring(0,e));const i=t.indexOf("-u-");if(i===-1)return[t];{let r,s;try{r=UW(t).resolvedOptions(),s=t}catch{const l=t.substring(0,i);r=UW(l).resolvedOptions(),s=l}const{numberingSystem:n,calendar:a}=r;return[s,n,a]}}function FHe(t,e,i){return(i||e)&&(t.includes("-u-")||(t+="-u"),i&&(t+=`-ca-${i}`),e&&(t+=`-nu-${e}`)),t}function NHe(t){const e=[];for(let i=1;i<=12;i++){const r=lt.utc(2009,i,1);e.push(t(r))}return e}function VHe(t){const e=[];for(let i=1;i<=7;i++){const r=lt.utc(2016,11,13+i);e.push(t(r))}return e}function a5(t,e,i,r){const s=t.listingMode();return s==="error"?null:s==="en"?i(e):r(e)}function UHe(t){return t.numberingSystem&&t.numberingSystem!=="latn"?!1:t.numberingSystem==="latn"||!t.locale||t.locale.startsWith("en")||LSe(t.locale).numberingSystem==="latn"}class BHe{constructor(e,i,r){this.padTo=r.padTo||0,this.floor=r.floor||!1;const{padTo:s,floor:n,...a}=r;if(!i||Object.keys(a).length>0){const o={useGrouping:!1,...r};r.padTo>0&&(o.minimumIntegerDigits=r.padTo),this.inf=DHe(e,o)}}format(e){if(this.inf){const i=this.floor?Math.floor(e):e;return this.inf.format(i)}else{const i=this.floor?Math.floor(e):_ee(e,3);return _a(i,this.padTo)}}}class jHe{constructor(e,i,r){this.opts=r,this.originalZone=void 0;let s;if(this.opts.timeZone)this.dt=e;else if(e.zone.type==="fixed"){const a=-1*(e.offset/60),o=a>=0?`Etc/GMT+${a}`:`Etc/GMT${a}`;e.offset!==0&&Fc.create(o).valid?(s=o,this.dt=e):(s="UTC",this.dt=e.offset===0?e:e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone)}else e.zone.type==="system"?this.dt=e:e.zone.type==="iana"?(this.dt=e,s=e.zone.name):(s="UTC",this.dt=e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone);const n={...this.opts};n.timeZone=n.timeZone||s,this.dtf=UW(i,n)}format(){return this.originalZone?this.formatToParts().map(({value:e})=>e).join(""):this.dtf.format(this.dt.toJSDate())}formatToParts(){const e=this.dtf.formatToParts(this.dt.toJSDate());return this.originalZone?e.map(i=>{if(i.type==="timeZoneName"){const r=this.originalZone.offsetName(this.dt.ts,{locale:this.dt.locale,format:this.opts.timeZoneName});return{...i,value:r}}else return i}):e}resolvedOptions(){return this.dtf.resolvedOptions()}}class qHe{constructor(e,i,r){this.opts={style:"long",...r},!i&&jSe()&&(this.rtf=IHe(e,r))}format(e,i){return this.rtf?this.rtf.format(e,i):dWe(i,e,this.opts.numeric,this.opts.style!=="long")}formatToParts(e,i){return this.rtf?this.rtf.formatToParts(e,i):[]}}const kSe={firstDay:1,minimalDays:4,weekend:[6,7]};class jr{static fromOpts(e){return jr.create(e.locale,e.numberingSystem,e.outputCalendar,e.weekSettings,e.defaultToEN)}static create(e,i,r,s,n=!1){const a=e||Cn.defaultLocale,o=a||(n?"en-US":LHe()),l=i||Cn.defaultNumberingSystem,c=r||Cn.defaultOutputCalendar,h=WW(s)||Cn.defaultWeekSettings;return new jr(o,l,c,h,a)}static resetCache(){ZA=null,VW.clear(),BW.clear(),jW.clear(),qW.clear(),GW.clear()}static fromObject({locale:e,numberingSystem:i,outputCalendar:r,weekSettings:s}={}){return jr.create(e,i,r,s)}constructor(e,i,r,s,n){const[a,o,l]=zHe(e);this.locale=a,this.numberingSystem=i||o||null,this.outputCalendar=r||l||null,this.weekSettings=s,this.intl=FHe(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=n,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=UHe(this)),this.fastNumbersCached}listingMode(){const e=this.isEnglish(),i=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return e&&i?"en":"intl"}clone(e){return!e||Object.getOwnPropertyNames(e).length===0?this:jr.create(e.locale||this.specifiedLocale,e.numberingSystem||this.numberingSystem,e.outputCalendar||this.outputCalendar,WW(e.weekSettings)||this.weekSettings,e.defaultToEN||!1)}redefaultToEN(e={}){return this.clone({...e,defaultToEN:!0})}redefaultToSystem(e={}){return this.clone({...e,defaultToEN:!1})}months(e,i=!1){return a5(this,e,ZSe,()=>{const r=this.intl==="ja"||this.intl.startsWith("ja-");i&=!r;const s=i?{month:e,day:"numeric"}:{month:e},n=i?"format":"standalone";if(!this.monthsCache[n][e]){const a=r?o=>this.dtFormatter(o,s).format():o=>this.extract(o,s,"month");this.monthsCache[n][e]=NHe(a)}return this.monthsCache[n][e]})}weekdays(e,i=!1){return a5(this,e,XSe,()=>{const r=i?{weekday:e,year:"numeric",month:"long",day:"numeric"}:{weekday:e},s=i?"format":"standalone";return this.weekdaysCache[s][e]||(this.weekdaysCache[s][e]=VHe(n=>this.extract(n,r,"weekday"))),this.weekdaysCache[s][e]})}meridiems(){return a5(this,void 0,()=>JSe,()=>{if(!this.meridiemCache){const e={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[lt.utc(2016,11,13,9),lt.utc(2016,11,13,19)].map(i=>this.extract(i,e,"dayperiod"))}return this.meridiemCache})}eras(e){return a5(this,e,KSe,()=>{const i={era:e};return this.eraCache[e]||(this.eraCache[e]=[lt.utc(-40,1,1),lt.utc(2017,1,1)].map(r=>this.extract(r,i,"era"))),this.eraCache[e]})}extract(e,i,r){const s=this.dtFormatter(e,i),n=s.formatToParts(),a=n.find(o=>o.type.toLowerCase()===r);return a?a.value:null}numberFormatter(e={}){return new BHe(this.intl,e.forceSimple||this.fastNumbers,e)}dtFormatter(e,i={}){return new jHe(e,this.intl,i)}relFormatter(e={}){return new qHe(this.intl,this.isEnglish(),e)}listFormatter(e={}){return RHe(this.intl,e)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||LSe(this.intl).locale.startsWith("en-us")}getWeekSettings(){return this.weekSettings?this.weekSettings:qSe()?kHe(this.locale):kSe}getStartOfWeek(){return this.getWeekSettings().firstDay}getMinDaysInFirstWeek(){return this.getWeekSettings().minimalDays}getWeekendDays(){return this.getWeekSettings().weekend}equals(e){return this.locale===e.locale&&this.numberingSystem===e.numberingSystem&&this.outputCalendar===e.outputCalendar}toString(){return`Locale(${this.locale}, ${this.numberingSystem}, ${this.outputCalendar})`}}let e7=null;class xa extends a2{static get utcInstance(){return e7===null&&(e7=new xa(0)),e7}static instance(e){return e===0?xa.utcInstance:new xa(e)}static parseSpecifier(e){if(e){const i=e.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(i)return new xa(OU(i[1],i[2]))}return null}constructor(e){super(),this.fixed=e}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${OP(this.fixed,"narrow")}`}get ianaName(){return this.fixed===0?"Etc/UTC":`Etc/GMT${OP(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(e,i){return OP(this.fixed,i)}get isUniversal(){return!0}offset(){return this.fixed}equals(e){return e.type==="fixed"&&e.fixed===this.fixed}get isValid(){return!0}}class GHe extends a2{constructor(e){super(),this.zoneName=e}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function v_(t,e){if(oi(t)||t===null)return e;if(t instanceof a2)return t;if(XHe(t)){const i=t.toLowerCase();return i==="default"?e:i==="local"||i==="system"?MU.instance:i==="utc"||i==="gmt"?xa.utcInstance:xa.parseSpecifier(i)||Fc.create(t)}else return j_(t)?xa.instance(t):typeof t=="object"&&"offset"in t&&typeof t.offset=="function"?t:new GHe(t)}const fee={arab:"[-]",arabext:"[-]",bali:"[-]",beng:"[-]",deva:"[-]",fullwide:"[-]",gujr:"[-]",hanidec:"[|||||||||]",khmr:"[-]",knda:"[-]",laoo:"[-]",limb:"[-]",mlym:"[-]",mong:"[-]",mymr:"[-]",orya:"[-]",tamldec:"[-]",telu:"[-]",thai:"[-]",tibt:"[-]",latn:"\\d"},che={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},HHe=fee.hanidec.replace(/[\[|\]]/g,"").split("");function WHe(t){let e=parseInt(t,10);if(isNaN(e)){e="";for(let i=0;i<t.length;i++){const r=t.charCodeAt(i);if(t[i].search(fee.hanidec)!==-1)e+=HHe.indexOf(t[i]);else for(const s in che){const[n,a]=che[s];r>=n&&r<=a&&(e+=r-n)}}return parseInt(e,10)}else return e}const HW=new Map;function ZHe(){HW.clear()}function gd({numberingSystem:t},e=""){const i=t||"latn";let r=HW.get(i);r===void 0&&(r=new Map,HW.set(i,r));let s=r.get(e);return s===void 0&&(s=new RegExp(`${fee[i]}${e}`),r.set(e,s)),s}let uhe=()=>Date.now(),hhe="system",dhe=null,phe=null,fhe=null,mhe=60,ghe,yhe=null;class Cn{static get now(){return uhe}static set now(e){uhe=e}static set defaultZone(e){hhe=e}static get defaultZone(){return v_(hhe,MU.instance)}static get defaultLocale(){return dhe}static set defaultLocale(e){dhe=e}static get defaultNumberingSystem(){return phe}static set defaultNumberingSystem(e){phe=e}static get defaultOutputCalendar(){return fhe}static set defaultOutputCalendar(e){fhe=e}static get defaultWeekSettings(){return yhe}static set defaultWeekSettings(e){yhe=WW(e)}static get twoDigitCutoffYear(){return mhe}static set twoDigitCutoffYear(e){mhe=e%100}static get throwOnInvalid(){return ghe}static set throwOnInvalid(e){ghe=e}static resetCaches(){jr.resetCache(),Fc.resetCache(),lt.resetCache(),ZHe()}}class sp{constructor(e,i){this.reason=e,this.explanation=i}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}const zSe=[0,31,59,90,120,151,181,212,243,273,304,334],FSe=[0,31,60,91,121,152,182,213,244,274,305,335];function Bh(t,e){return new sp("unit out of range",`you specified ${e} (of type ${typeof e}) as a ${t}, which is invalid`)}function mee(t,e,i){const r=new Date(Date.UTC(t,e-1,i));t<100&&t>=0&&r.setUTCFullYear(r.getUTCFullYear()-1900);const s=r.getUTCDay();return s===0?7:s}function NSe(t,e,i){return i+(t4(t)?FSe:zSe)[e-1]}function VSe(t,e){const i=t4(t)?FSe:zSe,r=i.findIndex(n=>n<e),s=e-i[r];return{month:r+1,day:s}}function gee(t,e){return(t-e+7)%7+1}function s6(t,e=4,i=1){const{year:r,month:s,day:n}=t,a=NSe(r,s,n),o=gee(mee(r,s,n),i);let l=Math.floor((a-o+14-e)/7),c;return l<1?(c=r-1,l=NR(c,e,i)):l>NR(r,e,i)?(c=r+1,l=1):c=r,{weekYear:c,weekNumber:l,weekday:o,...PU(t)}}function _he(t,e=4,i=1){const{weekYear:r,weekNumber:s,weekday:n}=t,a=gee(mee(r,1,e),i),o=W3(r);let l=s*7+n-a-7+e,c;l<1?(c=r-1,l+=W3(c)):l>o?(c=r+1,l-=W3(r)):c=r;const{month:h,day:f}=VSe(c,l);return{year:c,month:h,day:f,...PU(t)}}function t7(t){const{year:e,month:i,day:r}=t,s=NSe(e,i,r);return{year:e,ordinal:s,...PU(t)}}function vhe(t){const{year:e,ordinal:i}=t,{month:r,day:s}=VSe(e,i);return{year:e,month:r,day:s,...PU(t)}}function bhe(t,e){if(!oi(t.localWeekday)||!oi(t.localWeekNumber)||!oi(t.localWeekYear)){if(!oi(t.weekday)||!oi(t.weekNumber)||!oi(t.weekYear))throw new c3("Cannot mix locale-based week fields with ISO-based week fields");return oi(t.localWeekday)||(t.weekday=t.localWeekday),oi(t.localWeekNumber)||(t.weekNumber=t.localWeekNumber),oi(t.localWeekYear)||(t.weekYear=t.localWeekYear),delete t.localWeekday,delete t.localWeekNumber,delete t.localWeekYear,{minDaysInFirstWeek:e.getMinDaysInFirstWeek(),startOfWeek:e.getStartOfWeek()}}else return{minDaysInFirstWeek:4,startOfWeek:1}}function YHe(t,e=4,i=1){const r=EU(t.weekYear),s=jh(t.weekNumber,1,NR(t.weekYear,e,i)),n=jh(t.weekday,1,7);return r?s?n?!1:Bh("weekday",t.weekday):Bh("week",t.weekNumber):Bh("weekYear",t.weekYear)}function QHe(t){const e=EU(t.year),i=jh(t.ordinal,1,W3(t.year));return e?i?!1:Bh("ordinal",t.ordinal):Bh("year",t.year)}function USe(t){const e=EU(t.year),i=jh(t.month,1,12),r=jh(t.day,1,n6(t.year,t.month));return e?i?r?!1:Bh("day",t.day):Bh("month",t.month):Bh("year",t.year)}function BSe(t){const{hour:e,minute:i,second:r,millisecond:s}=t,n=jh(e,0,23)||e===24&&i===0&&r===0&&s===0,a=jh(i,0,59),o=jh(r,0,59),l=jh(s,0,999);return n?a?o?l?!1:Bh("millisecond",s):Bh("second",r):Bh("minute",i):Bh("hour",e)}function oi(t){return typeof t>"u"}function j_(t){return typeof t=="number"}function EU(t){return typeof t=="number"&&t%1===0}function XHe(t){return typeof t=="string"}function JHe(t){return Object.prototype.toString.call(t)==="[object Date]"}function jSe(){try{return typeof Intl<"u"&&!!Intl.RelativeTimeFormat}catch{return!1}}function qSe(){try{return typeof Intl<"u"&&!!Intl.Locale&&("weekInfo"in Intl.Locale.prototype||"getWeekInfo"in Intl.Locale.prototype)}catch{return!1}}function KHe(t){return Array.isArray(t)?t:[t]}function whe(t,e,i){if(t.length!==0)return t.reduce((r,s)=>{const n=[e(s),s];return r&&i(r[0],n[0])===r[0]?r:n},null)[1]}function eWe(t,e){return e.reduce((i,r)=>(i[r]=t[r],i),{})}function xC(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function WW(t){if(t==null)return null;if(typeof t!="object")throw new Xo("Week settings must be an object");if(!jh(t.firstDay,1,7)||!jh(t.minimalDays,1,7)||!Array.isArray(t.weekend)||t.weekend.some(e=>!jh(e,1,7)))throw new Xo("Invalid week settings");return{firstDay:t.firstDay,minimalDays:t.minimalDays,weekend:Array.from(t.weekend)}}function jh(t,e,i){return EU(t)&&t>=e&&t<=i}function tWe(t,e){return t-e*Math.floor(t/e)}function _a(t,e=2){const i=t<0;let r;return i?r="-"+(""+-t).padStart(e,"0"):r=(""+t).padStart(e,"0"),r}function u_(t){if(!(oi(t)||t===null||t===""))return parseInt(t,10)}function b1(t){if(!(oi(t)||t===null||t===""))return parseFloat(t)}function yee(t){if(!(oi(t)||t===null||t==="")){const e=parseFloat("0."+t)*1e3;return Math.floor(e)}}function _ee(t,e,i="round"){const r=10**e;switch(i){case"expand":return t>0?Math.ceil(t*r)/r:Math.floor(t*r)/r;case"trunc":return Math.trunc(t*r)/r;case"round":return Math.round(t*r)/r;case"floor":return Math.floor(t*r)/r;case"ceil":return Math.ceil(t*r)/r;default:throw new RangeError(`Value rounding ${i} is out of range`)}}function t4(t){return t%4===0&&(t%100!==0||t%400===0)}function W3(t){return t4(t)?366:365}function n6(t,e){const i=tWe(e-1,12)+1,r=t+(e-i)/12;return i===2?t4(r)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][i-1]}function AU(t){let e=Date.UTC(t.year,t.month-1,t.day,t.hour,t.minute,t.second,t.millisecond);return t.year<100&&t.year>=0&&(e=new Date(e),e.setUTCFullYear(t.year,t.month-1,t.day)),+e}function xhe(t,e,i){return-gee(mee(t,1,e),i)+e-1}function NR(t,e=4,i=1){const r=xhe(t,e,i),s=xhe(t+1,e,i);return(W3(t)-r+s)/7}function ZW(t){return t>99?t:t>Cn.twoDigitCutoffYear?1900+t:2e3+t}function GSe(t,e,i,r=null){const s=new Date(t),n={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};r&&(n.timeZone=r);const a={timeZoneName:e,...n},o=new Intl.DateTimeFormat(i,a).formatToParts(s).find(l=>l.type.toLowerCase()==="timezonename");return o?o.value:null}function OU(t,e){let i=parseInt(t,10);Number.isNaN(i)&&(i=0);const r=parseInt(e,10)||0,s=i<0||Object.is(i,-0)?-r:r;return i*60+s}function HSe(t){const e=Number(t);if(typeof t=="boolean"||t===""||!Number.isFinite(e))throw new Xo(`Invalid unit value ${t}`);return e}function a6(t,e){const i={};for(const r in t)if(xC(t,r)){const s=t[r];if(s==null)continue;i[e(r)]=HSe(s)}return i}function OP(t,e){const i=Math.trunc(Math.abs(t/60)),r=Math.trunc(Math.abs(t%60)),s=t>=0?"+":"-";switch(e){case"short":return`${s}${_a(i,2)}:${_a(r,2)}`;case"narrow":return`${s}${i}${r>0?`:${r}`:""}`;case"techie":return`${s}${_a(i,2)}${_a(r,2)}`;default:throw new RangeError(`Value format ${e} is out of range for property format`)}}function PU(t){return eWe(t,["hour","minute","second","millisecond"])}const iWe=["January","February","March","April","May","June","July","August","September","October","November","December"],WSe=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],rWe=["J","F","M","A","M","J","J","A","S","O","N","D"];function ZSe(t){switch(t){case"narrow":return[...rWe];case"short":return[...WSe];case"long":return[...iWe];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const YSe=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],QSe=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],sWe=["M","T","W","T","F","S","S"];function XSe(t){switch(t){case"narrow":return[...sWe];case"short":return[...QSe];case"long":return[...YSe];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const JSe=["AM","PM"],nWe=["Before Christ","Anno Domini"],aWe=["BC","AD"],oWe=["B","A"];function KSe(t){switch(t){case"narrow":return[...oWe];case"short":return[...aWe];case"long":return[...nWe];default:return null}}function lWe(t){return JSe[t.hour<12?0:1]}function cWe(t,e){return XSe(e)[t.weekday-1]}function uWe(t,e){return ZSe(e)[t.month-1]}function hWe(t,e){return KSe(e)[t.year<0?0:1]}function dWe(t,e,i="always",r=!1){const s={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},n=["hours","minutes","seconds"].indexOf(t)===-1;if(i==="auto"&&n){const f=t==="days";switch(e){case 1:return f?"tomorrow":`next ${s[t][0]}`;case-1:return f?"yesterday":`last ${s[t][0]}`;case 0:return f?"today":`this ${s[t][0]}`}}const a=Object.is(e,-0)||e<0,o=Math.abs(e),l=o===1,c=s[t],h=r?l?c[1]:c[2]||c[1]:l?s[t][0]:t;return a?`${o} ${h} ago`:`in ${o} ${h}`}function She(t,e){let i="";for(const r of t)r.literal?i+=r.val:i+=e(r.val);return i}const pWe={D:r6,DD:gSe,DDD:ySe,DDDD:_Se,t:vSe,tt:bSe,ttt:wSe,tttt:xSe,T:SSe,TT:TSe,TTT:$Se,TTTT:CSe,f:MSe,ff:ASe,fff:PSe,ffff:DSe,F:ESe,FF:OSe,FFF:RSe,FFFF:ISe};class il{static create(e,i={}){return new il(e,i)}static parseFormat(e){let i=null,r="",s=!1;const n=[];for(let a=0;a<e.length;a++){const o=e.charAt(a);o==="'"?((r.length>0||s)&&n.push({literal:s||/^\s+$/.test(r),val:r===""?"'":r}),i=null,r="",s=!s):s||o===i?r+=o:(r.length>0&&n.push({literal:/^\s+$/.test(r),val:r}),r=o,i=o)}return r.length>0&&n.push({literal:s||/^\s+$/.test(r),val:r}),n}static macroTokenToFormatOpts(e){return pWe[e]}constructor(e,i){this.opts=i,this.loc=e,this.systemLoc=null}formatWithSystemDefault(e,i){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(e,{...this.opts,...i}).format()}dtFormatter(e,i={}){return this.loc.dtFormatter(e,{...this.opts,...i})}formatDateTime(e,i){return this.dtFormatter(e,i).format()}formatDateTimeParts(e,i){return this.dtFormatter(e,i).formatToParts()}formatInterval(e,i){return this.dtFormatter(e.start,i).dtf.formatRange(e.start.toJSDate(),e.end.toJSDate())}resolvedOptions(e,i){return this.dtFormatter(e,i).resolvedOptions()}num(e,i=0,r=void 0){if(this.opts.forceSimple)return _a(e,i);const s={...this.opts};return i>0&&(s.padTo=i),r&&(s.signDisplay=r),this.loc.numberFormatter(s).format(e)}formatDateTimeFromString(e,i){const r=this.loc.listingMode()==="en",s=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",n=(_,w)=>this.loc.extract(e,_,w),a=_=>e.isOffsetFixed&&e.offset===0&&_.allowZ?"Z":e.isValid?e.zone.formatOffset(e.ts,_.format):"",o=()=>r?lWe(e):n({hour:"numeric",hourCycle:"h12"},"dayperiod"),l=(_,w)=>r?uWe(e,_):n(w?{month:_}:{month:_,day:"numeric"},"month"),c=(_,w)=>r?cWe(e,_):n(w?{weekday:_}:{weekday:_,month:"long",day:"numeric"},"weekday"),h=_=>{const w=il.macroTokenToFormatOpts(_);return w?this.formatWithSystemDefault(e,w):_},f=_=>r?hWe(e,_):n({era:_},"era"),y=_=>{switch(_){case"S":return this.num(e.millisecond);case"u":case"SSS":return this.num(e.millisecond,3);case"s":return this.num(e.second);case"ss":return this.num(e.second,2);case"uu":return this.num(Math.floor(e.millisecond/10),2);case"uuu":return this.num(Math.floor(e.millisecond/100));case"m":return this.num(e.minute);case"mm":return this.num(e.minute,2);case"h":return this.num(e.hour%12===0?12:e.hour%12);case"hh":return this.num(e.hour%12===0?12:e.hour%12,2);case"H":return this.num(e.hour);case"HH":return this.num(e.hour,2);case"Z":return a({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return a({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return a({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return e.zone.offsetName(e.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return e.zone.offsetName(e.ts,{format:"long",locale:this.loc.locale});case"z":return e.zoneName;case"a":return o();case"d":return s?n({day:"numeric"},"day"):this.num(e.day);case"dd":return s?n({day:"2-digit"},"day"):this.num(e.day,2);case"c":return this.num(e.weekday);case"ccc":return c("short",!0);case"cccc":return c("long",!0);case"ccccc":return c("narrow",!0);case"E":return this.num(e.weekday);case"EEE":return c("short",!1);case"EEEE":return c("long",!1);case"EEEEE":return c("narrow",!1);case"L":return s?n({month:"numeric",day:"numeric"},"month"):this.num(e.month);case"LL":return s?n({month:"2-digit",day:"numeric"},"month"):this.num(e.month,2);case"LLL":return l("short",!0);case"LLLL":return l("long",!0);case"LLLLL":return l("narrow",!0);case"M":return s?n({month:"numeric"},"month"):this.num(e.month);case"MM":return s?n({month:"2-digit"},"month"):this.num(e.month,2);case"MMM":return l("short",!1);case"MMMM":return l("long",!1);case"MMMMM":return l("narrow",!1);case"y":return s?n({year:"numeric"},"year"):this.num(e.year);case"yy":return s?n({year:"2-digit"},"year"):this.num(e.year.toString().slice(-2),2);case"yyyy":return s?n({year:"numeric"},"year"):this.num(e.year,4);case"yyyyyy":return s?n({year:"numeric"},"year"):this.num(e.year,6);case"G":return f("short");case"GG":return f("long");case"GGGGG":return f("narrow");case"kk":return this.num(e.weekYear.toString().slice(-2),2);case"kkkk":return this.num(e.weekYear,4);case"W":return this.num(e.weekNumber);case"WW":return this.num(e.weekNumber,2);case"n":return this.num(e.localWeekNumber);case"nn":return this.num(e.localWeekNumber,2);case"ii":return this.num(e.localWeekYear.toString().slice(-2),2);case"iiii":return this.num(e.localWeekYear,4);case"o":return this.num(e.ordinal);case"ooo":return this.num(e.ordinal,3);case"q":return this.num(e.quarter);case"qq":return this.num(e.quarter,2);case"X":return this.num(Math.floor(e.ts/1e3));case"x":return this.num(e.ts);default:return h(_)}};return She(il.parseFormat(i),y)}formatDurationFromString(e,i){const r=this.opts.signMode==="negativeLargestOnly"?-1:1,s=h=>{switch(h[0]){case"S":return"milliseconds";case"s":return"seconds";case"m":return"minutes";case"h":return"hours";case"d":return"days";case"w":return"weeks";case"M":return"months";case"y":return"years";default:return null}},n=(h,f)=>y=>{const _=s(y);if(_){const w=f.isNegativeDuration&&_!==f.largestUnit?r:1;let x;return this.opts.signMode==="negativeLargestOnly"&&_!==f.largestUnit?x="never":this.opts.signMode==="all"?x="always":x="auto",this.num(h.get(_)*w,y.length,x)}else return y},a=il.parseFormat(i),o=a.reduce((h,{literal:f,val:y})=>f?h:h.concat(y),[]),l=e.shiftTo(...o.map(s).filter(h=>h)),c={isNegativeDuration:l<0,largestUnit:Object.keys(l.values)[0]};return She(a,n(l,c))}}const eTe=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function uM(...t){const e=t.reduce((i,r)=>i+r.source,"");return RegExp(`^${e}$`)}function hM(...t){return e=>t.reduce(([i,r,s],n)=>{const[a,o,l]=n(e,s);return[{...i,...a},o||r,l]},[{},null,1]).slice(0,2)}function dM(t,...e){if(t==null)return[null,null];for(const[i,r]of e){const s=i.exec(t);if(s)return r(s)}return[null,null]}function tTe(...t){return(e,i)=>{const r={};let s;for(s=0;s<t.length;s++)r[t[s]]=u_(e[i+s]);return[r,null,i+s]}}const iTe=/(?:([Zz])|([+-]\d\d)(?::?(\d\d))?)/,fWe=`(?:${iTe.source}?(?:\\[(${eTe.source})\\])?)?`,vee=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,rTe=RegExp(`${vee.source}${fWe}`),bee=RegExp(`(?:[Tt]${rTe.source})?`),mWe=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,gWe=/(\d{4})-?W(\d\d)(?:-?(\d))?/,yWe=/(\d{4})-?(\d{3})/,_We=tTe("weekYear","weekNumber","weekDay"),vWe=tTe("year","ordinal"),bWe=/(\d{4})-(\d\d)-(\d\d)/,sTe=RegExp(`${vee.source} ?(?:${iTe.source}|(${eTe.source}))?`),wWe=RegExp(`(?: ${sTe.source})?`);function Z3(t,e,i){const r=t[e];return oi(r)?i:u_(r)}function xWe(t,e){return[{year:Z3(t,e),month:Z3(t,e+1,1),day:Z3(t,e+2,1)},null,e+3]}function pM(t,e){return[{hours:Z3(t,e,0),minutes:Z3(t,e+1,0),seconds:Z3(t,e+2,0),milliseconds:yee(t[e+3])},null,e+4]}function i4(t,e){const i=!t[e]&&!t[e+1],r=OU(t[e+1],t[e+2]),s=i?null:xa.instance(r);return[{},s,e+3]}function r4(t,e){const i=t[e]?Fc.create(t[e]):null;return[{},i,e+1]}const SWe=RegExp(`^T?${vee.source}$`),TWe=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function $We(t){const[e,i,r,s,n,a,o,l,c]=t,h=e[0]==="-",f=l&&l[0]==="-",y=(_,w=!1)=>_!==void 0&&(w||_&&h)?-_:_;return[{years:y(b1(i)),months:y(b1(r)),weeks:y(b1(s)),days:y(b1(n)),hours:y(b1(a)),minutes:y(b1(o)),seconds:y(b1(l),l==="-0"),milliseconds:y(yee(c),f)}]}const CWe={GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480};function wee(t,e,i,r,s,n,a){const o={year:e.length===2?ZW(u_(e)):u_(e),month:WSe.indexOf(i)+1,day:u_(r),hour:u_(s),minute:u_(n)};return a&&(o.second=u_(a)),t&&(o.weekday=t.length>3?YSe.indexOf(t)+1:QSe.indexOf(t)+1),o}const MWe=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function EWe(t){const[,e,i,r,s,n,a,o,l,c,h,f]=t,y=wee(e,s,r,i,n,a,o);let _;return l?_=CWe[l]:c?_=0:_=OU(h,f),[y,new xa(_)]}function AWe(t){return t.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}const OWe=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,PWe=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,RWe=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function The(t){const[,e,i,r,s,n,a,o]=t;return[wee(e,s,r,i,n,a,o),xa.utcInstance]}function DWe(t){const[,e,i,r,s,n,a,o]=t;return[wee(e,o,i,r,s,n,a),xa.utcInstance]}const IWe=uM(mWe,bee),LWe=uM(gWe,bee),kWe=uM(yWe,bee),zWe=uM(rTe),nTe=hM(xWe,pM,i4,r4),FWe=hM(_We,pM,i4,r4),NWe=hM(vWe,pM,i4,r4),VWe=hM(pM,i4,r4);function UWe(t){return dM(t,[IWe,nTe],[LWe,FWe],[kWe,NWe],[zWe,VWe])}function BWe(t){return dM(AWe(t),[MWe,EWe])}function jWe(t){return dM(t,[OWe,The],[PWe,The],[RWe,DWe])}function qWe(t){return dM(t,[TWe,$We])}const GWe=hM(pM);function HWe(t){return dM(t,[SWe,GWe])}const WWe=uM(bWe,wWe),ZWe=uM(sTe),YWe=hM(pM,i4,r4);function QWe(t){return dM(t,[WWe,nTe],[ZWe,YWe])}const $he="Invalid Duration",aTe={weeks:{days:7,hours:168,minutes:10080,seconds:10080*60,milliseconds:10080*60*1e3},days:{hours:24,minutes:1440,seconds:1440*60,milliseconds:1440*60*1e3},hours:{minutes:60,seconds:3600,milliseconds:3600*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},XWe={years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:2184,minutes:2184*60,seconds:2184*60*60,milliseconds:2184*60*60*1e3},months:{weeks:4,days:30,hours:720,minutes:720*60,seconds:720*60*60,milliseconds:720*60*60*1e3},...aTe},ih=146097/400,sS=146097/4800,JWe={years:{quarters:4,months:12,weeks:ih/7,days:ih,hours:ih*24,minutes:ih*24*60,seconds:ih*24*60*60,milliseconds:ih*24*60*60*1e3},quarters:{months:3,weeks:ih/28,days:ih/4,hours:ih*24/4,minutes:ih*24*60/4,seconds:ih*24*60*60/4,milliseconds:ih*24*60*60*1e3/4},months:{weeks:sS/7,days:sS,hours:sS*24,minutes:sS*24*60,seconds:sS*24*60*60,milliseconds:sS*24*60*60*1e3},...aTe},Qb=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],KWe=Qb.slice(0).reverse();function Cm(t,e,i=!1){const r={values:i?e.values:{...t.values,...e.values||{}},loc:t.loc.clone(e.loc),conversionAccuracy:e.conversionAccuracy||t.conversionAccuracy,matrix:e.matrix||t.matrix};return new xr(r)}function oTe(t,e){let i=e.milliseconds??0;for(const r of KWe.slice(1))e[r]&&(i+=e[r]*t[r].milliseconds);return i}function Che(t,e){const i=oTe(t,e)<0?-1:1;Qb.reduceRight((r,s)=>{if(oi(e[s]))return r;if(r){const n=e[r]*i,a=t[s][r],o=Math.floor(n/a);e[s]+=o*i,e[r]-=o*a*i}return s},null),Qb.reduce((r,s)=>{if(oi(e[s]))return r;if(r){const n=e[r]%1;e[r]-=n,e[s]+=n*t[r][s]}return s},null)}function Mhe(t){const e={};for(const[i,r]of Object.entries(t))r!==0&&(e[i]=r);return e}class xr{constructor(e){const i=e.conversionAccuracy==="longterm"||!1;let r=i?JWe:XWe;e.matrix&&(r=e.matrix),this.values=e.values,this.loc=e.loc||jr.create(),this.conversionAccuracy=i?"longterm":"casual",this.invalid=e.invalid||null,this.matrix=r,this.isLuxonDuration=!0}static fromMillis(e,i){return xr.fromObject({milliseconds:e},i)}static fromObject(e,i={}){if(e==null||typeof e!="object")throw new Xo(`Duration.fromObject: argument expected to be an object, got ${e===null?"null":typeof e}`);return new xr({values:a6(e,xr.normalizeUnit),loc:jr.fromObject(i),conversionAccuracy:i.conversionAccuracy,matrix:i.matrix})}static fromDurationLike(e){if(j_(e))return xr.fromMillis(e);if(xr.isDuration(e))return e;if(typeof e=="object")return xr.fromObject(e);throw new Xo(`Unknown duration argument ${e} of type ${typeof e}`)}static fromISO(e,i){const[r]=qWe(e);return r?xr.fromObject(r,i):xr.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static fromISOTime(e,i){const[r]=HWe(e);return r?xr.fromObject(r,i):xr.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static invalid(e,i=null){if(!e)throw new Xo("need to specify a reason the Duration is invalid");const r=e instanceof sp?e:new sp(e,i);if(Cn.throwOnInvalid)throw new $He(r);return new xr({invalid:r})}static normalizeUnit(e){const i={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[e&&e.toLowerCase()];if(!i)throw new mSe(e);return i}static isDuration(e){return e&&e.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(e,i={}){const r={...i,floor:i.round!==!1&&i.floor!==!1};return this.isValid?il.create(this.loc,r).formatDurationFromString(this,e):$he}toHuman(e={}){if(!this.isValid)return $he;const i=e.showZeros!==!1,r=Qb.map(s=>{const n=this.values[s];return oi(n)||n===0&&!i?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...e,unit:s.slice(0,-1)}).format(n)}).filter(s=>s);return this.loc.listFormatter({type:"conjunction",style:e.listStyle||"narrow",...e}).format(r)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let e="P";return this.years!==0&&(e+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(e+=this.months+this.quarters*3+"M"),this.weeks!==0&&(e+=this.weeks+"W"),this.days!==0&&(e+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(e+="T"),this.hours!==0&&(e+=this.hours+"H"),this.minutes!==0&&(e+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(e+=_ee(this.seconds+this.milliseconds/1e3,3)+"S"),e==="P"&&(e+="T0S"),e}toISOTime(e={}){if(!this.isValid)return null;const i=this.toMillis();return i<0||i>=864e5?null:(e={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...e,includeOffset:!1},lt.fromMillis(i,{zone:"UTC"}).toISOTime(e))}toJSON(){return this.toISO()}toString(){return this.toISO()}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`Duration { values: ${JSON.stringify(this.values)} }`:`Duration { Invalid, reason: ${this.invalidReason} }`}toMillis(){return this.isValid?oTe(this.matrix,this.values):NaN}valueOf(){return this.toMillis()}plus(e){if(!this.isValid)return this;const i=xr.fromDurationLike(e),r={};for(const s of Qb)(xC(i.values,s)||xC(this.values,s))&&(r[s]=i.get(s)+this.get(s));return Cm(this,{values:r},!0)}minus(e){if(!this.isValid)return this;const i=xr.fromDurationLike(e);return this.plus(i.negate())}mapUnits(e){if(!this.isValid)return this;const i={};for(const r of Object.keys(this.values))i[r]=HSe(e(this.values[r],r));return Cm(this,{values:i},!0)}get(e){return this[xr.normalizeUnit(e)]}set(e){if(!this.isValid)return this;const i={...this.values,...a6(e,xr.normalizeUnit)};return Cm(this,{values:i})}reconfigure({locale:e,numberingSystem:i,conversionAccuracy:r,matrix:s}={}){const a={loc:this.loc.clone({locale:e,numberingSystem:i}),matrix:s,conversionAccuracy:r};return Cm(this,a)}as(e){return this.isValid?this.shiftTo(e).get(e):NaN}normalize(){if(!this.isValid)return this;const e=this.toObject();return Che(this.matrix,e),Cm(this,{values:e},!0)}rescale(){if(!this.isValid)return this;const e=Mhe(this.normalize().shiftToAll().toObject());return Cm(this,{values:e},!0)}shiftTo(...e){if(!this.isValid)return this;if(e.length===0)return this;e=e.map(a=>xr.normalizeUnit(a));const i={},r={},s=this.toObject();let n;for(const a of Qb)if(e.indexOf(a)>=0){n=a;let o=0;for(const c in r)o+=this.matrix[c][a]*r[c],r[c]=0;j_(s[a])&&(o+=s[a]);const l=Math.trunc(o);i[a]=l,r[a]=(o*1e3-l*1e3)/1e3}else j_(s[a])&&(r[a]=s[a]);for(const a in r)r[a]!==0&&(i[n]+=a===n?r[a]:r[a]/this.matrix[n][a]);return Che(this.matrix,i),Cm(this,{values:i},!0)}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;const e={};for(const i of Object.keys(this.values))e[i]=this.values[i]===0?0:-this.values[i];return Cm(this,{values:e},!0)}removeZeros(){if(!this.isValid)return this;const e=Mhe(this.values);return Cm(this,{values:e},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(e){if(!this.isValid||!e.isValid||!this.loc.equals(e.loc))return!1;function i(r,s){return r===void 0||r===0?s===void 0||s===0:r===s}for(const r of Qb)if(!i(this.values[r],e.values[r]))return!1;return!0}}const nS="Invalid Interval";function eZe(t,e){return!t||!t.isValid?Sn.invalid("missing or invalid start"):!e||!e.isValid?Sn.invalid("missing or invalid end"):e<t?Sn.invalid("end before start",`The end of an interval must be after its start, but you had start=${t.toISO()} and end=${e.toISO()}`):null}class Sn{constructor(e){this.s=e.start,this.e=e.end,this.invalid=e.invalid||null,this.isLuxonInterval=!0}static invalid(e,i=null){if(!e)throw new Xo("need to specify a reason the Interval is invalid");const r=e instanceof sp?e:new sp(e,i);if(Cn.throwOnInvalid)throw new THe(r);return new Sn({invalid:r})}static fromDateTimes(e,i){const r=PE(e),s=PE(i),n=eZe(r,s);return n??new Sn({start:r,end:s})}static after(e,i){const r=xr.fromDurationLike(i),s=PE(e);return Sn.fromDateTimes(s,s.plus(r))}static before(e,i){const r=xr.fromDurationLike(i),s=PE(e);return Sn.fromDateTimes(s.minus(r),s)}static fromISO(e,i){const[r,s]=(e||"").split("/",2);if(r&&s){let n,a;try{n=lt.fromISO(r,i),a=n.isValid}catch{a=!1}let o,l;try{o=lt.fromISO(s,i),l=o.isValid}catch{l=!1}if(a&&l)return Sn.fromDateTimes(n,o);if(a){const c=xr.fromISO(s,i);if(c.isValid)return Sn.after(n,c)}else if(l){const c=xr.fromISO(r,i);if(c.isValid)return Sn.before(o,c)}}return Sn.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static isInterval(e){return e&&e.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get lastDateTime(){return this.isValid&&this.e?this.e.minus(1):null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(e="milliseconds"){return this.isValid?this.toDuration(e).get(e):NaN}count(e="milliseconds",i){if(!this.isValid)return NaN;const r=this.start.startOf(e,i);let s;return i?.useLocaleWeeks?s=this.end.reconfigure({locale:r.locale}):s=this.end,s=s.startOf(e,i),Math.floor(s.diff(r,e).get(e))+(s.valueOf()!==this.end.valueOf())}hasSame(e){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,e):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(e){return this.isValid?this.s>e:!1}isBefore(e){return this.isValid?this.e<=e:!1}contains(e){return this.isValid?this.s<=e&&this.e>e:!1}set({start:e,end:i}={}){return this.isValid?Sn.fromDateTimes(e||this.s,i||this.e):this}splitAt(...e){if(!this.isValid)return[];const i=e.map(PE).filter(a=>this.contains(a)).sort((a,o)=>a.toMillis()-o.toMillis()),r=[];let{s}=this,n=0;for(;s<this.e;){const a=i[n]||this.e,o=+a>+this.e?this.e:a;r.push(Sn.fromDateTimes(s,o)),s=o,n+=1}return r}splitBy(e){const i=xr.fromDurationLike(e);if(!this.isValid||!i.isValid||i.as("milliseconds")===0)return[];let{s:r}=this,s=1,n;const a=[];for(;r<this.e;){const o=this.start.plus(i.mapUnits(l=>l*s));n=+o>+this.e?this.e:o,a.push(Sn.fromDateTimes(r,n)),r=n,s+=1}return a}divideEqually(e){return this.isValid?this.splitBy(this.length()/e).slice(0,e):[]}overlaps(e){return this.e>e.s&&this.s<e.e}abutsStart(e){return this.isValid?+this.e==+e.s:!1}abutsEnd(e){return this.isValid?+e.e==+this.s:!1}engulfs(e){return this.isValid?this.s<=e.s&&this.e>=e.e:!1}equals(e){return!this.isValid||!e.isValid?!1:this.s.equals(e.s)&&this.e.equals(e.e)}intersection(e){if(!this.isValid)return this;const i=this.s>e.s?this.s:e.s,r=this.e<e.e?this.e:e.e;return i>=r?null:Sn.fromDateTimes(i,r)}union(e){if(!this.isValid)return this;const i=this.s<e.s?this.s:e.s,r=this.e>e.e?this.e:e.e;return Sn.fromDateTimes(i,r)}static merge(e){const[i,r]=e.sort((s,n)=>s.s-n.s).reduce(([s,n],a)=>n?n.overlaps(a)||n.abutsStart(a)?[s,n.union(a)]:[s.concat([n]),a]:[s,a],[[],null]);return r&&i.push(r),i}static xor(e){let i=null,r=0;const s=[],n=e.map(l=>[{time:l.s,type:"s"},{time:l.e,type:"e"}]),a=Array.prototype.concat(...n),o=a.sort((l,c)=>l.time-c.time);for(const l of o)r+=l.type==="s"?1:-1,r===1?i=l.time:(i&&+i!=+l.time&&s.push(Sn.fromDateTimes(i,l.time)),i=null);return Sn.merge(s)}difference(...e){return Sn.xor([this].concat(e)).map(i=>this.intersection(i)).filter(i=>i&&!i.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()}  ${this.e.toISO()})`:nS}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`Interval { start: ${this.s.toISO()}, end: ${this.e.toISO()} }`:`Interval { Invalid, reason: ${this.invalidReason} }`}toLocaleString(e=r6,i={}){return this.isValid?il.create(this.s.loc.clone(i),e).formatInterval(this):nS}toISO(e){return this.isValid?`${this.s.toISO(e)}/${this.e.toISO(e)}`:nS}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:nS}toISOTime(e){return this.isValid?`${this.s.toISOTime(e)}/${this.e.toISOTime(e)}`:nS}toFormat(e,{separator:i="  "}={}){return this.isValid?`${this.s.toFormat(e)}${i}${this.e.toFormat(e)}`:nS}toDuration(e,i){return this.isValid?this.e.diff(this.s,e,i):xr.invalid(this.invalidReason)}mapEndpoints(e){return Sn.fromDateTimes(e(this.s),e(this.e))}}class o5{static hasDST(e=Cn.defaultZone){const i=lt.now().setZone(e).set({month:12});return!e.isUniversal&&i.offset!==i.set({month:6}).offset}static isValidIANAZone(e){return Fc.isValidZone(e)}static normalizeZone(e){return v_(e,Cn.defaultZone)}static getStartOfWeek({locale:e=null,locObj:i=null}={}){return(i||jr.create(e)).getStartOfWeek()}static getMinimumDaysInFirstWeek({locale:e=null,locObj:i=null}={}){return(i||jr.create(e)).getMinDaysInFirstWeek()}static getWeekendWeekdays({locale:e=null,locObj:i=null}={}){return(i||jr.create(e)).getWeekendDays().slice()}static months(e="long",{locale:i=null,numberingSystem:r=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||jr.create(i,r,n)).months(e)}static monthsFormat(e="long",{locale:i=null,numberingSystem:r=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||jr.create(i,r,n)).months(e,!0)}static weekdays(e="long",{locale:i=null,numberingSystem:r=null,locObj:s=null}={}){return(s||jr.create(i,r,null)).weekdays(e)}static weekdaysFormat(e="long",{locale:i=null,numberingSystem:r=null,locObj:s=null}={}){return(s||jr.create(i,r,null)).weekdays(e,!0)}static meridiems({locale:e=null}={}){return jr.create(e).meridiems()}static eras(e="short",{locale:i=null}={}){return jr.create(i,null,"gregory").eras(e)}static features(){return{relative:jSe(),localeWeek:qSe()}}}function Ehe(t,e){const i=s=>s.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),r=i(e)-i(t);return Math.floor(xr.fromMillis(r).as("days"))}function tZe(t,e,i){const r=[["years",(l,c)=>c.year-l.year],["quarters",(l,c)=>c.quarter-l.quarter+(c.year-l.year)*4],["months",(l,c)=>c.month-l.month+(c.year-l.year)*12],["weeks",(l,c)=>{const h=Ehe(l,c);return(h-h%7)/7}],["days",Ehe]],s={},n=t;let a,o;for(const[l,c]of r)i.indexOf(l)>=0&&(a=l,s[l]=c(t,e),o=n.plus(s),o>e?(s[l]--,t=n.plus(s),t>e&&(o=t,s[l]--,t=n.plus(s))):t=o);return[t,s,o,a]}function iZe(t,e,i,r){let[s,n,a,o]=tZe(t,e,i);const l=e-s,c=i.filter(f=>["hours","minutes","seconds","milliseconds"].indexOf(f)>=0);c.length===0&&(a<e&&(a=s.plus({[o]:1})),a!==s&&(n[o]=(n[o]||0)+l/(a-s)));const h=xr.fromObject(n,r);return c.length>0?xr.fromMillis(l,r).shiftTo(...c).plus(h):h}const rZe="missing Intl.DateTimeFormat.formatToParts support";function kr(t,e=i=>i){return{regex:t,deser:([i])=>e(WHe(i))}}const sZe="",lTe=`[ ${sZe}]`,cTe=new RegExp(lTe,"g");function nZe(t){return t.replace(/\./g,"\\.?").replace(cTe,lTe)}function Ahe(t){return t.replace(/\./g,"").replace(cTe," ").toLowerCase()}function yd(t,e){return t===null?null:{regex:RegExp(t.map(nZe).join("|")),deser:([i])=>t.findIndex(r=>Ahe(i)===Ahe(r))+e}}function Ohe(t,e){return{regex:t,deser:([,i,r])=>OU(i,r),groups:e}}function l5(t){return{regex:t,deser:([e])=>e}}function aZe(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function oZe(t,e){const i=gd(e),r=gd(e,"{2}"),s=gd(e,"{3}"),n=gd(e,"{4}"),a=gd(e,"{6}"),o=gd(e,"{1,2}"),l=gd(e,"{1,3}"),c=gd(e,"{1,6}"),h=gd(e,"{1,9}"),f=gd(e,"{2,4}"),y=gd(e,"{4,6}"),_=S=>({regex:RegExp(aZe(S.val)),deser:([$])=>$,literal:!0}),x=(S=>{if(t.literal)return _(S);switch(S.val){case"G":return yd(e.eras("short"),0);case"GG":return yd(e.eras("long"),0);case"y":return kr(c);case"yy":return kr(f,ZW);case"yyyy":return kr(n);case"yyyyy":return kr(y);case"yyyyyy":return kr(a);case"M":return kr(o);case"MM":return kr(r);case"MMM":return yd(e.months("short",!0),1);case"MMMM":return yd(e.months("long",!0),1);case"L":return kr(o);case"LL":return kr(r);case"LLL":return yd(e.months("short",!1),1);case"LLLL":return yd(e.months("long",!1),1);case"d":return kr(o);case"dd":return kr(r);case"o":return kr(l);case"ooo":return kr(s);case"HH":return kr(r);case"H":return kr(o);case"hh":return kr(r);case"h":return kr(o);case"mm":return kr(r);case"m":return kr(o);case"q":return kr(o);case"qq":return kr(r);case"s":return kr(o);case"ss":return kr(r);case"S":return kr(l);case"SSS":return kr(s);case"u":return l5(h);case"uu":return l5(o);case"uuu":return kr(i);case"a":return yd(e.meridiems(),0);case"kkkk":return kr(n);case"kk":return kr(f,ZW);case"W":return kr(o);case"WW":return kr(r);case"E":case"c":return kr(i);case"EEE":return yd(e.weekdays("short",!1),1);case"EEEE":return yd(e.weekdays("long",!1),1);case"ccc":return yd(e.weekdays("short",!0),1);case"cccc":return yd(e.weekdays("long",!0),1);case"Z":case"ZZ":return Ohe(new RegExp(`([+-]${o.source})(?::(${r.source}))?`),2);case"ZZZ":return Ohe(new RegExp(`([+-]${o.source})(${r.source})?`),2);case"z":return l5(/[a-z_+-/]{1,256}?/i);case" ":return l5(/[^\S\n\r]/);default:return _(S)}})(t)||{invalidReason:rZe};return x.token=t,x}const lZe={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour12:{numeric:"h","2-digit":"hh"},hour24:{numeric:"H","2-digit":"HH"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};function cZe(t,e,i){const{type:r,value:s}=t;if(r==="literal"){const l=/^\s+$/.test(s);return{literal:!l,val:l?" ":s}}const n=e[r];let a=r;r==="hour"&&(e.hour12!=null?a=e.hour12?"hour12":"hour24":e.hourCycle!=null?e.hourCycle==="h11"||e.hourCycle==="h12"?a="hour12":a="hour24":a=i.hour12?"hour12":"hour24");let o=lZe[a];if(typeof o=="object"&&(o=o[n]),o)return{literal:!1,val:o}}function uZe(t){return[`^${t.map(i=>i.regex).reduce((i,r)=>`${i}(${r.source})`,"")}$`,t]}function hZe(t,e,i){const r=t.match(e);if(r){const s={};let n=1;for(const a in i)if(xC(i,a)){const o=i[a],l=o.groups?o.groups+1:1;!o.literal&&o.token&&(s[o.token.val[0]]=o.deser(r.slice(n,n+l))),n+=l}return[r,s]}else return[r,{}]}function dZe(t){const e=n=>{switch(n){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}};let i=null,r;return oi(t.z)||(i=Fc.create(t.z)),oi(t.Z)||(i||(i=new xa(t.Z)),r=t.Z),oi(t.q)||(t.M=(t.q-1)*3+1),oi(t.h)||(t.h<12&&t.a===1?t.h+=12:t.h===12&&t.a===0&&(t.h=0)),t.G===0&&t.y&&(t.y=-t.y),oi(t.u)||(t.S=yee(t.u)),[Object.keys(t).reduce((n,a)=>{const o=e(a);return o&&(n[o]=t[a]),n},{}),i,r]}let i7=null;function pZe(){return i7||(i7=lt.fromMillis(1555555555555)),i7}function fZe(t,e){if(t.literal)return t;const i=il.macroTokenToFormatOpts(t.val),r=pTe(i,e);return r==null||r.includes(void 0)?t:r}function uTe(t,e){return Array.prototype.concat(...t.map(i=>fZe(i,e)))}class hTe{constructor(e,i){if(this.locale=e,this.format=i,this.tokens=uTe(il.parseFormat(i),e),this.units=this.tokens.map(r=>oZe(r,e)),this.disqualifyingUnit=this.units.find(r=>r.invalidReason),!this.disqualifyingUnit){const[r,s]=uZe(this.units);this.regex=RegExp(r,"i"),this.handlers=s}}explainFromTokens(e){if(this.isValid){const[i,r]=hZe(e,this.regex,this.handlers),[s,n,a]=r?dZe(r):[null,null,void 0];if(xC(r,"a")&&xC(r,"H"))throw new c3("Can't include meridiem when specifying 24-hour format");return{input:e,tokens:this.tokens,regex:this.regex,rawMatches:i,matches:r,result:s,zone:n,specificOffset:a}}else return{input:e,tokens:this.tokens,invalidReason:this.invalidReason}}get isValid(){return!this.disqualifyingUnit}get invalidReason(){return this.disqualifyingUnit?this.disqualifyingUnit.invalidReason:null}}function dTe(t,e,i){return new hTe(t,i).explainFromTokens(e)}function mZe(t,e,i){const{result:r,zone:s,specificOffset:n,invalidReason:a}=dTe(t,e,i);return[r,s,n,a]}function pTe(t,e){if(!t)return null;const r=il.create(e,t).dtFormatter(pZe()),s=r.formatToParts(),n=r.resolvedOptions();return s.map(a=>cZe(a,t,n))}const r7="Invalid DateTime",Phe=864e13;function YA(t){return new sp("unsupported zone",`the zone "${t.name}" is not supported`)}function s7(t){return t.weekData===null&&(t.weekData=s6(t.c)),t.weekData}function n7(t){return t.localWeekData===null&&(t.localWeekData=s6(t.c,t.loc.getMinDaysInFirstWeek(),t.loc.getStartOfWeek())),t.localWeekData}function w1(t,e){const i={ts:t.ts,zone:t.zone,c:t.c,o:t.o,loc:t.loc,invalid:t.invalid};return new lt({...i,...e,old:i})}function fTe(t,e,i){let r=t-e*60*1e3;const s=i.offset(r);if(e===s)return[r,e];r-=(s-e)*60*1e3;const n=i.offset(r);return s===n?[r,s]:[t-Math.min(s,n)*60*1e3,Math.max(s,n)]}function c5(t,e){t+=e*60*1e3;const i=new Date(t);return{year:i.getUTCFullYear(),month:i.getUTCMonth()+1,day:i.getUTCDate(),hour:i.getUTCHours(),minute:i.getUTCMinutes(),second:i.getUTCSeconds(),millisecond:i.getUTCMilliseconds()}}function sz(t,e,i){return fTe(AU(t),e,i)}function Rhe(t,e){const i=t.o,r=t.c.year+Math.trunc(e.years),s=t.c.month+Math.trunc(e.months)+Math.trunc(e.quarters)*3,n={...t.c,year:r,month:s,day:Math.min(t.c.day,n6(r,s))+Math.trunc(e.days)+Math.trunc(e.weeks)*7},a=xr.fromObject({years:e.years-Math.trunc(e.years),quarters:e.quarters-Math.trunc(e.quarters),months:e.months-Math.trunc(e.months),weeks:e.weeks-Math.trunc(e.weeks),days:e.days-Math.trunc(e.days),hours:e.hours,minutes:e.minutes,seconds:e.seconds,milliseconds:e.milliseconds}).as("milliseconds"),o=AU(n);let[l,c]=fTe(o,i,t.zone);return a!==0&&(l+=a,c=t.zone.offset(l)),{ts:l,o:c}}function aS(t,e,i,r,s,n){const{setZone:a,zone:o}=i;if(t&&Object.keys(t).length!==0||e){const l=e||o,c=lt.fromObject(t,{...i,zone:l,specificOffset:n});return a?c:c.setZone(o)}else return lt.invalid(new sp("unparsable",`the input "${s}" can't be parsed as ${r}`))}function u5(t,e,i=!0){return t.isValid?il.create(jr.create("en-US"),{allowZ:i,forceSimple:!0}).formatDateTimeFromString(t,e):null}function a7(t,e,i){const r=t.c.year>9999||t.c.year<0;let s="";if(r&&t.c.year>=0&&(s+="+"),s+=_a(t.c.year,r?6:4),i==="year")return s;if(e){if(s+="-",s+=_a(t.c.month),i==="month")return s;s+="-"}else if(s+=_a(t.c.month),i==="month")return s;return s+=_a(t.c.day),s}function Dhe(t,e,i,r,s,n,a){let o=!i||t.c.millisecond!==0||t.c.second!==0,l="";switch(a){case"day":case"month":case"year":break;default:if(l+=_a(t.c.hour),a==="hour")break;if(e){if(l+=":",l+=_a(t.c.minute),a==="minute")break;o&&(l+=":",l+=_a(t.c.second))}else{if(l+=_a(t.c.minute),a==="minute")break;o&&(l+=_a(t.c.second))}if(a==="second")break;o&&(!r||t.c.millisecond!==0)&&(l+=".",l+=_a(t.c.millisecond,3))}return s&&(t.isOffsetFixed&&t.offset===0&&!n?l+="Z":t.o<0?(l+="-",l+=_a(Math.trunc(-t.o/60)),l+=":",l+=_a(Math.trunc(-t.o%60))):(l+="+",l+=_a(Math.trunc(t.o/60)),l+=":",l+=_a(Math.trunc(t.o%60)))),n&&(l+="["+t.zone.ianaName+"]"),l}const mTe={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},gZe={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},yZe={ordinal:1,hour:0,minute:0,second:0,millisecond:0},nz=["year","month","day","hour","minute","second","millisecond"],_Ze=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],vZe=["year","ordinal","hour","minute","second","millisecond"];function az(t){const e={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[t.toLowerCase()];if(!e)throw new mSe(t);return e}function Ihe(t){switch(t.toLowerCase()){case"localweekday":case"localweekdays":return"localWeekday";case"localweeknumber":case"localweeknumbers":return"localWeekNumber";case"localweekyear":case"localweekyears":return"localWeekYear";default:return az(t)}}function bZe(t){if(QA===void 0&&(QA=Cn.now()),t.type!=="iana")return t.offset(QA);const e=t.name;let i=YW.get(e);return i===void 0&&(i=t.offset(QA),YW.set(e,i)),i}function Lhe(t,e){const i=v_(e.zone,Cn.defaultZone);if(!i.isValid)return lt.invalid(YA(i));const r=jr.fromObject(e);let s,n;if(oi(t.year))s=Cn.now();else{for(const l of nz)oi(t[l])&&(t[l]=mTe[l]);const a=USe(t)||BSe(t);if(a)return lt.invalid(a);const o=bZe(i);[s,n]=sz(t,o,i)}return new lt({ts:s,zone:i,loc:r,o:n})}function khe(t,e,i){const r=oi(i.round)?!0:i.round,s=oi(i.rounding)?"trunc":i.rounding,n=(o,l)=>(o=_ee(o,r||i.calendary?0:2,i.calendary?"round":s),e.loc.clone(i).relFormatter(i).format(o,l)),a=o=>i.calendary?e.hasSame(t,o)?0:e.startOf(o).diff(t.startOf(o),o).get(o):e.diff(t,o).get(o);if(i.unit)return n(a(i.unit),i.unit);for(const o of i.units){const l=a(o);if(Math.abs(l)>=1)return n(l,o)}return n(t>e?-0:0,i.units[i.units.length-1])}function zhe(t){let e={},i;return t.length>0&&typeof t[t.length-1]=="object"?(e=t[t.length-1],i=Array.from(t).slice(0,t.length-1)):i=Array.from(t),[e,i]}let QA;const YW=new Map;class lt{constructor(e){const i=e.zone||Cn.defaultZone;let r=e.invalid||(Number.isNaN(e.ts)?new sp("invalid input"):null)||(i.isValid?null:YA(i));this.ts=oi(e.ts)?Cn.now():e.ts;let s=null,n=null;if(!r)if(e.old&&e.old.ts===this.ts&&e.old.zone.equals(i))[s,n]=[e.old.c,e.old.o];else{const o=j_(e.o)&&!e.old?e.o:i.offset(this.ts);s=c5(this.ts,o),r=Number.isNaN(s.year)?new sp("invalid input"):null,s=r?null:s,n=r?null:o}this._zone=i,this.loc=e.loc||jr.create(),this.invalid=r,this.weekData=null,this.localWeekData=null,this.c=s,this.o=n,this.isLuxonDateTime=!0}static now(){return new lt({})}static local(){const[e,i]=zhe(arguments),[r,s,n,a,o,l,c]=i;return Lhe({year:r,month:s,day:n,hour:a,minute:o,second:l,millisecond:c},e)}static utc(){const[e,i]=zhe(arguments),[r,s,n,a,o,l,c]=i;return e.zone=xa.utcInstance,Lhe({year:r,month:s,day:n,hour:a,minute:o,second:l,millisecond:c},e)}static fromJSDate(e,i={}){const r=JHe(e)?e.valueOf():NaN;if(Number.isNaN(r))return lt.invalid("invalid input");const s=v_(i.zone,Cn.defaultZone);return s.isValid?new lt({ts:r,zone:s,loc:jr.fromObject(i)}):lt.invalid(YA(s))}static fromMillis(e,i={}){if(j_(e))return e<-Phe||e>Phe?lt.invalid("Timestamp out of range"):new lt({ts:e,zone:v_(i.zone,Cn.defaultZone),loc:jr.fromObject(i)});throw new Xo(`fromMillis requires a numerical input, but received a ${typeof e} with value ${e}`)}static fromSeconds(e,i={}){if(j_(e))return new lt({ts:e*1e3,zone:v_(i.zone,Cn.defaultZone),loc:jr.fromObject(i)});throw new Xo("fromSeconds requires a numerical input")}static fromObject(e,i={}){e=e||{};const r=v_(i.zone,Cn.defaultZone);if(!r.isValid)return lt.invalid(YA(r));const s=jr.fromObject(i),n=a6(e,Ihe),{minDaysInFirstWeek:a,startOfWeek:o}=bhe(n,s),l=Cn.now(),c=oi(i.specificOffset)?r.offset(l):i.specificOffset,h=!oi(n.ordinal),f=!oi(n.year),y=!oi(n.month)||!oi(n.day),_=f||y,w=n.weekYear||n.weekNumber;if((_||h)&&w)throw new c3("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(y&&h)throw new c3("Can't mix ordinal dates with month/day");const x=w||n.weekday&&!_;let S,$,A=c5(l,c);x?(S=_Ze,$=gZe,A=s6(A,a,o)):h?(S=vZe,$=yZe,A=t7(A)):(S=nz,$=mTe);let M=!1;for(const N of S){const j=n[N];oi(j)?M?n[N]=$[N]:n[N]=A[N]:M=!0}const P=x?YHe(n,a,o):h?QHe(n):USe(n),O=P||BSe(n);if(O)return lt.invalid(O);const D=x?_he(n,a,o):h?vhe(n):n,[L,F]=sz(D,c,r),U=new lt({ts:L,zone:r,o:F,loc:s});return n.weekday&&_&&e.weekday!==U.weekday?lt.invalid("mismatched weekday",`you can't specify both a weekday of ${n.weekday} and a date of ${U.toISO()}`):U.isValid?U:lt.invalid(U.invalid)}static fromISO(e,i={}){const[r,s]=UWe(e);return aS(r,s,i,"ISO 8601",e)}static fromRFC2822(e,i={}){const[r,s]=BWe(e);return aS(r,s,i,"RFC 2822",e)}static fromHTTP(e,i={}){const[r,s]=jWe(e);return aS(r,s,i,"HTTP",i)}static fromFormat(e,i,r={}){if(oi(e)||oi(i))throw new Xo("fromFormat requires an input string and a format");const{locale:s=null,numberingSystem:n=null}=r,a=jr.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0}),[o,l,c,h]=mZe(a,e,i);return h?lt.invalid(h):aS(o,l,r,`format ${i}`,e,c)}static fromString(e,i,r={}){return lt.fromFormat(e,i,r)}static fromSQL(e,i={}){const[r,s]=QWe(e);return aS(r,s,i,"SQL",e)}static invalid(e,i=null){if(!e)throw new Xo("need to specify a reason the DateTime is invalid");const r=e instanceof sp?e:new sp(e,i);if(Cn.throwOnInvalid)throw new SHe(r);return new lt({invalid:r})}static isDateTime(e){return e&&e.isLuxonDateTime||!1}static parseFormatForOpts(e,i={}){const r=pTe(e,jr.fromObject(i));return r?r.map(s=>s?s.val:null).join(""):null}static expandFormat(e,i={}){return uTe(il.parseFormat(e),jr.fromObject(i)).map(s=>s.val).join("")}static resetCache(){QA=void 0,YW.clear()}get(e){return this[e]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?s7(this).weekYear:NaN}get weekNumber(){return this.isValid?s7(this).weekNumber:NaN}get weekday(){return this.isValid?s7(this).weekday:NaN}get isWeekend(){return this.isValid&&this.loc.getWeekendDays().includes(this.weekday)}get localWeekday(){return this.isValid?n7(this).weekday:NaN}get localWeekNumber(){return this.isValid?n7(this).weekNumber:NaN}get localWeekYear(){return this.isValid?n7(this).weekYear:NaN}get ordinal(){return this.isValid?t7(this.c).ordinal:NaN}get monthShort(){return this.isValid?o5.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?o5.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?o5.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?o5.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}getPossibleOffsets(){if(!this.isValid||this.isOffsetFixed)return[this];const e=864e5,i=6e4,r=AU(this.c),s=this.zone.offset(r-e),n=this.zone.offset(r+e),a=this.zone.offset(r-s*i),o=this.zone.offset(r-n*i);if(a===o)return[this];const l=r-a*i,c=r-o*i,h=c5(l,a),f=c5(c,o);return h.hour===f.hour&&h.minute===f.minute&&h.second===f.second&&h.millisecond===f.millisecond?[w1(this,{ts:l}),w1(this,{ts:c})]:[this]}get isInLeapYear(){return t4(this.year)}get daysInMonth(){return n6(this.year,this.month)}get daysInYear(){return this.isValid?W3(this.year):NaN}get weeksInWeekYear(){return this.isValid?NR(this.weekYear):NaN}get weeksInLocalWeekYear(){return this.isValid?NR(this.localWeekYear,this.loc.getMinDaysInFirstWeek(),this.loc.getStartOfWeek()):NaN}resolvedLocaleOptions(e={}){const{locale:i,numberingSystem:r,calendar:s}=il.create(this.loc.clone(e),e).resolvedOptions(this);return{locale:i,numberingSystem:r,outputCalendar:s}}toUTC(e=0,i={}){return this.setZone(xa.instance(e),i)}toLocal(){return this.setZone(Cn.defaultZone)}setZone(e,{keepLocalTime:i=!1,keepCalendarTime:r=!1}={}){if(e=v_(e,Cn.defaultZone),e.equals(this.zone))return this;if(e.isValid){let s=this.ts;if(i||r){const n=e.offset(this.ts),a=this.toObject();[s]=sz(a,n,e)}return w1(this,{ts:s,zone:e})}else return lt.invalid(YA(e))}reconfigure({locale:e,numberingSystem:i,outputCalendar:r}={}){const s=this.loc.clone({locale:e,numberingSystem:i,outputCalendar:r});return w1(this,{loc:s})}setLocale(e){return this.reconfigure({locale:e})}set(e){if(!this.isValid)return this;const i=a6(e,Ihe),{minDaysInFirstWeek:r,startOfWeek:s}=bhe(i,this.loc),n=!oi(i.weekYear)||!oi(i.weekNumber)||!oi(i.weekday),a=!oi(i.ordinal),o=!oi(i.year),l=!oi(i.month)||!oi(i.day),c=o||l,h=i.weekYear||i.weekNumber;if((c||a)&&h)throw new c3("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(l&&a)throw new c3("Can't mix ordinal dates with month/day");let f;n?f=_he({...s6(this.c,r,s),...i},r,s):oi(i.ordinal)?(f={...this.toObject(),...i},oi(i.day)&&(f.day=Math.min(n6(f.year,f.month),f.day))):f=vhe({...t7(this.c),...i});const[y,_]=sz(f,this.o,this.zone);return w1(this,{ts:y,o:_})}plus(e){if(!this.isValid)return this;const i=xr.fromDurationLike(e);return w1(this,Rhe(this,i))}minus(e){if(!this.isValid)return this;const i=xr.fromDurationLike(e).negate();return w1(this,Rhe(this,i))}startOf(e,{useLocaleWeeks:i=!1}={}){if(!this.isValid)return this;const r={},s=xr.normalizeUnit(e);switch(s){case"years":r.month=1;case"quarters":case"months":r.day=1;case"weeks":case"days":r.hour=0;case"hours":r.minute=0;case"minutes":r.second=0;case"seconds":r.millisecond=0;break}if(s==="weeks")if(i){const n=this.loc.getStartOfWeek(),{weekday:a}=this;a<n&&(r.weekNumber=this.weekNumber-1),r.weekday=n}else r.weekday=1;if(s==="quarters"){const n=Math.ceil(this.month/3);r.month=(n-1)*3+1}return this.set(r)}endOf(e,i){return this.isValid?this.plus({[e]:1}).startOf(e,i).minus(1):this}toFormat(e,i={}){return this.isValid?il.create(this.loc.redefaultToEN(i)).formatDateTimeFromString(this,e):r7}toLocaleString(e=r6,i={}){return this.isValid?il.create(this.loc.clone(i),e).formatDateTime(this):r7}toLocaleParts(e={}){return this.isValid?il.create(this.loc.clone(e),e).formatDateTimeParts(this):[]}toISO({format:e="extended",suppressSeconds:i=!1,suppressMilliseconds:r=!1,includeOffset:s=!0,extendedZone:n=!1,precision:a="milliseconds"}={}){if(!this.isValid)return null;a=az(a);const o=e==="extended";let l=a7(this,o,a);return nz.indexOf(a)>=3&&(l+="T"),l+=Dhe(this,o,i,r,s,n,a),l}toISODate({format:e="extended",precision:i="day"}={}){return this.isValid?a7(this,e==="extended",az(i)):null}toISOWeekDate(){return u5(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:e=!1,suppressSeconds:i=!1,includeOffset:r=!0,includePrefix:s=!1,extendedZone:n=!1,format:a="extended",precision:o="milliseconds"}={}){return this.isValid?(o=az(o),(s&&nz.indexOf(o)>=3?"T":"")+Dhe(this,a==="extended",i,e,r,n,o)):null}toRFC2822(){return u5(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return u5(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?a7(this,!0):null}toSQLTime({includeOffset:e=!0,includeZone:i=!1,includeOffsetSpace:r=!0}={}){let s="HH:mm:ss.SSS";return(i||e)&&(r&&(s+=" "),i?s+="z":e&&(s+="ZZ")),u5(this,s,!0)}toSQL(e={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(e)}`:null}toString(){return this.isValid?this.toISO():r7}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`DateTime { ts: ${this.toISO()}, zone: ${this.zone.name}, locale: ${this.locale} }`:`DateTime { Invalid, reason: ${this.invalidReason} }`}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(e={}){if(!this.isValid)return{};const i={...this.c};return e.includeConfig&&(i.outputCalendar=this.outputCalendar,i.numberingSystem=this.loc.numberingSystem,i.locale=this.loc.locale),i}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(e,i="milliseconds",r={}){if(!this.isValid||!e.isValid)return xr.invalid("created by diffing an invalid DateTime");const s={locale:this.locale,numberingSystem:this.numberingSystem,...r},n=KHe(i).map(xr.normalizeUnit),a=e.valueOf()>this.valueOf(),o=a?this:e,l=a?e:this,c=iZe(o,l,n,s);return a?c.negate():c}diffNow(e="milliseconds",i={}){return this.diff(lt.now(),e,i)}until(e){return this.isValid?Sn.fromDateTimes(this,e):this}hasSame(e,i,r){if(!this.isValid)return!1;const s=e.valueOf(),n=this.setZone(e.zone,{keepLocalTime:!0});return n.startOf(i,r)<=s&&s<=n.endOf(i,r)}equals(e){return this.isValid&&e.isValid&&this.valueOf()===e.valueOf()&&this.zone.equals(e.zone)&&this.loc.equals(e.loc)}toRelative(e={}){if(!this.isValid)return null;const i=e.base||lt.fromObject({},{zone:this.zone}),r=e.padding?this<i?-e.padding:e.padding:0;let s=["years","months","days","hours","minutes","seconds"],n=e.unit;return Array.isArray(e.unit)&&(s=e.unit,n=void 0),khe(i,this.plus(r),{...e,numeric:"always",units:s,unit:n})}toRelativeCalendar(e={}){return this.isValid?khe(e.base||lt.fromObject({},{zone:this.zone}),this,{...e,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...e){if(!e.every(lt.isDateTime))throw new Xo("min requires all arguments be DateTimes");return whe(e,i=>i.valueOf(),Math.min)}static max(...e){if(!e.every(lt.isDateTime))throw new Xo("max requires all arguments be DateTimes");return whe(e,i=>i.valueOf(),Math.max)}static fromFormatExplain(e,i,r={}){const{locale:s=null,numberingSystem:n=null}=r,a=jr.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0});return dTe(a,e,i)}static fromStringExplain(e,i,r={}){return lt.fromFormatExplain(e,i,r)}static buildFormatParser(e,i={}){const{locale:r=null,numberingSystem:s=null}=i,n=jr.fromOpts({locale:r,numberingSystem:s,defaultToEN:!0});return new hTe(n,e)}static fromFormatParser(e,i,r={}){if(oi(e)||oi(i))throw new Xo("fromFormatParser requires an input string and a format parser");const{locale:s=null,numberingSystem:n=null}=r,a=jr.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0});if(!a.equals(i.locale))throw new Xo(`fromFormatParser called with a locale of ${a}, but the format parser was created for ${i.locale}`);const{result:o,zone:l,specificOffset:c,invalidReason:h}=i.explainFromTokens(e);return h?lt.invalid(h):aS(o,l,r,`format ${i.format}`,e,c)}static get DATE_SHORT(){return r6}static get DATE_MED(){return gSe}static get DATE_MED_WITH_WEEKDAY(){return CHe}static get DATE_FULL(){return ySe}static get DATE_HUGE(){return _Se}static get TIME_SIMPLE(){return vSe}static get TIME_WITH_SECONDS(){return bSe}static get TIME_WITH_SHORT_OFFSET(){return wSe}static get TIME_WITH_LONG_OFFSET(){return xSe}static get TIME_24_SIMPLE(){return SSe}static get TIME_24_WITH_SECONDS(){return TSe}static get TIME_24_WITH_SHORT_OFFSET(){return $Se}static get TIME_24_WITH_LONG_OFFSET(){return CSe}static get DATETIME_SHORT(){return MSe}static get DATETIME_SHORT_WITH_SECONDS(){return ESe}static get DATETIME_MED(){return ASe}static get DATETIME_MED_WITH_SECONDS(){return OSe}static get DATETIME_MED_WITH_WEEKDAY(){return MHe}static get DATETIME_FULL(){return PSe}static get DATETIME_FULL_WITH_SECONDS(){return RSe}static get DATETIME_HUGE(){return DSe}static get DATETIME_HUGE_WITH_SECONDS(){return ISe}}function PE(t){if(lt.isDateTime(t))return t;if(t&&t.valueOf&&j_(t.valueOf()))return lt.fromJSDate(t);if(t&&typeof t=="object")return lt.fromObject(t);throw new Xo(`Unknown datetime argument: ${t}, of type ${typeof t}`)}const wZe="shortOffset";function xZe(t){return"timeZoneIANA"in t}function SZe(t){return t.startsWith("UTC")}function H6t(t,e=!1){return{json:{read:{source:t,reader:(i,r)=>r[t]?oz(r[t]):null},write:!!e&&{allowNull:!0,writer(i,r){r[t]=i?TZe(i):null}}}}}function oz(t,e=vp){return t?xZe(t)?t.timeZoneIANA:$Ze(t,e):e}function TZe(t){return{timeZoneIANA:t}}function $Ze(t,e=vp){if(!t||!ohe.has(t.timeZone))return e;const i=ohe.get(t.timeZone);return SZe(t.timeZone)||t.respectsDaylightSaving?i:CZe(i)}function CZe(t){const e=lt.local().setZone(t),i=Math.min(e.set({month:1,day:1}).offset,e.set({month:5}).offset);return i===0?"Etc/UTC":`Etc/GMT${xa.instance(-i).formatOffset(0,"narrow")}`}function W6t(t,e,i,r,s){if(e&&s==="date")return{timeZone:_v,timeZoneName:void 0};const n=r.hour,a=i===yv;return{timeZone:a?s==="timestamp-offset"?void 0:t??_v:i,timeZoneName:a&&n?wZe:void 0}}function MZe(t){const e=new Set(["etc/utc","etc/gmt","gmt"]),i=new Set(Intl.supportedValuesOf("timeZone").map(r=>r.toLowerCase()));return t===vp||t===yv||e.has(t.toLowerCase())||i.has(t.toLowerCase())}const EZe={dateStyle:void 0,year:void 0,month:void 0,day:void 0,weekday:void 0},AZe={timeStyle:void 0,hour12:void 0,hourCycle:void 0,hour:void 0,minute:void 0,second:void 0},gTe={timeZone:_v},Bp={year:"numeric",month:"numeric",day:"numeric"},RE={year:"numeric",month:"long",day:"numeric"},DE={year:"numeric",month:"short",day:"numeric"},IE={year:"numeric",month:"long",weekday:"long",day:"numeric"},h_={hour:"numeric",minute:"numeric"},Q1={...h_,second:"numeric"},yTe={hourCycle:"h23"},LE={...h_,...yTe},kE={...Q1,...yTe},_Te={"short-date":Bp,"short-date-short-time":{...Bp,...h_},"short-date-short-time-24":{...Bp,...LE},"short-date-long-time":{...Bp,...Q1},"short-date-long-time-24":{...Bp,...kE},"short-date-le":Bp,"short-date-le-short-time":{...Bp,...h_},"short-date-le-short-time-24":{...Bp,...LE},"short-date-le-long-time":{...Bp,...Q1},"short-date-le-long-time-24":{...Bp,...kE},"long-month-day-year":RE,"long-month-day-year-short-time":{...RE,...h_},"long-month-day-year-short-time-24":{...RE,...LE},"long-month-day-year-long-time":{...RE,...Q1},"long-month-day-year-long-time-24":{...RE,...kE},"day-short-month-year":DE,"day-short-month-year-short-time":{...DE,...h_},"day-short-month-year-short-time-24":{...DE,...LE},"day-short-month-year-long-time":{...DE,...Q1},"day-short-month-year-long-time-24":{...DE,...kE},"long-date":IE,"long-date-short-time":{...IE,...h_},"long-date-short-time-24":{...IE,...LE},"long-date-long-time":{...IE,...Q1},"long-date-long-time-24":{...IE,...kE},"long-month-year":{month:"long",year:"numeric"},"short-month-year":{month:"short",year:"numeric"},year:{year:"numeric"},"short-time":h_,"long-time":Q1},OZe=cl()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"}),vTe={ar:"ar-u-nu-latn-ca-gregory",nn:"no-NN"},PZe=new Intl.DateTimeFormat("bs",{month:"long"}).formatToParts(new Date(2025,2)),RZe=PZe.find(({type:t})=>t==="month")?.value.toLowerCase();function bTe(){const t=dee();return(t&&vTe[t])??dSe()}RZe!=="mart"&&(vTe.bs="sr-Latn-CS");let QW=new WeakMap;const RU=_Te["short-date-short-time"];function DZe(t){let e=QW.get(t);if(!e){const i=bTe(),r=xee(t.timeZone??vp),s={...t,timeZone:r};e=new Intl.DateTimeFormat(i,s),QW.set(t,e)}return e}function IZe(t){return _Te[t]}function Z6t(t){const{dateStyle:e,timeStyle:i,hour12:r,year:s,month:n}=t,a={};return e?a.dateStyle=e:s&&(a.year=s,a.month=n||void 0),i&&!a.year&&(a.timeStyle=i,a.hour12=r==="auto"?void 0:r==="always"),a}function vv(t,e=RU){return DZe(e).format(t)}function Y6t(t,e=RU){return vv(new Date(t),{...e,...gTe,...AZe})}function Q6t(t,e=RU){return vv(new Date(`1970-01-01T${t}Z`),{...e,...gTe,...EZe})}function X6t(t,e=RU){if(e.timeZone)return vv(new Date(t),e);const i=lt.fromISO(t,{setZone:!0}),r=i.offset===0?_v:e.timeZone,s={...e,timeZone:r};return i.toLocaleString(s,{locale:bTe()})}function xee(t){switch(t){case vp:return xHe;case yv:return _v;default:return t}}pee(()=>{QW=new WeakMap});const LZe={ar:"ar-u-nu-latn",bs:"sr-Latn-CS",nn:"no-NN"};let lz=new WeakMap,wTe={};function XW(t){const e=t||wTe;if(!lz.has(e)){const i=dee(),r=i&&LZe[i]||dSe();lz.set(e,new Intl.NumberFormat(r,t))}return lz.get(e)}function J6t(t={}){const e={};return t.digitSeparator!=null&&(e.useGrouping=t.digitSeparator),t.places!=null&&(e.minimumFractionDigits=e.maximumFractionDigits=t.places),e}function K6t(t){const{minimumFractionDigits:e,maximumFractionDigits:i,useGrouping:r}=t;return{minimumFractionDigits:e,maximumFractionDigits:i,useGrouping:r==="auto"?"auto":r==="always"}}function dy(t,e){return Object.is(t,-0)&&(t=0),XW(e).format(t)}function eVt(t,e=Lc()){if(!t)return null;let i=Fhe.get(e);if(!i){const r=XW().formatToParts(12345.6),s=[...XW({useGrouping:!1}).format(9876543210)].reverse(),n=new Map(s.map((f,y)=>[f,y])),a=new RegExp(`[${r.find(f=>f.type==="group")?.value}]`,"g"),o=new RegExp(`[${r.find(f=>f.type==="decimal")?.value}]`),l=new RegExp(`[${s.join("")}]`,"g"),c=/[\u200E\u200F\u202A\u202B\u202C\u202D\u202E\u2066\u2067\u2068\u2069\u061C]/g,h=/[-\u2212\u2013\u2014\u2015]/g;i=f=>{if((f=f.trim().replaceAll(a,"").replace(o,".").replace(l,_=>String(n.get(_))).replaceAll(c,"").replaceAll(h,"-"))==="")return null;const y=Number(f);return isNaN(y)?null:y},Fhe.set(e,i)}return i(t)}pee(()=>{lz=new WeakMap,wTe={}});const Fhe=new Map,xTe=()=>fe.getLogger("esri.intl.substitute");function kZe(t,e,i={}){const{format:r={}}=i;return Cy(t,s=>zZe(s,e,r))}function zZe(t,e,i){let r,s;const n=t.indexOf(":");if(n===-1?r=t.trim():(r=t.slice(0,n).trim(),s=t.slice(n+1).trim()),!r)return"";const a=zD(r,e);if(a==null)return"";const o=(s?i?.[s]:null)??i?.[r];return o?FZe(a,o):s?NZe(a,s):See(a)}function FZe(t,e){switch(e.type){case"date":return vv(t,e.intlOptions);case"number":return dy(t,e.intlOptions);default:return xTe().warn("missing format descriptor for key {key}"),See(t)}}function NZe(t,e){switch(e.toLowerCase()){case"dateformat":return vv(t);case"numberformat":return dy(t);default:return xTe().warn(`inline format is unsupported since 4.12: ${e}`),/^(dateformat|datestring)/i.test(e)?vv(t):/^numberformat/i.test(e)?dy(t):See(t)}}function See(t){switch(typeof t){case"string":return t;case"number":return dy(t);case"boolean":return""+t;default:return t instanceof Date?vv(t):""}}const STe={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:"no",nl:!0,no:!0,nn:"no",pl:!0,pt:"pt-BR","pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,zh:"zh-CN","zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function VZe(t){return t in STe}function Nhe(t){if(VZe(t)){const e=STe[t];return e===!0?t:e}return null}const XA=[],Y3=new Map;function Vhe(t){for(const e of Y3.keys())CTe(t.pattern,e)&&Y3.delete(e)}function UZe(t){return XA.includes(t)||(Vhe(t),XA.unshift(t)),ci(()=>{const e=XA.indexOf(t);e>-1&&(XA.splice(e,1),Vhe(t))})}async function TTe(t){const e=Lc();Y3.has(t)||Y3.set(t,BZe(t,e));const i=Y3.get(t);return i&&await jZe.add(i),i}function $Te(t){const e=dee(t);return e?Nhe(t)??Nhe(e):null}async function BZe(t,e){const i=[];for(const r of XA)if(CTe(r.pattern,t))try{return await r.fetchMessageBundle(t,e)}catch(s){i.push(s)}throw i.length?new ee("intl:message-bundle-error",`Errors occurred while loading "${t}"`,{errors:i}):new ee("intl:no-message-bundle-loader",`No loader found for message bundle "${t}"`)}function CTe(t,e){return typeof t=="string"?e.startsWith(t):t.test(e)}pee(()=>{Y3.clear()});const jZe=new class{constructor(){this._numLoading=0,this._dfd=null}async waitForAll(){this._dfd&&await this._dfd.promise}add(t){return this._increase(),t.then(()=>this._decrease(),()=>this._decrease()),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=lo())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&this._numLoading===0&&(this._dfd.resolve(),this._dfd=null)}};async function qZe(t,e,i,r){const s=e.exec(i);if(!s)throw new ee("esri-intl:invalid-bundle",`Bundle id "${i}" is not compatible with the pattern "${e}"`);const n=s[1]?`${s[1]}/`:"",a=s[2],o=$Te(r),l=`${n}${a}.json`,c=o?`${n}${a}_${o}.json`:l;let h;try{h=await Uhe(t(c))}catch(f){if(c===l)throw new ee("intl:unknown-bundle",`Bundle "${i}" cannot be loaded`,{error:f});try{h=await Uhe(t(l))}catch(y){throw new ee("intl:unknown-bundle",`Bundle "${i}" cannot be loaded`,{error:y})}}return h}async function Uhe(t){if(Bhe.fetchBundleAsset!=null)return Bhe.fetchBundleAsset(t);const e=await $r(t,{responseType:"text"});return JSON.parse(e.data)}let GZe=class{constructor({base:e="",pattern:i,location:r=new URL(window.location.href)}){let s;s=typeof r=="string"?n=>new URL(n,new URL(r,window.location.href)).href:r instanceof URL?n=>new URL(n,r).href:r,this.pattern=typeof i=="string"?new RegExp(`^${i}`):i,this.getAssetUrl=s,e=e?e.endsWith("/")?e:e+"/":"",this.matcher=new RegExp(`^${e}(?:(.*)\\/)?(.*)$`)}fetchMessageBundle(e,i){return qZe(this.getAssetUrl,this.matcher,e,i)}};function HZe(t){return new GZe(t)}const Bhe={};UZe(HZe({pattern:"esri/",location:Es}));const jhe={};function WZe(t){const e={async:t.async,isDebug:t.isDebug,locale:t.locale,baseUrl:t.baseUrl,has:{...t.has},map:{...t.map},packages:t.packages?.slice()||[],paths:{...jhe.paths,...t.paths}};return t.hasOwnProperty("async")||(e.async=!0),t.hasOwnProperty("isDebug")||(e.isDebug=!1),t.baseUrl||(e.baseUrl=jhe.baseUrl),e}let ZZe=class{constructor(){const e=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(i=>{this[i]=(...r)=>e[i](...r)})}},cz=class{constructor(){this._dispatcher=new ZZe,this._workerPostMessage({type:Kg.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(e){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=e,e&&this.addEventListener("message",e)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(e){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=e,e&&this.addEventListener("messageerror",e)}get onerror(){return this._onerrorHandler}set onerror(e){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=e,e&&this.addEventListener("error",e)}postMessage(e){rC(()=>{this._workerMessageHandler(new MessageEvent("message",{data:e}))})}dispatchEvent(e){return this._dispatcher.dispatchEvent(e)}addEventListener(e,i,r){this._dispatcher.addEventListener(e,i,r)}removeEventListener(e,i,r){this._dispatcher.removeEventListener(e,i,r)}_workerPostMessage(e){rC(()=>{this.dispatchEvent(new MessageEvent("message",{data:e}))})}async _workerMessageHandler(e){const i=FR(e);if(i&&i.type===Kg.OPEN){const{modulePath:r,jobId:s}=i;let n=await wC.loadWorker(r);n||(n=await import(r));const a=wC.connect(n);this._workerPostMessage({type:Kg.OPENED,jobId:s,data:a})}}};const JW=()=>fe.getLogger("esri.core.workers.workerFactory"),{HANDSHAKE:YZe}=Kg,QZe='let globalId=0;const outgoing=new Map,configuration={CONFIGURATION};self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;let s=null;return new Promise((r,i)=>{if(t){if(t.aborted)return i(createAbortError());s=()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:5,jobId:n}),i(createAbortError()))},t.addEventListener("abort",s)}outgoing.set(n,{resolve:r,reject:i}),self.postMessage({type:4,jobId:n,methodName:e,abortable:null!=t,data:o})}).finally(()=>{t&&t.removeEventListener("abort",s)})}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,fullVersion:r}=configuration.kernelInfo,{revision:t,fullVersion:n,version:s}=e.kernelInfo;esriConfig.assetsPath!==esriConfig.defaultAssetsPath&&o!==t&&console.warn(`Version mismatch detected between ArcGIS Maps SDK for JavaScript modules and assets. For more information visit https://esriurl.com/using-local-assets.\nModules version: ${r}\nAssets version: ${n??s}\nAssets path: ${esriConfig.assetsPath}`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case 1:let n;function t(e){const o=n.connect(e);self.postMessage({type:2,jobId:r,data:o},[o])}"function"==typeof define&&define.amd?require([workerPath],e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then(e=>e||new Promise(e=>{require([o.modulePath],e)})).then(t)}):"System"in self&&"function"==typeof System.import?System.import(workerPath).then(e=>(n=e.default,checkWorkerRevision(n),n.loadWorker(o.modulePath))).then(e=>e||System.import(o.modulePath)).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then(e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then(e=>e||import(o.modulePath)).then(t)}):(self.RemoteClient||importScripts(workerPath),n=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(n),n.loadWorker(o.modulePath).then(t));break;case 3:if(outgoing.has(r)){const s=outgoing.get(r);outgoing.delete(r),o.error?s.reject(JSON.parse(o.error)):s.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});';let h5,d5;const qhe="Failed to create Worker. Fallback to execute module in main thread";async function XZe(){if(!ie("esri-workers"))return Ghe(new cz);if(!h5&&!d5)try{const e=QZe.split("{CONFIGURATION}").join(JZe());h5=URL.createObjectURL(new Blob([e],{type:"text/javascript"}))}catch(e){d5=e||{}}let t;if(h5)try{t=new Worker(h5,{name:"esri-worker-"+KZe++})}catch{JW().warn(qhe,d5),t=new cz}else JW().warn(qhe,d5),t=new cz;return Ghe(t)}async function Ghe(t){return new Promise(e=>{function i(s){const n=FR(s);n&&n.type===YZe&&(t.removeEventListener("message",i),t.removeEventListener("error",r),e(t))}function r(s){s.preventDefault(),t.removeEventListener("message",i),t.removeEventListener("error",r),JW().warn("Failed to create Worker. Fallback to execute module in main thread",s),(t=new cz).addEventListener("message",i),t.addEventListener("error",r)}t.addEventListener("message",i),t.addEventListener("error",r)})}function JZe(){let t;if(fr.default!=null){const s={...fr};delete s.default,t=JSON.parse(JSON.stringify(s))}else t=JSON.parse(JSON.stringify(fr));t.assetsPath=Tu(t.assetsPath),t.defaultAssetsPath=t.defaultAssetsPath?Tu(t.defaultAssetsPath):void 0,t.request.interceptors=[],t.log.interceptors=[],t.locale=Lc(),t.has={"esri-csp-restrictions":ie("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":ie("esri-2d-update-debug"),"esri-2d-log-updating":ie("esri-2d-log-updating"),"featurelayer-pbf":ie("featurelayer-pbf"),"featurelayer-fast-triangulation-enabled":ie("featurelayer-fast-triangulation-enabled"),"featurelayer-simplify-thresholds":ie("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":ie("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":ie("featurelayer-simplify-mobile-factor"),"featurelayer-query-max-depth":ie("featurelayer-query-max-depth"),"featurelayer-query-tile-max-features":ie("featurelayer-query-tile-max-features"),"featurelayer-query-tile-concurrency":ie("featurelayer-query-tile-concurrency"),"featurelayer-query-pausing-enabled":ie("featurelayer-query-pausing-enabled"),"featurelayer-snapshot-concurrency":ie("featurelayer-snapshot-concurrency"),"featurelayer-snapshot-enabled":ie("featurelayer-snapshot-enabled"),"parquetlayer-full-query-feature-count":ie("parquetlayer-full-query-feature-count"),"esri-atomics":ie("esri-atomics"),"esri-shared-array-buffer":ie("esri-shared-array-buffer"),"esri-tiles-debug":ie("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":ie("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":ie("feature-polyline-generalization-factor"),"host-webworker":1},t.workers.loaderUrl&&(t.workers.loaderUrl=Tu(t.workers.loaderUrl)),t.workers.workerPath?t.workers.workerPath=Tu(t.workers.workerPath):t.workers.workerPath=Tu(Es("esri/core/workers/RemoteClient.js")),t.workers.useDynamicImport=!1;const e=fr.workers.loaderConfig,i=WZe({baseUrl:e?.baseUrl,locale:Lc(),has:{"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1,...e?.has},map:{...e?.map},paths:{...e?.paths},packages:e?.packages||[]});return JSON.stringify({esriConfig:t,loaderConfig:i,kernelInfo:{buildDate:yxe,fullVersion:FK,revision:_xe}})}let KZe=0;const{ABORT:Hhe,INVOKE:eYe,OPEN:tYe,OPENED:iYe,RESPONSE:zE}=Kg;let rYe=class MTe{static async create(e){const i=await XZe();return new MTe(i,e)}constructor(e,i){this._outJobs=new Map,this._inJobs=new Map,this.worker=e,this.id=i,e.addEventListener("message",this._onMessage.bind(this)),e.addEventListener("error",r=>{r.preventDefault(),fe.getLogger("esri.core.workers.WorkerOwner").error(r)})}terminate(){this.worker.terminate()}async open(e,i={}){const{signal:r}=i,s=cSe();return new Promise((n,a)=>{const o={resolve:n,reject:a,abortHandle:jD(r,()=>{this._outJobs.delete(s),this._post({type:Hhe,jobId:s})})};this._outJobs.set(s,o),this._post({type:tYe,jobId:s,modulePath:e})})}_onMessage(e){const i=FR(e);if(i)switch(i.type){case iYe:this._onOpenedMessage(i);break;case zE:this._onResponseMessage(i);break;case Hhe:this._onAbortMessage(i);break;case eYe:this._onInvokeMessage(i)}}_onAbortMessage(e){const i=this._inJobs,r=e.jobId,s=i.get(r);s&&(s.controller&&s.controller.abort(),i.delete(r))}_onInvokeMessage(e){const{methodName:i,jobId:r,data:s,abortable:n}=e,a=n?new AbortController:null,o=this._inJobs,l=vHe[i];let c;try{if(typeof l!="function")throw new TypeError(`${i} is not a function`);c=l.call(null,s,{signal:a?a.signal:null})}catch(h){return void this._post({type:zE,jobId:r,error:i6(h)})}$a(c)?(o.set(r,{controller:a,promise:c}),c.then(h=>{o.has(r)&&(o.delete(r),this._post({type:zE,jobId:r},h))},h=>{o.has(r)&&(o.delete(r),h||(h={message:"Error encountered at method"+i}),Hr(h)||this._post({type:zE,jobId:r,error:i6(h||{message:`Error encountered at method ${i}`})}))})):this._post({type:zE,jobId:r},c)}_onOpenedMessage(e){const{jobId:i,data:r}=e,s=this._outJobs.get(i);s&&(this._outJobs.delete(i),Ki(s.abortHandle),s.resolve(r))}_onResponseMessage(e){const{jobId:i,error:r,data:s}=e,n=this._outJobs.get(i);n&&(this._outJobs.delete(i),Ki(n.abortHandle),r?n.reject(ee.fromJSON(JSON.parse(r))):n.resolve(s))}_post(e,i,r){return uSe(this.worker,e,i,r)}};const Whe=ie("host-browser")?Math.min(navigator.hardwareConcurrency-1,ie("workers-pool-size")??8):0;let Xb=ie("esri-mobile")?Math.min(Whe,3):Whe;Xb||(Xb=ie("safari")&&ie("mac")?7:2);let Zhe=0;const uz=[];function sYe(){ETe()}async function p5(t,e){const i=new _He,{registryTarget:r,...s}=e;return await i.open(t,s),r&&cHe(r,i),i}async function nYe(t,e={}){if(typeof t!="string")throw new ee("workers:undefined-module","modulePath is missing");let i=e.strategy||"distributed";if(ie("host-webworker")&&!ie("esri-workers")&&(i="local"),i==="local"){let r=await wC.loadWorker(t);r||(r=await import(t)),st(e.signal);const s=e.client||r;return p5([wC.connect(r,e.schedule)],{...e,client:s})}if(await ETe(),st(e.signal),i==="dedicated"){const r=Zhe++%Xb;return p5([await uz[r].open(t,e)],e)}if(e.maxNumWorkers&&e.maxNumWorkers>0){const r=Math.min(e.maxNumWorkers,Xb);if(r<Xb){const s=new Array(r);for(let n=0;n<r;++n){const a=Zhe++%Xb;s[n]=uz[a].open(t,e)}return p5(s,e)}}return p5(uz.map(r=>r.open(t,e)),e)}let f5=null;async function ETe(){if(f5)return f5;new AbortController;const t=[];for(let e=0;e<Xb;e++){const i=rYe.create(e).then(r=>(uz[e]=r,r));t.push(i)}return f5=Promise.all(t),f5}function ATe(t,e){const i=al(t),r=al(e),s=i.store,n=r.store,a=r.metadata;for(const o in a){const l=a[o],c=s.originOf(o),h=n.originOf(o);if(!l.readOnly&&h!==0){if(c!==0){const f=s.get(o),y=n.get(o);f&&y&&y instanceof Me&&f instanceof Me&&f instanceof y.constructor&&ATe(f,y);continue}t.set(o,n.get(o))}}}function R(){return[0,0,0]}function cr(t){return[t[0],t[1],t[2]]}function Ge(t,e,i){return[t,e,i]}function bv(t,e,i){return[t,e,i]}function VR(t,e=R()){const i=Math.min(3,t.length);for(let r=0;r<i;++r)e[r]=t[r];return e}function wv(){return R()}function Jb(){return Ge(1,1,1)}function OTe(){return Ge(1,0,0)}function PTe(){return Ge(0,1,0)}function Tee(){return Ge(0,0,1)}const Kn=wv(),$ee=Jb(),Cee=OTe(),Mee=PTe(),py=Tee();Object.freeze(Object.defineProperty({__proto__:null,ONES:$ee,UNIT_X:Cee,UNIT_Y:Mee,UNIT_Z:py,ZEROS:Kn,clone:cr,create:R,freeze:bv,fromArray:VR,fromValues:Ge,ones:Jb,unitX:OTe,unitY:PTe,unitZ:Tee,zeros:wv},Symbol.toStringTag,{value:"Module"}));function aYe(t,e,i,r,s){RTe(t,e,i||0,r||t.length-1,s||oYe)}function RTe(t,e,i,r,s){for(;r>i;){if(r-i>600){var n=r-i+1,a=e-i+1,o=Math.log(n),l=.5*Math.exp(2*o/3),c=.5*Math.sqrt(o*l*(n-l)/n)*(a-n/2<0?-1:1);RTe(t,e,Math.max(i,Math.floor(e-a*l/n+c)),Math.min(r,Math.floor(e+(n-a)*l/n+c)),s)}var h=t[e],f=i,y=r;for(FE(t,i,e),s(t[r],h)>0&&FE(t,i,r);f<y;){for(FE(t,f,y),f++,y--;s(t[f],h)<0;)f++;for(;s(t[y],h)>0;)y--}s(t[i],h)===0?FE(t,i,y):FE(t,++y,r),y<=e&&(i=y+1),e<=y&&(r=y-1)}}function FE(t,e,i){var r=t[e];t[e]=t[i],t[i]=r}function oYe(t,e){return t<e?-1:t>e?1:0}let sVt=class{constructor(e=9,i){this._compareMinX=Qhe,this._compareMinY=Xhe,this._toBBox=r=>r,this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),i&&(typeof i=="function"?this._toBBox=i:this._initFormat(i)),this.clear()}destroy(){this.clear(),U0.prune(),RP.prune(),wl.prune(),KA.prune()}all(e){Yhe(this._data,e)}search(e,i){let r=this._data;const s=this._toBBox;if(g5(e,r))for(U0.clear();r;){for(let n=0,a=r.children.length;n<a;n++){const o=r.children[n],l=r.leaf?s(o):o;g5(e,l)&&(r.leaf?i(o):o7(e,l)?Yhe(o,i):U0.push(o))}r=U0.pop()}}collides(e){let i=this._data;const r=this._toBBox;if(!g5(e,i))return!1;for(U0.clear();i;){for(let s=0,n=i.children.length;s<n;s++){const a=i.children[s],o=i.leaf?r(a):a;if(g5(e,o)){if(i.leaf||o7(e,o))return!0;U0.push(a)}}i=U0.pop()}return!1}load(e){if(!e.length)return this;if(e.length<this._minEntries){for(let r=0,s=e.length;r<s;r++)this.insert(e[r]);return this}let i=this._build(e.slice(),0,e.length-1,0);if(this._data.children.length)if(this._data.height===i.height)this._splitRoot(this._data,i);else{if(this._data.height<i.height){const r=this._data;this._data=i,i=r}this._insert(i,this._data.height-i.height-1,!0)}else this._data=i;return this}insert(e){return e&&this._insert(e,this._data.height-1),this}clear(){return this._data=new hz([]),this}remove(e){if(!e)return this;let i,r=this._data,s=null,n=0,a=!1;const o=this._toBBox(e);for(wl.clear(),KA.clear();r||wl.length>0;){if(r||(r=wl.pop(),s=wl.data[wl.length-1],n=KA.pop()??0,a=!0),r.leaf&&(i=MR(r.children,e,r.children.length,r.indexHint),i!==-1))return r.children.splice(i,1),wl.push(r),this._condense(wl),this;a||r.leaf||!o7(r,o)?s?(n++,r=s.children[n],a=!1):r=null:(wl.push(r),KA.push(n),n=0,s=r,r=r.children[0])}return this}toJSON(){return this._data}fromJSON(e){return this._data=e,this}_build(e,i,r,s){const n=r-i+1;let a=this._maxEntries;if(n<=a){const h=new hz(e.slice(i,r+1));return oS(h,this._toBBox),h}s||(s=Math.ceil(Math.log(n)/Math.log(a)),a=Math.ceil(n/a**(s-1)));const o=new l7([]);o.height=s;const l=Math.ceil(n/a),c=l*Math.ceil(Math.sqrt(a));Jhe(e,i,r,c,this._compareMinX);for(let h=i;h<=r;h+=c){const f=Math.min(h+c-1,r);Jhe(e,h,f,l,this._compareMinY);for(let y=h;y<=f;y+=l){const _=Math.min(y+l-1,f);o.children.push(this._build(e,y,_,s-1))}}return oS(o,this._toBBox),o}_insert(e,i,r){const s=this._toBBox,n=r?e:s(e);wl.clear();const a=lYe(n,this._data,i,wl);for(a.children.push(e),PP(a,n);i>=0&&wl.data[i].children.length>this._maxEntries;)this._split(wl,i),i--;cYe(n,wl,i)}_split(e,i){const r=e.data[i],s=r.children.length,n=this._minEntries;this._chooseSplitAxis(r,n,s);const a=this._chooseSplitIndex(r,n,s);if(!a)return;const o=r.children.splice(a,r.children.length-a),l=r.leaf?new hz(o):new l7(o);l.height=r.height,oS(r,this._toBBox),oS(l,this._toBBox),i?e.data[i-1].children.push(l):this._splitRoot(r,l)}_splitRoot(e,i){this._data=new l7([e,i]),this._data.height=e.height+1,oS(this._data,this._toBBox)}_chooseSplitIndex(e,i,r){let s,n,a;s=n=1/0;for(let o=i;o<=r-i;o++){const l=JA(e,0,o,this._toBBox),c=JA(e,o,r,this._toBBox),h=hYe(l,c),f=KW(l)+KW(c);h<s?(s=h,a=o,n=f<n?f:n):h===s&&f<n&&(n=f,a=o)}return a}_chooseSplitAxis(e,i,r){const s=e.leaf?this._compareMinX:Qhe,n=e.leaf?this._compareMinY:Xhe;this._allDistMargin(e,i,r,s)<this._allDistMargin(e,i,r,n)&&e.children.sort(s)}_allDistMargin(e,i,r,s){e.children.sort(s);const n=this._toBBox,a=JA(e,0,i,n),o=JA(e,r-i,r,n);let l=m5(a)+m5(o);for(let c=i;c<r-i;c++){const h=e.children[c];PP(a,e.leaf?n(h):h),l+=m5(a)}for(let c=r-i-1;c>=i;c--){const h=e.children[c];PP(o,e.leaf?n(h):h),l+=m5(o)}return l}_condense(e){for(let i=e.length-1;i>=0;i--){const r=e.data[i];if(r.children.length===0)if(i>0){const s=e.data[i-1],n=s.children;n.splice(MR(n,r,n.length,s.indexHint),1)}else this.clear();else oS(r,this._toBBox)}}_initFormat(e){const i=["return a"," - b",";"];this._compareMinX=new Function("a","b",i.join(e[0])),this._compareMinY=new Function("a","b",i.join(e[1])),this._toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}};function lYe(t,e,i,r){for(;r.push(e),e.leaf!==!0&&r.length-1!==i;){let s,n=1/0,a=1/0;for(let o=0,l=e.children.length;o<l;o++){const c=e.children[o],h=KW(c),f=uYe(t,c)-h;f<a?(a=f,n=h<n?h:n,s=c):f===a&&h<n&&(n=h,s=c)}e=s||e.children[0]}return e}function Yhe(t,e){let i=t;for(RP.clear();i;){if(i.leaf===!0)for(const r of i.children)e(r);else RP.pushArray(i.children);i=RP.pop()??null}}function cYe(t,e,i){for(let r=i;r>=0;r--)PP(e.data[r],t)}function oS(t,e){JA(t,0,t.children.length,e,t)}function JA(t,e,i,r,s){s||(s=new hz([])),s.minX=1/0,s.minY=1/0,s.maxX=-1/0,s.maxY=-1/0;for(let n,a=e;a<i;a++)n=t.children[a],PP(s,t.leaf?r(n):n);return s}function PP(t,e){t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY)}function Qhe(t,e){return t.minX-e.minX}function Xhe(t,e){return t.minY-e.minY}function KW(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function m5(t){return t.maxX-t.minX+(t.maxY-t.minY)}function uYe(t,e){return(Math.max(e.maxX,t.maxX)-Math.min(e.minX,t.minX))*(Math.max(e.maxY,t.maxY)-Math.min(e.minY,t.minY))}function hYe(t,e){const i=Math.max(t.minX,e.minX),r=Math.max(t.minY,e.minY),s=Math.min(t.maxX,e.maxX),n=Math.min(t.maxY,e.maxY);return Math.max(0,s-i)*Math.max(0,n-r)}function o7(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function g5(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function Jhe(t,e,i,r,s){const n=[e,i];for(;n.length;){const a=n.pop(),o=n.pop();if(a-o<=r)continue;const l=o+Math.ceil((a-o)/r/2)*r;aYe(t,l,o,a,s),n.push(o,l,l,a)}}const U0=new _i,RP=new _i,wl=new _i,KA=new _i({deallocator:void 0});function dYe(){U0.prune(),RP.prune(),wl.prune(),KA.prune()}let pYe=class{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}},DTe=class extends pYe{constructor(){super(...arguments),this.height=1,this.indexHint=new lK}},hz=class extends DTe{constructor(e){super(),this.children=e,this.leaf=!0}},l7=class extends DTe{constructor(e){super(),this.children=e,this.leaf=!1}};function kc(t,e,i=He){return e||(e=new i),e===t||e.destroyed||(e.removeAll(),fYe(t)?e.addMany(t):t&&e.add(t)),e}function DU(t){return t}function fYe(t){return t&&(Array.isArray(t)||"items"in t&&Array.isArray(t.items))}let DP=class extends He{constructor(e){super(e),this.addHandles([this.on("before-add",i=>{i.item==null&&i.preventDefault()}),this.on("after-add",i=>this._own(i.item)),this.on("after-remove",i=>this._release(i.item))])}get owner(){return this._get("owner")}set owner(e){this.destroyed||e!==this._get("owner")&&(this._releaseAll(),this._set("owner",e),this._ownAll())}_ownAll(){for(const e of this.items)this._own(e)}_releaseAll(){for(const e of this.items)this._release(e)}_createNewInstance(e){return this.itemType?new(He.ofType(this.itemType.Type))(e):new He(e)}};function o6(t,e){return{type:t,cast:DU,set(i){const r=kc(i,this._get(e),t);r&&!r.destroyed&&(r.owner=this),this._set(e,r)}}}d([m()],DP.prototype,"owner",null),DP=d([k("esri.core.support.OwningCollection")],DP);var eO;const l6=cl()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),ITe=l6.jsonValues.slice();Ul(ITe,"orthometric");const IP=cl()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});let Eo=eO=class extends ke{constructor(t){super(t),this.heightModel="gravity-related-height",this.heightUnit="meters",this.vertCRS=null}writeHeightModel(t,e,i){return l6.write(t,e,i)}readHeightModel(t,e,i){return l6.read(t)||(i?.messages&&i.messages.push(mYe(t,{context:i})),null)}readHeightUnit(t,e,i){return IP.read(t)||(i?.messages&&i.messages.push(Khe(t,{context:i})),null)}readHeightUnitService(t,e,i){return YK(t)||IP.read(t)||(i?.messages&&i.messages.push(Khe(t,{context:i})),null)}readVertCRS(t,e){return e.vertCRS||e.ellipsoid||e.geoid}clone(){return new eO({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}equals(t){return!!t&&(this===t||this.heightModel===t.heightModel&&this.heightUnit===t.heightUnit&&this.vertCRS===t.vertCRS)}static deriveUnitFromSR(t,e){const i=Jxe(e);return new eO({heightModel:t.heightModel,heightUnit:i??void 0,vertCRS:t.vertCRS})}write(t,e){return e={origin:"web-scene",...e},super.write(t,e)}static fromJSON(t){if(!t)return null;const e=new eO;return e.read(t,{origin:"web-scene"}),e}};function Khe(t,e){return new ay("height-unit:unsupported",`Height unit of value '${t}' is not supported`,e)}function mYe(t,e){return new ay("height-model:unsupported",`Height model of value '${t}' is not supported`,e)}d([m({type:l6.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:ITe,default:"ellipsoidal",write:{isRequired:!0}}}}})],Eo.prototype,"heightModel",void 0),d([Ht("web-scene","heightModel")],Eo.prototype,"writeHeightModel",null),d([di(["web-scene","service"],"heightModel")],Eo.prototype,"readHeightModel",null),d([m({type:IP.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:IP.jsonValues,write:{writer:IP.write,isRequired:!0}}}}})],Eo.prototype,"heightUnit",void 0),d([di("web-scene","heightUnit")],Eo.prototype,"readHeightUnit",null),d([di("service","heightUnit")],Eo.prototype,"readHeightUnitService",null),d([m({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],Eo.prototype,"vertCRS",void 0),d([di("service","vertCRS",["vertCRS","ellipsoid","geoid"])],Eo.prototype,"readVertCRS",null),Eo=eO=d([k("esri.geometry.HeightModelInfo")],Eo);var eZ;let lT=eZ=class extends Me{constructor(t){super(t),this.isInverse=!1,this.wkt=null,this.wkid=null}getInverse(){return new eZ({isInverse:!this.isInverse,wkid:this.wkid,wkt:this.wkt})}};d([m()],lT.prototype,"isInverse",void 0),d([m()],lT.prototype,"wkt",void 0),d([m()],lT.prototype,"wkid",void 0),lT=eZ=d([k("esri.geometry.operators.support.GeographicTransformationStep")],lT);var tZ;let LP=tZ=class extends Me{constructor(t){super(t),this.steps=[]}getInverse(){const t=new tZ;for(let e=this.steps.length-1;e>=0;e--){const i=this.steps[e];t.steps.push(i.getInverse())}return t}};d([m({type:[lT],nonNullable:!0})],LP.prototype,"steps",void 0),LP=tZ=d([k("esri.geometry.operators.support.GeographicTransformation")],LP);const Il=Math.PI/180,gYe=/(?:SPHEROID|ELLIPSOID)\[([^\]]+)]/i,_0=mi.radius,_d=mi.eccentricitySquared,yYe={a1:_0*_d,a2:_0*_d*_0*_d,a3:_0*_d*_d/2,a4:_0*_d*_0*_d*2.5,a5:_0*_d+_0*_d*_d/2,a6:1-_d},_Ye={4267:{a:63782064e-1,f:1/294.9786982},4269:{a:6378137,f:1/298.257222101},4326:{a:mi.radius,f:mi.flattening},4490:{a:6378137,f:1/298.257222101},104900:{a:2439700,f:0},104901:{a:6051e3,f:0},104902:{a:6051800,f:0},104903:{a:oy.radius,f:oy.flattening},104904:{a:3393400,f:1/192.0430107526882},104905:{a:dp.radius,f:dp.flattening},104906:{a:6200,f:0},104907:{a:11100,f:0},104908:{a:71492e3,f:.06487439154031222},104909:{a:8200,f:0},104910:{a:83500,f:0},104911:{a:1e4,f:0},104912:{a:2409300,f:0},104913:{a:15e3,f:0},104914:{a:4e4,f:0},104915:{a:1562090,f:0},104916:{a:2632345,f:0},104917:{a:85e3,f:0},104918:{a:1821460,f:0},104919:{a:5e3,f:0},104920:{a:12e3,f:0},104921:{a:3e4,f:3},104922:{a:18e3,f:0},104923:{a:14e3,f:0},104924:{a:49300,f:0},104925:{a:60268e3,f:1/10.2079945799458},104926:{a:16e3,f:0},104927:{a:9500,f:0},104928:{a:56e4,f:0},104929:{a:249400,f:0},104930:{a:59500,f:0},104931:{a:16e3,f:0},104932:{a:133e3,f:0},104933:{a:718e3,f:0},104934:{a:888e3,f:0},104935:{a:1986300,f:0},104936:{a:1e4,f:0},104937:{a:41900,f:0},104938:{a:11e4,f:0},104939:{a:50100,f:0},104940:{a:764e3,f:0},104941:{a:11e3,f:0},104942:{a:529800,f:0},104943:{a:2575e3,f:0},104944:{a:25559e3,f:1/43.61604095563141},104945:{a:578900,f:0},104946:{a:33e3,f:0},104947:{a:21e3,f:0},104948:{a:13e3,f:0},104949:{a:31e3,f:0},104950:{a:27e3,f:0},104951:{a:42e3,f:0},104952:{a:235800,f:0},104953:{a:761400,f:0},104954:{a:15e3,f:0},104955:{a:54e3,f:0},104956:{a:77e3,f:0},104957:{a:27e3,f:0},104958:{a:788900,f:0},104959:{a:584700,f:0},104960:{a:24764e3,f:.01708124697141011},104961:{a:74e3,f:0},104962:{a:79e3,f:0},104963:{a:104e3,f:.14423076923076922},104964:{a:29e3,f:0},104965:{a:17e4,f:0},104966:{a:208e3,f:0},104967:{a:4e4,f:0},104968:{a:1352600,f:0},104969:{a:1195e3,f:0},104970:{a:593e3,f:0},104971:{a:dp.radius,f:0},104972:{a:47e4,f:0},104973:{a:255e3,f:0},104974:{a:2439400,f:0}},tO={2:{5:Cs,7:null,9:null,10:Cs,1:J3,6:null,8:null,0:null,3:ww,11:xw,2:Cs,4:Tw},5:{5:Cs,7:null,9:null,10:Cs,1:J3,6:null,8:null,0:null,3:ww,11:xw,2:Cs,4:Tw},7:{5:null,7:Cs,9:null,10:Cs,1:null,6:rZ,8:null,0:null,3:null,11:null,2:null,4:null},9:{5:null,7:null,9:Cs,10:Cs,1:null,6:null,8:iZ,0:null,3:null,11:null,2:null,4:null},3:{5:Q3,7:null,9:null,10:Q3,1:kTe,6:null,8:null,0:null,3:Cs,11:FTe,2:Q3,4:zTe},4:{5:$w,7:null,9:null,10:$w,1:UTe,6:null,8:null,0:null,3:BTe,11:bYe,2:$w,4:Cs},1:{5:Sw,7:null,9:null,10:Sw,1:Cs,6:null,8:null,0:null,3:NTe,11:wYe,2:Sw,4:VTe},6:{5:null,7:nZ,9:null,10:nZ,1:null,6:Cs,8:null,0:null,3:null,11:null,2:null,4:null},8:{5:null,7:null,9:sZ,10:sZ,1:null,6:null,8:Cs,0:null,3:null,11:null,2:null,4:null},0:{5:null,7:null,9:null,10:null,1:null,6:null,8:null,0:Cs,3:null,11:null,2:null,4:null},10:{5:Cs,7:Cs,9:Cs,10:Cs,1:J3,6:rZ,8:iZ,0:null,3:ww,11:xw,2:Cs,4:Tw},11:{5:X3,7:null,9:null,10:X3,1:xYe,6:null,8:null,0:null,3:SYe,11:Cs,2:X3,4:TYe}};function jx(t,e){return LTe(t,e)?.projector}function LTe(t,e){if(t==null||e==null)return null;if(Mm.source.spatialReference===t&&Mm.dest.spatialReference===e)return Mm;const i=ede(t,Mm.source),r=ede(e,Mm.dest);return i===0&&r===0?fs(t,e)?Mm.projector=Cs:Mm.projector=null:Mm.projector=tO[i][r],Mm}function hVt(t,e){switch(jx(t,e)){case Cs:return"copy3";case J3:return"wgs84ToSphericalECEF";case ww:return"wgs84ToWebMercator";case xw:return"wgs84ToPlateCarree";case Tw:return"wgs84ToWGS84ECEF";case Q3:return"webMercatorToWGS84";case kTe:return"webMercatorToSphericalECEF";case zTe:return"webMercatorToWGS84ECEF";case FTe:return"webMercatorToPlateCarree";case $w:return"wgs84ECEFToWGS84";case UTe:return"wgs84ECEFToSphericalECEF";case BTe:return"wgs84ECEFToWebMercator";case Sw:return"sphericalECEFToWGS84";case NTe:return"sphericalECEFToWebMercator";case nZ:return"sphericalMarsPCPFToMars2000";case sZ:return"sphericalMoonPCPFToMoon2000";case VTe:return"sphericalECEFToWGS84ECEF";case rZ:return"mars2000ToSphericalPCPF";case iZ:return"moon2000ToSphericalPCPF";default:return null}}function ede(t,e){return t?e.spatialReference===t?e.spatialReferenceId:(e.spatialReference=t,"metersPerUnit"in e&&(e.metersPerUnit=Wr(t,1)),IR(t)?e.spatialReferenceId=1:ly(t)?e.spatialReferenceId=2:Fu(t)?e.spatialReferenceId=3:DR(t)?e.spatialReferenceId=11:t.wkt===Hxe.wkt?e.spatialReferenceId=4:t.wkid===4490?e.spatialReferenceId=5:t.wkt===uU.wkt?e.spatialReferenceId=6:t.wkt===hU.wkt?e.spatialReferenceId=8:ZD(t)?e.spatialReferenceId=7:YD(t)?e.spatialReferenceId=9:e.spatialReferenceId=0):0}function Cs(t,e,i,r){t!==i&&(i[r++]=t[e++],i[r++]=t[e++],i[r]=t[e])}function Q3(t,e,i,r){i[r]=TC*(t[e]/Cw),i[r+1]=TC*(jTe-2*Math.atan(Math.exp(-t[e+1]/Cw))),i[r+2]=t[e+2]}function kTe(t,e,i,r){const s=t[e]/Cw,n=jTe-2*Math.atan(Math.exp(-t[e+1]/Cw)),a=Cw+t[e+2],o=Math.cos(n)*a;i[r]=Math.cos(s)*o,i[r+1]=Math.sin(s)*o,i[r+2]=Math.sin(n)*a}function zTe(t,e,i,r){Q3(t,e,i,r),Tw(i,r,i,r)}function vYe(t,e,i,r,s){const n=.4999999*Math.PI,a=Se(SC*t[e+1],-n,n),o=Math.sin(a);i[r++]=SC*t[e]*s.radius,i[r++]=s.halfSemiMajorAxis*Math.log((1+o)/(1-o)),i[r]=t[e+2]}function ww(t,e,i,r){vYe(t,e,i,r,mi)}function xw(t,e,i,r){i[r]=t[e]*tde,i[r+1]=t[e+1]*tde,i[r+2]=t[e+2]}function X3(t,e,i,r){i[r]=t[e]*ide,i[r+1]=t[e+1]*ide,i[r+2]=t[e+2]}function FTe(t,e,i,r){Q3(t,e,i,r),xw(i,r,i,r)}function bYe(t,e,i,r){$w(t,e,i,r),xw(i,r,i,r)}function wYe(t,e,i,r){Sw(t,e,i,r),xw(i,r,i,r)}function xYe(t,e,i,r){X3(t,e,i,r),J3(i,r,i,r)}function SYe(t,e,i,r){X3(t,e,i,r),ww(i,r,i,r)}function TYe(t,e,i,r){X3(t,e,i,r),Tw(i,r,i,r)}function Eee(t,e,i,r,s){const n=s+t[e+2],a=SC*t[e+1],o=SC*t[e],l=Math.cos(a)*n;i[r]=Math.cos(o)*l,i[r+1]=Math.sin(o)*l,i[r+2]=Math.sin(a)*n}function iZ(t,e,i,r){Eee(t,e,i,r,oy.radius)}function rZ(t,e,i,r){Eee(t,e,i,r,dp.radius)}function J3(t,e,i,r){Eee(t,e,i,r,mi.radius)}function Aee(t,e,i,r,s){const n=t[e],a=t[e+1],o=t[e+2],l=Math.sqrt(n*n+a*a+o*o),c=zu(o/(l===0?1:l)),h=Math.atan2(a,n);i[r++]=TC*h,i[r++]=TC*c,i[r]=l-s}function sZ(t,e,i,r){Aee(t,e,i,r,oy.radius)}function nZ(t,e,i,r){Aee(t,e,i,r,dp.radius)}function Sw(t,e,i,r){Aee(t,e,i,r,mi.radius)}function NTe(t,e,i,r){Sw(t,e,i,r),ww(i,r,i,r)}function VTe(t,e,i,r){Sw(t,e,i,r),Tw(i,r,i,r)}function $Ye(t,e,i,r,s){const n=SC*t[e],a=SC*t[e+1],o=t[e+2],l=Math.sin(a),c=Math.cos(a),h=s.radius/Math.sqrt(1-s.eccentricitySquared*l*l);i[r++]=(h+o)*c*Math.cos(n),i[r++]=(h+o)*c*Math.sin(n),i[r++]=(h*(1-s.eccentricitySquared)+o)*l}function Tw(t,e,i,r){$Ye(t,e,i,r,mi)}function $w(t,e,i,r){const s=yYe,n=t[e],a=t[e+1],o=t[e+2];let l,c,h,f,y,_,w,x,S,$,A,M,P,O,D,L,F,U,N,j,B;l=Math.abs(o),c=n*n+a*a,h=Math.sqrt(c),f=c+o*o,y=Math.sqrt(f),j=Math.atan2(a,n),_=o*o/f,w=c/f,O=s.a2/y,D=s.a3-s.a4/y,w>.3?(x=l/y*(1+w*(s.a1+O+_*D)/y),N=Math.asin(x),$=x*x,S=Math.sqrt(1-$)):(S=h/y*(1-_*(s.a5-O-w*D)/y),N=Math.acos(S),$=1-S*S,x=Math.sqrt($)),A=1-mi.eccentricitySquared*$,M=mi.radius/Math.sqrt(A),P=s.a6*M,O=h-M*S,D=l-P*x,F=S*O+x*D,L=S*D-x*O,U=L/(P/A+F),N+=U,B=F+L*U/2,o<0&&(N=-N),i[r++]=TC*j,i[r++]=TC*N,i[r]=B}function UTe(t,e,i,r){$w(t,e,i,r),J3(i,r,i,r)}function BTe(t,e,i,r){$w(t,e,i,r),ww(i,r,i,r)}const Mm={source:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},projector:Cs},SC=Lt(1),TC=Ea(1),jTe=.5*Math.PI,Cw=mi.radius,tde=Cw*Math.PI/180,ide=180/(Cw*Math.PI);function Aa(t,e,i,r,s,n,a=Math.floor(t.length/3)){const o=jx(e,s);if(o==null)return!1;if(o===Cs){if(t===r&&i===n)return!0;const c=i+3*a;for(let h=i,f=n;h<c;h++,f++)r[f]=t[h];return!0}const l=i+3*a;for(let c=i,h=n;c<l;c+=3,h+=3)o(t,c,r,h);return!0}const dVt=Object.freeze(Object.defineProperty({__proto__:null,projectBuffer:Aa},Symbol.toStringTag,{value:"Module"}));function rde(t,e,i,r,s,n){return y5[0]=t,y5[1]=e,y5[2]=i,Aa(y5,r,0,s,n,0)}const y5=R();function CYe(t,e,i){if(e==null||i==null||i.vcsWkid||fs(e,i)||pv(e)||pv(i))return null;const r=_p(e)/_p(i);if(r===1)return null;switch(t){case"point":case"esriGeometryPoint":return s=>MYe(s,r);case"polyline":case"esriGeometryPolyline":return s=>AYe(s,r);case"polygon":case"esriGeometryPolygon":return s=>EYe(s,r);case"multipoint":case"esriGeometryMultipoint":return s=>OYe(s,r);case"extent":case"esriGeometryEnvelope":return s=>PYe(s,r);default:return null}}function MYe(t,e){t?.z!=null&&(t.z*=e)}function EYe(t,e){if(t)for(const i of t.rings)for(const r of i)r.length>2&&(r[2]*=e)}function AYe(t,e){if(t)for(const i of t.paths)for(const r of i)r.length>2&&(r[2]*=e)}function OYe(t,e){if(t)for(const i of t.points)i.length>2&&(i[2]*=e)}function PYe(t,e){t&&t.zmin!=null&&t.zmax!=null&&(t.zmin*=e,t.zmax*=e)}let kP=null,UR=null,BR=null,$C=null,aZ={};const Oee=new e2;function Gv(){return!!(UR?.isLoaded()&&BR?.isLoaded()&&$C?.isLoaded())}function qTe(){return!!Gv()||(vt(Oee),qx(),!1)}function Ib(t,e){return!t||!e||Nu(t,e)||qTe()}function GTe(t,e){return!Nu(t,e)&&!Gv()}async function qx(t){kP==null&&(kP=Promise.all([te(()=>import("./projectOperator-CCFAEDl9.js"),__vite__mapDeps([111,112,64])).then(e=>(UR=e,UR.load())),te(()=>import("./projectOperator-CMdPtVOo.js"),__vite__mapDeps([113,112,64])).then(e=>(BR=e,BR.load())),te(()=>import("./geographicTransformationUtils-B69xrp6R.js"),[]).then(e=>($C=e,$C.load()))])),await kP,st(t),Oee.notify()}function zo(t,e,i){return Array.isArray(t)?t.length===0?[]:(Y7e(t),oZ(t,t[0].spatialReference,e,i)):(pC(t),oZ([t],t.spatialReference,e,i)[0])}function oZ(t,e,i,r){if(e==null||i==null)return t;if(Nu(e,i,r))return t.map(s=>zP(s,e,i));if(r?.geographicTransformation==null&&IR(e))return t.map(s=>zP(s,e,Ie.WGS84)).map(s=>xv(s,i));if(r?.geographicTransformation==null&&IR(i))return t.map(s=>xv(s,Ie.WGS84)).map(s=>zP(s,Ie.WGS84,i));if(!Gv())throw new WTe;if(!r?.geographicTransformation){if(r?.extendedParams)r={...r,geographicTransformation:$C.getTransformation(e,i,r.areaOfInterestExtent)||new LP};else if(!r?.areaOfInterestExtent){const s=RYe(e,i);let n=aZ[s];n||(n=$C.getTransformation(e,i)||new LP,aZ[s]=n),r={geographicTransformation:n}}}return t[0].spatialReference||(t[0].spatialReference=e),t[0]instanceof so?UR.executeMany(t,i,r):BR.executeMany(t,i,r)}function RYe(t,e){return[t.wkid?.toString()??"-1",t.wkt?.toString()??"",t.wkt2?.toString()??"",e.wkid?.toString()??"-1",e.wkt?.toString()??"",e.wkt2?.toString()??""].join()}function DYe(t,e){const i=HTe([t],e);return i.pending!=null?{pending:i.pending,geometry:null}:i.geometries!=null?{pending:null,geometry:i.geometries[0]}:{pending:null,geometry:null}}function HTe(t,e){if(!Gv()){for(const i of t)if(i!=null&&!fs(i.spatialReference,e)&&ip(i.spatialReference)&&ip(e)&&!Nu(i.spatialReference,e))return vt(Oee),{pending:qx(),geometries:null}}return{pending:null,geometries:t.map(i=>i==null?null:fs(i.spatialReference,e)?i:ip(i.spatialReference)&&ip(e)?xv(i,e):null)}}let WTe=class extends ee{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}};function IYe(){kP=null,UR=null,BR=null,$C=null,aZ={}}const LYe={get loadPromise(){return kP}};function xv(t,e){try{const i=zo(t,e);if(i==null)return null;"xmin"in t&&"xmin"in i&&(i.zmin=t.zmin,i.zmax=t.zmax);const r=CYe(i.type,t.spatialReference,e);return r?.(i),i}catch(i){if(!(i instanceof WTe))throw i;return null}}async function fy(t,e,i){const r=t.spatialReference;return r!=null&&e!=null&&await wp(r,e,null,i),xv(t,e)}function Nu(t,e,i){return!(i?.areaOfInterestExtent||i?.extendedParams||i?.geographicTransformation)&&(!!fs(t,e)||ip(t)&&ip(e)&&!!jx(t,e))}function kYe(t,e){if(fs(t,e))return!0;if(!ip(t)||!ip(e))return!1;const i=ly(t)||Fu(t)||RR(t),r=ly(e)||Fu(e)||RR(e);return i&&r}async function wp(t,e,i,r){if(Gv())return nue(r);if(Array.isArray(t)){for(const{source:s,dest:n,options:a}of t)if(s&&n&&!Nu(s,n,a))return qx(r)}else if(t&&e&&!Nu(t,e,i))return qx(r);return nue(r)}function zP(t,e,i){return t?"x"in t?YTe(t,e,new Qe,i,0):"xmin"in t?e3e(t,e,new Bt,i,0):"rings"in t?KTe(t,e,new os,i,0):"paths"in t?XTe(t,e,new Ps,i,0):"points"in t?QTe(t,e,new Po,i,0):null:null}function ZTe(t,e,i=e.spatialReference,r=0){return i!=null&&t.spatialReference!=null&&YTe(t,t.spatialReference,e,i,r)!=null}function YTe(t,e,i,r,s){Jo[0]=t.x,Jo[1]=t.y;const n=t.z;return Jo[2]=n!==void 0?n:s,Aa(Jo,e,0,Jo,r,0)?(i.x=Jo[0],i.y=Jo[1],i.spatialReference=r,n!==void 0||pv(r)?(i.z=Jo[2],i.hasZ=!0):(i.z=void 0,i.hasZ=!1),t.m===void 0?(i.m=void 0,i.hasM=!1):(i.m=t.m,i.hasM=!0),i):null}function zYe(t,e,i=e.spatialReference,r=0){return t.spatialReference!=null&&i!=null&&QTe(t,t.spatialReference,e,i,r)!=null}function QTe(t,e,i,r,s){const{points:n,hasZ:a,hasM:o}=t,l=[],c=n.length,h=[];for(const y of n)h.push(y[0],y[1],a?y[2]:s);if(!Aa(h,e,0,h,r,0,c))return null;const f=a||pv(r);for(let y=0;y<c;++y){const _=3*y,w=h[_],x=h[_+1];f&&o?l.push([w,x,h[_+2],n[y][3]]):f?l.push([w,x,h[_+2]]):o?l.push([w,x,n[y][2]]):l.push([w,x])}return i.points=l,i.spatialReference=r,i.hasZ=a,i.hasM=o,i}function FYe(t,e,i=e.spatialReference,r=0){return t.spatialReference!=null&&i!=null&&XTe(t,t.spatialReference,e,i,r)!=null}function XTe(t,e,i,r,s){const{paths:n,hasZ:a,hasM:o}=t,l=[];if(!t3e(n,a??!1,o??!1,e,l,r,s))return null;const c=a||pv(r);return i.paths=l,i.spatialReference=r,i.hasZ=c,i.hasM=o,i}function JTe(t,e,i=e.spatialReference,r=0){return t.spatialReference!=null&&i!=null&&KTe(t,t.spatialReference,e,i,r)!=null}function KTe(t,e,i,r,s){const{rings:n,hasZ:a,hasM:o}=t,l=[];if(!t3e(n,a??!1,o??!1,e,l,r,s))return null;const c=a||pv(r);return i.rings=l,i.spatialReference=r,i.hasZ=c,i.hasM=o,i}function NYe(t,e,i=e.spatialReference,r=0){return t.spatialReference!=null&&i!=null&&e3e(t,t.spatialReference,e,i,r)!=null}function e3e(t,e,i,r,s){const{xmin:n,ymin:a,xmax:o,ymax:l,hasZ:c,hasM:h}=t,f=c?t.zmin:s;if(!rde(n,a,f,e,Jo,r))return null;const y=c||pv(r);i.xmin=Jo[0],i.ymin=Jo[1],y&&(i.zmin=Jo[2]);const _=c?t.zmax:s;return rde(o,l,_,e,Jo,r)?(i.xmax=Jo[0],i.ymax=Jo[1],y&&(i.zmax=Jo[2]),h&&(i.mmin=t.mmin,i.mmax=t.mmax),i.spatialReference=r,i):null}function t3e(t,e,i,r,s,n,a=0){const o=new Array;for(const h of t)for(const f of h)o.push(f[0],f[1],e?f[2]:a);if(!Aa(o,r,0,o,n,0))return!1;let l=0;s.length=0;const c=e||pv(n);for(const h of t){const f=new Array;for(const y of h)c&&i?f.push([o[l++],o[l++],o[l++],y[3]]):c?f.push([o[l++],o[l++],o[l++]]):i?(f.push([o[l++],o[l++],y[2]]),l++):(f.push([o[l++],o[l++]]),l++);s.push(f)}return!0}const Jo=R(),fVt=Object.freeze(Object.defineProperty({__proto__:null,canProjectWithoutEngine:Nu,initializeProjection:wp,isEqualBaseGCS:kYe,isLoaded:Gv,isLoadedOrLoad:qTe,isLoadedOrLoadFor:Ib,load:qx,project:zo,projectExtent:NYe,projectMany:oZ,projectMultipoint:zYe,projectOrLoad:DYe,projectOrLoadMany:HTe,projectPoint:ZTe,projectPolygon:JTe,projectPolyline:FYe,projectWithZConversion:fy,projectWithoutEngine:zP,requiresLoad:GTe,test:LYe,tryProjectWithZConversion:xv,unload:IYe},Symbol.toStringTag,{value:"Module"})),VYe=new Ie(Gxe),u3=new Ie(uU),h3=new Ie(hU),UYe=new Ie(Hxe);function Sv(t){const e=lZ.get(t);if(e)return e;let i=VYe;if(t)if(t===u3)i=u3;else if(t===h3)i=h3;else{const r=t.wkid,s=t.latestWkid;if(r!=null||s!=null)uC(r)||uC(s)?i=u3:(hC(r)||hC(s))&&(i=h3);else{const n=t.wkt2??t.wkt;if(n){const a=n.toUpperCase();a===jYe?i=u3:a===qYe&&(i=h3)}}}return lZ.set(t,i),i}const lZ=new Map;function BYe(){lZ.clear()}const jYe=u3.wkt.toUpperCase(),qYe=h3.wkt.toUpperCase();function Pee(t,e,i,r){return t!=null&&(fs(e,r)?(Bv(i,t),!0):(nc[0]=t[0],nc[1]=t[1],nc[2]=0,!!Aa(nc,e,0,nc,r,0)&&(i[0]=nc[0],i[1]=nc[1],nc[0]=t[2],nc[1]=t[3],nc[2]=0,!!Aa(nc,e,0,nc,r,0)&&(i[2]=nc[0],i[3]=nc[1],!0))))}const nc=R();function Yl(t,e,i,r){if(Nu(t.spatialReference,i)){_5[0]=t.x,_5[1]=t.y;const n=t.z;return _5[2]=n??r??0,Aa(_5,t.spatialReference,0,e,i,0)}const s=xv(t,i);return!!s&&(e[0]=s?.x,e[1]=s?.y,e[2]=s?.z??r??0,!0)}async function c6(t,e,i,r,s){return await wp(t.spatialReference,i,null,s),Yl(t,e,i,r)}const _5=R();function pn(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function sm(t,e,i,r,s,n,a,o,l,c,h,f,y,_,w,x,S){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t[4]=n,t[5]=a,t[6]=o,t[7]=l,t[8]=c,t[9]=h,t[10]=f,t[11]=y,t[12]=_,t[13]=w,t[14]=x,t[15]=S,t}function xp(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Ql(t,e){if(t===e){const i=e[1],r=e[2],s=e[3],n=e[6],a=e[7],o=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=n,t[11]=e[14],t[12]=s,t[13]=a,t[14]=o}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function i3e(t,e){return nl(t,e)||xp(t),t}function nl(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],a=e[4],o=e[5],l=e[6],c=e[7],h=e[8],f=e[9],y=e[10],_=e[11],w=e[12],x=e[13],S=e[14],$=e[15],A=i*o-r*a,M=i*l-s*a,P=i*c-n*a,O=r*l-s*o,D=r*c-n*o,L=s*c-n*l,F=h*x-f*w,U=h*S-y*w,N=h*$-_*w,j=f*S-y*x,B=f*$-_*x,Y=y*$-_*S;let G=A*Y-M*B+P*j+O*N-D*U+L*F;return G?(G=1/G,t[0]=(o*Y-l*B+c*j)*G,t[1]=(s*B-r*Y-n*j)*G,t[2]=(x*L-S*D+$*O)*G,t[3]=(y*D-f*L-_*O)*G,t[4]=(l*N-a*Y-c*U)*G,t[5]=(i*Y-s*N+n*U)*G,t[6]=(S*P-w*L-$*M)*G,t[7]=(h*L-y*P+_*M)*G,t[8]=(a*B-o*N+c*F)*G,t[9]=(r*N-i*B-n*F)*G,t[10]=(w*D-x*P+$*A)*G,t[11]=(f*P-h*D-_*A)*G,t[12]=(o*U-a*j-l*F)*G,t[13]=(i*j-r*U+s*F)*G,t[14]=(x*M-w*O-S*A)*G,t[15]=(h*O-f*M+y*A)*G,t):null}function GYe(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],a=e[4],o=e[5],l=e[6],c=e[7],h=e[8],f=e[9],y=e[10],_=e[11],w=e[12],x=e[13],S=e[14],$=e[15];return t[0]=o*(y*$-_*S)-f*(l*$-c*S)+x*(l*_-c*y),t[1]=-(r*(y*$-_*S)-f*(s*$-n*S)+x*(s*_-n*y)),t[2]=r*(l*$-c*S)-o*(s*$-n*S)+x*(s*c-n*l),t[3]=-(r*(l*_-c*y)-o*(s*_-n*y)+f*(s*c-n*l)),t[4]=-(a*(y*$-_*S)-h*(l*$-c*S)+w*(l*_-c*y)),t[5]=i*(y*$-_*S)-h*(s*$-n*S)+w*(s*_-n*y),t[6]=-(i*(l*$-c*S)-a*(s*$-n*S)+w*(s*c-n*l)),t[7]=i*(l*_-c*y)-a*(s*_-n*y)+h*(s*c-n*l),t[8]=a*(f*$-_*x)-h*(o*$-c*x)+w*(o*_-c*f),t[9]=-(i*(f*$-_*x)-h*(r*$-n*x)+w*(r*_-n*f)),t[10]=i*(o*$-c*x)-a*(r*$-n*x)+w*(r*c-n*o),t[11]=-(i*(o*_-c*f)-a*(r*_-n*f)+h*(r*c-n*o)),t[12]=-(a*(f*S-y*x)-h*(o*S-l*x)+w*(o*y-l*f)),t[13]=i*(f*S-y*x)-h*(r*S-s*x)+w*(r*y-s*f),t[14]=-(i*(o*S-l*x)-a*(r*S-s*x)+w*(r*l-s*o)),t[15]=i*(o*y-l*f)-a*(r*y-s*f)+h*(r*l-s*o),t}function HYe(t){const e=t[0],i=t[1],r=t[2],s=t[3],n=t[4],a=t[5],o=t[6],l=t[7],c=t[8],h=t[9],f=t[10],y=t[11],_=t[12],w=t[13],x=t[14],S=t[15];return(e*a-i*n)*(f*S-y*x)-(e*o-r*n)*(h*S-y*w)+(e*l-s*n)*(h*x-f*w)+(i*o-r*a)*(c*S-y*_)-(i*l-s*a)*(c*x-f*_)+(r*l-s*o)*(c*w-h*_)}function an(t,e,i){const r=e[0],s=e[1],n=e[2],a=e[3],o=e[4],l=e[5],c=e[6],h=e[7],f=e[8],y=e[9],_=e[10],w=e[11],x=e[12],S=e[13],$=e[14],A=e[15];let M=i[0],P=i[1],O=i[2],D=i[3];return t[0]=M*r+P*o+O*f+D*x,t[1]=M*s+P*l+O*y+D*S,t[2]=M*n+P*c+O*_+D*$,t[3]=M*a+P*h+O*w+D*A,M=i[4],P=i[5],O=i[6],D=i[7],t[4]=M*r+P*o+O*f+D*x,t[5]=M*s+P*l+O*y+D*S,t[6]=M*n+P*c+O*_+D*$,t[7]=M*a+P*h+O*w+D*A,M=i[8],P=i[9],O=i[10],D=i[11],t[8]=M*r+P*o+O*f+D*x,t[9]=M*s+P*l+O*y+D*S,t[10]=M*n+P*c+O*_+D*$,t[11]=M*a+P*h+O*w+D*A,M=i[12],P=i[13],O=i[14],D=i[15],t[12]=M*r+P*o+O*f+D*x,t[13]=M*s+P*l+O*y+D*S,t[14]=M*n+P*c+O*_+D*$,t[15]=M*a+P*h+O*w+D*A,t}function Qh(t,e,i){const r=i[0],s=i[1],n=i[2];if(e===t)t[12]=e[0]*r+e[4]*s+e[8]*n+e[12],t[13]=e[1]*r+e[5]*s+e[9]*n+e[13],t[14]=e[2]*r+e[6]*s+e[10]*n+e[14],t[15]=e[3]*r+e[7]*s+e[11]*n+e[15];else{const a=e[0],o=e[1],l=e[2],c=e[3],h=e[4],f=e[5],y=e[6],_=e[7],w=e[8],x=e[9],S=e[10],$=e[11];t[0]=a,t[1]=o,t[2]=l,t[3]=c,t[4]=h,t[5]=f,t[6]=y,t[7]=_,t[8]=w,t[9]=x,t[10]=S,t[11]=$,t[12]=a*r+h*s+w*n+e[12],t[13]=o*r+f*s+x*n+e[13],t[14]=l*r+y*s+S*n+e[14],t[15]=c*r+_*s+$*n+e[15]}return t}function r3e(t,e,i){const r=i[0],s=i[1],n=i[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Eu(t,e,i,r){let s=r[0],n=r[1],a=r[2],o=Math.sqrt(s*s+n*n+a*a);if(o<=nn())return void pn(t,e);o=1/o,s*=o,n*=o,a*=o;const l=Math.sin(i),c=Math.cos(i),h=1-c,f=e[0],y=e[1],_=e[2],w=e[3],x=e[4],S=e[5],$=e[6],A=e[7],M=e[8],P=e[9],O=e[10],D=e[11],L=s*s*h+c,F=n*s*h+a*l,U=a*s*h-n*l,N=s*n*h-a*l,j=n*n*h+c,B=a*n*h+s*l,Y=s*a*h+n*l,G=n*a*h-s*l,Z=a*a*h+c;t[0]=f*L+x*F+M*U,t[1]=y*L+S*F+P*U,t[2]=_*L+$*F+O*U,t[3]=w*L+A*F+D*U,t[4]=f*N+x*j+M*B,t[5]=y*N+S*j+P*B,t[6]=_*N+$*j+O*B,t[7]=w*N+A*j+D*B,t[8]=f*Y+x*G+M*Z,t[9]=y*Y+S*G+P*Z,t[10]=_*Y+$*G+O*Z,t[11]=w*Y+A*G+D*Z,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15])}function CC(t,e,i){const r=Math.sin(i),s=Math.cos(i),n=e[4],a=e[5],o=e[6],l=e[7],c=e[8],h=e[9],f=e[10],y=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=n*s+c*r,t[5]=a*s+h*r,t[6]=o*s+f*r,t[7]=l*s+y*r,t[8]=c*s-n*r,t[9]=h*s-a*r,t[10]=f*s-o*r,t[11]=y*s-l*r,t}function IU(t,e,i){const r=Math.sin(i),s=Math.cos(i),n=e[0],a=e[1],o=e[2],l=e[3],c=e[8],h=e[9],f=e[10],y=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*s-c*r,t[1]=a*s-h*r,t[2]=o*s-f*r,t[3]=l*s-y*r,t[8]=n*r+c*s,t[9]=a*r+h*s,t[10]=o*r+f*s,t[11]=l*r+y*s,t}function MC(t,e,i){const r=Math.sin(i),s=Math.cos(i),n=e[0],a=e[1],o=e[2],l=e[3],c=e[4],h=e[5],f=e[6],y=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*s+c*r,t[1]=a*s+h*r,t[2]=o*s+f*r,t[3]=l*s+y*r,t[4]=c*s-n*r,t[5]=h*s-a*r,t[6]=f*s-o*r,t[7]=y*s-l*r,t}function LU(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function WYe(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Xh(t,e,i){if(e===0)return xp(t);let r=i[0],s=i[1],n=i[2],a=Math.sqrt(r*r+s*s+n*n);if(a<=nn())return null;a=1/a,r*=a,s*=a,n*=a;const o=Math.sin(e),l=Math.cos(e),c=1-l;return t[0]=r*r*c+l,t[1]=s*r*c+n*o,t[2]=n*r*c-s*o,t[3]=0,t[4]=r*s*c-n*o,t[5]=s*s*c+l,t[6]=n*s*c+r*o,t[7]=0,t[8]=r*n*c+s*o,t[9]=s*n*c-r*o,t[10]=n*n*c+l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ZYe(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=i,t[7]=0,t[8]=0,t[9]=-i,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function YYe(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-i,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=i,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function s3e(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=0,t[3]=0,t[4]=-i,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function n3e(t,e,i){const r=e[0],s=e[1],n=e[2],a=e[3],o=r+r,l=s+s,c=n+n,h=r*o,f=r*l,y=r*c,_=s*l,w=s*c,x=n*c,S=a*o,$=a*l,A=a*c;return t[0]=1-(_+x),t[1]=f+A,t[2]=y-$,t[3]=0,t[4]=f-A,t[5]=1-(h+x),t[6]=w+S,t[7]=0,t[8]=y+$,t[9]=w-S,t[10]=1-(h+_),t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function QYe(t,e){const i=XYe,r=-e[0],s=-e[1],n=-e[2],a=e[3],o=e[4],l=e[5],c=e[6],h=e[7],f=r*r+s*s+n*n+a*a;return f>0?(i[0]=2*(o*a+h*r+l*n-c*s)/f,i[1]=2*(l*a+h*s+c*r-o*n)/f,i[2]=2*(c*a+h*n+o*s-l*r)/f):(i[0]=2*(o*a+h*r+l*n-c*s),i[1]=2*(l*a+h*s+c*r-o*n),i[2]=2*(c*a+h*n+o*s-l*r)),n3e(t,e,i),t}const XYe=R();function JYe(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function a3e(t,e){const i=e[0],r=e[1],s=e[2],n=e[4],a=e[5],o=e[6],l=e[8],c=e[9],h=e[10];return t[0]=Math.sqrt(i*i+r*r+s*s),t[1]=Math.sqrt(n*n+a*a+o*o),t[2]=Math.sqrt(l*l+c*c+h*h),t}function o3e(t,e){const i=e[0]+e[5]+e[10];let r=0;return i>0?(r=2*Math.sqrt(i+1),t[3]=.25*r,t[0]=(e[6]-e[9])/r,t[1]=(e[8]-e[2])/r,t[2]=(e[1]-e[4])/r):e[0]>e[5]&&e[0]>e[10]?(r=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/r,t[0]=.25*r,t[1]=(e[1]+e[4])/r,t[2]=(e[8]+e[2])/r):e[5]>e[10]?(r=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/r,t[0]=(e[1]+e[4])/r,t[1]=.25*r,t[2]=(e[6]+e[9])/r):(r=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/r,t[0]=(e[8]+e[2])/r,t[1]=(e[6]+e[9])/r,t[2]=.25*r),t}function KYe(t,e,i,r){const s=e[0],n=e[1],a=e[2],o=e[3],l=s+s,c=n+n,h=a+a,f=s*l,y=s*c,_=s*h,w=n*c,x=n*h,S=a*h,$=o*l,A=o*c,M=o*h,P=r[0],O=r[1],D=r[2];return t[0]=(1-(w+S))*P,t[1]=(y+M)*P,t[2]=(_-A)*P,t[3]=0,t[4]=(y-M)*O,t[5]=(1-(f+S))*O,t[6]=(x+$)*O,t[7]=0,t[8]=(_+A)*D,t[9]=(x-$)*D,t[10]=(1-(f+w))*D,t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function eQe(t,e,i,r,s){const n=e[0],a=e[1],o=e[2],l=e[3],c=n+n,h=a+a,f=o+o,y=n*c,_=n*h,w=n*f,x=a*h,S=a*f,$=o*f,A=l*c,M=l*h,P=l*f,O=r[0],D=r[1],L=r[2],F=s[0],U=s[1],N=s[2],j=(1-(x+$))*O,B=(_+P)*O,Y=(w-M)*O,G=(_-P)*D,Z=(1-(y+$))*D,H=(S+A)*D,Q=(w+M)*L,X=(S-A)*L,ye=(1-(y+x))*L;return t[0]=j,t[1]=B,t[2]=Y,t[3]=0,t[4]=G,t[5]=Z,t[6]=H,t[7]=0,t[8]=Q,t[9]=X,t[10]=ye,t[11]=0,t[12]=i[0]+F-(j*F+G*U+Q*N),t[13]=i[1]+U-(B*F+Z*U+X*N),t[14]=i[2]+N-(Y*F+H*U+ye*N),t[15]=1,t}function tQe(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],a=i+i,o=r+r,l=s+s,c=i*a,h=r*a,f=r*o,y=s*a,_=s*o,w=s*l,x=n*a,S=n*o,$=n*l;return t[0]=1-f-w,t[1]=h+$,t[2]=y-S,t[3]=0,t[4]=h-$,t[5]=1-c-w,t[6]=_+x,t[7]=0,t[8]=y+S,t[9]=_-x,t[10]=1-c-f,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function l3e(t,e,i,r,s,n,a){const o=1/(i-e),l=1/(s-r),c=1/(n-a);return t[0]=2*n*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*n*l,t[6]=0,t[7]=0,t[8]=(i+e)*o,t[9]=(s+r)*l,t[10]=(a+n)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*n*2*c,t[15]=0,t}function iQe(t,e,i,r,s){const n=1/Math.tan(e/2);let a;return t[0]=n/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0?(a=1/(r-s),t[10]=(s+r)*a,t[14]=2*s*r*a):(t[10]=-1,t[14]=-2*r),t}function rQe(t,e,i,r){const s=Math.tan(e.upDegrees*Math.PI/180),n=Math.tan(e.downDegrees*Math.PI/180),a=Math.tan(e.leftDegrees*Math.PI/180),o=Math.tan(e.rightDegrees*Math.PI/180),l=2/(a+o),c=2/(s+n);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(a-o)*l*.5,t[9]=(s-n)*c*.5,t[10]=r/(i-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*i/(i-r),t[15]=0,t}function c3e(t,e,i,r,s,n,a){const o=1/(e-i),l=1/(r-s),c=1/(n-a);return t[0]=-2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+i)*o,t[13]=(s+r)*l,t[14]=(a+n)*c,t[15]=1,t}function kU(t,e,i,r){const s=e[0],n=e[1],a=e[2];let o=s-i[0],l=n-i[1],c=a-i[2];const h=nn();if(Math.abs(o)<h&&Math.abs(l)<h&&Math.abs(c)<h)return void xp(t);let f=1/Math.sqrt(o*o+l*l+c*c);o*=f,l*=f,c*=f;const y=r[0],_=r[1],w=r[2];let x=_*c-w*l,S=w*o-y*c,$=y*l-_*o;f=Math.sqrt(x*x+S*S+$*$),f?(f=1/f,x*=f,S*=f,$*=f):(x=0,S=0,$=0);let A=l*$-c*S,M=c*x-o*$,P=o*S-l*x;f=Math.sqrt(A*A+M*M+P*P),f?(f=1/f,A*=f,M*=f,P*=f):(A=0,M=0,P=0),t[0]=x,t[1]=A,t[2]=o,t[3]=0,t[4]=S,t[5]=M,t[6]=l,t[7]=0,t[8]=$,t[9]=P,t[10]=c,t[11]=0,t[12]=-(x*s+S*n+$*a),t[13]=-(A*s+M*n+P*a),t[14]=-(o*s+l*n+c*a),t[15]=1}function u3e(t,e,i,r){const s=e[0],n=e[1],a=e[2],o=r[0],l=r[1],c=r[2];let h=s-i[0],f=n-i[1],y=a-i[2],_=h*h+f*f+y*y;_>0&&(_=1/Math.sqrt(_),h*=_,f*=_,y*=_);let w=l*y-c*f,x=c*h-o*y,S=o*f-l*h;return _=w*w+x*x+S*S,_>0&&(_=1/Math.sqrt(_),w*=_,x*=_,S*=_),t[0]=w,t[1]=x,t[2]=S,t[3]=0,t[4]=f*S-y*x,t[5]=y*w-h*S,t[6]=h*x-f*w,t[7]=0,t[8]=h,t[9]=f,t[10]=y,t[11]=0,t[12]=s,t[13]=n,t[14]=a,t[15]=1,t}function sQe(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function nQe(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2+t[9]**2+t[10]**2+t[11]**2+t[12]**2+t[13]**2+t[14]**2+t[15]**2)}function aQe(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t[9]=e[9]+i[9],t[10]=e[10]+i[10],t[11]=e[11]+i[11],t[12]=e[12]+i[12],t[13]=e[13]+i[13],t[14]=e[14]+i[14],t[15]=e[15]+i[15],t}function h3e(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t[9]=e[9]-i[9],t[10]=e[10]-i[10],t[11]=e[11]-i[11],t[12]=e[12]-i[12],t[13]=e[13]-i[13],t[14]=e[14]-i[14],t[15]=e[15]-i[15],t}function oQe(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12]*i,t[13]=e[13]*i,t[14]=e[14]*i,t[15]=e[15]*i,t}function lQe(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t[6]=e[6]+i[6]*r,t[7]=e[7]+i[7]*r,t[8]=e[8]+i[8]*r,t[9]=e[9]+i[9]*r,t[10]=e[10]+i[10]*r,t[11]=e[11]+i[11]*r,t[12]=e[12]+i[12]*r,t[13]=e[13]+i[13]*r,t[14]=e[14]+i[14]*r,t[15]=e[15]+i[15]*r,t}function d3e(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function Ree(t,e){if(t===e)return!0;const i=t[0],r=t[1],s=t[2],n=t[3],a=t[4],o=t[5],l=t[6],c=t[7],h=t[8],f=t[9],y=t[10],_=t[11],w=t[12],x=t[13],S=t[14],$=t[15],A=e[0],M=e[1],P=e[2],O=e[3],D=e[4],L=e[5],F=e[6],U=e[7],N=e[8],j=e[9],B=e[10],Y=e[11],G=e[12],Z=e[13],H=e[14],Q=e[15],X=nn();return Math.abs(i-A)<=X*Math.max(1,Math.abs(i),Math.abs(A))&&Math.abs(r-M)<=X*Math.max(1,Math.abs(r),Math.abs(M))&&Math.abs(s-P)<=X*Math.max(1,Math.abs(s),Math.abs(P))&&Math.abs(n-O)<=X*Math.max(1,Math.abs(n),Math.abs(O))&&Math.abs(a-D)<=X*Math.max(1,Math.abs(a),Math.abs(D))&&Math.abs(o-L)<=X*Math.max(1,Math.abs(o),Math.abs(L))&&Math.abs(l-F)<=X*Math.max(1,Math.abs(l),Math.abs(F))&&Math.abs(c-U)<=X*Math.max(1,Math.abs(c),Math.abs(U))&&Math.abs(h-N)<=X*Math.max(1,Math.abs(h),Math.abs(N))&&Math.abs(f-j)<=X*Math.max(1,Math.abs(f),Math.abs(j))&&Math.abs(y-B)<=X*Math.max(1,Math.abs(y),Math.abs(B))&&Math.abs(_-Y)<=X*Math.max(1,Math.abs(_),Math.abs(Y))&&Math.abs(w-G)<=X*Math.max(1,Math.abs(w),Math.abs(G))&&Math.abs(x-Z)<=X*Math.max(1,Math.abs(x),Math.abs(Z))&&Math.abs(S-H)<=X*Math.max(1,Math.abs(S),Math.abs(H))&&Math.abs($-Q)<=X*Math.max(1,Math.abs($),Math.abs(Q))}function Dee(t){const e=nn(),i=t[0],r=t[1],s=t[2],n=t[4],a=t[5],o=t[6],l=t[8],c=t[9],h=t[10];return Math.abs(1-(i*i+n*n+l*l))<=e&&Math.abs(1-(r*r+a*a+c*c))<=e&&Math.abs(1-(s*s+o*o+h*h))<=e}function zU(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[8]===0&&t[9]===0&&t[10]===1}const cQe=an,uQe=h3e;Object.freeze(Object.defineProperty({__proto__:null,add:aQe,adjoint:GYe,copy:pn,determinant:HYe,equals:Ree,exactEquals:d3e,frob:nQe,fromQuat:tQe,fromQuat2:QYe,fromRotation:Xh,fromRotationTranslation:n3e,fromRotationTranslationScale:KYe,fromRotationTranslationScaleOrigin:eQe,fromScaling:WYe,fromTranslation:LU,fromXRotation:ZYe,fromYRotation:YYe,fromZRotation:s3e,frustum:l3e,getRotation:o3e,getScale:a3e,getTranslation:JYe,hasIdentityRotation:zU,identity:xp,invert:nl,invertOrIdentity:i3e,isOrthoNormal:Dee,lookAt:kU,mul:cQe,multiply:an,multiplyScalar:oQe,multiplyScalarAndAdd:lQe,ortho:c3e,perspective:iQe,perspectiveFromFieldOfView:rQe,rotate:Eu,rotateX:CC,rotateY:IU,rotateZ:MC,scale:r3e,set:sm,str:sQe,sub:uQe,subtract:h3e,targetTo:u3e,translate:Qh,transpose:Ql},Symbol.toStringTag,{value:"Module"}));function Le(t){const e=t[0],i=t[1],r=t[2];return Math.sqrt(e*e+i*i+r*r)}function de(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function ve(t,e,i,r){return t[0]=e,t[1]=i,t[2]=r,t}function xe(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}function Ce(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function Iee(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t}function p3e(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t}function hQe(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function f3e(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function EC(t,e){return t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t}function m3e(t,e){return t[0]=Math.sign(e[0]),t[1]=Math.sign(e[1]),t[2]=Math.sign(e[2]),t}function g3e(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t}function y3e(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t}function dQe(t,e=0,i=1){return t[0]=Math.min(Math.max(t[0],e),i),t[1]=Math.min(Math.max(t[1],e),i),t[2]=Math.min(Math.max(t[2],e),i),t}function pQe(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function le(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function Tr(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t}function Ri(t,e){const i=e[0]-t[0],r=e[1]-t[1],s=e[2]-t[2];return Math.sqrt(i*i+r*r+s*s)}function on(t,e){const i=e[0]-t[0],r=e[1]-t[1],s=e[2]-t[2];return i*i+r*r+s*s}function On(t){const e=t[0],i=t[1],r=t[2];return e*e+i*i+r*r}function Gh(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function fQe(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function Ee(t,e){const i=e[0],r=e[1],s=e[2];let n=i*i+r*r+s*s;return n>0&&(n=1/Math.sqrt(n),t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n),t}function Oe(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function bt(t,e,i){const r=e[0],s=e[1],n=e[2],a=i[0],o=i[1],l=i[2];return t[0]=s*l-n*o,t[1]=n*a-r*l,t[2]=r*o-s*a,t}function mQe(t,e,i){const r=e[0],s=e[1],n=e[2],a=i[0],o=i[1],l=i[2],c=s*l-n*o,h=n*a-r*l,f=r*o-s*a,y=Math.sqrt(c*c+h*h+f*f);return t[0]=c/y,t[1]=h/y,t[2]=f/y,t}function Wi(t,e,i,r){const s=e[0],n=e[1],a=e[2];return t[0]=s+r*(i[0]-s),t[1]=n+r*(i[1]-n),t[2]=a+r*(i[2]-a),t}function gQe(t,e,i,r,s,n){const a=n*n,o=a*(2*n-3)+1,l=a*(n-2)+n,c=a*(n-1),h=a*(3-2*n);return t[0]=e[0]*o+i[0]*l+r[0]*c+s[0]*h,t[1]=e[1]*o+i[1]*l+r[1]*c+s[1]*h,t[2]=e[2]*o+i[2]*l+r[2]*c+s[2]*h,t}function yQe(t,e,i,r,s,n){const a=1-n,o=a*a,l=n*n,c=o*a,h=3*n*o,f=3*l*a,y=l*n;return t[0]=e[0]*c+i[0]*h+r[0]*f+s[0]*y,t[1]=e[1]*c+i[1]*h+r[1]*f+s[1]*y,t[2]=e[2]*c+i[2]*h+r[2]*f+s[2]*y,t}function _Qe(t,e=1){const i=XD,r=2*i()*Math.PI,s=2*i()-1,n=Math.sqrt(1-s*s)*e;return t[0]=Math.cos(r)*n,t[1]=Math.sin(r)*n,t[2]=s*e,t}function Mt(t,e,i){const r=e[0],s=e[1],n=e[2];return t[0]=i[0]*r+i[4]*s+i[8]*n+i[12],t[1]=i[1]*r+i[5]*s+i[9]*n+i[13],t[2]=i[2]*r+i[6]*s+i[10]*n+i[14],t}function rl(t,e,i){const r=e[0],s=e[1],n=e[2];return t[0]=r*i[0]+s*i[3]+n*i[6],t[1]=r*i[1]+s*i[4]+n*i[7],t[2]=r*i[2]+s*i[5]+n*i[8],t}function Tc(t,e,i){const r=i[0],s=i[1],n=i[2],a=i[3],o=e[0],l=e[1],c=e[2],h=s*c-n*l,f=n*o-r*c,y=r*l-s*o,_=s*y-n*f,w=n*h-r*y,x=r*f-s*h,S=2*a;return t[0]=o+h*S+2*_,t[1]=l+f*S+2*w,t[2]=c+y*S+2*x,t}function vQe(t,e,i,r){const s=[],n=[];return s[0]=e[0]-i[0],s[1]=e[1]-i[1],s[2]=e[2]-i[2],n[0]=s[0],n[1]=s[1]*Math.cos(r)-s[2]*Math.sin(r),n[2]=s[1]*Math.sin(r)+s[2]*Math.cos(r),t[0]=n[0]+i[0],t[1]=n[1]+i[1],t[2]=n[2]+i[2],t}function bQe(t,e,i,r){const s=[],n=[];return s[0]=e[0]-i[0],s[1]=e[1]-i[1],s[2]=e[2]-i[2],n[0]=s[2]*Math.sin(r)+s[0]*Math.cos(r),n[1]=s[1],n[2]=s[2]*Math.cos(r)-s[0]*Math.sin(r),t[0]=n[0]+i[0],t[1]=n[1]+i[1],t[2]=n[2]+i[2],t}function wQe(t,e,i,r){const s=[],n=[];return s[0]=e[0]-i[0],s[1]=e[1]-i[1],s[2]=e[2]-i[2],n[0]=s[0]*Math.cos(r)-s[1]*Math.sin(r),n[1]=s[0]*Math.sin(r)+s[1]*Math.cos(r),n[2]=s[2],t[0]=n[0]+i[0],t[1]=n[1]+i[1],t[2]=n[2]+i[2],t}function _3e(t,e){Ee(sde,t),Ee(nde,e);const i=Oe(sde,nde);return i>1?0:i<-1?Math.PI:Math.acos(i)}const sde=R(),nde=R();function xQe(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function si(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function Tv(t,e){if(t===e)return!0;const i=t[0],r=t[1],s=t[2],n=e[0],a=e[1],o=e[2],l=nn();return Math.abs(i-n)<=l*Math.max(1,Math.abs(i),Math.abs(n))&&Math.abs(r-a)<=l*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(s-o)<=l*Math.max(1,Math.abs(s),Math.abs(o))}function Hv(t,e,i){const r=i[0]-e[0],s=i[1]-e[1],n=i[2]-e[2];let a=r*r+s*s+n*n;return a>0?(a=1/Math.sqrt(a),t[0]=r*a,t[1]=s*a,t[2]=n*a,t):(t[0]=0,t[1]=0,t[2]=0,t)}const ui=Ce,SQe=Iee,TQe=p3e,s4=Ri,AC=on,gu=Le,Gx=On,ade=Object.freeze(Object.defineProperty({__proto__:null,abs:EC,add:xe,angle:_3e,bezier:yQe,ceil:hQe,clamp:dQe,copy:de,cross:bt,crossAndNormalize:mQe,direction:Hv,dist:s4,distance:Ri,div:TQe,divide:p3e,dot:Oe,equals:Tv,exactEquals:si,floor:f3e,hermite:gQe,inverse:fQe,len:gu,length:Le,lerp:Wi,max:y3e,min:g3e,mul:SQe,multiply:Iee,negate:Gh,normalize:Ee,random:_Qe,rotateX:vQe,rotateY:bQe,rotateZ:wQe,round:pQe,scale:le,scaleAndAdd:Tr,set:ve,sign:m3e,sqrDist:AC,sqrLen:Gx,squaredDistance:on,squaredLength:On,str:xQe,sub:ui,subtract:Ce,transformMat3:rl,transformMat4:Mt,transformQuat:Tc},Symbol.toStringTag,{value:"Module"}));let Ay=class{constructor(e){this._allocator=e,this._items=[],this._itemsPtr=0,this._grow()}get(){return this._itemsPtr===0&&rC(()=>this._reset()),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const e=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*ode);this._items.length=Math.min(e,this._items.length),this._itemsPtr=0}_grow(){for(let e=0;e<Math.max(8,Math.min(this._items.length,ode));e++)this._items.push(this._allocator())}};const ode=1024;function it(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function v3e(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]]}function Lee(t,e,i,r,s,n,a,o,l,c,h,f,y,_,w,x){return[t,e,i,r,s,n,a,o,l,c,h,f,y,_,w,x]}const Ro=it();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:Ro,clone:v3e,create:it,fromValues:Lee},Symbol.toStringTag,{value:"Module"}));function Kh(){return[0,0,0,1]}function $Qe(t){return[t[0],t[1],t[2],t[3]]}function CQe(t,e,i,r){return[t,e,i,r]}const kee=Kh();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:kee,clone:$Qe,create:Kh,fromValues:CQe},Symbol.toStringTag,{value:"Module"}));function pt(){return[0,0]}function u6(t){return[t[0],t[1]]}function vs(t,e){return[t,e]}function MQe(t,e){return[t,e]}function EQe(t,e=pt()){const i=Math.min(2,t.length);for(let r=0;r<i;++r)e[r]=t[r];return e}function zee(){return pt()}function b3e(){return vs(1,1)}function w3e(){return vs(1,0)}function x3e(){return vs(0,1)}const $v=zee(),S3e=b3e(),AQe=w3e(),OQe=x3e();Object.freeze(Object.defineProperty({__proto__:null,ONES:S3e,UNIT_X:AQe,UNIT_Y:OQe,ZEROS:$v,clone:u6,create:pt,freeze:MQe,fromArray:EQe,fromValues:vs,ones:b3e,unitX:w3e,unitY:x3e,zeros:zee},Symbol.toStringTag,{value:"Module"}));function ri(){return[0,0,0,0]}function K3(t){return[t[0],t[1],t[2],t[3]]}function fi(t,e,i,r){return[t,e,i,r]}function jR(t,e,i,r){return[t,e,i,r]}function qR(t,e=ri()){const i=Math.min(4,t.length);for(let r=0;r<i;++r)e[r]=t[r];return e}function T3e(){return ri()}function Fee(){return fi(1,1,1,1)}function $3e(){return fi(1,0,0,0)}function C3e(){return fi(0,1,0,0)}function M3e(){return fi(0,0,1,0)}function E3e(){return fi(0,0,0,1)}const tn=T3e(),FU=Fee(),PQe=$3e(),RQe=C3e(),DQe=M3e(),IQe=E3e();Object.freeze(Object.defineProperty({__proto__:null,ONES:FU,UNIT_W:IQe,UNIT_X:PQe,UNIT_Y:RQe,UNIT_Z:DQe,ZEROS:tn,clone:K3,create:ri,freeze:jR,fromArray:qR,fromValues:fi,ones:Fee,unitW:E3e,unitX:$3e,unitY:C3e,unitZ:M3e,zeros:T3e},Symbol.toStringTag,{value:"Module"}));let fM=class X1{constructor(e){this._create=e,this._items=new Array,this._itemsPtr=0}get(){return this._itemsPtr===0&&rC(()=>this._reset()),this._itemsPtr>=this._items.length&&this._items.push(this._create()),this._items[this._itemsPtr++]}_reset(){const e=2*this._itemsPtr;this._items.length>e&&(this._items.length=e),this._itemsPtr=0}static createVec2f64(){return new X1(pt)}static createVec3f64(){return new X1(R)}static createVec4f64(){return new X1(ri)}static createMat3f64(){return new X1(Ir)}static createMat4f64(){return new X1(it)}static createQuatf64(){return new X1(Kh)}get test(){}};const gVt=fM.createVec2f64(),Ze=fM.createVec3f64(),Nee=fM.createVec4f64();fM.createMat3f64();const Vee=fM.createMat4f64(),LQe=fM.createQuatf64();function Oy(t){return t?{origin:cr(t.origin),vector:cr(t.vector)}:{origin:R(),vector:R()}}function A3e(t,e){const i=FQe.get();return i.origin=t,i.vector=e,i}function yVt(t,e=Oy()){return kQe(t.origin,t.vector,e)}function kQe(t,e,i=Oy()){return de(i.origin,t),de(i.vector,e),i}function dz(t,e,i=Oy()){return de(i.origin,t),Ce(i.vector,e,t),i}function O3e(t,e){const i=Ce(Ze.get(),e,t.origin),r=Oe(t.vector,i),s=Oe(t.vector,t.vector),n=Se(r/s,0,1),a=Ce(Ze.get(),le(Ze.get(),t.vector,n),i);return Oe(a,a)}function _Vt(t,e,i){return cZ(t,e,0,1,i)}function vVt(t,e,i){return xe(i,t.origin,le(i,t.vector,e))}function cZ(t,e,i,r,s){const{vector:n,origin:a}=t,o=Ce(Ze.get(),e,a),l=Oe(n,o)/On(n);return le(s,n,Se(l,i,r)),xe(s,s,t.origin)}function bVt(t,e){if(P3e(t,A3e(e.origin,e.direction),!1,h6)){const{tA:i,pB:r,distance2:s}=h6;if(i>=0&&i<=1)return s;if(i<0)return on(t.origin,r);if(i>1)return on(xe(Ze.get(),t.origin,t.vector),r)}return null}function zQe(t,e,i){return!!P3e(t,e,!0,h6)&&(de(i,h6.pA),!0)}function P3e(t,e,i,r){const n=t.origin,a=xe(Ze.get(),n,t.vector),o=e.origin,l=xe(Ze.get(),o,e.vector),c=Ze.get(),h=Ze.get();if(c[0]=n[0]-o[0],c[1]=n[1]-o[1],c[2]=n[2]-o[2],h[0]=l[0]-o[0],h[1]=l[1]-o[1],h[2]=l[2]-o[2],Math.abs(h[0])<1e-6&&Math.abs(h[1])<1e-6&&Math.abs(h[2])<1e-6)return!1;const f=Ze.get();if(f[0]=a[0]-n[0],f[1]=a[1]-n[1],f[2]=a[2]-n[2],Math.abs(f[0])<1e-6&&Math.abs(f[1])<1e-6&&Math.abs(f[2])<1e-6)return!1;const y=c[0]*h[0]+c[1]*h[1]+c[2]*h[2],_=h[0]*f[0]+h[1]*f[1]+h[2]*f[2],w=c[0]*f[0]+c[1]*f[1]+c[2]*f[2],x=h[0]*h[0]+h[1]*h[1]+h[2]*h[2],S=(f[0]*f[0]+f[1]*f[1]+f[2]*f[2])*x-_*_;if(Math.abs(S)<1e-6)return!1;let $=(y*_-w*x)/S,A=(y+_*$)/x;i&&($=Se($,0,1),A=Se(A,0,1));const M=Ze.get(),P=Ze.get();return M[0]=n[0]+$*f[0],M[1]=n[1]+$*f[1],M[2]=n[2]+$*f[2],P[0]=o[0]+A*h[0],P[1]=o[1]+A*h[1],P[2]=o[2]+A*h[2],r.tA=$,r.tB=A,r.pA=M,r.pB=P,r.distance2=on(M,P),!0}const h6={tA:0,tB:0,pA:R(),pB:R(),distance2:0},FQe=new Ay(()=>Oy());function jl(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function NQe(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function yr(t,e,i,r,s){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t}function Uee(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t}function R3e(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}function D3e(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t}function I3e(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t[3]=e[3]/i[3],t}function VQe(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function UQe(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function BQe(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t[3]=Math.min(e[3],i[3]),t}function jQe(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t[3]=Math.max(e[3],i[3]),t}function qQe(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function Cv(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function GQe(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t}function L3e(t,e){const i=e[0]-t[0],r=e[1]-t[1],s=e[2]-t[2],n=e[3]-t[3];return Math.sqrt(i*i+r*r+s*s+n*n)}function d6(t,e){const i=e[0]-t[0],r=e[1]-t[1],s=e[2]-t[2],n=e[3]-t[3];return i*i+r*r+s*s+n*n}function Bee(t){const e=t[0],i=t[1],r=t[2],s=t[3];return Math.sqrt(e*e+i*i+r*r+s*s)}function NU(t){const e=t[0],i=t[1],r=t[2],s=t[3];return e*e+i*i+r*r+s*s}function HQe(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function WQe(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function k3e(t,e){const i=e[0],r=e[1],s=e[2],n=e[3];let a=i*i+r*r+s*s+n*n;return a>0&&(a=1/Math.sqrt(a),t[0]=i*a,t[1]=r*a,t[2]=s*a,t[3]=n*a),t}function jee(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function qee(t,e,i,r){const s=e[0],n=e[1],a=e[2],o=e[3];return t[0]=s+r*(i[0]-s),t[1]=n+r*(i[1]-n),t[2]=a+r*(i[2]-a),t[3]=o+r*(i[3]-o),t}function ZQe(t,e=1){const i=XD;let r,s,n,a,o,l;do r=2*i()-1,s=2*i()-1,o=r*r+s*s;while(o>=1);do n=2*i()-1,a=2*i()-1,l=n*n+a*a;while(l>=1);const c=Math.sqrt((1-o)/l);return t[0]=e*r,t[1]=e*s,t[2]=e*n*c,t[3]=e*a*c,t}function Dc(t,e,i){const r=e[0],s=e[1],n=e[2],a=e[3];return t[0]=i[0]*r+i[4]*s+i[8]*n+i[12]*a,t[1]=i[1]*r+i[5]*s+i[9]*n+i[13]*a,t[2]=i[2]*r+i[6]*s+i[10]*n+i[14]*a,t[3]=i[3]*r+i[7]*s+i[11]*n+i[15]*a,t}function YQe(t,e,i){const r=e[0],s=e[1],n=e[2],a=i[0],o=i[1],l=i[2],c=i[3],h=c*r+o*n-l*s,f=c*s+l*r-a*n,y=c*n+a*s-o*r,_=-a*r-o*s-l*n;return t[0]=h*c+_*-a+f*-l-y*-o,t[1]=f*c+_*-o+y*-a-h*-l,t[2]=y*c+_*-l+h*-o-f*-a,t[3]=e[3],t}function QQe(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function ey(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function GR(t,e){const i=t[0],r=t[1],s=t[2],n=t[3],a=e[0],o=e[1],l=e[2],c=e[3],h=nn();return Math.abs(i-a)<=h*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(r-o)<=h*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(s-l)<=h*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-c)<=h*Math.max(1,Math.abs(n),Math.abs(c))}const XQe=R3e,JQe=D3e,KQe=I3e,eXe=L3e,tXe=d6,iXe=Bee,rXe=NU,z3e=Object.freeze(Object.defineProperty({__proto__:null,add:Uee,ceil:VQe,copy:jl,copyVec3:NQe,dist:eXe,distance:L3e,div:KQe,divide:I3e,dot:jee,equals:GR,exactEquals:ey,floor:UQe,inverse:WQe,len:iXe,length:Bee,lerp:qee,max:jQe,min:BQe,mul:JQe,multiply:D3e,negate:HQe,normalize:k3e,random:ZQe,round:qQe,scale:Cv,scaleAndAdd:GQe,set:yr,sqrDist:tXe,sqrLen:rXe,squaredDistance:d6,squaredLength:NU,str:QQe,sub:XQe,subtract:R3e,transformMat4:Dc,transformQuat:YQe},Symbol.toStringTag,{value:"Module"}));function wVt(t,e,i){const r=Oe(t,e)/Oe(t,t);return le(i,t,r)}function q_(t,e){return Oe(t,e)/Le(t)}function Gee(t,e){const i=Oe(t,e)/(Le(t)*Le(e));return-Ga(i)}function F3e(t,e,i){Ee(v5,t),Ee(c7,e);const r=Oe(v5,c7),s=Ga(r),n=bt(v5,v5,c7);return Oe(n,i)<0?2*Math.PI-s:s}const v5=R(),c7=R();function HR(t){const e=t[0]*t[0]+t[4]*t[4]+t[8]*t[8],i=t[1]*t[1]+t[5]*t[5]+t[9]*t[9],r=t[2]*t[2]+t[6]*t[6]+t[10]*t[10];return Math.sqrt(Math.max(e,i,r))}function sXe(t,e){const i=Math.sqrt(e[0]*e[0]+e[4]*e[4]+e[8]*e[8]),r=Math.sqrt(e[1]*e[1]+e[5]*e[5]+e[9]*e[9]),s=Math.sqrt(e[2]*e[2]+e[6]*e[6]+e[10]*e[10]);return ve(t,i,r,s),t}function xVt(t,e,i){i=i||t;const r=Oe(t,e);ve(i,t[0]-r*e[0],t[1]-r*e[1],t[2]-r*e[2]),Ee(i,i)}function Hee(t,e,i){Math.abs(t[0])>Math.abs(t[1])?ve(e,0,1,0):ve(e,1,0,0),bt(i,t,e),bt(e,i,t),Ee(i,i),Ee(e,e)}function b5(t,e,i,r,s,n){const a=t+(e-t)*s;return a+(i+(r-i)*s-a)*n}function N3e(t,e,i,r=R()){const s=Le(t),n=Le(e),a=Oe(t,e)/(s*n);if(a<.9999999999999999){const o=Math.acos(a),l=((1-i)*s+i*n)/Math.sin(o),c=l/s*Math.sin((1-i)*o),h=l/n*Math.sin(i*o);return le(Kb,t,c),le(ew,e,h),xe(r,Kb,ew)}return Wi(r,t,e,i)}function SVt(t,e,i,r=R(),s=R()){const n=Le(t),a=Le(e),o=Oe(t,e)/(n*a);if(o<.9999999999999999){const l=Math.acos(o),c=Math.sin(l),h=Math.sin(i*l),f=Math.sin((1-i)*l),y=(1-i)*n+i*a;{const _=y/c,w=_/a*h;le(Kb,t,_/n*f),le(ew,e,w),xe(r,Kb,ew)}{const _=1/n*(-Math.cos((1-i)*l)*l*y+f*(-n+a));le(Kb,t,_);const w=1/a*(Math.cos(i*l)*l*y+h*(-n+a));le(ew,e,w),xe(s,Kb,ew),le(s,s,1/c)}return s}return Wi(r,t,e,i),Ce(s,e,t),Ee(s,s),s}function VU(t,e,i){t=Ee(Kb,t),e=Ee(ew,e);const r=Ga(Oe(t,e));if(i){const s=bt(nXe,t,e);if(Oe(s,i)<0)return-r}return r}function pz(t){const e=t.length;return i=>{if(i<=t[0][0])return t[0][1];if(i>=t[e-1][0])return t[e-1][1];let r=1;for(;i>t[r][0];)r++;const s=t[r-1][0],n=t[r][0],a=(n-i)/(n-s);return a*t[r-1][1]+(1-a)*t[r][1]}}function TVt(t,e,i,r){Ce(lde,e,t),Ce(cde,i,t),bt(r,lde,cde),Ee(r,r),r[3]=-Oe(t,r)}function $Vt(t,e){if(ve(e,0,0,0),t.length>0){for(let i=0;i<t.length;++i)xe(e,e,t[i]);le(e,e,1/t.length)}}const lde=R(),cde=R(),nXe=R(),Kb=R(),ew=R();function Oi(t=iO){return[t[0],t[1],t[2],t[3]]}function V3e(t=iO[0],e=iO[1],i=iO[2],r=iO[3]){return Zee(t,e,i,r,Nee.get())}function Wee(t,e){return Zee(e[0],e[1],e[2],e[3],t)}function CVt(t){return t}function Zee(t,e,i,r,s=Oi()){return s[0]=t,s[1]=e,s[2]=i,s[3]=r,s}function U3e(t,e,i){return de(i,t),i[3]=e,i}function Qf(t,e,i){const r=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],s=Math.abs(r-1)>1e-5&&r>1e-12?1/Math.sqrt(r):1;return i[0]=e[0]*s,i[1]=e[1]*s,i[2]=e[2]*s,i[3]=-(i[0]*t[0]+i[1]*t[1]+i[2]*t[2]),i}function Su(t,e,i,r=Oi()){const s=i[0]-e[0],n=i[1]-e[1],a=i[2]-e[2],o=t[0]-e[0],l=t[1]-e[1],c=t[2]-e[2],h=n*c-a*l,f=a*o-s*c,y=s*l-n*o,_=h*h+f*f+y*y,w=Math.abs(_-1)>1e-5&&_>1e-12?1/Math.sqrt(_):1;return r[0]=h*w,r[1]=f*w,r[2]=y*w,r[3]=-(r[0]*t[0]+r[1]*t[1]+r[2]*t[2]),r}function B3e(t,e,i,r=0,s=Math.floor(i*(1/3)),n=Math.floor(i*(2/3))){if(i<3)return!1;e(NE,r);let a=s,o=!1;for(;a<i-1&&!o;)e(lS,a),a++,o=!si(NE,lS);if(!o)return!1;for(a=Math.max(a,n),o=!1;a<i&&!o;)e(Lb,a),a++,Ce(w5,NE,lS),Ee(w5,w5),Ce(x5,lS,Lb),Ee(x5,x5),o=!si(NE,Lb)&&!si(lS,Lb)&&Math.abs(Oe(w5,x5))<aXe;return o?(Su(NE,lS,Lb,t),!0):(r!==0||s!==1||n!==2)&&B3e(t,e,i,0,1,2)}function MVt(t,e,i=!0){const r=e.length/3;return B3e(t,(s,n)=>ve(s,e[3*n+0],e[3*n+1],e[3*n+2]),i?r-1:r)}const aXe=.99619469809,NE=R(),lS=R(),Lb=R(),w5=R(),x5=R();function uZ(t,e,i){return e!==t&&Wee(t,e),t[3]=-Oe(t,i),t}function oXe(t,e){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function hZ(t,e,i,r){return bt(Lb,e,t),Qf(i,Lb,r)}function j3e(t,e,i,r){return UU(n4(t,e,Ce(Ze.get(),i,e),pXe,r))}function mM(t,e,i){return e!=null&&UU(n4(t,e.origin,e.direction,fXe,i))}function q3e(t,e,i){return UU(n4(t,e.origin,e.vector,0,i))}function lXe(t,e,i){return UU(n4(t,e.origin,e.vector,1,i))}function WR(t,e){return va(t,e)>=0}function cXe(t,e){const i=Oe(t,e.ray.direction),r=-va(t,e.ray.origin);if(r<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return r>0;if((r<0||i<0)&&!(r<0&&i<0))return!0;const s=r/i;return i>0?s<e.c1&&(e.c1=s):s>e.c0&&(e.c0=s),e.c0<=e.c1}function uXe(t,e){const i=Oe(t,e.ray.direction),r=-va(t,e.ray.origin);if(i>-1e-6&&i<1e-6)return r>0;const s=r/i;return i>0?s<e.c1&&(e.c1=s):s>e.c0&&(e.c0=s),e.c0<=e.c1}function Yee(t,e,i){const r=le(Ze.get(),t,-t[3]),s=dXe(t,Ce(Ze.get(),e,r),Ze.get());return xe(i,s,r),i}function hXe(t,e,i,r){const s=t,n=Ze.get(),a=Ze.get();Hee(s,n,a);const o=Ce(Ze.get(),i,e),l=q_(n,o),c=q_(a,o),h=q_(s,o);return ve(r,l,c,h)}function dXe(t,e,i){const r=le(Ze.get(),t,Oe(t,e));return Ce(i,e,r),i}function dZ(t,e){return Math.abs(va(t,e))}function va(t,e){return Oe(t,e)+t[3]}function UU(t){return t===0||t===1}function n4(t,e,i,r,s){const n=Oe(t,i),a=va(t,e);if(n===0)return a>=0?2:3;let o=-a/n;return 1&r&&(o=Se(o,0,1)),!(4&r)&&o<0||!(8&r)&&o>1?a>=0?2:3:(xe(s,e,le(s,i,o)),a>=0?0:1)}const iO=[0,0,1,0],pXe=12,fXe=8;function rn(t){return t?ude(cr(t.origin),cr(t.direction)):ude(R(),R())}function ude(t,e){return{origin:t,direction:e}}function EVt(t,e){return sy(t.origin,e.origin)&&sy(t.direction,e.direction)}function Sp(t,e){const i=yXe.get();return i.origin=t,i.direction=e,i}function p6(t,e=rn()){return Xee(t.origin,t.direction,e)}function Qee(t,e,i=rn()){return de(i.origin,t),Ce(i.direction,e,t),i}function Xee(t,e,i=rn()){return de(i.origin,t),de(i.direction,e),i}function mXe(t,e){const i=bt(Ze.get(),Ee(Ze.get(),t.direction),Ce(Ze.get(),e,t.origin));return Oe(i,i)}function gXe(t,e,i){const r=Oe(t.direction,Ce(i,e,t.origin));return xe(i,t.origin,le(i,t.direction,r)),i}function AVt(t,e,i,r){const s=t.origin,n=e.origin,a=t.direction,o=e.direction,l=Oe(Ee(h7,a),Ee(hde,o));if(Math.abs(l)>=1)return null;const c=bt(h7,a,o),h=ui(u7,n,s),f=B_(dde,a[0],a[1],a[2],-o[0],-o[1],-o[2],c[0],c[1],c[2]),y=i2(dde,f);if(y==null)return[i,r];const _=Oe(ve(h7,y[0],y[3],y[6]),h),w=Oe(ve(hde,y[1],y[4],y[7]),h);return xe(i,s,le(u7,a,_)),xe(r,n,le(u7,o,w)),[i,r]}const yXe=new Ay(()=>rn()),u7=R(),h7=R(),hde=R(),dde=Ir(),d7=()=>fe.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");function Py(t=i$e){return{plane:Oi(t.plane),origin:cr(t.origin),basis1:cr(t.basis1),basis2:cr(t.basis2)}}function _Xe(t,e,i){const r=PXe.get();return r.origin=t,r.basis1=e,r.basis2=i,r.plane=V3e(0,0,0,0),BU(r),r}function o2(t,e=Py()){return Jee(t.origin,t.basis1,t.basis2,e)}function vXe(t,e){de(e.origin,t.origin),de(e.basis1,t.basis1),de(e.basis2,t.basis2),Wee(e.plane,t.plane)}function Jee(t,e,i,r=Py()){return de(r.origin,t),de(r.basis1,e),de(r.basis2,i),BU(r),AXe(r,"fromValues()"),r}function BU(t){hZ(t.basis2,t.basis1,t.origin,t.plane)}function G3e(t,e,i){t!==i&&o2(t,i);const r=le(Ze.get(),my(t),e);return xe(i.origin,i.origin,r),i.plane[3]-=e,i}function bXe(t,e,i){return H3e(e,i),G3e(i,ite(t,t.origin),i),i}function wXe(t,e){const i=t.basis1[0],r=t.basis2[1],[s,n]=t.origin;return pU(s-i,n-r,s+i,n+r,e)}function H3e(t,e=Py()){const i=(t[2]-t[0])/2,r=(t[3]-t[1])/2;return ve(e.origin,t[0]+i,t[1]+r,0),ve(e.basis1,i,0,0),ve(e.basis2,0,r,0),Zee(0,0,1,0,e.plane),e}function Kee(t,e,i){return!!mM(t.plane,e,i)&&e$e(t,i)}function xXe(t,e,i){if(Kee(t,e,i))return i;const r=W3e(t,e,Ze.get());return xe(i,e.origin,le(Ze.get(),e.direction,Ri(e.origin,r)/Le(e.direction))),i}function W3e(t,e,i){const r=f6.get();t$e(t,e,r,f6.get());let s=Number.POSITIVE_INFINITY;for(const n of ste){const a=rte(t,n,jU.get()),o=Ze.get();if(q3e(r,a,o)){const l=Hv(Ze.get(),e.origin,o),c=Math.abs(Ga(Oe(e.direction,l)));c<s&&(s=c,de(i,o))}}return s===Number.POSITIVE_INFINITY?Y3e(t,e,i):i}function Z3e(t,e){return(e-t)/e}function Y3e(t,e,i){if(Kee(t,e,i))return i;const r=f6.get(),s=f6.get();t$e(t,e,r,s);let n=Number.POSITIVE_INFINITY;for(const a of ste){const o=rte(t,a,jU.get()),l=Ze.get();if(lXe(r,o,l)){const c=mXe(e,l);if(!WR(s,l))continue;c<n&&(n=c,de(i,l))}}return ete(t,e.origin)<n&&Q3e(t,e.origin,i),i}function Q3e(t,e,i){const r=Yee(t.plane,e,Ze.get()),s=cZ(pde(t,t.basis1),r,-1,1,Ze.get()),n=cZ(pde(t,t.basis2),r,-1,1,Ze.get());return Ce(i,xe(Ze.get(),s,n),t.origin),i}function X3e(t,e,i){const{origin:r,basis1:s,basis2:n}=t,a=Ce(Ze.get(),e,r),o=q_(s,a),l=q_(n,a),c=q_(my(t),a);return ve(i,o,l,c)}function ete(t,e){const i=X3e(t,e,Ze.get()),{basis1:r,basis2:s}=t,n=Le(r),a=Le(s),o=Math.max(Math.abs(i[0])-n,0),l=Math.max(Math.abs(i[1])-a,0),c=i[2];return o*o+l*l+c*c}function SXe(t,e){return Math.sqrt(ete(t,e))}function TXe(t,e){let i=Number.NEGATIVE_INFINITY;for(const r of ste){const s=rte(t,r,jU.get()),n=O3e(s,e);n>i&&(i=n)}return Math.sqrt(i)}function tte(t,e){return WR(t.plane,e)&&e$e(t,e)}function $Xe(t,e,i,r){return EXe(t,i,r)}function ite(t,e){const i=-t.plane[3];return q_(my(t),e)-i}function CXe(t,e,i,r){const s=ite(t,e),n=le(OXe,my(t),i-s);return xe(r,e,n),r}function J3e(t,e){return si(t.basis1,e.basis1)&&si(t.basis2,e.basis2)&&si(t.origin,e.origin)}function K3e(t,e,i){return t!==i&&o2(t,i),nl(cS,e),Ql(cS,cS),Mt(i.basis1,t.basis1,cS),Mt(i.basis2,t.basis2,cS),Mt(i.plane,t.plane,cS),Mt(i.origin,t.origin,e),uZ(i.plane,i.plane,i.origin),i}function MXe(t,e,i,r){return t!==r&&o2(t,r),Xh(p7,e,i),Mt(r.basis1,t.basis1,p7),Mt(r.basis2,t.basis2,p7),BU(r),r}function my(t){return t.plane}function EXe(t,e,i){switch(e){case 0:de(i,t.basis1),Ee(i,i);break;case 1:de(i,t.basis2),Ee(i,i);break;case 2:de(i,my(t))}return i}function e$e(t,e){const i=Ce(Ze.get(),e,t.origin),r=On(t.basis1),s=On(t.basis2),n=Oe(t.basis1,i),a=Oe(t.basis2,i);return-n-r<0&&n-r<0&&-a-s<0&&a-s<0}function pde(t,e){const i=jU.get();return de(i.origin,t.origin),de(i.vector,e),i}function rte(t,e,i){const{basis1:r,basis2:s,origin:n}=t,a=le(Ze.get(),r,e.origin[0]),o=le(Ze.get(),s,e.origin[1]);xe(i.origin,a,o),xe(i.origin,i.origin,n);const l=le(Ze.get(),r,e.direction[0]),c=le(Ze.get(),s,e.direction[1]);return le(i.vector,xe(l,l,c),2),i}function AXe(t,e){Math.abs(Oe(t.basis1,t.basis2)/(Le(t.basis1)*Le(t.basis2)))>1e-6&&d7().warn(e,"Provided basis vectors are not perpendicular"),Math.abs(Oe(t.basis1,my(t)))>1e-6&&d7().warn(e,"Basis vectors and plane normal are not perpendicular"),Math.abs(-Oe(my(t),t.origin)-t.plane[3])>1e-6&&d7().warn(e,"Plane offset is not consistent with plane origin")}function t$e(t,e,i,r){const s=my(t);hZ(s,e.direction,e.origin,i),hZ(i,s,e.origin,r)}const i$e={plane:Oi(),origin:Ge(0,0,0),basis1:Ge(1,0,0),basis2:Ge(0,1,0)},f6=new Ay(Oi),jU=new Ay(Oy),OXe=R(),PXe=new Ay(()=>Py()),ste=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],cS=it(),p7=it(),RXe=Object.freeze(Object.defineProperty({__proto__:null,altitudeAt:ite,axisAt:$Xe,cameraFrustumCoverage:Z3e,closestPoint:Y3e,closestPointOnSilhouette:W3e,copy:o2,copyWithoutVerify:vXe,create:Py,distance:SXe,distance2:ete,distanceToSilhouette:TXe,elevate:G3e,equals:J3e,extrusionContainsPoint:tte,fromAABoundingRect:H3e,fromValues:Jee,getExtent:wXe,intersectRay:Kee,intersectRayClosestSilhouette:xXe,normal:my,projectPoint:Q3e,projectPointLocal:X3e,rotate:MXe,setAltitudeAt:CXe,setExtent:bXe,transform:K3e,up:i$e,updateUnboundedPlane:BU,wrap:_Xe},Symbol.toStringTag,{value:"Module"}));function fde(t,e){const i=Le(t),r=zu(t[2]/i),s=Math.atan2(t[1]/i,t[0]/i);return ve(e,i,r,s),e}const r$e=ms();function gM(t,e,i,r){return new Array(t,e,i,r)}function ms(){return gM(0,0,0,0)}function nte(t,e){return gM(t[0],t[1],t[2],e)}function DXe(t){return gM(t[0],t[1],t[2],t[3])}function yM(t,e,i){return s$e(t,e[0],e[1],e[2],i)}function s$e(t,e,i,r,s){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t}function n$e(t,e){return a$e(t,e)}function a$e(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function Mv(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function IXe(t){return gM(t[0],t[1],t[2],t[3])}function LXe(t){t[0]=0,t[1]=0,t[2]=0,t[3]=0}function l2(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=e,t}function Bf(t){return t[3]}function gy(t,e){return ve(e,t[0],t[1],t[2])}function Ti(t){return ve(g6,t[0],t[1],t[2])}function _M(t,e){t[0]=e[0],t[1]=e[1],t[2]=e[2]}function pZ(t,e){t[0]=e[0],t[1]=e[1],t[2]=e[2]}function o$e(t,e,i,r){t[0]=e,t[1]=i,t[2]=r}function OC(t,e,i){_M(t,Mt(g6,e,i))}function l$e(t,e,i,r,s){t[0]=e,t[1]=i,t[2]=r,t[3]=s}function kXe(t){return fi(t[0],t[1],t[2],t[3])}function zXe(t,e,i){return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2]),i[3]=t[3]+e,i}function FXe(t,e,i){return t!==i&&Mv(t,i),i}function NXe(t,e){return e}function Ry(t,e,i){if(e==null||!u$e(t,e,m6))return!1;let{t0:r,t1:s}=m6;if((r<0||s<r&&s>0)&&(r=s),r<0)return!1;if(i){const{origin:n,direction:a}=e;i[0]=n[0]+a[0]*r,i[1]=n[1]+a[1]*r,i[2]=n[2]+a[2]*r}return!0}function c$e(t,e,i){const r=Qee(e,i);if(!u$e(t,r,m6))return[];const{origin:s,direction:n}=r,{t0:a,t1:o}=m6,l=c=>{const h=R();return Tr(h,s,n,c),qU(t,h,h)};return Math.abs(a-o)<nn()?[l(a)]:[l(a),l(o)]}const m6={t0:0,t1:0};function u$e(t,e,i){const{origin:r,direction:s}=e,n=VXe;n[0]=r[0]-t[0],n[1]=r[1]-t[1],n[2]=r[2]-t[2];const a=s[0]*s[0]+s[1]*s[1]+s[2]*s[2];if(a===0)return!1;const o=2*(s[0]*n[0]+s[1]*n[1]+s[2]*n[2]),l=o*o-4*a*(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]-t[3]*t[3]);if(l<0)return!1;const c=Math.sqrt(l);return i.t0=(-o-c)/(2*a),i.t1=(-o+c)/(2*a),!0}const VXe=R();function fZ(t,e){return Ry(t,e,null)}function UXe(t,e,i){if(Ry(t,e,i))return i;const r=vM(t,e,Ze.get());return xe(i,e.origin,le(Ze.get(),e.direction,Ri(e.origin,r)/Le(e.direction))),i}function vM(t,e,i){const r=Ze.get(),s=Vee.get();bt(r,e.origin,e.direction);const n=Bf(t);bt(i,r,e.origin),le(i,i,1/Le(i)*n);const a=d$e(t,e.origin),o=Gee(e.origin,i);return Xh(s,o+a,r),Mt(i,i,s),i}function ate(t,e,i,r){const s=Bf(t),n=s*s,a=e+.5*Math.PI,o=i*i+n-2*Math.cos(a)*i*s,l=Math.sqrt(o),c=o-n;if(c<=0)return .5;const h=Math.sqrt(c),f=Math.acos(h/l)-Math.asin(s/(l/Math.sin(a)));return Math.min(1,(f+.5*r)/r)}function BXe(t,e,i){return Ry(t,e,i)?i:(gXe(e,Ti(t),i),qU(t,i,i))}function qU(t,e,i){const r=Ce(Ze.get(),e,Ti(t)),s=le(Ze.get(),r,t[3]/Le(r));return xe(i,s,Ti(t))}function h$e(t,e){const i=Ce(Ze.get(),e,Ti(t)),r=On(i),s=t[3]*t[3];return Math.sqrt(Math.abs(r-s))}function d$e(t,e){const i=Ce(Ze.get(),e,Ti(t)),r=Le(i),s=Bf(t),n=s+Math.abs(s-r);return Ga(s/n)}const f7=R();function p$e(t,e,i,r){const s=Ce(f7,e,Ti(t));switch(i){case 0:{const n=fde(s,f7)[2];return ve(r,-Math.sin(n),Math.cos(n),0)}case 1:{const n=fde(s,f7),a=n[1],o=n[2],l=Math.sin(a);return ve(r,-l*Math.cos(o),-l*Math.sin(o),Math.cos(a))}case 2:return Ee(r,s);default:return}}function f$e(t,e){const i=Ce(mZ,e,Ti(t));return Le(i)-t[3]}function jXe(t,e,i,r){const s=f$e(t,e),n=p$e(t,e,2,mZ),a=le(mZ,n,i-s);return xe(r,e,a)}function qXe(t,e){const i=on(Ti(t),e),r=Bf(t);return i<=r*r}function GXe(t,e,i=ms()){const r=Ri(Ti(t),gy(e,mde)),s=t[3],n=e[3];return r+n<s?(Mv(t,i),i):r+s<n?(Mv(e,i),i):(Wi(g6,Ti(t),gy(e,mde),(r+n-s)/(2*r)),yM(i,g6,(r+s+n)/2),i)}const g6=R(),mde=R(),GU=ms(),mZ=R(),HXe=Object.freeze(Object.defineProperty({__proto__:null,NullSphere:r$e,altitudeAt:f$e,angleToSilhouette:d$e,axisAt:p$e,cameraFrustumCoverage:ate,clear:LXe,clone:IXe,closestPoint:BXe,closestPointOnSilhouette:vM,containsPoint:qXe,copy:Mv,copyCenter:pZ,create:ms,distanceToSilhouette:h$e,elevate:zXe,equals:a$e,exactEquals:n$e,fromCenterAndRadius:nte,fromRadius:l2,fromValues:gM,fromVec4:DXe,getCenter:gy,getCenterTemp:Ti,getExtent:NXe,getRadius:Bf,intersectLine:c$e,intersectRay:Ry,intersectRayClosestSilhouette:UXe,intersectsRay:fZ,projectPoint:qU,set:s$e,setAltitudeAt:jXe,setCenter:_M,setCenterFromValues:o$e,setExtent:FXe,setFromCenterAndRadius:yM,setFromValues:l$e,setTransformedCenter:OC,tmpSphere:GU,toVec4:kXe,union:GXe},Symbol.toStringTag,{value:"Module"}));function WXe(t){const{value:e,operations:i}=t;return{operations:i,value:i.create(e)}}function ZXe(t,e,i){return t.operations.setExtent(t.value,e,i.value),i}function YXe(t,e){return t.operations.getExtent(t.value,e),e}function QXe(t){return{operations:t,value:t.create()}}function m$e(t,e,i=QXe(t)){return i.operations=t,t.copy(e,i.value),i}function XXe(t){return m$e(HXe,gM(0,0,0,or(t).radius))}const gde=2**50;function JXe(){return m$e(RXe,Jee([0,0,0],[gde,0,0],[0,gde,0]))}function KXe(t,e,i){return t.operations.axisAt(t.value,e,2,i)}function eJe(t,e,i,r){return t.operations.axisAt(t.value,e,i,r)}function tJe(t,e,i){return t.operations.intersectRay(t.value,e,i)}function iJe(t,e,i){return t.operations.intersectRayClosestSilhouette(t.value,e,i)}function rJe(t,e){return t.operations.altitudeAt(t.value,e)}function g$e(t,e,i,r){return t.operations.setAltitudeAt(t.value,e,i,r)}function sJe(t,e,i,r){return e!==r&&pn(r,e),ve(uS,r[12],r[13],r[14]),g$e(t,uS,i,uS),r[12]=uS[0],r[13]=uS[1],r[14]=uS[2],r}function m7(t,e,i){return t.operations.elevate(t.value,e,i.value)}const uS=R();function yde(t,e,i,r,s){return s[0]=Oe(t,e),s[1]=Oe(t,i),s[2]=Oe(t,r),s}function gZ(t,e,i,r,s){de(i,t),de(S5,e),Ee(S5,S5),bt(r,S5,i),bt(s,r,i)}function nJe(t,e){return t?Sv(e):e.isGeographic?Ie.PlateCarree:e}const S5=R(),ote=96;function OVt(t,e){const i=t.extent,r=t.width,s=Wr(i?.spatialReference);return i&&r?i.width/r*s*qK*ote:0}function aJe(t,e){return t/(Wr(e)*qK*ote)}function oJe(t){return t/(qK*ote)}function PVt(t,e,i){return lJe(t,e)&&cJe(t,i)}function lJe(t,e){return e===0||Gl(t,e)||t<e}function cJe(t,e){return e===0||Gl(t,e)||t>e}function RVt(t,e){return Gl(t,e)?0:(t||Number.POSITIVE_INFINITY)>(e||Number.POSITIVE_INFINITY)?1:-1}let y$e=0;const lte=t=>{const e=t;let i=class extends e{constructor(...r){super(...r),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Date.now().toString(16)+"-object-"+y$e++})}};return i=d([k("esri.core.Identifiable")],i),i},DVt=t=>{const e=t;let i=class extends e{constructor(...r){super(...r),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:y$e++})}};return i=d([k("esri.core.Identifiable.NumericIdentifiable")],i),i},IVt=lte(class{});let uJe=class{constructor(){this._resolver=lo(),this._status=0,this._resolvingPromises=[],this._resolver.promise.then(()=>{this._status=1,this._cleanUp()},()=>{this._status=2,this._cleanUp()}),this.promise=this._resolver.promise}destroy(){this._cleanUp()}addResolvingPromise(e){this._resolvingPromises.push(e),this._tryResolve()}isResolved(){return this._status===1}isRejected(){return this._status===2}isFulfilled(){return this._status!==0}abort(){this._resolver.reject(Xt())}_cleanUp(){this._allPromise=null,this._resolvingPromises=null}_tryResolve(){if(this.isFulfilled())return;const e=lo(),i=[...this._resolvingPromises,e.promise],r=this._allPromise=Promise.all(i);r.then(()=>{this.isFulfilled()||this._allPromise!==r||this._resolver.resolve()},s=>{this.isFulfilled()||this._allPromise!==r||Hr(s)||this._resolver.reject(s)}),e.resolve()}};const cte=t=>{const e=t;let i=class extends e{constructor(...r){super(...r),this._promiseProps=new uJe,this.addResolvingPromise(Promise.resolve())}destroy(){this._promiseProps.destroy()}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(r,s){return this._promiseProps.promise.then(()=>this).then(r,s)}catch(r){return this.when(null,r)}addResolvingPromise(r){r&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in r?r.when():r)}addResolvingTask(r){r&&!this._promiseProps.isFulfilled()&&(this.addHandles(z8e(r)),this._promiseProps.addResolvingPromise(r.promise))}};return i=d([k("esri.core.Promise")],i),i},ute=cte(Me),hJe="not-loaded",dJe="loading",pJe="failed",_de="loaded",_$e=t=>{const e=t;let i=class extends e{constructor(...r){super(...r),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise(s=>{const n=this.load.bind(this);this.load=a=>{const o=new Promise((l,c)=>{const h=jD(a,c);this.destroyed&&c(new ee("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this.when(l,c).finally(()=>{h&&h.remove()})});if(this.loadStatus===hJe){this._set("loadStatus",dJe);const l=this._loadController=new AbortController;n({signal:l.signal})}return s(),o}})),this.when(()=>{this._set("loadStatus",_de),this._loadController=null},s=>{this.destroyed||(this._set("loadStatus",pJe),this._set("loadError",s),this._loadController=null)})}destroy(){this._loadController&&(this._loadController=ps(this._loadController),this._promiseProps.abort()),this._set("loadError",null),this._set("loadWarnings",[])}get loaded(){return this.loadStatus===_de}get loadWarnings(){return this._get("loadWarnings")}load(r){return null}cancelLoad(){return this.isFulfilled()||(this._set("loadError",new ee("load:cancelled","Cancelled")),this._loadController?.abort(),this._promiseProps.abort()),this}};return d([m({readOnly:!0})],i.prototype,"loaded",null),d([m({readOnly:!0})],i.prototype,"loadError",void 0),d([m({clonable:!1})],i.prototype,"loadStatus",void 0),d([m({type:[ay],readOnly:!0})],i.prototype,"loadWarnings",null),i=d([k("esri.core.Loadable")],i),i},a4=_$e(ute);function yZ(t){return!(!t||!t.load)}async function fJe(t){const e="portalItem"in t?t:{portalItem:t},{fromItem:i}=await te(async()=>{const{fromItem:r}=await import("./portalLayers-Dncruciv.js");return{fromItem:r}},__vite__mapDeps([114,115,116,117,118]));try{return await i(e)}catch(r){const s=e?.portalItem,n=s?.id||"unset",a=s?.portal?.url||fr.portalUrl;throw fe.getLogger("esri.layers.support.fromPortalItem").error("#fromPortalItem()","Failed to create layer from portal item (portal: '"+a+"', id: '"+n+"')",r),r}}const vde={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,days:864e5,weeks:6048e5,months:26784e5,years:31536e6,decades:31536e7,centuries:31536e8};function g7(t,e,i,r=vp){const s=new Fc(xee(r)),n=lt.fromJSDate(t,{zone:s}),a=i==="decades"||i==="centuries"?"year":b$e(i);return i==="decades"&&(e*=10),i==="centuries"&&(e*=100),n.plus({[a]:e}).toJSDate()}function kVt(t,e,i="milliseconds"){const r=t.getTime(),s=v$e(e,i,"milliseconds");return new Date(r+s)}function bde(t,e,i=vp){const r=new Fc(xee(i)),s=lt.fromJSDate(t,{zone:r});if(e==="decades"||e==="centuries"){const a=s.startOf("year"),{year:o}=a,l=o-o%(e==="decades"?10:100);return a.set({year:l}).toJSDate()}const n=b$e(e);return s.startOf(n).toJSDate()}function v$e(t,e,i){return t===0?0:t*vde[e]/vde[i]}function mJe(t,e){return t&&e?t.intersection(e):t||e}function b$e(t){switch(t){case"milliseconds":return"millisecond";case"seconds":return"second";case"minutes":return"minute";case"hours":return"hour";case"days":return"day";case"weeks":return"week";case"months":return"month";case"years":return"year"}}var uh,x$;let Mn=(x$=class extends ke{static get allTime(){return wde}static get empty(){return gJe}static fromArray(e){return new uh({start:e[0]!=null?new Date(e[0]):e[0],end:e[1]!=null?new Date(e[1]):e[1]})}constructor(e){super(e),this.end=null,this.start=null}readEnd(e,i){return i.end!=null?new Date(i.end):null}writeEnd(e,i){i.end=e?.getTime()??null}get isAllTime(){return this.equals(uh.allTime)}get isEmpty(){return this.equals(uh.empty)}readStart(e,i){return i.start!=null?new Date(i.start):null}writeStart(e,i){i.start=e?.getTime()??null}clone(){return new uh({end:this.end,start:this.start})}equals(e){if(!e)return!1;const i=this.start?.getTime()??this.start,r=this.end?.getTime()??this.end,s=e.start?.getTime()??e.start,n=e.end?.getTime()??e.end;return i===s&&r===n}expandTo(e,i=vp){if(this.isEmpty||this.isAllTime)return this.clone();let r=this.start;r&&(r=bde(r,e,i));let s=this.end;if(s){const n=bde(s,e,i);s=s.getTime()===n.getTime()?n:g7(n,1,e,i)}return new uh({start:r,end:s})}intersection(e){if(!e)return this.clone();if(this.isEmpty||e.isEmpty)return uh.empty;if(this.isAllTime)return e.clone();if(e.isAllTime)return this.clone();const i=this.start?.getTime()??-1/0,r=this.end?.getTime()??1/0,s=e.start?.getTime()??-1/0,n=e.end?.getTime()??1/0;let a,o;return s>=i&&s<=r?a=s:i>=s&&i<=n&&(a=i),r>=s&&r<=n?o=r:n>=i&&n<=r&&(o=n),a==null||o==null||isNaN(a)||isNaN(o)?uh.empty:new uh({start:a===-1/0?null:new Date(a),end:o===1/0?null:new Date(o)})}offset(e,i,r=vp){if(this.isEmpty||this.isAllTime)return this.clone();const s=new uh,{start:n,end:a}=this;return n!=null&&(s.start=g7(n,e,i,r)),a!=null&&(s.end=g7(a,e,i,r)),s}toArray(){return this.isEmpty?[void 0,void 0]:[this.start?.getTime()??null,this.end?.getTime()??null]}union(e){if(!e||e.isEmpty)return this.clone();if(this.isEmpty)return e.clone();if(this.isAllTime||e.isAllTime)return wde.clone();const i=this.start!=null&&e.start!=null?new Date(Math.min(this.start.getTime(),e.start.getTime())):null,r=this.end!=null&&e.end!=null?new Date(Math.max(this.end.getTime(),e.end.getTime())):null;return new uh({start:i,end:r})}},uh=x$,x$);d([m({type:Date,json:{write:{allowNull:!0}}})],Mn.prototype,"end",void 0),d([di("end")],Mn.prototype,"readEnd",null),d([Ht("end")],Mn.prototype,"writeEnd",null),d([m({readOnly:!0,json:{read:!1}})],Mn.prototype,"isAllTime",null),d([m({readOnly:!0,json:{read:!1}})],Mn.prototype,"isEmpty",null),d([m({type:Date,json:{write:{allowNull:!0}}})],Mn.prototype,"start",void 0),d([di("start")],Mn.prototype,"readStart",null),d([Ht("start")],Mn.prototype,"writeStart",null),Mn=uh=d([k("esri.time.TimeExtent")],Mn);const wde=new Mn,gJe=new Mn({start:void 0,end:void 0});let yJe=0,Ms=class extends s2(lte(a4)){constructor(){super(...arguments),this.attributionDataUrl=null,this.fullExtent=new Bt(-180,-90,180,90,Ie.WGS84),this.id=Date.now().toString(16)+"-layer-"+yJe++,this.legendEnabled=!0,this.listMode="show",this.opacity=1,this.parent=null,this.persistenceEnabled=!1,this.popupEnabled=!0,this.attributionVisible=!0,this.spatialReference=Ie.WGS84,this.title=null,this.type=null,this.url=null,this.visibilityTimeExtent=null,this.visible=!0}static async fromArcGISServerUrl(e){const i=typeof e=="string"?{url:e}:e;return(await te(async()=>{const{fromUrl:r}=await import("./arcgisLayers-DMT9ufk4.js");return{fromUrl:r}},__vite__mapDeps([119,115,116,118]))).fromUrl(i)}static fromPortalItem(e){return fJe(e)}initialize(){this.when().catch(e=>{Hr(e)||fe.getLogger(this).error("#load()",`Failed to load layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}')`,{error:e})})}destroy(){const{parent:e}=this;e&&(this.parent=null,e.removeChildLayer?.(this))}get effectiveVisible(){return this.visible&&(this.parent?.effectiveVisible??!0)}get hasAttributionData(){return this.attributionDataUrl!=null}get loaded(){return super.loaded}removeFromParent(){const{parent:e}=this;e&&(e.removeChildLayer?.(this),this.parent=null)}get parsedUrl(){return Ma(this.url)}createLayerView(e,i){return Promise.reject(new ee("layer:create-layer-view","Layer does not support creating a layer view"))}async fetchAttributionData(){const e=this.attributionDataUrl;if(this.hasAttributionData&&e)return(await $r(e,{query:{f:"json"},responseType:"json"})).data;throw new ee("layer:no-attribution-data","Layer does not have attribution data")}};d([m({type:String})],Ms.prototype,"attributionDataUrl",void 0),d([m({readOnly:!0})],Ms.prototype,"effectiveVisible",null),d([m({type:Bt})],Ms.prototype,"fullExtent",void 0),d([m({readOnly:!0})],Ms.prototype,"hasAttributionData",null),d([m({type:String,clonable:!1})],Ms.prototype,"id",void 0),d([m({type:Boolean,nonNullable:!0})],Ms.prototype,"legendEnabled",void 0),d([m({type:["show","hide","hide-children"]})],Ms.prototype,"listMode",void 0),d([m({type:Number,range:{min:0,max:1},nonNullable:!0})],Ms.prototype,"opacity",void 0),d([m({clonable:!1})],Ms.prototype,"parent",void 0),d([m({readOnly:!0})],Ms.prototype,"parsedUrl",null),d([m({type:Boolean,readOnly:!0})],Ms.prototype,"persistenceEnabled",void 0),d([m({type:Boolean})],Ms.prototype,"popupEnabled",void 0),d([m({type:Boolean})],Ms.prototype,"attributionVisible",void 0),d([m({type:Ie})],Ms.prototype,"spatialReference",void 0),d([m({type:String})],Ms.prototype,"title",void 0),d([m({readOnly:!0,json:{read:!1}})],Ms.prototype,"type",void 0),d([m()],Ms.prototype,"url",void 0),d([m({type:Mn})],Ms.prototype,"visibilityTimeExtent",void 0),d([m({type:Boolean,nonNullable:!0})],Ms.prototype,"visible",void 0),Ms=d([k("esri.layers.Layer")],Ms);const T5=new WeakMap;function w$e(t){return!t.destroyed&&(T5.has(t)||t.addHandles([K(()=>{const{parent:e}=t;return!!(e&&e instanceof Ms)&&(e.type==="catalog-dynamic-group"||w$e(e))},e=>T5.set(t,e),At),ci(()=>T5.delete(t))]),T5.get(t))}const x$e=Symbol("BasemapInstance");function _Je(t){return t!=null&&typeof t=="object"&&x$e in t}function vJe(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="feature"}function bJe(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="graphics"}function wJe(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="map-image"}function xJe(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="knowledge-graph"&&"layers"in t}function SJe(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="knowledge-graph-sublayer"}function xde(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="subtype-group"&&"sublayers"in t}function kb(t){return t?.type==="subtype-sublayer"}function e$(t){const e=t?.type;return e==="base-tile"||e==="tile"||e==="elevation"||e==="imagery-tile"||e==="base-elevation"||e==="open-street-map"||e==="wcs"||e==="web-tile"||e==="wmts"||e==="vector-tile"}function PC(t){return t!=null&&"type"in t&&t.type==="group"}const FVt={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};function NVt(t){const e=t?.type;return e==="building-scene"||e==="integrated-mesh"||e==="point-cloud"||e==="scene"}function Hx(t){return t.type==="integrated-mesh"||t.type==="integrated-mesh-3dtiles"}function Sde(t){return t?.type==="voxel"}function Tde(t){return t?.type==="imagery-tile"}function S$e(t,e){return _Je(t?.parent)&&t.parent[e].includes(t)}function fz(t){return S$e(t,"baseLayers")}function y7(t){return S$e(t,"referenceLayers")}function HU(t){return t?.type==="feature"&&!t.url&&t.source?.type==="memory"}function VVt(t){const e=t?.type;return(e==="feature"||e==="subtype-group"||e==="oriented-imagery")&&t?.source?.type==="feature-layer"}function TJe(t){return t?.type==="feature"&&t.source?.type==="feature-layer"}function UVt(t){return vJe(t)&&TJe(t)}function $Je(t){if(t.activeLayer){const e=t.activeLayer.tileMatrixSet;if(e)return e;const i=t.activeLayer.tileMatrixSets;if(i)return i}return null}async function BVt(t,e){const i=hs?.findServerInfo(t);if(i?.currentVersion!=null)return i.owningSystemUrl||null;const r=t.toLowerCase().indexOf("/rest/services");if(r===-1)return null;const s=`${t.slice(0,r)}/rest/info`,n=e!=null?e.signal:null,{data:a}=await $r(s,{query:{f:"json"},responseType:"json",signal:n});return a?.owningSystemUrl||null}function CJe(t){if(!("capabilities"in t))return!1;switch(t.type){case"catalog":case"catalog-footprint":case"csv":case"feature":case"geojson":case"imagery":case"knowledge-graph-sublayer":case"ogc-feature":case"oriented-imagery":case"scene":case"sublayer":case"subtype-group":case"subtype-sublayer":case"wfs":return!0;default:return!1}}function MJe(t){return CJe(t)?"effectiveCapabilities"in t?t.effectiveCapabilities:t.capabilities:null}function EJe(t){if(!("editingEnabled"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":case"knowledge-graph-sublayer":return!0;default:return!1}}function AJe(t){return!!EJe(t)&&("effectiveEditingEnabled"in t?t.effectiveEditingEnabled:t.editingEnabled)}function T$e(t){return(t.type==="imagery"||t.type==="imagery-tile")&&t.renderer?.type==="flow"}function OJe(t,e){return null}function jVt(t){return null}function PJe(t){return!t||t.type==="Feature Service"&&!t.sourceUrl}function qVt(t,e){!e||!PJe(t)||OJe(t.url)}const _Z=-3,$$e=_Z-1,RJe=!!ie("esri-tests-disable-gpu-memory-measurements");let DJe=class{constructor(e,i,r,s=0){this.name=e,this._storage=i,this.removeFunc=r,this._defaultPriority=s,this.id=`${LJe++}${mz}`,this.size=0,this._hit=0,this._miss=0,this._storage.register(this)}destroy(){this._storage.deregister(this),this._storage=IJe}get hitRate(){return this._hit/(this._hit+this._miss)}get storageSize(){return this._storage.size}getSize(e){return this._storage.getSize(this,e)}set maxSize(e){this._storage.setMaxSize(this,e)}resetHitRate(){this._hit=this._miss=0}put(e,i,r=this._defaultPriority){this._storage.put(this,e,i,i.usedMemory,r)}pop(e){const i=this._storage.pop(this,e);return i===void 0?++this._miss:++this._hit,i}get(e){const i=this._storage.get(this,e);return i===void 0?++this._miss:++this._hit,i}peek(e){return this._storage.peek(this,e)}updateSize(e){this._storage.updateSize(this,e)}clear(){this._storage.clear(this)}clearAll(){this._storage.clearAll()}*[Symbol.iterator](){yield*this._storage.values(this)}get performanceInfo(){return this._storage.performanceInfo}resetStats(){this._storage.resetStats()}},hte=class{get size(){return this._size}constructor(e=10485760){this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._users=new Map,this._sizeLimits=new Map}destroy(){this.clearAll(),this._sizeLimits.clear(),this._users.clear(),this._db=null}register(e){this._users.set(e.id.slice(0,-1),e)}deregister(e){this.clear(e),this._sizeLimits.delete(e),this._users.delete(e.id.slice(0,-1))}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,-1),this._checkSize()}getSize(e,i){return this._db.get(e.id+i)?.size??0}put(e,i,r,s,n){i=e.id+i;const a=this._db.get(i);if(a&&(this._size-=a.size,e.size-=a.size,this._db.delete(i),a.entry!==r&&this._notifyRemove(i,a.entry,a.size,0)),s>this._maxSize)return void this._notifyRemove(i,r,s,0);if(r===void 0)return void console.warn("Refusing to cache undefined entry ");if(!s||s<0)return RJe||console.warn(`Refusing to cache entry with size ${s} for key ${i}`),void this._notifyRemove(i,r,0,0);const o=1+Math.max(n,$$e)-_Z;this._db.set(i,new kJe(r,s,o)),this._size+=s,e.size+=s,this._checkSize()}updateSize(e,i){i=e.id+i;const r=this._db.get(i);if(!r)return;this._size-=r.size,e.size-=r.size;let s=r.entry.usedMemory;for(;s>this._maxSize;){const n=this._notifyRemove(i,r.entry,s,1);if(!(n!=null&&n>0))return void this._db.delete(i);s=n}r.size=s,this._size+=s,e.size+=s,this._checkSize()}pop(e,i){i=e.id+i;const r=this._db.get(i);if(r)return this._size-=r.size,e.size-=r.size,this._db.delete(i),++this._hit,r.entry;++this._miss}get(e,i){i=e.id+i;const r=this._db.get(i);if(r!==void 0)return this._db.delete(i),r.lives=r.lifetime,this._db.set(i,r),++this._hit,r.entry;++this._miss}peek(e,i){const r=this._db.get(e.id+i);return r?++this._hit:++this._miss,r?.entry}get performanceInfo(){const e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},i={},r=new Array;this._db.forEach((a,o)=>{const l=a.lifetime;r[l]=(r[l]||0)+a.size,this._users.forEach(c=>{const{id:h,name:f}=c;if(o.startsWith(h)){const y=i[f]||0;i[f]=y+a.size}})});const s={};this._users.forEach(a=>{const o=a.name;if("hitRate"in a&&typeof a.hitRate=="number"&&!isNaN(a.hitRate)&&a.hitRate>0){const l=i[o]||0;i[o]=l,s[o]=Math.round(100*a.hitRate)+"%"}else s[o]="0%"});const n=Object.keys(i);n.sort((a,o)=>i[o]-i[a]),n.forEach(a=>e[a]=Math.round(i[a]/2**20)+"MB / "+s[a]);for(let a=r.length-1;a>=0;--a){const o=r[a];o&&(e["Priority "+(a+_Z-1)]=Math.round(o/this._size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forEach(e=>e.resetHitRate())}clear(e){const i=e.id;this._db.forEach((r,s)=>{s.startsWith(i)&&(this._size-=r.size,this._db.delete(s),this._notifyRemove(s,r.entry,r.size,0))}),e.size=0}clearAll(){this._db.forEach((e,i)=>this._notifyRemove(i,e.entry,e.size,0)),this._users.forEach(e=>e.size=0),this._size=0,this._db.clear()}*values(e){for(const[i,r]of this._db)i.startsWith(e.id)&&(yield r.entry)}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(e,i,r,s){const n=this._users.get(e.split(mz)[0])?.removeFunc,a=n?.(i,s,r);return typeof a=="number"?a:null}_checkSize(){this._sizeLimits.forEach((e,i)=>this._checkSizeLimits(e,i)),this._checkSizeLimits(this.maxSize)}setMaxSize(e,i){i==null||i<=0?this._sizeLimits.delete(e):this._sizeLimits.set(e,i)}_checkSizeLimits(e,i){const r=i??this;if(r.size<=e)return;const s=i?.id;let n=!0;for(;n;){n=!1;for(const[a,o]of this._db)if(o.lifetime===0&&(!s||a.startsWith(s))){const l=i??this._users.get(a.split(mz)[0]);if(this._purgeItem(a,o,l),r.size<=.9*e)return;n||=this._db.has(a)}}for(const[a,o]of this._db)if(!s||a.startsWith(s)){const l=i??this._users.get(a.split(mz)[0]);if(this._purgeItem(a,o,l),r.size<=.9*e)return}}_purgeItem(e,i,r){if(this._db.delete(e),i.lives<=1){this._size-=i.size,r&&(r.size-=i.size);const s=this._notifyRemove(e,i.entry,i.size,1);s!=null&&s>0&&(this._size+=s,r&&(r.size+=s),i.lives=i.lifetime,i.size=s,this._db.set(e,i))}else--i.lives,this._db.set(e,i)}};const IJe=new hte(0);let LJe=0,kJe=class{constructor(e,i,r){this.entry=e,this.size=i,this.lifetime=r,this.lives=r}};const mz=":";let C$e=class{constructor(e,i){this.removeFunc=i,this._storage=new hte,this.id="",this.name="",this.size=0,this._storage.maxSize=e,this._storage.register(this)}destroy(){this._storage.deregister(this),this._storage.destroy(),this._storage=null}put(e,i,r=1){this._storage.put(this,e,i,r,1)}pop(e){return this._storage.pop(this,e)}get(e){return this._storage.get(this,e)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}resetHitRate(){}},o4=class M$e{constructor(e,i,r,s=Pi()){this._level=e,this._row=i,this._col=r,this.extent=s}get id(){return this._id??=`${this.level}/${this.row}/${this.col}`,this._id}get level(){return this._level}set level(e){this._level=e,this._id=null}get row(){return this._row}set row(e){this._row=e,this._id=null}get col(){return this._col}set col(e){this._col=e,this._id=null}toJSON(){return{level:this._level,row:this._row,col:this._col,extent:this.extent}}static fromJSON(e){return new M$e(e.level,e.row,e.col,e.extent)}};function zJe(t){return 32+t.length}const E$e=16;function dte(t){if(!t)return 0;let e=Pg;for(const i in t)t.hasOwnProperty(i)&&(e+=pte(t[i],!1));return e}function y6(t){if(!t)return 0;if(typeof t[0]=="number")return Wx(t);if(Array.isArray(t))return FJe(t);let e=Pg;for(const i in t)t.hasOwnProperty(i)&&(e+=pte(t[i]));return e}function FJe(t){const e=t.length;if(e===0||typeof t[0]=="number")return A$e(t,8);let i=O$e;for(let r=0;r<e;r++)i+=pte(t[r]);return i}function pte(t,e=!0){switch(typeof t){case"object":return e?y6(t):Pg;case"string":return zJe(t);case"number":return E$e;case"boolean":return 4;default:return 8}}function Wx(...t){return t.reduce((e,i)=>e+(i?iM(i)?i.byteLength+fte:Array.isArray(i)?A$e(i,E$e):0:0),0)}function A$e(t,e){return O$e+t.length*e}const Pg=32,O$e=16,fte=145;function NJe(t,e=!1){return t<=Hl?e?new Array(t).fill(0):new Array(t):new Uint32Array(t)}let $de=class vZ{constructor(e){UJe(e);const{location:i,data:r}=e;this.location=Object.freeze(Te(i));const s=this.location.width,n=this.location.height;let a=!0,o=!0;const l=Math.ceil(s*n/32),c=NJe(l);let h=0;for(let f=0;f<r.length;f++){const y=f%32;r[f]?(o=!1,c[h]|=1<<y):a=!1,y===31&&++h}o?(this._availability="unavailable",this.byteSize=40):a?(this._availability="available",this.byteSize=40):(this._availability=c,this.byteSize=40+Wx(c))}getAvailability(e,i){if(this._availability==="unavailable"||this._availability==="available")return this._availability;const r=(e-this.location.top)*this.location.width+(i-this.location.left),s=r%32,n=r>>5,a=this._availability;return n<0||n>a.length?"unknown":a[n]&1<<s?"available":"unavailable"}static fromDefinition(e,i){const r=e.service.request||$r,{row:s,col:n,width:a,height:o}=e,l={query:{f:"json"}};return i=i?{...l,...i}:l,r(VJe(e),i).then(c=>c.data).catch(c=>{if(c?.details?.httpStatus===422)return{location:{top:s,left:n,width:a,height:o},valid:!0,data:new Array(a*o).fill(0)};throw c}).then(c=>{if(c.location&&(c.location.top!==s||c.location.left!==n||c.location.width!==a||c.location.height!==o))throw new ee("tilemap:location-mismatch","Tilemap response for different location than requested",{response:c,definition:{top:s,left:n,width:a,height:o}});return vZ.fromJSON(c)})}static fromJSON(e){return Object.freeze(new vZ(e))}};function Cde(t){return`${t.level}/${t.row}/${t.col}/${t.width}/${t.height}`}function VJe(t){let e;if(t.service.tileServers?.length){const r=t.service.tileServers;e=`${r&&r.length?r[t.row%r.length]:t.service.url}/tilemap/${t.level}/${t.row}/${t.col}/${t.width}/${t.height}`}else e=`${t.service.url}/tilemap/${t.level}/${t.row}/${t.col}/${t.width}/${t.height}`;const i=t.service.query;return i&&(e=`${e}?${i}`),e}function UJe(t){if(!t?.location)throw new ee("tilemap:missing-location","Location missing from tilemap response");if(t.valid===!1)throw new ee("tilemap:invalid","Tilemap response was marked as invalid");if(!t.data)throw new ee("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(t.data))throw new ee("tilemap:data-mismatch","Data must be an array of numbers");if(t.data.length!==t.location.width*t.location.height)throw new ee("tilemap:data-mismatch","Number of data items does not match width/height of tilemap")}var J1;function Mde(t,e,i){return new ee("tile-map:tile-unavailable","Tile is not available",{level:t,row:e,col:i})}var ev;let B0=(ev=class extends Me{constructor(e){super(e),this._pendingTilemapRequests={},this.request=$r,this.size=32,this._prefetchingEnabled=!0}initialize(){this._tilemapCache=new C$e(2097152),this.addHandles(K(()=>{const{layer:e}=this;return[e?.parsedUrl,e?.tileServers,e?.apiKey,e?.customParameters]},()=>this._initializeTilemapDefinition(),Wt))}get effectiveMinLOD(){return this.minLOD??this.layer.tileInfo.lods[0].level}get effectiveMaxLOD(){return this.maxLOD??this.layer.tileInfo.lods[this.layer.tileInfo.lods.length-1].level}getAvailability(e,i,r){if(!this.layer.tileInfo.lodAt(e)||e<this.effectiveMinLOD||e>this.effectiveMaxLOD)return"unavailable";const s=this._tilemapFromCache(e,i,r,this._tmpTilemapDefinition);return s?s.getAvailability(i,r):"unknown"}fetchAvailability(e,i,r,s){return!this.layer.tileInfo.lodAt(e)||e<this.effectiveMinLOD||e>this.effectiveMaxLOD?Promise.reject(Mde(e,i,r)):this._fetchTilemap(e,i,r,s).catch(n=>n).then(n=>{if(n instanceof $de){const a=n.getAvailability(i,r);if(a==="unavailable")throw Mde(e,i,r);return a}if(Hr(n))throw n;return"unknown"})}fetchAvailabilityUpsample(e,i,r,s,n){s.level=e,s.row=i,s.col=r;const a=this.layer.tileInfo;a.updateTileInfo(s);const o=this.fetchAvailability(e,i,r,n).catch(l=>{if(Hr(l))throw l;if(a.upsampleTile(s))return this.fetchAvailabilityUpsample(s.level,s.row,s.col,s,n);throw l});return this._fetchAvailabilityUpsamplePrefetch(e,i,r,n,o),o}async _fetchAvailabilityUpsamplePrefetch(e,i,r,s,n){if(!this._prefetchingEnabled)return;const a=`prefetch-${e}-${i}-${r}`;if(this.hasHandles(a))return;const o=new AbortController;n.then(()=>o.abort(),()=>o.abort());let l=!1;const c=ci(()=>{l||(l=!0,o.abort())});if(this.addHandles(c,a),await Cwe(10,o.signal).catch(()=>{}),l||(l=!0,this.removeHandles(a)),Rn(o))return;const h=new o4(e,i,r),f={...s,signal:o.signal},y=this.layer.tileInfo;for(let _=0;J1._prefetches.length<J1._maxPrefetch&&y.upsampleTile(h);++_){const w=this.fetchAvailability(h.level,h.row,h.col,f);J1._prefetches.push(w);const x=()=>{J1._prefetches.removeUnordered(w)};w.then(x,x)}}static cleanupTilemapCache(){this._prefetches.prune()}_fetchTilemap(e,i,r,s){if(!this.layer.tileInfo.lodAt(e)||e<this.effectiveMinLOD||e>this.effectiveMaxLOD)return Promise.reject(new ee("tilemap-cache:level-unavailable",`Level ${e} is unavailable in the service`));const n=this._tmpTilemapDefinition,a=this._tilemapFromCache(e,i,r,n);if(a)return Promise.resolve(a);const o=s?.signal;return s={...s,signal:null},new Promise((l,c)=>{qa(o,()=>c(Xt()));const h=Cde(n);let f=this._pendingTilemapRequests[h];if(!f){f=$de.fromDefinition(n,s).then(_=>(this._tilemapCache.put(h,_,_.byteSize),_));const y=()=>{delete this._pendingTilemapRequests[h]};this._pendingTilemapRequests[h]=f,f.then(y,y)}f.then(l,c)})}_initializeTilemapDefinition(){if(!this.layer.parsedUrl)return;const{parsedUrl:e,apiKey:i,customParameters:r}=this.layer;this._tilemapCache.clear(),this._tmpTilemapDefinition={service:{url:e.path,query:nC({...e.query,...r,token:i??e.query?.token}),tileServers:this.layer.tileServers,request:this.request},width:this.size,height:this.size,level:0,row:0,col:0}}_tilemapFromCache(e,i,r,s){s.level=e,s.row=i-i%this.size,s.col=r-r%this.size;const n=Cde(s);return this._tilemapCache.get(n)}get test(){}},J1=ev,ev._maxPrefetch=4,ev._prefetches=new _i({initialSize:J1._maxPrefetch}),ev);d([m({constructOnly:!0})],B0.prototype,"layer",void 0),d([m({constructOnly:!0})],B0.prototype,"minLOD",void 0),d([m({constructOnly:!0})],B0.prototype,"maxLOD",void 0),d([m({constructOnly:!0})],B0.prototype,"request",void 0),d([m({constructOnly:!0})],B0.prototype,"size",void 0),B0=J1=d([k("esri.layers.support.TilemapCache")],B0);let rO;function BJe(){rO=void 0}function jJe(t){return rO&&!rO.destroyed||(rO=t()),rO}let RC=class extends DP{constructor(e){super(e),this.addHandles(this.on("before-add",i=>{i.item!=null&&i.item.parent===this.owner&&(fe.getLogger(this).warn("Analysis inside the collection must be unique. Not adding this element again."),i.preventDefault())}))}_own(e){e.parent=this.owner}_release(e){e.parent=null}};RC=d([k("esri.support.AnalysesCollection")],RC);const P$e=Symbol("WebScene"),gz={widthBreakpoint:{getValue(t){const e=t.viewSize[0],i=t.breakpoints,r=this.values;return e<=i.xsmall?r.xsmall:e<=i.small?r.small:e<=i.medium?r.medium:e<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(t){const e=t.viewSize[1],i=t.breakpoints,r=this.values;return e<=i.xsmall?r.xsmall:e<=i.small?r.small:e<=i.medium?r.medium:e<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(t){const e=t.viewSize,i=e[0],r=e[1],s=this.values;return r>=i?s.portrait:s.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},_7={xsmall:544,small:768,medium:992,large:1200};function qJe(t){const e=t;return e&&e.xsmall<e.small&&e.small<e.medium&&e.medium<e.large}function v7(t,e){return e?gz[t].valueToClassName[e].split(" "):[]}const GJe=t=>{const e=t;let i=class extends e{constructor(...r){super(...r),this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=_7}initialize(){this.addHandles(K(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),Wt))}destroy(){this.destroyed||this._removeActiveClassNames()}set breakpoints(r){if(r!==this._get("breakpoints")){if(!qJe(r)){const s=JSON.stringify(_7,null,2);console.warn("provided breakpoints are not valid, using defaults:"+s),r=_7}this._set("breakpoints",{...r})}}_updateClassNames(){if(!this.container)return;const r=Mc.acquire(),s=Mc.acquire();let n,a=!1;for(n in gz){const o=this[n],l=gz[n].getValue({viewSize:this.size,breakpoints:this.breakpoints});o!==l&&(a=!0,this[n]=l,v7(n,o).forEach(c=>s.push(c)),v7(n,l).forEach(c=>r.push(c)))}a&&(this._applyClassNameChanges(r,s),Mc.release(r),Mc.release(s))}_applyClassNameChanges(r,s){const n=this.container;n&&(s.forEach(a=>n.classList.remove(a)),r.forEach(a=>n.classList.add(a)))}_removeActiveClassNames(){const r=this.container;if(!r)return;let s;for(s in gz)v7(s,this[s]).forEach(n=>r.classList.remove(n))}};return d([m()],i.prototype,"breakpoints",null),d([m()],i.prototype,"orientation",void 0),d([m()],i.prototype,"widthBreakpoint",void 0),d([m()],i.prototype,"heightBreakpoint",void 0),i=d([k("esri.views.BreakpointsOwner")],i),i};let mp=class extends Me{constructor(){super(...arguments),this.updating=!1,this._handleId=0,this._scheduleHandleId=0,this._pendingPromises=new Set}destroy(){this.removeAll()}add(e,i,r={}){return this._installWatch(e,i,r,K)}addWhen(e,i,r={}){return this._installWatch(e,i,r,Zs)}addOnCollectionChange(e,i,{initial:r=!1,final:s=!1}={}){const n=++this._handleId;return this.addHandles([Ys(e,"after-changes",this._createSyncUpdatingCallback(),Yt),Ys(e,"change",i,{onListenerAdd:r?a=>i({added:a.toArray(),removed:[]}):void 0,onListenerRemove:s?a=>i({added:[],removed:a.toArray()}):void 0})],n),ci(()=>this.removeHandles(n))}addPromise(e){if(e==null)return e;const i=++this._handleId;this.addHandles(ci(()=>{this._pendingPromises.delete(e)&&(this._pendingPromises.size!==0||this.hasHandles($5)||this._set("updating",!1))}),i),this._pendingPromises.add(e),this._set("updating",!0);const r=()=>this.removeHandles(i);return e.then(r,r),e}removeAll(){this._pendingPromises.clear(),this.removeAllHandles(),this._set("updating",!1)}_installWatch(e,i,r={},s){const n=++this._handleId;r.sync||this._installSyncUpdatingWatch(e,n);const a=s(e,i,r);return this.addHandles(a,n),ci(()=>this.removeHandles(n))}_installSyncUpdatingWatch(e,i){const r=this._createSyncUpdatingCallback(),s=K(e,r,{sync:!0,equals:()=>!1});return this.addHandles(s,i),s}_createSyncUpdatingCallback(){return()=>{this.removeHandles($5),++this._scheduleHandleId;const e=this._scheduleHandleId;this._get("updating")||this._set("updating",!0),this.addHandles(oM(()=>{e===this._scheduleHandleId&&(this._set("updating",this._pendingPromises.size>0),this.removeHandles($5))}),$5)}}};d([m({readOnly:!0})],mp.prototype,"updating",void 0),mp=d([k("esri.core.support.UpdatingHandles")],mp);const $5=-42;var _6=function(){return _6=Object.assign||function(e){for(var i,r=1,s=arguments.length;r<s;r++){i=arguments[r];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},_6.apply(this,arguments)},bZ={exports:{}},fn={},wZ={exports:{}},c2={};function R$e(){var t={};return t["align-content"]=!1,t["align-items"]=!1,t["align-self"]=!1,t["alignment-adjust"]=!1,t["alignment-baseline"]=!1,t.all=!1,t["anchor-point"]=!1,t.animation=!1,t["animation-delay"]=!1,t["animation-direction"]=!1,t["animation-duration"]=!1,t["animation-fill-mode"]=!1,t["animation-iteration-count"]=!1,t["animation-name"]=!1,t["animation-play-state"]=!1,t["animation-timing-function"]=!1,t.azimuth=!1,t["backface-visibility"]=!1,t.background=!0,t["background-attachment"]=!0,t["background-clip"]=!0,t["background-color"]=!0,t["background-image"]=!0,t["background-origin"]=!0,t["background-position"]=!0,t["background-repeat"]=!0,t["background-size"]=!0,t["baseline-shift"]=!1,t.binding=!1,t.bleed=!1,t["bookmark-label"]=!1,t["bookmark-level"]=!1,t["bookmark-state"]=!1,t.border=!0,t["border-bottom"]=!0,t["border-bottom-color"]=!0,t["border-bottom-left-radius"]=!0,t["border-bottom-right-radius"]=!0,t["border-bottom-style"]=!0,t["border-bottom-width"]=!0,t["border-collapse"]=!0,t["border-color"]=!0,t["border-image"]=!0,t["border-image-outset"]=!0,t["border-image-repeat"]=!0,t["border-image-slice"]=!0,t["border-image-source"]=!0,t["border-image-width"]=!0,t["border-left"]=!0,t["border-left-color"]=!0,t["border-left-style"]=!0,t["border-left-width"]=!0,t["border-radius"]=!0,t["border-right"]=!0,t["border-right-color"]=!0,t["border-right-style"]=!0,t["border-right-width"]=!0,t["border-spacing"]=!0,t["border-style"]=!0,t["border-top"]=!0,t["border-top-color"]=!0,t["border-top-left-radius"]=!0,t["border-top-right-radius"]=!0,t["border-top-style"]=!0,t["border-top-width"]=!0,t["border-width"]=!0,t.bottom=!1,t["box-decoration-break"]=!0,t["box-shadow"]=!0,t["box-sizing"]=!0,t["box-snap"]=!0,t["box-suppress"]=!0,t["break-after"]=!0,t["break-before"]=!0,t["break-inside"]=!0,t["caption-side"]=!1,t.chains=!1,t.clear=!0,t.clip=!1,t["clip-path"]=!1,t["clip-rule"]=!1,t.color=!0,t["color-interpolation-filters"]=!0,t["column-count"]=!1,t["column-fill"]=!1,t["column-gap"]=!1,t["column-rule"]=!1,t["column-rule-color"]=!1,t["column-rule-style"]=!1,t["column-rule-width"]=!1,t["column-span"]=!1,t["column-width"]=!1,t.columns=!1,t.contain=!1,t.content=!1,t["counter-increment"]=!1,t["counter-reset"]=!1,t["counter-set"]=!1,t.crop=!1,t.cue=!1,t["cue-after"]=!1,t["cue-before"]=!1,t.cursor=!1,t.direction=!1,t.display=!0,t["display-inside"]=!0,t["display-list"]=!0,t["display-outside"]=!0,t["dominant-baseline"]=!1,t.elevation=!1,t["empty-cells"]=!1,t.filter=!1,t.flex=!1,t["flex-basis"]=!1,t["flex-direction"]=!1,t["flex-flow"]=!1,t["flex-grow"]=!1,t["flex-shrink"]=!1,t["flex-wrap"]=!1,t.float=!1,t["float-offset"]=!1,t["flood-color"]=!1,t["flood-opacity"]=!1,t["flow-from"]=!1,t["flow-into"]=!1,t.font=!0,t["font-family"]=!0,t["font-feature-settings"]=!0,t["font-kerning"]=!0,t["font-language-override"]=!0,t["font-size"]=!0,t["font-size-adjust"]=!0,t["font-stretch"]=!0,t["font-style"]=!0,t["font-synthesis"]=!0,t["font-variant"]=!0,t["font-variant-alternates"]=!0,t["font-variant-caps"]=!0,t["font-variant-east-asian"]=!0,t["font-variant-ligatures"]=!0,t["font-variant-numeric"]=!0,t["font-variant-position"]=!0,t["font-weight"]=!0,t.grid=!1,t["grid-area"]=!1,t["grid-auto-columns"]=!1,t["grid-auto-flow"]=!1,t["grid-auto-rows"]=!1,t["grid-column"]=!1,t["grid-column-end"]=!1,t["grid-column-start"]=!1,t["grid-row"]=!1,t["grid-row-end"]=!1,t["grid-row-start"]=!1,t["grid-template"]=!1,t["grid-template-areas"]=!1,t["grid-template-columns"]=!1,t["grid-template-rows"]=!1,t["hanging-punctuation"]=!1,t.height=!0,t.hyphens=!1,t.icon=!1,t["image-orientation"]=!1,t["image-resolution"]=!1,t["ime-mode"]=!1,t["initial-letters"]=!1,t["inline-box-align"]=!1,t["justify-content"]=!1,t["justify-items"]=!1,t["justify-self"]=!1,t.left=!1,t["letter-spacing"]=!0,t["lighting-color"]=!0,t["line-box-contain"]=!1,t["line-break"]=!1,t["line-grid"]=!1,t["line-height"]=!1,t["line-snap"]=!1,t["line-stacking"]=!1,t["line-stacking-ruby"]=!1,t["line-stacking-shift"]=!1,t["line-stacking-strategy"]=!1,t["list-style"]=!0,t["list-style-image"]=!0,t["list-style-position"]=!0,t["list-style-type"]=!0,t.margin=!0,t["margin-bottom"]=!0,t["margin-left"]=!0,t["margin-right"]=!0,t["margin-top"]=!0,t["marker-offset"]=!1,t["marker-side"]=!1,t.marks=!1,t.mask=!1,t["mask-box"]=!1,t["mask-box-outset"]=!1,t["mask-box-repeat"]=!1,t["mask-box-slice"]=!1,t["mask-box-source"]=!1,t["mask-box-width"]=!1,t["mask-clip"]=!1,t["mask-image"]=!1,t["mask-origin"]=!1,t["mask-position"]=!1,t["mask-repeat"]=!1,t["mask-size"]=!1,t["mask-source-type"]=!1,t["mask-type"]=!1,t["max-height"]=!0,t["max-lines"]=!1,t["max-width"]=!0,t["min-height"]=!0,t["min-width"]=!0,t["move-to"]=!1,t["nav-down"]=!1,t["nav-index"]=!1,t["nav-left"]=!1,t["nav-right"]=!1,t["nav-up"]=!1,t["object-fit"]=!1,t["object-position"]=!1,t.opacity=!1,t.order=!1,t.orphans=!1,t.outline=!1,t["outline-color"]=!1,t["outline-offset"]=!1,t["outline-style"]=!1,t["outline-width"]=!1,t.overflow=!1,t["overflow-wrap"]=!1,t["overflow-x"]=!1,t["overflow-y"]=!1,t.padding=!0,t["padding-bottom"]=!0,t["padding-left"]=!0,t["padding-right"]=!0,t["padding-top"]=!0,t.page=!1,t["page-break-after"]=!1,t["page-break-before"]=!1,t["page-break-inside"]=!1,t["page-policy"]=!1,t.pause=!1,t["pause-after"]=!1,t["pause-before"]=!1,t.perspective=!1,t["perspective-origin"]=!1,t.pitch=!1,t["pitch-range"]=!1,t["play-during"]=!1,t.position=!1,t["presentation-level"]=!1,t.quotes=!1,t["region-fragment"]=!1,t.resize=!1,t.rest=!1,t["rest-after"]=!1,t["rest-before"]=!1,t.richness=!1,t.right=!1,t.rotation=!1,t["rotation-point"]=!1,t["ruby-align"]=!1,t["ruby-merge"]=!1,t["ruby-position"]=!1,t["shape-image-threshold"]=!1,t["shape-outside"]=!1,t["shape-margin"]=!1,t.size=!1,t.speak=!1,t["speak-as"]=!1,t["speak-header"]=!1,t["speak-numeral"]=!1,t["speak-punctuation"]=!1,t["speech-rate"]=!1,t.stress=!1,t["string-set"]=!1,t["tab-size"]=!1,t["table-layout"]=!1,t["text-align"]=!0,t["text-align-last"]=!0,t["text-combine-upright"]=!0,t["text-decoration"]=!0,t["text-decoration-color"]=!0,t["text-decoration-line"]=!0,t["text-decoration-skip"]=!0,t["text-decoration-style"]=!0,t["text-emphasis"]=!0,t["text-emphasis-color"]=!0,t["text-emphasis-position"]=!0,t["text-emphasis-style"]=!0,t["text-height"]=!0,t["text-indent"]=!0,t["text-justify"]=!0,t["text-orientation"]=!0,t["text-overflow"]=!0,t["text-shadow"]=!0,t["text-space-collapse"]=!0,t["text-transform"]=!0,t["text-underline-position"]=!0,t["text-wrap"]=!0,t.top=!1,t.transform=!1,t["transform-origin"]=!1,t["transform-style"]=!1,t.transition=!1,t["transition-delay"]=!1,t["transition-duration"]=!1,t["transition-property"]=!1,t["transition-timing-function"]=!1,t["unicode-bidi"]=!1,t["vertical-align"]=!1,t.visibility=!1,t["voice-balance"]=!1,t["voice-duration"]=!1,t["voice-family"]=!1,t["voice-pitch"]=!1,t["voice-range"]=!1,t["voice-rate"]=!1,t["voice-stress"]=!1,t["voice-volume"]=!1,t.volume=!1,t["white-space"]=!1,t.widows=!1,t.width=!0,t["will-change"]=!1,t["word-break"]=!0,t["word-spacing"]=!0,t["word-wrap"]=!0,t["wrap-flow"]=!1,t["wrap-through"]=!1,t["writing-mode"]=!1,t["z-index"]=!1,t}function HJe(t,e,i){}function WJe(t,e,i){}var ZJe=/javascript\s*\:/img;function YJe(t,e){return ZJe.test(e)?"":e}c2.whiteList=R$e();c2.getDefaultWhiteList=R$e;c2.onAttr=HJe;c2.onIgnoreAttr=WJe;c2.safeAttrValue=YJe;var QJe={indexOf:function(t,e){var i,r;if(Array.prototype.indexOf)return t.indexOf(e);for(i=0,r=t.length;i<r;i++)if(t[i]===e)return i;return-1},forEach:function(t,e,i){var r,s;if(Array.prototype.forEach)return t.forEach(e,i);for(r=0,s=t.length;r<s;r++)e.call(i,t[r],r,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(t){return String.prototype.trimRight?t.trimRight():t.replace(/(\s*$)/g,"")}},VE=QJe;function XJe(t,e){t=VE.trimRight(t),t[t.length-1]!==";"&&(t+=";");var i=t.length,r=!1,s=0,n=0,a="";function o(){if(!r){var h=VE.trim(t.slice(s,n)),f=h.indexOf(":");if(f!==-1){var y=VE.trim(h.slice(0,f)),_=VE.trim(h.slice(f+1));if(y){var w=e(s,a.length,y,_,h);w&&(a+=w+"; ")}}}s=n+1}for(;n<i;n++){var l=t[n];if(l==="/"&&t[n+1]==="*"){var c=t.indexOf("*/",n+2);if(c===-1)break;n=c+1,s=n+1,r=!1}else l==="("?r=!0:l===")"?r=!1:l===";"?r||o():l===`
`&&o()}return VE.trim(a)}var JJe=XJe,C5=c2,KJe=JJe;function Ede(t){return t==null}function eKe(t){var e={};for(var i in t)e[i]=t[i];return e}function D$e(t){t=eKe(t||{}),t.whiteList=t.whiteList||C5.whiteList,t.onAttr=t.onAttr||C5.onAttr,t.onIgnoreAttr=t.onIgnoreAttr||C5.onIgnoreAttr,t.safeAttrValue=t.safeAttrValue||C5.safeAttrValue,this.options=t}D$e.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,i=e.options,r=i.whiteList,s=i.onAttr,n=i.onIgnoreAttr,a=i.safeAttrValue,o=KJe(t,function(l,c,h,f,y){var _=r[h],w=!1;if(_===!0?w=_:typeof _=="function"?w=_(f):_ instanceof RegExp&&(w=_.test(f)),w!==!0&&(w=!1),f=a(h,f),!!f){var x={position:c,sourcePosition:l,source:y,isWhite:w};if(w){var S=s(h,f,x);return Ede(S)?h+":"+f:S}else{var S=n(h,f,x);if(!Ede(S))return S}}});return o};var tKe=D$e;(function(t,e){var i=c2,r=tKe;function s(a,o){var l=new r(o);return l.process(a)}e=t.exports=s,e.FilterCSS=r;for(var n in i)e[n]=i[n]})(wZ,wZ.exports);var mte=wZ.exports,gte={indexOf:function(t,e){var i,r;if(Array.prototype.indexOf)return t.indexOf(e);for(i=0,r=t.length;i<r;i++)if(t[i]===e)return i;return-1},forEach:function(t,e,i){var r,s;if(Array.prototype.forEach)return t.forEach(e,i);for(r=0,s=t.length;r<s;r++)e.call(i,t[r],r,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(t){var e=/\s|\n|\t/,i=e.exec(t);return i?i.index:-1}},iKe=mte.FilterCSS,rKe=mte.getDefaultWhiteList,v6=gte;function I$e(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}}var L$e=new iKe;function sKe(t,e,i){}function nKe(t,e,i){}function aKe(t,e,i){}function oKe(t,e,i){}function k$e(t){return t.replace(cKe,"&lt;").replace(uKe,"&gt;")}function lKe(t,e,i,r){if(i=B$e(i),e==="href"||e==="src"){if(i=v6.trim(i),i==="#")return"#";if(!(i.substr(0,7)==="http://"||i.substr(0,8)==="https://"||i.substr(0,7)==="mailto:"||i.substr(0,4)==="tel:"||i.substr(0,11)==="data:image/"||i.substr(0,6)==="ftp://"||i.substr(0,2)==="./"||i.substr(0,3)==="../"||i[0]==="#"||i[0]==="/"))return""}else if(e==="background"){if(M5.lastIndex=0,M5.test(i))return""}else if(e==="style"){if(Ade.lastIndex=0,Ade.test(i)||(Ode.lastIndex=0,Ode.test(i)&&(M5.lastIndex=0,M5.test(i))))return"";r!==!1&&(r=r||L$e,i=r.process(i))}return i=j$e(i),i}var cKe=/</g,uKe=/>/g,hKe=/"/g,dKe=/&quot;/g,pKe=/&#([a-zA-Z0-9]*);?/gim,fKe=/&colon;?/gim,mKe=/&newline;?/gim,M5=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,Ade=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,Ode=/u\s*r\s*l\s*\(.*/gi;function z$e(t){return t.replace(hKe,"&quot;")}function F$e(t){return t.replace(dKe,'"')}function N$e(t){return t.replace(pKe,function(i,r){return r[0]==="x"||r[0]==="X"?String.fromCharCode(parseInt(r.substr(1),16)):String.fromCharCode(parseInt(r,10))})}function V$e(t){return t.replace(fKe,":").replace(mKe," ")}function U$e(t){for(var e="",i=0,r=t.length;i<r;i++)e+=t.charCodeAt(i)<32?" ":t.charAt(i);return v6.trim(e)}function B$e(t){return t=F$e(t),t=N$e(t),t=V$e(t),t=U$e(t),t}function j$e(t){return t=z$e(t),t=k$e(t),t}function gKe(){return""}function yKe(t,e){typeof e!="function"&&(e=function(){});var i=!Array.isArray(t);function r(a){return i?!0:v6.indexOf(t,a)!==-1}var s=[],n=!1;return{onIgnoreTag:function(a,o,l){if(r(a))if(l.isClosing){var c="[/removed]",h=l.position+c.length;return s.push([n!==!1?n:l.position,h]),n=!1,c}else return n||(n=l.position),"[removed]";else return e(a,o,l)},remove:function(a){var o="",l=0;return v6.forEach(s,function(c){o+=a.slice(l,c[0]),l=c[1]}),o+=a.slice(l),o}}}function _Ke(t){for(var e="",i=0;i<t.length;){var r=t.indexOf("<!--",i);if(r===-1){e+=t.slice(i);break}e+=t.slice(i,r);var s=t.indexOf("-->",r);if(s===-1)break;i=s+3}return e}function vKe(t){var e=t.split("");return e=e.filter(function(i){var r=i.charCodeAt(0);return r===127?!1:r<=31?r===10||r===13:!0}),e.join("")}fn.whiteList=I$e();fn.getDefaultWhiteList=I$e;fn.onTag=sKe;fn.onIgnoreTag=nKe;fn.onTagAttr=aKe;fn.onIgnoreTagAttr=oKe;fn.safeAttrValue=lKe;fn.escapeHtml=k$e;fn.escapeQuote=z$e;fn.unescapeQuote=F$e;fn.escapeHtmlEntities=N$e;fn.escapeDangerHtml5Entities=V$e;fn.clearNonPrintableCharacter=U$e;fn.friendlyAttrValue=B$e;fn.escapeAttrValue=j$e;fn.onIgnoreTagStripAll=gKe;fn.StripTagBody=yKe;fn.stripCommentTag=_Ke;fn.stripBlankChar=vKe;fn.cssFilter=L$e;fn.getDefaultCSSWhiteList=rKe;var WU={},d_=gte;function bKe(t){var e=d_.spaceIndex(t),i;return e===-1?i=t.slice(1,-1):i=t.slice(1,e+1),i=d_.trim(i).toLowerCase(),i.slice(0,1)==="/"&&(i=i.slice(1)),i.slice(-1)==="/"&&(i=i.slice(0,-1)),i}function wKe(t){return t.slice(0,2)==="</"}function xKe(t,e,i){var r="",s=0,n=!1,a=!1,o=0,l=t.length,c="",h="";e:for(o=0;o<l;o++){var f=t.charAt(o);if(n===!1){if(f==="<"){n=o;continue}}else if(a===!1){if(f==="<"){r+=i(t.slice(s,o)),n=o,s=o;continue}if(f===">"){r+=i(t.slice(s,n)),h=t.slice(n,o+1),c=bKe(h),r+=e(n,r.length,c,h,wKe(h)),s=o+1,n=!1;continue}if(f==='"'||f==="'")for(var y=1,_=t.charAt(o-y);_.trim()===""||_==="=";){if(_==="="){a=f;continue e}_=t.charAt(o-++y)}}else if(f===a){a=!1;continue}}return s<t.length&&(r+=i(t.substr(s))),r}var SKe=/[^a-zA-Z0-9\\_:.-]/gim;function TKe(t,e){var i=0,r=0,s=[],n=!1,a=t.length;function o(y,_){if(y=d_.trim(y),y=y.replace(SKe,"").toLowerCase(),!(y.length<1)){var w=e(y,_||"");w&&s.push(w)}}for(var l=0;l<a;l++){var c=t.charAt(l),h,f;if(n===!1&&c==="="){n=t.slice(i,l),i=l+1,r=t.charAt(i)==='"'||t.charAt(i)==="'"?i:CKe(t,l+1);continue}if(n!==!1&&l===r){if(f=t.indexOf(c,l+1),f===-1)break;h=d_.trim(t.slice(r+1,f)),o(n,h),n=!1,l=f,i=l+1;continue}if(/\s|\n|\t/.test(c))if(t=t.replace(/\s|\n|\t/g," "),n===!1)if(f=$Ke(t,l),f===-1){h=d_.trim(t.slice(i,l)),o(h),n=!1,i=l+1;continue}else{l=f-1;continue}else if(f=MKe(t,l-1),f===-1){h=d_.trim(t.slice(i,l)),h=Pde(h),o(n,h),n=!1,i=l+1;continue}else continue}return i<t.length&&(n===!1?o(t.slice(i)):o(n,Pde(d_.trim(t.slice(i))))),d_.trim(s.join(" "))}function $Ke(t,e){for(;e<t.length;e++){var i=t[e];if(i!==" ")return i==="="?e:-1}}function CKe(t,e){for(;e<t.length;e++){var i=t[e];if(i!==" ")return i==="'"||i==='"'?e:-1}}function MKe(t,e){for(;e>0;e--){var i=t[e];if(i!==" ")return i==="="?e:-1}}function EKe(t){return t[0]==='"'&&t[t.length-1]==='"'||t[0]==="'"&&t[t.length-1]==="'"}function Pde(t){return EKe(t)?t.substr(1,t.length-2):t}WU.parseTag=xKe;WU.parseAttr=TKe;var AKe=mte.FilterCSS,jd=fn,q$e=WU,OKe=q$e.parseTag,PKe=q$e.parseAttr,yz=gte;function E5(t){return t==null}function RKe(t){var e=yz.spaceIndex(t);if(e===-1)return{html:"",closing:t[t.length-2]==="/"};t=yz.trim(t.slice(e+1,-1));var i=t[t.length-1]==="/";return i&&(t=yz.trim(t.slice(0,-1))),{html:t,closing:i}}function DKe(t){var e={};for(var i in t)e[i]=t[i];return e}function IKe(t){var e={};for(var i in t)Array.isArray(t[i])?e[i.toLowerCase()]=t[i].map(function(r){return r.toLowerCase()}):e[i.toLowerCase()]=t[i];return e}function G$e(t){t=DKe(t||{}),t.stripIgnoreTag&&(t.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),t.onIgnoreTag=jd.onIgnoreTagStripAll),t.whiteList||t.allowList?t.whiteList=IKe(t.whiteList||t.allowList):t.whiteList=jd.whiteList,t.onTag=t.onTag||jd.onTag,t.onTagAttr=t.onTagAttr||jd.onTagAttr,t.onIgnoreTag=t.onIgnoreTag||jd.onIgnoreTag,t.onIgnoreTagAttr=t.onIgnoreTagAttr||jd.onIgnoreTagAttr,t.safeAttrValue=t.safeAttrValue||jd.safeAttrValue,t.escapeHtml=t.escapeHtml||jd.escapeHtml,this.options=t,t.css===!1?this.cssFilter=!1:(t.css=t.css||{},this.cssFilter=new AKe(t.css))}G$e.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,i=e.options,r=i.whiteList,s=i.onTag,n=i.onIgnoreTag,a=i.onTagAttr,o=i.onIgnoreTagAttr,l=i.safeAttrValue,c=i.escapeHtml,h=e.cssFilter;i.stripBlankChar&&(t=jd.stripBlankChar(t)),i.allowCommentTag||(t=jd.stripCommentTag(t));var f=!1;i.stripIgnoreTagBody&&(f=jd.StripTagBody(i.stripIgnoreTagBody,n),n=f.onIgnoreTag);var y=OKe(t,function(_,w,x,S,$){var A={sourcePosition:_,position:w,isClosing:$,isWhite:Object.prototype.hasOwnProperty.call(r,x)},M=s(x,S,A);if(!E5(M))return M;if(A.isWhite){if(A.isClosing)return"</"+x+">";var P=RKe(S),O=r[x],D=PKe(P.html,function(L,F){var U=yz.indexOf(O,L)!==-1,N=a(x,L,F,U);return E5(N)?U?(F=l(x,L,F,h),F?L+'="'+F+'"':L):(N=o(x,L,F,U),E5(N)?void 0:N):N});return S="<"+x,D&&(S+=" "+D),P.closing&&(S+=" /"),S+=">",S}else return M=n(x,S,A),E5(M)?c(S):M},c);return f&&(y=f.remove(y)),y};var LKe=G$e;(function(t,e){var i=fn,r=WU,s=LKe;function n(o,l){var c=new s(l);return c.process(o)}e=t.exports=n,e.filterXSS=n,e.FilterXSS=s,(function(){for(var o in i)e[o]=i[o];for(var l in r)e[l]=r[l]})();function a(){return typeof self<"u"&&typeof DedicatedWorkerGlobalScope<"u"&&self instanceof DedicatedWorkerGlobalScope}a()&&(self.filterXSS=t.exports)})(bZ,bZ.exports);var hS=bZ.exports,kKe=function(t){if(typeof t!="object"||t===null||Object.prototype.toString.call(t)!=="[object Object]")return!1;var e=Object.getPrototypeOf(t);if(e===null)return!0;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},H$e=(function(){function t(e,i){var r=this;this.arcgisWhiteList={a:["href","style","target"],abbr:["title"],article:["style"],aside:["style"],audio:["autoplay","controls","loop","muted","preload"],b:[],blockquote:["style"],br:[],code:["style"],dd:["style"],del:["style"],details:["open","style"],div:["align","aria-hidden","aria-label","style"],dl:["style"],dt:["style"],em:[],figcaption:["style"],figure:["style"],font:["color","face","size","style"],footer:["style"],h1:["style"],h2:["style"],h3:["style"],h4:["style"],h5:["style"],h6:["style"],header:["style"],hr:[],i:[],img:["alt","border","height","src","style","width"],li:[],main:["style"],mark:["style"],nav:["style"],ol:[],p:["style"],pre:["style"],section:["style"],source:["media","src","type"],span:["aria-hidden","aria-label","style"],strong:[],sub:["style"],summary:["style"],sup:["style"],table:["border","cellpadding","cellspacing","height","style","width"],tbody:[],tr:["align","height","style","valign"],td:["align","colspan","height","nowrap","rowspan","style","valign","width"],th:["align","colspan","height","nowrap","rowspan","style","valign","width"],time:["style"],u:[],ul:[],video:["autoplay","controls","height","loop","muted","poster","preload","width"]},this.arcgisCSSWhiteList=_6(_6({},hS.getDefaultCSSWhiteList()),{"align-items":!0,"align-self":!0,flex:!0,"flex-basis":!0,"flex-direction":!0,"flex-flow":!0,"flex-grow":!0,"flex-shrink":!0,"flex-wrap":!0,float:!0,gap:!0,grid:!0,"grid-area":!0,"grid-auto-columns":!0,"grid-auto-flow":!0,"grid-auto-rows":!0,"grid-column":!0,"grid-column-end":!0,"grid-column-start":!0,"grid-row":!0,"grid-row-end":!0,"grid-row-start":!0,"grid-template":!0,"grid-template-areas":!0,"grid-template-columns":!0,"grid-template-rows":!0,"justify-content":!0,"justify-items":!0,"justify-self":!0,"line-height":!0,overflow:!0}),this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","arcgis-quickcapture","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(n,a,o,l){return n==="a"&&a==="href"||(n==="img"||n==="source")&&a==="src"?r.sanitizeUrl(o):hS.safeAttrValue(n,a,o,l)}},this._entityMap={"&":"&#x38;","<":"&#x3C;",">":"&#x3E;",'"':"&#x22;","'":"&#x27;","/":"&#x2F;"};var s;e&&!i?s=e:e&&i?(s=Object.create(this.arcgisFilterOptions),s.css={whiteList:this.arcgisCSSWhiteList},Object.keys(e).forEach(function(n){if(n==="whiteList")s.whiteList=r._extendObjectOfArrays([r.arcgisWhiteList,e.whiteList||{}]);else if(n==="css"){var a=e.css.whiteList;a!=null&&e.css instanceof Object&&Object.keys(a).forEach(function(o){return s.css.whiteList[o]=a[o]})}else s[n]=e[n]})):(s=Object.create(this.arcgisFilterOptions),s.whiteList=this.arcgisWhiteList,s.css={whiteList:this.arcgisCSSWhiteList}),this.xssFilterOptions=s,this._xssFilter=new hS.FilterXSS(s)}return t.prototype.sanitize=function(e,i){switch(i===void 0&&(i={}),typeof e){case"number":return isNaN(e)||!isFinite(e)?null:e;case"boolean":return e;case"string":return this._xssFilter.process(e);case"object":return this._iterateOverObject(e,i);default:return i.allowUndefined&&typeof e>"u"?void 0:null}},t.prototype.sanitizeUrl=function(e,i){var r=(i??{}).isProtocolRequired,s=r===void 0?!0:r,n=this._trim(e.substring(0,e.indexOf(":"))),a=e==="/",o=/^#/.test(e),l=n&&this.allowedProtocols.indexOf(n.toLowerCase())>-1;return a||o||l?hS.escapeAttrValue(e):!n&&!s?hS.escapeAttrValue("https://".concat(e)):""},t.prototype.sanitizeHTMLAttribute=function(e,i,r,s){return typeof this.xssFilterOptions.safeAttrValue=="function"?this.xssFilterOptions.safeAttrValue(e,i,r,s):hS.safeAttrValue(e,i,r,s)},t.prototype.validate=function(e,i){i===void 0&&(i={});var r=this.sanitize(e,i);return{isValid:e===r,sanitized:r}},t.prototype.encodeHTML=function(e){var i=this;return String(e).replace(/[&<>"'\/]/g,function(r){return i._entityMap[r]})},t.prototype.encodeAttrValue=function(e){var i=/^[a-zA-Z0-9]$/;return String(e).replace(/[\x00-\xFF]/g,function(r,s){return i.test(r)?r:"&#x".concat(Number(e.charCodeAt(s)).toString(16),";")})},t.prototype._extendObjectOfArrays=function(e){var i={};return e.forEach(function(r){Object.keys(r).forEach(function(s){Array.isArray(r[s])&&Array.isArray(i[s])?i[s]=i[s].concat(r[s]):i[s]=r[s]})}),i},t.prototype._iterateOverObject=function(e,i){var r=this;i===void 0&&(i={});try{var s=!1,n=void 0;if(Array.isArray(e))n=e.reduce(function(o,l){var c=r.validate(l,i);return c.isValid?o.concat([l]):(s=!0,o.concat([c.sanitized]))},[]);else if(kKe(e)){var a=Object.keys(e);n=a.reduce(function(o,l){var c=e[l],h=r.validate(c,i);return h.isValid?o[l]=c:(s=!0,o[l]=h.sanitized),o},{})}else return i.allowUndefined&&typeof e>"u"?void 0:null;return s?n:e}catch{return null}},t.prototype._trim=function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},t})();const zKe=["dd","dl","dt","h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"],FKe=zKe.reduce((t,e)=>(t[e]=[],t),{}),NKe=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","d","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],W$e=new H$e({whiteList:FKe,onTagAttr:(t,e,i)=>{const r=`${e}="${i}"`;if(NKe.includes(e))return r},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0),XVt=new H$e({whiteList:{br:[]},stripIgnoreTag:!0,escapeHtml:t=>t},!1),Z$e="http://www.w3.org/",ZU=`${Z$e}2000/svg`,Y$e=`${Z$e}1999/xlink`;let Rde=[],yte=(t,e)=>{let i={};return Object.keys(t).forEach(r=>{i[r]=t[r]}),e&&Object.keys(e).forEach(r=>{i[r]=e[r]}),i},_te=(t,e)=>t.vnodeSelector===e.vnodeSelector&&(t.properties&&e.properties?t.properties.key===e.properties.key&&t.properties.bind===e.properties.bind:!t.properties&&!e.properties),Q$e=t=>{if(typeof t!="string")throw new Error("Style values must be strings")},VKe=(t,e,i)=>{if(e.vnodeSelector!==""){for(let r=i;r<t.length;r++)if(_te(t[r],e))return r}return-1},b7=(t,e,i,r)=>{let s=t[e];if(s.vnodeSelector==="")return;let n=s.properties;if(!(n&&(n.key===void 0?n.bind:n.key))){for(let a=0;a<t.length;a++)if(a!==e){let o=t[a];if(_te(o,s))throw new Error(`${i.vnodeSelector} had a ${s.vnodeSelector} child ${r==="added"?r:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}}},UKe=t=>{if(t.properties){let e=t.properties.enterAnimation;e&&e(t.domNode,t.properties)}},xZ=[],SZ=!1,X$e=t=>{(t.children||[]).forEach(X$e),t.properties&&t.properties.afterRemoved&&t.properties.afterRemoved.apply(t.properties.bind||t.properties,[t.domNode])},Dde=()=>{SZ=!1,xZ.forEach(X$e),xZ.length=0},Ide=t=>{xZ.push(t),SZ||(SZ=!0,typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(Dde,{timeout:16}):setTimeout(Dde,16))},Lde=t=>{let e=t.domNode;if(t.properties){let i=t.properties.exitAnimation;if(i)return e.style.pointerEvents="none",void i(e,()=>{e.parentNode&&(e.parentNode.removeChild(e),Ide(t))},t.properties)}e.parentNode&&(e.parentNode.removeChild(e),Ide(t))},BKe=(t,e,i)=>{if(!e)return;let r=i.eventHandlerInterceptor,s=Object.keys(e),n=s.length;for(let a=0;a<n;a++){let o=s[a],l=e[o];if(o==="className")throw new Error('Property "className" is not supported, use "class".');if(o==="class")$Z(t,l,!0);else if(o==="classes"){let c=Object.keys(l),h=c.length;for(let f=0;f<h;f++){let y=c[f];l[y]&&t.classList.add(y)}}else if(o==="styles"){let c=Object.keys(l),h=c.length;for(let f=0;f<h;f++){let y=c[f],_=l[y];_&&(Q$e(_),i.styleApplyer(t,y,_))}}else if(o!=="key"&&l!=null){let c=typeof l;c==="function"?(o.lastIndexOf("on",0)===0&&(r&&(l=r(o,l,t,e)),o==="oninput"&&(function(){let h=l;l=function(f){h.apply(this,[f]),f.target["oninput-value"]=f.target.value}})()),t[o]=l):i.namespace===ZU?o==="href"?t.setAttributeNS(Y$e,o,l):t.setAttribute(o,l):c==="string"&&o!=="value"?o==="innerHTML"?t[o]=W$e.sanitize(l):TZ(t)&&o in t?t[o]=l:t.setAttribute(o,l):t[o]=l}}};function TZ(t){if(!(t instanceof Element&&t.tagName.includes("-")))return!1;const e=window.customElements.get(t.tagName.toLowerCase());return!!e&&t instanceof e}let b6,jKe=(t,e,i)=>{if(e)for(let r of e)FP(r,t,void 0,i)},J$e=(t,e,i)=>{jKe(t,e.children,i),e.text&&(t.textContent=e.text),BKe(t,e.properties,i),e.properties&&e.properties.afterCreate&&e.properties.afterCreate.apply(e.properties.bind||e.properties,[t,i,e.vnodeSelector,e.properties,e.children])},FP=(t,e,i,r)=>{let s,n=0,a=t.vnodeSelector,o=e.ownerDocument;if(a==="")s=t.domNode=o.createTextNode(t.text),i!==void 0?e.insertBefore(s,i):e.appendChild(s);else{for(let l=0;l<=a.length;++l){let c=a.charAt(l);if(l===a.length||c==="."||c==="#"){let h=a.charAt(n-1),f=a.slice(n,l);h==="."?s.classList.add(f):h==="#"?s.id=f:(f==="svg"&&(r=yte(r,{namespace:ZU})),r.namespace!==void 0?s=t.domNode=o.createElementNS(r.namespace,f):(s=t.domNode=t.domNode||o.createElement(f),f==="input"&&t.properties&&t.properties.type!==void 0&&s.setAttribute("type",t.properties.type)),i!==void 0?e.insertBefore(s,i):s.parentNode!==e&&e.appendChild(s)),n=l+1}}J$e(s,t,r)}},$Z=(t,e,i)=>{e&&e.split(" ").forEach(r=>{r&&t.classList.toggle(r,i)})},qKe=(t,e,i,r)=>{if(!i)return;let s=!1,n=Object.keys(i),a=n.length;for(let o=0;o<a;o++){let l=n[o],c=i[l],h=e[l];if(l==="class")h!==c&&($Z(t,h,!1),$Z(t,c,!0));else if(l==="classes"){let f=t.classList,y=Object.keys(c),_=y.length;for(let w=0;w<_;w++){let x=y[w],S=!!c[x];S!==!!h[x]&&(s=!0,S?f.add(x):f.remove(x))}}else if(l==="styles"){let f=Object.keys(c),y=f.length;for(let _=0;_<y;_++){let w=f[_],x=c[w];x!==h[w]&&(s=!0,x?(Q$e(x),r.styleApplyer(t,w,x)):r.styleApplyer(t,w,""))}}else if(c||typeof h!="string"||(c=""),l!=="value"||TZ(t)){if(c!==h){let f=typeof c;f==="function"&&r.eventHandlerInterceptor||(r.namespace===ZU?l==="href"?t.setAttributeNS(Y$e,l,c):t.setAttribute(l,c):f==="string"?l==="innerHTML"?t[l]=W$e.sanitize(c):l==="role"&&c===""?t.removeAttribute(l):TZ(t)&&l in t?t[l]=c:t.setAttribute(l,c):t[l]!==c&&(t[l]=c),s=!0)}}else{let f=t[l];f!==c&&(t["oninput-value"]?f===t["oninput-value"]:c!==h)&&(t[l]=c,t["oninput-value"]=void 0),c!==h&&(s=!0)}}return s},GKe=(t,e,i,r,s)=>{if(i===r)return!1;r=r||Rde;let n,a=(i=i||Rde).length,o=r.length,l=0,c=0,h=!1;for(;c<o;){let f=l<a?i[l]:void 0,y=r[c];if(f!==void 0&&_te(f,y))h=b6(f,y,s)||h,l++;else{let _=VKe(i,y,l+1);if(_>=0){for(n=l;n<_;n++)Lde(i[n]),b7(i,n,t,"removed");h=b6(i[_],y,s)||h,l=_+1}else FP(y,e,l<a?i[l].domNode:void 0,s),UKe(y),b7(r,c,t,"added")}c++}if(a>l)for(n=l;n<a;n++)Lde(i[n]),b7(i,n,t,"removed");return h};b6=(t,e,i)=>{let r=t.domNode,s=!1;if(t===e)return!1;let n=!1;if(e.vnodeSelector===""){if(e.text!==t.text){let a=r.ownerDocument.createTextNode(e.text);return r.parentNode.replaceChild(a,r),e.domNode=a,s=!0,s}e.domNode=r}else e.vnodeSelector.lastIndexOf("svg",0)===0&&(i=yte(i,{namespace:ZU})),t.text!==e.text&&(n=!0,e.text===void 0?r.removeChild(r.firstChild):r.textContent=e.text),e.domNode=r,n=GKe(e,r,t.children,e.children,i)||n,n=qKe(r,t.properties,e.properties,i)||n,e.properties&&e.properties.afterUpdate&&e.properties.afterUpdate.apply(e.properties.bind||e.properties,[r,i,e.vnodeSelector,e.properties,e.children]);return n&&e.properties&&e.properties.updateAnimation&&e.properties.updateAnimation(r,e.properties,t.properties),s};let A5=(t,e)=>({getLastRender:()=>t,update:i=>{if(t.vnodeSelector!==i.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let r=t;t=i,b6(r,i,e)},domNode:t.domNode});const HKe={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,i)=>{e.charAt(0)==="-"?t.style.setProperty(e,i):t.style[e]=i}};let sO=t=>yte(HKe,t),M_={append:(t,e,i)=>(i=sO(i),FP(e,t,void 0,i),A5(e,i)),insertBefore:(t,e,i)=>(i=sO(i),FP(e,t.parentNode,t,i),A5(e,i)),merge:(t,e,i)=>(i=sO(i),e.domNode=t,J$e(t,e,i),A5(e,i)),replace:(t,e,i)=>(i=sO(i),FP(e,t.parentNode,t,i),t.parentNode.removeChild(t),A5(e,i))},K$e,WKe=(t,e)=>{let i=[];for(;t&&t!==e;)i.push(t),t=t.parentNode;return i};K$e=Array.prototype.find?(t,e)=>t.find(e):(t,e)=>t.filter(e)[0];let ZKe=(t,e)=>{let i=t;return e.forEach(r=>{i=i&&i.children?K$e(i.children,s=>s.domNode===r):void 0}),i},YKe=(t,e,i)=>{let r=function(s){i("domEvent",s);let n=e(),a=WKe(s.currentTarget,n.domNode);a.reverse();let o,l=ZKe(n.getLastRender(),a);return t.scheduleRender(),l&&(o=l.properties[`on${s.type}`].apply(l.properties.bind||this,arguments)),i("domEventProcessed",s),o};return(s,n,a,o)=>r},kde=t=>{let e,i,r=sO(t),s=r.performanceLogger,n=!0,a=!1,o=[],l=[],c=(f,y,_)=>{let w,x=()=>w;r.eventHandlerInterceptor=YKe(e,x,s),w=f(y,_(),r),o.push(w),l.push(_)},h=()=>{if(i=void 0,n){n=!1,s("renderStart",void 0);for(let f=0;f<o.length;f++){let y=l[f]();s("rendered",void 0),o[f].update(y),s("patched",void 0)}s("renderDone",void 0),n=!0}};return e={renderNow:h,scheduleRender:()=>{i||a||(i=requestAnimationFrame(h))},stop:()=>{i&&(cancelAnimationFrame(i),i=void 0),a=!0},resume:()=>{a=!1,n=!0,e.scheduleRender()},append:(f,y)=>{c(M_.append,f,y)},insertBefore:(f,y)=>{c(M_.insertBefore,f,y)},merge:(f,y)=>{c(M_.merge,f,y)},replace:(f,y)=>{c(M_.replace,f,y)},detach:f=>{for(let y=0;y<l.length;y++)if(l[y]===f)return l.splice(y,1),o.splice(y,1)[0];throw new Error("renderFunction was not found")}},e},j0=class extends Me{constructor(){super(...arguments),this.items=new He,this._watchUpdatingTracking=new mp,this._callbacks=new Map,this._projector=kde(),this._hiddenProjector=kde()}get needsRender(){return this.items.length>0}get updating(){return this._watchUpdatingTracking?.updating??!1}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,i=>{for(const r of i.added){const s=()=>r.render();this._callbacks.set(r,s),this._projector.append(this.surface,s)}for(const r of i.removed){const s=this._projector.detach(this._callbacks.get(r));this.surface.removeChild(s.domNode),this._callbacks.delete(r)}})}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach(e=>this._projector.detach(e)),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const i=this._hiddenSurface,r=this._hiddenProjector;let s;const n=()=>(s=e.render(),s);r.append(i,n),r.renderNow();const a={left:0,top:0,right:0,bottom:0};if(s?.domNode){const o=s.domNode.getBoundingClientRect();a.left=o.left,a.top=o.top,a.right=o.right,a.bottom=o.bottom}for(r.detach(n);i.firstChild;)i.removeChild(i.firstChild);return a}overlaps(e,i){const r=this.computeBoundingRect(e),s=this.computeBoundingRect(i);return Math.max(r.left,s.left)<=Math.min(r.right,s.right)&&Math.max(r.top,s.top)<=Math.min(r.bottom,s.bottom)}get hasVisibleItems(){return this.items.some(e=>e.visible)}async prepare(){await document.fonts.load(this._fontString()).catch(()=>{})}renderCanvas(e,i){const r=!!i?.disableDecorations;if(!this.items.some(n=>n.visible&&!(r&&n.isDecoration)))return;const s=e.getContext("2d");s.save(),s.font=this._fontString(),this.items.forEach(n=>{r&&n.isDecoration||(s.save(),n.renderCanvas(s),s.restore())}),s.restore()}_fontString(){return`10px ${getComputedStyle(this.surface).fontFamily}`}};d([m({readOnly:!0})],j0.prototype,"surface",void 0),d([m({readOnly:!0})],j0.prototype,"items",void 0),d([m({readOnly:!0})],j0.prototype,"needsRender",null),d([m({readOnly:!0})],j0.prototype,"_watchUpdatingTracking",void 0),d([m({readOnly:!0})],j0.prototype,"updating",null),j0=d([k("esri.views.overlay.ViewOverlay")],j0);const zde=j0,w7=[0,0];function QKe(t){const e=(t.ownerDocument||window.document).defaultView,i=t.getBoundingClientRect();return w7[0]=i.left+(e?.pageXOffset??0),w7[1]=i.top+(e?.pageYOffset??0),w7}function Fde(t){t&&(t.textContent="",t.parentNode&&t.parentNode.removeChild(t))}function XKe(t){const e=document.createElement("div");return t.appendChild(e),e}const dS=16,UE=750,JKe=512,KKe=2,eet=t=>{const e=t;let i=class extends e{constructor(...r){super(...r),this._freqInfo={freq:dS,time:UE},this._overlayRenderTaskHandle=null,this.aria={},this.height=0,this.messagesCommon=null,this.overlay=null,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.addHandles([K(()=>this.cursor,s=>{const{surface:n}=this;n&&n.setAttribute("data-cursor",s)}),K(()=>this.navigating,s=>{const{surface:n}=this;n&&n.setAttribute("data-navigating",s.toString())}),K(()=>[this.aria,this.surface],()=>this._updateAria(),{initial:!0})])}initialize(){const r=this;this.addHandles([K(()=>this.ui,(s,n)=>this._handleUIChange(s,n),Wt),r.on("focus",()=>this.notifyChange("focused")),r.on("blur",()=>this.notifyChange("focused"))])}destroy(){this.destroyed||(this.ui?.destroy(),this.container=null)}get container(){return this._get("container")??null}set container(r){const s=this._get("container"),n=$U(r);if(n||typeof r!="string"||fe.getLogger(this).error("#container",`element with id '${r}' not found`),s===n)return;if(this._stopMeasuring(),s&&(s.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(Fde(this.root),this._set("root",null)),this.userContent&&(the(this.userContent,s),Fde(this.userContent),this._set("userContent",null))),!n)return this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),void this._set("container",null);n.classList.add("esri-view");const a=document.createElement("div");a.className="esri-view-user-storage",the(n,a),n.appendChild(a),this._set("userContent",a);const o=document.createElement("div");o.className="esri-view-root",n.insertBefore(o,n.firstChild),this._set("root",o);const l=document.createElement("div");l.className="esri-view-surface",l.setAttribute("role","application"),l.tabIndex=0,o.appendChild(l),this._set("surface",l);const c=new zde;o.appendChild(c.surface),this._set("overlay",c),this.addHandles(K(()=>c.needsRender,h=>{h&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=Rx({render:()=>this.overlay?.render()}):this._overlayRenderTaskHandle=Ki(this._overlayRenderTaskHandle)})),this.forceDOMReadyCycle(),this._set("container",n),this._startMeasuring()}get focused(){const r=document.activeElement===this.surface;return document.hasFocus()&&r}get size(){return[this.width,this.height]}set ui(r){const s=this._get("ui");s!==r&&s?.destroy(),this._set("ui",r)}blur(){this.surface?.blur()}focus(){this.surface?.focus()}pageToContainer(r,s,n){const a=this.position;return r-=a?a[0]:0,s-=a?a[1]:0,n?(n[0]=r,n[1]=s):n=[r,s],n}containerToPage(r,s,n){const a=this.position;return r+=a?a[0]:0,s+=a?a[1]:0,n?(n[0]=r,n[1]=s):n=[r,s],n}_updateAria(){const{surface:r,aria:s}=this;r&&(r.ariaLabelledByElements=s?.labelledByElements??null,r.ariaDescribedByElements=s?.describedByElements??null,r.ariaLabel=s?.label??null,r.ariaDescription=s?.description??null)}_handleUIChange(r,s){this.removeHandles("ui"),s&&s!==r&&s.destroy(),r&&(r.view=this,this.addHandles(K(()=>this.root,n=>{r.container=n?XKe(n):null},Wt),"ui")),this._set("ui",r)}_stopMeasuring(){this.removeHandles("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const r=this._freqInfo;r.freq=dS,r.time=UE;const s=Rx({prepare:o=>{const l=this._measure(),c=this._freqInfo;if(c.time+=o.deltaTime,l&&(c.freq=dS,this._get("resizing")||this._set("resizing",!0)),c.time<c.freq)return;c.time=0;const h=this._position();c.freq=h||l?dS:Math.min(UE,c.freq*KKe),!l&&c.freq>=JKe&&(s.pause(),this._get("resizing")&&this._set("resizing",!1))}}),n=new ResizeObserver(o=>{r.freq=dS,r.time=UE,s.resume()});this.container!=null&&n.observe(this.container);const a=ci(()=>n.disconnect());this.addHandles([aM(window,"resize",()=>{r.freq=dS,r.time=UE,s.resume()}),a,s],"measuring"),this._measure(),this._position()}_measure(){const r=this.container,s=r?r.clientWidth:0,n=r?r.clientHeight:0;if(s===0||n===0)return this.suspended||this._set("suspended",!0),!1;const a=this.width,o=this.height;return s===a&&n===o?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",s),this._set("height",n),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:a,oldHeight:o,width:s,height:n}),!0)}_position(){const r=this.container,s=this.position,n=r&&QKe(r);return!!n&&(!s||n[0]!==s[0]||n[1]!==s[1])&&(this._set("position",[n[0],n[1]]),!0)}forceDOMReadyCycle(){}};return d([m()],i.prototype,"aria",void 0),d([m()],i.prototype,"container",null),d([m({readOnly:!0})],i.prototype,"focused",null),d([m({readOnly:!0})],i.prototype,"height",void 0),d([m()],i.prototype,"messagesCommon",void 0),d([m({type:zde})],i.prototype,"overlay",void 0),d([m({readOnly:!0})],i.prototype,"position",void 0),d([m({readOnly:!0})],i.prototype,"resizing",void 0),d([m({readOnly:!0})],i.prototype,"root",void 0),d([m({value:null,readOnly:!0})],i.prototype,"size",null),d([m({readOnly:!0})],i.prototype,"surface",void 0),d([m({readOnly:!0})],i.prototype,"suspended",void 0),d([m({nonNullable:!0})],i.prototype,"ui",null),d([m({readOnly:!0})],i.prototype,"userContent",void 0),d([m({readOnly:!0})],i.prototype,"width",void 0),d([m()],i.prototype,"widthBreakpoint",void 0),i=d([k("esri.views.DOMContainer")],i),i};function vte(t,e,i){return tU(t.map((r,s)=>e.apply(i,[r,s])))}async function tet(t,e,i){return(await tU(t.map((r,s)=>e.apply(i,[r,s])))).map(r=>r.value)}function bte(t){return{ok:!0,value:t}}function wte(t){return{ok:!1,error:t}}function iet(t){return t!=null&&t.ok===!0?t.value:null}function ret(t){return t!=null&&t.ok===!1?t.error:null}async function Xf(t){if(t==null)return{ok:!1,error:new Error("no promise provided")};try{return bte(await t)}catch(e){return wte(e)}}async function KVt(t){try{return bte(await t)}catch(e){return My(e),wte(e)}}function eUt(t){if(t.ok===!0)return t.value;throw t.error}function Bc(t,e){return new q0(t,e)}let q0=class extends Me{get value(){return iet(this._result)}get error(){return ret(this._result)}get finished(){return this._result!=null}constructor(e,i){super({}),this._result=null,this._abortHandle=null,this.abort=()=>{this._abortController=ps(this._abortController)},this.remove=this.abort,this._abortController=new AbortController;const{signal:r}=this._abortController;this.promise=e(r),this.promise.then(s=>{this._result=bte(s),this._cleanup()},s=>{this._result=wte(s),this._cleanup()}),this._abortHandle=qa(i,this.abort)}normalizeCtorArgs(){return{}}destroy(){this.abort()}_cleanup(){this._abortHandle=Ki(this._abortHandle),this._abortController=null}};d([m()],q0.prototype,"value",null),d([m()],q0.prototype,"error",null),d([m()],q0.prototype,"finished",null),d([m()],q0.prototype,"promise",void 0),d([m()],q0.prototype,"_result",void 0),q0=d([k("esri.core.asyncUtils.ReactiveTask")],q0);const O5="popup",Nde="manual";function jf(t){return t!=null&&"open"in t&&"declaredClass"in t}function yy(t){return!!t&&t.tagName.toLowerCase()==="arcgis-popup"&&"open"in t}function set(t,e,i){const[r,s,n]=e;if(i){const[a,o,l]=i;a&&jf(o)&&(o.view=null,a.remove(o,O5),o!==s&&s&&o.destroy()),a&&l&&yy(l)&&(l.view=null,a.remove(l,O5),l!==n&&n&&l.remove())}r&&jf(s)&&(s.view=t,r.add(s,{key:O5,position:Nde,internal:!0})),r&&n&&yy(n)&&(n.view=t,r.add(n,{key:O5,position:Nde,internal:!0}))}async function net(t,e){const{popup:i,popupElement:r}=t;jf(i)?await P5(i,null,e):r&&yy(r)?await P5(null,r,e):e?.defer(async()=>{await t.setupPopup();const{popup:s,popupElement:n}=t;jf(s)&&!t.destroyed&&t.ready&&t.popupEnabled?await P5(s,null,e):n&&yy(n)&&await P5(null,n,e)})}function aet(t,e){const{popup:i,popupElement:r}=t;if(jf(i))return i.open(e);r&&yy(r)&&r.open(e)}function oet(t,e){jf(t)&&t.close(),e&&yy(e)&&(e.visible=!1)}async function P5(t,e,i){if(jf(t)){const r=await t.viewModel.handleViewClick(i);return void(r?.promises?.length?t.open(r):t.visible&&t.close())}if(e&&yy(e)){const r=await e.handleViewClick(i);r?.promises?.length?e.open(r):e.visible&&(e.visible=!1)}}const eCe=ie("mac")?"Meta":"Control",cet=new Set(["Alt","Control","Meta","Shift","Ctrl","Primary"]),uet=t=>cet.has(t);let het=class{constructor(e,i=[]){this.eventType=e,this.keyModifiers=i}matches(e){if(e.type!==this.eventType)return!1;if(this.keyModifiers.length===0)return!0;const i=e.modifiers;for(const r of this.keyModifiers)if(!i.has(r))return!1;return!0}},ho=class{constructor(e){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=e}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const e in this._incoming){const i=this._incoming[e];for(const r of i)this._incomingEventMatches.push(r.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(e=>e.eventType)),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(e){this._manager||(e.setEventCallback(i=>this._handleEvent(i)),e.setUninstallCallback(()=>this._onUninstall()),this._manager=e)}onUninstall(){}registerIncoming(e,i,r){let s;typeof i=="function"?(r=i,s=[]):s=i||[];const n=typeof e=="string"?new het(e,s):e,a=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},o=h=>{const f=this._incoming[h.match.eventType];if(f){const y=f.indexOf(h);f.splice(y,1),a(),this._manager&&this._manager.updateDependencies()}},l=new det(n,r,{onPause:o,onRemove:o,onResume:h=>{const f=this._incoming[h.match.eventType];f&&!f.includes(h)&&(f.push(h),a(),this._manager&&this._manager.updateDependencies())}});let c=this._incoming[n.eventType];return c||(c=[],this._incoming[n.eventType]=c),c.push(l),a(),this._manager&&this._manager.updateDependencies(),l}registerOutgoing(e){if(this._outgoing[e])throw new Error("There is already a callback registered for this outgoing InputEvent: "+e);const i=new pet(e,{onEmit:(r,s,n,a)=>{this._manager?.emit(r.eventType,s,n,a)},onRemove:r=>{delete this._outgoing[r.eventType],this._manager?.updateDependencies()}});return this._outgoing[e]=i,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),i}startCapturingPointer(e){this._manager?.setPointerCapture(e,!0)}stopCapturingPointer(e){this._manager?.setPointerCapture(e,!1)}refreshHasPendingInputs(){this._manager?.refreshHasPendingInputs()}_onUninstall(){this._manager&&(this.onUninstall(),this._manager=null)}_handleEvent(e){const i=this._incoming[e.type];if(i){for(const r of i)if(r.match.matches(e)&&(r.callback?.(e),e.shouldStopPropagation()))break}}},det=class{constructor(e,i,r){this.match=e,this._callback=i,this._handler=r}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}},pet=class{constructor(e,i){this.eventType=e,this._removed=!1,this._handler=i}emit(e,i,r){this._removed||this._handler.onEmit(this,e,i,r)}remove(){this._removed=!0,this._handler.onRemove(this)}},fet=class extends ho{constructor(e){super(!0),this._onChange=e,this._value="mouse",this._x=null,this._y=null,this._id=null,this.registerIncoming("pointer-move",i=>this._update(i.data))}_update(e){const i=e.native.pointerType==="touch"?"touch":"mouse",{x:r,y:s,native:{pointerId:n}}=e;i===this._value&&this._x===r&&this._y===s&&this._id===n||(this._value=i,this._x=r,this._y=s,this._id=n,this._onChange(n,i,r,s))}},met=class extends ho{get multiTouchActive(){return this._multiTouchActive.value}constructor(){super(!0),this._activeTouchPointerIds=new Set,this._multiTouchActive=Pn(!1),this._onPointerAdd=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.add(e.native.pointerId),this._update())},this._onPointerRemove=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.delete(e.native.pointerId),this._update())},this.registerIncoming("pointer-down",this._onPointerAdd),this.registerIncoming("pointer-up",this._onPointerRemove),this.registerIncoming("pointer-capture-lost",this._onPointerRemove),this.registerIncoming("pointer-cancel",this._onPointerRemove)}_update(){this._multiTouchActive.value=this._activeTouchPointerIds.size>1}},_y=class{constructor(e,i){this._owner=i,this._properties={},this._afterDispatchHandle=null;for(const r in e){const s=e[r],n=new ywe(s,void 0,void 0,2,2);this._properties[r]={pool:n,acquired:[]}}this._afterDispatchHandle=Rwe(()=>this._release())}destroy(){this._afterDispatchHandle&&(this._afterDispatchHandle.remove(),this._afterDispatchHandle=null);for(const e in this._properties){const i=this._properties[e];for(const r of i.acquired)oue(r)||i.pool.release(r);i.pool.destroy(),i.pool=null,i.acquired=null}this._properties=null,this._owner=null}get(e){const i=this._owner._get(e),r=this._properties[e];let s=r.pool.acquire();for(r.acquired.push(s);s===i;)s=r.pool.acquire(),r.acquired.push(s);return Pwe(),s}_release(){for(const e in this._properties){const i=this._properties[e];let r=0;for(const s of i.acquired)oue(s)?i.acquired[r++]=s:i.pool.release(s);i.acquired.length=r}}},get=class{constructor(){this.id=0,this.type="mouse",this.location=Zl()}},Od=class extends Me{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._handlersPriority=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=eCe,this._propertiesPool=new _y({latestPointerInfo:()=>new get},this),this._latestPointerInfo=void 0,this._paused=!1,this._testTimestamp=void 0}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const i of e)this.uninstallHandlers(i);this.eventSource.destroy(),this._currentPropagation=null,this._propertiesPool.destroy()}get hasPendingInputs(){return this._handlers.some(e=>e.handler.hasPendingInputs)}get multiTouchActive(){return this._multiTouchHandler.multiTouchActive}get latestPointerInfo(){return this._latestPointerInfo}get updating(){return this.hasPendingInputs||this._paused}installHandlers(e,i,r=Br.INTERNAL){if(this._nameToGroup[e]||i.length===0)return;const s={name:e,handlers:i.map(n=>({handler:n,active:!0,removed:!1,priorityIndex:0,groupPriority:r,eventCallback:null,uninstallCallback:null}))};this._nameToGroup[e]=s;for(let n=s.handlers.length-1;n>=0;n--){const a=s.handlers[n];this._handlers.push(a),a.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(o,l,c,h,f)=>{this._emitInputEvent(a.priorityIndex+1,o,l,c,f,h)},setPointerCapture:(o,l)=>{this._setPointerCapture(s,a,o,l)},setEventCallback:o=>{a.eventCallback=o},setUninstallCallback:o=>{a.uninstallCallback=o},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const i=this._nameToGroup[e];i?(i.handlers.forEach(r=>{r.removed=!0,r.uninstallCallback?.()}),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):fe.getLogger(this).error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return this._nameToGroup[e]!==void 0}isModifierKeyDown(e){return this._activeKeyModifiers.has(e)}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const e=new Set,i=new Set;this._handlersPriority=[];for(let r=this._handlers.length-1;r>=0;r--){const s=this._handlers[r];s.priorityIndex=r,this._handlersPriority.push(s)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let r=this._handlersPriority.length-1;r>=0;r--){const s=this._handlersPriority[r];s.priorityIndex=r;let n=s.handler.hasSideEffects;if(!n){for(const a of s.handler.outgoingEventTypes)if(e.has(a)){n=!0;break}}if(n)for(const a of s.handler.incomingEventMatches){e.add(a.eventType);for(const o of a.keyModifiers)uet(o)||i.add(o)}s.active=n}this._sourceEvents=e,this._keyModifiers=i,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointer(e,i,r,s){const n=this._latestPointerInfo;if(n==null||n.id!==e||n.type!==i||n.location.x!==r||n.location.y!==s){const a=this._propertiesPool.get("latestPointerInfo");a.id=e,a.type=i,a.location.x=r,a.location.y=s,this._latestPointerInfo=a}}_onEventReceived(e,i){if(e==="pointer-capture-lost"){const n=i;this._pointerCaptures.delete(n.native.pointerId)}this._updateKeyModifiers(e,i);const r=this._testTimestamp??i.native?.timestamp,s=i.native?.cancelable;this._emitInputEventFromSource(e,i,r,s)}_updateKeyModifiers(e,i){if(!i)return;let r=!1;const s=()=>{r||(this._activeKeyModifiers=new Set(this._activeKeyModifiers),r=!0)},n=(o,l)=>{l&&!this._activeKeyModifiers.has(o)?(s(),this._activeKeyModifiers.add(o)):!l&&this._activeKeyModifiers.has(o)&&(s(),this._activeKeyModifiers.delete(o))};if(e==="key-down"||e==="key-up"){const o=i.key;this._keyModifiers.has(o)&&n(o,e==="key-down")}const a=i.native;n("Alt",!!a?.altKey),n("Control",!!a?.ctrlKey),n("Ctrl",!!a?.ctrlKey),n("Shift",!!a?.shiftKey),n("Meta",!!a?.metaKey),n("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerHandler=new fet((e,i,r,s)=>this._setLatestPointer(e,i,r,s)),this._multiTouchHandler=new met,this.installHandlers("input-manager-logic",[this._latestPointerHandler,this._multiTouchHandler],Br.ALWAYS),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,Br.INTERNAL)}_setPointerCapture(e,i,r,s){const n=e.name+"-"+i.priorityIndex,a=this._pointerCaptures.get(r.pointerId)||new Set;this._pointerCaptures.set(r.pointerId,a),s?(a.add(n),a.size===1&&this.eventSource&&this.eventSource.setPointerCapture(r,!0)):a.has(n)&&(a.delete(n),a.size===0&&(this._pointerCaptures.delete(r.pointerId),this.eventSource&&this.eventSource.setPointerCapture(r,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter(e=>!e.removed),this.updateDependencies()}_emitInputEventFromSource(e,i,r,s){this._emitInputEvent(0,e,i,r,s)}_emitInputEvent(e,i,r,s,n,a){const o=s??this._currentPropagation?.timestamp??performance.now(),l=n??!1,c={event:new yet(i,r,o,a||this._activeKeyModifiers,l),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(c):this._doNewPropagation(c)}_doNewPropagation(e){this._currentPropagation={events:new bC,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}_continuePropagation(){this._paused=!1;const e=this._currentPropagation;if(e){for(;e.events.length>0;){const{event:i,priorityIndex:r}=e.events.pop(),s=i.data?.eventId;if(!(s!=null&&this._stoppedPropagationEventIds.has(s)))for(e.currentHandler=this._handlersPriority[r];e.currentHandler;){if(e.currentHandler.removed)e.needsHandlerGarbageCollect=!0;else{if(e.currentHandler.active&&!i.shouldStopPropagation()&&e.currentHandler.eventCallback?.(i),i.shouldStopPropagation()){s!=null&&this._stoppedPropagationEventIds.add(s);break}if(i.shouldPausePropagation(()=>this._continuePropagation()))return void this._pausePropagation({event:i,priorityIndex:e.currentHandler.priorityIndex+1})}e.currentHandler=this._handlersPriority[e.currentHandler.priorityIndex+1]}}e.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}}_pausePropagation(e){const i=new bC;i.push(e);const r=this._currentPropagation;if(r){for(;r.events.length;)i.push(r.events.pop());r.events=i,r.currentHandler=null,this._paused=!0}}_compareHandlerPriority(e,i){if(e.handler.hasSideEffects!==i.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==i.groupPriority)return e.groupPriority>i.groupPriority?-1:1;for(const r of e.handler.incomingEventMatches)for(const s of i.handler.incomingEventMatches){if(r.eventType!==s.eventType)continue;const n=r.keyModifiers.filter(a=>s.keyModifiers.includes(a));if(n.length===r.keyModifiers.length!=(n.length===s.keyModifiers.length))return r.keyModifiers.length>s.keyModifiers.length?-1:1}return e.priorityIndex>i.priorityIndex?-1:1}_sortHandlersPriority(e){const i=[];for(const r of e){let s=0;for(;s<i.length&&this._compareHandlerPriority(r,i[s])>=0;)s++;i.splice(s,0,r)}return i}get test(){}};d([m({readOnly:!0})],Od.prototype,"hasPendingInputs",null),d([m({constructOnly:!0})],Od.prototype,"eventSource",void 0),d([m({constructOnly:!0})],Od.prototype,"recognizers",void 0),d([m()],Od.prototype,"multiTouchActive",null),d([m()],Od.prototype,"_latestPointerInfo",void 0),d([m()],Od.prototype,"latestPointerInfo",null),d([m()],Od.prototype,"_paused",void 0),d([m({readOnly:!0})],Od.prototype,"updating",null),Od=d([k("esri.views.input.InputManager")],Od);let yet=class{constructor(e,i,r,s,n){this.type=e,this.data=i,this.timestamp=r,this.modifiers=s,this.cancelable=n,this._propagationState=0,this._resumeCallback=null}stopPropagation(){this._propagationState|=1}shouldStopPropagation(){return!!(1&this._propagationState)}defer(e){this._propagationState|=2;const i=(r,s)=>{this._propagationState&=-3;const n=this._resumeCallback;if(this._resumeCallback=null,n&&n(),s)throw r;return r};return(typeof e=="function"?e():e).then(r=>i(r,!1),r=>i(r,!0))}shouldPausePropagation(e){return!!(2&this._propagationState)&&(this._resumeCallback=e,!0)}preventDefault(){this.data.native.preventDefault()}};const Br={ALWAYS:1,DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3},_et=t=>{const e=t;let i=class extends e{constructor(){super(...arguments),this._popupSetupTask=null,this.popup={},this.popupEnabled=!0}initialize(){this.addHandles([K(()=>[this.ui,this.popup,this.popupElement],([r,s,n],a)=>{const[o,l,c]=a??[];set(this,[r,s,n],[o,l,c])},At),this.on("click",r=>{this.popup&&this.popupEnabled&&(r.pointerType!=="mouse"||r.button===0)&&net(this,r)},Br.WIDGET)]),mv(()=>this.ready&&this.popupEnabled&&!this.updating).then(()=>te(()=>import("./Popup-mYMs8l3k.js").then(r=>r.P),__vite__mapDeps([120,121,122,123,103,98,47,81,74,99,100,101,57,25,102,18,124,5,125,126,127,54,96,97,49,4,128,38,36,37,39,129,130,131,132,133,134,135,136,137,138,139,140,141,66,142,143,144,145,146,147,148,149,150,151,152,153,154,155,95,156,157,158,159,160,161,162,163,164,165,166,167,168,48,169,170,171,56,55])))}destroy(){this.destroyed||this.closePopup()}async openPopup(r){if(jf(this.popup))return this.popup.open(r);if(this.popupElement&&yy(this.popupElement))this.popupElement.open(r).catch(()=>{});else try{if(await this.setupPopup(),!this.popup)return void fe.getLogger(this).error(new ee("view:null-popup","Popup is null and can't be opened"));aet(this,r)}catch{}}closePopup(){this._popupSetupTask?.abort(),oet(this.popup,this.popupElement)}async fetchPopupFeatures(r,s){return await this.when(),this._popupHitsToFeatures(await this._getPopupHits(r,s),s)}async setupPopup(){if(this._popupSetupTask?.abort(),this.popup&&!jf(this.popup))return this._popupSetupTask=Bc(async r=>{if(!this.popupEnabled||!yy(this.popupElement))if(this.dependencies.popup&&typeof this.dependencies.popup=="function")await this.dependencies.popup(),st(r),customElements.get("arcgis-popup")||fe.getLogger(this).error(new ee("view:undefined-popup-element","`arcgis-popup` custom element is undefined and can't be opened")),this.popupElement=document.createElement("arcgis-popup");else{const{default:s}=await te(()=>import("./Popup-mYMs8l3k.js").then(a=>a.P),__vite__mapDeps([120,121,122,123,103,98,47,81,74,99,100,101,57,25,102,18,124,5,125,126,127,54,96,97,49,4,128,38,36,37,39,129,130,131,132,133,134,135,136,137,138,139,140,141,66,142,143,144,145,146,147,148,149,150,151,152,153,154,155,95,156,157,158,159,160,161,162,163,164,165,166,167,168,48,169,170,171,56,55]));if(st(r),!this.popup||jf(this.popup))return;const n=this.popup;if("open"in n||"close"in n){const{open:a,close:o,...l}=n;this.popup=new s({...l})}else this.popup=new s(n)}}),this._popupSetupTask.promise}async _popupHitsToFeatures({location:r,hits:s},n){const a=[],o=[];let l=!1;const c=PBe(n,ie("popup-view-fetch-timeout")??bet),h=_=>{const w=new vet(_);return o.push(w),a.push(w.promise),w},f=_=>{const w=o.at(-1);return w&&w.layerView===_&&!l?w:h(_)};for(const _ of s)"graphic"in _?(f(_.layerView).graphics.push(_.graphic),l=!1):(a.push(_.layerView.fetchPopupFeaturesAtLocation(_.mapPoint,c)),l=!0);o.forEach(_=>_.resolve(c));const y=ABe(a).then(_=>_.filter(w=>!!w).flat());return{pendingFeatures:a,allGraphicsPromise:y,location:r}}async _getPopupHits(r,s){const{hits:n,location:a}=await this.popupHitTest(r);st(s);const o=[];for(const l of n)if("graphic"in l){if(this._isValidPopupGraphic(l.graphic,s)){const c=this._isValidPopupGraphicsLayerView(l.layerView)?l.layerView:void 0;o.push({graphic:l.graphic,layerView:c})}}else this._isValidPopupLocationLayerView(l.layerView)&&o.push({mapPoint:l.mapPoint,layerView:l.layerView});return{hits:o,location:a}}_isValidPopupGraphic(r,s){return r&&!!r.getEffectivePopupTemplate(s?.defaultPopupTemplateEnabled)}_isValidPopupGraphicsLayerView(r){return!r||(!("layer"in r)||!r.suspended)&&"fetchPopupFeaturesFromGraphics"in r}_isValidPopupLocationLayerView(r){return(!("layer"in r)||!r.suspended)&&"fetchPopupFeaturesAtLocation"in r}};return d([m()],i.prototype,"popup",void 0),d([m()],i.prototype,"popupElement",void 0),d([m()],i.prototype,"popupEnabled",void 0),i=d([k("esri.views.PopupView")],i),i};let vet=class{constructor(e){this.layerView=e,this._resolver=lo(),this.graphics=[]}get promise(){return this._resolver.promise}resolve(e){const{layerView:i,graphics:r,_resolver:s}=this;if(!i)return s.resolve(r),s.promise;let n;return i.fetchPopupFeaturesFromGraphics(r,e).catch(a=>(n=a,null)).then(a=>{a?s.resolve(a):s.reject(n)}),s.promise}};const bet=5e3;async function xte(t,e){return await t.load(),wet(t,e)}async function wet(t,e){const i=[],r=(...n)=>{for(const a of n)a!=null&&(Array.isArray(a)?r(...a):He.isCollection(a)?a.forEach(o=>r(o)):yZ(a)&&i.push(a))};e(r);let s=null;if(await tet(i,async n=>{const a=await Xf(xet(n)?n.loadAll():n.load());a.ok!==!1||s||(s=a)}),s)throw s.error;return t}function xet(t){return"loadAll"in t&&typeof t.loadAll=="function"}var CZ;const Tet=new ta({avgRating:"avg-rating",numRatings:"num-ratings",numComments:"num-comments",numViews:"num-views"});let Hn=CZ=class extends Me{constructor(t){super(t),this.categories=null,this.disableExtraQuery=!1,this.extent=null,this.filter=null,this.num=10,this.query=null,this.sortField=null,this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(t){t!=="asc"&&t!=="desc"||this._set("sortOrder",t)}clone(){return new CZ({categories:this.categories?Te(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():null,filter:this.filter,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(t,e){let i=[];this.categories&&(i=this.categories.map(a=>Array.isArray(a)?JSON.stringify(a):a));let r="";if(this.extent){const a=QD(this.extent,Ie.WGS84);a!=null&&(r=`${a.xmin},${a.ymin},${a.xmax},${a.ymax}`)}let s=this.query;!this.disableExtraQuery&&t.extraQuery&&(s="("+s+")"+t.extraQuery);const n={categories:i,bbox:r,q:s,filter:this.filter,num:this.num,sortField:null,sortOrder:null,start:this.start};return this.sortField&&(n.sortField=this.sortField.split(",").map(a=>Tet.toJSON(a.trim())).join(","),n.sortOrder=this.sortOrder),{query:{...e,...n}}}};d([m()],Hn.prototype,"categories",void 0),d([m()],Hn.prototype,"disableExtraQuery",void 0),d([m({type:Bt})],Hn.prototype,"extent",void 0),d([m()],Hn.prototype,"filter",void 0),d([m()],Hn.prototype,"num",void 0),d([m()],Hn.prototype,"query",void 0),d([m()],Hn.prototype,"sortField",void 0),d([m()],Hn.prototype,"sortOrder",null),d([m()],Hn.prototype,"start",void 0),Hn=CZ=d([k("esri.portal.PortalQueryParams")],Hn);var MZ;let xn=MZ=class extends ke{constructor(t){super(t),this.access=null,this.created=null,this.description=null,this.id=null,this.isInvitationOnly=!1,this.modified=null,this.owner=null,this.portal=null,this.snippet=null,this.sortField=null,this.sortOrder=null,this.sourceJSON=null,this.tags=null,this.title=null}get thumbnailUrl(){const t=this.url,e=this.thumbnail;return t&&e&&this.portal?this.portal?.normalizeUrl(`${t}/info/${e}?f=json`):null}get url(){const t=this.portal?.restUrl;return t?t+"/community/groups/"+this.id:null}fetchCategorySchema(t){return this.portal.request(this.url+"/categorySchema",t).then(e=>{const i=e.categorySchema||[];return i.some(r=>r.source==="contentCategorySetsGroupQuery.LivingAtlas")?this._fetchCategorySchemaSet("LivingAtlas",t):i})}fetchMembers(t){return this.portal.request(this.url+"/users",t)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}toJSON(){throw new ee("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const e=new MZ({sourceJSON:t});return e.read(t),e}queryItems(t,e){let i=Ca(Hn,t);const r=this.portal;return parseFloat(r.currentVersion)>5?(i=i||new Hn,r.queryPortal(`/content/groups/${this.id}/search`,i,"PortalItem",e)):(i=i?i.clone():new Hn,i.query="group:"+this.id+(i.query?" "+i.query:""),r.queryItems(i,e))}_fetchCategorySchemaSet(t,e){const i=this.portal;return i.fetchSelf(i.authMode,!0,e).then(r=>{const s=r.contentCategorySetsGroupQuery;if(s){const n=new Hn({disableExtraQuery:!0,num:1,query:s});return i.queryGroups(n,e)}throw new ee("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found")}).then(r=>{if(r.total){const s=r.results[0],n=new Hn({num:1,query:`typekeywords:"${t}"`});return s.queryItems(n,e)}throw new ee("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found")}).then(r=>r.total?r.results[0].fetchData("json",e).then(s=>{const n=s?.categorySchema;return n?.length?n:[]}):[])}};d([m()],xn.prototype,"access",void 0),d([m({type:Date})],xn.prototype,"created",void 0),d([m()],xn.prototype,"description",void 0),d([m()],xn.prototype,"id",void 0),d([m()],xn.prototype,"isInvitationOnly",void 0),d([m({type:Date})],xn.prototype,"modified",void 0),d([m()],xn.prototype,"owner",void 0),d([m()],xn.prototype,"portal",void 0),d([m()],xn.prototype,"snippet",void 0),d([m()],xn.prototype,"sortField",void 0),d([m()],xn.prototype,"sortOrder",void 0),d([m()],xn.prototype,"sourceJSON",void 0),d([m()],xn.prototype,"tags",void 0),d([m()],xn.prototype,"thumbnail",void 0),d([m({readOnly:!0})],xn.prototype,"thumbnailUrl",null),d([m()],xn.prototype,"title",void 0),d([m({readOnly:!0})],xn.prototype,"url",null),xn=MZ=d([k("esri.portal.PortalGroup")],xn);let K1=class extends Me{constructor(e){super(e),this.nextQueryParams=null,this.queryParams=null,this.results=null,this.total=null}};d([m()],K1.prototype,"nextQueryParams",void 0),d([m()],K1.prototype,"queryParams",void 0),d([m()],K1.prototype,"results",void 0),d([m()],K1.prototype,"total",void 0),K1=d([k("esri.portal.PortalQueryResult")],K1);let Wm=class extends ke{constructor(e){super(e),this.created=null,this.id=null,this.portal=null,this.title=null,this.username=null}get url(){const e=this.portal?.restUrl;return e?`${e}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new ee("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented")}};d([m({type:Date})],Wm.prototype,"created",void 0),d([m()],Wm.prototype,"id",void 0),d([m()],Wm.prototype,"portal",void 0),d([m()],Wm.prototype,"title",void 0),d([m({readOnly:!0})],Wm.prototype,"url",null),d([m()],Wm.prototype,"username",void 0),Wm=d([k("esri.portal.PortalFolder")],Wm);var EZ;let Xr=EZ=class extends ke{constructor(t){super(t),this.access=null,this.created=null,this.culture=null,this.description=null,this.email=null,this.fullName=null,this.id=null,this.modified=null,this.orgId=null,this.portal=null,this.preferredView=null,this.privileges=null,this.region=null,this.role=null,this.roleId=null,this.sourceJSON=null,this.units=null,this.username=null,this.userLicenseTypeId=null,this.userType=null}get thumbnailUrl(){const t=this.url,e=this.thumbnail;return t&&e?this.portal.normalizeUrl(`${t}/info/${e}?f=json`):null}get userContentUrl(){const t=this.portal?.restUrl;return t?`${t}/content/users/${this.id}`:null}get url(){const t=this.portal?.restUrl;return t?`${t}/community/users/${this.id}`:null}addItem(t){const e=t&&t.item,i=t?.data,r=t?.folder,s={method:"post"};e&&(s.query=e.createPostQuery(),i!=null&&(typeof i=="string"?s.query.text=i:typeof i=="object"&&(s.query.text=JSON.stringify(i))));let n=this.userContentUrl;return r&&(n+="/"+(typeof r=="string"?r:r.id)),this.portal.request(n+"/addItem",s).then(a=>(e.id=a.id,e.portal=this.portal,e.loaded?e.reload():e.load()))}async deleteItem(t,e=!1){let i=this.userContentUrl;t.ownerFolder&&(i+="/"+t.ownerFolder);const r=e?{permanentDelete:!0}:{};await this.portal.request(i+`/items/${t.id}/delete`,{method:"post",query:r}),t.id=null,t.portal=null}async deleteItems(t,e=!1){t=t.slice();const i=this.userContentUrl+"/deleteItems",r=[],s=t.map(n=>n.id);if(s.length){const n={method:"post",query:{items:s.join(","),permanentDelete:e}},a=await this.portal.request(i,n);for(const o of a.results){const l=t.find(f=>o.itemId===f.id),c=o.success;let h=null;c?(l.id=null,l.portal=null):o.error&&(h=new ee("portal:delete-item-failed",o.error.message,o.error)),r.push({item:l,success:c,error:h})}}return r}fetchFolders(){const t={query:{num:1}};return this.portal.request(this.userContentUrl??"",t).then(e=>{let i;return i=e&&e.folders?e.folders.map(r=>{const s=Wm.fromJSON(r);return s.portal=this.portal,s}):[],i})}fetchGroups(){return this.portal.request(this.url??"").then(t=>{let e;return e=t&&t.groups?t.groups.map(i=>{const r=xn.fromJSON(i);return r.portal=this.portal,r}):[],e})}async fetchItems(t){t??={};let e=this.userContentUrl??"";t.folder&&(e+="/"+t.folder.id);const{default:i}=await te(()=>Promise.resolve().then(()=>tCe),void 0),r={folders:!1,inRecycleBin:!!t.inRecycleBin||null,foldersContent:!(t.folder||!t.includeSubfolderItems)||null,num:t.num||10,start:t.start||1,sortField:t.sortField||"created",sortOrder:t.sortOrder||"asc"},s=await this.portal.request(e,{query:r});let n;return s?.items?(n=s.items.map(a=>{const o=i.fromJSON(a);return o.portal=this.portal,o}),await Promise.all(n.map(a=>a.load())),{items:n,nextStart:s.nextStart,total:s.total}):{items:[],nextStart:-1,total:0}}fetchTags(){return this.portal.request(this.url+"/tags").then(t=>t.tags)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}queryFavorites(t){return this.favGroupId?(this._favGroup||(this._favGroup=new xn({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(t)):Promise.reject(new ee("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}async restoreItem(t,e){const i=this.userContentUrl,r=e?{folderID:typeof e=="string"?e:e.id}:null;await this.portal.request(i+`/items/${t.id}/restore`,{method:"post",query:r})}toJSON(){throw new ee("internal:not-yet-implemented","PortalUser.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const e=new EZ({sourceJSON:t});return e.read(t),e}};d([m()],Xr.prototype,"access",void 0),d([m({type:Date})],Xr.prototype,"created",void 0),d([m()],Xr.prototype,"culture",void 0),d([m()],Xr.prototype,"description",void 0),d([m()],Xr.prototype,"email",void 0),d([m()],Xr.prototype,"favGroupId",void 0),d([m()],Xr.prototype,"fullName",void 0),d([m()],Xr.prototype,"id",void 0),d([m({type:Date})],Xr.prototype,"modified",void 0),d([m()],Xr.prototype,"orgId",void 0),d([m()],Xr.prototype,"portal",void 0),d([m()],Xr.prototype,"preferredView",void 0),d([m()],Xr.prototype,"privileges",void 0),d([m()],Xr.prototype,"region",void 0),d([m()],Xr.prototype,"role",void 0),d([m()],Xr.prototype,"roleId",void 0),d([m()],Xr.prototype,"sourceJSON",void 0),d([m()],Xr.prototype,"thumbnail",void 0),d([m({readOnly:!0})],Xr.prototype,"thumbnailUrl",null),d([m()],Xr.prototype,"units",void 0),d([m({readOnly:!0})],Xr.prototype,"userContentUrl",null),d([m({readOnly:!0})],Xr.prototype,"url",null),d([m()],Xr.prototype,"username",void 0),d([m()],Xr.prototype,"userLicenseTypeId",void 0),d([m()],Xr.prototype,"userType",void 0),Xr=EZ=d([k("esri.portal.PortalUser")],Xr);var ou;let BE;const Vde={PortalGroup:()=>Promise.resolve({default:xn}),PortalItem:()=>te(()=>Promise.resolve().then(()=>tCe),void 0),PortalUser:()=>Promise.resolve({default:Xr})};var Lf;let Fe=(Lf=class extends Vv(a4){constructor(e){super(e),this._esriIdCredentialCreateHandle=null,this.access=null,this.allSSL=!1,this.authMode="auto",this.authorizedCrossOriginDomains=null,this.basemapGalleryGroupQuery=null,this.basemapGalleryGroupQuery3D=null,this.g3DTilesGalleryGroupQuery=null,this.g3dTilesEnabled=null,this.bingKey=null,this.canListApps=!1,this.canListData=!1,this.canListPreProvisionedItems=!1,this.canProvisionDirectPurchase=!1,this.canSearchPublic=!0,this.canShareBingPublic=!1,this.canSharePublic=!1,this.canSignInArcGIS=!1,this.canSignInIDP=!1,this.colorSetsGroupQuery=null,this.commentsEnabled=!1,this.created=null,this.culture=null,this.customBaseUrl=null,this.default3DBasemapQuery=null,this.defaultBasemap=null,this.defaultDevBasemap=null,this.defaultExtent=null,this.defaultVectorBasemap=null,this.description=null,this.devBasemapGalleryGroupQuery=null,this.eueiEnabled=null,this.featuredGroups=null,this.featuredItemsGroupQuery=null,this.galleryTemplatesGroupQuery=null,this.layoutGroupQuery=null,this.livingAtlasGroupQuery=null,this.hasCategorySchema=!1,this.hasClassificationSchema=!1,this.helperServices=null,this.homePageFeaturedContent=null,this.homePageFeaturedContentCount=null,this.httpPort=null,this.httpsPort=null,this.id=null,this.ipCntryCode=null,this.isPortal=!1,this.isReadOnly=!1,this.layerTemplatesGroupQuery=null,this.maxTokenExpirationMinutes=null,this.modified=null,this.name=null,this.portalHostname=null,this.portalMode=null,this.portalProperties=null,this.region=null,this.recycleBinEnabled=!1,this.rotatorPanels=null,this.showHomePageDescription=!1,this.sourceJSON=null,this.supportsHostedServices=!1,this.symbolSetsGroupQuery=null,this.templatesGroupQuery=null,this.units=null,this.url=fr.portalUrl,this.urlKey=null,this.user=null,this.use3dBasemaps=!0,this.useDefault3dBasemap=!1,this.useStandardizedQuery=!1,this.useVectorBasemaps=!1,this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(e){return typeof e=="string"?{url:e}:e}destroy(){Ude.unregister(this),this.defaultBasemap=Re(this.defaultBasemap),this.defaultDevBasemap=Re(this.defaultDevBasemap),this.defaultVectorBasemap=Re(this.defaultVectorBasemap),this._esriIdCredentialCreateHandle=Ki(this._esriIdCredentialCreateHandle)}readAuthorizedCrossOriginDomains(e){if(e)for(const i of e)fr.request.trustedServers.includes(i)||fr.request.trustedServers.push(i);return e}readDefaultBasemap(e){return this._readBasemap(e)}readDefaultDevBasemap(e){return this._readBasemap(e)}readDefaultVectorBasemap(e){return this._readBasemap(e)}get extraQuery(){const e=this.user?.orgId,i=!e||this.canSearchPublic;return this.id&&!i?` AND orgid:${this.id}`:null}get hasAPIKey(){return q9e(this.restUrl)}get isOrganization(){return!!this.access}get itemPageUrl(){return this.url?`${this.url}/home/item.html`:null}get loaded(){return super.loaded}get restUrl(){let e=this.url;if(e){const i=e.indexOf("/sharing");e=i>0?e.slice(0,i):this.url.replace(/\/+$/,""),e+="/sharing/rest"}return e}get thumbnailUrl(){const e=this.restUrl,i=this.thumbnail;return e&&i?this._normalizeSSL(e+"/portals/self/resources/"+i):null}readUrlKey(e){return e&&e.toLowerCase()}readUser(e){let i=null;return e&&(i=Xr.fromJSON(e),i.portal=this),i}load(e){const i=te(async()=>{const{default:r}=await Promise.resolve().then(()=>Net);return{default:r}},void 0).then(({default:r})=>{st(e),BE=r}).then(()=>this.sourceJSON?this.sourceJSON:this.fetchSelf(this.authMode,!1,e)).then(r=>{if(!this.hasAPIKey&&hs){const s=hs;this.credential=s.findCredential(this.restUrl),this.credential||this.authMode!==ou.AUTH_MODE_AUTO&&this.authMode!==ou.AUTH_MODE_NO_PROMPT||(this._esriIdCredentialCreateHandle?.remove(),this._esriIdCredentialCreateHandle=s.on("credential-create",$et(new WeakRef(this))),Ude.register(this,this._esriIdCredentialCreateHandle,this))}this.sourceJSON=r,this.read(r)});return this.addResolvingPromise(i),Promise.resolve(this)}async createElevationLayers(){await this.load();const e=this._getHelperService("defaultElevationLayers"),i=(await te(async()=>{const{default:r}=await import("./ElevationLayer-CAVA8EvU.js");return{default:r}},__vite__mapDeps([172,173,174,139,147,157,175]))).default;return e?e.map(r=>new i({id:r.id,url:r.url})):[]}async fetchBasemaps(e,i){const r=await this._fetchBasemaps(e,i);if(i?.include3d===!0&&this.use3dBasemaps!==!1){const s=await this._fetchBasemaps3D(e,i);r.unshift(...s)}return r}async fetchDefault3DBasemap(e){if(!this.useDefault3dBasemap||!this.default3DBasemapQuery||this.default3DBasemapQuery==="none")return null;const i=new Hn;i.query=this.default3DBasemapQuery,i.disableExtraQuery=!0;const r=(await this.queryItems(i,e)).results.find(s=>s.type==="Web Scene");return r?new BE({portalItem:r}):null}fetchCategorySchema(e){return this.hasCategorySchema?this.request(this.restUrl+"/portals/self/categorySchema",e).then(i=>i.categorySchema):Rn(e)?Promise.reject(Xt()):Promise.resolve([])}async fetchClassificationSchema(e){return this.hasClassificationSchema?this.request(this.restUrl+"/portals/self/classification/classificationSchema",e).then(i=>i.classificationSchema):null}fetchFeaturedGroups(e){const i=this.featuredGroups,r=new Hn({num:100,sortField:"title"});if(i?.length){const s=[];for(const n of i)s.push(`(title:"${n.title}" AND owner:${n.owner})`);return r.query=s.join(" OR "),this.queryGroups(r,e).then(n=>n.results)}return Rn(e)?Promise.reject(Xt()):Promise.resolve([])}fetchRegions(e){const i=this.user?.culture||this.culture||Lc();return this.request(this.restUrl+"/portals/regions",{...e,query:{culture:i}})}fetchSettings(e){const i=this.user?.culture||this.culture||Lc();return this.request(this.restUrl+"/portals/self/settings",{...e,query:{culture:i}})}static getDefault(){return jJe(()=>new ou)}queryGroups(e,i){return this.queryPortal("/community/groups",e,"PortalGroup",i)}queryItems(e,i){return this.queryPortal("/search",e,"PortalItem",i)}queryUsers(e,i){return e.sortField||(e.sortField="username"),this.queryPortal("/community/users",e,"PortalUser",i)}fetchSelf(e=this.authMode,i=!1,r){const s=this.restUrl+"/portals/self",n={authMode:e,query:{culture:Lc().toLowerCase()},withCredentials:!0,...r};return n.authMode==="auto"&&(n.authMode="no-prompt"),i&&(n.query.default=!0),this.request(s,n)}queryPortal(e,i,r,s){const n=Ca(Hn,i),a=o=>this.request(this.restUrl+e,{...n.toRequestOptions(this),...s}).then(l=>{const c=n.clone();return c.start=l.nextStart,new K1({nextQueryParams:c,queryParams:n,total:l.total,results:ou._resultsToTypedArray(o,{portal:this},l,s)})}).then(l=>Promise.all(l.results.map(c=>typeof c.when=="function"?c.when():l)).then(()=>l,c=>(My(c),l)));return r&&Vde[r]?Vde[r]().then(({default:o})=>(st(s),a(o))):a()}signIn(){if(this.hasAPIKey)return this.load().then(()=>{if(!this.user)throw new ee("portal:not-authenticated","Unable to authenticate user. Portal.user is missing")});if(this.authMode===ou.AUTH_MODE_ANONYMOUS||this.authMode===ou.AUTH_MODE_NO_PROMPT&&!hs)return Promise.reject(new ee("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if(this.loadStatus==="failed")return Promise.reject(this.loadError);const e=i=>Promise.resolve().then(()=>this.loadStatus==="not-loaded"?(i||(this.authMode="immediate"),this.load().then(()=>null)):this.loadStatus==="loading"?this.load().then(()=>this.credential?null:(this.credential=i,this.fetchSelf("immediate"))):this.user&&this.credential===i?null:(this.credential=i,this.fetchSelf("immediate"))).then(r=>{r&&(this.sourceJSON=r,this.read(r))});return hs?hs.getCredential(this.restUrl,{prompt:this.authMode!==ou.AUTH_MODE_NO_PROMPT}).then(i=>e(i)):e(this.credential)}normalizeUrl(e){const i=this.credential?.token;return this._normalizeSSL(i?e+(e.includes("?")?"&":"?")+"token="+i:e)}requestToTypedArray(e,i,r){return this.request(e,i).then(s=>{const n=ou._resultsToTypedArray(r,{portal:this},s);return Promise.all(n.map(a=>typeof a.when=="function"?a.when():s)).then(()=>n,()=>n)})}request(e,i={}){const r={f:"json",...i.query},{authMode:s=this.authMode===ou.AUTH_MODE_ANONYMOUS||this.authMode===ou.AUTH_MODE_NO_PROMPT?this.authMode:"auto",body:n=null,cacheBust:a=!1,method:o="auto",responseType:l="json",signal:c}=i,h={authMode:s,body:n,cacheBust:a,method:o,query:r,responseType:l,timeout:0,signal:c};return i.withCredentials&&(h.withCredentials=!0),$r(this._normalizeSSL(e),h).then(f=>f.data)}toJSON(){throw new ee("internal:not-yet-implemented","Portal.toJSON is not yet implemented")}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");return new ou({sourceJSON:e})}_getHelperService(e){const i=this.helperServices?.[e];if(!i)throw new ee("portal:service-not-found",`The \`helperServices\` do not include an entry named "${e}"`);return i}async _fetchBasemaps(e,i){const r=new Hn;r.query=e||(wW()?this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery),r.disableExtraQuery=!0;const s=await this.queryGroups(r,i);if(!s.total)return[];const n=s.results[0];r.num=100,r.query='type:"Web Map" -type:"Web Application"',r.sortField=n.sortField||"name",r.sortOrder=n.sortOrder||"desc";const a=await n.queryItems(r,i);return a.total?a.results.filter(o=>o.type==="Web Map").map(o=>new BE({portalItem:o})):[]}async _fetchBasemaps3D(e,i){const r=e||this.basemapGalleryGroupQuery3D;if(!r)return[];if(wW())return[];const s=new Hn({query:r,disableExtraQuery:!0}),n=await this.queryGroups(s,i);if(!n.total)return[];const a=n.results[0];s.num=100,s.query='type:"Web Scene"',s.sortField=a.sortField||"name",s.sortOrder=a.sortOrder||"desc";const o=await a.queryItems(s,i);return o.total?o.results.filter(l=>l.type==="Web Scene").map(l=>new BE({portalItem:l})):[]}_normalizeSSL(e){return e.replace(/^http:/i,"https:").replace(":7080",":7443")}_readBasemap(e){if(e){const i=BE.fromJSON(e);return i.portalItem={portal:this},i}return null}static _resultsToTypedArray(e,i,r,s){let n;if(r){const a=s!=null?s.signal:null;n=r.listings||r.notifications||r.userInvitations||r.tags||r.items||r.groups||r.comments||r.provisions||r.results||r.relatedItems||r,(e||i)&&(n=n.map(o=>{const l=Object.assign(e?e.fromJSON(o):o,i);return typeof l.load=="function"&&l.load(a),l}))}else n=[];return n}},ou=Lf,Lf.AUTH_MODE_ANONYMOUS="anonymous",Lf.AUTH_MODE_AUTO="auto",Lf.AUTH_MODE_IMMEDIATE="immediate",Lf.AUTH_MODE_NO_PROMPT="no-prompt",Lf);d([m()],Fe.prototype,"access",void 0),d([m()],Fe.prototype,"allSSL",void 0),d([m()],Fe.prototype,"authMode",void 0),d([m()],Fe.prototype,"authorizedCrossOriginDomains",void 0),d([di("authorizedCrossOriginDomains")],Fe.prototype,"readAuthorizedCrossOriginDomains",null),d([m()],Fe.prototype,"basemapGalleryGroupQuery",void 0),d([m({json:{name:"3DBasemapGalleryGroupQuery"}})],Fe.prototype,"basemapGalleryGroupQuery3D",void 0),d([m({json:{name:"g3DTilesGalleryGroupQuery"}})],Fe.prototype,"g3DTilesGalleryGroupQuery",void 0),d([m({json:{name:"g3dTilesEnabled"}})],Fe.prototype,"g3dTilesEnabled",void 0),d([m()],Fe.prototype,"bingKey",void 0),d([m()],Fe.prototype,"canListApps",void 0),d([m()],Fe.prototype,"canListData",void 0),d([m()],Fe.prototype,"canListPreProvisionedItems",void 0),d([m()],Fe.prototype,"canProvisionDirectPurchase",void 0),d([m()],Fe.prototype,"canSearchPublic",void 0),d([m()],Fe.prototype,"canShareBingPublic",void 0),d([m()],Fe.prototype,"canSharePublic",void 0),d([m()],Fe.prototype,"canSignInArcGIS",void 0),d([m()],Fe.prototype,"canSignInIDP",void 0),d([m()],Fe.prototype,"colorSetsGroupQuery",void 0),d([m()],Fe.prototype,"commentsEnabled",void 0),d([m({type:Date})],Fe.prototype,"created",void 0),d([m()],Fe.prototype,"credential",void 0),d([m()],Fe.prototype,"culture",void 0),d([m()],Fe.prototype,"currentVersion",void 0),d([m()],Fe.prototype,"customBaseUrl",void 0),d([m()],Fe.prototype,"default3DBasemapQuery",void 0),d([m()],Fe.prototype,"defaultBasemap",void 0),d([di("defaultBasemap")],Fe.prototype,"readDefaultBasemap",null),d([m()],Fe.prototype,"defaultDevBasemap",void 0),d([di("defaultDevBasemap")],Fe.prototype,"readDefaultDevBasemap",null),d([m({type:Bt})],Fe.prototype,"defaultExtent",void 0),d([m()],Fe.prototype,"defaultVectorBasemap",void 0),d([di("defaultVectorBasemap")],Fe.prototype,"readDefaultVectorBasemap",null),d([m()],Fe.prototype,"description",void 0),d([m()],Fe.prototype,"devBasemapGalleryGroupQuery",void 0),d([m()],Fe.prototype,"eueiEnabled",void 0),d([m({readOnly:!0})],Fe.prototype,"extraQuery",null),d([m()],Fe.prototype,"featuredGroups",void 0),d([m()],Fe.prototype,"featuredItemsGroupQuery",void 0),d([m()],Fe.prototype,"galleryTemplatesGroupQuery",void 0),d([m()],Fe.prototype,"layoutGroupQuery",void 0),d([m()],Fe.prototype,"livingAtlasGroupQuery",void 0),d([m({readOnly:!0})],Fe.prototype,"hasAPIKey",null),d([m()],Fe.prototype,"hasCategorySchema",void 0),d([m()],Fe.prototype,"hasClassificationSchema",void 0),d([m()],Fe.prototype,"helpBase",void 0),d([m()],Fe.prototype,"helperServices",void 0),d([m()],Fe.prototype,"helpMap",void 0),d([m()],Fe.prototype,"homePageFeaturedContent",void 0),d([m()],Fe.prototype,"homePageFeaturedContentCount",void 0),d([m()],Fe.prototype,"httpPort",void 0),d([m()],Fe.prototype,"httpsPort",void 0),d([m()],Fe.prototype,"id",void 0),d([m()],Fe.prototype,"ipCntryCode",void 0),d([m({readOnly:!0})],Fe.prototype,"isOrganization",null),d([m()],Fe.prototype,"isPortal",void 0),d([m()],Fe.prototype,"isReadOnly",void 0),d([m({readOnly:!0})],Fe.prototype,"itemPageUrl",null),d([m()],Fe.prototype,"layerTemplatesGroupQuery",void 0),d([m()],Fe.prototype,"maxTokenExpirationMinutes",void 0),d([m({type:Date})],Fe.prototype,"modified",void 0),d([m()],Fe.prototype,"name",void 0),d([m()],Fe.prototype,"portalHostname",void 0),d([m()],Fe.prototype,"portalMode",void 0),d([m()],Fe.prototype,"portalProperties",void 0),d([m()],Fe.prototype,"region",void 0),d([m()],Fe.prototype,"recycleBinEnabled",void 0),d([m({readOnly:!0})],Fe.prototype,"restUrl",null),d([m()],Fe.prototype,"rotatorPanels",void 0),d([m()],Fe.prototype,"showHomePageDescription",void 0),d([m()],Fe.prototype,"sourceJSON",void 0),d([m()],Fe.prototype,"staticImagesUrl",void 0),d([m({json:{name:"2DStylesGroupQuery"}})],Fe.prototype,"stylesGroupQuery2d",void 0),d([m({json:{name:"stylesGroupQuery"}})],Fe.prototype,"stylesGroupQuery3d",void 0),d([m()],Fe.prototype,"supportsHostedServices",void 0),d([m()],Fe.prototype,"symbolSetsGroupQuery",void 0),d([m()],Fe.prototype,"templatesGroupQuery",void 0),d([m()],Fe.prototype,"thumbnail",void 0),d([m({readOnly:!0})],Fe.prototype,"thumbnailUrl",null),d([m()],Fe.prototype,"units",void 0),d([m()],Fe.prototype,"url",void 0),d([m()],Fe.prototype,"urlKey",void 0),d([di("urlKey")],Fe.prototype,"readUrlKey",null),d([m()],Fe.prototype,"user",void 0),d([di("user")],Fe.prototype,"readUser",null),d([m()],Fe.prototype,"use3dBasemaps",void 0),d([m()],Fe.prototype,"useDefault3dBasemap",void 0),d([m()],Fe.prototype,"useStandardizedQuery",void 0),d([m()],Fe.prototype,"useVectorBasemaps",void 0),d([m()],Fe.prototype,"vectorBasemapGalleryGroupQuery",void 0),Fe=ou=d([k("esri.portal.Portal")],Fe);const Ude=new FinalizationRegistry(t=>{t.remove()});function $et(t){const e=hs;return()=>{const i=t.deref();i&&e.findCredential(i.restUrl)&&i.signIn().catch(()=>{})}}let Zm=class extends Me{constructor(e){super(e),this.portalItem=null}normalizeCtorArgs(e){return e?.portalItem&&e.path?{...e,path:Bde(e.path,e.portalItem)}:e}set path(e){e!=null&&Ic(e)?fe.getLogger(this).error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",e)}_castPath(e){return Bde(e,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get cdnUrl(){return this.portalItem&&this.path?`${this.portalItem.itemCdnUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(e="json",i){const r=this.cdnUrl;if(r==null)throw new ee("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal.request(r,{responseType:e,query:{token:this.portalItem.apiKey,_ts:i?.cacheBust?Date.now():null},signal:i?.signal})}async update(e,i){const{addOrUpdateResources:r}=await te(()=>Promise.resolve().then(()=>N3),void 0);return await r(this.portalItem,[{resource:this,content:e,compress:i?.compress,access:i?.access}],"update",i),this}hasPath(){return this.path!=null}};function Bde(t,e){return t==null?t:(t=t.replace(/^\/+/,""),e!=null&&Ic(t)&&(t=IK(t,e.itemUrl)),t?.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,""))}d([m()],Zm.prototype,"portalItem",void 0),d([m({type:String,value:null})],Zm.prototype,"path",null),d([qr("path")],Zm.prototype,"_castPath",null),d([m({type:String,readOnly:!0})],Zm.prototype,"url",null),d([m({type:String,readOnly:!0})],Zm.prototype,"cdnUrl",null),d([m({type:String,readOnly:!0})],Zm.prototype,"itemRelativeUrl",null),Zm=d([k("esri.portal.PortalItemResource")],Zm);let tw=class extends Me{constructor(e){super(e),this.created=null,this.rating=null}};d([m({type:Date})],tw.prototype,"created",void 0),d([m()],tw.prototype,"rating",void 0),tw=d([k("esri.portal.PortalRating")],tw);var eb;const Cet=new Set(["3DTiles Service","CSV","Feature Collection","Feature Service","Feed","GeoJson","Group Layer","Image Service","KML","Knowledge Graph Layer","Map Service","Media Layer","Scene Service","Stream Service","Video Service","Vector Tile Service","WCS","WFS","WMS","WMTS"]),Met=new Set(["KML","GeoJson","CSV"]);let Kt=eb=class extends Vv(a4){static from(t){return qD(eb,t)}constructor(t){super(t),this.access=null,this.accessInformation=null,this.apiKey=null,this.applicationProxies=null,this.avgRating=null,this.categories=null,this.classification=null,this.created=null,this.culture=null,this.description=null,this.extent=null,this.groupCategories=null,this.id=null,this.isOrgItem=!1,this.itemControl=null,this.licenseInfo=null,this.modified=null,this.name=null,this.numComments=null,this.numRatings=null,this.numViews=null,this.owner=null,this.ownerFolder=null,this.portal=null,this.screenshots=null,this.size=null,this.snippet=null,this.sourceJSON=null,this.sourceUrl=null,this.spatialReference=null,this.tags=null,this.title=null,this.type=null,this.typeKeywords=null,this.url=null}destroy(){this.portal=null}get displayName(){const t=this.type,e=this.typeKeywords||[];let i=t;return t==="Feature Service"||t==="Feature Collection"?i=e.includes("Table")?"Table":e.includes("Route Layer")?"Route Layer":e.includes("Markup")?"Markup":"Feature Layer":t==="Image Service"?i=e.includes("Elevation 3D Layer")?"Elevation Layer":e.includes("Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":t==="Scene Service"?i="Scene Layer":t==="Video Service"?i="Video Layer":t==="Scene Package"?i="Scene Layer Package":t==="Stream Service"?i="Feature Layer":t==="Geoprocessing Service"?i=e.includes("Web Tool")?"Tool":"Geoprocessing Service":t==="Geoenrichment Service"?i="GeoEnrichment Service":t==="Geocoding Service"?i="Locator":t==="Microsoft Powerpoint"?i="Microsoft PowerPoint":t==="GeoJson"?i="GeoJSON":t==="Globe Service"?i="Globe Layer":t==="Vector Tile Service"?i="Tile Layer":t==="netCDF"?i="NetCDF":t==="Map Service"?i=e.includes("Spatiotemporal")||!e.includes("Hosted Service")&&!e.includes("Tiled")||e.includes("Relational")?"Map Image Layer":"Tile Layer":t?.toLowerCase().includes("add in")?i=t.replaceAll(/(add in)/gi,"Add-In"):t==="datastore catalog service"?i="Big Data File Share":t==="Compact Tile Package"?i="Tile Package (tpkx)":t==="Raster function template"?i="Raster Function Template":t==="OGCFeatureServer"?i="OGC Feature Layer":t==="web mapping application"&&e.includes("configurableApp")?i="Instant App":t==="Insights Page"?i="Insights Report":t==="Excalibur Imagery Project"?i="Excalibur Project":t==="3DTiles Service"?i="3D tiles layer":t==="3DTiles Package"&&(i="3D tiles package"),i}readExtent(t){return t&&t.length?new Bt(t[0][0],t[0][1],t[1][0],t[1][1]):null}get iconUrl(){const t=this.type?.toLowerCase()||"",e=this.typeKeywords||[],i="esri/images/portal/",r="16";let s,n=!1,a=!1,o=!1,l=!1,c=!1,h=!1,f=!1,y=!1;return t.indexOf("service")>0||t==="feature collection"||t==="kml"||t==="wms"||t==="wmts"||t==="wfs"?(n=e.includes("Hosted Service"),t==="feature service"||t==="feature collection"||t==="kml"||t==="wfs"?(a=e.includes("Table"),o=e.includes("Route Layer"),l=e.includes("Markup"),c=e.includes("Spatiotemporal"),h=e.includes("UtilityNetwork"),s=c&&a?"spatiotemporaltable":a?"table":o?"routelayer":l?"markup":c?"spatiotemporal":h?"utilitynetwork":n?"featureshosted":"features"):t==="map service"||t==="wms"||t==="wmts"?(c=e.includes("Spatiotemporal"),f=e.includes("Relational"),s=c||f?"mapimages":n||e.includes("Tiled")||t==="wmts"?"maptiles":"mapimages"):s=t==="scene service"?e.includes("Line")?"sceneweblayerline":e.includes("3DObject")?"sceneweblayermultipatch":e.includes("Point")?"sceneweblayerpoint":e.includes("IntegratedMesh")?"sceneweblayermesh":e.includes("PointCloud")?"sceneweblayerpointcloud":e.includes("Polygon")?"sceneweblayerpolygon":e.includes("Building")?"sceneweblayerbuilding":e.includes("Voxel")?"sceneweblayervoxel":"sceneweblayer":t==="image service"?e.includes("Elevation 3D Layer")?"elevationlayer":e.includes("Tiled Imagery")?"tiledimagerylayer":"imagery":t==="stream service"?"streamlayer":t==="vector tile service"?"vectortile":t==="datastore catalog service"?"datastorecollection":t==="geocoding service"?"geocodeservice":t==="video service"?e.includes("Live Stream")?"livestreamvideolayer":"videolayer":t==="geoprocessing service"?e.includes("Web Tool")?"tool":"layers":t==="geodata service"?"geodataservice":t==="3dtiles service"?e.includes("3DObject")?"3dobjecttileslayer":e.includes("IntegratedMesh")?"integratedmeshtileslayer":e.includes("GaussianSplat")?"gaussiansplatlayer":"3dtileslayer":"layers"):t==="web map"||t==="cityengine web scene"?s="maps":t==="web scene"?s=e.includes("ViewingMode-Local")?"webscenelocal":"websceneglobal":t==="web mapping application"&&e.includes("configurableApp")?s="instantapps":t==="web mapping application"||t==="mobile application"||t==="application"||t==="operation view"||t==="desktop application"?s="apps":t==="map document"||t==="map package"||t==="published map"||t==="scene document"||t==="globe document"||t==="basemap package"||t==="mobile basemap package"||t==="mobile map package"||t==="project package"||t==="project template"||t==="pro map"||t==="layout"||t==="layer"&&e.includes("ArcGIS Pro")||t==="explorer map"&&e.indexOf("Explorer Document")?s="mapsgray":t==="service definition"||t==="shapefile"||t==="cad drawing"||t==="geojson"||t==="netcdf"||t==="administrative report"?s="datafiles":t==="360 vr experience"?s="360vr":t==="explorer add in"||t==="desktop add in"||t==="windows viewer add in"||t==="windows viewer configuration"?s="appsgray":t==="arcgis pro add in"||t==="arcgis pro configuration"?s="addindesktop":t==="pdf"?s="pdf":t==="microsoft word"?s="word":t==="microsoft excel"?s="excel":t==="microsoft powerpoint"?s="ppt":t==="rule package"||t==="file geodatabase"||t==="sqlite geodatabase"||t==="csv collection"||t==="kml collection"||t==="windows mobile package"||t==="map template"||t==="desktop application template"||t==="gml"||t==="arcpad package"||t==="code sample"||t==="document link"||t==="earth configuration"||t==="operations dashboard add in"||t==="rules package"||t==="workflow manager package"||t==="explorer map"&&e.includes("Explorer Mapping Application")||e.includes("Document")?s="datafilesgray":t==="network analysis service"||t==="geoprocessing service"||t==="geodata service"||t==="geometry service"||t==="geoprocessing package"||t==="locator package"||t==="geoprocessing sample"||t==="workflow manager service"?s="toolsgray":t==="layer"||t==="layer package"||t==="explorer layer"?s="layersgray":t==="analysis model"?s="analysismodel":t==="scene package"?s="scenepackage":t==="3dtiles package"?s="3dtileslayerpackage":t==="3dtiles service"?s="3dtileslayer":t==="mobile scene package"?s="mobilescenepackage":t==="tile package"||t==="compact tile package"?s="tilepackage":t==="task file"?s="taskfile":t==="report template"?s="report-template":t==="statistical data collection"?s="statisticaldatacollection":t==="insights workbook"?s="workbook":t==="insights model"?s="insightsmodel":t==="insights page"?s="insightspage":t==="insights theme"?s="insightstheme":t==="hub initiative"?s="hubinitiative":t==="hub page"?s="hubpage":t==="hub site application"?s="hubsite":t==="hub event"?s="hubevent":t==="hub project"?s="hubproject":t==="relational database connection"?s="relationaldatabaseconnection":t==="big data file share"?s="datastorecollection":t==="image collection"?s="imagecollection":t==="desktop style"?s="desktopstyle":t==="style"?s=e.includes("Dictionary")?"dictionarystyle":"style":t==="dashboard"?s="dashboard":t==="raster function template"?s="rasterprocessingtemplate":t==="vector tile package"?s="vectortilepackage":t==="ortho mapping project"?s="orthomappingproject":t==="ortho mapping template"?s="orthomappingtemplate":t==="solution"?s="solutions":t==="geopackage"?s="geopackage":t==="deep learning package"?s="deeplearningpackage":t==="real time analytic"?s="realtimeanalytics":t==="reality mapping project"?s="realitymappingproject":t==="big data analytic"?s="bigdataanalytics":t==="feed"?s="feed":t==="excalibur imagery project"?s="excaliburimageryproject":t==="notebook"?s="notebook":t==="storymap"?s="storymap":t==="survey123 add in"?s="survey123addin":t==="mission"?s="mission":t==="mission report"?s="missionreport":t==="mission template"?s="missiontemplate":t==="quickcapture project"?s="quickcaptureproject":t==="pro report"?s="proreport":t==="pro report template"?s="proreporttemplate":t==="urban model"?s="urbanmodel":t==="urban project"?s="urbanproject":t==="web experience"?s="experiencebuilder":t==="web experience template"?s="webexperiencetemplate":t==="experience builder widget"?s="experiencebuilderwidget":t==="experience builder widget package"?s="experiencebuilderwidgetpackage":t==="workflow"?s="workflow":t==="kernel gateway connection"?s="kernelgatewayconnection":t==="insights script"?s="insightsscript":t==="hub initiative template"?s="hubinitiativetemplate":t==="storymap theme"?s="storymaptheme":t==="knowledge graph"?s="knowledgegraph":t==="knowledge graph layer"?s="knowledgegraphlayer":t==="knowledge studio project"?s="knowledgestudio":t==="native application"?s="nativeapp":t==="native application installer"?s="nativeappinstaller":t==="web link chart"?s="linkchart":t==="knowledge graph web investigation"?s="investigation":t==="ogcfeatureserver"?s="features":t==="pro presentation"?s="propresentation":t==="pro project"?s="proproject":t==="insights workbook package"?s="insightsworkbookpackage":t==="apache parquet"?s="apacheparquet":t==="notebook code snippet library"?s="notebookcodesnippets":t==="suitability model"?s="suitabilitymodel":t==="esri classifier definition"?s="classifierdefinition":t==="esri classification schema"?s="classificationschema":t==="insights data engineering workbook"?s="dataengineeringworkbook":t==="insights data engineering model"?s="dataengineeringmodel":t==="deep learning studio project"?s="deeplearningproject":t==="discussion"?s="discussion":t==="allsource project"?s="allsourceproject":t==="api key"?s="apikey":t==="data pipeline"?s="datapipelines":t==="group layer"?(y=e.includes("Map"),s=y?"layergroup2d":"layergroup"):s=t==="media layer"?"onlinemedialayer":t==="form"?e.includes("Survey123")?"survey":"datafilesgray":t==="csv"?"csv":t==="image"?"image":t==="xr experience"?"xrexperience":"maps",s?Es(i+s+r+".png"):null}get isLayer(){return this.type!=null&&Cet.has(this.type)}get itemCdnUrl(){return NK(this.itemUrl)}get itemPageUrl(){const t=this.portal?.itemPageUrl;return t&&this.id?`${t}?id=${this.id}`:null}get itemUrl(){const t=this.portal?.restUrl;return t&&this.id?`${t}/content/items/${this.id}`:null}get loaded(){return super.loaded}get thumbnailUrl(){const t=this.itemUrl,e=this.thumbnail;return t&&e?this.portal?.normalizeUrl(`${t}/info/${e}?f=json`)??null:null}get userItemUrl(){const t=this.portal?.restUrl;if(!t)return null;const e=this.owner||this.portal?.user?.id;return e?`${t}/content/users/${this.ownerFolder?`${e}/${this.ownerFolder}`:e}/items/${this.id}`:null}load(t){const e=this.portal??(this.portal=Fe.getDefault()),i=e.load(t).then(()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?e.request(this.itemUrl,{signal:t!=null?t.signal:null,query:{token:this.apiKey}}):{}).then(r=>{this.sourceJSON=r,this.read(r)});return this.addResolvingPromise(i),Promise.resolve(this)}async addRating(t){const e={method:"post",query:{}},i=t instanceof tw?t.rating:t;return i==null||isNaN(i)||typeof t!="number"||(e.query.rating=i),this.portal?(await this.portal.request(this.itemUrl+"/addRating",e),new tw({rating:i,created:new Date})):null}clone(){const t={access:this.access,accessInformation:this.accessInformation,applicationProxies:Te(this.applicationProxies),avgRating:this.avgRating,categories:Te(this.categories),classification:Te(this.classification),created:Te(this.created),culture:this.culture,description:this.description,extent:Te(this.extent),groupCategories:Te(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:Te(this.modified),name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:Te(this.screenshots),size:this.size,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:Te(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:Te(this.typeKeywords),url:this.url};this.loaded&&(t.loadStatus="loaded");const e=new eb({sourceJSON:this.sourceJSON}).set(t);return e._set("isOrgItem",this.isOrgItem),e}createPostQuery(){const t=this.toJSON();for(const e of["tags","typeKeywords","categories"])t[e]=t[e]?.join(", ");for(const e of["extent","classification"]){const i=t[e];i&&(t[e]=JSON.stringify(i))}return t}async deleteRating(){await this.portal.request(this.itemUrl+"/deleteRating",{method:"post"})}fetchData(t="json",e){return this.portal.request(this.itemUrl+"/data",{responseType:t,...e,query:{token:this.apiKey}})}async fetchRating(t){const e=await this.portal.request(this.itemUrl+"/rating",{query:{token:this.apiKey},...t});return e.rating!=null?(e.created=new Date(e.created),new tw(e)):null}fetchRelatedItems(t,e){return this.portal.requestToTypedArray(this.itemUrl+"/relatedItems",{query:{...t,token:this.apiKey},...e},eb)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}reload(){return this.portal.request(this.itemUrl??"",{cacheBust:!0,query:{token:this.apiKey}}).then(t=>(this.applicationProxies&&!Object.hasOwn(t,"appProxies")&&(this.applicationProxies=null),this.sourceJSON=t,this.read(t),this))}update(t){return this.id?this.load().then(()=>this.portal.signIn()).then(()=>{const e=t?.data,i={method:"post"};i.query=this.createPostQuery();for(const r in i.query)i.query[r]===null&&(i.query[r]="");return i.query.clearEmptyFields=!0,e!=null&&(typeof e=="string"?i.query.text=e:typeof e=="object"&&(i.query.text=JSON.stringify(e))),this.portal.request(`${this.userItemUrl}/update`,i).then(()=>this.reload())}):Promise.reject(new ee("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async copy(t){if(!this.id)throw new ee("portal:item-does-not-exist","The item does not exist yet");await this.load();const{portal:e,itemUrl:i}=this;await e.signIn();const{copyResources:r,folder:s,tags:n,title:a}=t||{},o={method:"post",query:{copyPrivateResources:r==="all",folder:typeof s=="string"?s:s?.id,includeResources:!!r,tags:n?.join(","),title:a}},{itemId:l}=await e.request(`${i}/copy`,o);return new eb({id:l,portal:e})}updateThumbnail(t){return this.id?this.load().then(()=>this.portal.signIn()).then(()=>{const e=t.thumbnail,i=t.filename,r={method:"post"};if(typeof e=="string")rm(e)?r.query={data:e}:r.query={url:Tu(e)},i!=null&&(r.query.filename=i);else{const s=new FormData;i!=null?s.append("file",e,i):s.append("file",e),r.body=s}return this.portal.request(`${this.userItemUrl}/updateThumbnail`,r).then(()=>this.reload())}):Promise.reject(new ee("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async fetchResources(t={},e){const{fetchResources:i}=await te(()=>Promise.resolve().then(()=>N3),void 0);return i(this,t,e)}async addResource(t,e,i){const{addOrUpdateResources:r}=await te(()=>Promise.resolve().then(()=>N3),void 0);return t.portalItem=this,await r(this,[{resource:t,content:e,compress:i?.compress,access:i?.access}],"add",i),t}async removeResource(t,e){const{removeResource:i}=await te(()=>Promise.resolve().then(()=>N3),void 0);if(t.portalItem&&t.portalItem.itemUrl!==this.itemUrl)throw new ee("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return i(this,t,e)}async removeAllResources(t){const{removeAllResources:e}=await te(()=>Promise.resolve().then(()=>N3),void 0);return e(this,t)}resourceFromPath(t){return new Zm({portalItem:this,path:t})}toJSON(){const t=this.extent,e={accessInformation:this.accessInformation,categories:Te(this.categories),classification:Te(this.classification),created:this.created?.getTime(),description:this.description,extent:t&&[[t.xmin,t.ymin],[t.xmax,t.ymax]],id:this.id,isOrgItem:this.isOrgItem,licenseInfo:this.licenseInfo,modified:this.modified?.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:Te(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:Te(this.typeKeywords),url:this.url};return C8e(e)}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new eb({sourceJSON:t})}_getPostQuery(){const t=this.toJSON();for(const e in t)e==="tags"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="typeKeywords"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="extent"&&t[e]&&(t[e]=JSON.stringify(t[e]));return t}};d([m({type:["private","shared","org","public"]})],Kt.prototype,"access",void 0),d([m()],Kt.prototype,"accessInformation",void 0),d([m({type:String})],Kt.prototype,"apiKey",void 0),d([m({json:{read:{source:"appProxies"}}})],Kt.prototype,"applicationProxies",void 0),d([m()],Kt.prototype,"avgRating",void 0),d([m()],Kt.prototype,"categories",void 0),d([m()],Kt.prototype,"classification",void 0),d([m({type:Date})],Kt.prototype,"created",void 0),d([m()],Kt.prototype,"culture",void 0),d([m()],Kt.prototype,"description",void 0),d([m({readOnly:!0})],Kt.prototype,"displayName",null),d([m({type:Bt})],Kt.prototype,"extent",void 0),d([di("extent")],Kt.prototype,"readExtent",null),d([m()],Kt.prototype,"groupCategories",void 0),d([m({readOnly:!0})],Kt.prototype,"iconUrl",null),d([m()],Kt.prototype,"id",void 0),d([m({readOnly:!0})],Kt.prototype,"isLayer",null),d([m({type:Boolean,readOnly:!0})],Kt.prototype,"isOrgItem",void 0),d([m()],Kt.prototype,"itemControl",void 0),d([m({readOnly:!0})],Kt.prototype,"itemPageUrl",null),d([m({readOnly:!0})],Kt.prototype,"itemUrl",null),d([m()],Kt.prototype,"licenseInfo",void 0),d([m({type:Date})],Kt.prototype,"modified",void 0),d([m()],Kt.prototype,"name",void 0),d([m()],Kt.prototype,"numComments",void 0),d([m()],Kt.prototype,"numRatings",void 0),d([m()],Kt.prototype,"numViews",void 0),d([m()],Kt.prototype,"owner",void 0),d([m()],Kt.prototype,"ownerFolder",void 0),d([m({type:Fe})],Kt.prototype,"portal",void 0),d([m()],Kt.prototype,"screenshots",void 0),d([m()],Kt.prototype,"size",void 0),d([m()],Kt.prototype,"snippet",void 0),d([m()],Kt.prototype,"sourceJSON",void 0),d([m({type:String})],Kt.prototype,"sourceUrl",void 0),d([m({type:String})],Kt.prototype,"spatialReference",void 0),d([m()],Kt.prototype,"tags",void 0),d([m()],Kt.prototype,"thumbnail",void 0),d([m({readOnly:!0})],Kt.prototype,"thumbnailUrl",null),d([m()],Kt.prototype,"title",void 0),d([m()],Kt.prototype,"type",void 0),d([m()],Kt.prototype,"typeKeywords",void 0),d([m({type:String,json:{read(t,e){if(Met.has(e.type)){const i=this.portal?.restUrl;t||=i&&this.id?`${i}/content/items/${this.id}/data`:null}return t}}})],Kt.prototype,"url",void 0),d([m({readOnly:!0})],Kt.prototype,"userItemUrl",null),Kt=eb=d([k("esri.portal.PortalItem")],Kt);const tCe=Object.freeze(Object.defineProperty({__proto__:null,get default(){return Kt}},Symbol.toStringTag,{value:"Module"}));async function Eet(t){if(!t)return;const e=t.includes("-vector")?t.slice(0,t.indexOf("-vector")):t.includes("-3d")?t.slice(0,t.indexOf("-3d")):t,i=await TTe("esri/t9n/basemaps");return i[t]||i[e]}const AZ={satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return Es("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return Es("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return Es("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-hillshade",url:"https://services.arcgisonline.com/ArcGIS/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1},{id:"terrain-base",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/33064a20de0c48d2bb61efa8faca93a8/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Terrain Base"},{id:"terrain-reference",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/14fbc125ccc9488888b014db09f35f67/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Reference Reference",isReference:!0}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return Es("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/94329802cbfa44a18f423e6f1a0b875c/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return Es("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return Es("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get"dark-gray"(){return{...this["dark-gray-vector"],id:"dark-gray"}},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return Es("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get gray(){return{...this["gray-vector"],id:"gray"}},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return Es("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},get streets(){return{...this["streets-vector"],id:"streets"}},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return Es("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},get topo(){return{...this["topo-vector"],id:"topo"}},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return Es("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return Es("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return Es("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"topo-3d":{id:"topo-3d",is3d:!0,get thumbnailUrl(){return Es("esri/images/basemap/topo-3d.png")},baseMapLayers:[{id:"topo-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/1e7d1784d1ef4b79ba6764d0bd6c3150/resources/styles/root.json",layerType:"VectorTileLayer",title:"Topographic",visibility:!0,opacity:1},{id:"topo-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/Open3D_Trees_v1/SceneServer",itemId:"9d3d89d42cfe4e2c9d108a2f0d518406",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/Esri3D_Buildings_v1/SceneServer",itemId:"b8fec5af7dfe4866b1b8ac2d2800f282",layerType:"ArcGISSceneServiceLayer"}]},"navigation-3d":{id:"navigation-3d",is3d:!0,get thumbnailUrl(){return Es("esri/images/basemap/navigation-3d.jpg")},baseMapLayers:[{id:"navigation-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/ccc904ff872b4144b94934e55e32784b/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation",visibility:!0,opacity:1},{id:"navigation-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/Esri3D_Buildings_v1/SceneServer",itemId:"b8fec5af7dfe4866b1b8ac2d2800f282",layerType:"ArcGISSceneServiceLayer"}]},"streets-3d":{id:"streets-3d",is3d:!0,get thumbnailUrl(){return Es("esri/images/basemap/streets-3d.png")},baseMapLayers:[{id:"streets-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/198298c4c64c4cb19de5b46aa00c198d/resources/styles/root.json",layerType:"VectorTileLayer",title:"Streets",visibility:!0,opacity:1},{id:"streets-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"streets-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/Esri3D_Buildings_v1/SceneServer",itemId:"b8fec5af7dfe4866b1b8ac2d2800f282",layerType:"ArcGISSceneServiceLayer"}]},"osm-3d":{id:"osm-3d",is3d:!0,get thumbnailUrl(){return Es("esri/images/basemap/osm-3d.png")},baseMapLayers:[{id:"osm-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/8628d259c9d14bdc848771c23c513940/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap",visibility:!0,opacity:1},{id:"osm-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/Open3D_Trees_v1/SceneServer",itemId:"9d3d89d42cfe4e2c9d108a2f0d518406",layerType:"ArcGISSceneServiceLayer"},{id:"osm-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"osm-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/Open3D_Buildings_v1/SceneServer",itemId:"cd33b09dde0a419c986ca1a78a5fc06d",layerType:"ArcGISSceneServiceLayer"}]},"gray-3d":{id:"gray-3d",is3d:!0,get thumbnailUrl(){return Es("esri/images/basemap/gray-3d.png")},baseMapLayers:[{id:"gray-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/01a14b466345455ba4176d2e6390db92/resources/styles/root.json",layerType:"VectorTileLayer",title:"Streets",visibility:!0,opacity:1},{id:"gray-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"gray-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/Esri3D_Buildings_v1/SceneServer",itemId:"b8fec5af7dfe4866b1b8ac2d2800f282",layerType:"ArcGISSceneServiceLayer"}]},"navigation-dark-3d":{id:"navigation-dark-3d",itemId:"5a1365328b4943f09a54cf5fd1205707",is3d:!0,baseMapLayers:[{id:"navigation-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/451a1777ab3f4bf095fae24a117439d9/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation Dark"},{id:"navigation-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/Esri3D_Buildings_v1/SceneServer",itemId:"b8fec5af7dfe4866b1b8ac2d2800f282",layerType:"ArcGISSceneServiceLayer"}]},"streets-dark-3d":{id:"streets-dark-3d",itemId:"8a4efa2c20484ec9b4557895e65736ff",is3d:!0,baseMapLayers:[{id:"streets-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/bc599b6d741a4ac084b7eea7bf8c5938/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap Streets Night (for 3D)"},{id:"streets-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"streets-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/Esri3D_Buildings_v1/SceneServer",itemId:"b8fec5af7dfe4866b1b8ac2d2800f282",layerType:"ArcGISSceneServiceLayer"}]},"dark-gray-3d":{id:"dark-gray-3d",itemId:"a8b7322a5fe94002bb0f5e0eeb0c5c18",is3d:!0,baseMapLayers:[{id:"dark-gray-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/4178f71acb934fb89f169e7d667c20c6/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap Dark Gray Canvas (for 3D)"},{id:"dark-gray-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"dark-gray-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/Esri3D_Buildings_v1/SceneServer",itemId:"b8fec5af7dfe4866b1b8ac2d2800f282",layerType:"ArcGISSceneServiceLayer"}]}};let Ym=class extends Me{constructor(e){super(e),this.apiKey=null,this.id=null,this.language=null,this.places=null,this.serviceUrl="https://basemapstyles-api.arcgis.com/arcgis/rest/services/styles/v2",this.worldview=null}get languageParameter(){const e=this.language;let i=e==="local"||e==="global"?e:$Te(e??Lc())??"global";return i=i==="no"?"nb":i,i}};d([m()],Ym.prototype,"apiKey",void 0),d([m()],Ym.prototype,"id",void 0),d([m()],Ym.prototype,"language",void 0),d([m()],Ym.prototype,"places",void 0),d([m()],Ym.prototype,"serviceUrl",void 0),d([m()],Ym.prototype,"worldview",void 0),Ym=d([k("esri.support.BasemapStyle")],Ym);const Aet=Ym,Oet=new Set(["bing-maps","imagery","imagery-tile","map-image","open-street-map","tile","unknown","unsupported","vector-tile","web-tile","wcs","wms","wmts"]),Pet=new Set(["integrated-mesh-3dtiles"]),iCe=new Set(["catalog","csv","feature","geo-rss","geojson","group","imagery","imagery-tile","kml","knowledge-graph","map-image","map-notes","media","ogc-feature","oriented-imagery","parquet","route","stream","subtype-group","tile","unknown","unsupported","vector-tile","video","web-tile","wcs","wfs","wms","wmts"]),Ret=new Set([...iCe,"link-chart"]);function Det(t){switch(t.layerContainerType){case"basemap-base-layers":return Oet;case"basemap-ground-layers":return Pet;case"operational-layers":return t.origin==="link-chart"?Ret:iCe;default:return null}}function Iet(t,e){if(e.restrictedWebMapWriting){const i=Det(e);return i==null||i.has(t.type)&&!HU(t)}return!0}function Let(t,e){if(e)if(HU(t)){const i=zD("featureCollection.layers",e),r=i?.[0]?.layerDefinition;r&&jde(t,r)}else t.type!=="group"&&jde(t,e)}function jde(t,e){"maxScale"in t&&(e.maxScale=BN(t.maxScale)??void 0),"minScale"in t&&(e.minScale=BN(t.minScale)??void 0)}function ket(t,e){if(Let(t,e),e&&(e.id=t.id,"blendMode"in t&&(e.blendMode=t.blendMode,e.blendMode==="normal"&&delete e.blendMode),e.opacity=BN(t.opacity)??void 0,e.title=t.title||"Layer",e.visibility=t.visible,"legendEnabled"in t&&t.type!=="wmts"))if(HU(t)){const i=e.featureCollection;i&&(i.showLegend=t.legendEnabled)}else e.showLegend=t.legendEnabled}function x7(t,e,i){if(!t.persistenceEnabled)return null;if(!("write"in t)||!t.write)return i?.messages&&i.messages.push(new ee("layer:unsupported",`Layers (${t.title}, ${t.id}) of type '${t.declaredClass}' cannot be persisted`,{layer:t})),null;if(HU(t)&&!t.isTable)e=t.resourceInfo;else if(Iet(t,i)){const r={};return t.write(r,i)?r:null}return e!=null&&ket(t,e=Te(e)),e}var qde,cT,Nw;let hc=(Nw=class extends Vv(a4){constructor(e){super(e),this[qde]=!0,this.id=null,this.portalItem=null,this.spatialReference=null,this.style=null,this.thumbnailUrl=null,this.title="Basemap",this.type="Basemap",this.id=Date.now().toString(16)+"-basemap-"+cT.idCounter++,this.baseLayers=new He,this.referenceLayers=new He,this.groundLayers=new He;const i=o=>{const{parent:l}=o;l&&l!==this&&"remove"in l&&l.remove?.(o),o.parent=this,o.type!=="elevation"&&o.type!=="integrated-mesh-3dtiles"||fe.getLogger(this).error(`Layer '${o.title}, id:${o.id}' of type '${o.type}' is not supported as a basemap layer and will therefore be ignored.`)},r=o=>{const{parent:l}=o;l&&l!==this&&"remove"in l&&l.remove?.(o),o.parent=this},s=o=>{const l=o.item;return l.parent===this?(fe.getLogger(this).error(`Layer '${l.title}, id:${l.id}' of type '${l.type}' already a ground layer, second add will be ignored.`),void o.preventDefault()):l.type!=="integrated-mesh-3dtiles"&&l.type!=="integrated-mesh"?(fe.getLogger(this).error(`Layer '${l.title}, id:${l.id}' of type '${l.type}' is not supported as a ground layer and will therefore be ignored.`),void o.preventDefault()):void 0},n=o=>{o.parent=null},a=o=>{o.parent===this&&(o.parent=null)};this.addHandles([this.baseLayers.on("after-add",o=>i(o.item)),this.baseLayers.on("after-remove",o=>n(o.item)),this.referenceLayers.on("after-add",o=>i(o.item)),this.referenceLayers.on("after-remove",o=>n(o.item)),this.groundLayers.on("before-add",s),this.groundLayers.on("after-add",o=>r(o.item)),this.groundLayers.on("after-remove",o=>a(o.item))])}initialize(){this.when().catch(e=>{fe.getLogger(this).error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,e)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const e=this.baseLayers.toArray();for(const s of e)s.destroyed||s.destroy();const i=this.groundLayers.toArray();for(const s of i)s.destroyed||s.destroy();const r=this.referenceLayers.toArray();for(const s of r)s.destroyed||s.destroy();this.baseLayers.destroy(),this.groundLayers.destroy(),this.referenceLayers.destroy(),this.portalItem=Re(this.portalItem)}removeChildLayer(e){for(const i of[this.baseLayers,this.referenceLayers,this.groundLayers])i.remove(e)}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e={...e}).resourceInfo),e}set baseLayers(e){this._set("baseLayers",kc(e,this._get("baseLayers")))}_writeBaseLayers(e,i,r){const s=[];e&&(r={...r,layerContainerType:"basemap-base-layers"},this.baseLayers.forEach(n=>{const a=x7(n,r.webmap?r.webmap.getLayerJSONFromResourceInfo(n):null,r);a!=null&&s.push(a)}),this.referenceLayers.forEach(n=>{const a=x7(n,r.webmap?r.webmap.getLayerJSONFromResourceInfo(n):null,r);a!=null&&(n.type!=="scene"&&(a.isReference=!0),s.push(a))})),i.baseMapLayers=s}set groundLayers(e){this._set("groundLayers",kc(e,this._get("groundLayers")))}_writeGroundLayers(e,i,r){const s=[];e&&(r={...r,layerContainerType:"basemap-ground-layers"},this.groundLayers.forEach(n=>{const a=x7(n,r.webmap?r.webmap.getLayerJSONFromResourceInfo(n):null,r);a!=null&&s.push(a)}),s.length>0&&(i.groundLayers=s))}get loaded(){return super.loaded}set referenceLayers(e){this._set("referenceLayers",kc(e,this._get("referenceLayers")))}writeTitle(e,i){i.title=e||"Basemap"}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return xte(this,e=>{e(this.baseLayers,this.groundLayers,this.referenceLayers)})}clone(){const e={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.map(i=>CP(i)?i.clone():i),groundLayers:this.groundLayers.map(i=>CP(i)?i.clone():i),referenceLayers:this.referenceLayers.map(i=>CP(i)?i.clone():i)};return this.loaded&&(e.loadStatus="loaded"),new cT({resourceInfo:this.resourceInfo}).set(e)}read(e,i){this.resourceInfo||this._set("resourceInfo",{data:e,context:i}),super.read(e,i)}write(e,i){return e=e||{},i?.origin||(i={origin:"web-map",...i}),super.write(e,i),!this.loaded&&this.resourceInfo?.data.baseMapLayers&&(e.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(r=>{const s=Te(r);return s.url&&Wf(s.url)&&(s.url=`https:${s.url}`),s.templateUrl&&Wf(s.templateUrl)&&(s.templateUrl=`https:${s.templateUrl}`),s})),e}async _loadFromSource(e){const{resourceInfo:i,portalItem:r,style:s}=this;st(e);const n=[];if(i){const a=i.context?i.context.url:null;if(n.push(this._loadLayersFromJSON(i.data,a,e)),i.data.id&&!i.data.title){const o=i.data.id;n.push(Eet(o).then(l=>{l&&this.read({title:l},i.context)}))}}else r?n.push(this._loadFromItem(r,e)):s&&n.push(this._loadFromStylesService(s,e));await Promise.all(n)}async _loadLayersFromJSON(e,i,r){const s=this.resourceInfo?.context,n=this.portalItem?.portal||s?.portal||null,a=Fet[s?.origin||""]??"web-map",{populateOperationalLayers:o}=await te(async()=>{const{populateOperationalLayers:c}=await import("./layersCreator-i2Z_AdV6.js");return{populateOperationalLayers:c}},__vite__mapDeps([176,117,116,115,118,114,167])),l=[];if(st(r),e.baseMapLayers&&Array.isArray(e.baseMapLayers)){const c={context:{...s,origin:a,url:i,portal:n,layerContainerType:"basemap-base-layers"},defaultLayerType:"DefaultTileLayer"},h=_=>a==="web-scene"&&_.layerType==="ArcGISSceneServiceLayer"||_.isReference,f=o(this.baseLayers,e.baseMapLayers.filter(_=>!h(_)),c);l.push(f);const y=o(this.referenceLayers,e.baseMapLayers.filter(h),c);l.push(y)}if(e.groundLayers&&Array.isArray(e.groundLayers)){const c={context:{...s,origin:a,url:i,portal:n,layerContainerType:"basemap-ground-layers"},defaultLayerType:"IntegratedMesh3DTilesLayer"},h=o(this.groundLayers,e.groundLayers,c);l.push(h)}await Promise.allSettled(l)}async _loadFromItem(e,i){const r=await e.load(i),s=await r.fetchData("json",i),n=Ma(e.itemUrl??"");return this._set("resourceInfo",{data:s.baseMap??{},context:{origin:zet[e.type||""]??"web-map",portal:e.portal||Fe.getDefault(),url:n}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:s.spatialReference},this.resourceInfo.context),this.read({title:e.title,thumbnailUrl:e.thumbnailUrl},{origin:"portal-item",portal:e.portal||Fe.getDefault(),url:n}),this._loadLayersFromJSON(this.resourceInfo.data,n,i)}async _loadFromStylesService(e,i){const r=e.serviceUrl.endsWith("/webmaps")?e.serviceUrl.slice(0,-8):e.serviceUrl,s=`${r}/styles/${e.id}/self`,n=`${r}/webmaps/${e.id}`,a=e.apiKey??fr.apiKeys.basemapStyles,[o,l]=await Promise.all([(await $r(s,{query:{token:a},signal:i?.signal})).data,(await $r(n,{query:{language:e.languageParameter,places:e.places,worldview:e.worldview,token:a},signal:i?.signal})).data]);this.thumbnailUrl??=o.thumbnailUrl;const c=Ma(n);if(this._set("resourceInfo",{data:l.baseMap??{},context:{origin:"web-map",url:c}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:l.spatialReference},this.resourceInfo.context),await this._loadLayersFromJSON(this.resourceInfo.data,c,i),a)for(const h of[...this.baseLayers,...this.groundLayers,...this.referenceLayers])"apiKey"in h&&(h.apiKey=a)}static fromId(e){const i=AZ[e];return i?i.itemId?new cT({portalItem:{id:i.itemId,portal:{url:"https://www.arcgis.com"}}}):cT.fromJSON(i,i.is3d?{origin:"web-scene",portal:new Fe({url:"https://www.arcgis.com"})}:{origin:"web-map"}):null}},qde=x$e,cT=Nw,Nw.idCounter=0,Nw);d([m({json:{read:!1,write:{ignoreOrigin:!0,target:"baseMapLayers",writer(t,e,i,r){this._writeBaseLayers(t,e,r)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:He}},writer(t,e,i,r){this._writeBaseLayers(t,e,r)}}}}}})],hc.prototype,"baseLayers",null),d([m({json:{read:!1,write:{ignoreOrigin:!0,target:"groundLayers",writer(t,e,i,r){this._writeGroundLayers(t,e,r)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{groundLayers:{type:He}},writer(t,e,i,r){this._writeGroundLayers(t,e,r)}}}}}})],hc.prototype,"groundLayers",null),d([m({type:String,json:{origins:{"web-scene":{write:!0}}}})],hc.prototype,"id",void 0),d([m({type:Kt})],hc.prototype,"portalItem",void 0),d([m()],hc.prototype,"referenceLayers",null),d([m({readOnly:!0})],hc.prototype,"resourceInfo",void 0),d([m({type:Ie})],hc.prototype,"spatialReference",void 0),d([m({type:Aet})],hc.prototype,"style",void 0),d([m()],hc.prototype,"thumbnailUrl",void 0),d([m({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],hc.prototype,"title",void 0),d([Ht("title")],hc.prototype,"writeTitle",null),hc=cT=d([k("esri.Basemap")],hc);const zet={"Web Scene":"web-scene","Web Map":"web-map","Link Chart":"link-chart"},Fet={"web-scene":"web-scene","web-map":"web-map","link-chart":"link-chart"},t$=hc,Net=Object.freeze(Object.defineProperty({__proto__:null,default:t$},Symbol.toStringTag,{value:"Module"})),w6={transparent:[0,0,0,0],black:[0,0,0,1],silver:[192,192,192,1],gray:[128,128,128,1],white:[255,255,255,1],maroon:[128,0,0,1],red:[255,0,0,1],purple:[128,0,128,1],fuchsia:[255,0,255,1],green:[0,128,0,1],lime:[0,255,0,1],olive:[128,128,0,1],yellow:[255,255,0,1],navy:[0,0,128,1],blue:[0,0,255,1],teal:[0,128,128,1],aqua:[0,255,255,1],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],blanchedalmond:[255,235,205,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],oldlace:[253,245,230,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],rebeccapurple:[102,51,153,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],whitesmoke:[245,245,245,1],yellowgreen:[154,205,50,1]};function rCe(t){return!!w6[t]||!!w6[t.toLowerCase()]}function Ste(t){return w6[t]??w6[t.toLowerCase()]}function Vet(t){return[...Ste(t)]}function S7(t,e,i){i<0&&++i,i>1&&--i;const r=6*i;return r<1?t+(e-t)*r:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}function sCe(t,e,i,r=1){const s=(t%360+360)%360/360,n=i<=.5?i*(e+1):i+e-i*e,a=2*i-n;return[Math.round(255*S7(a,n,s+1/3)),Math.round(255*S7(a,n,s)),Math.round(255*S7(a,n,s-1/3)),r]}function Uet(t){const e=t.length>5,i=e?8:4,r=(1<<i)-1,s=e?1:17,n=e?t.length===9:t.length===5;let a=+("0x"+t.slice(1));if(isNaN(a))return null;const o=[0,0,0,1];let l;return n&&(l=a&r,a>>=i,o[3]=s*l/255),l=a&r,a>>=i,o[2]=s*l,l=a&r,a>>=i,o[1]=s*l,l=a&r,a>>=i,o[0]=s*l,o}function nCe(t){if(!t.startsWith("#")||isNaN(+`0x${t.slice(1)}`))return null;switch(t.length){case 4:case 5:{const e=parseInt(t.slice(1,2),16),i=parseInt(t.slice(2,3),16),r=parseInt(t.slice(3,4),16),s=t.length===4?15:parseInt(t.slice(4),16);return[e+16*e,i+16*i,r+16*r,(s+16*s)/255]}case 7:case 9:return[parseInt(t.slice(1,3),16),parseInt(t.slice(3,5),16),parseInt(t.slice(5,7),16),(t.length===7?255:parseInt(t.slice(7),16))/255];default:return null}}function aCe(t){const e=t.toLowerCase().match(/^(rgba?|hsla?)\(([\s.\-,%0-9]+)\)/);if(e){const i=e[2].split(/\s*,\s*/),r=e[1];if(r==="rgb"&&i.length===3||r==="rgba"&&i.length===4){if(i[0].endsWith("%")){const s=i.map(n=>2.56*parseFloat(n));return i.length===4&&(s[3]=parseFloat(i[3])),Gde(s)}return Gde(i.map(s=>parseFloat(s)))}if(r==="hsl"&&i.length===3||r==="hsla"&&i.length===4)return sCe(parseFloat(i[0]),parseFloat(i[1])/100,parseFloat(i[2])/100,parseFloat(i[3]??"1"))}return null}function Gde(t){return t[0]=i$(t[0]),t[1]=i$(t[1]),t[2]=i$(t[2]),t[3]=t.length===4?lCe(t[3]):1,t}function oCe(t){let e=rCe(t)?Ste(t):null;return e??=aCe(t),e??=nCe(t),e}function _Ut(t){const e=oCe(t);return e!=null?[e[0]/255,e[1]/255,e[2]/255,e[3]]:null}function lCe(t){return cCe(t,0,1)}function i$(t){return Math.round(cCe(t,0,255))}function cCe(t,e,i){return t=Number(t),isNaN(t)?i:t<e?e:t>i?i:t}const DC=2.2,Bet=1/DC;function vUt(t){return t**DC}function bUt(t){return t**Bet}function R5(t){return Se(wK(t),0,255)}function D5(t,e){const i=t.toString(16).padStart(2,"0");return e?i.slice(0,1):i}let mt=class hh{static blendColors(e,i,r,s=new hh){return s.r=Math.round(e.r+(i.r-e.r)*r),s.g=Math.round(e.g+(i.g-e.g)*r),s.b=Math.round(e.b+(i.b-e.b)*r),s.a=e.a+(i.a-e.a)*r,s._sanitize()}static fromRgb(e,i){const r=aCe(e);return r?hh.fromArray(r,i):null}static fromHex(e,i=new hh){const r=nCe(e);return r?hh.fromArray(r,i):null}static fromArray(e,i=new hh){return i._set(Number(e[0]),Number(e[1]),Number(e[2]),Number(e[3])),isNaN(i.a)&&(i.a=1),i._sanitize()}static fromString(e,i){const r=oCe(e);return r?hh.fromArray(r,i):null}static fromJSON(e){return e!=null?new hh([e[0],e[1],e[2],(e[3]??255)/255]):void 0}static toUnitRGB(e){return e!=null?[e.r/255,e.g/255,e.b/255]:null}static toUnitRGBA(e,i){return e==null?null:(i??=[0,0,0,0],i[0]=e.r/255,i[1]=e.g/255,i[2]=e.b/255,i[3]=e.a!=null?e.a:1,i)}constructor(e){this.r=255,this.g=255,this.b=255,this.a=1,e&&this.setColor(e)}get isBright(){return .299*this.r+.587*this.g+.114*this.b>=127}setColor(e){return typeof e=="string"?hh.fromString(e,this):Array.isArray(e)?hh.fromArray(e,this):(this._set(e.r??0,e.g??0,e.b??0,e.a??1),e instanceof hh||this._sanitize()),this}toRgb(){return[this.r,this.g,this.b]}toRgba(){return[this.r,this.g,this.b,this.a]}toHex(e){const i=e?.capitalize??!1,r=e?.digits??6,s=r===3||r===4,n=r===4||r===8,a=`#${D5(this.r,s)}${D5(this.g,s)}${D5(this.b,s)}${n?D5(Math.round(255*this.a),s):""}`;return i?a.toUpperCase():a}toCss(e=!1){const i=this.r+", "+this.g+", "+this.b;return e?`rgba(${i}, ${this.a})`:`rgb(${i})`}toString(){return this.toCss(!0)}toJSON(){return this.toArray()}toArray(e=0){const i=R5(this.r),r=R5(this.g),s=R5(this.b);return e===0||this.a!==1?[i,r,s,R5(255*this.a)]:[i,r,s]}clone(){return new hh(this.toRgba())}hash(){return this.r<<24|this.g<<16|this.b<<8|255*this.a}equals(e){return e!=null&&e.r===this.r&&e.g===this.g&&e.b===this.b&&e.a===this.a}_sanitize(){return this.r=i$(this.r),this.g=i$(this.g),this.b=i$(this.b),this.a=lCe(this.a),this}_set(e,i,r,s){this.r=e,this.g=i,this.b=r,this.a=s}};mt.prototype.declaredClass="esri.Color";let Jd=class extends He{constructor(e){super(e),this.getCollections=null}initialize(){this.addHandles(WBe(()=>this._refresh(),Yt))}destroy(){this.getCollections=null}_refresh(){const e=this.getCollections?.();if(e==null)return void this.removeAll();let i=0;for(const r of e)r!=null&&(i=this._processCollection(i,r));this.splice(i)}_createNewInstance(e){return new He(e)}_processCollection(e,i){if(!i)return e;const r=this.itemFilterFunction??(s=>!!s);for(const s of i)if(s){if(r(s)){const n=this.indexOf(s,e);n>=0?n!==e&&this.reorder(s,e):this.add(s,e),++e}if(this.getChildrenFunction){const n=this.getChildrenFunction(s);if(Array.isArray(n))for(const a of n)e=this._processCollection(e,a);else e=this._processCollection(e,n)}}return e}};d([m()],Jd.prototype,"getCollections",void 0),d([m()],Jd.prototype,"getChildrenFunction",void 0),d([m()],Jd.prototype,"itemFilterFunction",void 0),Jd=d([k("esri.core.CollectionFlattener")],Jd);function Et(t,e={}){const i=t instanceof ta?t:new ta(t,e),{alwaysWriteDefaults:r,default:s,ignoreUnknown:n=!0,name:a,nonNullable:o,readOnly:l=!1}=e;return m({type:n?i.apiValues:String,json:{type:i.jsonValues,default:s,name:a,read:!l&&{reader:i.read},write:{writer:i.write,alwaysWriteDefaults:r}},nonNullable:o,readOnly:l})}var OZ;let _z=OZ=class extends ke{constructor(t){super(t),this.type="none"}clone(){return new OZ({type:this.type})}};d([Et({none:"none",stayAbove:"stay-above"}),m({json:{write:{isRequired:!0}}})],_z.prototype,"type",void 0),_z=OZ=d([k("esri.ground.NavigationConstraint")],_z);const uCe=Symbol("GroundInstance");function jet(t){return t!=null&&typeof t=="object"&&uCe in t}function Tte(t){const e=wK(100*(1-t));return Math.max(0,Math.min(e,100))}function $te(t){const e=1-t/100;return Math.max(0,Math.min(e,1))}var Hde,PZ,k1e;let dh=PZ=(k1e=class extends Vv(a4){constructor(t){super(t),this[Hde]=!0,this.parent=null,this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new He;const e=r=>{const{parent:s}=r;s&&s!==this&&"remove"in s&&s.remove?.(r),r.parent=this,r.type!=="elevation"&&r.type!=="base-elevation"&&fe.getLogger(this).error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},i=r=>{r.parent=null};this.addHandles([this.layers.on("after-add",r=>e(r.item)),this.layers.on("after-remove",r=>i(r.item))]),this.allLayers=new Jd({getCollections:()=>[this.layers,this.parent?.basemap?.groundLayers]})}removeChildLayer(t){this.layers.remove(t)}initialize(){this.when().catch(t=>{Hr(t)||fe.getLogger(this).error("#load()","Failed to load ground",t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}get integratedMeshGround(){const t=this.parent?.basemap?.groundLayers.at(0);return t?.replacesTerrain?t:null}destroy(){const t=this.layers.removeAll();for(const e of t)Re(e);this.layers.destroy()}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}get loaded(){return super.loaded}get layers(){return this._get("layers")}set layers(t){this._set("layers",kc(t,this._get("layers")))}writeLayers(t,e,i,r){const s=[];t&&(r={...r,layerContainerType:"ground"},t.forEach(n=>{if("write"in n){const a={};m8e(n)().write(a,r)&&s.push(a)}else r?.messages&&r.messages.push(new ee("layer:unsupported",`Layers (${n.title}, ${n.id}) of type '${n.declaredClass}' cannot be persisted in the ground`,{layer:n}))})),e.layers=s}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return xte(this,t=>{t(this.layers)})}async queryElevation(t,e){await this.load({signal:e?.signal});const{queryAll:i}=await te(()=>Promise.resolve().then(()=>Fye),void 0);return st(e),i(this.layers.filter(Wde).toArray(),t,e)}async createElevationSampler(t,e){await this.load({signal:e?.signal});const{createSampler:i}=await te(()=>Promise.resolve().then(()=>Fye),void 0);return st(e),i(this.layers.filter(Wde).toArray(),t,e)}clone(){const t={opacity:this.opacity,surfaceColor:Te(this.surfaceColor),navigationConstraint:Te(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(t.loadStatus="loaded"),new PZ({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}_loadFromSource(t){const e=this.resourceInfo;return e?this._loadLayersFromJSON(e.data,e.context,t):Promise.resolve()}async _loadLayersFromJSON(t,e,i){const r=e?.origin||"web-scene",s=e?.portal||null,n=e?.url||null,{populateOperationalLayers:a}=await te(async()=>{const{populateOperationalLayers:l}=await import("./layersCreator-i2Z_AdV6.js");return{populateOperationalLayers:l}},__vite__mapDeps([176,117,116,115,118,114,167]));st(i);const o=[];if(t.layers&&Array.isArray(t.layers)){const l={context:{origin:r,url:n,portal:s,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};o.push(a(this.layers,t.layers,l))}await Promise.allSettled(o)}},Hde=uCe,k1e);function Wde(t){return t&&"createElevationSampler"in t}d([m()],dh.prototype,"parent",void 0),d([m()],dh.prototype,"integratedMeshGround",null),d([m({json:{read:!1,write:{isRequired:!0}}})],dh.prototype,"layers",null),d([m()],dh.prototype,"allLayers",void 0),d([Ht("layers")],dh.prototype,"writeLayers",null),d([m({readOnly:!0})],dh.prototype,"resourceInfo",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:qi,read:{reader:$te,source:"transparency"},write:{writer:(t,e)=>{e.transparency=Tte(t)},target:"transparency"}}})],dh.prototype,"opacity",void 0),d([m({type:mt,json:{type:[qi],write:(t,e)=>{e.surfaceColor=t.toJSON().slice(0,3)}}})],dh.prototype,"surfaceColor",void 0),d([m({type:_z,json:{write:!0}})],dh.prototype,"navigationConstraint",void 0),dh=PZ=d([k("esri.Ground")],dh);const ZR=dh,qet="randomUUID"in crypto;function u2(){if(qet)return crypto.randomUUID();const t=crypto.getRandomValues(new Uint16Array(8));t[3]=4095&t[3]|16384,t[4]=16383&t[4]|32768;const e=i=>t[i].toString(16).padStart(4,"0");return e(0)+e(1)+"-"+e(2)+"-"+e(3)+"-"+e(4)+"-"+e(5)+e(6)+e(7)}function xUt(){return`{${u2().toUpperCase()}}`}function SUt(){return`{${u2()}}`}function TUt(t){const e=t.toUpperCase();return t.startsWith("{")?e:`{${e}}`}const pS={Base64:0,Hex:1,String:2,Raw:3},r$=8,hCe=(1<<r$)-1;function E_(t,e){const i=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(i>>16)<<16|65535&i}function Get(t){const e=[];for(let i=0,r=t.length*r$;i<r;i+=r$)e[i>>5]|=(t.charCodeAt(i/r$)&hCe)<<i%32;return e}function Het(t){const e=[];for(let i=0,r=32*t.length;i<r;i+=r$)e.push(String.fromCharCode(t[i>>5]>>>i%32&hCe));return e.join("")}function Wet(t){const e="0123456789abcdef",i=[];for(let r=0,s=4*t.length;r<s;r++)i.push(e.charAt(t[r>>2]>>r%4*8+4&15)+e.charAt(t[r>>2]>>r%4*8&15));return i.join("")}function Zet(t){const i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=[];for(let s=0,n=4*t.length;s<n;s+=3){const a=(t[s>>2]>>s%4*8&255)<<16|(t[s+1>>2]>>(s+1)%4*8&255)<<8|t[s+2>>2]>>(s+2)%4*8&255;for(let o=0;o<4;o++)8*s+6*o>32*t.length?r.push("="):r.push(i.charAt(a>>6*(3-o)&63))}return r.join("")}function Yet(t,e){return t<<e|t>>>32-e}function YU(t,e,i,r,s,n){return E_(Yet(E_(E_(e,t),E_(r,n)),s),i)}function jo(t,e,i,r,s,n,a){return YU(e&i|~e&r,t,e,s,n,a)}function qo(t,e,i,r,s,n,a){return YU(e&r|i&~r,t,e,s,n,a)}function Go(t,e,i,r,s,n,a){return YU(e^i^r,t,e,s,n,a)}function Ho(t,e,i,r,s,n,a){return YU(i^(e|~r),t,e,s,n,a)}function Qet(t,e){t[e>>5]|=128<<e%32,t[14+(e+64>>>9<<4)]=e;let i=1732584193,r=-271733879,s=-1732584194,n=271733878;for(let a=0;a<t.length;a+=16){const o=i,l=r,c=s,h=n;i=jo(i,r,s,n,t[a],7,-680876936),n=jo(n,i,r,s,t[a+1],12,-389564586),s=jo(s,n,i,r,t[a+2],17,606105819),r=jo(r,s,n,i,t[a+3],22,-1044525330),i=jo(i,r,s,n,t[a+4],7,-176418897),n=jo(n,i,r,s,t[a+5],12,1200080426),s=jo(s,n,i,r,t[a+6],17,-1473231341),r=jo(r,s,n,i,t[a+7],22,-45705983),i=jo(i,r,s,n,t[a+8],7,1770035416),n=jo(n,i,r,s,t[a+9],12,-1958414417),s=jo(s,n,i,r,t[a+10],17,-42063),r=jo(r,s,n,i,t[a+11],22,-1990404162),i=jo(i,r,s,n,t[a+12],7,1804603682),n=jo(n,i,r,s,t[a+13],12,-40341101),s=jo(s,n,i,r,t[a+14],17,-1502002290),r=jo(r,s,n,i,t[a+15],22,1236535329),i=qo(i,r,s,n,t[a+1],5,-165796510),n=qo(n,i,r,s,t[a+6],9,-1069501632),s=qo(s,n,i,r,t[a+11],14,643717713),r=qo(r,s,n,i,t[a],20,-373897302),i=qo(i,r,s,n,t[a+5],5,-701558691),n=qo(n,i,r,s,t[a+10],9,38016083),s=qo(s,n,i,r,t[a+15],14,-660478335),r=qo(r,s,n,i,t[a+4],20,-405537848),i=qo(i,r,s,n,t[a+9],5,568446438),n=qo(n,i,r,s,t[a+14],9,-1019803690),s=qo(s,n,i,r,t[a+3],14,-187363961),r=qo(r,s,n,i,t[a+8],20,1163531501),i=qo(i,r,s,n,t[a+13],5,-1444681467),n=qo(n,i,r,s,t[a+2],9,-51403784),s=qo(s,n,i,r,t[a+7],14,1735328473),r=qo(r,s,n,i,t[a+12],20,-1926607734),i=Go(i,r,s,n,t[a+5],4,-378558),n=Go(n,i,r,s,t[a+8],11,-2022574463),s=Go(s,n,i,r,t[a+11],16,1839030562),r=Go(r,s,n,i,t[a+14],23,-35309556),i=Go(i,r,s,n,t[a+1],4,-1530992060),n=Go(n,i,r,s,t[a+4],11,1272893353),s=Go(s,n,i,r,t[a+7],16,-155497632),r=Go(r,s,n,i,t[a+10],23,-1094730640),i=Go(i,r,s,n,t[a+13],4,681279174),n=Go(n,i,r,s,t[a],11,-358537222),s=Go(s,n,i,r,t[a+3],16,-722521979),r=Go(r,s,n,i,t[a+6],23,76029189),i=Go(i,r,s,n,t[a+9],4,-640364487),n=Go(n,i,r,s,t[a+12],11,-421815835),s=Go(s,n,i,r,t[a+15],16,530742520),r=Go(r,s,n,i,t[a+2],23,-995338651),i=Ho(i,r,s,n,t[a],6,-198630844),n=Ho(n,i,r,s,t[a+7],10,1126891415),s=Ho(s,n,i,r,t[a+14],15,-1416354905),r=Ho(r,s,n,i,t[a+5],21,-57434055),i=Ho(i,r,s,n,t[a+12],6,1700485571),n=Ho(n,i,r,s,t[a+3],10,-1894986606),s=Ho(s,n,i,r,t[a+10],15,-1051523),r=Ho(r,s,n,i,t[a+1],21,-2054922799),i=Ho(i,r,s,n,t[a+8],6,1873313359),n=Ho(n,i,r,s,t[a+15],10,-30611744),s=Ho(s,n,i,r,t[a+6],15,-1560198380),r=Ho(r,s,n,i,t[a+13],21,1309151649),i=Ho(i,r,s,n,t[a+4],6,-145523070),n=Ho(n,i,r,s,t[a+11],10,-1120210379),s=Ho(s,n,i,r,t[a+2],15,718787259),r=Ho(r,s,n,i,t[a+9],21,-343485551),i=E_(i,o),r=E_(r,l),s=E_(s,c),n=E_(n,h)}return[i,r,s,n]}function Xet(t,e=pS.Hex){const i=e||pS.Base64,r=Qet(Get(t),t.length*r$);switch(i){case pS.Raw:return r;case pS.Hex:return Wet(r);case pS.String:return Het(r);case pS.Base64:return Zet(r)}}function dCe(t){return t&&"getAtOrigin"in t&&"originOf"in t}function RZ(t){return Cte[Jet(t)]||ett}function Jet(t){return t.type==="json"?"application/json":t.type==="blob"?t.blob.type:Ket(t.url)}function Ket(t){const e=zK(t);return DZ[e]||pCe}const Cte={},pCe="text/plain",ett=Cte[pCe],DZ={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip","bin.gz":"application/octet-stream"};for(const t in DZ)Cte[DZ[t]]=t;function ttt(t){const e=t?.origins??[void 0];return(i,r)=>{const s=itt(t,i,r);for(const n of e){const a=xK(i,n,r);for(const o in s)a[o]=s[o]}}}function itt(t,e,i){if(t?.type==="resource")return rtt(t,e,i);switch(t?.type??"other"){case"other":return{read:!0,write:!0};case"url":{const{read:r,write:s}=N9e;return{read:r,write:s}}}}function rtt(t,e,i){const r=UD(e,i);return{type:String,read:(s,n,a)=>{const o=oU(s,n,a);return r.type===String?o:typeof r.type=="function"?new r.type({url:o}):void 0},write:{isRequired:r.json?.write?.isRequired,writer(s,n,a,o){if(!o?.resources)return typeof s=="string"?void(n[a]=oC(s,o)):void(n[a]=s.write({},o));const l=att(s),c=oC(l,{...o,verifyItemRelativeUrls:o?.verifyItemRelativeUrls?{writtenUrls:o.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},1),h=r.type!==String&&(!dCe(this)||o?.origin&&this.originIdOf(i)>Ug(o.origin)),f={object:this,propertyName:i,value:s,targetUrl:c,dest:n,targetPropertyName:a,context:o,params:t};o?.portalItem&&c&&!Ic(c)?h&&t?.contentAddressed?IZ(f):h?stt(f):ntt(f):o?.portalItem&&(c==null||bxe(c)!=null||Lx(c)||h)?IZ(f):n[a]=c}}}}function IZ(t){const{targetUrl:e,params:i,value:r,context:s,dest:n,targetPropertyName:a}=t;if(!s.portalItem)return;const o=wxe(e),l=mCe(r,e,s);if(i?.contentAddressed&&l.type!=="json")return void s.messages?.push(new ee("persistable:contentAddressingUnsupported",`Property "${a}" is trying to serializing a resource with content of type ${l.type} with content addressing. Content addressing is only supported for json resources.`,{content:l}));const c=i?.contentAddressed&&l.type==="json"?Xet(l.jsonString):o?.filename??u2(),h=Mp(i?.prefix??o?.prefix,c),f=`${h}.${RZ(l)}`;if(i?.contentAddressed&&s.resources&&l.type==="json"){const w=s.resources.toKeep.find(({resource:x})=>x.path===f)??s.resources.toAdd.find(({resource:x})=>x.path===f);if(w)return void(n[a]=w.resource.itemRelativeUrl)}const y=s.portalItem.resourceFromPath(f);Lx(e)&&s.resources&&s.resources.pendingOperations.push(M9e(e).then(w=>{y.path=`${h}.${RZ({type:"blob",blob:w})}`,n[a]=y.itemRelativeUrl}).catch(()=>{}));const _=i?.compress??!1;s.resources&&fCe({...t,resource:y,content:l,compress:_,updates:s.resources.toAdd}),n[a]=y.itemRelativeUrl}function stt(t){const{context:e,targetUrl:i,params:r,value:s,dest:n,targetPropertyName:a}=t;if(!e.portalItem)return;const o=e.portalItem.resourceFromPath(i),l=mCe(s,i,e),c=RZ(l),h=zK(o.path),f=r?.compress??!1;c===h?(e.resources&&fCe({...t,resource:o,content:l,compress:f,updates:e.resources.toUpdate}),n[a]=i):IZ(t)}function ntt({context:t,targetUrl:e,dest:i,targetPropertyName:r}){t.portalItem&&t.resources&&(t.resources.toKeep.push({resource:t.portalItem.resourceFromPath(e),compress:!1}),i[r]=e)}function fCe({object:t,propertyName:e,updates:i,resource:r,content:s,compress:n}){const a=o=>{ott(t,e,o)};i.push({resource:r,content:s,compress:n,finish:a})}function mCe(t,e,i){return typeof t=="string"?{type:"url",url:e}:{type:"json",jsonString:JSON.stringify(t.toJSON(i))}}function att(t){return t==null?null:typeof t=="string"?t:t.url}function ott(t,e,i){typeof t[e]=="string"?t[e]=i.url:t[e].url=i.url}let vz=class extends ur(ke){constructor(e){super(e),this.color=null}};d([m({type:mt,json:{type:[qi],write:!0}})],vz.prototype,"color",void 0),vz=d([k("esri.effects.FocusAreaOutline")],vz);const ltt=vz;var bz;let LZ=bz=class extends Vv(He.ofType(os)){constructor(t){super(t)}clone(){return new bz(this.items.map(t=>t.clone()))}write(t,e){return this.toJSON(e)}toJSON(t){const e=t?.layer?.spatialReference;return e?this.toArray().map(i=>{if(!e.equals(i.spatialReference)){if(!Nu(i.spatialReference,e))return t?.messages?.push(new ay("scenefilter:unsupported","Scene filters with incompatible spatial references are not supported",{modification:this,spatialReference:t.layer.spatialReference,context:t})),null;const s=new os;JTe(i,s,e),i=s}const r=i.toJSON(t);return delete r.spatialReference,r}).filter(i=>i!=null):this.toArray().map(i=>i.toJSON(t))}static fromJSON(t,e){const i=new bz;return t.forEach(r=>i.add(os.fromJSON(r,e))),i}};LZ=bz=d([k("esri.layers.support.PolygonCollection")],LZ);const NP=LZ;let Qm=class extends Vv(Nv){constructor(e){super(e),this.id=`focusarea-${u2()}`,this.title=null,this.enabled=!0,this.outline=null,this.geometries=new NP}readGeometries(e,i,r){Array.isArray(e)?this.geometries=NP.fromJSON(e,r):r.origin!=="web-scene"&&r.origin!=="portal-item"||r.hooks?.onAfterLoad?.(()=>this._loadGeometries(cM(e,r),r))}async _loadGeometries(e,i){const r=await $r(e,{responseType:"json"});this.geometries=NP.fromJSON(r.data,i)}};d([m({type:String,nonNullable:!0,json:{write:!0,origins:{"web-scene":{write:{isRequired:!0}}}}}),m()],Qm.prototype,"id",void 0),d([m({type:String,json:{write:!0}})],Qm.prototype,"title",void 0),d([m({type:Boolean,nonNullable:!0,json:{write:!0,origins:{"web-scene":{write:{isRequired:!0}}}}})],Qm.prototype,"enabled",void 0),d([m({type:ltt,json:{write:!0}})],Qm.prototype,"outline",void 0),d([m({type:NP,nonNullable:!0,json:{write:!0,origins:{"web-scene":{write:{isRequired:!0}}}},clonable:t=>new NP(t.items.map(e=>e.clone()))}),ttt({origins:["web-scene","portal-item"],type:"resource",prefix:"geometries",contentAddressed:!0})],Qm.prototype,"geometries",void 0),d([di(["web-scene","portal-item","service"],"geometries")],Qm.prototype,"readGeometries",null),Qm=d([k("esri.effects.FocusArea")],Qm);const ctt=Qm;let nO=class extends Vv(Nv){constructor(e){super(e),this.areas=new He,this.style="bright"}};d([m({type:He.ofType(ctt),nonNullable:!0,json:{write:!0,origins:{"web-scene":{write:{isRequired:!0}}}},clonable:t=>new He(t.items.map(e=>e.clone()))})],nO.prototype,"areas",void 0),d([m({type:["bright","dark"],nonNullable:!0,json:{write:!0}})],nO.prototype,"style",void 0),nO=d([k("esri.effects.FocusAreas")],nO);const gCe=nO;function utt(t){return typeof t=="object"&&t!=null&&"loaded"in t&&t.loaded===!0&&"type"in t}function yCe(t){return!(!utt(t)||!MJe(t)?.operations?.supportsEditing||"editingEnabled"in t&&!AJe(t)||w$e(t))}function QU(){const t=new Float32Array(16);return t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function htt(t){const e=new Float32Array(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function dtt(t,e,i,r,s,n,a,o,l,c,h,f,y,_,w,x){const S=new Float32Array(16);return S[0]=t,S[1]=e,S[2]=i,S[3]=r,S[4]=s,S[5]=n,S[6]=a,S[7]=o,S[8]=l,S[9]=c,S[10]=h,S[11]=f,S[12]=y,S[13]=_,S[14]=w,S[15]=x,S}const ptt=QU();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:ptt,clone:htt,create:QU,fromValues:dtt},Symbol.toStringTag,{value:"Module"}));const ftt=(t,e)=>{const i=sm(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1);return Ql(i,i)},mtt=(t,e)=>{const i=sm(t,e,0,0,.5-.5*e,0,e,0,.5-.5*e,0,0,e,.5-.5*e,0,0,0,1);return Ql(i,i)},gtt=(t,e)=>{const i=1-e,r=sm(t,.2126+.7874*i,.7152-.7152*i,.0722-.0722*i,0,.2126-.2126*i,.7152+.2848*i,.0722-.0722*i,0,.2126-.2126*i,.7152-.7152*i,.0722+.9278*i,0,0,0,0,1);return Ql(r,r)},ytt=(t,e)=>{const i=Math.sin(e*Math.PI/180),r=Math.cos(e*Math.PI/180),s=sm(t,.213+.787*r-.213*i,.715-.715*r-.715*i,.072-.072*r+.928*i,0,.213-.213*r+.143*i,.715+.285*r+.14*i,.072-.072*r-.283*i,0,.213-.213*r-.787*i,.715-.715*r+.715*i,.072+.928*r+.072*i,0,0,0,0,1);return Ql(s,s)},_tt=(t,e)=>{const i=1-2*e,r=sm(t,i,0,0,e,0,i,0,e,0,0,i,e,0,0,0,1);return Ql(r,r)},vtt=(t,e)=>{const i=sm(t,.213+.787*e,.715-.715*e,.072-.072*e,0,.213-.213*e,.715+.285*e,.072-.072*e,0,.213-.213*e,.715-.715*e,.072+.928*e,0,0,0,0,1);return Ql(i,i)},btt=(t,e)=>{const i=1-e,r=sm(t,.393+.607*i,.769-.769*i,.189-.189*i,0,.349-.349*i,.686+.314*i,.168-.168*i,0,.272-.272*i,.534-.534*i,.131+.869*i,0,0,0,0,1);return Ql(r,r)};let _Ce=class vCe{constructor(e,i,r){this.strength=e,this.radius=i,this.threshold=r,this.type="bloom"}interpolate(e,i,r){this.strength=$c(e.strength,i.strength,r),this.radius=$c(e.radius,i.radius,r),this.threshold=$c(e.threshold,i.threshold,r)}clone(){return new vCe(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:VP(this.radius),strength:this.strength,threshold:this.threshold}}},bCe=class wCe{constructor(e){this.radius=e,this.type="blur"}interpolate(e,i,r){this.radius=Math.round($c(e.radius,i.radius,r))}clone(){return new wCe(this.radius)}toJSON(){return{type:"blur",radius:VP(this.radius)}}},kZ=class xCe{constructor(e,i){this.type=e,this.amount=i,this.type!=="invert"&&this.type!=="grayscale"&&this.type!=="sepia"||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,i,r){this.amount=$c(e.amount,i.amount,r),this._updateMatrix()}clone(){return new xCe(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const e=this._colorMatrix||QU();switch(this.type){case"brightness":this._colorMatrix=ftt(e,this.amount);break;case"contrast":this._colorMatrix=mtt(e,this.amount);break;case"grayscale":this._colorMatrix=gtt(e,this.amount);break;case"invert":this._colorMatrix=_tt(e,this.amount);break;case"saturate":this._colorMatrix=vtt(e,this.amount);break;case"sepia":this._colorMatrix=btt(e,this.amount)}}},SCe=class TCe{constructor(e,i,r,s){this.offsetX=e,this.offsetY=i,this.blurRadius=r,this.color=s,this.type="drop-shadow"}interpolate(e,i,r){this.offsetX=$c(e.offsetX,i.offsetX,r),this.offsetY=$c(e.offsetY,i.offsetY,r),this.blurRadius=$c(e.blurRadius,i.blurRadius,r),this.color[0]=Math.round($c(e.color[0],i.color[0],r)),this.color[1]=Math.round($c(e.color[1],i.color[1],r)),this.color[2]=Math.round($c(e.color[2],i.color[2],r)),this.color[3]=$c(e.color[3],i.color[3],r)}clone(){return new TCe(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const e=[...this.color];return e[3]*=255,{type:"drop-shadow",xoffset:VP(this.offsetX),yoffset:VP(this.offsetY),blurRadius:VP(this.blurRadius),color:e}}},$Ce=class CCe{constructor(e){this.angle=e,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,i,r){this.angle=$c(e.angle,i.angle,r),this._updateMatrix()}clone(){return new CCe(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const e=this._colorMatrix||QU();this._colorMatrix=ytt(e,this.angle)}},MCe=class ECe{constructor(e){this.amount=e,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(e,i,r){this.amount=$c(e.amount,i.amount,r)}clone(){return new ECe(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}};function $c(t,e,i){return t+(e-t)*i}function VP(t){return Math.round(1e3*gv(t))/1e3}function wtt(t){switch(t.type){case"grayscale":case"sepia":case"invert":return new kZ(t.type,0);case"saturate":case"brightness":case"contrast":return new kZ(t.type,1);case"opacity":return new MCe(1);case"hue-rotate":return new $Ce(0);case"blur":return new bCe(0);case"drop-shadow":return new SCe(0,0,0,[...Ste("transparent")]);case"bloom":return new _Ce(0,0,1)}}function xtt(t,e){const i=t.length>e.length?t:e;return(t.length>e.length?e:t).every((r,s)=>r.type===i[s].type)}function Stt(t,e){const i=t.length>e.length?t:e,r=t.length>e.length?e:t;for(let s=r.length;s<i.length;s++)r.push(wtt(i[s]))}function Ttt(t){const e=t[0];return!!e&&"type"in e}function $tt(t,e){return JSON.stringify(t??null)===JSON.stringify(e??null)}function EUt(t,e){return t.allLayerViews.find(r=>r.uid===e)?.layer.parent===t.map?.basemap}function Zde(t){return!!t?.baseLayers.concat(t.referenceLayers).some(Ctt)}function Ctt(t){if(Yde(t.url))return!0;if(t.type==="vector-tile")for(const e in t.sourceNameToSource){const i=t.sourceNameToSource[e];if(Yde(i?.sourceUrl))return!0}return!1}const Mtt=/^(basemaps|ibasemaps).*-api\.arcgis\.com$/i;function Yde(t){if(!t)return!1;const e=new _w(Tu(t));return!!e.authority&&Mtt.test(e.authority)}function Qde(t){return{type:t.type,effect:"effect"in t?t.effect:void 0,url:Att("urlTemplate"in t&&t.urlTemplate||t.url||"styleUrl"in t&&t.styleUrl||""),minScale:"minScale"in t&&t.minScale!=null?t.minScale:0,maxScale:"maxScale"in t&&t.maxScale!=null?t.maxScale:0,opacity:t.opacity!=null?t.opacity:1,visible:t.visible==null||!!t.visible,sublayers:t.type!=="map-image"&&t.type!=="wms"||t.sublayers==null?void 0:t.sublayers?.map(e=>({id:e.id,visible:e.visible})),activeLayerId:t.type==="wmts"?t.activeLayer?.id:void 0}}function Ett(t,e){if(t.type!==e.type||t.url!==e.url||t.minScale!==e.minScale||t.maxScale!==e.maxScale||t.visible!==e.visible||t.opacity!==e.opacity||!$tt(t.effect,e.effect))return!1;if(t.activeLayerId!=null||e.activeLayerId!=null)return t.activeLayerId===e.activeLayerId;if(t.sublayers!=null||e.sublayers!=null){if(t.sublayers==null||e.sublayers==null||t.sublayers.length!==e.sublayers.length)return!1;for(let i=0;i<t.sublayers.length;i++){const r=t.sublayers.at(i),s=e.sublayers.at(i);if(r?.id!==s?.id||r?.visible!==s?.visible)return!1}}return!0}function Att(t){return t?Jg(t).replace(/^\s*https?:/i,"").toLowerCase():""}const T7=()=>fe.getLogger("esri.support.basemapUtils");function Ott(){return{}}function Ptt(t){for(const e in t){const i=t[e];i&&!i.destroyed&&i.destroy(),delete t[e]}}function Mte(t,e){let i;if(typeof t=="string"){const r=t in AZ,s=!r&&t.includes("/");if(!r&&!s){if(wW())T7().warn(`Unable to find basemap definition for: ${t}. See available styles at https://developers.arcgis.com/rest/basemap-styles/`);else{const n=Object.entries(AZ).filter(([a,o])=>o.classic||o.is3d).map(([a])=>`"${a}"`).sort().join(", ");T7().warn(`Unable to find basemap definition for: ${t}. Try one of these: ${n}`)}return null}e&&(i=e[t]),i||(i=r?t$.fromId(t):new t$({style:{id:t}}),e&&(e[t]=i))}else i=Ca(t$,t);return i?.destroyed&&(T7().warn("The provided basemap is already destroyed",{basemap:i}),i=null),i}function Rtt(t,e=null){const i=Mte(t);if(!i)return null;const r=i.clone();return e&&(r.baseLayers=Xde(r.baseLayers,e.baseLayers),r.referenceLayers=Xde(r.referenceLayers,e.referenceLayers)),r}function Xde(t,e){const i=new He;return t.forEach(r=>{const s=e.find(n=>n.type!=="scene"&&Ett(Qde(r),Qde(n)))||r;i.includes(s)?i.push(r):i.push(s)}),i}function Dtt(t){return new Jd({getCollections:()=>[t.tables,t.layers],getChildrenFunction:e=>{const i=[];return"tables"in e&&i.push(e.tables),"layers"in e&&i.push(e.layers),i},itemFilterFunction:e=>{const i=e.parent;return!!i&&"tables"in i&&i.tables.includes(e)}})}function I5(t){for(const e of t.values())e?.destroy();t.clear()}const Jde={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function Itt(t){let e=null;if(typeof t=="string")if(t in Jde){const i=Jde[t];e=new ZR({resourceInfo:{data:{layers:[i]}}})}else fe.getLogger("esri.support.groundUtils").warn(`Unable to find ground definition for: ${t}. Try "world-elevation"`);else e=Ca(ZR,t);return e}function zZ(t,e,i){let r,s;if(t)for(let n=0,a=t.length;n<a;n++){if(r=t.at(n),r?.[e]===i)return r;if(r?.type==="group"&&(s=zZ(r.layers,e,i),s))return s}}const Ltt=t=>{const e=t;let i=class extends e{constructor(...r){super(...r),this.layers=new He;const s=o=>{o.parent&&o.removeFromParent()},n=o=>{o.parent=this,this.layerAdded(o),o.type!=="elevation"&&o.type!=="base-elevation"||fe.getLogger(this).error(`Layer 'title:${o.title}, id:${o.id}' of type '${o.type}' is not supported as an operational layer and will therefore be ignored.`)},a=o=>{o.parent=null,this.layerRemoved(o)};this.addHandles([this.layers.on("before-add",o=>{if(o.item===this)return o.preventDefault(),void fe.getLogger(this).error("#add()","Cannot add layer to itself.");s(o.item)}),this.layers.on("after-add",o=>n(o.item)),this.layers.on("after-remove",o=>a(o.item))])}destroy(){const r=this.layers.toArray();for(const s of r)s.destroy();this.layers.destroy()}removeChildLayer(r){this.layers.remove(r),super.removeChildLayer?.(r)}set layers(r){this._set("layers",kc(r,this._get("layers")))}add(r,s){const n=this.layers;if(s=n.getNextIndex(s),r instanceof Ms){const a=r;a.parent===this?this.reorder(a,s):n.add(a,s)}else $a(r)?r.then(a=>{this.destroyed||this.add(a,s)}):fe.getLogger(this).error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(r,s){const n=this.layers;let a=n.getNextIndex(s);r.slice().forEach(o=>{o.parent!==this?(n.add(o,a),a+=1):this.reorder(o,a)})}findLayerById(r){return zZ(this.layers,"id",r)}findLayerByUid(r){return zZ(this.layers,"uid",r)}remove(r){return this.layers.remove(r)}removeMany(r){return this.layers.removeMany(r)}removeAll(){return this.layers.removeAll()}reorder(r,s){return this.layers.reorder(r,s)}layerAdded(r){}layerRemoved(r){}};return d([m()],i.prototype,"layers",null),i=d([k("esri.support.LayersMixin")],i),i},ktt=new Set(["feature","subtype-group"]);function FZ(t,e,i){if(t)for(let r=0,s=t.length;r<s;r++){const n=t.at(r);if(n[e]===i)return n;if(n?.type==="group"){const a=FZ(n.tables,e,i);if(a)return a}}}const ztt=t=>{const e=t;let i=class extends e{constructor(...r){super(...r),this.tables=new He,this.addHandles([this.tables.on("after-add",s=>{const n=s.item;n.parent&&n.parent!==this&&n.removeFromParent(),n.parent=this,ktt.has(n.type)||fe.getLogger(this).error(`Layer 'title:${n.title}, id:${n.id}' of type '${n.type}' is not supported as a table and will therefore be ignored.`)}),this.tables.on("after-remove",s=>{s.item.parent=null})])}destroy(){const r=this.tables.toArray();for(const s of r)s.destroy();this.tables.destroy()}removeChildLayer(r){this.tables.remove(r),super.removeChildLayer?.(r)}set tables(r){this._set("tables",kc(r,this._get("tables")))}findTableById(r){return FZ(this.tables,"id",r)}findTableByUid(r){return FZ(this.tables,"uid",r)}};return d([m()],i.prototype,"tables",null),i=d([k("esri.support.TablesMixin")],i),i};let ph=class extends ztt(Ltt(Uc)){constructor(e){super(e),this.allLayers=new Jd({getCollections:()=>[this.basemap?.baseLayers,this.basemap?.groundLayers,this.ground?.layers,this.layers,this.basemap?.referenceLayers],getChildrenFunction:i=>"layers"in i?i.layers:null}),this.focusAreas=new gCe,this.allTables=Dtt(this),this.basemap=null,this.editableLayers=new Jd({getCollections:()=>[this.allLayers],itemFilterFunction:yCe}),this.ground=new ZR,this._basemapCache=Ott(),this.addHandles(Zs(()=>this.ground,(i,r)=>{r?.parent===this&&(r.parent=null),i.parent=this},{sync:!0}))}destroy(){Ptt(this._basemapCache),this._basemapCache=null,this.focusAreas.destroy(),this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),this.basemap=Re(this.basemap),Re(this.ground),this._set("ground",null)}castBasemap(e){return Mte(e,this._basemapCache)}castGround(e){return Itt(e)??this._get("ground")}findLayerById(e){return this.allLayers.find(i=>i.id===e)}findTableById(e){return this.allTables.find(i=>i.id===e)}};d([m({readOnly:!0,dependsOn:[]})],ph.prototype,"allLayers",void 0),d([m({type:gCe,nonNullable:!0,json:{write:{overridePolicy:t=>({enabled:t.areas.length>0,ignoreOrigin:!0})}}})],ph.prototype,"focusAreas",void 0),d([m({readOnly:!0})],ph.prototype,"allTables",void 0),d([m({type:t$,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],ph.prototype,"basemap",void 0),d([qr("basemap")],ph.prototype,"castBasemap",null),d([m({readOnly:!0})],ph.prototype,"editableLayers",void 0),d([m({type:ZR,nonNullable:!0})],ph.prototype,"ground",void 0),d([qr("ground")],ph.prototype,"castGround",null),d([m()],ph.prototype,"undoRedo",void 0),ph=d([k("esri.Map")],ph);const ACe=ph;function fS(t){return typeof t=="number"}function OUt(t){return typeof t=="number"&&isFinite(t)&&Math.floor(t)===t}function PUt(t){return typeof t=="boolean"}function Wv(t){return typeof t=="string"||t instanceof String}function OCe(t){return t==null||Wv(t)}function RUt(t){return Array.isArray(t)}function DUt(t){return t?.declaredClass==="esri.Graphic"}function IUt(t){return t instanceof Date}const Ftt="HH:mm",Ntt="HH:mm:ss",Vtt="HH:mm:ss.SSS",Utt=[Vtt,Ntt,Ftt,"TT"],Btt="yyyy-MM-dd";function Kde(t){if(!t||!Wv(t))return null;const e=lt.fromFormat(t,Btt);return e.isValid?e:null}function epe(t){return t&&Wv(t)?nBe(Utt,e=>{const i=lt.fromFormat(t,e);return i.isValid?i:null})??null:null}function tpe(t){if(!t||!Wv(t))return null;const e=lt.fromISO(t);return e.isValid?e:null}const PCe=new Set(["integer","small-integer","long","big-integer","esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeLong","esriFieldTypeBigInteger"]);function jtt(t){return t!=null&&PCe.has(t.type)}function RCe(t){return t!=null&&(t.type==="date-only"||t.type==="esriFieldTypeDateOnly")}function DCe(t){return t!=null&&(t.type==="timestamp-offset"||t.type==="esriFieldTypeTimestampOffset")}function ICe(t){return t!=null&&(t.type==="time-only"||t.type==="esriFieldTypeTimeOnly")}const qtt=new Set(["single","double","esriFieldTypeSingle","esriFieldTypeDouble"]);_K(PCe,qtt);function Gtt(t,e){const i=t?.domain;if(!i||i.type!=="range")return;const r="range"in i?i.range[0]:i.minValue,s="range"in i?i.range[1]:i.maxValue,n=jtt(t);return RCe(t)||ICe(t)||DCe(t)?{...Htt(t,s,r),isInteger:n}:{min:r!=null&&typeof r=="number"?r:null,max:s!=null&&typeof s=="number"?s:null,rawMin:r,rawMax:s,isInteger:n}}function Htt(t,e,i){return RCe(t)?{min:Kde(i)?.toMillis(),max:Kde(e)?.toMillis(),rawMin:i,rawMax:e}:ICe(t)?{min:epe(i)?.toMillis(),max:epe(e)?.toMillis(),rawMin:i,rawMax:e}:DCe(t)?{min:tpe(i)?.toMillis(),max:tpe(e)?.toMillis(),rawMin:i,rawMax:e}:{max:null,min:null}}function LCe(t){if(!t)return;const e=t.match(Wtt);return e?.groups?e.groups.doubleQuoted??e.groups.singleQuoted??e.groups.dotNotation:void 0}const Wtt=/^(\$feature\[(?:"(?<doubleQuoted>[^"]+)"|'(?<singleQuoted>[^']+)')\]|\$feature\.(?<dotNotation>[a-z_][a-z0-9_]*))$/i;function LUt(t){return t.match(Ztt)?.[1]?.replaceAll("\\'","'")??null}const Ztt=/^hash\(\$feature\['((\\'|[^'])+)'\]\) \* 8\.381e-8$/;let $7;function Ete(){return $7||($7=(async()=>{const[t,e,i]=await Promise.all([te(()=>import("./arcadeUtils-Cd2Zxk3x.js"),__vite__mapDeps([177,178,179,180,181,130,22,182,183,184,1,48,185,186,131,132,187])),te(()=>import("./batchExec-D5eBKOxd.js"),__vite__mapDeps([188,60])),te(()=>import("./aiServices-BzS84jLp.js").then(r=>r.a),__vite__mapDeps([183,180,181,130,22,184,179]))]);return{arcade:t.arcade,arcadeUtils:t,batchExec:e,aiServices:i,Dictionary:t.Dictionary,Feature:t.arcadeFeature,Voxel:t.Voxel,Pixel:t.Pixel}})()),$7}const Ytt=/^([0-9_])/,Qtt=/[^a-z0-9_\u0080-\uffff]+/gi;function Xtt(t){return t==null?null:t.trim().replaceAll(Qtt,"_").replace(Ytt,"F$1")||null}const Jtt=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],Ktt=["field","normalizationField"];function kUt(t,e){if(t!=null&&e!=null){for(const i of Array.isArray(t)?t:[t])if(ipe(Jtt,i,e),"visualVariables"in i&&i.visualVariables)for(const r of i.visualVariables)ipe(Ktt,r,e)}}function ipe(t,e,i){if(t)for(const r of t){const s=zD(r,e),n=s&&typeof s!="function"&&i.get(s);n&&Uf(r,n.name,e)}}function zUt(t,e){if(t!=null&&e?.fields?.length)if("startField"in t){const i=e.get(t.startField),r=e.get(t.endField);t.startField=i?.name??null,t.endField=r?.name??null}else{const i=e.get(t.startTimeField),r=e.get(t.endTimeField);t.startTimeField=i?.name??null,t.endTimeField=r?.name??null}}const C7=new Set;function Ate(t,e){return t&&e?(C7.clear(),YR(C7,t,e),Array.from(C7).sort()):[]}function YR(t,e,i){if(i)if(e?.fields?.length)if(i.includes("*"))for(const{name:r}of e.fields)t.add(r);else for(const r of i)QR(t,e,r);else{if(i.includes("*"))return t.clear(),void t.add("*");for(const r of i)r!=null&&t.add(r)}}function QR(t,e,i){if(typeof i=="string")if(e){const r=e.get(i);r&&t.add(r.name)}else t.add(i)}function FUt(t,e){return e==null||t==null?[]:e.includes("*")?(t.fields??[]).map(i=>i.name):e}function NUt(t,e,i=1){if(!e||!t)return[];if(e.includes("*"))return["*"];const r=Ate(t,e);return r.length/t.fields.length>=i?["*"]:r}async function Ev(t,e,i,r){if(!r)return;const s=LCe(r);if(s)QR(t,e,s);else{const{arcadeUtils:n}=await Ete(),a=n.extractFieldNames(r,i?.partitions??e?.fields?.map(o=>o.name));for(const o of a)QR(t,i?.index??e,o)}}async function Ote(t,e,i){if(i&&i!=="1=1"){const r=await nSe(i,e);if(!r.isStandardized)throw new ee("fieldUtils:collectFilterFields","Where clause is not standardized",{where:i});YR(t,e,r.fieldNames)}}function VUt({displayField:t,fields:e}){return t||(e?.length?eit(e):null)}function eit(t){return M7(t,"name-or-title")||M7(t,"unique-identifier")||M7(t,"type-or-category")||tit(t)}function tit(t){for(const e of t){if(!e?.name)continue;const i=e.name.toLowerCase();if(i.includes("name")||i.includes("title"))return e.name}return null}function M7(t,e){for(const i of t)if(i?.valueType&&i.valueType===e)return i.name;return null}async function UUt(t,e){if(!e)return;const i=e.elevationInfo?.featureExpressionInfo;return i?i.collectRequiredFields(t,e.fieldsIndex):void 0}function iit(t,e,i){i.onStatisticExpression?Ev(t,e,null,i.onStatisticExpression.expression):t.add(i.onStatisticField)}async function BUt(t,e,i){if(!e||!i||!("fields"in i))return;const r=[],s=i.popupTemplate;r.push(kCe(t,e,s)),i.fields&&r.push(...i.fields.map(async n=>iit(t,e.fieldsIndex,n))),await Promise.all(r)}async function jUt(t,e){const{fieldsIndex:i,trackInfo:r}=e;if(!e||!r||!i)return;const s=[r.latestObservations.renderer?.collectRequiredFields(t,i),r.previousObservations.renderer?.collectRequiredFields(t,i),r.trackLines.renderer?.collectRequiredFields(t,i)];r.popupTemplate&&s.push(kCe(t,e,r.popupTemplate));for(const n of[r.latestObservations.labelingInfo,r.previousObservations.labelingInfo,r.trackLines.labelingInfo])if(n)for(const a of n)s.push(NCe(t,i,a));await Promise.all(s)}async function kCe(t,e,i){const r=[];i?.expressionInfos&&r.push(...i.expressionInfos.map(n=>Ev(t,e.fieldsIndex,null,n.expression)));const s=i?.content;if(Array.isArray(s))for(const n of s)n.type==="expression"&&n.expressionInfo&&r.push(Ev(t,e.fieldsIndex,null,n.expressionInfo.expression));await Promise.all(r)}async function qUt(t,e,i){e&&(e.timeInfo&&i?.timeExtent&&YR(t,e.fieldsIndex,[e.timeInfo.startField,e.timeInfo.endField]),e.floorInfo&&YR(t,e.fieldsIndex,[e.floorInfo.floorField]),i?.where!=null&&await Ote(t,e.fieldsIndex,i.where))}async function GUt(t,e,i){e&&i&&await Promise.all(i.map(r=>rit(t,e,r)))}async function rit(t,e,i){e&&i&&(i.valueExpression?await Ev(t,e.fieldsIndex,null,i.valueExpression):i.field&&QR(t,e.fieldsIndex,i.field))}function HUt(t){return t?Ate(t.fieldsIndex,zCe(t)):[]}function sit(t){if(!t)return[];const e=t.geometryFieldsInfo;return e?Ate(t.fieldsIndex,[e.shapeAreaField,e.shapeLengthField]):[]}async function WUt(t,e,i){if(!e||!i)return;const r=e.fieldsIndex;await Promise.all(i.filters.map(s=>Ote(t,r,s.where)))}const nit=new Set(["oid","global-id","guid"]),ait=new Set(["oid","global-id"]),oit=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^shape$/i,/^shape_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/objectid/i,/^perimeter_/i,/_perimeter$/i,/_i$/i];function lit(t){const e=new Set;FCe(t).forEach(r=>e.add(r)),sit(t).forEach(r=>e.add(r.toLowerCase()));const i=t&&"infoFor3D"in t?t.infoFor3D:void 0;return i&&(Object.values(i.assetMapFieldRoles).forEach(r=>e.add(r.toLowerCase())),Object.values(i.transformFieldRoles).forEach(r=>e.add(r.toLowerCase()))),Array.from(e)}function zCe(t){if(!t)return[];const e="editFieldsInfo"in t&&t.editFieldsInfo;if(!e)return[];const{creationDateField:i,creatorField:r,editDateField:s,editorField:n}=e;return[i,r,s,n].filter(Boolean)}function FCe(t){return zCe(t).map(e=>e.toLowerCase())}function ZUt(t,e){return t.editable&&!nit.has(t.type)&&!FCe(e).includes(t.name?.toLowerCase()??"")}function YUt(t,e){const i=t.name?.toLowerCase()??"";return!(e?.objectIdField!=null&&i===e.objectIdField.toLowerCase()||e?.globalIdField!=null&&i===e.globalIdField.toLowerCase()||lit(e).includes(i)||ait.has(t.type)||oit.some(r=>r.test(i)))}async function QUt(t,e){const{labelingInfo:i,fieldsIndex:r}=e;i?.length&&await Promise.all(i.map(s=>NCe(t,r,s)))}async function NCe(t,e,i){if(!i)return;const r=i.getLabelExpression(),s=i.where;if(r.type==="arcade")await Ev(t,e,null,r.expression);else{const n=r.expression.match(/{[^}]*}/g);n&&n.forEach(a=>{QR(t,e,a.slice(1,-1))})}await Ote(t,e,s)}function cit(t){const e=t.defaultValue;return e!==void 0&&UCe(t,e)?e:t.nullable?null:void 0}function XUt(t){const e=typeof t=="string"?{type:t}:t;return jCe(e)?255:e.type==="esriFieldTypeDate"||e.type==="date"?8:void 0}function VCe(t){return typeof t=="number"&&!isNaN(t)&&isFinite(t)}function uit(t){return t===null||VCe(t)}function hit(t){return t===null||Number.isInteger(t)}function dit(){return!0}function UCe(t,e){let i;switch(t.type){case"date":case"integer":case"long":case"small-integer":case"big-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":case"esriFieldTypeBigInteger":i=t.nullable?hit:Number.isInteger;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":i=t.nullable?uit:VCe;break;case"string":case"esriFieldTypeString":i=t.nullable?OCe:Wv;break;default:i=dit}return arguments.length===1?i:i(e)}const pit=["integer","small-integer","big-integer","long"],fit=["single","double"],mit=["esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeLong","esriFieldTypeBigInteger"],git=["esriFieldTypeSingle","esriFieldTypeDouble"],BCe=new Set([...pit,...mit]),yit=new Set([...fit,...git]),_it=_K(BCe,yit);function vit(t){return t!=null&&BCe.has(t.type)}function l4(t){return t!=null&&_it.has(t.type)}function jCe(t){return t!=null&&(t.type==="string"||t.type==="esriFieldTypeString")}function Pte(t){return t!=null&&(t.type==="date"||t.type==="esriFieldTypeDate")}function bit(t){return t!=null&&(t.type==="date-only"||t.type==="esriFieldTypeDateOnly")}function wit(t){return t!=null&&(t.type==="timestamp-offset"||t.type==="esriFieldTypeTimestampOffset")}function qCe(t){return t!=null&&(t.type==="time-only"||t.type==="esriFieldTypeTimeOnly")}function rpe(t){return t!=null&&(t.type==="oid"||t.type==="esriFieldTypeOID")}function spe(t){return t!=null&&(t.type==="global-id"||t.type==="esriFieldTypeGlobalID")}function JUt(t,e){return xit(t,e)===null}function KUt(t){return t==null||typeof t=="number"&&isNaN(t)?null:t}function xit(t,e){return t==null||t.nullable&&e===null?null:UCe(t,e)?l4(t)&&!Sit(t.type,Number(e))?"numeric-range-validation-error::out-of-range":null:"type-validation-error::invalid-type"}function Sit(t,e){const i=typeof t=="string"?GCe(t):t;if(!i)return!1;const r=i.min,s=i.max;return i.isInteger?Number.isInteger(e)&&e>=r&&e<=s:e>=r&&e<=s}function GCe(t){switch(t){case"esriFieldTypeSmallInteger":case"small-integer":return Tit;case"esriFieldTypeInteger":case"esriFieldTypeLong":case"integer":case"long":return $it;case"esriFieldTypeBigInteger":case"big-integer":return Cit;case"esriFieldTypeSingle":case"single":return Mit;case"esriFieldTypeDouble":case"double":return Eit}}const Tit={min:-32768,max:32767,isInteger:!0,rawMin:-32768,rawMax:32767},$it={min:-2147483648,max:2147483647,isInteger:!0,rawMin:-2147483648,rawMax:2147483647},Cit={min:-Number.MAX_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER,isInteger:!0,rawMin:-Number.MAX_SAFE_INTEGER,rawMax:Number.MAX_SAFE_INTEGER},L5=(2-2**-23)*2**127,Mit={min:-L5,max:L5,isInteger:!1,rawMin:-L5,rawMax:L5},Eit={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1,rawMin:-Number.MAX_VALUE,rawMax:Number.MAX_VALUE};function e8t(t,e,i){switch(t){case"domain-validation-error::invalid-coded-value":return`Value ${i} is not in the coded domain - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case"domain-validation-error::value-out-of-range":return`Value ${i} is out of the range of valid values - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case"type-validation-error::invalid-type":return`Value ${i} is not a valid value for the field type - field: ${e.name}, type: ${e.type}, nullable: ${e.nullable}`;case"numeric-range-validation-error::out-of-range":{const{min:r,max:s}=GCe(e.type);return`Value ${i} is out of range for the number type - field: ${e.name}, type: ${e.type}, value range is ${r} to ${s}`}}}function t8t(t,e){return!Ait(t,e,null)}function Ait(t,e,i){if(!t?.attributes||!e){if(i!=null)for(const n of e??[])i.add(n);return!0}const r=new Set(Object.keys(t.attributes));let s=!1;for(const n of e)if(!r.has(n)){if(s=!0,i==null)break;i.add(n)}return s}function i8t(t){return!!t&&["raster.itempixelvalue","raster.servicepixelvalue"].some(e=>t.toLowerCase().startsWith(e))}function Oit(t){const e=t?.match(/{[^}]+}/g);return e?e.map(i=>i.slice(1,-1).split(":")[0].trim()):[]}let wz=class extends ke{constructor(e){super(e),this.type=null}};d([m({type:["attachments","custom","fields","media","text","expression","relationship","utility-network-associations"],readOnly:!0,json:{read:!1,write:!0}})],wz.prototype,"type",void 0),wz=d([k("esri.popup.content.Content")],wz);const Dy=wz,k5=new ta({asc:"ascending",desc:"descending"});let aO=class extends ur(ke){constructor(e){super(e),this.field=null,this.order="ascending"}};d([m({type:String,json:{write:!0}})],aO.prototype,"field",void 0),d([m({type:k5.apiValues,json:{type:k5.jsonValues,read:k5.read,write:k5.write}})],aO.prototype,"order",void 0),aO=d([k("esri.popup.support.AttachmentsOrderByInfo")],aO);const Pit=aO;let sf=class extends ur(Dy){constructor(e){super(e),this.attachmentKeywords=null,this.attachmentTypes=null,this.description=null,this.displayType="auto",this.orderByFields=null,this.title=null,this.type="attachments"}};d([m({type:[String],json:{write:!0}})],sf.prototype,"attachmentKeywords",void 0),d([m({type:[["application","audio","image","model","text","video"]],json:{write:!0}})],sf.prototype,"attachmentTypes",void 0),d([m({type:String,json:{write:!0}})],sf.prototype,"description",void 0),d([m({type:["auto","preview","list"],json:{write:!0}})],sf.prototype,"displayType",void 0),d([m({type:[Pit],json:{write:!0}})],sf.prototype,"orderByFields",void 0),d([m({type:String,json:{write:!0}})],sf.prototype,"title",void 0),d([m({type:["attachments"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],sf.prototype,"type",void 0),sf=d([k("esri.popup.content.AttachmentsContent")],sf);const XR=sf;var NZ;let tb=NZ=class extends Dy{constructor(t){super(t),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new NZ({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?Te(this.outFields):null})}};d([m()],tb.prototype,"creator",void 0),d([m()],tb.prototype,"destroyer",void 0),d([m()],tb.prototype,"outFields",void 0),d([m({type:["custom"],readOnly:!0})],tb.prototype,"type",void 0),tb=NZ=d([k("esri.popup.content.CustomContent")],tb);const Rit=tb;var VZ;let uT=VZ=class extends ke{constructor(t){super(t),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new VZ({title:this.title,expression:this.expression})}};d([m({type:String,json:{write:!0}})],uT.prototype,"title",void 0),d([m({type:String,json:{write:!0}})],uT.prototype,"expression",void 0),d([m({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],uT.prototype,"returnType",void 0),uT=VZ=d([k("esri.popup.ElementExpressionInfo")],uT);const Dit=uT;var UZ;let oO=UZ=class extends Dy{constructor(t){super(t),this.expressionInfo=null,this.type="expression"}clone(){return new UZ({expressionInfo:this.expressionInfo?.clone()})}};d([m({type:Dit,json:{write:!0}})],oO.prototype,"expressionInfo",void 0),d([m({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],oO.prototype,"type",void 0),oO=UZ=d([k("esri.popup.content.ExpressionContent")],oO);const XU=oO;let xz=class extends ur(ke){constructor(e){super(e),this.type=null}};d([m({type:["date-time","number"],nonNullable:!0,readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],xz.prototype,"type",void 0),xz=d([k("esri.layers.support.FieldFormat")],xz);const Rte=xz,HCe="auto";let Xm=class extends Rte{constructor(e){super(e),this.dateStyle=null,this.hour12=HCe,this.month=null,this.timeStyle=null,this.type="date-time",this.year=null}};d([m({type:["full","long","medium","short"],json:{write:!0}})],Xm.prototype,"dateStyle",void 0),d([m({type:["always","auto","never"],nonNullable:!0,json:{default:HCe,write:!0}})],Xm.prototype,"hour12",void 0),d([m({type:["long","short"],json:{write:!0}})],Xm.prototype,"month",void 0),d([m({type:["full","long","medium","short"],json:{write:!0}})],Xm.prototype,"timeStyle",void 0),d([m({type:["date-time"]})],Xm.prototype,"type",void 0),d([m({type:["numeric"],json:{write:!0}})],Xm.prototype,"year",void 0),Xm=d([k("esri.layers.support.DateTimeFieldFormat")],Xm);const Mw=Xm,npe={min:0,max:20},WCe=2,ZCe=0,YCe="decimal",QCe="auto";let G0=class extends Rte{constructor(e){super(e),this.maximumFractionDigits=WCe,this.minimumFractionDigits=ZCe,this.style=YCe,this.type="number",this.useGrouping=QCe}};d([m({type:qi,nonNullable:!0,range:npe,json:{default:WCe,write:!0}})],G0.prototype,"maximumFractionDigits",void 0),d([m({type:qi,nonNullable:!0,range:npe,json:{default:ZCe,write:!0}})],G0.prototype,"minimumFractionDigits",void 0),d([m({type:["decimal"],nonNullable:!0,json:{default:YCe,write:!0}})],G0.prototype,"style",void 0),d([m({type:["number"]})],G0.prototype,"type",void 0),d([m({type:["always","auto","never"],nonNullable:!0,json:{default:QCe,write:!0}})],G0.prototype,"useGrouping",void 0),G0=d([k("esri.layers.support.NumberFieldFormat")],G0);const x6=G0;let hT=class extends ur(ke){constructor(e){super(e),this.dateFormat=null,this.digitSeparator=!1,this.places=null}};d([Et(OZe)],hT.prototype,"dateFormat",void 0),d([m({type:Boolean,json:{write:!0}})],hT.prototype,"digitSeparator",void 0),d([m({type:qi,json:{write:!0}})],hT.prototype,"places",void 0),hT=d([k("esri.popup.support.FieldInfoFormat")],hT);const bM=hT,Iit={base:Rte,key:"type",errorContext:"field-configuration-field-format",typeMap:{"date-time":Mw,number:x6}};function u8t(t,e){const{format:i}=t;return e&&JU(e)?i?XCe(i,e):Sz(e,{hour12:"always",useGrouping:"always"}):null}function XCe(t,e){const{dateFormat:i}=t;if(!e)return i?ope(t):ape(t);if(!JU(e))return;const r={hour12:"always"};switch(e.type){case"integer":case"small-integer":case"big-integer":case"long":return JCe(t);case"single":case"double":return ape(t);case"date":case"timestamp-offset":return i?ope(t):Sz(e,r);case"date-only":return i?Lit(t):Sz(e);case"time-only":return i?kit(t):Sz(e,r)}}function JU(t){return l4(t)||Pte(t)||bit(t)||qCe(t)||wit(t)}function JCe(t){return new x6({useGrouping:t.digitSeparator?"always":"never"})}function ape(t){const e=JCe(t),{places:i}=t;return e.minimumFractionDigits=i??0,e.maximumFractionDigits=i??2,e}function ope(t){return new Mw({dateStyle:KCe(t),year:rMe(t),month:tMe(t),timeStyle:iMe(t),hour12:eMe(t)})}function Lit(t){return new Mw({dateStyle:KCe(t),year:rMe(t),month:tMe(t)})}function kit(t){return new Mw({timeStyle:iMe(t),hour12:eMe(t)})}function KCe(t){const{dateFormat:e}=t;return e?e.startsWith("short-date")?"short":e.startsWith("day-short-month-year")?"medium":e.startsWith("long-month-day-year")?"long":e.startsWith("long-date")?"full":null:null}function eMe(t){return t.dateFormat?.endsWith("-24")?"never":"always"}function tMe(t){switch(t.dateFormat){case"short-month-year":return"short";case"long-month-year":return"long";default:return null}}function iMe(t){const{dateFormat:e}=t;return e?e.includes("short-time")?"short":e.includes("long-time")?"medium":null:null}function rMe(t){switch(t.dateFormat){case"short-month-year":case"long-month-year":case"year":return"numeric";default:return null}}function zit(t,e){const i=t.type==="number",r=t.type==="date-time";if(!e)return i?lpe(t):r?cpe(t):null;if(JU(e))switch(e.type){case"integer":case"small-integer":case"big-integer":case"long":return i?sMe(t):null;case"single":case"double":return i?lpe(t):null;case"date":case"timestamp-offset":return r?cpe(t):null;case"date-only":return r?Fit(t):null;case"time-only":return r?Nit(t):null}}function sMe(t){return new bM({digitSeparator:t.useGrouping!=="never"})}function lpe(t){const e=sMe(t);return e.places=t.maximumFractionDigits,e}function cpe(t){let e;const i=nMe(t),r=aMe(t),s=t.hour12==="never"?"24":null,n=t.year==="numeric"?"year":null,a=oMe(t);return i&&r&&s?e=`${i}-${r}-${s}`:i&&r?e=`${i}-${r}`:i?e=i:n&&a?e=`${a}-${n}`:n&&(e=n),e?new bM({dateFormat:e}):null}function Fit(t){let e;const i=nMe(t),r=t.year==="numeric"?"year":null,s=oMe(t);return i?e=i:r&&s?e=`${s}-${r}`:r&&(e=r),e?new bM({dateFormat:e}):null}function Nit(t){let e;const i=aMe(t),r=t.hour12==="never"?"24":null;return i&&r?e=`short-date-${i}-${r}`:i&&(e=`short-date-${i}`),e?new bM({dateFormat:e}):null}function nMe(t){switch(t.dateStyle){case"short":return"short-date";case"medium":return"day-short-month-year";case"long":return"long-month-day-year";case"full":return"long-date";default:return}}function aMe(t){return t.timeStyle&&(t.timeStyle==="short"?"short-time":"long-time")}function oMe(t){switch(t.month){case"short":return"short-month";case"long":return"long-month";default:return}}function Sz(t,e){if(!JU(t))return;const i=e?.useGrouping??"auto",r=e?.hour12??"auto";switch(t.type){case"integer":case"small-integer":case"big-integer":case"long":return new x6({minimumFractionDigits:0,maximumFractionDigits:0,useGrouping:i});case"single":case"double":return new x6({minimumFractionDigits:0,maximumFractionDigits:2,useGrouping:i});case"date":case"timestamp-offset":return new Mw({dateStyle:"short",timeStyle:"short",hour12:r});case"date-only":return new Mw({dateStyle:"short"});case"time-only":return new Mw({timeStyle:"short",hour12:r})}}let lu=class extends ur(ke){constructor(e){super(e),this.fieldName=null,this.isEditable=!0,this.label=null,this.statisticType=null,this.stringFieldOption="text-box",this.tooltip=null,this.visible=!0}set fieldFormat(e){this._set("fieldFormat",e),this._set("format",e?zit(e):null)}set format(e){this._set("format",e),this._set("fieldFormat",e?XCe(e):null)}readFormat(e,i){if(!i.fieldFormat)return e?bM.fromJSON(e):null}clone(){const e=super.clone();return e._set("format",this.format?.clone()),e._set("fieldFormat",this.fieldFormat?.clone()),e}};d([m({value:null,clonable:!1,types:Iit,json:{write:{overridePolicy(t,e,i){const{fieldName:r}=this;return{enabled:!!r&&!r.startsWith("expression/")&&!r.startsWith("relationships/")&&!!i?.writeFieldFormat}}}}})],lu.prototype,"fieldFormat",null),d([m({type:String,json:{write:!0}})],lu.prototype,"fieldName",void 0),d([m({value:null,clonable:!1,type:bM,json:{write:!0}})],lu.prototype,"format",null),d([di("format")],lu.prototype,"readFormat",null),d([m({type:Boolean,json:{write:{alwaysWriteDefaults:!0},default:!0}})],lu.prototype,"isEditable",void 0),d([m({type:String,json:{write:!0}})],lu.prototype,"label",void 0),d([m({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],lu.prototype,"statisticType",void 0),d([Et(new ta({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],lu.prototype,"stringFieldOption",void 0),d([m({type:String,json:{write:!0}})],lu.prototype,"tooltip",void 0),d([m({type:Boolean,json:{write:!0}})],lu.prototype,"visible",void 0),lu=d([k("esri.popup.FieldInfo")],lu);const lMe=lu;var BZ;let H0=BZ=class extends Dy{constructor(t){super(t),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}clone(){return new BZ(Te({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};d([m({type:Object,json:{write:!0}})],H0.prototype,"attributes",void 0),d([m({type:String,json:{write:!0}})],H0.prototype,"description",void 0),d([m({type:[lMe],json:{write:!0}})],H0.prototype,"fieldInfos",void 0),d([m({type:String,json:{write:!0}})],H0.prototype,"title",void 0),d([m({type:["fields"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],H0.prototype,"type",void 0),H0=BZ=d([k("esri.popup.content.FieldsContent")],H0);const JR=H0;let ib=class extends ke{constructor(e){super(e),this.altText=null,this.caption="",this.title="",this.type=null}};d([m({type:String,json:{write:!0}})],ib.prototype,"altText",void 0),d([m({type:String,json:{write:!0}})],ib.prototype,"caption",void 0),d([m({type:String,json:{write:!0}})],ib.prototype,"title",void 0),d([m({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],ib.prototype,"type",void 0),ib=d([k("esri.popup.content.mixins.MediaInfo")],ib);const Dte=ib;var jZ;let rb=jZ=class extends Me{constructor(t){super(t),this.color=null,this.fieldName=null,this.tooltip=null,this.value=null}clone(){return new jZ({color:this.color?.clone(),fieldName:this.fieldName,tooltip:this.tooltip,value:this.value})}};d([m()],rb.prototype,"color",void 0),d([m()],rb.prototype,"fieldName",void 0),d([m()],rb.prototype,"tooltip",void 0),d([m()],rb.prototype,"value",void 0),rb=jZ=d([k("esri.popup.content.support.ChartMediaInfoValueSeries")],rb);const Vit=rb;var qZ;let W0=qZ=class extends ke{constructor(t){super(t),this.colors=null,this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new qZ({colors:Te(this.colors),fields:Te(this.fields),normalizeField:this.normalizeField,series:Te(this.series),tooltipField:this.tooltipField})}};d([m({type:[mt],json:{type:[[qi]],write:!0}})],W0.prototype,"colors",void 0),d([m({type:[String],json:{write:{isRequired:!0}}})],W0.prototype,"fields",void 0),d([m({type:String,json:{write:!0}})],W0.prototype,"normalizeField",void 0),d([m({type:[Vit],json:{read:!1}})],W0.prototype,"series",void 0),d([m({type:String,json:{write:!0}})],W0.prototype,"tooltipField",void 0),W0=qZ=d([k("esri.popup.content.support.ChartMediaInfoValue")],W0);const Uit=W0;let lO=class extends Dte{constructor(e){super(e),this.type=null,this.value=void 0}};d([m({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],lO.prototype,"type",void 0),d([m({type:Uit,json:{write:{isRequired:!0}}})],lO.prototype,"value",void 0),lO=d([k("esri.popup.content.mixins.ChartMediaInfo")],lO);const KU=lO,e8=cl()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"});var GZ;let Tz=GZ=class extends KU{constructor(t){super(t),this.type="bar-chart"}clone(){return new GZ({altText:this.altText,title:this.title,caption:this.caption,value:this.value?.clone()})}};d([m({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:{writer:e8.write,isRequired:!0}}})],Tz.prototype,"type",void 0),Tz=GZ=d([k("esri.popup.content.BarChartMediaInfo")],Tz);const cMe=Tz;var HZ;let $z=HZ=class extends KU{constructor(t){super(t),this.type="column-chart"}clone(){return new HZ({altText:this.altText,title:this.title,caption:this.caption,value:this.value?.clone()})}};d([m({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:{writer:e8.write,isRequired:!0}}})],$z.prototype,"type",void 0),$z=HZ=d([k("esri.popup.content.ColumnChartMediaInfo")],$z);const uMe=$z;var WZ;let cO=WZ=class extends ke{constructor(t){super(t),this.linkURL=null,this.sourceURL=null}clone(){return new WZ({linkURL:this.linkURL,sourceURL:this.sourceURL})}};d([m({type:String,json:{write:!0}})],cO.prototype,"linkURL",void 0),d([m({type:String,json:{write:{isRequired:!0}}})],cO.prototype,"sourceURL",void 0),cO=WZ=d([k("esri.popup.content.support.ImageMediaInfoValue")],cO);const Bit=cO;var ZZ;let dT=ZZ=class extends Dte{constructor(t){super(t),this.refreshInterval=0,this.type="image",this.value=void 0}clone(){return new ZZ({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:this.value?.clone()})}};d([m({type:Number,json:{write:!0}})],dT.prototype,"refreshInterval",void 0),d([m({type:["image"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],dT.prototype,"type",void 0),d([m({type:Bit,json:{write:{isRequired:!0}}})],dT.prototype,"value",void 0),dT=ZZ=d([k("esri.popup.content.ImageMediaInfo")],dT);const hMe=dT;var YZ;let Cz=YZ=class extends KU{constructor(t){super(t),this.type="line-chart"}clone(){return new YZ({altText:this.altText,title:this.title,caption:this.caption,value:this.value?.clone()})}};d([m({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:{writer:e8.write,isRequired:!0}}})],Cz.prototype,"type",void 0),Cz=YZ=d([k("esri.popup.content.LineChartMediaInfo")],Cz);const dMe=Cz;var QZ;let Mz=QZ=class extends KU{constructor(t){super(t),this.type="pie-chart"}clone(){return new QZ({altText:this.altText,title:this.title,caption:this.caption,value:this.value?.clone()})}};d([m({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:{writer:e8.write,isRequired:!0}}})],Mz.prototype,"type",void 0),Mz=QZ=d([k("esri.popup.content.PieChartMediaInfo")],Mz);const pMe=Mz,XZ={base:Dte,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":cMe,"column-chart":uMe,"line-chart":dMe,"pie-chart":pMe,image:hMe}};var JZ;let Pd=JZ=class extends Dy{constructor(t){super(t),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(t){return t&&t.map(e=>e.type==="image"?hMe.fromJSON(e):e.type==="barchart"?cMe.fromJSON(e):e.type==="columnchart"?uMe.fromJSON(e):e.type==="linechart"?dMe.fromJSON(e):e.type==="piechart"?pMe.fromJSON(e):void 0).filter(Boolean)}writeMediaInfos(t,e){e.mediaInfos=t&&t.map(i=>i.toJSON())}clone(){return new JZ(Te({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};d([m()],Pd.prototype,"activeMediaInfoIndex",void 0),d([m({type:Object,json:{write:!0}})],Pd.prototype,"attributes",void 0),d([m({type:String,json:{write:!0}})],Pd.prototype,"description",void 0),d([m({types:[XZ]})],Pd.prototype,"mediaInfos",void 0),d([di("mediaInfos")],Pd.prototype,"readMediaInfos",null),d([Ht("mediaInfos")],Pd.prototype,"writeMediaInfos",null),d([m({type:String,json:{write:!0}})],Pd.prototype,"title",void 0),d([m({type:["media"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],Pd.prototype,"type",void 0),Pd=JZ=d([k("esri.popup.content.MediaContent")],Pd);const KR=Pd;var KZ;let uO=KZ=class extends ke{constructor(t){super(t),this.field=null,this.order=null}clone(){return new KZ({field:this.field,order:this.order})}};d([m({type:String,json:{write:!0}})],uO.prototype,"field",void 0),d([m({type:["asc","desc"],json:{write:!0}})],uO.prototype,"order",void 0),uO=KZ=d([k("esri.popup.support.RelatedRecordsInfoFieldOrder")],uO);const fMe=uO;let nf=class extends ur(Dy){constructor(e){super(e),this.description=null,this.displayCount=null,this.displayType="list",this.orderByFields=null,this.relationshipId=null,this.title=null,this.type="relationship"}};d([m({type:String,json:{write:!0}})],nf.prototype,"description",void 0),d([m({type:Number,json:{type:qi,write:!0}})],nf.prototype,"displayCount",void 0),d([m({type:["list"],json:{write:{isRequired:!0}}})],nf.prototype,"displayType",void 0),d([m({type:[fMe],json:{write:!0}})],nf.prototype,"orderByFields",void 0),d([m({type:Number,json:{type:qi,write:{isRequired:!0}}})],nf.prototype,"relationshipId",void 0),d([m({type:String,json:{write:!0}})],nf.prototype,"title",void 0),d([m({type:["relationship"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],nf.prototype,"type",void 0),nf=d([k("esri.popup.content.RelationshipContent")],nf);const eD=nf;var eY;let hO=eY=class extends Dy{constructor(t){super(t),this.text=null,this.type="text"}clone(){return new eY({text:this.text})}};d([m({type:String,json:{write:!0}})],hO.prototype,"text",void 0),d([m({type:["text"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],hO.prototype,"type",void 0),hO=eY=d([k("esri.popup.content.TextContent")],hO);const tD=hO;let Jm=class extends ur(ke){constructor(e){super(e),this.title=null,this.description=null,this.type=null,this.associatedNetworkSourceId=null,this.associatedAssetGroup=null,this.associatedAssetType=null}};d([m({type:String,json:{write:!0}})],Jm.prototype,"title",void 0),d([m({type:String,json:{write:!0}})],Jm.prototype,"description",void 0),d([m({type:["attachment","connectivity","container","content","structure"],json:{write:!0}})],Jm.prototype,"type",void 0),d([m({type:Number,json:{type:qi,write:!0}})],Jm.prototype,"associatedNetworkSourceId",void 0),d([m({type:Number,json:{type:qi,write:!0}})],Jm.prototype,"associatedAssetGroup",void 0),d([m({type:Number,json:{type:qi,write:!0}})],Jm.prototype,"associatedAssetType",void 0),Jm=d([k("esri.popup.support.UtilityNetworkAssociationType")],Jm);const jit=Jm;let Z0=class extends ur(Dy){constructor(e){super(e),this.description=null,this.displayCount=null,this.title=null,this.associationTypes=[],this.type="utility-network-associations"}};d([m({type:String,json:{write:!0}})],Z0.prototype,"description",void 0),d([m({type:Number,json:{type:qi,write:!0}})],Z0.prototype,"displayCount",void 0),d([m({type:String,json:{write:!0}})],Z0.prototype,"title",void 0),d([m({type:[jit],json:{write:!0}})],Z0.prototype,"associationTypes",void 0),d([Et({utilityNetworkAssociations:"utility-network-associations"})],Z0.prototype,"type",void 0),Z0=d([k("esri.popup.content.UtilityNetworkAssociationsContent")],Z0);const Ite=Z0,qit={base:null,key:"type",typeMap:{attachment:XR,media:KR,text:tD,expression:XU,field:JR,relationship:eD,utilityNetworkAssociations:Ite}},Git={base:null,key:"type",typeMap:{attachment:XR,media:KR,text:tD,expression:XU,field:JR,relationship:eD}};var tY;let sb=tY=class extends ke{constructor(t){super(t),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new tY({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};d([m({type:String,json:{write:!0}})],sb.prototype,"name",void 0),d([m({type:String,json:{write:!0}})],sb.prototype,"title",void 0),d([m({type:String,json:{write:!0}})],sb.prototype,"expression",void 0),d([m({type:["string","number"],json:{write:!0}})],sb.prototype,"returnType",void 0),sb=tY=d([k("esri.popup.ExpressionInfo")],sb);const Hit=sb;var iY;let dO=iY=class extends ke{constructor(t){super(t),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new iY({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};d([m({type:Boolean,json:{write:!0}})],dO.prototype,"returnTopmostRaster",void 0),d([m({type:Boolean,json:{write:!0}})],dO.prototype,"showNoDataRecords",void 0),dO=iY=d([k("esri.popup.LayerOptions")],dO);const Wit=dO;var rY;let pO=rY=class extends ke{constructor(t){super(t),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new rY({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?Te(this.orderByFields):null})}};d([m({type:Boolean,json:{write:!0}})],pO.prototype,"showRelatedRecords",void 0),d([m({type:[fMe],json:{write:!0}})],pO.prototype,"orderByFields",void 0),pO=rY=d([k("esri.popup.RelatedRecordsInfo")],pO);const upe=pO;var sY;let fh=sY=class extends lte(Me){constructor(t){super(t),this.active=!1,this.className=null,this.disabled=!1,this.icon=null,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new sY({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};d([m()],fh.prototype,"active",void 0),d([m()],fh.prototype,"className",void 0),d([m()],fh.prototype,"disabled",void 0),d([m()],fh.prototype,"icon",void 0),d([m()],fh.prototype,"id",void 0),d([m()],fh.prototype,"indicator",void 0),d([m()],fh.prototype,"title",void 0),d([m()],fh.prototype,"type",void 0),d([m()],fh.prototype,"visible",void 0),fh=sY=d([k("esri.support.actions.ActionBase")],fh);const Lte=fh;var nY;let Ez=nY=class extends Lte{constructor(t){super(t),this.image=null,this.type="button"}clone(){return new nY({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};d([m()],Ez.prototype,"image",void 0),Ez=nY=d([k("esri.support.actions.ActionButton")],Ez);const Zit=Ez;var aY;let fO=aY=class extends Lte{constructor(t){super(t),this.image=null,this.type="toggle",this.value=!1}clone(){return new aY({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};d([m()],fO.prototype,"image",void 0),d([m()],fO.prototype,"value",void 0),fO=aY=d([k("esri.support.actions.ActionToggle")],fO);const Yit=fO,jE="relationships/",hpe="expression/",Qit=He.ofType({key:"type",defaultKeyValue:"button",base:Lte,typeMap:{button:Zit,toggle:Yit}}),Xit={base:Dy,key:"type",typeMap:{media:KR,custom:Rit,text:tD,attachments:XR,fields:JR,expression:XU,relationship:eD,utilityNetworkAssociations:Ite}},mMe=new Set(["attachments","fields","media","text","expression","relationship"]),Jit=new Set([...mMe,"utility-network-associations"]);let da=class extends ur(ke){constructor(e){super(e),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title=""}castContent(e){return Array.isArray(e)?e.map(i=>ny(Xit,i)):typeof e=="string"||typeof e=="function"||e instanceof HTMLElement||$a(e)?e:(fe.getLogger(this).error("content error","unsupported content value",{value:e}),null)}readContent(e,i){const{popupElements:r}=i;return Array.isArray(r)&&r.length>0?this._readPopupInfoElements(i.description,i.mediaInfos,r):this._readPopupInfo(i)}writeWebSceneContent(e,i,r,s){this._writePopupTemplateContent(e,i,s)}writeWebMapContent(e,i,r,s){this._writePopupTemplateContent(e,i,s)}writeFieldInfos(e,i,r,s){const{content:n}=this,a=Array.isArray(n)?n:null,{writeFieldFormat:o,...l}=s||{};if(e){const c=a?a.filter(f=>f.type==="fields"):[],h=c.length&&c.every(f=>f.fieldInfos?.length);i.fieldInfos=e.filter(Boolean).map(f=>{const y=f.toJSON(l);return h&&(y.visible=!1),y})}if(a)for(const c of a)c.type==="fields"&&this._writeFieldsContent(c,i,l)}writeLayerOptions(e,i,r,s){i[r]=!e||e.showNoDataRecords===null&&e.returnTopmostRaster===null?null:e.toJSON(s)}writeTitle(e,i){i.title=e||""}async collectRequiredFields(e,i,r){const s=this.expressionInfos||[];await this._collectExpressionInfoFields(e,i,r,[...s,...this._getContentExpressionInfos(this.content,s)]),YR(e,i,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(e,i){const r=new Set;return await this.collectRequiredFields(r,e,i),[...r].sort()}_writePopupTemplateContent(e,i,r){typeof e!="string"?Array.isArray(e)&&(i.popupElements=e.filter(s=>r?.origin==="web-scene"?mMe.has(s.type):Jit.has(s.type)).map(s=>s?.toJSON(r)),i.popupElements.forEach(s=>{s.type==="attachments"?this._writeAttachmentContent(i):s.type==="media"?this._writeMediaContent(s,i):s.type==="text"?this._writeTextContent(s,i):s.type==="relationship"&&this._writeRelationshipContent(s,i)})):i.description=e}_writeFieldsContent(e,i,r){const s=e.fieldInfos;if(!Array.isArray(s)||!s.length)return;const n=i.fieldInfos;if(Array.isArray(n))for(const a of s){const o=n.find(l=>l.fieldName?.toLowerCase()===a.fieldName?.toLowerCase());o?o.visible=!0:n.push(a.toJSON(r))}else i.fieldInfos=s.map(a=>a.toJSON(r))}_writeAttachmentContent(e){e.showAttachments||(e.showAttachments=!0)}_writeRelationshipContent(e,i){const r=e.orderByFields?.map(n=>this._toFieldOrderJSON(n,e.relationshipId))||[],s=[...i.relatedRecordsInfo?.orderByFields||[],...r];i.relatedRecordsInfo={showRelatedRecords:!0,...s?.length&&{orderByFields:s}}}_writeTextContent(e,i){!i.description&&e.text&&(i.description=e.text)}_writeMediaContent(e,i){if(!Array.isArray(e.mediaInfos)||!e.mediaInfos.length)return;const r=Te(e.mediaInfos);Array.isArray(i.mediaInfos)?i.mediaInfos=[...i.mediaInfos,...r]:i.mediaInfos=r}_readPopupInfoElements(e,i,r){const s={description:!1,mediaInfos:!1};return r.map(n=>n.type==="media"?(n.mediaInfos||!i||s.mediaInfos||(n.mediaInfos=i,s.mediaInfos=!0),KR.fromJSON(n)):n.type==="text"?(n.text||!e||s.description||(n.text=e,s.description=!0),tD.fromJSON(n)):n.type==="attachments"?XR.fromJSON(n):n.type==="fields"?JR.fromJSON(n):n.type==="expression"?XU.fromJSON(n):n.type==="relationship"?eD.fromJSON(n):n.type==="utilityNetworkAssociations"?Ite.fromJSON(n):void 0).filter(Boolean)}_toRelationshipContent(e){const{field:i,order:r}=e;if(!i?.startsWith(jE))return null;const s=i.replace(jE,"").split("/");if(s.length!==2)return null;const n=parseInt(s[0],10),a=s[1];return!Number.isNaN(n)&&a?eD.fromJSON({relationshipId:n,orderByFields:[{field:a,order:r}]}):null}_toFieldOrderJSON(e,i){const{order:r,field:s}=e;return{field:`${jE}${i}/${s}`,order:r}}_readPopupInfo({description:e,mediaInfos:i,showAttachments:r,relatedRecordsInfo:s={showRelatedRecords:!1}}){const n=[];e?n.push(new tD({text:e})):n.push(new JR),Array.isArray(i)&&i.length&&n.push(KR.fromJSON({mediaInfos:i})),r&&n.push(XR.fromJSON({displayType:"auto"}));const{showRelatedRecords:a,orderByFields:o}=s;return a&&o?.length&&o.forEach(l=>{const c=this._toRelationshipContent(l);c&&n.push(c)}),n.length?n:e}_getContentElementFields(e){const i=e?.type;if(i==="attachments")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)];if(i==="custom")return e.outFields||[];if(i==="fields")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...this._getFieldInfoFields(e.fieldInfos??this.fieldInfos)];if(i==="media"){const r=e.mediaInfos||[];return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...r.reduce((s,n)=>[...s,...this._getMediaInfoFields(n)],[])]}return i==="text"?this._extractFieldNames(e.text):i==="relationship"||i==="utility-network-associations"?[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)]:[]}_getMediaInfoFields(e){const{caption:i,title:r,value:s}=e,n=s||{},{fields:a,normalizeField:o,tooltipField:l,sourceURL:c,linkURL:h}=n,f=[...this._extractFieldNames(r),...this._extractFieldNames(i),...this._extractFieldNames(c),...this._extractFieldNames(h),...a??[]];return o&&f.push(o),l&&f.push(l),f}_getContentExpressionInfos(e,i){return Array.isArray(e)?e.reduce((r,s)=>[...r,...s.type==="expression"&&s.expressionInfo?[s.expressionInfo]:[]],i):[]}_getContentFields(e){return typeof e=="string"?this._extractFieldNames(e):Array.isArray(e)?e.reduce((i,r)=>[...i,...this._getContentElementFields(r)],[]):[]}async _collectExpressionInfoFields(e,i,r,s){s&&await Promise.all(s.map(n=>Ev(e,i,r,n.expression)))}_getFieldInfoFields(e){return e?e.filter(({fieldName:i,visible:r})=>!(r!==void 0&&!r||!i||i.startsWith(jE)||i.startsWith(hpe))).map(i=>i.fieldName):[]}_getActionsFields(e){return e?e.toArray().reduce((i,r)=>[...i,...this._getActionFields(r)],[]):[]}_getActionFields(e){const{className:i,title:r,type:s}=e,n=s==="button"||s==="toggle"?e.image:"";return[...this._extractFieldNames(r),...this._extractFieldNames(i),...this._extractFieldNames(n)]}_getTitleFields(e){return typeof e=="string"?this._extractFieldNames(e):[]}_extractFieldNames(e){return Oit(e).filter(i=>!(i.startsWith(jE)||i.startsWith(hpe)))}};d([m({type:Qit})],da.prototype,"actions",void 0),d([m()],da.prototype,"content",void 0),d([qr("content")],da.prototype,"castContent",null),d([di("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments","relatedRecordsInfo"])],da.prototype,"readContent",null),d([Ht("web-scene","content",{popupElements:{type:He.ofType(Git)},showAttachments:{type:Boolean},mediaInfos:{type:He.ofType(XZ)},description:{type:String},relatedRecordsInfo:{type:upe}})],da.prototype,"writeWebSceneContent",null),d([Ht("content",{popupElements:{type:He.ofType(qit)},showAttachments:{type:Boolean},mediaInfos:{type:He.ofType(XZ)},description:{type:String},relatedRecordsInfo:{type:upe}})],da.prototype,"writeWebMapContent",null),d([m({type:[Hit],json:{write:!0}})],da.prototype,"expressionInfos",void 0),d([m({type:[lMe]})],da.prototype,"fieldInfos",void 0),d([Ht("fieldInfos")],da.prototype,"writeFieldInfos",null),d([m({type:Wit})],da.prototype,"layerOptions",void 0),d([Ht("layerOptions")],da.prototype,"writeLayerOptions",null),d([m({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],da.prototype,"lastEditInfoEnabled",void 0),d([m()],da.prototype,"outFields",void 0),d([m()],da.prototype,"overwriteActions",void 0),d([m()],da.prototype,"returnGeometry",void 0),d([m({json:{type:String}})],da.prototype,"title",void 0),d([Ht("title")],da.prototype,"writeTitle",null),da=d([k("esri.PopupTemplate")],da);const Kit=da,gMe=Symbol("idFieldsProviderSymbol");function ert(t){return!!t&&gMe in t}function dpe(t){return ert(t)?t[gMe]:void 0}const yMe=Symbol("popupProvider");function _8t(t){return typeof t=="object"&&t!==null&&"popupEnabled"in t&&"popupTemplate"in t}function trt(t){return!!t&&yMe in t}function irt(t){return trt(t)?t[yMe]:null}function c4(t,e){switch(e.type){case"object-id":case"unique-id-simple":return t.attributes[e.fieldName];case"unique-id-composite":{const i=[];for(const r of e.fieldNames)i.push(t.attributes[r]??null);return JSON.stringify(i)}}}function ppe(t,e){if("uniqueIdFields"in e&&e.uniqueIdFields?.length){if(e.uniqueIdFields.length===1)return t.attributes?.[e.uniqueIdFields[0]];const i=e.uniqueIdFields.map(r=>t.attributes?.[r]);return JSON.stringify(i)}return"objectIdField"in e&&e.objectIdField?t.attributes?.[e.objectIdField]:null}const fpe=new ta({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let rrt=0,Qn=class extends ke{constructor(e){super(e),this.id="sym"+rrt++,this.type=null,this.color=new mt([0,0,0,1])}readColor(e){return e?.[0]!=null?[e[0],e[1],e[2],e[3]/255]:e}async collectRequiredFields(e,i){}hash(){return JSON.stringify(this.toJSON())}clone(){}};d([m({type:fpe.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:fpe.write,isRequired:!0}}})],Qn.prototype,"type",void 0),d([m({type:mt,json:{write:{allowNull:!0}}})],Qn.prototype,"color",void 0),d([di("color")],Qn.prototype,"readColor",null),Qn=d([k("esri.symbols.Symbol")],Qn);var oY;let Ll=oY=class extends Qn{constructor(t){super(t),this.data=null,this.type="cim"}readData(t,e){return e}writeData(t,e){Object.assign(e,t)}async collectRequiredFields(t,e){if(this.data?.type==="CIMSymbolReference"){const i=this.data.primitiveOverrides;if(i){const r=i.map(s=>{const n=s.valueExpressionInfo;return n?Ev(t,e,null,n.expression):null});await Promise.all(r)}}}clone(){return new oY({data:Te(this.data)})}hash(){return Jbe(JSON.stringify(this.data)).toString()}};d([m({json:{write:!1}})],Ll.prototype,"color",void 0),d([m({json:{write:!0}})],Ll.prototype,"data",void 0),d([di("data",["symbol"])],Ll.prototype,"readData",null),d([Ht("data",{})],Ll.prototype,"writeData",null),d([Et({CIMSymbolReference:"cim"},{readOnly:!0})],Ll.prototype,"type",void 0),Ll=oY=d([k("esri.symbols.CIMSymbol")],Ll);let Vl=class extends ke{constructor(e){super(e),this.enabled=!0,this.type=null,this.ignoreDrivers=!1}writeEnabled(e,i,r){e||(i[r]=e)}};d([m({type:Boolean,json:{read:{source:"enable"},write:{target:"enable"}}})],Vl.prototype,"enabled",void 0),d([Ht("enabled")],Vl.prototype,"writeEnabled",null),d([m({type:["icon","object","line","path","fill","water","extrude","text"],readOnly:!0,json:{write:{isRequired:!0}}})],Vl.prototype,"type",void 0),Vl=d([k("esri.symbols.Symbol3DLayer")],Vl);function srt(t,e){const i=e.transparency!=null?$te(e.transparency):1,r=e.color;return r&&Array.isArray(r)?new mt([r[0]||0,r[1]||0,r[2]||0,i]):null}function nrt(t,e){e.color=t.toJSON().slice(0,3);const i=Tte(t.a);i!==0&&(e.transparency=i)}function Iy(t){return{type:mt,nonNullable:t?.nonNullable,json:{type:[qi],default:null,read:{source:["color","transparency"],reader:srt},write:{target:{color:{type:[qi],isRequired:t?.colorRequiredOnWrite},transparency:{type:qi}},writer:nrt}}}}const Jf={type:Number,cast:sn,json:{write:!0}};function w8t(t){return t==="emissive"?0:1}let nb=class extends ke{constructor(e){super(e),this.color=new mt([0,0,0,1]),this.extensionLength=0,this.size=gv(1)}clone(){}cloneProperties(){return{color:Te(this.color),size:this.size,extensionLength:this.extensionLength}}};d([m({type:["solid","sketch"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0,isRequired:!0}}})],nb.prototype,"type",void 0),d([m(Iy({colorRequiredOnWrite:!0}))],nb.prototype,"color",void 0),d([m({...Jf,json:{write:{overridePolicy:t=>({enabled:!!t})}}})],nb.prototype,"extensionLength",void 0),d([m(Jf)],nb.prototype,"size",void 0),nb=d([k("esri.symbols.edges.Edges3D")],nb);const kte=nb;var lY;let Az=lY=class extends kte{constructor(t){super(t),this.type="sketch"}clone(){return new lY(this.cloneProperties())}};d([Et({sketch:"sketch"},{readOnly:!0})],Az.prototype,"type",void 0),Az=lY=d([k("esri.symbols.edges.SketchEdges3D")],Az);const art=Az;var cY;let Oz=cY=class extends kte{constructor(t){super(t),this.type="solid"}clone(){return new cY(this.cloneProperties())}};d([Et({solid:"solid"},{readOnly:!0})],Oz.prototype,"type",void 0),Oz=cY=d([k("esri.symbols.edges.SolidEdges3D")],Oz);const ort=Oz,_Me={types:{key:"type",base:kte,typeMap:{solid:ort,sketch:art}},json:{write:!0}};var uY;let d3=uY=class extends ke{constructor(){super(...arguments),this.strength=null,this.source="emissive"}clone(){const t={strength:this.strength,source:this.source};return new uY(t)}};d([m({json:{write:!1}})],d3.prototype,"strength",void 0),d([m({json:{write:!1}})],d3.prototype,"source",void 0),d3=uY=d([k("esri.symbols.support.Symbol3DEmissive")],d3);var hY;let Au=hY=class extends ke{constructor(t){super(t),this.color=null,this.emissive=new d3({source:"emissive"})}clone(){const t={color:this.color?.clone()??null,emissive:this.emissive?.clone()??null};return new hY(t)}};d([m(Iy())],Au.prototype,"color",void 0),d([m({type:d3,json:{write:!1}})],Au.prototype,"emissive",void 0),Au=hY=d([k("esri.symbols.support.Symbol3DMaterial")],Au);var dY,S$;let xg=(S$=class extends Vl{constructor(e){super(e),this.type="extrude",this.size=1,this.material=null,this.castShadows=!0,this.edges=null}clone(){return new dY({edges:this.edges?.clone(),enabled:this.enabled,material:this.material?.clone(),castShadows:this.castShadows,size:this.size})}},dY=S$,S$);d([Et({Extrude:"extrude"},{readOnly:!0})],xg.prototype,"type",void 0),d([m({type:Number,json:{write:{enabled:!0,isRequired:!0}},nonNullable:!0})],xg.prototype,"size",void 0),d([m({type:Au,json:{write:!0}})],xg.prototype,"material",void 0),d([m({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],xg.prototype,"castShadows",void 0),d([m(_Me)],xg.prototype,"edges",void 0),xg=dY=d([k("esri.symbols.ExtrudeSymbol3DLayer")],xg);let UP=class extends ke{constructor(e){super(e)}clone(){throw new Error("Subclasses of LinePattern3D should implement their own clone method.")}};d([m({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],UP.prototype,"type",void 0),UP=d([k("esri.symbols.patterns.LinePattern3D")],UP);const lrt=["dash","dash-dot","dot","long-dash","long-dash-dot","long-dash-dot-dot","none","short-dash","short-dash-dot","short-dash-dot-dot","short-dot","solid"];var pY;const crt=cl()({dash:"dash","dash-dot":"dash-dot","dash-dot-dot":"long-dash-dot-dot",dot:"dot","long-dash":"long-dash","long-dash-dot":"long-dash-dot",null:"none","short-dash":"short-dash","short-dash-dot":"short-dash-dot","short-dash-dot-dot":"short-dash-dot-dot","short-dot":"short-dot",solid:"solid"});let iw=pY=class extends UP{constructor(t){super(t),this.type="style",this.style="solid"}clone(){const t={style:this.style};return new pY(t)}};d([m({type:["style"],json:{write:{isRequired:!0}}})],iw.prototype,"type",void 0),d([Et(crt),m({type:lrt,json:{write:{isRequired:!0}}})],iw.prototype,"style",void 0),iw=pY=d([k("esri.symbols.patterns.LineStylePattern3D")],iw);let BP=class extends ke{constructor(e){super(e),this.type="style"}clone(){throw new Error("Subclasses of Pattern3D should implement their own clone method.")}};d([m({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],BP.prototype,"type",void 0),BP=d([k("esri.symbols.patterns.Pattern3D")],BP);const urt=["backward-diagonal","cross","diagonal-cross","forward-diagonal","horizontal","none","solid","vertical"];var fY;let p3=fY=class extends BP{constructor(t){super(t),this.type="style",this.style="solid"}clone(){return new fY({style:this.style})}};d([m({type:["style"],json:{write:{isRequired:!0}}})],p3.prototype,"type",void 0),d([m({type:urt,json:{read:!0,write:{isRequired:!0}}})],p3.prototype,"style",void 0),p3=fY=d([k("esri.symbols.patterns.StylePattern3D")],p3);const hrt={types:{key:"type",base:BP,typeMap:{style:p3}},json:{write:!0}},vMe={types:{key:"type",base:UP,typeMap:{style:iw}},json:{write:!0}},jP=new mt("white"),drt=new mt([255,255,255,0]);function prt(t){return t.r===0&&t.g===0&&t.b===0}var mY;let qP=mY=class extends Au{constructor(t){super(t),this.colorMixMode=null}clone(){const t={color:this.color?.clone()??null,colorMixMode:this.colorMixMode,emissive:this.emissive?.clone()??null};return new mY(t)}};d([Et({multiply:"multiply",replace:"replace",tint:"tint"})],qP.prototype,"colorMixMode",void 0),qP=mY=d([k("esri.symbols.support.Symbol3DFillMaterial")],qP);function iD(t){return t<=Hl?new Array(t).fill(0):new Float64Array(t)}function $8t(t){return(iM(t)?t.byteLength/8:t.length)<=Hl?Array.from(t):new Float64Array(t)}function C8t(t,e,i){return Array.isArray(t)?t.slice(e,e+i):t.subarray(e,e+i)}function M8t(t){return[...t]}function E8t(t){const e=it();for(let i=0;i<16;++i)e[i]=t[i];return e}function ul(t=TMe){return[t[0],t[1],t[2],t[3],t[4],t[5]]}function IC(t,e,i,r,s,n,a=ul()){return a[0]=t,a[1]=e,a[2]=i,a[3]=r,a[4]=s,a[5]=n,a}function A8t(t,e=ul()){return frt(t,0,t.length/3,e)}function frt(t,e,i,r=ul()){return t8(r,yY),mrt(r,t,e,i),r}function O8t(t,e=iD(24)){const[i,r,s,n,a,o]=t;return e[0]=i,e[1]=r,e[2]=s,e[3]=i,e[4]=r,e[5]=o,e[6]=i,e[7]=a,e[8]=s,e[9]=i,e[10]=a,e[11]=o,e[12]=n,e[13]=r,e[14]=s,e[15]=n,e[16]=r,e[17]=o,e[18]=n,e[19]=a,e[20]=s,e[21]=n,e[22]=a,e[23]=o,e}function P8t(t,e){const i=isFinite(t[2])||isFinite(t[5]);return new Bt(i?{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],zmin:t[2],zmax:t[5],spatialReference:e}:{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],spatialReference:e})}function R8t(t,e,i=ul()){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=e[0],i[4]=e[1],i[5]=e[2],i}function bMe(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[3]),t[4]=Math.max(t[4],e[4]),t[5]=Math.max(t[5],e[5])}function D8t(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[3]=Math.max(t[3],e[2]),t[4]=Math.max(t[4],e[3])}function LC(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[0]),t[4]=Math.max(t[4],e[1]),t[5]=Math.max(t[5],e[2])}function mrt(t,e,i=0,r=e.length/3){let s=t[0],n=t[1],a=t[2],o=t[3],l=t[4],c=t[5];for(let h=0;h<r;h++)s=Math.min(s,e[i+3*h]),n=Math.min(n,e[i+3*h+1]),a=Math.min(a,e[i+3*h+2]),o=Math.max(o,e[i+3*h]),l=Math.max(l,e[i+3*h+1]),c=Math.max(c,e[i+3*h+2]);t[0]=s,t[1]=n,t[2]=a,t[3]=o,t[4]=l,t[5]=c}function E7(t,e,i){const r=e.length;let s=t[0],n=t[1],a=t[2],o=t[3],l=t[4],c=t[5];if(i)for(let h=0;h<r;h++){const f=e[h];s=Math.min(s,f[0]),n=Math.min(n,f[1]),a=Math.min(a,f[2]),o=Math.max(o,f[0]),l=Math.max(l,f[1]),c=Math.max(c,f[2])}else for(let h=0;h<r;h++){const f=e[h];s=Math.min(s,f[0]),n=Math.min(n,f[1]),o=Math.max(o,f[0]),l=Math.max(l,f[1])}t[0]=s,t[1]=n,t[2]=a,t[3]=o,t[4]=l,t[5]=c}function grt(t){for(let e=0;e<6;e++)if(!isFinite(t[e]))return!1;return!0}function h2(t){return t[0]>=t[3]?0:t[3]-t[0]}function d2(t){return t[1]>=t[4]?0:t[4]-t[1]}function Zv(t){return t[2]>=t[5]?0:t[5]-t[2]}function yrt(t){const e=h2(t),i=Zv(t),r=d2(t);return Math.sqrt(e*e+i*i+r*r)}function zte(t,e=[0,0,0]){return e[0]=t[0]+h2(t)/2,e[1]=t[1]+d2(t)/2,e[2]=t[2]+Zv(t)/2,e}function I8t(t,e=[0,0,0]){return e[0]=h2(t),e[1]=d2(t),e[2]=Zv(t),e}function _rt(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[0]<=t[3]&&e[1]<=t[4]&&e[2]<=t[5]}function L8t(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[3]<=t[3]&&e[4]<=t[4]&&e[5]<=t[5]}function vrt(t,e){return Math.max(e[0],t[0])<=Math.min(e[3],t[3])&&Math.max(e[1],t[1])<=Math.min(e[4],t[4])&&Math.max(e[2],t[2])<=Math.min(e[5],t[5])}function k8t(t,e){return e==null||vrt(t,e)}function z8t(t,e,i){let r=0,s=1;for(let n=0;n<3;++n){const a=t[n],o=t[n+3],l=e[n],c=i[n],h=c<l,f=h?c:l,y=h?l:c,_=Math.max(a,f),w=Math.min(o,y);if(_>w)return!1;if(y===f)break;const x=y-f,S=(_-f)/x,$=(w-f)/x;if(r=Math.max(r,h?1-$:S),s=Math.min(s,h?1-S:$),r>s)return!1}return!0}function brt(t,e,i,r,s=t){return s[0]=t[0]+e,s[1]=t[1]+i,s[2]=t[2]+r,s[3]=t[3]+e,s[4]=t[4]+i,s[5]=t[5]+r,s}function F8t(t,e,i=t){const r=t[0]+h2(t)/2,s=t[1]+d2(t)/2,n=t[2]+Zv(t)/2;return i[0]=r+(t[0]-r)*e,i[1]=s+(t[1]-s)*e,i[2]=n+(t[2]-n)*e,i[3]=r+(t[3]-r)*e,i[4]=s+(t[4]-s)*e,i[5]=n+(t[5]-n)*e,i}function N8t(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function wMe(t,e,i=t){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i!==t&&(i[3]=t[3],i[4]=t[4],i[5]=t[5]),i}function xMe(t,e,i=t){return i[3]=e[0],i[4]=e[1],i[5]=e[2],i!==t&&(i[0]=t[0],i[1]=t[1],i[2]=t[2]),t}function t8(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function Nc(t){return t?t8(t,yY):ul(yY)}function Fte(t,e=Pi()){return e[0]=t[0],e[1]=t[1],e[2]=t[3],e[3]=t[4],e}function V8t(t,e){return t[0]=e[0],t[1]=e[1],t[2]=Number.NEGATIVE_INFINITY,t[3]=e[2],t[4]=e[3],t[5]=Number.POSITIVE_INFINITY,t}function wrt(t,e,i,r,s){return t[0]=e,t[1]=i,t[2]=Number.NEGATIVE_INFINITY,t[3]=r,t[4]=s,t[5]=Number.POSITIVE_INFINITY,t}function gY(t){return t.length===6}function SMe(t){return h2(t)===0&&d2(t)===0&&Zv(t)===0}function U8t(t,e,i){if(t==null||e==null)return t===e;if(!gY(t)||!gY(e))return!1;if(i){for(let r=0;r<t.length;r++)if(!i(t[r],e[r]))return!1}else for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function xrt(t,e,i,r,s,n){return IC(t,e,i,r,s,n,Srt)}const B8t=[-1/0,-1/0,-1/0,1/0,1/0,1/0],yY=[1/0,1/0,1/0,-1/0,-1/0,-1/0],TMe=[0,0,0,0,0,0],Srt=ul();function j8t(t,{isPrimitive:e,width:i,depth:r,height:s}){const n=e?10:1;if(i==null&&s==null&&r==null)return[n*t[0],n*t[1],n*t[2]];const a=Ge(i,r,s);let o;for(let l=0;l<3;l++){const c=a[l];if(c!=null){o=c/t[l];break}}for(let l=0;l<3;l++)a[l]==null&&(a[l]=t[l]*o);return a}const Trt=IC(-.5,-.5,-.5,.5,.5,.5),$rt=IC(-.5,-.5,0,.5,.5,1),Crt=IC(-.5,-.5,0,.5,.5,.5);function q8t(t){switch(t){case"sphere":case"cube":case"diamond":return Trt;case"cylinder":case"cone":case"inverted-cone":return $rt;case"tetrahedron":return Crt;default:return}}const Nte=["butt","square","round"],Mrt=[...Nte,"none"],$Me=["miter","bevel","round"];var _Y;let ab=_Y=class extends ke{constructor(t){super(t),this.color=new mt([0,0,0,1]),this.size=gv(1),this.pattern=null,this.patternCap="butt"}clone(){const t={color:this.color!=null?this.color.clone():null,size:this.size,pattern:this.pattern!=null?this.pattern.clone():null,patternCap:this.patternCap};return new _Y(t)}};d([m(Iy({colorRequiredOnWrite:!0}))],ab.prototype,"color",void 0),d([m({...Jf,json:{write:{isRequired:!0}}})],ab.prototype,"size",void 0),d([m(vMe)],ab.prototype,"pattern",void 0),d([m({type:Nte,json:{default:"butt",write:{overridePolicy(){return{enabled:this.pattern!=null}}}}})],ab.prototype,"patternCap",void 0),ab=_Y=d([k("esri.symbols.support.Symbol3DOutline")],ab);var Pz,T$;let Sc=(T$=class extends Vl{constructor(e){super(e),this.type="fill",this.material=null,this.pattern=null,this.castShadows=!0,this.outline=null,this.edges=null}clone(){const e={edges:this.edges!=null?this.edges.clone():null,enabled:this.enabled,material:this.material!=null?this.material.clone():null,pattern:this.pattern!=null?this.pattern.clone():null,castShadows:this.castShadows,outline:this.outline!=null?this.outline.clone():null};return new Pz(e)}static fromSimpleFillSymbol(e){const i=e.outline&&e.outline.style&&e.outline.style!=="solid"?new iw({style:e.outline.style}):null,r={size:e.outline?.width??0,color:(e.outline?.color??jP).clone(),pattern:i};return i&&e.outline?.cap&&(r.patternCap=e.outline.cap),new Pz({material:new qP({color:(e.color??drt).clone()}),pattern:e.style&&e.style!=="solid"?new p3({style:e.style}):null,outline:r})}},Pz=T$,T$);d([Et({Fill:"fill"},{readOnly:!0})],Sc.prototype,"type",void 0),d([m({type:qP,json:{write:!0}})],Sc.prototype,"material",void 0),d([m(hrt)],Sc.prototype,"pattern",void 0),d([m({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Sc.prototype,"castShadows",void 0),d([m({type:ab,json:{write:!0}})],Sc.prototype,"outline",void 0),d([m(_Me)],Sc.prototype,"edges",void 0),Sc=Pz=d([k("esri.symbols.FillSymbol3DLayer")],Sc);var vY;const Ert=cl()({circle:"circle",square:"square",cross:"cross",x:"x",kite:"kite",triangle:"triangle"});let ob=vY=class extends ke{constructor(t){super(t)}readHref(t,e,i){return t?cM(t,i):e.dataURI}writeHref(t,e,i,r){t&&(rm(t)?e.dataURI=t:(e.href=oC(t,r),Ic(e.href)&&(e.href=Jg(e.href))))}clone(){return new vY({href:this.href,primitive:this.primitive})}equals(t){return t.primitive===this.primitive&&t.href===this.href}};d([m({type:String,json:{write:!0,read:{source:["href","dataURI"]}}})],ob.prototype,"href",void 0),d([di("href")],ob.prototype,"readHref",null),d([Ht("href",{href:{type:String},dataURI:{type:String}})],ob.prototype,"writeHref",null),d([Et(Ert)],ob.prototype,"primitive",void 0),ob=vY=d([k("esri.symbols.support.IconSymbol3DLayerResource")],ob);const G8t="circle";let Rz=class extends ur(ke){constructor(e){super(e),this.mode="hidden"}equals(e){return this.mode===e.mode}};d([m({type:["adaptive","hidden","visible"],json:{write:{isRequired:!0}}})],Rz.prototype,"mode",void 0),Rz=d([k("esri.symbols.support.OccludedVisibility")],Rz);const CMe=Rz;var bY;let f3=bY=class extends Me{constructor(t){super(t),this.x=0,this.y=0}clone(){return new bY({x:this.x,y:this.y})}equals(t){return t.x===this.x&&t.y===this.y}};d([m({type:Number})],f3.prototype,"x",void 0),d([m({type:Number})],f3.prototype,"y",void 0),f3=bY=d([k("esri.symbols.support.Symbol3DAnchorPosition2D")],f3);var wY;let mO=wY=class extends ke{constructor(t){super(t),this.color=new mt([0,0,0,1]),this.size=gv(1)}clone(){const t={color:this.color!=null?this.color.clone():null,size:this.size};return new wY(t)}equals(t){return t.size===this.size&&(this.color==null?t.color==null:this.color.equals(t.color))}};d([m(Iy({colorRequiredOnWrite:!0}))],mO.prototype,"color",void 0),d([m({...Jf,json:{write:{isRequired:!0}}})],mO.prototype,"size",void 0),mO=wY=d([k("esri.symbols.support.Symbol3DIconOutline")],mO);var pT,$$;let Fa=($$=class extends Vl{constructor(e){super(e),this.material=null,this.resource=null,this.type="icon",this.size=12,this.anchor="center",this.anchorPosition=null,this.outline=null,this.angle=0,this.occludedVisibility=null}clone(){return new pT({anchor:this.anchor,anchorPosition:Te(this.anchorPosition),enabled:this.enabled,material:Te(this.material),outline:Te(this.outline),resource:Te(this.resource),angle:this.angle,size:this.size,occludedVisibility:Te(this.occludedVisibility)})}static fromSimpleMarkerSymbol(e){const i=e.color||jP,r=mpe(e),s=e.outline&&e.outline.width>0?{size:e.outline.width,color:(e.outline.color||jP).clone()}:null;return new pT({size:e.size,angle:e.angle,resource:{primitive:Ort(()=>fe.getLogger(this.prototype),e.style)},material:{color:i},outline:s,anchor:r?"relative":void 0,anchorPosition:r})}static fromPictureMarkerSymbol(e){const i=!e.color||prt(e.color)?jP:e.color,r=mpe(e);return new pT({size:e.width<=e.height?e.height:e.width,angle:e.angle,resource:{href:e.url},material:{color:i.clone()},anchor:r?"relative":void 0,anchorPosition:r})}static fromCIMSymbol(e){return new pT({resource:{href:uxe({mediaType:"application/json",data:JSON.stringify(e.data)})}})}},pT=$$,$$);function mpe(t){const e="width"in t?t.width:t.size,i="height"in t?t.height:t.size,r=gpe(t.xoffset),s=gpe(t.yoffset);return(r||s)&&e&&i?{x:-r/e,y:s/i}:null}function gpe(t){return isFinite(t)?t:0}d([m({type:Au,json:{write:!0}})],Fa.prototype,"material",void 0),d([m({type:ob,json:{write:!0}})],Fa.prototype,"resource",void 0),d([Et({Icon:"icon"},{readOnly:!0})],Fa.prototype,"type",void 0),d([m({...Jf,json:{write:{isRequired:!0}}})],Fa.prototype,"size",void 0),d([Et({center:"center",left:"left",right:"right",top:"top",bottom:"bottom",topLeft:"top-left",topRight:"top-right",bottomLeft:"bottom-left",bottomRight:"bottom-right",relative:"relative"},{default:"center"})],Fa.prototype,"anchor",void 0),d([m({type:f3,json:{type:[Number],read:{reader:t=>new f3({x:t[0],y:t[1]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],Fa.prototype,"anchorPosition",void 0),d([m({type:mO,json:{write:!0}})],Fa.prototype,"outline",void 0),d([m({type:Number,json:{write:!0,default:0}})],Fa.prototype,"angle",void 0),d([m({type:CMe})],Fa.prototype,"occludedVisibility",void 0),Fa=pT=d([k("esri.symbols.IconSymbol3DLayer")],Fa);const Art={circle:"circle",cross:"cross",diamond:"kite",square:"square",x:"x",triangle:"triangle",path:null};function Ort(t,e){return Art[e]||(t().warn(`${e} cannot be mapped to Icon symbol. Fallback to "circle"`),"circle")}const Prt=["begin","end","begin-end"],MMe=["arrow","circle","square","diamond","cross","x"];let Rg=class extends ur(ke){constructor(e){super(e),this.type="style",this.placement="begin-end",this.style="arrow",this.color=null}equals(e){return e!=null&&e.placement===this.placement&&e.style===this.style&&(this.color==null&&e.color==null||this.color!=null&&e.color!=null&&this.color.toJSON()===e.color.toJSON())}};d([m({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0,isRequired:!0}}})],Rg.prototype,"type",void 0),d([m({type:Prt,json:{default:"begin-end",write:!0}})],Rg.prototype,"placement",void 0),d([m({type:MMe,json:{default:"arrow",write:!0}})],Rg.prototype,"style",void 0),d([m({type:mt,json:{type:[qi],default:null,write:!0}})],Rg.prototype,"color",void 0),Rg=d([k("esri.symbols.LineStyleMarker3D")],Rg);var Dz,C$;let vc=(C$=class extends Vl{constructor(e){super(e),this.material=null,this.type="line",this.join="miter",this.cap="butt",this.size=gv(1),this.pattern=null,this.marker=null}clone(){const e={enabled:this.enabled,material:this.material!=null?this.material.clone():null,size:this.size,join:this.join,cap:this.cap,pattern:this.pattern!=null?this.pattern.clone():null,marker:this.marker!=null?this.marker.clone():null};return new Dz(e)}static fromSimpleLineSymbol(e){const i={enabled:!0,size:e.width??gv(1),cap:e.cap||"butt",join:e.join||"miter",pattern:e.style?new iw({style:e.style}):null,material:new Au({color:(e.color||jP).clone()}),marker:e.marker?new Rg({placement:e.marker.placement,style:e.marker.style,color:e.marker.color?.clone()??null}):null};return new Dz(i)}},Dz=C$,C$);d([m({type:Au,json:{write:!0}})],vc.prototype,"material",void 0),d([Et({Line:"line"},{readOnly:!0})],vc.prototype,"type",void 0),d([m({type:$Me,json:{write:!0,default:"miter"}})],vc.prototype,"join",void 0),d([m({type:Nte,json:{write:!0,default:"butt"}})],vc.prototype,"cap",void 0),d([m({...Jf,json:{write:{isRequired:!0}}})],vc.prototype,"size",void 0),d([m(vMe)],vc.prototype,"pattern",void 0),d([m({types:{key:"type",base:Rg,typeMap:{style:Rg}},json:{write:!0}})],vc.prototype,"marker",void 0),vc=Dz=d([k("esri.symbols.LineSymbol3DLayer")],vc);var xY;const Rrt=cl()({sphere:"sphere",cylinder:"cylinder",cube:"cube",cone:"cone",diamond:"diamond",tetrahedron:"tetrahedron",invertedCone:"inverted-cone"});let gO=xY=class extends ke{clone(){return new xY({href:this.href,primitive:this.primitive})}};d([m({type:String,json:{read:oU,write:lC}})],gO.prototype,"href",void 0),d([Et(Rrt)],gO.prototype,"primitive",void 0),gO=xY=d([k("esri.symbols.support.ObjectSymbol3DLayerResource")],gO);const Drt="sphere";var SY;let zb=SY=class extends Me{constructor(){super(...arguments),this.x=0,this.y=0,this.z=0}clone(){return new SY({x:this.x,y:this.y,z:this.z})}};d([m({type:Number})],zb.prototype,"x",void 0),d([m({type:Number})],zb.prototype,"y",void 0),d([m({type:Number})],zb.prototype,"z",void 0),zb=SY=d([k("esri.symbols.support.Symbol3DAnchorPosition3D")],zb);var TY,M$;let Ka=(M$=class extends Vl{constructor(e){super(e),this.material=null,this.castShadows=!0,this.resource=null,this.type="object",this.width=void 0,this.height=void 0,this.depth=void 0,this.anchor=void 0,this.anchorPosition=void 0,this.heading=void 0,this.tilt=void 0,this.roll=void 0}clone(){return new TY({heading:this.heading,tilt:this.tilt,roll:this.roll,anchor:this.anchor,anchorPosition:this.anchorPosition?.clone(),depth:this.depth,enabled:this.enabled,height:this.height,material:this.material?.clone()??null,castShadows:this.castShadows,resource:this.resource?.clone(),width:this.width})}get isPrimitive(){return!this.resource||typeof this.resource.href!="string"}},TY=M$,M$);d([m({type:Au,json:{write:!0}})],Ka.prototype,"material",void 0),d([m({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Ka.prototype,"castShadows",void 0),d([m({type:gO,json:{write:!0}})],Ka.prototype,"resource",void 0),d([Et({Object:"object"},{readOnly:!0})],Ka.prototype,"type",void 0),d([m({type:Number,json:{write:!0}})],Ka.prototype,"width",void 0),d([m({type:Number,json:{write:!0}})],Ka.prototype,"height",void 0),d([m({type:Number,json:{write:!0}})],Ka.prototype,"depth",void 0),d([Et({center:"center",top:"top",bottom:"bottom",origin:"origin",relative:"relative"},{default:"origin"})],Ka.prototype,"anchor",void 0),d([m({type:zb,json:{type:[Number],read:{reader:t=>new zb({x:t[0],y:t[1],z:t[2]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y,t.z]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],Ka.prototype,"anchorPosition",void 0),d([m({type:Number,json:{write:!0}})],Ka.prototype,"heading",void 0),d([m({type:Number,json:{write:!0}})],Ka.prototype,"tilt",void 0),d([m({type:Number,json:{write:!0}})],Ka.prototype,"roll",void 0),d([m({readOnly:!0})],Ka.prototype,"isPrimitive",null),Ka=TY=d([k("esri.symbols.ObjectSymbol3DLayer")],Ka);var $Y,E$;let Co=(E$=class extends Vl{constructor(e){super(e),this.material=null,this.castShadows=!0,this.type="path",this.profile="circle",this.join="miter",this.cap="butt",this.width=void 0,this.height=void 0,this.anchor="center",this.profileRotation="all"}readWidth(e,i){return e??(i.height==null&&i.size!=null?i.size:void 0)}readHeight(e,i){return e??(i.width==null&&i.size!=null?i.size:void 0)}clone(){return new $Y({enabled:this.enabled,material:this.material!=null?this.material.clone():null,castShadows:this.castShadows,profile:this.profile,join:this.join,cap:this.cap,width:this.width,height:this.height,profileRotation:this.profileRotation,anchor:this.anchor})}},$Y=E$,E$);d([m({type:Au,json:{write:!0}})],Co.prototype,"material",void 0),d([m({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Co.prototype,"castShadows",void 0),d([Et({Path:"path"},{readOnly:!0})],Co.prototype,"type",void 0),d([m({type:["circle","quad"],nonNullable:!0,json:{write:!0,default:"circle"}})],Co.prototype,"profile",void 0),d([m({type:$Me,nonNullable:!0,json:{write:!0,default:"miter"}})],Co.prototype,"join",void 0),d([m({type:Mrt,nonNullable:!0,json:{write:!0,default:"butt"}})],Co.prototype,"cap",void 0),d([m({type:Number,json:{write:{enabled:!0,target:{width:{type:Number},size:{type:Number}}}}})],Co.prototype,"width",void 0),d([di("width",["width","size","height"])],Co.prototype,"readWidth",null),d([m({type:Number,json:{write:!0}})],Co.prototype,"height",void 0),d([di("height",["height","size","width"])],Co.prototype,"readHeight",null),d([m({type:["center","bottom","top"],nonNullable:!0,json:{write:!0,default:"center"}})],Co.prototype,"anchor",void 0),d([m({type:["heading","all"],nonNullable:!0,json:{write:!0,default:"all"}})],Co.prototype,"profileRotation",void 0),Co=$Y=d([k("esri.symbols.PathSymbol3DLayer")],Co);const Irt=["none","underline","line-through"],Lrt=["normal","italic","oblique"],krt=["normal","lighter","bold","bolder"],EMe={type:Number,cast:t=>{const e=xu(t);return e===0?1:Se(e,.1,4)},nonNullable:!0},zrt=["left","right","center"],Frt=["baseline","top","middle","bottom"],AMe={type:zrt,nonNullable:!0},OMe={type:Frt,nonNullable:!0},Z8t=8;var CY;let Mh=CY=class extends ke{constructor(t){super(t),this.decoration="none",this.family="sans-serif",this.size=9,this.style="normal",this.weight="normal"}castSize(t){return sn(t)}clone(){return new CY({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}hash(){return`${this.decoration}.${this.family}.${this.size}.${this.style}.${this.weight}`}};d([m({type:Irt,json:{default:"none",write:!0}})],Mh.prototype,"decoration",void 0),d([m({type:String,json:{write:!0}})],Mh.prototype,"family",void 0),d([m({type:Number,json:{write:{overridePolicy:(t,e,i)=>({enabled:!i||!i.textSymbol3D})}}})],Mh.prototype,"size",void 0),d([qr("size")],Mh.prototype,"castSize",null),d([m({type:Lrt,json:{default:"normal",write:!0}})],Mh.prototype,"style",void 0),d([m({type:krt,json:{default:"normal",write:!0}})],Mh.prototype,"weight",void 0),Mh=CY=d([k("esri.symbols.Font")],Mh);var MY;let m3=MY=class extends ke{constructor(){super(...arguments),this.color=new mt([0,0,0,1]),this.size=0}clone(){const t={color:Te(this.color),size:this.size};return new MY(t)}};d([m(Iy())],m3.prototype,"color",void 0),d([m(Jf)],m3.prototype,"size",void 0),m3=MY=d([k("esri.symbols.support.Symbol3DHalo")],m3);let GP=class extends ur(ke){constructor(e){super(e),this.color=null}};d([m(Iy())],GP.prototype,"color",void 0),GP=d([k("esri.symbols.support.Symbol3DTextBackground")],GP);var Iz,A$;let jn=(A$=class extends Vl{constructor(e){super(e),this._userSize=void 0,this.halo=null,this.horizontalAlignment="center",this.lineHeight=1,this.material=null,this.background=null,this.text=null,this.type="text",this.verticalAlignment="baseline",this.occludedVisibility=null}get font(){return this._get("font")||null}set font(e){e!=null&&this._userSize!=null&&(e.size=this._userSize),this._set("font",e)}writeFont(e,i,r,s){const n={...s,textSymbol3D:!0};i.font=e.write({},n),delete i.font.size}get size(){return this._userSize!=null?this._userSize:this.font?.size!=null?this.font.size:9}set size(e){this._userSize=e,this.font!=null&&(this.font.size=this._userSize),this.notifyChange("size")}clone(){const e=new Iz({enabled:this.enabled,font:Te(this.font),halo:Te(this.halo),horizontalAlignment:this.horizontalAlignment,lineHeight:this.lineHeight,material:this.material!=null?this.material.clone():null,text:this.text,verticalAlignment:this.verticalAlignment,background:Te(this.background),occludedVisibility:Te(this.occludedVisibility)});return e._userSize=this._userSize,e}static fromTextSymbol(e){return new Iz({font:e.font!=null?e.font.clone():new Mh,halo:Nrt(e.haloColor,e.haloSize),horizontalAlignment:e.horizontalAlignment,lineHeight:e.lineHeight,material:e.color?new Au({color:e.color.clone()}):null,text:e.text,verticalAlignment:e.verticalAlignment,background:e.backgroundColor?new GP({color:e.backgroundColor.clone()}):null})}},Iz=A$,A$);function Nrt(t,e){return t&&e!=null&&e>0?new m3({color:Te(t),size:e}):null}d([m({type:Mh,json:{write:!0}})],jn.prototype,"font",null),d([Ht("font")],jn.prototype,"writeFont",null),d([m({type:m3,json:{write:!0}})],jn.prototype,"halo",void 0),d([m({...AMe,json:{default:"center",write:!0}})],jn.prototype,"horizontalAlignment",void 0),d([m({...EMe,json:{default:1,write:!0}})],jn.prototype,"lineHeight",void 0),d([m({type:Au,json:{write:!0}})],jn.prototype,"material",void 0),d([m({type:GP,json:{write:!0}})],jn.prototype,"background",void 0),d([m(Jf)],jn.prototype,"size",null),d([m({type:String,json:{write:!0}})],jn.prototype,"text",void 0),d([Et({Text:"text"},{readOnly:!0})],jn.prototype,"type",void 0),d([m({...OMe,json:{default:"baseline",write:!0}})],jn.prototype,"verticalAlignment",void 0),d([m({type:CMe})],jn.prototype,"occludedVisibility",void 0),jn=Iz=d([k("esri.symbols.TextSymbol3DLayer")],jn);var EY,O$;let Sg=(O$=class extends Vl{constructor(e){super(e),this.color=AY.clone(),this.type="water",this.waterbodySize="medium",this.waveDirection=null,this.waveStrength="moderate"}clone(){return new EY({color:this.color.clone(),waterbodySize:this.waterbodySize,waveDirection:this.waveDirection,waveStrength:this.waveStrength})}},EY=O$,O$);d([m({type:mt,nonNullable:!0,json:{type:[qi],write:(t,e,i)=>e[i]=t.toArray(1),default:()=>AY.clone(),defaultEquals:t=>t.toCss(!0)===AY.toCss(!0)}})],Sg.prototype,"color",void 0),d([Et({Water:"water"},{readOnly:!0})],Sg.prototype,"type",void 0),d([m({type:["small","medium","large"],json:{write:!0,default:"medium"}})],Sg.prototype,"waterbodySize",void 0),d([m({type:Number,json:{write:!0,default:null}})],Sg.prototype,"waveDirection",void 0),d([m({type:["calm","rippled","slight","moderate"],json:{write:!0,default:"moderate"}})],Sg.prototype,"waveStrength",void 0),Sg=EY=d([k("esri.symbols.WaterSymbol3DLayer")],Sg);const AY=new mt([0,119,190]);var OY;let Dg=OY=class extends Me{constructor(t){super(t),this.name=null,this.styleUrl=null,this.styleName=null,this.portal=null}clone(){return new OY({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}};d([m({type:String})],Dg.prototype,"name",void 0),d([m({type:String})],Dg.prototype,"styleUrl",void 0),d([m({type:String})],Dg.prototype,"styleName",void 0),d([m({type:Fe})],Dg.prototype,"portal",void 0),Dg=OY=d([k("esri.symbols.support.StyleOrigin")],Dg);var PY;let HP=PY=class extends Me{constructor(){super(...arguments),this.url=""}clone(){return new PY({url:this.url})}};d([m({type:String})],HP.prototype,"url",void 0),HP=PY=d([k("esri.symbols.support.Thumbnail")],HP);const PMe={icon:Fa,object:Ka,line:vc,path:Co,fill:Sc,extrude:xg,text:jn,water:Sg},Vrt=He.ofType({base:Vl,key:"type",typeMap:PMe,errorContext:"symbol-layer"});let bc=class extends Qn{constructor(e){super(e),this.styleOrigin=null,this.thumbnail=null,this.type=null;const i=this.__accessor__&&this.__accessor__.metadata&&this.__accessor__.metadata.symbolLayers,r=i?.type,s=r||He;this._set("symbolLayers",new s)}get color(){return null}set color(e){this.constructed&&fe.getLogger(this).error("Symbol3D does not support colors on the symbol level. Colors may be set on individual symbol layer materials instead.")}set symbolLayers(e){kc(e,this._get("symbolLayers"))}readStyleOrigin(e,i,r){if(e.styleUrl&&e.name){const s=cM(e.styleUrl,r);return new Dg({styleUrl:s,name:e.name})}if(e.styleName&&e.name)return new Dg({portal:r?.portal||Fe.getDefault(),styleName:e.styleName,name:e.name});r?.messages&&r.messages.push(new ay("symbol3d:incomplete-style-origin","Style origin requires either a 'styleUrl' or 'styleName' and a 'name' property",{context:r,definition:e}))}writeStyleOrigin(e,i,r,s){if(e.styleUrl&&e.name){let n=oC(e.styleUrl,s);Ic(n)&&(n=Jg(n)),i.styleOrigin={styleUrl:n,name:e.name}}else e.styleName&&e.name&&(e.portal&&s?.portal&&!T9e(e.portal.restUrl,s.portal.restUrl)?s?.messages&&s.messages.push(new ay("symbol:cross-portal","The symbol style origin cannot be persisted because it refers to an item on a different portal than the one being saved to.",{symbol:this})):i.styleOrigin={styleName:e.styleName,name:e.name})}normalizeCtorArgs(e){return e instanceof Vl||e&&PMe[e.type]?{symbolLayers:[e]}:Array.isArray(e)?{symbolLayers:e}:e}};d([m({json:{read:!1,write:!1}})],bc.prototype,"color",null),d([m({type:Vrt,nonNullable:!0,json:{write:!0}}),qr(DU)],bc.prototype,"symbolLayers",null),d([m({type:Dg})],bc.prototype,"styleOrigin",void 0),d([di("styleOrigin")],bc.prototype,"readStyleOrigin",null),d([Ht("styleOrigin",{"styleOrigin.styleUrl":{type:String},"styleOrigin.styleName":{type:String},"styleOrigin.name":{type:String}})],bc.prototype,"writeStyleOrigin",null),d([m({type:HP,json:{read:!1}})],bc.prototype,"thumbnail",void 0),d([m({type:["point-3d","line-3d","polygon-3d","mesh-3d","label-3d"],readOnly:!0})],bc.prototype,"type",void 0),bc=d([k("esri.symbols.Symbol3D")],bc);let g3=class extends ke{constructor(e){super(e),this.visible=!0}clone(){throw new Error("Subclasses of Callout3D should implement their own clone method.")}};d([m({type:["line"],constructOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,isRequired:!0}}})],g3.prototype,"type",void 0),d([m({readOnly:!0})],g3.prototype,"visible",void 0),g3=d([k("esri.symbols.callouts.Callout3D")],g3);var RY;let Lz=RY=class extends ke{constructor(t){super(t),this.color=new mt("white")}clone(){return new RY({color:Te(this.color)})}};d([m(Iy({colorRequiredOnWrite:!0}))],Lz.prototype,"color",void 0),Lz=RY=d([k("esri.symbols.callouts.LineCallout3DBorder")],Lz);const Urt=Lz;var DY;let Tg=DY=class extends g3{constructor(t){super(t),this.type="line",this.color=new mt([0,0,0,1]),this.size=gv(1),this.border=null}get visible(){return this.size>0&&this.color!=null&&this.color.a>0}clone(){return new DY({color:Te(this.color),size:this.size,border:Te(this.border)})}};d([Et({line:"line"})],Tg.prototype,"type",void 0),d([m(Iy({colorRequiredOnWrite:!0}))],Tg.prototype,"color",void 0),d([m({...Jf,json:{write:{isRequired:!0}}})],Tg.prototype,"size",void 0),d([m({type:Urt,json:{write:!0}})],Tg.prototype,"border",void 0),d([m({readOnly:!0})],Tg.prototype,"visible",null),Tg=DY=d([k("esri.symbols.callouts.LineCallout3D")],Tg);function Vte(t){if(!t)return!1;const e=t.verticalOffset;return!(!e||e.screenLength<=0||e.maxWorldLength!=null&&e.maxWorldLength<=0)}function RMe(t){return!t||!t.supportsCallout||!t.supportsCallout()?!1:!!t.callout?.visible&&!!Vte(t)}function DMe(t){return t.type==="point-3d"||t.type==="label-3d"}function Brt(t){return t.horizontalAlignment==="center"}const IMe={types:{key:"type",base:g3,typeMap:{line:Tg}},json:{write:!0}};var IY;let b_=IY=class extends ke{constructor(t){super(t),this.screenLength=0,this.minWorldLength=0,this.maxWorldLength=null}clone(){return new IY({screenLength:this.screenLength,minWorldLength:this.minWorldLength,maxWorldLength:this.maxWorldLength})}};d([m({...Jf,json:{write:{isRequired:!0}}})],b_.prototype,"screenLength",void 0),d([m({type:Number,nonNullable:!0,json:{write:!0,default:0}})],b_.prototype,"minWorldLength",void 0),d([m({type:Number,json:{write:!0}})],b_.prototype,"maxWorldLength",void 0),b_=IY=d([k("esri.symbols.support.Symbol3DVerticalOffset")],b_);var kz;const LMe=He.ofType({base:null,key:"type",typeMap:{text:jn}});let Sf=kz=class extends bc{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.styleOrigin=null,this.symbolLayers=new LMe,this.type="label-3d"}supportsCallout(){return!0}hasVisibleCallout(){return RMe(this)}hasVisibleVerticalOffset(){return Vte(this)}clone(){return new kz({styleOrigin:Te(this.styleOrigin),symbolLayers:Te(this.symbolLayers),thumbnail:Te(this.thumbnail),callout:Te(this.callout),verticalOffset:Te(this.verticalOffset)})}static fromTextSymbol(t){return new kz({symbolLayers:new He([jn.fromTextSymbol(t)])})}};d([m({type:b_,json:{write:!0}})],Sf.prototype,"verticalOffset",void 0),d([m(IMe)],Sf.prototype,"callout",void 0),d([m({json:{read:!1,write:!1}})],Sf.prototype,"styleOrigin",void 0),d([m({type:LMe})],Sf.prototype,"symbolLayers",void 0),d([Et({LabelSymbol3D:"label-3d"},{readOnly:!0})],Sf.prototype,"type",void 0),Sf=kz=d([k("esri.symbols.LabelSymbol3D")],Sf);var zz;const kMe=He.ofType({base:null,key:"type",typeMap:{line:vc,path:Co}}),jrt=He.ofType({base:null,key:"type",typeMap:{line:vc,path:Co}});let A_=zz=class extends bc{constructor(t){super(t),this.symbolLayers=new kMe,this.type="line-3d"}clone(){return new zz({styleOrigin:Te(this.styleOrigin),symbolLayers:Te(this.symbolLayers),thumbnail:Te(this.thumbnail)})}static fromSimpleLineSymbol(t){return new zz({symbolLayers:new He([vc.fromSimpleLineSymbol(t)])})}};d([m({type:kMe,json:{type:jrt}})],A_.prototype,"symbolLayers",void 0),d([Et({LineSymbol3D:"line-3d"},{readOnly:!0})],A_.prototype,"type",void 0),A_=zz=d([k("esri.symbols.LineSymbol3D")],A_);var Fz;const zMe=He.ofType({base:null,key:"type",typeMap:{fill:Sc}});let O_=Fz=class extends bc{constructor(t){super(t),this.symbolLayers=new zMe,this.type="mesh-3d"}clone(){return new Fz({styleOrigin:Te(this.styleOrigin),symbolLayers:Te(this.symbolLayers),thumbnail:Te(this.thumbnail)})}static fromSimpleFillSymbol(t){return new Fz({symbolLayers:new He([Sc.fromSimpleFillSymbol(t)])})}};d([m({type:zMe})],O_.prototype,"symbolLayers",void 0),d([Et({MeshSymbol3D:"mesh-3d"},{readOnly:!0})],O_.prototype,"type",void 0),O_=Fz=d([k("esri.symbols.MeshSymbol3D")],O_);let yO=class extends Qn{constructor(e){super(e),this.type="simple-line",this.width=.75}hash(){return`${this.type}.${this.width}`}};d([Et({esriSLS:"simple-line"},{readOnly:!0})],yO.prototype,"type",void 0),d([m({type:Number,cast:sn,json:{write:!0}})],yO.prototype,"width",void 0),yO=d([k("esri.symbols.LineSymbol")],yO);var LY;let af=LY=class extends ke{constructor(t){super(t),this.placement="begin-end",this.type="line-marker",this.style="arrow"}writeStyle(t,e,i,r){e[i]=r?.origin==="web-map"?"arrow":t}set color(t){this._set("color",t)}readColor(t){return t?.[0]!=null?[t[0],t[1],t[2],t[3]/255]:t}writeColor(t,e,i,r){r?.origin==="web-map"||(e[i]=t)}clone(){return new LY({color:Te(this.color),placement:this.placement,style:this.style})}hash(){return`${this.placement}.${this.color?.hash()}.${this.style}`}};d([m({type:["begin","end","begin-end"],json:{write:!0}})],af.prototype,"placement",void 0),d([Et({"line-marker":"line-marker"},{readOnly:!0}),m({json:{origins:{"web-map":{write:!1}}}})],af.prototype,"type",void 0),d([m({type:MMe})],af.prototype,"style",void 0),d([Ht("style")],af.prototype,"writeStyle",null),d([m({type:mt,value:null,json:{write:{allowNull:!0}}})],af.prototype,"color",null),d([di("color")],af.prototype,"readColor",null),d([Ht("color")],af.prototype,"writeColor",null),af=LY=d([k("esri.symbols.LineSymbolMarker")],af);const qrt=af;var kY;const A7=new ta({esriSLSSolid:"solid",esriSLSDash:"dash",esriSLSDot:"dot",esriSLSDashDot:"dash-dot",esriSLSDashDotDot:"long-dash-dot-dot",esriSLSNull:"none",esriSLSShortDash:"short-dash",esriSLSShortDot:"short-dot",esriSLSShortDashDot:"short-dash-dot",esriSLSShortDashDotDot:"short-dash-dot-dot",esriSLSLongDash:"long-dash",esriSLSLongDashDot:"long-dash-dot"});let Oo=kY=class extends yO{constructor(...t){super(...t),this.type="simple-line",this.style="solid",this.cap="round",this.join="round",this.marker=null,this.miterLimit=2}normalizeCtorArgs(t,e,i,r,s,n){if(t&&typeof t!="string")return t;const a={};return t!=null&&(a.style=t),e!=null&&(a.color=e),i!=null&&(a.width=sn(i)),r!=null&&(a.cap=r),s!=null&&(a.join=s),n!=null&&(a.miterLimit=sn(n)),a}clone(){return new kY({color:Te(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit,marker:this.marker?.clone()})}hash(){return`${super.hash()}.${this.color?.hash()}.${this.style}.${this.cap}.${this.join}.${this.miterLimit}.${this.marker?.hash()}`}};d([Et({esriSLS:"simple-line"},{readOnly:!0})],Oo.prototype,"type",void 0),d([m({type:A7.apiValues,json:{read:A7.read,write:A7.write}})],Oo.prototype,"style",void 0),d([m({type:["butt","round","square"],json:{write:{overridePolicy:(t,e,i)=>({enabled:t!=="round"&&i?.origin==null})}}})],Oo.prototype,"cap",void 0),d([m({type:["miter","round","bevel"],json:{write:{overridePolicy:(t,e,i)=>({enabled:t!=="round"&&i?.origin==null})}}})],Oo.prototype,"join",void 0),d([m({types:{key:"type",base:null,defaultKeyValue:"line-marker",typeMap:{"line-marker":qrt}},json:{write:!0,origins:{"web-scene":{write:!1}}}})],Oo.prototype,"marker",void 0),d([m({type:Number,json:{read:!1,write:!1}})],Oo.prototype,"miterLimit",void 0),Oo=kY=d([k("esri.symbols.SimpleLineSymbol")],Oo);let y3=class extends Qn{constructor(e){super(e),this.outline=null,this.type=null}hash(){return`${this.type}.${this.outline?.hash()}`}};d([m({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":Oo}},json:{default:null,write:!0}})],y3.prototype,"outline",void 0),d([m({type:["simple-fill","picture-fill"],readOnly:!0})],y3.prototype,"type",void 0),y3=d([k("esri.symbols.FillSymbol")],y3);function Grt(t,e,i){return e.imageData?uxe({mediaType:e.contentType||"image/png",isBase64:!0,data:e.imageData}):FMe(e.url,i)}function FMe(t,e){if(!Ic(t)){const i=Wrt(e);if(i)return Mp(i,"images",t)}return cM(t,e)}function Hrt(t,e,i,r){if(rm(t)){const s=aC(t);if(!s)return;e.contentType=s.mediaType,e.imageData=s.data,i&&i.imageData===e.imageData&&i.url&&lC(i.url,e,"url",r)}else lC(t,e,"url",r)}const NMe={json:{read:{source:["imageData","url"],reader:Grt},write:{writer(t,e,i,r){Hrt(t,e,this.source,r)}}}},VMe={readOnly:!0,json:{read:{source:["imageData","url"],reader(t,e,i){const r={};return e.imageData&&(r.imageData=e.imageData),e.contentType&&(r.contentType=e.contentType),e.url&&(r.url=FMe(e.url,i)),r}}}};function Wrt(t){if(!t)return null;const{origin:e,layer:i}=t;if(e!=="service"&&e!=="portal-item")return null;const r=i?.type;return r==="feature"||r==="stream"?i.parsedUrl?.path:r==="map-image"||r==="tile"?t.url?.path:null}var zY;let fc=zY=class extends y3{constructor(...t){super(...t),this.type="picture-fill",this.url=null,this.xscale=1,this.yscale=1,this.width=12,this.height=12,this.xoffset=0,this.yoffset=0,this.source=null}normalizeCtorArgs(t,e,i,r){if(t&&typeof t!="string"&&t.imageData==null)return t;const s={};return t&&(s.url=t),e&&(s.outline=e),i!=null&&(s.width=sn(i)),r!=null&&(s.height=sn(r)),s}clone(){const t=new zY({color:Te(this.color),height:this.height,outline:Te(this.outline),url:this.url,width:this.width,xoffset:this.xoffset,xscale:this.xscale,yoffset:this.yoffset,yscale:this.yscale});return t._set("source",Te(this.source)),t}hash(){return`${super.hash()}.${this.color?.hash()}.${this.height}.${this.url}.${this.width}.${this.xoffset}.${this.xscale}.${this.yoffset}.${this.yscale}`}};d([Et({esriPFS:"picture-fill"},{readOnly:!0})],fc.prototype,"type",void 0),d([m(NMe)],fc.prototype,"url",void 0),d([m({type:Number,json:{write:!0}})],fc.prototype,"xscale",void 0),d([m({type:Number,json:{write:!0}})],fc.prototype,"yscale",void 0),d([m({type:Number,cast:sn,json:{write:!0}})],fc.prototype,"width",void 0),d([m({type:Number,cast:sn,json:{write:!0}})],fc.prototype,"height",void 0),d([m({type:Number,cast:sn,json:{write:!0}})],fc.prototype,"xoffset",void 0),d([m({type:Number,cast:sn,json:{write:!0}})],fc.prototype,"yoffset",void 0),d([m(VMe)],fc.prototype,"source",void 0),fc=zY=d([k("esri.symbols.PictureFillSymbol")],fc);let $g=class extends Qn{constructor(e){super(e),this.angle=0,this.type=null,this.xoffset=0,this.yoffset=0,this.size=9}hash(){return`${this.type}.${this.angle}.${this.size}.${this.xoffset}.${this.yoffset}`}};d([m({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],$g.prototype,"angle",void 0),d([m({type:["simple-marker","picture-marker"],readOnly:!0})],$g.prototype,"type",void 0),d([m({type:Number,cast:sn,json:{write:!0}})],$g.prototype,"xoffset",void 0),d([m({type:Number,cast:sn,json:{write:!0}})],$g.prototype,"yoffset",void 0),d([m({cast:t=>t==="auto"?t:xu(sn(t)),json:{write:!0}})],$g.prototype,"size",void 0),$g=d([k("esri.symbols.MarkerSymbol")],$g);var FY;let gc=FY=class extends $g{constructor(...t){super(...t),this.color=null,this.type="picture-marker",this.url=null,this.source=null,this.height=12,this.width=12,this.size=null}normalizeCtorArgs(t,e,i){if(t&&typeof t!="string"&&t.imageData==null)return t;const r={};return t&&(r.url=t),e!=null&&(r.width=sn(e)),i!=null&&(r.height=sn(i)),r}readHeight(t,e){return e.size||t}readWidth(t,e){return e.size||t}clone(){const t=new FY({angle:this.angle,height:this.height,url:this.url,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset});return t._set("source",Te(this.source)),t}hash(){return`${super.hash()}.${this.height}.${this.url}.${this.width}`}};d([m({json:{write:!1}})],gc.prototype,"color",void 0),d([Et({esriPMS:"picture-marker"},{readOnly:!0})],gc.prototype,"type",void 0),d([m(NMe)],gc.prototype,"url",void 0),d([m(VMe)],gc.prototype,"source",void 0),d([m({type:Number,cast:sn,json:{write:!0}})],gc.prototype,"height",void 0),d([di("height",["height","size"])],gc.prototype,"readHeight",null),d([m({type:Number,cast:sn,json:{write:!0}})],gc.prototype,"width",void 0),d([m({json:{write:!1}})],gc.prototype,"size",void 0),gc=FY=d([k("esri.symbols.PictureMarkerSymbol")],gc);var lb;const UMe=He.ofType({base:null,key:"type",typeMap:{icon:Fa,object:Ka,text:jn}});let Hd=lb=class extends bc{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.symbolLayers=new UMe,this.type="point-3d"}supportsCallout(){if((this.symbolLayers?this.symbolLayers.length:0)<1)return!1;for(const t of this.symbolLayers.items)switch(t.type){case"icon":case"text":case"object":continue;default:return!1}return!0}hasVisibleCallout(){return RMe(this)}hasVisibleVerticalOffset(){return Vte(this)}clone(){return new lb({verticalOffset:Te(this.verticalOffset),callout:Te(this.callout),styleOrigin:Te(this.styleOrigin),symbolLayers:Te(this.symbolLayers),thumbnail:Te(this.thumbnail)})}static fromSimpleMarkerSymbol(t){return new lb({symbolLayers:new He([Fa.fromSimpleMarkerSymbol(t)])})}static fromPictureMarkerSymbol(t){return new lb({symbolLayers:new He([Fa.fromPictureMarkerSymbol(t)])})}static fromCIMSymbol(t){if(t.data?.symbol?.type!=="CIMPointSymbol")return null;const i=t.data.symbol;return new lb(i?.callout?{symbolLayers:new He([Fa.fromCIMSymbol(t)]),callout:new Tg({size:.5,color:new mt([0,0,0])}),verticalOffset:new b_({screenLength:40})}:{symbolLayers:new He([Fa.fromCIMSymbol(t)])})}static fromTextSymbol(t){return new lb({symbolLayers:new He([jn.fromTextSymbol(t)])})}};d([m({type:b_,json:{write:!0}})],Hd.prototype,"verticalOffset",void 0),d([m(IMe)],Hd.prototype,"callout",void 0),d([m({type:UMe,json:{origins:{"web-scene":{write:!0}}}})],Hd.prototype,"symbolLayers",void 0),d([Et({PointSymbol3D:"point-3d"},{readOnly:!0})],Hd.prototype,"type",void 0),Hd=lb=d([k("esri.symbols.PointSymbol3D")],Hd);var _O;const BMe=He.ofType({base:null,key:"type",typeMap:{extrude:xg,fill:Sc,icon:Fa,line:vc,object:Ka,text:jn,water:Sg}});let P_=_O=class extends bc{constructor(t){super(t),this.symbolLayers=new BMe,this.type="polygon-3d"}initialize(){const t=e=>{e.type==="line"&&cv(fe.getLogger(this),"LineSymbol3DLayer can not be used as a SymbolLayer with a PolygonSymbol3D symbol anymore.",{replacement:"Use FillSymbol3DLayer.outline instead.",version:"4.28"}),e.type==="text"&&cv(fe.getLogger(this),"TextSymbol3DLayer can not be used as a SymbolLayer with a PolygonSymbol3D symbol anymore.",{replacement:"Use Labels instead.",version:"4.28"})};for(const e of this.symbolLayers)t(e);this.addHandles(Ys(()=>this.symbolLayers,"after-add",({item:e})=>t(e),Yt))}clone(){return new _O({styleOrigin:Te(this.styleOrigin),symbolLayers:Te(this.symbolLayers),thumbnail:Te(this.thumbnail)})}static fromJSON(t){const e=new _O;if(e.read(t),e.symbolLayers.length===2&&e.symbolLayers.at(0).type==="fill"&&e.symbolLayers.at(1).type==="line"){const i=e.symbolLayers.at(0),r=e.symbolLayers.at(1);!r.enabled||t.symbolLayers?.[1]&&t.symbolLayers[1].enable===!1||(i.outline={size:r.size,color:r.material!=null?r.material.color:null}),e.symbolLayers.removeAt(1)}return e}static fromSimpleFillSymbol(t){return new _O({symbolLayers:new He([Sc.fromSimpleFillSymbol(t)])})}};d([m({type:BMe,json:{write:!0}})],P_.prototype,"symbolLayers",void 0),d([Et({PolygonSymbol3D:"polygon-3d"},{readOnly:!0})],P_.prototype,"type",void 0),P_=_O=d([k("esri.symbols.PolygonSymbol3D")],P_);var NY;const O7=new ta({esriSFSSolid:"solid",esriSFSNull:"none",esriSFSHorizontal:"horizontal",esriSFSVertical:"vertical",esriSFSForwardDiagonal:"forward-diagonal",esriSFSBackwardDiagonal:"backward-diagonal",esriSFSCross:"cross",esriSFSDiagonalCross:"diagonal-cross"});let Mf=NY=class extends y3{constructor(...t){super(...t),this.color=new mt([0,0,0,.25]),this.outline=new Oo,this.type="simple-fill",this.style="solid"}normalizeCtorArgs(t,e,i){if(t&&typeof t!="string")return t;const r={};return t&&(r.style=t),e&&(r.outline=e),i&&(r.color=i),r}clone(){return new NY({color:Te(this.color),outline:this.outline&&this.outline.clone(),style:this.style})}hash(){return`${super.hash()}${this.style}.${this.color&&this.color.hash()}`}};d([m()],Mf.prototype,"color",void 0),d([m()],Mf.prototype,"outline",void 0),d([Et({esriSFS:"simple-fill"},{readOnly:!0})],Mf.prototype,"type",void 0),d([m({type:O7.apiValues,json:{read:O7.read,write:O7.write}})],Mf.prototype,"style",void 0),Mf=NY=d([k("esri.symbols.SimpleFillSymbol")],Mf);var VY;const P7=new ta({esriSMSCircle:"circle",esriSMSSquare:"square",esriSMSCross:"cross",esriSMSX:"x",esriSMSDiamond:"diamond",esriSMSTriangle:"triangle",esriSMSPath:"path"});let Rl=VY=class extends $g{constructor(...t){super(...t),this.color=new mt([255,255,255,.25]),this.type="simple-marker",this.size=12,this.style="circle",this.outline=new Oo}normalizeCtorArgs(t,e,i,r){if(t&&typeof t!="string")return t;const s={};return t&&(s.style=t),e!=null&&(s.size=sn(e)),i&&(s.outline=i),r&&(s.color=r),s}writeColor(t,e){t&&this.style!=="x"&&this.style!=="cross"&&(e.color=t.toJSON()),t===null&&(e.color=null)}set path(t){this.style="path",this._set("path",t)}clone(){return new VY({angle:this.angle,color:Te(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){return`${super.hash()}.${this.color&&this.color.hash()}.${this.path}.${this.style}.${this.outline?.hash()}`}};d([m()],Rl.prototype,"color",void 0),d([Ht("color")],Rl.prototype,"writeColor",null),d([Et({esriSMS:"simple-marker"},{readOnly:!0})],Rl.prototype,"type",void 0),d([m()],Rl.prototype,"size",void 0),d([m({type:P7.apiValues,json:{read:P7.read,write:P7.write}})],Rl.prototype,"style",void 0),d([m({type:String,json:{write:!0}})],Rl.prototype,"path",null),d([m({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":Oo}},json:{default:null,write:!0}})],Rl.prototype,"outline",void 0),Rl=VY=d([k("esri.symbols.SimpleMarkerSymbol")],Rl);var UY;let Kr=UY=class extends Qn{constructor(...t){super(...t),this.backgroundColor=null,this.borderLineColor=null,this.borderLineSize=null,this.font=new Mh,this.horizontalAlignment="center",this.kerning=!0,this.haloColor=null,this.haloSize=null,this.rightToLeft=null,this.rotated=!1,this.text="",this.type="text",this.verticalAlignment="baseline",this.xoffset=0,this.yoffset=0,this.angle=0,this.width=null,this.lineWidth=192,this.lineHeight=1}normalizeCtorArgs(t,e,i){if(t&&typeof t!="string")return t;const r={};return t&&(r.text=t),e&&(r.font=e),i&&(r.color=i),r}writeLineWidth(t,e,i,r){r&&typeof r!="string"?r.origin:e[i]=t}castLineWidth(t){return sn(t)}writeLineHeight(t,e,i,r){r&&typeof r!="string"?r.origin:e[i]=t}clone(){return new UY({angle:this.angle,backgroundColor:Te(this.backgroundColor),borderLineColor:Te(this.borderLineColor),borderLineSize:this.borderLineSize,color:Te(this.color),font:this.font&&this.font.clone(),haloColor:Te(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,kerning:this.kerning,lineHeight:this.lineHeight,lineWidth:this.lineWidth,rightToLeft:this.rightToLeft,rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){return`${this.backgroundColor?.hash()}.${this.borderLineColor}.${this.borderLineSize}.${this.color?.hash()}.${this.font&&this.font.hash()}.${this.haloColor?.hash()}.${this.haloSize}.${this.horizontalAlignment}.${this.kerning}.${this.rightToLeft}.${this.rotated}.${this.text}.${this.verticalAlignment}.${this.width}.${this.xoffset}.${this.yoffset}.${this.lineHeight}.${this.lineWidth}.${this.angle}`}};d([m({type:mt,json:{write:!0}})],Kr.prototype,"backgroundColor",void 0),d([m({type:mt,json:{write:!0}})],Kr.prototype,"borderLineColor",void 0),d([m({type:Number,json:{write:!0},cast:sn})],Kr.prototype,"borderLineSize",void 0),d([m({type:Mh,json:{write:!0}})],Kr.prototype,"font",void 0),d([m({...AMe,json:{write:!0}})],Kr.prototype,"horizontalAlignment",void 0),d([m({type:Boolean,json:{write:!0}})],Kr.prototype,"kerning",void 0),d([m({type:mt,json:{write:!0}})],Kr.prototype,"haloColor",void 0),d([m({type:Number,cast:sn,json:{write:!0}})],Kr.prototype,"haloSize",void 0),d([m({type:Boolean,json:{write:!0}})],Kr.prototype,"rightToLeft",void 0),d([m({type:Boolean,json:{write:!0}})],Kr.prototype,"rotated",void 0),d([m({type:String,json:{write:!0}})],Kr.prototype,"text",void 0),d([Et({esriTS:"text"},{readOnly:!0})],Kr.prototype,"type",void 0),d([m({...OMe,json:{write:!0}})],Kr.prototype,"verticalAlignment",void 0),d([m({type:Number,cast:sn,json:{write:!0}})],Kr.prototype,"xoffset",void 0),d([m({type:Number,cast:sn,json:{write:!0}})],Kr.prototype,"yoffset",void 0),d([m({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],Kr.prototype,"angle",void 0),d([m({type:Number,json:{write:!0}})],Kr.prototype,"width",void 0),d([m({type:Number})],Kr.prototype,"lineWidth",void 0),d([Ht("lineWidth")],Kr.prototype,"writeLineWidth",null),d([qr("lineWidth")],Kr.prototype,"castLineWidth",null),d([m(EMe)],Kr.prototype,"lineHeight",void 0),d([Ht("lineHeight")],Kr.prototype,"writeLineHeight",null),Kr=UY=d([k("esri.symbols.TextSymbol")],Kr);var BY;let yc=BY=class extends Qn{constructor(t){super(t),this.color=null,this.styleName=null,this.portal=null,this.styleUrl=null,this.thumbnail=null,this.name=null,this.type="web-style"}get _fetchCacheKey(){const t=this.portal!=null?this.portal:Fe.getDefault(),e=t.user?t.user.username:null;return`${this.styleName}:${this.styleUrl}:${this.name}:${e}:${t.url}`}read(t,e){this.portal=e?.portal,super.read(t,e)}clone(){return new BY({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}fetchSymbol(t){return this._fetchSymbol(t)}async fetchCIMSymbol(t){uwe(fe.getLogger(this),"WebStyleSymbol.fetchCIMSymbol is deprecated in favour of WebStyleSymbol.fetchSymbol which now supports both web and cim symbology",{version:"4.33",replacement:"WebStyleSymbol.fetchSymbol",see:"https://arcg.is/0CXPTr#fetchSymbol",warnOnce:!0});const e=await this._fetchSymbol({...t,acceptedFormats:["cim"]});if(e?.type!=="cim")throw new ee("webstylesymbol:fetchCIMSymbol","Resolved web style symbol is not of type 'cim'");return e}async _fetchSymbol(t){const e=t!=null?t.cache:null,i=e?this._fetchCacheKey:null;if(e!=null){const a=i&&e.get(i);if(a)return a.clone()}const{resolveWebStyleSymbol:r}=await te(()=>import("./webStyleSymbolUtils-BACwhvKO.js"),__vite__mapDeps([189,190,100,101,57,25,102]));st(t);const s=r(this,{portal:this.portal},t);s.catch(a=>{fe.getLogger(this).error("#fetchSymbol()","Failed to create symbol from style",a)});const n=await s;return e?.set(i,n.clone()),n}};d([m({json:{write:!1}})],yc.prototype,"color",void 0),d([m({type:String,json:{write:!0}})],yc.prototype,"styleName",void 0),d([m({type:Fe,json:{write:!1}})],yc.prototype,"portal",void 0),d([m({type:String,json:{read:oU,write:lC}})],yc.prototype,"styleUrl",void 0),d([m({type:HP,json:{read:!1}})],yc.prototype,"thumbnail",void 0),d([m({type:String,json:{write:!0}})],yc.prototype,"name",void 0),d([Et({styleSymbolReference:"web-style"},{readOnly:!0})],yc.prototype,"type",void 0),d([m()],yc.prototype,"_fetchCacheKey",null),yc=BY=d([k("esri.symbols.WebStyleSymbol")],yc);function tBt(t){if(!t)return!1;switch(t.type){case"picture-fill":case"picture-marker":case"simple-fill":case"simple-line":case"simple-marker":case"text":case"cim":return!0;default:return!1}}function iBt(t){switch(t?.type){case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":return!0;default:return!1}}const w_={base:Qn,key:"type",typeMap:{"simple-fill":Mf,"picture-fill":fc,"picture-marker":gc,"simple-line":Oo,"simple-marker":Rl,text:Kr,"label-3d":Sf,"line-3d":A_,"mesh-3d":O_,"point-3d":Hd,"polygon-3d":P_,"web-style":yc,cim:Ll},errorContext:"symbol"},rBt={base:Qn,key:"type",typeMap:{"picture-marker":gc,"simple-marker":Rl,"point-3d":Hd,cim:Ll},errorContext:"symbol"},sBt={base:Qn,key:"type",typeMap:{"simple-line":Oo,"line-3d":A_,cim:Ll},errorContext:"symbol"},nBt={base:Qn,key:"type",typeMap:{"simple-fill":Mf,"picture-fill":fc,"polygon-3d":P_,cim:Ll},errorContext:"symbol"},aBt={base:Qn,key:"type",typeMap:{"picture-marker":gc,"simple-marker":Rl,text:Kr,"web-style":yc,cim:Ll},errorContext:"symbol"},oBt=TK({types:w_}),lBt={base:Qn,key:"type",typeMap:{"simple-fill":Mf,"picture-fill":fc,"picture-marker":gc,"simple-line":Oo,"simple-marker":Rl,text:Kr,"line-3d":A_,"mesh-3d":O_,"point-3d":Hd,"polygon-3d":P_,"web-style":yc,cim:Ll},errorContext:"symbol"},cBt={base:Qn,key:"type",typeMap:{text:Kr,"label-3d":Sf},errorContext:"symbol"},uBt={base:Qn,key:"type",typeMap:{"line-3d":A_,"mesh-3d":O_,"point-3d":Hd,"polygon-3d":P_,"web-style":yc,cim:Ll},errorContext:"symbol"},hBt={base:Qn,key:"type",typeMap:{"label-3d":Sf},errorContext:"symbol"},dBt=ny(w_);var jY;function Zrt(t){if(!t)return null;const e={};for(const i in t){const r=hy(t[i]);r&&(e[i]=r)}return Object.keys(e).length!==0?e:null}function Yrt(t){if(t==null)return null;const e={};for(const i in t){const r=t[i];r&&(e[i]=r.toJSON())}return Object.keys(e).length!==0?e:null}var P$;let Gn=(P$=class extends ur(ke){constructor(e){super(e),this.isAggregate=!1,this.layer=null,this.origin=null,this.sourceLayer=null,this._version=0,Object.defineProperty(this,"uid",{value:ql(),configurable:!0}),Object.defineProperty(this,"_lastMeshTransform",{value:{},configurable:!0,writable:!0,enumerable:!1}),arguments.length>1&&iBe(fe.getLogger(this),"Graphic",{version:"4.30"})}initialize(){this._watchMeshGeometryChanges()}set aggregateGeometries(e){const i=this._get("aggregateGeometries");JSON.stringify(i)!==JSON.stringify(e)&&this._set("aggregateGeometries",e)}set attributes(e){const i=this._get("attributes");i!==e&&(this._set("attributes",e),this._notifyLayer("attributes",i,e))}set geometry(e){const i=this._get("geometry");i!==e&&(this._set("geometry",e),e?.type!=="mesh"&&this._notifyLayer("geometry",i,e))}set popupTemplate(e){const i=this._get("popupTemplate");i!==e&&(this._set("popupTemplate",e),this._notifyLayer("popupTemplate",i,e))}set symbol(e){const i=this._get("symbol");i!==e&&(this._set("symbol",e),this._notifyLayer("symbol",i,e))}get version(){return this._version}set visible(e){const i=this._get("visible");i!==e&&(this._set("visible",e),this._notifyLayer("visible",i,e))}cloneShallow(){return new jY({aggregateGeometries:this.aggregateGeometries,attributes:this.attributes,geometry:this.geometry,isAggregate:this.isAggregate,layer:this.layer,popupTemplate:this.popupTemplate,sourceLayer:this.sourceLayer,symbol:this.symbol,visible:this.visible,origin:this.origin})}getEffectivePopupTemplate(e=!1){if(this.popupTemplate)return this.popupTemplate;const i=irt(this.origin);if(i)return i.popupTemplate??(e?i.defaultPopupTemplate:null)??null;const r=this.origin&&"layer"in this.origin?this.origin.layer:null;for(const s of[r,this.sourceLayer,this.layer])if(s&&typeof s=="object"){if("popupTemplate"in s&&s.popupTemplate)return s.popupTemplate;if(e&&"defaultPopupTemplate"in s&&s.defaultPopupTemplate!=null)return s.defaultPopupTemplate}return null}getAttribute(e){return this.attributes?.[e]}setAttribute(e,i){if(this.attributes){const r=this.getAttribute(e);this.attributes[e]=i,this._notifyLayer("attributes",r,i,e)}else this.attributes={[e]:i}}getObjectId(){const e=dpe(this.origin);if(e)return ppe(this,e);const i=this.sourceLayer??this.layer;return i?ppe(this,i):null}getGlobalId(){const e=dpe(this.origin);if(e?.globalIdField)return this.getAttribute(e.globalIdField);const i=this.sourceLayer??this.layer;return i&&"globalIdField"in i&&i.globalIdField?this.getAttribute(i.globalIdField):null}toJSON(){return{aggregateGeometries:Yrt(this.aggregateGeometries),geometry:this.geometry!=null?this.geometry.toJSON():null,symbol:this.symbol!=null?this.symbol.toJSON():null,attributes:OR(this.attributes)?this.attributes.toJSON():{...this.attributes},popupTemplate:this.popupTemplate?.toJSON()??null}}notifyMeshTransformChanged(e={}){const{geometry:i}=this;if(i?.type==="mesh"){const r={origin:i.origin,transform:i.transform};this._notifyLayer("origin-transform",r,r,e.action)}}_notifyLayer(e,i,r,s){if(this._version++,!this.layer||!("graphicChanged"in this.layer))return;const n={graphic:this,property:e,oldValue:i,newValue:r};e==="origin-transform"&&(n.action=s),e==="attributes"&&(n.attributeName=s),this.layer.graphicChanged(n)}_watchMeshGeometryChanges(){this.addHandles([Zs(()=>this.geometry?.type==="mesh"&&this.geometry.vertexSpace.origin?{localMatrix:this.geometry.transform?.localMatrix,origin:this.geometry.vertexSpace.origin}:void 0,({localMatrix:e,origin:i})=>{this._lastMeshTransform.localMatrix===e&&this._lastMeshTransform.origin===i||(this._lastMeshTransform.localMatrix=e,this._lastMeshTransform.origin=i,this.notifyMeshTransformChanged())}),Zs(()=>this.geometry?.type==="mesh"?{vertexAttributes:this.geometry.vertexAttributes}:void 0,()=>{const e=this.geometry;e?.type==="mesh"&&e.vertexSpace.origin?(this._lastMeshTransform.localMatrix=e.transform?.localMatrix,this._lastMeshTransform.origin=e.vertexSpace.origin):(this._lastMeshTransform.localMatrix=void 0,this._lastMeshTransform.origin=void 0),this._notifyLayer("geometry",this.geometry,this.geometry)},{equals:(e,i)=>e===i,sync:!0})])}},jY=P$,P$);d([m({value:null,json:{read:Zrt}})],Gn.prototype,"aggregateGeometries",null),d([m({value:null})],Gn.prototype,"attributes",null),d([m({value:null,types:hee,json:{read:hy}})],Gn.prototype,"geometry",null),d([m({type:Boolean})],Gn.prototype,"isAggregate",void 0),d([m({clonable:!1})],Gn.prototype,"layer",void 0),d([m({clonable:"reference"})],Gn.prototype,"origin",void 0),d([m({type:Kit,value:null})],Gn.prototype,"popupTemplate",null),d([m({clonable:"reference"})],Gn.prototype,"sourceLayer",void 0),d([m({value:null,types:w_})],Gn.prototype,"symbol",null),d([m({clonable:!1,json:{read:!1,write:!1}})],Gn.prototype,"_version",void 0),d([m({type:Boolean,value:!0})],Gn.prototype,"visible",null),Gn=jY=d([k("esri.Graphic")],Gn);let Ew=class extends DP{_own(e){e.layer&&"remove"in e.layer&&e.layer!==this.owner&&e.layer.remove(e),e.layer=this.owner}_release(e){e.layer===this.owner&&(e.layer=null)}};d([iSe({Type:Gn,ensureType:Ca(Gn)})],Ew.prototype,"itemType",void 0),Ew=d([k("esri.support.GraphicsCollection")],Ew);let Km=class extends Me{constructor(e){super(e),this.view=null,this.baseLayerViews=new He,this.groundLayerViews=new He,this.referenceLayerViews=new He,this._loadingHandle=K(()=>this.view?.map?.basemap,i=>{i&&i.load().catch(()=>{})},Wt)}destroy(){this._set("view",null),this._loadingHandle=Ki(this._loadingHandle),this.baseLayerViews.destroyAll(),this.groundLayerViews.destroyAll(),this.referenceLayerViews.destroyAll()}get suspended(){return this.view?.suspended??!0}get updating(){return this.view?.suspended?!1:!!this.view?.map?.basemap?.loaded&&(this.baseLayerViews.some(i=>i.updating)||this.groundLayerViews.some(i=>i.updating)||this.referenceLayerViews.some(i=>i.updating))}};d([m({constructOnly:!0})],Km.prototype,"view",void 0),d([m({readOnly:!0})],Km.prototype,"baseLayerViews",void 0),d([m({readOnly:!0})],Km.prototype,"groundLayerViews",void 0),d([m({readOnly:!0})],Km.prototype,"referenceLayerViews",void 0),d([m({readOnly:!0})],Km.prototype,"suspended",null),d([m({type:Boolean,readOnly:!0})],Km.prototype,"updating",null),Km=d([k("esri.views.BasemapView")],Km);const Qrt=Km;let cu=class extends Me{constructor(e){super(e),this.factor=1.5,this.offset=Zl(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};d([m({type:Number})],cu.prototype,"factor",void 0),d([m({nonNullable:!0})],cu.prototype,"offset",void 0),d([m()],cu.prototype,"position",void 0),d([m({type:Number,range:{min:0}})],cu.prototype,"size",void 0),d([m()],cu.prototype,"maskUrl",void 0),d([m()],cu.prototype,"maskEnabled",void 0),d([m()],cu.prototype,"overlayUrl",void 0),d([m()],cu.prototype,"overlayEnabled",void 0),d([m({readOnly:!0})],cu.prototype,"version",null),d([m({type:Boolean})],cu.prototype,"visible",void 0),cu=d([k("esri.views.Magnifier")],cu);const jMe=cu;let s$=class{constructor(e){this._observable=new e2,this._map=new Map(e)}get size(){return vt(this._observable),this._map.size}clear(){this._map.size>0&&(this._map.clear(),this._observable.notify())}delete(e){const i=this._map.delete(e);return i&&this._observable.notify(),i}entries(){return vt(this._observable),this._map.entries()}forEach(e,i){vt(this._observable),this._map.forEach((r,s)=>e.call(i,r,s,this),i)}get(e){return vt(this._observable),this._map.get(e)}has(e){return vt(this._observable),this._map.has(e)}keys(){return vt(this._observable),this._map.keys()}set(e,i){return this._map.set(e,i),this._observable.notify(),this}values(){return vt(this._observable),this._map.values()}[Symbol.iterator](){return vt(this._observable),this._map[Symbol.iterator]()}[Symbol.dispose](){this._observable.destroy()}get[Symbol.toStringTag](){return this._map[Symbol.toStringTag]}};var qY;let vO=qY=class extends ke{constructor(t){super(t),this.name=null,this.code=null}clone(){return new qY({name:this.name,code:this.code})}};d([m({type:String,json:{write:{isRequired:!0}}})],vO.prototype,"name",void 0),d([m({type:[String,Number],json:{write:{isRequired:!0}}})],vO.prototype,"code",void 0),vO=qY=d([k("esri.layers.support.CodedValue")],vO);const Xrt=new ta({inherited:"inherited",codedValue:"coded-value",range:"range"});let R_=class extends ke{constructor(e){super(e),this.name=null,this.type=null}};d([m({type:String,json:{write:!0}})],R_.prototype,"name",void 0),d([Et(Xrt),m({json:{write:{isRequired:!0}}})],R_.prototype,"type",void 0),R_=d([k("esri.layers.support.Domain")],R_);var GY,R$;let _3=(R$=class extends R_{constructor(e){super(e),this.codedValues=null,this.type="coded-value"}getName(e){let i=null;if(this.codedValues){const r=String(e);this.codedValues.some(s=>(String(s.code)===r&&(i=s.name),!!i))}return i}clone(){return new GY({codedValues:Te(this.codedValues),name:this.name})}},GY=R$,R$);d([m({type:[vO],json:{write:{isRequired:!0}}})],_3.prototype,"codedValues",void 0),d([Et({codedValue:"coded-value"})],_3.prototype,"type",void 0),_3=GY=d([k("esri.layers.support.CodedValueDomain")],_3);var HY,D$;let WP=(D$=class extends R_{constructor(e){super(e),this.type="inherited"}clone(){return new HY}},HY=D$,D$);d([Et({inherited:"inherited"})],WP.prototype,"type",void 0),WP=HY=d([k("esri.layers.support.InheritedDomain")],WP);var WY,I$;let Fb=(I$=class extends R_{constructor(e){super(e),this.maxValue=null,this.minValue=null,this.type="range"}clone(){return new WY({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}},WY=I$,I$);d([m({json:{type:[Number],read:{source:"range",reader:(t,e)=>e.range?.[1]},write:{enabled:!1,overridePolicy(){return{enabled:this.maxValue!=null&&this.minValue==null}},target:"range",writer(t,e,i){e[i]=[this.minValue||0,t]},isRequired:!0}}})],Fb.prototype,"maxValue",void 0),d([m({json:{type:[Number],read:{source:"range",reader:(t,e)=>e.range?.[0]},write:{target:"range",writer(t,e,i){e[i]=[t,this.maxValue||0]},isRequired:!0}}})],Fb.prototype,"minValue",void 0),d([Et({range:"range"})],Fb.prototype,"type",void 0),Fb=WY=d([k("esri.layers.support.RangeDomain")],Fb);const Jrt={key:"type",base:R_,typeMap:{range:Fb,"coded-value":_3,inherited:WP}};function Krt(t){if(!t?.type)return null;switch(t.type){case"range":return Fb.fromJSON(t);case"codedValue":return _3.fromJSON(t);case"inherited":return WP.fromJSON(t)}return null}const Ute=new ta({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml",esriFieldTypeBigInteger:"big-integer",esriFieldTypeDateOnly:"date-only",esriFieldTypeTimeOnly:"time-only",esriFieldTypeTimestampOffset:"timestamp-offset"});var ZY;const est=new ta({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",currency:"currency",dateAndTime:"date-and-time",description:"description",emailAddress:"email-address",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",phoneNumber:"phone-number",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});var L$;let So=(L$=class extends ke{constructor(e){super(e),this.alias=null,this.defaultValue=void 0,this.description=null,this.domain=null,this.editable=!0,this.length=void 0,this.name=null,this.nullable=!0,this.type=null,this.valueType=null,this.visible=!0}readDescription(e,{description:i}){let r=null;try{r=i?JSON.parse(i):null}catch{}return r?.value??null}readValueType(e,{description:i}){let r=null;try{r=i?JSON.parse(i):null}catch{}return r?est.fromJSON(r.fieldValueType):null}clone(){return new ZY({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:this.domain?.clone()??null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType,visible:this.visible})}},ZY=L$,L$);d([m({type:String,json:{write:!0}})],So.prototype,"alias",void 0),d([m({type:[String,Number],json:{write:{allowNull:!0}}})],So.prototype,"defaultValue",void 0),d([m()],So.prototype,"description",void 0),d([di("description")],So.prototype,"readDescription",null),d([m({types:Jrt,json:{read:{reader:Krt},write:!0}})],So.prototype,"domain",void 0),d([m({type:Boolean,json:{write:!0}})],So.prototype,"editable",void 0),d([m({type:qi,json:{write:{overridePolicy:t=>({enabled:Number.isFinite(t)})}}})],So.prototype,"length",void 0),d([m({type:String,json:{write:!0}})],So.prototype,"name",void 0),d([m({type:Boolean,json:{write:!0}})],So.prototype,"nullable",void 0),d([Et(Ute)],So.prototype,"type",void 0),d([m()],So.prototype,"valueType",void 0),d([di("valueType",["description"])],So.prototype,"readValueType",null),d([m({type:Boolean,json:{read:!1}})],So.prototype,"visible",void 0),So=ZY=d([k("esri.layers.support.Field")],So);var YY;let fT=YY=class extends ke{constructor(t){super(t),this.type="map-layer"}clone(){const{mapLayerId:t,gdbVersion:e}=this;return new YY({mapLayerId:t,gdbVersion:e})}};d([Et({mapLayer:"map-layer"}),m({json:{write:{isRequired:!0}}})],fT.prototype,"type",void 0),d([m({type:qi,json:{write:{isRequired:!0}}})],fT.prototype,"mapLayerId",void 0),d([m({type:String,json:{write:!0}})],fT.prototype,"gdbVersion",void 0),fT=YY=d([k("esri.layers.support.source.MapLayerSource")],fT);var QY;let eg=QY=class extends ke{constructor(t){super(t),this.type="query-table"}clone(){const{workspaceId:t,query:e,oidFields:i,spatialReference:r,geometryType:s}=this,n={workspaceId:t,query:e,oidFields:i,spatialReference:r?.clone()??void 0,geometryType:s};return new QY(n)}};d([Et({queryTable:"query-table"}),m({json:{write:{isRequired:!0}}})],eg.prototype,"type",void 0),d([m({type:String,json:{write:!0}})],eg.prototype,"workspaceId",void 0),d([m({type:String,json:{write:!0}})],eg.prototype,"query",void 0),d([m({type:String,json:{write:!0}})],eg.prototype,"oidFields",void 0),d([m({type:Ie,json:{write:!0}})],eg.prototype,"spatialReference",void 0),d([Et(eSe)],eg.prototype,"geometryType",void 0),eg=QY=d([k("esri.layers.support.source.QueryTableDataSource")],eg);var XY;let mT=XY=class extends ke{constructor(t){super(t),this.type="raster"}clone(){const{workspaceId:t,dataSourceName:e}=this;return new XY({workspaceId:t,dataSourceName:e})}};d([Et({raster:"raster"}),m({json:{write:{isRequired:!0}}})],mT.prototype,"type",void 0),d([m({type:String,json:{write:!0}})],mT.prototype,"dataSourceName",void 0),d([m({type:String,json:{write:!0}})],mT.prototype,"workspaceId",void 0),mT=XY=d([k("esri.layers.support.source.RasterDataSource")],mT);var JY;let cb=JY=class extends ke{constructor(t){super(t),this.type="table"}clone(){const{workspaceId:t,gdbVersion:e,dataSourceName:i}=this;return new JY({workspaceId:t,gdbVersion:e,dataSourceName:i})}};d([Et({table:"table"}),m({json:{write:{isRequired:!0}}})],cb.prototype,"type",void 0),d([m({type:String,json:{write:!0}})],cb.prototype,"workspaceId",void 0),d([m({type:String,json:{write:!0}})],cb.prototype,"gdbVersion",void 0),d([m({type:String,json:{write:!0}})],cb.prototype,"dataSourceName",void 0),cb=JY=d([k("esri.layers.support.source.TableDataSource")],cb);var KY,eQ;const tst=cl()({esriLeftInnerJoin:"left-inner-join",esriLeftOuterJoin:"left-outer-join"});let uu=KY=class extends ke{constructor(t){super(t),this.type="join-table"}readLeftTableSource(t,e,i){return ype()(t,e,i)}castLeftTableSource(t){return ny(tQ(),t)}readRightTableSource(t,e,i){return ype()(t,e,i)}castRightTableSource(t){return ny(tQ(),t)}clone(){const{leftTableKey:t,rightTableKey:e,leftTableSource:i,rightTableSource:r,joinType:s}=this,n={leftTableKey:t,rightTableKey:e,leftTableSource:i?.clone()??void 0,rightTableSource:r?.clone()??void 0,joinType:s};return new KY(n)}};d([Et({joinTable:"join-table"}),m({json:{write:{isRequired:!0}}})],uu.prototype,"type",void 0),d([m({type:String,json:{write:!0}})],uu.prototype,"leftTableKey",void 0),d([m({type:String,json:{write:!0}})],uu.prototype,"rightTableKey",void 0),d([m({json:{write:!0}})],uu.prototype,"leftTableSource",void 0),d([di("leftTableSource")],uu.prototype,"readLeftTableSource",null),d([qr("leftTableSource")],uu.prototype,"castLeftTableSource",null),d([m({json:{write:!0}})],uu.prototype,"rightTableSource",void 0),d([di("rightTableSource")],uu.prototype,"readRightTableSource",null),d([qr("rightTableSource")],uu.prototype,"castRightTableSource",null),d([Et(tst)],uu.prototype,"joinType",void 0),uu=KY=d([k("esri.layers.support.source.JoinTableDataSource")],uu);let R7=null;function ype(){return R7||(R7=TK({types:tQ()})),R7}let D7=null;function tQ(){return D7||(D7={key:"type",base:null,typeMap:{"data-layer":Cg,"map-layer":fT}}),D7}const ist={key:"type",base:null,typeMap:{"join-table":uu,"query-table":eg,raster:mT,table:cb}};var k$;let Cg=(k$=class extends ke{constructor(e){super(e),this.type="data-layer"}clone(){const{fields:e,dataSource:i}=this;return new eQ({fields:e,dataSource:i})}},eQ=k$,k$);d([Et({dataLayer:"data-layer"}),m({json:{write:{isRequired:!0}}})],Cg.prototype,"type",void 0),d([m({type:[So],json:{write:!0}})],Cg.prototype,"fields",void 0),d([m({types:ist,json:{write:!0}})],Cg.prototype,"dataSource",void 0),Cg=eQ=d([k("esri.layers.support.source.DataLayerSource")],Cg),Cg.from=Ca(Cg);let ub=class extends ur(ke){constructor(e){super(e),this.onFields=null,this.operator=null,this.searchTerm=null,this.searchType=null}};d([m({type:[String],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.onFields!=null&&this.onFields.length>0}}}}})],ub.prototype,"onFields",void 0),d([m({type:String,json:{write:!0}})],ub.prototype,"operator",void 0),d([m({type:String,json:{write:!0}})],ub.prototype,"searchTerm",void 0),d([m({type:String,json:{write:!0}})],ub.prototype,"searchType",void 0),ub=d([k("esri.rest.support.FullTextSearch")],ub);const rst=ub;var iQ;const _pe=new ta({upperLeft:"upper-left",lowerLeft:"lower-left"});let hb=iQ=class extends ke{constructor(t){super(t),this.extent=null,this.mode="view",this.originPosition="upper-left",this.tolerance=1}clone(){return new iQ(Te({extent:this.extent,mode:this.mode,originPosition:this.originPosition,tolerance:this.tolerance}))}};d([m({type:Bt,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],hb.prototype,"extent",void 0),d([m({type:["view","edit"],json:{write:!0}})],hb.prototype,"mode",void 0),d([m({type:String,json:{read:_pe.read,write:_pe.write}})],hb.prototype,"originPosition",void 0),d([m({type:Number,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],hb.prototype,"tolerance",void 0),hb=iQ=d([k("esri.rest.support.QuantizationParameters")],hb);const sst=t=>{const e=t;let i=class extends e{};return i=d([k("esri.rest.support.QueryMixin")],i),i},nst=new ta({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"});var rQ;const vpe=new ta({count:"count",sum:"sum",min:"min",max:"max",avg:"avg",stddev:"stddev",var:"var",exceedslimit:"exceedslimit",percentile_cont:"percentile-continuous",percentile_disc:"percentile-discrete",EnvelopeAggregate:"envelope-aggregate",CentroidAggregate:"centroid-aggregate",ConvexHullAggregate:"convex-hull-aggregate"});let Rd=rQ=class extends ke{constructor(t){super(t),this.maxPointCount=void 0,this.maxRecordCount=void 0,this.maxVertexCount=void 0,this.onStatisticField=null,this.outStatisticFieldName=null,this.statisticType=null,this.statisticParameters=null}writeStatisticParameters(t,e){this.statisticType!=="percentile-continuous"&&this.statisticType!=="percentile-discrete"||(e.statisticParameters=Te(t))}clone(){return new rQ({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType,statisticParameters:Te(this.statisticParameters)})}};d([m({type:Number,json:{write:!0}})],Rd.prototype,"maxPointCount",void 0),d([m({type:Number,json:{write:!0}})],Rd.prototype,"maxRecordCount",void 0),d([m({type:Number,json:{write:!0}})],Rd.prototype,"maxVertexCount",void 0),d([m({type:String,json:{write:!0}})],Rd.prototype,"onStatisticField",void 0),d([m({type:String,json:{write:!0}})],Rd.prototype,"outStatisticFieldName",void 0),d([m({type:String,json:{read:{source:"statisticType",reader:vpe.read},write:{target:"statisticType",writer:vpe.write}}})],Rd.prototype,"statisticType",void 0),d([m({type:Object})],Rd.prototype,"statisticParameters",void 0),d([Ht("statisticParameters")],Rd.prototype,"writeStatisticParameters",null),Rd=rQ=d([k("esri.rest.support.StatisticDefinition")],Rd);var Nz;const ast=new ta({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});var Vw;let kt=(Vw=class extends sst(ke){static from(e){return qD(Nz,e)}constructor(e){super(e),this.aggregateIds=null,this.cacheHint=void 0,this.compactGeometryEnabled=!1,this.datumTransformation=null,this.defaultSpatialReferenceEnabled=!1,this.distance=void 0,this.dynamicDataSource=void 0,this.formatOf3DObjects=null,this.fullText=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=void 0,this.groupByFieldsForStatistics=null,this.having=null,this.historicMoment=null,this.maxAllowableOffset=void 0,this.maxRecordCountFactor=1,this.multipatchOption=null,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.outStatistics=null,this.parameterValues=null,this.pixelSize=null,this.quantizationParameters=null,this.rangeValues=null,this.relationParameter=null,this.resultType=null,this.returnCentroid=!1,this.returnDistinctValues=!1,this.returnExceededLimitFeatures=!0,this.returnGeometry=!1,this.returnQueryGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.returnTrueCurves=void 0,this.sourceSpatialReference=null,this.spatialRelationship="intersects",this.start=void 0,this.sqlFormat=null,this.text=null,this.timeExtent=null,this.timeReferenceUnknownClient=!1,this.units=null,this.where=null}castDatumTransformation(e){return typeof e=="number"||typeof e=="object"?e:null}writeHistoricMoment(e,i){i.historicMoment=e&&e.getTime()}writeParameterValues(e,i){if(e){const r={};for(const s in e){const n=e[s];Array.isArray(n)?r[s]=n.map(a=>a instanceof Date?a.getTime():a):n instanceof Date?r[s]=n.getTime():r[s]=n}i.parameterValues=r}}writeStart(e,i){i.resultOffset=this.start,i.resultRecordCount=this.num||10,i.where="1=1"}writeWhere(e,i){i.where=e||"1=1"}clone(){return new Nz(Te({aggregateIds:this.aggregateIds,cacheHint:this.cacheHint,compactGeometryEnabled:this.compactGeometryEnabled,datumTransformation:this.datumTransformation,defaultSpatialReferenceEnabled:this.defaultSpatialReferenceEnabled,distance:this.distance,fullText:this.fullText,formatOf3DObjects:this.formatOf3DObjects,gdbVersion:this.gdbVersion,geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,having:this.having,historicMoment:this.historicMoment!=null?new Date(this.historicMoment):null,maxAllowableOffset:this.maxAllowableOffset,maxRecordCountFactor:this.maxRecordCountFactor,multipatchOption:this.multipatchOption,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,parameterValues:this.parameterValues,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,rangeValues:this.rangeValues,relationParameter:this.relationParameter,resultType:this.resultType,returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnQueryGeometry:this.returnQueryGeometry,returnM:this.returnM,returnZ:this.returnZ,returnTrueCurves:this.returnTrueCurves,dynamicDataSource:this.dynamicDataSource,sourceSpatialReference:this.sourceSpatialReference,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.sqlFormat,text:this.text,timeExtent:this.timeExtent,timeReferenceUnknownClient:this.timeReferenceUnknownClient,units:this.units,where:this.where}))}},Nz=Vw,Vw.MAX_MAX_RECORD_COUNT_FACTOR=5,Vw);d([m({json:{write:!0}})],kt.prototype,"aggregateIds",void 0),d([m({type:Boolean,json:{write:!0}})],kt.prototype,"cacheHint",void 0),d([m({type:Boolean,json:{default:!1,write:!0}})],kt.prototype,"compactGeometryEnabled",void 0),d([m({json:{write:!0}})],kt.prototype,"datumTransformation",void 0),d([qr("datumTransformation")],kt.prototype,"castDatumTransformation",null),d([m({type:Boolean,json:{default:!1,write:!0}})],kt.prototype,"defaultSpatialReferenceEnabled",void 0),d([m({type:Number,json:{write:!0}})],kt.prototype,"distance",void 0),d([m({type:Cg,json:{write:!0}})],kt.prototype,"dynamicDataSource",void 0),d([m({type:String,json:{write:!0}})],kt.prototype,"formatOf3DObjects",void 0),d([m({type:[rst],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.fullText!=null&&this.fullText.length>0}}}}})],kt.prototype,"fullText",void 0),d([m({type:String,json:{write:!0}})],kt.prototype,"gdbVersion",void 0),d([m({types:hee,json:{read:hy,write:!0}})],kt.prototype,"geometry",void 0),d([m({type:Number,json:{write:!0}})],kt.prototype,"geometryPrecision",void 0),d([m({type:[String],json:{write:!0}})],kt.prototype,"groupByFieldsForStatistics",void 0),d([m({type:String,json:{write:!0}})],kt.prototype,"having",void 0),d([m({type:Date})],kt.prototype,"historicMoment",void 0),d([Ht("historicMoment")],kt.prototype,"writeHistoricMoment",null),d([m({type:Number,json:{write:!0}})],kt.prototype,"maxAllowableOffset",void 0),d([m({type:Number,cast:t=>t<1?1:t>kt.MAX_MAX_RECORD_COUNT_FACTOR?kt.MAX_MAX_RECORD_COUNT_FACTOR:t,json:{write:{overridePolicy:t=>({enabled:t>1})}}})],kt.prototype,"maxRecordCountFactor",void 0),d([m({type:["xyFootprint"],json:{write:!0}})],kt.prototype,"multipatchOption",void 0),d([m({type:Number,json:{read:{source:"resultRecordCount"}}})],kt.prototype,"num",void 0),d([m({json:{write:!0}})],kt.prototype,"objectIds",void 0),d([m({type:[String],json:{write:!0}})],kt.prototype,"orderByFields",void 0),d([m({type:[String],json:{write:!0}})],kt.prototype,"outFields",void 0),d([m({type:Ie,json:{name:"outSR",write:!0}})],kt.prototype,"outSpatialReference",void 0),d([m({type:[Rd],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.outStatistics!=null&&this.outStatistics.length>0}}}}})],kt.prototype,"outStatistics",void 0),d([m({json:{write:!0}})],kt.prototype,"parameterValues",void 0),d([Ht("parameterValues")],kt.prototype,"writeParameterValues",null),d([m({type:Qe,json:{write:!0}})],kt.prototype,"pixelSize",void 0),d([m({type:hb,json:{write:!0}})],kt.prototype,"quantizationParameters",void 0),d([m({type:[Object],json:{write:!0}})],kt.prototype,"rangeValues",void 0),d([m({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy(){return{enabled:this.spatialRelationship==="relation"}}}}})],kt.prototype,"relationParameter",void 0),d([m({type:String,json:{write:!0}})],kt.prototype,"resultType",void 0),d([m({type:Boolean,json:{default:!1,write:!0}})],kt.prototype,"returnCentroid",void 0),d([m({type:Boolean,json:{default:!1,write:!0}})],kt.prototype,"returnDistinctValues",void 0),d([m({type:Boolean,json:{default:!0,write:!0}})],kt.prototype,"returnExceededLimitFeatures",void 0),d([m({type:Boolean,json:{write:!0}})],kt.prototype,"returnGeometry",void 0),d([m({type:Boolean,json:{default:!1,write:!0}})],kt.prototype,"returnQueryGeometry",void 0),d([m({type:Boolean,json:{default:!1,write:!0}})],kt.prototype,"returnM",void 0),d([m({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],kt.prototype,"returnZ",void 0),d([m({type:Boolean,json:{write:!0}})],kt.prototype,"returnTrueCurves",void 0),d([m({type:Ie,json:{write:!0}})],kt.prototype,"sourceSpatialReference",void 0),d([Et(nst,{ignoreUnknown:!1,name:"spatialRel"})],kt.prototype,"spatialRelationship",void 0),d([m({type:Number,json:{read:{source:"resultOffset"}}})],kt.prototype,"start",void 0),d([Ht("start"),Ht("num")],kt.prototype,"writeStart",null),d([m({type:String,json:{write:!0}})],kt.prototype,"sqlFormat",void 0),d([m({type:String,json:{write:!0}})],kt.prototype,"text",void 0),d([m({type:Mn,json:{write:!0}})],kt.prototype,"timeExtent",void 0),d([m({type:Boolean,json:{default:!1,write:!0}})],kt.prototype,"timeReferenceUnknownClient",void 0),d([Et(ast,{ignoreUnknown:!1}),m({json:{write:{overridePolicy(t){return{enabled:!!t&&this.distance!=null}}}}})],kt.prototype,"units",void 0),d([m({type:String,json:{write:{overridePolicy(t){return{enabled:t!=null||this.start!=null&&this.start>0}}}}})],kt.prototype,"where",void 0),d([Ht("where")],kt.prototype,"writeWhere",null),kt=Nz=d([k("esri.rest.support.Query")],kt);function v0(t){return!(t==null||typeof t!="object"||!("createQuery"in t)||!t.createQuery)}let mh=class extends Uc{constructor(e){super(e),this._selectionMap=new s$,this._sources=new He,this._trashCan=[],this._layerEditHandles=new He,this._vizTaskId=0,this.view=null,this.showHighlight=!0,this.highlightName="default"}initialize(){this.addHandles([K(()=>[this.view,this.showHighlight],()=>this._refreshVisualization()),K(()=>this.view,e=>{e?.when().then(()=>this.syncSources())},Wt),Ys(()=>this.sources,"change",e=>{const i=this._selectionMap,r=[];for(const s of e.removed){const n=i.get(s);n&&(i.delete(s),n.highlightHandle?.remove(),r.push({layer:s,selection:[],added:[],removed:[...n.selection]}))}this._refreshListeners(),r.length&&this._onSelectionChange(r)},{onListenerAdd:()=>this._refreshListeners()})])}destroy(){this.clear(),this._layerEditHandles.drain(Ki)}get selections(){return Array.from(this._selectionMap.entries()).map(e=>{const[i,r]=e;return{layer:i,selection:[...r.selection]}})}get count(){let e=0;for(const i of this._selectionMap.values())e+=i.selection.length;return e}get hasSelection(){return this.count>0}get sources(){return this._sources}set sources(e){kc(e,this._sources)}syncSources(){const e=new Set,i=this.view?.map;if(!i)return;const r=s=>{xJe(s)?(s.layers?.forEach(r),s.tables?.forEach(r)):wJe(s)?(s.sublayers?.forEach(r),s.subtables?.forEach(r)):xde(s)?s.sublayers?.forEach(r):v0(s)&&e.add(s)};i.allLayers.forEach(r),i.allTables.forEach(r),this.sources=[...e]}async getSelectedFeatures(e,i={},r="layerView"){const{view:s,selections:n}=this;if(!s&&r==="layerView")return fe.getLogger(this).warn("Cannot query layer views without a view."),[];const a=(e?.length?n.filter(o=>e.includes(o.layer)):n).map(async o=>{const{layer:l,selection:c}=o;if(!c.length)return;const h=kb(l)?l.parent:l;if(h!=null){if(s&&r==="layerView"&&!bpe(h)&&wpe(h)){const f=await s.whenLayerView(h).catch(()=>null);if(f)return xpe(f,c,i)}return xpe(h,c,i)}}).filter(qf);return(await Promise.all(a)).filter(qf)}updateSelection(e){const i=new Map;for(const[n,a]of this._selectionMap)i.set(n,[...a.selection]);let r=!1;const s=e.current.concat(e.added);for(const n of s){const a=n.sourceLayer,o=n.getObjectId();if(this.sources.includes(a)&&(v0(a)||kb(a))&&o!==null){const l=Cu(i,a,()=>[]);l.includes(o)||(l.push(o),r=!0)}}for(const n of e.removed){const a=n.sourceLayer,o=n.getObjectId();if(this.sources.includes(a)&&(v0(a)||kb(a))&&o!==null){const l=i.get(a),c=l?.indexOf(o);c!==void 0&&c>=0&&(l?.splice(c,1),r=!0)}}if(r){const{_selectionMap:n,_trashCan:a}=this,o=[];for(const[l,c]of i){const h=n.get(l);h!==void 0&&a.push(h),n.set(l,{selection:c}),o.push({layer:l,selection:c,...$N(h!==void 0?h.selection:[],c)})}this._onSelectionChange(o)}}setSelection(e,i){this._setSelection(e,i)}getSelection(e){return this._selectionMap.get(e)?.selection}appendToSelection(e,i){const r=this._selectionMap.get(e),s=r!==void 0?[...r.selection]:[];for(const n of i)s.includes(n)||s.push(n);this._setSelection(e,s)}removeFromSelection(e,i){const r=this._selectionMap.get(e);if(!r)return;const s=[];for(const n of r.selection)i.includes(n)||s.push(n);this._setSelection(e,s)}toggleInSelection(e,i){const r=this._selectionMap.get(e);if(!r||r.selection.length===0)return void this._setSelection(e,i);const s=new Set(r.selection),n=new Set(i),a=GBe(s,n);this._setSelection(e,Array.from(a))}clear(){const e=this._selectionMap.values();this._trashCan.push(...e);const i=[];for(const[r,s]of this._selectionMap.entries())i.push({layer:r,added:[],removed:[...s.selection],selection:[]});this._selectionMap.clear(),this._onSelectionChange(i)}_onSelectionChange(e){this._refreshVisualization(),this.emit("selection-change",{view:this.view,changes:e})}_refreshVisualization(){for(this._vizTaskId++;this._trashCan.length>0;)this._trashCan.pop()?.highlightHandle?.remove();if(this.view==null)return;const{sources:e,view:i,_selectionMap:r,showHighlight:s}=this,n=this._vizTaskId;for(const a of e){const o=r.get(a),l=kb(a)?a.parent:a;if(l!=null&&wpe(l)){if(bpe(l))continue;i.whenLayerView(l).then(c=>{o?.highlightHandle?.remove(),o!=null&&s&&n===this._vizTaskId&&"highlight"in c&&typeof c.highlight=="function"&&o.selection.length>0&&(o.highlightHandle=c.highlight(o.selection,this.highlightName))}).catch(()=>{o?.highlightHandle?.remove()})}}}_refreshListeners(){this._layerEditHandles.drain(Ki);const e=new Set(this.sources.map(i=>kb(i)?i.parent:i));for(const i of e)v0(i)&&"on"in i&&i.on&&this._layerEditHandles.push(i.on("edits",r=>this._onLayerEdit(r,i)))}_onLayerEdit(e,i){if(xde(i))this._onParentLayerEdit(e,i);else if(e.deletedFeatures.length&&this._selectionMap.has(i)){const r=[];e.deletedFeatures.forEach(({error:s,objectId:n})=>{n!=null&&s==null&&r.push(n)}),this.removeFromSelection(i,r)}}_onParentLayerEdit(e,i){const{deletedFeatures:r,edits:s,updatedFeatures:n}=e;if(s?.updateFeatures?.forEach(a=>{const o=a.getObjectId()??a.attributes[i.objectIdField];if(o==null||n.find(h=>h.objectId===o)?.error)return;const l=i.findSublayerForFeature(a);if(!v0(l))return;const c=i.sublayers.find(h=>!(!v0(h)||!this.getSelection(h)?.includes(o)));v0(c)&&c!==l&&(this.removeFromSelection(c,[o]),this.appendToSelection(l,[o]))}),r.length){const a=[];r.forEach(({error:o,objectId:l})=>{l!=null&&o==null&&a.push(l)}),i.sublayers.forEach(o=>{v0(o)&&this._selectionMap.has(o)&&this.removeFromSelection(o,a)})}}_setSelection(e,i){if(!this.sources.includes(e))throw new Error(`Cannot set selection on layer ${e.title} because it is not in 'sources'`);const r=this._selectionMap.get(e);if(r===void 0||!lst(r,{selection:i})){r!==void 0&&this._trashCan.push(r),this._selectionMap.set(e,{selection:[...i]});const s={layer:e,selection:[...i],...$N(r!==void 0?r.selection:[],i)};this._onSelectionChange([s])}}};d([m()],mh.prototype,"_selectionMap",void 0),d([m()],mh.prototype,"_sources",void 0),d([m({readOnly:!0,nonNullable:!0})],mh.prototype,"selections",null),d([m({readOnly:!0,nonNullable:!0})],mh.prototype,"count",null),d([m()],mh.prototype,"view",void 0),d([m({readOnly:!0,nonNullable:!0})],mh.prototype,"hasSelection",null),d([m()],mh.prototype,"showHighlight",void 0),d([m()],mh.prototype,"sources",null),d([m()],mh.prototype,"highlightName",void 0),mh=d([k("esri.views.SelectionManager")],mh);const bpe=t=>kb(t)?t.parent?.isTable===!0:t.isTable,ost=t=>t.layer!==void 0,wpe=t=>t?.when!==void 0,lst=(t,e)=>{if(t==null&&e==null)return!0;if(t!=null&&e==null||t==null&&e!=null)return!1;if(t!=null&&e!=null&&t.selection!=null&&e.selection!=null){const i=[...t.selection],r=[...e.selection];if(i.length!==r.length)return!1;i.sort(),r.sort();for(let s=0;s<i.length;s++)if(i[s]!==r[s])return!1}return!0},xpe=async(t,e,i={})=>{let r;if(ost(t)){const s=t;r=s===void 0?null:await s.queryFeatures(new kt({...i,objectIds:e})).then(n=>({data:n,layer:t.layer}))}else{const s=t;r=s===void 0?null:await s.queryFeatures(new kt({...i,objectIds:e})).then(n=>({data:n,layer:s}))}return r},cst=mh;let bO=class extends ur(Me){constructor(e){super(e),this.accentColor=new mt([255,127,0]),this.textColor=new mt([255,255,255])}};d([m({type:mt,nonNullable:!0})],bO.prototype,"accentColor",void 0),d([m({type:mt,nonNullable:!0})],bO.prototype,"textColor",void 0),bO=d([k("esri.views.Theme")],bO);const sQ=bO,qMe=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],GMe={};function HMe(t){return!!GMe[t]}function ust(t){for(const e of t)if(!HMe(e))return!1;return!0}qMe.forEach(t=>{GMe[t]=!0});let hst=class{constructor(e){this._handlers=new Map,this._counter=0,this._handlerCounts=new Map,this.view=e,this.inputManager=null}connect(e){e&&this.disconnect(),this.inputManager=e,this._handlers.forEach(({handler:i,priority:r},s)=>this.inputManager?.installHandlers(s,[i],r))}disconnect(){this.inputManager&&this._handlers.forEach((e,i)=>this.inputManager?.uninstallHandlers(i)),this.inputManager=null}destroy(){this.disconnect(),this._handlers.clear(),this.view=null}on(e,i,r,s){const n=Array.isArray(e)?e:e.split(",");if(!ust(n))return n.some(HMe)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let a,o;Array.isArray(i)?o=i:(a=i,o=[]),typeof r=="function"?a=r:s=r,s=s??Br.DEFAULT;const l=this._createUniqueGroupName(),c=new dst(this.view,n,o,a);this._handlers.set(l,{handler:c,priority:s});for(const h of n){const f=this._handlerCounts.get(h)||0;this._handlerCounts.set(h,f+1)}return this.inputManager&&this.inputManager.installHandlers(l,[c],s),ci(()=>this._removeHandler(l,n))}hasHandler(e){return!!this._handlerCounts.get(e)}_removeHandler(e,i){if(this._handlers.has(e)){this._handlers.delete(e);for(const r of i){const s=this._handlerCounts.get(r);s===void 0||(s===1?this._handlerCounts.delete(r):this._handlerCounts.set(r,s-1))}}this.inputManager&&this.inputManager.uninstallHandlers(e)}_createUniqueGroupName(){return this._counter+=1,`viewEvents_${this._counter}`}},dst=class extends ho{constructor(e,i,r,s){super(!0),this._latestDragStart=void 0,this.view=e;for(const n of i)switch(n){case"click":this.registerIncoming("click",r,a=>s(mst(e,a)));break;case"double-click":this.registerIncoming("double-click",r,a=>s(gst(e,a)));break;case"immediate-click":this.registerIncoming("immediate-click",r,a=>s(yst(e,a)));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",r,a=>s(_st(e,a)));break;case"hold":this.registerIncoming("hold",r,a=>s(vst(e,a)));break;case"drag":this.registerIncoming("drag",r,a=>{const o=this._wrapDrag(a);o&&s(o)});break;case"key-down":this.registerIncoming("key-down",r,a=>s(bst(a)));break;case"key-up":this.registerIncoming("key-up",r,a=>s(wst(a)));break;case"pointer-down":this.registerIncoming("pointer-down",r,a=>s(qE(a,"pointer-down")));break;case"pointer-move":this.registerIncoming("pointer-move",r,a=>s(qE(a,"pointer-move")));break;case"pointer-up":this.registerIncoming("pointer-up",r,a=>s(qE(a,"pointer-up")));break;case"pointer-drag":this.registerIncoming("pointer-drag",r,a=>s(xst(a)));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",r,a=>s(Sst(a)));break;case"pointer-enter":this.registerIncoming("pointer-enter",r,a=>s(qE(a,"pointer-enter")));break;case"pointer-leave":this.registerIncoming("pointer-leave",r,a=>s(qE(a,"pointer-leave")));break;case"gamepad":this.registerIncoming("gamepad",r,a=>{s(Tst(a))});break;case"focus":this.registerIncoming("focus",r,a=>{s(pst(a))});break;case"blur":this.registerIncoming("blur",r,a=>{s(fst(a))})}}_wrapDrag(e){const i=e.data,{x:r,y:s}=i.center,{action:n,pointerType:a,button:o}=i;if(n==="start"&&(this._latestDragStart=i),!this._latestDragStart)return;const l=i.pointer.native,c=i.buttons,{cancelable:h,timestamp:f}=e,y={x:this._latestDragStart.center.x,y:this._latestDragStart.center.y};return n==="end"&&(this._latestDragStart=void 0),{type:"drag",action:n,x:r,y:s,origin:y,pointerType:a,button:o,buttons:c,radius:i.radius,angle:Ea(i.angle),native:l,timestamp:f,cancelable:h,stopPropagation:()=>e.stopPropagation(),defer:_=>e.defer(_),preventDefault:()=>e.preventDefault()}}};function pst(t){return{type:"focus",timestamp:t.timestamp,native:t.data.native,cancelable:t.cancelable,stopPropagation:()=>t.stopPropagation(),defer:e=>t.defer(e),preventDefault:()=>t.preventDefault()}}function fst(t){return{type:"blur",timestamp:t.timestamp,native:t.data.native,cancelable:t.cancelable,stopPropagation:()=>t.stopPropagation(),defer:e=>t.defer(e),preventDefault:()=>t.preventDefault()}}function mst(t,e){const{pointerType:i,button:r,buttons:s,x:n,y:a,native:o,eventId:l}=e.data,{cancelable:c,timestamp:h}=e;return{type:"click",pointerType:i,button:r,buttons:s,x:n,y:a,native:o,timestamp:h,screenPoint:Zl(n,a),mapPoint:u4(t,n,a),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),defer:f=>e.defer(f),preventDefault:()=>e.preventDefault()}}function gst(t,e){const{pointerType:i,button:r,buttons:s,x:n,y:a,native:o,eventId:l}=e.data,{cancelable:c,timestamp:h}=e;return{type:"double-click",pointerType:i,button:r,buttons:s,x:n,y:a,native:o,timestamp:h,mapPoint:u4(t,n,a),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),defer:f=>e.defer(f),preventDefault:()=>e.preventDefault()}}function yst(t,e){const{pointerType:i,button:r,buttons:s,x:n,y:a,native:o,eventId:l}=e.data,c=o.pointerId,{cancelable:h,timestamp:f}=e;return{type:"immediate-click",pointerId:c,pointerType:i,button:r,buttons:s,x:n,y:a,native:o,timestamp:f,mapPoint:u4(t,n,a),eventId:l,cancelable:h,stopPropagation:()=>e.stopPropagation(),defer:y=>e.defer(y),preventDefault:()=>e.preventDefault()}}function _st(t,e){const{pointerType:i,button:r,buttons:s,x:n,y:a,native:o,eventId:l}=e.data,c=o.pointerId,{cancelable:h,timestamp:f}=e;return{type:"immediate-double-click",pointerId:c,pointerType:i,button:r,buttons:s,x:n,y:a,native:o,timestamp:f,mapPoint:u4(t,n,a),eventId:l,cancelable:h,stopPropagation:()=>e.stopPropagation(),defer:y=>e.defer(y),preventDefault:()=>e.preventDefault()}}function vst(t,e){const{pointerType:i,button:r,buttons:s,x:n,y:a,native:o}=e.data,{cancelable:l,timestamp:c}=e;return{type:"hold",pointerType:i,button:r,buttons:s,x:n,y:a,native:o,timestamp:c,mapPoint:u4(t,n,a),cancelable:l,stopPropagation:()=>e.stopPropagation(),defer:h=>e.defer(h),preventDefault:()=>e.preventDefault()}}function u4(t,e,i){return t.toMap(Zl(e,i),{exclude:[]})}function bst(t){const{key:e,repeat:i,native:r}=t.data,{cancelable:s,timestamp:n}=t;return{type:"key-down",key:e,repeat:i,native:r,timestamp:n,cancelable:s,stopPropagation:()=>t.stopPropagation(),defer:a=>t.defer(a),preventDefault:()=>t.preventDefault()}}function wst(t){const{key:e,native:i}=t.data,{cancelable:r,timestamp:s}=t;return{type:"key-up",key:e,native:i,timestamp:s,cancelable:r,stopPropagation:()=>t.stopPropagation(),defer:n=>t.defer(n),preventDefault:()=>t.preventDefault()}}function qE(t,e){const{x:i,y:r,button:s,buttons:n,native:a,eventId:o}=t.data,l=a.pointerId,c=a.pointerType,{cancelable:h,timestamp:f}=t;return{type:e,x:i,y:r,pointerId:l,pointerType:c,button:s,buttons:n,native:a,timestamp:f,eventId:o,cancelable:h,stopPropagation:()=>t.stopPropagation(),defer:y=>t.defer(y),preventDefault:()=>t.preventDefault()}}function xst(t){const{x:e,y:i,buttons:r,native:s,eventId:n}=t.data.currentEvent,{button:a}=t.data.startEvent,o=t.data.startEvent.native.pointerId,l=t.data.startEvent.native.pointerType,c=t.data.action,h={x:t.data.startEvent.x,y:t.data.startEvent.y},{cancelable:f,timestamp:y}=t;return{type:"pointer-drag",x:e,y:i,pointerId:o,pointerType:l,button:a,buttons:r,action:c,origin:h,native:s,timestamp:y,eventId:n,cancelable:f,stopPropagation:()=>t.stopPropagation(),defer:_=>t.defer(_),preventDefault:()=>t.preventDefault()}}function Sst(t){const{cancelable:e,data:i,timestamp:r}=t,{x:s,y:n,deltaY:a,native:o}=i;return{type:"mouse-wheel",x:s,y:n,deltaY:a,native:o,timestamp:r,cancelable:e,stopPropagation:()=>t.stopPropagation(),defer:l=>t.defer(l),preventDefault:()=>t.preventDefault()}}function Tst(t){const{action:e,state:i,device:r}=t.data,{cancelable:s,timestamp:n}=t,{buttons:a,axes:o}=i;return{type:"gamepad",device:r,timestamp:n,action:e,buttons:a,axes:o,cancelable:s,stopPropagation:()=>t.stopPropagation(),defer:l=>t.defer(l),preventDefault:()=>t.preventDefault()}}const WMe="z",ZMe="r",YMe={cancel:"Escape",complete:"Enter"},yn={...YMe,redo:ZMe,undo:WMe,center:"Alt",constraint:"Shift",delete:["Backspace","Delete"],vertexAdd:"f",pan:" "},Spe={toggle:"Control"},SBt={enterInputMode:"Tab",commit:"Enter",discard:"Escape",next:"Tab"},TBt={moveUp:{key:"ArrowUp",modifier:"Shift",repeats:!0},moveDown:{key:"ArrowDown",modifier:"Shift",repeats:!0},moveLeft:{key:"ArrowLeft",modifier:"Shift",repeats:!0},moveRight:{key:"ArrowRight",modifier:"Shift",repeats:!0},scaleUp:{key:"+",modifier:"Shift"},scaleDown:{key:"-",modifier:"Shift"},factorModifier:{key:eCe,continuePropagation:!0},toggleOpacity:"t",preserveAspectRatio:{key:"Shift",continuePropagation:!0},rotateIncrements:{key:"Shift",continuePropagation:!0},editSourcePoints:{key:"Alt",continuePropagation:!0},undo:WMe,redo:ZMe};let $Bt=class{constructor(){this._bindings=new Map}add(e,i){return this.addToggle(e,r=>{r.type==="key-down"&&i(r)})}addToggle(e,i){const r=$st.fromDefinition(e,i),s=Cu(this._bindings,r.key,()=>[]);return s.push(r),ci(()=>tM(s,r))}register(e,i=Br.WIDGET){return qu([e.on("key-down",r=>this.dispatch(e.inputManager,r),i),e.on("key-up",r=>this.dispatch(e.inputManager,r),i)])}dispatch(e,i){const r=i.key,s=this._bindings.get(r);if(s)for(const n of s)n.process(e,i)}},$st=class nQ{constructor(e,i,r,s,n){this.key=e,this.modifiers=i,this.repeats=r,this.continuePropagation=s,this.callback=n}process(e,i){if(!(i.key!==this.key||"repeat"in i&&i.repeat&&!this.repeats)){for(const r of this.modifiers)if(!e.isModifierKeyDown(r))return;this.continuePropagation||i.stopPropagation(),this.callback(i)}}static fromDefinition(e,i){if(typeof e=="string")return new nQ(e,[],!1,!1,i);const{key:r,modifier:s,repeats:n,continuePropagation:a}=e;return new nQ(r,s?Array.isArray(s)?s:[s]:[],!!n,!!a,i)}};function Cst(t){return[t.on("before-add",e=>{const i=e.item;if(i==null||t.includes(i))return fe.getLogger("esri.views.interactive.interactiveToolUtils").warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void e.preventDefault();i.onAdd()}),t.on("after-remove",e=>{const i=e.item;i.active&&(i.view.activeTool=null),i.destroy()})]}function aQ(t){return t.visible&&t.getEditableFlag!=null&&t.getEditableFlag(0)&&t.getEditableFlag(1)}function Mst(t){return t.type==="key-down"&&t.key===YMe.cancel}function Th(t){return Zl(t.x,t.y)}function MBt(t){return Gs(t.x,t.y)}function QMe(t,e){const i=(t instanceof HTMLElement?t:t.surface)?.getBoundingClientRect();return i?Zl(e.clientX-i.left,e.clientY-i.top):Zl(0,0)}function Tpe(t,e){return e instanceof Event?QMe(t,e):Th(e)}function $pe(t){if(t instanceof Event)return!0;if(typeof t=="object"&&"type"in t)switch(t.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}let Vz=class extends Me{constructor(){super(...arguments),this._pointerLocations=new Map,this._hoveredManipulators=new s$,this._grabbedManipulators=new s$,this._draggedManipulators=new Map,this._stopDrag=!1,this._externallyDragging=!1,this._revertToNullActiveTool=!1}get cursor(){return this._cursorFromMap(this._grabbedManipulators,"grabbing")??this._cursorFromMap(this._hoveredManipulators,"pointer")}get hasFocusedManipulators(){return this._grabbedManipulators.size>0||this._draggedManipulators.size>0}handleInputEvent(e,i){const r=()=>e.stopPropagation();switch(e.type){case"pointer-move":Cpe(e.pointerType)&&this._pointerLocations.set(e.pointerId,{x:e.x,y:e.y,pointerType:e.pointerType});break;case"drag":this._grabbedManipulators.size>0?this._stopDrag=!0:e.action==="start"?this._externallyDragging=!0:e.action==="end"&&(this._externallyDragging=!1),this._stopDrag&&(r(),e.action==="end"&&(this._stopDrag=!1));break;case"pointer-down":{if(!Mpe(e))break;const s=Th(e),n=mS(s,e.pointerType,i.tools);if(n==null)break;const a=n.manipulator,o=n.tool;a==null||o==null||!a.interactive||a.grabbable&&a.grabbableForEvent(e)||!a.grabbing||a.dragging||this._releaseManipulatorBeforeDragging(a,e,i),a!=null&&o!=null&&a.interactive&&a.grabbable&&a.grabbableForEvent(e)&&!a.grabbing&&(this._grabbedManipulators.set(e.pointerId,{manipulator:a,tool:o,start:s,pointerType:e.pointerType}),this._grabbedManipulators.size===1&&i.activeTool==null&&(this._revertToNullActiveTool=!0,i.setActiveTool(n.tool)),a.grabbing=!0,a.events.emit("grab-changed",{action:"start",pointerType:e.pointerType,screenPoint:s}),r());break}case"pointer-up":this._draggedManipulators.has(e.pointerId)||this._handlePointerEnd(e,i);break;case"pointer-drag":{if(!Mpe(e))break;const s=this._grabbedManipulators.get(e.pointerId),n=s?.manipulator,a=s?.tool;if(n==null||a==null)break;const o=Th(e);o.x=Se(o.x,0,i.view.width),o.y=Se(o.y,0,i.view.height);const l=s.start,c=this._draggedManipulators.get(e.pointerId);switch(e.action){case"start":case"update":e.action!=="update"&&this._grabbedManipulators.size!==1||(n.dragging=!0,c?n.events.emit("drag",{action:"update",start:l,screenPoint:o}):n.events.emit("drag",{action:"start",start:l,screenPoint:o,pointerType:e.pointerType}),this._draggedManipulators.set(e.pointerId,{tool:a,manipulator:n,start:l}));break;case"end":n.dragging=!1,c&&n.events.emit("drag",{action:"end",start:l,screenPoint:o}),this._draggedManipulators.delete(e.pointerId),this._handlePointerEnd(e,i)}r();break}case"immediate-click":{const s=Th(e),n=mS(s,e.pointerType,i.tools);if(!Est(e)){for(const c of i.tools)if((n==null||n.tool!==c||c.automaticManipulatorSelection)&&c.manipulators){let h=!1;c.manipulators.forEach(({manipulator:f})=>{f.selected&&(f.selected=!1,h=!0)}),h&&c.onManipulatorSelectionChanged&&c.onManipulatorSelectionChanged()}}if(n==null)break;const{manipulator:a,tool:o}=n;if(!a.interactive)break;a.selectable&&o.automaticManipulatorSelection&&(a.selected=!a.selected,o.onManipulatorSelectionChanged&&o.onManipulatorSelectionChanged());const l=e.native.shiftKey;a.events.emit("immediate-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:l,stopPropagation:r}),I7(a,r);break}case"click":{const s=Th(e),n=mS(s,e.pointerType,i.tools),a=n?.manipulator;if(a==null||!a.interactive)break;const o=e.native.shiftKey;a.events.emit(e.type,{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:o}),r();break}case"double-click":{const s=Th(e),n=mS(s,e.pointerType,i.tools),a=n!=null?n.manipulator:null;if(a==null||!a.interactive)break;const o=e.native.shiftKey;a.events.emit("double-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:o,stopPropagation:r}),I7(a,r);break}case"immediate-double-click":{const s=Th(e),n=mS(s,e.pointerType,i.tools),a=n!=null?n.manipulator:null;if(a==null||!a.interactive)break;const o=e.native.shiftKey;a.events.emit("immediate-double-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:o,stopPropagation:r}),e.pointerType==="mouse"&&I7(a,r);break}}this._onFocusChange(i.tools)}_releaseManipulatorBeforeDragging(e,i,r){e.grabbing=!1,e.events.emit("grab-changed",{action:"end",pointerType:i.pointerType,screenPoint:Th(i)}),this._grabbedManipulators.forEach(({manipulator:s},n)=>{s===e&&this._grabbedManipulators.delete(n)}),this._afterManipulatorRelease(r.setActiveTool)}_handlePointerEnd(e,i){const r=this._grabbedManipulators.get(e.pointerId)?.manipulator;r!=null&&r.grabbing&&(r.grabbing=!1,r.events.emit("grab-changed",{action:"end",pointerType:e.pointerType,screenPoint:Th(e)}),this._grabbedManipulators.delete(e.pointerId),this._afterManipulatorRelease(i.setActiveTool))}_onFocusChange(e){this._updateFocusedManipulatorTools(e)}_updateFocusedManipulatorTools(e){const i=new Set,r=new Set;this._grabbedManipulators.forEach(({tool:s})=>i.add(s)),this._hoveredManipulators.forEach(({tool:s})=>r.add(s));for(const s of e){s.hasGrabbedManipulators=i.has(s),s.hasHoveredManipulators=r.has(s);const n=this._grabbedManipulators.values(),a=rBe(n,({tool:o})=>o===s);s.firstGrabbedManipulator=a!=null?a.manipulator:null}}clearPointers(e,{tools:i,setActiveTool:r},s=!0,n){const a=(o,l)=>o===e&&(n==null||n===l);this._grabbedManipulators.forEach(({tool:o,manipulator:l,pointerType:c},h)=>{a(o,l)&&(this._grabbedManipulators.delete(h),l.grabbing=!1,l.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:c}))}),this._draggedManipulators.forEach(({tool:o,manipulator:l},c)=>{a(o,l)&&(this._draggedManipulators.delete(c),l.dragging=!1,l.events.emit("drag",{action:"cancel"}))}),s&&this._hoveredManipulators.forEach(({tool:o,manipulator:l},c)=>{a(o,l)&&(this._hoveredManipulators.delete(c),l.hovering=!1)}),this._afterManipulatorRelease(r),this._onFocusChange(i)}updateHoveredStateFromKnownPointers(e){this._pointerLocations.forEach((i,r)=>{this._updateHoveredStateForPointerAtScreenPosition(Zl(i.x,i.y),r,i.pointerType,e)})}handleHoverEvent(e,i){const r=e.type;r!=="pointer-up"&&r!=="immediate-click"&&r!=="pointer-move"||!Cpe(e.pointerType)||(r!=="pointer-up"&&this._externallyDragging?this._clearHoveredManipulatorStates(e.pointerId):this._updateHoveredStateForPointerAtScreenPosition(Th(e),e.pointerId,e.pointerType,i))}_updateHoveredStateForPointerAtScreenPosition(e,i,r,s){let n=mS(e,r,s);const a=this._hoveredManipulators.get(i)?.manipulator;n==null||n.manipulator.interactive||(n=null),n!=null&&a===n.manipulator||(a!=null&&(a.hovering=!1),n!=null?(n.manipulator.hovering=!0,this._hoveredManipulators.set(i,n)):this._hoveredManipulators.delete(i),this._onFocusChange(s))}_afterManipulatorRelease(e){this._grabbedManipulators.size===0&&this._revertToNullActiveTool&&(e(null),this._revertToNullActiveTool=!1)}_clearHoveredManipulatorStates(e){this._hoveredManipulators.forEach(({manipulator:i},r)=>{e===r&&(this._hoveredManipulators.delete(e),i.hovering=!1)})}_cursorFromMap(e,i){if(!e?.size)return null;for(const{manipulator:r}of e.values())if(r?.interactive){if(r.grabbing&&r.grabCursor)return r.grabCursor;if(r.cursor)return r.cursor}return i}};function mS(t,e,i){for(const r of i){if(r.manipulators==null||!aQ(r))continue;const s=r.manipulators.intersect(t,e);if(s!=null)return{tool:r,manipulator:s}}return null}function Cpe(t){return t==="mouse"}function Mpe(t){return t.pointerType!=="mouse"||t.button===0}function Est(t){return!!t.native.shiftKey}function I7(t,e){t?.consumesClicks&&e()}d([m()],Vz.prototype,"cursor",null),Vz=d([k("esri.views.interactive.ToolViewManagerManipulatorState")],Vz);const Epe="attached",L7="tools",Ast=1e3;let of=class extends Me{constructor(e){super(e),this._updatingHandles=new mp,this._clock=nM,this._manipulatorState=new Vz,this.tools=new He,this._interacting=!1,this._interactingTimeout=Ast,this._interactingTimeoutHandle=null}initialize(){this.addHandles([this.view.on(qMe,e=>{this._handleInputEvent(e)},Br.TOOL),...Cst(this.tools),this.tools.on("before-add",({item:e})=>{this._updateToolEditableFlag(e)}),this.tools.on("before-remove",({item:e})=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs)}),this.tools.on("change",()=>{this._refreshToolWatchers()})])}destroy(){this.activeTool=null,this.tools.drain(e=>e.destroy()),this._clearInteractingTimeout(),this._interacting=!1,this._updatingHandles.destroy(),this._manipulatorState.destroy()}get _manipulatorStateEventArgs(){return{tools:this.tools,activeTool:this.activeTool,setActiveTool:e=>{this.activeTool=e},view:this.view}}set activeTool(e){if(e!=null&&!this.view.ready)return void fe.getLogger(this).error("Cannot set active tool while view is not ready.");if(e===this.activeTool)return;const i=this.activeTool;this._set("activeTool",e),i?.deactivate(),e?.activate(),this._removeIncompleteTools(e);for(const r of this.tools){this._updateToolEditableFlag(r);const s=aQ(r);this.activeTool!=null&&s||this._manipulatorState.clearPointers(r,this._manipulatorStateEventArgs,!s)}}get cursor(){const e=this._manipulatorState.cursor;if(e!=null)return e;for(const i of this.tools)if(i.visible&&i.cursor!=null)return i.cursor;return null}get updating(){return this._updatingHandles.updating||this.tools.some(e=>e.updating)}get interacting(){return this._interacting}_clearInteractingTimeout(){this._interactingTimeoutHandle=Ki(this._interactingTimeoutHandle)}_startInteractingTimeout(){this._clearInteractingTimeout(),this._interactingTimeoutHandle=this._clock.setTimeout(()=>this._interacting=!1,this._interactingTimeout)}attach(){this.view.type==="3d"?this.addHandles([K(()=>{const{state:e}=this.view;return"camera"in e&&e.camera},()=>this._forEachManipulator(e=>e.onViewChange())),this.view.elevationProvider.on("elevation-change",e=>this._forEachManipulator(i=>i.onElevationChange(e)))],Epe):this.addHandles(K(()=>this.view.extent,()=>this._forEachManipulator(e=>e.onViewChange())))}detach(){this.activeTool=null,this.tools.removeAll(),this.removeHandles(Epe),this._clearInteractingTimeout(),this._interacting=!1}_forEachManipulator(e){for(const i of this.tools)i.manipulators&&i.manipulators.forEach(({manipulator:r})=>e(r,i))}_handleInputEvent(e){let i=!1;const r={...e,stopPropagation:()=>{i=!0,e.stopPropagation()}};if(this.activeTool!=null)this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(r);else for(const s of this.tools)!i&&s.visible&&s.handleInputEvent(r);!i&&Mst(e)&&this.activeTool&&(e.stopPropagation(),e.preventDefault(),this.activeTool.cancel(),this.activeTool=null),this._manipulatorState.handleInputEvent(r,this._manipulatorStateEventArgs),i||this.activeTool==null||this.activeTool.handleInputEventAfter(r),this._manipulatorState.handleHoverEvent(r,this.tools),e.type==="pointer-move"&&(this._manipulatorState.hasFocusedManipulators||this.activeTool)&&(this._interacting=!0,this._startInteractingTimeout())}_refreshToolWatchers(){this.removeHandles(L7);for(const e of this.tools){if(e instanceof Me){const i=K(()=>[e.cursor,e.visible,e.editable],()=>{aQ(e)||this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs)});this.addHandles(i,L7)}e.manipulators&&this.addHandles([e.manipulators.on("after-remove",i=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs,!0,i.item.manipulator)}),e.manipulators.on("change",()=>{this._manipulatorState.updateHoveredStateFromKnownPointers(this.tools)})],L7)}this._manipulatorState.updateHoveredStateFromKnownPointers(this.tools)}_updateToolEditableFlag(e){e.setEditableFlag?.(1,this.activeTool==null||e===this.activeTool)}_removeIncompleteTools(e){this.tools.filter(i=>(e==null||i!==e)&&!i.created&&i.removeIncompleteOnCancel).forEach(i=>{this.tools.remove(i)})}get test(){}};d([m({constructOnly:!0,nonNullable:!0})],of.prototype,"view",void 0),d([m({value:null})],of.prototype,"activeTool",null),d([m({readOnly:!0,type:He})],of.prototype,"tools",void 0),d([m()],of.prototype,"cursor",null),d([m({readOnly:!0})],of.prototype,"updating",null),d([m()],of.prototype,"_interacting",void 0),d([m({readOnly:!0})],of.prototype,"interacting",null),of=d([k("esri.views.ToolViewManager")],of);const Ost=new mt("cyan"),Pst=1,Rst=.25,XMe=new mt("black"),JMe=.4,KMe=.2,Dst=.25,Tp="default",Ist="temporary",Lst=new mt("yellow"),kst=8;var oQ;let hu=oQ=class extends Me{constructor(t){super(t),this.name=Tp,this.color=Ost.clone(),this.haloColor=null,this.haloOpacity=Pst,this.fillOpacity=Rst,this.shadowColor=XMe.clone(),this.shadowOpacity=JMe,this.shadowDifference=KMe,this.haloWidth=2.1,this.haloBlur=.8/this.haloWidth}equals(t){return this.color.equals(t.color)&&(this.haloColor||this.color).equals(t.haloColor||t.color)&&this.haloOpacity===t.haloOpacity&&this.fillOpacity===t.fillOpacity&&this.haloWidth===t.haloWidth&&this.haloBlur===t.haloBlur&&this.shadowColor.equals(t.shadowColor)&&this.shadowOpacity===t.shadowOpacity&&this.shadowDifference===t.shadowDifference}clone(){return new oQ({...this,color:this.color.clone(),haloColor:this.haloColor?.clone(),shadowColor:this.shadowColor?.clone()})}assignFrom(t){this.color=t.color.clone(),this.haloColor=t.haloColor?.clone(),this.haloOpacity=t.haloOpacity,this.fillOpacity=t.fillOpacity,this.shadowColor=t.shadowColor.clone(),this.shadowDifference=t.shadowDifference,this.shadowOpacity=t.shadowOpacity,this.haloBlur=t.haloBlur,this.haloWidth=t.haloWidth}};d([m({type:String,constructOnly:!0,nonNullable:!0})],hu.prototype,"name",void 0),d([m({type:mt,nonNullable:!0})],hu.prototype,"color",void 0),d([m({type:mt})],hu.prototype,"haloColor",void 0),d([m({nonNullable:!0})],hu.prototype,"haloOpacity",void 0),d([m({nonNullable:!0})],hu.prototype,"fillOpacity",void 0),d([m({type:mt,nonNullable:!0})],hu.prototype,"shadowColor",void 0),d([m({nonNullable:!0})],hu.prototype,"shadowOpacity",void 0),d([m({nonNullable:!0})],hu.prototype,"shadowDifference",void 0),d([m({nonNullable:!0})],hu.prototype,"haloWidth",void 0),d([m({nonNullable:!0})],hu.prototype,"haloBlur",void 0),hu=oQ=d([k("esri.views.support.HighlightOptions")],hu);const Aw=hu;function zst(){return new(He.ofType(Aw))([new Aw({name:Tp}),new Aw({name:Ist,color:Lst})])}let gT=class extends Me{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown",e.mapping==="standard"?this._detectedDeviceType="standard":Fst.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){const e=navigator.getGamepads?navigator.getGamepads():[];return this.nativeIndex!=null&&this.nativeIndex<e.length?e[this.nativeIndex]:null}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return Nst[this.deviceType]}};d([m({nonNullable:!0,readOnly:!0})],gT.prototype,"nativeIndex",void 0),d([m({type:String,readOnly:!0})],gT.prototype,"deviceType",null),d([m({type:Number,readOnly:!0})],gT.prototype,"axisThreshold",null),gT=d([k("esri.views.input.gamepad.GamepadInputDevice")],gT);const Bte=gT,Fst=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),Nst={standard:.15,spacemouse:.025,unknown:0};let wO=class extends Me{constructor(e){super(e),this.devices=new He,this.enabledFocusMode="document"}};d([m({type:He.ofType(Bte),readOnly:!0})],wO.prototype,"devices",void 0),d([m({type:["document","view","none"]})],wO.prototype,"enabledFocusMode",void 0),wO=d([k("esri.views.input.gamepad.GamepadSettings")],wO);const Vst=wO;let Uz=class extends Me{constructor(){super(...arguments),this.gamepad=new Vst}};d([m({readOnly:!0})],Uz.prototype,"gamepad",void 0),Uz=d([k("esri.views.input.Input")],Uz);const Ust=Uz,k7=()=>m({type:["pan","rotate","zoom","none"],nonNullable:!0});let db=class extends Me{constructor(e){super(e),this.dragPrimary="pan",this.dragSecondary="rotate",this.dragTertiary="zoom",this.mouseWheel="zoom"}};d([k7()],db.prototype,"dragPrimary",void 0),d([k7()],db.prototype,"dragSecondary",void 0),d([k7()],db.prototype,"dragTertiary",void 0),d([m({type:["zoom","none"],nonNullable:!0})],db.prototype,"mouseWheel",void 0),db=d([k("esri.views.navigation.NavigationActionMap")],db);const eEe=db;let Y0=class extends Me{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};d([m({type:Boolean,nonNullable:!0})],Y0.prototype,"enabled",void 0),d([m({type:Bte})],Y0.prototype,"device",void 0),d([m({type:["pan","zoom"],nonNullable:!0})],Y0.prototype,"mode",void 0),d([m({type:["forward-down","forward-up"],nonNullable:!0})],Y0.prototype,"tiltDirection",void 0),d([m({type:Number,nonNullable:!0})],Y0.prototype,"velocityFactor",void 0),Y0=d([k("esri.views.navigation.gamepad.GamepadSettings")],Y0);const tEe=Y0;let Q0=class extends Me{constructor(e){super(e),this.actionMap=new eEe,this.browserTouchPanEnabled=!0,this.gamepad=new tEe,this.momentumEnabled=!0}get mouseWheelZoomEnabled(){return this.actionMap.mouseWheel==="zoom"}set mouseWheelZoomEnabled(e){XH(fe.getLogger(this),"mouseWheelZoomEnabled",{replacement:"actionMap.mouseWheel",version:"4.32",warnOnce:!0}),this.actionMap.mouseWheel=e?"zoom":"none"}};d([m({type:eEe,nonNullable:!0})],Q0.prototype,"actionMap",void 0),d([m({type:Boolean})],Q0.prototype,"browserTouchPanEnabled",void 0),d([m({type:tEe,nonNullable:!0})],Q0.prototype,"gamepad",void 0),d([m({type:Boolean})],Q0.prototype,"momentumEnabled",void 0),d([m({type:Boolean})],Q0.prototype,"mouseWheelZoomEnabled",null),Q0=d([k("esri.views.navigation.Navigation")],Q0);const iEe=Q0;function Bst(t,e){if(!t)return null;if(!lQ(t))return new ee("webscene:unsupported-height-model-info","The vertical coordinate system of the scene is not supported",{heightModelInfo:t});const i=t.heightUnit,r=Eo.deriveUnitFromSR(t,e).heightUnit;return i!==r?new ee("webscene:incompatible-height-unit",`The vertical units of the scene (${i}) must match the horizontal units of the scene (${r})`,{verticalUnit:i,horizontalUnit:r}):null}function kBt(t,e,i){const r=rEe(t),s=e,n=jst(r,s,i);if(r){const a=Eo.deriveUnitFromSR(r,t.spatialReference).heightUnit;if(!i&&a!==r.heightUnit){const o=new ee("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${a})`,{horizontalUnit:a});return new ee("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:r,error:o})}}if(!qst(t)||n===4)return new ee("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:r});switch(n){case 1:{const a=r?.heightUnit||"unknown",o=s?.heightUnit||"unknown",l=new ee("layerview:incompatible-height-unit",`The vertical units of the layer (${a}) must match the vertical units of the scene (${o})`,{layerUnit:a,sceneUnit:o});return new ee("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:l})}case 2:{const a=r?.heightModel||"unknown",o=s?.heightModel||"unknown",l=new ee("layerview:incompatible-height-model",`The height model of the layer (${a}) must match the height model of the scene (${o})`,{layerHeightModel:a,sceneHeightModel:o});return new ee("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:l})}case 3:{const a=r?.vertCRS||"unknown",o=s?.vertCRS||"unknown",l=new ee("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${a}) must match the vertical datum of the scene (${o})`,{layerDatum:a,sceneDatum:o});return new ee("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:l})}}return null}function jst(t,e,i){if(!lQ(t)||!lQ(e))return 4;if(t==null||e==null)return 0;if(!i&&t.heightUnit!==e.heightUnit)return 1;if(t.heightModel!==e.heightModel)return 2;switch(t.heightModel){case"gravity-related-height":return 0;case"ellipsoidal":return t.vertCRS===e.vertCRS?0:3;default:return 4}}function lQ(t){return t==null||t.heightModel!=null&&t.heightUnit!=null}function qst(t){return"heightModelInfo"in t&&t.heightModelInfo!=null||t.spatialReference!=null||!aEe(t)}function rEe(t){if(t.type==="integrated-mesh-3dtiles"||t.type==="gaussian-splat")return null;const e=t.url?HD(t.url):void 0;return!(t.spatialReference?.vcsWkid==null&&e!=null&&e.serverType==="ImageServer")&&sEe(t)&&t.heightModelInfo?t.heightModelInfo:aEe(t)?Eo.deriveUnitFromSR(Hst,t.spatialReference):null}function sEe(t){return"heightModelInfo"in t}function nEe(t){if(t.type==="unknown"||!("capabilities"in t))return!1;switch(t.type){case"catalog":case"catalog-footprint":case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"oriented-imagery":case"wfs":case"knowledge-graph-sublayer":return!0;default:return!1}}function aEe(t){return nEe(t)?!!(t.capabilities&&t.capabilities.data&&t.capabilities.data.supportsZ):oEe(t)}function Gst(t){return t.layers!=null||oEe(t)||nEe(t)||sEe(t)}function oEe(t){switch(t.type){case"building-scene":case"elevation":case"integrated-mesh":case"integrated-mesh-3dtiles":case"point-cloud":case"scene":case"voxel":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"catalog":case"catalog-footprint":case"catalog-dynamic-group":case"csv":case"dimension":case"gaussian-splat":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"knowledge-graph":case"link-chart":case"knowledge-graph-sublayer":case"line-of-sight":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"oriented-imagery":case"parquet":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"video":case"viewshed":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}const Hst=new Eo({heightModel:"gravity-related-height"});let cQ,z7=null;async function Wst(t){z7||(z7=te(()=>import("./geometryServiceUtils-C1ZVq3hY.js"),[]).then(e=>cQ=e)),await z7,st(t)}async function lEe(t,e,i,r){if(!t)return null;const s=t.spatialReference;return Gv()||Nu(s,e)?zo(t,e):cQ?cQ.projectGeometry(t,e,i,r):(await Promise.race([Wst(r),qx(r)]),lEe(t,e,i,r))}async function zBt(t,e){try{return t?.spatialReference?await fy(t,e):null}catch{return null}}let as=class extends Me{constructor(e){super(e),this.required={extent:!1,heightModelInfo:!1,tileInfo:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=ps(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return this.userSpatialReference??this._spatialReferenceTask.spatialReference}get extent(){return this._extentTask.extent}get heightModelInfo(){return this._heightModelInfoTask.heightModelInfo}get vcsWkid(){return this._heightModelInfoTask.vcsWkid}get latestVcsWkid(){return this._heightModelInfoTask.latestVcsWkid}get viewingMode(){return this.userSpatialReference==null||this.userSpatialReference.equals(this._spatialReferenceTask.spatialReference)?this._spatialReferenceTask.viewingMode:null}get tileInfo(){return this._tileInfoTask.tileInfo}get mapCollections(){const e=this.map?.(),i=[];return this.priorityCollection!=null&&i.push(this.priorityCollection),i.push({parent:e?.basemap,layers:e?.basemap?.baseLayers},{parent:e?.basemap,layers:e?.basemap?.groundLayers},{layers:e?.layers},{parent:e?.ground,layers:e?.ground?.layers},{parent:e?.basemap,layers:e?.basemap?.referenceLayers}),i}get _spatialReferenceTask(){if(this.suspended)return this._get("_spatialReferenceTask")??{updating:!1};let e;if(this._collectLayers(this.mapCollections,r=>{const s=this._getSupportedSpatialReferences(r);if(s.length>0){const n=this._narrowDownSpatialReferenceCandidates(e,s);n!=null&&(e=n)}return e?.length===1})&&e?.length!==1)return{updating:!0};const i=this._pickSpatialReferenceCandidate(e);return{spatialReference:i?.spatialReference??null,viewingMode:i?.viewingMode??null,updating:!1}}get _tileInfoTask(){if(!this.required.tileInfo)return this._get("_tileInfoTask")??{updating:!1};const e=this.map?.(),i=this.spatialReference;if(!i)return{updating:this._spatialReferenceTask.updating};let r;const s=this._collectLayers([{parent:e?.basemap,layers:e?.basemap?.baseLayers},{parent:e?.basemap,layers:e?.basemap?.groundLayers},{layers:e?.layers}],n=>!(!("tileInfo"in n)||!n.tileInfo?.spatialReference.equals(i))&&(r=n,!0),n=>"tileInfo"in n);return r?{tileInfo:r.tileInfo,updating:!1}:{updating:s}}get _heightModelInfoTask(){if(!this.required.heightModelInfo||this.suspended&&this._get("_heightModelInfoTask")?.heightModelInfo)return this._get("_heightModelInfoTask")??{updating:!1};let e={};const i=this._collectLayers(this.mapCollections,r=>{const s=rEe(r);return!!s&&(e={heightModelInfo:s,vcsWkid:r.spatialReference?.vcsWkid,latestVcsWkid:r.spatialReference?.latestVcsWkid},!0)},r=>Gst(r));return{...e,updating:i}}get _extentCandidatesTask(){if(this.suspended||!this.required.extent)return this._get("_extentCandidatesTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const e=[],i=this._collectLayers(this.mapCollections,r=>{const s="fullExtents"in r&&r.fullExtents||(r.fullExtent!=null?[r.fullExtent]:[]),n=this.requiresExtentInSpatialReference?null:s[0],a=s.find(o=>o.spatialReference.equals(this.spatialReference))??n;if(a)return e.push({extent:a,layer:r}),!0;if(this._getSupportedSpatialReferences(r).length>0)for(const o of s)e.push({extent:o,layer:r});return!1});return{candidates:e,updating:i}}get _extentTask(){const{candidates:e,updating:i}=this._extentCandidatesTask;if(i)return{updating:i};if(e==null||e.length===0)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const r=this._pickExtentCandidate(e),s=this.spatialReference;return r.extent.equals(this._projectExtentTask.input)&&s.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:this._projectExtentTask.task!=null&&!this._projectExtentTask.task.finished}:(this._projectExtentTask.task!=null&&(this._projectExtentTask.task=ps(this._projectExtentTask.task)),this._projectExtentTask={input:r.extent.clone(),output:null,spatialReference:s.clone(),task:Bc(async n=>{try{const a=await lEe(r.extent,s,"portalItem"in r.layer?r.layer.portalItem:void 0,n);this._projectExtentTask={...this._projectExtentTask,task:null,output:a}}catch{if(Rn(n))return;this._projectExtentTask={...this._projectExtentTask,task:null}}})},{updating:!0})}_narrowDownSpatialReferenceCandidates(e,i){if(e==null)return i;const r=new Array;for(const s of e)for(const n of i){if(!s.spatialReference.equals(n.spatialReference))continue;const a=Yst(s.viewingMode,n.viewingMode);if(a!==!1){r.push({spatialReference:s.spatialReference,viewingMode:a});break}}return r.length>0?r:null}_pickSpatialReferenceCandidate(e){const i=this.defaultSpatialReference;return e==null||e.length<1?i?{spatialReference:i,viewingMode:null}:null:(i!=null&&e.length>1&&e.some(({spatialReference:r})=>r.equals(i))&&(e=e.filter(({spatialReference:r})=>r.equals(i))),e.length>1&&e.some(({viewingMode:r})=>r!==2)&&(e=e.filter(({viewingMode:r})=>r!==2)),e[0])}_getSupportedSpatialReferences(e){const i="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(i.length===0)return[];const r=[];for(const s of i){const n=this.getSpatialReferenceSupport(s,e);if(n!=null){const a=n.constraints??[{spatialReference:s,viewingMode:null}];for(const{spatialReference:o,viewingMode:l}of a)this.requiresExtentInSpatialReference&&this.userSpatialReference!=null&&!o.equals(this.userSpatialReference)||r.push({spatialReference:o,viewingMode:l})}}return r}_pickExtentCandidate(e){const i=this.spatialReference;return e.find(({extent:r})=>i.equals(r.spatialReference))||e[0]}_collectLayers(e,i,r=()=>!0){switch(this._loadMaybe(this.map?.())){case"loading":return!0;case"failed":return!1}const s=new Zst(r,i);for(const n of e)if(this._collectCollection(n,s),s.done||s.preloading===this.sourcePreloadCount)break;return s.updating}_collectCollection(e,i){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return i.updating=!0,void++i.preloading;case"failed":return}for(const r of e.layers)if((r.type!=="graphics"||!r.internal)&&i.layerFilter(r)){switch(this._loadMaybe(r)){case"failed":continue;case"loading":i.updating=!0,++i.preloading;break;case"loaded":if(i.updating||(i.done=i.pushLayer(r)),i.done||i.preloading===this.sourcePreloadCount)break;"layers"in r&&this._collectCollection({layers:r.layers},i)}if(i.done||i.preloading===this.sourcePreloadCount)break}}}_loadMaybe(e){return e&&"loadStatus"in e&&e.loadStatus!=null?e.loadStatus==="not-loaded"?(e.load().catch(i=>{Hr(i)}),"loading"):e.loadStatus:"loaded"}};d([m()],as.prototype,"required",void 0),d([m({constructOnly:!0})],as.prototype,"map",void 0),d([m({constructOnly:!0})],as.prototype,"getSpatialReferenceSupport",void 0),d([m()],as.prototype,"defaultSpatialReference",void 0),d([m()],as.prototype,"userSpatialReference",void 0),d([m()],as.prototype,"sourcePreloadCount",void 0),d([m()],as.prototype,"priorityCollection",void 0),d([m()],as.prototype,"requiresExtentInSpatialReference",void 0),d([m()],as.prototype,"suspended",void 0),d([m({readOnly:!0})],as.prototype,"ready",null),d([m({readOnly:!0})],as.prototype,"heightModelInfoReady",null),d([m({readOnly:!0})],as.prototype,"spatialReference",null),d([m({readOnly:!0})],as.prototype,"extent",null),d([m({readOnly:!0})],as.prototype,"heightModelInfo",null),d([m({readOnly:!0})],as.prototype,"vcsWkid",null),d([m({readOnly:!0})],as.prototype,"latestVcsWkid",null),d([m({readOnly:!0})],as.prototype,"viewingMode",null),d([m({readOnly:!0})],as.prototype,"tileInfo",null),d([m({readOnly:!0})],as.prototype,"mapCollections",null),d([m({readOnly:!0})],as.prototype,"_spatialReferenceTask",null),d([m({readOnly:!0})],as.prototype,"_tileInfoTask",null),d([m({readOnly:!0})],as.prototype,"_heightModelInfoTask",null),d([m({readOnly:!0})],as.prototype,"_extentCandidatesTask",null),d([m()],as.prototype,"_extentTask",null),d([m()],as.prototype,"_projectExtentTask",void 0),as=d([k("esri.views.support.DefaultsFromMap")],as);let Zst=class{constructor(e,i){this.layerFilter=e,this.pushLayer=i,this.preloading=-1,this.updating=!1,this.done=!1}};function Yst(t,e){return t!=null?e!=null?t===e&&t:t:e}function Qst(t){return"tryRecycleWith"in t}let Xst=class{constructor(e,i,r){this.layer=e,this.view=i,this.layerViewImporter=r,this._controller=new AbortController,this._started=!1,this.done=!1,this._deferred=lo(),this.promise=this._deferred.promise,qa(this._controller.signal,()=>{this._recycleController?.abort();const s=new ee("cancelled:layerview-create","layerview creation cancelled",{layer:e});this._deferred?.reject(s)})}tryRecycle(e){if(!this.done||!this.layerView||!Qst(this.layerView))return null;this._recycleController?.abort(),this._recycleController=new AbortController;const i=this.layer.type,r=this._recycleController.signal;for(let s=0;s<e.length;s++){const n=e[s];if(n.type!==i)continue;const a=this.layerView.tryRecycleWith(n,{signal:r});if(a){e.splice(s,1),this.layer=n;const o=this.layerView,l=o.view;return this.promise=a.then(()=>(st(r),n.emit("layerview-destroy",{view:l,layerView:o}),l.emit("layerview-destroy",{view:l,layerView:o}),n.emit("layerview-create",{view:l,layerView:o}),l.emit("layerview-create",{view:l,layerView:o}),o)),this.promise}}return null}destroy(){this._controller.abort();const{layerView:e}=this;if(e){const{layer:i,view:r}=this;i.emit("layerview-destroy",{view:r,layerView:e}),r.emit("layerview-destroy",{layer:i,layerView:e})}this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null,this._map=null,this.promise=null,this._deferred=null}async start(){const{view:e}=this;if(this._started||!e.map)return;this._started=!0;const{_controller:{signal:i},layer:r}=this;this._map=e.map;try{let s,n;if(await r.load({signal:i}),r.prefetchResources&&await r.prefetchResources({signal:i}),Jst(r))s=await r.createLayerView(e,{signal:i});else{if(!this.layerViewImporter.hasLayerViewModule(r))throw new ee("layer:view-not-supported","No layerview implementation was found");const l=await this.layerViewImporter.importLayerView(r);st(i),s="default"in l?new l.default({layer:r,view:e}):new l({layer:r,view:e})}const a=()=>{n=Ki(n),s.destroyed||s.destroy(),this.done=!0};n=qa(i,a),st(i);try{await s.when()}catch(l){throw a(),l}if(!this._map?.allLayers?.includes(r))return a(),void this._deferred?.reject(new ee("view:no-layerview-for-layer","The layer has been removed from the map",{layer:r}));this.layerView=s,r.emit("layerview-create",{view:e,layerView:s}),e.emit("layerview-create",{layer:r,layerView:s}),this.done=!0,this._deferred?.resolve(s)}catch(s){r.emit("layerview-create-error",{view:e,error:s}),e.emit("layerview-create-error",{layer:r,error:s}),this.done=!0,this._deferred?.reject(new ee("layerview:create-error","layerview creation failed",{layer:r,error:s}))}}};function Jst(t){return t.createLayerView!==Ms.prototype.createLayerView}function Kst(t){return t!=null&&typeof t=="object"&&"layerViews"in t}let dc=class extends Me{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._recyclingInfoMap=new Map,this._watchUpdatingTracking=new mp,this.supportsGround=!0,this._preloadLayerViewModules=()=>{const i=this.view.map?.allLayers;if(i)for(const r of i)this.layerViewFilter?.(r)!==!1&&this.layerViewImporter.hasLayerViewModule(r)&&this.layerViewImporter.importLayerView(r)},this._reschedule=()=>this.destroyed?Promise.reject():(this._workPromise==null&&(this._workPromise=lo(),this._workPromise.promise.catch(()=>{})),this.removeHandles("reschedule"),this.addHandles(oM(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{if(this.destroyed)return;const{map:i}=this.view;if(!i)return void this.clear();if(this._map!==i&&(this.clear(),this._map=i),this._workPromise==null)return void this.notifyChange("updating");this.removeHandles("reschedule"),this.removeHandles("collection-change");const r=new Set,s=[],n=this.view.ready,a=h=>{if(h!=null){for(const f of h)if(f){if(this.layerViewFilter?.(f)===!1)continue;r.add(f);const y=this._layerLayerViewInfoMap.get(f);y&&n?y.start():y||this._recyclingInfoMap.has(f)||s.push(f),"layers"in f&&f.layers&&a(f.layers)}}};for(const h of this._rootCollectionNames)a(tp(this,h));const o=new Array,l=h=>{const f=h.tryRecycle(s);f?(this._recyclingInfoMap.set(h.layer,h),this.notifyChange("updating"),f.then(()=>{this._recyclingInfoMap.delete(h.layer),this._layerLayerViewInfoMap.set(h.layer,h),this._reschedule(),this.notifyChange("updating")}).catch(y=>{Hr(y)||(this._recyclingInfoMap.delete(h.layer),h.destroy(),this._reschedule(),this.notifyChange("updating"))})):o.push(h)};for(const h of this._layerLayerViewInfoMap.values())r.has(h.layer)||(this._layerLayerViewInfoMap.delete(h.layer),l(h));for(const h of this._recyclingInfoMap.values())r.has(h.layer)||(this._recyclingInfoMap.delete(h.layer),l(h));for(const h of s)this._createLayerView(h);this._refreshCollections(),o.forEach(h=>h.destroy());const c=[i?.ground?.layers,i?.basemap?.baseLayers,i?.basemap?.groundLayers,i?.basemap?.referenceLayers,i?.layers].filter(h=>!!h);r.forEach(h=>"layers"in h&&c.push(h.layers)),this.addHandles(c.map(h=>this._watchUpdatingTracking.addOnCollectionChange(()=>h,this._reschedule)),"collection-change"),this._workPromise.resolve(),this._workPromise=null},this._layersToLayerViews=new Map(e.layerviewMapping)}initialize(){this.addHandles([Ys(()=>this.view?.map?.allLayers,"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),K(()=>{const e=this.view,i=e?.map;return[i?.basemap,i?.ground,i?.layers,e?.ready]},()=>this._reschedule(),At)]),this._preloadLayerViewModules(),this._reschedule()}clearHandles(){this._watchUpdatingTracking.removeAll()}destroy(){this.clear(),I5(this._recyclingInfoMap),I5(this._layerLayerViewInfoMap),this._watchUpdatingTracking.destroy(),this._map=null,this._workPromise!=null&&(this._workPromise.reject(Xt()),this._workPromise=null)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return this._workPromise!=null||this._watchUpdatingTracking.updating||Qd(this._layerLayerViewInfoMap,e=>!e.done)||this._recyclingInfoMap.size>0}get updatingRemaining(){let e=0;for(const i of this._layerLayerViewInfoMap.values())i.done||++e;return e}clear(){this.destroyed||(this._clearCollections(),I5(this._layerLayerViewInfoMap),I5(this._recyclingInfoMap))}async whenLayerView(e){await this._reschedule();const i=this._layerLayerViewInfoMap.get(e)?.promise;if(!i){const r=this._recyclingInfoMap.get(e)?.promise;if(!r)throw new ee("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e});return r}return i}isCreatingLayerViewsForLayer(e,i){this.commitProperty("updatingRemaining");const r=this._layerLayerViewInfoMap.get(e);if(!r?.done)return!0;const s=r.layerView;return!(!s||!i||s.parent===i)||!!(r.done&&s&&"layers"in e&&e.layers?.length)&&e.layers.some(n=>this.isCreatingLayerViewsForLayer(n,s))}_refreshCollections(){for(const[e,i]of this._layersToLayerViews)this._populateLayerViewsOwners(tp(this,e),tp(this,i),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_clearCollections(){for(const e of this._layersToLayerViews.values())tp(this,e)?.removeAll()}_populateLayerViewsOwners(e,i,r){if(!e||!i)return void i?.removeAll();let s=0;for(const n of e){const a=this._layerLayerViewInfoMap.get(n);if(!a?.layerView)continue;const{layerView:o}=a;o.layer=n,o.parent=r,i.at(s)!==o&&i.splice(s,0,o),"layers"in n&&Kst(o)&&this._populateLayerViewsOwners(n.layers,o.layerViews,o),++s}s<i.length&&i.splice(s)}_createLayerView(e){e.load().catch(()=>{}),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const i=new Xst(e,this.view,this.layerViewImporter);i.promise?.then(()=>this._refreshCollections(),r=>{r&&(Hr(r)||r.name==="cancelled:layerview-create")||fe.getLogger(this).error(`Failed to create layerview for layer title:'${e.title??"no title"}', id:'${e.id??"no id"}' of type '${e.type}'.`,{layer:e,error:r}),this.destroyed||this._refreshCollections()}),this._layerLayerViewInfoMap.set(e,i),this.view.ready&&i.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};d([m()],dc.prototype,"_workPromise",void 0),d([m({readOnly:!0})],dc.prototype,"_watchUpdatingTracking",void 0),d([m({readOnly:!0})],dc.prototype,"_layersToLayerViews",void 0),d([m({constructOnly:!0})],dc.prototype,"layerviewMapping",void 0),d([m({readOnly:!0})],dc.prototype,"_rootCollectionNames",null),d([m({constructOnly:!0})],dc.prototype,"layerViewFilter",void 0),d([m()],dc.prototype,"layerViewImporter",void 0),d([m()],dc.prototype,"supportsGround",void 0),d([m({readOnly:!0})],dc.prototype,"updating",null),d([m({readOnly:!0})],dc.prototype,"updatingRemaining",null),d([m({constructOnly:!0})],dc.prototype,"view",void 0),dc=d([k("esri.views.support.LayerViewManager")],dc);const ent=dc;let yT=class extends Me{constructor(e){super(e),this.featureTitleFields=!1,this.utilityNetworkFields=!1,this.globalIdField=!1}};d([m()],yT.prototype,"featureTitleFields",void 0),d([m()],yT.prototype,"utilityNetworkFields",void 0),d([m()],yT.prototype,"globalIdField",void 0),yT=d([k("esri.views.support.RequiredFieldsOptions")],yT);const tnt=yT;var _T,tv;let _t=(tv=class extends s2(ute){constructor(e){super(e),this._userSpatialReference=null,this.handles=new Fv,this.updatingHandles=new mp,this.allLayerViews=new Jd({getCollections:()=>this.layerviewCollections,getChildrenFunction:int}),this.analyses=new RC,this.basemapView=null,this.dependencies={popup:void 0},this.displayFilterEnabled=!0,this.fatalError=null,this.graphics=new Ew,this.typeSpecificPreconditionsReady=!0,this.layerViews=new He,this.magnifier=new jMe,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this._readyStateWaitingTask=null,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this._lowPriorityCursorHandles=new He,this._highPriorityCursorHandles=new He,this.input=new Ust,this.navigation=new iEe,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new hst(this),this.persistableViewModels=new He,this.requiredFieldsOptions=new tnt,this._isValid=!1,this._readyCycleForced=!1,this._lockedSpatialReference=null,this._userTimeZone=null,this._lockedTimeZone=null,this._userTimeExtent=null,this._lockedTimeExtent=null,this.theme=null,this.handles.add(K(()=>this.preconditionsReady,i=>{const r=this.ready;if(i?(this._lockedSpatialReference=this.spatialReference,this._lockedTimeZone=this.timeZone,this._lockedTimeExtent=this.timeExtent,_T.views.add(this)):(this._lockedSpatialReference=null,_T.views.remove(this)),this.notifyChange("spatialReference"),!i&&r)this.toolViewManager?.detach(),this.analysisViewManager?.detach(),this.layerViewManager?.clear(),this._teardown();else if(i&&!r){try{this._startup()}catch(s){return void queueMicrotask(()=>{this.fatalError=new ee("view:startup-error","View._startup failed",s)})}this.analysisViewManager?.attach(),this.toolViewManager.attach()}},Yt))}initialize(){this.addResolvingPromise(Promise.all([this.loadAsyncDependencies(),this._validateWithErrorDisplay()]).then(()=>(this._isValid=!0,mv(()=>this.ready)))),this.basemapView=new Qrt({view:this}),this.layerViewManager=new ent({view:this,layerViewFilter:e=>this.layerViewFilter?.(e)??!0,layerViewImporter:{importLayerView:e=>this.importLayerView(e),hasLayerViewModule:e=>this.hasLayerViewModule(e)},layerviewMapping:this._layerToLayerviewMapping}),this.toolViewManager=new of({view:this}),this.selectionManager=new cst({view:this}),this.addHandles([Zs(()=>this.readyState==="map-content-error"&&!this.spatialReference,()=>{fe.getLogger(this).warn("#spatialReference","no spatial reference could be derived from the currently added map layers")}),K(()=>this.initialExtentRequired,e=>this.defaultsFromMap.required={...this.defaultsFromMap.required,extent:e},At),K(()=>this.ready,e=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=e,this.defaultsFromMap.userSpatialReference=e?this.spatialReference:this._userSpatialReference)},Yt),K(()=>this._userSpatialReference,e=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=e)},At)])}get _layerToLayerviewMapping(){return _T._layerToLayerview}destroy(){this.destroyed||(_T.views.remove(this),this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=Re(this.graphics),this.analyses=Re(this.analyses),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),this.analysisViewManager=Re(this.analysisViewManager),this.toolViewManager=Re(this.toolViewManager),this.layerViewManager=Re(this.layerViewManager),this.selectionManager=Re(this.selectionManager),this.basemapView=Re(this.basemapView),this.layerViews?.forEach(e=>e.destroy()),this.layerViews.length=0,this.invalidate(),this.handles.destroy(),this.map=Re(this.map),this.updatingHandles.destroy())}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return fe.getLogger(this).error("#toMap()","Not implemented on this instance of View"),null}get activeTool(){return this.toolViewManager?.activeTool}set activeTool(e){this.toolViewManager&&(this.toolViewManager.activeTool=e)}get layerviewCollections(){return[this.basemapView?.baseLayerViews,this.basemapView?.groundLayerViews,this.layerViews,this.basemapView?.referenceLayerViews]}get animation(){return this._get("animation")}set animation(e){this._set("animation",e)}get center(){return null}get defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new as({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:(e,i)=>this.getSpatialReferenceSupport(e,i),...this.defaultsFromMapSettings})}get extent(){return this._get("extent")}set extent(e){this._set("extent",e)}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get highlights(){return this._get("highlights")??zst()}set highlights(e){this._set("highlights",kc(e,this._get("highlights"),He.ofType(Aw)))}get interacting(){return this.navigating}get navigating(){return!1}get preconditionsReady(){return!this.destroying&&!this.destroyed&&!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||yZ(this.map)&&!this.map.loaded||this.width===0||this.height===0||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._lockedSpatialReference&&!this.defaultsFromMap?.ready||!this.typeSpecificPreconditionsReady)}get resolution(){return 0}set map(e){e!==this._get("map")&&(e?.destroyed&&(fe.getLogger(this).warn("#map","The provided map is already destroyed",{map:e}),e=null),yZ(e)&&e.load().catch(()=>{}),this.constructed&&!this.destroyed&&(this.forceReadyCycle(),this._lockedSpatialReference=null),this._set("map",e))}get readyState(){if(this.destroyed)return this._get("readyState");if(!this.map)return"missing-map";if("container"in this&&!this.container)return"missing-container";if(this.fatalError)return"rendering-error";if((this.defaultsFromMap?.ready??!1)&&!this.spatialReference){const e=!("loaded"in this.map)||this.map.loaded,i=this.map.ground.loaded,r=this.map.basemap?.loaded??!0;return e&&r&&i&&!this.map?.allLayers.length?"empty-map":(this._readyStateWaitingTask||(this._readyStateWaitingTask=Bc(s=>iU(ie("view-readyState-waiting-delay"),null,s)),this.addHandles(this._readyStateWaitingTask),this.addHandles(this._readyStateWaitingTask,"ready-state-task")),this._readyStateWaitingTask?.finished?"map-content-error":"loading")}return this._readyStateWaitingTask=ps(this._readyStateWaitingTask),this.removeHandles("ready-state-task"),this.ready?"ready":"loading"}get spatialReference(){const e=this._userSpatialReference||this._lockedSpatialReference||this.getDefaultSpatialReference()||null;if(e&&this.defaultsFromMap?.required?.heightModelInfo){const i=e.clone();return i.vcsWkid=this.defaultsFromMap.vcsWkid,i.latestVcsWkid=this.defaultsFromMap.latestVcsWkid,i}return e}set spatialReference(e){const i=!fs(e,this._get("spatialReference"));this._set("_userSpatialReference",e),i&&(this._set("spatialReference",e),this._spatialReferenceChanged(e))}_spatialReferenceChanged(e){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get timeExtent(){return this._userTimeExtent??this._lockedTimeExtent??this.getDefaultTimeExtent()??null}set timeExtent(e){this._userTimeExtent=e}get timeZone(){return this._userTimeZone??this._lockedTimeZone??this.getDefaultTimeZone()??vp}set timeZone(e){this._userTimeZone=e,MZe(e)||fe.getLogger(this).warn("#timeZone",`the parsed value '${e}' may not be a valid IANA time zone`)}get tools(){return this.toolViewManager?.tools}get initialExtent(){return this.defaultsFromMap?.extent}get cursor(){return this.toolViewManager?.cursor??this._highPriorityCursorHandles.at(-1)?.cursor??this._lowPriorityCursorHandles.at(-1)?.cursor??"default"}acquireCursor(e,i="low"){const r=i==="high"?this._highPriorityCursorHandles:this._lowPriorityCursorHandles,s={cursor:e},n=ci(()=>r.remove(s));return r.add(s),this.addHandles(n),n}get size(){return[this.width,this.height]}get effectiveTheme(){return this.theme??new sQ}whenLayerView(e){return this.layerViewManager?.whenLayerView(e)??Promise.reject()}getDefaultSpatialReference(){return this.defaultsFromMap?.spatialReference}getDefaultHeightModelInfo(){return(this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)??this.defaultsFromMap?.heightModelInfo??null}getDefaultTimeZone(){return null}getDefaultTimeExtent(){return null}getSurface(){return null}importLayerView(e){throw new ee("view:importLayerView-missing","importLayerView() not implemented")}hasLayerViewModule(e){return!1}async validate(){}async loadAsyncDependencies(){}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(e){return this.getSpatialReferenceSupport(e)!=null}when(e,i){return this.isResolved()&&!this.ready&&fe.getLogger(this).warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(e,i)}forceReadyCycle(){this.ready&&(Zs(()=>this.destroyed||this.preconditionsReady===!1,()=>this._readyCycleForced=!1,{once:!0}),this._readyCycleForced=!0)}on(e,i){return super.on(e,i)}addAndActivateTool(e){this.toolViewManager.tools.add(e),this.activeTool=e}tryFatalErrorRecovery(){this.fatalError=null}async _validateWithErrorDisplay(){try{await this.validate()}catch(e){const i=document.createElement("div");i.setAttribute("style","display: flex; flex-direction: column; gap: 8px; padding: 20px; height: 100%; justify-content: center; color: black; background: white; font-family: sans-serif;");const r=document.createElement("div");r.innerHTML="Unable to display map. WebGL2 support is required.",r.setAttribute("style","font-size: 24px; font-weight: bold;");const s=document.createElement("div");s.innerHTML="Ensure that your browser and hardware meet the minimum requirements.",s.setAttribute("style","font-size: 18px;");const n=document.createElement("a");n.innerHTML="https://esriurl.com/webgl-faq",n.target="_blank",n.setAttribute("style","font-size: 18px;"),n.href="https://esriurl.com/webgl-faq",i.appendChild(r),i.appendChild(s),i.appendChild(n);const a=this.getSurface();throw a&&a.appendChild(i),e}}},_T=tv,tv._layerToLayerview=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.basemap.groundLayers","view.basemapView.groundLayerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"],["view.map.layers","view.layerViews"]],tv.views=new He,tv);d([m()],_t.prototype,"_userSpatialReference",void 0),d([m()],_t.prototype,"activeTool",null),d([m({readOnly:!0})],_t.prototype,"allLayerViews",void 0),d([m({readOnly:!0})],_t.prototype,"layerviewCollections",null),d([m(o6(RC,"analyses"))],_t.prototype,"analyses",void 0),d([m()],_t.prototype,"animation",null),d([m()],_t.prototype,"basemapView",void 0),d([m()],_t.prototype,"center",null),d([m()],_t.prototype,"defaultsFromMapSettings",null),d([m()],_t.prototype,"defaultsFromMap",null),d([m()],_t.prototype,"dependencies",void 0),d([m()],_t.prototype,"displayFilterEnabled",void 0),d([m({type:Bt})],_t.prototype,"extent",null),d([m()],_t.prototype,"fatalError",void 0),d([m(o6(Ew,"graphics"))],_t.prototype,"graphics",void 0),d([m({readOnly:!0,type:Eo})],_t.prototype,"heightModelInfo",null),d([m({type:He.ofType(Aw)})],_t.prototype,"highlights",null),d([m({readOnly:!0})],_t.prototype,"interacting",null),d([m({constructOnly:!0})],_t.prototype,"layerViewFilter",void 0),d([m({readOnly:!0})],_t.prototype,"navigating",null),d([m({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_lockedSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],_t.prototype,"preconditionsReady",null),d([m({readOnly:!0})],_t.prototype,"typeSpecificPreconditionsReady",void 0),d([m({type:He,readOnly:!0})],_t.prototype,"layerViews",void 0),d([m()],_t.prototype,"resolution",null),d([m({type:jMe})],_t.prototype,"magnifier",void 0),d([m({value:null,type:ACe})],_t.prototype,"map",null),d([m()],_t.prototype,"padding",void 0),d([m({readOnly:!0})],_t.prototype,"ready",void 0),d([m()],_t.prototype,"_readyStateWaitingTask",void 0),d([m({readOnly:!0})],_t.prototype,"readyState",null),d([m({type:Ie})],_t.prototype,"spatialReference",null),d([m()],_t.prototype,"stationary",null),d([m({type:Mn})],_t.prototype,"timeExtent",null),d([m({type:String,nonNullable:!0})],_t.prototype,"timeZone",null),d([m()],_t.prototype,"tools",null),d([m()],_t.prototype,"toolViewManager",void 0),d([m({readOnly:!0})],_t.prototype,"type",void 0),d([m({type:Number})],_t.prototype,"scale",void 0),d([m({readOnly:!0})],_t.prototype,"updating",void 0),d([m({readOnly:!0})],_t.prototype,"initialExtentRequired",void 0),d([m({readOnly:!0})],_t.prototype,"initialExtent",null),d([m()],_t.prototype,"cursor",null),d([m({readOnly:!0})],_t.prototype,"input",void 0),d([m({type:iEe,nonNullable:!0})],_t.prototype,"navigation",void 0),d([m()],_t.prototype,"layerViewManager",void 0),d([m()],_t.prototype,"analysisViewManager",void 0),d([m()],_t.prototype,"selectionManager",void 0),d([m()],_t.prototype,"width",void 0),d([m()],_t.prototype,"height",void 0),d([m({readOnly:!0})],_t.prototype,"resizing",void 0),d([m({value:null,readOnly:!0})],_t.prototype,"size",null),d([m({readOnly:!0})],_t.prototype,"suspended",void 0),d([m({readOnly:!0})],_t.prototype,"viewEvents",void 0),d([m({readOnly:!0})],_t.prototype,"persistableViewModels",void 0),d([m()],_t.prototype,"_isValid",void 0),d([m()],_t.prototype,"_readyCycleForced",void 0),d([m()],_t.prototype,"_lockedSpatialReference",void 0),d([m()],_t.prototype,"_userTimeZone",void 0),d([m()],_t.prototype,"_lockedTimeZone",void 0),d([m()],_t.prototype,"_userTimeExtent",void 0),d([m()],_t.prototype,"_lockedTimeExtent",void 0),d([m({type:sQ})],_t.prototype,"theme",void 0),d([m({readOnly:!0,type:sQ})],_t.prototype,"effectiveTheme",null),_t=_T=d([k("esri.views.View")],_t);const F7=globalThis.$arcgis;F7&&!F7.views&&Object.defineProperty(F7,"views",{configurable:!1,enumerable:!0,writable:!1,value:_t.views});const Ape=_t;function int(t){return t.layerViews}var z$;let vT=(z$=class extends ute{constructor(e){super(e),this.state="running",this.target=null,this._resolver=null}initialize(){this._resolver=lo(),this.addResolvingPromise(this._resolver.promise)}get done(){return this.state==="finished"||this.state==="stopped"}stop(){this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","stopped"),this._resolver?.reject(new ee("view:animation-stopped","ViewAnimation stopped")))}finish(){this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","finished"),this._resolver?.resolve())}update(e,i){i||(i=$a(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",i)}},z$.state={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"},z$);d([m({readOnly:!0})],vT.prototype,"done",null),d([m({readOnly:!0,type:String})],vT.prototype,"state",void 0),d([m()],vT.prototype,"target",void 0),vT=d([k("esri.views.ViewAnimation")],vT);const kC=vT;function uQ(t){return t==="global"?1:2}function N7(t){return t===1?"global":"local"}function Ep(t,e,i,r){return{x:t,y:e,z:i,hasZ:i!=null,hasM:!1,spatialReference:r,type:"point"}}function cEe(t,e,i,r,s){t.x=e,t.y=i,t.z=r,t.hasZ=r!=null,t.spatialReference=s}let jBt=class{constructor(e,i,r,s,n){this.spatialReference=e,this._position=n!==void 0?[i,r,s??0,n??0]:s!==void 0?[i,r,s??0]:[i,r],this._flags=(s!==void 0?1:0)+(n!==void 0?2:0)}get hasZ(){return!(1&~this._flags)}get hasM(){return!(2&~this._flags)}get type(){return"point"}get x(){return this._position[0]}get y(){return this._position[1]}get z(){return this.hasZ?this._position[2]:void 0}get m(){return this.hasM?this._position[3]:void 0}};function ja(t,e,i,r,s){return!(e==null||r==null||t.length<2)&&(GE.x=t[0],GE.y=t[1],GE.z=t[2],GE.spatialReference=e,Yl(GE,i,r,s))}const GE=Ep(0,0,0,Ie.WGS84);function p2(t,e,i){return!!ja(t,e,z5,i.spatialReference)&&(i.x=z5[0],i.y=z5[1],i.z=z5[2],!0)}async function uEe(t,e,i,r){return await wp(e,i.spatialReference,null,r),p2(t,e,i)}const z5=R(),F5={102100:{maxX:20037508342788905e-9,minX:-20037508342788905e-9,plus180Line:new Ps({paths:[[[20037508342788905e-9,-20037508342788905e-9],[20037508342788905e-9,20037508342788905e-9]]],spatialReference:Ie.WebMercator}),minus180Line:new Ps({paths:[[[-20037508342788905e-9,-20037508342788905e-9],[-20037508342788905e-9,20037508342788905e-9]]],spatialReference:Ie.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new Ps({paths:[[[180,-180],[180,180]]],spatialReference:Ie.WGS84}),minus180Line:new Ps({paths:[[[-180,-180],[-180,180]]],spatialReference:Ie.WGS84})}};function rw(t,e){return Math.ceil((t-e)/(2*e))}function hEe(t,e){const i=ZP(t);for(const r of i)for(const s of r)s[0]+=e;return t}function ZP(t){return TU(t)?t.rings:t.paths}function rnt(t,e){return e?{...e,query:{...t,...e.query}}:{query:t}}function dEe(t){return typeof t=="string"?Ma(t):Te(t)}function snt(t,e,i){const r={};for(const s in t){if(s==="declaredClass")continue;const n=t[s];if(n!=null&&typeof n!="function")if(Array.isArray(n))r[s]=n.map(a=>snt(a));else if(typeof n=="object")if(n.toJSON){const a=n.toJSON(i?.[s]);r[s]=e?a:JSON.stringify(a)}else r[s]=e?n:JSON.stringify(n);else r[s]=n}return r}function nnt(t,e){return t?e&&UK(t)?e:VK(t)??hs?.findCredential(t)?.token:null}async function GBt(t,e,i){const r=nnt(t,e);return r||(!hs&&fr.request.useIdentity&&await te(()=>import("./IdentityManager-CinhUBi0.js"),[]),(await hs.getCredential(t,i))?.token)}async function ant(t,e,i,r){const s=dEe(t),n=e[0].spatialReference,a={...r,responseType:"json",query:{...s.query,f:"json",sr:ZN(n),target:JSON.stringify({geometryType:e4(e[0]),geometries:e}),cutter:JSON.stringify(i)}},o=await $r(s.path+"/cut",a),{cutIndexes:l,geometries:c=[]}=o.data;return{cutIndexes:l,geometries:c.map(h=>{const f=hy(h);return f.spatialReference=n,f})}}function ont(t){return{geometryType:e4(t[0]),geometries:t.map(e=>e.toJSON())}}function pEe(t,e,i){const r=QGe(e);return t.map(s=>{const n=r.fromJSON(s);return n.spatialReference=i,n})}async function lnt(t,e,i){const r=typeof t=="string"?Ma(t):t,s=e[0].spatialReference,n=e4(e[0]),a={...i,query:{...r.query,f:"json",sr:ZN(s),geometries:JSON.stringify(ont(e))}},{data:o}=await $r(r.path+"/simplify",a);return pEe(o.geometries,n,s)}const fEe=()=>fe.getLogger("esri.geometry.support.normalizeUtils");function cnt(t){return t.type==="polygon"}function unt(t){return t[0].type==="polygon"}function hnt(t){return t[0].type==="polyline"}function dnt(t,e){if(!(t instanceof Ps||t instanceof os)){const s="straightLineDensify: the input geometry is neither polyline nor polygon";throw fEe().error(s),new ee("internal:geometry",s)}const i=ZP(t),r=[];for(const s of i){const n=[];r.push(n),n.push([s[0][0],s[0][1]]);for(let a=0;a<s.length-1;a++){const o=s[a][0],l=s[a][1],c=s[a+1][0],h=s[a+1][1],f=Math.sqrt((c-o)*(c-o)+(h-l)*(h-l)),y=(h-l)/f,_=(c-o)/f,w=f/e;if(w>1){for(let A=1;A<=w-1;A++){const M=A*e,P=_*M+o,O=y*M+l;n.push([P,O])}const x=(f+Math.floor(w-1)*e)/2,S=_*x+o,$=y*x+l;n.push([S,$])}n.push([c,h])}}return cnt(t)?new os({rings:r,spatialReference:t.spatialReference}):new Ps({paths:r,spatialReference:t.spatialReference})}function Ope(t,e,i){if(e){const r=dnt(t,1e6);t=l3(r,!0)}return i&&(t=hEe(t,i)),t}function Ppe(t,e,i){if(Array.isArray(t)){const r=t[0];if(r>e){const s=rw(r,e);t[0]=r+s*(-2*e)}else if(r<i){const s=rw(r,i);t[0]=r+s*(-2*i)}}else{const r=t.x;if(r>e){const s=rw(r,e);t=t.clone().offset(s*(-2*e),0)}else if(r<i){const s=rw(r,i);t=t.clone().offset(s*(-2*i),0)}}return t}function pnt(t,e){let i=-1;for(let r=0;r<e.cutIndexes.length;r++){const s=e.cutIndexes[r],n=e.geometries[r],a=ZP(n);for(let o=0;o<a.length;o++){const l=a[o];l.some(c=>{if(c[0]<180)return!0;{let h=0;for(let y=0;y<l.length;y++){const _=l[y][0];h=_>h?_:h}h=Number(h.toFixed(9));const f=-360*rw(h,180);for(let y=0;y<l.length;y++){const _=n.getPoint(o,y);n.setPoint(o,y,_.clone().offset(f,0))}return!0}})}if(s===i){if(unt(t))for(const o of ZP(n))t[s]=t[s].addRing(o);else if(hnt(t))for(const o of ZP(n))t[s]=t[s].addPath(o)}else i=s,t[s]=n}return t}async function fnt(t,e,i){if(!Array.isArray(t))return fnt([t],e);e&&typeof e!="string"&&fEe().warn("normalizeCentralMeridian()","The url object is deprecated, use the url string instead");const r=typeof e=="string"?e:e?.url??fr.geometryServiceUrl;let s,n,a,o,l,c,h,f,y=0;const _=[],w=[];for(const P of t)if(P!=null)if(s||(s=P.spatialReference,n=Ru(s),a=s.isWebMercator,c=a?102100:4326,o=F5[c].maxX,l=F5[c].minX,h=F5[c].plus180Line,f=F5[c].minus180Line),n)if(P.type==="mesh")w.push(P);else if(P.type==="point")w.push(Ppe(P.clone(),o,l));else if(P.type==="multipoint"){const O=P.clone();O.points=O.points.map(D=>Ppe(D,o,l)),w.push(O)}else if(P.type==="extent"){const O=P.clone()._normalize(!1,!1,n);w.push(O.rings?new os(O):O)}else if(P.extent){const O=P.extent,D=rw(O.xmin,l)*(2*o);let L=D===0?P.clone():hEe(P.clone(),D);O.offset(D,0);let{xmin:F,xmax:U}=O;F=Number(F.toFixed(9)),U=Number(U.toFixed(9)),O.intersects(h)&&U!==o?(y=U>y?U:y,L=Ope(L,a),_.push(L),w.push("cut")):O.intersects(f)&&F!==l?(y=U*(2*o)>y?U*(2*o):y,L=Ope(L,a,360),_.push(L),w.push("cut")):w.push(L)}else w.push(P.clone());else w.push(P);else w.push(P);let x=rw(y,o),S=-90;const $=x,A=new Ps;for(;x>0;){const P=360*x-180;A.addPath([[P,S],[P,-1*S]]),S*=-1,x--}if(_.length>0&&$>0){const P=pnt(_,await ant(r,_,A,i)),O=[],D=[];for(let U=0;U<w.length;U++){const N=w[U];if(N!=="cut")D.push(N);else{const j=P.shift(),B=t[U];B!=null&&B.type==="polygon"&&B.rings&&B.rings.length>1&&j.rings.length>=B.rings.length?(O.push(j),D.push("simplify")):D.push(a?U_(j):j)}}if(!O.length)return D;const L=await lnt(r,O,i),F=[];for(let U=0;U<D.length;U++){const N=D[U];N!=="simplify"?F.push(N):F.push(a?U_(L.shift()):L.shift())}return F}const M=[];for(let P=0;P<w.length;P++){const O=w[P];if(O!=="cut")M.push(O);else{const D=_.shift();M.push(a===!0?U_(D):D)}}return M}function HBt(t,e,i){const r=Ru(i);if(r==null)return t;const[s,n]=r.valid,a=2*n;let o=0,l=0;e>n?o=Math.ceil(Math.abs(e-n)/a):e<s&&(o=-Math.ceil(Math.abs(e-s)/a)),t>n?l=Math.ceil(Math.abs(t-n)/a):t<s&&(l=-Math.ceil(Math.abs(t-s)/a));let c=t+(o-l)*a;const h=c-e;return h>n?c-=a:h<s&&(c+=a),c}function i8(t){const e=Ru(t);if(e==null)return null;const[i,r]=e.valid;return new sU(i,r)}const mEe=i8(Ie.WGS84),mnt=i8(Ie.WebMercator);function gEe(t,e,i){const r=Math.sin(t),s=Math.cos(t),n=Math.sin(e),a=Math.cos(e),o=i;return o[0]=-r,o[4]=-n*s,o[8]=a*s,o[12]=0,o[1]=s,o[5]=-n*r,o[9]=a*r,o[13]=0,o[2]=0,o[6]=a,o[10]=n,o[14]=0,o[3]=0,o[7]=0,o[11]=0,o[15]=1,o}function gnt(t,e,i){return gEe(t,e,i),Ql(i,i),i}function h4(t,e,i,r){const s=LTe(t,r);if(s==null)return!1;const n=s.source.spatialReferenceId,a=s.dest.spatialReferenceId;if(n===a&&!V7(a)&&(n!==0||fs(t,r)))return LU(i,e),!0;if(V7(a)){const l=tO[n][10],c=tO[10][a];return l!=null&&c!=null&&(l(e,0,b0,0),c(b0,0,w0,0),gEe(N5*b0[0],N5*b0[1],i),i[12]=w0[0],i[13]=w0[1],i[14]=w0[2],!0)}const o=V7(n);if((a===3||a===11||a===2||a===5)&&(n===2||o||n===3||n===5)){const l=tO[n][10],c=tO[10][a];return l!=null&&c!=null&&(l(e,0,b0,0),c(b0,0,w0,0),o?gnt(N5*b0[0],N5*b0[1],i):xp(i),i[12]=w0[0],i[13]=w0[1],i[14]=w0[2],!0)}return!1}function V7(t){return t===1||t===6||t===8||t===4}const N5=Lt(1),b0=R(),w0=R();function r8(t){return t?{ray:rn(t.ray),c0:t.c0,c1:t.c1}:{ray:rn(),c0:0,c1:Number.MAX_VALUE}}function ynt(t,e=r8()){return p6(t,e.ray),e.c0=0,e.c1=Number.MAX_VALUE,e}function _nt(t,e,i=r8()){const r=Le(t.vector);return Xee(t.origin,e,i.ray),i.c0=0,i.c1=r,i}function WBt(t,e){return yEe(t,t.c0,e)}function ZBt(t,e){return yEe(t,t.c1,e)}function yEe(t,e,i){return xe(i,t.ray.origin,le(i,t.ray.direction,e))}new Ay(()=>r8());function jte(t){return t?[Oi(t[0]),Oi(t[1]),Oi(t[2]),Oi(t[3]),Oi(t[4]),Oi(t[5])]:[Oi(),Oi(),Oi(),Oi(),Oi(),Oi()]}function _Ee(){return[R(),R(),R(),R(),R(),R(),R(),R()]}function vEe(t,e){for(let i=0;i<wM;i++)Wee(t[i],e[i]);return t}function bEe(t,e,i,r=Tnt){const s=an(Vee.get(),e,t);nl(s,s);for(let n=0;n<xnt;++n){const a=Dc(Nee.get(),Snt[n],s);ve(r[n],a[0]/a[3],a[1]/a[3],a[2]/a[3])}wEe(i,r)}function wEe(t,e){Su(e[4],e[0],e[3],t[0]),Su(e[1],e[5],e[6],t[1]),Su(e[4],e[5],e[1],t[2]),Su(e[3],e[2],e[6],t[3]),Su(e[0],e[1],e[2],t[4]),Su(e[5],e[4],e[7],t[5])}function D_(t,e){for(let i=0;i<wM;i++){const r=t[i];if(r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]>=e[3])return!1}return!0}function vnt(t,e){return SEe(t,ynt(e,TEe.get()))}function YBt(t,e){for(let i=0;i<wM;i++){const r=t[i];if(!uXe(r,e))return!1}return!0}function bnt(t,e,i){return SEe(t,_nt(e,i,TEe.get()))}function xEe(t,e){for(let i=0;i<wM;i++)if(va(t[i],e)>0)return!1;return!0}function SEe(t,e){for(let i=0;i<wM;i++)if(!cXe(t[i],e))return!1;return!0}const wnt={bottom:[5,1,0,4],near:[0,1,2,3],far:[5,4,7,6],right:[1,5,6,2],left:[4,0,3,7],top:[7,3,2,6]},wM=6,xnt=8,Snt=[fi(-1,-1,-1,1),fi(1,-1,-1,1),fi(1,1,-1,1),fi(-1,1,-1,1),fi(-1,-1,1,1),fi(1,-1,1,1),fi(1,1,1,1),fi(-1,1,1,1)],TEe=new Ay(r8),Tnt=_Ee();function $nt(t,e,i){return 2*Math.atan(Math.sqrt(e*e+i*i)*Math.tan(.5*t)/e)}function Cnt(t,e,i){return 2*Math.atan(Math.sqrt(e*e+i*i)*Math.tan(.5*t)/i)}function Mnt(t,e,i){return 2*Math.atan(e*Math.tan(.5*t)/Math.sqrt(e*e+i*i))}function Ent(t,e,i){return 2*Math.atan(i*Math.tan(.5*t)/Math.sqrt(e*e+i*i))}var hQ;let ni=hQ=class extends Me{constructor(t){super(t),this._ray=rn(),this._viewport=fi(0,0,1,1),this._padding=fi(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=vs(1,1e3),this._viewDirty=!0,this._viewMatrix=it(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=it(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=it(),this._frustumDirty=!0,this._frustum=jte(),this._fullViewport=ri(),this._pixelRatio=1,this.row=0,this.column=0,this._rows=1,this._columns=1,this._center=R(),this._up=R(),this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(t){this._pixelRatio=t>0?t:1}get rows(){return this._rows}set rows(t){this._rows=Math.max(1,t)}get columns(){return this._columns}set columns(t){this._columns=Math.max(1,t)}get eye(){return this._ray.origin}set eye(t){this._compareAndSetView(t,this._ray.origin)}get center(){return this._center}set center(t){this._compareAndSetView(t,this._center,"_center")}get ray(){return Ce(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(t){this._compareAndSetView(t,this._up,"_up")}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(t){pn(this._viewMatrix,t),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),ve(R(),-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10])}get viewUp(){return this._ensureViewClean(),ve(R(),this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9])}get viewRight(){return this._ensureViewClean(),ve(R(),this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8])}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(t){this._nearFar[0]!==t&&(this._nearFar[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(t){this._nearFar[1]!==t&&(this._nearFar[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(t){this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3]}get screenViewport(){if(this.pixelRatio===1)return this._viewport;const t=Cv(ri(),this._viewport,1/this.pixelRatio),e=this._get("screenViewport");return e&&GR(t,e)?e:t}get screenPadding(){if(this.pixelRatio===1)return this._padding;const t=Cv(ri(),this._padding,1/this.pixelRatio),e=this._get("screenPadding");return e&&GR(t,e)?e:t}get x(){return this._viewport[0]}set x(t){t+=this._padding[3],this._viewport[0]!==t&&(this._viewport[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(t){t+=this._padding[2],this._viewport[1]!==t&&(this._viewport[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(t){this._viewport[2]!==t&&(this._viewport[2]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(t){this._viewport[3]!==t&&(this._viewport[3]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[1]+this._padding[3]}set fullWidth(t){this.width=t-(this._padding[1]+this._padding[3])}get fullHeight(){return this._viewport[3]+this._padding[0]+this._padding[2]}set fullHeight(t){this.height=t-(this._padding[0]+this._padding[2])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[3],this._fullViewport[1]=this._viewport[1]-this._padding[2],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(t){ey(this._padding,t)||(this._viewport[0]+=t[3]-this._padding[3],this._viewport[1]+=t[2]-this._padding[2],this._viewport[2]-=t[1]+t[3]-(this._padding[1]+this._padding[3]),this._viewport[3]-=t[0]+t[2]-(this._padding[0]+this._padding[2]),jl(this._padding,t),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){return this._viewProjectionDirty&&(an(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){return this._projectionMatrixInternal}get inverseProjectionMatrix(){return nl(it(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||it()}get fov(){return this._fov}set fov(t){this._fov=t,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return Mnt(this._fov,this.width,this.height)}set fovX(t){this._fov=$nt(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return Ent(this._fov,this.width,this.height)}set fovY(t){this._fov=Cnt(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return Ri(this.center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(nl(this._viewInverseTransposeMatrix,this.viewMatrix),Ql(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(t){const{near:e,far:i}=this;return 2*e*i/(i+e-t*(i-e))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return this.relativeElevation!=null&&this.relativeElevation>=0}get _projectionMatrixInternal(){const t=this.width,e=this.height,i=this.near*Math.tan(this.fovY/2)*2,r=i*this._aspect,s=i/this.rows,n=r/this.columns,a=-r/2+this.column*n,o=a+n,l=-i/2+this.row*s,c=l+s,h=l3e(it(),a*(1+2*this._padding[3]/t),o*(1+2*this._padding[1]/t),l*(1+2*this._padding[2]/e),c*(1+2*this._padding[0]/e),this.near,this.far),f=this._get("projectionMatrix");return f&&Ree(f,h)?f:h}copyFrom(t){de(this._ray.origin,t.eye),this.center=t.center,this.up=t.up,jl(this._viewport,t.viewport),this.notifyChange("_viewport"),jl(this._padding,t.padding),this.notifyChange("_padding"),ko(this._nearFar,t.nearFar),this.notifyChange("_nearFar"),this._fov=t.fov,this.row=t.row,this.column=t.column,this.rows=t.rows,this.columns=t.columns,this.relativeElevation=t.relativeElevation;const e=t;return this._viewDirty=e._viewDirty,this._viewDirty||(pn(this._viewMatrix,t.viewMatrix),this.notifyChange("_viewMatrix")),this._viewProjectionDirty=!0,this._frustumDirty=e._frustumDirty,this._frustumDirty||(vEe(this._frustum,t.frustum),this._frustumDirty=!1),e._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(pn(this._viewInverseTransposeMatrix,t.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),jl(this._fullViewport,t.fullViewport),this.pixelRatio=t.pixelRatio,this}copyViewFrom(t){this.eye=t.eye,this.center=t.center,this.up=t.up,this.fov=t.fov}clone(){return new hQ().copyFrom(this)}equals(t){return si(this.eye,t.eye)&&si(this.center,t.center)&&si(this.up,t.up)&&ey(this._viewport,t.viewport)&&ey(this._padding,t.padding)&&e6(this.nearFar,t.nearFar)&&this._fov===t.fov&&this.pixelRatio===t.pixelRatio&&this.relativeElevation===t.relativeElevation&&this.row===t.row&&this.column===t.column&&this.rows===t.rows&&this.columns===t.columns}almostEquals(t){const e=Math.max(1,1/this.pixelRatio,1/t.pixelRatio);if(Math.abs(t.fov-this._fov)>=.001||d6(t.screenPadding,this.screenPadding)>=e||d6(this.screenViewport,t.screenViewport)>=e||this.row!==t.row||this.column!==t.column||this.rows!==t.rows||this.columns!==t.columns)return!1;ui(_n,t.eye,t.center),ui(jp,this.eye,this.center);const i=Oe(_n,jp),r=Gx(_n),s=Gx(jp),n=5e-4;return i*i>=(1-1e-10)*r*s&&AC(t.eye,this.eye)<Math.max(r,s)*n*n}computeRenderPixelSizeAt(t){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(t))}computeRenderPixelSizeAtDist(t){return t*this.perRenderPixelRatio}computeScreenPixelSizeAt(t){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(t))}_viewDirectionDistance(t){return Math.abs(q_(this.viewForward,Ce(_n,t,this.eye)))}computeScreenPixelSizeAtDist(t){return t*this.perScreenPixelRatio}computeDistanceFromRadius(t,e){return t/Math.tan(Math.min(this.fovX,this.fovY)/(2*(e||1)))}getScreenCenter(t=Gs()){return t[0]=(this.padding[3]+this.width/2)/this.pixelRatio,t[1]=(this.padding[0]+this.height/2)/this.pixelRatio,t}getRenderCenter(t,e=.5,i=.5){return t[0]=this.padding[3]+this.width*e,t[1]=this.padding[2]+this.height*i,t[2]=.5,t}setGLViewport(t){const e=this.viewport,i=this.padding;t.setViewport(e[0]-i[3],e[1]-i[2],e[2]+i[1]+i[3],e[3]+i[0]+i[2])}applyProjection(t,e){t!==wi&&de(wi,t),wi[3]=1,Dc(wi,wi,this.projectionMatrix);const i=Math.abs(wi[3]);le(wi,wi,1/i);const r=this.fullViewport;e[0]=ft(0,r[0]+r[2],.5+.5*wi[0]),e[1]=ft(0,r[1]+r[3],.5+.5*wi[1]),e[2]=.5*(wi[2]+1),e[3]=i}unapplyProjection(t,e){const i=this.fullViewport;wi[0]=(t[0]/(i[0]+i[2])*2-1)*t[3],wi[1]=(t[1]/(i[1]+i[3])*2-1)*t[3],wi[2]=(2*t[2]-1)*t[3],wi[3]=t[3],this.inverseProjectionMatrix!=null&&(Dc(wi,wi,this.inverseProjectionMatrix),e[0]=wi[0],e[1]=wi[1],e[2]=wi[2])}projectToScreen(t,e){return this.projectToRenderScreen(t,U7),this.renderToScreen(U7,e),e}projectToRenderScreen(t,e){if(wi[0]=t[0],wi[1]=t[1],wi[2]=t[2],wi[3]=1,Dc(wi,wi,this.viewProjectionMatrix),wi[3]===0)return null;const i=wi;le(i,i,1/Math.abs(wi[3]));const r=this.fullViewport,s=ft(0,r[0]+r[2],.5+.5*i[0]),n=ft(0,r[1]+r[3],.5+.5*i[1]);return"x"in e?(e.x=s,e.y=n):(e[0]=s,e[1]=n,e.length>2&&(e[2]=.5*(i[2]+1))),e}unprojectFromScreen(t,e){return this.unprojectFromRenderScreen(this.screenToRender(t,U7),e)}unprojectFromRenderScreen(t,e){if(an(V5,this.projectionMatrix,this.viewMatrix),!nl(V5,V5))return null;const i=this.fullViewport;return wi[0]=2*(t[0]-i[0])/i[2]-1,wi[1]=2*(t[1]-i[1])/i[3]-1,wi[2]=2*t[2]-1,wi[3]=1,Dc(wi,wi,V5),wi[3]===0?null:(e[0]=wi[0]/wi[3],e[1]=wi[1]/wi[3],e[2]=wi[2]/wi[3],e)}constrainWindowSize(t,e,i,r){const s=t*this.pixelRatio,n=e*this.pixelRatio,a=Math.max(s-i/2,0),o=Math.max(this.fullHeight-n-r/2,0),l=-Math.min(s-i/2,0),c=-Math.min(this.fullHeight-n-r/2,0),h=i-l- -Math.min(this.fullWidth-s-i/2,0),f=r-c- -Math.min(n-r/2,0);return[Math.round(a),Math.round(o),Math.round(h),Math.round(f)]}computeUp(t){t===1?this._computeUpGlobal():this._computeUpLocal()}screenToRender(t,e){const i=t[0]*this.pixelRatio,r=this.fullHeight-t[1]*this.pixelRatio;return e[0]=i,e[1]=r,e}renderToScreen(t,e){const i=t[0]/this.pixelRatio,r=(this.fullHeight-t[1])/this.pixelRatio;e[0]=i,e[1]=r}_computeUpGlobal(){Ce(_n,this.center,this.eye);const t=Le(this.center);t<1?si(this._up,py)&&(de(this._up,py),this._markViewDirty(),this.notifyChange("_up")):Math.abs(Oe(_n,this.center))>.9999*Le(_n)*t||(bt(jp,_n,this.center),bt(jp,jp,_n),Ee(jp,jp),si(this._up,jp)||(de(this._up,jp),this.notifyChange("_up"),this._markViewDirty()))}_computeUpLocal(){Hv(_n,this.eye,this.center),Math.abs(_n[2])<=.9999&&(le(_n,_n,_n[2]),ve(_n,-_n[0],-_n[1],1-_n[2]),Ee(_n,_n),si(this._up,_n)||(de(this._up,_n),this.notifyChange("_up"),this._markViewDirty()))}_compareAndSetView(t,e,i=""){typeof t[0]=="number"&&isFinite(t[0])&&typeof t[1]=="number"&&isFinite(t[1])&&typeof t[2]=="number"&&isFinite(t[2])?si(t,e)||(de(e,t),this._markViewDirty(),i.length&&this.notifyChange(i)):fe.getLogger("esri.views.3d.webgl-engine.lib.RenderCamera").warn("RenderCamera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&(bEe(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(kU(this._viewMatrix,this.eye,this.center,this.up),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};d([m()],ni.prototype,"_viewport",void 0),d([m()],ni.prototype,"_padding",void 0),d([m()],ni.prototype,"_fov",void 0),d([m()],ni.prototype,"_nearFar",void 0),d([m()],ni.prototype,"_viewDirty",void 0),d([m()],ni.prototype,"_viewMatrix",void 0),d([m()],ni.prototype,"_pixelRatio",void 0),d([m()],ni.prototype,"pixelRatio",null),d([m()],ni.prototype,"row",void 0),d([m()],ni.prototype,"column",void 0),d([m()],ni.prototype,"_rows",void 0),d([m()],ni.prototype,"rows",null),d([m()],ni.prototype,"_columns",void 0),d([m()],ni.prototype,"columns",null),d([m()],ni.prototype,"eye",null),d([m()],ni.prototype,"center",null),d([m()],ni.prototype,"_center",void 0),d([m()],ni.prototype,"up",null),d([m()],ni.prototype,"_up",void 0),d([m()],ni.prototype,"viewMatrix",null),d([m({readOnly:!0})],ni.prototype,"viewForward",null),d([m({readOnly:!0})],ni.prototype,"viewUp",null),d([m({readOnly:!0})],ni.prototype,"viewRight",null),d([m({readOnly:!0})],ni.prototype,"nearFar",null),d([m()],ni.prototype,"near",null),d([m()],ni.prototype,"far",null),d([m()],ni.prototype,"viewport",null),d([m({readOnly:!0})],ni.prototype,"screenViewport",null),d([m({readOnly:!0})],ni.prototype,"screenPadding",null),d([m()],ni.prototype,"x",null),d([m()],ni.prototype,"y",null),d([m()],ni.prototype,"width",null),d([m()],ni.prototype,"height",null),d([m()],ni.prototype,"fullWidth",null),d([m()],ni.prototype,"fullHeight",null),d([m({readOnly:!0})],ni.prototype,"_aspect",null),d([m()],ni.prototype,"padding",null),d([m({readOnly:!0})],ni.prototype,"projectionMatrix",null),d([m({readOnly:!0})],ni.prototype,"inverseProjectionMatrix",null),d([m()],ni.prototype,"fov",null),d([m()],ni.prototype,"fovX",null),d([m()],ni.prototype,"fovY",null),d([m()],ni.prototype,"viewInverseTransposeMatrix",null),d([m({readOnly:!0})],ni.prototype,"_projectionMatrixInternal",null),d([m()],ni.prototype,"relativeElevation",void 0),ni=hQ=d([k("esri.views.3d.webgl.RenderCamera")],ni);const nr=ni,wi=ri(),V5=it(),_n=R(),jp=R(),U7=zf();var Wg;let Ua=(Wg=class{constructor(e=1/0,i=-1/0){this.near=e,this.far=i}set(e,i){this.near=e,this.far=i}union(e){e!=null&&(this.near=Math.min(this.near,e.near),this.far=Math.max(this.far,e.far))}within(e){return this.near<=e&&e<=this.far}equals(e){return this.near===e.near&&this.far===e.far}},Wg.Zero=new Wg(0,0),Wg.Infinite=new Wg,Wg),G_=class{get ray(){return this._ray}get distanceInRenderSpace(){return this.distance==null?null:(le(U5,this.ray.direction,this.distance),Le(U5))}withinDistance(e){return!!Vu(this)&&this.distanceInRenderSpace<=e}getIntersectionPoint(e){return!!Vu(this)&&(le(U5,this.ray.direction,this.distance),xe(e,this.ray.origin,U5),!0)}getTransformedNormal(e){return de(HE,this.normal),HE[3]=0,Dc(HE,HE,this.transformation),de(e,HE),Ee(e,e)}constructor(e){this.intersector=4,this.normal=R(),this.transformation=it(),this._ray=rn(),this.init(e)}init(e){this.distance=this.target=this.drapedLayerOrder=this.renderPriority=null,this.intersector=4,p6(e,this._ray)}set(e,i,r,s,n,a,o){this.intersector=e,this.distance=r,de(this.normal,s??py),pn(this.transformation,n??Ro),this.target=i,this.drapedLayerOrder=a,this.renderPriority=o}copy(e){p6(e.ray,this._ray),this.intersector=e.intersector,this.distance=e.distance,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.renderPriority=e.renderPriority,de(this.normal,e.normal),pn(this.transformation,e.transformation)}};function Vu(t){return t?.distance!=null}const U5=R(),HE=ri();let Ant=class{constructor(e,i,r){this.object=e,this.geometryId=i,this.primitiveIndex=r}},dQ=class extends G_{constructor(){super(...arguments),this.intersector=1}},Ont=class extends Ant{constructor(e,i){super(e.object,e.geometryId,e.primitiveIndex),this.center=cr(i)}};function s8(t){return Vu(t)&&t.intersector===1&&!!t.target&&"center"in t.target}let Pnt=class{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.filteredLayerViewUids=[],this.store=2,this.normalRequired=!0,this.excludeLabels=!1}};function Rnt(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function S6(t,e,i){i*=.5;const r=Math.sin(i);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(i),t}function qte(t,e){const i=2*Math.acos(e[3]),r=Math.sin(i/2);return r>nn()?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=1,t[1]=0,t[2]=0),i}function n8(t,e,i){const r=e[0],s=e[1],n=e[2],a=e[3],o=i[0],l=i[1],c=i[2],h=i[3];return t[0]=r*h+a*o+s*c-n*l,t[1]=s*h+a*l+n*o-r*c,t[2]=n*h+a*c+r*l-s*o,t[3]=a*h-r*o-s*l-n*c,t}function Dnt(t,e,i){i*=.5;const r=e[0],s=e[1],n=e[2],a=e[3],o=Math.sin(i),l=Math.cos(i);return t[0]=r*l+a*o,t[1]=s*l+n*o,t[2]=n*l-s*o,t[3]=a*l-r*o,t}function Int(t,e,i){i*=.5;const r=e[0],s=e[1],n=e[2],a=e[3],o=Math.sin(i),l=Math.cos(i);return t[0]=r*l-n*o,t[1]=s*l+a*o,t[2]=n*l+r*o,t[3]=a*l-s*o,t}function Lnt(t,e,i){i*=.5;const r=e[0],s=e[1],n=e[2],a=e[3],o=Math.sin(i),l=Math.cos(i);return t[0]=r*l+s*o,t[1]=s*l-r*o,t[2]=n*l+a*o,t[3]=a*l-n*o,t}function knt(t,e){const i=e[0],r=e[1],s=e[2];return t[0]=i,t[1]=r,t[2]=s,t[3]=Math.sqrt(Math.abs(1-i*i-r*r-s*s)),t}function Bz(t,e,i,r){const s=e[0],n=e[1],a=e[2],o=e[3];let l,c,h,f,y,_=i[0],w=i[1],x=i[2],S=i[3];return c=s*_+n*w+a*x+o*S,c<0&&(c=-c,_=-_,w=-w,x=-x,S=-S),1-c>nn()?(l=Math.acos(c),h=Math.sin(l),f=Math.sin((1-r)*l)/h,y=Math.sin(r*l)/h):(f=1-r,y=r),t[0]=f*s+y*_,t[1]=f*n+y*w,t[2]=f*a+y*x,t[3]=f*o+y*S,t}function znt(t){const e=XD,i=e(),r=e(),s=e(),n=Math.sqrt(1-i),a=Math.sqrt(i);return t[0]=n*Math.sin(2*Math.PI*r),t[1]=n*Math.cos(2*Math.PI*r),t[2]=a*Math.sin(2*Math.PI*s),t[3]=a*Math.cos(2*Math.PI*s),t}function Fnt(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],a=i*i+r*r+s*s+n*n,o=a?1/a:0;return t[0]=-i*o,t[1]=-r*o,t[2]=-s*o,t[3]=n*o,t}function H_(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function $Ee(t,e){const i=e[0]+e[4]+e[8];let r;if(i>0)r=Math.sqrt(i+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{let s=0;e[4]>e[0]&&(s=1),e[8]>e[3*s+s]&&(s=2);const n=(s+1)%3,a=(s+2)%3;r=Math.sqrt(e[3*s+s]-e[3*n+n]-e[3*a+a]+1),t[s]=.5*r,r=.5/r,t[3]=(e[3*n+a]-e[3*a+n])*r,t[n]=(e[3*n+s]+e[3*s+n])*r,t[a]=(e[3*a+s]+e[3*s+a])*r}return t}function Nnt(t,e,i,r){const s=.5*Math.PI/180;e*=s,i*=s,r*=s;const n=Math.sin(e),a=Math.cos(e),o=Math.sin(i),l=Math.cos(i),c=Math.sin(r),h=Math.cos(r);return t[0]=n*l*h-a*o*c,t[1]=a*o*h+n*l*c,t[2]=a*l*c-n*o*h,t[3]=a*l*h+n*o*c,t}function Vnt(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}const Unt=jl,pQ=yr,Bnt=Uee,jnt=n8,qnt=Cv,Gnt=jee,Hnt=qee,CEe=Bee,Wnt=CEe,MEe=NU,Znt=MEe,Gte=k3e,Ynt=ey,Qnt=GR;function Xnt(t,e,i){const r=Oe(e,i);return r<-.999999?(bt(qp,Jnt,e),gu(qp)<1e-6&&bt(qp,Knt,e),Ee(qp,qp),S6(t,qp,Math.PI),t):r>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(bt(qp,e,i),t[0]=qp[0],t[1]=qp[1],t[2]=qp[2],t[3]=1+r,Gte(t,t))}const qp=R(),Jnt=Ge(1,0,0),Knt=Ge(0,1,0);function eat(t,e,i,r,s,n){return Bz(Rpe,e,s,n),Bz(Dpe,i,r,n),Bz(t,Rpe,Dpe,2*n*(1-n)),t}const Rpe=Kh(),Dpe=Kh();function tat(t,e,i,r){const s=iat;return s[0]=i[0],s[3]=i[1],s[6]=i[2],s[1]=r[0],s[4]=r[1],s[7]=r[2],s[2]=-e[0],s[5]=-e[1],s[8]=-e[2],Gte(t,$Ee(t,s))}const iat=Ir();Object.freeze(Object.defineProperty({__proto__:null,add:Bnt,calculateW:knt,conjugate:H_,copy:Unt,dot:Gnt,equals:Qnt,exactEquals:Ynt,fromEuler:Nnt,fromMat3:$Ee,getAxisAngle:qte,identity:Rnt,invert:Fnt,len:Wnt,length:CEe,lerp:Hnt,mul:jnt,multiply:n8,normalize:Gte,random:znt,rotateX:Dnt,rotateY:Int,rotateZ:Lnt,rotationTo:Xnt,scale:qnt,set:pQ,setAxes:tat,setAxisAngle:S6,slerp:Bz,sqlerp:eat,sqrLen:Znt,squaredLength:MEe,str:Vnt},Symbol.toStringTag,{value:"Module"}));let d4=class{constructor(e,i,r=i){this.data=e,this.size=i,this.stride=r}},Si=class extends d4{constructor(e,i,r,s=!1,n=r){super(e,r,n),this.indices=i,this.exclusive=s}};const zC=1e-6,WE=R(),B5=R();function rat(t,e){const{data:i,size:r}=t,s=i.length/r;if(s<=0)return;const n=new pat(t);mQ(WE,n.minProj,n.maxProj),xO(WE,WE,.5),zh(B5,n.maxProj,n.minProj);const a=fQ(B5),o=new fat;o.quality=a,s<14&&(t=new d4(new Float64Array(n.buffer,112,42),3));const l=R(),c=R(),h=R(),f=R(),y=R(),_=R(),w=R();switch(sat(n,t,w,l,c,h,f,y,_,o)){case 1:return void zpe(WE,B5,e);case 2:return void hat(t,f,e)}nat(t,w,l,c,h,f,y,_,o),EEe(t,o.b0,o.b1,o.b2,a$,o$);const x=R();zh(x,o$,a$),o.quality=fQ(x),o.quality<a?AEe(o.b0,o.b1,o.b2,a$,o$,x,e):zpe(WE,B5,e)}function sat(t,e,i,r,s,n,a,o,l,c){return aat(t,r,s),gQ(r,s)<zC?1:(zh(a,r,s),io(a,a),oat(e,r,a,n)<zC?2:(zh(o,s,n),io(o,o),zh(l,n,r),io(l,l),Fh(i,o,a),io(i,i),pb(e,i,a,o,l,c),0))}const ZE=R(),YE=R(),rh=R(),sh=R(),nh=R(),x0=R(),S0=R(),T0=R();function nat(t,e,i,r,s,n,a,o,l){lat(t,e,i,ZE,YE),ZE[0]!==void 0&&(zh(rh,ZE,i),io(rh,rh),zh(sh,ZE,r),io(sh,sh),zh(nh,ZE,s),io(nh,nh),Fh(x0,sh,n),io(x0,x0),Fh(S0,nh,a),io(S0,S0),Fh(T0,rh,o),io(T0,T0),pb(t,x0,n,sh,rh,l),pb(t,S0,a,nh,sh,l),pb(t,T0,o,rh,nh,l)),YE[0]!==void 0&&(zh(rh,YE,i),io(rh,rh),zh(sh,YE,r),io(sh,sh),zh(nh,YE,s),io(nh,nh),Fh(x0,sh,n),io(x0,x0),Fh(S0,nh,a),io(S0,S0),Fh(T0,rh,o),io(T0,T0),pb(t,x0,n,sh,rh,l),pb(t,S0,a,nh,sh,l),pb(t,T0,o,rh,nh,l))}function aat(t,e,i){let r=gQ(t.maxVert[0],t.minVert[0]),s=0;for(let n=1;n<7;++n){const a=gQ(t.maxVert[n],t.minVert[n]);a>r&&(r=a,s=n)}Ou(e,t.minVert[s]),Ou(i,t.maxVert[s])}const ah=[0,0,0];function oat(t,e,i,r){const{data:s,size:n}=t;let a=Number.NEGATIVE_INFINITY,o=0;for(let l=0;l<s.length;l+=n){ah[0]=s[l]-e[0],ah[1]=s[l+1]-e[1],ah[2]=s[l+2]-e[2];const c=i[0]*ah[0]+i[1]*ah[1]+i[2]*ah[2],h=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],f=ah[0]*ah[0]+ah[1]*ah[1]+ah[2]*ah[2]-c*c/h;f>a&&(a=f,o=l)}return Ou(r,s,o),a}const Wn=pt();function lat(t,e,i,r,s){uat(t,e,Wn,s,r);const n=PEe(i,e);Wn[1]-zC<=n&&(r[0]=void 0),Wn[0]+zC>=n&&(s[0]=void 0)}const Ipe=R(),Lpe=R(),kpe=R(),gS=R(),yS=R(),j5=R();function pb(t,e,i,r,s,n){if(OEe(e)<zC)return;Fh(Ipe,i,e),Fh(Lpe,r,e),Fh(kpe,s,e),n$(t,e,Wn),yS[1]=Wn[0],gS[1]=Wn[1],j5[1]=gS[1]-yS[1];const a=[i,r,s],o=[Ipe,Lpe,kpe];for(let l=0;l<3;++l){n$(t,a[l],Wn),yS[0]=Wn[0],gS[0]=Wn[1],n$(t,o[l],Wn),yS[2]=Wn[0],gS[2]=Wn[1],j5[0]=gS[0]-yS[0],j5[2]=gS[2]-yS[2];const c=fQ(j5);c<n.quality&&(Ou(n.b0,a[l]),Ou(n.b1,e),Ou(n.b2,o[l]),n.quality=c)}}const cat=R();function n$(t,e,i){const{data:r,size:s}=t;i[0]=Number.POSITIVE_INFINITY,i[1]=Number.NEGATIVE_INFINITY;for(let n=0;n<r.length;n+=s){const a=r[n]*e[0]+r[n+1]*e[1]+r[n+2]*e[2];i[0]=Math.min(i[0],a),i[1]=Math.max(i[1],a)}}function uat(t,e,i,r,s){const{data:n,size:a}=t;Ou(r,n),Ou(s,r),i[0]=PEe(cat,e),i[1]=i[0];for(let o=a;o<n.length;o+=a){const l=n[o]*e[0]+n[o+1]*e[1]+n[o+2]*e[2];l<i[0]&&(i[0]=l,Ou(r,n,o)),l>i[1]&&(i[1]=l,Ou(s,n,o))}}function zpe(t,e,i){i.center=t,i.halfSize=le(e,e,.5),i.quaternion=kee}const Em=R(),_S=R(),QE=R(),a$=R(),o$=R(),Fpe=R();function hat(t,e,i){Ou(Em,e),Math.abs(e[0])>Math.abs(e[1])&&Math.abs(e[0])>Math.abs(e[2])?Em[0]=0:Math.abs(e[1])>Math.abs(e[2])?Em[1]=0:Em[2]=0,OEe(Em)<zC&&(Em[0]=Em[1]=Em[2]=1),Fh(_S,e,Em),io(_S,_S),Fh(QE,e,_S),io(QE,QE),EEe(t,e,_S,QE,a$,o$),zh(Fpe,o$,a$),AEe(e,_S,QE,a$,o$,Fpe,i)}function EEe(t,e,i,r,s,n){n$(t,e,Wn),s[0]=Wn[0],n[0]=Wn[1],n$(t,i,Wn),s[1]=Wn[0],n[1]=Wn[1],n$(t,r,Wn),s[2]=Wn[0],n[2]=Wn[1]}const x1=R(),XE=R(),q5=R(),Gp=C2e(1,0,0,0,1,0,0,0,1),dat=Kh();function AEe(t,e,i,r,s,n,a){Gp[0]=t[0],Gp[1]=t[1],Gp[2]=t[2],Gp[3]=e[0],Gp[4]=e[1],Gp[5]=e[2],Gp[6]=i[0],Gp[7]=i[1],Gp[8]=i[2],a.quaternion=mat(dat,Gp),mQ(x1,r,s),xO(x1,x1,.5),xO(XE,t,x1[0]),xO(q5,e,x1[1]),mQ(XE,XE,q5),xO(q5,i,x1[2]),a.center=xe(XE,XE,q5),a.halfSize=le(x1,n,.5)}const Jc=7;let pat=class{constructor(e){this.minVert=new Array(Jc),this.maxVert=new Array(Jc);const i=64*Jc;this.buffer=new ArrayBuffer(i);let r=0;this.minProj=new Float64Array(this.buffer,r,Jc),r+=8*Jc,this.maxProj=new Float64Array(this.buffer,r,Jc),r+=8*Jc;for(let l=0;l<Jc;++l)this.minVert[l]=new Float64Array(this.buffer,r,3),r+=24;for(let l=0;l<Jc;++l)this.maxVert[l]=new Float64Array(this.buffer,r,3),r+=24;for(let l=0;l<Jc;++l)this.minProj[l]=Number.POSITIVE_INFINITY,this.maxProj[l]=Number.NEGATIVE_INFINITY;const s=new Array(Jc),n=new Array(Jc),{data:a,size:o}=e;for(let l=0;l<a.length;l+=o){let c=a[l];c<this.minProj[0]&&(this.minProj[0]=c,s[0]=l),c>this.maxProj[0]&&(this.maxProj[0]=c,n[0]=l),c=a[l+1],c<this.minProj[1]&&(this.minProj[1]=c,s[1]=l),c>this.maxProj[1]&&(this.maxProj[1]=c,n[1]=l),c=a[l+2],c<this.minProj[2]&&(this.minProj[2]=c,s[2]=l),c>this.maxProj[2]&&(this.maxProj[2]=c,n[2]=l),c=a[l]+a[l+1]+a[l+2],c<this.minProj[3]&&(this.minProj[3]=c,s[3]=l),c>this.maxProj[3]&&(this.maxProj[3]=c,n[3]=l),c=a[l]+a[l+1]-a[l+2],c<this.minProj[4]&&(this.minProj[4]=c,s[4]=l),c>this.maxProj[4]&&(this.maxProj[4]=c,n[4]=l),c=a[l]-a[l+1]+a[l+2],c<this.minProj[5]&&(this.minProj[5]=c,s[5]=l),c>this.maxProj[5]&&(this.maxProj[5]=c,n[5]=l),c=a[l]-a[l+1]-a[l+2],c<this.minProj[6]&&(this.minProj[6]=c,s[6]=l),c>this.maxProj[6]&&(this.maxProj[6]=c,n[6]=l)}for(let l=0;l<Jc;++l){let c=s[l];Ou(this.minVert[l],a,c),c=n[l],Ou(this.maxVert[l],a,c)}}},fat=class{constructor(){this.b0=Ge(1,0,0),this.b1=Ge(0,1,0),this.b2=Ge(0,0,1),this.quality=0}};function fQ(t){return t[0]*t[1]+t[0]*t[2]+t[1]*t[2]}function mQ(t,e,i){t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2]}function zh(t,e,i){t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2]}function xO(t,e,i){t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i}function Ou(t,e,i=0){t[0]=e[i],t[1]=e[i+1],t[2]=e[i+2]}function Fh(t,e,i){const r=e[0],s=e[1],n=e[2],a=i[0],o=i[1],l=i[2];t[0]=s*l-n*o,t[1]=n*a-r*l,t[2]=r*o-s*a}function io(t,e){const i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];if(i>0){const r=1/Math.sqrt(i);t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r}}function OEe(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]}function gQ(t,e){const i=e[0]-t[0],r=e[1]-t[1],s=e[2]-t[2];return i*i+r*r+s*s}function PEe(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function mat(t,e){const i=e[0]+e[4]+e[8];if(i>0){let r=Math.sqrt(i+1);t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r}else{let r=0;e[4]>e[0]&&(r=1),e[8]>e[3*r+r]&&(r=2);const s=(r+1)%3,n=(r+2)%3;let a=Math.sqrt(e[3*r+r]-e[3*s+s]-e[3*n+n]+1);t[r]=.5*a,a=.5/a,t[3]=(e[3*s+n]-e[3*n+s])*a,t[s]=(e[3*s+r]+e[3*r+s])*a,t[n]=(e[3*n+r]+e[3*r+n])*a}return t}let REe=class jz{constructor(e=Kn,i=$at,r=kee){this._data=[e[0],e[1],e[2],i[0],i[1],i[2],r[0],r[1],r[2],r[3]]}clone(){return jz.fromData(this._data)}invalidate(){this._data[3]=-1}get isValid(){return this._data[3]>=0}static fromData(e){const i=new jz;return i._copyFromData(e),i}static fromJSON(e){return new jz(e.center,e.halfSize,e.quaternion)}copy(e){this._copyFromData(e.data)}_copyFromData(e){for(let i=0;i<10;++i)this._data[i]=e[i]}get center(){return ve(Ze.get(),this._data[0],this._data[1],this._data[2])}get centerX(){return this._data[0]}get centerY(){return this._data[1]}get centerZ(){return this._data[2]}getCenter(e){return e[0]=this._data[0],e[1]=this._data[1],e[2]=this._data[2],e}set center(e){this._data[0]=e[0],this._data[1]=e[1],this._data[2]=e[2]}setCenter(e,i,r){this._data[0]=e,this._data[1]=i,this._data[2]=r}get halfSize(){return ve(Ze.get(),this._data[3],this._data[4],this._data[5])}get halfSizeX(){return this._data[3]}get halfSizeY(){return this._data[4]}get halfSizeZ(){return this._data[5]}getHalfSize(e){return e[0]=this._data[3],e[1]=this._data[4],e[2]=this._data[5],e}set halfSize(e){this._data[3]=e[0],this._data[4]=e[1],this._data[5]=e[2]}get quaternion(){return pQ(LQe.get(),this._data[6],this._data[7],this._data[8],this._data[9])}getQuaternion(e){return e[0]=this._data[6],e[1]=this._data[7],e[2]=this._data[8],e[3]=this._data[9],e}set quaternion(e){this._data[6]=e[0],this._data[7]=e[1],this._data[8]=e[2],this._data[9]=e[3]}get data(){return this._data}getCorners(e){const i=this._data,r=pQ(ts,i[6],i[7],i[8],i[9]);for(let s=0;s<8;++s){const n=e[s];n[0]=(1&s?-1:1)*i[3],n[1]=(2&s?-1:1)*i[4],n[2]=(4&s?-1:1)*i[5],Tc(n,n,r),n[0]+=i[0],n[1]+=i[1],n[2]+=i[2]}}doesIntersectFrustumConservativeApproximation(e){return this.intersectPlane(e[0])<=0&&this.intersectPlane(e[1])<=0&&this.intersectPlane(e[2])<=0&&this.intersectPlane(e[3])<=0&&this.intersectPlane(e[4])<=0&&this.intersectPlane(e[5])<=0}get radius(){const e=this._data[3],i=this._data[4],r=this._data[5];return Math.sqrt(e*e+i*i+r*r)}intersectSphere(e){ai[0]=this._data[0]-e[0],ai[1]=this._data[1]-e[1],ai[2]=this._data[2]-e[2];const i=this.getQuaternion(Fg);return H_(ts,i),Tc(ai,ai,ts),EC(ai,ai),Am[0]=Math.min(ai[0],this._data[3]),Am[1]=Math.min(ai[1],this._data[4]),Am[2]=Math.min(ai[2],this._data[5]),AC(Am,ai)<e[3]*e[3]}intersectSphereWithMBS(e,i=this.radius){const r=this._data;ai[0]=r[0]-e[0],ai[1]=r[1]-e[1],ai[2]=r[2]-e[2];const s=e[3],n=s+i;return!(Gx(ai)>n*n)&&(ts[0]=-r[6],ts[1]=-r[7],ts[2]=-r[8],ts[3]=r[9],Tc(ai,ai,ts),EC(ai,ai),Am[0]=Math.min(ai[0],r[3]),Am[1]=Math.min(ai[1],r[4]),Am[2]=Math.min(ai[2],r[5]),AC(Am,ai)<s*s)}intersectPlane(e){const i=e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3],r=this.projectedRadius(e);return i>r?1:i<-r?-1:0}intersectRay(e,i,r=0){const s=this._data,n=ts;n[0]=-s[6],n[1]=-s[7],n[2]=-s[8],n[3]=s[9],ai[0]=e[0]-s[0],ai[1]=e[1]-s[1],ai[2]=e[2]-s[2];const a=Tc(ai,ai,ts),o=Tc(Am,i,ts);let l=-1/0,c=1/0;const h=this.getHalfSize(l$);for(let f=0;f<3;f++){const y=a[f],_=o[f],w=h[f]+r;if(Math.abs(_)>1e-6){const x=(w-y)/_,S=(-w-y)/_;l=Math.max(l,Math.min(x,S)),c=Math.min(c,Math.max(x,S))}else if(y>w||y<-w)return!1}return l<=c}projectedArea(e,i,r,s){const n=this.getQuaternion(Fg);H_(ts,n),ai[0]=e[0]-this._data[0],ai[1]=e[1]-this._data[1],ai[2]=e[2]-this._data[2],Tc(ai,ai,ts);const a=this.getHalfSize(l$),o=ai[0]<-a[0]?-1:ai[0]>a[0]?1:0,l=ai[1]<-a[1]?-1:ai[1]>a[1]?1:0,c=ai[2]<-a[2]?-1:ai[2]>a[2]?1:0,h=Math.abs(o)+Math.abs(l)+Math.abs(c);if(h===0)return 1/0;const f=h===1?4:6,y=6*(o+3*l+9*c+13);kR(bT,n),KD(bT,bT,a);const _=this.getCenter(Kd);for(let S=0;S<f;S++){const $=_at[y+S];ve(ai,((1&$)<<1)-1,(2&$)-1,((4&$)>>1)-1),rl(ai,ai,bT),xe(S1,_,ai),S1[3]=1,Dc(S1,S1,i);const A=1/Math.max(1e-6,S1[3]);vd[2*S]=S1[0]*A,vd[2*S+1]=S1[1]*A}const w=2*f-2;let x=vd[0]*(vd[3]-vd[w+1])+vd[w]*(vd[1]-vd[w-1]);for(let S=2;S<w;S+=2)x+=vd[S]*(vd[S+3]-vd[S-1]);return Math.abs(x)*r*s*.125}projectedRadius(e){const i=this.getQuaternion(Fg);return H_(ts,i),Tc(ai,e,ts),Math.abs(ai[0]*this._data[3])+Math.abs(ai[1]*this._data[4])+Math.abs(ai[2]*this._data[5])}minimumDistancePlane(e){return e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3]-this.projectedRadius(e)}maximumDistancePlane(e){return e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3]+this.projectedRadius(e)}toAaBoundingBox(e){const i=this.getQuaternion(Fg),r=kR(bT,i),s=this._data[3]*Math.abs(r[0])+this._data[4]*Math.abs(r[3])+this._data[5]*Math.abs(r[6]),n=this._data[3]*Math.abs(r[1])+this._data[4]*Math.abs(r[4])+this._data[5]*Math.abs(r[7]),a=this._data[3]*Math.abs(r[2])+this._data[4]*Math.abs(r[5])+this._data[5]*Math.abs(r[8]);e[0]=this._data[0]-s,e[1]=this._data[1]-n,e[2]=this._data[2]-a,e[3]=this._data[0]+s,e[4]=this._data[1]+n,e[5]=this._data[2]+a}transform(e,i,r,s=0,n=Sv(r),a=Sv(i),o=jx(i,a)){if(r===n)i.isGeographic?xat(this,e,i,s,a):wat(this,e,i,s,a,o);else if(i.isWGS84&&(r.isWebMercator||DR(r)))vat(i,this,r,e,s);else if(i.isWebMercator&&DR(r))bat(i,this,r,e,s);else{const l=this.getCenter(Kd);l[2]+=s,Aa(l,i,0,l,r,0),e.center=l,this!==e&&(e.quaternion=this.getQuaternion(Fg),e.halfSize=this.getHalfSize(l$))}}};const ts=Kh(),Fg=Kh(),gat=Kh(),ai=R(),Am=R(),S1=ri();function yat(t,e=new REe){return rat(t,e),e}const vd=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2],_at=(()=>{const t=new Int8Array(162);let e=0;const i=r=>{for(let s=0;s<r.length;s++)t[e+s]=r[s];e+=6};return i([6,2,3,1,5,4]),i([0,2,3,1,5,4]),i([0,2,3,7,5,4]),i([0,1,3,2,6,4]),i([0,1,3,2,0,0]),i([0,1,5,7,3,2]),i([0,1,3,7,6,4]),i([0,1,3,7,6,2]),i([0,1,5,7,6,2]),i([0,1,5,4,6,2]),i([0,1,5,4,0,0]),i([0,1,3,7,5,4]),i([0,2,6,4,0,0]),i([0,0,0,0,0,0]),i([1,3,7,5,0,0]),i([2,3,7,6,4,0]),i([2,3,7,6,0,0]),i([2,3,1,5,7,6]),i([0,1,5,7,6,2]),i([0,1,5,7,6,4]),i([0,1,3,7,6,4]),i([4,5,7,6,2,0]),i([4,5,7,6,0,0]),i([4,5,1,3,7,6]),i([0,2,3,7,5,4]),i([6,2,3,7,5,4]),i([6,2,3,1,5,4]),t})();function DEe(t,e,i,r,s){const n=t.getQuaternion(Fg);s.quaternion=n,H_(ts,n);const a=t.getCenter(Kd),o=t.getHalfSize(l$);if(r===1){Tc(Rr,a,ts),EC(qd,Rr),g3e(eu,qd,o),ui(eu,qd,eu);const l=Le(eu);xe(eu,qd,o);const c=Le(eu);if(l<i)s.center=a,ve(Rr,i,i,i),s.halfSize=xe(Rr,o,Rr);else{const h=c>0?1+e/c:1,f=l>0?1+i/l:1,y=(f+h)/2,_=(f-h)/2;le(eu,qd,_),s.halfSize=Tr(eu,eu,o,y),le(eu,qd,y),Tr(eu,eu,o,_),m3e(Rr,Rr),Iee(Rr,eu,Rr);const w=t.getQuaternion(gat);s.center=Tc(Rr,Rr,w)}}else{s.center=Tr(Rr,a,py,(i+e)/2);const l=Tc(Rr,py,ts);EC(l,l),s.halfSize=Tr(qd,o,l,(i-e)/2)}return s}function vat(t,e,i,r,s){e.getCenter(Kd),Kd[2]+=s;const n=Sv(i);Aa(Kd,t,0,Kd,n,0),IEe(n,e,Kd,i,r)}function bat(t,e,i,r,s){e.getCenter(Kd),Kd[2]+=s,IEe(t,e,Kd,i,r)}function IEe(t,e,i,r,s){const n=e.getQuaternion(Fg),a=kR(bT,n),o=e.getHalfSize(l$);for(let l=0;l<8;++l){for(let c=0;c<3;++c)Pf[c]=o[c]*(l&1<<c?-1:1);for(let c=0;c<3;++c){let h=i[c];for(let f=0;f<3;++f)h+=Pf[f]*a[3*f+c];qz[3*l+c]=h}}Aa(qz,t,0,qz,r,0,8),yat(Sat,s)}function wat(t,e,i,r,s=Sv(i),n=jx(i,s)){t.getCorners(Npe),t.getCenter(Pf),Pf[2]+=r,h4(i,Pf,Kc,s),e.setCenter(Kc[12],Kc[13],Kc[14]);const a=2*Math.sqrt(1+Kc[0]+Kc[5]+Kc[10]);ts[0]=(Kc[6]-Kc[9])/a,ts[1]=(Kc[8]-Kc[2])/a,ts[2]=(Kc[1]-Kc[4])/a,ts[3]=.25*a;const o=t.getQuaternion(Fg);e.quaternion=n8(ts,ts,o),H_(ts,ts),ve(qd,0,0,0);const l=e.getCenter(Tat);for(const c of Npe)c[2]+=r,n(c,0,c,0),ui(Rr,c,l),Tc(Rr,Rr,ts),EC(Rr,Rr),y3e(qd,qd,Rr);e.halfSize=qd}function xat(t,e,i,r,s=Sv(i)){const n=or(i),a=1+Math.max(0,r)/(n.radius+t.centerZ);t.getCenter(Pf),Pf[2]+=r,Aa(Pf,i,0,Pf,s,0),e.center=Pf;const o=t.getQuaternion(Fg);e.quaternion=o,H_(ts,o),ve(Rr,0,0,1),Tc(Rr,Rr,ts);const l=t.getHalfSize(l$);ve(Rr,l[0]*Math.abs(Rr[0]),l[1]*Math.abs(Rr[1]),l[2]*Math.abs(Rr[2])),le(Rr,Rr,n.inverseFlattening),xe(Rr,l,Rr),e.halfSize=le(Rr,Rr,a)}const qz=new Array(24),Sat=new d4(qz,3),Pf=R(),Kd=R(),Tat=R(),l$=R(),bT=Ir(),Kc=it(),Npe=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],Rr=R(),qd=R(),eu=R(),$at=bv(-1,-1,-1);function njt(t){return Array.from(t)}let Cat=class{constructor(){this._transform=it(),this._transformInverse=new G5({value:this._transform},nl,it),this._transformInverseTranspose=new G5(this._transformInverse,Ql,it),this._transformTranspose=new G5({value:this._transform},Ql,it),this._transformInverseRotation=new G5({value:this._transform},x2e,Ir)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(e){pn(this._transform,e)}multiplyTransform(e){an(this._transform,this._transform,e)}set(e){pn(this._transform,e),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(e,i){this.setTransformMatrix(e),this.multiplyTransform(i),this._invalidateLazyTransforms()}},G5=class{constructor(e,i,r){this._original=e,this._update=i,this._dirty=!0,this._transform=r()}invalidate(){this._dirty=!0}get value(){return this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1),this._transform}},Mat=class{constructor(e=0){this.offset=e,this.tmpVertex=R()}applyToVertex(e,i,r){const s=ve(Hte,e,i,r),n=xe(LEe,s,this.localOrigin),a=this.offset/Le(n);return Tr(this.tmpVertex,s,n,a),this.tmpVertex}applyToAabb(e){const i=Pat,r=Rat,s=Dat;for(let l=0;l<3;++l)i[l]=e[0+l]+this.localOrigin[l],r[l]=e[3+l]+this.localOrigin[l],s[l]=i[l];const n=this.applyToVertex(i[0],i[1],i[2]);for(let l=0;l<3;++l)e[l]=n[l],e[l+3]=n[l];const a=l=>{const c=this.applyToVertex(l[0],l[1],l[2]);for(let h=0;h<3;++h)e[h]=Math.min(e[h],c[h]),e[h+3]=Math.max(e[h+3],c[h])};for(let l=1;l<8;++l){for(let c=0;c<3;++c)s[c]=l&1<<c?r[c]:i[c];a(s)}let o=0;for(let l=0;l<3;++l)i[l]*r[l]<0&&(o|=1<<l);if(o!==0&&o!==7){for(let l=0;l<8;++l)if((o&l)===0){for(let c=0;c<3;++c)s[c]=o&1<<c?0:l&1<<c?i[c]:r[c];a(s)}}for(let l=0;l<3;++l)e[l]-=this.localOrigin[l],e[l+3]-=this.localOrigin[l];return e}},Eat=class{constructor(e=0){this.componentLocalOriginLength=0,this._totalOffset=0,this._offset=0,this._tmpVertex=R(),this._tmpMbs=ms(),this._tmpObb=new REe,this._resetOffset(e)}_resetOffset(e){this._offset=e,this._totalOffset=e}set offset(e){this._resetOffset(e)}get offset(){return this._offset}set componentOffset(e){this._totalOffset=this._offset+e}set localOrigin(e){this.componentLocalOriginLength=Le(e)}applyToVertex(e,i,r){const s=ve(Hte,e,i,r),n=ve(LEe,e,i,r+this.componentLocalOriginLength),a=this._totalOffset/Le(n);return Tr(this._tmpVertex,s,n,a),this._tmpVertex}applyToAabb(e){const i=this.componentLocalOriginLength,r=e[0],s=e[1],n=e[2]+i,a=e[3],o=e[4],l=e[5]+i,c=Math.abs(r),h=Math.abs(s),f=Math.abs(n),y=Math.abs(a),_=Math.abs(o),w=Math.abs(l),x=.5*(1+Math.sign(r*a))*Math.min(c,y),S=.5*(1+Math.sign(s*o))*Math.min(h,_),$=.5*(1+Math.sign(n*l))*Math.min(f,w),A=Math.max(c,y),M=Math.max(h,_),P=Math.max(f,w),O=Math.sqrt(x*x+S*S+$*$),D=Math.sign(c+r),L=Math.sign(h+s),F=Math.sign(f+n),U=Math.sign(y+a),N=Math.sign(_+o),j=Math.sign(w+l),B=this._totalOffset;if(O<B)return e[0]-=(1-D)*B,e[1]-=(1-L)*B,e[2]-=(1-F)*B,e[3]+=U*B,e[4]+=N*B,e[5]+=j*B,e;const Y=B/Math.sqrt(A*A+M*M+P*P),G=B/O,Z=G-Y,H=-Z;return e[0]+=r*(D*H+G),e[1]+=s*(L*H+G),e[2]+=n*(F*H+G),e[3]+=a*(U*Z+Y),e[4]+=o*(N*Z+Y),e[5]+=l*(j*Z+Y),e}applyToMbs(e){const i=Ti(e),r=Le(i),s=this._totalOffset/r,n=Tr(kEe,i,i,s),a=e[3]+e[3]*this._totalOffset/r;return yM(this._tmpMbs,n,a),this._tmpMbs}applyToObb(e){return DEe(e,this._totalOffset,this._totalOffset,1,this._tmpObb),this._tmpObb}},Aat=class{constructor(e=0){this.offset=e,this.sphere=ms(),this.tmpVertex=R()}applyToVertex(e,i,r){const s=this.objectTransform.transform,n=ve(Hte,e,i,r),a=Mt(n,n,s),o=this.offset/Le(a);Tr(a,a,a,o);const l=this.objectTransform.inverse;return Mt(this.tmpVertex,a,l),this.tmpVertex}applyToMinMax(e,i){const r=this.offset/Le(e);Tr(e,e,e,r);const s=this.offset/Le(i);Tr(i,i,i,s)}applyToAabb(e){const i=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*i,e[1]+=e[1]*i,e[2]+=e[2]*i;const r=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*r,e[4]+=e[4]*r,e[5]+=e[5]*r,e}applyToBoundingSphere(e){const i=Ti(e),r=Le(i),s=this.offset/r,n=Tr(kEe,i,i,s),a=e[3]+e[3]*this.offset/r;return yM(this.sphere,n,a),this.sphere}};const Vpe=new Aat;function yQ(t){return t!=null?(Vpe.offset=t,Vpe):null}const Upe=new Eat;function Bpe(t){return t!=null?(Upe.offset=t,Upe):null}const jpe=new Mat;function Oat(t){return t!=null?(jpe.offset=t,jpe):null}const Av="terrain",Hte=R(),LEe=R(),Pat=R(),Rat=R(),Dat=R(),kEe=R(),FC=1e-5;let Vc=class{constructor(e){this.options=new Pnt,this._results=new Iat,this.transform=new Cat,this.camera=new nr,this.tolerance=FC,this.verticalOffset=null,this._ray=rn(),this._rayEnd=R(),this._rayBeginTransformed=R(),this._rayEndTransformed=R(),this.viewingMode=e??1}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(e,i,r){this.resetWithRay(Qee(e,i,this._ray),r)}resetWithRay(e,i){this.camera=i,e!==this._ray&&p6(e,this._ray),this.options.verticalOffset!==0?this.viewingMode===2?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,xe(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(e=null,i,r,s,n){this.point=i,this.filterPredicate=s,this.tolerance=r??FC;const a=yQ(this.verticalOffset);if(e&&e.length>0){const o=n?l=>{n(l)&&this.intersectObject(l)}:l=>{this.intersectObject(l)};for(const l of e){const c=l.getSpatialQueryAccelerator?.();c!=null?(a!=null?c.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,o,a):c.forEachAlongRay(this._ray.origin,this._ray.direction,o),this.options.selectionMode&&this.options.hud&&c.forEachDegenerateObject(o)):l.objects.forEach(h=>o(h))}}this.sortResults()}intersectObject(e){const i=e.geometries;if(!i)return;const r=e.effectiveTransformation,s=yQ(this.verticalOffset);for(const n of i){if(!n.visible)continue;const{material:a,id:o}=n;if(!a.visible)continue;this.transform.setAndInvalidateLazyTransforms(r,n.transformation),Mt(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),Mt(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const l=this.transform.transform;s!=null&&(s.objectTransform=this.transform),a.intersect(n,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(c,h,f,y)=>this.handleObjectIntersection({object:e,geometryId:o,primitiveIndex:f},c,h,l,y))}}handleObjectIntersection(e,i,r,s,n){if(i<0||this.filterPredicate!=null&&!this.filterPredicate(this._ray.origin,this._rayEnd,i))return;const a=n?this._results.hud:this._results;e=n?new Ont(e,n):e;const o=n?l=>l.set(1,e,i,r):l=>l.set(4,e,i,r,s);if((a.min.distance==null||i<a.min.distance)&&o(a.min),this.options.store!==0&&(a.max.distance==null||i>a.max.distance)&&o(a.max),this.options.store===2)if(n){const l=new dQ(this._ray);o(l),this._results.hud.all.push(l)}else{const l=new G_(this._ray);o(l),this._results.all.push(l)}}sortResults(e=this._results.all){e.sort((i,r)=>i.distance!==r.distance?(i.distance??0)-(r.distance??0):i.drapedLayerOrder!==r.drapedLayerOrder?qpe(i.drapedLayerOrder,r.drapedLayerOrder):qpe(i.renderPriority,r.renderPriority))}};function qpe(t,e){return(e??-Number.MAX_VALUE)-(t??-Number.MAX_VALUE)}let Iat=class{constructor(){this.min=new G_(rn()),this.max=new G_(rn()),this.hud={min:new dQ(rn()),max:new dQ(rn()),all:new Array},this.ground=new G_(rn()),this.all=[]}init(e){this.min.init(e),this.max.init(e),this.ground.init(e),this.all.length=0,this.hud.min.init(e),this.hud.max.init(e),this.hud.all.length=0}};function zEe(t,e,i,r){return t.renderCoordsHelper.fromRenderCoords(e.eye,T6,r)!=null&&vqe(i,T6)}function a8(t,e){return t.elevationProvider?t.elevationProvider.getElevation(e[0],e[1],e[2],t.renderCoordsHelper.spatialReference,"ground")??0:0}function f2(t,e,i,r){const s=t.state.camera.clone();e&&i&&r&&(s.eye=e,s.center=i,s.up=r),Lat(t,s.ray,$0)||de($0,s.center);const n=t.state.constraints,a=n.minimumPoiDistance;if(on(s.eye,$0)<a){const o=n.collision.enabled;de(T1,s.viewForward),le(T1,T1,a),o?s.eye=Ce(T6,$0,T1):xe($0,s.eye,T1);const l=t.renderCoordsHelper,c=l.getAltitude(s.eye),h=n.collision.elevationMargin;o&&c<h&&(Ce(T1,$0,s.eye),s.eye=l.setAltitude(T6,h,s.eye),xe($0,s.eye,T1))}return s.center=$0,s}function Gpe(t,e,i){if(!t.state.isGlobal||!t.stateManager.constraintsManager)return!1;const r=a8(t,e),s=t.stateManager.constraintsManager.nearFarHeuristic;let n=Hpe.get(t);n===void 0&&(n=new nr,Hpe.set(t,n)),n.eye=e,n.center=i;const{far:a}=s.compute(n,t.renderDataExtent,Ua.Infinite,r),o=a*a;return on(e,i)>o}function Lat(t,e,i){let r=_Q[t.viewingMode];r||(r=new Vc(t.state.viewingMode),r.options.backfacesTerrain=!t.state.isGlobal,r.options.invisibleTerrain=!0,_Q[t.viewingMode]=r);const{isGlobal:s}=t.state;return!(!t.sceneIntersectionHelper.intersectRay(e,r,i)||Gpe(t,e.origin,i))||!(!t.renderCoordsHelper.intersectManifold(e,0,i)||Gpe(t,e.origin,i))||!!s&&kat(e,i,or(t.spatialReference).radius)}function kat(t,e,i){const r=Oe(t.origin,t.origin)-i*i,s=r>0?Math.sqrt(r)/3:1;return le(e,t.direction,s/Le(t.direction)),xe(e,e,t.origin),!0}let _Q={};function zat(){_Q={}}const T6=R(),$0=R(),T1=R(),Hpe=new WeakMap;function Fat(t,e){const i=[],r=[];return H5(i,t,e,0),H5(r,i,e,1),H5(i,r,e,2),H5(r,i,e,3),r}function H5(t,e,i,r){const s=Nat(i,r);if(t.length=0,e.length){s(W5,e[0],e[0])===1&&JE(t,e[0]);for(let n=0;n<e.length;n++){const a=e[n===e.length-1?0:n+1];switch(s(W5,e[n],a)){case 1:JE(t,a);break;case 3:JE(t,u6(W5));break;case 2:JE(t,u6(W5)),JE(t,a)}}}}function JE(t,e){t.length!==0&&yU(t.at(-1),e)||t.push(e)}function Nat(t,e){const i=e===0||e===2?0:1,r=t[e],s=e===0||e===1?1:-1,n=i===0?1:0;return(a,o,l)=>{if(o[i]<r&&l[i]<r)return s===1?0:1;if(o[i]>r&&l[i]>r)return s===1?1:0;const c=(l[n]-o[n])/(l[i]-o[i]),h=o[n]+c*(r-o[i]);return a[i]=r,a[n]=h,(o[i]<r?1:-1)*s>0?2:3}}const W5=pt(),Vat=R(),Z5=R();function Wte(){return{direction:R(),up:R()}}function FEe(t,e,i,r,s){let n=Ee(Vat,t),a=Oe(n,r);const o=a>0;a=Math.abs(a),a>.99&&(a=Math.abs(Oe(e,r)),a<.99?(de(n,e),o&&le(n,n,-1)):n=null);let l=0;if(n){le(Z5,r,Oe(r,n)),Ce(n,n,Z5);const h=Oe(n,s)/(Le(n)*Le(s));bt(Z5,n,s),l=(Oe(Z5,r)>0?1:-1)*Ea(Ga(h))}const c=Ea(Ga(-Oe(r,t)/Le(t)));return i?(i.heading=l,i.tilt=c,i):{heading:l,tilt:c}}function NEe(t,e,i,r){Ce(Wpe,i,e),q3e(r,A3e(e,Wpe),t)||t===i||de(t,i)}const Wpe=R(),VEe=Ge(0,1,0),UEe=Ge(0,0,1),KE=it(),Om=R(),Pm=R();function BEe(t,e,i,r=Wte()){const{direction:s,up:n}=r;return s3e(KE,-Lt(e)),CC(KE,KE,Lt(i)),Mt(s,UEe,KE),le(s,s,-1),Mt(n,VEe,KE),r}function Uat(t,e,i,r){return FEe(e,i,r,UEe,VEe)}function Bat(t,e,i,r){const s=BEe(t,i,r),n=R();return le(n,s.direction,-e),xe(n,n,t),{up:s.up,eye:n,heading:i,tilt:r}}function jat(t){return Ea(t)}function qat(t){return Lt(t)}function Gat(t,e,i,r,s){const n=t.renderSpatialReference,a=t.spatialReference??e.spatialReference;return Yl(e,Om,n),Yl(e,Pm,n),Om[0]-=i/2,Pm[0]+=i/2,Om[1]-=r/2,Pm[1]+=r/2,ja(Om,n,Om,a),ja(Pm,n,Pm,a),s?(s.xmin=Om[0],s.ymin=Om[1],s.xmax=Pm[0],s.ymax=Pm[1],s.spatialReference=a):s=new Bt(Om[0],Om[1],Pm[0],Pm[1],a),s}function Hat(t,e){const i=t.frustum,{renderCoordsHelper:r}=t,s=r.getAltitude(e),n=t.spatialReference,a=t.state.camera.eye,o=[],l=i.planes[5];for(let c=0;c<4;c++){const h=i.lines[c];r.intersectInfiniteManifold(Sp(h.origin,h.direction),s,Wd)||Wat(Wd,i,r,h.endpoint,s),NEe(Wd,a,Wd,l),o.push(vs(Wd[0],Wd[1]))}return Zat(Fat(o,r.extent),r,n)}function Wat(t,e,i,r,s){const n=e.lines[11].direction,a=(s-i.getAltitude(r))/n[2];Tr(t,r,n,a)}function Zat(t,e,i){const r=t.map(s=>(ve(Wd,s[0],s[1],0),e.fromRenderCoords(Wd,Wd,i),[Wd[0],Wd[1]]));return r.length<=2?new os({spatialReference:i}):(r.push(r[0].slice()),SU(r)||r.reverse(),new os({rings:[r],spatialReference:i}))}const Wd=R(),Yat=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:Uat,eyeForCenterWithHeadingTilt:Bat,eyeTiltToLookAtTilt:qat,headingTiltToDirectionUp:BEe,lookAtTiltToEyeTilt:jat,toArea:Hat,toExtent:Gat},Symbol.toStringTag,{value:"Module"}));var Uw;let jEe=(Uw=class{get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}get origin(){return this._origin}constructor(e){this.renderCoordsHelper=e,this.frustum=jte(),this._points=_Ee(),this.lines=new Array(12),this._origin=R(),this._direction=R(),this._altitude=null;for(let i=0;i<12;i++)this.lines[i]={origin:null,direction:R(),endpoint:null}}update(e){bEe(e.viewMatrix,e.projectionMatrix,this.frustum,this._points),de(this._origin,e.eye),de(this._direction,e.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this._updateLines()}updatePoints(e){for(let i=0;i<this._points.length;i++)de(this._points[i],e[i]);wEe(this.frustum,this._points),this._updateLines()}get altitude(){return this._altitude}intersectsSphere(e){return D_(this.frustum,e)}intersectsRay(e){return vnt(this.frustum,e)}intersectsLineSegment(e,i){return bnt(this.frustum,e,i)}intersectsPoint(e){return xEe(this.frustum,e)}_updateLines(){const e=this._points;for(let i=0;i<4;i++){const r=i+4;B7(this.lines[i],e[i],e[r]),B7(this.lines[i+4],e[i],i===3?e[0]:e[i+1]),B7(this.lines[i+8],e[r],i===3?e[4]:e[r+1])}}},Uw.planePointIndices=wnt,Uw.nearFarLineIndices=[[0,4],[1,5],[2,6],[3,7]],Uw);function B7(t,e,i){t.origin=e,t.endpoint=i,Hv(t.direction,e,i)}function Zte(t){return Se((t-vQ)/(Qat-vQ),0,1)}const vQ=1e5,Qat=1e6,bQ=1e4,Gz=Ge(parseFloat(5802e-9.toFixed(6)),parseFloat(13558e-9.toFixed(6)),parseFloat(331e-7.toFixed(6))),j7=3,q7=Ge(j7*parseFloat(65e-8.toFixed(6)),j7*parseFloat(1881e-9.toFixed(6)),j7*parseFloat(85e-9.toFixed(6))),Xat=3996e-9,Jat=Ge(parseFloat(Number(Gz[0]+q7[0]).toFixed(6)),parseFloat(Number(Gz[1]+q7[1]).toFixed(6)),parseFloat(Number(Gz[2]+q7[2]).toFixed(6)));function Kat(t,e,i){return t===1?new tot(e,i):new eot(e,i)}let eot=class{constructor(e,i){this._elevationProvider=e,this._referenceEllipsoid=or(i),this._unitInMeters=Wr(i,this._referenceEllipsoid.metersPerDegree)}compute(e,i,r,s){const{eye:n,center:a}=e;let o=n[2]*this._unitInMeters;const l=o,c=o-s,h=this._elevationProvider?.visibleElevationBounds;h&&(o=c>=0?l-this._unitInMeters*h.min:this._unitInMeters*h.max-l),i??=new Bt({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0});const f={x:i.xmax-i.xmin,y:i.ymax-i.ymin,z:4*Math.max(i.xmax-i.xmin,i.ymax-i.ymin)},y=Math.max(f.x,f.y,f.z);Ce(X0,a,n),Dl[0]=X0[0]>0?i.xmax:i.xmin,Dl[1]=X0[1]>0?i.ymax:i.ymin,Dl[2]=X0[2]>0?y/2:-y/2,Ce(Dl,Dl,n),Ee(X0,X0);const _=1.1*Oe(Dl,X0)*this._unitInMeters,w=Math.sqrt(o*(o+2*this._referenceEllipsoid.radius)),x=Math.max(i.xmax-i.xmin,i.ymax-i.ymin),S=x*rot*this._unitInMeters,$=x*sot*this._unitInMeters,A=Se((o-$)/(S-$),0,1)**3,M=Math.min(ft(w,_,A),w)*Math.max(Math.log(Math.abs(c)),1);return qEe(Math.min(M,Math.max(34064e4,y))/this._unitInMeters,Hz,this._unitInMeters,wT)}},tot=class{constructor(e,i){this._elevationProvider=e,this._referenceEllipsoid=or(i)}compute(e,i,r,s){const{eye:n}=e,a=Le(n),o=a-this._referenceEllipsoid.radius,l=this._referenceEllipsoid.radius+Math.min(0,s),c=Math.abs(o-s),h=Math.max(c,Math.abs(o)),f=this._elevationProvider?.visibleElevationBounds.max??0,y=Zte(h),_=Math.sqrt(h*(h+2*l)),w=a+this._referenceEllipsoid.radius,x=1.2*ft(_,w,y),S=(Math.log(h)-Zpe)/(iot-Zpe);qEe(x,Se(Hz-S*(Hz-Ype),Ype,Hz),1,wT);const $=this._referenceEllipsoid.radius+f,A=this._referenceEllipsoid.radius+this._referenceEllipsoid.atmosphereHeight,M=Math.max($,A),P=a-M;if(y>0&&P>o8){const O=Ee(Dl,le(Dl,e.eye,-1)),D=Ee(X0,e.viewForward),L=Ga(Oe(O,D)),F=.5*e.fovY,U=Math.cos(F);let N=Ua.Infinite.near;if(L<=F)N=P*U;else{const B=Ee(Dl,e.viewUp),Y=Math.tan(F),G=le(Dl,B,Y),Z=Ee(Dl,Ce(Dl,D,G)),H=Xee(e.eye,Z,aot),Q=l2(not,M);if(Ry(Q,H,Dl)){const X=Ce(Dl,Dl,e.eye);N=Le(X)*U}}const j=.99*Math.min(r.near,N);if(j<Ua.Infinite.near&&j>wT.near){const B=ft(wT.near,j,y);wT.near=B}}return wT}};function qEe(t,e,i,r){const s=o8/i,n=t/e;return n>s?(r.far=t,r.near=n):(r.near=s,r.far=r.near*e),r}const Zpe=7.983,iot=16.994,Hz=2e4,Ype=100,o8=2,rot=.001,sot=1e-4,Dl=R(),X0=R(),wT={near:0,far:0},not=ms(),aot=rn();function vy(t,e,i){t.worldUpAtPosition(e,Qpe),Ce(G7,i,e);const r=Le(G7);return r===0?0:Ga(Oe(G7,Qpe)/r)}const Qpe=R(),G7=R();function Xpe(t,e,i){if(e.longitude==null||e.latitude==null||i.longitude==null||i.latitude==null)throw new Error("Invalid points: no lon/lat");return oot(t,e.longitude,e.latitude,i.longitude,i.latitude)}function oot(t,e,i,r,s){const n=Lt(i),a=Lt(s),o=n-a,l=Lt(e)-Lt(r),c=Math.sin(o/2),h=Math.sin(l/2),f=2*zu(Math.sqrt(c*c+Math.cos(n)*Math.cos(a)*h*h))*t;return Math.round(1e4*f)/1e4}function lot(t,e,i){const r=e.spatialReference,s=or(r),n=new Qe(e.x,t.y,r),a=new Qe(i.x,t.y,r),o=new Qe(t.x,e.y,r),l=new Qe(t.x,i.y,r);return{lon:Xpe(s.radius,n,a),lat:Xpe(s.radius,o,l)}}function cot(t,e,i){const r=e/i,s=Lt(t),n=Math.sin(r/2),a=Math.cos(s),o=2*zu(Math.sqrt(n*n/(a*a)));return Ea(o)}function uot(t,e){return t/15}function Jpe(t,e){const i=t?.[0];if(i==null)return null;e||(e={hours:0,minutes:0,seconds:0}),e.hours=uot(i);const r=e.hours%1;e.hours-=r,e.minutes=60*r;const s=e.minutes%1;return e.minutes-=s,e.seconds=Math.round(60*s),e}const GEe=Ge(0,0,1),HEe=Ee(R(),Ge(1,1,1)),eA=it(),p_=R(),vS=R();function WEe(t,e,i,r=Wte()){bt(p_,t,GEe),Oe(p_,p_)===0&&bt(p_,t,HEe),Xh(eA,-Lt(e),t),Eu(eA,eA,-Lt(i),p_);const{up:s,direction:n}=r;return bt(s,p_,t),Ee(s,s),Mt(s,s,eA),Ee(n,t),Gh(n,n),Mt(n,n,eA),r}function hot(t,e,i,r){const s=p_,n=vS;return Ee(s,t),bt(vS,s,GEe),Oe(vS,vS)===0&&bt(vS,s,HEe),bt(n,vS,s),FEe(e,i,r,s,n)}function dot(t,e,i,r){const s={eye:R(),up:null,tilt:r,heading:i},n=p_;n[0]=t[0],n[1]=t[2],n[2]=-t[1];const a=e,o=Lt(i),l=Lt(r),c=Math.sin(o),h=Math.cos(o),f=Math.sin(l),y=Math.cos(l),_=Le(n);let w;if(Math.abs(l)<1e-8)w=a+_;else{const H=_/f,Q=zu(a/H),X=Math.PI-l-Q;w=H*Math.sin(X)}const x=y*a,S=a*a*(f*f),$=h*h*S,A=w-x,M=A*A,P=$*($+M-n[1]*n[1]);if(P<0)return le(s.eye,n,w/_),s.tilt=0,Y5(s,t);const O=Math.sqrt(P),D=n[1]*A,L=$+M;let F;if(F=h>0?-O+D:O+D,Math.abs(L)<1e-8)return _<1e-8?(s.eye[0]=0,s.eye[1]=0,s.eye[2]=a):le(s.eye,n,w/_),s.tilt=0,H7(s.eye),Y5(s,t);s.eye[1]=F/L;const U=c*c*S,N=f*a,j=h*N*s.eye[1],B=s.eye[1]*s.eye[1],Y=1-B,G=Math.sqrt(Y),Z=$*B+U-2*j*G*A+Y*M;return Math.abs(Z)<1e-8?(le(s.eye,n,w/_),s.tilt=0,H7(s.eye),Y5(s,t)):(s.eye[0]=(Y*(w*n[0]-x*n[0])-N*G*(n[0]*s.eye[1]*h+n[2]*c))/Z,s.eye[2]=(Y*(w*n[2]-x*n[2])-N*G*(n[2]*s.eye[1]*h-n[0]*c))/Z,le(s.eye,s.eye,w),H7(s.eye),Y5(s,t))}function H7(t){const e=t[1];t[1]=-t[2],t[2]=e}function Y5(t,e){const i=WEe(e,t.heading,t.tilt);return t.up=i.up,t}function pot(t,e,i){const r=Le(e),s=Math.sqrt(i*i+r*r-2*i*r*Math.cos(Math.PI-t)),n=zu(i/(s/Math.sin(t)));return Ea(t-n)}function fot(t,e,i){const r=Lt(t),s=Le(e);return zu(i/(s/Math.sin(r)))+r}function mot(t,e,i,r,s){let n,a,o,l;const c=e.latitude,h=or(t.spatialReference).radius,f=e.longitude,y=cot(c,i,h)/2;n=f-y,a=f+y;const _=Lt(c),w=(1+Math.sin(_))/(1-Math.sin(_)),x=(w+1)*Math.tan(r/h/2),S=x*x;function $(M){const P=Math.PI/2;return(M=Hje.normalize(M,-P))>P&&(M=Math.PI-M),M}if(o=1.5*Math.PI-2*Math.atan(.5*(x+Math.sqrt(4*w+S))),l=o+r/h,o=$(o),l=$(l),l<o){const M=l;l=o,o=M}if(o=Math.max(Ea(o),-90),l=Math.min(Ea(l),90),a=mEe.monotonic(n,a),a-n>180){const M=(a-n-180)/2;n+=M,a-=M}const A=t.spatialReference&&t.spatialReference.isGeographic?t.spatialReference:Ie.WGS84;return s?(s.xmin=n,s.ymin=o,s.xmax=a,s.ymax=l,s.spatialReference=A):s=new Bt(n,o,a,l,A),t.spatialReference&&t.spatialReference.isWebMercator&&U_(s,!1,s),s}function got(t,e){const{renderCoordsHelper:i}=t,r=t.state.camera.clone(),s=new jEe(i);r.near=o8,s.update(r);const n=i.getAltitude(e),a=t.spatialReference,o=i.referenceEllipsoid.radius,l=r.eye,c=1+Ri(l,e)/(o+n),h=Math.sqrt(c*c-1),{minCurvature:f,maxCurvature:y,minSamples:_,maxSamples:w}=bot,x=vot(t),S=Se((h-f)/(y-f),0,1),$=Math.round(ft(_,w,S)),A=r.aboveGround,M=s.planes[5],P=[],O=Qf(Kn,wot,Oi()),D=Qf(Kn,xot,Oi());yr(W7,0,0,0,0);const L=U=>{};for(let U=0;U<4;U++){const N=U===1&&!A||U===3&&A?1-x:0,j=U===1&&A||U===3&&!A?x:1,B=s.lines[U],Y=s.lines[U===3?0:U+1];for(let G=0;G<$;G++){const Z=G/$,H=G===0?0:ft(N,j,U===1?1-(1-Z)**2:U===3?Z**2:Z),Q=Wi(Tot,B.origin,Y.origin,H),X=N3e(B.direction,Y.direction,H,Sot);i.intersectManifoldClosestSilhouette(Sp(Q,X),n,kl),NEe(kl,l,kl,M),P.push(cr(kl)),P.length!==0&&L(AC(P.at(-1),kl));const ye=(WR(O,kl)?1:0)|(WR(D,kl)?2:0);W7[ye]=1}}P.length>2&&L(AC(P[0],P.at(-1)));const F=yot(NU(W7)>1?_ot(ZEe(P,O),D):[P],i,a);return new os({rings:F,spatialReference:a})}function yot(t,e,i){const r=2*nn();return t.map(s=>{const n=[];let a=!1;for(const o of s)e.fromRenderCoords(o,kl,i),Math.abs(o[0])<r&&Math.abs(o[1])<r?(n.push([null,kl[1]]),n.push([null,kl[1]]),a=!0):n.push([kl[0],kl[1]]);if(a)for(let o=0;o<n.length;o++){const l=n[o];if(l[0]!=null)continue;const c=n[o+1],h=n.at(o===0?-1:o-1);l[0]=h[0],o++;const f=n.at(o===n.length-1?0:o+1);c[0]=f[0]}return n.push(n[0]),SU(n)||n.reverse(),n})}function _ot(t,e){const i=[];for(const r of t)i.push(...ZEe(r,e));return i}function ZEe(t,e){const i=[],r=[],s=nn();for(let a=0;a<t.length;a++){const o=t[a],l=a===t.length-1?t[0]:t[a+1],c=dz(o,l,$ot),h=n4(e,c.origin,c.vector,0,kl);switch(h){case 2:i.push(o);break;case 3:r.push(o);break;case 0:case 1:{const[f,y,_]=h===0?[1,i,r]:[-1,r,i],w=e,x=Tr(R(),kl,w,f*s),S=Tr(R(),kl,w,f*-s);y.push(o),y.push(x),_.push(S)}}}const n=[];return i.length&&n.push(i),r.length&&n.push(r),n}function vot(t){const{renderCoordsHelper:e,state:{camera:i}}=t,{center:r,eye:s}=i,n=Math.abs(e.getAltitude(r)),a=Math.abs(Math.PI/2-vy(e,r,s));return l2(Kpe,e.referenceEllipsoid.radius+n),ate(Kpe,a,i.distance,i.fovY)}const bot={minCurvature:Lt(5),maxCurvature:Lt(50),minSamples:1,maxSamples:6},wot=Ge(1,0,0),xot=Ge(0,1,0),Sot=R(),Tot=R(),kl=R(),Kpe=ms(),$ot=Oy(),W7=ri(),Cot=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:hot,eyeForCenterWithHeadingTilt:dot,eyeTiltToLookAtTilt:fot,headingTiltToDirectionUp:WEe,lookAtTiltToEyeTilt:pot,toArea:got,toExtent:mot},Symbol.toStringTag,{value:"Module"}));function Yv({state:t}){return t.isGlobal?Cot:Yat}function p4(t,e,i,r,s){return Yv(t).directionToHeadingTilt(e,i,r,s)}const es={OPAQUE:"opaque-color",TRANSPARENT:"transparent-color",COMPOSITE:"composite-color",FINAL:"final-color"},ht={SSAO:"ssao",LASERLINES:"laserline-color",ANTIALIASING:"aa-color",HIGHLIGHTS:"highlight-color",MAGNIFIER:"magnifier-color",OCCLUDED:"occluded-color",VIEWSHED:"viewshed-color",CUTFILL_DEPTH:"cutfill-depth",CUTFILL_COLOR:"cutfill-color",OPAQUE_TERRAIN:"opaque-terrain-color",OPAQUE_ENVIRONMENT:"opaque-environment-color",TRANSPARENT_ENVIRONMENT:"transparent-environment-color",FOCUSAREA:"focusarea",FOCUSAREA_COLOR:"focusarea-color"};function NC(t,e,i){const r=t.renderSpatialReference,s=p4(t,e.eye,e.viewForward,e.up,Mot);let n=t.spatialReference;return ja(e.eye,r,bS,n)||(n=Ie.WGS84,ja(e.eye,r,bS,n)),i==null?i=new ol(new Qe(bS,n),s.heading,s.tilt,Ea(e.fov)):(i.position.x=bS[0],i.position.y=bS[1],i.position.z=bS[2],i.position.spatialReference=n,i.heading=s.heading,i.tilt=s.tilt,i.fov=Ea(e.fov)),i.layout.row=e.row,i.layout.rows=e.rows,i.layout.column=e.column,i.layout.columns=e.columns,i}function Tf(t,e){if(!e)return null;const i=t.renderSpatialReference,r=Yv(t).headingTiltToDirectionUp,s=R();if(!Yl(e.position,s,i))return null;const n=r(s,e.heading,e.tilt);le(n.direction,n.direction,t.state.camera.distance),xe(n.direction,n.direction,s);const a=f2(t,s,n.direction,n.up);return a.fov=Lt(e.fov),a.row=e.layout.row,a.rows=e.layout.rows,a.column=e.layout.column,a.columns=e.layout.columns,a}const bS=R(),Mot={heading:0,tilt:0};function $6(t){return t.type==="point"}let Eot=class{constructor(e,i=null,r=0){this.array=e,this.spatialReference=i,this.offset=r}};function YEe(t){return"array"in t}function Ff(t,e,i="ground"){if($6(e))return t.getElevation(e.x,e.y,e.z||0,e.spatialReference,i);if(YEe(e)){let r=e.offset;return t.getElevation(e.array[r++],e.array[r++],e.array[r]||0,e.spatialReference??t.spatialReference,i)}return t.getElevation(e[0],e[1],e[2]||0,t.spatialReference,i)}function rD(t,e){return t!=null&&(e==null||(e===2?!t.isGeographic||t.isWGS84||t.wkid===4490:t.isWebMercator||t.isWGS84||t.wkid===4490||t.wkid===104971||t.wkid===104905||t.wkid===104903))}const Yte=()=>fe.getLogger("esri.views.3d.support.cameraUtils"),QEe=96*39.37,wQ=1,Aot=8,Oot=5,XEe=1,YP=R();function m2(t){return t.spatialReference??Ie.WGS84}function Pot(t,e,i,r,s){return Yv(t).headingTiltToDirectionUp(e,i,r,s)}function sD(t,e){const{camera:i}=t.state,{unitInMeters:r}=t.renderCoordsHelper;return e/=r,i.width/2/i.pixelRatio/(QEe/e)/Math.tan(i.fovX/2)}function Zx(t,e){const{camera:i}=t.state,{unitInMeters:r}=t.renderCoordsHelper,s=e*Math.tan(i.fovX/2),n=i.width/2/i.pixelRatio;return QEe/(n/s)*r}function JEe(t,e,i,r){const s=r.levelAtScale(e),n=KEe(p4(t,i.eye,i.viewForward,i.up).tilt),a=Math.max(s-n,0);return r.scaleAtLevel(a)}function efe(t,e,i){const r=i.levelAtScale(t),s=KEe(e);return i.scaleAtLevel(r+s)}function KEe(t){return 2*((t>90?180-t:t)/90)**2}function Rot(t,e,i=0){const r=t.basemapTerrain?.tilingScheme;if(!r)return 0;const s=or(t.spatialReference).radius,n=t.state.viewingMode===2?e.eye[2]:Le(e.eye)-s;return JEe(t,Zx(t,Math.abs(n-i)),e,r)}function Dot(t,e,i=0){const r=Tf(t,e);return r?Rot(t,r,i):0}const Iot=1,Lot=100;function kot(t,e,i,r){if(e===0)return 0;const s=t.state.contentCamera,n=Ri(s.eye,i),a=t.basemapTerrain?.tilingScheme;if(!a)return Yte().error("#scaleToTargetDistance()","Cannot compute distance from scale without a tiling scheme"),n;let o=n;const l=p4(t,s.eye,s.viewForward,s.up),c=l.tilt>90;if(t.state.isLocal){const w=(sD(t,efe(e,l.tilt,a))-Math.abs(s.eye[2]-r[2]))/Math.cos(Lt(l.tilt));return o=c?o-w:o+w,o}let h=1/0,f=0,y=nD(t,l.heading,l.tilt,i,n,1);if(!y)return o;const _=Le(r);for(;h>Iot&&f<Lot;){const w=Le(y.eye),x=c?180-y.tilt:y.tilt,S=Lt(x),$=Math.sin(S)*w,A=Math.cos(S)*w,M=sD(t,efe(e,y.tilt,a)),P=c?_-M:_+M,O=zu($/P),D=Math.cos(O)*P-A,L=Ri(y.eye,i);o=c?L-D:L+D,y=nD(t,l.heading,l.tilt,i,o,1);const F=Xte(t,y,Ea(s.fov));if(!y||!F)return o;const U=Dot(t,F,_-or(t.spatialReference).radius);h=Math.abs(e-U),++f}return o}async function zot(t,e,i,r,s,n){return l8(t,e,sD(t,i),r,s,n)}function Fot(t,e,i,r,s,n){return Xte(t,nD(t,r.heading,r.tilt,e,i,s),r.fov,n)}async function l8(t,e,i,r,s,n){const a=await tAe(t,r.heading,r.tilt,e,i,s,n);return st(n),pAe(t,a,r.fov,n)}function eAe(t,e){return!!(t.basemapTerrain&&t.renderCoordsHelper.fromRenderCoords(e,YP,t.spatialReference)&&t.elevationProvider&&(Ff(t.elevationProvider,YP)??0)>YP[2]-XEe)}async function Not(t,e,i){if(eAe(t,e))return!0;const{elevationProvider:r,spatialReference:s,renderCoordsHelper:n}=t;if(r==null||!n.fromRenderCoords(e,YP,s))return!1;const[a,o,l]=YP,c=await r.queryElevation(a,o,l,s,"ground",i)??0;return st(i),c>l-XEe}async function Vot(t,e,i){const r=R();if(e==null)return de(r,t.state.camera.center);if(e instanceof Qe){const{renderSpatialReference:s,basemapTerrain:n,elevationProvider:a}=t,o=e.spatialReference;if(await c6(e,r,s,0,{signal:i}),st(i),e.z==null&&n!=null&&a!=null){const l=await a.queryElevation(e.x,e.y,e.z??0,o,"ground",i);st(i),l!=null&&t.renderCoordsHelper.setAltitude(r,l)}return r}return de(r,e)}function Uot(t,e){const i=R();if(e==null)return de(i,t.state.camera.center);if(e instanceof Qe){if(!Yl(e,i,t.renderSpatialReference))return null;const{basemapTerrain:r,elevationProvider:s}=t;if(e.z==null&&r!=null&&s!=null){const n=Ff(s,e);n!=null&&t.renderCoordsHelper.setAltitude(i,n)}return i}return de(i,e)}function nD(t,e,i,r,s,n){return iAe(t,e,i,r instanceof Qe?r:null,Uot(t,r),s,n)}async function tAe(t,e,i,r,s,n,a){const o=r instanceof Qe?r:null,l=await Vot(t,r,a);return st(a),rAe(t,e,i,o,l,s,n,a)}function iAe(t,e,i,r,s,n,a){if(s==null||!r&&(r=new Qe({spatialReference:m2(t)}),!p2(s,t.renderSpatialReference,r)))return null;const o=sAe(t,e,i,s,n,a);if(nAe(t,i,a)&&eAe(t,o.eye)){const{tilt:l,mode:c}=aAe(t,i,s,n);return iAe(t,e,l,r,s,n,c)}return oAe(o,s)}async function rAe(t,e,i,r,s,n,a,o){r||(r=new Qe({spatialReference:m2(t)}),await uEe(s,t.renderSpatialReference,r,{signal:o})||(r=null)),st(o);const l=sAe(t,e,i,s,n,a);if(nAe(t,i,a)&&await Not(t,l.eye,o)){st(o);const{tilt:c,mode:h}=aAe(t,i,s,n);return rAe(t,e,c,r,s,n,h,o)}return oAe(l,s)}function sAe(t,e,i,r,s,n){const a=qot(t,e,i,r,s=Math.max(s,t.state.constraints.minimumPoiDistance),n);return(0,Yv(t).eyeForCenterWithHeadingTilt)(r,s,a.heading,a.tilt)}function nAe(t,e,i){const r=t.map.ground.navigationConstraint;return i===1&&t.state.isGlobal&&e>0&&(r==null||r.type==="stay-above")}function aAe(t,e,i,r){const s=dAe(t,i,r,Hot(t,r,e,i));return{tilt:s,mode:e-s<1?0:1}}function oAe(t,e){return{...t,center:cr(e)}}function lAe(t,e){const{state:i,spatialReference:r}=t,s=e.spatialReference;return i.isGlobal&&rD(s,1)||i.isLocal&&r.equals(s)}function cAe(t,e){let i,r,s;if(t.state.isGlobal){const h=new Qe(e.xmin,e.ymin,e.spatialReference),f=new Qe(e.xmax,e.ymax,e.spatialReference),y=e.spatialReference.isGeographic?mEe:mnt;i=new Qe({x:y.center(h.x,f.x),y:(f.y+h.y)/2,z:e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0,spatialReference:e.spatialReference});const _=or(e.spatialReference),w=lot(i,h,f);r=w.lon,s=w.lat,y.diff(h.x,f.x)>y.range/2&&(r+=_.halfCircumference),r=Math.min(r,_.halfCircumference),s=Math.min(s,_.halfCircumference)}else{const h=t.renderSpatialReference??e.spatialReference;h.equals(e.spatialReference)||(e=zo(e,h)),r=e.xmax-e.xmin,s=e.ymax-e.ymin;const f=e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0;i=new Qe({x:e.xmin+.5*r,y:e.ymin+.5*s,z:f,spatialReference:h})}const n=e.zmax!=null&&e.zmin!=null?e.zmax-e.zmin:0,a=t.state.camera,o=1/Math.tan(a.fovX/2),l=1/Math.tan(a.fovY/2),c=1/Math.tan(a.fov/2);return{center:i,distance:Math.max(.5*r*o,.5*s*l,.5*n*c)/wQ}}async function uAe(t,e,i,r,s,n){const a=lAe(t,e)?e:await fy(e,t.spatialReference,{signal:n});st(n);const{center:o,distance:l}=cAe(t,a),c=await tAe(t,i,r,o,l,s,n);return st(n),pAe(t,c,t.camera.fov,n)}function Wz(t,e,i,r,s,n){let a;try{a=lAe(t,e)?e:zo(e,t.spatialReference)}catch{return null}const{center:o,distance:l}=cAe(t,a),c=nD(t,i,r,o,l,s);return c==null?null:Xte(t,c,t.camera.fov,n)}function hAe(t,e,i){const r=t.renderSpatialReference,s=new Qe({spatialReference:m2(t)});if(!p2(i,r,s))return null;const n=Math.tan(e.fovX/2),a=Math.tan(e.fovY/2),o=s4(e.eye,i),l=2*o*n*wQ,c=2*o*a*wQ;return Yv(t).toExtent(t,s,l,c)}function Bot(t,e){return Yv(t).toArea(t,e)}function jot(t,e,i){const r=t.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(i/r)/Math.LN2>Aot)return!0;const s=e,n=t.pointsOfInterest.centerOnSurfaceFrequent.renderLocation;return Ri(s,n)/(Math.tan(.5*t.state.camera.fov)*r)>Oot}function qot(t,e,i,r,s,n){let a=0;return n===1&&jot(t,r,s)?(e=0,a=Got(t,s,i,r)):a=Qte(t,r,s,i),a=t.state.constraints.clampTilt(s,a),{heading:e,tilt:i=dAe(t,r,s,a)}}const C6=.7;function Got(t,e,i,r){const s=Qte(t,r,e,i);if(!t.state.constraints.tilt)return s;const n=t.state.constraints.tilt(e);n.max=Math.min(n.max,.5*Math.PI);const a=n.min*(1-C6)+n.max*C6;return Math.min(s,a)}function Hot(t,e,i,r){let s=Qte(t,r,e,i);if(!t.state.constraints.tilt)return s;const n=t.state.constraints.tilt(e);return s=Math.min(s,.5*Math.PI),n.min*(1-C6)+s*C6}function dAe(t,e,i,r){return Yv(t).lookAtTiltToEyeTilt(r,e,i)}function Qte(t,e,i,r){return Yv(t).eyeTiltToLookAtTilt(r,e,i)}function Xte(t,e,i,r){if(e==null)return null;const s=t.renderSpatialReference,n=new Qe({spatialReference:m2(t)});return p2(e.eye,s,n)?(r??=new ol,r.position=n,r.heading=e.heading,r.tilt=e.tilt,r.fov=i,r):null}async function pAe(t,e,i,r){const s=t.renderSpatialReference,n=new Qe({spatialReference:m2(t)});return await uEe(e.eye,s,n,{signal:r}),st(r),new ol(n,e.heading,e.tilt,i)}function Wot(t,e){const i=t.basemapTerrain?.tilingScheme;if(i)return i.levelAtScale(e);Yte().error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}function fAe(t,e){const i=t.basemapTerrain?.tilingScheme;if(i)return i.scaleAtLevel(e);Yte().error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}let aD=class extends Uc{queryElevation(e){const i=this.projectIfRequired(e,this.spatialReference);if(!i)return null;switch(e.type){case"point":return Zot(e,i,this);case"polyline":return Yot(e,i,this);case"multipoint":return Qot(e,i,this);default:return null}}projectIfRequired(e,i){if(e==null)return null;const r=e.spatialReference;if(r.equals(i))return e;const s=QD(e,i);return s||fe.getLogger(this).error(`Cannot project geometry spatial reference (wkid:${r.wkid}) to elevation sampler spatial reference (wkid:${i.wkid})`),s}};function Zot(t,e,i){return t.hasZ=!0,t.z=i.elevationAt(e.x,e.y),t}function Yot(t,e,i){Rf.spatialReference=e.spatialReference;const r=t.hasM&&!t.hasZ;for(let s=0;s<t.paths.length;s++){const n=t.paths[s],a=e.paths[s];for(let o=0;o<n.length;o++){const l=n[o],c=a[o];Rf.x=c[0],Rf.y=c[1],r&&(l[3]=l[2]),l[2]=i.elevationAt(Rf.x,Rf.y)}}return t.hasZ=!0,t}function Qot(t,e,i){Rf.spatialReference=e.spatialReference;const r=t.hasM&&!t.hasZ;for(let s=0;s<t.points.length;s++){const n=t.points[s],a=e.points[s];Rf.x=a[0],Rf.y=a[1],r&&(n[3]=n[2]),n[2]=i.elevationAt(Rf.x,Rf.y)}return t.hasZ=!0,t}aD=d([k("esri.layers.support.ElevationSampler")],aD);const Rf=new Qe;var xQ,F$;let wa=(F$=class extends ke{constructor(e){super(e),this.cols=null,this.level=0,this.levelValue=null,this.origin=null,this.resolution=0,this.rows=null,this.scale=0}clone(){return new xQ({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}},xQ=F$,F$);d([m({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],wa.prototype,"cols",void 0),d([m({type:qi,json:{write:!0}})],wa.prototype,"level",void 0),d([m({type:String,json:{write:!0}})],wa.prototype,"levelValue",void 0),d([m({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],wa.prototype,"origin",void 0),d([m({type:Number,json:{write:!0}})],wa.prototype,"resolution",void 0),d([m({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],wa.prototype,"rows",void 0),d([m({type:Number,json:{write:!0}})],wa.prototype,"scale",void 0),wa=xQ=d([k("esri.layers.support.LOD")],wa);var xT;const tfe=new ta({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});var N$;let to=(N$=class extends ke{static create(e={}){const{resolutionFactor:i=1,scales:r,size:s=256,spatialReference:n=Ie.WebMercator,numLODs:a=24}=e;if(!ip(n)){const y=[];if(r)for(let _=0;_<r.length;_++){const w=r[_];y.push(new wa({level:_,scale:w,resolution:w}))}else{let _=5e-4;for(let w=a-1;w>=0;w--)y.unshift(new wa({level:w,scale:_,resolution:_})),_*=2}return new xT({dpi:96,lods:y,origin:new Qe(0,0,n),size:[s,s],spatialReference:n})}const o=Ru(n),l=e.origin?new Qe({x:e.origin.x,y:e.origin.y,spatialReference:n}):new Qe(o?{x:o.origin[0],y:o.origin[1],spatialReference:n}:{x:0,y:0,spatialReference:n}),c=96,h=1/(Wr(n)*39.37*c),f=[];if(r)for(let y=0;y<r.length;y++){const _=r[y],w=_*h;f.push(new wa({level:y,scale:_,resolution:w}))}else{let y=Uv(n)?512/s*5916575275917094e-7:256/s*591657527591555e-6;const _=Math.ceil(a/i);f.push(new wa({level:0,scale:y,resolution:y*h}));for(let w=1;w<_;w++){const x=y/2**i,S=x*h;f.push(new wa({level:w,scale:x,resolution:S})),y=x}}return new xT({dpi:c,lods:f,origin:l,size:[s,s],spatialReference:n})}constructor(e){super(e),this.dpi=96,this.format=null,this.origin=null,this.size=null,this.spatialReference=null}get isWrappable(){const{spatialReference:e,origin:i}=this;if(e&&i){const r=Ru(e);return e.isWrappable&&!!r&&Math.abs(r.origin[0]-i.x)<=r.dx}return!1}readOrigin(e,i){return Qe.fromJSON({spatialReference:i.spatialReference,...e})}set lods(e){let i=0,r=0;const s=[],n=this._levelToLOD={};e&&(i=-1/0,r=1/0,e.forEach(a=>{s.push(a.scale),i=a.scale>i?a.scale:i,r=a.scale<r?a.scale:r,n[a.level]=a})),this._set("scales",s),this._set("lods",e),this._initializeUpsampleLevels()}readSize(e,i){return[i.cols,i.rows]}writeSize(e,i){i.cols=e[0],i.rows=e[1]}zoomToScale(e){const i=this.scales;if(e<=0)return i[0];if(e>=i.length-1)return i[i.length-1];const r=Math.floor(e),s=r+1;return i[r]/(i[r]/i[s])**(e-r)}scaleToZoom(e){const i=this.scales,r=i.length-1;let s=0;for(;s<r;s++){const n=i[s],a=i[s+1];if(n<=e)return s;if(a===e)return s+1;if(n>e&&a<e)return s+Math.log(n/e)/Math.log(n/a)}return s}tileAt(e,i,r,s){const n=this.lodAt(e);if(!n)return null;let a,o;if(typeof i=="number")a=i,o=r;else if(fs(i.spatialReference,this.spatialReference))a=i.x,o=i.y,s=r;else{const h=QD(i,this.spatialReference);if(h==null)return null;a=h.x,o=h.y,s=r}const l=n.resolution*this.size[0],c=n.resolution*this.size[1];return s??=new o4(0,0,0),s.level=e,s.row=Math.floor((this.origin.y-o)/c+.001),s.col=Math.floor((a-this.origin.x)/l+.001),this.updateTileInfo(s),s}updateTileInfo(e,i=0){if(!("extent"in e))return!1;let r=this.lodAt(e.level);if(!r&&i===1){const o=this.lods[this.lods.length-1];o.level<e.level&&(r=o)}if(!r)return!1;const s=e.level-r.level,n=r.resolution*this.size[0]/2**s,a=r.resolution*this.size[1]/2**s;return e.extent[0]=this.origin.x+e.col*n,e.extent[1]=this.origin.y-(e.row+1)*a,e.extent[2]=e.extent[0]+n,e.extent[3]=e.extent[1]+a,!0}upsampleTile(e){const i=this._upsampleLevels[e.level];return!(!i||i.parentLevel===-1)&&(e.level=i.parentLevel,e.row=Math.floor(e.row/i.factor+.001),e.col=Math.floor(e.col/i.factor+.001),this.updateTileInfo(e),!0)}getTileBounds(e,i){const r=this.lodAt(i.level);if(r==null)return null;const{resolution:s}=r,n=s*this.size[0],a=s*this.size[1];return e[0]=this.origin.x+i.col*n,e[1]=this.origin.y-(i.row+1)*a,e[2]=e[0]+n,e[3]=e[1]+a,e}lodAt(e){return this._levelToLOD?.[e]??null}clone(){return xT.fromJSON(this.write({}))}getCompatibleForVTL(e){if(this.size[0]!==this.size[1]||this.size[0]===256&&e===512)return null;const i=(this.size[0]===512&&e===256?-1:0)+(this.spatialReference.isGeographic?1:0);if(this.size[0]===e&&i===0)return this;const r=[],s=this.lods.length-i;for(let n=0;n<s;n++){const a=n+i,{scale:o,resolution:l}=a>=0?this.lods[a]:{scale:2*this.lods[0].scale,resolution:2*this.lods[0].resolution};r.push(new wa({level:n,scale:o,resolution:l}))}return new xT({size:[e,e],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:r})}_initializeUpsampleLevels(){const e=this.lods;this._upsampleLevels=[];let i=null;for(let r=0;r<e.length;r++){const s=e[r];this._upsampleLevels[s.level]={parentLevel:i?i.level:-1,factor:i?i.resolution/s.resolution:0},i=s}}},xT=N$,N$);d([m({type:Number,json:{write:!0}})],to.prototype,"compressionQuality",void 0),d([m({type:Number,json:{write:!0}})],to.prototype,"dpi",void 0),d([m({type:String,json:{read:tfe.read,write:tfe.write,origins:{"web-scene":{read:!1,write:!1}}}})],to.prototype,"format",void 0),d([m({readOnly:!0})],to.prototype,"isWrappable",null),d([m({type:Qe,json:{write:!0}})],to.prototype,"origin",void 0),d([di("origin")],to.prototype,"readOrigin",null),d([m({type:[wa],value:null,json:{write:!0}})],to.prototype,"lods",null),d([m({readOnly:!0})],to.prototype,"scales",void 0),d([m({cast:t=>Array.isArray(t)?t:typeof t=="number"?[t,t]:[256,256]})],to.prototype,"size",void 0),d([di("size",["rows","cols"])],to.prototype,"readSize",null),d([Ht("size",{cols:{type:qi},rows:{type:qi}})],to.prototype,"writeSize",null),d([m({type:Ie,json:{write:!0}})],to.prototype,"spatialReference",void 0),to=xT=d([k("esri.layers.support.TileInfo")],to);const Xot=12;var Bn;let Zd=(Bn=class{constructor(e){const i=Bn.checkUnsupported(e);if(i!=null)throw i;const r=e;this.spatialReference=r.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=Uv(this.spatialReference),this.origin=[r.origin.x,r.origin.y],this.pixelSize=r.size[0],this.dpi=r.dpi;const s=r.lods.reduce((c,h)=>(h.level<c.minLod.level&&(c.minLod=h),c.max=Math.max(c.max,h.level),c),{minLod:r.lods[0],max:-1/0}),n=s.minLod,a=2**n.level;let o=n.resolution*a,l=n.scale*a;this.levels=new Array(s.max+1);for(let c=0;c<this.levels.length;c++)this.levels[c]={resolution:o,scale:l,tileSize:[o*r.size[0],o*r.size[1]]},o/=2,l/=2}clone(){return new Bn(this.toTileInfo())}toTileInfo(){return new to({dpi:this.dpi,origin:new Qe({x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference}),size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((e,i)=>new wa({level:i,scale:e.scale,resolution:e.resolution}))})}getExtent(e,i,r,s){const n=this.levels[e],a=n.tileSize[0],o=n.tileSize[1];s[0]=this.origin[0]+r*a,s[2]=this.origin[0]+(r+1)*a,s[3]=this.origin[1]-i*o,s[1]=this.origin[1]-(i+1)*o}convertExtentToRadians(e,i){this._isWebMercator?(i[0]=Uue(e[0]),i[1]=CW(e[1]),i[2]=Uue(e[2]),i[3]=CW(e[3])):this._isGCS&&(i[0]=Lt(e[0]),i[1]=Lt(e[1]),i[2]=Lt(e[2]),i[3]=Lt(e[3]))}getExtentGeometry(e,i,r,s=new Bt){return this.getExtent(e,i,r,Hp),s.spatialReference=this.spatialReference,s.xmin=Hp[0],s.ymin=Hp[1],s.xmax=Hp[2],s.ymax=Hp[3],s.zmin=void 0,s.zmax=void 0,s}ensureMaxLod(e){if(e==null)return!1;let i=!1;for(;this.levels.length<=e;){const{resolution:r,scale:s}=this.levels[this.levels.length-1],n=r/2*this.pixelSize;this.levels.push({resolution:r/2,scale:s/2,tileSize:[n,n]}),i=!0}return i}capMaxLod(e){this.levels.length>e+1&&(this.levels.length=e+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(e){return this.levels[0].scale/2**e}levelAtScale(e){const i=this.levels[0].scale;return e>=i?0:Math.log(i/e)*Math.LOG2E}resolutionAtLevel(e){return this.levels[0].resolution/2**e}compatibleWith(e,i=1/0){if(Bn.checkUnsupported(e))return!1;const r=new Bn(e);if(!r.spatialReference.equals(this.spatialReference)||r.pixelSize!==this.pixelSize)return!1;const s=Math.min(this.levels.length-1,r.levels.length-1,i),n=this.levels[s].resolution;let a=.5*n;return!Gl(r.origin[0],this.origin[0],a)||!Gl(r.origin[1],this.origin[1],a)?!1:(a=.5*n/2**s/this.pixelSize*Xot,Gl(n,r.levels[s].resolution,a))}rootTilesInExtent(e,i=null,r=1/0){const s=new Array,n=this.levels[0].tileSize;if(e==null||n[0]===0||n[1]===0)return s;Bn.computeRowColExtent(e,n,this.origin,Hp);let a=Hp[1],o=Hp[3],l=Hp[0],c=Hp[2];const h=c-l,f=o-a;if(h*f>r){const y=Math.floor(Math.sqrt(r));f>y&&(a=a+Math.floor(.5*f)-Math.floor(.5*y),o=a+y),h>y&&(l=l+Math.floor(.5*h)-Math.floor(.5*y),c=l+y)}for(let y=a;y<o;y++)for(let _=l;_<c;_++)s.push([0,y,_]);return i!=null&&(i[0]=this.origin[0]+l*n[0],i[1]=this.origin[1]-o*n[1],i[2]=this.origin[0]+c*n[0],i[3]=this.origin[1]-a*n[1]),s}static computeRowColExtent(e,i,r,s){const n=.001*(e[2]-e[0]+(e[3]-e[1]));s[0]=Math.max(0,Math.floor((e[0]+n-r[0])/i[0])),s[2]=Math.max(0,Math.ceil((e[2]-n-r[0])/i[0])),s[1]=Math.max(0,Math.floor((r[1]-e[3]+n)/i[1])),s[3]=Math.max(0,Math.ceil((r[1]-e[1]-n)/i[1]))}static isPowerOfTwo(e){const i=e.lods,r=i[0].resolution*2**i[0].level;return!i.some(s=>!MK(s.resolution,r/2**s.level))}static hasGapInLevels(e){const i=e.lods.map(r=>r.level);i.sort((r,s)=>r-s);for(let r=1;r<i.length;r++)if(i[r]!==i[0]+r)return!0;return!1}static tileSizeSupported(e){const i=e.size[1];return i===e.size[0]&&!(i&i-1)&&i>=128&&i<=512}static hasOriginPerLODs(e){const i=e.origin;return e.lods.some(r=>r.origin!=null&&(r.origin[0]!==i.x||r.origin[1]!==i.y))}static getMissingTileInfoError(){return new ee("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(e){return e==null?Jte():e.lods.length<1?new ee("tilingscheme:generic","Tiling scheme must have at least one level"):Bn.isPowerOfTwo(e)?Bn.hasGapInLevels(e)?new ee("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):Bn.tileSizeSupported(e)?Bn.hasOriginPerLODs(e)?new ee("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new ee("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new ee("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(e,i){const r=e[2]-e[0],s=e[3]-e[1],n=Wr(i),a=1.2*Math.max(r,s),o=256,l=a/o,c=l*n*(96/.0254),h=new Bn(new to({size:[o,o],origin:new Qe({x:e[0]-.5*(a-r),y:e[3]+.5*(a-s)}),lods:[new wa({level:0,resolution:l,scale:c})],spatialReference:i}));return h.ensureMaxLod(20),h}static makeWebMercatorAuxiliarySphere(e){const i=new Bn(Bn.WebMercatorAuxiliarySphereTileInfo);return i.ensureMaxLod(e),i}static makeGCSWithTileSize(e,i=256,r=16){const s=256/i,n=new Bn(new to({size:[i,i],origin:new Qe({x:-180,y:90,spatialReference:e}),spatialReference:e,lods:[new wa({level:0,resolution:.703125*s,scale:295497598570834e-6*s})]}));return n.ensureMaxLod(r),n}get test(){}},Bn.WebMercatorAuxiliarySphereTileInfo=new to({size:[256,256],origin:new Qe({x:-20037508342787e-6,y:20037508342787e-6,spatialReference:Ie.WebMercator}),spatialReference:Ie.WebMercator,lods:[new wa({level:0,resolution:156543.03392800014,scale:591657527591555e-6})]}),Bn.WebMercatorAuxiliarySphere=Bn.makeWebMercatorAuxiliarySphere(19),Bn);function Jte(){return new ee("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}const Hp=Pi(),v3=64,SO=512,Jot=2.5,Kte=qje(fW/10),mAe=2,gAe=Pi();Zd.WebMercatorAuxiliarySphere.getExtent(0,0,0,gAe);const Kot=Pi([-180,-90,180,90]),elt="Cannot extend surface to encompass all layers because it would result in too many root tiles.",tlt="Surface extent is too large for tile resolution at level 0.",Tn=4;let b3=class extends aD{constructor(e){super(e),this.noDataValue=Kte}};d([m({constructOnly:!0})],b3.prototype,"view",void 0),d([m({readOnly:!0})],b3.prototype,"noDataValue",void 0),b3=d([k("esri.views.support.GroundViewElevationSampler")],b3);let ST=class extends b3{initialize(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))}get demResolution(){return this.view.basemapTerrain.demResolution}get extent(){const e=this.view.basemapTerrain;if(e?.extent==null||e.spatialReference==null)return null;const i=fU(e.extent,e.spatialReference);return i.zmin=e.visibleElevationBounds.min,i.zmax=e.visibleElevationBounds.max,i}get spatialReference(){return this.view.basemapTerrain?.spatialReference??Ie.WGS84}elevationAt(e,i){if(this.extent==null||!Mo(this.extent,e,i)){const r=this.extent!=null?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;return fe.getLogger(this).warn("#elevationAt()",`Point used to sample elevation (${e}, ${i}) is outside of the sampler extent (${r})`),this.noDataValue}return this.view.elevationProvider?.getElevation(e,i,0,this.spatialReference,"ground")??this.noDataValue}};d([m({readOnly:!0})],ST.prototype,"demResolution",null),d([m({readOnly:!0})],ST.prototype,"extent",null),d([m()],ST.prototype,"spatialReference",null),ST=d([k("esri.views.support.GroundElevationSampler")],ST);let TT=class extends b3{get demResolution(){return this.view.basemapTerrain.demResolution}get extent(){return this.view.map.allLayers.reduce((e,i)=>i.type!=="integrated-mesh"&&i.type!=="integrated-mesh-3dtiles"||!i.fullExtent?e:e?e.union(i.fullExtent):i.fullExtent.clone(),null)}get spatialReference(){return this.view.spatialReference}elevationAt(e,i){return this.extent!=null&&Mo(this.extent,e,i)?this.view.elevationProvider.getElevation(e,i,0,this.spatialReference,"im")??this.noDataValue:this.noDataValue}};d([m({readOnly:!0})],TT.prototype,"demResolution",null),d([m({readOnly:!0})],TT.prototype,"extent",null),d([m()],TT.prototype,"spatialReference",null),TT=d([k("esri.views.support.IntegratedMeshElevationSampler")],TT);let lf=class extends Me{constructor(e){super(e),this.view=null,this.layerViews=new He}initialize(){this.addHandles(Zs(()=>this.view?.map?.ground,async e=>e.load())),this.view.type==="3d"&&this.addHandles([K(()=>this.view.map?.basemap,()=>this._groundLayersChanged(),{initial:!0}),K(()=>this.view.map?.basemap?.groundLayers,e=>{this._groundLayersChanged(),e?.on("after-changes",()=>this._groundLayersChanged())},{initial:!0}),K(()=>this.view.basemapView?.groundLayerViews,e=>{this._groundLayersChanged(),e?.on("after-changes",()=>this._groundLayersChanged())},{initial:!0}),Zs(()=>this.view.type==="3d"&&(this.view?.basemapTerrain??!1),async()=>{this._groundLayersChanged()})])}_groundLayersChanged(){const{view:e}=this;if(e!=null&&e.type==="3d"){const i=e.basemapTerrain;if(i){const r=e.map?.basemap?.groundLayers.some(s=>!!e.basemapView?.groundLayerViews.find(n=>n.layer===s)&&"replacesTerrain"in s&&s.replacesTerrain);i.enable(!r)}}}get ground(){return this.view?.map?.ground}destroy(){this._set("view",null),this.layerViews.destroyAll()}get elevationSampler(){return this.view.type==="3d"?new ST({view:this.view}):null}get integratedMeshElevationSampler(){return this.view?new TT({view:this.view}):null}get extent(){const{view:e}=this;return e?.ready?hAe(e,e.state.camera,e.pointsOfInterest.centerOnSurfaceFrequent.renderLocation):null}get updating(){return!this.suspended&&this.layerViews.some(({updating:e})=>e)}get suspended(){return this.view?.suspended??!0}};d([m({readOnly:!0})],lf.prototype,"elevationSampler",null),d([m({readOnly:!0})],lf.prototype,"integratedMeshElevationSampler",null),d([m({readOnly:!0})],lf.prototype,"extent",null),d([m({type:Boolean,readOnly:!0})],lf.prototype,"updating",null),d([m({constructOnly:!0})],lf.prototype,"view",void 0),d([m({type:He,readOnly:!0})],lf.prototype,"layerViews",void 0),d([m({readOnly:!0})],lf.prototype,"suspended",null),lf=d([k("esri.views.GroundView")],lf);const ilt=lf;let du=class extends s2(ilt){constructor(e){super(e)}initialize(){super.initialize(),this.addHandles(Zs(()=>this._terrainSurface,e=>e.on("elevation-change",i=>this._elevationChange(i)))),this.addHandles(Zs(()=>this._integratedMeshGroundLayerView,e=>{this.removeHandles(ife),e&&this.addHandles(e.elevationProvider.on("elevation-change",i=>this._elevationChange(i)),ife)}))}_elevationChange(e){this.emit("elevation-change",e)}get _integratedMeshGroundLayerView(){const e=this.ground?.integratedMeshGround;if(e)return this.view.basemapView?.groundLayerViews.find(i=>i.layer===e)}get _terrainSurface(){return this.view.basemapTerrain}get _usingTerrain(){return this._terrainSurface?.enabled??!1}get _usingIntegratedMesh(){return this._integratedMeshGroundLayerView?.visible??!1}get spatialReference(){return this._terrainSurface?.spatialReference}intersect(e,i,r,s){this._source?.intersect(e,i,r,s)}get updating(){return!this.suspended&&((this._source?.updating??!1)||this.layerViews.some(({updating:e})=>e))}get elevationQueryCache(){return this._usingTerrain?this._terrainSurface?.elevationQueryCache:null}get extentAABR(){return this._terrainSurface?.extent}get suspended(){return this._source?.suspended??!1}get ready(){return this._source?.ready??!0}updateOverlayParameters(){this._terrainSurface?.updateOverlayParameters()}get _source(){return this._usingTerrain?this._terrainSurface:this._usingIntegratedMesh?this._integratedMeshGroundLayerView:null}requestRender(e){this.view.stage.renderView?.requestRender(e)}};d([m({readOnly:!0})],du.prototype,"_integratedMeshGroundLayerView",null),d([m({readOnly:!0})],du.prototype,"_terrainSurface",null),d([m({readOnly:!0})],du.prototype,"_usingTerrain",null),d([m({readOnly:!0})],du.prototype,"_usingIntegratedMesh",null),d([m({readOnly:!0})],du.prototype,"spatialReference",null),d([m({type:Boolean,readOnly:!0})],du.prototype,"updating",null),d([m({readOnly:!0})],du.prototype,"elevationQueryCache",null),d([m({readOnly:!0})],du.prototype,"extentAABR",null),d([m({readOnly:!0})],du.prototype,"suspended",null),d([m({readOnly:!0})],du.prototype,"ready",null),du=d([k("esri.views.3d.GroundView3D")],du);const ife=Symbol("integratedMeshHandleKey"),tA=()=>te(()=>import("./TileLayerView3D-C3ykbYHQ.js"),__vite__mapDeps([191,192,193,194,158,195,196,197,198,199,200,201])),rfe=()=>te(()=>import("./ElevationLayerView3D-BQADmj_O.js"),__vite__mapDeps([202,175,192,193,200])),sfe={"base-dynamic":()=>te(()=>import("./BaseDynamicLayerView3D-CyUDo_fG.js"),__vite__mapDeps([203,204,205,206,207,208,192,200,201])),"base-elevation":rfe,"base-tile":tA,"bing-maps":tA,"building-scene":()=>te(()=>import("./BuildingSceneLayerView3D-BNbOEqBJ.js"),__vite__mapDeps([209,210,135,133,134,136,137,39,129,138,139,140,141,66,142,143,144,145,146,147,122,123,103,98,47,81,74,99,100,101,57,25,102,18,148,149,150,151,152,153,154,155,95,96,97,49,54,4,156,157,158,159,160,161,162,163,164,165,166,167,168,211,212,213,214,215,75,199,216,1,217,218,219,220,221,222,223,224,21,86,85,225,226,227,228,229,16,0,17,19,3,5,6,7,20,230,231,192,200])),catalog:()=>te(()=>import("./CatalogLayerView3D-B3kzPIzR.js"),__vite__mapDeps([232,192,200])),"catalog-dynamic-group":()=>te(()=>import("./CatalogDynamicGroupLayerView3D-CV9mvlx2.js"),__vite__mapDeps([233,192,200])),"catalog-footprint":()=>te(()=>import("./CatalogFootprintLayerView3D-BeIeBk9L.js"),__vite__mapDeps([234,235,236,230,237,17,18,225,226,227,122,123,103,98,47,81,74,99,100,101,57,25,102,107,238,126,127,54,239,240,186,241,224,21,199,242,145,197,16,0,1,19,3,4,5,6,7,20,243,129,14,15,192,38,36,37,39,244,68,245,66,144,215,200,201])),csv:()=>te(()=>import("./CSVLayerView3D-CIpNszv_.js"),__vite__mapDeps([246,235,236,230,237,17,18,225,226,227,122,123,103,98,47,81,74,99,100,101,57,25,102,107,238,126,127,54,239,240,186,241,224,21,199,242,145,197,16,0,1,19,3,4,5,6,7,20,243,129,14,15,192,38,36,37,39,244,68,245,66,144,215,200,201])),dimension:()=>te(()=>import("./DimensionLayerView3D-AlFv4Pj4.js"),__vite__mapDeps([247,192,248,200])),elevation:rfe,feature:()=>te(()=>import("./FeatureLayerView3D-DyWG0Kls.js"),__vite__mapDeps([249,136,235,236,230,237,17,18,225,226,227,122,123,103,98,47,81,74,99,100,101,57,25,102,107,238,126,127,54,239,240,186,241,224,21,199,242,145,197,16,0,1,19,3,4,5,6,7,20,243,129,14,15,192,38,36,37,39,244,68,245,66,144,215,200,201])),"gaussian-splat":()=>te(()=>import("./GaussianSplatLayerView3D-CVVpBq-w.js"),__vite__mapDeps([250,251,192,200])),geojson:()=>te(()=>import("./GeoJSONLayerView3D-BWooyiLO.js"),__vite__mapDeps([252,235,236,230,237,17,18,225,226,227,122,123,103,98,47,81,74,99,100,101,57,25,102,107,238,126,127,54,239,240,186,241,224,21,199,242,145,197,16,0,1,19,3,4,5,6,7,20,243,129,14,15,192,38,36,37,39,244,68,245,66,144,215,200,201])),graphics:()=>te(()=>import("./GraphicsLayerView3D-CQLAnRDF.js"),__vite__mapDeps([253,192,239,254,47,241,99,224,98,81,74,100,101,57,25,102,21,199,242,226,200,227])),group:()=>te(()=>import("./GroupLayerView3D-BwWaQTXU.js"),__vite__mapDeps([255,200])),imagery:()=>te(()=>import("./ImageryLayerView3D-Cd6CTTUP.js"),__vite__mapDeps([256,204,205,206,207,208,192,200,201,196,83,257,106,107,258,187,230,80,199])),"integrated-mesh":()=>te(()=>import("./IntegratedMeshLayerView3D-DSBT2vk5.js"),__vite__mapDeps([259,217,218,219,220,221,214,215,75,222,123,223,99,47,224,98,81,74,100,101,57,25,102,21,199,86,85,225,226,227,192,200])),"integrated-mesh-3dtiles":()=>te(()=>import("./IntegratedMesh3DTilesLayerView3D-CvYEArLX.js"),__vite__mapDeps([260,218,219,223,86,192,222,200])),"line-of-sight":()=>te(()=>import("./LineOfSightLayerView3D-DoQ3iQf1.js"),__vite__mapDeps([261,192,248,200])),"map-image":()=>te(()=>import("./MapImageLayerView3D-qtkRv1lS.js"),__vite__mapDeps([262,204,205,206,207,208,192,200,201,195,196,197,198,199,263,230])),media:()=>te(()=>import("./MediaLayerView3D-GlNYNFoX.js").then(t=>t.M),__vite__mapDeps([264,265,65,192,55,266,267,268,269,270,271,206,207,208,200,227])),"ogc-feature":()=>te(()=>import("./OGCFeatureLayerView3D-wsp6f2lq.js"),__vite__mapDeps([272,235,236,230,237,17,18,225,226,227,122,123,103,98,47,81,74,99,100,101,57,25,102,107,238,126,127,54,239,240,186,241,224,21,199,242,145,197,16,0,1,19,3,4,5,6,7,20,243,129,14,15,192,38,36,37,39,244,68,245,66,144,215,200,201])),"open-street-map":tA,"oriented-imagery":()=>te(()=>import("./FeatureLayerView3D-DyWG0Kls.js"),__vite__mapDeps([249,136,235,236,230,237,17,18,225,226,227,122,123,103,98,47,81,74,99,100,101,57,25,102,107,238,126,127,54,239,240,186,241,224,21,199,242,145,197,16,0,1,19,3,4,5,6,7,20,243,129,14,15,192,38,36,37,39,244,68,245,66,144,215,200,201])),"point-cloud":()=>te(()=>import("./PointCloudLayerView3D-23tBfkAe.js"),__vite__mapDeps([273,219,16,0,1,17,18,19,3,4,5,6,7,20,129,192,231,214,215,75,72,73,74,226,274,199,200,227])),viewshed:()=>te(()=>import("./ViewshedLayerView3D-BXHxxllb.js"),__vite__mapDeps([275,192,248,200])),voxel:()=>te(()=>import("./VoxelLayerView3D-DPh-x7_t.js"),__vite__mapDeps([276,192,277,274,199,200])),route:()=>te(()=>import("./RouteLayerView3D-DFZsK7l6.js"),__vite__mapDeps([278,279,280,192,254,47,241,99,224,98,81,74,100,101,57,25,102,21,199,242,226,244,200,227])),scene:t=>t.profile==null||t.profile==="mesh-pyramids"?te(()=>import("./SceneLayerView3D-D-LHwWYp.js"),__vite__mapDeps([281,1,145,197,217,218,219,220,221,214,215,75,222,123,223,99,47,224,98,81,74,100,101,57,25,102,21,199,86,85,225,226,227,192,282,229,16,0,17,18,19,3,4,5,6,7,20,230,200,228,129,231,274])):te(()=>import("./SceneLayerGraphicsView3D-D2HP9xwN.js"),__vite__mapDeps([283,220,219,221,214,215,75,222,123,145,192,240,186,47,241,99,224,98,81,74,100,101,57,25,102,21,199,242,197,16,0,1,17,18,19,3,4,5,6,7,20,243,129,226,282,229,230,200,225,274,227])),stream:()=>te(()=>import("./StreamLayerView3D-C1oJU0uS.js"),__vite__mapDeps([284,236,230,237,17,18,225,226,227,122,123,103,98,47,81,74,99,100,101,57,25,102,107,238,126,127,54,239,240,186,241,224,21,199,242,145,197,16,0,1,19,3,4,5,6,7,20,243,129,14,15,192,69,48,70,38,36,37,39,244,200])),tile:tA,"imagery-tile":()=>te(()=>import("./ImageryTileLayerView3D-7nOOY56T.js"),__vite__mapDeps([285,80,192,193,83,257,106,107,205,258,187,230,286,199,200,201])),"vector-tile":()=>te(()=>import("./VectorTileLayerView3D-BAQhK1rI.js"),__vite__mapDeps([287,59,37,51,91,192,193,200])),wcs:()=>te(()=>import("./ImageryTileLayerView3D-7nOOY56T.js"),__vite__mapDeps([285,80,192,193,83,257,106,107,205,258,187,230,286,199,200,201])),"web-tile":tA,wfs:()=>te(()=>import("./WFSLayerView3D-CFINV5Ga.js"),__vite__mapDeps([288,235,236,230,237,17,18,225,226,227,122,123,103,98,47,81,74,99,100,101,57,25,102,107,238,126,127,54,239,240,186,241,224,21,199,242,145,197,16,0,1,19,3,4,5,6,7,20,243,129,14,15,192,38,36,37,39,244,68,245,66,144,215,200,201])),wms:()=>te(()=>import("./WMSLayerView3D-DH4mLrfJ.js"),__vite__mapDeps([289,204,205,206,207,208,192,200,201,290,230])),wmts:()=>te(()=>import("./WMTSLayerView3D-BIQ-b_Nm.js"),__vite__mapDeps([291,192,193,194,158,200,201])),"geo-rss":null,kml:null,"knowledge-graph-sublayer":null,"knowledge-graph":null,"link-chart":null,"map-notes":null,parquet:null,"subtype-group":null,unknown:null,unsupported:null,video:null};function rlt(t){const e=t.declaredClass?t.declaredClass.slice(t.declaredClass.lastIndexOf(".")+1):"Unknown",i=e.replaceAll(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new ee(`${i}:view-not-supported`,`${e} is not supported in 3D`)}const nfe={hasLayerViewModule:t=>sfe[t.type]!=null,importLayerView:t=>{const e=sfe[t.type];if(e==null)throw rlt(t);return e(t)}},slt={"area-measurement":()=>te(()=>import("./AreaMeasurementAnalysisView3D-qxrykYF6.js"),__vite__mapDeps([292,293,294,295,296,258,297,207,267,268,269,298,299,300,208,301,302,303,304,305,306,307,308,309,310,311,312,313,238,270,271,314])),dimension:()=>te(()=>import("./DimensionAnalysisView3D-CcpDwkMk.js"),__vite__mapDeps([315,293,299,296,300,316,295,258,297,207,309,310,267,268,269,317,302,303,304,305,306,307,308,318,206,208,301,313,238,270,271,314,312,311,298,319])),"direct-line-measurement":()=>te(()=>import("./DirectLineMeasurementAnalysisView3D-CZkUt73o.js"),__vite__mapDeps([320,293,295,296,258,297,207,298,299,300,302,303,304,305,306,307,308,301,294,309,310,267,268,269,312,313,238,270,271])),"elevation-profile":()=>te(()=>import("./ElevationProfileAnalysisView3D-CItFX3ke.js"),__vite__mapDeps([321,293,322,301,323,304,296,305,258,324,325,30,326,327,328,329,330,331,332,64,333,334,335,336,337,55,266,338])),"line-of-sight":()=>te(()=>import("./LineOfSightAnalysisView3D-sIFpk1Mp.js"),__vite__mapDeps([339,293,340,295,296,258,297,207,341,342,305,312,310,267,268,269,306])),slice:()=>te(()=>import("./SliceAnalysisView3D-NTFHH9p-.js"),__vite__mapDeps([343,293,344,210,135,133,134,136,137,39,129,138,139,140,141,66,142,143,144,145,146,147,122,123,103,98,47,81,74,99,100,101,57,25,102,18,148,149,150,151,152,153,154,155,95,96,97,49,54,4,156,157,158,159,160,161,162,163,164,165,166,167,168,211,212,213,214,215,75,199,345,346,295,296,258,297,207,208,317,347,206,309,310,267,268,269,312,311,301])),viewshed:()=>te(()=>import("./ViewshedAnalysisView3D-BsB_Tei9.js"),__vite__mapDeps([348,340,293,295,296,258,297,207,309,310,267,268,269,349,350,322,301,346,303,304,305,312,311,306])),"volume-measurement":()=>te(()=>import("./VolumeMeasurementAnalysisView3D-ZlC7w3iv.js"),__vite__mapDeps([351,293,295,296,258,297,207,352,20,241,99,325,30,298,299,300,323,304,305,324,301,345,346,344,208,309,310,267,268,269,353,354,125,355,356,338,271]))};function nlt(t){const e=slt[t.type];if(!e)throw new ee("analysis-view-module-import-utils:analysis-not-supported",`Analysis "${t.type}" is not supported`);return e()}let tg=class extends Me{constructor(e){super(e),this.collision=new TO,this.distance=1/0,this.minimumPoiDistance=4,this.tilt=null}get altitude(){return this.mode===2?null:this._get("altitude")||null}set altitude(e){this.mode!==2?this._set("altitude",e):fe.getLogger(this).warn("Altitude constraint is ignored in local scenes")}get mode(){return this.state.viewingMode}clampAltitude(e){return this.altitude?Se(e,this.altitude.min,this.altitude.max):e}clampTilt(e,i){if(!this.tilt)return i;const r=this.tilt(e);return Se(i,r.min,r.max)}clampDistance(e){return Math.min(e,this.distance)}createDefaultTilt(){return this.mode===2?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()}createConstantMaxTilt(e){return(i,r=Z7)=>(r.min=no.min,r.max=e,r)}_createDefaultTiltLocal(){const e=this.collision.enabled?pz([[4e3,no.max],[1e4,Lt(88)],[6e6,Lt(88)]]):()=>no.max;return(i,r=Z7)=>(r.min=no.min,r.max=e(i),r)}_createDefaultTiltGlobal(){const e=this.collision.enabled?pz([[4e3,no.max],[5e4,Lt(88)],[6e6,Lt(88)],[2e7,no.min]]):pz([[3e5,no.max],[3e6,Lt(88)],[6e6,Lt(88)],[2e7,no.min]]);return(i,r=Z7)=>(r.min=no.min,r.max=e(i),r)}};function alt(t){return{min:-2e5,max:4*t.radius}}d([m()],tg.prototype,"altitude",null),d([m({readOnly:!0})],tg.prototype,"collision",void 0),d([m()],tg.prototype,"distance",void 0),d([m({readOnly:!0})],tg.prototype,"minimumPoiDistance",void 0),d([m()],tg.prototype,"tilt",void 0),d([m({constructOnly:!0})],tg.prototype,"state",void 0),tg=d([k("esri.views.3d.state.Constraints")],tg);const afe=alt(mi),no={min:Lt(.5),max:Lt(179.5)},Z7={min:0,max:0};let TO=class extends Me{constructor(){super(...arguments),this.enabled=!0,this.elevationMargin=5}};d([m({type:Boolean})],TO.prototype,"enabled",void 0),d([m({type:Number})],TO.prototype,"elevationMargin",void 0),TO=d([k("esri.views.3d.state.Constraints.CollisionConstraint")],TO);let w3=class extends Nv{constructor(){super(...arguments),this.min=afe.min,this.max=afe.max}};d([m({type:Number})],w3.prototype,"min",void 0),d([m({type:Number})],w3.prototype,"max",void 0),w3=d([k("esri.views.3d.constraints.AltitudeConstraint")],w3);let Mg=class extends Nv{constructor(){super(...arguments),this.mode="auto"}get near(){return this._get("near")}set near(e){this._set("near",e),e>=this._get("far")&&(this.far=e+1e-9),this.mode="manual"}castNear(e){return Math.max(1e-8,e)}get far(){return this._get("far")}set far(e){this._set("far",e),e<=this._get("near")&&(this.near=e-1e-9),this.mode="manual"}castFar(e){return Math.max(1e-8,e)}autoUpdate(e,i){this.mode==="auto"&&(this._get("near")!==e&&this._set("near",e),this._get("far")!==i&&this._set("far",i))}};d([m({type:Number,value:1e-8})],Mg.prototype,"near",null),d([qr("near")],Mg.prototype,"castNear",null),d([m({type:Number,value:1e-8})],Mg.prototype,"far",null),d([qr("far")],Mg.prototype,"castFar",null),d([m({type:["auto","manual"]})],Mg.prototype,"mode",void 0),Mg=d([k("esri.views.3d.constraints.ClipDistanceConstraint")],Mg);const SQ={min:Ea(no.min),max:Ea(no.max)};let Nb=class extends Nv{constructor(e){super(e),this.mode="auto"}get max(){return this._get("max")}set max(e){this._set("max",e),this.mode="manual"}castMax(e){return Se(e,SQ.min,SQ.max)}autoUpdate(e){this.mode==="auto"&&this._get("max")!==e&&this._set("max",e)}};d([m({type:["auto","manual"]})],Nb.prototype,"mode",void 0),d([m({type:Number,value:SQ.max})],Nb.prototype,"max",null),d([qr("max")],Nb.prototype,"castMax",null),Nb=d([k("esri.views.3d.constraints.TiltConstraint")],Nb);let Vb=class extends Nv{constructor(e){super(e),this.tilt=new Nb,this.altitude=new w3,this.clipDistance=new Mg}};d([m({type:Nb,nonNullable:!0})],Vb.prototype,"tilt",void 0),d([m({type:w3,nonNullable:!0})],Vb.prototype,"altitude",void 0),d([m({type:Mg,nonNullable:!0})],Vb.prototype,"clipDistance",void 0),Vb=d([k("esri.views.3d.constraints.Constraints")],Vb);function ofe(t){return fs(t,u3)||ZD(t)?{wkid:104971}:fs(t,h3)||YD(t)?{wkid:104903}:Ie.WGS84}let iA=class{constructor(e,i,r,s,n,a,o,l,c=.5){this.coverage=e,this.density=i,this.absorption=r,this.cloudSize=s,this.detailSize=n,this.smoothness=a,this.cloudHeight=o,this.raymarchingSteps=l,this.median=c}};const eo={sunny:new iA([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],0),cloudy:new iA([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],2,.6),rainy:new iA([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],2,.4),snowy:new iA([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],1,.65),foggy:new iA([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],0)};eo.default=eo.sunny;function Ac(){return new Float32Array(3)}function TQ(t){const e=new Float32Array(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Ji(t,e,i){const r=new Float32Array(3);return r[0]=t,r[1]=e,r[2]=i,r}function yAe(){return Ac()}function _Ae(){return Ji(1,1,1)}function vAe(){return Ji(1,0,0)}function bAe(){return Ji(0,1,0)}function wAe(){return Ji(0,0,1)}const olt=yAe(),llt=_Ae(),clt=vAe(),ult=bAe(),hlt=wAe();Object.freeze(Object.defineProperty({__proto__:null,ONES:llt,UNIT_X:clt,UNIT_Y:ult,UNIT_Z:hlt,ZEROS:olt,clone:TQ,create:Ac,fromValues:Ji,ones:_Ae,unitX:vAe,unitY:bAe,unitZ:wAe,zeros:yAe},Symbol.toStringTag,{value:"Module"}));const Ih=ie("esri-mobile")?64:128,dlt=Ih/128,Vd=Math.ceil(Math.sqrt(Ih)),ty=(Ih+2)*Vd,plt=1e5,Q5=128,flt=ty/1560,E=(t,...e)=>{let i="";for(let r=0;r<e.length;r++)i+=t[r]+e[r];return i+=t[t.length-1],i};function _e(t,e,i=""){return t?e:i}E.int=t=>Math.round(t).toString(),E.float=t=>t.toPrecision(8);function Oa(t,e=!0){t.attributes.add("position","vec2"),e&&t.varyings.add("uv","vec2"),t.vertex.main.add(E`
      gl_Position = vec4(position, 0.0, 1.0);
      ${e?E`uv = position * 0.5 + vec2(0.5);`:""}
  `)}let Ni=class{constructor(e,i,r,s,n=null){if(this.name=e,this.type=i,this.arraySize=n,this.bind={0:null,1:null,2:null},s)switch(r){case void 0:break;case 0:this.bind[0]=s;break;case 1:this.bind[1]=s;break;case 2:this.bind[2]=s}}equals(e){return this.type===e.type&&this.name===e.name&&this.arraySize===e.arraySize}},VC=class extends Ni{constructor(e,i){super(e,"bool",1,(r,s,n)=>r.setUniform1b(e,i(s,n)))}},ll=class extends Ni{constructor(e,i,r){super(e,"vec2",1,(s,n,a)=>s.setUniform2fv(e,i(n,a),r))}},ut=class extends Ni{constructor(e,i,r){super(e,"float",1,(s,n,a)=>s.setUniform1f(e,i(n,a),r))}},Ap=class extends Ni{constructor(e,i,r){super(e,"mat3",1,(s,n,a)=>s.setUniformMatrix3fv(e,i(n,a),r))}},zt=class extends Ni{constructor(e,i){super(e,"sampler2D",1,(r,s,n)=>r.bindTexture(e,i(s,n)))}};function f4(t){t.code.add(E`vec2 sphereIntersect(vec3 start, vec3 dir, float distance) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * distance;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`)}let mlt=class{};const hr=mlt,kjt=new hr,eie=()=>fe.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");let xAe=class{constructor(){this._includedModules=new Map}include(e,i){this._includedModules.has(e)?this._includedModules.get(e):(this._includedModules.set(e,i),e(this.builder,i))}},Di=class extends xAe{constructor(){super(...arguments),this.vertex=new lfe,this.fragment=new lfe,this.attributes=new vlt,this.varyings=new blt,this.extensions=new wlt,this.outputs=new xlt}get fragmentUniforms(){return this.fragment.uniforms.entries}get attributeNames(){return this.attributes.names}get builder(){return this}generate(e,i=!1){const r=this.extensions.generateSource(e),s=this.attributes.generateSource(e),n=this.varyings.generateSource(e),a=e==="vertex"?this.vertex:this.fragment,o=a.uniforms.generateSource(),l=a.code.generateSource(),c=a.main.generateSource(i),h=e==="vertex"?$lt:Tlt,f=a.constants.generateSource(),y=this.outputs.generateSource(e);return`#version 300 es
${r.join(`
`)}
${h}
${f.join(`
`)}
${o.join(`
`)}
${s.join(`
`)}
${n.join(`
`)}
${y.join(`
`)}
${l.join(`
`)}
${c.join(`
`)}`}generateBind(e){const i=new Map;this.vertex.uniforms.entries.forEach(n=>{const a=n.bind[0];a&&i.set(n.name,a)}),this.fragment.uniforms.entries.forEach(n=>{const a=n.bind[0];a&&i.set(n.name,a)});const r=Array.from(i.values()),s=r.length;return n=>{for(let a=0;a<s;++a)r[a](e,n)}}generateBindPass(e){const i=new Map;this.vertex.uniforms.entries.forEach(n=>{const a=n.bind[1];a&&i.set(n.name,a)}),this.fragment.uniforms.entries.forEach(n=>{const a=n.bind[1];a&&i.set(n.name,a)});const r=Array.from(i.values()),s=r.length;return(n,a)=>{for(let o=0;o<s;++o)r[o](e,n,a)}}generateBindDraw(e){const i=new Map;this.vertex.uniforms.entries.forEach(n=>{const a=n.bind[2];a&&i.set(n.name,a)}),this.fragment.uniforms.entries.forEach(n=>{const a=n.bind[2];a&&i.set(n.name,a)});const r=Array.from(i.values()),s=r.length;return(n,a,o)=>{for(let l=0;l<s;++l)r[l](e,o,n,a)}}},glt=class{constructor(e){this._stage=e,this._entries=new Map}add(...e){for(const i of e)this._add(i);return this._stage}get(e){return this._entries.get(e)}_add(e){if(e!=null){if(this._entries.has(e.name)&&!this._entries.get(e.name).equals(e))throw new ee("shaderbuilder:duplicate-uniform",`Duplicate uniform name ${e.name} for different uniform type`);this._entries.set(e.name,e)}else eie().error(`Trying to add null Uniform from ${new Error().stack}.`)}generateSource(){return Array.from(this._entries.values()).map(({name:e,arraySize:i,type:r})=>i!=null?`uniform ${r} ${e}[${i}];`:`uniform ${r} ${e};`)}get entries(){return Array.from(this._entries.values())}},ylt=class{constructor(e){this._stage=e,this._bodies=new Array}add(e){return this._bodies.push(e),this._stage}generateSource(e){if(this._bodies.length>0)return[`void main() {
 ${this._bodies.join(`
`)||""} 
}`];if(e)throw new ee("shaderbuilder:missing-main","Shader does not contain main function body.");return[]}},_lt=class{constructor(e){this._stage=e,this._entries=new Array}add(e){return this._entries.push(e),this._stage}generateSource(){return this._entries}},lfe=class extends xAe{constructor(){super(...arguments),this.uniforms=new glt(this),this.main=new ylt(this),this.code=new _lt(this),this.constants=new Slt(this)}get builder(){return this}},vlt=class{constructor(){this._entries=new Array}add(e,i){this._entries.push([e,i])}generateSource(e){return e==="fragment"?[]:this._entries.map(i=>`in ${i[1]} ${i[0]};`)}get names(){return this._entries.map(([e])=>e)}},blt=class{constructor(){this._entries=new Map}add(e,i,r){this._entries.has(e)?eie().warn(`Ignoring duplicate varying ${i} ${e}`):this._entries.set(e,{type:i,invariant:r?.invariant??!1})}generateSource(e){const i=new Array;return this._entries.forEach((r,s)=>i.push((r.invariant&&e==="vertex"?"invariant ":"")+(r.type==="int"?"flat ":"")+(e==="vertex"?"out":"in")+` ${r.type} ${s};`)),i}};var Zg;let wlt=(Zg=class{constructor(){this._entries=new Set}add(e){this._entries.add(e)}generateSource(e){const i=e==="vertex"?Zg.ALLOWLIST_VERTEX:Zg.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(r=>i.includes(r)).map(r=>`#extension ${r} : enable`)}},Zg.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],Zg.ALLOWLIST_VERTEX=[],Zg);var Yg;let xlt=(Yg=class{constructor(){this._entries=new Map}add(e,i,r=0){const s=this._entries.get(r);s?.name!==e||s?.type!==i?this._entries.set(r,{name:e,type:i}):eie().warn(`Fragment shader output location ${r} occupied`)}generateSource(e){if(e==="vertex")return[];this._entries.size===0&&this._entries.set(0,{name:Yg.DEFAULT_NAME,type:Yg.DEFAULT_TYPE});const i=new Array;return this._entries.forEach((r,s)=>i.push(`layout(location = ${s}) out ${r.type} ${r.name};`)),i}},Yg.DEFAULT_TYPE="vec4",Yg.DEFAULT_NAME="fragColor",Yg),Slt=class zr{constructor(e){this._stage=e,this._entries=new Set}add(e,i,r){let s="ERROR_CONSTRUCTOR_STRING";switch(i){case"float":s=zr._numberToFloatStr(r);break;case"int":s=zr._numberToIntStr(r);break;case"bool":s=r.toString();break;case"vec2":s=`vec2(${zr._numberToFloatStr(r[0])},                            ${zr._numberToFloatStr(r[1])})`;break;case"vec3":s=`vec3(${zr._numberToFloatStr(r[0])},                            ${zr._numberToFloatStr(r[1])},                            ${zr._numberToFloatStr(r[2])})`;break;case"vec4":s=`vec4(${zr._numberToFloatStr(r[0])},                            ${zr._numberToFloatStr(r[1])},                            ${zr._numberToFloatStr(r[2])},                            ${zr._numberToFloatStr(r[3])})`;break;case"ivec2":s=`ivec2(${zr._numberToIntStr(r[0])},                             ${zr._numberToIntStr(r[1])})`;break;case"ivec3":s=`ivec3(${zr._numberToIntStr(r[0])},                             ${zr._numberToIntStr(r[1])},                             ${zr._numberToIntStr(r[2])})`;break;case"ivec4":s=`ivec4(${zr._numberToIntStr(r[0])},                             ${zr._numberToIntStr(r[1])},                             ${zr._numberToIntStr(r[2])},                             ${zr._numberToIntStr(r[3])})`;break;case"uvec2":s=`uvec2(${zr._numberToIntStr(r[0])},                             ${zr._numberToIntStr(r[1])})`;break;case"uvec3":s=`uvec3(${zr._numberToIntStr(r[0])},                             ${zr._numberToIntStr(r[1])},                             ${zr._numberToIntStr(r[2])})`;break;case"uvec4":s=`uvec4(${zr._numberToIntStr(r[0])},                             ${zr._numberToIntStr(r[1])},                             ${zr._numberToIntStr(r[2])},                             ${zr._numberToIntStr(r[3])})`;break;case"mat2":case"mat3":case"mat4":s=`${i}(${Array.prototype.map.call(r,n=>zr._numberToFloatStr(n)).join(", ")})`}return this._entries.add(`const ${i} ${e} = ${s};`),this._stage}static _numberToIntStr(e){return e.toFixed(0)}static _numberToFloatStr(e){return Number.isInteger(e)?e.toFixed(1):e.toString()}generateSource(){return Array.from(this._entries)}};const Tlt=`#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
  precision highp int;
  precision highp sampler2D;
  precision highp usampler2D;
  precision highp sampler2DArray;
  precision highp sampler2DShadow;
#else
  precision mediump float;
  precision mediump int;
  precision mediump sampler2D;
  precision mediump usampler2D;
  precision mediump sampler2DArray;
  precision mediump sampler2DShadow;
#endif`,$lt=`precision highp float;
 precision highp sampler2D;
 precision highp usampler2D;
 precision highp sampler2DArray;
 precision highp sampler2DShadow;


 invariant gl_Position;
 `;let tie=class extends hr{constructor(){super(...arguments),this.cloudRadius=0,this.cloudSize=0,this.detailSize=0,this.absorption=0,this.density=0,this.smoothness=0,this.cloudHeight=0,this.coverage=0,this.lastSlice=!1,this.viewMatrix=Ir()}};const c$=ie("esri-mobile")?1024:2048;function SAe(t){const e=new Di;e.include(Oa,!1);const i=e.fragment;return i.include(f4),i.uniforms.add(new ut("cloudRadius",r=>r.cloudRadius),new ut("power",r=>ft(35,120,r.absorption)),new ut("sigmaE",r=>1+r.absorption),new ut("density",r=>ft(0,.3,r.density)),new ut("cloudSize",r=>ft(0,.02,Math.max(.01,1-r.cloudSize))),new ut("detailSize",r=>ft(0,.2,Math.max(.01,1-r.detailSize))),new ut("smoothness",r=>ft(0,.5,1-r.smoothness)),new ut("cloudHeight",r=>ft(0,1500,r.cloudHeight)),new ut("coverage",r=>r.coverage),new Ap("view",r=>r.viewMatrix),new zt("cloudShapeTexture",r=>r.noiseTexture!=null?r.noiseTexture.textureAtlas:null),new ll("cloudVariables",r=>Cr(Clt,r.coverage,r.absorption)),new VC("lastSlice",r=>r.lastSlice)),i.constants.add("halfCubeMapSize","float",.5*c$),i.code.add(E`
    const int STEPS = ${t.steps===0?E`16`:t.steps===1?E`100`:E`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord;
      xy.x -= halfCubeMapSize;
      xy.y = lastSlice ? fragCoord.y - halfCubeMapSize : fragCoord.y;

      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`),i.code.add(E`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${E.float(ty)};
      const float dataWidth = ${E.float(ty)};
      const float tileRows = ${E.float(Vd)};
      const vec3 atlasDimensions = vec3(${E.float(Ih)}, ${E.float(Ih)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${E.float(dlt)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = (${E.float(flt)} * p) / ${E.float(ty)} + 0.5;

      return texture(cloudShapeTexture, uv).a;
    }
    `),i.code.add(E`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`),i.code.add(E`float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}
float multipleOctaves(float extinction, float mu, float stepL) {
float attenuation = 1.0;
float contribution = 1.0;
float phaseAttenuation = 1.0;
float luminance = 0.0;
for (int i = 0; i < 4; i++) {
float phase = mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);
luminance += contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);
attenuation *= 0.2;
contribution *= 0.6;
phaseAttenuation *= 0.5;
}
return luminance;
}`),i.code.add(E`float lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
float beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`),i.code.add(E`float mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return 0.0;
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
float shading = 0.0;
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
float luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
shading += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return shading;
}`),i.main.add(E`if (coverage ==  0.0) {
fragColor = vec4(0.0, 1.0, 0.0, 1.0);
return;
}
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
float hazeFactor = smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(dot(rayDir, vec3(0, 0, 1))));
float totalTransmittance = 1.0;
float shading = 0.0;
float cloudDistance = cloudRadius + cloudStart;
float rayStartDistance = dot(viewPos, viewPos) - (cloudDistance * cloudDistance);
vec2 rayStartIntersect = sphereIntersect(viewPos, rayDir, rayStartDistance);
float rayEndDistance = dot(viewPos, viewPos) - ((cloudDistance + cloudHeight) * (cloudDistance + cloudHeight));
vec2 rayEndIntersect = sphereIntersect(viewPos, rayDir, rayEndDistance);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
vec3 sunDirection = normalize(vec3(0, 0, 1));
shading = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance);
shading = mix(clamp(1.0 - cloudVariables.y, 0.6, 1.0), shading, hazeFactor);
totalTransmittance = mix(0.0, totalTransmittance, hazeFactor);
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);`),e}const Clt=pt(),Mlt=Object.freeze(Object.defineProperty({__proto__:null,CloudsPassParameters:tie,build:SAe,cubeMapSize:c$},Symbol.toStringTag,{value:"Module"}));let Ii=class{constructor(e,i){this._module=e,this._load=i}get(){return this._module}async reload(){return this._module=await this._load(),this._module}};function QP(t){return t===4||t===5||t===6||t===7||t===8}function Y7(t){return $Q(t)||t===3}function iie(t){return t===9||t===10}function Elt(t){return TAe(t)||iie(t)}function TAe(t){return t===0}function ds(t){return TAe(t)||u$(t)}function Wjt(t){return ds(t)||t===10}function XP(t){return ds(t)||iie(t)}function $Q(t){return XP(t)||rie(t)}function rie(t){return t===2}function u$(t){return t===1}function Alt(t){return rie(t)||QP(t)}const Olt=()=>fe.getLogger("esri.views.webgl.checkWebGLError");function sie(t){switch(t.getError()){case t.NO_ERROR:return null;case t.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case t.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case t.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case t.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case t.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case t.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}const $Ae=!!ie("enable-feature:webgl-debug");function Ko(){return $Ae}function CQ(){return $Ae}function Cc(t,e=Ko()){if(e){const i=sie(t);if(i){const r=new Error().stack;Olt().error(new ee("webgl-error","WebGL error occurred",{message:i,stack:r}))}}}let cfe=class{constructor(e,i,r){this._context=e,this.locations=r,this._textures=new Map,this.source=Ko()?i:null,i.attributeNames.forEach(s=>{r.has(s)||console.error(`Missing VertexAttributeLocation for ${s} used in shader`)}),this._glProgram=e.programCache.acquire(i.generate("vertex",!0),i.generate("fragment",!0),r),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bind=i.generateBind(this),this.bindPass=i.generateBindPass(this),this.bindDraw=i.generateBindDraw(this)}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get hasTransformFeedbackVaryings(){return this._glProgram.hasTransformFeedbackVaryings}get compiled(){return this._glProgram.compiled}setUniform1b(e,i){this._glProgram.setUniform1i(e,i?1:0)}setUniform1i(e,i){this._glProgram.setUniform1i(e,i)}setUniform1f(e,i,r){this._glProgram.setUniform1f(e,i,r)}setUniform2fv(e,i,r){this._glProgram.setUniform2fv(e,i,r)}setUniform3fv(e,i,r){this._glProgram.setUniform3fv(e,i,r)}setUniform4fv(e,i,r){this._glProgram.setUniform4fv(e,i,r)}setUniformMatrix3fv(e,i,r){this._glProgram.setUniformMatrix3fv(e,i,!1,r)}setUniformMatrix4fv(e,i,r){this._glProgram.setUniformMatrix4fv(e,i,!1,r)}setUniformMatrices4fv(e,i,r){this._glProgram.setUniformMatrices4fv(e,i,!1,r)}setUniform1fv(e,i,r){this._glProgram.setUniform1fv(e,i,r)}setUniform1iv(e,i){this._glProgram.setUniform1iv(e,i)}setUniform2iv(e,i){this._glProgram.setUniform2iv(e,i)}setUniform3iv(e,i){this._glProgram.setUniform3iv(e,i)}setUniform4iv(e,i){this._glProgram.setUniform4iv(e,i)}assertCompatibleVertexAttributeLocations(e,i){let r=e.locations;if(i){const s=new Map(r);i.forEach((n,a)=>s.set(a,r.size+n)),r=s}r.size!==this.locations.size&&console.error(`VertexAttributeLocations are incompatible: ${r}, ${this.locations}`),this.locations.forEach((s,n)=>{r.get(n)!==s&&console.error(`VertexAttributeLocations are incompatible: Program has ${n} at position ${s}, VAO has it at position ${r.get(n)}.`)})}stop(){this._textures.clear()}bindTexture(e,i){i?.glName||(Ko()&&console.error(`Texture sampler ${e} has no given Texture in ${new Error().stack} `),i=this._context.emptyTexture);const r=this._ensureTextureUnit(e,i);this._context.useProgram(this),this.setUniform1i(e,r.unit),this._context.bindTexture(i,r.unit)}_ensureTextureUnit(e,i){let r=this._textures.get(e);return r==null?(r={texture:i,unit:this._textures.size},this._textures.set(e,r)):r.texture=i,r}};const lr={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},ar={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,HALF_FLOAT:5131},tt={RGBA4:32854,R16F:33325,RG16F:33327,RGB32F:34837,RGBA16F:34842,R32F:33326,RG32F:33328,RGBA32F:34836,R11F_G11F_B10F:35898,RGB8:32849,RGBA8:32856,RGB5_A1:32855,R8:33321,RG8:33323,R8I:33329,R8UI:33330,R16I:33331,R16UI:33332,R32I:33333,R32UI:33334,RG8I:33335,RG8UI:33336,RG16I:33337,RG16UI:33338,RG32I:33339,RG32UI:33340,RGB16F:34843,RGB9_E5:35901,SRGB8:35905,SRGB8_ALPHA8:35907,RGB565:36194,RGBA32UI:36208,RGB32UI:36209,RGBA16UI:36214,RGB16UI:36215,RGBA8UI:36220,RGB8UI:36221,RGBA32I:36226,RGB32I:36227,RGBA16I:36232,RGB16I:36233,RGBA8I:36238,RGB8I:36239,R8_SNORM:36756,RG8_SNORM:36757,RGB8_SNORM:36758,RGBA8_SNORM:36759,RGB10_A2:32857,RGB10_A2UI:36975},Plt=Object.values(tt),Kf={DEPTH24_STENCIL8:35056,DEPTH32F_STENCIL8:36013},Hh={DEPTH_COMPONENT16:33189,DEPTH_COMPONENT24:33190,DEPTH_COMPONENT32F:36012},bs={FLOAT:ar.FLOAT,UNSIGNED_BYTE:ar.UNSIGNED_BYTE,UNSIGNED_INT_24_8:34042,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT:ar.UNSIGNED_SHORT,UNSIGNED_INT:ar.UNSIGNED_INT,HALF_FLOAT:5131,FLOAT_32_UNSIGNED_INT_24_8_REV:36269},Q7=33984,Bs={Texture:0,TileTexture:1,BufferObject:2,VertexArrayObject:3,Shader:4,Program:5,FramebufferObject:6,Renderbuffer:7,TransformFeedback:8,Sync:9,UNCOUNTED:10,LinesOfCode:10,Uniform:11,COUNT:12},$T=1029,M6=0,Dr=36064,Do=36065,nie=36066,Ba=33306,CAe=36096,Rlt=36128,Vs={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_SRGB8_ETC2:37493,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37494,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37495,COMPRESSED_RGBA8_ETC2_EAC:37496,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37497};function g2(t,e,i=32774,r=[0,0,0,0]){return{srcRgb:t,srcAlpha:t,dstRgb:e,dstAlpha:e,opRgb:i,opAlpha:i,color:{r:r[0],g:r[1],b:r[2],a:r[3]}}}function Ly(t,e,i,r,s=32774,n=32774,a=[0,0,0,0]){return{srcRgb:t,srcAlpha:e,dstRgb:i,dstAlpha:r,opRgb:s,opAlpha:n,color:{r:a[0],g:a[1],b:a[2],a:a[3]}}}const Dlt=g2(0,771),aie=g2(1,0),Ilt=g2(1,1),Qv=g2(1,771),em=Ly(770,1,771,771),Llt=Ly(0,0,768,1),oie={face:1029,mode:2305},klt={face:1028,mode:2305},MAe=t=>t===2?oie:t===1?klt:null,m4={zNear:0,zFar:1},$i={r:!0,g:!0,b:!0,a:!0};function zlt(t){return Hlt.intern(t)}function Flt(t){return Wlt.intern(t)}function Nlt(t){return Zlt.intern(t)}function Vlt(t){return Ylt.intern(t)}function Ult(t){return Qlt.intern(t)}function Blt(t){return Xlt.intern(t)}function jlt(t){return Jlt.intern(t)}function qlt(t){return Klt.intern(t)}function Glt(t){return ect.intern(t)}function li(t){return tct.intern(t)}let nm=class{constructor(e,i){this._makeKey=e,this._makeRef=i,this._interns=new Map}intern(e){if(!e)return null;const i=this._makeKey(e),r=this._interns;return r.has(i)||r.set(i,this._makeRef(e)),r.get(i)??null}};function am(t){return"["+t.join(",")+"]"}const Hlt=new nm(EAe,t=>({__tag:"Blending",...t}));function EAe(t){return t?am([t.srcRgb,t.srcAlpha,t.dstRgb,t.dstAlpha,t.opRgb,t.opAlpha,t.color.r,t.color.g,t.color.b,t.color.a]):null}const Wlt=new nm(AAe,t=>({__tag:"Culling",...t}));function AAe(t){return t?am([t.face,t.mode]):null}const Zlt=new nm(OAe,t=>({__tag:"PolygonOffset",...t}));function OAe(t){return t?am([t.factor,t.units]):null}const Ylt=new nm(PAe,t=>({__tag:"DepthTest",...t}));function PAe(t){return t?am([t.func]):null}const Qlt=new nm(RAe,t=>({__tag:"StencilTest",...t}));function RAe(t){return t?am([t.function.func,t.function.ref,t.function.mask,t.operation.fail,t.operation.zFail,t.operation.zPass]):null}const Xlt=new nm(DAe,t=>({__tag:"DepthWrite",...t}));function DAe(t){return t?am([t.zNear,t.zFar]):null}const Jlt=new nm(IAe,t=>({__tag:"ColorWrite",...t}));function IAe(t){return t?am([t.r,t.g,t.b,t.a]):null}const Klt=new nm(LAe,t=>({__tag:"StencilWrite",...t}));function LAe(t){return t?am([t.mask]):null}const ect=new nm(kAe,t=>({__tag:"DrawBuffers",...t}));function kAe(t){return t?am(t.buffers):null}const tct=new nm(ict,t=>({blending:zlt(t.blending),culling:Flt(t.culling),polygonOffset:Nlt(t.polygonOffset),depthTest:Vlt(t.depthTest),stencilTest:Ult(t.stencilTest),depthWrite:Blt(t.depthWrite),colorWrite:jlt(t.colorWrite),stencilWrite:qlt(t.stencilWrite),drawBuffers:Glt(t.drawBuffers)}));function ict(t){return t?am([EAe(t.blending),AAe(t.culling),OAe(t.polygonOffset),PAe(t.depthTest),RAe(t.stencilTest),DAe(t.depthWrite),IAe(t.colorWrite),LAe(t.stencilWrite),kAe(t.drawBuffers)]):null}let rct=class{constructor(e){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._drawBuffersInvalid=!0,this._stateSetters=e}setPipeline(e){(this._pipelineInvalid||e!==this._pipeline)&&(this._setBlending(e.blending),this._setCulling(e.culling),this._setPolygonOffset(e.polygonOffset),this._setDepthTest(e.depthTest),this._setStencilTest(e.stencilTest),this._setDepthWrite(e.depthWrite),this._setColorWrite(e.colorWrite),this._setStencilWrite(e.stencilWrite),this._setDrawBuffers(e.drawBuffers),this._pipeline=e),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDrawBuffers(){this._drawBuffersInvalid=!0,this._pipelineInvalid=!0}_setBlending(e){this._blending=this._setSubState(e,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(e){this._culling=this._setSubState(e,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(e){this._polygonOffset=this._setSubState(e,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(e){this._depthTest=this._setSubState(e,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(e){this._stencilTest=this._setSubState(e,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(e){this._depthWrite=this._setSubState(e,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(e){this._colorWrite=this._setSubState(e,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(e){this._stencilWrite=this._setSubState(e,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setDrawBuffers(e){this._drawBuffers=this._setSubState(e,this._drawBuffers,this._drawBuffersInvalid,this._stateSetters.setDrawBuffers),this._drawBuffersInvalid=!1}_setSubState(e,i,r,s){return(r||e!==i)&&(s(e),this._pipelineInvalid=!0),e}};const sct=()=>fe.getLogger("esri.views.3d.webgl.ShaderTechnique");let Vi=class{constructor(e,i,r,s){this.primitiveType=lr.TRIANGLES,this.key=i.key,this._program=new cfe(e.rctx,r.get().build(i),s),this._pipeline=this.initializePipeline(i),this.reload=async n=>{n&&await r.reload(),this.key.equals(i.key)||sct().warn("Configuration was changed after construction, cannot reload shader.",r),Rt(this._program),this._program=new cfe(e.rctx,r.get().build(i),s),this._pipeline=this.initializePipeline(i)}}destroy(){this._program=Rt(this._program),this._pipeline=null}get program(){return this._program}get compiled(){return this.program.compiled}ensureAttributeLocations(e){this.program.assertCompatibleVertexAttributeLocations(e)}getPipeline(e,i){return this._pipeline}initializePipeline(e){return li({blending:Qv,colorWrite:$i})}};function sw(t,e){return Alt(t)?{buffers:[M6]}:e??null}function ed(t){let e=0;return new Map(t.map(({name:i,count:r})=>{const s=[i,e];return r===16?e+=4:r===9?e+=3:++e,s}))}function c8(t){const e=new Map;let i=0;return t.forEach(r=>r.forEach(({name:s,count:n})=>{e.set(s,i),n===16?i+=4:n===9?i+=3:++i})),e}function nct(t){return c8(Array.from(t.values()).map(({layout:e})=>e))}let Ov=class{constructor(e,i,r,s,n,a=!1,o=0){this.name=e,this.count=i,this.type=r,this.offset=s,this.stride=n,this.normalized=a,this.divisor=o}};const u8=[],act=[new Ov("position",3,ar.FLOAT,0,12)],lie=[new Ov("position",2,ar.FLOAT,0,8)],Qs=ed(lie),Kjt=ed(act),g4=[new Ov("position",2,ar.FLOAT,0,12),new Ov("uv0",2,ar.HALF_FLOAT,8,12)],oct=[new Ov("position",2,ar.FLOAT,0,16),new Ov("uv0",2,ar.FLOAT,8,16)];let X7=class extends Vi{constructor(e,i){super(e,i,new Ii(Mlt,()=>te(()=>Promise.resolve().then(()=>Mkt),void 0)),Qs)}initializePipeline(e){return li({blending:g2(32769,32770,32774,e.writeTextureChannels===0?[1,1,0,0]:[0,0,1,1]),depthTest:{func:515},colorWrite:$i})}},lct=class{constructor(e){this._bits=[...e]}equals(e){return sy(this._bits,e.bits)}get code(){return this._code??=String.fromCharCode(...this._bits),this._code}get bits(){return this._bits}},Fo=class extends hr{constructor(){super(),this._parameterBits=this._parameterBits?.map(()=>0)??[],this._parameterNames??=[]}get key(){return this._key??=new lct(this._parameterBits),this._key}decode(e=this.key){const i=this._parameterBits;this._parameterBits=[...e.bits];const r=this._parameterNames.map(s=>`    ${s}: ${this[s]}`).join(`
`);return this._parameterBits=i,r}};function oe(t={}){return(e,i)=>{e.hasOwnProperty("_parameterNames")||Object.defineProperty(e,"_parameterNames",{value:e._parameterNames?.slice()??[],configurable:!0,writable:!0}),e.hasOwnProperty("_parameterBits")||Object.defineProperty(e,"_parameterBits",{value:e._parameterBits?.slice()??[0],configurable:!0,writable:!0}),e._parameterNames.push(i);const r=t.count||2,s=Math.ceil(Math.log2(r)),n=e._parameterBits;let a=0;for(;n[a]+s>16;)a++,a>=n.length&&n.push(0);const o=n[a],l=(1<<s)-1<<o;n[a]+=s,t.count?Object.defineProperty(e,i,{get(){return(this._parameterBits[a]&l)>>o},set(c){if(this[i]!==c){if(this._key=null,this._parameterBits[a]=this._parameterBits[a]&~l|+c<<o&l,typeof c!="number")throw new ee("internal:invalid-shader-configuration",`Configuration value for ${i} must be a number, got ${typeof c}`);if(t.count==null)throw new ee("internal:invalid-shader-configuration",`Configuration value for ${i} must provide a count option`)}}}):Object.defineProperty(e,i,{get(){return!!((this._parameterBits[a]&l)>>o)},set(c){if(this[i]!==c&&(this._key=null,this._parameterBits[a]=this._parameterBits[a]&~l|+c<<o&l,typeof c!="boolean"))throw new ee("internal:invalid-shader-configuration",`Configuration value for ${i} must be boolean, got ${typeof c}`)}})}}let MQ=class extends Fo{constructor(){super(...arguments),this.steps=0,this.writeTextureChannels=0}};d([oe({count:3})],MQ.prototype,"steps",void 0),d([oe({count:2})],MQ.prototype,"writeTextureChannels",void 0);let cie=class extends hr{constructor(){super(...arguments),this.weatherTile=vs(0,0)}};function zAe(t){const e=new Di;return e.include(Oa,!1),e.fragment.code.add(E`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`),t.mode===0&&(e.fragment.code.add(E`float saturate(float x) {
return clamp(x, 0.0, 1.0);
}`),e.fragment.code.add(E`vec3 modulo(vec3 m, float n) {
return mod(mod(m, n) + n, n);
}
vec3 hash(vec3 p3, float frequency) {
p3 = modulo(p3, frequency);
p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
p3 += dot(p3, p3.yxz + 33.33);
return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
}`),e.fragment.code.add(E`vec3 fade(vec3 t) {
return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
}`),e.fragment.code.add(E`
    float gradientNoise(vec3 p, float frequency) {
      vec3 i = floor(p);
      vec3 f = fract(p);
      vec3 u = fade(f);
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequency = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequency;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${E.float(Vd)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${E.float(8)});

      float worley0 = worley(p, ${E.float(2)} * 2.0);
      float worley1 = worley(p, ${E.float(2)} * 8.0);
      float worley2 = worley(p, ${E.float(2)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${E.float(2)});
      float worley1 = worley(p, ${E.float(2)} * 2.0);
      float worley2 = worley(p, ${E.float(2)} * 4.0);
      float worley3 = worley(p, ${E.float(2)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `)),e.fragment.uniforms.add(new ll("weatherTile",i=>i.weatherTile)).code.add(E`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${E.float(Q5)});

      // Get global coordinates of p
      p += weatherTile * ${E.float(Q5)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${E.float(plt)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `),t.mode===0?e.fragment.main.add(E`
      float padWidth = 1.0;
      float paddedSize = ${E.float(Ih)} + 2.0 * padWidth;
      float tileCount = ${E.float(Vd)} * ${E.float(Vd)};
      vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

      bool padCell = false;
      if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
        padCell = true;
      }

      if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
        padCell = true;
      }

      bool startPadX = false;
      bool startPadY = false;
      bool endPadX = false;
      bool endPadY = false;

      if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
        startPadX = true;
      }

      if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
        startPadY = true;
      }

      if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
        endPadX = true;
      }

      if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
        endPadY = true;
      }

      vec2 padding = vec2(2.0 * padWidth) * tile;
      vec2 uv;

      if (padCell) {
        vec2 pixel = gl_FragCoord.xy - padWidth - padding;

        if (startPadX) {
          pixel.x += ${E.float(Ih)};
        }

        if (startPadY) {
          pixel.y += ${E.float(Ih)};
        }

        if (endPadX) {
          pixel.x -= ${E.float(Ih)};
        }

        if (endPadY) {
          pixel.y -= ${E.float(Ih)};
        }

        uv = vec2(pixel.xy / ${E.float(Ih)});
      } else {
        vec2 pixel = gl_FragCoord.xy - padWidth - padding;
        uv = vec2(pixel.xy / ${E.float(Ih)});
      }

      vec3 p_ = get3Dfrom2D(uv);
      vec3 p = p_;
      p.z /= (${E.float(Vd)} * ${E.float(Vd)});

      float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
      float worleyNoise = getTextureForPointWorley(p);

      fragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

      p_ = mod(p_ + 1.0, ${E.float(Vd)} * ${E.float(Vd)});
      p = p_;
      p.z /= (${E.float(Vd)} * ${E.float(Vd)});

      worleyPerlinNoise = getTextureForPointPerlinWorley(p);
      worleyNoise = getTextureForPointWorley(p);

      fragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

      vec2 mapUV = ${E.float(Q5)} * (gl_FragCoord.xy / ${E.float(ty)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);
      fragColor.ba = vec2(0.0, map);
      `):e.fragment.main.add(E`
      vec2 mapUV = ${E.float(Q5)} * (gl_FragCoord.xy / ${E.float(ty)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);
      fragColor = vec4(map);
    `),e}const cct=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:cie,build:zAe},Symbol.toStringTag,{value:"Module"}));let Zz=class extends Fo{constructor(){super(...arguments),this.mode=0}};d([oe({count:2})],Zz.prototype,"mode",void 0);let J7=class extends Vi{constructor(e,i){super(e,i,new Ii(cct,()=>te(()=>Promise.resolve().then(()=>Ekt),void 0)),Qs)}initializePipeline(e){return li({blending:e.mode===0?aie:Ly(0,1,1,0),depthTest:{func:519},colorWrite:$i})}};const ufe=()=>fe.getLogger("esri.views.webgl.BufferObject"),uct=!!ie("esri-tests-disable-gpu-memory-measurements");let Uu=class CT{static createIndex(e,i,r){return new CT(e,34963,i,r)}static createUniform(e,i,r){return new CT(e,35345,i,r)}static createPixelPack(e,i=35041,r){const s=new CT(e,35051,i);return r&&s.setSize(r),s}static createPixelUnpack(e,i=35040,r){return new CT(e,35052,i,r)}static createTransformFeedback(e,i=35044,r){const s=new CT(e,35982,i);return s.setSize(r),s}constructor(e,i,r,s){this._context=e,this.bufferType=i,this.usage=r,this._glName=null,this._size=-1,this._indexType=void 0,e.instanceCounter.increment(Bs.BufferObject,this),this._glName=this._context.gl.createBuffer(),Cc(this._context.gl),s&&this.setData(s)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get sizeBytes(){if(this.bufferType===34963){if(this._indexType===ar.UNSIGNED_INT)return 4*this._size;if(this._indexType===ar.UNSIGNED_SHORT)return 2*this._size}return this._size}get usedMemory(){return uct?0:this.sizeBytes}get _isVAOAware(){return this.bufferType===34963||this.bufferType===34962}dispose(){this._context?.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(Bs.BufferObject,this),this._context=null):this._glName&&ufe().warn("Leaked WebGL buffer object")}setSize(e,i=null){if(this.bufferType===34963&&i!=null)switch(this._indexType=i,i){case ar.UNSIGNED_SHORT:e*=2;break;case ar.UNSIGNED_INT:e*=4}this._setBufferData(e)}setData(e){if(!e)return;let i=e.byteLength;this.bufferType===34963&&(mw(e)?this._indexType=ar.UNSIGNED_BYTE:QV(e)?(i/=2,this._indexType=ar.UNSIGNED_SHORT):pK(e)&&(i/=4,this._indexType=ar.UNSIGNED_INT)),this._setBufferData(i,e)}_setBufferData(e,i=null){this._size=e;const r=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const s=this._context.gl;i!=null?s.bufferData(this.bufferType,i,this.usage):s.bufferData(this.bufferType,e,this.usage),Cc(s),this._isVAOAware&&this._context.bindVAO(r)}setSubData(e,i,r,s){if(!e)return;const n=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const{gl:a}=this._context;a.bufferSubData(this.bufferType,i*e.BYTES_PER_ELEMENT,e,r,s-r),Cc(a),this._isVAOAware&&this._context.bindVAO(n)}getSubData(e,i=0,r,s){if(r<0||s<0)return;const n=hct(e)?e.BYTES_PER_ELEMENT:1;if(n*((r??0)+(s??0))>e.byteLength)return;i+n*(s??0)>this.usedMemory&&ufe().warn("Potential problem getting subdata: requested data exceeds buffer size!");const a=this._context.gl;this.bufferType===35982?(this._context.bindBuffer(this,35982),a.getBufferSubData(35982,i,e,r,s),this._context.unbindBuffer(35982)):(this._context.bindBuffer(this,36662),a.getBufferSubData(36662,i,e,r,s),this._context.unbindBuffer(36662))}async getSubDataAsync(e,i=0,r,s){await this._context.clientWaitAsync(),this.getSubData(e,i,r,s)}};function hct(t){return x8e(t)}function FAe(t,e,i,r=0){const s=t.gl;t.bindBuffer(i);for(const n of i.layout){const a=e.get(n.name);if(a==null){console.warn(`There is no location for vertex attribute '${n.name}' defined.`);continue}const o=r*n.stride;if(n.count<=4)s.vertexAttribPointer(a,n.count,n.type,n.normalized,n.stride,n.offset+o),s.enableVertexAttribArray(a),n.divisor>0&&s.vertexAttribDivisor(a,n.divisor);else if(n.count===9)for(let l=0;l<3;l++)s.vertexAttribPointer(a+l,3,n.type,n.normalized,n.stride,n.offset+12*l+o),s.enableVertexAttribArray(a+l),n.divisor>0&&s.vertexAttribDivisor(a+l,n.divisor);else if(n.count===16)for(let l=0;l<4;l++)s.vertexAttribPointer(a+l,4,n.type,n.normalized,n.stride,n.offset+16*l+o),s.enableVertexAttribArray(a+l),n.divisor>0&&s.vertexAttribDivisor(a+l,n.divisor);else console.error("Unsupported vertex attribute element count: "+n.count);if(Ko()){const l=sie(t.gl);l&&console.error(`Unable to bind vertex attribute "${n.name}" with baseInstanceOffset ${o}:`,l,n)}}}function dct(t){switch(t){case 6406:case 6409:case 6403:case 36244:case 6402:case 34041:return 1;case 6410:case 33319:case 33320:return 2;case 6407:case 36248:return 3;case 6408:case 36249:return 4}return 0}function uie(t){switch(t){case 6406:case 6409:case 6403:case 36244:case tt.R8:case tt.R8I:case tt.R8UI:case tt.R8_SNORM:case 36168:return 1;case 6410:case 33319:case 33320:case tt.RGBA4:case tt.R16F:case tt.R16I:case tt.R16UI:case tt.RG8:case tt.RG8I:case tt.RG8UI:case tt.RG8_SNORM:case tt.RGB565:case tt.RGB5_A1:case Hh.DEPTH_COMPONENT16:return 2;case 6407:case 36248:case tt.RGB8:case tt.RGB8I:case tt.RGB8UI:case tt.RGB8_SNORM:case tt.SRGB8:case Hh.DEPTH_COMPONENT24:return 3;case 6408:case 36249:case tt.RGBA8:case tt.R32F:case tt.R11F_G11F_B10F:case tt.RG16F:case tt.R32I:case tt.R32UI:case tt.RG16I:case tt.RG16UI:case tt.RGBA8I:case tt.RGBA8UI:case tt.RGBA8_SNORM:case tt.SRGB8_ALPHA8:case tt.RGB9_E5:case tt.RGB10_A2UI:case tt.RGB10_A2:case Hh.DEPTH_COMPONENT32F:case Kf.DEPTH24_STENCIL8:return 4;case Kf.DEPTH32F_STENCIL8:return 5;case tt.RGB16F:case tt.RGB16I:case tt.RGB16UI:return 6;case tt.RG32F:case tt.RG32I:case tt.RG32UI:case tt.RGBA16F:case tt.RGBA16I:case tt.RGBA16UI:return 8;case tt.RGB32F:case tt.RGB32I:case tt.RGB32UI:return 12;case tt.RGBA32F:case tt.RGBA32I:case tt.RGBA32UI:return 16;case Vs.COMPRESSED_RGB_S3TC_DXT1_EXT:case Vs.COMPRESSED_RGBA_S3TC_DXT1_EXT:return .5;case Vs.COMPRESSED_RGBA_S3TC_DXT3_EXT:case Vs.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case Vs.COMPRESSED_R11_EAC:case Vs.COMPRESSED_SIGNED_R11_EAC:case Vs.COMPRESSED_RGB8_ETC2:case Vs.COMPRESSED_SRGB8_ETC2:case Vs.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case Vs.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return .5;case Vs.COMPRESSED_RG11_EAC:case Vs.COMPRESSED_SIGNED_RG11_EAC:case Vs.COMPRESSED_RGBA8_ETC2_EAC:case Vs.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}let pct=class{constructor(e,i=0,r=i,s=!1,n=1){this.internalFormat=e,this.width=i,this.height=r,this.multisampled=s,this.samples=n}};function fct(t){return t.width<=0||t.height<=0||t.internalFormat==null?0:t.width*t.height*uie(t.internalFormat)}const mct=!!ie("esri-tests-disable-gpu-memory-measurements");let NAe=class{constructor(e,i){this._context=e,this._descriptor=i,this.type=2,this._context.instanceCounter.increment(Bs.Renderbuffer,this);const r=this._context.gl;this.glName=r.createRenderbuffer(),this._context.bindRenderbuffer(this);const{width:s,height:n,internalFormat:a,multisampled:o}=i;o?r.renderbufferStorageMultisample(r.RENDERBUFFER,this.samples,a,s,n):r.renderbufferStorage(r.RENDERBUFFER,a,s,n),this._context.bindRenderbuffer(null)}get descriptor(){return this._descriptor}get samples(){const e=this._descriptor.samples,i=this._context.parameters.maxSamples;return e?Math.min(e,i):i}get usedMemory(){return mct?0:fct(this._descriptor)}resize(e,i){const r=this._descriptor;if(r.width===e&&r.height===i)return;r.width=e,r.height=i;const s=this._context.gl;this._context.bindRenderbuffer(this),r.multisampled?s.renderbufferStorageMultisample(s.RENDERBUFFER,this.samples,r.internalFormat,r.width,r.height):s.renderbufferStorage(s.RENDERBUFFER,r.internalFormat,r.width,r.height),this._context.bindRenderbuffer(null)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(Bs.Renderbuffer,this),this._context=null)}},Zi=class{constructor(e=0,i=e){this.width=e,this.height=i,this.type=0,this.target=3553,this.pixelFormat=6408,this.dataType=bs.UNSIGNED_BYTE,this.samplingMode=9729,this.wrapMode=10497,this.maxAnisotropy=1,this.flipped=!1,this.hasMipmap=!1,this.isOpaque=!1,this.unpackAlignment=4,this.preMultiplyAlpha=!1,this.compareEnabled=!1,this.linearFilterDepth=!1,this.depth=1,this.isImmutable=!1}};function gct(t){return t.width<=0||t.height<=0||t.depth<=0?0:Math.round(t.width*t.height*t.depth*(t.hasMipmap?4/3:1)*(t.internalFormat==null?4:uie(t.internalFormat))*(t.target===34067?6:1))}const rA=()=>fe.getLogger("esri/views/webgl/textureUtils");function sA(t){const{width:e,height:i,depth:r}=t;(e!=null&&e<0||i!=null&&i<0||r!=null&&r<0)&&rA().error("Negative dimension parameters are not allowed!");const{internalFormat:s}=t;if(s&&(hie(s)||VAe(s))){const{linearFilterDepth:n,compareEnabled:a,samplingMode:o,hasMipmap:l}=t;l&&rA().error("Depth textures cannot have mipmaps"),n?o!==9729&&o!==9728&&rA().error("Depth textures cannot sample mipmaps"):(o!==9728&&rA().error("Depth textures without filtering must use NEAREST filtering"),a&&rA().error("Depth textures without filtering cannot use compare function"))}}function yct(t){return Plt.includes(t)}function hie(t){return XV(Hh,t)}function VAe(t){return XV(Kf,t)}function UAe(t){return t!=null&&XV(Vs,t)}function MT(t){return t!=null&&"type"in t&&t.type==="compressed"}function _ct(t){return t!=null&&"byteLength"in t}function hfe(t){return t!=null&&!MT(t)&&!_ct(t)}function wS(t){return t===32879||t===35866}function dfe(t,e,i,r=1){let s=Math.max(e,i);return t===32879&&(s=Math.max(s,r)),Math.floor(Math.log2(s))+1}function X5(t){if(t.internalFormat!=null)return t.internalFormat;switch(t.dataType){case bs.FLOAT:switch(t.pixelFormat){case 6408:return tt.RGBA32F;case 6407:return tt.RGB32F;default:throw new ee("texture:unknown-format","Unable to derive format")}case bs.UNSIGNED_BYTE:switch(t.pixelFormat){case 6408:return tt.RGBA8;case 6407:return tt.RGB8}}const{pixelFormat:e}=t;return t.internalFormat=e===34041?Kf.DEPTH24_STENCIL8:e===6402?Hh.DEPTH_COMPONENT24:e,t.internalFormat}function vct(t){let e="width"in t?t.width:t.codedWidth,i="height"in t?t.height:t.codedHeight;return t instanceof HTMLVideoElement&&(e=t.videoWidth,i=t.videoHeight),{width:e,height:i,depth:1}}let bct=class BAe extends Zi{constructor(e,i){switch(super(),this.context=e,Object.assign(this,i),this.internalFormat){case tt.R16F:case tt.R32F:case tt.R8_SNORM:case tt.R8:this.pixelFormat=6403;break;case tt.R8I:case tt.R8UI:case tt.R16I:case tt.R16UI:case tt.R32I:case tt.R32UI:this.pixelFormat=36244}}static validate(e,i){return new BAe(e,i)}};const wct=!!ie("esri-tests-disable-gpu-memory-measurements"),Rm=()=>fe.getLogger("esri/views/webgl/Texture");var ga;let Fi=(ga=class{constructor(e,i=null,r=null){if(this.type=1,this._glName=null,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._shadowFilterDirty=!1,this._wasImmutablyAllocated=!1,"context"in e)this._descriptor=e,r=i;else{const s=bct.validate(e,i);if(!s)throw new ee("texture:invalid-descriptor","Texture descriptor invalid");this._descriptor=s}this._descriptor.target===34067?this._setDataCubeMap(r):this.setData(r)}get glName(){return this._glName}get descriptor(){return this._descriptor}get usedMemory(){return wct?0:gct(this._descriptor)}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty||this._shadowFilterDirty}get hasWebGLTextureObject(){return!!this._glName}dispose(){this.abortCompression(),this.hasWebGLTextureObject&&this._descriptor.context?.gl&&(this._descriptor.context.instanceCounter.decrement(Bs.Texture,this),this._descriptor.context.unbindTexture(this),this._descriptor.context.gl.deleteTexture(this._glName),this._glName=null,this._descriptor=null)}release(){this.dispose()}[Symbol.dispose](){this.dispose()}resize(e,i){const r=this._descriptor;if(r.width!==e||r.height!==i){if(this._wasImmutablyAllocated)throw new ee("texture:immutable-resize","Immutable textures can't be resized!");r.width=e,r.height=i,this._descriptor.target===34067?this._setDataCubeMap(null):this.setData(null)}}enableCompression(e){this._descriptor.compress=e}disableCompression(){this._descriptor.compress=void 0}setData(e){this.abortCompression(),!MT(e)&&this._descriptor.internalFormat&&XV(Vs,this._descriptor.internalFormat)&&(this._descriptor.internalFormat=void 0),this._setData(e),!MT(e)&&this._descriptor.compress&&this._compressOnWorker(e)}updateData(e,i,r,s,n,a,o=0){a||Rm().error("An attempt to use uninitialized data!"),this.hasWebGLTextureObject||Rm().error("An attempt to update uninitialized texture!");const l=this._descriptor;l.internalFormat=X5(l);const{context:c,pixelFormat:h,dataType:f,target:y,isImmutable:_}=l;if(_&&!this._wasImmutablyAllocated)throw new ee("texture:uninitialized","Cannot update immutable texture before allocation!");const w=c.bindTexture(this,ga.TEXTURE_UNIT_FOR_UPDATES,!0);(i<0||r<0||i+s>l.width||r+n>l.height)&&Rm().error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage();const{gl:x}=c;o&&(s&&n||Rm().warn("Must pass width and height if `UNPACK_SKIP_ROWS` is used"),x.pixelStorei(x.UNPACK_SKIP_ROWS,o)),hfe(a)?x.texSubImage2D(y,e,i,r,s,n,h,f,a):MT(a)?x.compressedTexSubImage2D(y,e,i,r,s,n,l.internalFormat,a.levels[e]):x.texSubImage2D(y,e,i,r,s,n,h,f,a),o&&x.pixelStorei(x.UNPACK_SKIP_ROWS,0),c.bindTexture(w,ga.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(e,i,r,s,n,a,o,l){l||Rm().error("An attempt to use uninitialized data!"),this.hasWebGLTextureObject||Rm().error("An attempt to update an uninitialized texture!");const c=this._descriptor;c.internalFormat=X5(c);const{context:h,pixelFormat:f,dataType:y,isImmutable:_,target:w}=c;if(_&&!this._wasImmutablyAllocated)throw new ee("texture:uninitialized","Cannot update immutable texture before allocation!");wS(w)||Rm().warn("Attempting to set 3D texture data on a non-3D texture");const x=h.bindTexture(this,ga.TEXTURE_UNIT_FOR_UPDATES);h.setActiveTexture(ga.TEXTURE_UNIT_FOR_UPDATES),(i<0||r<0||s<0||i+n>c.width||r+a>c.height||s+o>c.depth)&&Rm().error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage();const{gl:S}=h;if(MT(l))l=l.levels[e],S.compressedTexSubImage3D(w,e,i,r,s,n,a,o,c.internalFormat,l);else{const $=l;S.texSubImage3D(w,e,i,r,s,n,a,o,f,y,$)}h.bindTexture(x,ga.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const e=this._descriptor;if(e.width===0||e.height===0)return;if(!e.hasMipmap){if(this._wasImmutablyAllocated)throw new ee("texture:immutable-change","Cannot add mipmaps to immutable texture after allocation");e.hasMipmap=!0,this._samplingModeDirty=!0,sA(e)}e.samplingMode===9729?(this._samplingModeDirty=!0,e.samplingMode=9985):e.samplingMode===9728&&(this._samplingModeDirty=!0,e.samplingMode=9984);const i=this._descriptor.context.bindTexture(this,ga.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(ga.TEXTURE_UNIT_FOR_UPDATES),this._descriptor.context.gl.generateMipmap(e.target),this._descriptor.context.bindTexture(i,ga.TEXTURE_UNIT_FOR_UPDATES)}clearMipmap(){const e=this._descriptor;if(e.hasMipmap){if(this._wasImmutablyAllocated)throw new ee("texture:immutable-change","Cannot delete mipmaps to immutable texture after allocation");e.hasMipmap=!1,this._samplingModeDirty=!0,sA(e)}e.samplingMode===9985?(this._samplingModeDirty=!0,e.samplingMode=9729):e.samplingMode===9984&&(this._samplingModeDirty=!0,e.samplingMode=9728)}setSamplingMode(e){e!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=e,this._samplingModeDirty=!0)}setWrapMode(e){e!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=e,sA(this._descriptor),this._wrapModeDirty=!0)}setShadowFiltering(e){e!==this._descriptor.linearFilterDepth&&(this._descriptor.linearFilterDepth=this._descriptor.compareEnabled=e,this.setSamplingMode(e?9729:9728),sA(this._descriptor),this._shadowFilterDirty=!0)}applyChanges(){this._samplingModeDirty&&(this._applySamplingMode(),this._samplingModeDirty=!1),this._wrapModeDirty&&(this._applyWrapMode(),this._wrapModeDirty=!1),this._shadowFilterDirty&&(this._applyShadowMode(),this._shadowFilterDirty=!1)}abortCompression(){this._compressionAbortController=ps(this._compressionAbortController)}_setData(e,i){const r=this._descriptor,s=r.context?.gl;if(!s)return;Cc(s),this.hasWebGLTextureObject||(this._glName=s.createTexture(),r.context.instanceCounter.increment(Bs.Texture,this)),sA(r);const n=r.context.bindTexture(this,ga.TEXTURE_UNIT_FOR_UPDATES);r.context.setActiveTexture(ga.TEXTURE_UNIT_FOR_UPDATES),this._configurePixelStorage(),Cc(s);const a=i??r.target,o=wS(a);if(hfe(e))this._setDataFromTexImageSource(e,a);else{const{width:l,height:c,depth:h}=r;if(l==null||c==null)throw new ee("texture:missing-size","Width and height must be specified!");if(o&&h==null)throw new ee("texture:missing-depth","Depth must be specified!");if(r.internalFormat=X5(r),r.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(a,r.internalFormat,r.hasMipmap,l,c,h),MT(e)){if(!UAe(r.internalFormat))throw new ee("texture:format-mismatch","Attempting to use compressed data with an uncompressed format!");this._setDataFromCompressedSource(e,r.internalFormat,a)}else this._texImage(a,0,r.internalFormat,l,c,h,e),Cc(s),r.hasMipmap&&this.generateMipmap()}this._applySamplingMode(),this._applyWrapMode(),this._applyAnisotropicFilteringParameters(),this._applyShadowMode(),Cc(s),r.context.bindTexture(n,ga.TEXTURE_UNIT_FOR_UPDATES)}_setDataCubeMap(e=null){for(let i=34069;i<=34074;i++)this._setData(e,i)}_configurePixelStorage(){const e=this._descriptor.context.gl,{unpackAlignment:i,flipped:r,preMultiplyAlpha:s}=this._descriptor;e.pixelStorei(e.UNPACK_ALIGNMENT,i),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,r?1:0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s?1:0)}_setDataFromTexImageSource(e,i){const{gl:r}=this._descriptor.context,s=this._descriptor;s.internalFormat=X5(s);const n=wS(i),{width:a,height:o,depth:l}=vct(e);s.width&&s.height,s.width||(s.width=a),s.height||(s.height=o),n&&s.depth,n&&(s.depth=l),s.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(i,s.internalFormat,s.hasMipmap,a,o,l),this._texImage(i,0,s.internalFormat,a,o,l,e),Cc(r),s.hasMipmap&&(this.generateMipmap(),Cc(r))}_setDataFromCompressedSource(e,i,r){const s=this._descriptor,{width:n,height:a,depth:o}=s,l=e.levels,c=dfe(r,n,a,o),h=Math.min(c,l.length)-1;this._descriptor.context.gl.texParameteri(s.target,33085,h),this._forEachMipmapLevel((f,y,_,w)=>{const x=l[Math.min(f,l.length-1)];this._compressedTexImage(r,f,i,y,_,w,x)},h)}_texStorage(e,i,r,s,n,a){const{gl:o}=this._descriptor.context;if(!yct(i)&&!hie(i)&&!VAe(i))throw new ee("texture:missing-format","Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const l=r?dfe(e,s,n,a):1;if(wS(e)){if(a==null)throw new ee("texture:missing-depth","Missing depth dimension for 3D texture upload");o.texStorage3D(e,l,i,s,n,a)}else o.texStorage2D(e,l,i,s,n);this._wasImmutablyAllocated=!0}_texImage(e,i,r,s,n,a,o){const l=this._descriptor.context.gl,c=wS(e),{isImmutable:h,pixelFormat:f,dataType:y}=this._descriptor;if(h){if(o!=null){const _=o;if(c){if(a==null)throw new ee("texture:missing-depth","Missing depth dimension for 3D texture upload");l.texSubImage3D(e,i,0,0,0,s,n,a,f,y,_)}else l.texSubImage2D(e,i,0,0,s,n,f,y,_)}}else{const _=o;if(c){if(a==null)throw new ee("texture:missing-depth","Missing depth dimension for 3D texture upload");l.texImage3D(e,i,r,s,n,a,0,f,y,_)}else l.texImage2D(e,i,r,s,n,0,f,y,_)}}_compressedTexImage(e,i,r,s,n,a,o){const l=this._descriptor.context.gl,c=wS(e);if(this._descriptor.isImmutable){if(o!=null)if(c){if(a==null)throw new ee("texture:missing-depth","Missing depth dimension for 3D texture upload");l.compressedTexSubImage3D(e,i,0,0,0,s,n,a,r,o)}else l.compressedTexSubImage2D(e,i,0,0,s,n,r,o)}else if(c){if(a==null)throw new ee("texture:missing-depth","Missing depth dimension for 3D texture upload");l.compressedTexImage3D(e,i,r,s,n,a,0,o)}else l.compressedTexImage2D(e,i,r,s,n,0,o)}async _compressOnWorker(e){const{width:i,height:r,context:s,flipped:n,preMultiplyAlpha:a,hasMipmap:o}=this._descriptor,l=this._descriptor.compress?.compressionTracker,c=this._descriptor.compress?.compressionCallback,{compressedTextureETC:h,compressedTextureS3TC:f}=s.capabilities;if(!ga.compressionWorkerHandle?.isCompressible(e,this._descriptor)||!h&&!f)return;this.abortCompression();const y=new AbortController;let _;this._compressionAbortController=y,l?.increment();try{e instanceof Uint8Array?_=e.buffer:(_=await createImageBitmap(e,{imageOrientation:n?"flipY":"none"}),st(y));const w={data:_,width:i,height:r,needsFlip:e instanceof Uint8Array&&this.descriptor.flipped,components:this._descriptor.pixelFormat===6408?4:3,preMultiplyAlpha:a,hasMipmap:o,hasETC:!!h,hasS3TC:!!f},x=await ga.compressionWorkerHandle.invoke(w,y.signal,"low");if(st(y),x.compressedTexture&&this.hasWebGLTextureObject){const S=this.usedMemory;this._descriptor.internalFormat=x.internalFormat,this._setData(x.compressedTexture),c?.(S-this.usedMemory)}}catch(w){Hr(w)||Rm().error("Texture compression failed!")}finally{l?.decrement(),this._compressionAbortController?.signal.aborted&&(this._compressionAbortController=null),_ instanceof ImageBitmap&&_.close()}}_forEachMipmapLevel(e,i=1/0){let{width:r,height:s,depth:n,hasMipmap:a,target:o}=this._descriptor;const l=o===32879;if(r==null||s==null||l&&n==null)throw new ee("texture:missing-size","Missing texture dimensions for mipmap calculation");for(let c=0;e(c,r,s,n),a&&(r!==1||s!==1||l&&n!==1)&&!(c>=i);++c)r=Math.max(1,r>>1),s=Math.max(1,s>>1),l&&(n=Math.max(1,n>>1))}_applySamplingMode(){const e=this._descriptor,i=e.context?.gl;let r=e.samplingMode,s=e.samplingMode;r===9985||r===9987?(r=9729,e.hasMipmap||(s=9729)):r!==9984&&r!==9986||(r=9728,e.hasMipmap||(s=9728)),i.texParameteri(e.target,i.TEXTURE_MAG_FILTER,r),i.texParameteri(e.target,i.TEXTURE_MIN_FILTER,s)}_applyWrapMode(){const e=this._descriptor,i=e.context?.gl;typeof e.wrapMode=="number"?(i.texParameteri(e.target,i.TEXTURE_WRAP_S,e.wrapMode),i.texParameteri(e.target,i.TEXTURE_WRAP_T,e.wrapMode)):(i.texParameteri(e.target,i.TEXTURE_WRAP_S,e.wrapMode.s),i.texParameteri(e.target,i.TEXTURE_WRAP_T,e.wrapMode.t))}_applyShadowMode(){const e=this._descriptor,i=e.context?.gl,r=e.compareEnabled?i.COMPARE_REF_TO_TEXTURE:i.NONE;i.texParameteri(e.target,i.TEXTURE_COMPARE_MODE,r),e.compareEnabled&&i.texParameteri(e.target,i.TEXTURE_COMPARE_FUNC,i.GREATER),Cc(i)}_applyAnisotropicFilteringParameters(){const e=this._descriptor,i=e.context.capabilities.textureFilterAnisotropic;i&&e.context.gl.texParameterf(e.target,i.TEXTURE_MAX_ANISOTROPY,e.maxAnisotropy??1)}},ga.TEXTURE_UNIT_FOR_UPDATES=0,ga.compressionWorkerHandle=null,ga);const xct=()=>fe.getLogger("esri.views.webgl.FramebufferObject");var kf;let Xv=(kf=class{constructor(e,i,r){if(this._context=e,this._glName=null,this._colorAttachments=new Map,this._depthStencilBuffer=null,this._depthStencilTexture=null,this._initialized=!1,e.instanceCounter.increment(Bs.FramebufferObject,this),i!=null){const s=$ct(e,i);s!=null&&(this._colorAttachments.set(Dr,s),f_(s)?this._validateTextureDescriptor(s.descriptor):this._validateRenderbufferDescriptor(s.descriptor)),this._validateColorAttachmentPoint(Dr)}if(r!=null)if(Sct(r))this._depthStencilTexture=f_(r)?r:new Fi(e,r),this._validateTextureDescriptor(this._depthStencilTexture.descriptor);else{const s=EQ(r)?r:new NAe(e,r);this._depthStencilBuffer=s,this._validateRenderbufferDescriptor(s.descriptor)}}dispose(){const{_colorAttachments:e,_glName:i}=this;if(e.size===0&&!this._depthStencilBuffer&&!this._depthStencilTexture&&!i)return;const{_context:r}=this,s=r.getBoundFramebufferObject();e.forEach((n,a)=>this.detachColorTexture(a)?.dispose()),this.detachDepthStencilBuffer()?.dispose(),this.detachDepthStencilTexture()?.dispose(),r.gl.deleteFramebuffer(i),this._glName=null,r.bindFramebuffer(s===this?null:s),r.instanceCounter.decrement(Bs.FramebufferObject,this)}get glName(){return this._glName}get colorTexture(){const e=this._colorAttachments.get(Dr);return f_(e)?e:null}get depthStencil(){return this._depthStencilTexture||this._depthStencilBuffer}get depthStencilTexture(){return this._depthStencilTexture}get width(){return(this._colorAttachments.get(Dr)??this._depthStencilTexture??this._depthStencilBuffer)?.descriptor?.width??0}get height(){return(this._colorAttachments.get(Dr)??this._depthStencilTexture??this._depthStencilBuffer)?.descriptor?.height??0}get usedMemory(){return[...this._colorAttachments].reduce((e,[i,r])=>e+r.usedMemory,this.depthStencil?.usedMemory??0)}getColorTexture(e){const i=this._colorAttachments.get(e);return i&&f_(i)?i:null}get colorAttachments(){return[...this._colorAttachments.keys()]}attachColorTexture(e,i=Dr){if(!e)return;this._validateColorAttachmentPoint(i);const{descriptor:r}=e;this._validateTextureDescriptor(r),this.detachColorTexture(i)?.dispose(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,i)),this._colorAttachments.set(i,e)}detachColorTexture(e=Dr){const i=this._colorAttachments.get(e);if(!i)return;const r=f_(i);return this._initialized&&this._context.temporaryBindFramebufferObject(this,()=>{if(r)this._framebufferTexture2D(null,e);else{const s=this._context.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,e,s.RENDERBUFFER,null)}}),this._colorAttachments.delete(e),r?i:void 0}setColorTextureTarget(e,i=Dr,r=0){const s=this._colorAttachments.get(i);s&&(e===35866?this._framebufferTextureLayer(s.glName,i,36160,0,r):this._framebufferTexture2D(s.glName,i,e,36160,0))}attachDepthStencil(e){if(e)switch(e.type){case 1:return this._attachDepthStencilTexture(e);case 2:return this._attachDepthStencilBuffer(e)}}_attachDepthStencilTexture(e){if(e==null)return;const{descriptor:i}=e,{pixelFormat:r,dataType:s}=i;r===34041||r===6402?r!==34041||s===bs.UNSIGNED_INT_24_8?r!==6402||s===bs.UNSIGNED_INT||s===bs.UNSIGNED_SHORT?(this._validateTextureDescriptor(i),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,J5(r))),this._depthStencilTexture?.dispose(),this._depthStencilTexture=e):console.error("Depth texture must have data type of UNSIGNED_INT or UNSIGNED_SHORT!"):console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"):console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!")}detachDepthStencilTexture(){const e=this._depthStencilTexture;return e&&this._initialized&&this._context.temporaryBindFramebufferObject(this,()=>{this._framebufferTexture2D(null,J5(e.descriptor.pixelFormat))}),this._depthStencilTexture=null,e}_attachDepthStencilBuffer(e){if(e==null)return;const i=e.descriptor;if(this._validateRenderbufferDescriptor(i),this._disposeDepthStencilAttachments(),this._initialized){this._context.bindFramebuffer(this);const{gl:r}=this._context,s=this._getGLAttachmentPoint(i);r.framebufferRenderbuffer(36160,s,r.RENDERBUFFER,e.glName)}this._depthStencilBuffer=e}detachDepthStencilBuffer(){const e=this._depthStencilBuffer;if(e&&this._initialized){const{_context:i}=this,r=i.getBoundFramebufferObject();i.bindFramebuffer(this);const{gl:s}=i,n=this._getGLAttachmentPoint(e.descriptor);s.framebufferRenderbuffer(36160,n,s.RENDERBUFFER,null),i.bindFramebuffer(r)}return this._depthStencilBuffer=null,e}invalidateAttachments(e){const{_context:i}=this;i.temporaryBindFramebufferObject(this,()=>i.gl.invalidateFramebuffer(36160,e),!0)}copyToTexture(e,i,r,s,n,a,o){(e<0||i<0||n<0||a<0)&&console.error("Offsets cannot be negative!"),(r<=0||s<=0)&&console.error("Copy width and height must be greater than zero!");const l=o.descriptor;o.descriptor.target!==3553&&console.error("Texture target must be TEXTURE_2D!"),(l?.width==null||l?.height==null||e+r>this.width||i+s>this.height||n+r>l.width||a+s>l.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const c=this._context,h=c.bindTexture(o,Fi.TEXTURE_UNIT_FOR_UPDATES);c.setActiveTexture(Fi.TEXTURE_UNIT_FOR_UPDATES),c.bindFramebuffer(this),c.gl.copyTexSubImage2D(3553,0,n,a,e,i,r,s),c.bindTexture(h,Fi.TEXTURE_UNIT_FOR_UPDATES)}readPixels(e,i,r,s,n,a,o){(r<=0||s<=0)&&console.error("Copy width and height must be greater than zero!"),o||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(e,i,r,s,n,a,o)}async readPixelsAsync(e,i,r,s,n,a,o){const{gl:l}=this._context,c=Uu.createPixelPack(this._context,35041,o.byteLength);this._context.bindBuffer(c);const h=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this),l.readPixels(e,i,r,s,n,a,0),this._context.unbindBuffer(35051),this._context.bindFramebuffer(h),await c.getSubDataAsync(o),c.dispose()}resize(e,i){if(this.width===e&&this.height===i)return;const r={width:e,height:i};if(nw(r,this._context.parameters.maxTextureSize),this._colorAttachments.forEach(s=>s.resize(r.width,r.height)),this._depthStencilTexture?.resize(r.width,r.height),this._initialized&&(nw(r,this._context.parameters.maxRenderbufferSize),this._depthStencilBuffer?.resize(r.width,r.height),Ko())){const{gl:s}=this._context;s.checkFramebufferStatus(36160)!==s.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!")}}initializeAndBind(e=36160){const{gl:i}=this._context;if(this._initialized)return void i.bindFramebuffer(e,this.glName);this._glName&&i.deleteFramebuffer(this._glName);const r=i.createFramebuffer();if(i.bindFramebuffer(e,r),this._colorAttachments.forEach((s,n)=>{if(f_(s)){const a=pfe(s);a===35866?this._framebufferTextureLayer(s.glName,n,e,0,0):this._framebufferTexture2D(s.glName,n,a,e)}else if(EQ(s)){const a=this._context.gl;a.framebufferRenderbuffer(e,n,a.RENDERBUFFER,s.glName)}}),this._depthStencilBuffer){const s=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);i.framebufferRenderbuffer(e,s,i.RENDERBUFFER,this._depthStencilBuffer.glName)}else if(this._depthStencilTexture){const s=J5(this._depthStencilTexture.descriptor.pixelFormat);this._framebufferTexture2D(this._depthStencilTexture.glName,s,pfe(this._depthStencilTexture),e)}Ko()&&i.checkFramebufferStatus(e)!==i.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=r,this._initialized=!0}_framebufferTexture2D(e,i=Dr,r=3553,s=36160,n=0){this._context.gl.framebufferTexture2D(s,i,r,e,n)}_framebufferTextureLayer(e,i=Dr,r=36160,s=0,n=0){this._context.gl.framebufferTextureLayer(r,i,e,s,n)}_disposeDepthStencilAttachments(){const e=this._context.gl;if(this._depthStencilBuffer){if(this._initialized){this._context.bindFramebuffer(this);const i=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);e.framebufferRenderbuffer(36160,i,e.RENDERBUFFER,null)}this._depthStencilBuffer=Rt(this._depthStencilBuffer)}this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,J5(this._depthStencilTexture.descriptor.pixelFormat))),this._depthStencilTexture=Rt(this._depthStencilTexture))}_validateTextureDescriptor(e){e.target!==3553&&e.target!==34067&&e.target!==35866&&console.error("Texture type must be TEXTURE_2D, TEXTURE_2D_ARRAY or TEXTURE_CUBE_MAP!"),nw(e,this._context.parameters.maxTextureSize),this._validateBufferDimensions(e)}_validateRenderbufferDescriptor(e){nw(e,this._context.parameters.maxRenderbufferSize),this._validateBufferDimensions(e)}_validateBufferDimensions(e){e.width<=0&&(e.width=this.width),e.height<=0&&(e.height=this.height),this.width>0&&this.height>0&&(this.width===e.width&&this.height===e.height||console.error("Attachment size must match framebuffer size!"))}_getGLAttachmentPoint(e){switch(e.internalFormat){case Hh.DEPTH_COMPONENT16:case Hh.DEPTH_COMPONENT24:case Hh.DEPTH_COMPONENT32F:return CAe;case Kf.DEPTH24_STENCIL8:case Kf.DEPTH32F_STENCIL8:return Ba;case 36168:return Rlt;default:return Dr}}_validateColorAttachmentPoint(e){if(kf._MAX_COLOR_ATTACHMENTS===-1){const{gl:r}=this._context;kf._MAX_COLOR_ATTACHMENTS=r.getParameter(r.MAX_COLOR_ATTACHMENTS)}const i=e-Dr;i+1>kf._MAX_COLOR_ATTACHMENTS&&fe.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${i+1}. Implementation supports up to ${kf._MAX_COLOR_ATTACHMENTS} color attachments`)}},kf._MAX_COLOR_ATTACHMENTS=-1,kf);function f_(t){return h8(t)===1}function EQ(t){return h8(t)===2}function Sct(t){return f_(t)||jAe(t)}function jAe(t){return h8(t)===0}function Tct(t){return h8(t)===3||t!=null&&"samples"in t}function h8(t){return t!=null&&"type"in t?t.type:null}function $ct(t,e){return f_(e)||EQ(e)?e:jAe(e)?new Fi(t,e):Tct(e)?new NAe(t,e):null}function nw(t,e){const i=Math.max(t.width,t.height);if(i>e){xct().warnOnce(`Resizing FBO attachment size ${t.width}x${t.height} to device limit ${e}`);const r=e/i;return t.width=Math.round(t.width*r),t.height=Math.round(t.height*r),!1}return!0}function pfe(t){return t.descriptor.target===34067?34069:t.descriptor.target===35866?35866:3553}function J5(t){return t===6402?CAe:Ba}let Yz=class extends Me{constructor(e){super(e),this._needsRender=!0,this._passParameters=new cie,this._configuration=new Zz,this._fbo=new Xv(e.context.renderContext.rctx,new Zi(ty)),e.context.techniques.precompile(J7,new Zz);const i=new Zz;i.mode=1,e.context.techniques.precompile(J7,i)}get textureAtlas(){if(this._texture&&!this._needsRender)return this._texture;this._configuration.mode=this._texture?1:0;const e=this.context.techniques.get(J7,this._configuration);return e.compiled&&(this._texture=this._render(e)),this._texture}updateWeatherMap(e){yU(this._passParameters.weatherTile,e)||(ko(this._passParameters.weatherTile,e),this._needsRender=!0)}destroy(){this._fbo=Rt(this._fbo)}_render(e){if(!this._fbo)return null;const i=this.context.renderContext.rctx,r=i.getViewport();return i.setViewport(0,0,ty,ty),i.bindFramebuffer(this._fbo),i.bindTechnique(e,this.context.renderContext.bind,this._passParameters),i.screen.draw(),i.setViewport(r.x,r.y,r.width,r.height),this._needsRender=!1,this._fbo.colorTexture}};d([m({constructOnly:!0})],Yz.prototype,"context",void 0),Yz=d([k("esri.views.3d.environment.NoiseTextureAtlas")],Yz);let $O=class extends Me{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};d([m()],$O.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),d([m()],$O.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),$O=d([k("esri.views.support.debugFlags")],$O);const Cct=new $O,ea=Symbol("Yield");let Mct=class{constructor(){this._tasks=new Array,this._numPendingTasks=Pn(0),this._readyToRun=Pn(!1)}get length(){return this._tasks.length}get updating(){return this._numPendingTasks.value>0}get readyToRun(){return this._readyToRun.value}_updateReadyToRun(){this._readyToRun.value=this._tasks.length>0}destroy(){this.cancelAll()}runTask(e){if(this.length===0)return ea;for(;!e.done&&this._process(e);)e.madeProgress()}push(e,i,r){return this._addTask((s,n)=>new mfe(s,n,e,i,r),Array.prototype.push)}unshift(e,i,r){return this._addTask((s,n)=>new mfe(s,n,e,i,r),Array.prototype.unshift)}pushGenerator(e,i,r){return this._addTask((s,n)=>new Ect(s,n,e,i,r),Array.prototype.push)}_process(e){if(this._tasks.length===0)return!1;const i=this._tasks.shift();this._updateReadyToRun();try{if(Rn(i.signal))this._cancelTask(i,Xt());else switch(i.type){case 0:this._processSimple(i,e);break;case 1:this._processGenerator(i,e);break;case 2:this._processIterator(i,e);break;default:}}catch(r){i.reject(r)}return!0}cancelAll(){const e=Xt();for(const i of this._tasks)this._cancelTask(i,e);this._tasks.length=0,this._updateReadyToRun()}_cancelTask(e,i){if(e.abortCallback){const r=e.abortCallback(i);e.type===2&&e.iterator.return&&ffe(e.iterator.return()),$a(r)?r.then(e.resolve,e.reject):e.resolve(r)}else e.type===2&&e.iterator.throw&&ffe(e.iterator.throw(i)),e.reject(i)}_onIteratorResult(e,i){i.done?e.resolve(i.value):(this._tasks.unshift(e),this._updateReadyToRun())}_processSimple(e,i){const r=e.callback(i);$a(r)?r.then(e.resolve,e.reject):e.resolve(r)}_processGenerator(e,i){const r=e.generatorFunction(i),s=new Act(e.resolve,e.reject,r,e.signal,e.abortCallback);this._processIterator(s,i)}_processIterator(e,i){const r=e.iterator.next(i);$a(r)?r.then(s=>this._onIteratorResult(e,s),e.reject):this._onIteratorResult(e,r)}_addTask(e,i){return new Promise((r,s)=>{const n=e(r,s);i.call(this._tasks,n),++this._numPendingTasks.value,this._updateReadyToRun()}).finally(()=>--this._numPendingTasks.value)}};function ffe(t){$a(t)?t.then(K7,K7):K7(t)}function K7(t){Hr(t)||t instanceof Error||t instanceof ee||t!=null&&typeof t=="object"&&"done"in t&&t.done||fe.getLogger("esri.layers.support.PromiseQueue").warn("Generator iterator was aborted, but it is not done.")}let die=class{constructor(e,i,r=void 0,s=void 0){this.resolve=e,this.reject=i,this.signal=r,this.abortCallback=s}},mfe=class extends die{constructor(e,i,r,s,n){super(e,i,s,n),this.callback=r,this.type=0}},Ect=class extends die{constructor(e,i,r,s,n){super(e,i,s,n),this.generatorFunction=r,this.type=1}},Act=class extends die{constructor(e,i,r,s,n){super(e,i,s,n),this.iterator=r,this.type=2}};function Oct(){return new Lct}const yt={RESOURCE_CONTROLLER_IMMEDIATE:"immediate",RESOURCE_CONTROLLER:"schedule",SLIDE:"slide",STREAM_DATA_LOADER:"stream loader",ELEVATION_QUERY:"elevation query",TERRAIN_SURFACE:"terrain",SURFACE_GEOMETRY_UPDATES:"surface geometry updates",LOD_RENDERER:"LoD renderer",GRAPHICS_CORE:"Graphics3D",I3S_CONTROLLER:"I3S",POINT_CLOUD_LAYER:"point cloud",FEATURE_TILE_FETCHER:"feature fetcher",STREAM_CONTROLLER:"stream controller",OVERLAY:"overlay",OVERLAY_RENDERER:"overlay renderer",STAGE:"stage",GRAPHICS_DECONFLICTOR:"graphics deconflictor",FILTER_VISIBILITY:"Graphics3D filter visibility",SCALE_VISIBILITY:"Graphics3D scale visibility",FRUSTUM_VISIBILITY:"Graphics3D frustum visibility",POINT_OF_INTEREST_FREQUENT:"POI frequent",POINT_OF_INTEREST_INFREQUENT:"POI infrequent",LABELER:"labeler",FEATURE_QUERY_ENGINE:"feature query",FEATURE_TILE_TREE:"feature tile tree",FEATURE_TILE_TREE_ACTIVE:"fast feature tile tree",ELEVATION_ALIGNMENT:"elevation alignment",ELEVATION_ALIGNMENT_SCENE:"elevation alignment scene",TEXT_TEXTURE_ATLAS:"text texture atlas",TEXTURE_UNLOAD:"texture unload",LINE_OF_SIGHT_TOOL:"line of sight tool",LINE_OF_SIGHT_TOOL_INTERACTIVE:"interactive line of sight tool",ELEVATION_PROFILE:"elevation profile",SNAPPING:"snapping",SHADOW_ACCUMULATOR:"shadow accumulator",CLOUDS_GENERATOR:"clouds generator",FLOW_GENERATOR:"flow generator",MAPVIEW_FETCH_QUEUE:"mapview fetch queue",MAPVIEW_LAYERVIEW_UPDATE:"mapview layerview update",MAPVIEW_VECTOR_TILE_PARSING_QUEUE:"mapview vector tile parsing queue",NONE:0,TEST_PRIO:1},$h=0,gfe=new Map([[yt.RESOURCE_CONTROLLER_IMMEDIATE,$h],[yt.RESOURCE_CONTROLLER,4],[yt.SLIDE,$h],[yt.STREAM_DATA_LOADER,$h],[yt.ELEVATION_QUERY,$h],[yt.TERRAIN_SURFACE,1],[yt.SURFACE_GEOMETRY_UPDATES,1],[yt.LOD_RENDERER,2],[yt.GRAPHICS_CORE,2],[yt.I3S_CONTROLLER,2],[yt.POINT_CLOUD_LAYER,2],[yt.FEATURE_TILE_FETCHER,2],[yt.STREAM_CONTROLLER,2],[yt.CLOUDS_GENERATOR,2],[yt.OVERLAY,4],[yt.OVERLAY_RENDERER,4],[yt.STAGE,4],[yt.GRAPHICS_DECONFLICTOR,4],[yt.FILTER_VISIBILITY,4],[yt.SCALE_VISIBILITY,4],[yt.FRUSTUM_VISIBILITY,4],[yt.POINT_OF_INTEREST_FREQUENT,6],[yt.POINT_OF_INTEREST_INFREQUENT,30],[yt.LABELER,8],[yt.FEATURE_QUERY_ENGINE,8],[yt.FEATURE_TILE_TREE,16],[yt.FEATURE_TILE_TREE_ACTIVE,$h],[yt.ELEVATION_ALIGNMENT,12],[yt.ELEVATION_ALIGNMENT_SCENE,14],[yt.TEXT_TEXTURE_ATLAS,12],[yt.TEXTURE_UNLOAD,12],[yt.LINE_OF_SIGHT_TOOL,16],[yt.LINE_OF_SIGHT_TOOL_INTERACTIVE,$h],[yt.SNAPPING,$h],[yt.SHADOW_ACCUMULATOR,30],[yt.FLOW_GENERATOR,12],[yt.MAPVIEW_FETCH_QUEUE,$h],[yt.MAPVIEW_LAYERVIEW_UPDATE,2],[yt.MAPVIEW_VECTOR_TILE_PARSING_QUEUE,$h]]);function yfe(t){return gfe.has(t)?gfe.get(t):typeof t=="number"?t:1}const Pct=6.5,_fe=1,Rct=30,Dct=1e3/30,Ict=100,vfe=.9;let Lct=class{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some(e=>e.needsUpdate)}constructor(){this._updating=Pn(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new Bg("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new pie,this.state=1,this._tasks=new Array,this._runQueue=new Array,this._load=0,this._forceTask=!1,this._debug=!1,this._debugHandle=K(()=>Cct.SCHEDULER_LOG_SLOW_TASKS,e=>this._debug=e,Wt);for(const e of Object.keys(yt))this.performanceInfo.tasks.set(yt[e],new Bg(String(yt[e])))}destroy(){this._tasks.forEach(e=>e.remove()),this._tasks.length=0,this._runQueue.length=0,Ki(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(e){this._updatingChanged(),e&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this._runFrame())}))}registerTask(e,i){const r=new kct(this,e,i);return this._tasks.push(r),this._updatingChanged(),this.performanceInfo.tasks.has(e)||this.performanceInfo.tasks.set(e,new Bg(e)),r}get load(){return this._load}frame(e){if(this._startFrameTaskTimes(),this._updateBudget(e)){const i=this._budget.now();return this._runFrame(),this._recordFrameTaskTimes(this._budget.now()-i),!0}return this._recordFrameTaskTimes(0),!1}_updateBudget(e){this._test&&(this._test.usedBudget=0),++this._frameNumber;let i=Pct,r=e.frameDuration,s=_fe;switch(this.state){case 2:i=0,r=Math.max(Ict,e.frameDuration),s=Rct;break;case 1:r=Math.max(Dct,e.frameDuration)}return r=r-e.elapsedFrameTime-i,this.state!==2&&r<_fe&&!this._forceTask?(this._forceTask=!0,!1):(r=Math.max(r,s),this._budget.reset(r),this._updateLoad(),this._schedule())}_runFrame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case 2:this._runIdle();break;case 1:this._runInteracting();break;default:this._runAnimating()}this._test&&(this._test.usedBudget=this._budget.elapsed)}stopFrame(){this._budget.reset(0),this._budget.madeProgress()}removeTask(e){Ul(this._tasks,e),Ul(this._runQueue,e),this._updatingChanged()}_updateTask(e){this._tasks.forEach(i=>{i.name===e&&i.setPriority(e)})}_getState(e){if(this._runQueue.some(r=>r.name===e))return"s";let i="i";return this._tasks.forEach(r=>{r.name===e&&r.needsUpdate&&(r.schedulePriority<=1?i="r":i!=="r"&&(i="w"))}),i}_getRuntime(e){let i=0;return this._tasks.forEach(r=>{r.name===e&&(i+=r.runtime)}),i}_resetRuntimes(){this._tasks.forEach(e=>e.runtime=0)}_getRunning(){const e=new Map;if(this._tasks.forEach(r=>{r.needsUpdate&&e.set(r.name,(e.get(r.name)||0)+1)}),e.size===0)return null;let i="";return e.forEach((r,s)=>{i+=r>1?` ${r}x ${s}`:` ${s}`}),i}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const e=this._tasks.reduce((i,r)=>r.needsUpdate?++i:i,0);this._load=this._load*vfe+e*(1-vfe)}_schedule(){for(YV(this._runQueue,e=>!!e.needsUpdate||(e.schedulePriority=e.basePriority,!1)),this._tasks.forEach(e=>{e.basePriority===$h&&e.needsUpdate&&!this._runQueue.includes(e)&&e.blockFrame!==this._frameNumber&&this._runQueue.unshift(e)});this._runQueue.length===0;){let e=!1,i=0;if(this._tasks.forEach(r=>{r.needsUpdate&&r.schedulePriority!==0&&r.basePriority!==$h&&r.blockFrame!==this._frameNumber&&(e=!0,i=Math.max(i,r.basePriority),r.schedulePriority===1?(r.schedulePriority=0,this._runQueue.push(r)):--r.schedulePriority)}),!e)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){do for(;this._runQueue.length>0;){const e=this._budget.now(),i=this._runQueue.pop();this._budget.resetProgress();try{i.task.runTask(this._budget)===ea&&(i.blockFrame=this._frameNumber)}catch(s){fe.getLogger("esri.views.support.Scheduler").error(`Exception in task "${i.name}"`,s),i.blockFrame=this._frameNumber}!this._budget.hasProgressed&&i.blockFrame!==this._frameNumber&&i.needsUpdate&&(i.name,i.blockFrame=this._frameNumber),i.schedulePriority=i.basePriority;const r=this._budget.now()-e;if(i.runtime+=r,this._frameTaskTimes.set(i.priority,this._frameTaskTimes.get(i.priority)+r),this._budget.remaining<=0)return void this._updatingChanged()}while(this._schedule());this._updatingChanged()}_startFrameTaskTimes(){for(const e of Object.keys(yt))this._frameTaskTimes.set(yt[e],0)}_recordFrameTaskTimes(e){this._frameTaskTimes.forEach((i,r)=>this.performanceInfo.tasks.get(r).push(i)),this.performanceInfo.total.push(e)}get test(){return this._test}},kct=class{get task(){return this._task.value}get readyToRun(){return this._queue.readyToRun}get updating(){return this._queue.updating}constructor(e,i,r){this._scheduler=e,this.name=i,this.blockFrame=0,this.runtime=0,this._queue=new Mct,this._handles=new Fv,this._basePriority=yfe(i),this.schedulePriority=this._basePriority,this._task=Pn(r??this._queue),this._handles.add(Zs(()=>this.task.readyToRun,s=>e.taskRunningChanged(s)))}remove(){this.processQueue(sl),this._scheduler.removeTask(this),this.schedule=W_.schedule,this.reschedule=W_.reschedule,this.scheduleGenerator=W_.scheduleGenerator,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(e){if(this.name===e)return;this.name=e;const i=yfe(e);this._basePriority!==$h&&this.schedulePriority===0||(this.schedulePriority=i),this._basePriority=i}get priority(){return this.name}set priority(e){this.setPriority(e)}get needsUpdate(){return this.readyToRun||!this.task.destroyed&&this.task.readyToRun}schedule(e,i,r){return this._queue.push(e,i,r)}reschedule(e,i,r){return this._queue.unshift(e,i,r)}scheduleGenerator(e,i,r){return this._queue.pushGenerator(e,i,r)}processQueue(e){return this._queue.runTask(e)}},pie=class{constructor(){this._begin=performance?.now()??0,this._budget=0,this._done=!1,this._progressed=!1,this._enabled=!0}run(e){return!this.done&&(e()===!0&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get enabled(){return this._enabled}set enabled(e){this._enabled=e}reset(e){this._begin=this.now(),this._budget=e,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return this.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}};const sl=new pie;function zct(t){const e=new pie;return e.reset(t),e}sl.enabled=!1;let Fct=class{remove(){}processQueue(){}schedule(e,i,r){try{if(Rn(i)){const s=Xt();return r?Promise.resolve(r(s)):Promise.reject(s)}return eW(e(sl))}catch(s){return Promise.reject(s)}}reschedule(e,i,r){return this.schedule(e,i,r)}async scheduleGenerator(e,i,r){if(Rn(i)){const n=Xt();if(r)return r(n);throw n}const s=e(sl);for(;;){const n=s.next(sl),a=$a(n)?await n:n;if(Rn(i)){const o=Xt();if(r){const c=r(o),h=s.return(null);return $a(h)&&await Hf(h),c}const l=s.throw(o);throw $a(l)&&await Hf(l),o}if(a.done)return a.value}}};const W_=new Fct;let xl=class extends Me{constructor(e){super(e),this._state=Pn(0),this._passParameters=new tie,this._weatherTileCount=128,this._sliceIndex=0,this._tileIndex=0,this._tilesPerSlice=1,this.coverage=ft(eo.default.coverage[0],eo.default.coverage[1],.5),this.density=ft(eo.default.density[0],eo.default.density[1],.5),this.absorption=ft(eo.default.absorption[0],eo.default.absorption[1],.5),this.cloudSize=ft(eo.default.cloudSize[0],eo.default.cloudSize[1],.5),this.detailSize=ft(eo.default.detailSize[0],eo.default.detailSize[1],.5),this.smoothness=ft(eo.default.smoothness[0],eo.default.smoothness[1],.5),this.cloudHeight=ft(eo.default.cloudHeight[0],eo.default.cloudHeight[1],.5),this.raymarchingSteps=eo.default.raymarchingSteps,this._viewMatrix=it(),this._dirty=!0,this.readyToRun=!0,this._configuration=new MQ}initialize(){const e=or(this.view.spatialReference);this._passParameters.cloudRadius=.5*e.radius;const i=()=>this.setDirty();this.addHandles([this.view.resourceController.scheduler.registerTask(yt.CLOUDS_GENERATOR,this),K(()=>this.coverage,i,Wt),K(()=>this.density,i,Wt),K(()=>this.absorption,i,Wt),K(()=>this.cloudSize,i,Wt),K(()=>this.detailSize,i,Wt),K(()=>this.smoothness,i,Wt),K(()=>this.cloudHeight,i,Wt),K(()=>this.raymarchingSteps,i,Wt)]);const r=u6(this._computeWeatherTile());let s=0;this.addHandles(K(()=>{const n=this._computeWeatherTile();return yU(r,n)||(++s,ko(r,n)),s},i))}destroy(){this.destroyCubeMap(),this._passParameters.noiseTexture=Re(this._passParameters.noiseTexture)}_precompile(){this._configuration.steps=this.raymarchingSteps,this._configuration.writeTextureChannels=0,this.context.techniques.precompile(X7,this._configuration),this._configuration.writeTextureChannels=1,this.context.techniques.precompile(X7,this._configuration)}_acquireTechnique(){switch(this.raymarchingSteps){case 0:this._tilesPerSlice=1;break;case 1:this._tilesPerSlice=4;break;case 3:case 2:this._tilesPerSlice=8;break;default:this.raymarchingSteps}return this._configuration.writeTextureChannels=1-this.parameters.readChannels,this._configuration.steps=this.raymarchingSteps,this.context.techniques.get(X7,this._configuration)}_computeWeatherTile(){const{camera:e,environment:i}=this.view,{latitude:r,longitude:s}=e.position;if(r==null||s==null)return $v;Cr(bd,(r+90)/180,(s+180)/360);const n=Math.floor(this._weatherTileCount*Math.abs(2*bd[0]-1));bd[0]=Math.floor(2*this._weatherTileCount*bd[0]),bd[1]=Math.floor(4*(this._weatherTileCount-n)*bd[1]);let a=0,o=0;if(i?.lighting?.type!=="virtual"&&i?.lighting?.date!=null){const l=new Date(i.lighting.date);l.setUTCHours(i.lighting.date.getUTCHours()+(i.lighting.displayUTCOffset??0)),a=31*l.getUTCMonth()+l.getUTCDate(),o=l.getUTCFullYear()}return bd[0]=(bd[0]+a)%(2*this._weatherTileCount),bd[1]=(bd[1]+o%100)%(4*this._weatherTileCount),bd}get state(){return this._state.value}set state(e){this._state.value=e}get usedMemory(){return(this._fbo?.usedMemory??0)+(this._passParameters.noiseTexture?.textureAtlas?.usedMemory??0)}_ensureNoiseTexture(){return this._passParameters.noiseTexture??=new Yz({context:this.context}),this._passParameters.noiseTexture}_ensureFrameBufferCube(e){const i=this.context.renderContext.rctx;if(this._fbo==null){const r=new Zi(e,e/2);r.target=35866,r.depth=6,r.wrapMode=33071,this._fbo=new Xv(i,r),this.parameters.data=this,this.parameters.absorption=this.absorption,this.parameters.coverage=this.coverage}return i.unbindTexture(this._fbo.colorTexture),this._fbo}get cubeMap(){return this._fbo}get parameters(){return this.context.renderContext.bind.clouds}destroyCubeMap(){this._fbo=Rt(this._fbo),this.parameters.data=null}applyPreset(e,i){const r=e.median,s=n=>{const a=ft(n[0],n[1],r);return i<.5?ft(n[0],a,2*i):ft(a,n[1],2*(i-.5))};this.coverage=s(e.coverage),this.density=s(e.density),this.absorption=s(e.absorption),this.cloudSize=s(e.cloudSize),this.detailSize=s(e.detailSize),this.smoothness=s(e.smoothness),this.cloudHeight=s(e.cloudHeight),this.raymarchingSteps=e.raymarchingSteps,this._precompile()}setDirty(){this._dirty=this.readyToRun=!0}runTask(e){if(this.state===3)return ea;this._dirty&&(this._sliceIndex=this._tileIndex=0,this.state=1,this._passParameters.absorption=this.absorption,this._passParameters.density=this.density,this._passParameters.cloudSize=this.cloudSize,this._passParameters.detailSize=this.detailSize,this._passParameters.smoothness=this.smoothness,this._passParameters.cloudHeight=this.cloudHeight,this._passParameters.coverage=this.coverage,this._ensureNoiseTexture().updateWeatherMap(this._computeWeatherTile()),this._dirty=!1);const i=this._acquireTechnique();if(!this._ensureNoiseTexture().textureAtlas||!i.compiled)return ea;const r=Nct[this._sliceIndex],s=Vct[this._sliceIndex];u3e(this._viewMatrix,Uct,r,s),jv(this._passParameters.viewMatrix,this._viewMatrix);const n=this.context.renderContext.rctx,a=n.getViewport(),o=c$/this._tilesPerSlice,l=this._tileIndex*o;n.setViewport(0,l,c$,o);const c=this._ensureFrameBufferCube(c$);return n.bindFramebuffer(c),this._passParameters.lastSlice=this._sliceIndex===5,n.bindTechnique(i,this.context.renderContext.bind,this._passParameters),c.setColorTextureTarget(35866,Dr,this._sliceIndex),n.screen.draw(),n.gl.flush(),n.setViewport(a.x,a.y,a.width,a.height),this.requestRender(),++this._tileIndex,this._sliceIndex===5&&this._tileIndex===this._tilesPerSlice?(this._sliceIndex=this._tileIndex=0,this.state=2,this.readyToRun=!1):this._tileIndex===this._tilesPerSlice&&(++this._sliceIndex,this._tileIndex=0),e.madeProgress(),ea}};d([m({constructOnly:!0})],xl.prototype,"context",void 0),d([m({constructOnly:!0})],xl.prototype,"view",void 0),d([m({constructOnly:!0})],xl.prototype,"requestRender",void 0),d([m()],xl.prototype,"coverage",void 0),d([m()],xl.prototype,"density",void 0),d([m()],xl.prototype,"absorption",void 0),d([m()],xl.prototype,"cloudSize",void 0),d([m()],xl.prototype,"detailSize",void 0),d([m()],xl.prototype,"smoothness",void 0),d([m()],xl.prototype,"cloudHeight",void 0),d([m()],xl.prototype,"raymarchingSteps",void 0),d([m()],xl.prototype,"readyToRun",void 0),xl=d([k("esri.views.3d.environment.CloudsRenderer")],xl);const Nct=[Ji(1,0,0),Ji(-1,0,0),Ji(0,1,0),Ji(0,-1,0),Ji(0,0,1),Ji(0,0,1)],Vct=[Ji(0,0,-1),Ji(0,0,-1),Ji(0,0,-1),Ji(0,0,-1),Ji(0,1,0),Ji(0,1,0)],Uct=wv(),bd=zee();function x9t(t){return d8(t,!0)}function d8(t,e){if(Array.isArray(t)){if(t.length<Hl)return t}else if(t.length<Hl)return Array.from(t);let i=!0,r=!0;return t.some((s,n)=>(i=i&&s===0,r=r&&s===n,!i&&!r)),i?mie(t.length):r?xM(t.length):iM(t)&&t.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT?t:Bct(t,!e)}function Bct(t,e){for(const i of t){if(i>=65536)return iM(t)?t:new Uint32Array(t);i>=256&&(e=!1)}return e?new Uint8Array(t):new Uint16Array(t)}function S9t(t){return t<=Hl?new Array(t):t<=65536?new Uint16Array(t):new Uint32Array(t)}function T9t(t){return t<=Hl?new Array(t):new Uint32Array(t)}let CO=fie(131072);const qAe=[0],eq=(()=>{const t=new Uint16Array(65536);for(let e=0;e<t.length;++e)t[e]=e;return t})();function xM(t){return t===1?qAe:t<Hl?Array.from(new Uint16Array(eq.buffer,0,t)):t<eq.length?new Uint16Array(eq.buffer,0,t):(t>CO.length&&(CO=fie(Math.max(2*CO.length,t))),new Uint32Array(CO.buffer,0,t))}function fie(t){const e=new Uint32Array(t);for(let i=0;i<e.length;i++)e[i]=i;return e}let MO=new Uint8Array(65536);function mie(t){if(t===1)return qAe;if(t<Hl)return new Array(t).fill(0);if(t>MO.length){const e=Math.max(2*MO.length,t);MO=new Uint8Array(e)}return new Uint8Array(MO.buffer,0,t)}function jct(){CO=fie(131072),MO=new Uint8Array(65536)}let co=class extends Ni{constructor(e,i,r){super(e,"vec3",0,(s,n)=>s.setUniform3fv(e,i(n),r))}},_r=class extends Ni{constructor(e,i,r){super(e,"vec3",1,(s,n,a)=>s.setUniform3fv(e,i(n,a),r))}},Io=class extends Ni{constructor(e,i,r){super(e,"mat4",0,(s,n)=>s.setUniformMatrix4fv(e,i(n),r))}};function GAe(t){const e=new Di;return e.attributes.add("position","vec3"),e.attributes.add("instanceFeatureAttribute","float"),e.vertex.uniforms.add(new co("cameraPosition",i=>i.camera.eye),new _r("offset",(i,r)=>qct(i,r)),new ut("width",i=>i.width),new ut("time",i=>i.time),new Io("proj",i=>i.camera.projectionMatrix),new Io("view",i=>i.camera.viewMatrix)),e.varyings.add("vUv","vec2"),e.vertex.code.add(E`vec3 hash31(float p){
vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
p3 += dot(p3, p3.yzx + 33.33);
return fract((p3.xxy + p3.yzz) * p3.zyx);
}
float hash11(float p){
p = fract(p * 0.1031);
p *= p + 33.33;
p *= p + p;
return fract(p);
}
vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
}`),e.vertex.main.add(E`
      vUv = position.xz;
      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundredths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${t.type===0?E`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:E`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
  `),e.fragment.uniforms.add(new ut("opacity",i=>i.opacity),new co("particleColor",i=>Gct(i,t))),e.fragment.main.add(E`
    float d = length(vUv - vec2(0.5));

    ${t.type===0?E`d = 0.35 * smoothstep(0.5, 0.0, d);`:E`d = smoothstep(0.5, 0.1, d);`}
    fragColor = opacity * vec4(particleColor * d, d);
  `),e}function qct(t,e){const i=e.camera.eye,r=.5*t.width,s=1/t.width,n=f3e(AQ,ve(AQ,(i[0]+r)*s,(i[1]+r)*s,(i[2]+r)*s));return ui(n,i,le(n,n,t.width))}function Gct(t,e){const i=e.type===0?Wct:Hct,r=le(AQ,i,Zct),s=t.camera.eye;Ee(bfe,s);const n=Math.max(0,Oe(bfe,t.lighting.mainLight.direction));return Wi(r,r,i,n)}const AQ=R(),bfe=R(),Hct=Ge(1,1,1),Wct=Ge(.85,.85,.85),Zct=.7,Yct=Object.freeze(Object.defineProperty({__proto__:null,build:GAe},Symbol.toStringTag,{value:"Module"}));let Qct=class extends hr{constructor(){super(...arguments),this.time=0,this.radius=1,this.width=500,this.opacity=0}},wfe=class extends Vi{constructor(e,i){super(e,i,new Ii(Yct,()=>te(()=>Promise.resolve().then(()=>Akt),void 0)),new Map([["position",0],["instanceFeatureAttribute",1]]))}initializePipeline(){return li({blending:Qv,depthTest:{func:515},colorWrite:$i})}},HAe=class extends Fo{constructor(){super(...arguments),this.type=0}};d([oe({count:2})],HAe.prototype,"type",void 0);function Lo(t,e=0){const i=t.stride;return Array.from(t.fields.keys()).map(r=>{const s=t.fields.get(r),n=s.constructor.ElementCount,a=Xct(s.constructor.ElementType),o=s.offset,l=s.optional?.glNormalized??!1;return new Ov(r,n,a,o,i,l,e)})}function Xct(t){switch(t){case"u8":return ar.UNSIGNED_BYTE;case"u16":return ar.UNSIGNED_SHORT;case"u32":return ar.UNSIGNED_INT;case"i8":return ar.BYTE;case"i16":return ar.SHORT;case"i32":return ar.INT;case"f16":return ar.HALF_FLOAT;case"f32":return ar.FLOAT;default:throw new Error("BufferType not supported in WebGL")}}let gie=globalThis.Float16Array;function WAe(...t){return new(gie??Float32Array)(...t)}function y4(){return gie}let np=!!gie;var V$;let ZAe=(V$=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.elementCount=9;const a=this.TypedArrayConstructor;s===void 0&&(s=9*a.BYTES_PER_ELEMENT);const o=i.byteLength===0?0:r;this.typedBuffer=n==null?new a(i,o):new a(i,o,(n-r)/a.BYTES_PER_ELEMENT),this.typedBufferStride=s/a.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}getMat(e,i){let r=e*this.typedBufferStride;for(let s=0;s<9;s++)i[s]=this.typedBuffer[r++];return i}setMat(e,i){let r=e*this.typedBufferStride;for(let s=0;s<9;s++)this.typedBuffer[r++]=i[s]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}copyFrom(e,i,r){const s=this.typedBuffer,n=i.typedBuffer;let a=e*this.typedBufferStride,o=r*i.typedBufferStride;for(let l=0;l<9;++l)s[a++]=n[o++]}get buffer(){return this.typedBuffer.buffer}},V$.ElementCount=9,V$);var U$;let YAe=(U$=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.elementCount=16;const a=this.TypedArrayConstructor;s===void 0&&(s=16*a.BYTES_PER_ELEMENT);const o=i.byteLength===0?0:r;this.typedBuffer=n==null?new a(i,o):new a(i,o,(n-r)/a.BYTES_PER_ELEMENT),this.typedBufferStride=s/a.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}getMat(e,i){let r=e*this.typedBufferStride;for(let s=0;s<16;s++)i[s]=this.typedBuffer[r++];return i}setMat(e,i){let r=e*this.typedBufferStride;for(let s=0;s<16;s++)this.typedBuffer[r++]=i[s]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}copyFrom(e,i,r){this.copyFromTypedBuffer(e,i.typedBuffer,r*i.typedBufferStride)}copyFromTypedBuffer(e,i,r){const s=this.typedBuffer;let n=e*this.typedBufferStride;for(let a=0;a<16;++a)s[n++]=i[r++]}get buffer(){return this.typedBuffer.buffer}},U$.ElementCount=16,U$);var B$;let ky=(B$=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.elementCount=1;const a=this.TypedArrayConstructor;s===void 0&&(s=a.BYTES_PER_ELEMENT);const o=i.byteLength===0?0:r;this.typedBuffer=n==null?new a(i,o):new a(i,o,(n-r)/a.BYTES_PER_ELEMENT),this.stride=s,this.typedBufferStride=s/a.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride)}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}get(e){return this.typedBuffer[e*this.typedBufferStride]}set(e,i){this.typedBuffer[e*this.typedBufferStride]=i}get buffer(){return this.typedBuffer.buffer}},B$.ElementCount=1,B$);var j$;let zy=(j$=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.start=r,this.elementCount=2;const a=this.TypedArrayConstructor;s===void 0&&(s=2*a.BYTES_PER_ELEMENT);const o=i.byteLength===0?0:r;this.typedBuffer=n==null?new a(i,o):new a(i,o,(n-r)/a.BYTES_PER_ELEMENT),this.typedBufferStride=s/a.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}getVec(e,i){return e*=this.typedBufferStride,Cr(i,this.typedBuffer[e],this.typedBuffer[e+1])}setVec(e,i){e*=this.typedBufferStride,this.typedBuffer[e++]=i[0],this.typedBuffer[e]=i[1]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}setValues(e,i,r){e*=this.typedBufferStride,this.typedBuffer[e++]=i,this.typedBuffer[e]=r}copyFrom(e,i,r){const s=this.typedBuffer,n=i.typedBuffer;let a=e*this.typedBufferStride,o=r*i.typedBufferStride;s[a++]=n[o++],s[a]=n[o]}get buffer(){return this.typedBuffer.buffer}},j$.ElementCount=2,j$);var q$;let Fy=(q$=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.elementCount=3;const a=this.TypedArrayConstructor;s===void 0&&(s=3*a.BYTES_PER_ELEMENT);const o=i.byteLength===0?0:r;this.typedBuffer=n==null?new a(i,o):new a(i,o,(n-r)/a.BYTES_PER_ELEMENT),this.typedBufferStride=s/a.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}getVec(e,i){return e*=this.typedBufferStride,ve(i,this.typedBuffer[e],this.typedBuffer[e+1],this.typedBuffer[e+2])}setVec(e,i){e*=this.typedBufferStride,this.typedBuffer[e++]=i[0],this.typedBuffer[e++]=i[1],this.typedBuffer[e]=i[2]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}setValues(e,i,r,s){e*=this.typedBufferStride,this.typedBuffer[e++]=i,this.typedBuffer[e++]=r,this.typedBuffer[e]=s}copyFrom(e,i,r){const s=this.typedBuffer,n=i.typedBuffer;let a=e*this.typedBufferStride,o=r*i.typedBufferStride;s[a++]=n[o++],s[a++]=n[o++],s[a]=n[o]}get buffer(){return this.typedBuffer.buffer}},q$.ElementCount=3,q$);var G$;let Ny=(G$=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.start=r,this.elementCount=4;const a=this.TypedArrayConstructor;s===void 0&&(s=4*a.BYTES_PER_ELEMENT);const o=i.byteLength===0?0:r;this.typedBuffer=n==null?new a(i,o):new a(i,o,(n-r)/a.BYTES_PER_ELEMENT),this.typedBufferStride=s/a.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}getVec(e,i){return e*=this.typedBufferStride,yr(i,this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e])}setVec(e,i){e*=this.typedBufferStride,this.typedBuffer[e++]=i[0],this.typedBuffer[e++]=i[1],this.typedBuffer[e++]=i[2],this.typedBuffer[e]=i[3]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}setValues(e,i,r,s,n){e*=this.typedBufferStride,this.typedBuffer[e++]=i,this.typedBuffer[e++]=r,this.typedBuffer[e++]=s,this.typedBuffer[e]=n}copyFrom(e,i,r){const s=this.typedBuffer,n=i.typedBuffer;let a=e*this.typedBufferStride,o=r*i.typedBufferStride;s[a++]=n[o++],s[a++]=n[o++],s[a++]=n[o++],s[a]=n[o]}get buffer(){return this.typedBuffer.buffer}},G$.ElementCount=4,G$);const Wo=ri();let Jct=class{constructor(e){this.message=e}toString(){return`AssertException: ${this.message}`}};function dt(t,e="Assertion"){if(!t){const i=new Error(e).stack;throw new Jct(`${e} at ${i}`)}}function xS(t,e){t||(e=e||"",console.warn("Verify failed: "+e+`
`+new Error("verify").stack))}function QAe(t,e,i,r){let s,n=(i[0]-t[0])/e[0],a=(r[0]-t[0])/e[0];n>a&&(s=n,n=a,a=s);let o=(i[1]-t[1])/e[1],l=(r[1]-t[1])/e[1];if(o>l&&(s=o,o=l,l=s),n>l||o>a)return!1;o>n&&(n=o),l<a&&(a=l);let c=(i[2]-t[2])/e[2],h=(r[2]-t[2])/e[2];return c>h&&(s=c,c=h,h=s),!(n>h||c>a)&&(h<a&&(a=h),!(a<0))}function K5(t,e,i,r,s,n=pt()){const a=(r[s]-i[s])*(e[0]-t[0])-(r[0]-i[0])*(e[s]-t[s]),o=(r[0]-i[0])*(t[s]-i[s])-(r[s]-i[s])*(t[0]-i[0]);if(a===0)return!1;const l=o/a;return n[0]=t[0]+l*(e[0]-t[0]),n[1]=t[s]+l*(e[s]-t[s]),!0}function xfe(t,e,i,r,s){Wo[0]=t[0],Wo[1]=t[1],Wo[2]=t[2],Wo[3]=1,Dc(Wo,Wo,e),s.length>2&&(s[2]=-Wo[2]),Dc(Wo,Wo,i),dt(Wo[3]!==0),s[0]=Wo[0]/Wo[3],s[1]=Wo[1]/Wo[3],s[2]=Wo[2]/Wo[3],s[0]=(.5*s[0]+.5)*r[2]+r[0],s[1]=(.5*s[1]+.5)*r[3]+r[1]}function Kct(t,e){return Math.log(t)/Math.log(e)}function eut(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[3]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[7]===0&&t[8]===0&&t[9]===0&&t[10]===1&&t[11]===0&&t[15]===1}var H$;let tut=(H$=class extends ky{constructor(e,i=0,r,s){dt(np),super(y4(),e,i,r,s),this.elementType="f16"}},H$.ElementType="f16",H$);var W$;let oD=(W$=class extends ky{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}},W$.ElementType="f32",W$);var Bw;let XAe=(Bw=class extends zy{constructor(e,i=0,r,s){dt(np),super(y4(),e,i,r,s),this.elementType="f16"}slice(e,i){return this.sliceBuffer(Bw,e,i)}},Bw.ElementType="f16",Bw);var jw;let E6=(jw=class extends zy{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}slice(e,i){return this.sliceBuffer(jw,e,i)}},jw.ElementType="f32",jw);var qw;let JAe=(qw=class extends Fy{constructor(e,i=0,r,s){dt(np),super(y4(),e,i,r,s),this.elementType="f16"}slice(e,i){return this.sliceBuffer(qw,e,i)}},qw.ElementType="f16",qw);var iv;let Z_=(iv=class extends Fy{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}slice(e,i){return this.sliceBuffer(iv,e,i)}static fromTypedArray(e,i){return new iv(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}},iv.ElementType="f32",iv);var Gw;let KAe=(Gw=class extends Ny{constructor(e,i=0,r,s){dt(np),super(y4(),e,i,r,s),this.elementType="f16"}slice(e,i){return this.sliceBuffer(Gw,e,i)}},Gw.ElementType="f16",Gw);var Hw;let Yx=(Hw=class extends Ny{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}slice(e,i){return this.sliceBuffer(Hw,e,i)}},Hw.ElementType="f32",Hw);var Ww;let eOe=(Ww=class extends ZAe{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}slice(e,i){return this.sliceBuffer(Ww,e,i)}},Ww.ElementType="f32",Ww);var Zw;let tOe=(Zw=class extends ZAe{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(Zw,e,i)}},Zw.ElementType="f64",Zw);var Yw;let iOe=(Yw=class extends YAe{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}slice(e,i){return this.sliceBuffer(Yw,e,i)}},Yw.ElementType="f32",Yw);var Qw;let rOe=(Qw=class extends YAe{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(Qw,e,i)}},Qw.ElementType="f64",Qw);var Xw;let sOe=(Xw=class extends ky{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(Xw,e,i)}},Xw.ElementType="f64",Xw);var Jw;let nOe=(Jw=class extends zy{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(Jw,e,i)}},Jw.ElementType="f64",Jw);var rv;let aOe=(rv=class extends Fy{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(rv,e,i)}static fromTypedArray(e,i){return new rv(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}},rv.ElementType="f64",rv);var Kw;let oOe=(Kw=class extends Ny{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(Kw,e,i)}},Kw.ElementType="f64",Kw);var ex;let A6=(ex=class extends ky{constructor(e,i=0,r,s){super(Uint8Array,e,i,r,s),this.elementType="u8"}slice(e,i){return this.sliceBuffer(ex,e,i)}},ex.ElementType="u8",ex);var tx;let lOe=(tx=class extends zy{constructor(e,i=0,r,s){super(Uint8Array,e,i,r,s),this.elementType="u8"}slice(e,i){return this.sliceBuffer(tx,e,i)}},tx.ElementType="u8",tx);var sv;let iut=(sv=class extends Fy{constructor(e,i=0,r,s){super(Uint8Array,e,i,r,s),this.elementType="u8"}slice(e,i){return this.sliceBuffer(sv,e,i)}static fromTypedArray(e,i){return new sv(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}},sv.ElementType="u8",sv);var ix;let Bu=(ix=class extends Ny{constructor(e,i=0,r,s){super(Uint8Array,e,i,r,s),this.elementType="u8"}slice(e,i){return this.sliceBuffer(ix,e,i)}},ix.ElementType="u8",ix);var rx;let cOe=(rx=class extends ky{constructor(e,i=0,r,s){super(Uint16Array,e,i,r,s),this.elementType="u16"}slice(e,i){return this.sliceBuffer(rx,e,i)}},rx.ElementType="u16",rx);var sx;let uOe=(sx=class extends zy{constructor(e,i=0,r,s){super(Uint16Array,e,i,r,s),this.elementType="u16"}slice(e,i){return this.sliceBuffer(sx,e,i)}},sx.ElementType="u16",sx);var nx;let rut=(nx=class extends Fy{constructor(e,i=0,r,s){super(Uint16Array,e,i,r,s),this.elementType="u16"}slice(e,i){return this.sliceBuffer(nx,e,i)}},nx.ElementType="u16",nx);var ax;let hOe=(ax=class extends Ny{constructor(e,i=0,r,s){super(Uint16Array,e,i,r,s),this.elementType="u16"}slice(e,i){return this.sliceBuffer(ax,e,i)}},ax.ElementType="u16",ax);var ox;let dOe=(ox=class extends ky{constructor(e,i=0,r,s){super(Uint32Array,e,i,r,s),this.elementType="u32"}slice(e,i){return this.sliceBuffer(ox,e,i)}},ox.ElementType="u32",ox);var lx;let sut=(lx=class extends zy{constructor(e,i=0,r,s){super(Uint32Array,e,i,r,s),this.elementType="u32"}slice(e,i){return this.sliceBuffer(lx,e,i)}},lx.ElementType="u32",lx);var cx;let nut=(cx=class extends Fy{constructor(e,i=0,r,s){super(Uint32Array,e,i,r,s),this.elementType="u32"}slice(e,i){return this.sliceBuffer(cx,e,i)}},cx.ElementType="u32",cx);var ux;let aut=(ux=class extends Ny{constructor(e,i=0,r,s){super(Uint32Array,e,i,r,s),this.elementType="u32"}slice(e,i){return this.sliceBuffer(ux,e,i)}},ux.ElementType="u32",ux);var hx;let pOe=(hx=class extends ky{constructor(e,i=0,r,s){super(Int8Array,e,i,r,s),this.elementType="i8"}slice(e,i){return this.sliceBuffer(hx,e,i)}},hx.ElementType="i8",hx);var dx;let fOe=(dx=class extends zy{constructor(e,i=0,r,s){super(Int8Array,e,i,r,s),this.elementType="i8"}slice(e,i){return this.sliceBuffer(dx,e,i)}},dx.ElementType="i8",dx);var px;let out=(px=class extends Fy{constructor(e,i=0,r,s){super(Int8Array,e,i,r,s),this.elementType="i8"}slice(e,i){return this.sliceBuffer(px,e,i)}},px.ElementType="i8",px);var fx;let lut=(fx=class extends Ny{constructor(e,i=0,r,s){super(Int8Array,e,i,r,s),this.elementType="i8"}slice(e,i){return this.sliceBuffer(fx,e,i)}},fx.ElementType="i8",fx);var mx;let cut=(mx=class extends ky{constructor(e,i=0,r,s){super(Int16Array,e,i,r,s),this.elementType="i16"}slice(e,i){return this.sliceBuffer(mx,e,i)}},mx.ElementType="i16",mx);var gx;let O6=(gx=class extends zy{constructor(e,i=0,r,s){super(Int16Array,e,i,r,s),this.elementType="i16"}slice(e,i){return this.sliceBuffer(gx,e,i)}},gx.ElementType="i16",gx);var yx;let uut=(yx=class extends Fy{constructor(e,i=0,r,s){super(Int16Array,e,i,r,s),this.elementType="i16"}slice(e,i){return this.sliceBuffer(yx,e,i)}},yx.ElementType="i16",yx);var _x;let mOe=(_x=class extends Ny{constructor(e,i=0,r,s){super(Int16Array,e,i,r,s),this.elementType="i16"}slice(e,i){return this.sliceBuffer(_x,e,i)}},_x.ElementType="i16",_x);var vx;let hut=(vx=class extends ky{constructor(e,i=0,r,s){super(Int32Array,e,i,r,s),this.elementType="i32"}slice(e,i){return this.sliceBuffer(vx,e,i)}},vx.ElementType="i32",vx);var bx;let dut=(bx=class extends zy{constructor(e,i=0,r,s){super(Int32Array,e,i,r,s),this.elementType="i32"}slice(e,i){return this.sliceBuffer(bx,e,i)}},bx.ElementType="i32",bx);var wx;let put=(wx=class extends Fy{constructor(e,i=0,r,s){super(Int32Array,e,i,r,s),this.elementType="i32"}slice(e,i){return this.sliceBuffer(wx,e,i)}},wx.ElementType="i32",wx);var xx;let fut=(xx=class extends Ny{constructor(e,i=0,r,s){super(Int32Array,e,i,r,s),this.elementType="i32"}slice(e,i){return this.sliceBuffer(xx,e,i)}},xx.ElementType="i32",xx);function Sfe(t){switch(t){case"u8":case"i8":return 1;case"u16":case"i16":case"f16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8}}let Tfe=class gOe{constructor(e,i){this.layout=e,this.buffer=typeof i=="number"?new ArrayBuffer(i*e.stride):i;for(const r of e.fields.keys()){const s=e.fields.get(r);this[r]=new s.constructor(this.buffer,s.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(e,i){const r=this[e];return r&&r.elementCount===i.ElementCount&&r.elementType===i.ElementType?r:null}slice(e,i){return new gOe(this.layout,this.buffer.slice(e*this.stride,i*this.stride))}copyFrom(e,i=0,r=0,s=e.count){const n=this.stride;if(n%4==0){const a=new Uint32Array(e.buffer,i*n,s*n/4);new Uint32Array(this.buffer,r*n,s*n/4).set(a)}else{const a=new Uint8Array(e.buffer,i*n,s*n);new Uint8Array(this.buffer,r*n,s*n).set(a)}return this}get usedMemory(){return this.byteLength}dispose(){}},mut=class yOe{constructor(e){this._stride=0,this._fields=new Map,e&&(this._stride=e.stride,e.fields.forEach(i=>this._fields.set(i[0],{...i[1],constructor:yut(i[1].constructor)})))}freeze(){return this}get locations(){return ed(Lo(this))}vec2f16(e,i){return this._appendField(e,np?XAe:E6,i),this}vec2f(e,i){return this._appendField(e,E6,i),this}vec2f64(e,i){return this._appendField(e,nOe,i),this}vec3f16(e,i){return this._appendField(e,np?JAe:Z_,i),this}vec3f(e,i){return this._appendField(e,Z_,i),this}vec3f64(e,i){return this._appendField(e,aOe,i),this}vec4f16(e,i){return this._appendField(e,np?KAe:Yx,i),this}vec4f(e,i){return this._appendField(e,Yx,i),this}vec4f64(e,i){return this._appendField(e,oOe,i),this}mat3f(e,i){return this._appendField(e,eOe,i),this}mat3f64(e,i){return this._appendField(e,tOe,i),this}mat4f(e,i){return this._appendField(e,iOe,i),this}mat4f64(e,i){return this._appendField(e,rOe,i),this}vec4u8(e,i){return this._appendField(e,Bu,i),this}f16(e,i){return this._appendField(e,np?tut:oD,i),this}f32(e,i){return this._appendField(e,oD,i),this}f64(e,i){return this._appendField(e,sOe,i),this}u8(e,i){return this._appendField(e,A6,i),this}u16(e,i){return this._appendField(e,cOe,i),this}i8(e,i){return this._appendField(e,pOe,i),this}vec2i8(e,i){return this._appendField(e,fOe,i),this}vec2i16(e,i){return this._appendField(e,O6,i),this}vec2u8(e,i){return this._appendField(e,lOe,i),this}vec2u16(e,i){return this._appendField(e,uOe,i),this}vec4u16(e,i){return this._appendField(e,hOe,i),this}vec4i16(e,i){return this._appendField(e,mOe,i),this}u32(e,i){return this._appendField(e,dOe,i),this}_appendField(e,i,r){this._fields.has(e)&&dt(!1,`${e} already added to vertex buffer layout`);const s=i.ElementCount*Sfe(i.ElementType),n=this._stride;this._fields.set(e,{constructor:i,size:s,offset:n,optional:r}),this._alignFields()}_alignFields(){let e=0,i=1;this._fields.forEach(r=>{const s=Sfe(r.constructor.ElementType);e=Math.floor((e+s-1)/s)*s,r.offset=e,e+=r.size,i=Math.max(i,s)}),e=Math.floor((e+i-1)/i)*i,this._stride=e}createBuffer(e){return new Tfe(this,e)}createView(e){return new Tfe(this,e)}clone(){const e=new yOe;return e._stride=this._stride,e._fields=new Map,this._fields.forEach((i,r)=>e._fields.set(r,i)),e.BufferType=this.BufferType,e}get stride(){return this._stride}get fields(){return this._fields}};function jc(){return new mut}let R9t=class{constructor(e){this.fields=new Array,e.fields.forEach((i,r)=>{const s={...i,constructor:_Oe(i.constructor)};this.fields.push([r,s])}),this.stride=e.stride}};const gut=[oD,E6,Z_,Yx,eOe,iOe,sOe,nOe,aOe,oOe,tOe,rOe,A6,lOe,iut,Bu,cOe,uOe,rut,hOe,dOe,sut,nut,aut,pOe,fOe,out,lut,cut,O6,uut,mOe,hut,dut,put,fut];function _Oe(t){return`${t.ElementType}_${t.ElementCount}`}function yut(t){return vOe.get(t)}const vOe=new Map;gut.forEach(t=>vOe.set(_Oe(t),t));let Nl=class extends Me{constructor(e){super(e),this.view=null,this.consumes={required:[]},this.produces=es.COMPOSITE,this.requireGeometryDepth=!1,this._dirty=!0}initialize(){this.addHandles([K(()=>this.view.ready,e=>{e&&this.view.stage?.renderer.addRenderNode(this)},Wt)])}destroy(){this.view.stage?.renderer?.removeRenderNode(this)}precompile(){}render(){throw new ee("RenderNode:render-function-not-implemented","render() is not implemented.")}get camera(){return this.view.state.camera.clone()}get sunLight(){return this.bindParameters.lighting.legacy}get gl(){return this.view.stage.renderView.renderingContext.gl}get techniques(){return this.view.stage.renderView.techniques}acquireOutputFramebuffer(){const e=this._frameBuffer?.getTexture()?.descriptor,i=this.view.stage.renderer.fboCache.acquire(e?.width??640,e?.height??480,this.produces);return i.fbo?.initializeAndBind(),i}bindRenderTarget(){return this._frameBuffer?.fbo?.initializeAndBind(),this._frameBuffer}requestRender(e){switch(e){case 2:this.view.state.fading=!0;case 1:this.view.stage?.renderView.requestRender(e);case 0:case void 0:this._dirty=!0}}resetWebGLState(){this.renderingContext.resetState(),this.renderingContext.bindFramebuffer(this._frameBuffer?.fbo)}get fboCache(){return this.view.stage.renderer.fboCache}get bindParameters(){return this.renderContext.bind}get renderingContext(){return this.view.stage.renderView.renderingContext}get renderContext(){return this.view.stage?.renderer.renderContext}updateAnimation(e){return!!this._dirty&&(this._dirty=!1,!0)}doRender(e){this._frameBuffer=e.find(({name:i})=>i===this.produces);try{return this.render(e)}finally{this._frameBuffer=null}}};d([m({constructOnly:!0})],Nl.prototype,"view",void 0),d([m({constructOnly:!0})],Nl.prototype,"consumes",void 0),d([m()],Nl.prototype,"produces",void 0),d([m({readOnly:!0})],Nl.prototype,"techniques",null),Nl=d([k("esri.views.3d.webgl.RenderNode")],Nl);let Nf=class extends Nl{constructor(){super(...arguments),this.produces="disabled",this.consumes={required:[ht.OPAQUE_ENVIRONMENT]}}_enable(){this.produces=ht.OPAQUE_ENVIRONMENT,this.requestRender(1)}_disable(){this.produces="disabled",this.requestRender(1)}};d([m()],Nf.prototype,"produces",void 0),d([m()],Nf.prototype,"consumes",void 0),Nf=d([k("esri.views.3d.webgl-engine.effects.OpaqueEnvironment")],Nf);let Ow=class extends Nf{constructor(){super(...arguments),this.consumes={required:[ht.TRANSPARENT_ENVIRONMENT]}}_enable(){this.produces=ht.TRANSPARENT_ENVIRONMENT,this.requestRender(1)}};d([m()],Ow.prototype,"consumes",void 0),Ow=d([k("esri.views.3d.webgl-engine.effects.TransparentEnvironment")],Ow);const tq=()=>fe.getLogger("esri.views.webgl.VertexArrayObject");let by=class bOe{constructor(e,i,r,s){this._context=e,this._indexBuffer=r,this._buffers=i instanceof Map?i:new Map([["geometry",i]]),this._baseInstances=s==null?new Map:typeof s=="number"?new Map([["geometry",s]]):s,this.locations=nct(this._buffers)}get glName(){return this._glName}get context(){return this._context}get buffers(){return this._buffers}buffer(e="geometry"){return this.buffers.get(e)}get indexBuffer(){return this._indexBuffer}getByteLength(e){return this.buffer(e)?.sizeBytes??0}vertexCount(e){const i=this.buffer(e);return i?i.sizeBytes/i.layout[0].stride:0}get usedMemory(){return Array.from(this._buffers.values()).reduce((e,i)=>e+i.usedMemory,this._indexBuffer?.usedMemory??0+(this._buffers.size+(this._indexBuffer?1:0))*fte)}dispose(){this._context?(this._buffers.forEach(e=>e.dispose()),this._buffers.clear(),this._indexBuffer=Rt(this._indexBuffer),this.disposeVAOOnly()):(this._glName||this._buffers.size>0)&&tq().warn("Leaked WebGL VAO")}disposeVAOOnly(){this._context?(this._context.getBoundVAO()===this&&this._context.bindVAO(null),this._glName&&(this._context.gl.deleteVertexArray(this._glName),this._glName=null,this._context.instanceCounter.decrement(Bs.VertexArrayObject,this)),this._context=null):this._glName&&tq().warn("Leaked WebGL VAO")}bind(e=this.locations){const i=this._context.gl;this._glName?i.bindVertexArray(this._glName):(this._context.instanceCounter.increment(Bs.VertexArrayObject,this),this._glName=i.createVertexArray(),i.bindVertexArray(this._glName),this._bindLayout(e))}_bindLayout(e){const{_buffers:i,_indexBuffer:r}=this;if(i||tq().error("Vertex buffer dictionary is empty!"),i.forEach((s,n)=>FAe(this._context,e,s,this._baseInstances.get(n)??0)),r!=null){const s=this._context.gl;this._context.gl.bindBuffer(s.ELEMENT_ARRAY_BUFFER,r.glName)}}unbind(){this._context.gl.bindVertexArray(null)}shallowCloneWithBaseInstances(e){return new bOe(this._context,this._buffers,this._indexBuffer,e)}},Op=class extends by{},Hs=class extends Uu{constructor(e,i,r,s=35044){super(e,34962,s,r),this.layout=i}},Qz=class extends Ow{constructor(e){super(e),this._hasSnowCover=!1,this._rainSpeed=.1,this._snowSpeed=.01,this._numParticles=0,this._passParameters=new Qct,this._configuration=new HAe;const{view:i,type:r}=e;this._configuration.type=r==="rainy"?0:1,i.stage.renderView.techniques.precompile(wfe,this._configuration),this._passParameters.time=0,this._passParameters.radius=or(i.spatialReference).radius,this.addHandles([K(()=>i.environment.weather,s=>{s.type===r&&this.addHandles([K(()=>s.precipitation,n=>this._adjustParticles(n),At),K(()=>s.type==="snowy"&&s.snowCover==="enabled",n=>this._hasSnowCover=n,At)])},At)]),this.addHandles(K(()=>i.stage?.renderer.renderContext.bind.clouds.fadeFactor??1,s=>{this._passParameters.opacity=s,s===1&&(this.removeHandles("opacity"),this.addHandles(K(()=>i.stage?.renderer.renderContext.bind.clouds.opacity??1,n=>this._passParameters.opacity=n,At),"opacity"))},Yt),"opacity")}initialize(){this.addHandles([K(()=>this.view.environment.atmosphereEnabled,e=>e?this._enable():this._disable(),At)])}_adjustParticles(e){const r=e<.5?ft(0,.35,2*e):ft(.35,1,2*(e-.5));this._numParticles=$fe*r}destroy(){this._numParticles=0,this._vao=Rt(this._vao),this._instanceIdBuffer=Rt(this._instanceIdBuffer)}fadeOut(e){this.removeAllHandles(),this.addHandles(K(()=>this.renderContext?.bind.clouds.fadeFactor??1,i=>{this._passParameters.opacity=1-i,i===1&&(this.removeAllHandles(),e())}),"opacity")}get snowCover(){return this._hasSnowCover?this._passParameters.opacity:null}updateAnimation(e){const i=(this.type==="rainy"?this._rainSpeed:this._snowSpeed)*gK(e.time)%1e5;return this._passParameters.time!==i&&(this._passParameters.time=i,!0)}render(e){const i=this.renderingContext,r=Math.round(this._numParticles*this._passParameters.opacity),s=e.find(({name:o})=>o===ht.TRANSPARENT_ENVIRONMENT);if(r<1)return s;const n=this.techniques.get(wfe,this._configuration);if(!n.compiled)return this.requestRender(1),s;const a=i.bindTechnique(n,this.bindParameters,this._passParameters);return this._vao??=_ut(i),i.bindVAO(this._vao),this._bindInstanceIdBuffer(a.locations),a.assertCompatibleVertexAttributeLocations(this._vao,ed(Cfe)),i.drawArraysInstanced(lr.TRIANGLES,0,3,r),i.unbindBuffer(34962),s}_bindInstanceIdBuffer(e){const i=this.renderingContext;if(this._instanceIdBuffer)return void i.bindBuffer(this._instanceIdBuffer);const r=xM($fe);this._instanceIdBuffer=new Hs(i,Cfe,new Float32Array(r)),FAe(i,e,this._instanceIdBuffer,0)}};function _ut(t){const e=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new Op(t,new Hs(t,Lo(vut),e))}d([m({constructOnly:!0})],Qz.prototype,"type",void 0),Qz=d([k("esri.views.3d.environment.Precipitation")],Qz);const $fe=25e4,vut=jc().vec3f("position").freeze(),Cfe=Lo(jc().f32("instanceFeatureAttribute"),1);var OQ;let EO=OQ=class extends ke{constructor(t){super(t),this.type="cloudy",this.cloudCover=.5}clone(){return new OQ({cloudCover:this.cloudCover})}};d([Et({cloudy:"cloudy"}),m({json:{write:{isRequired:!0}}})],EO.prototype,"type",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],EO.prototype,"cloudCover",void 0),EO=OQ=d([k("esri.views.3d.environment.CloudyWeather")],EO);const but=EO;var PQ;let AO=PQ=class extends ke{constructor(t){super(t),this.type="foggy",this.fogStrength=.5}clone(){return new PQ({fogStrength:this.fogStrength})}};d([Et({foggy:"foggy"}),m({json:{write:{isRequired:!0}}})],AO.prototype,"type",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],AO.prototype,"fogStrength",void 0),AO=PQ=d([k("esri.views.3d.environment.FoggyWeather")],AO);const wut=AO;var RQ;let ET=RQ=class extends ke{constructor(t){super(t),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new RQ({cloudCover:this.cloudCover,precipitation:this.precipitation})}};d([Et({rainy:"rainy"}),m({json:{write:{isRequired:!0}}})],ET.prototype,"type",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],ET.prototype,"cloudCover",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],ET.prototype,"precipitation",void 0),ET=RQ=d([k("esri.views.3d.environment.RainyWeather")],ET);const xut=ET;var DQ;let fb=DQ=class extends ke{constructor(t){super(t),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new DQ({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};d([Et({snowy:"snowy"}),m({json:{write:{isRequired:!0}}})],fb.prototype,"type",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],fb.prototype,"cloudCover",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],fb.prototype,"precipitation",void 0),d([m({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],fb.prototype,"snowCover",void 0),fb=DQ=d([k("esri.views.3d.environment.SnowyWeather")],fb);const Sut=fb;var IQ;let OO=IQ=class extends ke{constructor(t){super(t),this.type="sunny",this.cloudCover=.5}clone(){return new IQ({cloudCover:this.cloudCover})}};d([Et({sunny:"sunny"}),m({json:{write:{isRequired:!0}}})],OO.prototype,"type",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],OO.prototype,"cloudCover",void 0),OO=IQ=d([k("esri.views.3d.environment.SunnyWeather")],OO);const P6=OO,yie={key:"type",base:P6,typeMap:{sunny:P6,cloudy:but,rainy:xut,snowy:Sut,foggy:wut}},Tut=Object.keys(yie.typeMap);function $ut(t,e){return!!Tut.includes(t)||(e.error(`"${t}" is not a valid weather type`),!1)}const aw=1e4,Cut=1e5,wOe={required:[]},Mut={required:[2]};let xOe=class extends Me{precompile(e){return!!this.acquireTechniques(e)}consumes(){return wOe}get usedMemory(){return 0}get renderOccludedFlags(){return 1}get isDecoration(){return!1}get readyToRun(){return!1}get numGeometries(){return 0}get hasOccludees(){return!1}get hasEmitters(){return!1}forEachGeometry(e){}},_4=class extends xOe{},B9t=class extends xOe{},mb=class extends _4{constructor(e){super(e),this.produces=new Map([]),this._clouds=Pn(null),this._incarnation=0,this._precipitation=null}initialize(){this.view.stage?.addRenderPlugin(this)}destroy(){this.removeHandles(),this.uninitializeRenderContext(),this.view?.stage?.removeRenderPlugin(this),this._set("view",null)}get updating(){return!!this._clouds.value?.readyToRun}get weatherAvailable(){return Le(this.view.state.camera.eye)-or(this.view.spatialReference).radius<=aw}get usedMemory(){return this._clouds.value?.usedMemory??0}_fadeOutPrecipitation(){this._precipitation&&(this._precipitationOutgoing?.destroy(),this._precipitationOutgoing=this._precipitation,this._precipitationOutgoing.fadeOut(()=>this._precipitationOutgoing=Re(this._precipitationOutgoing)),this._precipitation=null,++this._incarnation)}get _snowCover(){return this._precipitationOutgoing?.snowCover??this._precipitation?.snowCover??0}get weather(){return this.view?.environmentManager?.weatherEnabled?this.view.environment.weather:null}initializeRenderContext(e){this._context=e;const i=this.view,r=()=>this._requestRender();this.addHandles([K(()=>this._precipitation,r,Yt),K(()=>this._clouds.value?.state,r,Yt),K(()=>i.state.mode,r,Yt),K(()=>this._updateClouds(),r,Yt),K(()=>this._updatePrecipitation(),r,Yt),K(()=>this.weather,s=>this._initWeather(s))])}uninitializeRenderContext(){this._context=null,this._clouds.value=Re(this._clouds.value),this._precipitation=Re(this._precipitation),this._precipitationOutgoing=Re(this._precipitationOutgoing)}prepareRender(e){const{bind:i,time:r}=e;if(this.view.state.viewingMode===1){if(i.clouds.data){i.clouds.fade(i.camera,r,this.view.qualitySettings.fadeDuration);const s=this._clouds.value;s&&s.state===0&&s.coverage===0&&!s.readyToRun&&s.destroyCubeMap()}i.snowCover=this._snowCover}}acquireTechniques(){return[]}render(){}_requestRender(){this._context?.requestRender()}_initWeather(e){const i=this._context;if(!e||!i)return void(this._clouds.value=Re(this._clouds.value));if(this._clouds.value)return;const r=this.view;this._clouds.value=new xl({context:i,view:r,requestRender:()=>this._requestRender()})}_updateClouds(){const e=this.view.environment.weather;return e==null||this._clouds.value==null||this._clouds.value.applyPreset(eo[e.type],Eut(e)),++this._incarnation}_updatePrecipitation(){const e=this.view.environment.weather;if(e.type===this._precipitation?.type)return this._incarnation;this._fadeOutPrecipitation();const i=e.type==="rainy"||e.type==="snowy",r=this._context;return i&&r&&(this._precipitation=new Qz({view:this.view,type:e.type}),++this._incarnation),this._incarnation}hasHighlight(){return!1}get test(){}};function Eut(t){switch(t.type){case"rainy":case"snowy":case"cloudy":case"sunny":return t.cloudCover;case"foggy":return t.fogStrength}}d([m({constructOnly:!0})],mb.prototype,"view",void 0),d([m({type:Boolean,readOnly:!0})],mb.prototype,"updating",null),d([m()],mb.prototype,"weatherAvailable",null),d([m()],mb.prototype,"_context",void 0),mb=d([k("esri.views.3d.environment.EnvironmentRenderer")],mb);var p8=Math.PI,js=Math.sin,Va=Math.cos,_ie=Math.tan,SOe=Math.asin,vie=Math.atan2,TOe=Math.acos,Zn=p8/180,$Oe=864e5,COe=2440588,MOe=2451545,Aut={dec:0,ra:0};function Out(t){return t.valueOf()/$Oe-.5+COe}function eL(t){return new Date((t+.5-COe)*$Oe)}function Xz(t){return Out(t)-MOe}var R6=23.4397*Zn;function EOe(t,e){return vie(js(t)*Va(R6)-_ie(e)*js(R6),Va(t))}function bie(t,e){return SOe(js(e)*Va(R6)+Va(e)*js(R6)*js(t))}function AOe(t,e,i){return vie(js(t),Va(t)*js(e)-_ie(i)*Va(e))}function OOe(t,e,i){return SOe(js(e)*js(i)+Va(e)*Va(i)*Va(t))}function POe(t,e){return Zn*(280.16+360.9856235*t)-e}function ROe(t){return Zn*(357.5291+.98560028*t)}function DOe(t){return Zn*(1.9148*js(t)+.02*js(2*t)+3e-4*js(3*t))}function IOe(t,e){return t+e+102.9372*Zn+p8}function LOe(t,e){var i=ROe(t),r=IOe(i,DOe(i));return e||(e={dec:0,ra:0}),e.dec=bie(r,0),e.ra=EOe(r,0),e}var zl={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(t,e,i,r){var s=Zn*-i,n=Zn*e,a=Xz(t),o=LOe(a,Aut),l=POe(a,s)-o.ra;return r||(r={azimuth:0,altitude:0}),r.azimuth=AOe(l,n,o.dec),r.altitude=OOe(l,n,o.dec),r}},Jz=[[-.83,"sunrise","sunset"]];zl.addTime=function(t,e,i){Jz.push([t,e,i])};var kOe=9e-4;function Put(t,e){return Math.round(t-kOe-e/(2*p8))}function Mfe(t,e,i){return kOe+(t+e)/(2*p8)+i}function Efe(t,e,i){return MOe+t+.0053*js(e)-.0069*js(2*i)}function Rut(t,e,i){return TOe((js(t)-js(e)*js(i))/(Va(e)*Va(i)))}function Afe(t){var e=Zn*(134.963+13.064993*t),i=Zn*(93.272+13.22935*t),r=Zn*(218.316+13.176396*t)+6.289*Zn*js(e),s=5.128*Zn*js(i),n=385001-20905*Va(e);return{ra:EOe(r,s),dec:bie(r,s),dist:n}}zl.getTimes=function(t,e,i){var r=Zn*-i,s=Zn*e,n=Put(Xz(t),r),a=Mfe(0,r,n),o=ROe(a),l=DOe(o),c=IOe(o,l),h=bie(c,0),f=Efe(a,o,c);function y(P){return Efe(Mfe(Rut(P,s,h),r,n),o,c)}function _(P){var O=(js(P)-js(s)*js(h))/(Va(s)*Va(h));return O<-1?zl.PolarException.MIDNIGHT_SUN:O>1?zl.PolarException.POLAR_NIGHT:zl.PolarException.NORMAL}var w,x,S,$,A,M={solarNoon:eL(f),nadir:eL(f-.5),polarException:zl.PolarException.NORMAL};for(w=0,x=Jz.length;w<x;w+=1)A=f-(($=y((S=Jz[w])[0]*Zn))-f),M[S[1]]=eL(A),M[S[2]]=eL($);return M.polarException=_(Jz[0][0]*Zn),M},zl.getMoonPosition=function(t,e,i){var r=Zn*-i,s=Zn*e,n=Xz(t),a=Afe(n),o=POe(n,r)-a.ra,l=OOe(o,s,a.dec);return l+=.017*Zn/_ie(l+10.26*Zn/(l+5.1*Zn)),{azimuth:AOe(o,s,a.dec),altitude:l,distance:a.dist}},zl.getMoonFraction=function(t){var e=Xz(t),i=LOe(e),r=Afe(e),s=149598e3,n=TOe(js(i.dec)*js(r.dec)+Va(i.dec)*Va(r.dec)*Va(i.ra-r.ra)),a=vie(s*js(n),r.dist-s*Va(n));return(1+Va(a))/2};const el={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};let tL=class{constructor(e,i){this.direct=e,this.ambient=i}};function Dut(t,e,i,r,s,n){ve(n.ambient.color,1,1,1),n.ambient.intensity=el.global.ambient,ve(n.direct.color,1,1,1),n.direct.intensity=el.global.direct;const a=e[2],o=Se((Math.abs(a)-el.local.altitude)/(el.global.altitude-el.local.altitude),0,1);let l;if(n.globalFactor=o,t!=null&&(l=zl.getTimes(t,e[1],e[0])),o<1){let c;if(t!=null)c=Vut(t,l,r);else{const h=FOe(r);c={direct:{intensity:el.local.directAtNoon*h.direct,color:Ge(1,1,1)},ambient:{intensity:el.local.ambientAtNoon*h.ambient,color:Ge(1,1,1)},timeOfDay:"early afternoon"}}Wi(n.ambient.color,c.ambient.color,n.ambient.color,o),n.ambient.intensity=ft(c.ambient.intensity,n.ambient.intensity,o),Wi(n.direct.color,c.direct.color,n.direct.color,o),n.direct.intensity=ft(c.direct.intensity,n.direct.intensity,o),n.specularStrength=r==="rainy"||r==="snowy"||r==="foggy"?0:1,n.environmentStrength=r==="rainy"?.7:r==="snowy"||r==="foggy"?.75:1}n.noonFactor=t!=null?Nut(t,l):1,t!=null?Iut(t,e,i,n.direct.directionToLightSource):zOe(s,i,n.direct.directionToLightSource)}function zOe(t,e,i){e===1?Ee(nq,t.eye):ve(nq,0,0,1),le(aq,t.viewForward,-1);const r=VU(aq,nq),s=Math.max(r-2*oq,0),n=.85*s/(s+1),a=Math.max(oq,r-oq-n);Xh(Ufe,-a,t.viewRight),Mt(i,aq,Ufe),xe(i,i,le(Uut,t.viewRight,But)),Ee(i,i)}function Iut(t,e,i,r){const s=Fut,n=xp(zut);if(i===1)zl.getPosition(t,0,0,s),ve(r,0,0,-1),CC(n,n,-s.azimuth),IU(n,n,-s.altitude),Mt(r,r,n);else{const a=el.planarDirection,o=a.globalAngles,l=e[2];let c=(Math.abs(l)-a.localAltitude)/(a.globalAltitude-a.localAltitude);c=Se(c,0,1),c<1?(zl.getPosition(t,e[1],e[0],s),s.azimuth=(1-c)*s.azimuth+c*o.azimuth,s.altitude=(1-c)*s.altitude+c*o.altitude):(s.azimuth=o.azimuth,s.altitude=o.altitude),ve(r,0,-1,0),MC(n,n,-s.azimuth),CC(n,n,-s.altitude),Mt(r,r,n)}}function Lut(t,e){if(e===1)return!0;const i=el.planarDirection;return Math.abs(t)<i.localAltitude}const kut=Ge(.5773502691896258,-.5773502691896258,.5773502691896258);let Ofe=class{constructor(){this.ambient={color:Ge(1,1,1),intensity:.55},this.direct={color:Ge(1,1,1),intensity:.55,directionToLightSource:cr(kut)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}};const zut=it(),Fut={azimuth:0,altitude:0};function Nut(t,e){const i=t.valueOf();let r,s;e.polarException===zl.PolarException.MIDNIGHT_SUN?(r=i-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,s=r+432e6):e.polarException===zl.PolarException.POLAR_NIGHT?(r=i-2,s=i-1):(r=e.sunrise.valueOf(),s=e.sunset.valueOf());const n=r+(s-r)/2;return 1-Se(Math.abs(i-n)/432e5,0,1)}function FOe(t){switch(t){case"disabled":case"sunny":case"cloudy":return new tL(1,1);case"rainy":return new tL(.4,1.2);case"snowy":return new tL(.5,1.3);case"foggy":return new tL(.2,1.6)}}function Pfe(t,e){const i=(t[0]+t[1]+t[2])/3;t[0]+=(i-t[0])*e,t[1]+=(i-t[1])*e,t[2]+=(i-t[2])*e}const iq=Ge(.01,.01,.01),LQ=Ge(1,.6,.5),kQ=Ge(1,.98,.98),Rfe=Ge(1,1,1),rq=Ge(.8,.8,1),zQ=Ge(.8,.8,1),FQ=Ge(.98,.98,1),Dfe=Ge(1,1,1),sq=vs(.01,el.local.ambientAtNight),NQ=vs(el.local.directAtTwilight,el.local.ambientAtTwilight),VQ=vs(.9*el.local.directAtNoon,el.local.ambientAtNoon),Ife=vs(el.local.directAtNoon,el.local.ambientAtNoon),Lfe=VQ,kfe=kQ,zfe=FQ,Ffe=NQ,Nfe=LQ,Vfe=zQ;function Vut(t,e,i){const r=t.valueOf();let s,n;e.polarException===zl.PolarException.MIDNIGHT_SUN?(s=r-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,n=s+432e6):e.polarException===zl.PolarException.POLAR_NIGHT?(s=r-2,n=r-1):(s=e.sunrise.valueOf(),n=e.sunset.valueOf());const a=n-s,o=s+a/2,l=a/4,c=o-l,h=o+l,f=.06*a,y=s-f/2,_=s+f/2,w=n-f/2,x=n+f/2,S=pt(),$=R(),A=R();let M="";if(r<y||r>x)ko(S,sq),de($,iq),de(A,rq),M="night";else if(r<_){const D=(r-y)/(_-y);Ec(S,sq,NQ,D),Wi($,iq,LQ,D),Wi(A,rq,zQ,D),M="sun rising"}else if(r<c){const D=(r-_)/(c-_);Ec(S,NQ,VQ,D),Wi($,LQ,kQ,D),Wi(A,zQ,FQ,D),M="early morning"}else if(r<o){const D=(r-c)/(o-c);Ec(S,VQ,Ife,D),Wi($,kQ,Rfe,D),Wi(A,FQ,Dfe,D),M="late morning"}else if(r<h){const D=(r-o)/(h-o);Ec(S,Ife,Lfe,D),Wi($,Rfe,kfe,D),Wi(A,Dfe,zfe,D),M="early afternoon"}else if(r<w){const D=(r-h)/(w-h);Ec(S,Lfe,Ffe,D),Wi($,kfe,Nfe,D),Wi(A,zfe,Vfe,D),M="late afternoon"}else if(r<x){const D=(r-w)/(x-w);Ec(S,Ffe,sq,D),Wi($,Nfe,iq,D),Wi(A,Vfe,rq,D),M="sun setting"}let P=0;switch(i){case"rainy":case"foggy":P=.8;break;case"snowy":P=.5}P>0&&(Pfe($,P),Pfe(A,P));const O=FOe(i);return{direct:{intensity:S[0]*O.direct,color:$},ambient:{intensity:S[1]*O.ambient,color:A},timeOfDay:M}}const Ufe=it(),nq=R(),aq=R(),Uut=R(),oq=.25,But=.2;let wie=class{constructor(e=wv()){this.intensity=e}},NOe=class{constructor(e=wv(),i=Ge(.57735,.57735,.57735)){this.intensity=e,this.direction=i}},D6=class{constructor(e=wv(),i=Ge(.57735,.57735,.57735),r=!0,s=1,n=1){this.intensity=e,this.direction=i,this.castShadows=r,this.specularStrength=s,this.environmentStrength=n}},VOe=class{constructor(){this.r=[0],this.g=[0],this.b=[0]}},Dd=class extends Uc{constructor(e){super(e),this._tmpLightParameters=new Ofe,this._defaultLightParameters=new Ofe,this._tmpDate=new Date,this._tmpTz={hours:0,minutes:0,seconds:0},this._viewHandlesKey="viewHandles",this._trackingEnabled=!1,this._mainLight=new D6,this._ambientLight=new wie,this._moonLight=new NOe,this._disableWeather=!1,this._renderer=null,this._resetReferencePosition()}destroy(){this.disconnectView()}get _view(){return this._renderer?.view}get updating(){return!!this._renderer?.updating||!this._canProjectCameraPosition}get weatherEnabled(){return this._view?.environment.atmosphereEnabled&&!this._disableWeather&&this._view?.state?.viewingMode===1&&WD(this._view.spatialReference)}get _weatherAvailable(){return this.weatherEnabled&&this._renderer?.weatherAvailable}get referencePositionGeographic(){return this._referencePositionGeographic}get _canProjectCameraPosition(){const e=this._view?.stateManager?.camera?.position?.spatialReference??Ie.WGS84,i=ofe(e);return Ib(e,i)}connectView(e){if(this._renderer)return;this._renderer=new mb({view:e});const i=()=>this._updateRenderParameters(),r=()=>this._cameraHandler();this.addHandles([K(()=>e.environment.lighting,s=>this._updateLightingHandler(s),Yt),K(()=>e.environment.lighting.type!=="virtual"?e.environment.lighting.date:null,s=>this._lightingDateHandler(s),Yt),K(()=>e.environment.lighting.directShadowsEnabled,i,Yt),K(()=>e.qualitySettings.ambientOcclusion,i,Yt),K(()=>e.qualitySettings.reflections,i,Yt),K(()=>e.spatialReference,()=>this._resetReferencePosition(!0),Yt),K(()=>[e.environment.weather.type,this.weatherEnabled],()=>this._updateLighting(null,1),Yt),K(()=>e.environment.weather.type==="snowy"&&e.environment.weather.snowCover,i,Yt),K(()=>e.environment,s=>s.setComputeWeatherAvailable(()=>this._weatherAvailable),At),K(()=>e.viewingMode,()=>this._resetReferencePosition(!0),At),K(()=>e.environment.lighting.type!=="virtual"&&e.environment.lighting.cameraTrackingEnabled,s=>this._updateCameraTracking(s),At),K(()=>e.state.camera,r,At),Zs(()=>this._canProjectCameraPosition,r,Yt)],this._viewHandlesKey),this._updateRenderParameters(),this._updateLighting(),this._cameraHandler(),this.notifyChange("updating")}disconnectView(){this.removeHandles(this._viewHandlesKey),this._resetReferencePosition(),this._renderer=Re(this._renderer)}_updateLightingHandler(e){this._updateCameraTracking(e.type!=="virtual"&&e.cameraTrackingEnabled),this._lightingDateHandler(e.type!=="virtual"?e.date:null),this._updateRenderParameters()}_updateCameraTracking(e){if(this._trackingEnabled=e,e)this._cameraHandler();else{const i=this._view.environment.lighting;i?.type!=="virtual"&&(i.positionTimezoneInfo.autoUpdated=!1)}}_lightingDateHandler(e){const i=this._view.environment.lighting;if(i?.type!=="virtual"){if(e){if(!i.positionTimezoneInfo.autoUpdated&&(this._preupdateTracking(e),this._referencePositionGeographic!=null)){const r=Jpe(this._referencePositionGeographic,this._tmpTz);r!=null&&(i.autoUpdate(null,r),this._trackingEnabled&&(i.positionTimezoneInfo.autoUpdated=!0))}this._updateLighting(e)}}else this._updateLighting()}_preupdateTracking(e){!this._trackingEnabled&&this._view.environment.lighting.type!=="virtual"&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(e)}_cameraHandler(e=null){const i=this._view;if(!i.ready)return;const r=i.stateManager.camera;if(!r)return;const{position:s}=r,n=s.spatialReference??Ie.WGS84,a=ofe(n);if(!Yl(s,iL,a))return this._referencePositionGeographic==null?void 0:(this._referencePositionGeographic=null,void this._updateLighting());this._referencePositionGeographic?Tv(this._referencePositionGeographic,iL)||(de(this._referencePositionGeographic,iL),this.notifyChange("referencePositionGeographic")):this._referencePositionGeographic=cr(iL),this._autoUpdateTimezone(this._referencePositionGeographic,e)||this._updateLighting(e)}_updateLighting(e,i=0){const r=this._view,{lighting:s}=r.environment,n=s.type==="virtual",a=this._referencePositionGeographic,o=a!=null?this._tmpLightParameters:this._defaultLightParameters;if(a){e??=n?null:s.date;const _=this._weatherAvailable?r.environment.weather.type:"disabled";Dut(e,a,r.state.viewingMode,_,r.state.camera,o)}else n&&zOe(r.state.camera,r.state.viewingMode,o.direct.directionToLightSource);const l=this._mainLight,c=o.direct;le(l.intensity,c.color,c.intensity*Math.PI),de(l.direction,c.directionToLightSource),l.specularStrength=o.specularStrength,l.environmentStrength=o.environmentStrength;const h=this._ambientLight;le(h.intensity,o.ambient.color,o.ambient.intensity);const f=this._moonLight;Wi(f.intensity,jut,qut,o.globalFactor);const y=(1-.5*o.globalFactor)*(1-.4*o.noonFactor*(1-o.globalFactor));le(f.intensity,f.intensity,y),de(f.direction,c.directionToLightSource),this._view.stage?.renderer.updateLighting([l,h,f],o.noonFactor,o.globalFactor,this._weatherAvailable?i:0),this._updateRenderParameters()}_autoUpdateTimezone(e,i=null){if(this._view.environment.lighting.type==="virtual"||!this._view.environment.lighting.cameraTrackingEnabled||e==null)return!1;const r=this._tmpDate;r.setTime((i||this._view.environment.lighting.date).getTime());const s=Jpe(e,this._tmpTz);if(s==null)return!1;let n=this._view.environment.lighting.positionTimezoneInfo;if(n.autoUpdated){if(n.hours===s.hours&&n.minutes===s.minutes&&n.seconds===s.seconds)return!1}else n=s;const a=r.getUTCHours()-(s.hours-n.hours),o=r.getUTCMinutes()-(s.minutes-n.minutes),l=r.getUTCSeconds()-(s.seconds-n.seconds);return r.setUTCHours(a),r.setUTCMinutes(o),r.setUTCSeconds(l),!i&&this._view.environment.lighting.autoUpdate(r,s)}_updateRenderParameters(){const e=this._view.stage;if(!e)return;const i=this._referencePositionGeographic==null||Lut(this._referencePositionGeographic[2],this._view.state.viewingMode);e.renderer.setParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&i,environment:this._view.environment,weatherVisible:this._weatherAvailable,qualitySettings:this._view.qualitySettings})}_resetReferencePosition(e=!1){this._referencePositionGeographic=null,e&&this._cameraHandler()}get test(){}};d([m({type:Boolean,readOnly:!0})],Dd.prototype,"updating",null),d([m()],Dd.prototype,"_disableWeather",void 0),d([m()],Dd.prototype,"weatherEnabled",null),d([m()],Dd.prototype,"_weatherAvailable",null),d([m()],Dd.prototype,"referencePositionGeographic",null),d([m()],Dd.prototype,"_referencePositionGeographic",void 0),d([m()],Dd.prototype,"_renderer",void 0),d([m()],Dd.prototype,"_canProjectCameraPosition",null),Dd=d([k("esri.views.3d.environment.EnvironmentManager")],Dd);const jut=Ge(.22,.22,.33),qut=Ge(.22,.22,.22),iL=R();var UQ,Z$;let gh=(Z$=class extends ke{constructor(e){super(e),this.type="sun",this.date=null,this.directShadowsEnabled=!1,this.displayUTCOffset=null}readDate(e,i){return i.datetime!=null&&new Date(i.datetime)||null}writeDate(e,i,r){i[r]=e.getTime()}readDirectShadowsEnabled(e,i){return!!i.directShadows}writedirectShadowsEnabled(e,i,r){e&&(i[r]=e)}writeDisplayUTCOffset(e,i){e!=null&&(i.displayUTCOffset=e)}clone(){return new UQ(this.cloneConstructProperties())}cloneConstructProperties(){const e={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:this.displayUTCOffset!=null?this.displayUTCOffset:null};return this.date!=null&&(e.date=new Date(this.date)),e}},UQ=Z$,Z$);d([m({readOnly:!0,type:["sun"],json:{write:!0}})],gh.prototype,"type",void 0),d([m({type:Date,json:{type:Number,write:{target:"datetime"}}})],gh.prototype,"date",void 0),d([di("date",["datetime"])],gh.prototype,"readDate",null),d([Ht("date")],gh.prototype,"writeDate",null),d([m({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],gh.prototype,"directShadowsEnabled",void 0),d([di("directShadowsEnabled",["directShadows"])],gh.prototype,"readDirectShadowsEnabled",null),d([Ht("directShadowsEnabled")],gh.prototype,"writedirectShadowsEnabled",null),d([m({type:Number,json:{write:!0}})],gh.prototype,"displayUTCOffset",void 0),d([Ht("displayUTCOffset")],gh.prototype,"writeDisplayUTCOffset",null),gh=UQ=d([k("esri.webscene.SunLighting")],gh);const Qx=gh;var AT;let OT=AT=class extends s2(Qx){static calculateTimezoneOffset({hours:t,minutes:e,seconds:i}){return Math.round(t+e/60+i/3600)}constructor(t){super(t),this.cameraTrackingEnabled=!0,this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};const e=new Date().getFullYear(),i=new Date("March 15, "+e+" 12:00:00 UTC");this._set("defaultDate",i),this._set("date",i)}get defaultDate(){return new Date(this._get("defaultDate"))}static fromWebsceneLighting(t){return new AT(t.cloneConstructProperties())}set defaultDate(t){const e=this._get("date")===this._get("defaultDate");t=new Date(t),this._set("defaultDate",t),e&&this._set("date",t)}set date(t){t!=null&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(t)))}autoUpdate(t,e){const i=AT.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=e.hours,this.positionTimezoneInfo.minutes=e.minutes,this.positionTimezoneInfo.seconds=e.seconds;let r=null;t!=null&&(this.positionTimezoneInfo.autoUpdated=!0,isNaN(t.getTime())?(r=this.defaultDate.getTime(),this._set("date",this.defaultDate)):(r=this.date&&this.date.getTime(),this._set("date",new Date(t))));const s=AT.calculateTimezoneOffset(this.positionTimezoneInfo);if(i!==s&&(rL.target=this,rL.timezoneOffset=s,this.emit("timezone-will-change",rL),rL.target=null),t!=null)return isNaN(t.getTime())||r!==t.getTime()}clone(){const t=this._get("date")===this._get("defaultDate"),e=new AT({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled});return t&&e._set("date",e._get("defaultDate")),e.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated,e.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours,e.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes,e.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds,e}cloneWithWebsceneLighting(t){const e=this.clone();return t.date!=null&&(e.date=t.date),e.directShadowsEnabled=t.directShadowsEnabled,e.displayUTCOffset=t.displayUTCOffset,e}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};d([m({type:Boolean})],OT.prototype,"cameraTrackingEnabled",void 0),d([m({type:Date})],OT.prototype,"defaultDate",null),d([m({type:Date})],OT.prototype,"date",null),OT=AT=d([k("esri.views.3d.environment.SunLighting")],OT);const rL={target:null,timezoneOffset:0},gb=OT;var BQ,Y$;let PO=(Y$=class extends ke{constructor(e){super(e),this.type="virtual",this.directShadowsEnabled=!1}clone(){return new BQ(this.cloneConstructProperties())}cloneConstructProperties(){return{directShadowsEnabled:this.directShadowsEnabled}}},BQ=Y$,Y$);d([m({readOnly:!0,type:["virtual"],json:{write:{isRequired:!0}}})],PO.prototype,"type",void 0),d([m({type:Boolean,json:{default:!1,name:"directShadows",write:!0}})],PO.prototype,"directShadowsEnabled",void 0),PO=BQ=d([k("esri.webscene.VirtualLighting")],PO);const v4=PO;var Kz;let eF=Kz=class extends s2(v4){constructor(t){super(t),this.cameraTrackingEnabled=!0}clone(){return new Kz({...this.cloneConstructProperties(),cameraTrackingEnabled:this.cameraTrackingEnabled})}static fromWebsceneLighting(t){return new Kz(t.cloneConstructProperties())}cloneWithWebsceneLighting(t){const e=this.clone();return e.directShadowsEnabled=t.directShadowsEnabled,e}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};d([m({type:Boolean})],eF.prototype,"cameraTrackingEnabled",void 0),eF=Kz=d([k("esri.views.3d.environment.VirtualLighting")],eF);const RO=eF,Gut={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:gb,virtual:RO}},UOe={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:Qx,virtual:v4}};let tF=class extends ke{constructor(e){super(e)}clone(){throw new Error("Subclasses of Background should implement their own clone method.")}};d([m({readOnly:!0,json:{read:!1}})],tF.prototype,"type",void 0),tF=d([k("esri.webscene.background.Background")],tF);const BOe=tF;var jQ;let DO=jQ=class extends BOe{constructor(t){super(t),this.type="color",this.color=new mt([0,0,0,1])}clone(){return new jQ(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};d([Et({color:"color"},{readOnly:!0}),m({json:{write:{isRequired:!0}}})],DO.prototype,"type",void 0),d([m(Iy({nonNullable:!0,colorRequiredOnWrite:!0}))],DO.prototype,"color",void 0),DO=jQ=d([k("esri.webscene.background.ColorBackground")],DO);const jOe=DO,Bfe={base:BOe,key:"type",typeMap:{color:jOe}};function Hut(t){return(e,i,r)=>{if(!e)return e;for(const s in t.typeMap)if(e.type===s){const n=new t.typeMap[s];return n.read(e,r),n}}}const Wut={types:Bfe,json:{read:Hut(Bfe),write:{overridePolicy:(t,e,i)=>({enabled:!i?.isPresentation})}}};var qQ;const jfe=(t,e,i)=>({enabled:!i?.isPresentation});var Q$;let J0=(Q$=class extends ke{constructor(e){super(e),this.lighting=new Qx,this.background=null,this.atmosphereEnabled=!0,this.starsEnabled=!0}set weather(e){$ut(e?.type,fe.getLogger(this))&&this._set("weather",e)}clone(){return new qQ(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:this.lighting&&this.lighting.type==="virtual"?v4.prototype.clone.call(this.lighting):Qx.prototype.clone.call(this.lighting),background:Te(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}}},qQ=Q$,Q$);d([m({types:UOe,nonNullable:!0,json:{write:!0}})],J0.prototype,"lighting",void 0),d([m(Wut)],J0.prototype,"background",void 0),d([m({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:jfe}}})],J0.prototype,"atmosphereEnabled",void 0),d([m({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:jfe}}})],J0.prototype,"starsEnabled",void 0),d([m({types:yie,nonNullable:!0,json:{write:!0},value:new P6})],J0.prototype,"weather",null),J0=qQ=d([k("esri.webscene.Environment")],J0);const b4=J0;var IO,X$;let yb=(X$=class extends b4{constructor(e){super(e),this.lighting=this.castLighting(),this._computeWeatherAvailable=void 0,this.cachedCameraTrackingEnabled=null}static fromWebsceneEnvironment(e){const i=e.cloneConstructProperties();return new IO({...i,lighting:i.lighting?i.lighting.type==="virtual"?RO.fromWebsceneLighting(i.lighting):gb.fromWebsceneLighting(i.lighting):void 0})}get weatherAvailable(){return this._computeWeatherAvailable?.()??!1}setComputeWeatherAvailable(e){this._computeWeatherAvailable=e}castLighting(e){return this._convertLightingWithDestroy(e)}applyLighting(e){this.lighting=this._convertLightingWithDestroy(e)}_convertLightingWithDestroy(e){const i=this._convertLighting(e);return i!==e&&this.addHandles(JV(i)),i}_convertLighting(e){return e?e instanceof gb||e instanceof RO?e:e instanceof Qx?this.lighting&&this.lighting.type!=="virtual"?this.lighting.cloneWithWebsceneLighting(e):new gb({...e.cloneConstructProperties(),...this.lighting?.cloneNonPersistentConstructProperties()}):e instanceof v4?this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(e):new RO({...e.cloneConstructProperties(),...this.lighting?.cloneNonPersistentConstructProperties()}):ny(Gut,e):new gb}clone(){return new IO({lighting:this.lighting.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:Te(this.background)})}cloneWithWebsceneEnvironment(e){return new IO({weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:Te(this.background),...e.cloneConstructProperties(),lighting:this._getLighting(e)})}_getLighting(e){switch(e.lighting.type){case"sun":return this.lighting&&this.lighting.type==="sun"?this.lighting.cloneWithWebsceneLighting(e.lighting):gb.fromWebsceneLighting(e.lighting);case"virtual":return this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(e.lighting):RO.fromWebsceneLighting(e.lighting);default:return e.lighting,gb.fromWebsceneLighting(e.lighting)}}},IO=X$,X$);d([m({nonNullable:!0})],yb.prototype,"lighting",void 0),d([m()],yb.prototype,"_computeWeatherAvailable",void 0),d([m({readOnly:!0})],yb.prototype,"weatherAvailable",null),d([qr("lighting")],yb.prototype,"castLighting",null),yb=IO=d([k("esri.views.3d.environment.SceneViewEnvironment")],yb);const PT=yb;let Gu=class{constructor(e=15,i=0,r=0,s=null,n=null,a=0){this.selection=e,this.interactionType=i,this.interactionFactor=r,this.interactionStartCamera=s,this.interactionDirection=n,this.tiltMode=a}};function lD(t,e){return(t&e)!==0}function I6(t,e,i,r,s,n){t!==0&&(i?(n.min=Math.min(n.min,e),n.max=Math.max(n.max,e)):r!=null?(n.min-=Math.max(0,(e-n.min)*(1-r)),n.max+=Math.max(0,(e-n.max)*(1-r))):s&&(n.min-=Math.max(0,e-n.min-s),n.max+=Math.max(0,e-n.max-s)))}const y2=new Gu(0);function qOe(t,e,i,r){return e=e||t.viewForward,de(r,e),le(r,r,Math.sign(Oe(e,i))),r}function e7t(t,e,i,r){return Jut(t,e,i,Qut(r,e,i,!0))}function Zut(t,e,i,r){const s=Oe(i,Ce(t,r,e));return xe(t,e,le(t,i,s))}const Yut={dir:R(),len:0,clip:pt()};function Qut(t,e,i,r){const s=Yut;return t?(i&&r&&(s.len=Ri(e,i)),de(s.dir,t)):(s.len=Ri(e,i),Ce(s.dir,i,e),le(s.dir,s.dir,1/s.len)),s}function Xut(t,e,i){const r=Oe(t,i.dir),s=-va(t,e);if(s<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return s>0;if((s<0||r<0)&&!(s<0&&r<0))return!0;const n=s/r;return r>0?n<i.clip[1]&&(i.clip[1]=n):n>i.clip[0]&&(i.clip[0]=n),i.clip[0]<=i.clip[1]}function Jut(t,e,i,r){r.clip[0]=0,r.clip[1]=i?r.len:Number.MAX_VALUE;for(let s=0;s<t.length;s++)if(!Xut(t[s],e,r))return!1;return!0}function Kut(t,e,i=y2){const r=xie(t,e,i);if(r===0)return!1;const s=t.renderCoordsHelper,n=s.getAltitude(e.eye)+r,a=qOe(e,i.interactionDirection,iht(t,e,Math.sign(r),aht),nht),o=de(oht,e.viewForward),l=s.intersectInfiniteManifold(Sp(e.eye,a),n,lq);return e.eye=l??s.setAltitude(lq,n,e.eye),e.center=Zut(lq,e.eye,o,e.center),!0}function xie(t,e,i=y2){if(!eht(t,i)||!t.state.constraints.altitude)return 0;const r=rht(t.state.constraints.altitude,sht);tht(t,i,r);const s=t.renderCoordsHelper.getAltitude(e.eye),n=Se(s,r.min,r.max)-s;return Math.abs(n)<=1e-6?0:n}function eht(t,e){const i=t.state.constraints.altitude;return!(!t.state.isGlobal||!i)&&(e.interactionType!==2||!lD(e.selection,1))}function tht(t,e,i){const r=e.interactionType;if(r===0)return;const{min:s,max:n}=i,{interactionStartCamera:a,interactionFactor:o}=e;if(!a)return;const l=r===2||r===1,c=xie(t,a),h=c===0?0:t.renderCoordsHelper.getAltitude(a.eye);i.min=s,i.max=n,I6(c,h,l,o,.05*h,i)}function iht(t,e,i,r){return t.renderCoordsHelper.worldUpAtPosition(e.eye,r),le(r,r,i),r}function rht(t,e){return e.min=t.min,e.max=t.max,e}const sht={min:0,max:0},nht=R(),aht=R(),oht=R(),lq=R();function Sie(t,e,i=y2){if(!t.state.isLocal)return 0;const r=t.state.constraints.distance;if(!t.pointsOfInterest.surfaceOrigin.renderLocation||r===1/0)return 0;sL.min=0,sL.max=r,cht(t,i,sL);const s=Tie(t,e),n=sL.max-s;return n>=-1e-6?0:n}function lht(t,e,i=y2){const r=Sie(t,e,i);if(r===0)return!1;const s=t.pointsOfInterest.surfaceOrigin;if(!s.renderLocation)return!1;const n=Tie(t,e)+r,a=de(hht,e.eye),o=qOe(e,i.interactionDirection,uht(e,s.renderLocation,fht),pht);if(!Ry(nte(s.renderLocation,n),Sp(e.eye,o),nL))return!1;e.eye=nL;const l=Ce(dht,e.eye,a);e.center=xe(nL,e.center,l);const c=t.renderCoordsHelper.getAltitude(e.center),h=t.renderCoordsHelper.intersectInfiniteManifold(e.ray,c,nL);return h!=null&&(e.center=h),!0}function cht(t,e,i){const r=e.interactionType;if(r===0)return;const{min:s,max:n}=i,{interactionStartCamera:a,interactionFactor:o}=e;if(!a)return;const l=r===1||r===4,c=Sie(t,a),h=c===0?0:Tie(t,a);i.min=s,i.max=n,I6(c,h,l,o,.05*h,i)}function Tie(t,e){const i=t.pointsOfInterest.surfaceOrigin;return i.renderLocation?Ri(e.eye,i.renderLocation):0}function uht(t,e,i){return Hv(i,t.eye,e)}const sL={min:0,max:0},hht=R(),dht=R(),pht=R(),fht=R(),nL=R();function SM(t,e,i=0){const r=t.state.constraints.collision;if(!r.enabled)return!1;const s=a8(t,e.eye),n=t.renderCoordsHelper.getAltitude(e.eye),a=s+r.elevationMargin;if(n>=a)return!1;const o=Le(e.eye);if(Ce(aL,e.center,e.eye),e.eye=t.renderCoordsHelper.setAltitude(mht,a,e.eye),i===1)e.center=xe(aL,e.eye,aL);else if(i===2){const l=(o-n+a)/o;e.center=le(aL,e.center,l)}return!0}const aL=R(),mht=R();function GOe(t,e,i,r=!0){nA.eyeCenterDistance=0,nA.requiresTwoSteps=!1;const s=$ie(t,e,i,y2,nA);if(s===0)return!1;switch(Xh(oL,-s,e.viewRight),i.tiltMode){case 1:Mt(C0,e.viewForward,oL),le(C0,C0,nA.eyeCenterDistance),e.center=xe(x_,e.eye,C0);break;case 0:Ce(C0,e.center,e.eye),Mt(C0,C0,oL),e.eye=Ce(x_,e.center,C0);break;default:i.tiltMode}return e.up=Mt(x_,e.up,oL),!nA.requiresTwoSteps||!r||GOe(t,e,i,!1)}function $ie(t,e,i,r=y2,s){if(!t.state.constraints.tilt)return 0;const n=Math.min(e.relativeElevation*iF,e.distance),a=t.state.constraints.tilt(n,$ht);return Tht(t,i,a),r.interactionType===2&&lD(r.selection,2)&&HOe(t,r.interactionStartCamera,a),i.tiltMode===1||r.tiltMode===1?yht(t,e,a,s):ght(t,e,a)}function ght(t,e,i){const r=vy(t.renderCoordsHelper,e.center,e.eye),s=r-Se(r,i.min,i.max);return cD(s)?s:0}function yht(t,e,i,r){switch(r&&(r.requiresTwoSteps=!1),t.viewingMode){case"global":return vht(t,e,i,r);case"local":return _ht(t,e,i,r)}}function _ht(t,e,i,r){const s=vy(t.renderCoordsHelper,e.center,e.eye),n=Se(s,i.min,i.max),a=s-n;if(!cD(a))return 0;if(r){const o=Math.abs(t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude),l=t.renderCoordsHelper.getAltitude(e.eye)-o,c=Math.max(Math.cos(n),1e-4);Math.abs(c)>1e-4?r.eyeCenterDistance=l/c:r.eyeCenterDistance=e.distance}return a}function vht(t,e,i,r){const s=bht(t,e,Cht),n=Se(s.tiltAtCenter,i.min,i.max);if(!cD(s.tiltAtCenter-n))return 0;let a,o;return s.centerIsOnSurface?(a=wht(s),o=xht(s,a)):(a=s.constraints.clampTilt(s.distance,s.tiltAtCenter),r&&a<Math.PI/2&&(r.requiresTwoSteps=!0,a=Math.PI/2-1e-5),o=Sht(s,a)),r&&(r.eyeCenterDistance=GQ(s,a)),o}function bht(t,e,i){const r=t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,s=r+or(t.spatialReference).radius,n=t.renderCoordsHelper.intersectManifold(e.ray,r,x_);return i.distance=Math.min(e.relativeElevation*iF,e.distance),i.centerIsOnSurface=!1,n!=null?(i.distance=Math.min(e.relativeElevation*iF,Ri(e.eye,n)),i.tiltAtCenter=vy(t.renderCoordsHelper,n,e.eye),i.centerIsOnSurface=!0):t.state.isLocal?i.tiltAtCenter=vy(t.renderCoordsHelper,e.center,e.eye):(vM(l2(GU,s),e.ray,x_),i.distance=Math.min(e.relativeElevation*iF,Ri(e.eye,x_)),i.tiltAtCenter=Ga(-Oe(e.viewForward,Ee(x_,x_)))),i.radius=s,i.eyeRadius=Le(e.eye),i.constraints=t.state.constraints,i}function cD(t){return Math.abs(t)>1e-9}function wht(t){const{constraints:e,distance:i,tiltAtCenter:r}=t;let s=r,n=e.clampTilt(i,r);const a=GQ(t,n);if(e.clampTilt(a,r)===n)return n;let o=0;for(;o<10&&cD(n-s);){const l=(s+n)/2,c=GQ(t,l);cD(e.clampTilt(c,l)-l)?s=l:n=l,o++}return n}function GQ(t,e){if(!t.centerIsOnSurface)return t.distance;const i=Math.PI-Se(e,0,Math.PI),r=zu(t.radius/t.eyeRadius*Math.sin(i)),s=Math.PI-i-r,n=Math.sin(s)/Math.sin(i);if(t.eyeRadius<t.radius&&n>1){const a=Math.PI-r,o=Math.PI-i-a;return Math.sin(o)/Math.sin(i)*t.eyeRadius}return n*t.eyeRadius}function xht(t,e){const i=zu(t.radius/t.eyeRadius*Math.sin(t.tiltAtCenter)),r=zu(t.radius/t.eyeRadius*Math.sin(e));return t.eyeRadius>t.radius?i-r:r-i}function Sht(t,e){return t.tiltAtCenter-Math.PI/2-(e-Math.PI/2)}function Tht(t,e,i){if(e.interactionType===0)return;const{interactionStartCamera:r,interactionFactor:s}=e;if(!r)return;const{min:n,max:a}=i,o=$ie(t,r,y2,e),l=o===0?0:vy(t.renderCoordsHelper,r.center,r.eye);i.min=n,i.max=a,e.interactionType===2?(lD(e.selection,2)&&HOe(t,r,i),I6(o,l,!0,s,qfe,i)):I6(o,l,!1,s,qfe,i)}function HOe(t,e,i){const r=t.state.constraints;if(t.state.isLocal||!r.altitude||!e)return;const s=On(e.center),n=Math.sqrt(s),a=e.distance,o=or(t.spatialReference).radius,l=r.altitude.min+o,c=r.altitude.max+o,h=(l*l-a*a-s)/(-2*n*a),f=(c*c-a*a-s)/(-2*n*a);i.min=Math.max(i.min,Math.min(Math.PI-Ga(f),i.max)),i.max=Math.min(i.max,Math.PI-Ga(h))}const C0=R(),oL=it(),x_=R(),qfe=Lt(5),iF=30,$ht={min:0,max:0},Cht={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,distance:0,tiltAtCenter:0},nA={eyeCenterDistance:0,requiresTwoSteps:!1};function aA(t,e,i,r){const s=3*t,n=3*(i-t)-s,a=1-s-n,o=3*e,l=3*(r-e)-o,c=1-o-l;function h(w){return((a*w+n)*w+s)*w}function f(w){return((c*w+l)*w+o)*w}function y(w){return(3*a*w+2*n)*w+s}function _(w,x){let S,$,A,M,P,O;for(A=w,O=0;O<8;O++){if(M=h(A)-w,Math.abs(M)<x)return A;if(P=y(A),Math.abs(P)<1e-6)break;A-=M/P}if(S=0,$=1,A=w,A<S)return S;if(A>$)return $;for(;S<$;){if(M=h(A),Math.abs(M-w)<x)return A;w>M?S=A:$=A,A=.5*($-S)+S}return A}return function(w,x=1e-6){return f(_(w,x))}}const Eh={};Eh.ease=aA(.25,.1,.25,1),Eh.linear=aA(0,0,1,1),Eh.easeIn=Eh["ease-in"]=aA(.42,0,1,1),Eh.easeOut=Eh["ease-out"]=aA(0,0,.58,1),Eh.easeInOut=Eh["ease-in-out"]=aA(.42,0,.58,1);const Mht=t=>t,uD=t=>t*t,L6=t=>1-uD(1-t),Gfe=t=>t<.5?uD(2*t)/2:(L6(2*(t-.5))+1)/2,k6=t=>t*t*t,HQ=t=>1-k6(1-t),WQ=t=>t<.5?k6(2*t)/2:(HQ(2*(t-.5))+1)/2,z6=t=>t*t*t*t,ZQ=t=>1-z6(1-t),Hfe=t=>t<.5?z6(2*t)/2:(ZQ(2*(t-.5))+1)/2,F6=t=>t*t*t*t*t,YQ=t=>1-F6(1-t),Wfe=t=>t<.5?F6(2*t)/2:(YQ(2*(t-.5))+1)/2,N6=t=>1-Math.cos(t*Math.PI/2),QQ=t=>1-N6(1-t),Zfe=t=>t<.5?N6(2*t)/2:(QQ(2*(t-.5))+1)/2,V6=t=>2**(10*(t-1)),UC=t=>1-V6(1-t),Yfe=t=>t<.5?V6(2*t)/2:(UC(2*(t-.5))+1)/2,U6=t=>-(Math.sqrt(1-t*t)-1),XQ=t=>1-U6(1-t),Qfe=t=>t<.5?U6(2*t)/2:(XQ(2*(t-.5))+1)/2;function td(t){const e=2*(t-Math.sqrt((t-1)*t)),i=e/2/t;return r=>r<i?t*r*r:e*r-e+1}function id(t,e){return(i,r)=>i<e?e*t(i/e,r):1-t((1-i)/(1-e),r)*(1-e)}const Xfe=id(td(1),1),Jfe=id(td(1),0),B6=id(td(1),.5),Kfe=id(td(2),1),eme=id(td(2),0),tme=id(td(2),.5),ime=id(td(3),1),rme=id(td(3),0),sme=id(td(3),.5),nme=id(td(4),1),ame=id(td(4),0),ome=id(td(4),.5),Eht={linear:Mht,"in-quad":uD,"out-quad":L6,"in-out-quad":Gfe,"in-coast-quad":Xfe,"out-coast-quad":Jfe,"in-out-coast-quad":B6,"in-cubic":k6,"out-cubic":HQ,"in-out-cubic":WQ,"in-coast-cubic":Kfe,"out-coast-cubic":eme,"in-out-coast-cubic":tme,"in-quart":z6,"out-quart":ZQ,"in-out-quart":Hfe,"in-coast-quart":ime,"out-coast-quart":rme,"in-out-coast-quart":sme,"in-quint":F6,"out-quint":YQ,"in-out-quint":Wfe,"in-coast-quint":nme,"out-coast-quint":ame,"in-out-coast-quint":ome,"in-sine":N6,"out-sine":QQ,"in-out-sine":Zfe,"in-expo":V6,"out-expo":UC,"in-out-expo":Yfe,"in-circ":U6,"out-circ":XQ,"in-out-circ":Qfe,"quad-in":uD,"quad-out":L6,"quad-in-out":Gfe,"quad-in-coast":Xfe,"quad-out-coast":Jfe,"quad-in-out-coast":B6,"cubic-in":k6,"cubic-out":HQ,"cubic-in-out":WQ,"cubic-in-coast":Kfe,"cubic-out-coast":eme,"cubic-in-out-coast":tme,"quart-in":z6,"quart-out":ZQ,"quart-in-out":Hfe,"quart-in-coast":ime,"quart-out-coast":rme,"quart-in-out-coast":sme,"quint-in":F6,"quint-out":YQ,"quint-in-out":Wfe,"quint-in-coast":nme,"quint-out-coast":ame,"quint-in-out-coast":ome,"sine-in":N6,"sine-out":QQ,"sine-in-out":Zfe,"expo-in":V6,"expo-out":UC,"expo-in-out":Yfe,"circ-in":U6,"circ-out":XQ,"circ-in-out":Qfe,ease:t=>Eh.ease(t),"ease-in":t=>Eh.easeIn(t),"ease-out":t=>Eh.easeOut(t),"ease-in-out":t=>Eh.easeInOut(t)};function us(t,e,i=Rht,r=e){r!==e&&r.copyFrom(e),r.computeUp(t.state.viewingMode);let s=!1;for(let o=0;o<Dht;o++){let l=0;for(const c of Pht)if(lD(i.selection,c.type)){const h=Math.abs(c.error(t,r,i));c.apply(t,r,i)&&(s=!0,l+=h)}if(l===0)break}const n=lD(i.selection,8),a=Aht(i.interactionType,t);return n&&SM(t,r,a)&&(s=!0),s&&r.computeUp(t.state.viewingMode),s}function Aht(t,e){switch(t){case 4:return 1;case 5:return e.state.isGlobal?2:1;default:return 0}}function Nh(t){const e=Math.min(1,t/150);return WQ(e)}function Oht(t,e,i){return $ie(t,e,i)*e.distance}const Pht=[{type:1,error:Oht,apply:GOe},{type:2,error:xie,apply:Kut},{type:4,error:Sie,apply:lht}],Rht=new Gu,Dht=5;let lme=class{get pitch(){return this._pitch}get yaw(){return this._yaw}get distance(){return this._distance}get fov(){return this._fov}get size(){return this._size}constructor(e){this.viewingMode=e,this.center=R(),this._pitch=0,this._yaw=0,this._distance=0,this.direction=cr(cme),this._fov=55,this._size=1}pixelsPerPanAtZoom(e){return this._size/2/(this._zoomToPanScale*e)}zoomAtPixelsPerPan(e){return this._size/2/(this._zoomToPanScale*e)}pixelsPerRotate(){const e=Math.max(Math.cos(Math.abs(this._pitch)),.5);return this._size/2/e}compareTo(e,i){if(this.viewingMode===1){const n=(Le(this.center)+Le(e.center))/2;i.pan=VU(this.center,e.center)*n}else i.pan=Ri(this.center,e.center);let r=Math.abs(e._yaw-this._yaw);r>=Math.PI&&(r=2*Math.PI-r);const s=Math.abs(e._pitch-this._pitch);i.rotate=Math.max(r,s),i.fov=e.fov-this.fov,i.sourceZoom=this._distance,i.targetZoom=e._distance}interpolate(e,i,r){this.viewingMode===1?N3e(e.center,i.center,r.pan,this.center):Wi(this.center,e.center,i.center,r.pan),this._distance=isFinite(i.distance)?ft(e.distance,i.distance+r.zoomOffset,r.zoom):e.distance,this._pitch=ft(e.pitch,i.pitch,r.rotate);let s=e._yaw;const n=i._yaw;Math.abs(n-s)>=Math.PI&&(s+=2*(s<n?1:-1)*Math.PI),this._yaw=ft(s,n,r.rotate),this._fov=ft(e.fov,i.fov,r.fov)}copyFrom(e){de(this.center,e.center),this._pitch=e.pitch,this._yaw=e.yaw,this._distance=e.distance,de(this.direction,e.direction),this._size=e.size,this._fov=e.fov,this._zoomToPanScale=Math.atan(.5*this._fov),this.viewingMode=e.viewingMode}copyFromRenderCamera(e){const i=this._lookAtOrientation(e.center,ume);de(this.center,e.center),Ce(Ya,e.center,e.eye),rl(Ya,Ya,i),rl(E0,e.up,i),this._distance=Le(Ya),this._distance!==0&&(Ya[0]/=this._distance,Ya[1]/=this._distance,Ya[2]/=this._distance),this._pitch=Iht(Ya),this._yaw=Lht(Ya,E0),this._size=Math.sqrt(e.width*e.width+e.height*e.height),this._fov=e.fov,this._zoomToPanScale=Math.atan(.5*this._fov)}copyToRenderCamera(e){const i=this._lookAtOrientation(this.center,ume);qv(i,i),this._axisAngleVec3(rF,this._pitch-Math.PI/2,cme,Ya),this._axisAngleVec3(ow,this._yaw,Ya,Ya),this._axisAngleVec3(rF,this._pitch-Math.PI/2,ow,E0),this._axisAngleVec3(ow,this._yaw,E0,E0),le(Ya,Ya,this._distance),rl(Ya,Ya,i),rl(E0,E0,i),e.center=this.center,e.eye=Ce(Ya,this.center,Ya),e.up=E0,e.fov=this._fov}_axisAngleVec3(e,i,r,s){const n=Math.cos(i),a=Math.sin(i);return le(tu,r,n),bt(_c,e,r),le(_c,_c,a),le(M0,e,(1-n)*Oe(e,r)),xe(s,xe(s,tu,_c),M0)}_lookAtOrientation(e,i=Ir()){return this._upAtLookAt(e,M0),bt(tu,this.direction,M0),Ee(tu,tu),tu[0]===0&&tu[1]===0&&tu[2]===0&&de(tu,rF),bt(_c,M0,tu),Ee(_c,_c),i[0]=tu[0],i[1]=_c[0],i[2]=M0[0],i[3]=tu[1],i[4]=_c[1],i[5]=M0[1],i[6]=tu[2],i[7]=_c[2],i[8]=M0[2],i}_upAtLookAt(e,i){return this.viewingMode===2?de(i,ow):Ee(i,e)}};function Iht(t){return Math.PI-VU(ow,t)}function Lht(t,e){const i=kht;return Math.abs(e[2])<.5?(de(i,e),t[2]>0&&le(i,i,-1)):de(i,t),bt(_c,i,ow),Ee(_c,_c),VU(rF,_c,ow)}const tu=R(),_c=R(),M0=R(),Ya=R(),E0=R(),kht=R(),ow=py,cme=Mee,rF=Cee,ume=Ir();let zht=class{constructor(){this.pan=0,this.rotate=0,this.fov=0,this.sourceZoom=0,this.targetZoom=0}};const j6={desiredScreenFlow:2,minDuration:500,maxDuration:8e3};let Fht=class WOe{constructor(e){this._createCamera=e,this.compared=new zht,this.segmentStart=0,this.segmentEnd=1,this.settings={desiredScreenFlow:j6.desiredScreenFlow},this.source=e(),this.target=e()}clone(){const e=new WOe(this._createCamera);return e.copyFrom(this),e}copyFrom(e){this.update(e.source,e.target,e.settings)}update(e,i,r){this.source!==e&&this.source.copyFrom(e),this.target!==i&&this.target.copyFrom(i),this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=r.desiredScreenFlow??j6.desiredScreenFlow,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(e){const i=this.target.pixelsPerPanAtZoom(e);return this.halfWindowSize/i}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>nn()}get hasFov(){return Math.abs(this.compared.fov)>nn()}get hasRotate(){return this.compared.rotate>nn()}},Nht=class{constructor(){this.pan=0,this.rotate=0,this.zoom=0,this.fov=0,this.zoomOffset=0}},Vht=class{constructor(){this.segments=new Array}get time(){return this.segments.reduce((e,i)=>e+i.time,0)}interpolateComponentsAt(e,i){e=Math.min(Math.max(e,0),1),e*=this.time;let r=0,s=0;const n=this.definition,a=this.segments.reduce((o,l)=>o||l.definition.hasZoom,!1);for(let o=0;o<this.segments.length;o++){const l=this.segments[o],c=l.definition;if(e<=l.time||o===this.segments.length-1){if(this.segmentInterpolateComponentsAt(l,l.time===0?0:e/l.time,i),n.hasPan&&!isNaN(i.pan)&&isFinite(n.compared.pan)?i.pan=(r+c.compared.pan*i.pan)/n.compared.pan:i.pan=1,n.hasRotate&&!isNaN(i.rotate)&&isFinite(n.compared.rotate)?i.rotate=(s+c.compared.rotate*i.rotate)/n.compared.rotate:i.rotate=1,a&&!isNaN(i.zoom)&&isFinite(c.compared.targetZoom)){const{sourceZoom:h,targetZoom:f}=c.compared,y=i.zoom*(f-h)+h,_=this.segments[0].definition.compared.sourceZoom,w=this.segments[this.segments.length-1].definition.compared.targetZoom,x=Math.abs(f-_)>Math.abs(h-_)?f:h;i.zoomOffset=x-w,i.zoom=(y-_)/(x-_)}else i.zoom=1;return i}e-=l.time,r+=c.compared.pan,s+=c.compared.rotate}}segmentInterpolateComponentsAt(e,i,r){e.interpolateComponentsAt(i,r)}},cq=class{get time(){return this._time}constructor(e){e&&this.update(e)}update(e){e&&(this.definition?this.definition.copyFrom(e):this.definition=e.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){const e=this.definition,i=e.compared,r=i.sourceZoom,s=i.targetZoom;this._zoomSign=r>s?1:-1,this._panPixelsAtSource=i.pan*e.source.pixelsPerPanAtZoom(r);const n=(e.source.pixelsPerRotate()+e.target.pixelsPerRotate())/2;this._rotatePixels=i.rotate*n}_updatePixelFlow(){const e=this.definition.compared.sourceZoom,i=this.definition.compared.targetZoom,{hasZoom:r,hasPan:s,hasRotate:n}=this.definition;let a=0,o=0;r&&(s&&(a=(i/e-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),n&&(o=this._zoomSign*(Math.log(e/i)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;const l=this.definition.desiredPixelFlow;if(r&&s&&n){const c=a+o+a*o;this._zoomPixelFlow=a*o/c*l,this._panPixelFlow=o/c*l,this._rotatePixelFlow=a/c*l}else if(r&&s){const c=1+a;this._zoomPixelFlow=a/c*l,this._panPixelFlow=1/c*l}else if(r&&n){const c=1+o;this._zoomPixelFlow=o/c*l,this._rotatePixelFlow=1/c*l}else if(s&&n){const c=this._panPixelsAtSource/this._rotatePixels,h=1+c;this._panPixelFlow=c/h*l,this._rotatePixelFlow=1/h*l}else s?this._panPixelFlow=l:r?this._zoomPixelFlow=l:n&&(this._rotatePixelFlow=l);if(this._time=Math.max(this.rotateTime,this.zoomTime,this.panTime),this.fovTime>this._time){const c=this.fovTime/this._time;this._time=this.fovTime,this._zoomPixelFlow/=c,this._panPixelFlow/=c,this._rotatePixelFlow/=c}}get rotateTime(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:0}get zoomTime(){return this.definition.hasZoom?this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow:0}get fovTime(){return this.definition.hasFov?Math.abs(this.definition.compared.fov)/Uht:0}get panTime(){if(!this.definition.hasPan)return 0;if(this.definition.hasZoom){const e=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,i=e*this._panPixelsAtSource;return Math.log(i*(this._zoomPixelFlow/this._panPixelFlow)+1)/(e*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}_interpolateComponentsZoom(e){if(e===0||e===1)return e;if(this.definition.hasZoom){const i=this.definition.compared.sourceZoom,r=this.definition.compared.targetZoom;return(i*(i/r)**-e-i)/(r-i)}return e}_interpolateComponentsFov(e){if(e===0)return this.definition.segmentStart;if(e===1)return this.definition.segmentEnd;if(this.definition.hasFov){const{segmentStart:i,segmentEnd:r}=this.definition;return i+e*(r-i)}return this.definition.segmentStart}_interpolateComponentsPan(e){if(e===0||e===1)return e;if(this.definition.hasPan&&this.definition.hasZoom){const i=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(i*e*this._time)-1))/(i*Math.LN2)}return e}_interpolateComponentsRotate(e){return e}interpolateComponentsAt(e,i){e=Math.min(Math.max(e,0),1),i.zoom=this._interpolateComponentsZoom(e),i.pan=this._interpolateComponentsPan(e),i.rotate=this._interpolateComponentsRotate(e),i.zoomOffset=0,i.fov=this._interpolateComponentsFov(e)}};const Uht=Lt(45);function Bht(t,e,i){const r=e-t.compared.sourceZoom,s=t.halfWindowPanAtZoom(r);return-t.halfWindowSize*(i.ascensionFactor*Math.LN2*t.compared.pan+s)*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2*s)}function jht(t,e,i){const r=1/e,s=Math.log(t.compared.sourceZoom*r),n=1/t.desiredPixelFlow,a=1/Math.LN2,o=e-t.compared.sourceZoom,l=1/o,c=(i.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(o))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*r*n*a*l*c-t.halfWindowSize*s*n*a*l+t.halfWindowSize*s*n*a*c/(o*o)}function qht(t,e,i){const r=e-t.compared.sourceZoom,s=1/r,n=1/e,a=Math.log(t.compared.sourceZoom*n),o=(i.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(r))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*s*(-2*s*n*o+2*s*a+2*n-2*a*o/(r*r)-o/(e*e))/(t.desiredPixelFlow*Math.LN2)}function Ght(t,e){return-t.halfWindowSize*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2)}function Hht(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function Wht(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function Zht(t,e,i){return-t.compared.pan*t.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e))}function Yht(t,e,i){return t.compared.pan*t.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e))}function Qht(t,e,i){return-2*t.compared.pan*t.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e*e))}function Xht(t,e,i){return t.halfWindowSize*(-t.halfWindowPanAtZoom(e)-i.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*t.halfWindowPanAtZoom(-e+t.compared.targetZoom))}function Jht(t,e,i){const r=Math.log(e/t.compared.targetZoom),s=1/t.desiredPixelFlow,n=1/Math.LN2,a=-e+t.compared.targetZoom,o=1/a,l=(-t.halfWindowPanAtZoom(e)-i.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return-t.halfWindowSize*r*s*n*o+t.halfWindowSize*r*s*n*l/(a*a)+t.halfWindowSize*s*n*o*l/e}function Kht(t,e,i){const r=e-t.compared.targetZoom,s=1/r,n=1/e,a=Math.log(e/t.compared.targetZoom),o=(t.halfWindowPanAtZoom(e)+i.descensionFactor*Math.LN2*t.compared.pan-t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*s*(-2*s*n*o-2*s*a+2*n+2*a*o/(r*r)-o/(e*e))/(t.desiredPixelFlow*Math.LN2)}function edt(t,e){return t.halfWindowSize*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2)}function tdt(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function idt(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function rdt(t){const e=t.compared.sourceZoom-t.compared.targetZoom;if(e===0)return t.compared.pan*t.halfWindowSize/(t.desiredPixelFlow*t.halfWindowPanAtZoom(t.compared.sourceZoom));const i=Math.LN2*t.compared.pan,r=e,s=t.halfWindowPanAtZoom(r),n=t.halfWindowSize*Math.log(t.compared.sourceZoom/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*s);return t.compared.sourceZoom<=t.compared.targetZoom?n*(i-s):n*(i+s)}function sdt(t,e){let i=ndt(t,e);const r={ascensionFactor:e.ascensionFactor!=null?e.ascensionFactor:.5,descensionFactor:e.descensionFactor!=null?e.descensionFactor:.5},s=r.ascensionFactor===0,n=r.descensionFactor===0,a=s?Ght:Bht,o=s?Hht:jht,l=s?Wht:qht,c=n?edt:Xht,h=n?tdt:Jht,f=n?idt:Kht,y=O=>a(t,O,r)+Zht(t,O,r)+c(t,O,r),_=O=>o(t,O,r)+Yht(t,O,r)+h(t,O,r),w=O=>l(t,O,r)+Qht(t,O,r)+f(t,O,r);let x=y(i);const S=rdt(t);let $;const A=e.maximumIterations||20,M=e.maximumDistance!=null?e.maximumDistance:1/0;for($=0;$<A;$++){const O=e.desiredSlope??1e-6;let D=_(i);Math.abs(D)>O&&(D+=O);const L=D/w(i);if(isNaN(L)||i>=M&&L<0){if(!isFinite(M))return null;i=M,x=y(i);break}if(i-=L,i<=t.compared.sourceZoom||i<=t.compared.targetZoom)return null;const F=y(i);if(Math.abs(F-x)/x<=.005)break;x=F}return isNaN(x)||x>S*(1-.3)||i<=t.compared.sourceZoom||i<=t.compared.targetZoom?null:i}function ndt(t,e){const i=Math.max(t.compared.sourceZoom,t.compared.targetZoom),r=t.source.zoomAtPixelsPerPan(t.desiredPixelFlow/t.compared.pan)/2;return r<i?e.maximumDistance!=null?i+(e.maximumDistance-i)/2:1.5*i:e.maximumDistance?Math.min(e.maximumDistance,r):r}let adt=class extends Vht{constructor(e,i){super(),this._preallocSegments=[new cq,new cq,new cq],this._ascensionSegment=null,this._descensionSegment=null,this.update(e,i)}update(e,i){if(!e)return;this.definition?this.definition.copyFrom(e):this.definition=e.clone();const r=i?.apex?sdt(e,i.apex):null;this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,r?this._updateWithApex(r,i?.apex):this._updateWithoutApex()}segmentInterpolateComponentsAt(e,i,r){e.interpolateComponentsAt(i,r),e===this._ascensionSegment?r.zoom=L6(r.zoom):e===this._descensionSegment&&(r.zoom=uD(r.zoom))}_updateWithApex(e,i){const[r,s,n]=this._preallocSegments,a=i?.ascensionFactor??.5,o=Math.min(1-a,i?.ascensionFactor!=null&&i.descensionFactor!=null?i.descensionFactor:.5),l=1-a-o;r.definition?r.definition.copyFrom(this.definition):r.definition=this.definition.clone(),r.definition.compared.targetZoom=e,r.definition.compared.pan=this.definition.compared.pan*a,r.definition.compared.rotate=this.definition.compared.rotate*a,r.definition.segmentEnd=a,r.update(),this._ascensionSegment=r,this.segments.push(r),l>0&&(s.definition?s.definition.copyFrom(this.definition):s.definition=this.definition.clone(),s.definition.copyFrom(this.definition),s.definition.compared.sourceZoom=e,s.definition.compared.targetZoom=e,s.definition.compared.pan=this.definition.compared.pan*l,s.definition.compared.rotate=this.definition.compared.rotate*l,s.definition.segmentStart=r.definition.segmentEnd,s.definition.segmentEnd=r.definition.segmentEnd+l,s.update(),this.segments.push(s)),n.definition?n.definition.copyFrom(this.definition):n.definition=this.definition.clone(),n.definition.compared.sourceZoom=e,n.definition.compared.pan=this.definition.compared.pan*o,n.definition.compared.rotate=this.definition.compared.rotate*o,n.definition.segmentStart=a+l,n.update(),this._descensionSegment=n,this.segments.push(n)}_updateWithoutApex(){const[e]=this._preallocSegments;e.update(this.definition),this.segments.push(e)}};const odt=new Nht;let ldt=class{get time(){return this._time}get isLinear(){return this.path.segments.length===1}constructor(e){this._time=0,this._easing=B6,this.definition=new Fht(e),this.path=new adt}update(e,i,r){this.definition.update(e,i,r),this.path.update(this.definition,r),this._time=this._applyTimeSettings(xwe(isFinite(this.path.time)?this.path.time:0),r),this._easing=r.easing??(this._time>=1e3?B6:UC)}cameraAt(e,i){e=Math.min(Math.max(0,e),1),e=this._normalizedEasing(e);const r=this.path.interpolateComponentsAt(e,odt);i.interpolate(this.definition.source,this.definition.target,r)}_normalizedEasing(e){const i=this._easing(0,this._time),r=this._easing(1,this._time);return(this._easing(e,this._time)-i)/(r-i)}_applyTimeSettings(e,i){const r=i.speedFactor!=null?i.speedFactor:1,s=i.minDuration??j6.minDuration/r,n=i.maxDuration??j6.maxDuration/r;return e=i.duration!=null?i.duration:Math.min(Math.max(e/r,s),n)}},cdt=class{get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}constructor(e){this.currentTime=0,this._animation=new ldt(()=>new lme(e)),this._current=new lme(e)}update(e,i,r){const{source:s,target:n}=this._animation.definition,a=Ce(udt,i.center,e.center),o=Le(a);o>=1e-5?(a[0]/=o,a[1]/=o,a[2]/=o):(a[0]=0,a[1]=1,a[0]=0),de(s.direction,a),de(n.direction,a),s.copyFromRenderCamera(e),n.copyFromRenderCamera(i),this._current.copyFrom(s),this._animation.update(s,n,r),this.currentTime=0,e.almostEquals(i)&&(this.currentTime=this._animation.time)}cameraAt(e,i){this._animation.cameraAt(e,this._current),this._current.copyToRenderCamera(i)}step(e,i){this.finished||(this.currentTime=this.currentTime+xwe(e),this.currentTime>=this.time&&(this.currentTime=this.time)),this.cameraAt(this.currentTime/this.time,i)}};const udt=R();let Ig=class extends Me{constructor(e){super(e),this.state=0}get running(){return this.state===2}get isInteractive(){return!1}get canStop(){return!1}stopController(){return!!this.destroyed||!!this.canStop&&(this.state=3,!0)}finishController(){this.state=4}};d([m({constructOnly:!0})],Ig.prototype,"view",void 0),d([m({readOnly:!0})],Ig.prototype,"running",null),d([m()],Ig.prototype,"state",void 0),d([m({readOnly:!0})],Ig.prototype,"isInteractive",null),Ig=d([k("esri.views.3d.state.controllers.CameraController")],Ig);let hD=class extends Ig{constructor(){super(...arguments),this._asyncResult=null}get canStop(){return!0}set asyncResult(e){this._asyncResult&&(this._asyncResult.reject(Xt()),this._asyncResult=null),this.state===4||this.state===3?(rM(e),this.state===4?e.resolve():e.reject(Xt())):this._asyncResult=e}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=2,this.viewAnimation!=null&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())}updateStateFromViewAnimation(){!this.viewAnimation||this.state!==0&&this.state!==2||(this.viewAnimation.state===kC.state.FINISHED?this.finish():this.viewAnimation.state===kC.state.STOPPED&&(this.state=3))}onControllerEnd(e){this.viewAnimation==null||this.viewAnimation.done||(this.state===4?this.viewAnimation.finish():this.state===3&&this.viewAnimation.stop()),this._asyncResult&&(this.state===4?this._asyncResult.resolve():this._asyncResult.reject(Xt()))}finish(){this.finishController()}};hD=d([k("esri.views.3d.state.controllers.AnimationController")],hD);let lw=class extends hD{get _intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.type="point-to-point",this.mode="interaction"}initialize(){this.animation=new cdt(this.view.state.viewingMode),this.viewAnimation=this.mode==="interaction"?null:new kC}get isInteractive(){return this.mode==="interaction"}begin(e,i){this.stepController=(n,a)=>{this.animation.step(n,a),this.animation.finished&&this.finishController()};const r=this.animationSettings(i);LO.copyFrom(this.view.state.camera);const s=new Vc(this.view.state.viewingMode);this._intersectionHelper.intersectRay(LO.ray,s,hme)&&(LO.center=hme),this.animation.update(LO,e,r),this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time,super.finish()}onControllerEnd(e){this.stepController&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,e),this.animation.currentTime=this.animation.time),super.onControllerEnd(e),this.stepController=void 0}animationSettings(e={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(1/0)/6,ascensionFactor:void 0,descensionFactor:void 0},...e,easing:typeof e.easing=="string"?Eht[e.easing]:e.easing}}};d([m({constructOnly:!0})],lw.prototype,"mode",void 0),d([m({readOnly:!0})],lw.prototype,"isInteractive",null),lw=d([k("esri.views.3d.state.controllers.PointToPointAnimationController")],lw);let LO=new nr;const hme=R();function hdt(){LO=new nr}function dme(t){return t!=null&&"type"in t&&t.type==="point-to-point"}function f8(t=pdt){return[t[0],t[1],t[2],t[3]]}function dD(t,e){return ddt(t[0],t[1],t[2],e,Nee.get())}function ddt(t,e,i,r,s=f8()){return s[0]=t,s[1]=e,s[2]=i,s[3]=r,s}function Cie(t,e,i){return bt(i,t,e),Ee(i,i),i[3]=Gee(t,e),i}const pdt=[0,0,1,0];function d7t(t,e,i=rn()){return Mie(t,Xd(e),i),Ee(i.direction,i.direction),i}function Mie(t,e,i){return fdt(t,t.screenToRender(e,Ze.get()),i)}function fdt(t,e,i){if(e==null)return null;const r=ko(Ze.get(),e);if(r[2]=0,!t.unprojectFromRenderScreen(r,i.origin))return null;const s=ko(Ze.get(),e);s[2]=1;const n=t.unprojectFromRenderScreen(s,Ze.get());return n==null?null:(Ce(i.direction,n,i.origin),i)}function TM(t,e,i){return Eie(t,t.screenToRender(e,Ze.get()),i)}function Eie(t,e,i){de(i.origin,t.eye);const r=ve(Ze.get(),e[0],e[1],1),s=t.unprojectFromRenderScreen(r,Ze.get());return s==null?null:(Ce(i.direction,s,i.origin),i)}function Aie(t,e,i,r){const s=TM(e,i,mdt);return Ry(t,s,r)}const mdt=rn(),ZOe=30,q6=[1,3e8],YOe=8,G6=[200,1508e5],QOe=5,XOe=50,gdt=5,ydt=10,w4=80,uq=90,Pv=1e-6,_2={exclude:new Set([Av])};function Pw(t,e,i){return i[0]=e[0]/(t.fullWidth/t.pixelRatio),i[1]=e[1]/(t.fullHeight/t.pixelRatio),i}function JQ(t){for(;t>Math.PI;)t-=2*Math.PI;for(;t<-Math.PI;)t+=2*Math.PI;return t}function Rv(t,e,i){const r=Xh(Vee.get(),i[3],i);r==null||d3e(r,Ro)||(Ce(sr,t.eye,e),Mt(sr,sr,r),t.eye=xe(sr,sr,e),Ce(sr,t.center,e),Mt(sr,sr,r),t.center=xe(sr,sr,e),t.up=Mt(sr,t.up,r))}function _dt(t,e,i,r){return mM(t,Mie(e,i,Rie),r)}function KQ(t,e,i,r){return mM(t,TM(e,i,Rie),r)}function Oie(t,e,i,r){const s=Ze.get();let n=1-i;Ce(s,e,t.eye);const a=Le(s);let o=a*(1-n);n>=0&&o<r&&(o=r,n=-(o-a)/a),Math.abs(a-o)<Pv||(le(s,s,n),t.eye=xe(sr,t.eye,s),t.center=Wi(sr,t.center,e,n))}function JOe(t,e,i){e.getScreenCenter(pme),Aie(t,e,pme,sr)&&(e.center=sr);const r=e.distance,s=r*i;if(Math.abs(r-s)<Pv)return;const n=le(Ze.get(),e.viewForward,s);e.eye=Ce(sr,e.center,n)}const pme=Gs();function hq(t,e){ve(e,0,0,0);for(const i of t)xe(e,e,i);le(e,e,1/t.length)}function sF(t,e,i,r){return Math.sin(t/Le(e))*(i+r.radius)}function fme(t,e,i,r){return sF(Math.PI/2,e,i,r)+(t-Math.PI/2)}const mme={Elevation:3e4,Angle:Lt(16)},KOe=Lt(80);function ePe(t,e,i,r,s,n){const a=R(),o=ms();let l=!0,c=!0;return t.intersectScreen(i,a,n)?o[3]=Le(a):(c=!1,e.aboveGround&&s!==0?o[3]=Math.max(Le(e.center),.9*r):o[3]=Le(e.eye)-e.relativeElevation,s===1?pD(o,e,i,a):l=Aie(o,e,i,a)),{sphere:o,scenePickPoint:l?a:null,hasGeometryIntersection:c}}function x4(t,e,i,r){const s=t.relativeElevation;if(s>mme.Elevation&&r==="global")return 1;TM(t,e,pq);const n=Math.sign(s),a=i.worldUpAtPosition(t.eye,sr);return-n*Oe(a,pq.direction)<Math.sin(mme.Angle)*Le(pq.direction)?0:1}function tPe(t,e,i){Ce(dq,i,e),t.eye=Ce(sr,t.eye,dq),t.center=Ce(sr,t.center,dq)}const dq=R();function pD(t,e,i,r){const s=TM(e,i,Rie);return s!=null&&(vM(t,s,lL),Ry(t,s,r)?!(on(lL,s.origin)<on(r,s.origin))||(de(r,lL),!1):(Ce(SS,e.eye,e.center),Ee(SS,SS),U3e(SS,-Oe(Ee(SS,SS),lL),gme),mM(gme,s,r),!1))}const lL=R(),SS=R(),gme=Oi();function iPe(t,e,i,r,s,n){let a=0;if(bt(Z6,t,e),Ce(dL,t,e),Le(t)<=s||!r.aboveGround){bt(i,dL,r.eye);const o=Oe(t,e)/(Le(t)*Le(e));if(o<.9999)a=Ga(o);else{const c=Le(bt(R(),t,e))/(Le(t)*Le(e));a=zu(c)}const l=Math.cos(Se(hv.normalize(Lt(n)),0,KOe));a=-a-Math.max(0,Le(e)-s)/(l*s)}else Ce(yme,r.eye,r.center),bt(i,dL,yme),a=-Le(dL)/s;return Ee(i,i),le(i,i,Le(Z6)),a}const yme=R();function _me(t,e,i,r){let s,n;const a=Math.cos(Se(hv.normalize(Lt(r)),0,KOe));return s=e>i?-(e-i)/(a*i):e<-i?Math.PI-(e+i)/(a*i):Ga(e/i),n=t>i?-(t-i)/(a*i):t<-i?Math.PI-(t+i)/(a*i):Ga(t/i),(n-s)*i}function vdt(t,e,i,r,s,n,a,o,l,c){const h=_me(t[2],e[2],n[3],o),f=l?_me(t[0],e[0],n[3],180):e[0]-t[0],y=Math.sin(a)*f-Math.cos(a)*h,_=Math.cos(a)*f+Math.sin(a)*h;Ee(sr,s);const w=l?y/Math.sqrt(Math.abs(n[3]**2-Oe(i,sr)**2)):y/n[3],x=_/Math.sqrt(Math.abs(n[3]**2-Oe(i,r)**2));Cr(c,w,x)}function rPe(t,e,i,r,s,n,a,o,l,c){bt(Z6,t,e),gZ(n.up,n.eye,cL,uL,hL),gZ([0,0,1],n.eye,iy,Y_,oPe),de(i,Y_),de(r,iy),Ee(i,i),le(i,i,Le(Z6)),yde(t,Ee(uL,uL),Ee(hL,hL),Ee(cL,cL),vme),yde(e,uL,hL,cL,bme),vdt(vme,bme,t,iy,Y_,a,o,l,c,s)}function bdt(t,e,i,r,s,n,a){Xh(H6,s,r),Xh(W6,a,n),an(x3,H6,W6),Ce(e,t,i),Mt(e,e,x3),xe(e,e,i)}function sPe(t,e,i,r,s,n){Xh(H6,r,i),Xh(W6,n,s),an(x3,H6,W6),Ce(sr,t.eye,e),Mt(sr,sr,x3),t.eye=xe(sr,sr,e),Ce(sr,t.center,e),Mt(sr,sr,x3),t.center=xe(sr,sr,e),Ce(sr,t.up,e),Mt(sr,sr,x3),t.up=xe(sr,sr,e)}const $1={Pole:.95,Angle:Lt(18),Tilt:45,TiltHysteresisMargin:1e-7};let TS=!1;function Pie(t,e,i,r,s,n){const a=Math.abs(r)>Math.PI-$1.Angle||Math.abs(r)<$1.Angle,o=(Math.abs(t[2])<i*$1.Pole||Math.abs(e)>i)&&n;return a&&o?!TS&&s<$1.Tilt-$1.TiltHysteresisMargin?TS=!0:TS&&s>$1.Tilt+$1.TiltHysteresisMargin&&(TS=!1):TS=!1,TS}function nPe(t,e,i,r,s,n){if(n)Cie(i,r,wme),Rv(e,Ti(t),wme);else{const a=iPe(i,r,xme,e,t[3],s);Rv(e,Ti(t),dD(xme,a))}}function aPe(t,e,i,r,s,n,a){const o=a?20:1,l=1e-12;let c,h;de(C1,r),kO.copyFrom(e);for(let f=0;f<o&&on(i,C1)>l&&(c=on(i,C1),rPe(i,C1,Y_,iy,oA,kO,t,s,n,a),sPe(kO,Ti(t),iy,oA[1],Y_,oA[0]),bdt(C1,C1,Ti(t),iy,oA[1],Y_,oA[0]),h=on(i,C1),h<c||f===0);f++)e.copyFrom(kO)}function wdt(t,e,i,r,s,n,a){Pie(i,Oe(e.up,i),t[3],-hv.normalize(Lt(s)),n,e.aboveGround)?aPe(t,e,i,r,-hv.normalize(Lt(s)),n,a):nPe(t,e,i,r,n,a)}function xdt(t,e,i,r,s,n){const{eye:a}=t;gZ([0,0,1],a,iy,Y_,oPe);const o=e.translation[0]*i.pan,l=s.mode==="zoom"?0:e.translation[1]*i.pan,c=Math.max(Math.sqrt(Math.abs(1-Oe(t.center,iy)**2/Le(t.center)**2)),.5),h=(Math.sin(n)*l+Math.cos(n)*o)/c,f=-Math.cos(n)*l+Math.sin(n)*o;switch(Eu(r.pan.matrix,r.pan.matrix,h,iy),r.pan.enabled=!0,s.mode){case"pan":Eu(r.pan.matrix,r.pan.matrix,f,Y_),r.pan.enabled=!0;break;case"zoom":r.zoom=-e.translation[1]*i.zoom}}function Sdt(t,e,i,r,s){const{eye:n,viewRight:a}=t,o=bt(Ze.get(),a,n),l=e.translation[0]*i.pan;switch(l!==0&&(Eu(r.pan.matrix,r.pan.matrix,-l,o),r.pan.enabled=!0),s.mode){case"pan":{const c=e.translation[1]*i.pan;c!==0&&(Eu(r.pan.matrix,r.pan.matrix,c,a),r.pan.enabled=!0);break}case"zoom":r.zoom=-e.translation[1]*i.zoom}}function Tdt(t,e,i,r,s,n,a,o,l){Pie(t.center,Oe(t.up,t.center),Le(t.center),-hv.normalize(Lt(n)),a,e.aboveGround)?xdt(e,i,r,o,l,-hv.normalize(Lt(s))):Sdt(e,i,r,o,l)}function $M(t,e,i=1/0){const r=Math.abs(Oe(t,e));return Math.min(i,1/r)}const iy=R(),Y_=R(),oPe=R(),cL=R(),uL=R(),hL=R(),vme=R(),bme=R(),oA=pt(),wme=f8(),H6=it(),W6=it(),x3=it(),C1=R(),sr=R(),dL=R();let kO=new nr;const Z6=R(),xme=R();function $dt(){kO=new nr}const Rie={origin:R(),direction:R()},pq={origin:R(),direction:R()},Sme=.6,fq=4,Cdt=60;let Y6=class extends lw{constructor(){super(...arguments),this._zoomLocation=R(),this._tmpCamera=new nr,this._tmpViewDir=R(),this._tmpRayDir=rn(),this._targetOnSphere=R(),this._tmpCenter=R(),this._beginCamera=new nr,this._constraintOptions=new Gu(7,1,null,this._beginCamera),this._sphere=ms()}initialize(){this._intersector=new Vc(this.view.state.viewingMode)}step(e,i){if(!this.running)return;const r=this.view.state;this.animation.finished?this._beginCamera.copyFrom(r.camera):this.animation.cameraAt(1,this._beginCamera);let s=!1,n=!1;this._intersectionHelper.intersectScreen(i,this._zoomLocation,this.view.map.ground.opacity===0?_2:{})&&(s=e>0,n=!0),this._tmpCamera.copyFrom(r.camera),s?this._intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter):this._intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:de(this._zoomLocation,this._tmpCamera.center),this._updateCamera(this._tmpCamera,e,i,n),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:UC}}_updateCamera(e,i,r,s){const n=x4(e,r,this.view.renderCoordsHelper,this.view.viewingMode),a=Math.abs(this.view.camera.position.z),o=this._zoomLocation;Ee(fL,e.eye),le(fL,fL,-1),TM(e,r,this._tmpRayDir),Ee(this._tmpRayDir.direction,this._tmpRayDir.direction);const l=Se($M(fL,this._tmpRayDir.direction,YOe)*a,G6[0],G6[1]);if(n===1){let c=Sme**i;this._sphere[3]=Le(o),Ce(this._tmpViewDir,e.center,e.eye);const h=Math.min(Le(this._tmpViewDir),l);let f=h*c;if(c<=1&&f<fq&&(f=fq,c=f/h),Math.abs(h-f)<Pv)return;const y=Le(e.center);if(this._sphere[3]!==y){const _=this._sphere[3]+c*(y-this._sphere[3]);e.center=le(pL,e.center,_/y)}le(this._tmpViewDir,this._tmpViewDir,-c),e.eye=xe(pL,e.center,this._tmpViewDir),us(this.view,e,this._constraintOptions),on(o,e.center)>1e-12&&Aie(this._sphere,e,r,this._targetOnSphere)&&wdt(this._sphere,e,o,this._targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{let c=Sme**Math.abs(i);const h=i>0?1:-1;Ce(this._tmpViewDir,o,e.eye);const f=Le(this._tmpViewDir),y=this.view.stage.renderView.getMinimalDepthForArea(null,r[0],r[1],this.view.state.camera,Cdt);let _=y??l;s&&i>0&&(_=Math.min(_,f)),le(this._tmpRayDir.direction,this._tmpRayDir.direction,_),xe(o,this._tmpRayDir.origin,this._tmpRayDir.direction);let w=_*c;const x=Math.max(fq,1.01*e.nearFar[0]);if(i>0&&w<x&&(w=x,c=w/_),Math.abs(_-w)<Pv)return;le(this._tmpRayDir.direction,this._tmpRayDir.direction,h*(1-c)),e.eye=xe(pL,e.eye,this._tmpRayDir.direction),e.center=xe(pL,e.center,this._tmpRayDir.direction),Ee(this._tmpRayDir.direction,this._tmpRayDir.direction),this._constraintOptions.interactionDirection=this._tmpRayDir.direction,us(this.view,e,this._constraintOptions),this._constraintOptions.interactionDirection=null}SM(this.view,e)}};Y6=d([k("esri.views.3d.state.controllers.ZoomStepControllerGlobal")],Y6);const pL=R(),fL=R();let nF,aF=null;const h$=new Map;async function f7t(t){aF==null&&(nF==null&&(nF=te(()=>import("./VoxelWasmPerSceneView-Dp9w0HoK.js"),__vite__mapDeps([357,277]))),aF=await nF);const e=t.view;let i=h$.get(e);return i||(i=new aF.default({view:e}),h$.set(e,i)),i.addVoxelLayer(t)}function fD(t){return h$.get(t)}function m7t(t){const e=t.view,i=h$.get(e);i&&i.removeVoxelLayer(t)<1&&(h$.delete(e),h$.size===0&&(nF=null,aF=null))}const Mdt=.6,Edt=4,Adt=60;let Q6=class extends lw{constructor(){super(...arguments),this._zoomLocation=R(),this._tmpCamera=new nr,this._tmpRayDir=R(),this._tmpCenter=R(),this._beginCamera=new nr,this._constraintOptions=new Gu(15,1,null,this._beginCamera)}step(e,i){if(!this.running)return;const r=this.view.state;this.animation.finished?this._beginCamera.copyFrom(r.camera):this.animation.cameraAt(1,this._beginCamera),this._tmpCamera.copyFrom(r.camera);const s=new Vc(this.view.state.viewingMode);let n=!1;e>0?(n=this._intersectionHelper.intersectScreenFreePointFallback(i,this._zoomLocation,this.view.basemapTerrain.invisible?_2:{}),this._intersectionHelper.intersectRay(this._tmpCamera.ray,s,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter)):this._intersectionHelper.intersectRay(this._tmpCamera.ray,s,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:de(this._zoomLocation,this._tmpCamera.center);const a=Mdt**e;let o=this.view.stage.renderView.getMinimalDepthForArea(fD(this.view),i[0],i[1],this.view.state.camera,Adt);Ce(mL,this._tmpCamera.eye,this._zoomLocation),Ee(mL,mL);const l=Math.abs(this.view.camera.position.z),c=Se($M(Odt,mL,YOe)*l,G6[0],G6[1]);o=o??c;const h=R();Ce(h,this._zoomLocation,this._tmpCamera.eye),(o<Le(h)||!n)&&(Ee(h,h),xe(this._zoomLocation,this._tmpCamera.eye,le(h,h,o))),this._updateCamera(this._tmpCamera,a,this._zoomLocation),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:UC}}_updateCamera(e,i,r){Ce(this._tmpRayDir,r,e.eye);const s=Le(this._tmpRayDir);let n=s*i;const a=i<=1,o=Math.max(Edt,1.01*e.nearFar[0]);n!==0&&(a&&n<o&&(n=o,i=n/s),Math.abs(s-n)<Pv||(le(this._tmpRayDir,this._tmpRayDir,i),e.eye=Ce(Tme,r,this._tmpRayDir),e.center=Wi(Tme,e.center,r,1-i),us(this.view,e,this._constraintOptions)))}};Q6=d([k("esri.views.3d.state.controllers.ZoomStepControllerLocal")],Q6);const Tme=R(),Odt=Ge(0,0,1),mL=R();function Pdt(t,e){switch(e){case"primary":return t.pointerType==="touch"||t.button===0;case"secondary":return t.pointerType!=="touch"&&t.button===2;case"tertiary":return t.pointerType!=="touch"&&t.button===1}}function Die(t,e){const{button:i,pointerType:r}=t;return r!=="touch"&&e.some(s=>s==="primary"&&i===0||s==="secondary"&&i===2||s==="tertiary"&&i===1)}function mq(t,{dragPrimary:e,dragSecondary:i,dragTertiary:r}){return[{key:"primary",value:e},{key:"secondary",value:i},{key:"tertiary",value:r}].filter(s=>s.value===t).map(s=>s.key)}let Rdt=class extends ho{constructor(e,i){super(!0),this._view=e,this.registerIncoming("double-click",i,r=>this._handleDoubleClick(r))}_handleDoubleClick(e){const i=e.data;if(Pdt(i,"primary")){const r=this._view.state.isGlobal?new Y6({view:this._view,mode:"animation"}):new Q6({view:this._view,mode:"animation"});this._view.state.switchCameraController(r),r.step(Math.log(.5)/Math.log(.6),Gs(i.x,i.y)),e.stopPropagation()}}},oF=class extends Me{constructor(e){super(e)}initialize(){this.addHandles(this.view.elevationProvider.on("elevation-change",e=>this._handleElevationChangeEvent(e)))}_handleElevationChangeEvent(e){if(this.view.state.cameraController||e.context!=="ground")return;const i=this.view.state.camera;e.spatialReference!=null&&zEe(this.view,i,e.extent,e.spatialReference)&&this._applyToCurrentCamera()}_applyToCurrentCamera(){this.view.state.updateCamera(e=>SM(this.view,e,1))}};d([m({constructOnly:!0})],oF.prototype,"view",void 0),oF=d([k("esri.views.3d.state.SurfaceCollisionConstraint")],oF);let zO=class extends Me{constructor(e){super(e),this.nearFarHeuristic=Kat(e.view.state.viewingMode,e.view.basemapTerrain,e.view.renderCoordsHelper.spatialReference)}initialize(){const e=()=>this._updateNearFar();this.addHandles([K(()=>[this.view.constraints.clipDistance.near,this.view.constraints.clipDistance.far],()=>this._clipDistanceNearFarChanged()),this.view.state.events.on("before-camera-change",({camera:i,sceneDepthRange:r})=>this._updateCameraNearFar(i,r)),K(()=>this.view.constraints.clipDistance.mode,e),K(()=>this.view.stage.renderer.sceneDepthRange.value,e,Yt),K(()=>this.view.renderDataExtent,e,Yt),K(()=>this.view.basemapTerrain.visibleElevationBounds,e,Yt),K(()=>[this.view.constraints.altitude.min,this.view.constraints.altitude.max],()=>this._updateAltitude(),Yt),K(()=>this.view.constraints.tilt.max,()=>this._updateTiltMax(),Yt),K(()=>this.view.constraints.tilt.mode,()=>this._updateTilt(),Yt),K(()=>this.view.state?.camera,()=>this._updateTiltAutoMax(),Yt),K(()=>[this.view.map?.ground?.navigationConstraint?.type,this.view.state.constraints.collision.enabled],()=>this._updateCollision(),Yt)]),this.view.state.isLocal&&this.addHandles(K(()=>this.view.renderDataExtent,i=>this._updateLocalSurfaceDistance(i),Wt)),this._updateNearFar(),this.view.state.viewingMode!==2&&this._updateAltitude(),this._updateTilt(),this._updateCollision(),this._set("surfaceCollisionConstraint",new oF({view:this.view}))}destroy(){this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){const e=this.view.constraints.clipDistance;e.mode!=="auto"&&this.view.state.updateCamera(i=>$me(i,e))}_updateNearFar(){this.view.state.updateCamera(e=>this._updateCameraNearFar(e))}_updateCameraNearFar(e,i){const r=this.view.constraints.clipDistance;r.mode==="manual"?$me(e,r):this._updateCameraNearFarAuto(e,r,i)}_updateCameraNearFarAuto(e,i,r=this.view.stage.renderer.sceneDepthRange.value){const s=a8(this.view,e.eye),n=this.nearFarHeuristic.compute(e,this.view.renderDataExtent,r,s);e.near=n.near,e.far=n.far,i&&i.autoUpdate(e.near,e.far)}_updateCollision(){const e=this.view.map?.ground?.navigationConstraint?.type,i=!e||e==="stay-above",r=this.view.state.constraints.collision;i!==r.enabled&&(r.enabled=i,i&&this._reapplyConstraints(8),this.view.constraints.tilt.mode==="auto"&&this._updateTiltAuto())}_updateAltitude(){const e=this.view.constraints.altitude;this.view.state.viewingMode===1?this.view.state.constraints.altitude={min:e.min,max:e.max}:this.view.state.constraints.altitude=null,this._reapplyConstraints()}_updateTiltMax(){const e=this.view.constraints.tilt;e.mode!=="auto"&&(this._updateTiltManual(e),this._reapplyConstraints())}_updateTilt(){const e=this.view.constraints.tilt;e.mode==="manual"?this._updateTiltManual(e):this._updateTiltAuto(),this._reapplyConstraints()}_updateTiltManual(e){const i=this.view.state.constraints;i.tilt=i.createConstantMaxTilt(Lt(e.max))}_updateTiltAuto(){const e=this.view.state.constraints;e.tilt=e.createDefaultTilt(),this._updateTiltAutoMax()}_updateTiltAutoMax(){const e=this.view.constraints.tilt;if(e.mode!=="auto")return;const i=this.view.state.constraints;if(i.tilt){const r=i.tilt(this.view.state.camera.distance).max;e.autoUpdate(Ea(r))}}_updateLocalSurfaceDistance(e){if(e==null)return;let i=Math.max(e.width,e.height);if(i<=0)return;e.zmax!=null&&e.zmin!=null&&(i=Math.max(i,e.zmax-e.zmin));const r=this.view.state,s=3*i/Math.atan(r.camera.fov/2);s!==r.constraints.distance&&(r.constraints.distance=s)}_reapplyConstraints(e=15){this.view.state.updateCamera(i=>us(this.view,i,new Gu(e,0,null)))}};function $me(t,e){e&&(t.near=e.near,t.far=e.far)}d([m({constructOnly:!0})],zO.prototype,"view",void 0),d([m({readOnly:!0})],zO.prototype,"surfaceCollisionConstraint",void 0),zO=d([k("esri.views.3d.state.ConstraintsManager")],zO);let JP=class extends Ig{constructor(e){super(e)}set desiredCamera(e){this._set("desiredCamera",e.clone())}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=2,this.addHandles(this.view.elevationProvider.on("elevation-change",e=>this._elevationChangeEvent(e))),this._applyCorrection()}onControllerEnd(){this.removeAllHandles()}_elevationChangeEvent(e){e.spatialReference!=null&&!zEe(this.view,this.desiredCamera,e.extent,e.spatialReference)||e.context!=="ground"||this._applyCorrection()}_applyCorrection(){this.view.state.updateCamera(e=>{e.copyViewFrom(this.desiredCamera),SM(this.view,e,1)||this.constraintEnabled||(this.state=3)})}};d([m({constructOnly:!0})],JP.prototype,"desiredCamera",null),JP=d([k("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],JP);const Ddt=.66;function lPe(t){return 360-nU.normalize(t)}function m8(t){return nU.normalize(360-t)}function cPe(t,e,i){const r=e.camera;if(r!=null)return Idt(r,m2(t));const{targetGeometry:s}=e;if(s==null)return null;const{camera:n,mode:a}=hPe(t,e.rotation,i);if(s.type==="point")return kdt(t,e,s,n,a);const o=s.extent;return o==null?null:Wz(t,o,n.heading,n.tilt,a)}async function uPe(t,e,i,r){const s=e.camera;if(s!=null)return Ldt(s,m2(t),r);const{targetGeometry:n}=e;if(n==null)throw new Error("Viewpoint has no targetGeometry!");const{camera:a,mode:o}=hPe(t,e.rotation,i);if(n.type==="point")return zdt(t,e,n,a,o,r);const l=n.extent;if(l==null)throw new Error("Target geometry has no extent!");return uAe(t,l,a.heading,a.tilt,o,r)}function Idt(t,e){const i=t.position;let r;try{r=xv(i,e)}catch{return null}if(!r)return null;const s=t.clone();return s.position=r.clone(),s}async function Ldt(t,e,i){const r=t.position,s=await fy(r,e,{signal:i});st(i);const n=t.clone();return n.position=s.clone(),n}function hPe(t,e,i){const r=NC(t,t.state.camera);let s=1;return e!=null&&(r.heading=lPe(e),s=0),i!=null&&(r.tilt=i),{camera:r,mode:s}}function kdt(t,e,i,r,s){const n=t.spatialReference;let a;try{a=xv(i.clone(),n)}catch{return null}if(!a)return null;const o=e.scale!=null?sD(t,e.scale):t.state.camera.distance;return Fot(t,a,o,r,s)}async function zdt(t,e,i,r,s,n){const a=t.spatialReference,o=await fy(i.clone(),a,{signal:n});st(n);const l=e.scale!=null?sD(t,e.scale):t.state.camera.distance;return l8(t,o,l,r,s,n)}function dPe(t,e,i=null){return i==null&&(i=new Yf),Lie(t,null,e.clone(),i)}async function pPe(t,e,i){const r=Wdt(t,e);if(!r)throw new ee("viewpointutils-create:no-target","Missing target for creating viewpoint");const s=new ol({fov:t.camera.fov}),n=new Yf({camera:s});if(r.target instanceof Yf)return M1(await Vdt(t,r.target,r,i,n));if(r.target instanceof ol)return M1(await mPe(t,r.target,i,n));const a=r.scale!=null||r.zoom!=null;if(r.target instanceof Bt){const c=r.target.xmin===r.target.xmax||r.target.ymin===r.target.ymax;return M1(a||c?await eX(t,r,r.target.center,s,i,n):await qdt(t,r,r.target,s,i,n))}const o=new Ydt,l=a?Fdt(t,r):void 0;if(await fPe(t,r.target,l,o,i),isFinite(o.boundingBox[0])){let c;if(zte(o.boundingBox,Os),yu.x=Os[0],yu.y=Os[1],yu.z=Os[2],yu.spatialReference=t.spatialReference,isFinite(yu.z)&&o.hasZ?c=SMe(o.boundingBox):(yu.z=void 0,c=bqe(Fte(o.boundingBox,Qdt))),a||c)return M1(await eX(t,r,yu,s,i,n));const h=Zdt(t,o.screenSpaceObjects);return M1(await Hdt(t,r,yu,o.boundingBox,h,s,i,n))}return r.position?M1(await Bdt(t,r,s,n,i)):M1(await jdt(t,r,s,i,n))}function Iie(t,e){return e.scale==null&&e.zoom!=null?fAe(t,e.zoom):e.scale}function Fdt(t,e){const i=Iie(t,e);return i?oJe(i):void 0}function g8(t,e){let i=!1;return e.heading!=null?(t.heading=e.heading,i=!0):e.rotation!=null&&(t.heading=lPe(e.rotation),i=!0),e.tilt!=null&&(t.tilt=e.tilt,i=!0),e.fov!=null&&(t.fov=e.fov),i}function Lie(t,e,i,r){const s=t.spatialReference||Ie.WGS84;if(e??=Tf(t,i),e==null)return r;const n=new Qe({spatialReference:s});return p2(e.center,t.renderSpatialReference,n)&&(r.targetGeometry=n,r.scale=Zx(t,e.distance),r.rotation=m8(i.heading),r.camera=i),r}async function X6(t,e,i,r){const s=()=>new ee("viewpointutils:invalid-geometry","The target is missing a valid geometry");if(!e)throw s();e.type==="mesh"&&(e=e.extent);const n=t.basemapTerrain.spatialReference;if(!e.hasZ&&t.basemapTerrain){let f;switch(e.type){case"point":f=e;break;case"multipoint":case"polyline":f=e.extent?.center;break;case"extent":f=e.center;break;case"polygon":{const y=Q2e(e);f=y?Qe.fromJSON(y):null;break}}f!=null&&n&&t.elevationProvider?(f=await fy(f,n,{signal:r}),Os[2]=Ff(t.elevationProvider,f)??0):Os[2]=0}const a=Xdt[e.type],o=new Array;if(a(e,e.hasZ?f=>{o.push([f[0],f[1],f[2]])}:f=>{o.push([f[0],f[1]])},Os),o.length===0)throw s();const l=e.spatialReference,c=t.spatialReference,h=await fy(new Po({spatialReference:l,hasZ:e.hasZ,hasM:!1,points:o}),c,{signal:r});if(e.hasZ&&(i.hasZ=!0),e.hasZ)for(const[f,y,_]of h.points)Os[0]=f,Os[1]=y,Os[2]=_,LC(i.boundingBox,Os);else for(const[f,y]of h.points)Os[0]=f,Os[1]=y,LC(i.boundingBox,Os)}async function Ndt(t,e,i,r,s){const n=await Xf(t.whenViewForGraphic(e));if(n.ok===!1||n.value==null||!("whenGraphicBounds"in n.value))return void await X6(t,e.geometry,r,s);const a=n.value,o=await Xf(a.whenGraphicBounds(e,{minDemResolution:i}));if(o.ok===!1||!o.value)return void await X6(t,e.geometry,r,s);const{screenSpaceObjects:l,boundingBox:c}=o.value;bMe(r.boundingBox,c),l&&l.forEach(h=>{r.screenSpaceObjects.push(h)}),isFinite(c[2])&&(r.hasZ=!0)}async function fPe(t,e,i,r,s){if(Array.isArray(e)&&e.length===2){const n=e[0],a=e[1];if(typeof n=="number"&&typeof a=="number")return yu.x=n,yu.y=a,yu.z=void 0,yu.spatialReference=t.spatialReference?.isGeographic?t.spatialReference:Ie.WGS84,void await X6(t,yu,r,s)}e&&"map"in e&&typeof e.map=="function"?await Promise.allSettled(e.map(n=>fPe(t,n,i,r,s))):e instanceof so?await X6(t,e,r,s):e instanceof Gn&&await Ndt(t,e,i,r,s)}async function Vdt(t,e,i,r,s){if(e.camera)return mPe(t,e.camera,r,s);s.scale=e.scale,s.rotation=e.rotation,s.targetGeometry=e.targetGeometry!=null?e.targetGeometry.clone():null,s.camera=null,i.heading!=null?s.rotation=m8(i.heading):i.rotation!=null&&(s.rotation=i.rotation);const n=Iie(t,i);return n!=null&&(s.scale=n),s.camera=await uPe(t,s,i.tilt,r),s}async function mPe(t,e,i,r){const s=t.spatialReference,n=await fy(e.position,s,{signal:i}),a=e.clone();return a.position=n,Lie(t,null,a,r)}async function Udt(t,e,i,r,s,n,a){const o=t.renderSpatialReference;return await c6(e,gq,o,0,{signal:a}),await c6(i,yL,o,0,{signal:a}),n.targetGeometry=new Qe(e),s.position=new Qe(i),Ce(J6,gq,yL),p4(t,yL,J6,r.up,s),n.scale=Zx(t,Ri(yL,gq)),n.rotation=m8(s.heading),n.camera=s,n}async function eX(t,e,i,r,s,n){n.targetGeometry=i.clone();const a=f2(t);if(e.position)return Udt(t,n.targetGeometry,e.position,a,r,n,s);if(e.zoomFactor){const l=a.distance/e.zoomFactor,c=le(Os,a.viewForward,-l);a.eye=xe(Os,a.center,c),n.scale=Zx(t,l)}NC(t,a,r);const o=g8(r,e)?0:1;if(!e.zoomFactor){const l=Iie(t,e);if(l==null){await c6(n.targetGeometry,Os,t.renderSpatialReference,0,{signal:s});const c=xEe(a.frustum,Os)?Ri(a.eye,Os):a.distance;n.camera=await l8(t,n.targetGeometry,c,r,o),n.scale=Zx(t,c)}else n.scale=l,n.camera=await zot(t,n.targetGeometry,n.scale,r,o,s)}return n}async function Bdt(t,e,i,r,s){const n=f2(t);de(J6,n.viewForward),p4(t,n.eye,J6,n.up,yq);const a=t.spatialReference,{position:o}=e;if(o){const l=await fy(o,a,{signal:s});i.position=l}else i.position=new Qe;return i.heading=e.heading!=null?e.heading:yq.heading,i.tilt=e.tilt!=null?e.tilt:yq.tilt,Lie(t,null,i,r)}async function jdt(t,e,i,r,s){if(e.heading!=null||e.rotation!=null||e.scale!=null||e.tilt!=null||e.zoom!=null||e.zoomFactor!=null){const n=f2(t),{spatialReference:a,renderSpatialReference:o}=t,l=new Qe({spatialReference:a});return p2(n.center,o,l)?eX(t,e,l,i,r,s):s}return s.scale=t.scale,s.camera=t.camera.clone(),g8(s.camera,e),s}async function qdt(t,e,i,r,s,n){n.targetGeometry=i.clone();const a=f2(t);NC(t,a,r);const o=g8(r,e)?0:1;return n.camera=await uAe(t,i,r.heading,r.tilt,o,s),n}function Gdt(t,e,i,r,s){let n=0;i.z!=null?n=i.z:t.basemapTerrain&&t.elevationProvider&&(n=Ff(t.elevationProvider,i)),ve(Os,i.x,i.y,n),h4(t.spatialReference,Os,Cme,t.renderSpatialReference),jv(gL,Cme),qv(gL,gL),Nc(lA);const a=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(let w=0;w<a.length;w++){const x=a[w];let S=r[x[2]];isFinite(S)||(S=n),ve(Os,r[x[0]],r[x[1]],S),ja(Os,t.spatialReference,Os,t.renderSpatialReference),LC(lA,rl(Os,Os,gL))}const o=h2(lA),l=Zv(lA),c=d2(lA),h=1/Math.tan(e.fovX/2),f=1/Math.tan(e.fovY/2),y=.5*Math.sqrt(o*o+c*c)*Math.max(f,h)+.5*l,_=.5*l*f+.5*Math.max(o,c);return Math.max(y,_)/s}async function Hdt(t,e,i,r,s,n,a,o){o.targetGeometry=i.clone();const l=f2(t),c=Gdt(t,l,i,r,s);NC(t,l,n);const h=g8(n,e)?0:1;return o.camera=await l8(t,o.targetGeometry,c,n,h,a),o.scale=Zx(t,c),o}function Wdt(t,e){if(!e||!t.spatialReference)return null;const i={target:void 0};return"declaredClass"in e||Array.isArray(e)?i.target=e:(Object.assign(i,e),!i.target&&"center"in e&&e.center&&(i.target=e.center)),i}function M1(t){return t?.camera!=null&&(t.rotation=m8(t.camera.heading)),t}function Zdt(t,e){const i=Ddt;if(!e.length)return i;let r=Number.NEGATIVE_INFINITY;for(let s=0;s<e.length;s++){const n=e[s].screenSpaceBoundingRect;r=Math.max(r,Math.abs(n[0]),Math.abs(n[1]),Math.abs(n[2]),Math.abs(n[3]))}return i-r/Math.min(t.width,t.height)*2}let Ydt=class{constructor(){this.hasZ=!1,this.boundingBox=Nc(),this.screenSpaceObjects=new Array}};const Os=R(),Cme=it(),gL=Ir(),lA=ul(),Qdt=Pi(),J6=R(),yL=R(),gq=R(),yq={heading:0,tilt:0},yu=new Qe,Xdt={point(t,e,i){i[0]=t.x,i[1]=t.y,t.z!=null&&(i[2]=t.z),e(i)},polygon(t,e,i){const r=t.hasZ;for(let s=0;s<t.rings.length;s++){const n=t.rings[s];for(let a=0;a<n.length;a++)i[0]=n[a][0],i[1]=n[a][1],r&&(i[2]=n[a][2]),e(i)}},polyline(t,e,i){const r=t.hasZ;for(let s=0;s<t.paths.length;s++){const n=t.paths[s];for(let a=0;a<n.length;a++)i[0]=n[a][0],i[1]=n[a][1],r&&(i[2]=n[a][2]),e(i)}},multipoint(t,e,i){const r=t.points,s=t.hasZ;for(let n=0;n<r.length;n++)i[0]=r[n][0],i[1]=r[n][1],s&&(i[2]=r[n][2]),e(i)},extent(t,e,i){t.zmin!=null&&t.zmax!=null?(e(ve(i,t.xmin,t.ymin,t.zmin)),e(ve(i,t.xmax,t.ymin,t.zmin)),e(ve(i,t.xmin,t.ymax,t.zmin)),e(ve(i,t.xmax,t.ymax,t.zmin)),e(ve(i,t.xmin,t.ymin,t.zmax)),e(ve(i,t.xmax,t.ymin,t.zmax)),e(ve(i,t.xmin,t.ymax,t.zmax)),e(ve(i,t.xmax,t.ymax,t.zmax))):(e(ve(i,t.xmin,t.ymin,i[2])),e(ve(i,t.xmax,t.ymin,i[2])),e(ve(i,t.xmin,t.ymax,i[2])),e(ve(i,t.xmax,t.ymax,i[2])))}},Jdt=Object.freeze(Object.defineProperty({__proto__:null,create:pPe,fromCamera:dPe,toCameraAsync:uPe,toCameraSync:cPe},Symbol.toStringTag,{value:"Module"}));let Kdt=class{constructor(e,i,r){this._target=e,this._options=i,this.view=r,this.state="pending",this._animationController=null,this.promise=new Promise((s,n)=>{this._resolveCallback=s,this._rejectCallback=n;const a=new AbortController;this._options.signal!=null&&qa(this._options.signal,()=>this.abort()),this._abortController=a,this._waitForReady()})}_resolve(e){if(this.state!=="finished")return this.state="finished",this._resolveCallback(e)}_reject(e){if(this.state!=="finished")return this.state="finished",this._rejectCallback(e)}abort(e=!1){this._abortController.abort(),this.state==="wait-for-animation-finish"&&!e&&this._animationController!=null&&this.view.state.cameraController===this._animationController&&this._animationController.running&&this._animationController.stopController(),this._reject(Xt())}async _waitForReady(){if(this.state="wait-for-ready",!this.view.ready)try{await mv(()=>this.view.ready,this._abortController.signal)}catch(e){return this._reject(e)}this._createViewPoint()}async _createViewPoint(){if(this.state!=="finished"){this.state="wait-for-viewpoint",this._animationController=this._options.animate?this._getAnimationController():null;try{const e=await pPe(this.view,this._target,this._abortController.signal);if(this.state==="finished")return;const i=e?this._getCameraFromViewpoint(e):null;if(i==null)return;if(this._options.animate){if(this._animationController==null)return;this._startAnimation(i,this._animationController)}else this.view.stateManager.setStateCamera(i.camera,{applyConstraints:!i.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this._resolve()}catch(e){this._reject(e)}}}_getCameraFromViewpoint(e){const i=!!(this._target instanceof Yf&&this._target.camera||this._target instanceof ol),r=e.camera;if(r==null)return null;if(!this.view.stateManager.isCompatible(r)){const n=r.position,a=n&&n.spatialReference,o=a?a.wkid:"none",l=this.view.spatialReference?.wkid;return this._reject(new ee("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${o}, view: ${l})`,{camera:r})),null}const s=Tf(this.view,r);return s==null?(this._reject(new ee("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:e,camera:s,isFullySpecified:i}}_startAnimation(e,i){this.state="wait-for-animation-finish";const r=i.viewAnimation;if(r==null)return void this._reject(new ee("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));if(r.update(e.viewpoint,"running"),!i.running||i.viewAnimation==null||i.viewAnimation.target!==e.viewpoint||this.view.state.cameraController!==i)return this.abort();let s;e.isFullySpecified?(s=new JP({view:this.view,desiredCamera:e.camera}),SM(this.view,e.camera,1)):us(this.view,e.camera),i.begin(e.camera,this._options);const n=()=>{const o=this.view.state.cameraController;s&&(o&&o.running?dme(o)&&o.viewAnimation!=null&&o.viewAnimation.target===e.viewpoint&&(this.view.state.cameraController=s):i.viewAnimation!=null&&i.viewAnimation.target===e.viewpoint&&i.state===4&&(this.view.state.cameraController=s))},a=o=>{if(this.view.state!=null)switch(i.state){case 4:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this._resolve()}break;case 0:case 1:case 2:case 3:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this._reject(o)}}};r.when(n,o=>a(o)),i.asyncResult={resolve:()=>a(),reject:o=>a(o)}}_getAnimationController(){let e=null,i=null;const r=this.view.state.cameraController;return dme(r)&&(r.updateStateFromViewAnimation(),r.running&&(e=r,i=e.viewAnimation)),e==null&&(e=new lw({view:this.view,mode:"animation"}),i=e.viewAnimation,this.view.state.switchCameraController(e),e.state===1)?(i?.stop(),this._reject(new ee("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null):e}},ks=class extends Me{constructor(e){super(e),this.ready=!1,this._windowDevicePixelRatio=1,this._devicePixelRatioOverride=null,this._idleTimeout=Mme,this.test={viewStateManager:this,contentCameraResetState:new Map,setDevicePixelRatio:i=>this._devicePixelRatioOverride=i,getDevicePixelRatioOverride:()=>this._devicePixelRatioOverride,renderState:null,get maximumPixelRatio(){return this.viewStateManager.view.qualitySettings.maximumPixelRatio},get updatingIgnoreRenderState(){return this.renderState!=null},get idleTimeoutEnabled(){return this.viewStateManager._idleTimeout>0},set idleTimeoutEnabled(i){this.viewStateManager._idleTimeout=i?Mme:0}},this._propertiesPool=new _y({frustum:()=>new jEe(null)},this),this._cameraSetByUser=!1,this._gotoOperation=null,this._cameraChangeTime=0,this._tmpCanvasSize=new ept}initialize(){this._cameraChangeTime=performance.now(),this.addHandles([Ys(()=>this.view.state.events,"before-camera-change",({camera:e})=>e&&this._updateElevation(e)),K(()=>this.view.state?.camera,(e,i)=>this._cameraChangedHandler(e,i),Yt)]),Zs(()=>this.view.state?.camera,e=>this._updateElevation(e),{once:!0,sync:!0}),this.addHandles([Rx({prepare:()=>this._prepareFrame()}),K(()=>this.view.state.cameraController,()=>{this._cameraSetByUser=!0,this.removeHandles(vL)}),Ys(()=>this.view.state.events,"camera-projection-changed",()=>this.notifyChange("scale"))])}destroy(){this.exit(),this._propertiesPool=Re(this._propertiesPool)}get camera(){const e=this._get("camera");if(!this.ready)return e;const i=NC(this.view,this.view.state.camera,lF);return i&&e&&i.equals(e)?e:i.clone()}set camera(e){if(this._updatePropertyBeforeReady("camera",e))return;this.view.elevationProvider.enableCache(!0);const i=Tf(this.view,e);i?this.setStateCamera(i,{applyConstraints:!1})||fe.getLogger(this).warnOnce("#camera=","There is a currently active camera controller that has priority."):fe.getLogger(this).error("#camera=","Invalid camera",e),this.view.elevationProvider.enableCache(!1)}get contentCamera(){const e=this._get("contentCamera");if(!this.ready)return e;const i=NC(this.view,this.view.state.contentCamera,lF);return i&&e&&i.equals(e)?e:i.clone()}set contentCamera(e){if(this._updatePropertyBeforeReady("contentCamera",e))return;const i=Tf(this.view,e);this.view.state.contentCamera=i??null}installContentCameraReset(e){if(this.removeHandles(_q),this.test.contentCameraResetState.clear(),!this.view.state.fixedContentCamera)return!1;const i=this.zoom,r=this.view.state.camera.distance**2,s=VR(this.view.state.camera.center),n=e.sticky?this.contentCamera.clone():null;return this.addHandles([K(()=>this.contentCamera,()=>{e.sticky||(this.removeHandles(_q),this.test.contentCameraResetState.clear())}),K(()=>this.zoom,a=>{a!==void 0&&i!==void 0&&(this.test.contentCameraResetState.set("view.zoom",Math.abs(a-i)/2),Math.abs(a-i)>2?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=n))}),K(()=>this.view.state.camera,a=>{const o=on(s,a.center);this.test.contentCameraResetState.set("camera.center",o/r),o>r?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=n)})],_q),!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(e){this._updatePropertyBeforeReady("center",e)||(e?this.isCompatible(e)?this.setStateCamera(this._centerToCamera(e),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():fe.getLogger(this).error("#center=","Invalid center",e):fe.getLogger(this).error("#center=","Center has an incompatible spatial reference (center: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",e):fe.getLogger(this).error("#center=","Center may not be null or undefined"))}get visibleArea(){if(!this.ready){const e=this._get("extent");return e?os.fromExtent(e):null}return Bot(this.view,this.view.pointsOfInterest.focus.renderLocation)}get extent(){if(!this.ready)return this._get("extent");const e=this.view,i=hAe(e,e.state.camera,e.pointsOfInterest.centerOnContent.renderLocation);return i??this._get("extent")}set extent(e){this._updatePropertyBeforeReady("extent",e)||(e?this.isCompatible(e)?this.setStateCamera(this._extentToCamera(e),{applyConstraints:!0})||fe.getLogger(this).error("#extent=","Invalid extent",e):fe.getLogger(this).error("#extent=","Extent has an incompatible spatial reference (extent: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",e):fe.getLogger(this).error("#extent=","Extent may not be null or undefined"))}get frustum(){const e=this._propertiesPool.get("frustum");return e.renderCoordsHelper=this.view.renderCoordsHelper,e.update(this.view.state.camera),e}get constraintsManager(){return this._constraintsManager}get _initialViewpoint(){const e=this.view.map;return e&&"initialViewProperties"in e?e.initialViewProperties?.viewpoint:void 0}get hasInitialView(){return!!this._initialViewpoint}get scale(){if(!this.ready)return this._get("scale");const e=this.view.basemapTerrain.tilingScheme,i=this.view.pointsOfInterest.cameraOnSurface.scale;return e&&i?JEe(this.view,i,this.view.state.contentCamera,e):this._get("scale")}set scale(e){this._updatePropertyBeforeReady("scale",e)||this.setStateCamera(this._scaleToCamera(e),{applyConstraints:!0})||fe.getLogger(this).error("#scale=","Invalid scale",e)}get padding(){if(!this.ready)return this._get("padding");const e=this.view.state.camera,i=e.padding,r=e.pixelRatio,s=this._get("padding"),n=Math.round(i[0]/r),a=Math.round(i[1]/r),o=Math.round(i[2]/r),l=Math.round(i[3]/r);return s!=null&&s.top===n&&s.right===a&&s.bottom===o&&s.left===l?s:{top:n,right:a,bottom:o,left:l}}set padding(e){this._updatePropertyBeforeReady("padding",e)||(this._paddingToArray(e,this.view.state.camera.pixelRatio,_L),this.view.state.updateCamera(i=>i.padding=_L))}_paddingToArray(e,i,r){e?yr(r,e.top||0,e.right||0,e.bottom||0,e.left||0):yr(r,0,0,0,0);for(let s=0;s<4;s++)r[s]=Math.round(r[s]*i)}get screenCenter(){const e=this.padding;return Zl((this.view.width-(e.left+e.right))/2+e.left,(this.view.height-(e.top+e.bottom))/2+e.top)}get viewpoint(){return this.ready?dPe(this.view,this.camera):this._get("viewpoint")}set viewpoint(e){if(!this._updatePropertyBeforeReady("viewpoint",e))if(e){if(!this.isCompatible(e)){const i=e.camera!=null?e.camera.position:e.targetGeometry,r=i!=null&&i.spatialReference;return void fe.getLogger(this).error("#viewpoint=","Viewpoint has an incompatible spatial reference (viewpoint: "+(r?r.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",e)}this.setStateCamera(this._viewpointToCamera(e),{applyConstraints:!e.camera})||fe.getLogger(this).error("#viewpoint=","Invalid viewpoint",e)}else fe.getLogger(this).error("#viewpoint=","Viewpoint may not be null or undefined")}get zoom(){return this.ready?Wot(this.view,this.scale):this._get("zoom")}set zoom(e){this._updatePropertyBeforeReady("zoom",e)||e===void 0||this.setStateCamera(this._zoomToCamera(e),{applyConstraints:!0})||fe.getLogger(this).error("#zoom=","Invalid zoom",e)}_computeCanvasSize(){if(this._devicePixelRatioOverride)return this.view.state.contentPixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*this._devicePixelRatioOverride),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*this._devicePixelRatioOverride),this._tmpCanvasSize.pixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize;const e=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio),i=(this._usePhysicalPixelRendering?this._windowDevicePixelRatio:e)*this.view.resolutionScale;this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*i),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*i);const r=this.view.stage.renderView.renderingContext?.parameters.maxTextureSize;return r&&nw(this._tmpCanvasSize,r),this._tmpCanvasSize.pixelRatio=this._tmpCanvasSize.width>0?this._tmpCanvasSize.width/this.view.surface.clientWidth*.5+this._tmpCanvasSize.height/this.view.surface.clientHeight*.5:i,this.view.state&&(this.view.state.contentPixelRatio=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)),this._tmpCanvasSize}get _rasterPixelRatio(){return this._devicePixelRatioOverride!=null?this._devicePixelRatioOverride:this._usePhysicalPixelRenderingAny?this._windowDevicePixelRatio:Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)}get _usePhysicalPixelRendering(){return this.view?.stage?.renderer.isFeatureEnabled(8)??!1}get _usePhysicalPixelRenderingAny(){const e=this.view?.stage?.renderer;return e&&(e.isFeatureEnabled(8,2)||e.isFeatureEnabled(8,1)||e.isFeatureEnabled(8,0))}preinit(e){return!(this._isOverridden("center")&&!Ib(this.center.spatialReference,e))&&!(this._isOverridden("camera")&&!Ib(this.camera.position.spatialReference,e))&&!(this._isOverridden("extent")&&!Ib(this.extent.spatialReference,e))&&!!(!this._isOverridden("viewpoint")||Ib(this.viewpoint.targetGeometry?.spatialReference,e)&&Ib(this.viewpoint.camera?.position?.spatialReference,e))}init(){this._constraintsManager=new zO({view:this.view}),this._prepareFrame();const e=this._getInitialProperties();this._cameraSetByUser=!1,this._set("ready",!0);for(const i of e)this.set(i.name,i.value);if(!this._cameraSetByUser){const i=this._initialViewpoint||this.view.initialExtent;i&&this.isCompatible(i)?this._setInitialView(i):this.view.state.viewingMode===2&&this.addHandles(Zs(()=>this.view.basemapTerrain.ready,()=>{this.removeHandles(vL),this._setInitialView(this.view.dataExtent)},{once:!0,initial:!0}),vL)}}exit(){this._cancelGoToOperation(),this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this._cameraSetByUser=!1,this.removeHandles(vL),this._constraintsManager=Re(this._constraintsManager))}async goTo(e,i){return i={animate:!0,...i},this._gotoOperation!=null&&this._gotoOperation.abort(i.animate),this._gotoOperation=new Kdt(e,i,this.view),this.view.resourceController.scheduler.stopFrame(),this._gotoOperation.promise}debugSetCameraOnContent(){this.setStateCamera(f2(this.view),{applyConstraints:!1})}step(e){const i=this.view.state?.cameraController;i?.stepController&&this.view.state.updateCamera(r=>i.stepController(e,r))}_cancelGoToOperation(){this._gotoOperation!=null&&(this._gotoOperation.abort(),this._gotoOperation=null)}_getInitialProperties(){const e=new Set,i=[];for(const{propertyName:r,overrides:s}of ipt){const n=e.has(r),a=this._isOverridden(r);!n&&a&&i.push({name:r,value:this._get(r)}),this._clearOverride(r),(n||a)&&s.forEach(o=>e.add(o))}return i}_setInitialView(e){if(e==null||this._cameraSetByUser)return;if(e instanceof ol)return void this.setStateCamera(Tf(this.view,e),{applyConstraints:!1});if(e instanceof Yf){if(e.targetGeometry instanceof Bt){const n=Wz(this.view,e.targetGeometry,0,.5,0);return void(n!=null&&this.setStateCamera(Tf(this.view,n),{applyConstraints:!0}))}const r={applyConstraints:!e.camera},s=this._viewpointToCamera(e);return void this.setStateCamera(s,r)}const i=Wz(this.view,e,0,.5,0);i!=null&&this.setStateCamera(Tf(this.view,i),{applyConstraints:!0})}_updatePropertyBeforeReady(e,i){return!this.ready&&(this._override(e,i),i&&tpt.has(e)&&this._override("hasInitialView",!0),!0)}isCompatible(e){return e!=null&&(e instanceof Yf?e.camera?this.isCompatible(e.camera):this.isCompatible(e.targetGeometry):e instanceof ol?this.isCompatible(e.position):e.spatialReference&&!GTe(e.spatialReference,this.view.spatialReference))}_getPreservingHeadingTilt(e=rpt){return this._cameraSetByUser?(e.heading=this.camera.heading,e.tilt=this.camera.tilt):(e.heading=0,e.tilt=.5),e}_centerPointAtDistanceToCamera(e,i,r=ig){const{heading:s,tilt:n}=this._getPreservingHeadingTilt(),a=nD(this.view,s,n,e,i,1);return a==null?null:(r.copyFrom(this.view.state.camera),r.eye=a.eye,r.center=a.center,r.up=a.up,r)}_centerToCamera(e){let i;if(e.hasZ)i=this.view.state.camera.distance;else{const{centerOnContent:r}=this.view.pointsOfInterest;r.runTask(),i=r.distance}return this._centerPointAtDistanceToCamera(e,i)}_extentToCamera(e){const{heading:i,tilt:r}=this._getPreservingHeadingTilt(),s=Wz(this.view,e,i,r,1,lF);return s?Tf(this.view,s):null}_scaleToCamera(e){if(e==null)return null;const i=this.view,r=i.pointsOfInterest.centerOnContent;r.runTask();const s=r.renderLocation,n=i.pointsOfInterest.cameraOnSurface.renderLocation,a=kot(i,e,s,n);return this._centerPointAtDistanceToCamera(s,a)}_zoomToCamera(e){return this._scaleToCamera(fAe(this.view,e))}_viewpointToCamera(e){return Tf(this.view,cPe(this.view,e))}setStateCamera(e,i){return!(e==null||!this.view.state.stopActiveCameraController())&&(this._cameraSetByUser=!0,i.doNotCancelGoToOperation||this._cancelGoToOperation(),this.view.state.updateCamera(r=>{i.positionAndOrientationOnly?(r.eye=e.eye,r.center=e.center,r.up=e.up,r.fov=e.fov):r.copyFrom(e),i.applyConstraints&&us(this.view,r)}),i.applyConstraints||(this.view.state.cameraController=new JP({view:this.view,desiredCamera:e})),!0)}_prepareFrame(){const{surface:e,canvas:i,stage:r}=this.view;if(!e||!i||!r||r.destroyed||r.destroying)return;this._windowDevicePixelRatio=window.devicePixelRatio;const s=this._computeCanvasSize();if(s.width!==0&&s.height!==0&&(i.width===s.width&&i.height===s.height||(i.width=s.width,i.height=s.height),this.view.state)){const n=this.view.state.camera;n.fullWidth===s.width&&n.fullHeight===s.height&&n.pixelRatio===s.pixelRatio||(ig.copyFrom(n),ig.pixelRatio!==s.pixelRatio&&(this._paddingToArray(this.padding,s.pixelRatio,_L),ig.padding=_L),ig.fullWidth=s.width,ig.fullHeight=s.height,ig.pixelRatio=s.pixelRatio,this.view.state.camera=ig),this._updateState()}}_updateElevation(e){const i=this.view.renderCoordsHelper?.getAltitude(e.eye)??0,r=this.view.basemapTerrain?.spatialReference,s=r?a8(this.view,e.eye):0;e.relativeElevation=i-s}_updateState(){this.test.renderState!=null?this.view.state.mode=this.test.renderState:this.view.animation?this.view.state.mode=0:this.view.interacting?this.view.state.mode=1:(this.view.state.mode===0&&(this._cameraChangeTime=0),performance.now()-this._cameraChangeTime<this._idleTimeout?this.view.state.mode=1:this.view.state.mode=2),this.view.state.rasterPixelRatio=this._rasterPixelRatio}_cameraChangedHandler(e,i){e&&i&&e.almostEquals(i)||(this._cameraChangeTime=performance.now(),this._updateState())}};d([m({type:ol,dependsOn:["view.state.camera","ready"]})],ks.prototype,"camera",null),d([m({type:ol,dependsOn:["view.state.contentCamera","ready"]})],ks.prototype,"contentCamera",null),d([m({type:Qe})],ks.prototype,"center",null),d([m()],ks.prototype,"visibleArea",null),d([m({type:Bt})],ks.prototype,"extent",null),d([m({readOnly:!0})],ks.prototype,"frustum",null),d([m()],ks.prototype,"_constraintsManager",void 0),d([m({readOnly:!0})],ks.prototype,"constraintsManager",null),d([m()],ks.prototype,"_initialViewpoint",null),d([m({readOnly:!0})],ks.prototype,"hasInitialView",null),d([m({readOnly:!0,type:Boolean})],ks.prototype,"ready",void 0),d([m({type:Number})],ks.prototype,"scale",null),d([m()],ks.prototype,"padding",null),d([m({readOnly:!0})],ks.prototype,"screenCenter",null),d([m({constructOnly:!0})],ks.prototype,"view",void 0),d([m({type:Yf})],ks.prototype,"viewpoint",null),d([m({type:Number})],ks.prototype,"zoom",null),d([m({readOnly:!0})],ks.prototype,"_rasterPixelRatio",null),d([m({readOnly:!0})],ks.prototype,"_usePhysicalPixelRendering",null),d([m({readOnly:!0})],ks.prototype,"_usePhysicalPixelRenderingAny",null),d([m()],ks.prototype,"_windowDevicePixelRatio",void 0),d([m()],ks.prototype,"_devicePixelRatioOverride",void 0),ks=d([k("esri.views.3d.state.ViewStateManager")],ks);let ept=class{constructor(){this.width=0,this.height=0,this.pixelRatio=1}};const tpt=new Set(["camera","viewpoint","extent","scale","center","zoom"]),ipt=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],rpt={heading:0,tilt:0};let lF=new ol,ig=new nr;const _L=ri(),vL="pending-initial-view",_q="content-camera-reset",Mme=300,spt=100;function npt(){lF=new ol,ig=new nr}let ap=class extends Ig{constructor(){super(...arguments),this.startCamera=new nr,this.currentCamera=new nr,this._isInteractive=!1,this._interactingTimeoutHandle=void 0}get isInteractive(){return this._isInteractive}stepController(e,i){i.copyViewFrom(this.currentCamera),this.currentCamera.copyFrom(i)}onControllerStart(e){this.state=2,this.startCamera.copyFrom(e),this.currentCamera.copyFrom(e)}onControllerEnd(e){e.copyViewFrom(this.currentCamera)}commitCamera(){this._isInteractive=!0,this._interactingTimeoutHandle?.remove(),this._interactingTimeoutHandle=nM.setTimeout(()=>{this._isInteractive=!1,this._interactingTimeoutHandle=void 0},spt),this.view.state.updateCamera(e=>this.stepController(0,e))}};d([m({readOnly:!0})],ap.prototype,"isInteractive",null),d([m()],ap.prototype,"_isInteractive",void 0),ap=d([k("esri.views.3d.state.controllers.InteractiveController")],ap);let KP=class extends ap{get _intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.pivot=0,this._rotScale=0,this._lastPoint=pt(),this._tmpWorldUp=R(),this._tmpViewDir=R(),this._tmpRotCurPoint=pt(),this._tmpTransf=it(),this._tmpAxis=R(),this._tmpPivotPoint=R(),this._pivotPos=R(),this._constraintOptions=new Gu(15,2,0,this.startCamera)}initialize(){this._rotScale=this.pivot===0?3:1.5}begin(e){if(this.running){switch(this.pivot){case 1:de(this._pivotPos,this.startCamera.eye),this._constraintOptions.interactionType=3,this._constraintOptions.tiltMode=1,this._constraintOptions.selection=0;break;case 0:{const i=this._intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this._pivotPos,this.view.basemapTerrain.invisible?_2:{});i||de(this._pivotPos,this.startCamera.center),this._constrainPivotPoint(e,i),this.startCamera.center=this._pivotPos,this._constraintOptions.interactionType=2,this._constraintOptions.tiltMode=0,this._constraintOptions.selection=11;break}}Pw(this.startCamera,e,this._lastPoint)}}_constrainPivotPoint(e,i){const r=this.startCamera,s=R();Ce(s,this._pivotPos,r.eye);const n=Le(s),a=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(r.eye,Eme);let o=Math.max($M(Eme,r.viewForward,gdt)*a,ydt);i&&(o=Math.min(n,o));const l=Gs(r.width/r.pixelRatio*.5,r.height/r.pixelRatio*.5),c=x4(this.startCamera,l,this.view.renderCoordsHelper,this.view.viewingMode);let h=this.view.stage.renderView.getMinimalDepthForArea(fD(this.view),r.fullWidth/r.pixelRatio*.5,r.fullHeight/r.pixelRatio*.5,r,2.5*uq,uq),f=this.view.stage.renderView.getMinimalDepthForArea(fD(this.view),e[0],e[1],r,uq);h==null&&f==null||(h=h??f??0,f=f==null||c===1?h:f,o=h>f?f:h,o=i?Math.min(o,n):o),Ee(s,s),de(this._pivotPos,xe(this._tmpPivotPoint,r.eye,le(this._tmpPivotPoint,s,o)))}update(e){if(this.running){switch(this.pivot){case 1:this.currentCamera.center=this._applyRotation(this.currentCamera,e,this.currentCamera.center,this._pivotPos);break;case 0:this.currentCamera.center=this._pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,e,this.currentCamera.eye,this._pivotPos)}us(this.view,this.currentCamera,this._constraintOptions),this.commitCamera()}}end(){this.running&&this.finishController()}_applyRotation(e,i,r,s){this.view.renderCoordsHelper.worldUpAtPosition(s,this._tmpWorldUp),Pw(e,i,this._tmpRotCurPoint);let n=(this._lastPoint[1]-this._tmpRotCurPoint[1])*this._rotScale,a=(this._tmpRotCurPoint[0]-this._lastPoint[0])*this._rotScale;Ce(this._tmpViewDir,r,s);const o=Le(this._tmpViewDir),l=Ga(Oe(this._tmpViewDir,this._tmpWorldUp)/o);if(this.pivot===1){n*=-.5;const c=.5*Math.PI-l,h=.5*Math.PI*.99;n=c-Math.max(-h,Math.min(h,c+n))}return n=Se(n+l,no.min,no.max)-l,bt(this._tmpAxis,e.up,this._tmpViewDir),this.pivot===0&&(a=-a),Xh(this._tmpTransf,a,this._tmpWorldUp),Eu(this._tmpTransf,this._tmpTransf,n,this._tmpAxis),Mt(this._tmpViewDir,this._tmpViewDir,this._tmpTransf),e.up=Mt(vq,e.up,this._tmpTransf),xe(vq,s,this._tmpViewDir),ko(this._lastPoint,this._tmpRotCurPoint),vq}};d([m()],KP.prototype,"pivot",void 0),KP=d([k("esri.views.3d.state.controllers.RotateController")],KP);const vq=R(),Eme=R();let bq=class extends ho{constructor(e,i,r,s){super(!0),this._view=e,this.pointerActions=i,this._pivot=r,this.registerIncoming("drag",s,n=>this._handleDrag(n))}_handleDrag(e){const i=e.data;if(i.pointers.size>1||!Die(e.data,this.pointerActions))return;const r=Gs(i.center.x,i.center.y);switch(i.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._cameraController=new KP({view:this._view,pivot:this._pivot}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break;case"update":this._cameraController&&this._cameraController.update(r);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}};function apt(t){return t&&"nodeType"in t}function opt(t){return t&&typeof t.render=="function"}const Ame={component:"esri-component"};let _b=class extends Me{constructor(){super(...arguments),this.widget=null}destroy(){this.node=null,this.widget?.destroy()}get id(){return this._get("id")??this.widget?.id??this.node?.id}set id(e){this._set("id",e)}set node(e){const i=this._get("node");e!==i&&(e&&e.classList.add(Ame.component),i&&i.classList.remove(Ame.component),this._set("node",e))}castNode(e){return this.widget?.destroy(),e?typeof e=="string"||apt(e)?(this._set("widget",null),$U(e)):(opt(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}};d([m()],_b.prototype,"id",null),d([m()],_b.prototype,"node",null),d([qr("node")],_b.prototype,"castNode",null),d([m({readOnly:!0})],_b.prototype,"widget",void 0),_b=d([k("esri.views.ui.Component")],_b);const eR=_b;function lpt(t,e){return{type:fv(e),value:t,unit:e}}function A7t(t){return{value:t}}function Iu(t,e){return{type:fv(e),value:t,unit:e}}function y8(t,e){return{type:fv(e),value:t,unit:e}}function O7t(t,e){return{type:fv(e),value:t,unit:e}}function _8(t,e,i="arithmetic"){return{type:fv(e),value:t,unit:e,rotationType:i}}function P7t(t,e){const i=cpt(t,e);return t.type==="angle"?_8(i,e,t.rotationType):lpt(i,e)}function cpt(t,e){return hi(t.value,t.unit,e)}function R7t(t,e){return t==null?e:e==null||t.value>hi(e.value,e.unit,t.unit)?t:e}function D7t(t,e){return t==null?null:{...t,value:t.value*e}}function upt(t,e,i){if(e===i)return t;switch(i){case"arithmetic":case"geographic":return 90-t}}const I7t=Iu(0,"meters"),L7t=y8(0,"square-meters");_8(0,"radians");const k7t=_8(0,"degrees"),z7t=_8(0,"degrees","geographic");function gPe(t,e,i){return t.units[e][i]}function wy(t,e,i,r=2,s="abbr"){return`${dy(e,{minimumFractionDigits:r,maximumFractionDigits:r,signDisplay:e>0?"never":"exceptZero"})} ${gPe(t,i,s)}`}function v8(t,e,i,r=2,s="abbr"){return`${dy(e,{minimumFractionDigits:r,maximumFractionDigits:r,signDisplay:"exceptZero"})} ${gPe(t,i,s)}`}function F7t(t,e,i,r=2,s="abbr"){const n=GK(e,i);return wy(t,hi(e,i,n),n,r,s)}function N7t(t,e,i,r=2,s="abbr"){const n=GK(e,i);return v8(t,hi(e,i,n),n,r,s)}function V7t(t,e,i,r=2,s="abbr"){const n=HK(e,i);return wy(t,hi(e,i,n),n,r,s)}function U7t(t,e,i,r=2,s="abbr"){const n=HK(e,i);return v8(t,hi(e,i,n),n,r,s)}function B7t(t,e,i,r=2,s="abbr"){const n=WK(e,i);return wy(t,hi(e,i,n),n,r,s)}function j7t(t,e,i,r=2,s="abbr"){const n=WK(e,i);return v8(t,hi(e,i,n),n,r,s)}function q7t(t,e,i,r=2,s="abbr"){const n=ZK(e,i);return wy(t,hi(e,i,n),n,r,s)}function G7t(t,e,i,r=2,s="abbr"){const n=ZK(e,i);return v8(t,hi(e,i,n),n,r,s)}function H7t(t,e,i,r=2,s="abbr"){const n=Qxe(e,i);return wy(t,hi(e,i,n),n,r,s)}function W7t(t,e,i,r=2,s="abbr"){const n=Xxe(e,i);return wy(t,hi(e,i,n),n,r,s)}const hpt=(t,e)=>({style:"unit",unitDisplay:"narrow",unit:"degree",maximumFractionDigits:e,minimumFractionDigits:e,signDisplay:t>0?"never":"exceptZero"});function tX(t,e,i,r,s,n=nU,a=!0){let o=n.normalize(upt(hi(t,e,"degrees"),i,r),0,a);const l=hpt(o,s??2);return o=dpt(o,l),dy(o,l)}const Ome=new Map;function dpt(t,e){const i=JSON.stringify(e);let r=Ome.get(i);return r||(r=new Intl.NumberFormat("en-US",e),Ome.set(i,r)),/^[-+]?360\.?0*?$/.test(r.format(t))?0:t}const Pme=["B","kB","MB","GB","TB"];function Z7t(t,e){let i=(e=Math.round(e))===0?0:Math.floor(Math.log(e)/Math.log(1024));i=Se(i,0,Pme.length-1);const r=dy(e/1024**i,{maximumFractionDigits:2});return Cy(t.units.bytes[Pme[i]],{fileSize:r})}const ppt={handleInterceptedEvent:(t,e,i,r)=>(t.scheduleRender(),e.properties[`on${r.type}`].apply(e.properties.bind||i,[r]))},fpt={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,i)=>{e.startsWith("-")?t.style.setProperty(e,i):t.style[e]=i}},mpt=t=>({...fpt,...t}),gpt=(t,e)=>{const i=[];for(;t&&t!==e;)i.push(t),t=t.parentNode;return i},ypt=(t,e)=>t.find(e),Rme=(t,e,i=!1)=>{let r=t;return e.forEach((s,n)=>{const a=r?.children?ypt(r.children,o=>o.domNode===s):void 0;i&&!a&&n!==e.length-1||(r=a)}),r},_pt=t=>{let e;const i={...ppt,...t},r=mpt(i),s=r.performanceLogger;let n,a=!0,o=!1;const l=[],c=[],h=(y,_,w)=>{let x;r.eventHandlerInterceptor=($,A,M,P)=>function(O){let D;s("domEvent",O);const L=gpt(O.currentTarget,x.domNode),F=L.some(N=>customElements.get(N?.tagName?.toLowerCase()));if(O.eventPhase===Event.CAPTURING_PHASE||!F)L.reverse(),D=Rme(x.getLastRender(),L);else{const N=O.composedPath(),j=N.slice(N.indexOf(O.currentTarget),N.indexOf(x.domNode)).reverse();D=Rme(x.getLastRender(),j,!0)}let U;return D&&(U=i.handleInterceptedEvent(e,D,this,O)),s("domEventProcessed",O),U},i.postProcessProjectionOptions?.(r);const S=w();x=y(_,S,r),r.eventHandlerInterceptor=void 0,l.push(x),c.push(w),i.afterFirstVNodeRendered&&i.afterFirstVNodeRendered(x,S)};let f=()=>{if(n=void 0,a){a=!1,s("renderStart",void 0);for(let y=0;y<l.length;y++){const _=c[y]();s("rendered",void 0);try{l[y].update(_)}catch(w){console.error(w)}s("patched",void 0)}s("renderDone",void 0),a=!0}};return i.modifyDoRenderImplementation&&(f=i.modifyDoRenderImplementation(f,l,c)),e={renderNow:f,scheduleRender:()=>{n||o||(n=requestAnimationFrame(f))},stop:()=>{n&&(cancelAnimationFrame(n),n=void 0),o=!0},resume:()=>{o=!1,a=!0,e.scheduleRender()},append:(y,_)=>{h(M_.append,y,_)},insertBefore:(y,_)=>{h(M_.insertBefore,y,_)},merge:(y,_)=>{h(M_.merge,y,_)},replace:(y,_)=>{h(M_.replace,y,_)},detach:y=>{for(let _=0;_<c.length;_++)if(c[_]===y)return c.splice(_,1),l.splice(_,1)[0];throw new Error("renderFunction was not found")}},e};let yPe=!1;const vpt=t=>{yPe=!0,MVe(t)};let _Pe;function bpt(){yPe||vpt(Tu(Es(_Pe)))}function Jv(t){const e=[];for(const i of Object.keys(t))customElements.get(`calcite-${i}`)||e.push(t[i]?.());return e.length>0?Promise.all(e):null}_Pe="components/assets";const vPe=Symbol("widget"),bPe=Symbol("widget-test-data"),wpt=[],xpt={},K6=new WeakMap;function wPe(t,e){let i=e.children;if(i?.length)for(let s=0;s<i.length;++s)i[s]=wPe(t,i[s]);else i=wpt;const r=e.vnodeSelector;if(eV(r)){const s=e.properties||xpt,n=s.key||r,a={key:n,afterCreate:Spt,afterUpdate:Tpt,afterRemoved:xPe,parentWidget:t,widgetConstructor:r,widgetProperties:{...s,key:n,children:i}};return{vnodeSelector:r.vnodeSelector,properties:a,children:void 0,text:void 0,domNode:null}}return e}function Spt(t,e,i,{parentWidget:r,widgetConstructor:s,widgetProperties:n}){const a=new s(n);a.container=t,K6.set(t,a),a.afterCreate?.(a,t),r.addHandles(ci(()=>xPe(t))),queueMicrotask(()=>{a[bPe].projector?.renderNow()})}function Tpt(t,e,i,{widgetProperties:r}){const s=K6.get(t);s&&(s.set(r),s.afterUpdate?.(s,t))}function xPe(t){const e=K6.get(t);e&&(e.afterRemoved?.(e,t),e.destroy(),K6.delete(t))}function eV(t){return typeof t=="function"&&t[vPe]}const Dme=new Set;function $pt(t){Dme.add(t),t.finally(()=>Dme.delete(t))}function Cpt(t){return ci()}const b8=new Map;function kie(){b8.clear()}function Mpt(t){return b8.get(t)}function Ept(t,e){b8.set(t,e)}function wq(t){b8.delete(t)}function Apt(...t){const e=Mc.acquire();for(let r=0;r<t.length;r++){const s=t[r],n=typeof s;if(n==="string")e.push(s);else if(Array.isArray(s))e.push.apply(e,s);else if(n==="object")for(const a in s)s[a]&&e.push(a)}const i=e.join(" ");return Mc.release(e),i}(()=>{const t=new Map,e=new ResizeObserver(r=>{kie();for(const s of r)t.get(s.target)?.(s)}),i=(r,s,n)=>(t.set(r,s),e.observe(r,n),ci(()=>{e.unobserve(r),t.delete(r)}));return(r,s,n)=>{let a=null;return qu([K(()=>typeof r=="function"?r():r,o=>{a?.remove(),o&&(a=i(o,s,n))},At),ci(()=>a?.remove())])}})();function Opt(t){const e=t?.closest("[dir]");return e!==null&&e instanceof HTMLElement&&e.dir==="rtl"||document.dir==="rtl"}function Y7t(t){const e="data-node-ref";this[t.getAttribute(e)]=null}function Q7t(t){const e="data-node-ref";this[t.getAttribute(e)]=t}function Ppt(t){return t==="Enter"||t===" "}async function Rpt(t,e){await UBe(BD(e));const i=typeof t=="function"?t():t;i&&("setFocus"in i&&typeof i.setFocus=="function"?await i.setFocus():i instanceof HTMLElement&&i.focus())}var Ime;let Dpt=0;function SPe(t,e){const i=Object.prototype.hasOwnProperty;for(const r in e)i.call(e,r)&&i.call(t,r)&&(t[r]!=null&&e[r]!=null&&typeof t[r]=="object"&&typeof e[r]=="object"?SPe(t[r],e[r]):t[r]=e[r]);return t}const Ipt=_pt({postProcessProjectionOptions(t){const e=t.eventHandlerInterceptor,i=/capture$/i;t.eventHandlerInterceptor=(r,s,n,a)=>{const o=e?.(r,s,n,a),l=i.test(r);if(!((r=r.replace(i,"")).toLowerCase()in n)||l){const c=r[2].toLowerCase()+r.slice(3),h=_=>o?.call(n,_);n.addEventListener(c,h,l);const f=()=>n.removeEventListener(c,h,l),y=a.afterRemoved;a.afterRemoved=_=>{y?.(_),f()}}return o}},handleInterceptedEvent(t,e,i,r){const{eventPhase:s,type:n}=r,a=s===Event.CAPTURING_PHASE;let o=`on${n}${a?"capture":""}`;const l=e.properties;(l&&o in l||(o=`on${n[0].toUpperCase()}${n.slice(1)}${a?"Capture":""}`,l&&o in l))&&(kie(),t.scheduleRender(),l[o].call(l.bind||i,r))}});let xq=!1;var Sx;let Ja=(Sx=class extends cte(Uc){constructor(e,i){super(e,i),this._attached=!1,this._projector=Ipt,this._readyForTrueRender=!1,this.key=this,this.autoRenderingEnabled=!0,this._loadLocale=wwe(async()=>{if(this._messageBundleProps?.length){const l=await Promise.allSettled(this._messageBundleProps.map(async({bundlePath:c,propertyName:h})=>{if(this.destroyed)return;let f=await TTe(c);this.destroyed||(this.uiStrings&&Object.keys(this.uiStrings)&&(f=SPe(Te(f),this.uiStrings)),this[h]=f)}));if(this.destroyed)return;for(const c of l)c.status==="rejected"&&fe.getLogger(this).error("widget-intl:locale-error",this.declaredClass,c.reason)}await this.loadLocale()}),this.addHandles(Cpt()),bpt();const r="esri-widget-uid-"+u2(),s=this.render.bind(this);this._trackingTarget=new FD(()=>{this.autoRenderingEnabled&&this.scheduleRender()});const n=()=>({vnodeSelector:"div",properties:{key:`${r}-hidden`,class:"",styles:{display:"none"}},domNode:null,children:void 0,text:void 0}),a=()=>{if(!this._readyForTrueRender||this.destroyed)return null;const l=s()??n(),c=l.properties??={};if(c.key??=r,eV(l.vnodeSelector)){if(!this.visible)return n()}else this.visible?c.styles||(c.styles={}):(c.class="",c.styles={display:"none"}),c.styles.display??="";let h=0;return l.children?.forEach(f=>{eV(f.vnodeSelector)||(f.properties??={},f.properties.key??=`${this.id}--${h++}`)}),wPe(this,l)};this.render=()=>{if(xq)return a();let l=Mpt(this)??null;if(l)return l;this._trackingTarget.clear(),xq=!0;try{l=Gf(this._trackingTarget,a)}catch(c){throw fe.getLogger(this).error(c),c}finally{xq=!1}return l&&Ept(this,l),l};const o=this.beforeFirstRender();o?this._resourcesFetch=o.then(()=>{this.destroyed||(this._readyForTrueRender=!0,this._postInitialize())}):(this._resourcesFetch=Promise.resolve().then(()=>{this.destroyed||this._postInitialize()}),this._readyForTrueRender=!0),this.addResolvingPromise(this._resourcesFetch),$pt(this._resourcesFetch)}normalizeCtorArgs(e,i){const r={...e};return i&&(r.container=i),r}postInitialize(){}beforeFirstRender(){const e=this.loadDependencies();return this._messageBundleProps?.length||e?Promise.all([e,this._loadLocale()]).then(()=>{}).catch(KH):null}loadDependencies(){return null}loadLocale(){return null}destroy(){this.destroyed||(Re(this._trackingTarget),Re(this.viewModel),this._detach(this.container),this._set("container",null),this.render=()=>null,this._projector=null,wq(this))}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return $U(e)}get destroyed(){return super.destroyed}get domNode(){return this.container}set domNode(e){this.container=e}get icon(){return null}set icon(e){this._overrideIfSome("icon",e)}get id(){return this._get("id")||this.container?.id||Date.now().toString(16)+"-widget-"+Dpt++}set id(e){e&&this._set("id",e)}get label(){return this.declaredClass.split(".").pop()}set label(e){this._overrideIfSome("label",e)}get renderable(){return this._resourcesFetch}get visible(){return this._get("visible")}set visible(e){this._set("visible",e)}get[(Ime=vPe,bPe)](){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||(wq(this),this._projector.scheduleRender())}classes(...e){return Apt.apply(this,e)}renderNow(){wq(this),this._projector.renderNow()}_postInitialize(){if(this.destroyed)return;this.scheduleRender(),this._delegatedEventNames?.length&&this.addHandles(K(()=>this.viewModel,(i,r)=>{r&&this.removeHandles("delegated-events"),i&&eU(i)&&this.addHandles(this._delegatedEventNames.map(s=>aM(i,s,n=>{this.emit(s,n)})),"delegated-events")},At)),this.postInitialize();const e=async()=>{await this._loadLocale().catch(KH),this.scheduleRender()};this.addHandles([fSe(e),K(()=>this.uiStrings,e)]),this.addHandles(Zs(()=>this.container,i=>{this.destroyed||this._attach(i)},{initial:!0,once:!0}))}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){this._attached&&(this._projector.detach(this.render),this._attached=!1),e?.parentNode?.removeChild(e)}},Sx[Ime]=!0,Sx.vnodeSelector="div",Sx);d([m()],Ja.prototype,"_readyForTrueRender",void 0),d([m({value:null})],Ja.prototype,"container",null),d([qr("container")],Ja.prototype,"castContainer",null),d([m()],Ja.prototype,"icon",null),d([m()],Ja.prototype,"id",null),d([m()],Ja.prototype,"label",null),d([m()],Ja.prototype,"renderable",null),d([m()],Ja.prototype,"uiStrings",void 0),d([m()],Ja.prototype,"viewModel",void 0),d([m({value:!0})],Ja.prototype,"visible",null),d([m()],Ja.prototype,"key",void 0),d([m()],Ja.prototype,"children",void 0),d([m()],Ja.prototype,"afterCreate",void 0),d([m()],Ja.prototype,"afterUpdate",void 0),d([m()],Ja.prototype,"afterRemoved",void 0),Ja=d([k("esri.widgets.Widget")],Ja);const Pp=Ja;function Wh(t){return(e,i)=>{e.hasOwnProperty("_messageBundleProps")||(e._messageBundleProps=e._messageBundleProps?e._messageBundleProps.slice():[]),e._messageBundleProps.push({bundlePath:t,propertyName:i})}}var Lpt=function(t){return{vnodeSelector:"",properties:void 0,children:void 0,text:t.toString(),domNode:null}},TPe=function(t,e){for(var i=0,r=t.length;i<r;i++){var s=t[i];Array.isArray(s)?TPe(s,e):s!=null&&s!==!1&&(s.hasOwnProperty("vnodeSelector")||(s=Lpt(s)),e.push(s))}},kpt=function(t,e){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];if(i.length===1&&typeof i[0]=="string")return{vnodeSelector:t,properties:e||void 0,children:void 0,text:i[0],domNode:null};var s=[];return TPe(i,s),{vnodeSelector:t,properties:e||void 0,children:s,text:void 0,domNode:null}};function St(t,e,...i){return typeof t!="function"||eV(t)?kpt(t,e??null,...i):t(e,...i)}function Sq(...t){return t}const bL="esri-fov-overlay",wL={base:bL,outer:`${bL}-outer`,reset:`${bL}-reset`,text:`${bL}-text`};let rg=class extends Pp{constructor(e){super(e),this.onReset=()=>{},this._messagesCommon=null,this._messagesUnits=null,this.fov=null}render(){return St("div",{class:wL.outer},St("div",{class:wL.base},St("p",{class:wL.text},this._overlay),St("p",{class:wL.reset,onclick:this.onReset,title:this._messagesCommon.reset},this._reset)))}get _overlay(){const{fov:e,_messagesUnits:i}=this;if(!i||e==null)return"";const r=tX(Ea(e),"degrees","arithmetic","arithmetic",0),s=zpt/(2*Math.tan(e/2));return`${r} | ${wy(i,s,"millimeters",0,"abbr")} |`}get _reset(){return this._messagesUnits&&this.fov!=null?"":""}};d([m()],rg.prototype,"onReset",void 0),d([m(),Wh("esri/t9n/common")],rg.prototype,"_messagesCommon",void 0),d([m(),Wh("esri/core/t9n/Units")],rg.prototype,"_messagesUnits",void 0),d([m()],rg.prototype,"fov",void 0),d([m()],rg.prototype,"_overlay",null),d([m()],rg.prototype,"_reset",null),rg=d([k("esri.widgets.FovOverlay")],rg);const zpt=Math.sqrt(1872);let d$=class extends ap{constructor(e){super(e),this.onStop=null,this._timeOutId=void 0,this._onReset=()=>{this._startSize=this._lastDrag=null,this._setFov(Fpt),this.updateTimeout()},this._center=R(),this._viewForward=R(),this._constraints=new Gu(15,1)}begin(e){Upt(e)?this._showOverlay().fov=e.fov:(this._lastDrag=e[1],this._startSize=null,this._ensureStartSize(this.view.state.camera))}updateTimeout(){clearTimeout(this._timeOutId),this._timeOutId=setTimeout(this.onStop,1500)}update(e){if(this._lastDrag==null)return this._lastDrag=e[1],this._startSize=null,void this._ensureStartSize(this.view.state.camera);const i=-(this._lastDrag-e[1])/2;this._lastDrag=e[1],this.step(i)}step(e){if(!this.running)return void(this._startSize=this._lastDrag=null);const i=this.view.state,r=this.currentCamera.copyFrom(i.camera),s=Ea(r.fov)+e,n=Lt(Se(s,Npt,Vpt));n!==r.fov?this._setFov(n):this._showOverlay().fov=r.fov}finish(){this.running&&(this._startSize=this._lastDrag=null,this.finishController())}destroy(){this.hideOverlay()}onControllerEnd(e){super.onControllerEnd(e),this._startSize=this._lastDrag=null,this.hideOverlay()}_showOverlay(){return this._overlay||(this._overlay=new eR({id:"esri.FovOverlay",node:new rg({onReset:this._onReset})}),this.view.ui.add(this._overlay)),this._overlay.widget}hideOverlay(){this._overlay&&(this.view.ui.remove(this._overlay),this._overlay=Re(this._overlay))}_setFov(e){const i=this.view.state,r=this.currentCamera.copyFrom(i.camera),s=this._ensureStartSize(r)/Math.tan(e/2),n=xe(Tq,this._center,le(Tq,this._viewForward,-s));r.eye=n,r.fov=e,this._constraints.interactionStartCamera=i.camera,this._constraints.interactionFactor=Nh(this.currentCamera.height-i.camera.height),us(this.view,this.currentCamera,this._constraints),this.begin(r),this.commitCamera()}_ensureStartSize(e){if(this._startSize==null){de(this._viewForward,e.viewForward);const i=this.view.stage.renderView.getMinimalDepthForArea(null,e.fullWidth/e.pixelRatio*.5,e.fullHeight/e.pixelRatio*.5,e,w4),r=Ri(e.eye,this.view.pointsOfInterest.centerOnContent.renderLocation),s=i??r;xe(this._center,e.eye,le(Tq,this._viewForward,s)),this._startSize=s*Math.tan(e.fov/2)}return this._startSize}};d([m()],d$.prototype,"onStop",void 0),d$=d([k("esri.views.3d.state.controllers.FovController")],d$);const Fpt=Lt(new ol().fov),Npt=10,Vpt=150,Tq=R();function Upt(t){return!Array.isArray(t)}const Lme=12;let iX=class extends ap{constructor(){super(...arguments),this._pickPoint=R(),this._tmpP0=pt(),this._panAxisAngle=f8(),this._tmpRayDir=R(),this._tmpRayDirPick=R(),this._targetOnSphere=R(),this._navigationMode=1,this._tmpRay={origin:R(),direction:R()},this.dragBeginPoint=Gs(),this._normalizedAnchorPoint=pt(),this._constraintOptions=new Gu(7,1,0,this.startCamera),this._sphere=ms(),this._hasPickPoint=!1}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.running)return;ko(this.dragBeginPoint,e),Pw(this.startCamera,e,this._normalizedAnchorPoint);const i=or(this.view.spatialReference),r=ePe(this._intersectionHelper,this.startCamera,e,i.radius,0,this.view.basemapTerrain.invisible?_2:{});if(this._navigationMode=x4(this.startCamera,e,this.view.renderCoordsHelper,this.view.viewingMode),this._navigationMode===1)this._hasPickPoint=!!r.scenePickPoint,this._pickPoint=r.scenePickPoint??this._pickPoint,this._sphere=r.sphere;else{let s;TM(this.startCamera,e,this._tmpRay),Ee(this._tmpRay.direction,this._tmpRay.direction),r.scenePickPoint!=null&&(Ce(this._tmpRayDirPick,this.startCamera.eye,r.scenePickPoint),s=Le(this._tmpRayDirPick));const n=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(this.startCamera.eye,kme);const a=Se($M(kme,this._tmpRay.direction,ZOe)*n,q6[0],q6[1]),o=this.view.stage.renderView.getMinimalDepthForArea(null,e[0],e[1],this.view.state.camera,w4);let l=o??a;s!=null&&(l=Math.min(l,s)),this._hasPickPoint=!0,le(this._tmpRay.direction,this._tmpRay.direction,l),xe(this._pickPoint,this._tmpRay.origin,this._tmpRay.direction)}}update(e){if(this.running){if(this.currentCamera.eye=this.startCamera.eye,this.currentCamera.center=this.startCamera.center,this.currentCamera.up=this.startCamera.up,this._navigationMode===1){Ce(this._tmpRayDir,this.currentCamera.center,this.currentCamera.eye);const i=Le(this._tmpRayDir);Pw(this.currentCamera,e,this._tmpP0);const r=(this._normalizedAnchorPoint[1]-this._tmpP0[1])*Lme;let s=i*2**r;const n=this.view.state.constraints.minimumPoiDistance;if(r<0&&s<n&&(s=n),Math.abs(i-s)<Pv)return;if(this._hasPickPoint&&s<i){const a=1-(1-s/i)*(1-this._sphere[3]/Le(this.currentCamera.center));this.currentCamera.center=le(xL,this.currentCamera.center,a)}le(this._tmpRayDir,this._tmpRayDir,-s/i),this.currentCamera.eye=xe(xL,this.currentCamera.center,this._tmpRayDir),this._constraintOptions.interactionFactor=Nh(Zf(this.dragBeginPoint,e)),us(this.view,this.currentCamera,this._constraintOptions),this._hasPickPoint&&(pD(this._sphere,this.currentCamera,this.dragBeginPoint,this._targetOnSphere),Cie(this._pickPoint,this._targetOnSphere,this._panAxisAngle),Rv(this.currentCamera,Ti(this._sphere),this._panAxisAngle))}else{const i=Le(this._tmpRay.direction);Pw(this.currentCamera,e,this._tmpP0);const r=(this._normalizedAnchorPoint[1]-this._tmpP0[1])*Lme;let s=i*2**r;const n=this.view.state.constraints.minimumPoiDistance;if(r<0&&s<n&&(s=n),Math.abs(i-s)<Pv)return;le(this._tmpRayDir,this._tmpRay.direction,1-s/i),this.currentCamera.eye=xe(xL,this.currentCamera.eye,this._tmpRayDir),this.currentCamera.center=xe(xL,this.currentCamera.center,this._tmpRayDir),Ee(this._tmpRayDir,this._tmpRayDir),this._constraintOptions.interactionDirection=this._tmpRayDir,us(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}SM(this.view,this.currentCamera),this.commitCamera()}}finish(){this.running&&this.finishController()}};iX=d([k("esri.views.3d.state.controllers.ZoomControllerGlobal")],iX);const xL=R(),kme=R();let rX=class extends ap{constructor(){super(...arguments),this._tmpP=R(),this._tmpDir=R(),this._tmpN=R(),this._tmpP0=pt(),this._tmpPoi=R(),this._tmpRayDir=R(),this.dragBeginPoint=Gs(),this._normalizedAnchorPoint=pt(),this._constraintOptions=new Gu(15,1,0,this.startCamera,R()),this._plane=Oi()}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.running)return;ko(this.dragBeginPoint,e),Pw(this.startCamera,e,this._normalizedAnchorPoint);const i=this._intersectionHelper.intersectScreenFreePointFallback(e,this._tmpP,this.view.basemapTerrain.invisible?_2:{});Ce(this._tmpDir,this._tmpP,this.startCamera.eye);const r=Le(this._tmpDir);Ee(this._tmpDir,this._tmpDir);const s=Math.abs(this.view.camera.position.z),n=Se($M(Bpt,this._tmpDir,ZOe)*s,q6[0],q6[1]),a=this.view.stage.renderView.getMinimalDepthForArea(fD(this.view),e[0],e[1],this.view.state.camera,w4);let o=a??n;i&&(o=Math.min(o,r)),le(this._tmpDir,this._tmpDir,o),xe(this._tmpP,this.startCamera.eye,this._tmpDir),Ce(this._tmpN,this.startCamera.eye,this.startCamera.center),Ee(this._tmpN,this._tmpN),this._tmpN[1]<0&&Gh(this._tmpN,this._tmpN),Qf(this._tmpP,this._tmpN,this._plane)}update(e){if(!this.running)return;_dt(this._plane,this.currentCamera,this.dragBeginPoint,this._tmpPoi)||de(this._tmpPoi,this.currentCamera.center),Pw(this.currentCamera,e,this._tmpP0);let i=4*(this._tmpP0[1]-this._normalizedAnchorPoint[1]);ko(this._normalizedAnchorPoint,this._tmpP0),Ce(this._tmpRayDir,this._tmpPoi,this.currentCamera.eye);const r=Le(this._tmpRayDir);let s=r*(1-i);this._constraintOptions.interactionDirection&&(de(this._constraintOptions.interactionDirection,this._tmpRayDir),le(this._constraintOptions.interactionDirection,this._constraintOptions.interactionDirection,Math.sign(i)/r));const n=this.view.state.constraints.minimumPoiDistance;i>=0&&s<n&&(s=n,i=-(s-r)/r),Math.abs(r-s)<Pv||(le(this._tmpRayDir,this._tmpRayDir,i),this.currentCamera.eye=xe(E1,this.currentCamera.eye,this._tmpRayDir),Wi(E1,this.currentCamera.center,this._tmpPoi,i),this._tmpPoi[2]>this.startCamera.center[2]?E1[2]=Math.max(this.startCamera.center[2],E1[2]):E1[2]=Math.min(this.startCamera.center[2],E1[2]),this.currentCamera.center=E1,this._constraintOptions.interactionFactor=Nh(Zf(this.dragBeginPoint,e)),us(this.view,this.currentCamera,this._constraintOptions),this.commitCamera())}finish(){this.running&&this.finishController()}};rX=d([k("esri.views.3d.state.controllers.ZoomControllerLocal")],rX);const E1=R(),Bpt=Ge(0,0,1);let jpt=class extends ho{constructor(e,i,r){super(!0),this._view=e,this.pointerActions=i,this._fovModifier=r,this.registerIncoming("drag",[r],s=>this._handleZoom(s)),this.registerIncoming("drag",s=>this._handleZoom(s))}_handleZoom(e){const i=e.data;if(i.pointers.size>1||!Die(e.data,this.pointerActions))return;const r=Gs(i.center.x,i.center.y);switch(i.action){case"start":{this._cameraController?.finish();const s=this._view,n=e.modifiers.has(this._fovModifier);this._cameraController=n?new d$({view:s,onStop:()=>this._stopController()}):s.state.isGlobal?new iX({view:s}):new rX({view:s}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break}case"update":this._cameraController?.update(r);break;case"end":this._cameraController instanceof d$?this._cameraController.updateTimeout():this._stopController()}e.stopPropagation()}_stopController(){this._cameraController?.finish(),this._cameraController=null}};function wd(t){let e=t*t;return t<0&&(e*=-1),e}function zme(t,e,i){const r=i,s=t.state,n=t.device,a=e.tiltDirection==="forward-down"?1:-1,o=1;return n.deviceType==="standard"?(r.translation[0]=wd(s.axes[0]),r.translation[1]=wd(s.axes[1]),r.translation[2]=wd(s.buttons[7])-wd(s.buttons[6]),r.heading=wd(s.axes[2]),r.tilt=wd(s.axes[3])):n.deviceType==="spacemouse"&&(r.translation[0]=1.2*wd(s.axes[0]),r.translation[1]=1.2*wd(s.axes[1]),r.translation[2]=2*-wd(s.axes[2]),r.heading=1.2*wd(s.axes[5]),r.tilt=1.2*wd(s.axes[3])),r.tilt*=a,le(r.translation,r.translation,o),r}function Fme(t,e){const i=e;return i.translation[0]=t[1]-t[0],i.translation[1]=t[3]-t[2],i.translation[2]=t[4]-t[5],i.heading=t[7]-t[6],i.tilt=t[8]-t[9],i.zoom=t[10]-t[11],i}function $q(t){return t.translation[0]===0&&t.translation[1]===0&&t.translation[2]===0&&t.heading===0&&t.tilt===0&&t.zoom===0}let cw=class extends ap{constructor(e){super(e),this._filteredSurfaceElevation=0,this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this._keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0],this._tmpCamera=new nr,this._headingStart=0,this._constraintOptions=new Gu(15,0,0,new nr,null,1)}handleEventGamepad(e){const i=zme(e,this.view.navigation.gamepad,this._transformation);(e.action==="end"||$q(i))&&this.finishController()}activateDirection(e){this._keysButtonState[e]=1,Fme(this._keysButtonState,this._transformation)}directionActive(e){return this._keysButtonState[e]===1}countActiveDirections(){return this._keysButtonState.reduce((e,i)=>i>0?e+1:e,0)}deactivateDirection(e){this._keysButtonState[e]=0;const i=Fme(this._keysButtonState,this._transformation);$q(i)&&this.finishController()}onControllerStart(e){this._filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z,this._headingStart=this.view.camera.heading,super.onControllerStart(e)}_updateFilteredSurfaceElevation(e){const i=this.view.pointsOfInterest.cameraOnSurface.location.z,r=1;this._filteredSurfaceElevation+=r*(i-this._filteredSurfaceElevation)*e}stepController(e,i){this._updateStartHeading(),this._updateFilteredSurfaceElevation(e),this.currentCamera.copyViewFrom(i),this._updateCameraCenter(),this._constraintOptions.interactionStartCamera?.copyFrom(this.currentCamera),this._calculateControlTransformation(e,this.currentCamera,A1),this._applyDisabledMovementTypes(A1),this._applyPan(A1.pan),this._applyRotate(A1.rotate),this._applyZoom(A1.zoom),this._applyAscend(A1.ascend),this._constraintOptions.interactionType=0,this._constraintOptions.selection=8,us(this.view,this.currentCamera,this._constraintOptions),super.stepController(e,i)}_updateStartHeading(){this._transformation.heading!==0&&(this._headingStart=this.view.camera.heading)}_applyRotate(e){if(!e.enabled)return;const i=this.currentCamera;Ce(fl,i.center,i.eye),Mt(fl,fl,e.matrix),i.center=xe(fl,fl,i.eye),i.up=Mt(fl,i.up,e.matrix),this._constraintOptions.interactionType=3,this._constraintOptions.selection=7,us(this.view,i,this._constraintOptions)}_applyPan(e,i=this.currentCamera){e.enabled&&(i.eye=Mt(fl,i.eye,e.matrix),i.center=Mt(fl,i.center,e.matrix),this.view.state.isGlobal&&(i.up=Mt(fl,i.up,e.matrix)),this._constraintOptions.interactionType=4,this._constraintOptions.selection=15,us(this.view,i,this._constraintOptions))}_applyZoom(e){if(!e)return;const i=this.currentCamera.viewForward;this.currentCamera.eye=xe(fl,this.currentCamera.eye,le(Ze.get(),i,e)),de(cA,i),Gh(cA,cA),this._constraintOptions.interactionDirection=cA,this._constraintOptions.interactionType=1,this._constraintOptions.selection=7,us(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_applyAscend(e){if(!e)return;const i=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,Ze.get());if(this._constraintOptions.interactionDirection=de(cA,i),this.view.state.isGlobal){const r=Le(this.currentCamera.eye),s=(r+e)/r;this.currentCamera.eye=le(fl,this.currentCamera.eye,s),this.currentCamera.center=le(fl,this.currentCamera.center,s)}else{const r=le(Ze.get(),i,e);this.currentCamera.eye=xe(fl,this.currentCamera.eye,r),this.currentCamera.center=xe(fl,this.currentCamera.center,r)}this._updateCameraCenter(),this._constraintOptions.interactionType=5,this._constraintOptions.selection=8,us(this.view,this.currentCamera,this._constraintOptions)&&this._updateCameraCenter(),this._constraintOptions.selection=7,us(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_calculateControlTransformation(e,i,r){Qpt(r);const s=this._computeVelocities(e);this.view.state.isLocal?this._calculateControlTransformationLocal(s,i,r):this._calculateControlTransformationGlobal(s,i,r)}_updateCameraCenter(){const e=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,i=this.view.renderCoordsHelper,r=this.currentCamera.ray;this.currentCamera.center=i.intersectManifoldClosestSilhouette(r,e,fl)}_calculateControlTransformationLocal(e,i,r){const{viewRight:s,viewForward:n}=i,a=this._transformation,o=this.view.navigation.gamepad,l=ve(Ze.get(),n[0],n[1],0);Ee(l,l);const c=a.translation[0]*e.pan;if(c!==0){const x=le(Ze.get(),s,c);Qh(r.pan.matrix,r.pan.matrix,x),r.pan.enabled=!0}switch(o.mode){case"pan":{const x=-a.translation[1]*e.pan;if(x!==0){const S=le(Ze.get(),l,x);Qh(r.pan.matrix,r.pan.matrix,S),r.pan.enabled=!0}r.zoom=a.zoom*e.zoom;break}case"zoom":r.zoom=(-a.translation[1]+a.zoom)*e.zoom;break;default:o.mode}const h=a.translation[2]*e.ascend;r.ascend=h;const f=-a.heading*e.rotate;f!==0&&(Eu(r.rotate.matrix,r.rotate.matrix,f,this.view.renderCoordsHelper.worldUpAtPosition(i.eye,Ze.get())),r.rotate.enabled=!0);const y=a.tilt*e.rotate,_=vy(this.view.renderCoordsHelper,i.center,i.eye),w=Se(_+y,no.min,no.max)-_;w&&(Eu(r.rotate.matrix,r.rotate.matrix,w,s),r.rotate.enabled=!0)}_calculateControlTransformationGlobal(e,i,r){const{eye:s,viewRight:n}=i,a=this._transformation,o=this.view.navigation.gamepad,l=bt(Ze.get(),n,s);Ee(l,l),Gh(l,l),Tdt(this.startCamera,i,a,e,this.view.camera.heading,this._headingStart,this.view.camera.tilt,r,o),this._tmpCamera.copyFrom(this.currentCamera),this._applyPan(A1.pan,this._tmpCamera);const c=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,h=a.translation[2]*e.ascend;r.ascend=h;const f=-a.heading*e.rotate;f!==0&&(Eu(r.rotate.matrix,r.rotate.matrix,f,this._tmpCamera.eye),r.rotate.enabled=!0);const y=a.tilt*e.rotate,_=this._clampTiltDeltaGlobalToValidRange(y,i.ray,c);_!==0&&(Eu(r.rotate.matrix,r.rotate.matrix,_,this._tmpCamera.viewRight),r.rotate.enabled=!0),r.zoom+=a.zoom*e.zoom}_clampTiltDeltaGlobalToValidRange(e,i,r){const s=or(this.view.spatialReference),n=sF(no.min,i.origin,r,s);let a=0,o=0;const l=Ze.get();if(this.view.renderCoordsHelper.intersectManifold(i,r,l)){const c=vy(this.view.renderCoordsHelper,l,i.origin);a=sF(c,i.origin,r,s),o=sF(no.max,i.origin,r,s)}else{vM(l2(GU,r+s.radius),i,l);const c=Math.PI+Gee(i.direction,l);a=fme(c,i.origin,r,s),o=fme(no.max,i.origin,r,s)}return Se(a+e,n,o)-a}_getPointAbsoluteSurfaceElevation(e,i,r){const{renderCoordsHelper:s}=this.view,n=s.getAltitude(e),a=i+Math.abs(n-i);return s.setAltitude(r,a,e),a}_clampedDistanceToSurface(e,i){const{renderCoordsHelper:r}=this.view,{camera:s}=this.view.state,{direction:n}=Pot(this.view,i,0,$Pe,Ypt),a=r.intersectManifoldClosestSilhouette(Sp(i,n),e,Ze.get()),o=Ri(i,a),l=r.intersectManifoldClosestSilhouette(Sp(i,Hv(Ze.get(),i,s.center)),e,Ze.get()),c=Ri(i,l);return Math.min(o,c)}_computeHeadingRotateRadius(e){const{renderCoordsHelper:i,state:r}=this.view,{camera:s,isGlobal:n}=r,a=i.intersectManifoldClosestSilhouette(s.ray,this._filteredSurfaceElevation,Ze.get());if(n){const o=Ce(Ze.get(),e,a),l=Le(o);le(o,o,1/l);const c=Ee(Ze.get(),e),h=Ga(Oe(c,o));return l*Math.sin(Math.min(Gpt,h))}{const o=de(Ze.get(),e);return i.setAltitude(o,this._filteredSurfaceElevation),Ri(a,o)}}_minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:Hpt}_computeVelocities(e){const i=this._filteredSurfaceElevation,r=i+or(this.view.spatialReference).radius,{camera:s,isGlobal:n}=this.view.state,a=Ze.get(),o=this._getPointAbsoluteSurfaceElevation(s.eye,i,a),l=this._clampedDistanceToSurface(i,a),c=s.width/2,h=Nme*s.width,f=Nme*s.width,y=l*Math.tan(.5*s.fovX)/c,_=y/r,w=y/this._computeHeadingRotateRadius(a),x=o-i;return{pan:(n?_:y)*h*e,ascend:Math.max(this._minimumAscendVelocity()*e,2**(h*e/c)*x-x),zoom:2**(h*e/c)*l-l,rotate:Se(w*f,Wpt,Zpt)*e}}_applyDisabledMovementTypes(e){this.disableMovements==null||this.disableMovements.mode!==void 0&&this.view.state.viewingMode!==this.disableMovements.mode||(e.zoom=this.disableMovements.zoom?0:e.zoom,e.ascend=this.disableMovements.ascend?0:e.ascend,e.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&xp(e.pan.matrix),e.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&xp(e.rotate.matrix))}static activatesFor(e,i){const r=zme(i,e.navigation.gamepad,qpt);return!(i.action==="end"||$q(r))}};d([m({constructOnly:!0})],cw.prototype,"gamepadDevice",void 0),d([m({constructOnly:!0})],cw.prototype,"disableMovements",void 0),cw=d([k("esri.views.3d.state.controllers.GamepadKeyboardController")],cw);const qpt={translation:[0,0,0],heading:0,tilt:0,zoom:0},$Pe=80,Gpt=Lt($Pe),Nme=.75,Hpt=5,Wpt=Lt(30),Zpt=Lt(80),A1={zoom:0,ascend:0,pan:{enabled:!1,matrix:it()},rotate:{enabled:!1,matrix:it()}},fl=R(),cA=R(),Ypt=Wte();function Qpt(t){t.zoom=0,t.ascend=0,t.pan.enabled=!1,xp(t.pan.matrix),t.rotate.enabled=!1,xp(t.rotate.matrix)}let Xpt=class extends ho{constructor(e){super(!0),this._view=e,this._watchHandles=new Fv,this._handle=this.registerIncoming("gamepad",i=>this._handleEventGamepad(i)),this._handle.pause()}onInstall(e){super.onInstall(e),this._watchHandles.add([K(()=>this._view.navigation.gamepad.enabled,i=>{i?this._handle.resume():(this._handle.pause(),this._cameraControllerGamepad&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null))},Wt),K(()=>this._view.navigation.gamepad.device,i=>{this._cameraControllerGamepad&&i&&this._cameraControllerGamepad.gamepadDevice!==i&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null)})])}onUninstall(){this._watchHandles.removeAll(),super.onUninstall()}_handleEventGamepad(e){const i=this._view.navigation.gamepad.device;if(i&&e.data.device!==i)return;const r=this._cameraControllerGamepad?.running;if(r||cw.activatesFor(this._view,e.data)){if(!r){const s=new cw({view:this._view,gamepadDevice:e.data.device});this._view.state.switchCameraController(s),s.state!==1&&(this._cameraControllerGamepad=s)}this._cameraControllerGamepad&&this._cameraControllerGamepad.running&&this._cameraControllerGamepad.gamepadDevice===e.data.device&&this._cameraControllerGamepad.handleEventGamepad(e.data)}}};function Jpt(t){const e=()=>t(document.visibilityState==="visible");return document.addEventListener("visibilitychange",e),ci(()=>document.removeEventListener("visibilitychange",e))}let Kpt=class extends ho{constructor(e,i){super(!0),this._view=e,this._keyToDirection=new Map,this._keyToAction=new Map,this._disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:2},this._stickyKeyTimeoutHandle=void 0,this._stickyKeyDuration=200,this._addKeysMapping(i),this.registerIncoming("key-down",null,r=>this._handleKeyDown(r)),this.registerIncoming("key-up",null,r=>this._handleKeyUp(r)),this.registerIncoming("blur",null,()=>this._handleStop()),this._visibilityHandle=Jpt(r=>r?null:this._handleStop())}onUninstall(){this._visibilityHandle?.remove(),this._handleStop()}setStickyKeyDuration(e){this._stickyKeyDuration=e}_addKeysMapping(e){this._addKeyMapping(e.pan.left,0),this._addKeyMapping(e.pan.right,1),this._addKeyMapping(e.pan.forward,2),this._addKeyMapping(e.pan.backward,3),this._addKeyMapping(e.pan.up,4),this._addKeyMapping(e.pan.down,5),this._addKeyMapping(e.lookAround.headingLeft,6),this._addKeyMapping(e.lookAround.headingRight,7),this._addKeyMapping(e.lookAround.tiltUp,8),this._addKeyMapping(e.lookAround.tiltDown,9),this._addKeyMapping(e.zoom.zoomIn,10),this._addKeyMapping(e.zoom.zoomOut,11),this._addKeyAction(e.reset.heading,()=>this._resetHeading()),this._addKeyAction(e.reset.tilt,()=>this._resetTilt())}_addKeyMapping(e,i){for(const r of this._eachKey(e))this._keyToDirection.set(r,i)}*_eachKey(e){typeof e=="string"?yield e:yield*e}_addKeyAction(e,i){for(const r of this._eachKey(e))this._keyToAction.set(r,i)}_handleKeyDown(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const i=this._keyToAction.get(e.data.key);if(i!=null)return e.stopPropagation(),void i();const r=this._keyToDirection.get(e.data.key);if(r!=null&&(this._cameraControllerKeyboard&&this._cameraControllerKeyboard.running||(this._cameraControllerKeyboard=new cw({view:this._view,disableMovements:this._disableMovements}),this._view.state.switchCameraController(this._cameraControllerKeyboard)),this._cameraControllerKeyboard.running)){if(e.stopPropagation(),this._cameraControllerKeyboard.directionActive(r)||(this._cameraControllerKeyboard.activateDirection(r),this._cameraControllerKeyboard.countActiveDirections()>1||!this._isPanning(r)))return;this._stickyKeyDuration>0&&(this._stickyKeyTimeoutHandle=setTimeout(()=>{this._stickyKeyTimeoutHandle=void 0,this._stickyDirection!=null&&this._stickyDirection!==void 0&&(this._cameraControllerKeyboard?.deactivateDirection(this._stickyDirection),this._stickyDirection=void 0)},this._stickyKeyDuration))}}_handleStop(){this._cameraControllerKeyboard?.running&&(this._cameraControllerKeyboard.finishController(),this._cameraControllerKeyboard=null)}_handleKeyUp(e){if(e.data.native.ctrlKey||e.data.native.metaKey||!this._cameraControllerKeyboard?.running)return;const i=this._keyToDirection.get(e.data.key);if(i==null)return;e.stopPropagation();const r=this._stickyKeyTimeoutHandle===void 0;this._stickyKeyTimeoutHandle===void 0||this._cameraControllerKeyboard?.countActiveDirections()!==1?(this._cameraControllerKeyboard?.deactivateDirection(i),r&&(this._stickyDirection=void 0)):this._stickyDirection=i}_isPanning(e){return e<=3}_resetHeading(){this._view.goTo({heading:0}).catch(()=>{})}_resetTilt(){this._view.goTo({tilt:0}).catch(()=>{})}},eft=class extends ho{constructor(e,i){super(!0),this._view=e,this.registerIncoming("mouse-wheel",[i],r=>this._handleFov(r)),this.registerIncoming("mouse-wheel",r=>this._handleZoom(r))}_handleZoom(e){if(!this._mouseWheelZoomEnabled)return;const i=e.data;this._zoomController?.running||(this._stopFovController(),this._zoomController=this._view.state.isGlobal?new Y6({view:this._view,mode:"interaction"}):new Q6({view:this._view,mode:"interaction"}),this._view.state.switchCameraController(this._zoomController)),this._zoomController.step(-i.deltaY/60,Gs(i.x,i.y)),e.preventDefault(),e.stopPropagation()}_handleFov(e){this._mouseWheelZoomEnabled&&(this._fovController?.running||(this._zoomController?.finish(),this._fovController?.hideOverlay(),this._fovController=new d$({view:this._view,onStop:()=>this._stopFovController()}),this._view.state.switchCameraController(this._fovController),this._fovController.state!==1)?(this._fovController.updateTimeout(),this._fovController.step(e.data.deltaY/20),e.preventDefault(),e.stopPropagation()):this._stopFovController())}get _mouseWheelZoomEnabled(){return this._view.navigation.actionMap.mouseWheel==="zoom"}_stopFovController(){this._fovController?.finish(),this._fovController=null}},tV=class{constructor(e){this._gain=e}reset(e){this._value=e}set gain(e){this._gain=e}get value(){return this._value===void 0?0:this._value}update(e){this._value===void 0?this._value=e:this._value=this._gain*e+(1-this._gain)*this._value}},Xx=class extends hD{constructor(){super(...arguments),this._beginCamera=new nr,this._elapsedTime=0,this.constraintOptions=new Gu(15,4,0,this._beginCamera)}initialize(){this.constraintOptions.interactionType=this.interactionType,this.viewAnimation=new kC}onControllerStart(e){this._beginCamera.copyFrom(e),super.onControllerStart(e)}stepController(e,i){i.copyViewFrom(this._beginCamera),this._elapsedTime=this._elapsedTime+e,this.momentumStep(this._elapsedTime,i),us(this.view,i,this.constraintOptions),this.momentum.isFinished(this._elapsedTime)&&this.finishController()}};Xx=d([k("esri.views.3d.state.controllers.momentum.MomentumController")],Xx);let tR=class extends Xx{constructor(e){super(e),this.interactionType=4,this._tmpPan=R()}momentumStep(e,i){const r=this.momentum.value(e);le(this._tmpPan,this.momentum.direction,r),i.eye=Ce(Vme,i.eye,this._tmpPan),i.center=Ce(Vme,i.center,this._tmpPan),this.constraintOptions.interactionDirection=this._tmpPan}};d([m({constructOnly:!0})],tR.prototype,"momentum",void 0),tR=d([k("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],tR);const Vme=R(),tft=R(),SL=R();let cF=class extends Xx{constructor(e){super(e),this.interactionType=4}momentumStep(e,i){const r=this.momentum.value1(e),s=this.momentum.value2(e);de(SL,i.eye),Ee(SL,SL),bt(this.momentum.axis2,SL,this.momentum.axis1),sPe(i,tft,this.momentum.axis1,r,this.momentum.axis2,s)}};d([m({constructOnly:!0})],cF.prototype,"momentum",void 0),cF=d([k("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],cF);let Ub=class extends Xx{constructor(e){super(e),this.interactionType=2}momentumStep(e,i){const r=this.momentum.value(e);Rv(i,this.center,dD(this.axis,r))}set center(e){this._set("center",cr(e))}set axis(e){this._set("axis",cr(e))}};d([m({constructOnly:!0})],Ub.prototype,"center",null),d([m({constructOnly:!0})],Ub.prototype,"axis",null),d([m({constructOnly:!0})],Ub.prototype,"momentum",void 0),Ub=d([k("esri.views.3d.state.controllers.momentum.RotationMomentumController")],Ub);let S3=class extends Xx{constructor(e){super(e),this.interactionType=1,this.constraintOptions.interactionDirection=R()}momentumStep(e,i){const{interactionDirection:r}=this.constraintOptions;if(!r)return;de(r,i.eye);const s=this.momentum.valueDelta(0,e);Oie(i,this.zoomCenter,s,this.view.state.constraints.minimumPoiDistance),Hv(r,i.eye,r)}set zoomCenter(e){this._set("zoomCenter",cr(e))}};d([m({constructOnly:!0})],S3.prototype,"momentum",void 0),d([m({constructOnly:!0})],S3.prototype,"zoomCenter",null),S3=d([k("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],S3);let vb=class extends Xx{constructor(e){super(e),this.radius=0,this.interactionType=1,this._tmpSceneCenter=R(),this._tmpZoomAxisAngle=f8(),this._sphere=ms()}initialize(){this._sphere[3]=this.radius}momentumStep(e,i){const r=this.momentum.valueDelta(0,e);JOe(this._sphere,i,r),this.constraintOptions.interactionType=1,us(this.view,i,this.constraintOptions),pD(this._sphere,i,this.screenCenter,this._tmpSceneCenter),Cie(this.sceneCenter,this._tmpSceneCenter,this._tmpZoomAxisAngle),Rv(i,Ti(this._sphere),this._tmpZoomAxisAngle),this.constraintOptions.interactionType=4}set screenCenter(e){this._set("screenCenter",Gs(e[0],e[1]))}set sceneCenter(e){this._set("sceneCenter",cr(e))}};d([m({constructOnly:!0})],vb.prototype,"momentum",void 0),d([m({constructOnly:!0})],vb.prototype,"radius",void 0),d([m({constructOnly:!0})],vb.prototype,"screenCenter",null),d([m({constructOnly:!0})],vb.prototype,"sceneCenter",null),vb=d([k("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],vb);let Yd=class{constructor(e){this._gain=e,this.lastValue=void 0,this.filteredDelta=void 0}update(e){if(this.hasLastValue()){const i=this.computeDelta(e);this._updateDelta(i)}this.lastValue=e}reset(){this.lastValue=void 0,this.filteredDelta=void 0}hasLastValue(){return this.lastValue!==void 0}hasFilteredDelta(){return this.filteredDelta!==void 0}computeDelta(e){return this.lastValue===void 0?NaN:e-this.lastValue}_updateDelta(e){this.filteredDelta!==void 0?this.filteredDelta=(1-this._gain)*this.filteredDelta+this._gain*e:this.filteredDelta=e}},w8=class{constructor(e,i,r){this._initialVelocity=e,this._stopVelocity=i,this._friction=r,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(e){return e>this.duration}get friction(){return this._friction}value(e){return this.valueFromInitialVelocity(this._initialVelocity,e)}valueDelta(e,i){const r=this.value(e);return this.value(e+i)-r}valueFromInitialVelocity(e,i){i=Math.min(i,this.duration);const r=1-this.friction;return e*(r**i-1)/Math.log(r)}},ift=class extends w8{constructor(e,i,r,s,n){super(e,i,r),this._sceneVelocity=s,this.direction=n}value(e){return super.valueFromInitialVelocity(this._sceneVelocity,e)}},CPe=class{constructor(e=300,i=12,r=.84){this._minimumInitialVelocity=e,this._stopVelocity=i,this._friction=r,this.enabled=!0,this._time=new Yd(.6),this._screen=[new Yd(.4),new Yd(.4)],this._scene=[new Yd(.6),new Yd(.6),new Yd(.6)],this._tmpDirection=R()}add(e,i,r){if(this.enabled){if(this._time.hasLastValue()&&this._time.computeDelta(r)<.015)return;this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._scene[0].update(i[0]),this._scene[1].update(i[1]),this._scene[2].update(i[2]),this._time.update(r)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._scene[0].reset(),this._scene[1].reset(),this._scene[2].reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,i=this._screen[1].filteredDelta,r=e==null||i==null?0:Math.sqrt(e*e+i*i),s=this._time.filteredDelta,n=s==null||r==null?0:r/s;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(e,i,r){ve(this._tmpDirection,this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);const s=Le(this._tmpDirection);s>0&&le(this._tmpDirection,this._tmpDirection,1/s);const n=this._time.filteredDelta;return new ift(e,i,r,n==null?0:s/n,this._tmpDirection)}},Ume=class{constructor(e){this._gain=e}update(e){this.filteredValue!==void 0?this.filteredValue=(1-this._gain)*this.filteredValue+this._gain*e:this.filteredValue=e}reset(){this.filteredValue=void 0}get hasFilteredValue(){return this.filteredValue!==void 0}};const Bme=1e-5;let rft=class extends w8{constructor(e,i,r,s,n,a=0,o){super(e,i,r),this._angularVelocity1=s,this.axis1=n,this.angularVelocity2=a,this.axis2=o}value1(e){return super.valueFromInitialVelocity(this._angularVelocity1,e)}value2(e){return super.valueFromInitialVelocity(this.angularVelocity2,e)}},sft=class{constructor(e=300,i=12,r=.84){this._minimumInitialVelocity=e,this._stopVelocity=i,this._friction=r,this.enabled=!0,this._tmpAxis1=R(),this._tmpAxis2=R(),this._tmpAngles=pt(),this._time=new Yd(.3),this._screen=[new Yd(.4),new Yd(.4)],this._angle1=new Ume(.6),this._angle2=new Ume(.6),this._axis1=R(),this._axis2=R(),this._lastScene=R()}addMomentumDirectRotation(e,i,r,s,n,a){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(r)<.01)return;let o=iPe(this._lastScene,i,this._tmpAxis2,s,n,a);this._angle2.update(0),On(this._tmpAxis2)<Bme?o=0:Ee(this._axis1,this._tmpAxis2),this._angle1.update(o),de(this._lastScene,i)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(r)}}addMomentumPreserveHeading(e,i,r,s,n,a,o){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(r)<.01)return;rPe(this._lastScene,i,this._tmpAxis2,this._tmpAxis1,this._tmpAngles,s,n,a,o,!1),On(this._tmpAxis2)<Bme?(this._angle1.update(0),this._angle2.update(0)):(this._angle1.update(this._tmpAngles[1]),this._angle2.update(this._tmpAngles[0]),Ee(this._axis1,this._tmpAxis1),Ee(this._axis2,this._tmpAxis2)),de(this._lastScene,i)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(r)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._angle1.reset(),this._angle2.reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,i=this._screen[1].filteredDelta,r=e==null||i==null?null:Math.sqrt(e*e+i*i),s=this._time.filteredDelta,n=r==null||s==null?0:r/s;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(e,i,r){const s=this._time.filteredDelta,n=this._angle1.filteredValue,a=this._angle2.filteredValue,o=s==null||a==null?0:a/s;return new rft(e,i,r,s==null||n==null?0:n/s,this._axis1,o,this._axis2)}},MPe=class{constructor(e=2.5,i=.01,r=.95,s=12){this._minimumInitialVelocity=e,this._stopVelocity=i,this._friction=r,this._maxVelocity=s,this.enabled=!0,this.value=new Yd(.8),this.time=new Yd(.3)}add(e,i){if(this.enabled&&i!=null){if(this.time.hasLastValue()){if(this.time.computeDelta(i)<.01)return;if(this.value.hasFilteredDelta()){const r=this.value.computeDelta(e);this.value.filteredDelta*r<0&&this.value.reset()}}this.time.update(i),this.value.update(e)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let e=this.value.filteredDelta/this.time.filteredDelta;return e=Se(e,-this._maxVelocity,this._maxVelocity),Math.abs(e)<this._minimumInitialVelocity?null:this.createMomentum(e,this._stopVelocity,this._friction)}createMomentum(e,i,r){return new w8(e,i,r)}},EPe=class extends MPe{constructor(e=3,i=.01,r=.95,s=12){super(e,i,r,s)}add(e,i){const r=this.value.lastValue;if(r!=null){let s=e-r;for(;s>Math.PI;)s-=2*Math.PI;for(;s<-Math.PI;)s+=2*Math.PI;e=r+s}super.add(e,i)}},nft=class extends w8{constructor(e,i,r){super(e,i,r)}value(e){const i=super.value(e);return Math.exp(i)}valueDelta(e,i){const r=super.value(e),s=super.value(e+i)-r;return Math.exp(s)}},APe=class extends MPe{constructor(e=2.5,i=.01,r=.95,s=12){super(e,i,r,s)}add(e,i){super.add(Math.log(e),i)}createMomentum(e,i,r){return new nft(e,i,r)}},sX=class extends ap{constructor(){super(...arguments),this._smoothRotation=new tV(.05),this._rotationAxis=R(),this._beginAngle=0,this._beginHeading=0,this._panningPlane=Oi(),this._beginRadius=0,this._smoothScaling=new tV(.05),this._zoomCenterScreen=Gs(),this._zoomMomentumEstimator=new APe,this._rotationMomentumEstimator=new EPe,this._panSphericalMomentumEstimator=new sft,this._panPlanarMomentumEstimator=new CPe,this._adjustedSphere=ms(),this._tmp3d=R(),this._tmpScreenPointArray=Gs(),this._beginScreenPoint=Gs(),this._beginScenePoint=R(),this._screenPickPoint=Gs(),this._scenePickPoint=R(),this._navigationMode=1,this._sphere=ms(),this._pointerCount=0,this._tmpInteractionDirection=R(),this._beginCamera=new nr,this._constraintOptions=new Gu(15,0,0,this._beginCamera)}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.running)return;this._zoomMomentumEstimator.enabled=this._rotationMomentumEstimator.enabled=this._panPlanarMomentumEstimator.enabled=this._panSphericalMomentumEstimator.enabled=this.view.navigation.momentumEnabled,this._beginHeading=-hv.normalize(Lt(this.view.camera.heading)),this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._smoothRotation.reset(),Xd(e.center,this._screenPickPoint),ko(this._beginScreenPoint,this._screenPickPoint);const i=ePe(this._intersectionHelper,this.startCamera,this._screenPickPoint,or(this.view.spatialReference).radius,1,this.view.basemapTerrain.invisible?_2:{});i.scenePickPoint!=null&&(this._scenePickPoint=i.scenePickPoint,this._sphere=i.sphere,de(this._beginScenePoint,this._scenePickPoint),this._navigationMode=x4(this.startCamera,this._screenPickPoint,this.view.renderCoordsHelper,this.view.viewingMode),this._navigationMode===0&&this._preparePlanarPanMode(e,i.hasGeometryIntersection),this._beginCamera.copyFrom(this.startCamera))}update(e){if(!this.running)return;this.currentCamera.copyFrom(this.startCamera);const i=e.pointers.size>1;this._navigationMode===1?(i&&this._zoomSpherical(e),this._panningSpherical(e),i&&this._rotateSpherical(e)):(i&&this._zoomPlanar(e),this._panningPlanar(e),i&&this._rotatePlanar(e)),this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const i=this._zoomMomentumEstimator.evaluateMomentum();if(i)return this._navigationMode===1?new vb({view:this.view,momentum:i,screenCenter:this._zoomCenterScreen,sceneCenter:this._beginScenePoint,radius:this._sphere[3]}):new S3({view:this.view,momentum:i,zoomCenter:this._beginScenePoint});const r=this._rotationMomentumEstimator.evaluateMomentum();if(r)return new Ub({view:this.view,momentum:r,center:gy(this._sphere,R()),axis:this._rotationAxis});if(this._navigationMode===1){const s=this._panSphericalMomentumEstimator.evaluateMomentum();if(s)return new cF({view:this.view,momentum:s})}else{const s=this._panPlanarMomentumEstimator.evaluateMomentum();if(s)return new tR({view:this.view,momentum:s})}return null}_preparePlanarPanMode(e,i){const r=Gh(this._tmp3d,this.startCamera.viewForward);Qf(this._scenePickPoint,r,this._panningPlane);const s=Gs(this._screenPickPoint[0],0),n=R(),a=Le(this.startCamera.eye);this._adjustedSphere[3]=a<this._sphere[3]?a-100:this._sphere[3],pD(this._adjustedSphere,this.startCamera,s,n);const o=R(),l=R(),c=R();Ce(o,this._scenePickPoint,this.currentCamera.eye);const h=Le(o);Ee(o,o);const f=QOe*Math.max(Math.abs(this.view.camera.position.z),XOe),y=this.view.stage.renderView.getMinimalDepthForArea(null,this._screenPickPoint[0],this._screenPickPoint[1],this.view.state.camera,w4);let _=y??f;i&&(_=Math.min(_,h)),de(c,xe(l,this.currentCamera.eye,le(l,o,_))),this._panningPlane[3]=-Oe(this._panningPlane,c),this.startCamera.center=xe(l,this.startCamera.eye,le(l,this.startCamera.viewForward,_));const w=Xd(e.center,this._tmpScreenPointArray);KQ(this._panningPlane,this.startCamera,w,this._beginScenePoint)}_zoomSpherical(e){const i=this._beginRadius/e.radius,r=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=r,this._smoothScaling.update(i),JOe(this._sphere,this.currentCamera,this._smoothScaling.value),Xd(e.center,this._zoomCenterScreen),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),this._constraintOptions.interactionType=1,this._constraintOptions.interactionFactor=Nh(e.radius-this._beginRadius),us(this.view,this.currentCamera,this._constraintOptions)}_panningSpherical(e){const i=Xd(e.center,this._tmpScreenPointArray);pD(this._sphere,this.currentCamera,i,this._tmp3d),Pie(this._beginScenePoint,Oe(this.currentCamera.up,this._beginScenePoint),this._sphere[3],this._beginHeading,this.view.camera.tilt,this.startCamera.aboveGround)?(aPe(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this._beginHeading,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumPreserveHeading(i,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere,this._beginHeading,this.view.camera.tilt)):(nPe(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumDirectRotation(i,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere[3],this.view.camera.tilt)),this._constraintOptions.interactionType=4,this._constraintOptions.interactionFactor=Nh(Zf(this._screenPickPoint,i)),us(this.view,this.currentCamera,this._constraintOptions)}_rotateSpherical(e){Ee(this._rotationAxis,this._scenePickPoint),this.currentCamera.aboveGround||Gh(this._rotationAxis,this._rotationAxis);const i=this._smoothRotation.value,r=i+JQ(e.angle-i),s=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=s,this._smoothRotation.update(r);const n=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(n,.001*e.timestamp),Rv(this.currentCamera,Ti(this._sphere),dD(this._rotationAxis,n)),this._constraintOptions.interactionType=2,this._constraintOptions.interactionFactor=Nh(e.radius*r),us(this.view,this.currentCamera,this._constraintOptions)}_panningPlanar(e){const i=Xd(e.center,this._tmpScreenPointArray);KQ(this._panningPlane,this.currentCamera,i,this._tmp3d)&&(tPe(this.currentCamera,this._beginScenePoint,this._tmp3d),this._panPlanarMomentumEstimator.add(i,this._tmp3d,.001*e.timestamp),this._constraintOptions.interactionType=4,this._constraintOptions.interactionFactor=Nh(Zf(this._beginScreenPoint,i)),this._constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this._tmpInteractionDirection),us(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null)}_zoomPlanar(e){const i=this._beginRadius/e.radius,r=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=r,this._smoothScaling.update(i),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),Oie(this.currentCamera,this._beginScenePoint,this._smoothScaling.value,this.view.state.constraints.minimumPoiDistance),this._constraintOptions.interactionType=1,this._constraintOptions.interactionFactor=Nh(e.radius-this._beginRadius),us(this.view,this.currentCamera,this._constraintOptions)}_rotatePlanar(e){de(this._rotationAxis,this._beginScenePoint),this.currentCamera.aboveGround||Gh(this._rotationAxis,this._rotationAxis);const i=this._smoothRotation.value;let r=e.angle-i;r=JQ(r);const s=i+r,n=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=n,this._smoothRotation.update(s);const a=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(a,.001*e.timestamp),Rv(this.currentCamera,Ti(this._sphere),dD(this._rotationAxis,a)),this._constraintOptions.interactionType=2,this._constraintOptions.interactionFactor=Nh(e.radius*a),us(this.view,this.currentCamera,this._constraintOptions)}};sX=d([k("esri.views.3d.state.controllers.PinchAndPanControllerGlobal")],sX);const jme=Ge(0,0,1);let nX=class extends ap{constructor(){super(...arguments),this._rotationValueSmooth=new tV(.05),this._scalingValueSmooth=new tV(.05),this._planeHorizontal=Oi(),this._planeVertical=Oi(),this._rotationMomentumEstimator=new EPe,this._panMomentumEstimator=new CPe(300,12,.9),this._zoomMomentumEstimator=new APe,this._beginRadius=0,this._beginCenter=R(),this._beginAngle=0,this._tmpPoints=[],this._navigationMode=1,this._beginCenterScreen=Gs(),this._tmpCentroid3d=R(),this._tmpCentroid2d=Gs(),this._tmp2d=Gs(),this._pointerCount=0,this._beginCamera=new nr,this._constraintOptions=new Gu(15,0,0,this._beginCamera)}begin(e){if(!this.running)return;const i=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=i,this._rotationMomentumEstimator.enabled=i,this._panMomentumEstimator.enabled=i,this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._rotationValueSmooth.reset(),this._scalingValueSmooth.reset(),Xd(e.center,this._beginCenterScreen),U3e(jme,0,this._planeHorizontal);const r=R(),s=this._intersectionHelper.intersectScreenFreePointFallback(this._beginCenterScreen,r,this.view.basemapTerrain.invisible?_2:{}),n=R();Gh(n,this.startCamera.viewForward);const a=R();de(a,jme);const o=Oe(n,a);this._navigationMode=x4(this.startCamera,this._beginCenterScreen,this.view.renderCoordsHelper,this.view.viewingMode);const l=$M(a,this.startCamera.viewForward,QOe)*Math.max(Math.abs(this.view.camera.position.z),XOe);uZ(this._planeHorizontal,this._planeHorizontal,r),this.startCamera.aboveGround||oXe(this._planeHorizontal,this._planeHorizontal);const c=R(),h=R(),f=R();Ce(c,r,this.currentCamera.eye);const y=Le(c);if(Ee(c,c),this._navigationMode===0){le(a,a,o),Ce(this._planeVertical,n,a),Ee(this._planeVertical,this._planeVertical),uZ(this._planeVertical,this._planeVertical,r);const _=this.view.stage.renderView.getMinimalDepthForArea(fD(this.view),this._beginCenterScreen[0],this._beginCenterScreen[1],this.view.state.camera,w4);let w=_??l;s&&(w=Math.min(w,y)),de(f,xe(h,this.currentCamera.eye,le(h,c,w))),this._planeVertical[3]=-Oe(this._planeVertical,f),this._computePlanePoints(e.pointers,this._planeVertical,this.startCamera,this._tmpPoints),hq(this._tmpPoints,this._beginCenter)}else{const _=s?y:l;de(f,xe(h,this.currentCamera.eye,le(h,c,_))),this._planeHorizontal[3]=-Oe(this._planeHorizontal,f),this._computePlanePoints(e.pointers,this._planeHorizontal,this.startCamera,this._tmpPoints),hq(this._tmpPoints,this._beginCenter)}this._beginCamera.copyFrom(this.startCamera)}update(e){if(!this.running)return;this.currentCamera.copyFrom(this.startCamera);const i=e.pointers.size>1,r=this._navigationMode===1?this._planeHorizontal:this._planeVertical,s=this._beginCenter;if(i){const n=this._beginRadius/e.radius,a=.001875*Math.min(Math.max(e.radius,40),120);this._scalingValueSmooth.gain=a,this._scalingValueSmooth.update(n),Oie(this.currentCamera,s,this._scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance),this._zoomMomentumEstimator.add(this._scalingValueSmooth.value,.001*e.timestamp),this._constraintOptions.interactionType=1,this._constraintOptions.interactionFactor=Nh(Math.abs(e.radius-this._beginRadius)),us(this.view,this.currentCamera,this._constraintOptions)}if(this._computePlanePoints(e.pointers,r,this.currentCamera,this._tmpPoints),hq(this._tmpPoints,this._tmpCentroid3d),Xd(e.center,this._tmpCentroid2d),tPe(this.currentCamera,s,this._tmpCentroid3d),this._panMomentumEstimator.add(this._tmpCentroid2d,this._tmpCentroid3d,.001*e.timestamp),this._constraintOptions.interactionType=4,this._constraintOptions.interactionFactor=Nh(Zf(this._beginCenterScreen,this._tmpCentroid2d)),us(this.view,this.currentCamera,this._constraintOptions),i){const n=s,a=this._rotationValueSmooth.value,o=a+JQ(e.angle-a),l=.00125*Math.min(Math.max(e.radius,40),120);this._rotationValueSmooth.gain=l,this._rotationValueSmooth.update(o);const c=this._rotationValueSmooth.value-this._beginAngle;this._rotationMomentumEstimator.add(c,.001*e.timestamp);const h=this._planeHorizontal;Rv(this.currentCamera,n,dD(h,c)),this._constraintOptions.interactionType=2,this._constraintOptions.interactionFactor=Nh(Math.abs(e.radius*c)),us(this.view,this.currentCamera,this._constraintOptions)}this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const i=this._zoomMomentumEstimator.evaluateMomentum();if(i)return new S3({view:this.view,momentum:i,zoomCenter:this._beginCenter});const r=this._rotationMomentumEstimator.evaluateMomentum();if(r)return new Ub({view:this.view,momentum:r,center:this._beginCenter,axis:this._planeHorizontal});const s=this._panMomentumEstimator.evaluateMomentum();return s?new tR({view:this.view,momentum:s}):null}_computePlanePoints(e,i,r,s){s.length=e.size;const n=this._tmp2d;let a=0;return e.forEach(o=>{n[0]=o.x,n[1]=o.y,s[a]===void 0&&(s[a]=R()),KQ(i,r,n,s[a]),a+=1}),s}get _intersectionHelper(){return this.view.sceneIntersectionHelper}};nX=d([k("esri.views.3d.state.controllers.PinchAndPanControllerLocal")],nX);let qme=class extends ho{constructor(e,i,r){super(!0),this._view=e,this.pointerActions=i,this._lastEndTimestamp=0,this._lastTimestamp=0,this.registerIncoming("drag",r,s=>this._handleDrag(s))}_handleDrag(e){if(e.data.pointerType==="mouse"&&!Die(e.data,this.pointerActions))return;const i=e.timestamp-this._lastEndTimestamp,r=40,s=this._momentum&&this._momentum.running&&i<r;switch(e.data.action){case"start":case"update":if(s)break;this._controller&&this._controller.running?e.data.timestamp-this._lastTimestamp>2&&(this._controller.update(e.data),this._lastTimestamp=e.timestamp):this._startController(e);break;case"end":case"removed":this._endController(e,!0);break;case"added":this._endController(e,!1),this._startController(e)}e.stopPropagation()}_endController(e,i){if(this._controller?.running){this._lastEndTimestamp=e.timestamp;const r=this._controller.end(e.data);i&&r&&(this._momentum=r,this._view.state.switchCameraController(this._momentum))}this._controller=null}_startController(e){this._controller=this._createController(),this._view.state.switchCameraController(this._controller),this._controller.begin(e.data),this._lastTimestamp=e.timestamp}_createController(){return this._view.state.isGlobal?new sX({view:this._view}):new nX({view:this._view})}},aft=class extends ho{constructor(e,i){super(!0),this.view=e,this.registerIncoming("pointer-down",i,()=>this.view.state.stopActiveCameraController())}},oft=class extends ho{constructor(e,i=!1){super(!0),this._view=e,this._invert=i,this.registerIncoming("vertical-two-finger-drag",r=>this._handleTwoFinger(r))}_handleTwoFinger(e){const i=this._invert?-1:1,r=Gs(0,e.data.delta*i);switch(e.data.action){case"begin":this._cameraController?.end(),this._cameraController=new KP({view:this._view,pivot:0}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break;case"update":this._cameraController?.update(r);break;case"end":this._cameraController?.end(),this._cameraController=null}}};function Gme(t){const e=t.native;return e?{buttons:e.buttons.map(i=>i.pressed?i.value||1:0),axes:e.axes.map(i=>uft(i,t.axisThreshold))}:{buttons:[],axes:[]}}function lft(t,e){if(t.axes.length!==e.axes.length||t.buttons.length!==e.buttons.length)return!1;for(let i=0;i<t.axes.length;i++)if(t.axes[i]!==e.axes[i])return!1;for(let i=0;i<t.buttons.length;i++)if(t.buttons[i]!==e.buttons[i])return!1;return!0}function cft(t){for(let e=0;e<t.axes.length;e++)if(t.axes[e]!==0)return!1;for(let e=0;e<t.buttons.length;e++)if(t.buttons[e]!==0)return!1;return!0}function uft(t,e){const i=Math.abs(t);return i<e?0:Math.sign(t)*(i-e)/(1-e)}let hft=class{constructor(e,i){this._element=e,this._input=i,this._hasEventListeners=!1,this._onConnectGamepad=n=>{this._connectGamepad(n.gamepad)},this._onDisconnectGamepad=n=>{const a=n.gamepad,o=a.index,l=this._inputDevices[o];l&&(this._emitGamepadEvent(a,Gme(l),!1),this._inputDevices.splice(o,1),this._latestUpdate.splice(o,1),this._input.gamepad.devices.remove(l),this.ensurePollingState())},this._frameTask=null,this._latestUpdate=new Array,this._inputDevices=new Array,this._callback=null;const r="getGamepads"in window.navigator,s=window.isSecureContext;this.supported=r&&s,this.supported&&(Hme(n=>this._connectGamepad(n)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(e){this._hasEventListeners!==e&&(this._hasEventListeners=e,this.ensurePollingState())}get _eventsEnabled(){return this.supported&&this._inputDevices.length>0&&this._hasEventListeners}set onEvent(e){this._callback=e}_connectGamepad(e){const i=new Bte(e);i.deviceType!=="unknown"&&(this._inputDevices[e.index]=i,this._input.gamepad.devices.add(i)),this.ensurePollingState()}ensurePollingState(){this._eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){this._frameTask==null&&(this._frameTask=Rx({update:()=>this._readGamepadState()}))}_stopPolling(){this._frameTask!=null&&(this._frameTask.remove(),this._frameTask=null,this._latestUpdate=new Array)}_readGamepadState(){const e=document.hasFocus(),i=this._element.contains(document.activeElement),r=this._input.gamepad.enabledFocusMode==="document"&&!e||this._input.gamepad.enabledFocusMode==="view"&&!i;Hme(s=>{const n=this._inputDevices[s.index];if(!n)return;const a=this._latestUpdate[s.index],o=Gme(n),l=r||cft(o);a&&(a.timestamp===s.timestamp||!a.active&&l||lft(a.state,o))||this._emitGamepadEvent(s,o,!l)})}_emitGamepadEvent(e,i,r){const s=this._latestUpdate[e.index],n=s&&s.active;if(!n&&!r)return;const a=!n&&r?"start":n&&r?"update":"end";this._latestUpdate[e.index]={timestamp:e.timestamp,state:i,active:r},this._callback&&this._callback({device:this._inputDevices[e.index],state:i,action:a})}};function dft(t){if(!t||!t.connected)return!1;for(let e=0;e<t.axes.length;e++)if(isNaN(t.axes[e]))return!1;return!0}function Hme(t){for(const e of navigator.getGamepads())dft(e)&&t(e)}const Wme=ie("edge"),pft=ie("chrome"),fft=ie("ff"),mft=ie("safari"),Zme="esri-view-surface",$S={touchNone:`${Zme}--touch-none`,touchPan:`${Zme}--touch-pan`};var Tx;let gft=(Tx=class{constructor(e,i){this._active={},this._callback=()=>{},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=e,e.getAttribute("tabindex")||e.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new hft(e,i),this._gamepadSource.onEvent=r=>this._callback("gamepad",r)}destroy(){this._callback=()=>{},this.activeEvents=null,this._activePointerCaptures.forEach(e=>this._releasePointerCaptureSafe(e)),this._activePointerCaptures.clear(),this._gamepadSource=Re(this._gamepadSource),this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(e){this._browserTouchPanningEnabled=e,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(e){this._callback=e}set activeEvents(e){for(const i in this._active)if(!e||!e.has(i)){const r=this._active[i];this._element.removeEventListener(Cq[i],r),delete this._active[i]}e&&e.forEach(i=>{if(!this._active[i]&&Cq[i]){const r=(this._eventHandlers[i]||this._handleDefault).bind(this,i);this._element.addEventListener(Cq[i],r),this._active[i]=r}}),this._gamepadSource&&(this._gamepadSource.hasEventListeners=e?.has("gamepad")??!1)}setPointerCapture(e,i){i?this._setPointerCaptureSafe(e.pointerId):(this._releasePointerCaptureSafe(e.pointerId),this._activePointerCaptures.delete(e.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?$S.touchNone:$S.touchPan),this._element.classList.add(this._browserTouchPanningEnabled?$S.touchPan:$S.touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove($S.touchNone),this._element.classList.remove($S.touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_setPointerCaptureSafe(e){try{this._element.setPointerCapture(e),this._activePointerCaptures.add(e)}catch{}}_releasePointerCaptureSafe(e){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(e))return;this._element.releasePointerCapture(e)}catch{}}_updateNormalizedPointerLikeEvent(e,i){const r=QMe(this._element,e);return Tx.test.disableSubpixelCoordinates&&(r.x=Math.round(r.x),r.y=Math.round(r.y)),i.x=r.x,i.y=r.y,i}_handleKey(e,i){const{key:r}=i;r&&e==="key-up"&&this._keyDownState.delete(r);const s={native:i,key:r,repeat:!!r&&this._keyDownState.has(r)};r&&e==="key-down"&&this._keyDownState.add(s.key),this._callback(e,s)}_handlePointer(e,i){const r=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,pointerType:i.pointerType,button:i.button,buttons:i.buttons,eventId:this._eventId++});this._callback(e,r)}_handlePointerPreventDefault(e,i){const r=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,pointerType:i.pointerType,button:i.button,buttons:i.buttons,eventId:this._eventId++});i.preventDefault(),this._callback(e,r)}_getDeltaFromTrackpadOrMouseWheel(e){return e.shiftKey&&ie("mac")&&e.deltaY===0?e.deltaX:e.deltaY}_handleMouseWheel(e,i){let r=this._getDeltaFromTrackpadOrMouseWheel(i);switch(i.deltaMode){case 0:Wme&&(r=r/document.documentElement.clientHeight*600);break;case 1:r*=30;break;case 2:r*=900}Wme?r*=.7:pft||mft?r*=.6:fft&&(r*=1.375);const s=100,n=Math.abs(r);n>s&&(r=r/n*200/(1+Math.exp(-.02*(n-s))));const a=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,deltaY:r});this._callback(e,a)}_handlePointerCaptureLost(e,i){this._activePointerCaptures.delete(i.pointerId),this._handleDefault(e,i)}_handleDefault(e,i){const r={native:i};i.preventDefault(),this._callback(e,r)}_preventAltKeyDefault(e){e.key==="Alt"&&e.preventDefault()}_preventMultiTouchPanning(e){e.touches.length>1&&e.preventDefault()}},Tx.test={disableSubpixelCoordinates:!1},Tx);const Cq={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};let yft=class extends ho{constructor(){super(!0),this.registerIncoming("context-menu",e=>e.data.native.preventDefault())}};const OPe=()=>({maximumClickDelay:300}),_ft=(t={})=>({...OPe(),movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500,...t}),PPe=(t={})=>({...OPe(),maximumDoubleClickDistance:10,maximumDoubleTouchDistance:35,maximumDoubleClickDelay:250,maximumDoubleTouchDelay:350,...t});function aX(t,e){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}function vft(t,e){const i=e.x-t.x,r=e.y-t.y;return Math.sqrt(i*i+r*r)}function bft(t,e){if(e?(e.radius=0,e.center.x=0,e.center.y=0):e={radius:0,center:Zl()},t.length===0)return e;if(t.length===1)return e.center.x=t[0].x,e.center.y=t[0].y,e;if(t.length===2){const[M,P]=t,[O,D]=[P.x-M.x,P.y-M.y];return e.radius=Math.sqrt(O*O+D*D)/2,e.center.x=(M.x+P.x)/2,e.center.y=(M.y+P.y)/2,e}let i=0,r=0;for(let M=0;M<t.length;M++)i+=t[M].x,r+=t[M].y;i/=t.length,r/=t.length;const s=t.map(M=>M.x-i),n=t.map(M=>M.y-r);let a=0,o=0,l=0,c=0,h=0,f=0,y=0;for(let M=0;M<s.length;M++){const P=s[M],O=n[M],D=P*P,L=O*O;a+=D,o+=L,l+=P*O,c+=D*P,h+=L*O,f+=P*L,y+=O*D}const _=.5*(c+f),w=.5*(h+y),x=a*o-l*l,S=(_*o-w*l)/x,$=(a*w-l*_)/x,A=Zl(S+i,$+r);return{radius:Math.sqrt(S*S+$*$+(a+o)/t.length),center:A}}function iR(t){const{native:e}=t,{pointerId:i,button:r,pointerType:s}=e;return s==="mouse"?`${i}:${r}`:`${s}`}let wft=class extends ho{constructor(e){super(!1),this._navigationTouch=e,this._startStateModifiers=new Set,this._activePointerMap=new Map,this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(e,i,r,s){return{action:e,pointerType:this._pointerType,button:this._mouseButton,buttons:i.buttons,timestamp:s,pointers:xft(this._activePointerMap),pointer:i,angle:r.angle,radius:r.radius,center:r.center}}_addPointer(e){const i=e.native.pointerId,r=TL(this._activePointerMap).angle,s={event:e,initialAngle:0,lastAngle:0};this._activePointerMap.set(i,s);const n=uF(s,RPe(this._activePointerMap));s.initialAngle=n,s.lastAngle=n,this._updatePointerAngles(r)}_updatePointer(e){if(e&&e.x==null&&e.y==null)return;const i=e.native.pointerId,r=this._activePointerMap.get(i);r?r.event=e:this._addPointer(e)}_removePointer(e){const i=TL(this._activePointerMap).angle;this._activePointerMap.delete(e),this._updatePointerAngles(i)}_updatePointerAngles(e){const i=TL(this._activePointerMap);this._activePointerMap.forEach(r=>{r.initialAngle=uF(r,i)-e,r.lastAngle=uF(r,i)-e})}_emitEvent(e,i,r){const s=TL(this._activePointerMap);this._drag.emit(this._createPayload(e,i,s,r),void 0,this._startStateModifiers)}_handlePointerUpAndPointerLost(e){const i=e.data.native.pointerId,r=e.timestamp;this._activePointerMap.get(i)&&(this._activePointerMap.size===1?(this._updatePointer(e.data),!this._isCurrentDragSuppressed&&this._emitEvent("end",e.data,r),this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._removePointer(i)):(this._removePointer(i),this._emitEvent("removed",e.data,e.timestamp)))}_handlePointerDrag(e){const i=e.data,r=i.currentEvent,s=e.timestamp;switch(i.action){case"start":case"update":this._isDragging?this._activePointerMap.has(r.native.pointerId)?(this._updatePointer(r),!this._isCurrentDragSuppressed&&this._emitEvent("update",r,s)):(this._addPointer(r),this._emitEvent("added",r,s),this._isCurrentDragSuppressed=this._isSuppressed):(this._updatePointer(r),this._pointerType=e.data.startEvent.pointerType,this._mouseButton=e.data.startEvent.button,this._startStateModifiers=e.modifiers,this._isDragging=!0,this._isCurrentDragSuppressed=this._isSuppressed,!this._isCurrentDragSuppressed&&this._emitEvent("start",r,s))}}get _isSuppressed(){return!!this._navigationTouch&&!this._navigationTouch.browserTouchPanEnabled&&this._pointerType==="touch"&&this._activePointerMap.size===1}};function RPe(t){const e=[];return t.forEach(i=>{e.push(Zl(i.event.x,i.event.y))}),bft(e)}function TL(t){const e=RPe(t);let i=0;return t.forEach(r=>{let s=uF(r,e),n=s-r.lastAngle;for(;n>Math.PI;)n-=2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;s=r.lastAngle+n,r.lastAngle=s;const a=s-r.initialAngle;i+=a}),i/=t.size||1,{angle:i,radius:e.radius,center:e.center}}function xft(t){const e=new Map;return t.forEach((i,r)=>e.set(r,i.event)),e}function uF(t,e){const i=t.event,r=i.x-e.center.x,s=i.y-e.center.y;return Math.atan2(s,r)}let Sft=class extends ho{constructor(e={},i=nM){super(!1),this._clock=i,this._pointerState=new Map,this._parameters=PPe(e),this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUp.bind(this))}onUninstall(){this._pointerState.forEach(e=>{e.immediateDoubleClick&&e.immediateDoubleClick.timeoutHandle.remove()}),super.onUninstall()}_handlePointerDown(e){const i=e.data,r=iR(i);if(!this._pointerState.has(r)){const s={downButton:i.native.button,x:i.x,y:i.y,immediateDoubleClick:null};this._pointerState.set(r,s),this.startCapturingPointer(i.native)}}_handlePointerUp(e){const i=e.data,r=iR(i),s=this._pointerState.get(r);if(s&&s.downButton===i.native.button){const n=s.immediateDoubleClick,a=e.data.native.pointerType==="touch"?this._parameters.maximumDoubleTouchDistance:this._parameters.maximumDoubleClickDistance;n?(n.timeoutHandle.remove(),aX(n,e.data)>a?this._startImmediateDoubleClick(e,s):(this._immediateDoubleClick.emit(e.data,void 0,n.modifiers),this._removeState(i))):aX(s,e.data)>a?this._removeState(i):this._startImmediateDoubleClick(e,s)}}_startImmediateDoubleClick(e,i){const r=e.data.native.pointerType==="touch"?this._parameters.maximumDoubleTouchDelay:this._parameters.maximumDoubleClickDelay;i.immediateDoubleClick={x:e.data.x,y:e.data.y,modifiers:e.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(e.data),r)}}_removeState(e){const i=iR(e);this._pointerState.delete(i),this.stopCapturingPointer(e.native),this.refreshHasPendingInputs()}},Tft=class extends ho{constructor(e={},i=nM){super(!1),this._clock=i,this._pointerState=new Map,this._parameters=_ft(e),this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",r=>this._handlePointerDown(r)),this.registerIncoming("pointer-up",r=>this._handlePointerLoss(r,"pointer-up")),this.registerIncoming("pointer-capture-lost",r=>this._handlePointerLoss(r,"pointer-capture-lost")),this.registerIncoming("pointer-cancel",r=>this._handlePointerLoss(r,"pointer-cancel")),this._moveHandle=this.registerIncoming("pointer-move",r=>this._handlePointerMove(r)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(e=>{e.holdTimeout=Ki(e.holdTimeout)}),super.onUninstall()}_handlePointerDown(e){const i=e.data,r=i.native.pointerId;let s=null;this._pointerState.size===0&&(s=this._clock.setTimeout(()=>{const a=this._pointerState.get(r);if(a){if(!a.isDragging){const o=a.previousEvent;this._pointerHold.emit(o,void 0,e.modifiers),a.holdEmitted=!0}a.holdTimeout=null}},this._parameters.holdDelay));const n={startEvent:i,previousEvent:i,startTimestamp:e.timestamp,isDragging:!1,downButton:i.native.button,holdTimeout:s,modifiers:new Set};this._pointerState.set(r,n),this.startCapturingPointer(i.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(e)}_handlePointerMove(e){const i=e.data,r=i.native.pointerId,s=this._pointerState.get(r);s&&(s.isDragging?this._pointerDrag.emit($L("update",s,i),void 0,s.modifiers):vft(i,s.startEvent)>this._getDragThreshold(i.native.pointerType)&&this._startDragging(e),s.previousEvent=i)}_getDragThreshold(e){switch(e){case"touch":return this._parameters.movementUntilTouchDrag;case"pen":return this._parameters.movementUntilPenDrag;default:return this._parameters.movementUntilMouseDrag}}_startDragging(e){const i=e.data,r=i.native.pointerId;this._pointerState.forEach(s=>{s.holdTimeout!=null&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging||(s.modifiers=e.modifiers,s.isDragging=!0,r===s.startEvent.native.pointerId?this._pointerDrag.emit($L("start",s,i)):this._pointerDrag.emit($L("start",s,s.previousEvent),e.timestamp))})}_handlePointerLoss(e,i){const r=e.data,s=r.native.pointerId,n=this._pointerState.get(s);n&&(n.holdTimeout!=null&&(n.holdTimeout.remove(),n.holdTimeout=null),n.isDragging?this._pointerDrag.emit($L("end",n,i==="pointer-up"?r:n.previousEvent),void 0,n.modifiers):i==="pointer-up"&&n.downButton===r.native.button&&e.timestamp-n.startTimestamp<=this._parameters.maximumClickDelay&&!n.holdEmitted&&this._immediateClick.emit(r),this._pointerState.delete(s),this.stopCapturingPointer(r.native),this._pointerState.size===0&&this._moveHandle.pause())}};function $L(t,e,i){return{action:t,startEvent:e.startEvent,previousEvent:e.previousEvent,currentEvent:i}}let $ft=class extends ho{constructor(e={},i=nM){super(!1),this._clock=i,this._pointerState=new Map,this._parameters=PPe(e),this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",r=>this._handleImmediateClick(r)),this.registerIncoming("pointer-down",r=>this._handlePointerDown(r))}onUninstall(){this._pointerState.forEach(e=>e.doubleClickTimer=Ki(e.doubleClickTimer))}get hasPendingInputs(){for(const e of this._pointerState.values())if(e.doubleClickTimer!=null)return!0;return!1}_clearDoubleClickTimer(e,i){const r=this._pointerState.get(e);r&&(r.doubleClickTimer=Ki(r.doubleClickTimer),i&&this._click.emit(r.event.data,void 0,r.event.modifiers),this._pointerState.delete(e),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(e){const i=this._pointerState.get(e);i.pointerDownCount===1&&this._click.emit(i.event.data,void 0,i.event.modifiers),i.doubleClickTimer=null,this._pointerState.delete(e),this.refreshHasPendingInputs()}_handleImmediateClick(e){const i=e.data,{pointerType:r}=i.native,s=Cft(i);if(!this._pointerState.has(s))return void this._startClick(e);const n=this._pointerState.get(s),{data:a,modifiers:o}=n.event,l=r==="touch"?this._parameters.maximumDoubleTouchDistance:this._parameters.maximumDoubleClickDistance;aX(a,i)>l?(this._clearDoubleClickTimer(s,!0),this._startClick(e)):(this._clearDoubleClickTimer(s,!1),n.pointerDownCount===2&&this._doubleClick.emit(a,void 0,o))}_handlePointerDown(e){const i=iR(e.data),r=this._pointerState.get(i);r&&(r.pointerDownCount+=1)}_startClick(e){const{data:i}=e,{native:{pointerType:r}}=i,s=iR(i),n=r==="touch"?this._parameters.maximumDoubleTouchDelay:this._parameters.maximumDoubleClickDelay,a=this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(s),n);this._pointerState.set(s,{event:e,doubleClickTimer:a,pointerDownCount:1}),this.refreshHasPendingInputs()}};function Cft(t){const{pointerId:e,pointerType:i,button:r}=t.native;return i==="mouse"?`${e}:${r}`:`${i}`}let Mft=class{constructor(e){this._callbacks=e,this._currentCount=0,this._callbacks.condition||(this._callbacks.condition=()=>!0)}handle(e){const i=e.data,r=i.pointers.size;switch(i.action){case"start":this._currentCount=r,this._emitStart(e);break;case"added":this._emitEnd(this._previousEvent),this._currentCount=r,this._emitStart(e);break;case"update":this._emitUpdate(e);break;case"removed":this._startEvent&&this._emitEnd(this._previousEvent),this._currentCount=r,this._emitStart(e);break;case"end":this._emitEnd(e),this._currentCount=0}this._previousEvent=e}_emitStart(e){this._startEvent=e,this._callbacks.condition?.(this._currentCount,e)&&this._callbacks.start(this._currentCount,e,this._startEvent)}_emitUpdate(e){this._callbacks.condition?.(this._currentCount,e)&&this._callbacks.update(this._currentCount,e,this._startEvent)}_emitEnd(e){this._callbacks.condition?.(this._currentCount,e)&&this._callbacks.end(this._currentCount,e,this._startEvent),this._startEvent=null}},Eft=class extends ho{constructor(e=20,i=40){super(!1),this._threshold=e,this._maxDelta=i,this._state="ready",this._emittedArtificalEnd2=!1,this._vertical=this.registerOutgoing("vertical-two-finger-drag"),this._artificalDrag=this.registerOutgoing("drag"),this._dragEventSeparator=new Mft({start:(r,s)=>this._observeStart(r,s),update:(r,s,n)=>this._observeUpdate(r,s,n),end:(r,s)=>this._observeEnd(s)}),this.registerIncoming("drag",r=>this._dragEventSeparator.handle(r))}get failed(){return this._state==="failed"}_observeStart(e,i){e===1&&this._emittedArtificalEnd2&&(this._emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:i.data.button,buttons:i.data.buttons,pointerType:i.data.pointerType,timestamp:i.data.timestamp,pointers:i.data.pointers,pointer:i.data.pointer,angle:i.data.angle,radius:i.data.radius,center:i.data.center}),i.stopPropagation()),this._state=e===2?"ready":"failed"}_observeUpdate(e,i,r){if(this._state!=="failed"&&e===2)return this._state==="active"?(this._vertical.emit({delta:i.data.center.y-this._thresholdReachedCenter.y,action:"update"}),void i.stopPropagation()):void(this._checkMovementWithinLimits(i.data,r.data)?this._checkVerticalThresholdReached(i.data,r.data)&&(this._state="active",this._emittedArtificalEnd2=!0,this._thresholdReachedCenter=i.data.center,this._artificalDrag.emit({action:"end",button:i.data.button,buttons:i.data.buttons,pointerType:i.data.pointerType,timestamp:i.data.timestamp,pointers:i.data.pointers,pointer:i.data.pointer,angle:i.data.angle,radius:i.data.radius,center:i.data.center}),this._vertical.emit({delta:i.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),i.stopPropagation()):this._state="failed")}_observeEnd(e){this._state==="active"&&(this._vertical.emit({delta:e.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this._state="ready",e.stopPropagation())}_checkMovementWithinLimits(e,i){let r=-1/0,s=1/0,n=-1/0,a=1/0;for(const{x,y:S}of i.pointers.values())r=Math.max(r,x),s=Math.min(s,x),n=Math.max(n,S),a=Math.min(a,S);let o=-1/0,l=1/0,c=-1/0,h=1/0;for(const{x,y:S}of e.pointers.values())o=Math.max(o,x),l=Math.min(l,x),c=Math.max(c,S),h=Math.min(h,S);const f=r-s,y=n-a,_=o-l,w=c-h;return Math.abs(e.center.x-i.center.x)<this._threshold&&Math.abs(_-f)<=this._maxDelta&&Math.abs(w-y)<=this._maxDelta}_checkVerticalThresholdReached(e,i){let r=Math.abs(e.center.y-i.center.y);return e.pointers.forEach((s,n)=>{const a=i.pointers.get(n);r=Math.min(r,Math.abs(s.y-a.y))}),r>=this._threshold}},sg=class extends Me{constructor(){super(...arguments),this.mode="default",this._updateMode=({mode:e,dragPrimary:i,dragSecondary:r,dragTertiary:s})=>{e==="pro"&&(r="zoom",s=i==="pan"?"rotate":"pan");const n={dragPrimary:i,dragSecondary:r,dragTertiary:s};this._modeDragPan&&(this._modeDragPan.pointerActions=mq("pan",n)),this._modeDragRotate&&(this._modeDragRotate.pointerActions=mq("rotate",n)),this._modeDragZoom&&(this._modeDragZoom.pointerActions=mq("zoom",n))}}destroy(){this.disconnect()}get primaryDragAction(){return this.view.navigation.actionMap.dragPrimary}set primaryDragAction(e){const{actionMap:i}=this.view.navigation;i.dragPrimary=e,i.dragSecondary=e==="pan"?"rotate":"pan"}get updating(){return!!this._inputManager?.updating}get latestPointerInfo(){return this._inputManager?.latestPointerInfo}get multiTouchActive(){return this._inputManager?.multiTouchActive??!1}disconnect(){this.removeAllHandles(),this.view.viewEvents.disconnect(),this._modeDragPan=null,this._modeDragRotate=null,this._modeDragZoom=null,this._modeKeyboardNavigation=null,this._inputManager=Re(this._inputManager),this._source=Re(this._source)}connect(){const e=this.view;this._source=new gft(this.view.surface,e.input);const i=[new Sft,new Tft,new $ft,new wft(this.view.navigation),new Eft],r=new Od({eventSource:this._source,recognizers:i});this._inputManager=r,r.installHandlers("prevent-context-menu",[new yft],Br.INTERNAL);const s={fov:"Shift",pan:{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:["u","U"],down:["j","J"]},lookAround:{headingLeft:["a","A"],headingRight:["d","D"],tiltUp:["w","W"],tiltDown:["s","S"],modifier:"b"},zoom:{zoomIn:["+","="],zoomOut:["-","_"]},reset:{heading:["n","N"],tilt:["p","P"]}};this._modeDragPan=new qme(e,["primary"]),this._modeDragRotate=new bq(e,["secondary"],0),this._modeDragZoom=new jpt(e,["tertiary"],s.fov),this._modeKeyboardNavigation=new Kpt(e,s),r.installHandlers("navigation",[new aft(e),new Rdt(e),new Xpt(e),new eft(e,s.fov),new bq(e,["primary"],1,[s.lookAround.modifier]),new bq(e,["secondary"],0,[s.lookAround.modifier]),new qme(e,["tertiary"],[s.lookAround.modifier]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,this._modeKeyboardNavigation,new oft(e)],Br.INTERNAL),this.view.viewEvents.connect(r),this.addHandles([K(()=>this.view.navigation?.browserTouchPanEnabled,n=>{this._source.browserTouchPanningEnabled=!n},Wt),K(()=>{const{actionMap:n}=this.view.navigation,{dragPrimary:a,dragSecondary:o,dragTertiary:l}=n;return{mode:this.mode,dragPrimary:a,dragSecondary:o,dragTertiary:l}},this._updateMode,At)])}isModifierKeyDown(e){return this._inputManager?.isModifierKeyDown(e)??!1}get test(){}};d([m()],sg.prototype,"view",void 0),d([m({type:["default","pro"]})],sg.prototype,"mode",void 0),d([m({readOnly:!0})],sg.prototype,"updating",null),d([m()],sg.prototype,"latestPointerInfo",null),d([m()],sg.prototype,"multiTouchActive",null),d([m()],sg.prototype,"_inputManager",void 0),sg=d([k("esri.views.3d.input.SceneInputManager")],sg);const Aft=sg;let zs=class extends Me{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1}};d([m()],zs.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),d([m()],zs.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),d([m()],zs.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),d([m()],zs.prototype,"DECONFLICTOR_SHOW_GRID",void 0),d([m()],zs.prototype,"LABELS_SHOW_BORDER",void 0),d([m()],zs.prototype,"TEXT_SHOW_BASELINE",void 0),d([m()],zs.prototype,"TEXT_SHOW_BORDER",void 0),d([m()],zs.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),d([m()],zs.prototype,"OVERLAY_SHOW_CENTER",void 0),d([m()],zs.prototype,"SHOW_POI",void 0),d([m()],zs.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),d([m()],zs.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),d([m()],zs.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),d([m()],zs.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),d([m()],zs.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),d([m()],zs.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),d([m()],zs.prototype,"I3S_TREE_SHOW_TILES",void 0),d([m()],zs.prototype,"I3S_SHOW_MODIFICATIONS",void 0),d([m()],zs.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),d([m()],zs.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),d([m()],zs.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),d([m()],zs.prototype,"LINE_WIREFRAMES",void 0),zs=d([k("esri.views.3d.support.debugFlags")],zs);const Ws=new zs;let ya,BC,oX=!1,lX=!1,cX=!1,uX=!1,rR=null;function Oft(t){const e=lX?t():null;if(!e?.bins)return;DPe();const i=BC;let r=0;for(let s=0;s<e.numX;s++)for(let n=0;n<e.numY;n++){const a=e.bins[s][e.numY-1-n];r+=a.length;const o=s*e.sizeX,l=(s+1)*e.sizeX,c=n*e.sizeY,h=(n+1)*e.sizeY;i.fillText(a.length.toFixed(),o+5,c+15),IPe(o,l,c,h,"blue")}i.fillText("total totalShownLabels: "+r,70,40),i.fillText("total visible labels: "+e.numVisible,70,50),i.fillText("total numTests: "+e.numTests,70,30)}function Pft(t){cX=Ws.DECONFLICTOR_SHOW_VISIBLE,uX=Ws.DECONFLICTOR_SHOW_INVISIBLE,oX=cX||uX,lX=Ws.DECONFLICTOR_SHOW_GRID,rR=null,oX||lX?(BC&&ya&&BC.clearRect(0,0,ya.width,ya.height),rR=()=>Rft(t)):ya&&(ya.parentElement.removeChild(ya),ya=null)}function DPe(){rR&&(rR(),rR=null)}function Rft(t){ya==null&&(ya=document.createElement("canvas"),ya.setAttribute("id","debugCanvas2d"),t.surface.parentElement.style.position="relative",t.surface.parentElement.appendChild(ya),ya.style.position="absolute",ya.style.width="100%",ya.style.height="100%",ya.style.display="block",ya.style.pointerEvents="none",BC=ya.getContext("2d"),BC.font="12px Arial");const{width:e,height:i}=t.state.camera;ya.width=e,ya.height=i}function IPe(t,e,i,r,s){DPe();const n=ya.height,a=BC;a.beginPath(),a.lineWidth=1,a.strokeStyle=s,a.moveTo(t,n-i),a.lineTo(e,n-i),a.stroke(),a.lineTo(e,n-r),a.stroke(),a.lineTo(t,n-r),a.stroke(),a.lineTo(t,n-i),a.stroke(),a.closePath()}function LPe(t,e,i=!1){oX&&(e&&cX||!e&&uX)&&IPe(t[0],t[2],t[1],t[3],i?e?"pink":"grey":e?"green":"red")}let Dft=class{constructor(e,i,r){this._setVisibility=e,this._canConflict=i,this._compare=r,this.done=!1,this._items=new Array,this._accBinsNumX=15,this._accBinsNumY=20,this._accBinsSizeX=0,this._accBinsSizeY=0,this._accBins=null}destroy(){this._generator=null,this._accBins=null,this._items.length=0}reset(e,i){this._initBins(e,i),this._items.length=0,this.done=!1,this._generator=null}add(e){this._items.push(e)}run(e){this._generator??=this._run(e),this.done=!!this._generator.next(e).done}*_run(e){yield*this._sort(e),yield*this._deconflict(e),Oft(()=>({bins:this._accBins,numX:this._accBinsNumX,numY:this._accBinsNumY,sizeX:this._accBinsSizeX,sizeY:this._accBinsSizeY,numTests:0,numVisible:this._items.length}))}*_sort(e){for(const i of vwe(this._items,0,this._items.length,this._compare))e.madeProgress(),e.done&&(e=yield)}_isConflicted(e){let i=!0;return this._forEachBin(e.aabr,r=>(i=!1,r.some(s=>this._canConflict(s,e)&&KK(s.aabr,e.aabr))))||i}*_deconflict(e){for(const i of this._items){e.done&&(e=yield);const r=!this._isConflicted(i);this._setVisibility(i,r),LPe(i.aabr,r),r&&this._addToBins(i),e.madeProgress()}}_initBins(e,i){if(this._accBins==null){this._accBins=[];for(let r=0;r<this._accBinsNumX;r++){this._accBins.push([]);const s=this._accBins[this._accBins.length-1];for(let n=0;n<this._accBinsNumY;n++)s.push(new _i)}}else for(let r=0;r<this._accBinsNumX;r++)for(let s=0;s<this._accBinsNumY;s++)this._accBins[r][s].clear();this._accBinsSizeX=e/this._accBinsNumX,this._accBinsSizeY=i/this._accBinsNumY}_addToBins(e){this._forEachBin(e.aabr,i=>i.push(e))}_forEachBin(e,i){if(!this._accBins)return!1;const r=Math.max(Math.floor(e[0]/this._accBinsSizeX),0),s=Math.max(Math.floor(e[1]/this._accBinsSizeY),0),n=Math.min(Math.floor(e[2]/this._accBinsSizeX),this._accBinsNumX-1),a=Math.min(Math.floor(e[3]/this._accBinsSizeY),this._accBinsNumY-1);for(let o=r;o<=n;o++)for(let l=s;l<=a;l++)if(i(this._accBins[o][l]))return!0;return!1}},Ift=class{constructor(e){this._gl=e,this._sync=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0)}poll(){const e=this._gl,i=e.clientWaitSync(this._sync,e.SYNC_FLUSH_COMMANDS_BIT,0);if(i===e.WAIT_FAILED)throw new Error("clientWaitSync failed");return i!==e.TIMEOUT_EXPIRED}destroy(){this._gl.deleteSync(this._sync),this._sync=null}},bb=class extends Nl{constructor(e){super(e),this.category=es.COMPOSITE,this.readyToRun=!1,this.done=!0,this._origin=R(),this._textureWidth=256,this._uploadBuffer=new Float32Array(3*this._textureWidth),this._counter=0,this._width=0,this._height=0,this._pixelBufferSize=0,this._pipeline=li({colorWrite:$i}),this._format=0}initialize(){const e=this.view.resourceController.scheduler.registerTask(yt.GRAPHICS_CORE,this);this.addHandles(e),this.produces="disabled",this.consumes.required=[this.category],this.formatOverride&&(this._format=this.formatOverride)}destroy(){this._program=Rt(this._program);const e=this.gl;this._sync=Re(this._sync),this._pixelBuffer&&(e.deleteBuffer(this._pixelBuffer),this._pixelBuffer=null,this._pixelBufferSize=0),this._texture=Rt(this._texture)}precompile(){this._ensureProgram(this.renderingContext)}render(e){const i=e.find(({name:h})=>h===this.category);if(this._sync)return i;this.produces="disabled";const r=this.renderingContext,s=this.gl,n=i.getTexture(s.DEPTH_STENCIL_ATTACHMENT);if(!n)return i;const a=this.view.stage.renderer.fboCache.acquire(this._width,this._height,"hud visibility",9);r.bindFramebuffer(a.fbo),r.setPipelineState(this._pipeline);const o=this._ensureProgram(r);r.useProgram(o);const l=0;r.bindTexture(n,l),o.setUniform1i("depthTex",l);const c=1;return r.bindTexture(this._texture,c),o.setUniform1i("positionTex",c),an(Mq,this.camera.viewMatrix,LU(Mq,this._origin)),o.setUniformMatrix4fv("view",Mq),o.setUniformMatrix4fv("proj",this.camera.projectionMatrix),o.setUniform1i("count",this._counter),r.screen.draw(),this._pixelBuffer||(this._pixelBuffer=s.createBuffer()),this._format===0&&(this._format=s.getParameter(s.IMPLEMENTATION_COLOR_READ_FORMAT)===6403&&s.getParameter(s.IMPLEMENTATION_COLOR_READ_TYPE)===ar.FLOAT?6403:6408),this._pixelBufferSize=this._width*this._height*(this._format===6403?4:16),s.bindBuffer(s.PIXEL_PACK_BUFFER,this._pixelBuffer),s.bufferData(s.PIXEL_PACK_BUFFER,this._pixelBufferSize,s.STREAM_READ),s.readPixels(0,0,this._width,this._height,this._format,ar.FLOAT,0),this._sync=new Ift(s),a.release(),setTimeout(()=>this.readyToRun=!0,0),i}runTask(){if(!this._sync)return void(this.readyToRun=!1);try{if(!this._sync.poll())return ea}catch{return this.readyToRun=!1,void(this._sync=Re(this._sync))}this.readyToRun=!1,this._sync=Re(this._sync);const e=this.gl;e.bindBuffer(e.PIXEL_PACK_BUFFER,this._pixelBuffer),this._cpuBuffer=new Float32Array(this._width*this._height*(this._format===6403?1:4)),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,this._cpuBuffer),e.bindBuffer(e.PIXEL_PACK_BUFFER,null),this.done=!0}init(e,i){const r=this._textureWidth;if(this._width=r,this._height=Math.ceil(e/r),this._counter=0,this._texture?.dispose(),this._height===0)return;const s=new Zi(this._width,this._height);s.pixelFormat=6407,s.dataType=bs.FLOAT,s.samplingMode=9728,this._texture=new Fi(this.renderingContext,s),this.done=!1,ve(this._origin,Math.fround(i[0]),Math.fround(i[1]),Math.fround(i[2]))}addPosition(e){const i=this._width;if(this._counter>=i*this._height)return-1;const r=this._counter%i;return ui(CL,e,this._origin),this._uploadBuffer[3*r+0]=CL[0],this._uploadBuffer[3*r+1]=CL[1],this._uploadBuffer[3*r+2]=CL[2],r===i-1&&this._flush(),this._counter++}start(){if(this._width===0||this._height===0)return;const e=this._width;this._counter%e>0&&this._flush(),this.produces=this.category,this.requestRender(1)}getOcclusion(e){return this._cpuBuffer?.[this._format===6403?e:4*e]??-1}get usedMemory(){return(this._texture?.usedMemory??0)+this._pixelBufferSize+4*(this._uploadBuffer?.length??0)+4*(this._cpuBuffer?.length??0)}_flush(){const e=this._width,i=Math.floor(this._counter/e);this._texture?.updateData(0,0,i,e,1,this._uploadBuffer)}_ensureProgram(e){return this._program??=e.programCache.acquire(Lft,kft,Qs),this._program}};d([m()],bb.prototype,"category",void 0),d([m()],bb.prototype,"formatOverride",void 0),d([m()],bb.prototype,"readyToRun",void 0),d([m()],bb.prototype,"done",void 0),bb=d([k("esri.views.3d.webgl-engine.lib.GPUPointOcclusionQuery")],bb);const Lft=`#version 300 es
precision highp float;
in vec2 position;

void main() {
    gl_Position = vec4(position, 0.0, 1.0);
}`,kft=`#version 300 es
precision highp float;
out highp vec4 fragColor;

uniform highp mat4 proj;
uniform highp mat4 view;

uniform highp int count;

uniform highp sampler2D depthTex;
uniform highp sampler2D positionTex;

float linearizeDepth(float depth) {
  float depthNdc = depth * 2.0 - 1.0;
  float c1 = proj[3][2];
  float c2 = proj[2][2];
  return -c1 / (depthNdc + c2 + 1e-7);
}

void main() {
  int u = int(floor(gl_FragCoord.x));
  int v = int(floor(gl_FragCoord.y));
  if (u + v * textureSize(positionTex, 0).x >= count) {
    fragColor = vec4(-1);
    return;
  }
  vec4 posWorld = vec4(texelFetch(positionTex, ivec2(u, v), 0).rgb, 1.0);

  vec4 posView = view * posWorld;
  vec4 projected = proj * posView;

  vec3 clipPos = projected.xyz / projected.w;

  if (clipPos.x < -1.0 || clipPos.x > 1.0 || clipPos.y < -1.0 || clipPos.y > 1.0) {
    fragColor = vec4(-1);
    return;
  }

  vec3 uvDepth = 0.5 * clipPos + vec3(0.5);

  float depth = texture(depthTex, uvDepth.xy).r;

  if (uvDepth.z <= depth) {
    fragColor = vec4(0);
    return;
  }

  fragColor = vec4(linearizeDepth(depth) - linearizeDepth(uvDepth.z));
}
`,CL=R(),Mq=it();let hX=class{constructor(){this._scale=0,this._angleFactor=0,this._minScale=0}update(e,i,r,s){r?(this._scale=Math.min(r.divisor/(i-r.offset),1),this._angleFactor=zft(e),this._minScale=s!=null?Math.min(r.minPixelSize/s,1):0):(this._scale=1,this._minScale=1,this._angleFactor=1)}apply(e){const{_scale:i,_angleFactor:r,_minScale:s}=this;return e*Se(ft(i,1,r),s,1)}applyVec2(e,i){e[0]=this.apply(i[0]),e[1]=this.apply(i[1])}},kPe=class{constructor(){this.evaluator=new hX,this.alignmentEvaluator=new hX}update(e,i,r,s,n,a){this.evaluator.update(e,i,r,s),this.alignmentEvaluator.update(e,i,n??r,(n?a:null)??s)}};function zft(t){return Math.abs(t)**3}function qqt(t){return!!t&&!0}let Fft=class{constructor(){this.distance=0,this.fovY=0}},Yme=class{constructor(){this.camera=new Fft,this.offset=0,this.divisor=0,this.minPixelSize=0}};function Nft(t){return t instanceof Float32Array&&t.length>=16}function Vft(t){return Array.isArray(t)&&t.length>=16}function Uft(t){return Nft(t)||Vft(t)}const mD={unknown:1,inches:hi(1,"meters","inches"),feet:hi(1,"meters","feet"),"us-feet":hi(1,"meters","us-feet"),yards:hi(1,"meters","yards"),miles:hi(1,"meters","miles"),"nautical-miles":hi(1,"meters","nautical-miles"),millimeters:hi(1,"meters","millimeters"),centimeters:hi(1,"meters","centimeters"),decimeters:hi(1,"meters","decimeters"),meters:hi(1,"meters","meters"),kilometers:hi(1,"meters","kilometers"),"decimal-degrees":1/V7e(1,"meters",mi.radius)};function Jh(){return!!ie("enable-feature:objectAndLayerId-rendering")}let zie=class{constructor(e){this.field=e}},Bft=class extends zie{constructor(e){super(e),this.minSize=[0,0,0],this.maxSize=[0,0,0],this.offset=[0,0,0],this.factor=[0,0,0],this.type=[0,0,0],this.fallback=[0,0,0]}},Qme=class extends zie{constructor(e){super(e),this.colors=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.values=[0,0,0,0,0,0,0,0],this.fallback=[0,0,0,0]}},jft=class extends zie{constructor(e,i=0){super(e),this.fallback=i,this.values=[0,0,0,0,0,0,0,0],this.opacityValues=[0,0,0,0,0,0,0,0]}},qft=class{};function uA(t){return t!=null}function Jn(t,e){t&&t.push(e)}function Gft(t,e,i,r=it()){const s=t||0,n=e||0,a=i||0;return s!==0&&MC(r,r,-s/180*Math.PI),n!==0&&CC(r,r,n/180*Math.PI),a!==0&&IU(r,r,a/180*Math.PI),r}function A0(t,e,i,r,s){const n=t.minSize,a=t.maxSize;if(t.useSymbolValue){const o=r.symbolSize[i];return e.minSize[i]=o,e.maxSize[i]=o,e.offset[i]=e.minSize[i],e.factor[i]=0,e.type[i]=1,!0}if(uA(t.field))return uA(t.stops)?t.stops.length===2&&fS(t.stops[0].size)&&fS(t.stops[1].size)?(Xme(t.stops[0].size,t.stops[1].size,t.stops[0].value,t.stops[1].value,e,i),e.type[i]=1,!0):(Jn(s,"Could not convert size info: stops only supported with 2 elements"),!1):fS(n)&&fS(a)&&uA(t.minDataValue)&&uA(t.maxDataValue)?(Xme(n,a,t.minDataValue,t.maxDataValue,e,i),e.type[i]=1,!0):t.valueUnit==="unknown"?(Jn(s,"Could not convert size info: proportional size not supported"),!1):mD[t.valueUnit]!=null?(e.minSize[i]=-1/0,e.maxSize[i]=1/0,e.offset[i]=0,e.factor[i]=1/mD[t.valueUnit],e.type[i]=1,!0):(Jn(s,"Could not convert size info: scale-dependent size not supported"),!1);if(!uA(t.field)){if(t.stops?.[0]&&fS(t.stops[0].size))return e.minSize[i]=t.stops[0].size,e.maxSize[i]=t.stops[0].size,e.offset[i]=e.minSize[i],e.factor[i]=0,e.type[i]=1,!0;if(fS(n))return e.minSize[i]=n,e.maxSize[i]=n,e.offset[i]=n,e.factor[i]=0,e.type[i]=1,!0}return Jn(s,"Could not convert size info: unsupported variant of sizeInfo"),!1}function Xme(t,e,i,r,s,n){const a=Math.abs(r-i)>0?(e-t)/(r-i):0;s.minSize[n]=a>0?t:e,s.maxSize[n]=a>0?e:t,s.offset[n]=t-i*a,s.factor[n]=a}function Hft(t,e,i,r){if(t.normalizationField||t.valueRepresentation)return Jn(r,"Could not convert size info: unsupported property"),null;if(!OCe(t.field))return Jn(r,"Could not convert size info: field is not a string"),null;if(e.size){if(t.field)if(e.size.field){if(t.field!==e.size.field)return Jn(r,"Could not convert size info: multiple fields in use"),null}else e.size.field=t.field}else e.size=new Bft(t.field),de(e.size.fallback,i.fallbackSize);let s;switch(t.axis){case"width":return s=A0(t,e.size,0,i,r),s?e:null;case"height":return s=A0(t,e.size,2,i,r),s?e:null;case"depth":return s=A0(t,e.size,1,i,r),s?e:null;case"width-and-depth":return s=A0(t,e.size,0,i,r),s&&A0(t,e.size,1,i,r),s?e:null;case null:case void 0:case"all":return s=A0(t,e.size,0,i,r),s=s&&A0(t,e.size,1,i,r),s=s&&A0(t,e.size,2,i,r),s?e:null;default:return Jn(r,`Could not convert size info: unknown axis "${t.axis}""`),null}}function Wft(t,e,i){for(let s=0;s<3;++s){let n=e.unitInMeters;t.type[s]===1&&(n*=e.modelSize[s],t.type[s]=2),t.minSize[s]=t.minSize[s]/n,t.maxSize[s]=t.maxSize[s]/n,t.offset[s]=t.offset[s]/n,t.factor[s]=t.factor[s]/n}let r;if(t.type[0]!==0)r=0;else if(t.type[1]!==0)r=1;else{if(t.type[2]===0)return Jn(i,"No size axis contains a valid size or scale"),!1;r=2}for(let s=0;s<3;++s)t.type[s]===0&&(t.minSize[s]=t.minSize[r],t.maxSize[s]=t.maxSize[r],t.offset[s]=t.offset[r],t.factor[s]=t.factor[r],t.type[s]=t.type[r]);return!0}function Jme(t,e,i){t[4*e]=i.r/255,t[4*e+1]=i.g/255,t[4*e+2]=i.b/255,t[4*e+3]=i.a}function Zft(t,e,i,r){if(t.normalizationField)return Jn(r,"Could not convert color info: unsupported property"),null;if(Wv(t.field)){if(!t.stops)return Jn(r,"Could not convert color info: missing stops or colors"),null;{if(t.stops.length>8)return Jn(r,"Could not convert color info: too many color stops"),null;e.color=new Qme(t.field);const s=t.stops;for(let n=0;n<8;++n){const a=s[Math.min(n,s.length-1)];e.color.values[n]=a.value,Jme(e.color.colors,n,a.color)}jl(e.color.fallback,i.fallbackColor)}}else{if(!(t.stops&&t.stops.length>=0))return Jn(r,"Could not convert color info: no field and no colors/stops"),null;{const s=t.stops&&t.stops.length>=0&&t.stops[0].color;e.color=new Qme(null);for(let n=0;n<8;n++)e.color.values[n]=1/0,Jme(e.color.colors,n,s);jl(e.color.fallback,i.fallbackColor)}}return e}function Yft(t,e,i,r){if(t.normalizationField)return Jn(r,"Could not convert opacity info: unsupported property"),null;if(Wv(t.field)){if(!t.stops)return Jn(r,"Could not convert opacity info: missing stops or opacities"),null;{if(t.stops.length>8)return Jn(r,"Could not convert opacity info: too many opacity stops"),null;e.opacity=new jft(t.field,i.fallbackColor[3]);const s=t.stops;for(let n=0;n<8;++n){const a=s[Math.min(n,s.length-1)];e.opacity.values[n]=a.value,e.opacity.opacityValues[n]=a.opacity}}}else{if(!(t.stops&&t.stops.length>=0))return Jn(r,"Could not convert opacity info: no field and no opacities/stops"),null;{const s=t.stops&&t.stops.length>=0?t.stops[0].opacity:0;e.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0],fallback:i.fallbackColor[3]};for(let n=0;n<8;n++)e.opacity.values[n]=1/0,e.opacity.opacityValues[n]=s}}return e}function Eq(t,e,i){const r=i===2&&t.rotationType==="arithmetic";e.offset[i]=r?90:0,e.factor[i]=r?-1:1,e.type[i]=1}function Qft(t,e,i){if(!Wv(t.field))return Jn(i,"Could not convert rotation info: field is not a string"),null;if(e.rotation){if(t.field)if(e.rotation.field){if(t.field!==e.rotation.field)return Jn(i,"Could not convert rotation info: multiple fields in use"),null}else e.rotation.field=t.field}else e.rotation={field:t.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(t.axis){case"tilt":return Eq(t,e.rotation,0),e;case"roll":return Eq(t,e.rotation,1),e;case null:case void 0:case"heading":return Eq(t,e.rotation,2),e;default:return Jn(i,`Could not convert rotation info: unknown axis "${t.axis}""`),null}}let Jqt=class{constructor({supports:e,modelSize:i,symbolSize:r,unitInMeters:s,anchor:n,scale:a,rotation:o,fallbackColor:l,fallbackSize:c}){this.supports=e,this.modelSize=i??Jb(),this.symbolSize=r??Jb(),this.unitInMeters=s??1,this.anchor=n??wv(),this.scale=a??Jb(),this.rotation=o??wv(),this.fallbackColor=l??Fee(),this.fallbackSize=c??Jb()}};function zPe(t,e,i){if(!t)return null;const r=t.reduce((s,n)=>{if(!s)return s;if(n.valueExpression)return Jn(i,"Could not convert visual variables: arcade expressions not supported"),null;switch(n.type){case"size":return e.supports.size?Hft(n,s,e,i):s;case"color":return e.supports.color?Zft(n,s,e,i):s;case"opacity":return e.supports.opacity?Yft(n,s,e,i):null;case"rotation":return e.supports.rotation?Qft(n,s,i):s;default:return null}},new qft);return!(t.length>0&&r)||r.size||r.color||r.opacity||r.rotation?r?.size&&!Wft(r.size,e,i)?null:r:null}let Xft=class{constructor(e,i,r){this.visualVariables=e,this.materialParameters=i,this.requiresShaderTransformation=r}};function tGt(t,e){if(!t||Jh()||Ws.TESTS_DISABLE_FAST_UPDATES)return null;const i=zPe(t.visualVariables,e);return i?new Xft(i,NPe(i,e),!!i.size):null}function iGt(t,e,i){if(!e||!t)return!1;const r=t.visualVariables,s=zPe(e.visualVariables,i);return!!s&&!!(ML(r.size,s.size,"size")&&ML(r.color,s.color,"color")&&ML(r.rotation,s.rotation,"rotation")&&ML(r.opacity,s.opacity,"opacity"))&&(t.visualVariables=s,t.materialParameters=NPe(s,i),t.requiresShaderTransformation=!!s.size,!0)}function ML(t,e,i){if(!!t!=!!e||t&&t.field!==e?.field)return!1;if(t&&i==="rotation"){const r=t,s=e;for(let n=0;n<3;n++)if(r.type[n]!==s.type[n]||r.offset[n]!==s.offset[n]||r.factor[n]!==s.factor[n])return!1}return!0}let FPe=class extends hr{constructor(e){super(),this.vvSize=e?.size??null,this.vvColor=e?.color??null,this.vvOpacity=e?.opacity??null}get hasVVSize(){return!!this.vvSize}get hasVVColor(){return!!this.vvColor}get hasVVOpacity(){return!!this.vvOpacity}};function NPe(t,e){const i=new FPe(t);return i.vvSize&&(i.vvSymbolAnchor=e.anchor,xp(sR),Gft(e.rotation[2],e.rotation[0],e.rotation[1],sR),i.vvSymbolRotationMatrix=i.vvSymbolRotationMatrix||Ir(),jv(i.vvSymbolRotationMatrix,sR)),i}function sGt(t,e,i){if(!t.vvSize)return i;pn(O0,i);const r=t.vvSymbolRotationMatrix;return sm(sR,r[0],r[1],r[2],0,r[3],r[4],r[5],0,r[6],r[7],r[8],0,0,0,0,1),an(O0,O0,sR),VPe(Kme,t,e),r3e(O0,O0,Kme),Qh(O0,O0,t.vvSymbolAnchor),O0}function VPe(t,e,i){if(!e.vvSize)return ve(t,1,1,1),t;if(Number.isNaN(i[0]))return de(t,e.vvSize.fallback);for(let r=0;r<3;++r){const s=e.vvSize.offset[r]+i[0]*e.vvSize.factor[r];t[r]=Se(s,e.vvSize.minSize[r],e.vvSize.maxSize[r])}return t}function Aq(t,e){const i=t==null?0:e.attributes[t];return typeof i=="number"&&isFinite(i)?i:NaN}const O0=it(),Kme=R(),sR=it();function x8(t){t.vertex.code.add(E`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),t.vertex.code.add(E`vec3 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec3 params) {
return vec3(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z
);
}`),t.vertex.code.add(E`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec3 factor) {
return size * clamp(mix(factor.x, 1.0, factor.y), factor.z, 1.0);
}`),t.vertex.code.add(E`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),t.vertex.code.add(E`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec3 factor) {
return size * clamp(mix(factor.x, 1.0, factor.y), factor.z, 1.0);
}`),t.vertex.code.add(E`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function UPe(t){t.uniforms.add(new _r("screenSizePerspective",e=>BPe(e.screenSizePerspective,e.screenSizePerspectiveMinPixelReferenceSize)))}function S8(t){t.uniforms.add(new _r("screenSizePerspectiveAlignment",e=>BPe(e.screenSizePerspectiveAlignment||e.screenSizePerspective,e.screenSizePerspectiveAlignment?null:e.screenSizePerspectiveMinPixelReferenceSize)))}function BPe(t,e){const i=e!=null&&t!=null?Math.min(t.minPixelSize/e,1):0;return t?ve(ege,t.divisor,t.offset,i):ve(ege,0,0,0)}const ege=R();let Zh=class extends Ni{constructor(e,i,r){super(e,"vec3",2,(s,n,a,o)=>s.setUniform3fv(e,i(n,a,o),r))}},ws=class extends Ni{constructor(e,i,r){super(e,"float",0,(s,n)=>s.setUniform1f(e,i(n),r))}},Fie=class extends Ni{constructor(e,i,r){super(e,"mat4",2,(s,n,a)=>s.setUniformMatrix4fv(e,i(n,a),r))}};function xy(t,e){e.instancedDoublePrecision?t.constants.add("cameraPosition","vec3",Kn):t.uniforms.add(new Zh("cameraPosition",(i,r)=>ve(jPe,r.camera.viewInverseTransposeMatrix[3]-i.origin[0],r.camera.viewInverseTransposeMatrix[7]-i.origin[1],r.camera.viewInverseTransposeMatrix[11]-i.origin[2])))}function jg(t,e){if(!e.instancedDoublePrecision)return void t.uniforms.add(new Io("proj",r=>r.camera.projectionMatrix),new Fie("view",(r,s)=>Qh(tge,s.camera.viewMatrix,r.origin)),new Zh("localOrigin",r=>r.origin));const i=({camera:r})=>ve(jPe,r.viewInverseTransposeMatrix[3],r.viewInverseTransposeMatrix[7],r.viewInverseTransposeMatrix[11]);t.uniforms.add(new Io("proj",r=>r.camera.projectionMatrix),new Io("view",r=>Qh(tge,r.camera.viewMatrix,i(r))),new co("localOrigin",r=>i(r)))}const tge=it(),jPe=R();function Nie(t){t.uniforms.add(new Io("viewNormal",e=>e.camera.viewInverseTransposeMatrix))}function S4(t){t.uniforms.add(new ws("pixelRatio",e=>e.camera.pixelRatio/e.overlayStretch))}let Xn=class extends Ni{constructor(e,i,r){super(e,"vec4",1,(s,n,a)=>s.setUniform4fv(e,i(n,a),r))}},cGt=class{constructor(e){this.screenLength=Bx(e.screenLength),this.minWorldLength=e.minWorldLength??0,this.maxWorldLength=e.maxWorldLength??1/0}};function qPe(t,e){const i=t.vertex;e.hasVerticalOffset?(GPe(i),e.hasScreenSizePerspective&&(t.include(x8),S8(i),xy(t.vertex,e)),i.code.add(E`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${e.spherical?E`vec3 worldNormal = normalize(worldPos + localOrigin);`:E`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${e.hasScreenSizePerspective?E`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:E`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):i.code.add(E`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}const Jft=ri();function GPe(t){t.uniforms.add(new Xn("verticalOffset",(e,i)=>{const{minWorldLength:r,maxWorldLength:s,screenLength:n}=e.verticalOffset,a=Math.tan(.5*i.camera.fovY)/(.5*i.camera.fullViewport[3]),o=i.camera.pixelRatio||1;return yr(Jft,n*o,a,r,s)}))}let ao=class extends Ni{constructor(e,i,r){super(e,"vec4",0,(s,n)=>s.setUniform4fv(e,i(n),r))}};const HPe=.5;function WPe(t,e){t.include(x8),t.attributes.add("position","vec3"),t.attributes.add("normal","vec3"),t.attributes.add("centerOffsetAndDistance","vec4");const i=t.vertex;jg(i,e),xy(i,e),i.uniforms.add(new ao("viewport",r=>r.camera.fullViewport),new ut("polygonOffset",r=>r.shaderPolygonOffset),new ws("cameraGroundRelative",r=>r.camera.aboveGround?1:-1)),e.hasVerticalOffset&&GPe(i),i.code.add(E`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),i.code.add(E`
    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
      float pointGroundSign = ${e.terrainDepthTest?E.float(0):E`sign(pointGroundDistance)`};
      if (pointGroundSign == 0.0) {
        pointGroundSign = cameraGroundRelative;
      }

      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground
      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise
      float groundRelative = cameraGroundRelative * pointGroundSign;

      // view angle dependent part of polygon offset emulation: we take the absolute value because the sign that is
      // dropped is instead introduced using the ground-relative position of the symbol and the camera
      if (polygonOffset > .0) {
        float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
        float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
        float factor = (1.0 - tanAlpha / viewport[2]);

        // same side of the terrain
        if (groundRelative > 0.0) {
          posView *= factor;
        }
        // opposite sides of the terrain
        else {
          posView /= factor;
        }
      }

      return groundRelative;
    }
  `),e.draped&&!e.hasVerticalOffset||Nie(i),e.draped||(i.uniforms.add(new ws("perDistancePixelRatio",r=>Math.tan(r.camera.fovY/2)/(r.camera.fullViewport[2]/2))),i.code.add(E`
    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
      float distanceToCamera = length(posView);

      // Compute offset in world units for a half pixel shift
      float pixelOffset = distanceToCamera * perDistancePixelRatio * ${E.float(HPe)};

      // Apply offset along normal in the direction away from the ground surface
      vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;

      // Apply the same offset also on the view space position
      vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;

      posModel += modelOffset;
      posView += viewOffset;
    }
  `)),e.screenCenterOffsetUnitsEnabled&&S4(i),e.hasScreenSizePerspective&&S8(i),i.code.add(E`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      vec3 centerOffset = centerOffsetAndDistance.xyz;
      float pointGroundDistance = centerOffsetAndDistance.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${e.draped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${e.hasScreenSizePerspective&&(e.hasVerticalOffset||e.screenCenterOffsetUnitsEnabled)?"vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${e.hasVerticalOffset?e.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${e.hasVerticalOffset?E`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${e.screenCenterOffsetUnitsEnabled?"":E`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${e.screenCenterOffsetUnitsEnabled?e.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${e.screenCenterOffsetUnitsEnabled?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `)}let Vie=class{constructor(e){this._material=e.material,this._techniques=e.techniques,this._output=e.output}dispose(){}get _stippleTextures(){return this._techniques.context?.stippleTextures}get _markerTextures(){return this._techniques.context?.markerTextures}getTechnique(e,i){return this._techniques.get(e,this._material.getConfiguration(this._output,i))}ensureResources(e){return 2}},ZPe=class extends Vie{constructor(e){super(e),this._numLoading=0,this._disposed=!1,this._textures=e.textures,this.updateTexture(e.textureId),this._acquire(e.normalTextureId,i=>this._textureNormal=i),this._acquire(e.emissiveTextureId,i=>this._textureEmissive=i),this._acquire(e.occlusionTextureId,i=>this._textureOcclusion=i),this._acquire(e.metallicRoughnessTextureId,i=>this._textureMetallicRoughness=i)}dispose(){super.dispose(),this._texture=Sr(this._texture),this._textureNormal=Sr(this._textureNormal),this._textureEmissive=Sr(this._textureEmissive),this._textureOcclusion=Sr(this._textureOcclusion),this._textureMetallicRoughness=Sr(this._textureMetallicRoughness),this._disposed=!0}ensureResources(e){return this._numLoading===0?2:1}get textureBindParameters(){return new YPe(this._texture?.glTexture??null,this._textureNormal?.glTexture??null,this._textureEmissive?.glTexture??null,this._textureOcclusion?.glTexture??null,this._textureMetallicRoughness?.glTexture??null)}updateTexture(e){this._texture!=null&&e===this._texture.id||(this._texture=Sr(this._texture),this._acquire(e,i=>this._texture=i))}_acquire(e,i){if(e==null)return void i(null);const r=this._textures.acquire(e);if($a(r))return++this._numLoading,void r.then(s=>{if(this._disposed)return Sr(s),void i(null);i(s)}).finally(()=>--this._numLoading);i(r)}},Kft=class extends hr{constructor(e=null){super(),this.textureEmissive=e}},YPe=class extends Kft{constructor(e,i,r,s,n,a,o){super(r),this.texture=e,this.textureNormal=i,this.textureOcclusion=s,this.textureMetallicRoughness=n,this.scale=a,this.normalTextureTransformMatrix=o}},emt=class extends Fo{constructor(){super(...arguments),this.instancedDoublePrecision=!1,this.hasModelTransformation=!1}},op=class extends emt{constructor(){super(...arguments),this.output=0,this.oitPass=0,this.hasSlicePlane=!1,this.hasHighlightMixTexture=!1,this.bindType=1,this.instanced=!1,this.writeDepth=!0}};d([oe({count:11})],op.prototype,"output",void 0),d([oe({count:3})],op.prototype,"oitPass",void 0),d([oe()],op.prototype,"hasSlicePlane",void 0),d([oe()],op.prototype,"hasHighlightMixTexture",void 0);function QPe(t,e,i,r,s,n){let a=i.screenLength*t.pixelRatio;s!=null&&(rge.update(r,e,s,n),a=rge.apply(a));const o=a*Math.tan(.5*t.fovY)/(.5*t.fullHeight);return Se(o*e,i.minWorldLength,i.maxWorldLength)}const tmt=b8e();function ige(t,e){let i=!1;for(const r in e){const s=e[r];s!==void 0&&(Array.isArray(s)?Array.isArray(t[r])&&tmt(s,t[r])||(t[r]=s.slice(),i=!0):t[r]!==s&&(i=!0,t[r]=s))}return i}const nR={multiply:1,ignore:2,replace:3,tint:4},rge=new hX;let T8=class{constructor(e,i){this.id=ql(),this.supportsEdges=!1,this._renderPriority=0,this._parameters=new i,ige(this._parameters,e),this.validateParameters(this._parameters)}get parameters(){return this._parameters}update(e){return!1}setParameters(e,i=!0){ige(this._parameters,e)&&(this.validateParameters(this._parameters),i&&this._parametersChanged())}validateParameters(e){}shouldRender(e){return this.visible&&this.isVisibleForOutput(e.output)&&(!this.parameters.isDecoration||e.bind.decorations)&&(this.parameters.renderOccluded&e.renderOccludedMask)!==0}isVisibleForOutput(e){return!0}get renderPriority(){return this._renderPriority}set renderPriority(e){e!==this._renderPriority&&(this._renderPriority=e,this._parametersChanged())}_parametersChanged(){this.repository?.materialChanged(this)}get renderOccludedFlags(){return this.visible?this.parameters.renderOccluded:0}get hasEmissions(){return!1}getConfiguration(e,i,r=new op){return r.output=e,r.hasHighlightMixTexture=e===9&&i.highlightMixTexture!=null,r}},imt=class extends hr{constructor(){super(...arguments),this.renderOccluded=1,this.isDecoration=!1}};function rmt(t,e,i,r=1){const{data:s,indices:n}=t,a=e.typedBuffer,o=e.typedBufferStride,l=n.length;if(i*=o,r===1)for(let c=0;c<l;++c)a[i]=s[n[c]],i+=o;else for(let c=0;c<l;++c){const h=s[n[c]];for(let f=0;f<r;f++)a[i]=h,i+=o}}function aR(t,e,i){const{data:r,indices:s}=t,n=e.typedBuffer,a=e.typedBufferStride,o=s.length;i*=a;for(let l=0;l<o;++l){const c=2*s[l];n[i]=r[c],n[i+1]=r[c+1],i+=a}}function Uie(t,e,i,r=1){const{data:s,indices:n}=t,a=e.typedBuffer,o=e.typedBufferStride,l=n.length;if(i*=o,r===1)for(let c=0;c<l;++c){const h=3*n[c];a[i]=s[h],a[i+1]=s[h+1],a[i+2]=s[h+2],i+=o}else for(let c=0;c<l;++c){const h=3*n[c];for(let f=0;f<r;++f)a[i]=s[h],a[i+1]=s[h+1],a[i+2]=s[h+2],i+=o}}function gD(t,e,i,r=1){const{data:s,indices:n}=t,a=e.typedBuffer,o=e.typedBufferStride,l=n.length;if(i*=o,r===1)for(let c=0;c<l;++c){const h=4*n[c];a[i]=s[h],a[i+1]=s[h+1],a[i+2]=s[h+2],a[i+3]=s[h+3],i+=o}else for(let c=0;c<l;++c){const h=4*n[c];for(let f=0;f<r;++f)a[i]=s[h],a[i+1]=s[h+1],a[i+2]=s[h+2],a[i+3]=s[h+3],i+=o}}function sge(t,e,i){const r=t.typedBuffer,s=t.typedBufferStride;e*=s;for(let n=0;n<i;++n)r[e]=0,r[e+1]=0,r[e+2]=0,r[e+3]=0,e+=s}function Bie(t,e,i,r,s=1){if(!e)return void Uie(t,i,r,s);const{data:n,indices:a}=t,o=i.typedBuffer,l=i.typedBufferStride,c=a.length,h=e[0],f=e[1],y=e[2],_=e[4],w=e[5],x=e[6],S=e[8],$=e[9],A=e[10],M=e[12],P=e[13],O=e[14];r*=l;let D=0,L=0,F=0;const U=zU(e)?N=>{D=n[N]+M,L=n[N+1]+P,F=n[N+2]+O}:N=>{const j=n[N],B=n[N+1],Y=n[N+2];D=h*j+_*B+S*Y+M,L=f*j+w*B+$*Y+P,F=y*j+x*B+A*Y+O};if(s===1)for(let N=0;N<c;++N)U(3*a[N]),o[r]=D,o[r+1]=L,o[r+2]=F,r+=l;else for(let N=0;N<c;++N){U(3*a[N]);for(let j=0;j<s;++j)o[r]=D,o[r+1]=L,o[r+2]=F,r+=l}}function jie(t,e,i,r,s=1){if(!e)return void Uie(t,i,r,s);const{data:n,indices:a}=t,o=e,l=i.typedBuffer,c=i.typedBufferStride,h=a.length,f=o[0],y=o[1],_=o[2],w=o[4],x=o[5],S=o[6],$=o[8],A=o[9],M=o[10],P=!Dee(o),O=1e-6,D=1-O;r*=c;let L=0,F=0,U=0;const N=zU(o)?j=>{L=n[j],F=n[j+1],U=n[j+2]}:j=>{const B=n[j],Y=n[j+1],G=n[j+2];L=f*B+w*Y+$*G,F=y*B+x*Y+A*G,U=_*B+S*Y+M*G};if(s===1)if(P)for(let j=0;j<h;++j){N(3*a[j]);const B=L*L+F*F+U*U;if(B<D&&B>O){const Y=1/Math.sqrt(B);l[r]=L*Y,l[r+1]=F*Y,l[r+2]=U*Y}else l[r]=L,l[r+1]=F,l[r+2]=U;r+=c}else for(let j=0;j<h;++j)N(3*a[j]),l[r]=L,l[r+1]=F,l[r+2]=U,r+=c;else for(let j=0;j<h;++j){if(N(3*a[j]),P){const B=L*L+F*F+U*U;if(B<D&&B>O){const Y=1/Math.sqrt(B);L*=Y,F*=Y,U*=Y}}for(let B=0;B<s;++B)l[r]=L,l[r+1]=F,l[r+2]=U,r+=c}}function smt(t,e,i,r,s=1){if(!e)return void gD(t,i,r,s);const{data:n,indices:a}=t,o=e,l=i.typedBuffer,c=i.typedBufferStride,h=a.length,f=o[0],y=o[1],_=o[2],w=o[4],x=o[5],S=o[6],$=o[8],A=o[9],M=o[10],P=!Dee(o),O=1e-6,D=1-O;if(r*=c,s===1)for(let L=0;L<h;++L){const F=4*a[L],U=n[F],N=n[F+1],j=n[F+2],B=n[F+3];let Y=f*U+w*N+$*j,G=y*U+x*N+A*j,Z=_*U+S*N+M*j;if(P){const H=Y*Y+G*G+Z*Z;if(H<D&&H>O){const Q=1/Math.sqrt(H);Y*=Q,G*=Q,Z*=Q}}l[r]=Y,l[r+1]=G,l[r+2]=Z,l[r+3]=B,r+=c}else for(let L=0;L<h;++L){const F=4*a[L],U=n[F],N=n[F+1],j=n[F+2],B=n[F+3];let Y=f*U+w*N+$*j,G=y*U+x*N+A*j,Z=_*U+S*N+M*j;if(P){const H=Y*Y+G*G+Z*Z;if(H<D&&H>O){const Q=1/Math.sqrt(H);Y*=Q,G*=Q,Z*=Q}}for(let H=0;H<s;++H)l[r]=Y,l[r+1]=G,l[r+2]=Z,l[r+3]=B,r+=c}}function XPe(t,e,i,r,s=1){const{data:n,indices:a}=t,o=i.typedBuffer,l=i.typedBufferStride,c=a.length;if(r*=l,e===n.length&&e===4){o[r]=n[0],o[r+1]=n[1],o[r+2]=n[2],o[r+3]=n[3];const h=new Uint32Array(i.typedBuffer.buffer,i.start),f=l/4,y=h[r/=4];r+=f;const _=c*s;for(let w=1;w<_;++w)h[r]=y,r+=f;return}if(s!==1)if(e!==4)for(let h=0;h<c;++h){const f=3*a[h];for(let y=0;y<s;++y)o[r]=n[f],o[r+1]=n[f+1],o[r+2]=n[f+2],o[r+3]=255,r+=l}else for(let h=0;h<c;++h){const f=4*a[h];for(let y=0;y<s;++y)o[r]=n[f],o[r+1]=n[f+1],o[r+2]=n[f+2],o[r+3]=n[f+3],r+=l}else{if(e===4){for(let h=0;h<c;++h){const f=4*a[h];o[r]=n[f],o[r+1]=n[f+1],o[r+2]=n[f+2],o[r+3]=n[f+3],r+=l}return}for(let h=0;h<c;++h){const f=3*a[h];o[r]=n[f],o[r+1]=n[f+1],o[r+2]=n[f+2],o[r+3]=255,r+=l}}}function nmt(t,e,i){const{data:r,indices:s}=t,n=e.typedBuffer,a=e.typedBufferStride,o=s.length,l=r[0];i*=a;for(let c=0;c<o;++c)n[i]=l,i+=a}function nge(t,e,i,r){Ce(O1,t,e);const s=Math.max(Math.sqrt(Le(O1)),1e-4);le(O1,O1,1/s),i[r++]=O1[0],i[r++]=O1[1],i[r++]=O1[2],i[r++]=s}const O1=R();function JPe(t,e,i,r,s=1){const n=e.typedBuffer,a=e.typedBufferStride;if(r*=a,s===1)for(let o=0;o<i;++o)n[r]=t[0],n[r+1]=t[1],n[r+2]=t[2],n[r+3]=t[3],r+=a;else for(let o=0;o<i;++o)for(let l=0;l<s;++l)n[r]=t[0],n[r+1]=t[1],n[r+2]=t[2],n[r+3]=t[3],r+=a}function amt(t,e,i,r,s,n,a){let o={numItems:0,numVerticesPerItem:0};for(const l of i.fields.keys()){const c=t.get(l),h=c?.indices;if(c&&h)l==="position"&&(o={numItems:1,numVerticesPerItem:h.length}),omt(l,c,r,s,n,a);else if(l==="olidColor"&&e!=null){const f=t.get("position")?.indices;if(f){const y=f.length;JPe(e,n.getField(l,Bu),y,a)}}}return o}function omt(t,e,i,r,s,n){switch(t){case"position":{dt(e.size===3);const a=s.getField(t,Z_);dt(!!a,`No buffer view for ${t}`),Bie(e,i,a,n);break}case"normal":{dt(e.size===3);const a=s.getField(t,Z_);dt(!!a,`No buffer view for ${t}`),jie(e,r,a,n);break}case"normalCompressed":case"profileRight":case"profileUp":{dt(e.size===2);const a=s.getField(t,O6);dt(!!a,`No buffer view for ${t}`),aR(e,a,n);break}case"uv0":{dt(e.size===2);const a=s.getField(t,XAe)??s.getField(t,E6);dt(!!a,`No buffer view for ${t}`),aR(e,a,n);break}case"uvi":{dt(e.size===2);const a=s.getField(t,O6);dt(!!a,`No buffer view for ${t}`),aR(e,a,n);break}case"color":case"symbolColor":{const a=s.getField(t,Bu);dt(!!a,`No buffer view for ${t}`),dt(e.size===3||e.size===4),XPe(e,e.size,a,n);break}case"colorFeatureAttribute":case"opacityFeatureAttribute":case"sizeFeatureAttribute":{const a=s.getField(t,oD)??s.getField(t,oD);dt(!!a,`No buffer view for ${t}`),dt(e.size===1),nmt(e,a,n);break}case"tangent":{dt(e.size===4);const a=s.getField(t,Yx);dt(!!a,`No buffer view for ${t}`),smt(e,i,a,n);break}case"profileVertexAndNormal":{dt(e.size===4);const a=s.getField(t,KAe)??s.getField(t,Yx);dt(!!a,`No buffer view for ${t}`),gD(e,a,n);break}case"profileAuxData":{dt(e.size===3);const a=s.getField(t,JAe)??s.getField(t,Z_);dt(!!a,`No buffer view for ${t}`),Uie(e,a,n);break}}}let bGt=class extends hr{constructor(e){super(),this.slicePlaneLocalOrigin=e}};function lmt(t,e){tRe(t,e,new _r("slicePlaneOrigin",(i,r)=>qie(e,i,r)),new _r("slicePlaneBasis1",(i,r)=>jC(e,i,r,r.slicePlane?.basis1)),new _r("slicePlaneBasis2",(i,r)=>jC(e,i,r,r.slicePlane?.basis2)))}function I_(t,e){tRe(t,e,new Zh("slicePlaneOrigin",(i,r)=>qie(e,i,r)),new Zh("slicePlaneBasis1",(i,r)=>jC(e,i,r,r.slicePlane?.basis1)),new Zh("slicePlaneBasis2",(i,r)=>jC(e,i,r,r.slicePlane?.basis2)))}function KPe(t,e){eRe(t,e,new Zh("slicePlaneOrigin",(i,r)=>qie(e,i,r)),new Zh("slicePlaneBasis1",(i,r)=>jC(e,i,r,r.slicePlane?.basis1)),new Zh("slicePlaneBasis2",(i,r)=>jC(e,i,r,r.slicePlane?.basis2)))}const cmt=E`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
bool rejectBySlice(vec3 pos) {
return sliceByPlane(pos);
}`;function eRe(t,e,...i){e.hasSlicePlane?(t.uniforms.add(...i),t.code.add(cmt)):t.code.add("bool rejectBySlice(vec3 pos) { return false; }")}function tRe(t,e,...i){eRe(t,e,...i),e.hasSlicePlane?t.code.add(`
    void discardBySlice(vec3 pos) {
      if (sliceByPlane(pos)) {
        discard;
      }
    }

    vec4 applySliceOutline(vec4 color, vec3 pos) {
      SliceFactors factors = calculateSliceFactors(pos);

      factors.front /= 2.0 * fwidth(factors.front);
      factors.side0 /= 2.0 * fwidth(factors.side0);
      factors.side1 /= 2.0 * fwidth(factors.side1);
      factors.side2 /= 2.0 * fwidth(factors.side2);
      factors.side3 /= 2.0 * fwidth(factors.side3);

      // return after calling fwidth, to avoid aliasing caused by discontinuities in the input to fwidth
      if (sliceByFactors(factors)) {
        return color;
      }

      float outlineFactor = (1.0 - step(0.5, factors.front))
        * (1.0 - step(0.5, factors.side0))
        * (1.0 - step(0.5, factors.side1))
        * (1.0 - step(0.5, factors.side2))
        * (1.0 - step(0.5, factors.side3));

      return mix(color, vec4(vec3(0.0), color.a), outlineFactor * 0.3);
    }

    vec4 applySlice(vec4 color, vec3 pos) {
      return sliceEnabled() ? applySliceOutline(color, pos) : color;
    }
  `):t.code.add(E`void discardBySlice(vec3 pos) { }
vec4 applySlice(vec4 color, vec3 pos) { return color; }`)}function iRe(t,e,i){return t.instancedDoublePrecision?ve(umt,i.camera.viewInverseTransposeMatrix[3],i.camera.viewInverseTransposeMatrix[7],i.camera.viewInverseTransposeMatrix[11]):e.slicePlaneLocalOrigin}function rRe(t,e){return t!=null?Ce(iV,e.origin,t):e.origin}function sRe(t,e,i){return t.hasSliceTranslatedView?e!=null?Qh(hmt,i.camera.viewMatrix,e):i.camera.viewMatrix:null}function qie(t,e,i){if(i.slicePlane==null)return Kn;const r=iRe(t,e,i),s=rRe(r,i.slicePlane),n=sRe(t,r,i);return n!=null?Mt(iV,s,n):s}function jC(t,e,i,r){if(r==null||i.slicePlane==null)return Kn;const s=iRe(t,e,i),n=rRe(s,i.slicePlane),a=sRe(t,s,i);return a!=null?(xe(hA,r,n),Mt(iV,n,a),Mt(hA,hA,a),Ce(hA,hA,iV)):r}const umt=R(),iV=R(),hA=R(),hmt=it();function Gie(t,e){if(e.output!==10)return t.vertex.code.add(E`void forwardObjectAndLayerIdColor() {}`),void t.fragment.code.add(E`void outputObjectAndLayerIdColor() {}`);const i=e.instanced;t.varyings.add("objectAndLayerIdColorVarying","vec4");const r=i?"instanceOlidColor":"olidColor";t.attributes.add(r,"vec4"),t.vertex.code.add(E`
    void forwardObjectAndLayerIdColor() {
      objectAndLayerIdColorVarying = ${r} * 0.003921568627451;
    }`),t.fragment.code.add(E`void outputObjectAndLayerIdColor() {
fragColor = objectAndLayerIdColorVarying;
}`)}let rV=class extends Ni{constructor(e,i){super(e,"bool",0,(r,s)=>r.setUniform1b(e,i(s)))}};function $8(t){t.uniforms.add(new rV("alignPixelEnabled",e=>e.alignPixelEnabled)),t.code.add(E`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`),t.code.add(E`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`)}let Sy=class extends Ni{constructor(e,i,r){super(e,"vec2",0,(s,n)=>s.setUniform2fv(e,i(n),r))}};function rd(t){t.uniforms.add(new Sy("zProjectionMap",e=>dmt(e.camera))),t.code.add(E`float linearizeDepth(float depth) {
float depthNdc = depth * 2.0 - 1.0;
float c1 = zProjectionMap[0];
float c2 = zProjectionMap[1];
return -(c1 / (depthNdc + c2 + 1e-7));
}`),t.code.add(E`float delinearizeDepth(float linearDepth) {
float c1 = zProjectionMap[0];
float c2 = zProjectionMap[1];
float depthNdc = (-c1/linearDepth) - c2 - 1e-7;
float depthNonlinear01 = (depthNdc + 1.0 ) / 2.0;
return depthNonlinear01;
}`),t.code.add(E`float depthFromTexture(sampler2D depthTexture, vec2 uv) {
ivec2 iuv = ivec2(uv * vec2(textureSize(depthTexture, 0)));
float depth = texelFetch(depthTexture, iuv, 0).r;
return depth;
}`),t.code.add(E`float linearDepthFromTexture(sampler2D depthTexture, vec2 uv) {
return linearizeDepth(depthFromTexture(depthTexture, uv));
}`)}function dmt(t){const e=t.projectionMatrix;return Cr(pmt,e[14],e[10])}const pmt=pt();let po=class extends Ni{constructor(e,i){super(e,"sampler2D",0,(r,s)=>r.bindTexture(e,i(s)))}};function T4(t,{occlusionPass:e,terrainDepthTest:i,cullAboveTerrain:r}){const{vertex:s,fragment:n,varyings:a}=t;if(!i)return s.code.add("void forwardViewPosDepth(vec3 pos) {}"),void n.code.add(`${e?"bool":"void"} discardByTerrainDepth() { ${_e(e,"return false;")}}`);a.add("viewPosDepth","float",{invariant:!0}),s.code.add(`void forwardViewPosDepth(vec3 pos) {
    viewPosDepth = pos.z;
  }`),n.include(rd),n.uniforms.add(new po("terrainDepthTexture",o=>o.terrainDepth?.attachment)).code.add(E`
    ${e?"bool":"void"} discardByTerrainDepth() {
      float depth = texelFetch(terrainDepthTexture, ivec2(gl_FragCoord.xy), 0).r;
      float linearDepth = linearizeDepth(depth);
      ${e?"return viewPosDepth < linearDepth && depth < 1.0;":`if(viewPosDepth ${r?">":"<="} linearDepth) discard;`}
    }`)}function fmt(t,e){const{vertex:i,fragment:r}=t;t.include(T4,e),i.include($8),i.main.add(E`vec4 posProjCenter;
if (dot(position, position) > 0.0) {
ProjectHUDAux projectAux;
vec4 posProj = projectPositionHUD(projectAux);
posProjCenter = alignToPixelCenter(posProj, viewport.zw);
forwardViewPosDepth(projectAux.posView);
vec3 vpos = projectAux.posModel;
if (rejectBySlice(vpos)) {
posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
}
} else {
posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
}
gl_Position = posProjCenter;
gl_PointSize = 1.0;`),r.main.add(E`fragColor = vec4(1);
if(discardByTerrainDepth()) {
fragColor.g = 0.5;
}`)}function nRe(t){t.vertex.uniforms.add(new ws("renderTransparentlyOccludedHUD",e=>e.hudRenderStyle===0?1:e.hudRenderStyle===1?0:.75),new ao("viewport",e=>e.camera.fullViewport),new po("hudVisibilityTexture",e=>e.hudVisibility?.getTexture())),t.vertex.include($8),t.vertex.code.add(E`bool testHUDVisibility(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}function Hie(t){const{fragment:e}=t;e.code.add(E`uint readChannelBits(uint channel, int highlightLevel) {
int llc = (highlightLevel & 3) << 1;
return (channel >> llc) & 3u;
}
uint readChannel(uvec2 texel, int highlightLevel) {
int lic = (highlightLevel >> 2) & 1;
return texel[lic];
}
uint readLevelBits(uvec2 texel, int highlightLevel) {
return readChannelBits(readChannel(texel, highlightLevel), highlightLevel);
}`)}let mmt=class extends Ni{constructor(e,i){super(e,"ivec2",0,(r,s)=>r.setUniform2iv(e,i(s)))}},aRe=class extends Ni{constructor(e,i){super(e,"int",0,(r,s)=>r.setUniform1i(e,i(s)))}},gmt=class extends Ni{constructor(e,i){super(e,"usampler2D",0,(r,s)=>r.bindTexture(e,i(s)))}};function CM(t,e){const{fragment:i}=t,{output:r,draped:s,hasHighlightMixTexture:n}=e;r===9?(i.uniforms.add(new aRe("highlightLevel",a=>a.highlightLevel??0),new mmt("highlightMixOrigin",a=>a.highlightMixOrigin)),t.outputs.add("fragHighlight","uvec2",0),t.include(Hie),n?i.uniforms.add(new gmt("highlightMixTexture",a=>a.highlightMixTexture)).code.add(E`uvec2 getAccumulatedHighlight() {
return texelFetch(highlightMixTexture, ivec2(gl_FragCoord.xy) - highlightMixOrigin, 0).rg;
}
void outputHighlight(bool occluded) {
if (highlightLevel == 0) {
uint bits = occluded ? 3u : 1u;
fragHighlight = uvec2(bits, 0);
} else {
int ll = (highlightLevel & 3) << 1;
int li = (highlightLevel >> 2) & 3;
uint bits;
if (occluded) {
bits = 3u << ll;
} else {
bits = 1u << ll;
}
uvec2 combinedHighlight = getAccumulatedHighlight();
combinedHighlight[li] |= bits;
fragHighlight = combinedHighlight;
}
}`):i.code.add(E`void outputHighlight(bool occluded) {
uint bits = occluded ? 3u : 1u;
fragHighlight = uvec2(bits, 0);
}`),s?i.code.add(E`bool isHighlightOccluded() {
return false;
}`):i.uniforms.add(new po("depthTexture",a=>a.mainDepth)).code.add(E`bool isHighlightOccluded() {
float sceneDepth = texelFetch(depthTexture, ivec2(gl_FragCoord.xy), 0).x;
return gl_FragCoord.z > sceneDepth + 5e-7;
}`),i.code.add(E`void calculateOcclusionAndOutputHighlight() {
outputHighlight(isHighlightOccluded());
}`)):i.code.add(E`void calculateOcclusionAndOutputHighlight() {}`)}function Kv(t){t.code.add(E`struct MaskedColor {
vec4 color;
bvec4 mask;
};`)}function oRe(t){t.include(Kv),t.code.add(E`
    MaskedColor createMaskedFromUInt8NaNColor(vec4 color) {
      return MaskedColor(color * ${E.float(1/254)}, equal(color, vec4(255)));
    }
  `)}function Wie(t){t.include(Kv),t.code.add(E`vec4 maskedColorSelectOrOne(MaskedColor color) {
return vec4(
color.mask.r ? 1.0 : color.color.r,
color.mask.g ? 1.0 : color.color.g,
color.mask.b ? 1.0 : color.color.b,
color.mask.a ? 1.0 : color.color.a
);
}
MaskedColor multiplyMaskedColors(MaskedColor color1, MaskedColor color2) {
vec4 masked1 = maskedColorSelectOrOne(color1);
vec4 masked2 = maskedColorSelectOrOne(color2);
return MaskedColor(masked1 * masked2, bvec4(ivec4(color1.mask) & ivec4(color2.mask)));
}`)}function Zie(t){t.include(Kv),t.code.add(E`MaskedColor createMaskedFromNaNColor(vec4 color) {
return MaskedColor(color, isnan(color));
}`)}let ymt=class extends Ni{constructor(e,i,r,s){super(e,"vec4",1,(n,a,o)=>n.setUniform4fv(e,i(a,o),s),r)}},Rc=class extends Ni{constructor(e,i,r,s){super(e,"float",1,(n,a,o)=>n.setUniform1fv(e,i(a,o),s),r)}},_mt=class extends FPe{constructor(){super(...arguments),this.renderOccluded=1,this.isDecoration=!1}};const Oq=8;function Rw(t,e){const{vertex:i,attributes:r}=t;e.hasVVInstancing&&(e.hasVVSize||e.hasVVColor)&&r.add("instanceFeatureAttribute","vec4"),e.hasVVSize?(i.uniforms.add(new _r("vvSizeMinSize",s=>s.vvSize.minSize)),i.uniforms.add(new _r("vvSizeMaxSize",s=>s.vvSize.maxSize)),i.uniforms.add(new _r("vvSizeOffset",s=>s.vvSize.offset)),i.uniforms.add(new _r("vvSizeFactor",s=>s.vvSize.factor)),i.uniforms.add(new _r("vvSizeFallback",s=>s.vvSize.fallback)),i.uniforms.add(new Ap("vvSymbolRotationMatrix",s=>s.vvSymbolRotationMatrix)),i.uniforms.add(new _r("vvSymbolAnchor",s=>s.vvSymbolAnchor)),i.code.add(E`vec3 vvScale(vec4 _featureAttribute) {
if (isnan(_featureAttribute.x)) {
return vvSizeFallback;
}
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),i.code.add(E`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 scale = max(vvScale(_featureAttribute), eps);
        return vec4(vvSymbolRotationMatrix * _normal / scale, 1.0);
      }

      ${e.hasVVInstancing?E`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):i.code.add(E`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),t.vertex.include(Kv),e.hasVVColor?(i.constants.add("vvColorNumber","int",Oq),i.uniforms.add(new Rc("vvColorValues",s=>s.vvColor.values,Oq),new ymt("vvColorColors",s=>s.vvColor.colors,Oq),new Xn("vvColorFallback",s=>s.vvColor.fallback,{supportsNaN:!0})),e.hasVVInstancing&&(t.vertex.include(Wie),t.vertex.include(Zie)),i.code.add(E`
      vec4 interpolateVVColor(float value) {
        if (isnan(value)) {
          return vvColorFallback;
        }

        if (value <= vvColorValues[0]) {
          return vvColorColors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (vvColorValues[i] >= value) {
            float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
            return mix(vvColorColors[i-1], vvColorColors[i], f);
          }
        }
        return vvColorColors[vvColorNumber - 1];
      }

      vec4 vvGetColor(vec4 featureAttribute) {
        return interpolateVVColor(featureAttribute.y);
      }

      ${e.hasVVInstancing?E`
            vec4 vvColor() {
              return vvGetColor(instanceFeatureAttribute);
            }

            MaskedColor applyVVColor(MaskedColor color) {
              return multiplyMaskedColors(color, createMaskedFromNaNColor(vvColor()));
            }
            `:E`
            vec4 vvColor() {
              return vec4(1.0);
            }

            MaskedColor applyVVColor(MaskedColor color) {
              return color;
            }
            `}
    `)):i.code.add(E`vec4 vvColor() {
return vec4(1.0);
}
MaskedColor applyVVColor(MaskedColor color) {
return color;
}`)}function MM(t){t.code.add(E`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}let yD=class extends Ni{constructor(e,i,r){super(e,"vec4",2,(s,n,a)=>s.setUniform4fv(e,i(n,a),r))}};const Gr=1/255.5;function lRe(t){const e=new Di,{signedDistanceFieldEnabled:i,occlusionTestEnabled:r,horizonCullingEnabled:s,pixelSnappingEnabled:n,hasScreenSizePerspective:a,debugDrawLabelBorder:o,hasVVSize:l,hasVVColor:c,hasRotation:h,occludedFragmentFade:f,sampleSignedDistanceFieldTexelCenter:y}=t;e.include(WPe,t),e.vertex.include(KPe,t);const{occlusionPass:_,output:w,oitPass:x}=t;if(_)return e.include(fmt,t),e;const{vertex:S,fragment:$}=e;e.include(x8),e.include(Rw,t),e.include(Gie,t),r&&e.include(nRe),$.include(MM),e.varyings.add("vcolor","vec4"),e.varyings.add("vtc","vec2"),e.varyings.add("vsize","vec2");const A=w===9,M=A&&r;M&&e.varyings.add("voccluded","float"),S.uniforms.add(new ao("viewport",F=>F.camera.fullViewport),new ll("screenOffset",(F,U)=>Cr(hF,2*F.screenOffset[0]*U.camera.pixelRatio,2*F.screenOffset[1]*U.camera.pixelRatio)),new ll("anchorPosition",F=>qC(F)),new Xn("materialColor",F=>F.color),new ut("materialRotation",F=>F.rotation),new zt("tex",F=>F.texture)),S4(S),i&&(S.uniforms.add(new Xn("outlineColor",F=>F.outlineColor)),$.uniforms.add(new Xn("outlineColor",F=>age(F)?F.outlineColor:tn),new ut("outlineSize",F=>age(F)?F.outlineSize:0))),s&&S.uniforms.add(new yD("pointDistanceSphere",(F,U)=>{const N=U.camera.eye,j=F.origin;return fi(j[0]-N[0],j[1]-N[1],j[2]-N[2],mi.radius)})),n&&S.include($8),a&&(UPe(S),S8(S)),o&&e.varyings.add("debugBorderCoords","vec4"),e.attributes.add("uv0","vec2"),e.attributes.add("uvi","vec4"),e.attributes.add("color","vec4"),e.attributes.add("size","vec2"),e.attributes.add("rotation","float"),(l||c)&&e.attributes.add("featureAttribute","vec4"),S.code.add(s?E`bool behindHorizon(vec3 posModel) {
vec3 camToEarthCenter = pointDistanceSphere.xyz - localOrigin;
vec3 camToPos = pointDistanceSphere.xyz + posModel;
float earthRadius = pointDistanceSphere.w;
float a = dot(camToPos, camToPos);
float b = dot(camToPos, camToEarthCenter);
float c = dot(camToEarthCenter, camToEarthCenter) - earthRadius * earthRadius;
return b > 0.0 && b < a && b * b  > a * c;
}`:E`bool behindHorizon(vec3 posModel) { return false; }`),S.main.add(E`
    ProjectHUDAux projectAux;
    vec4 posProj = projectPositionHUD(projectAux);
    forwardObjectAndLayerIdColor();

    if (rejectBySlice(projectAux.posModel)) {
      // Project outside of clip plane
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
      return;
    }

    if (behindHorizon(projectAux.posModel)) {
      // Project outside of clip plane
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
      return;
    }

    vec2 inputSize;
    ${_e(a,E`
        inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
        vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);`,E`
        inputSize = size;
        vec2 screenOffsetScaled = screenOffset;`)}
    ${_e(l,E`inputSize *= vvScale(featureAttribute).xx;`)}

    vec2 combinedSize = inputSize * pixelRatio;
    vec4 quadOffset = vec4(0.0);

    ${_e(r,E`
    bool visible = testHUDVisibility(posProj);
    if (!visible) {
      vtc = vec2(0.0);
      ${_e(o,"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);")}
      return;
    }`)}
    ${_e(M,E`voccluded = visible ? 0.0 : 1.0;`)}
  `);const P=E`
      vec2 uv = mix(uvi.xy, uvi.zw, bvec2(uv0));
      vec2 texSize = vec2(textureSize(tex, 0));
      uv = mix(vec2(1.0), uv / texSize, lessThan(uv, vec2(${bmt})));
      quadOffset.xy = (uv0 - anchorPosition) * 2.0 * combinedSize;

      ${_e(h,E`
          float angle = radians(materialRotation + rotation);
          float cosAngle = cos(angle);
          float sinAngle = sin(angle);
          mat2 rotate = mat2(cosAngle, -sinAngle, sinAngle,  cosAngle);

          quadOffset.xy = rotate * quadOffset.xy;
        `)}

      quadOffset.xy = (quadOffset.xy + screenOffsetScaled) / viewport.zw * posProj.w;
  `,O=n?i?E`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:E`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:E`posProj += quadOffset;`;S.main.add(E`
    ${P}
    ${c?"vcolor = interpolateVVColor(featureAttribute.y) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    ${_e(w===10,E`vcolor.a = 1.0;`)}

    bool alphaDiscard = vcolor.a < ${E.float(Gr)};
    ${_e(i,`alphaDiscard = alphaDiscard && outlineColor.a < ${E.float(Gr)};`)}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${O}
      gl_Position = posProj;
    }

    vtc = uv;

    ${_e(o,E`debugBorderCoords = vec4(uv01, 1.5 / combinedSize);`)}
    vsize = inputSize;
  `),$.uniforms.add(new zt("tex",F=>F.texture)),f&&!A&&$.uniforms.add(new po("depthMap",F=>F.mainDepth),new ws("occludedOpacity",F=>F.hudOccludedFragmentOpacity));const D=o?E`(isBorder > 0.0 ? 0.0 : ${E.float(Gr)})`:E.float(Gr),L=E`
    ${_e(o,E`float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`)}

    vec2 samplePos = vtc;

    ${_e(y,E`
      float txSize = float(textureSize(tex, 0).x);
      float texelSize = 1.0 / txSize;

      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      samplePos += (vec2(1.0, -1.0) * texelSize) * scaleFactor;`)}

    ${i?E`
      vec4 fillPixelColor = vcolor;

      // Get distance in output units (i.e. pixels)

      float sdf = texture(tex, samplePos).r;
      float pixelDistance = sdf * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - pixelDistance, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(pixelDistance) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${D} ||
          fillPixelColor.a + outlinePixelColor.a < ${E.float(Gr)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        ${_e(!A,E`fragColor = vec4(compositeColor, compositeAlpha);`)}
      } else {
        if (fillAlphaFactor < ${D}) {
          discard;
        }

        ${_e(!A,E`fragColor = premultiplyAlpha(fillPixelColor);`)}
      }

      // visualize SDF:
      // fragColor = vec4(clamp(-pixelDistance/vsize.x*2.0, 0.0, 1.0), clamp(pixelDistance/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:E`
          vec4 texColor = texture(tex, samplePos, -0.5);
          if (texColor.a < ${D}) {
            discard;
          }
          ${_e(!A,E`fragColor = texColor * premultiplyAlpha(vcolor);`)}
          `}

    ${_e(f&&!A,E`
        float zSample = texelFetch(depthMap, ivec2(gl_FragCoord.xy), 0).x;
        if (zSample < gl_FragCoord.z) {
          fragColor *= occludedOpacity;
        }
        `)}

    ${_e(!A&&o,E`fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`)}
  `;switch(w){case 0:case 1:e.outputs.add("fragColor","vec4",0),w===1&&e.outputs.add("fragEmission","vec4",1),x===1&&e.outputs.add("fragAlpha","float",w===1?2:1),$.main.add(E`
        ${L}
        ${_e(x===2,E`fragColor.rgb /= fragColor.a;`)}
        ${_e(w===1,E`fragEmission = vec4(0.0);`)}
        ${_e(x===1,E`fragAlpha = fragColor.a;`)}`);break;case 10:$.main.add(E`
        ${L}
        outputObjectAndLayerIdColor();`);break;case 9:e.include(CM,t),$.main.add(E`
        ${L}
        outputHighlight(${_e(M,E`voccluded == 1.0`,E`false`)});`)}return e}function age(t){return t.outlineColor[3]>0&&t.outlineSize>0}function qC(t){return t.textureIsSignedDistanceField?vmt(t.anchorPosition,t.distanceFieldBoundingBox,hF):ko(hF,t.anchorPosition),hF}function vmt(t,e,i){Cr(i,t[0]*(e[2]-e[0])+e[0],t[1]*(e[3]-e[1])+e[1])}const hF=pt(),_D=32e3,bmt=E.float(_D),wmt=Object.freeze(Object.defineProperty({__proto__:null,build:lRe,calculateAnchorPosition:qC,fullUV:_D},Symbol.toStringTag,{value:"Module"})),xmt=Ly(1,0,1,771);function C8(t,e=!1){switch(t){case 0:return e?Qv:em;case 1:return xmt;case 2:case 3:return null}}function cRe(t){if(t.draped)return null;switch(t.oitPass){case 0:case 2:return t.writeDepth?m4:null;case 1:case 3:return null}}const Smt=5e5,Yie={factor:-1,units:-2};function Tmt({oitPass:t,enableOffset:e}){return e&&t===1?Yie:null}function Qie(t,e=513){return t===0||t===2?e:515}function Dw(t,e){const i=u$(e);return t===1?i?{buffers:[Dr,Do,nie]}:{buffers:[Dr,Do]}:i?{buffers:[Dr,Do]}:null}let $mt=class extends Vi{constructor(e,i){super(e,i,new Ii(wmt,()=>te(()=>Promise.resolve().then(()=>Okt),void 0)),c8([uRe,dRe()].map(Lo))),this.primitiveType=i.occlusionPass?lr.POINTS:lr.TRIANGLE_STRIP}initializePipeline(e){const{oitPass:i,hasPolygonOffset:r,draped:s,output:n,depthTestEnabled:a,occlusionPass:o}=e,l=a&&!s&&i!==1&&!o&&n!==9;return li({blending:ds(n)?C8(i,!0):null,depthTest:a&&!s?{func:515}:null,depthWrite:l?m4:null,drawBuffers:Dw(i,n),colorWrite:$i,polygonOffset:r?Cmt:null})}};const Cmt={factor:0,units:-4},uRe=jc().vec2u8("uv0",{glNormalized:!0}),hRe=jc().vec3f("position").vec3f("normal").vec4i16("uvi").vec4u8("color").vec2f("size").f32("rotation").vec4f("centerOffsetAndDistance").vec4f("featureAttribute"),Mmt=hRe.clone().vec4u8("olidColor");function dRe(){return Jh()?Mmt:hRe}let Nn=class extends op{constructor(e){super(),this.spherical=e,this.screenCenterOffsetUnitsEnabled=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.hasVVSize=!1,this.hasVVColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.hasRotation=!1,this.debugDrawLabelBorder=!1,this.hasPolygonOffset=!1,this.depthTestEnabled=!0,this.pixelSnappingEnabled=!0,this.draped=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.occlusionPass=!1,this.occludedFragmentFade=!1,this.horizonCullingEnabled=!0,this.isFocused=!0,this.olidColorInstanced=!1,this.textureCoordinateType=0,this.emissionSource=0,this.discardInvisibleFragments=!0,this.hasVVInstancing=!1,this.snowCover=!1}};d([oe()],Nn.prototype,"screenCenterOffsetUnitsEnabled",void 0),d([oe()],Nn.prototype,"occlusionTestEnabled",void 0),d([oe()],Nn.prototype,"signedDistanceFieldEnabled",void 0),d([oe()],Nn.prototype,"sampleSignedDistanceFieldTexelCenter",void 0),d([oe()],Nn.prototype,"hasVVSize",void 0),d([oe()],Nn.prototype,"hasVVColor",void 0),d([oe()],Nn.prototype,"hasVerticalOffset",void 0),d([oe()],Nn.prototype,"hasScreenSizePerspective",void 0),d([oe()],Nn.prototype,"hasRotation",void 0),d([oe()],Nn.prototype,"debugDrawLabelBorder",void 0),d([oe()],Nn.prototype,"hasPolygonOffset",void 0),d([oe()],Nn.prototype,"depthTestEnabled",void 0),d([oe()],Nn.prototype,"pixelSnappingEnabled",void 0),d([oe()],Nn.prototype,"draped",void 0),d([oe()],Nn.prototype,"terrainDepthTest",void 0),d([oe()],Nn.prototype,"cullAboveTerrain",void 0),d([oe()],Nn.prototype,"occlusionPass",void 0),d([oe()],Nn.prototype,"occludedFragmentFade",void 0),d([oe()],Nn.prototype,"horizonCullingEnabled",void 0),d([oe()],Nn.prototype,"isFocused",void 0);let Xie=class extends T8{constructor(e,i){super(e,Imt),this.produces=new Map([[13,r=>XP(r)&&!this.parameters.drawAsLabel],[14,r=>XP(r)&&this.parameters.drawAsLabel],[12,()=>this.parameters.occlusionTest],[18,r=>this.parameters.draped&&XP(r)]]),this._visible=!0,this._configuration=new Nn(i)}getConfiguration(e,i){const r=this.parameters.draped;return super.getConfiguration(e,i,this._configuration),this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen",this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.draped=r,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.sampleSignedDistanceFieldTexelCenter=this.parameters.sampleSignedDistanceFieldTexelCenter,this._configuration.hasRotation=this.parameters.hasRotation,this._configuration.hasVVSize=!!this.parameters.vvSize,this._configuration.hasVVColor=!!this.parameters.vvColor,this._configuration.occlusionPass=i.slot===12,this._configuration.occludedFragmentFade=!r&&this.parameters.occludedFragmentFade,this._configuration.horizonCullingEnabled=this.parameters.horizonCullingEnabled,this._configuration.isFocused=this.parameters.isFocused,this._configuration.depthTestEnabled=this.parameters.depthEnabled||i.slot===12,ds(e)&&(this._configuration.debugDrawLabelBorder=!!Ws.LABELS_SHOW_BORDER),this._configuration.oitPass=i.oitPass,this._configuration.terrainDepthTest=i.terrainDepthTest,this._configuration.cullAboveTerrain=i.cullAboveTerrain,this._configuration}intersect(e,i,r,s,n,a){const{options:{selectionMode:o,hud:l,excludeLabels:c},point:h,camera:f}=r,{parameters:y}=this;if(!o||!l||c&&y.isLabel||!e.visible||!h||!f)return;const _=e.attributes.get("featureAttribute"),w=_==null?null:qR(_.data,fX),{scaleX:x,scaleY:S}=mX(w,y,f.pixelRatio);jv(dF,i),e.attributes.has("featureAttribute")&&Omt(dF);const $=e.attributes.get("position"),A=e.attributes.get("size"),M=e.attributes.get("normal"),P=e.attributes.get("rotation"),O=e.attributes.get("centerOffsetAndDistance");dt($.size>=3);const D=qC(y),L=this.parameters.centerOffsetUnits==="screen";for(let F=0;F<$.data.length/$.size;F++){const U=F*$.size;ve(wr,$.data[U],$.data[U+1],$.data[U+2]),Mt(wr,wr,i),Mt(wr,wr,f.viewMatrix);const N=F*O.size;if(ve(As,O.data[N],O.data[N+1],O.data[N+2]),!L&&(wr[0]+=As[0],wr[1]+=As[1],As[2]!==0)){const B=As[2];Ee(As,wr),Ce(wr,wr,le(As,As,B))}const j=F*M.size;if(ve(Bb,M.data[j],M.data[j+1],M.data[j+2]),dX(Bb,dF,f,oR),gX(this.parameters,wr,oR,f,p$),f.applyProjection(wr,Pr),Pr[0]>-1){L&&(As[0]||As[1])&&(Pr[0]+=As[0]*f.pixelRatio,As[1]!==0&&(Pr[1]+=p$.alignmentEvaluator.apply(As[1])*f.pixelRatio),f.unapplyProjection(Pr,wr)),Pr[0]+=this.parameters.screenOffset[0]*f.pixelRatio,Pr[1]+=this.parameters.screenOffset[1]*f.pixelRatio,Pr[0]=Math.floor(Pr[0]),Pr[1]=Math.floor(Pr[1]);const B=F*A.size;qn[0]=A.data[B],qn[1]=A.data[B+1],p$.evaluator.applyVec2(qn,qn);const Y=mRe*f.pixelRatio;let G=0;y.textureIsSignedDistanceField&&(G=Math.min(y.outlineSize,.5*qn[0])*f.pixelRatio/2),qn[0]*=x,qn[1]*=S;const Z=F*P.size,H=y.rotation+P.data[Z];if(pX(h,Pr[0],Pr[1],qn,Y,G,H,y,D)){const Q=r.ray;if(Mt(sV,wr,nl(fRe,f.viewMatrix)),Pr[0]=h[0],Pr[1]=h[1],f.unprojectFromRenderScreen(Pr,wr)){const X=R();de(X,Q.direction);const ye=1/Le(X);le(X,X,ye),a(Ri(Q.origin,wr)*ye,X,-1,sV)}}}}}intersectDraped(e,i,r,s,n){const a=e.attributes.get("position"),o=e.attributes.get("size"),l=e.attributes.get("rotation"),c=this.parameters,h=qC(c),f=e.attributes.get("featureAttribute"),y=f==null?null:qR(f.data,fX),{scaleX:_,scaleY:w}=mX(y,c,e.screenToWorldRatio),x=Rmt*e.screenToWorldRatio;for(let S=0;S<a.data.length/a.size;S++){const $=S*a.size,A=a.data[$],M=a.data[$+1],P=S*o.size;qn[0]=o.data[P],qn[1]=o.data[P+1];let O=0;c.textureIsSignedDistanceField&&(O=Math.min(c.outlineSize,.5*qn[0])*e.screenToWorldRatio/2),qn[0]*=_,qn[1]*=w;const D=S*l.size,L=c.rotation+l.data[D];pX(r,A,M,qn,x,O,L,c,h)&&s(n.distance,n.normal,-1)}}createBufferWriter(){return new Lmt}applyShaderOffsetsView(e,i,r,s,n,a,o){const l=dX(i,r,n,oR);return this._applyVerticalGroundOffsetView(e,l,n,o),gX(this.parameters,o,l,n,a),this._applyPolygonOffsetView(o,l,s[3],n,o),this._applyCenterOffsetView(o,s,o),o}applyShaderOffsetsNDC(e,i,r,s,n){return this._applyCenterOffsetNDC(e,i,r,s),n!=null&&de(n,s),this._applyPolygonOffsetNDC(s,i,r,s),s}_applyPolygonOffsetView(e,i,r,s,n){const a=s.aboveGround?1:-1;let o=Math.sign(r);o===0&&(o=a);const l=a*o;if(this.parameters.shaderPolygonOffset<=0)return de(n,e);const c=Se(Math.abs(i.cosAngle),.01,1),h=1-Math.sqrt(1-c*c)/c/s.viewport[2];return le(n,e,l>0?h:1/h),n}_applyVerticalGroundOffsetView(e,i,r,s){const n=Le(e),a=r.aboveGround?1:-1,o=r.computeRenderPixelSizeAtDist(n)*HPe,l=le(wr,i.normal,a*o);return xe(s,e,l),s}_applyCenterOffsetView(e,i,r){const s=this.parameters.centerOffsetUnits!=="screen";return r!==e&&de(r,e),s&&(r[0]+=i[0],r[1]+=i[1],i[2]&&(Ee(Bb,r),ui(r,r,le(Bb,Bb,i[2])))),r}_applyCenterOffsetNDC(e,i,r,s){const n=this.parameters.centerOffsetUnits!=="screen";return s!==e&&de(s,e),n||(s[0]+=i[0]/r.fullWidth*2,s[1]+=i[1]/r.fullHeight*2),s}_applyPolygonOffsetNDC(e,i,r,s){const n=this.parameters.shaderPolygonOffset;if(e!==s&&de(s,e),n){const a=r.aboveGround?1:-1,o=a*Math.sign(i[3]);s[2]-=(o||a)*n}return s}set visible(e){this._visible=e}get visible(){const{color:e,outlineSize:i,outlineColor:r}=this.parameters,s=e[3]>=Gr||i>=Gr&&r[3]>=Gr;return this._visible&&s}createGLMaterial(e){return new Emt(e)}calculateRelativeScreenBounds(e,i,r=Pi()){return Amt(this.parameters,e,i,r),r[2]=r[0]+e[0],r[3]=r[1]+e[1],r}},Emt=class extends ZPe{constructor(e){super({...e,...e.material.parameters})}beginSlot(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.getTechnique($mt,e)}};function Amt(t,e,i,r){r[0]=t.anchorPosition[0]*-e[0]+t.screenOffset[0]*i,r[1]=t.anchorPosition[1]*-e[1]+t.screenOffset[1]*i}function dX(t,e,i,r){return Uft(e)&&(e=jv(Pmt,e)),rl(r.normal,t,e),Mt(r.normal,r.normal,i.viewInverseTransposeMatrix),r.cosAngle=Oe(pRe,Dmt),r}function Omt(t){const e=t[0],i=t[1],r=t[2],s=t[3],n=t[4],a=t[5],o=t[6],l=t[7],c=t[8],h=1/Math.sqrt(e*e+i*i+r*r),f=1/Math.sqrt(s*s+n*n+a*a),y=1/Math.sqrt(o*o+l*l+c*c);return t[0]=e*h,t[1]=i*h,t[2]=r*h,t[3]=s*f,t[4]=n*f,t[5]=a*f,t[6]=o*y,t[7]=l*y,t[8]=c*y,t}function pX(t,e,i,r,s,n,a,o,l){let c=e-s-r[0]*l[0],h=c+r[0]+2*s,f=i-s-r[1]*l[1],y=f+r[1]+2*s;const _=o.distanceFieldBoundingBox;return o.textureIsSignedDistanceField&&_!=null&&(c+=r[0]*_[0],f+=r[1]*_[1],h-=r[0]*(1-_[2]),y-=r[1]*(1-_[3]),c-=n,h+=n,f-=n,y+=n),Cr(oge,e,i),m2e(dA,t,oge,Lt(a)),dA[0]>c&&dA[0]<h&&dA[1]>f&&dA[1]<y}const p$=new kPe,wr=R(),Bb=R(),Pr=ri(),pRe=R(),sV=R(),dA=pt(),oge=pt(),dF=Ir(),Pmt=Ir(),fRe=it(),EL=ri(),As=R(),Pq=R(),fX=ri(),oR={normal:pRe,cosAngle:0},mRe=1,Rmt=2,qn=vs(0,0),Dmt=Ge(0,0,1);class Imt extends YPe{constructor(){super(...arguments),this.renderOccluded=1,this.isDecoration=!1,this.color=jR(1,1,1,1),this.polygonOffset=!1,this.anchorPosition=vs(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.outlineColor=jR(1,1,1,1),this.outlineSize=0,this.distanceFieldBoundingBox=ri(),this.rotation=0,this.hasRotation=!1,this.vvSizeEnabled=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.occludedFragmentFade=!1,this.horizonCullingEnabled=!1,this.centerOffsetUnits="world",this.drawAsLabel=!1,this.depthEnabled=!0,this.isFocused=!0,this.focusStyle="bright",this.draped=!1,this.isLabel=!1}get hasVVSize(){return!!this.vvSize}get hasVVColor(){return!!this.vvColor}get hasVVOpacity(){return!!this.vvOpacity}}class Lmt{constructor(){this.layout=uRe,this.instanceLayout=dRe()}elementCount(e){return e.get("position").indices.length}elementCountBaseInstance(e){return e.get("uv0").indices.length}write(e,i,r,s,n,a){const{position:o,normal:l,color:c,size:h,rotation:f,centerOffsetAndDistance:y,featureAttribute:_,uvi:w}=n;Bie(r.get("position"),e,o,a),jie(r.get("normal"),i,l,a);const x=r.get("position").indices.length;let S=0,$=0,A=_D,M=_D;const P=r.get("uvi")?.data;P&&P.length>=4&&(S=P[0],$=P[1],A=P[2],M=P[3]);for(let O=0;O<x;++O){const D=a+O;w.setValues(D,S,$,A,M)}if(XPe(r.get("color"),4,c,a),aR(r.get("size"),h,a),rmt(r.get("rotation"),f,a),r.get("centerOffsetAndDistance")?gD(r.get("centerOffsetAndDistance"),y,a):sge(y,a,x),r.get("featureAttribute")?gD(r.get("featureAttribute"),_,a):sge(_,a,x),s!=null){const O=r.get("position")?.indices;if(O){const D=O.length,L=n.getField("olidColor",Bu);JPe(s,L,D,a)}}return{numVerticesPerItem:1,numItems:x}}writeBaseInstance(e,i){const{uv0:r}=i;aR(e.get("uv0"),r,0)}intersect(e,i,r,s,n,a,o){const{options:{selectionMode:l,hud:c,excludeLabels:h},point:f,camera:y}=s;if(!l||!c||h&&i.isLabel||!f)return;const _=this.instanceLayout.createView(e),{position:w,normal:x,rotation:S,size:$,featureAttribute:A,centerOffsetAndDistance:M}=_,P=i.centerOffsetUnits==="screen",O=qC(i);if(w==null||x==null||S==null||$==null||M==null||y==null)return;const D=A==null?null:A.getVec(0,fX),{scaleX:L,scaleY:F}=mX(D,i,y.pixelRatio),U=w.count;for(let N=0;N<U;N++){if(w.getVec(N,wr),r!=null&&xe(wr,wr,r),Mt(wr,wr,y.viewMatrix),M.getVec(N,EL),ve(As,EL[0],EL[1],EL[2]),!P&&(wr[0]+=As[0],wr[1]+=As[1],As[2]!==0)){const j=As[2];Ee(As,wr),Ce(wr,wr,le(As,As,j))}if(x.getVec(N,Bb),dX(Bb,dF,y,oR),gX(i,wr,oR,y,p$),y.applyProjection(wr,Pr),Pr[0]>-1){P&&(As[0]||As[1])&&(Pr[0]+=As[0]*y.pixelRatio,As[1]!==0&&(Pr[1]+=p$.alignmentEvaluator.apply(As[1])*y.pixelRatio),y.unapplyProjection(Pr,wr)),Pr[0]+=i.screenOffset[0]*y.pixelRatio,Pr[1]+=i.screenOffset[1]*y.pixelRatio,Pr[0]=Math.floor(Pr[0]),Pr[1]=Math.floor(Pr[1]),$.getVec(N,qn),p$.evaluator.applyVec2(qn,qn);const j=mRe*y.pixelRatio;let B=0;i.textureIsSignedDistanceField&&(B=Math.min(i.outlineSize,.5*qn[0])*y.pixelRatio/2),qn[0]*=L,qn[1]*=F;const Y=S.get(N),G=i.rotation+Y;if(pX(f,Pr[0],Pr[1],qn,j,B,G,i,O)){const Z=s.ray;if(Mt(sV,wr,nl(fRe,y.viewMatrix)),Pr[0]=f[0],Pr[1]=f[1],y.unprojectFromRenderScreen(Pr,wr)){const H=R();de(H,Z.direction);const Q=1/Le(H);le(H,H,Q),o(Ri(Z.origin,wr)*Q,H,N,sV)}}}}}}function mX(t,e,i){return t==null||e.vvSize==null?{scaleX:i,scaleY:i}:(VPe(Pq,e,t),{scaleX:Pq[0]*i,scaleY:Pq[1]*i})}function gX(t,e,i,r,s){if(!t.verticalOffset?.screenLength){const l=Le(e);return s.update(i.cosAngle,l,t.screenSizePerspective,t.screenSizePerspectiveMinPixelReferenceSize,t.screenSizePerspectiveAlignment,null),e}const n=Le(e),a=t.screenSizePerspectiveAlignment??t.screenSizePerspective,o=QPe(r,n,t.verticalOffset,i.cosAngle,a,t.screenSizePerspectiveMinPixelReferenceSize);return s.update(i.cosAngle,n,t.screenSizePerspective,t.screenSizePerspectiveMinPixelReferenceSize,t.screenSizePerspectiveAlignment,null),le(i.normal,i.normal,o),xe(e,e,i.normal)}const Dm=R(),Rq=R(),CS=ri(),pA=ri(),Dq=R(),kmt=it(),zmt=ms(),Iq=rn(),Fmt=R(),Nmt=Pi();class Vmt{constructor(e){this.id=e,this.aabr=Pi(),this.altitude=0,this.distance=0,this.distanceToOccluder=0,this.culled=!1,this.visible=!1,this.priority=0}}function Umt(t,e){const i=t.distanceToOccluder!==0&&t.distance>t.distanceToOccluder,r=e.distanceToOccluder!==0&&e.distance>e.distanceToOccluder;return i!==r?+i-+r:t.priority!==e.priority?e.priority-t.priority:t.distance!==e.distance?t.distance-e.distance:t.visible!==e.visible?+e.visible-+t.visible:t.id-e.id}class Bmt{constructor(e,i){this.graphics3DGraphic=e,this.slicePlaneEnabled=i,this._info=null,this._labelInfo=null}ensureInfo(e){let i=this.getInfo(e);return i||(i=new Vmt(this.graphics3DGraphic.graphic.uid),this._setInfo(e,i)),i}getInfo(e){return e===16?this._labelInfo:this._info}removeInfo(e){this._setInfo(e,null)}_setInfo(e,i){e===16?this._labelInfo=i:this._info=i}}class jmt{constructor(){this.camera=new nr,this.slicePlane=Py(),this.slicePlaneEnabled=!1}copyFrom(e){this.camera.equals(e.camera)||this.camera.copyFrom(e.camera),o2(e.slicePlane,this.slicePlane),this.slicePlaneEnabled=e.slicePlaneEnabled}}let m_=class extends Me{get dirty(){return this._dirty}get state(){return this._state}constructor(t){super(t),this._dirty=!1,this._viewState=new jmt,this._state=0,this._checkOcclusion=new Map,this._active=new Map,this._checkOcclusionIterator=null,this._activeIterator=null,this._occlusionQueryUids=new Array,this._updatingHandles=new mp,this._deconflictor=new Dft((e,i)=>{e.visible=i,this._setGraphicVisibility(this._active.get(e.id),i)},(e,i)=>e.id!==i.id,Umt),this._baseOccludedVisibility=10,this._altitudeFactor=2,this._minAltitudeDifference=100}initialize(){this._updatingHandles.add(()=>(this.view?.map?.ground?.opacity??0)>0,()=>this.setDirty()),this._updatingHandles.add(()=>this.view.ready,()=>{this._occlusionQuery=null,this.setDirty()})}destroy(){this._occlusionQuery=null,this._updatingHandles.destroy(),this._deconflictor.destroy(),this._checkOcclusion.clear(),this._active.clear()}setDirty(){!this._dirty&&(this._active.size>0||this._checkOcclusion.size>0)&&(this._dirty=!0,this.notifyChange("_readyToRun"))}setPriority(t,e){const i=this._active.get(t.graphic.uid)?.getInfo(this.visibilityGroup);i&&(i.priority=e)}get _readyToRun(){return this._state!==0||this._dirty}get updating(){return this._readyToRun||this._updatingHandles.updating}get updatingProgress(){if(!this.updating)return 1;const t=this._state/5;return this._dirty?.5*t:t}get readyToRun(){return this.view.ready&&this.view.state!=null&&this._readyToRun}get usedMemory(){return this._occlusionQuery?.usedMemory??0+4*(this._occlusionQueryUids?.length??0)}runTask(t){switch(this._state){case 0:this._startUpdate(),t.madeProgress();case 1:if(this._state=1,!this._processCheckOcclusion(t))return;case 2:if(this._state=2,this._occlusionQuery&&!this._occlusionQuery.done)return ea;this._readOcclusionQueryResult(),t.madeProgress();case 3:if(this._state=3,!this._collectActiveGraphics(t))return;case 4:if(this._state=4,this._deconflictor.run(t),!this._deconflictor.done)return;default:this._state=0,this.notifyChange("_readyToRun")}}setGraphicsActive(t,e){e?t.forEach(i=>this.addToActiveGraphics(i)):t.forEach(i=>this.removeFromActiveGraphics(i))}layerSupportsDeconfliction(t){if(t==null||t.type!=="object3d")return!1;const e=t.stageObject;return(e?.geometries.length??0)!==1?!1:e?.geometries[0]?.material instanceof Xie}_startUpdate(){Pft(this.view),this._dirty=!1,this._viewState.copyFrom(this.viewState);const{fullWidth:t,fullHeight:e}=this._viewState.camera;this._deconflictor.reset(t,e),this._resetIterators(),this._occlusionQueryUids.length=0,this._checkOcclusion.size||(this._occlusionQuery=Re(this._occlusionQuery))}addToActiveGraphics(t){t.ensureInfo(this.visibilityGroup),this._active.set(t.graphics3DGraphic.graphic.uid,t),this.setDirty()}removeFromActiveGraphics(t){qmt(t,this.visibilityGroup),t.removeInfo(this.visibilityGroup),this._active.delete(t.graphics3DGraphic.graphic.uid),this.setDirty()}addToCheckOcclusion(t){this._checkOcclusion.set(t.graphics3DGraphic.graphic.uid,t),this.setDirty()}removeFromCheckOcclusion(t){this._checkOcclusion.delete(t.graphics3DGraphic.graphic.uid)}_processCheckOcclusion(t){if(this._checkOcclusion.size===0)return!0;const e=this._ensureCheckOcclusionIterator(),i=this._viewState.camera,r=Ql(kmt,i.viewInverseTransposeMatrix),s=this.view.map.ground.opacity>0,n=this.view.viewingMode==="global"&&s&&i.relativeElevation>0?zmt:null;let a=0;n!=null&&(OC(n,Kn,i.viewMatrix),n[3]=or(this.view.spatialReference).radius,a=h$e(n,Kn));const o=Pi();for(;;){if(t.done)return!1;t.madeProgress();const l=e.next();if(l.done===!0)break;const c=l.value,h=c.graphics3DGraphic;if(h.destroyed||!h.isVisible(1,8))continue;const f=Zmt(h,this.visibilityGroup);let y=null,_=!0;for(const w of f){if(!this.layerSupportsDeconfliction(w))continue;y=Ymt,this._projectHudLayer(w,i,y),cy(o);const x=w.stageObject.geometries[0].material;if(this._expandBoundingRect(o,i,w,x,y),y.isOutsideScreen){_=!1;break}if(this._isCulledBySlice(c,y.positionView)){_=!1;break}if(n!=null&&Wmt(y,n,a)){_=!1;break}Mt(Rq,y.positionView,r),y.altitude=this.view.renderCoordsHelper.getAltitude(Rq);const S=c.ensureInfo(this.visibilityGroup);if(S.altitude=y.altitude,S.distance=y.distance,S.distanceToOccluder=y.distanceToOccluder,S.culled=!1,Bv(S.aabr,o),x.parameters.occlusionTest)break;this._ensureOcclusionQuery().addPosition(Rq)===this._occlusionQueryUids.length&&this._occlusionQueryUids.push(h.graphic.uid);break}if(this._active.has(h.graphic.uid)&&(!_||!y)){const w=c.ensureInfo(this.visibilityGroup);w.visible=!y,w.culled=!0}}return this._checkOcclusionIterator=null,this._occlusionQueryUids.length||(this._occlusionQuery=Re(this._occlusionQuery)),this._occlusionQuery?.start(),!0}_readOcclusionQueryResult(){if(!this._occlusionQuery||!this._occlusionQueryUids.length)return;const t=this._viewState.camera,e=this.view.renderCoordsHelper.getAltitude(t.eye);for(let i=0;i<this._occlusionQueryUids.length;i++){const r=this._occlusionQueryUids[i],s=this._checkOcclusion.get(r);if(!s)continue;const n=this._occlusionQuery.getOcclusion(i)??-1,a=s.getInfo(this.visibilityGroup);a&&(a.distanceToOccluder=n>0?a.distance-n:0);const o=n<=0||this._occludedVisibility(a?.distanceToOccluder??0,a?.distance??n,a?.altitude??0,e);this._active.has(r)?a&&(a.culled=!o,a.visible=o):this._setGraphicVisibility(s,o)}this._occlusionQueryUids.length=0}_collectActiveGraphics(t){const e=this._ensureActiveGraphicsIterator(),i=this.visibilityGroup===16;for(;!t.done;){t.madeProgress();const r=e.next();if(r.done===!0)return this._activeIterator=null,!0;const s=r.value,n=s.getInfo(this.visibilityGroup);n&&(!(!i||s.graphics3DGraphic.isVisible())||n.culled?(LPe(n.aabr,!1,!0),this._setGraphicVisibility(s,n.visible)):this._deconflictor.add(n))}return!1}_occludedVisibility(t,e,i,r){const s=Math.max(this._minAltitudeDifference,Math.abs(i-r))-this._minAltitudeDifference;return t===0||e-t<=this._baseOccludedVisibility+this._altitudeFactor*s}_resetIterators(){this._checkOcclusionIterator=null,this._activeIterator=null}_ensureCheckOcclusionIterator(){return this._checkOcclusionIterator??=this._checkOcclusion.values(),this._checkOcclusionIterator}_ensureActiveGraphicsIterator(){return this._activeIterator??=this._active.values(),this._activeIterator}_ensureOcclusionQuery(){return this._occlusionQuery??=new bb({view:this.view}),this._occlusionQueryUids.length||this._occlusionQuery.init(this._checkOcclusion.size,this._viewState.camera.eye),this._occlusionQuery}_projectHudLayer(t,e,i){const r=t.stageObject,s=r.geometries[0],n=s.material;Mt(Dm,Ti(r.boundingVolumeWorldSpace.bounds),e.viewMatrix);const a=s.attributes,o=a.get("normal").data,l=a.get("centerOffsetAndDistance").data;n.applyShaderOffsetsView(Dm,o,r.transformation,l,e,i.screenSizePerspectiveEvaluators,Dm),yr(CS,Dm[0],Dm[1],Dm[2],1),Dc(pA,CS,e.projectionMatrix),le(i.positionNDC,pA,1/pA[3]),n.applyShaderOffsetsNDC(i.positionNDC,l,e,i.positionNDC,Dq),i.distanceWithoutPolygonOffset=e.depthNDCToWorld(Dq[2]),i.distance=Dq[2]===i.positionNDC[2]?i.distanceWithoutPolygonOffset:e.depthNDCToWorld(i.positionNDC[2]),yr(pA,i.positionNDC[0],i.positionNDC[1],i.positionNDC[2],1),Dc(CS,pA,e.inverseProjectionMatrix),Cv(CS,CS,1/CS[3]),ve(i.positionView,Dm[0],Dm[1],Dm[2])}_isCulledBySlice(t,e){return t.slicePlaneEnabled&&this._viewState.slicePlaneEnabled&&tte(this._viewState.slicePlane,e)}_expandBoundingRect(t,e,i,r,{positionNDC:s,screenSizePerspectiveEvaluators:n}){const a=i.getScreenSize(Gmt);n.evaluator.applyVec2(a,a),a[0]*=e.pixelRatio,a[1]*=e.pixelRatio;const o=JN(r.calculateRelativeScreenBounds(a,n.alignmentEvaluator.apply(e.pixelRatio),Nmt),ft(0,e.fullWidth,.5+.5*s[0]),ft(0,e.fullHeight,.5+.5*s[1])),l=this.marginFactor;if(l!==0){const c=l*Math.min(oo(o),Bl(o));o[0]-=c,o[1]-=c,o[2]+=c,o[3]+=c}H3(t,o,t)}_setGraphicVisibility(t,e){const i=t?.graphics3DGraphic;i&&!i.destroyed&&(i.setVisibilityFlag(this.visibilityGroup,8,e),this.visibilityGroup===16&&this.view.labeler.setLabelGraphicVisibility(i,e))}};function qmt(t,e){const i=t.graphics3DGraphic;i.destroyed||i.setVisibilityFlag(e,8,!0)}d([m({constructOnly:!0})],m_.prototype,"view",void 0),d([m({type:Boolean,readOnly:!0})],m_.prototype,"_readyToRun",null),d([m({type:Boolean,readOnly:!0})],m_.prototype,"updating",null),d([m({readOnly:!0})],m_.prototype,"_updatingHandles",void 0),m_=d([k("esri.views.3d.layers.graphics.Deconflictor")],m_);const Gmt=pt();class Hmt{constructor(){this.positionView=R(),this.positionNDC=R(),this.altitude=0,this.distance=0,this.distanceToOccluder=0,this.distanceWithoutPolygonOffset=0,this.screenSizePerspectiveEvaluators=new kPe}get isOutsideScreen(){const e=this.positionNDC;return e[0]<-1||e[1]<-1||e[2]<-1||e[0]>=1||e[1]>=1||e[2]>=1}}function Wmt(t,e,i){return de(Iq.direction,t.positionView),ve(Iq.origin,0,0,0),!!Ry(e,Iq,Fmt)&&t.distanceWithoutPolygonOffset>i}function Zmt(t,e){return e===16?t.labelLayers:t.layers}const Ymt=new Hmt,Qmt=2e3;let pF=class extends m_{constructor(e){super(e),this.visibilityGroup=16,this.marginFactor=.05,this._lastDeconfliction=0}get viewState(){return this.parent.viewState}runTask(e){if(this.parent.readyToRun)return ea;const i=performance.now();if(this.view.state.mode!==2&&i-this._lastDeconfliction<Qmt)return ea;const r=super.runTask(e);return this.state===0&&(this._lastDeconfliction=i),r}};d([m({constructOnly:!0})],pF.prototype,"parent",void 0),pF=d([k("esri.views.3d.layers.graphics.LabelDeconflictor")],pF);let yX=class extends m_{constructor(){super(...arguments),this._contexts=new Map,this.visibilityGroup=1,this._marginFactor=-.1,this.test={overrideMarginFactor:e=>{this._marginFactor=e,this.setDirty()}}}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this._updatingHandles.add(()=>this.view?.state?.camera,()=>{this._updateViewState(),this.setDirty()}),this._updatingHandles.add(()=>this.view?.slice?.plane,()=>{this._updateSlicePlane(),this._slicePlaneChanged(),this.setDirty()},Wt),this.addHandles(K(()=>this.view.basemapTerrain?.updating||this.view.graphicsView?.updating||this.view.allLayerViews.some(e=>e.updating),(e,i)=>{!e&&i&&this.setDirty()},Yt)),this._frameTask=this.view.resourceController.scheduler.registerTask(yt.GRAPHICS_DECONFLICTOR,this),this._labels=new pF({view:this.view,parent:this})}destroy(){this._labels=Re(this._labels),this._frameTask=Ki(this._frameTask)}get marginFactor(){return this._marginFactor}get usedMemory(){return super.usedMemory+this._labels.usedMemory}setDirty(){this._contexts.size>0&&(super.setDirty(),this._labels.setDirty())}runTask(e){const i=super.runTask(e);return this.readyToRun||this._labels.setDirty(),i}_updateViewState(){this.view?.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())}_updateSlicePlane(){const e=this.view?.slice?.plane;e!=null&&K3e(e,this._viewState.camera.viewMatrix,this._viewState.slicePlane),this._viewState.slicePlaneEnabled=e!=null}_slicePlaneChanged(){for(const e of this._contexts.keys())if(e.symbolCreationContext.slicePlaneEnabled)return void this.setDirty()}addGraphicsOwner(e){const i=this._getGraphicsContext(e);return{addGraphic:r=>this._addGraphic(e,i,r),removeGraphic:r=>this._removeGraphic(i,r),labelingInfoChange:()=>this._labelsEnabledChanged(e,i),featureReductionChange:()=>this._enabledChanged(e,i),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(e,i),screenSizePerspectiveEnabledChanged:()=>this._screenSizePerspectiveEnabledChange(),clear:()=>i.forEach(r=>this._removeGraphic(i,r.graphics3DGraphic)),remove:()=>this._removeGraphicsOwner(e),setDirty:()=>this.setDirty()}}_removeGraphicsOwner(e){const i=this._contexts.get(e);i&&(i.forEach(r=>this._removeGraphic(i,r.graphics3DGraphic)),this._contexts.delete(e),this.setDirty())}_addGraphic(e,i,r){const s=r.graphic.uid,n=new Bmt(r,e.symbolCreationContext.slicePlaneEnabled);i.set(s,n),this.addToCheckOcclusion(n),Lq(e)&&this.addToActiveGraphics(n),e.labelsEnabled&&(this._labels.addToCheckOcclusion(n),this._labels.addToActiveGraphics(n));const a=!this._graphicSupportsDeconfliction(r)||!Lq(e);r.setVisibilityFlag(1,8,a)}_removeGraphic(e,i){const r=i.graphic.uid,s=e.get(r);s&&(this.removeFromActiveGraphics(s),this.removeFromCheckOcclusion(s),this._labels.removeFromActiveGraphics(s),this._labels.removeFromCheckOcclusion(s),e.delete(r),this.setDirty())}_enabledChanged(e,i){Lq(e)?i.forEach(r=>this.addToActiveGraphics(r)):(i.forEach(r=>this.removeFromActiveGraphics(r)),Xmt(e))}_labelsEnabledChanged(e,i){e.labelsEnabled?(i.forEach(r=>this._labels.addToCheckOcclusion(r)),i.forEach(r=>this._labels.addToActiveGraphics(r))):(i.forEach(r=>this._labels.removeFromCheckOcclusion(r)),i.forEach(r=>this._labels.removeFromActiveGraphics(r)))}_slicePlaneEnabledChanged(e,i){const r=e.symbolCreationContext.slicePlaneEnabled;i.forEach(s=>s.slicePlaneEnabled=r),this.setDirty()}_screenSizePerspectiveEnabledChange(){this.setDirty()}_graphicSupportsDeconfliction(e){if(e.isDraped)return!1;const i=e.layers;if(!i?.length)return!1;for(const r of i)if(this.layerSupportsDeconfliction(r))return!0;return!1}_getGraphicsContext(e){const i=this._contexts.get(e);if(i)return i;const r=new Map;return this._contexts.set(e,r),this.setDirty(),r}};function Lq(t){const e=t.layer;return!(!e?.featureReduction||e.featureReduction.type!=="selection")}function Xmt(t){const e=t.graphics3DGraphics;e&&e.forEach(i=>i.setVisibilityFlag(1,8,!0))}yX=d([k("esri.views.3d.layers.graphics.GraphicsDeconflictor")],yX);function gRe(t){return"declaredClass"in t}function lge(t){return"declaredClass"in t}function Jmt(t){return"declaredClass"in t}function Kmt(t,e,i){return t?Jmt(t)?(t.origin!==i&&(t.origin=i),t):new Gn({layer:e,sourceLayer:e,origin:i,visible:t.visible,symbol:Te(t.symbol),attributes:Te(t.attributes),geometry:yRe(t.geometry)}):null}function yRe(t){return t==null?null:gRe(t)?t:hy(egt(t))}function egt(t){const{wkid:e,wkt:i,wkt2:r,latestWkid:s}=t.spatialReference,n={wkid:e,wkt:i,wkt2:r,latestWkid:s};switch(t.type){case"point":{const{x:a,y:o,z:l,m:c}=t;return{x:a,y:o,z:l,m:c,spatialReference:n}}case"polygon":{const{rings:a,hasZ:o,hasM:l}=t;return{rings:cge(a),hasZ:o,hasM:l,spatialReference:n}}case"polyline":{const{paths:a,hasZ:o,hasM:l}=t;return{paths:cge(a),hasZ:o,hasM:l,spatialReference:n}}case"extent":{const{xmin:a,xmax:o,ymin:l,ymax:c,zmin:h,zmax:f,mmin:y,mmax:_,hasZ:w,hasM:x}=t;return{xmin:a,xmax:o,ymin:l,ymax:c,zmin:h,zmax:f,mmin:y,mmax:_,hasZ:w,hasM:x,spatialReference:n}}case"multipoint":{const{points:a,hasZ:o,hasM:l}=t;return{points:vRe(a)?_Re(a):a,hasZ:o,hasM:l,spatialReference:n}}default:return}}function cge(t){return tgt(t)?t.map(e=>_Re(e)):t}function _Re(t){return t.map(e=>Array.from(e))}function tgt(t){for(const e of t)if(e.length!==0)return vRe(e);return!1}function vRe(t){return t.length>0&&(LD(t[0])||kD(t[0]))}function igt(t,e){if(!t)return null;let i;if(lge(t)){if(e==null)return t.clone();if(lge(e))return e.copy(t)}return e!=null?(i=e,i.x=t.x,i.y=t.y,i.spatialReference=t.spatialReference,t.hasZ?(i.z=t.z,i.hasZ=t.hasZ):(i.z=void 0,i.hasZ=!1),t.hasM?(i.m=t.m,i.hasM=!0):(i.m=void 0,i.hasM=!1)):(i=Ep(t.x,t.y,t.z,t.spatialReference),t.hasM&&(i.m=t.m,i.hasM=!0)),i}function FGt(t){const{wkid:e,wkt:i,wkt2:r,latestWkid:s}=t,n={wkid:e,wkt:i,wkt2:r,latestWkid:s};return Ie.fromJSON(n)}const Jie="__begin__",Kie="__end__",rgt=new RegExp(Jie,"ig"),sgt=new RegExp(Kie,"ig"),uge=new RegExp("^"+Jie,"i"),hge=new RegExp(Kie+"$","i"),nV='"',ngt=nV+" + ",agt=" + "+nV;function ogt(t){return t.replaceAll(new RegExp("\\[","g"),"{").replaceAll(new RegExp("\\]","g"),"}")}function NGt(t){return t.replaceAll(new RegExp("\\{","g"),"[").replaceAll(new RegExp("\\}","g"),"]")}function ere(t){const e={expression:"",type:"none"};return t.labelExpressionInfo?t.labelExpressionInfo.value?(e.expression=t.labelExpressionInfo.value,e.type="conventional"):t.labelExpressionInfo.expression&&(e.expression=t.labelExpressionInfo.expression,e.type="arcade"):t.labelExpression!=null&&(e.expression=ogt(t.labelExpression),e.type="conventional"),e}function VGt(t){const e=ere(t);if(!e)return null;switch(e.type){case"conventional":return lgt(e.expression);case"arcade":return e.expression}return null}function UGt(t){const e=ere(t);if(!e)return null;switch(e.type){case"conventional":return ugt(e.expression);case"arcade":return bRe(e.expression)}return null}function lgt(t){let e;return t?(e=Cy(t,i=>Jie+'$feature["'+i+'"]'+Kie),e=uge.test(e)?e.replace(uge,""):nV+e,e=hge.test(e)?e.replace(hge,""):e+nV,e=e.replaceAll(rgt,ngt).replaceAll(sgt,agt)):e='""',e}const cgt=/^\s*\{([^}]+)\}\s*$/i;function ugt(t){return t?.match(cgt)?.[1].trim()||null}const hgt=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])(.+)(\2)\]));?\s*$/i,dgt=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])(.+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,pgt=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(.+)(\1)\s*\));?\s*$/i;function bRe(t){if(!t)return null;let e=hgt.exec(t)||dgt.exec(t);return e?e[1]||e[3]:(e=pgt.exec(t),e?e[2]:null)}const wRe={TypeNotAllowedInFeature:"Feature attributes only support dates, numbers, strings, guids.",LogicError:"Logic error - {reason}",CannotCompareDateAndTime:"Cannot compare date or dateonly with timeonly types",NeverReach:"Encountered unreachable logic",AsyncNotEnabled:"Async Arcade must be enabled for this script",ModuleAccessorMustBeString:"Module accessor must be a string",ModuleExportNotFound:"Module has no export with provided identifier",ModulesNotSupported:"Current profile does not support modules",ArrayAccessMustBeNumber:"Array accessor must be a number",FunctionNotFound:"Function not found",FieldNotFound:"Key not found - {key}",CircularModules:"Circular module dependencies are not allowed",Cancelled:"Execution cancelled",UnsupportedHashType:"Type not supported in hash function",IllegalResult:"Value is not a supported return type",PortalRequired:"Portal is required",InvalidParameter:"Invalid parameter",WrongNumberOfParameters:"Call with wrong number of parameters",Unrecognized:"Unrecognized code structure",UnrecognizedType:"Unrecognized type",WrongSpatialReference:"Cannot work with geometry in this spatial reference. It is different to the execution spatial reference",BooleanConditionRequired:"Conditions must use booleans",NoFunctionInDictionary:"Dictionaries cannot contain functions.",NoFunctionInArray:"Arrays cannot contain functions.",NoFunctionInTemplateLiteral:"Template Literals do not expect functions by value.",KeyAccessorMustBeString:"Accessor must be a string",KeyMustBeString:"Object keys must be a string",Immutable:"Object is immutable",UnexpectedToken:"Unexpected token",MemberOfNull:"Cannot access property of null object",MaximumCallDepth:"Exceeded maximum function depth",OutOfBounds:"Out of bounds",InvalidIdentifier:"Identifier not recognized",CallNonFunction:"Expression is not a function",InvalidMemberAccessKey:"Cannot access value using a key of this type",AssignModuleFunction:"Cannot assign function to module variable",UnsupportUnaryOperator:"Unsupported unary operator",UnsupportedOperator:"Unsupported operator",LogicalExpressionOnlyBoolean:"Logical expressions must be boolean",LogicExpressionOrAnd:"Logical expression can only be combined with || or &&",CannotChangeTimeZoneTime:"Cannot change the timezone of a Time",CannotChangeTimeZoneDateOnly:"Cannot change the timezone of a DateOnly",FeatureSetDoesNotHaveSubtypes:"FeatureSet does not have subtypes"};let fgt=class extends Error{constructor(...e){super(...e)}},dge=class xRe extends fgt{constructor(e,i){super(tre(i)+e.message,{cause:e}),this.loc=null,Error.captureStackTrace&&Error.captureStackTrace(this,xRe),i?.loc&&(this.loc=i.loc)}},mgt=class SRe extends Error{constructor(e,i,r,s){super("Execution error - "+tre(r)+Cy(wRe[i],s)),this.loc=null,this.declaredRootClass="esri.arcade.arcadeexecutionerror",Error.captureStackTrace&&Error.captureStackTrace(this,SRe),r?.loc&&(this.loc=r.loc)}};function tre(t){return t&&t.loc?`Line : ${t.loc.start?.line}, ${t.loc.start?.column}: `:""}let jGt=class TRe extends Error{constructor(e,i,r,s){super("Compilation error - "+tre(r)+Cy(wRe[i],s)),this.loc=null,this.declaredRootClass="esri.arcade.arcadecompilationerror",Error.captureStackTrace&&Error.captureStackTrace(this,TRe),r?.loc&&(this.loc=r.loc)}},qGt=class $Re extends Error{constructor(){super("Uncompilable code structures"),this.declaredRootClass="esri.arcade.arcadeuncompilableerror",Error.captureStackTrace&&Error.captureStackTrace(this,$Re)}};function GGt(t,e,i){return i.declaredRootClass==="esri.arcade.arcadeexecutionerror"||i.declaredRootClass==="esri.arcade.arcadecompilationerror"?i.loc===null&&e?.loc?new dge(i,{cause:i}):i:(i.declaredRootClass==="esri.arcade.featureset.support.featureseterror"||i.declaredRootClass==="esri.arcade.featureset.support.sqlerror"||i.declaredRootClass,e?.loc?new dge(i,{cause:i}):i)}const ggt={UnrecognizedUri:"Unrecognized uri - {uri}",UnsupportedUriProtocol:"Unrecognized uri protocol"};let HGt=class CRe extends Error{constructor(e,i){super(Cy(ggt[e],i)),this.declaredRootClass="esri.arcade.arcademoduleerror",Error.captureStackTrace&&Error.captureStackTrace(this,CRe)}};function fF(t){return t.toLowerCase().replaceAll(/[\s-]+/g,"")}let WGt=class{constructor(e,i){const r=new Map;for(const s of e){const n=fF(s);if(r.has(n))throw new Error(`${s} already added as ${r.get(n)}`);r.set(n,s)}if(i!=null)for(const[s,n]of i){const a=fF(s);if(r.has(a))throw new Error(`${s} already associated with ${r.get(a)}`);r.set(a,n)}this._enumMap=r}lookup(e){return this._enumMap.get(fF(e))}get(e){const i=this.lookup(e);if(i==null)throw new mgt(null,"InvalidParameter",null);return i}};var J$;let Ef=(J$=class{},J$.instance=new Fc("Etc/UTC"),J$);function ygt(t){return t instanceof a2?t===Ef.instance:t?.toString().toLowerCase()==="unknown"}function YGt(t){return ygt(t)?Ef.instance:t}const _gt={TimeZoneNotRecognized:"Timezone identifier has not been recognized."};let vgt=class MRe extends Error{constructor(e,i){super(Cy(_gt[e],i)),this.declaredRootClass="esri.arcade.arcadedate.dateerror",Error.captureStackTrace&&Error.captureStackTrace(this,MRe)}};function MS(t,e,i){return t<e?t-e:t>i?t-i:0}function ES(t,e,i){return t<e?e:t>i?i:t}let qg=class Vn{constructor(e){this._date=e,this.declaredRootClass="esri.arcade.arcadedate"}static fromParts(e=0,i=1,r=1,s=0,n=0,a=0,o=0,l){if(isNaN(e)||isNaN(i)||isNaN(r)||isNaN(s)||isNaN(n)||isNaN(a)||isNaN(o))return null;const c=lt.local(e,i).daysInMonth;let h=lt.fromObject({day:ES(r,1,c),year:e,month:ES(i,1,12),hour:ES(s,0,23),minute:ES(n,0,59),second:ES(a,0,59),millisecond:ES(o,0,999)},{zone:$f(l)});return h=h.plus({months:MS(i,1,12),days:MS(r,1,c),hours:MS(s,0,23),minutes:MS(n,0,59),seconds:MS(a,0,59),milliseconds:MS(o,0,999)}),new Vn(h)}static get systemTimeZoneCanonicalName(){return Intl.DateTimeFormat().resolvedOptions().timeZone??"system"}static arcadeDateAndZoneToArcadeDate(e,i){const r=$f(i);return e.isUnknownTimeZone||r===Ef.instance?Vn.fromParts(e.year,e.monthJS+1,e.day,e.hour,e.minute,e.second,e.millisecond,r):new Vn(e._date.setZone(r))}static dateJSToArcadeDate(e){return new Vn(lt.fromJSDate(e,{zone:"system"}))}static dateJSAndZoneToArcadeDate(e,i="system"){const r=$f(i);return new Vn(lt.fromJSDate(e,{zone:r}))}static unknownEpochToArcadeDate(e){return new Vn(lt.fromMillis(e,{zone:Ef.instance}))}static unknownDateJSToArcadeDate(e){return new Vn(lt.fromMillis(e.getTime(),{zone:Ef.instance}))}static epochToArcadeDate(e,i="system"){const r=$f(i);return new Vn(lt.fromMillis(e,{zone:r}))}static dateTimeToArcadeDate(e){return new Vn(e)}clone(){return new Vn(this._date)}changeTimeZone(e){const i=$f(e);return Vn.dateTimeToArcadeDate(this._date.setZone(i))}static dateTimeAndZoneToArcadeDate(e,i){const r=$f(i);return e.zone===Ef.instance||r===Ef.instance?Vn.fromParts(e.year,e.month,e.day,e.hour,e.minute,e.second,e.millisecond,r):new Vn(e.setZone(r))}static nowToArcadeDate(e){const i=$f(e);return new Vn(lt.fromJSDate(new Date,{zone:i}))}static nowUTCToArcadeDate(){return new Vn(lt.utc())}get isSystem(){return this.timeZone==="system"||this.timeZone===Vn.systemTimeZoneCanonicalName}equals(e){return this.isSystem&&e.isSystem?this.toNumber()===e.toNumber():this.isUnknownTimeZone===e.isUnknownTimeZone&&this._date.equals(e._date)}get isUnknownTimeZone(){return this._date.zone===Ef.instance}get isValid(){return this._date.isValid}get hour(){return this._date.hour}get second(){return this._date.second}get day(){return this._date.day}get dayOfWeekISO(){return this._date.weekday}get dayOfWeekJS(){let e=this._date.weekday;return e>6&&(e=0),e}get millisecond(){return this._date.millisecond}get monthISO(){return this._date.month}get weekISO(){return this._date.weekNumber}get yearISO(){return this._date.weekYear}get monthJS(){return this._date.month-1}get year(){return this._date.year}get minute(){return this._date.minute}get zone(){return this._date.zone}get timeZoneOffset(){return this.isUnknownTimeZone?0:this._date.offset}get timeZone(){if(this.isUnknownTimeZone)return"unknown";if(this._date.zone.type==="system")return"system";const e=this.zone;return e.type==="fixed"?e.fixed===0?"UTC":e.formatOffset(0,"short"):e.name}stringify(){return JSON.stringify(this.toJSDate())}plus(e){return new Vn(this._date.plus(e))}diff(e,i){return this._date.diff(e._date,i)[i]}toISODate(){return this._date.toISODate()}toISOString(e){return e?this._date.toISO({suppressMilliseconds:!0,includeOffset:!this.isUnknownTimeZone}):this._date.toISO({includeOffset:!this.isUnknownTimeZone})}toISOTime(e,i){return this._date.toISOTime({suppressMilliseconds:e,includeOffset:i&&!this.isUnknownTimeZone})}toFormat(e,i){return this.isUnknownTimeZone&&(e=e.replaceAll("Z","")),this._date.toFormat(e,i)}toJSDate(){return this._date.toJSDate()}toSQLValue(){return this._date.toFormat("yyyy-LL-dd HH:mm:ss")}toSQLWithKeyword(){return`timestamp '${this.toSQLValue()}'`}toDateTime(){return this._date}toNumber(){return this._date.toMillis()}getTime(){return this._date.toMillis()}toUTC(){return new Vn(this._date.toUTC())}toLocal(){return new Vn(this._date.toLocal())}toString(){return this.toISOString(!0)}static fromReaderAsTimeStampOffset(e){if(!e)return null;const i=lt.fromISO(e,{setZone:!0});return new Vn(i)}};function $f(t,e=!0){if(t instanceof a2)return t;switch(fF(t)){case"system":return"system";case"utc":return"UTC";case"unknown":return Ef.instance}if(/^[+-]?[0-9]{1,2}(:[0-9]{2})?$/.test(t)){const r=xa.parseSpecifier("UTC"+(t.startsWith("+")||t.startsWith("-")?"":"+")+t);if(r)return r}const i=Fc.create(t);if(!i.isValid){if(e)throw new vgt("TimeZoneNotRecognized");return null}return i}function pge(t){t=t.replaceAll(/LTS|LT|L{1,4}|l{1,4}/g,"[$&]");let e="";const i=/(\[[^[]*\])|(\\)?([Hh]mm(ss)?|Mo|M{1,4}|Do|DDDo|D{1,4}|d{2,4}|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g;for(const r of t.match(i)||[])switch(r){case"D":e+="d";break;case"DD":e+="dd";break;case"DDD":e+="o";break;case"d":e+="c";break;case"ddd":e+="ccc";break;case"dddd":e+="cccc";break;case"M":e+="L";break;case"MM":e+="LL";break;case"MMM":e+="LLL";break;case"MMMM":e+="LLLL";break;case"YY":e+="yy";break;case"Y":case"YYYY":e+="yyyy";break;case"Q":e+="q";break;case"X":case"x":e+=r;break;default:r.length>=2&&r.startsWith("[")&&r.endsWith("]")?e+=`'${r.slice(1,-1)}'`:e+=`'${r}'`}return e}const fge="esri.core.sql.dateonly";let bgt=class pu{constructor(e,i,r){this._year=e,this._month=i,this._day=r,this.declaredRootClass=fge}static isDateOnly(e){return typeof e=="object"&&e!=null&&"declaredRootClass"in e&&e.declaredRootClass===fge}get month(){return this._month}get monthJS(){return this._month-1}get year(){return this._year}get day(){return this._day}get isValid(){return this.toDateTime("unknown").isValid}equals(e){return pu.isDateOnly(e)&&e.day===this.day&&e.month===this.month&&e.year===this.year}clone(){return new pu(this._year,this._month,this._day)}toDateTime(e){return lt.fromObject({day:this.day,month:this.month,year:this.year},{zone:$f(e)})}toDateTimeLuxon(e){return lt.fromObject({day:this.day,month:this.month,year:this.year},{zone:$f(e)})}toString(){return`${this.year.toString().padStart(4,"0")}-${this.month.toString().padStart(2,"0")}-${this.day.toString().padStart(2,"0")}`}toFormat(e=null,i=!0){if(e===null||e==="")return this.toString();if(i&&(e=pge(e)),!e)return"";const r=this.toDateTime("unknown");return qg.dateTimeToArcadeDate(r).toFormat(e,{locale:Lc(),numberingSystem:"latn"})}toArcadeDate(){const e=this.toDateTime("unknown");return qg.dateTimeToArcadeDate(e)}toNumber(){return this.toDateTime("unknown").toMillis()}toJSDate(){return this.toDateTime("unknown").toJSDate()}toStorageFormat(){return this.toFormat("yyyy-LL-dd",!1)}toSQLValue(){return this.toFormat("yyyy-LL-dd",!1)}toSQLWithKeyword(){return"date '"+this.toFormat("yyyy-LL-dd",!1)+"'"}plus(e,i){return pu.fromDateTime(this.toUTCDateTime().plus({[e]:i}))}toUTCDateTime(){return lt.utc(this.year,this.month,this.day,0,0,0,0)}difference(e,i){switch(i.toLowerCase()){case"days":case"day":case"d":return this.toUTCDateTime().diff(e.toUTCDateTime(),"days").days;case"months":case"month":return this.toUTCDateTime().diff(e.toUTCDateTime(),"months").months;case"minutes":case"minute":case"m":return i==="M"?this.toUTCDateTime().diff(e.toUTCDateTime(),"months").months:this.toUTCDateTime().diff(e.toUTCDateTime(),"minutes").minutes;case"seconds":case"second":case"s":return this.toUTCDateTime().diff(e.toUTCDateTime(),"seconds").seconds;case"milliseconds":case"millisecond":case"ms":default:return this.toUTCDateTime().diff(e.toUTCDateTime(),"milliseconds").milliseconds;case"hours":case"hour":case"h":return this.toUTCDateTime().diff(e.toUTCDateTime(),"hours").hours;case"years":case"year":case"y":return this.toUTCDateTime().diff(e.toUTCDateTime(),"years").years}}static fromMilliseconds(e){const i=lt.fromMillis(e,{zone:xa.utcInstance});return i.isValid?pu.fromParts(i.year,i.month,i.day):null}static fromSeconds(e){const i=lt.fromSeconds(e,{zone:xa.utcInstance});return i.isValid?pu.fromParts(i.year,i.month,i.day):null}static fromReader(e){if(!e)return null;const i=e.split("-");return i.length!==3?null:new pu(parseInt(i[0],10),parseInt(i[1],10),parseInt(i[2],10))}static fromParts(e,i,r){const s=new pu(e,i,r);return s.isValid===!1?null:s}static fromDateJS(e){return pu.fromParts(e.getFullYear(),e.getMonth()+1,e.getDay())}static fromDateTime(e){return pu.fromParts(e.year,e.month,e.day)}static fromSqlTimeStampOffset(e){return this.fromDateTime(e.toDateTime())}static fromString(e,i=null){if(e===""||e===null)return null;const r=[];if(i)(i=pge(i))&&r.push(i);else if(i===null||i===""){const s=lt.fromISO(e,{setZone:!0});return s.isValid?pu.fromParts(s.year,s.month,s.day):null}for(const s of r){const n=lt.fromFormat(e,i??s);if(n.isValid)return new pu(n.year,n.month,n.day)}return null}static fromNow(e="system"){const i=lt.fromJSDate(new Date).setZone($f(e));return new pu(i.year,i.month,i.day)}};function QGt(t){if(t==null)return null;switch(t.type){case"polygon":case"multipoint":case"polyline":return t.extent;case"point":return new Bt({xmin:t.x,ymin:t.y,xmax:t.x,ymax:t.y,spatialReference:t.spatialReference});case"extent":return t}return null}function XGt(t){if(t==null)return null;const e=t.clone();return t.cache._geVersion!==void 0&&(e.cache._geVersion=t.cache._geVersion),e}function AL(t){return typeof t=="number"&&isFinite(t)&&Math.floor(t)===t}function mge(t){if(!t)return"";const e=/(a|A|hh?|HH?|mm?|ss?|SSS|S|.)/g;let i="";for(const r of t.match(e)||[])switch(r){case"SSS":case"m":case"mm":case"h":case"hh":case"H":case"HH":case"s":case"ss":i+=r;break;case"A":case"a":i+="a";break;default:i+=`'${r}'`}return i}const gge="esri.core.sql.timeonly";let wgt=class cf{constructor(e,i,r,s){this._hour=e,this._minute=i,this._second=r,this._millisecond=s,this.declaredRootClass=gge}static isTimeOnly(e){return typeof e=="object"&&e!=null&&"declaredRootClass"in e&&e.declaredRootClass===gge}get hour(){return this._hour}get minute(){return this._minute}get second(){return this._second}get millisecond(){return this._millisecond}equals(e){return cf.isTimeOnly(e)&&e.hour===this.hour&&e.minute===this.minute&&e.second===this.second&&e.millisecond===this.millisecond}clone(){return new cf(this.hour,this.minute,this.second,this.millisecond)}isValid(){return AL(this.hour)&&AL(this.minute)&&AL(this.second)&&AL(this.millisecond)&&this.hour>=0&&this.hour<24&&this.minute>=0&&this.minute<60&&this.second>=0&&this.second<60&&this.millisecond>=0&&this.millisecond<1e3}toString(){return`${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,"0")}`+(this.millisecond>0?"."+this.millisecond.toString().padStart(3,"0"):"")}toSQLValue(){return this.toString()}toSQLWithKeyword(){return`time '${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,"0")}${this.millisecond>0?"."+this.millisecond.toString().padStart(3,"0"):""}'`}toStorageString(){return`${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,"0")}`}toFormat(e=null){return e===null||e===""?this.toString():(e=mge(e))?lt.local(1970,1,1,this._hour,this._minute,this._second,this._millisecond).toFormat(e,{locale:Lc(),numberingSystem:"latn"}):""}toNumber(){return this.millisecond+1e3*this.second+1e3*this.minute*60+60*this.hour*60*1e3}static fromParts(e,i,r,s){const n=new cf(e,i,r,s);return n.isValid()?n:null}static fromReader(e){if(!e)return null;const i=e.split(":");return i.length!==3?null:new cf(parseInt(i[0],10),parseInt(i[1],10),parseInt(i[2],10),0)}static fromMilliseconds(e){if(e>864e5||e<0)return null;const i=Math.floor(e/1e3%60),r=Math.floor(e/6e4%60),s=Math.floor(e/36e5%24),n=Math.floor(e%1e3);return new cf(s,r,i,n)}static fromDateJS(e){return new cf(e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds())}static fromDateTime(e){return new cf(e.hour,e.minute,e.second,e.millisecond)}static fromSqlTimeStampOffset(e){return this.fromDateTime(e.toDateTime())}static fromString(e,i=null){if(e===""||e===null)return null;const r=[];i?(i=mge(i))&&r.push(i):i!==null&&i!==""||(r.push("HH:mm:ss"),r.push("HH:mm:ss.SSS"),r.push("hh:mm:ss a"),r.push("hh:mm:ss.SSS a"),r.push("HH:mm"),r.push("hh:mm a"),r.push("H:mm"),r.push("h:mm a"),r.push("H:mm:ss"),r.push("h:mm:ss a"),r.push("H:mm:ss.SSS"),r.push("h:mm:ss.SSS a"));for(const s of r){const n=lt.fromFormat(e,s);if(n.isValid)return new cf(n.hour,n.minute,n.second,n.millisecond)}return null}plus(e,i){switch(e){case"days":case"years":case"months":return this.clone();case"hours":case"minutes":case"seconds":case"milliseconds":return cf.fromDateTime(this.toUTCDateTime().plus({[e]:i}))}return null}toUTCDateTime(){return lt.utc(1970,1,1,this.hour,this.minute,this.second,this.millisecond)}difference(e,i){switch(i.toLowerCase()){case"days":case"day":case"d":return this.toUTCDateTime().diff(e.toUTCDateTime(),"days").days;case"months":case"month":return this.toUTCDateTime().diff(e.toUTCDateTime(),"months").months;case"minutes":case"minute":case"m":return i==="M"?this.toUTCDateTime().diff(e.toUTCDateTime(),"months").months:this.toUTCDateTime().diff(e.toUTCDateTime(),"minutes").minutes;case"seconds":case"second":case"s":return this.toUTCDateTime().diff(e.toUTCDateTime(),"seconds").seconds;case"milliseconds":case"millisecond":case"ms":default:return this.toUTCDateTime().diff(e.toUTCDateTime(),"milliseconds").milliseconds;case"hours":case"hour":case"h":return this.toUTCDateTime().diff(e.toUTCDateTime(),"hours").hours;case"years":case"year":case"y":return this.toUTCDateTime().diff(e.toUTCDateTime(),"years").years}}};function xgt(t){return"timeZone"in t}function Sgt(t){return"timeZone"in t}function Tgt(t){return"dateFieldsTimeZone"in t}const $gt=new Map;let Cgt=class mF{static fromJSON(e){return new mF(e.fields,e.timeZoneByFieldName)}static fromLayer(e){return new mF(e.fields??[],_ge(e))}static fromLayerJSON(e){return new mF(e.fields??[],_ge(e))}constructor(e=[],i){this._fieldsMap=new Map,this._normalizedFieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this._requiredFields=null,this.dateFields=[],this.numericFields=[],this.fields=e||[],this._timeZoneByFieldName=i?new Map(i):null;const r=[];for(const s of this.fields){const n=s?.name,a=yge(n);if(n&&a){const o=jb(n);this._fieldsMap.set(n,s),this._fieldsMap.set(o,s),this._normalizedFieldsMap.set(a,s),r.push(`${o}:${s.type}:${this._timeZoneByFieldName?.get(n)}`),Pte(s)?(this.dateFields.push(s),this._dateFieldsSet.add(s)):l4(s)&&(this._numericFieldsSet.add(s),this.numericFields.push(s)),rpe(s)||spe(s)||(s.editable=s.editable==null||!!s.editable,s.nullable=s.nullable==null||!!s.nullable)}}r.sort(),this.uid=r.join()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const e of this.fields)rpe(e)||spe(e)||e.nullable||cit(e)!==void 0||this._requiredFields.push(e)}return this._requiredFields}equals(e){return this.uid===e?.uid}has(e){return this.get(e)!=null}get(e){if(!e)return;let i=this._fieldsMap.get(e);return i||(i=this._fieldsMap.get(jb(e))??this._normalizedFieldsMap.get(yge(e)),i&&this._fieldsMap.set(e,i),i)}getTimeZone(e){const i=this.get(e&&typeof e!="string"?e.name:e);return i?this._timeZoneByFieldName?this._timeZoneByFieldName.get(i.name):i.type==="date"||i.type==="esriFieldTypeDate"?(fe.getLogger("esri.layers.support.FieldsIndex").errorOnce(new ee("getTimeZone:no-timezone-information",`no time zone information for field '${i.name}'`)),_v):ERe.has(i.type)?yv:null:null}getLuxonTimeZone(e){const i=this.getTimeZone(e);return i?i===yv?Ef.instance:i===_v?xa.utcInstance:Cu($gt,i,()=>Fc.create(i)):null}isDateField(e){return this._dateFieldsSet.has(this.get(e))}isTimeOnlyField(e){return qCe(this.get(e))}isNumericField(e){return this._numericFieldsSet.has(this.get(e))}normalizeFieldName(e){return this.get(e)?.name??void 0}toJSON(){return{fields:this.fields.map(e=>OR(e)?e.toJSON():e),timeZoneByFieldName:this._timeZoneByFieldName?Array.from(this._timeZoneByFieldName.entries()):null}}};function jb(t){return t.trim().toLowerCase()}function yge(t){return Xtt(t)?.toLowerCase()??""}const ERe=new Set(["time-only","date-only","timestamp-offset","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]);function _ge(t){const e=new Map;if(!t.fields)return e;const i=t.datesInUnknownTimezone===!0,{timeInfo:r,editFieldsInfo:s}=t,n=(r?"startField"in r?r.startField:r.startTimeField:"")??"",a=(r?"endField"in r?r.endField:r.endTimeField:"")??"",o=Tgt(t)?t.dateFieldsTimeZone??null:t.dateFieldsTimeReference?oz(t.dateFieldsTimeReference):null,l=s?xgt(s)?s.timeZone??o:s.dateFieldsTimeReference?oz(s.dateFieldsTimeReference):o??_v:null,c=r?Sgt(r)?r.timeZone??o:r.timeReference?oz(r.timeReference):o:null,h=new Map([[jb(s?.creationDateField??""),l],[jb(s?.editDateField??""),l],[jb(n),c],[jb(a),c]]);for(const{name:f,type:y}of t.fields)if(ERe.has(y))e.set(f,yv);else if(y!=="date"&&y!=="esriFieldTypeDate")e.set(f,null);else if(i)e.set(f,yv);else{const _=h.get(jb(f??""))??o;e.set(f,_)}return e}const Mgt=["geometry","scale","timeProperties"];function JGt(t,e){if(e!=null)for(const i of Mgt)e.hasArcadeDependency(i)&&t.add(i);return t}function Egt(t,e){return ire.create(t,e,null,["$feature","$view"])}function KGt(t,e){return ire.create(t,e,null,["$feature","$view"])}function eHt(t,e,i){return ire.create(t,e,i,["$feature","$view","$config"])}let ire=class ARe{static async create(e,i,r,s){const{arcade:n,Dictionary:a}=await Ete();let o;try{o=n.parseScript(e)}catch(_){throw new ee("arcade-bad-expression","Failed to parse arcade script",{script:e,error:_})}const l=n.scriptUsesGeometryEngine(o);l&&await n.enableGeometrySupport(),await n.loadDependentModules(new Set,o,null,!1,l);const c={vars:s.reduce((_,w)=>({..._,[w]:null}),{}),spatialReference:i,useAsync:!1},h=n.compileScript(o,c);let f=null;r!=null&&(f=new a(r),f.immutable=!0);const y=new a;return y.immutable=!1,y.setField("scale",0),new ARe(e,n,o,h,i,y,f,a)}constructor(e,i,r,s,n,a,o,l){this.script=e,this._arcade=i,this._syntaxTree=r,this._compiled=s,this._spatialReference=n,this._viewDict=a,this._configDict=o,this._dictionaryCtor=l,this._dependencies=new Map,this._featureReader=new Agt,this._dependencies.set("geometry",i.scriptTouchesGeometry(this._syntaxTree)),this._dependencies.set("scale",this._arcade.referencesMember(this._syntaxTree,"scale")),this._dependencies.set("timeProperties",this._arcade.scriptUsesViewProperties(this._syntaxTree,["timeProperties"]))}evaluate(e,i){const r=i.$view?.timeZone;if(i.$view){let s;if(this._viewDict.setField("scale",i.$view.scale),i.$view.timeProperties!=null){const{currentStart:n,currentEnd:a}=i.$view.timeProperties;s=new this._dictionaryCtor({currentStart:n!=null?r!=null?qg.epochToArcadeDate(n,r):qg.unknownEpochToArcadeDate(n):void 0,currentEnd:a!=null?r!=null?qg.epochToArcadeDate(a,r):qg.unknownEpochToArcadeDate(a):void 0,startIncluded:!0,endIncluded:!0})}this._viewDict.setField("timeProperties",s)}return this._compiled({vars:{$view:this._viewDict,$config:this._configDict,$feature:e},spatialReference:this._spatialReference,timeZone:r})}repurposeFeature(e,i){return this._featureReader.bind(e,i,this._spatialReference),this._featureReader}references(e){return this._dependencies.get(e)??!1}},Agt=class{constructor(){this._boundTarget=null,this._boundSchema={fields:null,fieldsIndex:null,spatialReference:null,get geometryType(){return null},get objectIdField(){return null}},this.arcadeDeclaredClass="esri.arcade.Feature",this._contextTimeZone=null}bind(e,i,r){const s=i??new Cgt(Ogt(e.attributes));this._boundTarget=e,this._boundSchema.fields=s.fields,this._boundSchema.fieldsIndex=s,this._boundSchema.spatialReference=r}_getField(e){return this._boundSchema.fieldsIndex.get(e)}get contextTimeZone(){return this._contextTimeZone}set contextTimeZone(e){this._contextTimeZone=e}readArcadeFeature(){return this}hasField(e){return this._boundSchema.fieldsIndex.has(e)}geometry(){if("fromJSON"in this._boundTarget)return this._boundTarget.geometry;const e=hy(this._boundTarget.geometry);if(e){if(!this._boundSchema.spatialReference)throw new Error("InternalError: Expected spatial reference to be defined");e.spatialReference=this._boundSchema.spatialReference}return e}_hasGeometry(){return this._boundTarget.geometry!=null}isUnknownDateTimeField(e){return this._boundSchema.fieldsIndex.getTimeZone(e)===yv}field(e,i=!0){const r=this._getField(e);if(r){const s=this._boundTarget.attributes[r.name];if(s==null)return null;switch(r.type){case"date-only":case"esriFieldTypeDateOnly":return bgt.fromReader(s);case"time-only":case"esriFieldTypeTimeOnly":return wgt.fromReader(s);case"esriFieldTypeTimestampOffset":case"timestamp-offset":return qg.fromReaderAsTimeStampOffset(s);case"date":case"esriFieldTypeDate":return this.isUnknownDateTimeField(e)?qg.unknownEpochToArcadeDate(s):qg.epochToArcadeDate(s,this.contextTimeZone??vp);default:return s}}if(i)throw new Error(`Field ${e} does not exist`);return null}setField(e,i){throw new Error("Unable to update feature attribute values, feature is readonly")}keys(){return this._boundSchema.fieldsIndex.fields.map(e=>e.name)}isEmpty(){return this._boundSchema.fields.length<=0&&!this._hasGeometry()}castToText(e=!1){return JSON.stringify(this._boundTarget)}gdbVersion(){return null}fullSchema(){return this._boundSchema}castAsJson(e=null){return{attributes:this._boundTarget.attributes,geometry:e?.keepGeometryType===!0?this.geometry():this.geometry()?.toJSON()??null}}castAsJsonAsync(e=null,i=null){return Promise.resolve(this.castAsJson(i))}};function Ogt(t){const e=[];for(const i in t)e.push({name:i,alias:i,type:typeof t[i]=="string"?"esriFieldTypeString":"esriFieldTypeDouble"});return e}const kq=()=>fe.getLogger("esri.layers.support.labelFormatUtils"),zq={type:"simple",evaluate:()=>null},Pgt={getAttribute:(t,e)=>t.field(e)};async function Rgt(t,e,i){if(!t||!t.symbol||!e)return zq;const r=t.where,s=ere(t);let n;if(s.type==="arcade"){const a=LCe(s.expression),o=e.get(a);if(o&&(vit(o)||l4(o)||jCe(o)))n={type:"simple",evaluate(l){const c="attributes"in l?l.attributes?.[o.name]:l.field(o.name);return c==null?"":c.toString()}};else{const l=await Egt(s.expression,i);if(l==null)return zq;n={type:"arcade",evaluate(c,h){try{const f="attributes"in c?l.repurposeFeature(c,e):c;f.contextTimeZone=h??null;const y=l.evaluate(f,{$view:{timeZone:h}});if(y!=null)return y.toString()}catch(f){kq().error(new ee("arcade-expression-error","Encountered an error when evaluating label expression for feature",{error:f,feature:c,expression:s}))}return null},needsHydrationToEvaluate:()=>bRe(s.expression)==null}}}else n={type:"simple",evaluate:a=>s.expression.replaceAll(/{[^}]*}/g,o=>{const l=o.slice(1,-1),c=e.get(l);if(!c)return o;let h=null;return h="attributes"in a?a?.attributes?.[c.name]:a.field(c.name),h==null?"":Dgt(h,c)})};if(r){let a;try{a=await nSe(r,e)}catch(l){return kq().error(new ee("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:r,error:l})),zq}const o=n.evaluate;n.evaluate=(l,c)=>{const h="attributes"in l?void 0:Pgt;try{if(a.testFeature(l,h))return o(l,c)}catch(f){kq().error(new ee("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:r,feature:l,error:f}))}return null}}return n}function Dgt(t,e){if(t==null)return"";const i=e.domain;if(i){if(i.type==="codedValue"||i.type==="coded-value"){const s=t;for(const n of i.codedValues)if(n.code===s)return n.name}else if(i.type==="range"){const{max:s,min:n}=Gtt(e),a=+t;if(n!=null&&s!=null&&n<=a&&a<=s)return i.name}}let r=t;return Pte(e)?r=vv(r,IZe("short-date")):l4(e)&&(r=dy(+r)),r||""}let Igt=class{constructor(e,i){this.renderer=e,this.symbol=i,this.color=null,this.size=null,this.opacity=null,this.outlineSize=null,this.heading=null,this.tilt=null,this.roll=null}};function rHt(t,e,i,r,s,n,a,o,l,c,h){const f=Ugt[h.mode];let y,_,w=0;if(Aa(t,e,i,r,l.spatialReference,s,o))return f?.requiresAlignment(h)?(w=f.applyElevationAlignmentBuffer(r,s,n,a,o,l,c,h),y=n,_=a):(y=r,_=s),Aa(y,l.spatialReference,_,n,c.spatialReference,a,o)?w:void 0}function rre(t,e,i,r,s){const n=($6(t)?t.z:YEe(t)?t.array[t.offset+2]:t[2])||0;switch(i.mode){case"on-the-ground":{const a=Ff(e,t,"ground")??0;return s.verticalDistanceToGround=0,s.sampledElevation=a,void(s.z=a)}case"relative-to-ground":{const a=Ff(e,t,"ground")??0,o=i.geometryZWithOffset(n,r);return s.verticalDistanceToGround=o,s.sampledElevation=a,void(s.z=o+a)}case"relative-to-scene":{const a=Ff(e,t,"scene")??0,o=i.geometryZWithOffset(n,r);return s.verticalDistanceToGround=o,s.sampledElevation=a,void(s.z=o+a)}case"absolute-height":{const a=i.geometryZWithOffset(n,r),o=Ff(e,t,"ground")??0;return s.verticalDistanceToGround=a-o,s.sampledElevation=o,void(s.z=a)}default:return void(s.z=0)}}function sHt(t,e,i,r){return rre(t,e,i,r,T3),T3.z}function Lgt(t,e,i){return e==="on-the-ground"&&i==="on-the-ground"?t.staysOnTheGround:e===i||e!=="on-the-ground"&&i!=="on-the-ground"?e==null||i==null?t.definedChanged:1:t.onTheGroundChanged}function vge(t){return t==="relative-to-ground"||t==="relative-to-scene"}function nHt(t){return t!=="absolute-height"}function ORe(t,e,i,r,s){rre(e,i,s,r,T3),PRe(t,T3.verticalDistanceToGround);const n=T3.sampledElevation,a=pn(Bgt,t.transformation);return OL[0]=e.x,OL[1]=e.y,OL[2]=T3.z,h4(e.spatialReference,OL,a,r.spatialReference)?t.transformation=a:console.warn("Could not locate symbol object properly, it might be misplaced"),n}function PRe(t,e){for(let i=0;i<t.geometries.length;++i){const r=t.geometries[i].getMutableAttribute("centerOffsetAndDistance");r&&r.data[3]!==e&&(r.data[3]=e,t.geometryVertexAttributeUpdated(t.geometries[i],"centerOffsetAndDistance"))}}function kgt(t,e,i,r,s,n){let a=0;const o=n.spatialReference;e*=3,r*=3;for(let l=0;l<s;++l){const c=t[e],h=t[e+1],f=t[e+2],y=n.getElevation(c,h,f,o,"ground")??0;a+=y,i[r]=c,i[r+1]=h,i[r+2]=y,e+=3,r+=3}return a/s}function zgt(t,e,i,r,s,n,a,o){let l=0;const c=o.calculateOffsetRenderUnits(a),h=o.featureExpressionInfoContext,f=n.spatialReference;e*=3,r*=3;for(let y=0;y<s;++y){const _=t[e],w=t[e+1],x=t[e+2],S=n.getElevation(_,w,x,f,"ground")??0;l+=S,i[r]=_,i[r+1]=w,i[r+2]=h==null?x+S+c:S+c,e+=3,r+=3}return l/s}function Fgt(t,e,i,r,s,n,a,o){let l=0;const c=o.calculateOffsetRenderUnits(a),h=o.featureExpressionInfoContext,f=n.spatialReference;e*=3,r*=3;for(let y=0;y<s;++y){const _=t[e],w=t[e+1],x=t[e+2],S=n.getElevation(_,w,x,f,"scene")??0;l+=S,i[r]=_,i[r+1]=w,i[r+2]=h==null?x+S+c:S+c,e+=3,r+=3}return l/s}function Ngt(t){const e=t.meterUnitOffset,i=t.featureExpressionInfoContext;return e!==0||i!=null}function Vgt(t,e,i,r,s,n,a,o){const l=o.calculateOffsetRenderUnits(a),c=o.featureExpressionInfoContext;e*=3,r*=3;for(let h=0;h<s;++h){const f=t[e],y=t[e+1],_=t[e+2];i[r]=f,i[r+1]=y,i[r+2]=c==null?_+l:l,e+=3,r+=3}return 0}let RRe=class{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}};const Ugt={"absolute-height":{applyElevationAlignmentBuffer:Vgt,requiresAlignment:Ngt},"on-the-ground":{applyElevationAlignmentBuffer:kgt,requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:zgt,requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:Fgt,requiresAlignment:()=>!0}},Bgt=it(),T3=new RRe,OL=R();function jgt(t){if(t.length<Hl)return Array.from(t);if(Array.isArray(t))return Float64Array.from(t);if(!("BYTES_PER_ELEMENT"in t))return Array.from(t);switch(t.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(t);case 2:return Gbe(t)?y4().from(t):QV(t)?Uint16Array.from(t):Int16Array.from(t);case 4:return Float32Array.from(t);default:return Float64Array.from(t)}}let DRe=class IRe{get center(){return Ge(this._data[0],this._data[1],this._data[2])}get radius(){return this._data[3]}get bbMin(){return Ge(this._data[4],this._data[5],this._data[6])}get bbMax(){return Ge(this._data[7],this._data[8],this._data[9])}constructor(e,i,r){this.primitiveIndices=e,this._numIndexPerPrimitive=i,this.position=r,this._data=[.1,0,0,0,0,0,0,0,0,0],this._children=void 0,dt(e.length>=1),dt(r.size===3||r.size===4);const{data:s,size:n,indices:a}=r;dt(a.length%this._numIndexPerPrimitive===0),dt(a.length>=e.length*this._numIndexPerPrimitive);const o=e.length;let l=n*a[this._numIndexPerPrimitive*e[0]];P1.clear(),P1.push(l);const c=Ge(s[l],s[l+1],s[l+2]),h=cr(c);for(let w=0;w<o;++w){const x=this._numIndexPerPrimitive*e[w];for(let S=0;S<this._numIndexPerPrimitive;++S){l=n*a[x+S],P1.push(l);let $=s[l];c[0]=Math.min($,c[0]),h[0]=Math.max($,h[0]),$=s[l+1],c[1]=Math.min($,c[1]),h[1]=Math.max($,h[1]),$=s[l+2],c[2]=Math.min($,c[2]),h[2]=Math.max($,h[2])}}for(let w=0;w<3;++w)this._data[4+w]=c[w],this._data[7+w]=h[w];const f=Wi(R(),this.bbMin,this.bbMax,.5);let y=.5*Math.max(Math.max(h[0]-c[0],h[1]-c[1]),h[2]-c[2]),_=y*y;for(let w=0;w<P1.length;++w){l=P1.at(w);const x=s[l]-f[0],S=s[l+1]-f[1],$=s[l+2]-f[2],A=x*x+S*S+$*$;if(A<=_)continue;const M=Math.sqrt(A),P=.5*(M-y);y+=P,_=y*y;const O=P/M;f[0]+=x*O,f[1]+=S*O,f[2]+=$*O}this._data[3]=y;for(let w=0;w<3;++w)this._data[0+w]=f[w];P1.clear()}getChildren(){if(this._children||on(this.bbMin,this.bbMax)<=1)return this._children;const e=Wi(R(),this.bbMin,this.bbMax,.5),i=this.primitiveIndices.length,r=new Uint8Array(i),s=new Array(8);for(let h=0;h<8;++h)s[h]=0;const{data:n,size:a,indices:o}=this.position;for(let h=0;h<i;++h){let f=0;const y=this._numIndexPerPrimitive*this.primitiveIndices[h];let _=a*o[y],w=n[_],x=n[_+1],S=n[_+2];for(let $=1;$<this._numIndexPerPrimitive;++$){_=a*o[y+$];const A=n[_],M=n[_+1],P=n[_+2];A<w&&(w=A),M<x&&(x=M),P<S&&(S=P)}w<e[0]&&(f|=1),x<e[1]&&(f|=2),S<e[2]&&(f|=4),r[h]=f,++s[f]}let l=0;for(let h=0;h<8;++h)s[h]>0&&++l;if(l<2)return;const c=new Array(8);for(let h=0;h<8;++h)c[h]=s[h]>0?new Uint32Array(s[h]):void 0;for(let h=0;h<8;++h)s[h]=0;for(let h=0;h<i;++h){const f=r[h];c[f][s[f]++]=this.primitiveIndices[h]}this._children=new Array;for(let h=0;h<8;++h)c[h]!==void 0&&this._children.push(new IRe(c[h],this._numIndexPerPrimitive,this.position));return this._children}static prune(){P1.prune()}};const P1=new _i({deallocator:null});let LRe=class{constructor(e){this.id=ql(),this._attributes=new Map;for(const[i,r]of e)this._attributes.set(i,{...r,indices:d8(r.indices)})}get attributes(){return this._attributes}};function qgt(t){return t?{p0:cr(t.p0),p1:cr(t.p1),p2:cr(t.p2)}:{p0:R(),p1:R(),p2:R()}}function Ggt(t,e,i){const r=e[0]-t[0],s=e[1]-t[1],n=i[0]-t[0],a=i[1]-t[1];return .5*Math.abs(r*a-s*n)}function Hgt(t,e,i){return Ce(Fq,e,t),Ce(bge,i,t),.5*Le(bt(Fq,Fq,bge))}new Ay(Oy);new Ay(()=>qgt());const Fq=R(),bge=R();function Wgt(t,e){if(!t)return!1;const{size:i,data:r,indices:s}=t;ve(e,0,0,0),ve(Ah,0,0,0);let n=0,a=0;for(let o=0;o<s.length-2;o+=3){const l=s[o]*i,c=s[o+1]*i,h=s[o+2]*i;ve(ba,r[l],r[l+1],r[l+2]),ve(Ng,r[c],r[c+1],r[c+2]),ve(PL,r[h],r[h+1],r[h+2]);const f=Hgt(ba,Ng,PL);f?(xe(ba,ba,Ng),xe(ba,ba,PL),le(ba,ba,1/3*f),xe(e,e,ba),n+=f):(xe(Ah,Ah,ba),xe(Ah,Ah,Ng),xe(Ah,Ah,PL),a+=3)}return(a!==0||n!==0)&&(n!==0?(le(e,e,1/n),!0):a!==0&&(le(e,Ah,1/a),!0))}function Zgt(t,e){if(!t)return!1;const{size:i,data:r,indices:s}=t;ve(e,0,0,0);let n=-1,a=0;for(let o=0;o<s.length;o++){const l=s[o]*i;n!==l&&(e[0]+=r[l],e[1]+=r[l+1],e[2]+=r[l+2],a++),n=l}return a>1&&le(e,e,1/a),a>0}function Ygt(t,e,i){if(!t)return!1;ve(i,0,0,0),ve(Ah,0,0,0);let r=0,s=0;const{size:n,data:a,indices:o}=t,l=o.length-1,c=l+(e?2:0);for(let h=0;h<c;h+=2){const f=h<l?h+1:0,y=o[h<l?h:l]*n,_=o[f]*n;ba[0]=a[y],ba[1]=a[y+1],ba[2]=a[y+2],Ng[0]=a[_],Ng[1]=a[_+1],Ng[2]=a[_+2],le(ba,xe(ba,ba,Ng),.5);const w=s4(ba,Ng);w>0?(xe(i,i,le(ba,ba,w)),r+=w):r===0&&(xe(Ah,Ah,ba),s++)}return r!==0?(le(i,i,1/r),!0):s!==0&&(le(i,Ah,1/s),!0)}const ba=R(),Ng=R(),PL=R(),Ah=R();let kRe=class{constructor(){this.uid=ql()}},zRe=class extends kRe{constructor(e){super(),this.highlightName=e,this.channel=0}},Qgt=class extends kRe{constructor(){super(...arguments),this.channel=1}},Xl=class FRe extends LRe{constructor(e,i,r=null,s=0,n=null,a=-1,o){super(i),this.material=e,this.mapPositions=r,this.type=s,this.olidColor=n,this.edgeIndicesLength=a,this.baseGeometry=o,this._highlights=null,this._highlightOptionsCounts=null,this.visible=!0,this._boundingInfo=null;const l=this.positionAttribute;l!=null&&this.edgeIndicesLength<0&&(this.edgeIndicesLength=l.indices.length)}instantiate(e={}){const i=new FRe(e.material||this.material,[],this.mapPositions,this.type,this.olidColor,this.edgeIndicesLength,this.baseGeometry);return this._attributes.forEach((r,s)=>{r.exclusive=!1,i._attributes.set(s,r)}),i._boundingInfo=this._boundingInfo,i.transformation=e.transformation||this.transformation,i}getMutableAttribute(e){let i=this._attributes.get(e);return i&&!i.exclusive&&(i={...i,exclusive:!0,data:jgt(i.data)},this._attributes.set(e,i)),i}setAttributeData(e,i){const r=this._attributes.get(e);r?this._attributes.set(e,{...r,exclusive:!0,data:i}):Ko()&&console.warn(`Setting undefined attribute ${e} data`)}get positionAttribute(){return this.attributes.get("position")??this.baseGeometry?.attributes.get("position")}get indexCount(){return this._attributes.values().next().value?.indices?.length??0}get faceCount(){return this.indexCount/3}get boundingInfo(){return this._boundingInfo??=this._calculateBoundingInfo(),this._boundingInfo}computeAttachmentOrigin(e){return!!(this.type===0?this._computeAttachmentOriginTriangles(e):this.type===2?this._computeAttachmentOriginLines(e):this._computeAttachmentOriginPoints(e))&&(this._transformation!=null&&Mt(e,e,this._transformation),!0)}_computeAttachmentOriginTriangles(e){const i=this.positionAttribute;return Wgt(i,e)}_computeAttachmentOriginLines(e){const i=this.positionAttribute;return Ygt(i,Xgt(this.material.parameters,i),e)}_computeAttachmentOriginPoints(e){const i=this.positionAttribute;return Zgt(i,e)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const e=this.positionAttribute;if(!e||e.indices.length===0)return null;const i=this.type===0?3:1;dt(e.indices.length%i===0,"Indexing error: "+e.indices.length+" not divisible by "+i);const r=xM(e.indices.length/i);return new DRe(r,i,e)}get transformation(){return this._transformation??Ro}set transformation(e){this._transformation=e&&e!==Ro?v3e(e):null}get highlights(){return this._highlights||Jgt}get hasHighlights(){return(this._highlightOptionsCounts?.size??0)>0}foreachHighlightOptions(e){this._highlightOptionsCounts?.forEach((i,r)=>e(r))}allocateIdAndHighlight(e){const i=new zRe(e);return this.addHighlight(i)}addHighlight(e){this._ensureHighlights().add(e);const{highlightName:i}=e,r=(this._highlightOptionsCounts?.get(i)??0)+1;return this._ensureHighlightOptionsCounts().set(i,r),e}_ensureHighlights(){let e=this._highlights;return e||(e=new Set,this._highlights=e),e}_ensureHighlightOptionsCounts(){let e=this._highlightOptionsCounts;return e||(e=new Map,this._highlightOptionsCounts=e),e}removeHighlight(e){if(this._highlights?.delete(e)){const{highlightName:i}=e,r=this._highlightOptionsCounts?.get(i)??0;r<=1?this._highlightOptionsCounts?.delete(i):this._ensureHighlightOptionsCounts().set(i,r-1)}}};function Xgt(t,e){return!(!("isClosed"in t)||!t.isClosed)&&e.indices.length>2}const Jgt=new Set;function NRe(t){return t.mapPositions!=null}function hHt(t,e,i,r,s){const n=t.stageObject,a=n.geometries;let o=0;for(const l of a){if(!NRe(l))continue;const{update:c,averageGeometrySampledElevation:h}=URe(l,e,i,r,s);o+=h,c&&n.geometryVertexAttributeUpdated(l,"position")}return o/a.length}function Kgt(t,e,i,r,s,n){const a=t.stageObject,o=e.centerInElevationSR;let l=0;r(o,Oc),a.usesVerticalDistanceToGround?(PRe(a,Oc.verticalDistanceToGround),l=Oc.sampledElevation):e.mode!=="absolute-height"&&(l=Oc.sampledElevation);const c=pn(eyt,n??a.transformation),h=ve(VRe,c[12],c[13],c[14]);Ws.TESTS_DISABLE_OPTIMIZATIONS?(Fl[0]=o[0],Fl[1]=o[1],Fl[2]=Oc.z,h4(i,Fl,c,s.spatialReference)&&(n?pn(n,c):a.transformation=c)):s.setAltitudeOfTransformation(Oc.z,c);const f=sre/s.unitInMeters;return(Math.abs(c[12]-h[0])>=f||Math.abs(c[13]-h[1])>=f||Math.abs(c[14]-h[2])>=f)&&(n?pn(n,c):a.transformation=c),l}const eyt=it();function dHt(t,e,i,r,s){const n=t.graphics3DSymbolLayer.lodRenderer;if(n==null)return 0;const a=e.centerInElevationSR;r(a,Oc);const o=e.mode!=="absolute-height"?Oc.sampledElevation:0,l=n.instanceData,c=t.instanceIndex,h=tyt;l.getGlobalTransform(c,h);const f=ve(VRe,h[12],h[13],h[14]);Ws.TESTS_DISABLE_OPTIMIZATIONS?(Fl[0]=a[0],Fl[1]=a[1],Fl[2]=Oc.z,h4(i,Fl,h,s.spatialReference)&&l.setGlobalTransform(c,h)):s.setAltitudeOfTransformation(Oc.z,h);const y=sre/s.unitInMeters;return(Ws.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(h[12]-f[0])>=y||Math.abs(h[13]-f[1])>=y||Math.abs(h[14]-f[2])>=y)&&l.setGlobalTransform(c,h),o}function pHt(t,e,i,r,s){const n=t.stageObject,a=n.geometries;if(a.length===0)return 0;let o=0,l=null,c=0,h=!1;for(const f of a){if(!NRe(f))continue;const y=f.attributes.get("position");if(y!==l){const{update:_,averageGeometrySampledElevation:w}=URe(f,e,i,r,s);c=w,l=y,h=_}h&&n.geometryVertexAttributeUpdated(f,"position"),o+=c}return o/a.length}const sre=.01,Fl=R(),oh=R(),AS=R(),tyt=it(),VRe=R(),Oc=new RRe;function URe(t,e,i,r,s){let n=!1;const a=t.transformation,o=e.requiresSampledElevationInfo;oh[0]=a[12],oh[1]=a[13],oh[2]=a[14],t.invalidateBoundingInfo();const l=t.getMutableAttribute("position"),c=l.data,h=l.size,f=c.length/h,y=new Eot(t.mapPositions,i);let _=0,w=0;for(let x=0;x<f;x++){if(AS[0]=c[_],AS[1]=c[_+1],AS[2]=c[_+2],r(y,Oc),o&&(w+=Oc.sampledElevation),Ws.TESTS_DISABLE_OPTIMIZATIONS)c[_]=y.array[y.offset],c[_+1]=y.array[y.offset+1],c[_+2]=Oc.z,Aa(c,i,_,c,s.spatialReference,_,1),c[_]-=oh[0],c[_+1]-=oh[1],c[_+2]-=oh[2],n=!0;else{Fl[0]=c[_]+oh[0],Fl[1]=c[_+1]+oh[1],Fl[2]=c[_+2]+oh[2],s.setAltitude(Fl,Oc.z),c[_]=Fl[0]-oh[0],c[_+1]=Fl[1]-oh[1],c[_+2]=Fl[2]-oh[2];const S=sre/s.unitInMeters;(Math.abs(AS[0]-c[_])>=S||Math.abs(AS[1]-c[_+1])>=S||Math.abs(AS[2]-c[_+2])>=S)&&(n=!0)}_+=h,y.offset+=3}return w/=f,{update:n,averageGeometrySampledElevation:w}}let iyt=class{constructor(e,i,r){this.graphic=e,this.renderingInfo=i,this.layer=r}};var _X,$x;let FO=($x=class extends ur(ke){constructor(e){super(e),this.type="georeferenced",this.origin=null}},_X=$x,$x.absolute=new _X,$x);d([Et({georeferenced:"georeferenced"},{readOnly:!0})],FO.prototype,"type",void 0),d([m({type:[Number],nonNullable:!1,json:{write:!0}})],FO.prototype,"origin",void 0),FO=_X=d([k("esri.geometry.support.MeshGeoreferencedVertexSpace")],FO);let NO=class extends ur(ke){constructor(e){super(e),this.type="local",this.origin=R()}};d([Et({local:"local"},{readOnly:!0})],NO.prototype,"type",void 0),d([m({type:[Number],nonNullable:!0,json:{write:!0}})],NO.prototype,"origin",void 0),NO=d([k("esri.geometry.support.MeshLocalVertexSpace")],NO);function gHt(t){return t.origin==null}function BRe(t){return t.origin!=null}function yHt(t){return BRe(t.vertexSpace)}function ryt(t,e){if(!BRe(t))return null;const[i,r,s]=t.origin;return new Qe({x:i,y:r,z:s,spatialReference:e})}function _Ht(t,e){const{x:i,y:r,z:s,spatialReference:n}=t,a=[i,r,s??0];return(e?.vertexSpace??syt(n))==="local"?new NO({origin:a}):new FO({origin:a})}function syt(t){return t.isGeographic||t.isWebMercator?"local":"georeferenced"}function vHt(t,e){return t.type===e.type&&(t.origin===e.origin||t.origin!=null&&e.origin!=null&&si(t.origin,e.origin))}function jRe(t,e){if(t.type==="point")return P0(t,e,!1);if(gRe(t))switch(t.type){case"extent":return P0(t.center,e,!1);case"polygon":return P0(xge(t),e,!1);case"polyline":return P0(wge(t),e,!0);case"mesh":return P0(ryt(t.vertexSpace,t.spatialReference)??t.extent.center,e,!1);case"multipoint":return}else switch(t.type){case"extent":return P0(nyt(t),e,!0);case"polygon":return P0(xge(t),e,!0);case"polyline":return P0(wge(t),e,!0);case"multipoint":return}}function wge(t){const e=t.paths[0];if(!e||e.length===0)return null;const i=H2e(e,G2e(e)/2);return Ep(i[0],i[1],i[2],t.spatialReference)}function nyt(t){return Ep(.5*(t.xmax+t.xmin),.5*(t.ymax+t.ymin),t.zmin!=null&&t.zmax!=null&&isFinite(t.zmin)&&isFinite(t.zmax)?.5*(t.zmax+t.zmin):void 0,t.spatialReference)}function xge(t){const e=t.rings[0];if(!e||e.length===0)return null;const i=X2e(t.rings,!!t.hasZ);return Ep(i[0],i[1],i[2],t.spatialReference)}function P0(t,e,i){const r=i?t:igt(t);return e&&t?ZTe(t,r,e)?r:null:r}function bHt(t){if(!t)return 0;switch(t.type){case"point":return t.z;case"extent":return t.zmax;case"polygon":return t.hasZ?t.rings.reduce((e,i)=>i.reduce((r,s)=>Math.max(r,s[2]),e),-1/0):void 0;case"polyline":return t.hasZ?t.paths.reduce((e,i)=>i.reduce((r,s)=>Math.max(r,s[2]),e),-1/0):void 0;case"mesh":return t.extent.zmax;case"multipoint":return}}function wHt(t,e,i,r=0){if(t){e||(e=Pi());const s=t;let n=.5*s.width*(i-1),a=.5*s.height*(i-1);return s.width<1e-7*s.height?n+=a/20:s.height<1e-7*s.width&&(a+=n/20),yr(e,s.xmin-n-r,s.ymin-a-r,s.xmax+n+r,s.ymax+a+r),e}return null}function Nq(t,e,i=null){const r=K3(FU);return t!=null&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],t.length>3&&(r[3]=t[3])),e!=null&&(r[3]=e),i&&Cv(r,r,i),r}function xHt(t,e,i,r,s,n){for(let a=0;a<3;++a)n[a]=t?.[a]!=null?t[a]:i?.[a]!=null?i[a]:s[a];return n[3]=e??r??s[3],n}function SHt(t=$ee,e,i,r=1){const s=new Array(3);if(e==null||i==null)s[0]=1,s[1]=1,s[2]=1;else{let n,a=0;for(let o=2;o>=0;o--){const l=t[o],c=l!=null,h=o===0&&!n&&!c,f=i[o];let y;l==="symbol-value"||h?y=f!==0?e[o]/f:1:c&&l!=="proportional"&&isFinite(l)&&(y=f!==0?l/f:1),y!=null&&(s[o]=y,n=y,a=Math.max(a,Math.abs(y)))}for(let o=2;o>=0;o--)s[o]==null?s[o]=n:s[o]===0&&(s[o]=.001*a)}for(let n=2;n>=0;n--)s[n]/=r;return VR(s)}function ayt(t){return t.isPrimitive!=null}function THt(t){return oyt(ayt(t)?[t.width,t.depth,t.height]:t)?null:"Symbol sizes may not be negative values"}function oyt(t){const e=i=>i==null||i>=0;return Array.isArray(t)?t.every(e):e(t)}function $Ht(t,e,i,r=it()){return t&&MC(r,r,-t/180*Math.PI),e&&CC(r,r,e/180*Math.PI),i&&IU(r,r,i/180*Math.PI),r}function lyt(t,e,i){if(i.minDemResolution!=null)return i.minDemResolution;const r=Wr(e),s=h2(t)*r,n=d2(t)*r,a=Zv(t)*(e.isGeographic?1:r);return s===0&&n===0&&a===0?i.minDemResolutionForPoints:.01*Math.max(s,n,a)}let CHt=class{constructor(e,i,r){this.baseMaterial=e,this.edgeMaterial=i,this.hasSlicePlane=r}},qRe=class{get isElevationSource(){return!!this.stageObject.lastValidElevationBB}constructor(e,i,r,s,n,a=null){this.graphics3DSymbolLayer=e,this.stageObject=i,this._sharedResource=r,this.elevationAligner=s,this.elevationContext=n,this._edgeState=a,this.type="object3d",this._stageLayer=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1}initialize(e){this._stageLayer=e}destroy(){if(!this._stageLayer)return;const e=this._stageLayer.stage;this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1),e.renderer.edgeView?.removeObject(this.stageObject),this.stageObject.dispose(),this._sharedResource?.release(),this._visible=!1,this._stageLayer=null}get usedMemory(){return this.graphics3DSymbolLayer.usedMemory}layerOpacityChanged(e,i){const{stageObject:r,_edgeState:s,_stageLayer:n}=this;if(s==null)return;const a=Sge(s.baseMaterial);s.edgeMaterial.objectTransparency!==a&&(s.edgeMaterial.objectTransparency=a,this.resetEdgeObject(i)),n.stage.renderer.withEdgeView(o=>o.updateAllComponentOpacities(r,[e]))}updateHighlights(e){}slicePlaneEnabledChanged(e,i){const{stageObject:r,_edgeState:s,_stageLayer:n}=this;s!=null&&n.stage.renderer.withEdgeView(a=>{a.updateAllComponentMaterials(r,s.edgeMaterial,e,!i),s.hasSlicePlane=e})}setVisibility(e){const{_edgeState:i,stageObject:r,_stageLayer:s}=this;s!=null&&this.visible!==e&&(this._visible=e,r.visible=e,e&&!this._addedToStage&&(s.add(r),this._addedToStage=!0),i!=null&&s.stage.renderer.withEdgeView(n=>{n.hasObject(r)?n.updateObjectVisibility(r,e):e&&this._addOrUpdateEdgeObject(i,n,!1)}))}get visible(){return this._visible}alignWithElevation(e,i,r){if(this.elevationAligner==null)return;const s=(n,a)=>rre(n,e,this.elevationContext,i,a);this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,e.spatialReference,s,i),this.resetEdgeObject(r)}alignWithAbsoluteElevation(e,i,r){const s=(n,a)=>{a.sampledElevation=e,a.verticalDistanceToGround=0,a.z=e};this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,this.graphics3DSymbolLayer.view.spatialReference,s,i),this.resetEdgeObject(r)}getCenterObjectSpace(e=R()){return de(e,Ti(this.stageObject.boundingVolumeObjectSpace.bounds))}getBoundingBoxObjectSpace(e=ul()){const i=this.stageObject.boundingVolumeObjectSpace;return wMe(e,i.min),xMe(e,i.max),e}computeAttachmentOrigin(e){const i=this.stageObject.effectiveTransformation;if(this.useObjectOriginAsAttachmentOrigin)e.render.origin[0]+=i[12],e.render.origin[1]+=i[13],e.render.origin[2]+=i[14],e.render.num++;else for(const r of this.stageObject.geometries)r.computeAttachmentOrigin(Im)&&(Mt(Im,Im,i),xe(e.render.origin,e.render.origin,Im),e.render.num++)}async getProjectedBoundingBox(e,i,r,s,n){const a=this.getBoundingBoxObjectSpace(n),o=cyt,l=SMe(a)?1:o.length;for(let h=0;h<l;h++){const f=o[h];R0[0]=a[f[0]],R0[1]=a[f[1]],R0[2]=a[f[2]],Mt(R0,R0,this.stageObject.transformation),R1[3*h]=R0[0],R1[3*h+1]=R0[1],R1[3*h+2]=R0[2]}if(!e(R1,0,l))return null;Nc(a);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let h=0;h<3*l;h+=3){for(let f=0;f<3;f++)a[f]=Math.min(a[f],R1[h+f]),a[f+3]=Math.max(a[f+3],R1[h+f]);c&&r.push({location:R1.slice(h,h+3),screenSpaceBoundingRect:c})}if(i?.service&&this.elevationContext.mode!=="absolute-height"){zte(a,Im);const h=this.elevationContext.mode==="relative-to-scene"?"scene":"ground";let f=0;if(i.useViewElevation)f=i.service.getElevation(Im[0],Im[1],h)??0;else try{const y=lyt(a,i.service.spatialReference,i);f=await i.service.queryElevation(Im[0],Im[1],s,y,h)??0}catch{}brt(a,0,0,-this.alignedSampledElevation+f)}return a}addObjectState(e){e.stateType===0&&e.addObject(this.stageObject,this.stageObject.highlight(e.highlightName)),e.stateType===1&&e.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(e){e.removeByObject(this.stageObject)}resetEdgeObject(e){const{_edgeState:i,stageObject:r,_stageLayer:s,_visible:n}=this;i!=null&&s.stage.renderer.withEdgeView(a=>{n?this._addOrUpdateEdgeObject(i,a,e):a.removeObject(r)})}_addOrUpdateEdgeObject(e,i,r){const s=Sge(e.baseMaterial);e.edgeMaterial.objectTransparency=s,i.addOrUpdateObject3D(this.stageObject,e.edgeMaterial,e.hasSlicePlane,!r).then(()=>this._stageLayer?.sync())}};function Sge(t){return t.transparent?0:1}const R1=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],R0=R(),Im=R(),cyt=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];let uyt=class{constructor(e,i=null){this.labelText=i,this.elevationOffset=e??0}};const hyt=3,dyt=3,pyt=10;function Lu(t,e=!1){return t<=Hl?e?new Array(t).fill(0):new Array(t):new Float32Array(t)}function OHt(t){return Array.isArray(t)?t.length<Hl?t:new Float32Array(t):t.length<Hl?Array.from(t):t}function Tge(t){return(Array.isArray(t)?t.length:t.byteLength/8)<=Hl?Array.from(t):new Float32Array(t)}function PHt(t,e,i){return Array.isArray(t)?t.slice(e,e+i):t.subarray(e,e+i)}function $ge(t,e){const i=t[e],r=t[e+1],s=t[e+2];return Math.sqrt(i*i+r*r+s*s)}function fyt(t,e){const i=t[e],r=t[e+1],s=t[e+2],n=1/Math.sqrt(i*i+r*r+s*s);t[e]*=n,t[e+1]*=n,t[e+2]*=n}function Cge(t,e,i){t[e]*=i,t[e+1]*=i,t[e+2]*=i}function myt(t,e,i,r,s,n=e){(s=s||t)[n]=t[e]+i[r],s[n+1]=t[e+1]+i[r+1],s[n+2]=t[e+2]+i[r+2]}function gyt(){return Mge??=yyt(),Mge}function yyt(){const i=new Si([0,0,0,255,255,0,255,255],[0,1,2,3],2,!0);return new LRe([["uv0",i]])}let Mge=null;const Vq=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],_yt=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],vyt=[0,0,1,0,1,1,0,1],byt=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],GRe=new Array(36);for(let t=0;t<6;t++)for(let e=0;e<6;e++)GRe[6*t+e]=t;const wb=new Array(36);for(let t=0;t<6;t++)wb[6*t]=0,wb[6*t+1]=1,wb[6*t+2]=2,wb[6*t+3]=2,wb[6*t+4]=3,wb[6*t+5]=0;function wyt(t,e){Array.isArray(e)||(e=[e,e,e]);const i=new Array(24);for(let r=0;r<8;r++)i[3*r]=Vq[r][0]*e[0],i[3*r+1]=Vq[r][1]*e[1],i[3*r+2]=Vq[r][2]*e[2];return new Xl(t,[["position",new Si(i,byt,3,!0)],["normal",new Si(_yt,GRe,3)],["uv0",new Si(vyt,wb,2)]])}const Uq=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],xyt=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],Syt=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],Tyt=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];function $yt(t,e){Array.isArray(e)||(e=[e,e,e]);const i=new Array(18);for(let r=0;r<6;r++)i[3*r]=Uq[r][0]*e[0],i[3*r+1]=Uq[r][1]*e[1],i[3*r+2]=Uq[r][2]*e[2];return new Xl(t,[["position",new Si(i,Syt,3,!0)],["normal",new Si(xyt,Tyt,3)]])}const gF=Ji(-.5,0,-.5),yF=Ji(.5,0,-.5),_F=Ji(0,0,.5),vF=Ji(0,.5,0),OS=Ac(),PS=Ac(),f$=Ac(),m$=Ac(),g$=Ac();Ce(OS,gF,vF),Ce(PS,gF,yF),bt(f$,OS,PS),Ee(f$,f$),Ce(OS,yF,vF),Ce(PS,yF,_F),bt(m$,OS,PS),Ee(m$,m$),Ce(OS,_F,vF),Ce(PS,_F,gF),bt(g$,OS,PS),Ee(g$,g$);const Bq=[gF,yF,_F,vF],Cyt=[0,-1,0,f$[0],f$[1],f$[2],m$[0],m$[1],m$[2],g$[0],g$[1],g$[2]],Myt=[0,1,2,3,1,0,3,2,1,3,0,2],Eyt=[0,0,0,1,1,1,2,2,2,3,3,3];function Ayt(t,e){Array.isArray(e)||(e=[e,e,e]);const i=new Array(12);for(let r=0;r<4;r++)i[3*r]=Bq[r][0]*e[0],i[3*r+1]=Bq[r][1]*e[1],i[3*r+2]=Bq[r][2]*e[2];return new Xl(t,[["position",new Si(i,Myt,3,!0)],["normal",new Si(Cyt,Eyt,3)]])}function RHt(t,e,i,r,s={uv:!0}){const n=-Math.PI,a=2*Math.PI,o=-Math.PI/2,l=Math.PI,c=Math.max(3,Math.floor(i)),h=Math.max(2,Math.floor(r)),f=(c+1)*(h+1),y=Lu(3*f),_=Lu(3*f),w=Lu(2*f),x=[];let S=0;for(let M=0;M<=h;M++){const P=[],O=M/h,D=o+O*l,L=Math.cos(D);for(let F=0;F<=c;F++){const U=F/c,N=n+U*a,j=Math.cos(N)*L,B=Math.sin(D),Y=-Math.sin(N)*L;y[3*S]=j*e,y[3*S+1]=B*e,y[3*S+2]=Y*e,_[3*S]=j,_[3*S+1]=B,_[3*S+2]=Y,w[2*S]=U,w[2*S+1]=O,P.push(S),++S}x.push(P)}const $=new Array;for(let M=0;M<h;M++)for(let P=0;P<c;P++){const O=x[M][P],D=x[M][P+1],L=x[M+1][P+1],F=x[M+1][P];M===0?($.push(O),$.push(L),$.push(F)):M===h-1?($.push(O),$.push(D),$.push(L)):($.push(O),$.push(D),$.push(L),$.push(L),$.push(F),$.push(O))}const A=[["position",new Si(y,$,3,!0)],["normal",new Si(_,$,3,!0)]];return s.uv&&A.push(["uv0",new Si(w,$,2,!0)]),s.offset&&(A[0][0]="offset",A.push(["position",new Si(Float64Array.from(s.offset),mie($.length),3,!0)])),new Xl(t,A)}function Oyt(t,e,i,r){const s=HRe(e,i,r);return new Xl(t,s)}function HRe(t,e,i){const r=t;let s,n;if(i)s=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],n=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1];else{const c=r*(1+Math.sqrt(5))/2;s=[-r,c,0,r,c,0,-r,-c,0,r,-c,0,0,-r,c,0,r,c,0,-r,-c,0,r,-c,c,0,-r,c,0,r,-c,0,-r,-c,0,r],n=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}for(let c=0;c<s.length;c+=3)Cge(s,c,t/$ge(s,c));let a={};function o(c,h){c>h&&([c,h]=[h,c]);const f=c.toString()+"."+h.toString();if(a[f])return a[f];let y=s.length;return s.length+=3,myt(s,3*c,s,3*h,s,y),Cge(s,y,t/$ge(s,y)),y/=3,a[f]=y,y}for(let c=0;c<e;c++){const h=n.length,f=new Array(4*h);for(let y=0;y<h;y+=3){const _=n[y],w=n[y+1],x=n[y+2],S=o(_,w),$=o(w,x),A=o(x,_),M=4*y;f[M]=_,f[M+1]=S,f[M+2]=A,f[M+3]=w,f[M+4]=$,f[M+5]=S,f[M+6]=x,f[M+7]=A,f[M+8]=$,f[M+9]=S,f[M+10]=$,f[M+11]=A}n=f,a={}}const l=Tge(s);for(let c=0;c<l.length;c+=3)fyt(l,c);return[["position",new Si(Tge(s),n,3,!0)],["normal",new Si(l,n,3,!0)]]}function DHt(t,{normal:e,position:i,color:r,rotation:s,size:n,centerOffsetAndDistance:a,uvi:o,featureAttribute:l,olidColor:c=null}={}){const h=i?cr(i):R(),f=e?cr(e):Ge(0,0,1),y=r?[r[0],r[1],r[2],r.length>3?r[3]:255]:[255,255,255,255],_=n!=null&&n.length===2?n:[1,1],w=s!=null?[s]:[0],x=mie(1),S=[["position",new Si(h,x,3,!0)],["normal",new Si(f,x,3,!0)],["color",new Si(y,x,4,!0)],["size",new Si(_,x,2)],["rotation",new Si(w,x,1,!0)]];if(o&&S.push(["uvi",new Si(o,x,o.length)]),a!=null){const $=[a[0],a[1],a[2],a[3]];S.push(["centerOffsetAndDistance",new Si($,x,4)])}if(l){const $=[l[0],l[1],l[2],l[3]];S.push(["featureAttribute",new Si($,x,4)])}return new Xl(t,S,null,1,c,void 0,gyt())}const Pyt=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function IHt(t,e=Pyt){const i=new Array(12);for(let c=0;c<4;c++)for(let h=0;h<3;h++)i[3*c+h]=e[c][h];const r=[0,1,2,2,3,0],s=[0,0,1],n=[0,0,0,0,0,0],a=[0,0,1,0,1,1,0,1],o=[255,255,255,255],l=[["position",new Si(i,r,3,!0)],["normal",new Si(s,n,3,!0)],["uv0",new Si(a,r,2,!0)],["color",new Si(o,n,4,!0)]];return new Xl(t,l)}function Ryt(t,e,i,r,s=!0,n=!0){let a=0;const o=e,l=t;let c=Ji(0,a,0),h=Ji(0,a+l,0),f=Ji(0,-1,0),y=Ji(0,1,0);r&&(a=l,h=Ji(0,0,0),c=Ji(0,a,0),f=Ji(0,1,0),y=Ji(0,-1,0));const _=[h,c],w=[f,y],x=i+2,S=Math.sqrt(l*l+o*o);if(r)for(let O=i-1;O>=0;O--){const D=O*(2*Math.PI/i),L=Ji(Math.cos(D)*o,a,Math.sin(D)*o);_.push(L);const F=Ji(l*Math.cos(D)/S,-o/S,l*Math.sin(D)/S);w.push(F)}else for(let O=0;O<i;O++){const D=O*(2*Math.PI/i),L=Ji(Math.cos(D)*o,a,Math.sin(D)*o);_.push(L);const F=Ji(l*Math.cos(D)/S,o/S,l*Math.sin(D)/S);w.push(F)}const $=new Array,A=new Array;if(s){for(let O=3;O<_.length;O++)$.push(1),$.push(O-1),$.push(O),A.push(0),A.push(0),A.push(0);$.push(_.length-1),$.push(2),$.push(1),A.push(0),A.push(0),A.push(0)}if(n){for(let O=3;O<_.length;O++)$.push(O),$.push(O-1),$.push(0),A.push(O),A.push(O-1),A.push(1);$.push(0),$.push(2),$.push(_.length-1),A.push(1),A.push(2),A.push(w.length-1)}const M=Lu(3*x);for(let O=0;O<x;O++)M[3*O]=_[O][0],M[3*O+1]=_[O][1],M[3*O+2]=_[O][2];const P=Lu(3*x);for(let O=0;O<x;O++)P[3*O]=w[O][0],P[3*O+1]=w[O][1],P[3*O+2]=w[O][2];return[["position",new Si(M,$,3,!0)],["normal",new Si(P,A,3,!0)]]}function Ege(t,e,i,r,s,n=!0,a=!0){return new Xl(t,Ryt(e,i,r,s,n,a))}function Dyt(t,e,i,r,s,n,a){const o=s?TQ(s):Ji(1,0,0),l=n?TQ(n):Ji(0,0,0);a??=!0;const c=Ac();Ee(c,o);const h=Ac();le(h,c,Math.abs(e));const f=Ac();le(f,h,-.5),xe(f,f,l);const y=Ji(0,1,0);Math.abs(1-Oe(c,y))<.2&&ve(y,0,0,1);const _=Ac();bt(_,c,y),Ee(_,_),bt(y,_,c);const w=2*r+(a?2:0),x=r+(a?2:0),S=Lu(3*w),$=Lu(3*x),A=Lu(2*w),M=new Array(3*r*(a?4:2)),P=new Array(3*r*(a?4:2));a&&(S[3*(w-2)]=f[0],S[3*(w-2)+1]=f[1],S[3*(w-2)+2]=f[2],A[2*(w-2)]=0,A[2*(w-2)+1]=0,S[3*(w-1)]=S[3*(w-2)]+h[0],S[3*(w-1)+1]=S[3*(w-2)+1]+h[1],S[3*(w-1)+2]=S[3*(w-2)+2]+h[2],A[2*(w-1)]=1,A[2*(w-1)+1]=1,$[3*(x-2)]=-c[0],$[3*(x-2)+1]=-c[1],$[3*(x-2)+2]=-c[2],$[3*(x-1)]=c[0],$[3*(x-1)+1]=c[1],$[3*(x-1)+2]=c[2]);const O=(N,j,B)=>{M[N]=j,P[N]=B};let D=0;const L=Ac(),F=Ac();for(let N=0;N<r;N++){const j=N*(2*Math.PI/r);le(L,y,Math.sin(j)),le(F,_,Math.cos(j)),xe(L,L,F),$[3*N]=L[0],$[3*N+1]=L[1],$[3*N+2]=L[2],le(L,L,i),xe(L,L,f),S[3*N]=L[0],S[3*N+1]=L[1],S[3*N+2]=L[2],A[2*N]=N/r,A[2*N+1]=0,S[3*(N+r)]=S[3*N]+h[0],S[3*(N+r)+1]=S[3*N+1]+h[1],S[3*(N+r)+2]=S[3*N+2]+h[2],A[2*(N+r)]=N/r,A[2*N+1]=1;const B=(N+1)%r;O(D++,N,N),O(D++,N+r,N),O(D++,B,B),O(D++,B,B),O(D++,N+r,N),O(D++,B+r,B)}if(a){for(let N=0;N<r;N++){const j=(N+1)%r;O(D++,w-2,x-2),O(D++,N,x-2),O(D++,j,x-2)}for(let N=0;N<r;N++){const j=(N+1)%r;O(D++,N+r,x-1),O(D++,w-1,x-1),O(D++,j+r,x-1)}}const U=[["position",new Si(S,M,3,!0)],["normal",new Si($,P,3,!0)],["uv0",new Si(A,M,2,!0)]];return new Xl(t,U)}function LHt(t,e,i,r,s,n){r=r||10,s=s==null||s,dt(e.length>1);const a=[[0,0,0]],o=[],l=[];for(let c=0;c<r;c++){o.push([0,-c-1,-(c+1)%r-1]);const h=c/r*2*Math.PI;l.push([Math.cos(h)*i,Math.sin(h)*i])}return Iyt(t,l,e,a,o,s,n)}function Iyt(t,e,i,r,s,n,a=Ji(0,0,0)){const o=e.length,l=Lu(i.length*o*3+(6*r.length||0)),c=Lu(i.length*o*3+(r?6:0)),h=new Array,f=new Array;let y=0,_=0;const w=R(),x=R(),S=R(),$=R(),A=R(),M=R(),P=R(),O=R(),D=R(),L=R(),F=R(),U=R(),N=R(),j=Oi();ve(D,0,1,0),Ce(x,i[1],i[0]),Ee(x,x),n?(xe(O,i[0],a),Ee(S,O)):ve(S,0,0,1),Age(x,S,D,D,A,S,Oge),de($,S),de(U,A);for(let X=0;X<r.length;X++)le(M,A,r[X][0]),le(O,S,r[X][2]),xe(M,M,O),xe(M,M,i[0]),l[y++]=M[0],l[y++]=M[1],l[y++]=M[2];c[_++]=-x[0],c[_++]=-x[1],c[_++]=-x[2];for(let X=0;X<s.length;X++)h.push(s[X][0]>0?s[X][0]:-s[X][0]-1+r.length),h.push(s[X][1]>0?s[X][1]:-s[X][1]-1+r.length),h.push(s[X][2]>0?s[X][2]:-s[X][2]-1+r.length),f.push(0),f.push(0),f.push(0);let B=r.length;const Y=r.length-1;for(let X=0;X<i.length;X++){let ye=!1;X>0&&(de(w,x),X<i.length-1?(Ce(x,i[X+1],i[X]),Ee(x,x)):ye=!0,xe(L,w,x),Ee(L,L),xe(F,i[X-1],$),Qf(i[X],L,j),mM(j,Sp(F,w),O)?(Ce(O,O,i[X]),Ee(S,O),bt(A,L,S),Ee(A,A)):Age(L,$,U,D,A,S,Oge),de($,S),de(U,A)),n&&(xe(O,i[X],a),Ee(N,O));for(let De=0;De<o;De++)if(le(M,A,e[De][0]),le(O,S,e[De][1]),xe(M,M,O),Ee(P,M),c[_++]=P[0],c[_++]=P[1],c[_++]=P[2],xe(M,M,i[X]),l[y++]=M[0],l[y++]=M[1],l[y++]=M[2],!ye){const q=(De+1)%o;h.push(B+De),h.push(B+o+De),h.push(B+q),h.push(B+q),h.push(B+o+De),h.push(B+o+q);for(let ne=0;ne<6;ne++){const ce=h.length-6;f.push(h[ce+ne]-Y)}}B+=o}const G=i[i.length-1];for(let X=0;X<r.length;X++)le(M,A,r[X][0]),le(O,S,r[X][1]),xe(M,M,O),xe(M,M,G),l[y++]=M[0],l[y++]=M[1],l[y++]=M[2];const Z=_/3;c[_++]=x[0],c[_++]=x[1],c[_++]=x[2];const H=B-o;for(let X=0;X<s.length;X++)h.push(s[X][0]>=0?B+s[X][0]:-s[X][0]-1+H),h.push(s[X][2]>=0?B+s[X][2]:-s[X][2]-1+H),h.push(s[X][1]>=0?B+s[X][1]:-s[X][1]-1+H),f.push(Z),f.push(Z),f.push(Z);const Q=[["position",new Si(l,h,3,!0)],["normal",new Si(c,f,3,!0)]];return new Xl(t,Q)}function kHt(t,e,i,r,s){const n=iD(3*e.length),a=new Array(2*(e.length-1));let o=0,l=0;for(let h=0;h<e.length;h++){for(let f=0;f<3;f++)n[o++]=e[h][f];h>0&&(a[l++]=h-1,a[l++]=h)}const c=[["position",new Si(n,a,3,!0)]];if(i&&i.length===e.length&&i[0].length===3){const h=Lu(3*i.length);let f=0;for(let y=0;y<e.length;y++)for(let _=0;_<3;_++)h[f++]=i[y][_];c.push(["normal",new Si(h,a,3,!0)])}return r&&c.push(["color",new Si(r,xM(r.length/4),4)]),new Xl(t,c,null,2)}function zHt(t,e,i,r,s,n=0){const a=new Array(18),o=[[-i,n,s/2],[r,n,s/2],[0,e+n,s/2],[-i,n,-s/2],[r,n,-s/2],[0,e+n,-s/2]],l=[0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5];for(let c=0;c<6;c++)a[3*c]=o[c][0],a[3*c+1]=o[c][1],a[3*c+2]=o[c][2];return new Xl(t,[["position",new Si(a,l,3,!0)]])}function FHt(t,e){const i=t.getMutableAttribute("position").data;for(let r=0;r<i.length;r+=3){const s=i[r],n=i[r+1],a=i[r+2];ve(RS,s,n,a),Mt(RS,RS,e),i[r]=RS[0],i[r+1]=RS[1],i[r+2]=RS[2]}}function Lyt(t,e=t){const i=t.attributes,r=i.get("position").data,s=i.get("normal").data;if(s){const n=e.getMutableAttribute("normal").data;for(let a=0;a<s.length;a+=3){const o=s[a+1];n[a+1]=-s[a+2],n[a+2]=o}}if(r){const n=e.getMutableAttribute("position").data;for(let a=0;a<r.length;a+=3){const o=r[a+1];n[a+1]=-r[a+2],n[a+2]=o}}}function jq(t,e,i,r,s){return!(Math.abs(Oe(e,t))>s)&&(bt(i,t,e),Ee(i,i),bt(r,i,t),Ee(r,r),!0)}function Age(t,e,i,r,s,n,a){return jq(t,e,s,n,a)||jq(t,i,s,n,a)||jq(t,r,s,n,a)}const Oge=.99619469809,RS=R();let nre=class{constructor(e){this.layerViewUid=e}},$4=class extends nre{constructor(e,i){super(e),this.graphicUid=i}},kyt=class extends $4{constructor(e,i,r,s,n){super(e,i),this.layerViewUid=e,this.graphicUid=i,this.triangleNr=r,this.baseBoundingSphere=s,this.numLodLevels=n}};function are(t){return Vu(t)&&t.intersector===3&&!!t.target}let zyt=class{constructor(e,i,r,s){this.material=e,this.buffer=i,this.numVertices=r,this.boundingInfo=s,this.bufferWriter=e.createBufferWriter()}get layout(){return this.bufferWriter.layout}get numTriangles(){return this.numVertices/3}computeUsedMemory(){return this.buffer.byteLength+fte}get renderGeometry(){return this}intersect(e,i,r,s,n,a,o,l){const c=this.bufferWriter,h=this.buffer;c.intersect(h,this.material.parameters,null,e,r,s,(f,y,_)=>WRe(f,y,_,e,i,a,o,n,l))}},Fyt=class{constructor(e){this.engineGeometry=e;const i=this.material,r=this.engineGeometry,s=r.attributes,n=r.boundingInfo,a=i.createBufferWriter(),o=a.layout,l=a.elementCount(s),c=o.createBuffer(l);a.write(null,null,s,null,c,0),this.renderGeometry=new zyt(i,c.buffer,l,n)}get material(){return this.engineGeometry.material}get numVertices(){return this.engineGeometry.indexCount}get numTriangles(){return this.numVertices/3}get boundingInfo(){return this.engineGeometry.boundingInfo}computeUsedMemory(){return Array.from(this.engineGeometry.attributes.values()).reduce((e,i)=>e+Wx(i.data,i.indices),0)}intersect(e,i,r,s,n,a,o,l){const c=this.engineGeometry;this.material.intersect(c,e.transform.transform,e,r,s,(h,f,y)=>WRe(h,f,y,e,i,a,o,n,l))}};function WRe(t,e,i,r,s,n,a,o,l){if(t<0||s&&!s(r.rayBegin,r.rayEnd,t))return;const c=new kyt(n.layerViewUid,n.graphicUid(o),i,a,l);if((r.results.min.distance==null||t<r.results.min.distance)&&r.results.min.set(3,c,t,e,r.transform.transform),(r.results.max.distance==null||t>r.results.max.distance)&&r.results.max.set(3,c,t,e,r.transform.transform),r.options.store===2){const h=new G_(r.results.min.ray);h.set(3,c,t,e,r.transform.transform),r.results.all.push(h)}}let Nyt=class{constructor(e,i=null){this.geometry=e,this.textures=i}get material(){return this.geometry.material}get numTriangles(){return this.geometry.numTriangles}},Vyt=class{constructor(e,i,r){this.components=e,this.minScreenSpaceRadius=i,this.pivotOffset=r;const s=q3(this.components.map(n=>n.geometry));this.numVertices=s.reduce((n,a)=>n+a.numVertices,0)}},Uyt=class{constructor(e){this.levels=e,this.levels.sort((i,r)=>i.minScreenSpaceRadius===r.minScreenSpaceRadius?i.numVertices-r.numVertices:i.minScreenSpaceRadius-r.minScreenSpaceRadius)}get materialParameters(){return this.levels[0].components[0].geometry.material.parameters}getMaterials(){const e=[];return this.levels.forEach(i=>i.components.forEach(r=>e.push(r.geometry.material))),q3(e)}getTextures(){const e=new Array;return this.levels.forEach(i=>i.components.forEach(r=>{r.textures!=null&&e.push(...r.textures)})),q3(e)}getGeometries(){const e=new Array;return this.levels.forEach(i=>i.components.forEach(r=>{e.push(r.geometry)})),q3(e)}getEngineGeometries(){return this.getGeometries().map(e=>e.engineGeometry).filter(e=>e!=null)}computeUsedMemory(){const e=this.getGeometries(),i=this.getTextures(),r=e.reduce((s,n)=>s+n.computeUsedMemory(),0);return i.reduce((s,n)=>s+n.usedMemory,0)+r}};function WHt(t){switch(t){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function Byt(t,e){const i=(r,s,n=!1)=>new Uyt(r.map(a=>{const o=s(a.tesselation);return n&&Lyt(o),new Vyt([new Nyt(new Fyt(o))],a.minScreenSpaceRadius)}));switch(t){case"sphere":return i([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],r=>Oyt(e,.5,r,!0));case"cube":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>wyt(e,1));case"cone":return i(qq,r=>Ege(e,1,.5,r,!1),!0);case"inverted-cone":return i(qq,r=>Ege(e,1,.5,r,!0),!0);case"cylinder":return i(qq,r=>Dyt(e,1,.5,r,[0,0,1],[0,0,.5]));case"tetrahedron":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>Ayt(e,1),!0);case"diamond":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>$yt(e,1),!0);default:return}}const qq=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];let Oh=class{constructor(e){this.estimated=!1,this.verticesPerFeature=e.verticesPerFeature??0,this.verticesPerCoordinate=e.verticesPerCoordinate??0,this.drawCallsPerFeature=e.drawCallsPerFeature??0,this.memory=e.memory??new ZRe}},ore=class extends Oh{constructor(e){super(e),this.estimated=!0}},jyt=class extends Oh{constructor(e,i){super(i),this.numComplexities=e}},qyt=class extends ore{constructor(e,i){super(i),this.numComplexities=e}},ZRe=class{constructor(){this.bytesPerFeature=0,this.bytesPerFeatureLabel=0,this.resourceBytes=0,this.draped={bytesPerFeature:0,bytesPerFeatureLabel:0}}};function Gyt(t){return t.type==="fill"}function Hyt(t){return t.type==="extrude"}function Wyt(t){return t&&t.enabled&&(Hyt(t)||Gyt(t))&&t.edges!=null}function Zyt(t){return t&&t.enabled&&t.edges||null}function KHt(t,e){return Yyt(Zyt(t),e)}function Yyt(t,e){if(t==null)return null;const i=t.color!=null?qR(mt.toUnitRGBA(t.color)):fi(0,0,0,0),r=Bx(t.size),s=Bx(t.extensionLength);switch(t.type){case"solid":return Qyt({color:i,size:r,extensionLength:s,...e});case"sketch":return Xyt({color:i,size:r,extensionLength:s,...e});default:return}}function Qyt(t){return{...Jyt,...t,type:0}}function Xyt(t){return{...Kyt,...t,type:1}}const Jyt={color:fi(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:1,hasSlicePlane:!1},Kyt={color:fi(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:1,hasSlicePlane:!1};let M8=class{constructor(e=0,i=!1,r=!0){this.tolerance=e,this.isVerticalRay=i,this.normalRequired=r}};const RL=ul();function e0t(t,e,i,r,s,n){if(!t.visible)return;const a=ui(KRe,r,i),o=(h,f,y)=>n(h,y,f),{tolerance:l}=e,c=new M8(l,!1,e.options.normalRequired);if(t.boundingInfo)dt(t.type===0),YRe(t.boundingInfo,i,a,l,s,c,o);else{const h=t.positionAttribute,f=h.indices;XRe(i,a,0,f.length/3,f,h.data,h.stride,s,c,o)}}const t0t=R();function YRe(t,e,i,r,s,n,a){if(t==null)return;const o=d0t(i,t0t);if(wMe(RL,t.bbMin),xMe(RL,t.bbMax),s?.applyToAabb(RL),JRe(RL,e,o,r)){const{primitiveIndices:l,position:c}=t,h=l?l.length:c.indices.length/3;if(h>p0t){const f=t.getChildren();if(f!==void 0){for(const y of f)YRe(y,e,i,r,s,n,a);return}}a0t(e,i,0,h,c.indices,c.data,c.stride,l,s,n,a)}}const L_=R();function i0t(t,e,i,r,s,n,a,o,l){const{data:c,stride:h}=n;XRe(t,ui(KRe,e,t),i,r,s,c,h,a,o,l)}function tWt(t,e,i,r){if(!i.visible)return;const s=(l,c,h)=>r(l,h,c),{boundingInfo:n}=i;if(n){const{bbMin:l,bbMax:c}=n;if(t<l[0]||t>c[0]||e<l[1]||e>c[1])return}const a=i.positionAttribute,o=a.indices;r0t(t,e,0,o.length/3,o,a,s)}function r0t(t,e,i,r,s,n,a){const{data:o,stride:l}=n;for(let c=i;c<r;++c){const h=3*c,f=l*s[h],y=l*s[h+1],_=l*s[h+2],w=o[f+0]-t,x=o[f+1]-e,S=o[y+0]-t,$=o[y+1]-e,A=o[_+0]-t,M=o[_+1]-e,P=A*$-M*S,O=w*M-x*A,D=S*x-$*w;(P<0||O<0||D<0)&&(P>0||O>0||D>0)||a(0,c,null)}}function QRe(t,e,i,r,s,n,a,o,l,c=null,h=0){const f=t[0],y=t[1],_=t[2],w=e[0],x=e[1],S=e[2];for(let $=i;$<r;++$){const A=h+(c?c[$]:$),M=3*A,P=a*s[M],O=n[P],D=n[P+1],L=n[P+2],F=a*s[M+1],U=n[F],N=n[F+1],j=n[F+2],B=a*s[M+2],Y=U-O,G=N-D,Z=j-L,H=n[B]-O,Q=n[B+1]-D,X=n[B+2]-L,ye=x*X-Q*S,De=S*H-X*w,q=w*Q-H*x,ne=Y*ye+G*De+Z*q;if(Math.abs(ne)<=A8)continue;const ce=f-O,be=y-D,ze=_-L,Ne=ce*ye+be*De+ze*q;if(ne>0){if(Ne<0||Ne>ne)continue}else if(Ne>0||Ne<ne)continue;const at=be*Z-G*ze,Tt=ze*Y-Z*ce,et=ce*G-Y*be,It=w*at+x*Tt+S*et;if(ne>0){if(It<0||Ne+It>ne)continue}else if(It>0||Ne+It<ne)continue;const $t=(H*at+Q*Tt+X*et)/ne;$t>=0&&l($t,A,o?E8(Y,G,Z,H,Q,X,L_):null)}}function s0t(t,e,i,r,s,n,a,o){const l=t[0],c=t[1],h=t[2],f=e[0],y=e[1],_=e[2];for(let w=i;w<r;++w){const x=3*w,S=x+1,$=x+2,A=n*x,M=s[A],P=s[A+1],O=s[A+2],D=n*S,L=n*$,F=s[D]-M,U=s[D+1]-P,N=s[D+2]-O,j=s[L]-M,B=s[L+1]-P,Y=s[L+2]-O,G=y*Y-B*_,Z=_*j-Y*f,H=f*B-j*y,Q=F*G+U*Z+N*H;if(Math.abs(Q)<=A8)continue;const X=l-M,ye=c-P,De=h-O,q=X*G+ye*Z+De*H;if(Q>0){if(q<0||q>Q)continue}else if(q>0||q<Q)continue;const ne=ye*N-U*De,ce=De*F-N*X,be=X*U-F*ye,ze=f*ne+y*ce+_*be;if(Q>0){if(ze<0||q+ze>Q)continue}else if(ze>0||q+ze<Q)continue;const Ne=(j*ne+B*ce+Y*be)/Q;Ne>=0&&o(Ne,w,a?E8(F,U,N,j,B,Y,L_):null)}}function n0t(t,e,i,r,s,n,a,o,l,c,h,f=null,y=0){const _=t[0],w=t[1],x=t[2],S=e[0],$=e[1],A=e[2];for(let M=i;M<r;++M){const P=y+(f?f[M]:M),O=3*P,D=a*s[O],L=n[D],F=n[D+1],U=n[D+2],N=a*s[O+1],j=n[N],B=n[N+1],Y=n[N+2],G=a*s[O+2],Z=n[G],H=n[G+1],Q=n[G+2],X=U-l,ye=o/Math.sqrt(L*L+F*F+X*X),De=L+L*ye,q=F+F*ye,ne=U+X*ye,ce=Y-l,be=o/Math.sqrt(j*j+B*B+ce*ce),ze=j+j*be,Ne=B+B*be,at=Y+ce*be,Tt=Q-l,et=o/Math.sqrt(Z*Z+H*H+Tt*Tt),It=ze-De,$t=Ne-q,Ct=at-ne,jt=Z+Z*et-De,Ue=H+H*et-q,Ft=Q+Tt*et-ne,qe=$*Ft-Ue*A,je=A*jt-Ft*S,gt=S*Ue-jt*$,ct=It*qe+$t*je+Ct*gt;if(Math.abs(ct)<=A8)continue;const Ot=_-De,Xe=w-q,We=x-ne,Ye=Ot*qe+Xe*je+We*gt;if(ct>0){if(Ye<0||Ye>ct)continue}else if(Ye>0||Ye<ct)continue;const rt=Xe*Ct-$t*We,Zt=We*It-Ct*Ot,Li=Ot*$t-It*Xe,Ci=S*rt+$*Zt+A*Li;if(ct>0){if(Ci<0||Ye+Ci>ct)continue}else if(Ci>0||Ye+Ci<ct)continue;const ei=(jt*rt+Ue*Zt+Ft*Li)/ct;ei>=0&&h(ei,P,c?E8(It,$t,Ct,jt,Ue,Ft,L_):null)}}function a0t(t,e,i,r,s,n,a,o,l,c,h){const f=t[0],y=t[1],_=t[2],w=e[0],x=e[1],S=e[2],{normalRequired:$}=c;for(let A=i;A<r;++A){const M=o[A],P=3*M,O=a*s[P];let D=n[O],L=n[O+1],F=n[O+2];const U=a*s[P+1];let N=n[U],j=n[U+1],B=n[U+2];const Y=a*s[P+2];let G=n[Y],Z=n[Y+1],H=n[Y+2];l!=null&&([D,L,F]=l.applyToVertex(D,L,F,A),[N,j,B]=l.applyToVertex(N,j,B,A),[G,Z,H]=l.applyToVertex(G,Z,H,A));const Q=N-D,X=j-L,ye=B-F,De=G-D,q=Z-L,ne=H-F,ce=x*ne-q*S,be=S*De-ne*w,ze=w*q-De*x,Ne=Q*ce+X*be+ye*ze;if(Math.abs(Ne)<=A8)continue;const at=f-D,Tt=y-L,et=_-F,It=at*ce+Tt*be+et*ze;if(Ne>0){if(It<0||It>Ne)continue}else if(It>0||It<Ne)continue;const $t=Tt*ye-X*et,Ct=et*Q-ye*at,jt=at*X-Q*Tt,Ue=w*$t+x*Ct+S*jt;if(Ne>0){if(Ue<0||It+Ue>Ne)continue}else if(Ue>0||It+Ue<Ne)continue;const Ft=(De*$t+q*Ct+ne*jt)/Ne;Ft>=0&&h(Ft,M,$?E8(Q,X,ye,De,q,ne,L_):null)}}function XRe(t,e,i,r,s,n,a,o,l,c){const h=e,f=f0t,y=Math.abs(h[0]),_=Math.abs(h[1]),w=Math.abs(h[2]),x=y>=_?y>=w?0:2:_>=w?1:2,S=x,$=h[S]<0?2:1,A=(x+$)%3,M=(x+(3-$))%3,P=h[A]/h[S],O=h[M]/h[S],D=1/h[S],L=o0t,F=l0t,U=c0t,{normalRequired:N}=l;for(let j=i;j<r;++j){const B=3*j,Y=a*s[B];ve(f[0],n[Y+0],n[Y+1],n[Y+2]);const G=a*s[B+1];ve(f[1],n[G+0],n[G+1],n[G+2]);const Z=a*s[B+2];ve(f[2],n[Z+0],n[Z+1],n[Z+2]),o&&(de(f[0],o.applyToVertex(f[0][0],f[0][1],f[0][2],j)),de(f[1],o.applyToVertex(f[1][0],f[1][1],f[1][2],j)),de(f[2],o.applyToVertex(f[2][0],f[2][1],f[2][2],j))),ui(L,f[0],t),ui(F,f[1],t),ui(U,f[2],t);const H=L[A]-P*L[S],Q=L[M]-O*L[S],X=F[A]-P*F[S],ye=F[M]-O*F[S],De=U[A]-P*U[S],q=U[M]-O*U[S],ne=De*ye-q*X,ce=H*q-Q*De,be=X*Q-ye*H;if((ne<0||ce<0||be<0)&&(ne>0||ce>0||be>0))continue;const ze=ne+ce+be;if(ze===0)continue;const Ne=ne*(D*L[S])+ce*(D*F[S])+be*(D*U[S]);if(Ne*Math.sign(ze)<0)continue;const at=Ne/ze;at>=0&&c(at,j,N?u0t(f):null)}}const o0t=R(),l0t=R(),c0t=R();function E8(t,e,i,r,s,n,a){return ve(aV,t,e,i),ve(oV,r,s,n),bt(a,aV,oV),Ee(a,a),a}function u0t(t){return ui(aV,t[1],t[0]),ui(oV,t[2],t[0]),bt(L_,aV,oV),Ee(L_,L_),L_}const aV=R(),oV=R();function h0t(t,e,i){return ve(i,1/(e[0]-t[0]),1/(e[1]-t[1]),1/(e[2]-t[2]))}function d0t(t,e){return ve(e,1/t[0],1/t[1],1/t[2])}function JRe(t,e,i,r){return lre(t,e,i,r,1/0)}function lre(t,e,i,r,s){const n=(t[0]-r-e[0])*i[0],a=(t[3]+r-e[0])*i[0];let o=Math.min(n,a),l=Math.max(n,a);const c=(t[1]-r-e[1])*i[1],h=(t[4]+r-e[1])*i[1];if(l=Math.min(l,Math.max(c,h)),l<0||(o=Math.max(o,Math.min(c,h)),o>l))return!1;const f=(t[2]-r-e[2])*i[2],y=(t[5]+r-e[2])*i[2];return l=Math.min(l,Math.max(f,y)),!(l<0)&&(o=Math.max(o,Math.min(f,y)),!(o>l)&&o<s)}const p0t=1e3,A8=1e-7,KRe=R(),f0t=[R(),R(),R()];let m0t=class{constructor(e){this.layout=e}elementCount(e){return e.get("position").indices.length}write(e,i,r,s,n,a){return amt(r,s,this.layout,e,i,n,a)}intersect(e,i,r,s,n,a,o){const l=this.layout.createView(e).getField("position",Z_);if(l==null)return;const c=ui(g0t,a,n),h=0,f=l.count/3,y=s.options.normalRequired,_=(w,x,S)=>o(w,S,x);s0t(n,c,h,f,l.typedBuffer,l.typedBufferStride,y,_)}};const g0t=R();function C4(t,e){switch(t.fragment.code.add(E`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`),e.normalType){case 1:t.attributes.add("normalCompressed","vec2"),t.vertex.code.add(E`vec3 decompressNormal(vec2 normal) {
float z = 1.0 - abs(normal.x) - abs(normal.y);
return vec3(normal + sign(normal) * min(z, 0.0), z);
}
vec3 normalModel() {
return decompressNormal(normalCompressed);
}`);break;case 0:t.attributes.add("normal","vec3"),t.vertex.code.add(E`vec3 normalModel() {
return normal;
}`);break;default:e.normalType;case 2:case 3:}}function eDe({code:t,uniforms:e},i){e.add(new ws("dpDummy",()=>1)),t.add(E`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 hiD = hiA + hiB;
vec3 loD = loA + loB;
return  dpDummy * hiD + loD;
}`)}let tDe=class extends Ni{constructor(e,i,r){super(e,"mat3",2,(s,n,a)=>s.setUniformMatrix3fv(e,i(n,a),r))}},cre=class extends Ni{constructor(e,i,r){super(e,"mat4",1,(s,n,a)=>s.setUniformMatrix4fv(e,i(n,a),r))}};function lR(t,e){const{attributes:i,vertex:r,varyings:s,fragment:n}=t;r.include(eDe,e),i.add("position","vec3"),s.add("vPositionWorldCameraRelative","vec3"),s.add("vPosition_view","vec3",{invariant:!0}),r.uniforms.add(new _r("transformWorldFromViewTH",a=>a.transformWorldFromViewTH),new _r("transformWorldFromViewTL",a=>a.transformWorldFromViewTL),new Ap("transformViewFromCameraRelativeRS",a=>a.transformViewFromCameraRelativeRS),new cre("transformProjFromView",a=>a.transformProjFromView),new tDe("transformWorldFromModelRS",a=>a.transformWorldFromModelRS),new Zh("transformWorldFromModelTH",a=>a.transformWorldFromModelTH),new Zh("transformWorldFromModelTL",a=>a.transformWorldFromModelTL)),r.code.add(E`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * position;
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),r.code.add(E`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${e.spherical?E`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:E`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),n.uniforms.add(new _r("transformWorldFromViewTL",a=>a.transformWorldFromViewTL)),r.code.add(E`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),n.code.add(E`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}let y0t=class extends hr{constructor(){super(...arguments),this.transformWorldFromViewTH=R(),this.transformWorldFromViewTL=R(),this.transformViewFromCameraRelativeRS=Ir(),this.transformProjFromView=it()}},_0t=class extends hr{constructor(){super(...arguments),this.transformWorldFromModelRS=Ir(),this.transformWorldFromModelTH=R(),this.transformWorldFromModelTL=R()}};function O8(t,e){switch(e.normalType){case 0:case 1:t.include(C4,e),t.varyings.add("vNormalWorld","vec3"),t.varyings.add("vNormalView","vec3"),t.vertex.uniforms.add(new tDe("transformNormalGlobalFromModel",i=>i.transformNormalGlobalFromModel),new Ap("transformNormalViewFromGlobal",i=>i.transformNormalViewFromGlobal)).code.add(E`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`);break;case 2:t.vertex.code.add(E`void forwardNormal() {}`);break;default:e.normalType;case 3:}}let iDe=class extends y0t{constructor(){super(...arguments),this.transformNormalViewFromGlobal=Ir()}},rDe=class extends _0t{constructor(){super(...arguments),this.transformNormalGlobalFromModel=Ir(),this.toMapSpace=ri()}};const Pge={func:513},Rge={func:519},lV={mask:255},v0t={mask:0},b0t=t=>({function:{func:517,ref:t,mask:t},operation:{fail:7680,zFail:7680,zPass:7680}}),w0t=t=>({function:{func:519,ref:t,mask:t},operation:{fail:7680,zFail:7680,zPass:7681}}),ure={function:{func:519,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:0}},vX={function:{func:519,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7681}},x0t={function:{func:514,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7680}},S0t={function:{func:517,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7680}};let T0t=class{constructor(e,i,r){this.elementSize=i.stride,this._buffer=new Hs(e,Lo(i,1)),this.resize(r)}destroy(){this._buffer.dispose()}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get usedMemory(){return this._array.byteLength+this._buffer.usedMemory}copyRange(e,i,r,s=0){const n=new Uint8Array(this.array,e*this.elementSize,(i-e)*this.elementSize);new Uint8Array(r.array,s*this.elementSize).set(n)}transferAll(){this._buffer.setData(this._array)}transferRange(e,i){const r=e*this.elementSize,s=i*this.elementSize;this._buffer.setSubData(new Uint8Array(this._array),r,r,s)}resize(e){const i=e*this.elementSize,r=new ArrayBuffer(i);this._array&&(e>=this._capacity?new Uint8Array(r).set(new Uint8Array(this._array)):new Uint8Array(r).set(new Uint8Array(this._array).subarray(0,e*this.elementSize))),this._array=r,this._buffer.setSize(i),this._capacity=e}},Dge=class{constructor(e){this.localTransform=e.localTransform,this.globalTransform=e.globalTransform,this.modelOrigin=e.modelOrigin,this.model=e.instanceModel,this.modelNormal=e.instanceModelNormal,this.modelScaleFactors=e.modelScaleFactors,this.boundingSphere=e.boundingSphere,this.featureAttribute=e.getField("instanceFeatureAttribute",Yx),this.color=e.getField("instanceColor",Bu),this.olidColor=e.getField("instanceOlidColor",Bu),this.state=e.getField("state",A6),this.lodLevel=e.getField("lodLevel",A6)}},fA=class extends Me{constructor(e,i){super(e),this.events=new Ey,this._capacity=0,this._size=0,this._next=0,this._highlightOptionsMap=new Map,this._highlightOptionsMapPrev=new Map,this._layout=M0t(i),this._capacity=cV,this._buffer=this._layout.createBuffer(this._capacity),this._view=new Dge(this._buffer)}get capacity(){return this._capacity}get size(){return this._size}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this._grow();const e=this._findSlot();return this._view.state.set(e,1),this._size++,this.events.emit("instances-changed"),e}removeInstance(e){const i=this._view.state;dt(e>=0&&e<this._capacity&&!!(1&i.get(e)),"invalid instance handle"),this._getStateFlag(e,18)?this._setStateFlags(e,32):this.freeInstance(e),this.events.emit("instances-changed")}freeInstance(e){const i=this._view.state;dt(e>=0&&e<this._capacity&&!!(1&i.get(e)),"invalid instance handle"),i.set(e,0),this._size--}setLocalTransform(e,i,r=!0){this._view.localTransform.setMat(e,i),r&&this.updateModelTransform(e)}getLocalTransform(e,i){this._view.localTransform.getMat(e,i)}setGlobalTransform(e,i,r=!0){this._view.globalTransform.setMat(e,i),r&&this.updateModelTransform(e)}getGlobalTransform(e,i){this._view.globalTransform.getMat(e,i)}updateModelTransform(e){const i=this._view,r=ac,s=xd;i.localTransform.getMat(e,Ige),i.globalTransform.getMat(e,Gq);const n=an(Gq,Gq,Ige);ve(r,n[12],n[13],n[14]),i.modelOrigin.setVec(e,r),jv(s,n),i.model.setMat(e,s);const a=sXe(ac,n);a.sort(),i.modelScaleFactors.set(e,0,a[1]),i.modelScaleFactors.set(e,1,a[2]),i2(s,s),qv(s,s),i.modelNormal.setMat(e,s),this._setStateFlags(e,64),this.events.emit("instance-transform-changed",{index:e})}getModelTransform(e,i){const r=this._view;r.model.getMat(e,xd),r.modelOrigin.getVec(e,ac),i[0]=xd[0],i[1]=xd[1],i[2]=xd[2],i[3]=0,i[4]=xd[3],i[5]=xd[4],i[6]=xd[5],i[7]=0,i[8]=xd[6],i[9]=xd[7],i[10]=xd[8],i[11]=0,i[12]=ac[0],i[13]=ac[1],i[14]=ac[2],i[15]=1}applyShaderTransformation(e,i){this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,i)}getCombinedModelTransform(e,i){return this.getModelTransform(e,i),this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,i),i}getCombinedLocalTransform(e,i){this._view.localTransform.getMat(e,i),this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,i)}getCombinedMaxScaleFactor(e){let i=this._view.modelScaleFactors.get(e,1);return this.shaderTransformation!=null&&(this.shaderTransformation.scaleFactor(ac,this,e),i*=Math.max(ac[0],ac[1],ac[2])),i}getCombinedMedianScaleFactor(e){let i=this._view.modelScaleFactors.get(e,0);return this.shaderTransformation!=null&&(this.shaderTransformation.scaleFactor(ac,this,e),i*=$0t(ac[0],ac[1],ac[2])),i}getModel(e,i){this._view.model.getMat(e,i)}setFeatureAttribute(e,i){this._view.featureAttribute?.setVec(e,i)}getFeatureAttribute(e,i){this._view.featureAttribute?.getVec(e,i)}setColor(e,i){this._view.color?.setVec(e,i)}setObjectAndLayerIdColor(e,i){this._view.olidColor?.setVec(e,i)}setVisible(e,i){i!==this.getVisible(e)&&(this._setStateFlag(e,4,i),this.events.emit("instance-visibility-changed",{index:e}))}getVisible(e){return this._getStateFlag(e,4)}setHighlight(e,i){const{_highlightOptionsMap:r}=this,s=r.get(e);i?i!==s&&(r.set(e,i),this._setStateFlag(e,8,!0),this.events.emit("instance-highlight-changed")):s&&(r.delete(e),this._setStateFlag(e,8,!1),this.events.emit("instance-highlight-changed"))}get highlightOptionsMap(){return this._highlightOptionsMap}getHighlightStateFlag(e){return this._getStateFlag(e,8)}geHighlightOptionsPrev(e){const i=this._highlightOptionsMapPrev.get(e)??null;return this._highlightOptionsMapPrev.delete(e),i}getHighlightName(e){const i=this.highlightOptionsMap.get(e)??null;return i?this._highlightOptionsMapPrev.set(e,i):this._highlightOptionsMapPrev.delete(e),i}getState(e){return this._view.state.get(e)}getLodLevel(e){return this._view.lodLevel.get(e)}countFlags(e){let i=0;for(let r=0;r<this._capacity;++r)this.getState(r)&e&&++i;return i}_setStateFlags(e,i){const r=this._view.state;i=r.get(e)|i,r.set(e,i)}_clearStateFlags(e,i){const r=this._view.state;i=r.get(e)&~i,r.set(e,i)}_setStateFlag(e,i,r){r?this._setStateFlags(e,i):this._clearStateFlags(e,i)}_getStateFlag(e,i){return!!(this._view.state.get(e)&i)}_grow(){this._capacity=Math.max(cV,Math.floor(this._capacity*ZV)),this._buffer=this._layout.createBuffer(this._capacity).copyFrom(this._buffer),this._view=new Dge(this._buffer)}_findSlot(){const e=this._view.state;let i=this._next;for(;1&e.get(i);)i=i+1===this._capacity?0:i+1;return this._next=i+1===this._capacity?0:i+1,i}};function $0t(t,e,i){return Math.max(Math.min(t,e),Math.min(Math.max(t,e),i))}d([m({constructOnly:!0})],fA.prototype,"shaderTransformation",void 0),d([m()],fA.prototype,"_size",void 0),d([m({readOnly:!0})],fA.prototype,"size",null),fA=d([k("esri.views.3d.webgl-engine.lib.lodRendering.InstanceData")],fA);const C0t=jc().mat4f64("localTransform").mat4f64("globalTransform").vec4f64("boundingSphere").vec3f64("modelOrigin").mat3f("instanceModel").mat3f("instanceModelNormal").vec2f("modelScaleFactors");function M0t(t){return sDe(C0t.clone(),t).u8("state").u8("lodLevel")}function sDe(t,e){return e.instancedFeatureAttribute&&t.vec4f("instanceFeatureAttribute"),e.instancedColor&&t.vec4u8("instanceColor"),Jh()&&t.vec4u8("instanceOlidColor"),t}const ac=R(),xd=Ir(),Ige=it(),Gq=it(),cV=64;let E0t=class{constructor(e){this.model=e.instanceModel,this.modelNormal=e.instanceModelNormal,this.modelOriginHi=e.instanceModelOriginHi,this.modelOriginLo=e.instanceModelOriginLo,this.featureAttribute=e.getField("instanceFeatureAttribute",Yx),this.color=e.getField("instanceColor",Bu),this.olidColor=e.getField("instanceOlidColor",Bu)}},pWt=class{constructor(e,i){this._rctx=e,this._layout=i,this._headIndex=0,this._tailIndex=0,this._firstIndex=null,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const e=this._headIndex,i=this._tailIndex;return e>=i?e-i:e+this._capacity-i}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get usedMemory(){return this._buffer?.usedMemory??0}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCycle(){this._captureFirstIndex=!0}beginUpdate(){dt(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){dt(this._updating,"not updating"),this.size<_8e*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){dt(this._updating,"not updating"),this.isFull&&this._grow();const e=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=e,this._captureFirstIndex=!1),this._incrementHead(),dt(this._headIndex!==this._tailIndex,"invalid pointers"),e}freeTail(){dt(this._updating,"not updating"),dt(this.size>0,"invalid size");const e=this._tailIndex===this._firstIndex;this._incrementTail(),e&&(this._firstIndex=this._tailIndex)}_grow(){const e=Math.max(cV,Math.floor(this._capacity*ZV));this._resize(e)}_shrink(){const e=Math.max(cV,Math.floor(this._capacity*y8e));this._resize(e)}_resize(e){if(dt(this._updating,"not updating"),e===this._capacity)return;const i=new T0t(this._rctx,this._layout,e);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const r=this.size,s=this._compactInstances(i);dt(s===r,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=s,this._prevHeadIndex=0}this._resized=!0,this._capacity=e,this._buffer=i,this._view=new E0t(this._layout.createView(this._buffer.array))}_compactInstances(e){const i=this._headIndex,r=this._tailIndex;return r<i?(this._buffer.copyRange(r,i,e),i-r):r>i?(this._buffer.copyRange(r,this._capacity,e),i>0&&this._buffer.copyRange(0,i,e,this._capacity-r),i+(this._capacity-r)):0}_incrementHead(e=1){this._headIndex=(this._headIndex+e)%this._capacity}_incrementTail(e=1){this._tailIndex=(this._tailIndex+e)%this._capacity}_transferRange(e,i){e<i?this._buffer.transferRange(e,i):e>i&&(i>0&&this._buffer.transferRange(0,i),this._buffer.transferRange(e,this._capacity))}};const A0t=jc().vec3f("instanceModelOriginHi").vec3f("instanceModelOriginLo").mat3f("instanceModel").mat3f("instanceModelNormal");function O0t(t){return sDe(A0t.clone(),t)}function mWt({normalTexture:t,metallicRoughnessTexture:e,metallicFactor:i,roughnessFactor:r,emissiveTexture:s,emissiveFactor:n,occlusionTexture:a}){return t==null&&e==null&&s==null&&(n==null||si(n,Kn))&&a==null&&(r==null||r===1)&&(i==null||i===1)}function gWt({normalTexture:t,metallicRoughnessTexture:e,metallicFactor:i,roughnessFactor:r,emissiveTexture:s,emissiveFactor:n,occlusionTexture:a}){return t==null&&e==null&&s==null&&(n==null||si(n,Kn))&&a==null&&(r==null||r===1)&&(i==null||i===1||i===0)}const nDe=bv(1,1,.5),yWt=bv(0,.6,.2),_Wt=bv(0,1,.2);function aDe(t){t.vertex.code.add(E`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)}function oDe(t){t.varyings.add("linearDepth","float",{invariant:!0})}function lDe(t,e){oDe(t),t.vertex.code.add(E`
    void forwardLinearDepth(float _linearDepth) { ${_e(e,"linearDepth = _linearDepth;")} }
  `)}function hre(t){t.vertex.uniforms.add(new Sy("nearFar",e=>e.camera.nearFar))}function cDe(t){t.vertex.code.add(E`float calculateLinearDepth(vec2 nearFar,float z) {
return (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)}function P0t(t,e){const{vertex:i}=t,r=QP(e.output);r&&(t.include(lR,e),lDe(t,!0),hre(t),cDe(t)),i.code.add(E`
    void forwardLinearDepthToWriteShadowMap() {
      ${_e(r,"forwardLinearDepth(calculateLinearDepth(nearFar, vPosition_view.z));")}
    }
  `)}function k_(t){cDe(t),t.vertex.code.add(E`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = calculateLinearDepth(nearFar,eye.z);
return proj * eye;
}`),t.vertex.code.add(E`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}function uDe(t,e){e.instancedColor?(t.attributes.add("instanceColor","vec4"),t.vertex.include(Kv),t.vertex.include(oRe),t.vertex.include(Wie),t.vertex.code.add(E`
      MaskedColor applyInstanceColor(MaskedColor color) {
        return multiplyMaskedColors( color, createMaskedFromUInt8NaNColor(${"instanceColor"}));
      }
    `)):t.vertex.code.add(E`MaskedColor applyInstanceColor(MaskedColor color) {
return color;
}`)}function R0t(t,e,i){for(let r=0;r<i;++r)e[2*r]=t[r],e[2*r+1]=t[r]-e[2*r]}function D0t(t,e){const i=t.length;for(let r=0;r<i;++r)$3[0]=t[r],e[r]=$3[0];return e}function I0t(t,e){const i=t.length;for(let r=0;r<i;++r)$3[0]=t[r],$3[1]=t[r]-$3[0],e[r]=$3[1];return e}const $3=new Float32Array(2),Lge=Ir();function hDe(t,e){const{hasModelTransformation:i,instancedDoublePrecision:r,instanced:s,output:n,hasVertexTangents:a}=e;i&&(t.vertex.uniforms.add(new cre("model",l=>l.modelTransformation??Ro)),t.vertex.uniforms.add(new Ap("normalLocalOriginFromModel",l=>(S2e(Lge,l.modelTransformation??Ro),Lge)))),s&&r&&(t.attributes.add("instanceModelOriginHi","vec3"),t.attributes.add("instanceModelOriginLo","vec3"),t.attributes.add("instanceModel","mat3"),t.attributes.add("instanceModelNormal","mat3"));const o=t.vertex;r&&(o.include(eDe,e),o.uniforms.add(new co("viewOriginHi",l=>D0t(ve(DL,l.camera.viewInverseTransposeMatrix[3],l.camera.viewInverseTransposeMatrix[7],l.camera.viewInverseTransposeMatrix[11]),DL)),new co("viewOriginLo",l=>I0t(ve(DL,l.camera.viewInverseTransposeMatrix[3],l.camera.viewInverseTransposeMatrix[7],l.camera.viewInverseTransposeMatrix[11]),DL)))),o.code.add(E`
    vec3 getVertexInLocalOriginSpace() {
      return ${i?r?"(model * vec4(instanceModel * localPosition().xyz, 1.0)).xyz":"(model * localPosition()).xyz":r?"instanceModel * localPosition().xyz":"localPosition().xyz"};
    }

    vec3 subtractOrigin(vec3 _pos) {
      ${r?E`
          // Issue: (should be resolved now with invariant position) https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/56280
          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -instanceModelOriginHi, -instanceModelOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `),o.code.add(E`
    vec3 dpNormal(vec4 _normal) {
      return normalize(${i?r?"normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz)":"normalLocalOriginFromModel * _normal.xyz":r?"instanceModelNormal * _normal.xyz":"_normal.xyz"});
    }
    `),n===3&&(Nie(o),o.code.add(E`
    vec3 dpNormalView(vec4 _normal) {
      return normalize((viewNormal * ${i?r?"vec4(normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz), 1.0)":"vec4(normalLocalOriginFromModel * _normal.xyz, 1.0)":r?"vec4(instanceModelNormal * _normal.xyz, 1.0)":"_normal"}).xyz);
    }
    `)),a&&o.code.add(E`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${i?r?"return vec4(normalLocalOriginFromModel * (instanceModelNormal * _tangent.xyz), _tangent.w);":"return vec4(normalLocalOriginFromModel * _tangent.xyz, _tangent.w);":r?"return vec4(instanceModelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}
    }`)}const DL=R();let e1=class extends Ni{constructor(e,i){super(e,"int",1,(r,s,n)=>r.setUniform1i(e,i(s,n)))}};function dDe(t,e){t.varyings.add("colorMixMode","int"),t.varyings.add("opacityMixMode","int"),t.vertex.uniforms.add(new e1("symbolColorMixMode",i=>nR[i.colorMixMode])),e.hasSymbolColors?(t.vertex.include(Kv),t.vertex.include(oRe),t.vertex.include(Wie),t.attributes.add("symbolColor","vec4"),t.vertex.code.add(E`
    MaskedColor applySymbolColor(MaskedColor color) {
      return multiplyMaskedColors(color, createMaskedFromUInt8NaNColor(${"symbolColor"}));
    }
  `)):t.vertex.code.add(E`MaskedColor applySymbolColor(MaskedColor color) {
return color;
}`),t.vertex.code.add(E`
    void forwardColorMixMode(bvec4 mask) {
      colorMixMode = mask.r ? ${E.int(nR.ignore)} : symbolColorMixMode;
      opacityMixMode = mask.a ? ${E.int(nR.ignore)} : symbolColorMixMode;
    }
  `)}function Gg(t,e){switch(e.textureCoordinateType){case 1:return t.attributes.add("uv0","vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(E`void forwardTextureCoordinates() { vuv0 = uv0; }`);case 2:return t.attributes.add("uv0","vec2"),t.attributes.add("uvRegion","vec4"),t.varyings.add("vuv0","vec2"),t.varyings.add("vuvRegion","vec4"),void t.vertex.code.add(E`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);default:e.textureCoordinateType;case 0:return void t.vertex.code.add(E`void forwardTextureCoordinates() {}`);case 3:return}}function P8(t,e){e.hasVertexColors?(t.attributes.add("color","vec4"),t.varyings.add("vColor","vec4"),t.vertex.code.add(E`void forwardVertexColor() { vColor = color; }`),t.vertex.code.add(E`
      void forwardNormalizedVertexColor() { vColor = color * ${E.float(1/255)}; }
    `)):t.vertex.code.add(E`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}function dre(t,e){switch(e.output){case 4:case 5:case 6:case 7:t.fragment.code.add(E`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 20.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
return depth + SLOPE_SCALE * m + BIAS;
}
void outputDepth(float _linearDepth){
float fragDepth = _calculateFragDepth(_linearDepth);
gl_FragDepth = fragDepth;
}`);break;case 8:t.fragment.code.add(E`void outputDepth(float _linearDepth){
gl_FragDepth = _linearDepth;
}`)}}let R8=class extends Ni{constructor(e,i,r){super(e,"float",2,(s,n,a)=>s.setUniform1f(e,i(n,a),r))}};function C3(t,e){pDe(t,e,new ut("textureAlphaCutoff",i=>i.textureAlphaCutoff))}function L0t(t,e){pDe(t,e,new R8("textureAlphaCutoff",i=>i.textureAlphaCutoff))}function pDe(t,e,i){const r=t.fragment,s=e.alphaDiscardMode,n=s===0;s!==2&&s!==3||r.uniforms.add(i),r.code.add(E`
    void discardOrAdjustAlpha(inout vec4 color) {
      ${s===1?"color.a = 1.0;":`if (color.a < ${n?E.float(Gr):"textureAlphaCutoff"}) {
              discard;
             } ${_e(s===2,"else { color.a = 1.0; }")}`}
    }
  `)}function fDe(t,e){const{vertex:i,fragment:r,varyings:s}=t,{hasColorTexture:n,alphaDiscardMode:a}=e,o=n&&a!==1,{output:l,normalType:c,hasColorTextureTransform:h}=e;switch(l){case 2:jg(i,e),t.include(k_),r.include(I_,e),t.include(Gg,e),o&&r.uniforms.add(new zt("tex",f=>f.texture)),i.main.add(E`vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPosition(proj, view, vpos);
forwardTextureCoordinates();`),t.include(C3,e),r.main.add(E`
        discardBySlice(vpos);
        ${_e(o,E`vec4 texColor = texture(tex, ${h?"colorUV":"vuv0"});
                discardOrAdjustAlpha(texColor);`)}`);break;case 4:case 5:case 6:case 7:case 10:jg(i,e),t.include(k_),t.include(Gg,e),t.include(Rw,e),t.include(dre,e),r.include(I_,e),t.include(Gie,e),hre(t),s.add("depth","float",{invariant:!0}),o&&r.uniforms.add(new zt("tex",f=>f.texture)),i.main.add(E`vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
forwardTextureCoordinates();
forwardObjectAndLayerIdColor();`),t.include(C3,e),r.main.add(E`
        discardBySlice(vpos);
        ${_e(o,E`vec4 texColor = texture(tex, ${h?"colorUV":"vuv0"});
               discardOrAdjustAlpha(texColor);`)}
        ${l===10?E`outputObjectAndLayerIdColor();`:E`outputDepth(depth);`}`);break;case 3:{jg(i,e),t.include(k_),t.include(C4,e),t.include(O8,e),t.include(Gg,e),t.include(Rw,e),o&&r.uniforms.add(new zt("tex",y=>y.texture)),c===2&&s.add("vPositionView","vec3",{invariant:!0});const f=c===0||c===1;i.main.add(E`
        vpos = getVertexInLocalOriginSpace();
        ${f?E`vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:E`vPositionView = (view * vec4(vpos, 1.0)).xyz;`}
        vpos = subtractOrigin(vpos);
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPosition(proj, view, vpos);
        forwardTextureCoordinates();`),r.include(I_,e),t.include(C3,e),r.main.add(E`
        discardBySlice(vpos);
        ${_e(o,E`vec4 texColor = texture(tex, ${h?"colorUV":"vuv0"});
                discardOrAdjustAlpha(texColor);`)}

        ${c===2?E`vec3 normal = screenDerivativeNormal(vPositionView);`:E`vec3 normal = normalize(vNormalWorld);
                    if (gl_FrontFacing == false){
                      normal = -normal;
                    }`}
        fragColor = vec4(0.5 + 0.5 * normal, 1.0);`);break}case 9:jg(i,e),t.include(k_),t.include(Gg,e),t.include(Rw,e),o&&r.uniforms.add(new zt("tex",f=>f.texture)),i.main.add(E`vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPosition(proj, view, vpos);
forwardTextureCoordinates();`),r.include(I_,e),t.include(C3,e),t.include(CM,e),r.main.add(E`
        discardBySlice(vpos);
        ${_e(o,E`vec4 texColor = texture(tex, ${h?"colorUV":"vuv0"});
                discardOrAdjustAlpha(texColor);`)}
        calculateOcclusionAndOutputHighlight();`)}}function k0t(t){t.fragment.code.add(E`vec4 textureAtlasLookup(sampler2D tex, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
return textureGrad(tex, uvAtlas, dUVdx, dUVdy);
}`)}function D8(t,e){const{textureCoordinateType:i}=e;if(i===0||i===3)return;t.include(Gg,e);const r=i===2;r&&t.include(k0t),t.fragment.code.add(E`
    vec4 textureLookup(sampler2D tex, vec2 uv) {
      return ${r?"textureAtlasLookup(tex, uv, vuvRegion)":"texture(tex, uv)"};
    }
  `)}let Dv=class extends Ni{constructor(e,i){super(e,"sampler2D",2,(r,s,n)=>r.bindTexture(e,i(s,n)))}};function mDe(t,e){const i=t.fragment,{hasVertexTangents:r,doubleSidedMode:s,hasNormalTexture:n,textureCoordinateType:a,bindType:o,hasNormalTextureTransform:l}=e;r?(t.attributes.add("tangent","vec4"),t.varyings.add("vTangent","vec4"),s===2?i.code.add(E`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):i.code.add(E`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):i.code.add(E`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`),n&&a!==0&&(t.include(D8,e),i.uniforms.add(o===1?new zt("normalTexture",c=>c.textureNormal):new Dv("normalTexture",c=>c.textureNormal)),l&&(i.uniforms.add(new ll("scale",c=>c.scale??S3e)),i.uniforms.add(new Ap("normalTextureTransformMatrix",c=>c.normalTextureTransformMatrix??r2))),i.code.add(E`vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
vec3 rawNormal = textureLookup(normalTexture, uv).rgb * 2.0 - 1.0;`),l&&i.code.add(E`mat3 normalRotation = mat3(normalTextureTransformMatrix[0][0]/scale[0], normalTextureTransformMatrix[0][1]/scale[1], 0.0,
normalTextureTransformMatrix[1][0]/scale[0], normalTextureTransformMatrix[1][1]/scale[1], 0.0,
0.0, 0.0, 0.0 );
rawNormal.xy = (normalRotation * vec3(rawNormal.x, rawNormal.y, 1.0)).xy;`),i.code.add(E`return tangentSpace * rawNormal;
}`))}const gDe=3e5,uV=5e5;let pre=class extends Ni{constructor(e,i,r){super(e,"vec2",2,(s,n,a,o)=>s.setUniform2fv(e,i(n,a,o),r))}};const Hq=4;function yDe(){const t=new Di,e=t.fragment;t.include(Oa);const i=(Hq+1)/2,r=1/(2*i*i);return e.include(rd),e.uniforms.add(new zt("depthMap",s=>s.depthTexture),new Dv("tex",s=>s.colorTexture),new pre("blurSize",s=>s.blurSize),new ut("projScale",(s,n)=>{const a=n.camera.distance;return a>5e4?Math.max(0,s.projScale-(a-5e4)):s.projScale})),e.code.add(E`
    void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
      float c = texture(tex, uv).r;
      float d = linearDepthFromTexture(depthMap, uv);

      float ddiff = d - center_d;

      float w = exp(-r * r * ${E.float(r)} - ddiff * ddiff * sharpness);
      wTotal += w;
      bTotal += w * c;
    }
  `),t.outputs.add("fragBlur","float"),e.main.add(E`
    float b = 0.0;
    float w_total = 0.0;

    float center_d = linearDepthFromTexture(depthMap, uv);

    float sharpness = -0.05 * projScale / center_d;
    for (int r = -${E.int(Hq)}; r <= ${E.int(Hq)}; ++r) {
      float rf = float(r);
      vec2 uvOffset = uv + rf * blurSize;
      blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
    }
    fragBlur = b / w_total;`),t}const z0t=Object.freeze(Object.defineProperty({__proto__:null,build:yDe},Symbol.toStringTag,{value:"Module"}));let kge=class extends Vi{constructor(e,i){super(e,i,new Ii(z0t,()=>te(()=>Promise.resolve().then(()=>Pkt),void 0)),Qs)}initializePipeline(){return li({colorWrite:$i})}};const F0t="eXKEvZaUc66cjIKElE1jlJ6MjJ6Ufkl+jn2fcXp5jBx7c6KEflSGiXuXeW6OWs+tfqZ2Yot2Y7Zzfo2BhniEj3xoiXuXj4eGZpqEaHKDWjSMe7palFlzc3BziYOGlFVzg6Zzg7CUY5JrjFF7eYJ4jIKEcyyEonSXe7qUfqZ7j3xofqZ2c4R5lFZ5Y0WUbppoe1l2cIh2ezyUho+BcHN2cG6DbpqJhqp2e1GcezhrdldzjFGUcyxjc3aRjDyEc1h7Sl17c6aMjH92pb6Mjpd4dnqBjMOEhqZleIOBYzB7gYx+fnqGjJuEkWlwnCx7fGl+c4hjfGyRe5qMlNOMfnqGhIWHc6OMi4GDc6aMfqZuc6aMzqJzlKZ+lJ6Me3qRfoFue0WUhoR5UraEa6qMkXiPjMOMlJOGe7JrUqKMjK6MeYRzdod+Sl17boiPc6qEeYBlcIh2c1WEe7GDiWCDa0WMjEmMdod+Y0WcdntzhmN8WjyMjKJjiXtzgYxYaGd+a89zlEV7e2GJfnd+lF1rcK5zc4p5cHuBhL6EcXp5eYB7fnh8iX6HjIKEeaxuiYOGc66RfG2Ja5hzjlGMjEmMe9OEgXuPfHyGhPeEdl6JY02McGuMfnqGhFiMa3WJfnx2l4hwcG1uhmN8c0WMc39og1GBbrCEjE2EZY+JcIh2cIuGhIWHe0mEhIVrc09+gY5+eYBlnCyMhGCDl3drfmmMgX15aGd+gYx+fnuRfnhzY1SMsluJfnd+hm98WtNrcIuGh4SEj0qPdkqOjFF7jNNjdnqBgaqUjMt7boeBhnZ4jDR7c5pze4GGjEFrhLqMjHyMc0mUhKZze4WEa117kWlwbpqJjHZ2eX2Bc09zeId+e0V7WlF7jHJ2l72BfId8l3eBgXyBe897jGl7c66cgW+Xc76EjKNbgaSEjGx4fId8jFFjgZB8cG6DhlFziZhrcIh2fH6HgUqBgXiPY8dahGFzjEmMhEFre2dxhoBzc5SGfleGe6alc7aUeYBlhKqUdlp+cH5za4OEczxza0Gcc4J2jHZ5iXuXjH2Jh5yRjH2JcFx+hImBjH+MpddCl3dreZeJjIt8ZW18bm1zjoSEeIOBlF9oh3N7hlqBY4+UeYFwhLJjeYFwaGd+gUqBYxiEYot2fqZ2ondzhL6EYyiEY02Ea0VjgZB8doaGjHxoc66cjEGEiXuXiXWMiZhreHx8frGMe75rY02Ec5pzfnhzlEp4a3VzjM+EhFFza3mUY7Zza1V5e2iMfGyRcziEhDyEkXZ2Y4OBnCx7g5t2eyBjgV6EhEFrcIh2dod+c4Z+nJ5zjm15jEmUeYxijJp7nL6clIpjhoR5WrZraGd+fnuRa6pzlIiMg6ZzfHx5foh+eX1ufnB5eX1ufnB5aJt7UqKMjIh+e3aBfm5lbYSBhGFze6J4c39oc0mUc4Z+e0V7fKFVe0WEdoaGY02Ec4Z+Y02EZYWBfH6HgU1+gY5+hIWUgW+XjJ57ebWRhFVScHuBfJ6PhBx7WqJzlM+Ujpd4gHZziX6HjHmEgZN+lJt5boiPe2GJgX+GjIGJgHZzeaxufnB5hF2JtdN7jJ57hp57hK6ElFVzg6ZzbmiEbndzhIWHe3uJfoFue3qRhJd2j3xoc65zlE1jc3p8lE1jhniEgXJ7e657vZaUc3qBh52BhIF4aHKDa9drgY5+c52GWqZzbpqJe8tjnM+UhIeMfo2BfGl+hG1zSmmMjKJjZVaGgX15c1lze0mEp4OHa3mUhIWHhDyclJ6MeYOJkXiPc0VzhFiMlKaEboSJa5Jze41re3qRhn+HZYWBe0mEc4p5fnORbox5lEp4hGFjhGGEjJuEc1WEhLZjeHeGa7KlfHx2hLaMeX1ugY5+hIWHhKGPjMN7c1WEho1zhoBzZYx7fnhzlJt5exyUhFFziXtzfmmMa6qMYyiEiXxweV12kZSMeWqXSl17fnhzxmmMrVGEe1mcc4p5eHeGjK6MgY5+doaGa6pzlGV7g1qBh4KHkXiPeW6OaKqafqZ2eXZ5e1V7jGd7boSJc3BzhJd2e0mcYot2h1RoY8dahK6EQmWEWjx7e1l2lL6UgXyBdnR4eU9zc0VreX1umqaBhld7fo2Bc6KEc5Z+hDyEcIeBWtNrfHyGe5qMhMuMe5qMhEGEbVVupcNzg3aHhIF4boeBe0mEdlptc39ofFl5Y8uUlJOGiYt2UmGEcyxjjGx4jFF7a657ZYWBnElzhp57iXtrgZN+tfOEhIOBjE2HgU1+e8tjjKNbiWCDhE15gUqBgYN7fnqGc66ce9d7iYSBj0qPcG6DnGGcT3eGa6qMZY+JlIiMl4hwc3aRdnqBlGV7eHJ2hLZjfnuRhDyEeX6MSk17g6Z+c6aUjHmEhIF4gXyBc76EZW18fGl+fkl+jCxrhoVwhDyUhIqGlL2DlI6EhJd2tdN7eYORhEGMa2Faa6pzc3Bzc4R5lIRznM+UY9eMhDycc5Z+c4p5c4iGY117pb6MgXuPrbJafnx2eYOJeXZ5e657hDyEcziElKZjfoB5eHeGj4WRhGGEe6KGeX1utTStc76EhFGJnCyMa5hzfH6HnNeceYB7hmN8gYuMhIVrczSMgYF8h3N7c5pza5hzjJqEYIRdgYuMlL2DeYRzhGGEeX1uhLaEc4iGeZ1zdl6JhrVteX6Me2iMfm5lWqJzSpqEa6pzdnmchHx2c6OMhNdrhoR5g3aHczxzeW52gV6Ejm15frGMc0Vzc4Z+l3drfniJe+9rWq5rlF1rhGGEhoVwe9OEfoh+e7pac09+c3qBY0lrhDycdnp2lJ6MiYOGhGCDc3aRlL2DlJt5doaGdnp2gYF8gWeOjF2Uc4R5c5Z+jEmMe7KEc4mEeYJ4dmyBe0mcgXiPbqJ7eYB7fmGGiYSJjICGlF1reZ2PnElzbpqJfH6Hc39oe4WEc5eJhK6EhqyJc3qBgZB8c09+hEmEaHKDhFGJc5SGiXWMUpaEa89zc6OMnCyMiXtrho+Be5qMc7KEjJ57dmN+hKGPjICGbmiEe7prdod+hGCDdnmchBx7eX6MkXZ2hGGEa657hm98jFFjY5JreYOJgY2EjHZ2a295Y3FajJ6Mc1J+YzB7e4WBjF2Uc4R5eV12gYxzg1qBeId+c9OUc5pzjFFjgY5+hFiMlIaPhoR5lIpjjIKBlNdSe7KEeX2BfrGMhIqGc65zjE2UhK6EklZ+QmWEeziMWqZza3VzdnR4foh+gYF8n3iJiZhrnKp7gYF8eId+lJ6Me1lrcIuGjKJjhmN8c66MjFF7a6prjJ6UnJ5zezyUfruRWlF7nI5zfHyGe657h4SEe8tjhBx7jFFjc09+c39ojICMeZeJeXt+YzRzjHZ2c0WEcIeBeXZ5onSXkVR+gYJ+eYFwdldzgYF7eX2BjJ6UiXuXlE1jh4SEe1mchLJjc4Z+hqZ7eXZ5bm1zlL6Ue5p7iWeGhKqUY5pzjKJjcIeBe8t7gXyBYIRdlEp4a3mGnK6EfmmMZpqEfFl5gYxzjKZuhGFjhoKGhHx2fnx2eXuMe3aBiWeGvbKMe6KGa5hzYzB7gZOBlGV7hmN8hqZlYot2Y117a6pzc6KEfId8foB5rctrfneJfJ6PcHN2hFiMc5pzjH92c0VzgY2EcElzdmCBlFVzg1GBc65zY4OBboeBcHiBeYJ4ewxzfHx5lIRzlEmEnLKEbk1zfJ6PhmN8eYBljBiEnMOEiXxwezyUcIeBe76EdsKEeX2BdnR4jGWUrXWMjGd7fkl+j4WRlEGMa5Jzho+BhDyEfnqMeXt+g3aHlE1jczClhNN7ZW18eHx8hGFjZW18iXWMjKJjhH57gYuMcIuGWjyMe4ZtjJuExmmMj4WRdntzi4GDhFFzYIRdnGGcjJp7Y0F7e4WEkbCGiX57fnSHa657a6prhBCMe3Z+SmmMjH92eHJ2hK6EY1FzexhrvbKMnI5za4OEfnd+eXuMhImBe897hLaMjN+EfG+BeIOBhF1+eZeJi4GDkXZ2eXKEgZ6Ejpd4c2GHa1V5e5KUfqZuhCx7jKp7lLZrg11+hHx2hFWUoot2nI5zgbh5mo9zvZaUe3qRbqKMfqZ2kbCGhFiM";let N0t=class extends hr{constructor(){super(...arguments),this.projScale=1}},V0t=class extends N0t{constructor(){super(...arguments),this.intensity=1}},U0t=class extends hr{},B0t=class extends U0t{constructor(){super(...arguments),this.blurSize=pt()}};function I8(t){t.fragment.uniforms.add(new ao("projInfo",e=>j0t(e.camera))),t.fragment.uniforms.add(new Sy("zScale",e=>q0t(e.camera))),t.fragment.code.add(E`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}function j0t(t){const e=t.projectionMatrix;return e[11]===0?yr(zge,2/(t.fullWidth*e[0]),2/(t.fullHeight*e[5]),(1+e[12])/e[0],(1+e[13])/e[5]):yr(zge,-2/(t.fullWidth*e[0]),-2/(t.fullHeight*e[5]),(1-e[8])/e[0],(1-e[9])/e[5])}const zge=ri();function q0t(t){return t.projectionMatrix[11]===0?Cr(Fge,0,1):Cr(Fge,1,0)}const Fge=pt(),Nge=16;function _De(){const t=new Di,e=t.fragment;return t.include(Oa),t.include(I8),e.include(rd),e.uniforms.add(new ws("radius",i=>L8(i.camera))).code.add(E`vec3 sphere[16] = vec3[16](
vec3(0.186937, 0.0, 0.0),
vec3(0.700542, 0.0, 0.0),
vec3(-0.864858, -0.481795, -0.111713),
vec3(-0.624773, 0.102853, -0.730153),
vec3(-0.387172, 0.260319, 0.007229),
vec3(-0.222367, -0.642631, -0.707697),
vec3(-0.01336, -0.014956, 0.169662),
vec3(0.122575, 0.1544, -0.456944),
vec3(-0.177141, 0.85997, -0.42346),
vec3(-0.131631, 0.814545, 0.524355),
vec3(-0.779469, 0.007991, 0.624833),
vec3(0.308092, 0.209288,0.35969),
vec3(0.359331, -0.184533, -0.377458),
vec3(0.192633, -0.482999, -0.065284),
vec3(0.233538, 0.293706, -0.055139),
vec3(0.417709, -0.386701, 0.442449)
);
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn - bias, 0.0);
}`),e.code.add(E`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),t.outputs.add("fragOcclusion","float"),e.uniforms.add(new zt("normalMap",i=>i.normalTexture),new zt("depthMap",i=>i.depthTexture),new ut("projScale",i=>i.projScale),new zt("rnm",i=>i.noiseTexture),new ll("rnmScale",(i,r)=>Cr(Vge,r.camera.fullWidth/i.noiseTexture.descriptor.width,r.camera.fullHeight/i.noiseTexture.descriptor.height)),new ut("intensity",i=>i.intensity),new Sy("screenSize",i=>Cr(Vge,i.camera.fullWidth,i.camera.fullHeight))).main.add(E`
    float depth = depthFromTexture(depthMap, uv);

    // Early out if depth is out of range, such as in the sky
    if (depth >= 1.0 || depth <= 0.0) {
      fragOcclusion = 1.0;
      return;
    }

    // get the normal of current fragment
    ivec2 iuv = ivec2(uv * vec2(textureSize(normalMap, 0)));
    vec4 norm4 = texelFetch(normalMap, iuv, 0);
    if(norm4.a != 1.0) {
      fragOcclusion = 1.0;
      return;
    }
    vec3 norm = normalize(norm4.xyz * 2.0 - 1.0);

    float currentPixelDepth = linearizeDepth(depth);
    vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy, currentPixelDepth);

    float sum = 0.0;
    vec3 tapPixelPos;

    vec3 fres = normalize(2.0 * texture(rnm, uv * rnmScale).xyz - 1.0);

    // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
    // bug or deviation from CE somewhere else?
    float ps = projScale / (2.0 * currentPixelPos.z * zScale.x + zScale.y);

    for(int i = 0; i < ${E.int(Nge)}; ++i) {
      vec2 unitOffset = reflect(sphere[i], fres).xy;
      vec2 offset = vec2(-unitOffset * radius * ps);

      // don't use current or very nearby samples
      if( abs(offset.x) < 2.0 || abs(offset.y) < 2.0){
        continue;
      }

      vec2 tc = vec2(gl_FragCoord.xy + offset);
      if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
      vec2 tcTap = tc / screenSize;
      float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap);

      tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

      sum += aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
    }

    // output the result
    float A = max(1.0 - sum * intensity / float(${E.int(Nge)}), 0.0);

    // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4) / 2.2
    A = (pow(A, 0.2) + 1.2 * A * A * A * A) / 2.2;

    fragOcclusion = A;
  `),t}function L8(t){return Math.max(10,20*t.computeScreenPixelSizeAtDist(Math.abs(4*t.relativeElevation)))}const Vge=pt(),G0t=Object.freeze(Object.defineProperty({__proto__:null,build:_De,getRadius:L8},Symbol.toStringTag,{value:"Module"}));let Uge=class extends Vi{constructor(e,i){super(e,i,new Ii(G0t,()=>te(()=>Promise.resolve().then(()=>Rkt),void 0)),Qs)}initializePipeline(){return li({colorWrite:$i})}};const VO=2;let RT=class extends Nl{constructor(e){super(e),this.consumes={required:["normals"]},this.produces=ht.SSAO,this.isEnabled=()=>!1,this._enableTime=0,this._passParameters=new V0t,this._drawParameters=new B0t}initialize(){const e=Uint8Array.from(atob(F0t),r=>r.charCodeAt(0)),i=new Zi(32);i.wrapMode=33071,i.pixelFormat=6407,i.wrapMode=10497,i.hasMipmap=!0,this._passParameters.noiseTexture=new Fi(this.renderingContext,i,e),this.techniques.precompile(Uge),this.techniques.precompile(kge),this.addHandles(K(()=>this.isEnabled(),()=>this._enableTime=0))}destroy(){this._passParameters.noiseTexture=Rt(this._passParameters.noiseTexture)}render(e){const i=e.find(({name:D})=>D==="normals"),r=i?.getTexture(),s=i?.getTexture(Ba);if(!r||!s)return;const n=this.techniques.get(Uge),a=this.techniques.get(kge);if(!n.compiled||!a.compiled)return this._enableTime=performance.now(),void this.requestRender(1);this._enableTime===0&&(this._enableTime=performance.now());const o=this.renderingContext,l=this.view.qualitySettings.fadeDuration,c=this.bindParameters,h=c.camera,f=h.relativeElevation,y=Se((uV-f)/(uV-gDe),0,1),_=l>0?Math.min(l,performance.now()-this._enableTime)/l:1,w=_*y;this._passParameters.normalTexture=r,this._passParameters.depthTexture=s,this._passParameters.projScale=1/h.computeScreenPixelSizeAtDist(1),this._passParameters.intensity=4*H0t/L8(h)**6*w;const x=h.fullViewport[2],S=h.fullViewport[3],$=this.fboCache.acquire(x,S,"ssao input",2);o.bindFramebuffer($.fbo),o.setViewport(0,0,x,S),o.bindTechnique(n,c,this._passParameters,this._drawParameters),o.screen.draw();const A=Math.round(x/VO),M=Math.round(S/VO),P=this.fboCache.acquire(A,M,"ssao blur",0);o.bindFramebuffer(P.fbo),this._drawParameters.colorTexture=$.getTexture(),Cr(this._drawParameters.blurSize,0,VO/S),o.bindTechnique(a,c,this._passParameters,this._drawParameters),o.setViewport(0,0,A,M),o.screen.draw(),$.release();const O=this.fboCache.acquire(A,M,ht.SSAO,0);return o.bindFramebuffer(O.fbo),o.setViewport(0,0,x,S),o.setClearColor(1,1,1,0),o.clear(16384),this._drawParameters.colorTexture=P.getTexture(),Cr(this._drawParameters.blurSize,VO/x,0),o.bindTechnique(a,c,this._passParameters,this._drawParameters),o.setViewport(0,0,A,M),o.screen.draw(),o.setViewport4fv(h.fullViewport),P.release(),_<1&&this.requestRender(2),O}};d([m()],RT.prototype,"consumes",void 0),d([m()],RT.prototype,"produces",void 0),d([m({constructOnly:!0})],RT.prototype,"isEnabled",void 0),RT=d([k("esri.views.3d.webgl-engine.effects.ssao.SSAO")],RT);const H0t=.5;function k8(t,e){e.receiveAmbientOcclusion?(t.uniforms.add(new po("ssaoTex",i=>i.ssao?.getTexture())),t.constants.add("blurSizePixelsInverse","float",1/VO),t.code.add(E`float evaluateAmbientOcclusionInverse() {
vec2 ssaoTextureSizeInverse = 1.0 / vec2(textureSize(ssaoTex, 0));
return texture(ssaoTex, gl_FragCoord.xy * blurSizePixelsInverse * ssaoTextureSizeInverse).r;
}
float evaluateAmbientOcclusion() {
return 1.0 - evaluateAmbientOcclusionInverse();
}`)):t.code.add(E`float evaluateAmbientOcclusionInverse() { return 1.0; }
float evaluateAmbientOcclusion() { return 0.0; }`)}function vDe(t,e){const i=t.fragment,r=e.lightingSphericalHarmonicsOrder!==void 0?e.lightingSphericalHarmonicsOrder:2;r===0?(i.uniforms.add(new co("lightingAmbientSH0",({lighting:s})=>ve(Bge,s.sh.r[0],s.sh.g[0],s.sh.b[0]))),i.code.add(E`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):r===1?(i.uniforms.add(new ao("lightingAmbientSH_R",({lighting:s})=>yr(Lm,s.sh.r[0],s.sh.r[1],s.sh.r[2],s.sh.r[3])),new ao("lightingAmbientSH_G",({lighting:s})=>yr(Lm,s.sh.g[0],s.sh.g[1],s.sh.g[2],s.sh.g[3])),new ao("lightingAmbientSH_B",({lighting:s})=>yr(Lm,s.sh.b[0],s.sh.b[1],s.sh.b[2],s.sh.b[3]))),i.code.add(E`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):r===2&&(i.uniforms.add(new co("lightingAmbientSH0",({lighting:s})=>ve(Bge,s.sh.r[0],s.sh.g[0],s.sh.b[0])),new ao("lightingAmbientSH_R1",({lighting:s})=>yr(Lm,s.sh.r[1],s.sh.r[2],s.sh.r[3],s.sh.r[4])),new ao("lightingAmbientSH_G1",({lighting:s})=>yr(Lm,s.sh.g[1],s.sh.g[2],s.sh.g[3],s.sh.g[4])),new ao("lightingAmbientSH_B1",({lighting:s})=>yr(Lm,s.sh.b[1],s.sh.b[2],s.sh.b[3],s.sh.b[4])),new ao("lightingAmbientSH_R2",({lighting:s})=>yr(Lm,s.sh.r[5],s.sh.r[6],s.sh.r[7],s.sh.r[8])),new ao("lightingAmbientSH_G2",({lighting:s})=>yr(Lm,s.sh.g[5],s.sh.g[6],s.sh.g[7],s.sh.g[8])),new ao("lightingAmbientSH_B2",({lighting:s})=>yr(Lm,s.sh.b[5],s.sh.b[6],s.sh.b[7],s.sh.b[8]))),i.code.add(E`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),e.pbrMode!==1&&e.pbrMode!==2||i.code.add(E`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))}const Bge=R(),Lm=ri();function $p(t){t.uniforms.add(new co("mainLightDirection",e=>e.lighting.mainLight.direction))}function Ty(t){t.uniforms.add(new co("mainLightIntensity",e=>e.lighting.mainLight.intensity))}function W0t(t){$p(t.fragment),Ty(t.fragment),t.fragment.code.add(E`vec3 applyShading(vec3 shadingNormal, float shadow) {
float dotVal = clamp(dot(shadingNormal, mainLightDirection), 0.0, 1.0);
return mainLightIntensity * ((1.0 - shadow) * dotVal);
}`)}function Z0t(t){t.code.add(E`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG) {
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),t.code.add(E`float integratedRadiance(float cosTheta2, float roughness) {
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),t.code.add(E`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness) {
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}function M4(t){const e=3.141592653589793,i=.3183098861837907;t.constants.add("PI","float",e),t.constants.add("LIGHT_NORMALIZATION","float",i),t.constants.add("INV_PI","float",i),t.constants.add("HALF_PI","float",1.570796326794897),t.constants.add("TWO_PI","float",6.28318530717958)}function fre(t,e){t.include(M4),e.pbrMode!==1&&e.pbrMode!==2&&e.pbrMode!==5&&e.pbrMode!==6||(t.code.add(E`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),t.code.add(E`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`)),e.pbrMode!==1&&e.pbrMode!==2||(t.include(Z0t),t.code.add(E`struct PBRShadingInfo
{
float NdotV;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),t.code.add(E`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`))}function Y0t(t,e){t.include(M4),t.code.add(E`
  struct PBRShadingWater {
      float NdotL;   // cos angle between normal and light direction
      float NdotV;   // cos angle between normal and view direction
      float NdotH;   // cos angle between normal and half vector
      float VdotH;   // cos angle between view direction and half vector
      float LdotH;   // cos angle between light direction and half vector
      float VdotN;   // cos angle between view direction and normal vector
  };

  float dtrExponent = ${e.useCustomDTRExponentForWater?"2.2":"2.0"};
  `),t.code.add(E`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),t.code.add(E`float normalDistributionWater(float NdotH, float roughness) {
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),t.code.add(E`float geometricOcclusionKelemen(float LoH) {
return 0.25 / (LoH * LoH);
}`),t.code.add(E`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max) {
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze) * strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}`)}function Q0t(t,e,i){(i=i||t).length=t.length;for(let r=0;r<t.length;r++)i[r]=t[r]*e[r];return i}function Wq(t,e,i){(i=i||t).length=t.length;for(let r=0;r<t.length;r++)i[r]=t[r]*e;return i}function y$(t,e,i){(i=i||t).length=t.length;for(let r=0;r<t.length;r++)i[r]=t[r]+e[r];return i}function bDe(t){return(t+1)*(t+1)}function X0t(t){return Se(Math.floor(Math.sqrt(t)-1),0,2)}function wDe(t,e,i){const r=t[0],s=t[1],n=t[2],a=i||[];return a.length=bDe(e),e>=0&&(a[0]=.28209479177),e>=1&&(a[1]=.4886025119*r,a[2]=.4886025119*n,a[3]=.4886025119*s),e>=2&&(a[4]=1.09254843059*r*s,a[5]=1.09254843059*s*n,a[6]=.31539156525*(3*n*n-1),a[7]=1.09254843059*r*n,a[8]=.54627421529*(r*r-s*s)),a}function J0t(t,e){const i=bDe(t),r=e||{r:[],g:[],b:[]};r.r.length=r.g.length=r.b.length=i;for(let s=0;s<i;s++)r.r[s]=r.g[s]=r.b[s]=0;return r}function K0t(t,e){const i=X0t(e.r.length);for(const r of t)Gh(bX,r.direction),wDe(bX,i,Vg),Q0t(Vg,bF),Wq(Vg,r.intensity[0],DS),y$(e.r,DS),Wq(Vg,r.intensity[1],DS),y$(e.g,DS),Wq(Vg,r.intensity[2],DS),y$(e.b,DS);return e}function e_t(t,e){wDe(bX,0,Vg);for(const i of t)e.r[0]+=Vg[0]*bF[0]*i.intensity[0]*4*Math.PI,e.g[0]+=Vg[0]*bF[0]*i.intensity[1]*4*Math.PI,e.b[0]+=Vg[0]*bF[0]*i.intensity[2]*4*Math.PI;return e}function t_t(t,e,i,r){J0t(e,r),ve(i.intensity,0,0,0);let s=!1;const n=i_t,a=r_t,o=s_t;n.length=0,a.length=0,o.length=0;for(const l of t)l instanceof D6&&!s?(de(i.direction,l.direction),de(i.intensity,l.intensity),i.specularStrength=l.specularStrength,i.environmentStrength=l.environmentStrength,i.castShadows=l.castShadows,s=!0):l instanceof D6||l instanceof NOe?n.push(l):l instanceof wie?a.push(l):l instanceof VOe&&o.push(l);K0t(n,r),e_t(a,r);for(const l of o)y$(r.r,l.r),y$(r.g,l.g),y$(r.b,l.b)}const i_t=[],r_t=[],s_t=[],Vg=[0],DS=[0],bX=R(),bF=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];let jge=class{constructor(){this.color=R(),this.intensity=1}},n_t=class{constructor(){this.direction=R(),this.ambient=new jge,this.diffuse=new jge}};const xDe=.4;let Zq=class{constructor(){this._shOrder=2,this._legacy=new n_t,this.globalFactor=.5,this.noonFactor=.5,this._sphericalHarmonics=new VOe,this._mainLight=new D6(R(),Ge(1,0,0),!1)}get legacy(){return this._legacy}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}set(e){t_t(e,this._shOrder,this._mainLight,this._sphericalHarmonics),this.updateLegacy()}updateLegacy(){de(this._legacy.direction,this._mainLight.direction);const e=1/Math.PI;this._legacy.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*e,this._legacy.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*e,this._legacy.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*e,le(this._legacy.diffuse.color,this._mainLight.intensity,e),de(IL,this._legacy.diffuse.color),le(IL,IL,xDe*this.globalFactor),xe(this._legacy.ambient.color,this._legacy.ambient.color,IL)}copyFrom(e){this._sphericalHarmonics.r=Array.from(e.sh.r),this._sphericalHarmonics.g=Array.from(e.sh.g),this._sphericalHarmonics.b=Array.from(e.sh.b),de(this._mainLight.direction,e.mainLight.direction),de(this._mainLight.intensity,e.mainLight.intensity),this._mainLight.castShadows=e.mainLight.castShadows,this._mainLight.specularStrength=e.mainLight.specularStrength,this._mainLight.environmentStrength=e.mainLight.environmentStrength,this.globalFactor=e.globalFactor,this.noonFactor=e.noonFactor}lerpLighting(e,i,r){if(Wi(this._mainLight.intensity,e.mainLight.intensity,i.mainLight.intensity,r),this._mainLight.environmentStrength=ft(e.mainLight.environmentStrength,i.mainLight.environmentStrength,r),this._mainLight.specularStrength=ft(e.mainLight.specularStrength,i.mainLight.specularStrength,r),de(this._mainLight.direction,i.mainLight.direction),this._mainLight.castShadows=i.mainLight.castShadows,this.globalFactor=ft(e.globalFactor,i.globalFactor,r),this.noonFactor=ft(e.noonFactor,i.noonFactor,r),e.sh.r.length===i.sh.r.length)for(let s=0;s<i.sh.r.length;s++)this._sphericalHarmonics.r[s]=ft(e.sh.r[s],i.sh.r[s],r),this._sphericalHarmonics.g[s]=ft(e.sh.g[s],i.sh.g[s],r),this._sphericalHarmonics.b[s]=ft(e.sh.b[s],i.sh.b[s],r);else for(let s=0;s<i.sh.r.length;s++)this._sphericalHarmonics.r[s]=i.sh.r[s],this._sphericalHarmonics.g[s]=i.sh.g[s],this._sphericalHarmonics.b[s]=i.sh.b[s];this.updateLegacy()}};const IL=R();function a_t(t){t.code.add(E`float mapChannel(float x, vec2 p) {
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),t.code.add(E`vec3 blackLevelSoftCompression(vec3 color, float averageAmbientRadiance) {
vec2 p = vec2(0.02, 0.0075) * averageAmbientRadiance;
return vec3(mapChannel(color.x, p), mapChannel(color.y, p), mapChannel(color.z, p));
}`)}function EM(t){t.code.add(E`vec3 tonemapACES(vec3 x) {
return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
}`)}function z8(t){t.constants.add("ambientBoostFactor","float",xDe)}function GC(t){t.uniforms.add(new ws("lightingGlobalFactor",e=>e.lighting.globalFactor))}function HC(t,e){const i=t.fragment,{pbrMode:r,spherical:s,hasColorTexture:n}=e;i.include(k8,e),r!==0&&i.include(fre,e),t.include(vDe,e),i.include(M4),i.include(EM,e);const a=!(r===2&&!n);switch(a&&i.include(a_t),i.code.add(E`
    const float GAMMA_SRGB = ${E.float(DC)};
    const float INV_GAMMA_SRGB = 0.4761904;
    ${_e(r!==0,"const float GROUND_REFLECTANCE = 0.2;")}
  `),z8(i),GC(i),$p(i),i.code.add(E`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${s?E`normalize(vPosWorld)`:E`vec3(0.0, 0.0, 1.0)`}, mainLightDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `),Ty(i),i.code.add(E`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * mainLightIntensity;
}`),r){case 0:case 4:case 3:t.include(W0t),i.code.add(E`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight) {
vec3 mainLighting = applyShading(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`);break;case 1:case 2:i.code.add(E`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight,
vec3 viewDir, vec3 groundNormal, vec3 mrr, float additionalAmbientIrradiance) {
vec3 viewDirection = -viewDir;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotNG = clamp(dot(normal, groundNormal), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, groundNormal), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),i.code.add(E`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),e.useFillLights?i.uniforms.add(new rV("hasFillLights",o=>o.enableFillLights)):i.constants.add("hasFillLights","bool",!1),i.code.add(E`vec3 ambientDir = vec3(5.0 * groundNormal[1] - groundNormal[0] * groundNormal[2], - 5.0 * groundNormal[0] - groundNormal[2] * groundNormal[1], groundNormal[1] * groundNormal[1] + groundNormal[0] * groundNormal[0]);
ambientDir = ambientDir != vec3(0.0) ? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
float NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
vec3 mainLightIrradianceComponent = NdotL * (1.0 - shadow) * mainLightIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * mainLightIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),i.uniforms.add(new ws("lightingSpecularStrength",o=>o.lighting.mainLight.specularStrength),new ws("lightingEnvironmentStrength",o=>o.lighting.mainLight.environmentStrength)).code.add(E`vec3 horizonRingDir = inputs.RdotNG * groundNormal - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
float NdotH = clamp(dot(normal, h), 0.0, 1.0);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(NdotH, inputs.roughness) * mainLightIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * mainLightIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
float normalDirectionModifier = mix(1., min(mix(0.1, 2.0, (inputs.NdotNG + 1.) * 0.5), 1.0), clamp(inputs.roughness * 5.0, 0.0 , 1.0));
inputs.skyRadianceToSurface = (ambientLightRadianceComponent + horizonLightRadianceComponent) * normalDirectionModifier + mainLightRadianceComponent;
inputs.groundRadianceToSurface = 0.5 * GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) * normalDirectionModifier + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE);`),i.code.add(E`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent;
        ${a?E`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`:E`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `);break;case 5:case 6:$p(i),Ty(i),i.code.add(E`const float roughnessTerrain = 0.5;
const float specularityTerrain = 0.5;
const vec3 fresnelReflectionTerrain = vec3(0.04);
vec3 evaluatePBRSimplifiedLighting(vec3 n, vec3 c, float shadow, float ssao, vec3 al, vec3 vd, vec3 nup) {
vec3 viewDirection = -vd;
vec3 h = normalize(viewDirection + mainLightDirection);
float NdotL = clamp(dot(n, mainLightDirection), 0.001, 1.0);
float NdotV = clamp(abs(dot(n, viewDirection)), 0.001, 1.0);
float NdotH = clamp(dot(n, h), 0.0, 1.0);
float NdotNG = clamp(dot(n, nup), -1.0, 1.0);
vec3 albedoLinear = pow(c, vec3(GAMMA_SRGB));
float lightness = 0.3 * albedoLinear[0] + 0.5 * albedoLinear[1] + 0.2 * albedoLinear[2];
vec3 f0 = (0.85 * lightness + 0.15) * fresnelReflectionTerrain;
vec3 f90 =  vec3(clamp(dot(f0, vec3(50.0 * 0.33)), 0.0, 1.0));
vec3 mainLightIrradianceComponent = (1. - shadow) * NdotL * mainLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(n, ssao) + al;
vec3 ambientSky = ambientLightIrradianceComponent + mainLightIrradianceComponent;
vec3 indirectDiffuse = ((1.0 - NdotNG) * mainLightIrradianceComponent + (1.0 + NdotNG ) * ambientSky) * 0.5;
vec3 outDiffColor = albedoLinear * (1.0 - f0) * indirectDiffuse / PI;
vec3 mainLightRadianceComponent = normalDistribution(NdotH, roughnessTerrain) * mainLightIntensity;
vec2 dfg = prefilteredDFGAnalytical(roughnessTerrain, NdotV);
vec3 specularColor = f0 * dfg.x + f90 * dfg.y;
vec3 specularComponent = specularityTerrain * specularColor * mainLightRadianceComponent;
vec3 outColorLinear = outDiffColor + specularComponent;
vec3 outColor = pow(outColorLinear, vec3(INV_GAMMA_SRGB));
return outColor;
}`)}}function o_t(t,e){const i=t.fragment;switch(i.code.add(E`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`),e.doubleSidedMode){case 0:i.code.add(E`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case 1:i.code.add(E`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case 2:i.code.add(E`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:e.doubleSidedMode;case 3:}}function mre(t,e){const i=e.pbrMode,r=t.fragment;if(i!==2&&i!==0&&i!==1)return void r.code.add(E`void applyPBRFactors() {}`);if(i===0)return void r.code.add(E`void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`);if(i===2)return void r.code.add(E`vec3 mrr = vec3(0.0, 0.6, 0.2);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`);const{hasMetallicRoughnessTexture:s,hasMetallicRoughnessTextureTransform:n,hasOcclusionTexture:a,hasOcclusionTextureTransform:o,bindType:l}=e;(s||a)&&t.include(D8,e),r.code.add(E`vec3 mrr;
float occlusion;`),s&&r.uniforms.add(l===1?new zt("texMetallicRoughness",c=>c.textureMetallicRoughness):new Dv("texMetallicRoughness",c=>c.textureMetallicRoughness)),a&&r.uniforms.add(l===1?new zt("texOcclusion",c=>c.textureOcclusion):new Dv("texOcclusion",c=>c.textureOcclusion)),r.uniforms.add(l===1?new _r("mrrFactors",c=>c.mrrFactors):new Zh("mrrFactors",c=>c.mrrFactors)),r.code.add(E`
    ${_e(s,E`void applyMetallicRoughness(vec2 uv) {
            vec3 metallicRoughness = textureLookup(texMetallicRoughness, uv).rgb;
            mrr[0] *= metallicRoughness.b;
            mrr[1] *= metallicRoughness.g;
          }`)}

    ${_e(a,"void applyOcclusion(vec2 uv) { occlusion *= textureLookup(texOcclusion, uv).r; }")}

    float getBakedOcclusion() {
      return ${a?"occlusion":"1.0"};
    }

    void applyPBRFactors() {
      mrr = mrrFactors;
      occlusion = 1.0;

      ${_e(s,`applyMetallicRoughness(${n?"metallicRoughnessUV":"vuv0"});`)}
      ${_e(a,`applyOcclusion(${o?"occlusionUV":"vuv0"});`)}
    }
  `)}function l_t(t,e){const i=ds(e.output)&&e.receiveShadows;i&&lDe(t,!0),t.vertex.code.add(E`
    void forwardLinearDepthToReadShadowMap() { ${_e(i,"forwardLinearDepth(gl_Position.w);")} }
  `)}let c_t=class extends Ni{constructor(e,i,r,s){super(e,"mat4",2,(n,a,o,l)=>n.setUniformMatrices4fv(e,i(a,o,l),s),r)}},u_t=class extends Ni{constructor(e,i,r,s){super(e,"mat4",1,(n,a,o)=>n.setUniformMatrices4fv(e,i(a,o),s),r)}};function SDe(t){t.fragment.uniforms.add(new u_t("shadowMapMatrix",(e,i)=>i.shadowMap.getShadowMapMatrices(e.origin),4)),TDe(t)}function h_t(t){t.fragment.uniforms.add(new c_t("shadowMapMatrix",(e,i)=>i.shadowMap.getShadowMapMatrices(e.origin),4)),TDe(t)}function TDe(t){const{fragment:e}=t;e.uniforms.add(new ao("cascadeDistances",i=>i.shadowMap.cascadeDistances),new aRe("numCascades",i=>i.shadowMap.numCascades)),e.code.add(E`const vec3 invalidShadowmapUVZ = vec3(0.0, 0.0, -1.0);
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, ivec2 textureSize, vec3 lvpos) {
float xScale = float(textureSize.y) / float(textureSize.x);
return vec2((float(i) + lvpos.x) * xScale, lvpos.y);
}
vec3 calculateUVZShadow(in vec3 _worldPos, in float _linearDepth, in ivec2 shadowMapSize) {
int i = _linearDepth < cascadeDistances[1] ? 0 : _linearDepth < cascadeDistances[2] ? 1 : _linearDepth < cascadeDistances[3] ? 2 : 3;
if (i >= numCascades) {
return invalidShadowmapUVZ;
}
mat4 shadowMatrix = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];
vec3 lvpos = lightSpacePosition(_worldPos, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
return invalidShadowmapUVZ;
}
vec2 uvShadow = cascadeCoordinates(i, shadowMapSize, lvpos);
return vec3(uvShadow, lvpos.z);
}`)}function gre(t){t.fragment.code.add(E`float readShadowMapUVZ(vec3 uvzShadow, sampler2DShadow _shadowMap) {
return texture(_shadowMap, uvzShadow);
}`)}let hV=class extends Ni{constructor(e,i){super(e,"sampler2DShadow",0,(r,s)=>r.bindTexture(e,i(s)))}},yre=class extends hr{constructor(){super(...arguments),this.origin=R()}};function _re(t,e){e.receiveShadows&&t.include(SDe),$De(t,e)}function vre(t,e){e.receiveShadows&&t.include(h_t),$De(t,e)}function $De(t,e){t.fragment.uniforms.add(new ws("lightingGlobalFactor",s=>s.lighting.globalFactor));const{receiveShadows:i,spherical:r}=e;t.include(l_t,e),i&&d_t(t),t.fragment.code.add(E`
    float readShadow(float additionalAmbientScale, vec3 vpos) {
      return ${i?"max(lightingGlobalFactor * (1.0 - additionalAmbientScale), readShadowMap(vpos, linearDepth))":_e(r,"lightingGlobalFactor * (1.0 - additionalAmbientScale)","0.0")};
    }
  `)}function d_t(t){t.include(gre),t.fragment.uniforms.add(new hV("shadowMap",({shadowMap:e})=>e.depthTexture)).code.add(E`float readShadowMap(const in vec3 _worldPos, float _linearDepth) {
vec3 uvzShadow = calculateUVZShadow(_worldPos, _linearDepth, textureSize(shadowMap,0));
if (uvzShadow.z < 0.0) {
return 0.0;
}
return readShadowMapUVZ(uvzShadow, shadowMap);
}`)}function p_t(t,e){e.hasColorTextureTransform?(t.varyings.add("colorUV","vec2"),t.vertex.uniforms.add(new Ap("colorTextureTransformMatrix",i=>i.colorTextureTransformMatrix??r2)).code.add(E`void forwardColorUV(){
colorUV = (colorTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(E`void forwardColorUV(){}`)}function f_t(t,e){e.hasNormalTextureTransform&&e.textureCoordinateType!==0?(t.varyings.add("normalUV","vec2"),t.vertex.uniforms.add(new Ap("normalTextureTransformMatrix",i=>i.normalTextureTransformMatrix??r2)).code.add(E`void forwardNormalUV(){
normalUV = (normalTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(E`void forwardNormalUV(){}`)}function m_t(t,e){e.hasEmissionTextureTransform&&e.textureCoordinateType!==0?(t.varyings.add("emissiveUV","vec2"),t.vertex.uniforms.add(new Ap("emissiveTextureTransformMatrix",i=>i.emissiveTextureTransformMatrix??r2)).code.add(E`void forwardEmissiveUV(){
emissiveUV = (emissiveTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(E`void forwardEmissiveUV(){}`)}function g_t(t,e){e.hasOcclusionTextureTransform&&e.textureCoordinateType!==0?(t.varyings.add("occlusionUV","vec2"),t.vertex.uniforms.add(new Ap("occlusionTextureTransformMatrix",i=>i.occlusionTextureTransformMatrix??r2)).code.add(E`void forwardOcclusionUV(){
occlusionUV = (occlusionTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(E`void forwardOcclusionUV(){}`)}function y_t(t,e){e.hasMetallicRoughnessTextureTransform&&e.textureCoordinateType!==0?(t.varyings.add("metallicRoughnessUV","vec2"),t.vertex.uniforms.add(new Ap("metallicRoughnessTextureTransformMatrix",i=>i.metallicRoughnessTextureTransformMatrix??r2)).code.add(E`void forwardMetallicRoughnessUV(){
metallicRoughnessUV = (metallicRoughnessTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(E`void forwardMetallicRoughnessUV(){}`)}function bre(t){t.include(MM),t.code.add(E`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in macOS using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${E.int(1)}) {
        return allMixed;
      }
      if (mode == ${E.int(2)}) {
        return internalMixed;
      }
      if (mode == ${E.int(3)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in macOS using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${E.int(2)}) {
        return internalMixed;
      }
      if (mode == ${E.int(3)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)}function wre(t,e){e.snowCover&&(t.uniforms.add(new ws("snowCover",i=>i.snowCover)).code.add(E`float getSnow(vec3 normal, vec3 groundNormal) {
return smoothstep(0.5, 0.55, dot(normal, groundNormal)) * snowCover;
}
float getRealisticTreeSnow(vec3 faceNormal, vec3 shadingNormal, vec3 groundNormal) {
float snow = min(1.0, smoothstep(0.5, 0.55, dot(faceNormal, groundNormal)) +
smoothstep(0.5, 0.55, dot(-faceNormal, groundNormal)) +
smoothstep(0.0, 0.1, dot(shadingNormal, groundNormal)));
return snow * snowCover;
}`),t.code.add(E`vec3 applySnowToMRR(vec3 mrr, float snow) {
return mix(mrr, vec3(0.0, 1.0, 0.04), snow);
}`))}function t1(t){t.code.add(E`
    const float GAMMA = ${E.float(DC)};
    const float INV_GAMMA = ${E.float(1/DC)};

    vec4 delinearizeGamma(vec4 color) {
      return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.a);
    }

    vec3 linearizeGamma(vec3 color) {
      return pow(color, vec3(GAMMA));
    }
  `)}const __t=1,v_t=1;function b_t(t,e){if(!ds(e.output))return;t.fragment.include(t1);const{emissionSource:i,hasEmissiveTextureTransform:r,bindType:s}=e,n=i===3||i===4||i===5;n&&(t.include(D8,e),t.fragment.uniforms.add(s===1?new zt("texEmission",f=>f.textureEmissive):new Dv("texEmission",f=>f.textureEmissive)));const a=i===2||n;a&&t.fragment.uniforms.add(s===1?new _r("emissiveBaseColor",f=>f.emissiveBaseColor):new Zh("emissiveBaseColor",f=>f.emissiveBaseColor));const o=i!==0;o&&!(i===7||i===6||i===4||i===5)&&t.fragment.uniforms.add(s===1?new ut("emissiveStrength",f=>f.emissiveStrength):new R8("emissiveStrength",f=>f.emissiveStrength));const l=i===7,c=i===5,h=i===1||i===6||l;t.fragment.code.add(E`
    vec4 getEmissions(vec3 symbolColor) {
      vec4 emissions = ${a?c?"emissiveSource == 0 ? vec4(emissiveBaseColor, 1.0): vec4(linearizeGamma(symbolColor), 1.0)":"vec4(emissiveBaseColor, 1.0)":h?l?"emissiveSource == 0 ? vec4(0.0): vec4(linearizeGamma(symbolColor), 1.0)":"vec4(linearizeGamma(symbolColor), 1.0)":"vec4(0.0)"};
      ${_e(n,`${_e(c,`if(emissiveSource == 0) {
              vec4 emissiveFromTex = textureLookup(texEmission, ${r?"emissiveUV":"vuv0"});
              emissions *= vec4(linearizeGamma(emissiveFromTex.rgb), emissiveFromTex.a);
           }`,`vec4 emissiveFromTex = textureLookup(texEmission, ${r?"emissiveUV":"vuv0"});
           emissions *= vec4(linearizeGamma(emissiveFromTex.rgb), emissiveFromTex.a);`)}
        emissions.w = emissions.rgb == vec3(0.0) ? 0.0: emissions.w;`)}
      ${_e(o,`emissions.rgb *= emissiveStrength * ${E.float(v_t)};`)}
      return emissions;
    }
  `)}function F8(t,e){t.include(CM,e),t.include(b_t,e),t.fragment.include(MM);const{output:i,oitPass:r,discardInvisibleFragments:s,snowCover:n}=e,a=i===10,o=u$(i),l=ds(i)&&r===1,c=ds(i)&&r!==1;let h=0;(c||o||l)&&t.outputs.add("fragColor","vec4",h++),o&&t.outputs.add("fragEmission","vec4",h++),l&&t.outputs.add("fragAlpha","float",h++),t.fragment.code.add(E`
    void outputColorHighlightOID(vec4 finalColor, const in vec3 vWorldPosition, vec3 emissiveSymbolColor ${_e(n,", float snow")}) {
      ${_e(a,"finalColor.a = 1.0;")}

      ${_e(s,`if (finalColor.a < ${E.float(Gr)}) { discard; }`)}

      finalColor = applySlice(finalColor, vWorldPosition);
      ${_e(l,E`fragColor = premultiplyAlpha(finalColor);
             fragAlpha = finalColor.a;`)}
      ${_e(c,"fragColor = finalColor;")}
      ${_e(o,`fragEmission = ${_e(n,"mix(finalColor.a * getEmissions(emissiveSymbolColor), vec4(0.0), snow);","finalColor.a * getEmissions(emissiveSymbolColor);")}`)}
      calculateOcclusionAndOutputHighlight();
      ${_e(a,"outputObjectAndLayerIdColor();")}
    }
  `)}function CDe(t){const e=new Di,{attributes:i,vertex:r,fragment:s,varyings:n}=e,{output:a,normalType:o,offsetBackfaces:l,spherical:c,snowCover:h,pbrMode:f,textureAlphaPremultiplied:y,instancedDoublePrecision:_,hasVertexColors:w,hasVertexTangents:x,hasColorTexture:S,hasNormalTexture:$,hasNormalTextureTransform:A,hasColorTextureTransform:M}=t;if(jg(r,t),i.add("position","vec3"),n.add("vpos","vec3",{invariant:!0}),e.include(Rw,t),e.include(hDe,t),e.include(qPe,t),e.include(p_t,t),!ds(a))return e.include(fDe,t),e;e.include(f_t,t),e.include(m_t,t),e.include(g_t,t),e.include(y_t,t),xy(r,t),e.include(C4,t),e.include(k_);const P=o===0||o===1;return P&&l&&e.include(aDe),e.include(mDe,t),e.include(O8,t),e.include(uDe,t),n.add("vPositionLocal","vec3"),e.include(Gg,t),e.include(dDe,t),e.include(P8,t),r.uniforms.add(new Xn("externalColor",O=>O.externalColor,{supportsNaN:!0})),n.add("vcolorExt","vec4"),e.include(T4,t),r.include(Kv),r.include(Zie),e.include(_?_re:vre,t),r.main.add(E`
    forwardNormalizedVertexColor();

    MaskedColor maskedColor =
      applySymbolColor(applyVVColor(applyInstanceColor(createMaskedFromNaNColor(externalColor))));

    vcolorExt = maskedColor.color;
    forwardColorMixMode(maskedColor.mask);

    vpos = getVertexInLocalOriginSpace();
    vPositionLocal = vpos - view[3].xyz;
    vpos = subtractOrigin(vpos);
    ${_e(P,"vNormalWorld = dpNormal(vvLocalNormal(normalModel()));")}
    vpos = addVerticalOffset(vpos, localOrigin);
    ${_e(x,"vTangent = dpTransformVertexTangent(tangent);")}
    gl_Position = transformPosition(proj, view, vpos);
    ${_e(P&&l,"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);")}

    forwardViewPosDepth((view * vec4(vpos, 1.0)).xyz);
    forwardTextureCoordinates();
    forwardColorUV();
    forwardNormalUV();
    forwardEmissiveUV();
    forwardOcclusionUV();
    forwardMetallicRoughnessUV();

    if (opacityMixMode != ${E.int(nR.ignore)} && vcolorExt.a < ${E.float(Gr)}) {
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
    }
    forwardLinearDepthToReadShadowMap();
  `),e.include(HC,t),s.include(k8,t),e.include(C3,t),s.include(I_,t),e.include(F8,t),xy(s,t),s.uniforms.add(r.uniforms.get("localOrigin"),new _r("ambient",O=>O.ambient),new _r("diffuse",O=>O.diffuse),new ut("opacity",O=>O.opacity),new ut("layerOpacity",O=>O.layerOpacity)),S&&s.uniforms.add(new zt("tex",O=>O.texture)),e.include(mre,t),s.include(fre,t),s.include(bre),e.include(o_t,t),s.include(wre,t),z8(s),GC(s),Ty(s),s.main.add(E`
    discardBySlice(vpos);
    discardByTerrainDepth();
    ${S?E`
            vec4 texColor = texture(tex, ${M?"colorUV":"vuv0"});
            ${_e(y,"texColor.rgb /= texColor.a;")}
            discardOrAdjustAlpha(texColor);`:E`vec4 texColor = vec4(1.0);`}
    shadingParams.viewDirection = normalize(vpos - cameraPosition);
    ${o===2?E`vec3 normal = screenDerivativeNormal(vPositionLocal);`:E`shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
    applyPBRFactors();
    float ssao = evaluateAmbientOcclusionInverse() * getBakedOcclusion();

    vec3 posWorld = vpos + localOrigin;

    float additionalAmbientScale = additionalDirectedAmbientLight(posWorld);
    float shadow = readShadow(additionalAmbientScale, vpos);

    vec3 matColor = max(ambient, diffuse);
    vec3 albedo = mixExternalColor(${_e(w,"vColor.rgb *")} matColor, texColor.rgb, vcolorExt.rgb, colorMixMode);
    float opacity_ = layerOpacity * mixExternalOpacity(${_e(w,"vColor.a * ")} opacity, texColor.a, vcolorExt.a, opacityMixMode);

    ${$?`mat3 tangentSpace = computeTangentSpace(${x?"normal":"normal, vpos, vuv0"});
            vec3 shadingNormal = computeTextureNormal(tangentSpace, ${A?"normalUV":"vuv0"});`:"vec3 shadingNormal = normal;"}
    vec3 normalGround = ${c?"normalize(posWorld);":"vec3(0.0, 0.0, 1.0);"}

    ${_e(h,E`
          float snow = getSnow(normal, normalGround);
          albedo = mix(albedo, vec3(1), snow);
          shadingNormal = mix(shadingNormal, normal, snow);
          ssao = mix(ssao, 1.0, snow);`)}

    vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

    ${f===1||f===2?E`
            float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
            ${_e(h,"mrr = applySnowToMRR(mrr, snow);")}
            vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, additionalAmbientIrradiance);`:E`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
    vec4 finalColor = vec4(shadedColor, opacity_);
    outputColorHighlightOID(finalColor, vpos, albedo ${_e(h,", snow")});
  `),e}const w_t=Object.freeze(Object.defineProperty({__proto__:null,build:CDe},Symbol.toStringTag,{value:"Module"}));let x_t=class extends iDe{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=nDe,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType="normal",this.cullFace=2,this.instanced=!1,this.instancedFeatureAttribute=!1,this.instancedColor=!1,this.instanceColorEncodesAlphaIgnore=!1,this.emissiveStrength=0,this.emissiveSource=1,this.emissiveBaseColor=Kn,this.instancedDoublePrecision=!1,this.normalType=0,this.receiveShadows=!0,this.receiveAmbientOcclusion=!0,this.castShadows=!0,this.ambient=bv(.2,.2,.2),this.diffuse=bv(.8,.8,.8),this.externalColor=fi(1,1,1,1),this.colorMixMode="multiply",this.opacity=1,this.layerOpacity=1,this.origin=R(),this.hasSlicePlane=!1,this.offsetTransparentBackfaces=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.modelTransformation=null,this.drivenOpacity=!1,this.writeDepth=!0,this.customDepthTest=0,this.textureAlphaMode=0,this.textureAlphaCutoff=Gr,this.textureAlphaPremultiplied=!1,this.renderOccluded=1,this.isDecoration=!1}get hasVVSize(){return!!this.vvSize}get hasVVColor(){return!!this.vvColor}get hasVVOpacity(){return!!this.vvOpacity}},FWt=class extends rDe{constructor(){super(...arguments),this.origin=R(),this.slicePlaneLocalOrigin=this.origin}},MDe=class extends Vi{constructor(e,i,r=new Ii(w_t,()=>te(()=>Promise.resolve().then(()=>Dkt),void 0))){const s=[Lo(EDe(i))];i.instanced&&i.instancedDoublePrecision&&s.push(Lo(O0t(i))),super(e,i,r,c8(s))}_makePipeline(e,i){const{oitPass:r,output:s,transparent:n,cullFace:a,customDepthTest:o,hasOccludees:l}=e;return li({blending:ds(s)&&n?C8(r):null,culling:T_t(e)?MAe(a):null,depthTest:{func:Qie(r,S_t(o))},depthWrite:cRe(e),drawBuffers:sw(s,Dw(r,s)),colorWrite:$i,stencilWrite:l?lV:null,stencilTest:l?i?vX:ure:null,polygonOffset:Tmt(e)})}initializePipeline(e){return this._occludeePipelineState=this._makePipeline(e,!0),this._makePipeline(e,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}};function S_t(t){switch(t){case 1:return 515;case 0:case 3:return 513;case 2:return 516}}function T_t(t){return t.cullFace!==0||!t.hasSlicePlane&&!t.transparent&&!t.doubleSidedMode}function EDe(t){const e=jc().vec3f("position");return t.normalType===1?e.vec2i16("normalCompressed",{glNormalized:!0}):e.vec3f("normal"),t.hasVertexTangents&&e.vec4f("tangent"),t.hasTextures&&e.vec2f16("uv0"),t.hasVertexColors&&e.vec4u8("color"),t.hasSymbolColors&&e.vec4u8("symbolColor"),!t.instanced&&Jh()&&e.vec4u8("olidColor"),e}let zi=class extends op{constructor(e){super(),this.spherical=e,this.alphaDiscardMode=1,this.doubleSidedMode=0,this.pbrMode=0,this.cullFace=0,this.normalType=0,this.customDepthTest=0,this.emissionSource=0,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.hasVerticalOffset=!1,this.hasColorTexture=!1,this.hasMetallicRoughnessTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasScreenSizePerspective=!1,this.hasVertexTangents=!1,this.hasOccludees=!1,this.instanced=!1,this.instancedDoublePrecision=!1,this.hasModelTransformation=!1,this.offsetBackfaces=!1,this.hasVVSize=!1,this.hasVVColor=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.textureAlphaPremultiplied=!1,this.instancedFeatureAttribute=!1,this.instancedColor=!1,this.writeDepth=!0,this.transparent=!1,this.enableOffset=!0,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.snowCover=!1,this.hasColorTextureTransform=!1,this.hasEmissionTextureTransform=!1,this.hasNormalTextureTransform=!1,this.hasOcclusionTextureTransform=!1,this.hasMetallicRoughnessTextureTransform=!1,this.occlusionPass=!1,this.useCustomDTRExponentForWater=!1,this.useFillLights=!0,this.draped=!1}get textureCoordinateType(){return this.hasTextures?1:0}get hasTextures(){return this.hasColorTexture||this.hasNormalTexture||this.hasMetallicRoughnessTexture||this.emissionSource===3||this.hasOcclusionTexture}get hasVVInstancing(){return this.instanced}get discardInvisibleFragments(){return this.transparent}};d([oe({count:4})],zi.prototype,"alphaDiscardMode",void 0),d([oe({count:3})],zi.prototype,"doubleSidedMode",void 0),d([oe({count:7})],zi.prototype,"pbrMode",void 0),d([oe({count:3})],zi.prototype,"cullFace",void 0),d([oe({count:3})],zi.prototype,"normalType",void 0),d([oe({count:3})],zi.prototype,"customDepthTest",void 0),d([oe({count:8})],zi.prototype,"emissionSource",void 0),d([oe()],zi.prototype,"hasVertexColors",void 0),d([oe()],zi.prototype,"hasSymbolColors",void 0),d([oe()],zi.prototype,"hasVerticalOffset",void 0),d([oe()],zi.prototype,"hasColorTexture",void 0),d([oe()],zi.prototype,"hasMetallicRoughnessTexture",void 0),d([oe()],zi.prototype,"hasOcclusionTexture",void 0),d([oe()],zi.prototype,"hasNormalTexture",void 0),d([oe()],zi.prototype,"hasScreenSizePerspective",void 0),d([oe()],zi.prototype,"hasVertexTangents",void 0),d([oe()],zi.prototype,"hasOccludees",void 0),d([oe()],zi.prototype,"instanced",void 0),d([oe()],zi.prototype,"instancedDoublePrecision",void 0),d([oe()],zi.prototype,"hasModelTransformation",void 0),d([oe()],zi.prototype,"offsetBackfaces",void 0),d([oe()],zi.prototype,"hasVVSize",void 0),d([oe()],zi.prototype,"hasVVColor",void 0),d([oe()],zi.prototype,"receiveShadows",void 0),d([oe()],zi.prototype,"receiveAmbientOcclusion",void 0),d([oe()],zi.prototype,"textureAlphaPremultiplied",void 0),d([oe()],zi.prototype,"instancedFeatureAttribute",void 0),d([oe()],zi.prototype,"instancedColor",void 0),d([oe()],zi.prototype,"writeDepth",void 0),d([oe()],zi.prototype,"transparent",void 0),d([oe()],zi.prototype,"enableOffset",void 0),d([oe()],zi.prototype,"terrainDepthTest",void 0),d([oe()],zi.prototype,"cullAboveTerrain",void 0),d([oe()],zi.prototype,"snowCover",void 0),d([oe()],zi.prototype,"hasColorTextureTransform",void 0),d([oe()],zi.prototype,"hasEmissionTextureTransform",void 0),d([oe()],zi.prototype,"hasNormalTextureTransform",void 0),d([oe()],zi.prototype,"hasOcclusionTextureTransform",void 0),d([oe()],zi.prototype,"hasMetallicRoughnessTextureTransform",void 0);function ADe(t){const e=new Di,{attributes:i,vertex:r,fragment:s,varyings:n}=e,{output:a,offsetBackfaces:o,pbrMode:l,snowCover:c,spherical:h}=t,f=l===1||l===2;if(jg(r,t),i.add("position","vec3"),n.add("vpos","vec3",{invariant:!0}),e.include(Rw,t),e.include(hDe,t),e.include(qPe,t),e.include(T4,t),!ds(a))return e.include(fDe,t),e;xy(e.vertex,t),e.include(C4,t),e.include(k_),o&&e.include(aDe),n.add("vNormalWorld","vec3"),n.add("localvpos","vec3",{invariant:!0}),e.include(Gg,t),e.include(dDe,t),e.include(uDe,t),e.include(P8,t),r.include(Kv),r.include(Zie),r.uniforms.add(new Xn("externalColor",w=>w.externalColor,{supportsNaN:!0})),n.add("vcolorExt","vec4"),e.include(t.instancedDoublePrecision?_re:vre,t),r.main.add(E`
    forwardNormalizedVertexColor();

    MaskedColor maskedColorExt =
      applySymbolColor(applyVVColor(applyInstanceColor(createMaskedFromNaNColor(externalColor))));

    vcolorExt = maskedColorExt.color;
    forwardColorMixMode(maskedColorExt.mask);

    bool alphaCut = opacityMixMode != ${E.int(nR.ignore)} && vcolorExt.a < ${E.float(Gr)};
    vpos = getVertexInLocalOriginSpace();

    localvpos = vpos - view[3].xyz;
    vpos = subtractOrigin(vpos);
    vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
    vpos = addVerticalOffset(vpos, localOrigin);
    vec4 basePosition = transformPosition(proj, view, vpos);

    forwardViewPosDepth((view * vec4(vpos, 1.0)).xyz);
    forwardTextureCoordinates();
    forwardLinearDepthToReadShadowMap();
    gl_Position = alphaCut ? vec4(1e38, 1e38, 1e38, 1.0) :
    ${_e(o,"offsetBackfacingClipPosition(basePosition, vpos, vNormalWorld, cameraPosition);","basePosition;")}
  `);const{hasColorTexture:y,hasColorTextureTransform:_}=t;return e.include(HC,t),s.include(k8,t),e.include(C3,t),s.include(I_,t),e.include(F8,t),xy(s,t),$p(s),z8(s),GC(s),s.uniforms.add(r.uniforms.get("localOrigin"),r.uniforms.get("view"),new _r("ambient",w=>w.ambient),new _r("diffuse",w=>w.diffuse),new ut("opacity",w=>w.opacity),new ut("layerOpacity",w=>w.layerOpacity)),y&&s.uniforms.add(new zt("tex",w=>w.texture)),e.include(mre,t),s.include(fre,t),s.include(bre),s.include(wre,t),Ty(s),s.main.add(E`
      discardBySlice(vpos);
      discardByTerrainDepth();
      vec4 texColor = ${y?`texture(tex, ${_?"colorUV":"vuv0"})`:" vec4(1.0)"};
      ${_e(y,`${_e(t.textureAlphaPremultiplied,"texColor.rgb /= texColor.a;")}
        discardOrAdjustAlpha(texColor);`)}
      vec3 viewDirection = normalize(vpos - cameraPosition);
      applyPBRFactors();
      float ssao = evaluateAmbientOcclusionInverse();
      ssao *= getBakedOcclusion();

      float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
      vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
      float shadow = readShadow(additionalAmbientScale, vpos);
      vec3 matColor = max(ambient, diffuse);
      ${t.hasVertexColors?E`vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, colorMixMode);
             float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, opacityMixMode);`:E`vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, colorMixMode);
             float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, opacityMixMode);`}

      vec3 shadingNormal = normalize(vNormalWorld);
      vec3 groundNormal = ${h?"normalize(vpos + localOrigin)":"vec3(0.0, 0.0, 1.0)"};

      ${_e(c,`vec3 faceNormal = screenDerivativeNormal(vpos);
         float snow = getRealisticTreeSnow(faceNormal, shadingNormal, groundNormal);
         albedo = mix(albedo, vec3(1), snow);`)}

      ${E`albedo *= 1.2;
             vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
             float alignmentLightView = clamp(dot(viewForward, -mainLightDirection), 0.0, 1.0);
             float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
             float treeRadialFalloff = vColor.r;
             float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
             additionalLight += backLightFactor * mainLightIntensity;`}

      ${f?E`float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
            ${_e(c,"mrr = applySnowToMRR(mrr, snow);")}
            vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, groundNormal, mrr, additionalAmbientIrradiance);`:E`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
      vec4 finalColor = vec4(shadedColor, opacity_);
      outputColorHighlightOID(finalColor, vpos, albedo ${_e(c,", 1.0")});`),e}const $_t=Object.freeze(Object.defineProperty({__proto__:null,build:ADe},Symbol.toStringTag,{value:"Module"}));let C_t=class extends MDe{constructor(e,i){super(e,i,new Ii($_t,()=>te(()=>Promise.resolve().then(()=>Ikt),void 0)))}},ODe=class extends T8{constructor(e,i){super(e,E_t),this.materialType="default",this.supportsEdges=!0,this.intersectDraped=void 0,this.produces=new Map([[2,r=>(Y7(r)||QP(r))&&!this.transparent],[4,r=>(Y7(r)||QP(r))&&this.transparent&&this.parameters.writeDepth],[8,r=>(Y7(r)||QP(r))&&this.transparent&&!this.parameters.writeDepth]]),this._layout=EDe(this.parameters),this._configuration=new zi(i.spherical)}isVisibleForOutput(e){return e!==4&&e!==6&&e!==5||this.parameters.castShadows}get visible(){const{layerOpacity:e,colorMixMode:i,opacity:r,externalColor:s}=this.parameters;return e*(i==="replace"?1:r)*(i==="ignore"||isNaN(s[3])?1:s[3])>=Gr}get _hasEmissiveBase(){return!!this.parameters.emissiveTextureId||!si(this.parameters.emissiveBaseColor,Kn)}get hasEmissions(){return this.parameters.emissiveStrength>0&&(this.parameters.emissiveSource===0&&this._hasEmissiveBase||this.parameters.emissiveSource===1)}getConfiguration(e,i){const{parameters:r,_configuration:s}=this,{treeRendering:n,doubleSided:a,doubleSidedType:o}=r;return super.getConfiguration(e,i,this._configuration),s.hasNormalTexture=r.hasNormalTexture,s.hasColorTexture=r.hasColorTexture,s.hasMetallicRoughnessTexture=r.hasMetallicRoughnessTexture,s.hasOcclusionTexture=r.hasOcclusionTexture,s.hasVertexTangents=!n&&r.hasVertexTangents,s.instanced=r.instanced,s.instancedDoublePrecision=r.instancedDoublePrecision,s.hasVVColor=!!r.vvColor,s.hasVVSize=!!r.vvSize,s.hasVerticalOffset=r.verticalOffset!=null,s.hasScreenSizePerspective=r.screenSizePerspective!=null,s.hasSlicePlane=r.hasSlicePlane,s.alphaDiscardMode=r.textureAlphaMode,s.normalType=n?0:r.normalType,s.transparent=this.transparent,s.writeDepth=r.writeDepth,s.customDepthTest=r.customDepthTest??0,s.hasOccludees=i.hasOccludees,s.cullFace=r.hasSlicePlane?0:r.cullFace,s.cullAboveTerrain=i.cullAboveTerrain,s.hasModelTransformation=!n&&r.modelTransformation!=null,s.hasVertexColors=r.hasVertexColors,s.hasSymbolColors=r.hasSymbolColors,s.doubleSidedMode=n?2:a&&o==="normal"?1:a&&o==="winding-order"?2:0,s.instancedFeatureAttribute=r.instancedFeatureAttribute,s.instancedColor=r.instancedColor,ds(e)?(s.terrainDepthTest=i.terrainDepthTest,s.receiveShadows=r.receiveShadows,s.receiveAmbientOcclusion=r.receiveAmbientOcclusion&&i.ssao!=null):(s.terrainDepthTest=!1,s.receiveShadows=s.receiveAmbientOcclusion=!1),s.textureAlphaPremultiplied=!!r.textureAlphaPremultiplied,s.pbrMode=r.usePBR?r.isSchematic?2:1:0,s.emissionSource=r.emissionSource,s.offsetBackfaces=!(!this.transparent||!r.offsetTransparentBackfaces),s.oitPass=i.oitPass,s.enableOffset=i.camera.relativeElevation<Smt,s.snowCover=i.snowCover>0,s.hasColorTextureTransform=!!r.colorTextureTransformMatrix,s.hasNormalTextureTransform=!!r.normalTextureTransformMatrix,s.hasEmissionTextureTransform=!!r.emissiveTextureTransformMatrix,s.hasOcclusionTextureTransform=!!r.occlusionTextureTransformMatrix,s.hasMetallicRoughnessTextureTransform=!!r.metallicRoughnessTextureTransformMatrix,s}intersect(e,i,r,s,n,a){if(this.parameters.verticalOffset!=null){const o=r.camera;ve(Qq,i[12],i[13],i[14]);let l=null;switch(r.viewingMode){case 1:l=Ee(qge,Qq);break;case 2:l=de(qge,R_t)}let c=0;const h=Ce(D_t,Qq,o.eye),f=Le(h),y=le(h,h,1/f);let _=null;this.parameters.screenSizePerspective&&(_=Oe(l,y)),c+=QPe(o,f,this.parameters.verticalOffset,_??0,this.parameters.screenSizePerspective,null),le(l,l,c),rl(Yq,l,r.transform.inverseRotation),s=Ce(O_t,s,Yq),n=Ce(P_t,n,Yq)}e0t(e,r,s,n,yQ(r.verticalOffset),a)}createGLMaterial(e){return new M_t(e)}createBufferWriter(){return new m0t(this._layout)}get transparent(){return A_t(this.parameters)}},M_t=class extends ZPe{constructor(e){super({...e,...e.material.parameters})}beginSlot(e){this._material.setParameters({receiveShadows:e.shadowMap.enabled});const i=this._material.parameters;this.updateTexture(i.textureId);const r=e.camera.viewInverseTransposeMatrix;return ve(i.origin,r[3],r[7],r[11]),this._material.setParameters(this.textureBindParameters),this.getTechnique(i.treeRendering?C_t:MDe,e)}},E_t=class extends x_t{constructor(){super(...arguments),this.treeRendering=!1,this.hasVertexTangents=!1}get hasNormalTexture(){return!this.treeRendering&&!!this.normalTextureId}get hasColorTexture(){return!!this.textureId}get hasMetallicRoughnessTexture(){return!this.treeRendering&&!!this.metallicRoughnessTextureId}get hasOcclusionTexture(){return!this.treeRendering&&!!this.occlusionTextureId}get emissionSource(){return this.treeRendering?0:this.emissiveTextureId!=null&&this.emissiveSource===0?3:this.usePBR?this.emissiveSource===0?2:1:0}get hasTextures(){return this.hasColorTexture||this.hasNormalTexture||this.hasMetallicRoughnessTexture||this.emissionSource===3||this.hasOcclusionTexture}};function A_t(t){const{drivenOpacity:e,opacity:i,externalColor:r,layerOpacity:s,texture:n,textureId:a,textureAlphaMode:o,colorMixMode:l}=t,c=r[3];return e||i<1&&l!=="replace"||c<1&&l!=="ignore"||s<1||(n!=null||a!=null)&&o!==1&&o!==2&&l!=="replace"}const O_t=R(),P_t=R(),R_t=Ge(0,0,1),qge=R(),Yq=R(),Qq=R(),D_t=R(),PDe=new ore({});function HWt(t){return t.type==="web-style"?PDe:xre(t.symbolLayers.toArray().map(e=>RDe(t,e)))}function xre(t){let e=0,i=0,r=0,s=!1,n=0;const a=new ZRe;for(const o of t)o!=null&&(e+=o.verticesPerFeature,i+=o.verticesPerCoordinate,r+=o.drawCallsPerFeature,a.bytesPerFeature+=o.memory.bytesPerFeature,a.bytesPerFeatureLabel+=o.memory.bytesPerFeatureLabel,a.resourceBytes+=o.memory.resourceBytes,a.draped.bytesPerFeature+=o.memory.bytesPerFeature,a.draped.bytesPerFeatureLabel+=o.memory.bytesPerFeatureLabel,s=s||o.estimated,++n);return s?new qyt(n,{verticesPerFeature:e,verticesPerCoordinate:i,drawCallsPerFeature:r,memory:a}):new jyt(n,{verticesPerFeature:e,verticesPerCoordinate:i,drawCallsPerFeature:r,memory:a})}function WWt(t){const e=xre(t);return e.numComplexities>0&&(e.verticesPerFeature/=e.numComplexities,e.verticesPerCoordinate/=e.numComplexities,e.drawCallsPerFeature/=e.numComplexities,e.memory.bytesPerFeature/=e.numComplexities,e.memory.bytesPerFeatureLabel/=e.numComplexities,e.memory.resourceBytes/=e.numComplexities,e.memory.draped.bytesPerFeature/=e.numComplexities,e.memory.draped.bytesPerFeatureLabel/=e.numComplexities),e}const Xq={};function RDe(t,e){const i=I_t(t,e),r=Wyt(e)?2:0;switch(e.type){case"extrude":return new Oh({verticesPerFeature:-12,verticesPerCoordinate:12,drawCallsPerFeature:r,memory:i});case"fill":if(t.type==="mesh-3d")return new Oh({drawCallsPerFeature:r,memory:i});if(e.outline!=null&&e.outline.size>0)return new Oh({verticesPerFeature:-12,verticesPerCoordinate:9,memory:i});case"water":return new Oh({verticesPerFeature:-6,verticesPerCoordinate:3,memory:i});case"line":return new Oh({verticesPerFeature:-6,verticesPerCoordinate:6,memory:i});case"object":return e.resource?.href?new ore({verticesPerFeature:100,memory:i}):{...L_t(e.resource?.primitive??Drt),memory:i};case"path":{let s=0,n=0;switch(e.profile){case"circle":s=pyt;break;case"quad":s=4;break;default:return void(e.profile,void 0)}switch(e.join){case"round":n=hyt;break;case"miter":case"bevel":n=1;break;default:return}const a=2*s,o=s*n*2,l=o+a;let c=-2*o-a;switch(e.cap){case"none":break;case"butt":case"square":c+=2*(s-1);break;case"round":c+=2*(s*(dyt-1)*2+s);break;default:return}return new Oh({verticesPerFeature:c,verticesPerCoordinate:l,memory:i})}case"text":{const s=t.type==="label-3d"?0:2;return new Oh({verticesPerFeature:6,memory:i,drawCallsPerFeature:s})}case"icon":return new Oh({verticesPerFeature:6,memory:i});default:return}}function I_t(t,e){const i=t.type==="point-3d";switch(e.type){case"extrude":return e.edges&&e.edges.size>0?To.EXTRUDE_EDGES:To.EXTRUDE;case"fill":return e.outline!=null&&e.outline.size>0?To.FILL_OUTLINE:To.FILL;case"water":return To.FILL;case"line":return e.join==="round"?To.LINE_ROUND:To.LINE_MITER;case"path":switch(e.join){case"round":switch(e.profile){case"circle":return To.PATH_ROUND_CIRCLE;case"quad":return To.PATH_ROUND_QUAD;default:return void(e.profile,void 0)}case"miter":case"bevel":switch(e.profile){case"circle":return To.PATH_MITER_CIRCLE;case"quad":return To.PATH_MITER_QUAD;default:return void(e.profile,void 0)}default:return}case"object":return i?To.OBJECT_POINT:To.OBJECT_POLYGON;case"icon":case"text":return i?To.ICON_POINT:To.ICON_POLYGON;default:return}}function L_t(t){const e=Xq[t];if(e)return e;const i=k_t(Byt(t,new ODe({},{spherical:!0})).levels);return Xq[t]=new Oh({verticesPerFeature:i}),Xq[t]}function k_t(t){return t.reduce((e,i,r)=>e+i.numVertices*(1/10**r),0)/t.reduce((e,i,r)=>e+1/10**r,0)}const To={ICON_POINT:{bytesPerFeature:2658,bytesPerFeatureLabel:3484,resourceBytes:0,draped:{bytesPerFeature:1845,bytesPerFeatureLabel:3498}},ICON_POLYGON:{bytesPerFeature:3086,bytesPerFeatureLabel:2996,resourceBytes:0,draped:{bytesPerFeature:2694,bytesPerFeatureLabel:3014}},OBJECT_POINT:{bytesPerFeature:497,bytesPerFeatureLabel:2933,resourceBytes:0,draped:{bytesPerFeature:497,bytesPerFeatureLabel:2933}},OBJECT_POLYGON:{bytesPerFeature:867,bytesPerFeatureLabel:2491,resourceBytes:0,draped:{bytesPerFeature:867,bytesPerFeatureLabel:2491}},LINE_MITER:{bytesPerFeature:2337,bytesPerFeatureLabel:2658,resourceBytes:0,draped:{bytesPerFeature:1864,bytesPerFeatureLabel:2656}},LINE_ROUND:{bytesPerFeature:2341,bytesPerFeatureLabel:2672,resourceBytes:0,draped:{bytesPerFeature:1873,bytesPerFeatureLabel:2643}},PATH_MITER_CIRCLE:{bytesPerFeature:22374,bytesPerFeatureLabel:2558,resourceBytes:0,draped:{bytesPerFeature:22374,bytesPerFeatureLabel:2558}},PATH_ROUND_CIRCLE:{bytesPerFeature:24004,bytesPerFeatureLabel:2598,resourceBytes:0,draped:{bytesPerFeature:24004,bytesPerFeatureLabel:2598}},PATH_MITER_QUAD:{bytesPerFeature:24040,bytesPerFeatureLabel:2940,resourceBytes:0,draped:{bytesPerFeature:24040,bytesPerFeatureLabel:2940}},PATH_ROUND_QUAD:{bytesPerFeature:23088,bytesPerFeatureLabel:2886,resourceBytes:0,draped:{bytesPerFeature:23088,bytesPerFeatureLabel:2886}},FILL:{bytesPerFeature:3059,bytesPerFeatureLabel:2838,resourceBytes:0,draped:{bytesPerFeature:2352,bytesPerFeatureLabel:2808}},FILL_OUTLINE:{bytesPerFeature:3093,bytesPerFeatureLabel:2632,resourceBytes:0,draped:{bytesPerFeature:2480,bytesPerFeatureLabel:2601}},EXTRUDE:{bytesPerFeature:5075,bytesPerFeatureLabel:2559,resourceBytes:0,draped:{bytesPerFeature:5075,bytesPerFeatureLabel:2559}},EXTRUDE_EDGES:{bytesPerFeature:2843,bytesPerFeatureLabel:2139,resourceBytes:0,draped:{bytesPerFeature:2843,bytesPerFeatureLabel:2139}}};if(ie("esri-tests-disable-symbol-memory-estimators"))for(const t in To){const e=To[t];e.bytesPerFeature=0,e.bytesPerFeatureLabel=0,e.draped.bytesPerFeature=0,e.draped.bytesPerFeatureLabel=0}function z_t(t){return!!t&&mD[t]!=null}function Sre(t){return 1/(mD[t]||1)}function F_t(){const t=Object.keys(mD);return tM(t,"decimal-degrees"),t.sort(),t}const N_t=F_t(),V_t=()=>fe.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function U_t(t){return{cachedResult:t.cachedResult,arcade:t.arcade?{func:t.arcade.func,context:t.arcade.modules.arcadeUtils.createExecContext(null,{sr:t.arcade.context.spatialReference}),modules:t.arcade.modules}:null}}function ZWt(t){const e=t?.expression;if(typeof e=="string"){const i=IDe(e);if(i!=null)return{cachedResult:i}}return null}async function YWt(t,e,i,r){const s=t?.expression;if(typeof s!="string")return null;const n=IDe(s);if(n!=null)return{cachedResult:n};const a=await Ete();st(i);const o=a.arcadeUtils,l=o.createSyntaxTree(s);return o.dependsOnView(l)?(r?.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:o.createFunction(l),context:o.createExecContext(null,{sr:e}),modules:a}}}function B_t(t,e,i){return t.arcadeUtils.createFeature(e.attributes,e.geometry,i)}function j_t(t,e){if(t!=null&&!DDe(t)){if(!e||!t.arcade)return void V_t().errorOncePerTick("Arcade support required but not provided");const i=e;i._geometry&&(i._geometry=yRe(i._geometry)),t.arcade.modules.arcadeUtils.updateExecContext(t.arcade.context,e)}}function q_t(t){if(t!=null){if(DDe(t))return t.cachedResult;const e=t.arcade;let i=e?.modules.arcadeUtils.executeFunction(e.func,e.context);return typeof i!="number"&&(t.cachedResult=0,i=0),i}return 0}function QWt(t,e=!1){let i=t?.featureExpressionInfo;const r=i?.expression;return e||r==="0"||(i=null),i??null}const G_t={cachedResult:0};function DDe(t){return t.cachedResult!=null}function IDe(t){return t==="0"?0:null}let Gge=class LDe{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.mode=null,this.centerInElevationSR=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(e){this._unit=e,this._metersPerElevationInfoUnit=Sre(e)}get requiresSampledElevationInfo(){return this.mode!=="absolute-height"}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(e){this._meterUnitOffset=e,this._renderUnitOffset=0}set offsetElevationInfoUnits(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(e){this._renderUnitOffset+=e}geometryZWithOffset(e,i){const r=this.calculateOffsetRenderUnits(i);return this.featureExpressionInfoContext!=null?r:e+r}calculateOffsetRenderUnits(e){let i=this._meterUnitOffset;const r=this.featureExpressionInfoContext;return r!=null&&(i+=q_t(r)*this._metersPerElevationInfoUnit),i/e.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){this.mode=e.mode,this.unit=z_t(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=e.offset??0}setFeatureExpressionInfoContext(e){this._featureExpressionInfoContext=e}updateFeatureExpressionInfoContextForGraphic(e,i,r){e.arcade?(this._featureExpressionInfoContext=U_t(e),this.updateFeatureExpressionFeature(i,r)):this._featureExpressionInfoContext=e}updateFeatureExpressionFeature(e,i){const r=this.featureExpressionInfoContext;r?.arcade&&(r.cachedResult=void 0,j_t(this._featureExpressionInfoContext,e.geometry?B_t(r.arcade.modules,e,i):null))}static fromElevationInfo(e){const i=new LDe;return e!=null&&i.setFromElevationInfo(e),i}},Tre=class{constructor(e){this.schedule=e,this._abortController=null,this._loadStatus=0,this._loadError=null,this._loader=null,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(e,i){return this._loadStatus===1?(e&&e(),this._loader??Promise.resolve()):this._loadStatus===2?(i&&i(this._loadError),this._loader??Promise.resolve()):(this._loader==null&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null,this._loadStatus=1},r=>{throw this._loadError=r,this._abortController=null,this._loadStatus=2,!Hr(r)&&this.logger&&r.message&&this.logger.warn(r.message),r})),this._loader.then(e,i).catch(()=>{}),this._loader)}abortLoad(){this._abortController!=null?this._abortController=ps(this._abortController):this._loadStatus===0&&(this._loadStatus=2),this._loader=null}};function JWt(t){switch(t){case"multiply":default:return 1;case"ignore":return 2;case"replace":return 3;case"tint":return 4}}function H_t(t,e,i){if(t==null||e===2)return i[0]=255,i[1]=255,i[2]=255,void(i[3]=255);const r=Se(Math.round(t[3]*dV),0,dV),s=r===0||e===4?0:e===3?Y_t:Q_t;i[0]=Se(Math.round(t[0]*IS),0,IS),i[1]=Se(Math.round(t[1]*IS),0,IS),i[2]=Se(Math.round(t[2]*IS),0,IS),i[3]=r+s}function W_t(t,e){for(let i=0;i<4;i++)t[i]=Z_t(e[i]);return t}function Z_t(t){return isNaN(t)?255:t*(254/255)}const IS=255,dV=85,Y_t=dV,Q_t=2*dV,D1=()=>fe.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");let X_t=class extends Tre{constructor(e,i,r,s,n=!0){super(r.schedule),this.symbol=e,this.symbolLayer=i,this._context=r,this._drivenOpacityFallbackAlwaysOpaque=n,this.ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1,rotation:!1},this._materials=[],this.logger=D1(),this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this.skipHighSymbolLodsChanged=!0,this._renderPriority=s.renderPriority,this._renderPriorityStep=s.renderPriorityStep,this._elevationContext=new Gge,this.updateComplexity(),this.ignoreDrivers=s.ignoreDrivers,this.ignoreDrivers||(this._drivenProperties=Hge(this._context.renderer,n)),this._updateElevationContext()}destroy(){this.complexity=null,this._materials.length=0,super.destroy()}get view(){return this._context.stage.view}getCachedSize(){return null}get extentPadding(){return 0}get materials(){return this._materials}get estimatedMemory(){const{complexity:e}=this;return e==null?0:(this.draped?e.memory.draped:e.memory).bytesPerFeature}get usedMemory(){return this.estimatedMemory}_drivenPropertiesChanged(e){if(this.ignoreDrivers)return!1;const i=this._drivenProperties,r=Hge(e,this._drivenOpacityFallbackAlwaysOpaque);return r.color!==i.color||r.opacity!==i.opacity||r.opacityAlwaysOpaque!==i.opacityAlwaysOpaque||r.size!==i.size||r.rotation!==i.rotation}get needsDrivenTransparentPass(){return this._hasDrivenColorOrOpacity&&!this._drivenProperties.opacityAlwaysOpaque}get _hasDrivenColorOrOpacity(){return this._drivenProperties.color||this._drivenProperties.opacity}_logGeometryCreationWarnings(e,i,r,s){const n=e.projectionSuccess,a="polygons"in e?e.polygons:null,o=`${s} geometry failed to be created`;n?!this._logGeometryValidationWarnings(i,r,s)&&a&&a.length===0&&r==="rings"&&i.length>0&&i[0].length>2&&D1().warnOncePerTick(`${o} (filled rings should use clockwise winding - try reversing the order of vertices)`):D1().warnOncePerTick(`${o} (failed to project geometry to view spatial reference)`)}get needsUpdateFocus(){return!1}_logGeometryValidationWarnings(e,i,r){const s=`${r} geometry failed to be created`;return!e.length||e.length===1&&!e[0].length?(D1().warnOncePerTick(`${s} (no ${i} were defined)`),!0):(!Array.isArray(e)||!Array.isArray(e[0]))&&(D1().warnOncePerTick(`${s} (${i} should be defined as a 2D array)`),!0)}_validateGeometry(e,i=null,r=null){if(i!=null&&!i.includes(e.type))return this.logger.warn("unsupported geometry type for "+r+` symbol: ${e.type}`),!1;switch(e.type){case"point":{const s=e;if(!isFinite(s.x)||!isFinite(s.y))return D1().warn("point coordinate is not a valid number, graphic skipped"),!1;break}case"polygon":Z2e(e)}return!0}_defaultElevationInfoNoZ(){return J_t}_defaultElevationInfoZ(){return K_t}_updateElevationContext(){this._elevationInfoOverride!=null?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.setFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.setFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(e){return e.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(e,i=this.getDefaultElevationInfo(e)){return this._elevationContext.mode||i.mode}setElevationInfoOverride(e){this._elevationInfoOverride=e,this._updateElevationContext()}createElevationContextForGraphic(e){const i=new Gge;return this.updateElevationContextForGraphic(i,e),i}updateElevationContextForGraphic(e,i){const r=i.geometry,s=this.getDefaultElevationInfo(r);e.unit=this._elevationContext.unit!=null?this._elevationContext.unit:s.unit,e.mode=this.getGeometryElevationMode(r,s),e.offsetMeters=this._elevationContext.meterUnitOffset??s.offset??0;const n=!this._elevationOptions.supportsOnTheGround&&e.mode==="on-the-ground";n&&(e.mode="relative-to-ground",e.offsetMeters=0);const a=n?G_t:this._elevationContext.featureExpressionInfoContext;a?e.updateFeatureExpressionInfoContextForGraphic(a,i,this._context.layer):e.setFeatureExpressionInfoContext(null)}prepareSymbolLayerPatch(e){}onRemoveGraphic(e){}_getLayerOpacity(){return this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner?this._context.graphicsCoreOwner.fullOpacity??0:this._context.layer.opacity??1}_getCombinedOpacity(e,i=Wge){const r=this.draped?1:this._getLayerOpacity();return this._drivenProperties.color?r:e?r*(this._drivenProperties.opacity?1:e.a):i.hasIntrinsicColor?r:0}_getCombinedOpacityAndColor(e,i=Wge){const r=this._getCombinedOpacity(e,i);if(this._drivenProperties.color)return Nq(null,r);const s=e!=null?mt.toUnitRGB(e):$ee;return Nq(s,r)}_getDrivenUInt8Color({color:e,opacity:i},r,s){const{color:n,opacity:a}=this._drivenProperties,o=mt.toUnitRGBA(r)??(s?FU:tn),l=n?e??o:null,c=e||r||s,h=n?null:o[3];return Nq(l,a&&c?i??h:null,255)}_getDrivenUInt8ColorWithNaNSupport({color:e,opacity:i},r,s){const n=r?qR(mt.toUnitRGBA(r)):fi(NaN,NaN,NaN,s?NaN:0);return this._drivenProperties.color&&e!=null&&jl(n,e),this._drivenProperties.opacity&&i!=null&&(n[3]=i),Cv(n,n,255),W_t(n,n)}isFastUpdatesEnabled(){return this._fastUpdates!=null}updateComplexity(){this.complexity=this.computeComplexity()}computeComplexity(){return RDe(this.symbol,this.symbolLayer)}globalPropertyChanged(e,i,r){switch(e){case"opacity":return this.layerOpacityChanged(i,r),!0;case"screenSizePerspectiveEnabled":return this.layerScreenSizePerspectiveChanged(i,r),!0;case"elevationInfo":{const s=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(i,r,s)!==2}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(i,r);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged;case"skipHighSymbolLods":return this.skipHighSymbolLodsChanged;default:return!1}}get pixelRatioChanged(){return!0}updateGraphics3DGraphicElevationInfo(e,i,r){let s=1;return e?.forEach(n=>{const a=i(n);if(a!=null){const o=n.graphic;this.updateElevationContextForGraphic(a.elevationContext,o),a.needsElevationUpdates=r(a.elevationContext.mode)}else s=2}),s}applyRendererDiff(e,i){return 0}getFastUpdateAttrValues(e){if(!this._fastUpdates)return null;const i=this._fastUpdates.visualVariables,r=i.size?Aq(i.size.field,e):0,s=i.color?Aq(i.color.field,e):0,n=i.opacity?Aq(i.opacity.field,e):0;return fi(r,s,n,0)}get draped(){return this._draped}ensureDrapedStatus(e){return this._draped==null?(this._draped=e,!0):(e!==this.draped&&D1().warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){const e=()=>({size:this._fastUpdates?.visualVariables.size?.field??null,color:this._fastUpdates?.visualVariables.color?.field??null,opacity:this._fastUpdates?.visualVariables.opacity?.field??null,rotation:this._fastUpdates?.visualVariables.rotation?.field??null});return{drivenProperties:this._drivenProperties,getVisVarFields:e}}};function Hge(t,e){const i={color:!1,opacity:!1,opacityAlwaysOpaque:e,size:!1,rotation:!1};return t&&"visualVariables"in t&&t.visualVariables&&t.visualVariables.forEach(r=>{switch(r.type){case"color":if(i.color=!0,r.stops)for(let s=0;s<r.stops.length;s++){const n=r.stops[s].color;n&&n.a<1&&(i.opacityAlwaysOpaque=!1)}break;case"opacity":i.opacity=!0,i.opacityAlwaysOpaque=!1;break;case"size":i.size=!0;break;case"rotation":i.rotation=!0}}),i}const J_t={mode:"on-the-ground",offset:0,unit:"meters"},K_t={mode:"absolute-height",offset:0,unit:"meters"},Wge={hasIntrinsicColor:!1},eZt=fi(NaN,NaN,NaN,NaN);function kDe(t){return t==="position"}function evt(t,e){return t==null&&(t=[]),t.push(e),t}function tvt(t,e){if(t==null)return null;const i=t.filter(r=>r!==e);return i.length===0?null:i}function tZt(t,e,i,r,s){LL[0]=t.get(e,0),LL[1]=t.get(e,1),LL[2]=t.get(e,2),R0t(LL,I1,3),i.set(s,0,I1[0]),r.set(s,0,I1[1]),i.set(s,1,I1[2]),r.set(s,1,I1[3]),i.set(s,2,I1[4]),r.set(s,2,I1[5])}const LL=R(),I1=new Float32Array(6);let zDe=class{constructor(e={}){this.id=ql(),this._highlightIds=new Set,this._shaderTransformation=null,this._visible=!0,this.castShadow=e.castShadow??!0,this.usesVerticalDistanceToGround=e.usesVerticalDistanceToGround??!1,this.graphicUid=e.graphicUid,this.layerViewUid=e.layerViewUid,e.isElevationSource&&(this.lastValidElevationBB=new FDe),this._geometries=e.geometries?Array.from(e.geometries):new Array}dispose(){this._geometries.length=0}get layer(){return this._layer}set layer(e){dt(this._layer==null||e==null,"Object3D can only be added to a single Layer"),this._layer=e}addGeometry(e){e.visible=this._visible,this._geometries.push(e);for(const i of this._highlightIds)e.addHighlight(i);this._emit("geometryAdded",{object:this,geometry:e}),this._highlightIds.size&&this._emit("highlightChanged",this),this._invalidateBoundingVolume()}removeGeometry(e){const i=this._geometries.splice(e,1)[0];if(i){for(const r of this._highlightIds)i.removeHighlight(r);this._emit("geometryRemoved",{object:this,geometry:i}),this._highlightIds.size&&this._emit("highlightChanged",this),this._invalidateBoundingVolume()}}removeAllGeometries(){for(;this._geometries.length>0;)this.removeGeometry(0)}geometryVertexAttributeUpdated(e,i,r=!1){this._emit("attributesChanged",{object:this,geometry:e,attribute:i,sync:r}),kDe(i)&&this._invalidateBoundingVolume()}get visible(){return this._visible}set visible(e){if(this._visible!==e){this._visible=e;for(const i of this._geometries)i.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const e=new Qgt;for(const i of this._geometries)i.occludees=evt(i.occludees,e);return this._emit("occlusionChanged",this),e}removeOcclude(e){for(const i of this._geometries)i.occludees=tvt(i.occludees,e);this._emit("occlusionChanged",this)}highlight(e){const i=new zRe(e);for(const r of this._geometries)r.addHighlight(i);return this._emit("highlightChanged",this),this._highlightIds.add(i),i}removeHighlight(e){this._highlightIds.delete(e);for(const i of this._geometries)i.removeHighlight(e);this._emit("highlightChanged",this)}removeStateID(e){e.channel===0?this.removeHighlight(e):this.removeOcclude(e)}getCombinedStaticTransformation(e,i){return an(i,this.transformation,e.transformation)}getCombinedShaderTransformation(e,i=it()){return an(i,this.effectiveTransformation,e.transformation)}get boundingVolumeWorldSpace(){return this._bvWorldSpace||(this._bvWorldSpace=this._bvWorldSpace||new Zge,this._validateBoundingVolume(this._bvWorldSpace,0)),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._bvObjectSpace||(this._bvObjectSpace=this._bvObjectSpace||new Zge,this._validateBoundingVolume(this._bvObjectSpace,1)),this._bvObjectSpace}_validateBoundingVolume(e,i){const r=i===1;for(const s of this._geometries){const n=s.boundingInfo;n&&ivt(n,e,r?s.transformation:this.getCombinedShaderTransformation(s))}_M(e.bounds,Wi(Jq,e.min,e.max,.5));for(const s of this._geometries){const n=s.boundingInfo;if(n==null)continue;const a=r?s.transformation:this.getCombinedShaderTransformation(s),o=HR(a);Mt(Jq,n.center,a);const l=Ri(Jq,Ti(e.bounds)),c=n.radius*o;e.bounds[3]=Math.max(e.bounds[3],l+c)}}_invalidateBoundingVolume(){const e=this._bvWorldSpace?.bounds;this._bvObjectSpace=this._bvWorldSpace=void 0,this.layer&&e&&this.layer.notifyObjectBBChanged(this,e)}_emit(e,i){this.layer?.events.emit(e,i)}get geometries(){return this._geometries}get transformation(){return this._transformation??Ro}set transformation(e){this._transformation=pn(this._transformation??it(),e),this._invalidateBoundingVolume(),this._emit("transformationChanged",this)}get shaderTransformation(){return this._shaderTransformation}set shaderTransformation(e){this._shaderTransformation=e?pn(this._shaderTransformation??it(),e):null,this._invalidateBoundingVolume(),this._emit("shaderTransformationChanged",this)}get effectiveTransformation(){return this.shaderTransformation??this.transformation}get test(){}},FDe=class{constructor(){this._data=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE]}get min(){return Ge(this._data[0],this._data[1],this._data[2])}get max(){return Ge(this._data[3],this._data[4],this._data[5])}minWith(e){const{_data:i}=this;i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.min(i[2],e[2])}maxWith(e){const{_data:i}=this;i[3]=Math.max(i[3],e[0]),i[4]=Math.max(i[4],e[1]),i[5]=Math.max(i[5],e[2])}assignMinMax(e,i){for(let r=0;r<3;++r)this._data[0+r]=e[r],this._data[3+r]=i[r]}isEmpty(){return this._data[3]<this._data[0]&&this._data[4]<this._data[1]&&this._data[5]<this._data[2]}},Zge=class extends FDe{constructor(){super(...arguments),this.bounds=ms()}};function ivt(t,e,i){const r=t.bbMin,s=t.bbMax;if(zU(i)){const n=ve(rvt,i[12],i[13],i[14]);return xe(iu,r,n),xe(Sd,s,n),e.minWith(iu),void e.maxWith(Sd)}if(Mt(iu,r,i),si(r,s))return e.minWith(iu),void e.maxWith(iu);Mt(Sd,s,i),e.minWith(iu),e.minWith(Sd),e.maxWith(iu),e.maxWith(Sd);for(let n=0;n<3;++n)de(iu,r),de(Sd,s),iu[n]=s[n],Sd[n]=r[n],Mt(iu,iu,i),Mt(Sd,Sd,i),e.minWith(iu),e.minWith(Sd),e.maxWith(iu),e.maxWith(Sd)}const rvt=R(),iu=R(),Sd=R(),Jq=R();function svt(t,e,i,r,s){if(NDe(t,e))return null;i.localOrigin=ovt(t,e);const n=new zDe({geometries:[i],castShadow:!1,layerViewUid:t.layerViewUid,graphicUid:s,usesVerticalDistanceToGround:!0});return{object:n,sampledElevation:ORe(n,e,t.elevationProvider,t.renderCoordsHelper,r)}}function nZt(t,e,i,r){return NDe(e,i)?null:ORe(t,i,e.elevationProvider,e.renderCoordsHelper,r)}function NDe(t,e){const i=t.clippingExtent;return!!i&&(Yl(e,z_,t.elevationProvider.spatialReference),!_rt(i,z_))}function nvt(t,e,i){const r=t.elevationContext,s=i.spatialReference;Yl(e,z_,s),r.centerInElevationSR=Ge(z_[0],z_[1],e.hasZ?z_[2]:0)}function avt(t){switch(t.type){case"point":return t;case"polygon":case"extent":return jRe(t);case"polyline":{const e=t.paths[0];if(!e||e.length===0)return null;const i=H2e(e,G2e(e)/2);return Ep(i[0],i[1],i[2],t.spatialReference)}case"mesh":return t.extent.center}return null}function ovt(t,e){return Yl(e,z_,t.renderCoordsHelper.spatialReference),t.localOriginFactory.getOrigin(z_)}const z_=R();function VDe(){return new Float32Array(2)}function lvt(t){const e=new Float32Array(2);return e[0]=t[0],e[1]=t[1],e}function Af(t,e){const i=new Float32Array(2);return i[0]=t,i[1]=e,i}function UDe(){return VDe()}function BDe(){return Af(1,1)}function jDe(){return Af(1,0)}function qDe(){return Af(0,1)}const cvt=UDe(),uvt=BDe(),hvt=jDe(),dvt=qDe();Object.freeze(Object.defineProperty({__proto__:null,ONES:uvt,UNIT_X:hvt,UNIT_Y:dvt,ZEROS:cvt,clone:lvt,create:VDe,fromValues:Af,ones:BDe,unitX:jDe,unitY:qDe,zeros:UDe},Symbol.toStringTag,{value:"Module"}));function pvt(t){t.include(rd),t.uniforms.add(new po("geometryDepthTexture",e=>e.geometryDepth?.attachment)),t.code.add(E`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos);
return (elementDepth < (geometryDepth - 1.0));
}`)}function GDe(t){const e=new Di,{vertex:i,fragment:r}=e,{terrainDepthTest:s}=t;return i.include($8),e.include(WPe,t),e.vertex.include(KPe,t),e.attributes.add("uv0","vec2"),i.uniforms.add(new ao("viewport",n=>n.camera.fullViewport),new ut("lineSize",(n,a)=>n.size>0?Math.max(1,n.size)*a.camera.pixelRatio:0),new Sy("pixelToNDC",n=>Cr(Yge,2/n.camera.fullViewport[2],2/n.camera.fullViewport[3])),new ut("borderSize",(n,a)=>n.borderColor?a.camera.pixelRatio:0),new ll("screenOffset",(n,a)=>Cr(Yge,n.horizontalScreenOffset*a.camera.pixelRatio,0))),e.varyings.add("coverageSampling","vec4"),e.varyings.add("lineSizes","vec2"),s&&e.varyings.add("depth","float"),t.occlusionTestEnabled&&e.include(nRe),t.hasScreenSizePerspective&&S8(i),i.main.add(E`
    ProjectHUDAux projectAux;
    vec4 endPoint = projectPositionHUD(projectAux);

    vec3 vpos = projectAux.posModel;
    if (rejectBySlice(vpos)) {
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    }
    ${_e(t.occlusionTestEnabled,E`if (!testHUDVisibility(endPoint)) {
             gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
             return;
           }`)}

    ${t.hasScreenSizePerspective?E`vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
               vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);`:"vec2 screenOffsetScaled = screenOffset;"}
    // Add view dependent polygon offset to get exact same original starting point. This is mostly used to get the
    // correct depth value
    vec3 posView = (view * vec4(position, 1.0)).xyz;
    ${_e(s,"depth = posView.z;")}

    applyHUDViewDependentPolygonOffset(centerOffsetAndDistance.w, projectAux.absCosAngle, posView);
    vec4 startPoint = proj * vec4(posView, 1.0);

    // Apply screen offset to both start and end point
    vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
    startPoint.xy += screenOffsetNorm * startPoint.w;
    endPoint.xy += screenOffsetNorm * endPoint.w;

    // Align start and end to pixel origin
    vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
    vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${_e(t.hudDepth,t.hudDepthAlignStart?"endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);":"startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);")}
    vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);

    // The direction of the line in screen space
    vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
    vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${t.hasScreenSizePerspective?E`float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
               float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);`:E`float lineSizeScaled = lineSize;
               float borderSizeScaled = borderSize;`}
    float halfPixelSize = lineSizeScaled * 0.5;

    // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
    float padding = 1.0 + borderSizeScaled;
    vec2 ndcOffset = (-halfPixelSize - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

    // Offset x/y from the center of the line in screen space
    projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

    // Compute a coverage varying which we can use in the fragment shader to determine
    // how much a pixel is actually covered by the line (i.e. to anti alias the line).
    // This works by computing two coordinates that can be linearly interpolated and then
    // subtracted to find out how far away from the line edge we are.
    float edgeDirection = (uv0.x * 2.0 - 1.0);

    float halfBorderSize = 0.5 * borderSizeScaled;
    float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
    float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

    float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

    coverageSampling = vec4(
      // Edge coordinate
      outerEdgeCoverageSampler,

      // Border edge coordinate
      outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

      // Line offset
      halfPixelSize - 0.5,

      // Border offset
      halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
    );

    lineSizes = vec2(lineSizeScaled, borderSizeScaled);
    gl_Position = projectedPosition;`),r.uniforms.add(new Xn("uColor",n=>n.color??tn),new Xn("borderColor",n=>n.borderColor??tn)),s&&(r.include(pvt,t),r.uniforms.add(new Sy("inverseViewport",n=>n.inverseViewport))),r.main.add(E`
    ${_e(s,"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }")}

    vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

    float borderAlpha = uColor.a * borderColor.a * coverage.y;
    float colorAlpha = uColor.a * coverage.x;

    float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);
    ${_e(!t.hudDepth,E`vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
           fragColor = vec4(finalRgb, finalAlpha);`)}`),e}const Yge=pt(),fvt=Object.freeze(Object.defineProperty({__proto__:null,build:GDe},Symbol.toStringTag,{value:"Module"}));let mvt=class extends Vi{constructor(e,i){super(e,i,new Ii(fvt,()=>te(()=>Promise.resolve().then(()=>Lkt),void 0)),HDe.locations)}initializePipeline(e){const{hudDepth:i,terrainDepthTest:r}=e,s={func:r?519:513};return li(i?{depthTest:s,depthWrite:m4}:{blending:Ly(1,770,771,771),depthTest:s,colorWrite:$i})}};const HDe=jc().vec3f("position").vec3f("normal").vec2f16("uv0").vec4f("centerOffsetAndDistance");let K0=class extends op{constructor(e){super(),this.spherical=e,this.screenCenterOffsetUnitsEnabled=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.hudDepth=!1,this.hudDepthAlignStart=!1,this.terrainDepthTest=!1,this.draped=!1}};d([oe()],K0.prototype,"screenCenterOffsetUnitsEnabled",void 0),d([oe()],K0.prototype,"occlusionTestEnabled",void 0),d([oe()],K0.prototype,"hasVerticalOffset",void 0),d([oe()],K0.prototype,"hasScreenSizePerspective",void 0),d([oe()],K0.prototype,"hudDepth",void 0),d([oe()],K0.prototype,"hudDepthAlignStart",void 0),d([oe()],K0.prototype,"terrainDepthTest",void 0);let Kq=class extends T8{constructor(e,i){super(e,WDe),this.intersectDraped=void 0,this.produces=new Map([[15,r=>ds(r)],[16,r=>ds(r)]]),this._configuration=new K0(i),this._uniqueMaterialIdentifier=wX(this.parameters)}passParameters(){return this.parameters}getConfiguration(e,i){return super.getConfiguration(e,i,this._configuration),this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.hasVerticalOffset=this.parameters.verticalOffset!=null,this._configuration.hasScreenSizePerspective=this.parameters.screenSizePerspective!=null,this._configuration.hudDepth=i.slot===16,this._configuration.hudDepthAlignStart=!!this.parameters.hudDepthAlignStart,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen",this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.terrainDepthTest=i.terrainDepthTest,this._configuration}get visible(){return this.parameters.color[3]>=Gr||(this.parameters.borderColor?.[3]??0)>=Gr}intersect(){}createGLMaterial(e){return new gvt(e)}createBufferWriter(){return new yvt}validateParameters(e){this._uniqueMaterialIdentifier=wX(e)}get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}};function wX({renderOccluded:t,isDecoration:e,horizontalScreenOffset:i,color:r,size:s,occlusionTest:n,shaderPolygonOffset:a,hudDepthAlignStart:o,centerOffsetUnits:l,hasSlicePlane:c,screenSizePerspective:h,verticalOffset:f,borderColor:y}){return D8e`${t}:${e}:${i}:[${r}]:${s}:${n}:${a}:${o}:${l}:${c}:${h!=null}:{${f?.screenLength}:${f?.minWorldLength}:${f?.maxWorldLength}}:[${y}]`}let gvt=class extends Vie{beginSlot(e){return this.getTechnique(mvt,e)}},WDe=class extends imt{constructor(){super(...arguments),this.horizontalScreenOffset=0,this.color=fi(0,0,0,1),this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.hudDepthAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}};const Qge=[Af(0,0),Af(1,0),Af(0,1),Af(1,0),Af(1,1),Af(0,1)];let yvt=class{constructor(){this.layout=HDe}elementCount(e){return 6*e.get("position").indices.length}write(e,i,r,s,n,a){Bie(r.get("position"),e,n.position,a,6),jie(r.get("normal"),i,n.normal,a,6),gD(r.get("centerOffsetAndDistance"),n.centerOffsetAndDistance,a,6);for(let o=0;o<Qge.length;++o)n.uv0.setVec(a+o,Qge[o]);return null}};var Cx;let _vt=(Cx=class extends X_t{constructor(e,i){super(e,null,i,wvt),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._materials[0]=new Kq(this._materialParameters,this._context.spherical)}_perInstanceMaterialParameters(e){const i=this._materialParameters;return i.horizontalScreenOffset=e.horizontalScreenOffset??0,i.centerOffsetUnits=e.centerOffsetUnits||"world",i}get _materialParameters(){const e=new WDe,i=this.symbol,r=i.callout;if(r.color){const a=mt.toUnitRGBA(r.color);a[3]*=this._getLayerOpacity(),e.color=a}else e.color=tn;if(e.size=Bx(r.size||0),i.verticalOffset){const{screenLength:a,minWorldLength:o,maxWorldLength:l}=i.verticalOffset;e.verticalOffset={screenLength:Bx(a),minWorldLength:o||0,maxWorldLength:l??1/0}}e.borderColor=r.border?.color!=null?mt.toUnitRGBA(r.border.color):null;const s=i.symbolLayers.at(0).type==="object",n=i.type==="label-3d";return e.occlusionTest=!s&&!ie("enable-feature:non-occluded-hud"),s&&(e.shaderPolygonOffset=0),e.hudDepthAlignStart=n,e.hasSlicePlane=this._context.slicePlaneEnabled,e.screenSizePerspective=this._context.screenSizePerspectiveEnabled?this.view.screenSizePerspective.parameters:null,e}_defaultElevationInfoNoZ(){return bvt}createGraphics3DGraphic(e,i){const r=e.renderingInfo,s=e.graphic,n=this.createElevationContextForGraphic(s,r.elevationOffset||0),a=r.symbol,o=this._elevationContext.mode==="on-the-ground"&&(a.type==="cim"||!a.symbolLayers.some(c=>c.type==="object"||c.type==="text"));if(a.type!=="label-3d"&&o||a.type==="point-3d"&&a.symbolLayers.every(c=>c.type==="text"&&!Brt(c)))return null;const l=jRe(s.geometry);return l==null?null:this._createAs3DShape(l,n,r,s.uid,i)}layerOpacityChanged(){this._materials[0]?.setParameters(this._materialParameters)}layerScreenSizePerspectiveChanged(){const e=this._context.screenSizePerspectiveEnabled?this.view.screenSizePerspective.parameters:null;this._materials[0]?.setParameters({screenSizePerspective:e})}layerElevationInfoChanged(e,i,r){const s=this._elevationContext.mode,n=Lgt(Cx.elevationModeChangeTypes,r,s);return n!==1||e?.forEach(a=>{const o=i(a);o!=null&&this.graphics3DGraphicLayerElevationInfoChanged(a.graphic,o)}),n}slicePlaneEnabledChanged(){return this._materials[0]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}createElevationContextForGraphic(e,i=0){const r=super.createElevationContextForGraphic(e);return r.addOffsetRenderUnits(i),r}updateElevationContextForGraphic(e,i,r=0){super.updateElevationContextForGraphic(e,i),e.addOffsetRenderUnits(r)}graphics3DGraphicLayerElevationInfoChanged(e,i){const{elevationContext:r,metadata:s}=i;this.updateElevationContextForGraphic(r,e,s?.elevationOffset??0),i.needsElevationUpdates=vge(r.mode)}computeComplexity(){return new Oh({verticesPerFeature:6})}_getOrCreateMaterial(e,i){const r=this._perInstanceMaterialParameters(e),s=wX(r);if(s===this._materials[0]?.uniqueMaterialIdentifier)return this._materials[0];if(i){let n=i.get(s);return n==null&&(n=new Kq(r,this._context.spherical),i.set(s,n)),n}return new Kq(r,this._context.spherical)}_createAs3DShape(e,i,r,s,n){const a=this._context.layerViewUid,o=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:s,layerViewUid:a}),l=this._getOrCreateMaterial(r,n),c=new Xl(l,vvt(r),null,1,o),h=svt(this._context,e,c,i,s);if(h==null)return null;const f=new qRe(this,h.object,null,Kgt,i);return f.metadata=new uyt(r.elevationOffset),f.alignedSampledElevation=h.sampledElevation,f.needsElevationUpdates=vge(i.mode),nvt(f,e,this._context.elevationProvider),f}},Cx.elevationModeChangeTypes={definedChanged:1,staysOnTheGround:1,onTheGroundChanged:2},Cx);function vvt(t){const{translation:e,centerOffset:i}=t,r=new Si(e?[e[0],e[1],e[2]]:[0,0,0],eG,3,!0),s=new Si(i?[i[0],i[1],i[2],i[3]]:[0,0,0,1],eG,4,!0);return[["position",r],["normal",new Si([0,0,1],eG,3,!0)],["centerOffsetAndDistance",s]]}const eG=[0],bvt={mode:"relative-to-ground",offset:0},wvt={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};let xvt=class extends Igt{constructor(e,i,r=R(),s=ri(),n=0,a="world",o=0){super(e,i),this.translation=r,this.centerOffset=s,this.horizontalScreenOffset=n,this.centerOffsetUnits=a,this.elevationOffset=o}},Svt=class extends iyt{};const Xge=()=>fe.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function Tvt(t,e){if(!DMe(t))return Xge().error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${t.type}' does not support callouts`),null;if(!t.callout)return null;const i=$vt[t.callout.type];return i?new i(t,e):(Xge().error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${t.callout.type}`),null)}const $vt={line:_vt};function fZt(t){return t?{originPosition:t.originPosition==="upper-left"?"upperLeft":t.originPosition==="lower-left"?"lowerLeft":t.originPosition,scale:t.tolerance?[t.tolerance,t.tolerance,1,1]:[1,1,1,1],translate:t.extent!=null?[t.extent.xmin,t.extent.ymax,t.extent.zmin??0,t.extent.mmin??0]:[0,0,0,0]}:null}function Cvt(t){return t.originPosition==="lowerLeft"&&t.scale.length===4&&t.translate.length===4}function E4(t){if(Cvt(t))return t;const{originPosition:e,scale:i,translate:r}=t,s=i[0]??1,n=i[1]??1;return{originPosition:"lowerLeft",scale:[s,e==="lowerLeft"?n:-n,i[2]??1,i[3]??1],translate:[r[0]??0,r[1]??0,r[2]??0,r[3]??0]}}function Mvt({scale:t,translate:e},i){return Math.round((i-e[0])/t[0])}function Evt({scale:t,translate:e},i){return Math.round((i-e[1])/t[1])}function Avt({scale:t,translate:e},i){return Math.round(((i??0)-e[2])/t[2])}function Ovt({scale:t,translate:e},i){return i?Math.round((i-e[3])/t[3]):0}function A4({scale:t,translate:e},i){return i*t[0]+e[0]}function O4({scale:t,translate:e},i){return i*t[1]+e[1]}function vD({scale:t,translate:e},i){return(i??0)*t[2]+e[2]}function bD({scale:t,translate:e},i){return i?i*t[3]+e[3]:0}function $re(t,e){return t&&e?Ivt:t&&!e?Rvt:!t&&e?Dvt:Pvt}const Pvt=(t,e)=>{const i=new Array(e.length);if(!e.length)return i;const r=e[0];let s=A4(t,r[0]),n=O4(t,r[1]);i[0]=[s,n];const{scale:a,originPosition:o}=t,l=a[0],c=o==="lowerLeft"?a[1]:-a[1];for(let h=1;h<e.length;h++){const[f,y]=e[h];s+=l*f,n+=c*y,i[h]=[s,n]}return i},Rvt=(t,e)=>{const i=new Array(e.length);if(!e.length)return i;const r=e[0];let s=A4(t,r[0]),n=O4(t,r[1]);i[0]=[s,n,vD(t,r[2])];const{scale:a,originPosition:o}=t,l=a[0],c=o==="lowerLeft"?a[1]:-a[1];for(let h=1;h<e.length;h++){const[f,y,_]=e[h];s+=l*f,n+=c*y,i[h]=[s,n,vD(t,_)]}return i},Dvt=(t,e)=>{const i=new Array(e.length);if(!e.length)return i;const r=e[0];let s=A4(t,r[0]),n=O4(t,r[1]);i[0]=[s,n,bD(t,r[2])];const{scale:a,originPosition:o}=t,l=a[0],c=o==="lowerLeft"?a[1]:-a[1];for(let h=1;h<e.length;h++){const[f,y,_]=e[h];s+=l*f,n+=c*y,i[h]=[s,n,bD(t,_)]}return i},Ivt=(t,e)=>{const i=new Array(e.length);if(!e.length)return i;const r=e[0];let s=A4(t,r[0]),n=O4(t,r[1]);i[0]=[s,n,vD(t,r[2]),bD(t,r[3])];const{scale:a,originPosition:o}=t,l=a[0],c=o==="lowerLeft"?a[1]:-a[1];for(let h=1;h<e.length;h++){const[f,y,_,w]=e[h];s+=l*f,n+=c*y,i[h]=[s,n,vD(t,_),bD(t,w)]}return i};function ZDe(t,e,i){const r=new Array(i.length);for(let s=0;s<i.length;s++)r[s]=e(t,i[s]);return r}function mZt(t,e,i){const r=E4(t);return e.x=Mvt(r,i.x),e.y=Evt(r,i.y),i.z!=null&&(e.z=Avt(r,i.z)),i.m!=null&&(e.m=Ovt(r,i.m)),e}function Lvt(t,e,i,r=i?.hasZ??!1,s=i?.hasM??!1){if(i!=null){const n=E4(t);e.points=$re(r,s)(n,i.points),e.hasZ=r,e.hasM=s}return e}function kvt(t,e,i,r=i?.z!=null,s=i?.m!=null){if(i==null)return e;const n=E4(t);return e.x=A4(n,i.x),e.y=O4(n,i.y),r&&(e.z=vD(n,i.z)),s&&(e.m=bD(n,i.m)),e}function zvt(t,e,i,r=i?.hasZ??!1,s=i?.hasM??!1){if(i!=null){const n=E4(t);e.rings=ZDe(n,$re(r,s),i.rings),e.hasZ=r,e.hasM=s}return e}function Fvt(t,e,i,r=i?.hasZ??!1,s=i?.hasM??!1){if(i!=null){const n=E4(t);e.paths=ZDe(n,$re(r,s),i.paths),e.hasZ=r,e.hasM=s}return e}function Nvt(){return ie("curve-densification-max-segments")}let gZt=class{constructor(e,i,r){this.uid=e,this.geometry=i,this.attributes=r,this.visible=!0,this.objectId=null,this.centroid=null}};function _Zt(t){return t.geometry!=null}let vZt=class{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}};function wZt(t,e){const i=eSe.fromJSON(t.geometryType),r=Ie.fromJSON(t.spatialReference),s=t.transform,n=t.objectIdFieldName,a=e?.maxStringAttributeLength,o=e?.maxStringAttributeFields;let l;const c=t.features.map(h=>{const f=Vvt(h,i,r,t.objectIdFieldName),y=f.geometry;if(Gvt(f.attributes,o,a,_=>{l??=[];const w=qvt(f,n);w!=null&&l.push({objectId:w,attribute:_})}),y!=null&&s)switch(y.type){case"point":f.geometry=kvt(s,y,y);break;case"multipoint":f.geometry=Lvt(s,y,y);break;case"polygon":f.geometry=zvt(s,y,y);break;case"polyline":f.geometry=Fvt(s,y,y);break;case"extent":case"mesh":f.geometry=y}return f});return{geometryType:i,features:c,spatialReference:r,fields:t.fields?.map(h=>So.fromJSON(h))??[],objectIdFieldName:t.objectIdFieldName,globalIdFieldName:t.globalIdFieldName,geohashFieldName:t.geohashFieldName,geometryProperties:t.geometryProperties,hasZ:t.hasZ,hasM:t.hasM,exceededTransferLimit:t.exceededTransferLimit,transform:null,missingAttributes:l}}function Vvt(t,e,i,r){return{uid:ql(),objectId:r&&t.attributes?t.attributes[r]:null,attributes:t.attributes,geometry:Uvt(t.geometry,e,i),visible:!0}}function Uvt(t,e,i){if(t==null)return null;switch(e){case"point":{const r=t;return{x:r.x,y:r.y,z:r.z,m:r.m,hasZ:r.z!=null,hasM:r.m!=null,type:"point",spatialReference:i}}case"polyline":{const r=t;return{paths:r.paths,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"polyline",spatialReference:i}}case"polygon":{const r=t;return{rings:r.rings,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"polygon",spatialReference:i}}case"multipoint":{const r=t;return{points:r.points,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"multipoint",spatialReference:i}}}}function Bvt(t){if(t==null)return 0;switch(t.type){case"point":return Pg+10+8+24;case"polyline":case"polygon":{let e=0;const i=2+(t.hasZ?1:0)+(t.hasM?1:0),r=t.type==="polyline"?t.paths:t.rings;if((t.type==="polyline"?t.curvePaths:t.curveRings)?.length){const n=3*Nvt()*128;e=8*n*i+128*n+32*(r.length+1)}else e=y6(r);return Pg+64+e+34}case"multipoint":{const e=y6(t.points);return Pg+e+64+34+32}case"extent":return Pg+10+64+34;case"mesh":{const e=t.vertexAttributes;return Pg+Wx(e.position,e.normal,e.uv,e.tangent)}default:return Pg}}function xZt(t){let e=32;return e+=dte(t.attributes),e+=3,e+=8+Bvt(t.geometry),e}function SZt(t){if(t==null)return 0;switch(t.type){case"point":return 1;case"polyline":{let e=0;for(const i of t.paths)e+=i.length;return e}case"polygon":{let e=0;for(const i of t.rings)e+=i.length;return e}case"multipoint":return t.points.length;case"extent":return 2;case"mesh":{const e=t.vertexAttributes&&t.vertexAttributes.position;return e?e.length/3:0}default:return}}function TZt(t){if(t==null)return!1;switch(t.type){case"extent":case"point":return!0;case"polyline":for(const e of t.paths)if(e.length>0)return!0;return!1;case"polygon":for(const e of t.rings)if(e.length>0)return!0;return!1;case"multipoint":return t.points.length>0;case"mesh":return!t.loaded||t.vertexAttributes.position.length>0}}function $Zt(t,e){switch(Nc(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[3]=t.x,e[1]=e[4]=t.y,t.hasZ&&(e[2]=e[5]=t.z);break;case"polyline":for(let i=0;i<t.paths.length;i++)E7(e,t.paths[i],!!t.hasZ);break;case"polygon":for(let i=0;i<t.rings.length;i++)E7(e,t.rings[i],!!t.hasZ);break;case"multipoint":E7(e,t.points,!!t.hasZ);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[3]=t.xmax,e[4]=t.ymax,t.zmin!=null&&(e[2]=t.zmin),t.zmax!=null&&(e[5]=t.zmax)}return e}function jvt(t,e){switch(cy(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[2]=t.x,e[1]=e[3]=t.y;break;case"polyline":for(let i=0;i<t.paths.length;i++)H9(e,t.paths[i]);break;case"polygon":for(let i=0;i<t.rings.length;i++)H9(e,t.rings[i]);break;case"multipoint":H9(e,t.points);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax}}function qvt(t,e){return t.objectId!=null?t.objectId:t.attributes&&e?t.attributes[e]:null}function Gvt(t,e,i,r){if(e?.size&&i!=null&&t)for(const s in t){if(!e.has(s))continue;const n=t[s];typeof n=="string"&&n.length>i&&(r(s),t[s]="")}}function Cre(t,e){return t?e?4:3:e?3:2}function Hvt(t,e,i,r){if(!e?.lengths.length)return null;t.lengths.length&&(t.lengths.length=0),t.coords.length&&(t.coords.length=0);const s=t.coords,n=[],a=i?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:o,coords:l}=e,c=Cre(i,r);let h=0;for(const f of o){const y=Wvt(a,l,h,f,i,r);y&&n.push(y),h+=f*c}if(n.sort((f,y)=>{let _=f[2]-y[2];return _===0&&i&&(_=f[4]-y[4]),_}),n.length){let f=6*n[0][2];s[0]=n[0][0]/f,s[1]=n[0][1]/f,i&&(f=6*n[0][4],s[2]=f!==0?n[0][3]/f:0),(s[0]<a[0]||s[0]>a[1]||s[1]<a[2]||s[1]>a[3]||i&&(s[2]<a[4]||s[2]>a[5]))&&(s.length=0)}if(!s.length){const f=e.lengths[0]?Zvt(l,0,o[0],i,r):null;if(!f)return null;s[0]=f[0],s[1]=f[1],i&&f.length>2&&(s[2]=f[2])}return t}function Wvt(t,e,i,r,s,n){const a=Cre(s,n);let o=i,l=i+a,c=0,h=0,f=0,y=0,_=0;for(let x=0,S=r-1;x<S;x++,o+=a,l+=a){const $=e[o],A=e[o+1],M=e[o+2],P=e[l],O=e[l+1],D=e[l+2];let L=$*O-P*A;y+=L,c+=($+P)*L,h+=(A+O)*L,s&&(L=$*D-P*M,f+=(M+D)*L,_+=L),$<t[0]&&(t[0]=$),$>t[1]&&(t[1]=$),A<t[2]&&(t[2]=A),A>t[3]&&(t[3]=A),s&&(M<t[4]&&(t[4]=M),M>t[5]&&(t[5]=M))}if(y>0&&(y*=-1),_>0&&(_*=-1),!y)return null;const w=[c,h,.5*y];return s&&(w[3]=f,w[4]=.5*_),w}function Zvt(t,e,i,r,s){const n=Cre(r,s);let a=e,o=e+n,l=0,c=0,h=0,f=0;for(let y=0,_=i-1;y<_;y++,a+=n,o+=n){const w=t[a],x=t[a+1],S=t[a+2],$=t[o],A=t[o+1],M=t[o+2],P=r?Qvt(w,x,S,$,A,M):Yvt(w,x,$,A);if(P)if(l+=P,r){const O=Jvt(w,x,S,$,A,M);c+=P*O[0],h+=P*O[1],f+=P*O[2]}else{const O=Xvt(w,x,$,A);c+=P*O[0],h+=P*O[1]}}return l>0?r?[c/l,h/l,f/l]:[c/l,h/l]:i>0?r?[t[e],t[e+1],t[e+2]]:[t[e],t[e+1]]:null}function Yvt(t,e,i,r){const s=i-t,n=r-e;return Math.sqrt(s*s+n*n)}function Qvt(t,e,i,r,s,n){const a=r-t,o=s-e,l=n-i;return Math.sqrt(a*a+o*o+l*l)}function Xvt(t,e,i,r){return[t+.5*(i-t),e+.5*(r-e)]}function Jvt(t,e,i,r,s,n){return[t+.5*(r-t),e+.5*(s-e),i+.5*(n-i)]}const L1=2;let zc=class DT{constructor(e=[],i=[]){this.lengths=e??[],this.coords=i??[]}static fromJSON(e){return new DT(e.lengths,e.coords)}static fromRect(e){const[i,r,s,n]=e,a=s-i,o=n-r;return new DT([5],[i,r,a,0,0,o,-a,0,0,-o])}get isPoint(){return this.lengths.length===0&&this.coords.length>=2}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((e,i)=>e+i)}get usedMemory(){return 64+Wx(this.lengths,this.coords)}area(){let e=0,i=0;if(!this.lengths.length)return 0;for(let r=0;r<this.lengths.length;r++){const s=this.lengths[r];if(s<3)continue;let n=this.coords[L1*i],a=this.coords[L1*i+1];for(let o=1;o<s;o+=1){const l=this.coords[L1*(o+i)],c=this.coords[L1*(o+i)+1];e+=-.5*(l-n)*(c+a),n=l,a=c}i+=s}return e}forEachVertex(e){let i=0;this.lengths.length||e(this.coords[0],this.coords[1]);for(let r=0;r<this.lengths.length;r++){const s=this.lengths[r];for(let n=0;n<s;n++)e(this.coords[L1*(n+i)],this.coords[L1*(n+i)+1]);i+=s}}deltaDecode(){const e=this.clone(),{coords:i,lengths:r}=e;let s=0;for(const n of r){for(let a=1;a<n;a++)i[2*(s+a)]+=i[2*(s+a)-2],i[2*(s+a)+1]+=i[2*(s+a)-1];s+=n}return e}clone(e){if(this.lengths.length===0)return new DT([],[this.coords[0],this.coords[1]]);const i=(this.lengths.length===0?1:this.lengths.reduce((s,n)=>s+n))*L1,r=this.coords.slice(0,i);return e?(e.set(r),new DT(this.lengths,e)):new DT(Array.from(this.lengths),Array.from(r))}},WC=class wF{constructor(e=null,i={},r,s,n=0){this.geometry=e,this.attributes=i,this.centroid=r,this.objectId=s,this.displayId=n}static fromJSON(e){const i=e.geometry?zc.fromJSON(e.geometry):null,r=e.centroid?zc.fromJSON(e.centroid):null,s=e.objectId;return new wF(i,e.attributes,r,s)}weakClone(){const e=new wF(this.geometry,this.attributes,this.centroid,this.objectId);return e.displayId=this.displayId,e}clone(){const e=this.geometry?.clone(),i=new wF(e,{...this.attributes},this.centroid?.clone(),this.objectId);return i.displayId=this.displayId,i}ensureCentroid(e){return this.centroid??=Hvt(new zc,this.geometry,e.hasZ,e.hasM),this.centroid}get usedMemory(){return 128+dte(this.attributes)+(this.geometry?.usedMemory??0)}};function CZt(t){return!!t.geometry?.coords?.length}let Kvt=class YDe{constructor(){this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const e=new YDe;return e.globalIdFieldName=this.globalIdFieldName,e.geohashFieldName=this.geohashFieldName,e.geometryProperties=this.geometryProperties,e.geometryType=this.geometryType,e.spatialReference=this.spatialReference,e.hasZ=this.hasZ,e.hasM=this.hasM,e.features=this.features,e.fields=this.fields,e.transform=this.transform,e.exceededTransferLimit=this.exceededTransferLimit,e.uniqueIdField=this.uniqueIdField,e.queryGeometry=this.queryGeometry,e.queryGeometryType=this.queryGeometryType,e}};function uo(t,e){return t?e?4:3:e?3:2}const N8=()=>fe.getLogger("esri.layers.graphics.featureConversionUtils"),Mre={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0,esriGeometryMultiPatch:3,esriGeometryEnvelope:0},e1t=(t,e,i,r,s,n)=>{t[i]=s,t[i+1]=n},Jge=(t,e,i,r,s,n)=>{t[i]=s,t[i+1]=n,t[i+2]=e[r+2]},t1t=(t,e,i,r,s,n)=>{t[i]=s,t[i+1]=n,t[i+2]=e[r+3]},i1t=(t,e,i,r,s,n)=>{t[i]=s,t[i+1]=n,t[i+2]=e[r+2],t[i+3]=e[r+3]};function Ere(t,e,i,r){if(t){if(i)return e&&r?i1t:Jge;if(e&&r)return t1t}else if(e&&r)return Jge;return e1t}function tG({scale:t,translate:e},i){return Math.round((i-e[0])/t[0])}function iG({scale:t,translate:e},i){return Math.round((e[1]-i)/t[1])}function rG({scale:t,translate:e},i){return Math.round((i-e[0])/t[0])}function sG({scale:t,translate:e},i){return Math.round((i-e[1])/t[1])}function nG({scale:t,translate:e},i,r){return i*t[r]+e[r]}function MZt(t,e,i){return t?e?i?Pre(t):Are(t):i?Ore(t):V8(t):null}function V8(t){const e=t.coords;return{x:e[0],y:e[1]}}function QDe(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t}function Are(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2]}}function r1t(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t}function Ore(t){const e=t.coords;return{x:e[0],y:e[1],m:e[2]}}function s1t(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.m,t}function Pre(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2],m:e[3]}}function n1t(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t.coords[3]=e.m,t}function a1t(t,e,i,r){let s=V8;i&&r?s=Pre:i?s=Are:r&&(s=Ore);for(const n of e){const{geometry:a,attributes:o}=n,l=a!=null?s(a):null;t.push({attributes:o,geometry:l})}return t}function Rre(t,e){return t&&e?n1t:t?r1t:e?s1t:QDe}function o1t(t,e,i,r,s){const n=Rre(i,r);for(const a of e){const o=a.geometry!=null?n(new zc,a.geometry):null;t.push(new WC(o,a.attributes,null,c4(a,s)))}return t}function l1t(t,e,i=Rre(e.z!=null,e.m!=null)){return i(t,e)}function c1t(t,e,i,r){for(const{geometry:s,attributes:n}of e)t.push({attributes:n,geometry:s!=null?XDe(s,i,r):null});return t}function XDe(t,e,i){if(t==null)return null;const r=uo(e,i),s=[];for(let n=0;n<t.coords.length;n+=r){const a=[];for(let o=0;o<r;o++)a.push(t.coords[n+o]);s.push(a)}return e?i?{points:s,hasZ:e,hasM:i}:{points:s,hasZ:e}:i?{points:s,hasM:i}:{points:s}}function u1t(t,e,i,r,s){const n=uo(i,r);for(const a of e){const o=a.geometry!=null?JDe(new zc,a.geometry,n):null;t.push(new WC(o,a.attributes,null,c4(a,s)))}return t}function JDe(t,e,i=uo(e.hasZ,e.hasM)){t.lengths[0]=e.points.length;const r=t.coords;let s=0;for(const n of e.points)for(let a=0;a<i;a++)r[s++]=n[a];return t}function h1t(t,e,i,r){for(const{geometry:s,attributes:n}of e)t.push({attributes:n,geometry:s!=null?KDe(s,i,r):null});return t}function KDe(t,e,i){if(!t)return null;const r=uo(e,i),{coords:s,lengths:n}=t,a=[];let o=0;for(const l of n){const c=[];for(let h=0;h<l;h++){const f=[];for(let y=0;y<r;y++)f.push(s[o++]);c.push(f)}a.push(c)}return e?i?{paths:a,hasZ:e,hasM:i}:{paths:a,hasZ:e}:i?{paths:a,hasM:i}:{paths:a}}function d1t(t,e,i,r,s){const n=uo(i,r);for(const a of e){const o=a.geometry!=null?e4e(new zc,a.geometry,n):null,l=a.centroid!=null?l1t(new zc,a.centroid):null;t.push(new WC(o,a.attributes,l,c4(a,s)))}return t}function e4e(t,e,i=uo(e.hasZ,e.hasM)){const{lengths:r,coords:s}=t;let n=0;for(const a of e.paths){for(const o of a)for(let l=0;l<i;l++)s[n++]=o[l];r.push(a.length)}return t}function p1t(t,e,i,r){for(const{geometry:s,attributes:n,centroid:a}of e){const o=s!=null?t4e(s,i,r):null;if(a!=null){const l=V8(a);t.push({attributes:n,centroid:l,geometry:o})}else t.push({attributes:n,geometry:o})}return t}function t4e(t,e,i){if(!t)return null;const r=uo(e,i),{coords:s,lengths:n}=t,a=[];let o=0;for(const l of n){const c=[];for(let h=0;h<l;h++){const f=[];for(let y=0;y<r;y++)f.push(s[o++]);c.push(f)}a.push(c)}return e?i?{rings:a,hasZ:e,hasM:i}:{rings:a,hasZ:e}:i?{rings:a,hasM:i}:{rings:a}}function f1t(t,e,i,r,s){for(const n of e){const a=n.geometry!=null?i4e(new zc,n.geometry,i,r):null,o=c4(n,s);n.centroid!=null?t.push(new WC(a,n.attributes,QDe(new zc,n.centroid),o)):t.push(new WC(a,n.attributes,null,o))}return t}function i4e(t,e,i=e.hasZ,r=e.hasM){return m1t(t,e.rings,i,r)}function m1t(t,e,i,r){const s=uo(i,r),{lengths:n,coords:a}=t;let o=0;ry(t);for(const l of e){for(const c of l)for(let h=0;h<s;h++)a[o++]=c[h];n.push(l.length)}return t}const _$=[],cR=[];function EZt(t,e,i,r,s){_$[0]=t;const[n]=r4e(cR,_$,e,i,r,s);return Cp(_$),Cp(cR),n}function r4e(t,e,i,r,s,n){if(Cp(t),!i){for(const a of e){const o=c4(a,n);t.push(new WC(null,a.attributes,null,o))}return t}switch(i){case"esriGeometryPoint":return o1t(t,e,r,s,n);case"esriGeometryMultipoint":return u1t(t,e,r,s,n);case"esriGeometryPolyline":return d1t(t,e,r,s,n);case"esriGeometryPolygon":case"esriGeometryMultiPatch":return f1t(t,e,r,s,n);default:N8().error("convertToFeatureSet:unknown-geometry",new ee("internal:geometry",`Unable to parse unknown geometry type '${i}'`)),Cp(t)}return t}function AZt(t,e,i,r){cR[0]=t,s4e(_$,cR,e,i,r);const s=_$[0];return Cp(_$),Cp(cR),s}function g1t(t,e,i){if(t==null)return null;const r=new zc;return"hasZ"in t&&e==null&&(e=t.hasZ),"hasM"in t&&i==null&&(i=t.hasM),cee(t)?Rre(e??t.z!=null,i??t.m!=null)(r,t):TU(t)?i4e(r,t,e,i):uee(t)?e4e(r,t,uo(e,i)):lee(t)?JDe(r,t,uo(e,i)):void N8().error("convertFromGeometry:unknown-geometry",new ee("internal:geometry",`Unable to parse unknown geometry type '${t}'`))}function y1t(t,e,i,r){const s=t&&("coords"in t?t:t.geometry);if(s==null)return null;switch(e){case"esriGeometryPoint":{let n=V8;return i&&r?n=Pre:i?n=Are:r&&(n=Ore),n(s)}case"esriGeometryMultipoint":return XDe(s,i,r);case"esriGeometryPolyline":return KDe(s,i,r);case"esriGeometryPolygon":return t4e(s,i,r);default:return N8().error("convertToGeometry:unknown-geometry",new ee("internal:geometry",`Unable to parse unknown geometry type '${e}'`)),null}}function _1t(t,e){for(const i of e)t.push({attributes:i.attributes});return t}function s4e(t,e,i,r,s){if(Cp(t),i==null)return _1t(t,e);switch(i){case"esriGeometryPoint":return a1t(t,e,r,s);case"esriGeometryMultipoint":return c1t(t,e,r,s);case"esriGeometryPolyline":return h1t(t,e,r,s);case"esriGeometryPolygon":return p1t(t,e,r,s);default:N8().error("convertToFeatureSet:unknown-geometry",new ee("internal:geometry",`Unable to parse unknown geometry type '${i}'`))}return t}function OZt(t){const{spatialReference:e,transform:i,fields:r,hasM:s,hasZ:n,features:a,geometryType:o,exceededTransferLimit:l,queryGeometry:c,queryGeometryType:h}=t,f={features:s4e([],a,o,n,s),fields:r,geometryType:o,spatialReference:e,queryGeometry:y1t(c,h,!1,!1)};return i&&(f.transform=i),l&&(f.exceededTransferLimit=l),s&&(f.hasM=s),n&&(f.hasZ=n),f}function PZt(t,e){const i=new Kvt,{hasM:r,hasZ:s,features:n,spatialReference:a,geometryType:o,exceededTransferLimit:l,transform:c,fields:h}=t;return h&&(i.fields=h),i.geometryType=o??null,i.spatialReference=a??null,n&&r4e(i.features,n,o,s,r,e),l&&(i.exceededTransferLimit=l),r&&(i.hasM=r),s&&(i.hasZ=s),c&&(i.transform=c),i}function RZt(t){const{transform:e,features:i,hasM:r,hasZ:s}=t;if(!e)return t;for(const n of i)n.geometry!=null&&eye(n.geometry,n.geometry,r,s,e),n.centroid!=null&&eye(n.centroid,n.centroid,r,s,e);return t.transform=null,t}function DZt(t,e){const{geometryType:i,features:r,hasM:s,hasZ:n}=e;if(!t)return e;for(let a=0;a<r.length;a++){const o=r[a],l=o.weakClone();l.geometry=new zc,Kge(l.geometry,o.geometry,s,n,i,t),o.centroid&&(l.centroid=new zc,Kge(l.centroid,o.centroid,s,n,"esriGeometryPoint",t)),r[a]=l}return e.transform=t,e}function Kge(t,e,i,r,s,n,a=i,o=r){if(ry(t),!e?.coords.length)return null;const l=Mre[s],{coords:c,lengths:h}=e,f=uo(i,r),y=uo(i&&a,r&&o),_=Ere(i,r,a,o);if(!h.length)return _(t.coords,c,0,0,tG(n,c[0]),iG(n,c[1])),ry(t,f,0),t;let w,x,S,$,A=0,M=0,P=M;for(const O of h){if(O<l)continue;let D=0;M=P,S=w=tG(n,c[A]),$=x=iG(n,c[A+1]),_(t.coords,c,M,A,S,$),D++,A+=f,M+=y;for(let L=1;L<O;L++,A+=f)S=tG(n,c[A]),$=iG(n,c[A+1]),S===w&&$===x||(_(t.coords,c,M,A,S-w,$-x),M+=y,D++,w=S,x=$);D>=l&&(t.lengths.push(D),P=M)}return Cp(t.coords,P),t.coords.length?t:null}function IZt(t,e,i,r,s,n,a=i,o=r){if(ry(t),!e?.coords.length)return null;const l=Mre[s],{coords:c,lengths:h}=e,f=uo(i,r),y=uo(i&&a,r&&o),_=Ere(i,r,a,o);if(!h.length)return _(t.coords,c,0,0,c[0],c[1]),ry(t,f,0),t;let w=0;const x=n*n;for(const S of h){if(S<l){w+=S*f;continue}const $=t.coords.length/y,A=w,M=w+(S-1)*f;_(t.coords,c,t.coords.length,A,c[A],c[A+1]),xX(t.coords,c,f,x,_,A,M),_(t.coords,c,t.coords.length,M,c[M],c[M+1]);const P=t.coords.length/y-$;P>=l?t.lengths.push(P):Cp(t.coords,$*y),w+=S*f}return t.coords.length?t:null}function v1t(t,e,i,r){const s=t[e],n=t[e+1],a=t[i],o=t[i+1],l=t[r],c=t[r+1];let h=a,f=o,y=l-h,_=c-f;if(y!==0||_!==0){const w=((s-h)*y+(n-f)*_)/(y*y+_*_);w>1?(h=l,f=c):w>0&&(h+=y*w,f+=_*w)}return y=s-h,_=n-f,y*y+_*_}function xX(t,e,i,r,s,n,a){let o,l=r,c=0;for(let h=n+i;h<a;h+=i)o=v1t(e,h,n,a),o>l&&(c=h,l=o);l>r&&(c-n>i&&xX(t,e,i,r,s,n,c),s(t,e,t.length,c,e[c],e[c+1]),a-c>i&&xX(t,e,i,r,s,c,a))}function LZt(t,e,i,r){if(!e?.coords?.length)return null;const s=uo(i,r);let n=Number.POSITIVE_INFINITY,a=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;if(e&&e.coords){const c=e.coords;for(let h=0;h<c.length;h+=s){const f=c[h],y=c[h+1];n=Math.min(n,f),o=Math.max(o,f),a=Math.min(a,y),l=Math.max(l,y)}}return gY(t)?wrt(t,n,a,o,l):pU(n,a,o,l,t),t}function eye(t,e,i,r,s){const{coords:n,lengths:a}=e,o=uo(i,r);if(!n.length)return t!==e&&ry(t),t;rM(s);const{originPosition:l,scale:c,translate:h}=s,f=x1t;f.originPosition=l;const y=f.scale;y[0]=c[0]??1,y[1]=-(c[1]??1),y[2]=c[2]??1,y[3]=c[3]??1;const _=f.translate;if(_[0]=h[0]??0,_[1]=h[1]??0,_[2]=h[2]??0,_[3]=h[3]??0,!a.length){for(let x=0;x<o;++x)t.coords[x]=nG(f,n[x],x);return t!==e&&ry(t,o,0),t}let w=0;for(let x=0;x<a.length;x++){const S=a[x];t.lengths[x]=S;for(let M=0;M<o;++M)t.coords[w+M]=nG(f,n[w+M],M);let $=t.coords[w],A=t.coords[w+1];w+=o;for(let M=1;M<S;M++,w+=o){$+=n[w]*y[0],A+=n[w+1]*y[1],t.coords[w]=$,t.coords[w+1]=A;for(let P=2;P<o;++P)t.coords[w+P]=nG(f,n[w+P],P)}}return t!==e&&ry(t,n.length,a.length),t}function kZt(t,e,i,r,s,n){if(ry(t),t.lengths.push(...e.lengths),i===s&&r===n)for(let a=0;a<e.coords.length;a++)t.coords.push(e.coords[a]);else{const a=uo(i,r),o=Ere(i,r,s,n),l=e.coords;for(let c=0;c<l.length;c+=a)o(t.coords,l,t.coords.length,c,l[c],l[c+1])}return t}function b1t(t,e,i,r){let s=0,n=t[r*e],a=t[r*(e+1)];for(let o=1;o<i;o++){const l=n+t[r*(e+o)],c=a+t[r*(e+o)+1],h=(l-n)*(c+a);n=l,a=c,s+=h}return .5*s}function zZt(t,e){const{coords:i,lengths:r}=t;let s=0,n=0;for(let a=0;a<r.length;a++){const o=r[a];n+=b1t(i,s,o,e),s+=o}return Math.abs(n)}function w1t(t,e,i,r){return t*r-i*e===0&&t*i+e*r>0}function FZt(t,e,i,r,s){const n=uo(r,s);if(!t.lengths.length){if(t.coords.length<2)return null;const[f,y]=t.coords,_=rG(e,f),w=sG(e,y);return new zc([],[_,w])}const a=new zc([],[0,0]),o=Mre[i],l=i==="esriGeometryPolygon"||i==="esriGeometryPolyline";let c=0,h=0;for(let f=0;f<t.lengths.length;f++){const y=t.lengths[f],_=h;let w=rG(e,t.coords[n*c]),x=sG(e,t.coords[n*c+1]);a.coords[h++]=w,a.coords[h++]=x;let S=0,$=0,A=1;for(let M=1;M<y;M++){const P=rG(e,t.coords[n*(M+c)]),O=sG(e,t.coords[n*(M+c)+1]);if(P!==w||O!==x){const D=P-w,L=O-x;l&&w1t(S,$,D,L)?(a.coords[h-2]+=D,a.coords[h-1]+=L,w+=D,x+=L):(a.coords[h++]=P,a.coords[h++]=O,w=P,x=O,S=D,$=L,A+=1)}}A<o?h=_:a.lengths.push(A),c+=y}return a.lengths.length===0?null:a}function ry(t,e=0,i=0){Cp(t.lengths,i),Cp(t.coords,e)}function Cp(t,e=0){t.length!==e&&(t.length=e)}const x1t={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]},tye=new Wl(()=>ul(),t=>t8(t,TMe),null,10,5),S1t=Pi();let T1t=class{get labelLayers(){return this._labelLayers||$8e}get extent(){return this._extent}get isElevationSource(){return this.layers.some(e=>e?.isElevationSource)}constructor(e,i,r){this.graphic=e,this.graphics3DSymbol=i,this.layers=r,this._visibleFlags=255,++i.referenced}initialize(e){this._layer=e,this._forEachSymbolLayerGraphic(i=>{i.initialize(e),i.setVisibility(this.isVisible())})}destroy(){this._forEachSymbolLayerGraphic(e=>e.destroy()),this._calloutLayer=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return this.layers==null}clearLabelGraphics(){this._forEachLabelGraphic(e=>e.destroy()),this._labelLayers=null}addLabelGraphic(e,i){this._labelLayers||(this._labelLayers=new Array),this._labelLayers.push(e),e.initialize(i),e.setVisibility(this.isVisible(16))}setCalloutGraphic(e){this._calloutLayer=e,this._layer&&(e.initialize(this._layer),e.setVisibility(this.isVisible()))}get calloutLayer(){return this._calloutLayer}get isDraped(){let e=!1;return this._forEachSymbolLayerGraphic(i=>{i.type==="draped"&&(e=!0)}),e}isVisible(e=1,i){const r=i?this._visibleFlags|i|16*i:this._visibleFlags;return e===1?!(15&~r):!(255&~r)}setVisibilityFlag(e,i,r){const s=this.isVisible(e);r?this._visibleFlags|=e*i:this._visibleFlags&=~(e*i);const n=this.isVisible(e);if(s===n)return!1;if(e===16)this._forEachLabelGraphic(a=>a.setVisibility(n));else{this._forEachSymbolLayerGraphic(o=>o.setVisibility(n));const a=this.isVisible(16);this._forEachLabelGraphic(o=>o.setVisibility(a))}return!0}getVisibilityFlag(e,i){return(this._visibleFlags&e*i)!==0}computeExtent(e){if(!this._extent){const i=this.graphic.geometry;if(i==null)return!1;this._extent=Pi(),jvt(i,this._extent);const r=i.spatialReference;if(!fs(r,e)&&!Pee(this._extent,r,this._extent,e))return this._extent=null,!1}return!0}getAsOptimizedGeometry(e,i){return this._optimizedGeometry||(this._optimizedGeometry=this._convertGraphicToOptimizedGeometry(this.graphic,e,i)),this._optimizedGeometry}_convertGraphicToOptimizedGeometry(e,i,r){let s=e.geometry;return s.type!=="mesh"&&s.type!=="extent"||(s=os.fromExtent(s.type==="mesh"?s.extent:s)),g1t(s,i,r)}get usedMemory(){let e=dte(this.graphic.attributes);return this._forEachSymbolLayerGraphic(i=>e+=i.usedMemory),e}computeAttachmentOrigin(){const e={render:{origin:R(),num:0},draped:{origin:pt(),num:0}};for(const i of this.layers)i?.computeAttachmentOrigin(e);return e.render.num>1&&le(e.render.origin,e.render.origin,1/e.render.num),e.draped.num>1&&zg(e.draped.origin,e.draped.origin,1/e.draped.num),e}async getProjectedBoundingBox(e,i,r,s,n){return n||(n={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),n.boundingBox?Nc(n.boundingBox):n.boundingBox=Nc(),n.requiresDrapedElevation=!1,await vte(this.layers,async a=>{if(a==null)return;const o=a.type==="draped"?i:e,l=tye.acquire(),c=await a.getProjectedBoundingBox(o,r,n.screenSpaceObjects,s,l);isFinite(c[2])&&isFinite(c[5])||(n.requiresDrapedElevation=!0),c&&bMe(n.boundingBox,l),tye.release(l)}),grt(n.boundingBox)||AW(Fte(n.boundingBox,S1t))?n:null}needsElevationUpdates(){for(const e of this.layers)if(e!=null&&(e.type==="object3d"||e.type==="lod-instance")&&e.needsElevationUpdates)return!0;return this._labelLayers?.some(e=>e?.needsElevationUpdates??!1)??!1}alignWithElevation(e,i,r){this._forEachRenderedGraphic(s=>{s.type!=="object3d"&&s.type!=="lod-instance"||s.alignWithElevation(e,i,r)})}alignWithAbsoluteElevation(e,i,r){this._forEachRenderedGraphic(s=>{s.type==="object3d"&&s.alignWithAbsoluteElevation(e,i,r)})}addObjectStateSet(e){this._forEachSymbolLayerGraphic(i=>i.addObjectState(e))}removeObjectState(e){this._forEachSymbolLayerGraphic(i=>i.removeObjectState(e))}updateHighlights(e){this._forEachSymbolLayerGraphic(i=>i.updateHighlights(e))}_forEachGraphicList(e,i){e?.forEach(r=>r&&i(r))}_forEachSymbolLayerGraphic(e){this._forEachGraphicList(this.layers,e),this._calloutLayer&&e(this._calloutLayer)}_forEachLabelGraphic(e){this._forEachGraphicList(this.labelLayers,e)}_forEachRenderedGraphic(e){this._forEachSymbolLayerGraphic(e),this._forEachLabelGraphic(e)}get test(){}},VZt=class{constructor(e,i,r,s){this.scheduler=e,this.schedule=i,this.layerViewUid=r,this.compressionTracker=s,this.sharedResources=null,this.streamDataRequester=null,this.elevationProvider=null,this.renderer=null,this.stage=null,this.clippingExtent=null,this.renderCoordsHelper=null,this.overlaySR=null,this.layer=null,this.drapeSourceRenderer=null,this.graphicsCoreOwner=null,this.localOriginFactory=null,this.featureExpressionInfoContext=null,this.screenSizePerspectiveEnabled=!0,this.slicePlaneEnabled=!1,this.physicalBasedRenderingEnabled=!1,this.skipHighSymbolLods=!1,this.isAsync=!1}get spherical(){return this.stage.view.state.viewingMode===1}},$1t=class{constructor(){this.renderPriority=0,this.renderPriorityStep=1,this.ignoreDrivers=!1}};const C1t=2216,M1t=4096;function n4e(t){return C1t+M1t*t.symbolLayers.length+t.complexity.memory.resourceBytes}let E1t=class extends Tre{set symbol(e){this._symbol=e,e.symbolLayers.forEach((i,r)=>{const s=this.symbolLayers[r];s!=null&&(s.symbol=e,s.symbolLayer=i)})}get symbol(){return this._symbol}constructor(e,i,r){super(i.schedule),this._symbol=e,this._context=i,this._backgroundLayers=r,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}async doLoad(e){let i=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(i=this._backgroundLayers.concat(i));const r=i.length;for(;this.symbolLayers.length<i.length;)this.symbolLayers.push(null);this.symbolLayers.length=i.length;const s=[];if(!aG){const{make:n}=await te(()=>import("./Graphics3DSymbolLayerFactory-DfLWPFhx.js"),__vite__mapDeps([358,352,20,241,99,325,30,52,53,50,54,51,55,56,57,25,127,126,258,324,319,301,359,360,32,33,361,221,362,190,363,208,102,189,100,101,364,297,207]));aG=n}for(let n=0;n<r;n++){const a=i.at(n);if(a.enabled===!1)continue;kL.renderPriority=1-(1+n)/r,kL.renderPriorityStep=1/r,kL.ignoreDrivers=a.ignoreDrivers;const o=aG(this.symbol,a,this._context,kL),l=jD(e,()=>{this.symbolLayers[n]=null,o.destroy()});l&&s.push(l),this.symbolLayers[n]=o}if(await vte(this.symbolLayers,async(n,a)=>{if(n!=null)try{await n.load(),this._extentPadding+=Math.max(this._extentPadding,n.extentPadding)}catch{this.symbolLayers[a]=null}}),s.forEach(n=>n.remove()),st(e),this.symbolLayers.length&&!this.symbolLayers.some(n=>!!n))throw new Error}getSymbolLayerSize(e){const i=this.symbolLayers[e];return i!=null?i.getCachedSize():null}get extentPadding(){return this._extentPadding}get symbologySnappingSupported(){return this.symbolLayers.some(e=>e?.queryForSnapping)}get needsUpdateFocus(){return this.symbolLayers.some(e=>e?.needsUpdateFocus===!0)}createGraphics3DGraphic(e,i){const{graphic:r}=e,s=this.symbolLayers.map(n=>n?.createGraphics3DGraphic(e)??null);return new T1t(r,i||this,s)}get complexity(){return xre(this.symbolLayers.map(e=>e?.complexity))}globalPropertyChanged(e,i){const r=this.symbolLayers.length;for(let s=0;s<r;s++){const n=this.symbolLayers[s],a=o=>{const l=o.layers[s];return l instanceof qRe?l:null};if(n!=null&&!n.globalPropertyChanged(e,i,a))return!1}return!0}applyRendererDiff(e,i){return this.loadStatus!==1?0:this.symbolLayers.reduce((r,s)=>r!==0&&s!=null?Math.min(r,s.applyRendererDiff(e,i)):r,2)}prepareSymbolPatch(e){if(this.loadStatus===2||e.diff.type!=="partial")return;const i=e.diff.diff;if(!i.symbolLayers||i.symbolLayers.type!=="partial")return;const r=i.symbolLayers.diff;this.symbolLayers.forEach((s,n)=>{if(s==null)return;const a=r[n];if(a){const o={diff:a,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};s.prepareSymbolLayerPatch(o),e.symbolStatePatches.push(...o.symbolLayerStatePatches),o.graphics3DGraphicPatches.length&&e.graphics3DGraphicPatches.push((l,c)=>{const h=l.layers[n];h!=null&&o.graphics3DGraphicPatches.forEach(f=>f(h,c))})}})}updateGeometry(e){return this._updateGeometryOrTransform(e,(i,r)=>!!i.updateGeometry&&i.updateGeometry(e.graphic,r))}updateTransform(e,i,r,s){return this._updateGeometryOrTransform(e,(n,a)=>!!n.updateTransform&&n.updateTransform(a,i,r,s))}_updateGeometryOrTransform(e,i){for(let r=0;r<this.symbolLayers.length;r++){const s=this.symbolLayers[r];if(s==null)continue;const n=e.layers[r];if(!n||!i(s,n))return!1}return!0}onRemoveGraphic(e){for(let i=0;i<this.symbolLayers.length;i++){const r=this.symbolLayers[i];if(r==null)continue;const s=e.layers[i];s!=null&&r.onRemoveGraphic(s)}}getFastUpdateStatus(){let e=!1,i=!1;for(const r of this.symbolLayers)if(r!=null){if(r.loadStatus===0)return 3;r.isFastUpdatesEnabled()?i=!0:e=!0}return i?e?2:1:e?0:4}async queryForSnapping(e,i,r,s){const n=this.symbolLayers.filter(qf).filter(o=>o.queryForSnapping!=null).map(o=>o.queryForSnapping(e,i,r,s)),a=await Promise.all(n);return st(s),a.flat()}destroy(){if(!this.destroyed){super.destroy();for(const e of this.symbolLayers)e?.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}get usedMemory(){return n4e(this)}},aG=null;const kL=new $1t;let A1t=class extends Tre{constructor(e,i,r){super(i),this.symbol=e,this._convert=r,this.symbologySnappingSupported=!1,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(e){return this.graphics3DSymbol!=null?this.graphics3DSymbol.getSymbolLayerSize(e):null}get symbolLayers(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.extentPadding:0}async doLoad(e){const i=await this.symbol.fetchSymbol({signal:e});i.id=this.symbol.id,this.graphics3DSymbol=this._convert(i),this.graphics3DSymbol!=null&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(e){return this.graphics3DSymbol!=null?this.graphics3DSymbol.createGraphics3DGraphic(e,this):null}get complexity(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.complexity:PDe}globalPropertyChanged(e,i){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.globalPropertyChanged(e,i)}applyRendererDiff(e,i){return this.graphics3DSymbol!=null?this.graphics3DSymbol.applyRendererDiff(e,i):0}prepareSymbolPatch(e){this.graphics3DSymbol!=null&&this.graphics3DSymbol.prepareSymbolPatch(e)}updateGeometry(e){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.updateGeometry(e)}updateTransform(e,i,r,s){return this.graphics3DSymbol?.updateTransform(e,i,r,s)??!1}onRemoveGraphic(){}get needsUpdateFocus(){return!1}getFastUpdateStatus(){return this.graphics3DSymbol?.getFastUpdateStatus()??3}destroy(){this.graphics3DSymbol!=null&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return this.graphics3DSymbol===void 0}get usedMemory(){return n4e(this)}};function SX(t){return t instanceof A1t?t.graphics3DSymbol:t instanceof E1t?t:null}const GZt=1.2,HZt=tn,O1t=4;let P1t=class{constructor(e,i="center",r=!1,s=pt(),n=fi(0,0,0,-1),a="world",o=R(),l=0){this.verticalOffset=e,this.anchor=i,this.hasLabelVerticalOffset=r,this.screenOffset=s,this.centerOffset=n,this.centerOffsetUnits=a,this.translation=o,this.elevationOffset=l}},R1t=class{constructor(e,i="center",r="center",s=null,n=pt(),a=!0){this.placement=e,this.horizontalPlacement=i,this.verticalPlacement=r,this.text=s,this.displaySize=n,this.isFocused=a}};function TX(t,e,i){return t.canvas||(t.canvas=document.createElement("canvas")),t.canvas.width=e,t.canvas.height=i,t.canvas}function D1t(t){const{size:e}=t.definition,i=t.fontString(e);let r=iye.get(i);if(!r){const s=TX(L1t,0,0).getContext("2d");t.setFontProperties(s,e);const n=s.measureText(k1t);r=new I1t(n.actualBoundingBoxAscent,n.actualBoundingBoxDescent),iye.set(i,r)}return r}const iye=new Map;let I1t=class{get maxHeight(){return this.maxAscent+this.maxDescent}constructor(e,i){this.maxAscent=e,this.maxDescent=i}};const L1t={canvas:null},k1t=(()=>{let t="";for(let e=32;e<127;e++)t+=String.fromCharCode(e);return t})(),pV=1;let z1t=class{constructor(e,i,r,s){this.text=e,this._alignment=i,this._parameters=r,this._maxSize=s,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._metricsCached=null,this.key=`${e}--${this._parameters.key}-${this._alignment}`,this._lines=e.replaceAll(" ","").split(/\r?\n/)}get displayWidth(){return Math.ceil(this._displayWidth+2*this._horizontalPadding)}get displayHeight(){let e=this._metrics.firstLineAscent;for(let i=0;i<this._lines.length-1;i++)e+=this._lineSpacing;return e+=this._metrics.lastLineDescent,Math.ceil(e+2*this._haloSize+2*this._verticalPadding)}get renderedWidth(){return this._toRoundedRenderUnit(this.displayWidth)}get renderedHeight(){return this._toRoundedRenderUnit(this.displayHeight)}get firstRenderedBaselinePosition(){return this._toRenderUnit(this._firstLineYOffset+this._metrics.firstLineAscent)}get _firstLineYOffset(){return this._verticalPadding+this._haloSize}get _metrics(){if(this._metricsCached==null){const e=TX(rye,zL,zL).getContext("2d"),i=this._parameters.definition.pixelRatio,r=this._fontSize*i;this._parameters.setFontProperties(e,r);let s=2*this._haloSize;const n=this._parameters.definition.font;n.style!=="italic"&&n.style!=="oblique"&&n.weight!=="bold"&&n.weight!=="bolder"||(s+=.3*e.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let a=0,o=0,l=0,c=0,h=0;this._lines.forEach(($,A)=>{const M=e.measureText($),P=M.width/i,O=P+s;this._textWidths.push(P),this._lineWidths.push(O),a=Math.max(a,O),c=Math.max(c,M.actualBoundingBoxAscent/i),h=Math.max(h,M.actualBoundingBoxDescent/i),A===0&&(o=M.actualBoundingBoxAscent/i),A===this._lines.length-1&&(l=M.actualBoundingBoxDescent/i)});const f=D1t(this._parameters),y=Math.max(c,f.maxAscent),_=Math.max(h,f.maxDescent),w=o,x=this._parameters.definition.font.decoration==="underline"?_:l,S=a;this._metricsCached=new N1t(w,x,y,_,S)}return this._metricsCached}get _lineSpacing(){return(this._midLineHeight+this._linePadding)*this._parameters.definition.lineSpacingFactor}get _midLineHeight(){return this._metrics.midLineHeight}get _linePadding(){return this._midLineHeight*F1t}get _midLineAscent(){return this._metrics.maxLineAscent}get _renderedFontSize(){return this._toRenderUnit(this._fontSize)}get _fontSize(){return this._parameters.definition.size}get _renderedHaloSize(){return this._toRenderUnit(this._haloSize)}get _haloSize(){return this._parameters.haloSize}get _horizontalPadding(){return this._hasBackground?this._parameters.definition.background.padding[0]:0}get _verticalPadding(){return Math.max(this._hasBackground?this._parameters.definition.background.padding[1]:0,pV)}get _hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if(this._renderPixelRatio==null){const e=this._parameters.definition.pixelRatio;this._renderPixelRatio=Math.min(e,Math.min(this._maxSize[0]/this.displayWidth,this._maxSize[1]/this.displayHeight))}return this._renderPixelRatio}_getLineXOffset(e){switch(this._alignment){case 0:return this._horizontalPadding;case 1:return(this.displayWidth-this._lineWidths[e])/2;case 2:return this.displayWidth-this._horizontalPadding-this._lineWidths[e]}}render(e,i,r){e.save();const s=i/=this.renderPixelRatio,n=r/=this.renderPixelRatio,a=this._haloSize,o=this._firstLineYOffset+this._metrics.firstLineAscent;i+=a,r+=o;const l=this._haloSize>0;l&&this._renderHalo(e,s,n,a,o),this._parameters.setFontProperties(e,this._renderedFontSize);for(let c=0;c<this._lines.length;++c){const h=this._lines[c],f=this._getLineXOffset(c);l&&(e.globalCompositeOperation="destination-out",e.fillStyle="rgb(0, 0, 0)",this._fillText(e,h,i+f,r),this._renderLineDecoration(e,i+f,r,this._textWidths[c])),e.globalCompositeOperation="source-over",e.fillStyle=this._parameters.textStyle,this._fillText(e,h,i+this._getLineXOffset(c),r),this._renderLineDecoration(e,i+f,r,this._textWidths[c]),r+=this._lineSpacing}if(Ws.TEXT_SHOW_BASELINE){e.strokeStyle=sye,e.setLineDash([2,2]),e.lineWidth=1;let c=n+o;for(let h=0;h<this._lines.length;++h)this._drawLine(e,[s,c],[s+this.displayWidth,c]),c+=this._lineSpacing}if(Ws.TEXT_SHOW_BORDER&&(e.strokeStyle=sye,e.setLineDash([]),e.lineWidth=1,this._drawBox(e,[s,n],[this.displayWidth,this.displayHeight])),this._hasBackground){const c=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(e,s,n,c),e.globalCompositeOperation="destination-over",e.fillStyle=this._parameters.backgroundStyle,e.fill()}e.restore()}_renderLineDecoration(e,i,r,s,n=!1){if(this._parameters.definition.font.decoration==="none"||s===0)return;const a=1,o=Math.max(this._parameters.definition.size/16,a);switch(this._parameters.definition.font.decoration){case"underline":r+=2*o;break;case"line-through":r-=.33*this._midLineAscent}const l=n?this._haloSize:0;e.strokeStyle=n?this._parameters.haloStyle:this._parameters.textStyle,e.lineWidth=this._toRenderUnit(o+2*l),e.beginPath(),e.moveTo(this._toRenderUnit(i-l),this._toRenderUnit(r)),e.lineTo(this._toRenderUnit(i+s+l),this._toRenderUnit(r)),e.stroke()}_roundedRect(e,i,r,s){i=this._toRenderUnit(i),r=this._toRenderUnit(r);const n=this.renderedWidth,a=this.renderedHeight;s!==0?(s=Se(s,0,Math.floor(a/2)),e.beginPath(),e.moveTo(i,r+s),e.arcTo(i,r,i+s,r,s),e.lineTo(i+n-s,r),e.arcTo(i+n,r,i+n,r+s,s),e.lineTo(i+n,r+a-s),e.arcTo(i+n,r+a,i+n-s,r+a,s),e.lineTo(i+s,r+a),e.arcTo(i,r+a,i,r+a-s,s),e.closePath()):e.rect(i,r,n,a)}_renderHalo(e,i,r,s,n){const a=this.renderedWidth,o=this.renderedHeight,l=TX(rye,Math.max(a,zL),Math.max(o,zL)),c=l.getContext("2d");c.clearRect(0,0,a,o),this._parameters.setFontProperties(c,this._renderedFontSize),c.fillStyle=this._parameters.haloStyle,c.strokeStyle=this._parameters.haloStyle;const h=this._renderedHaloSize<3;c.lineJoin=h?"miter":"round",h?this._renderHaloEmulated(c,s,n):this._renderHaloNative(c,s,n);let f=n;for(let y=0;y<this._lines.length;++y){const _=this._getLineXOffset(y);this._renderLineDecoration(c,s+_,f,this._textWidths[y],!0),f+=this._lineSpacing}e.globalAlpha=this._parameters.definition.halo.color[3],e.drawImage(l,0,0,a,o,this._toRenderUnit(i),this._toRenderUnit(r),a,o),e.globalAlpha=1}_renderHaloEmulated(e,i,r){for(let s=0;s<this._lines.length;++s){const n=this._lines[s],a=this._getLineXOffset(s);for(const[o,l]of a4e)this._fillText(e,n,i+a+this._haloSize*o,r+this._haloSize*l);r+=this._lineSpacing}}_renderHaloNative(e,i,r){const s=2*this._haloSize;for(let n=0;n<this._lines.length;++n){const a=this._lines[n],o=this._getLineXOffset(n),l=5,c=.1;for(let h=0;h<l;h++){const f=1-(l-1)*c+h*c;e.lineWidth=this._toRenderUnit(f*s),this._strokeText(e,a,i+o,r)}r+=this._lineSpacing}}get _displayWidth(){return this._metrics.displayWidth}_toRenderUnit(e){return e*this.renderPixelRatio}_toRoundedRenderUnit(e){return Math.round(e*this.renderPixelRatio)}_fillText(e,i,r,s){e.fillText(i,this._toRenderUnit(r),this._toRenderUnit(s))}_strokeText(e,i,r,s){e.strokeText(i,this._toRenderUnit(r),this._toRenderUnit(s))}_drawLine(e,i,r){e.beginPath(),e.moveTo(this._toRoundedRenderUnit(i[0])+.5,this._toRoundedRenderUnit(i[1])+.5),e.lineTo(this._toRoundedRenderUnit(r[0])+.5,this._toRoundedRenderUnit(r[1])+.5),e.stroke()}_drawBox(e,i,r){const s=this._toRenderUnit(i[0]),n=this._toRenderUnit(i[1]),a=this._toRenderUnit(r[0]),o=this._toRenderUnit(r[1]),l=Math.floor(s)+.5,c=Math.ceil(s+a)-.5,h=Math.floor(n)+.5,f=Math.ceil(n+o)-.5;e.beginPath(),e.moveTo(l,h),e.lineTo(c,h),e.lineTo(c,f),e.lineTo(l,f),e.lineTo(l,h),e.stroke()}};const a4e=[];for(let e=0;e<360;e+=360/16)a4e.push([Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)]);const rye={canvas:null},F1t=.2,zL=512,sye="rgb(255, 0, 255, 0.5)";let N1t=class{get firstLineHeight(){return this.firstLineAscent+this.maxLineDescent}get midLineHeight(){return this.maxLineAscent+this.maxLineDescent}get lastLineHeight(){return this.maxLineAscent+this.lastLineDescent}constructor(e,i,r,s,n){this.firstLineAscent=e,this.lastLineDescent=i,this.maxLineAscent=r,this.maxLineDescent=s,this.displayWidth=n}};const mA=()=>fe.getLogger("esri.views.3d.layers.graphics.labelPlacement");let nye=class{constructor(e,i,r,s=null){this._graphic=e,this._symbol=i,this._class=r,this._disablePlacement=s}get placement(){const e=this._verticalOffsetPlacement;if(e==null)return null;const i=this._getPlacementInfo(e);if(i==null)return null;const r=i.anchor,s=!!e.hasLabelVerticalOffset,n=e.verticalOffset,a=new P1t(n,r,s);return this._calculatePlacementOffsets(a,i)}get _verticalOffsetPlacement(){const e=this._class.labelPlacement,{_symbol:i,_graphic:r}=this,s=SX(r.graphics3DSymbol),n=s?.symbol.type==="point-3d"?s.symbol:null,a=Vh[e]||this._defaultPlacementInfo;return n?.supportsCallout()&&n.hasVisibleVerticalOffset()&&!r.isDraped?{placement:null,hasLabelVerticalOffset:!1,verticalOffset:n.verticalOffset.clone(),anchor:null,normalizedOffset:null}:!i?.hasVisibleVerticalOffset()||n!=null&&n.supportsCallout()&&n.verticalOffset&&!r.isDraped?{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}:a&&V1t(a.placement)?{placement:"above-center",verticalOffset:i.verticalOffset.clone(),anchor:"bottom",normalizedOffset:[0,a.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(mA().errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+e+" placement)"),null)}_getPlacementInfo(e){if(e.anchor)return e;const i=this._class.labelPlacement,r=Vh[i],s=r||this._defaultPlacementInfo;return i&&!r&&mA().warnOnce(`the requested label placement '${i}' is currently unsupported in SceneView.`),this._validatePlacementInfo(s)}_calculatePlacementOffsets(e,i){const r=this._graphic.graphic.geometry;if(r==null)return null;switch(r.type){case"point":this._setPointSpecificPlacement(e,i);break;case"mesh":this._setMeshSpecificPlacement(e,i);break;case"polygon":this._setPolygonSpecificPlacement(e,i)}const s=O1t-pV;return e.screenOffset[0]+=s*i.normalizedOffset[0],e.screenOffset[1]+=s*i.normalizedOffset[1],e}get _defaultPlacementInfo(){const e=this._graphic.graphic.geometry;if(e==null)return null;switch(e.type){case"polyline":case"extent":case"multipoint":return{placement:"center-center",normalizedOffset:Kn,anchor:"center"};case"polygon":return this._firstSymbolLayer?.type==="extrude"?Vh["above-center"]:{placement:"center-center",normalizedOffset:Kn,anchor:"center"};case"point":case"mesh":return Vh["above-center"];default:return}}_validatePlacementInfo(e){const i=this._graphic.graphic.geometry;if(i==null)return null;if(this._disablePlacement!=null){const s=this._class.labelPlacement;return s?(mA().warnOncePerTick(aye(s,this._disablePlacement.logEntityDescription)),this._defaultPlacementInfo):e}const r=i.type;switch(r){case"polyline":case"polygon":case"extent":case"multipoint":{const s=this._class.labelPlacement;if(s)return Vh[s]&&mA().warnOnce(aye(s,`'${r}' geometries`)),this._defaultPlacementInfo;break}case"point":case"mesh":return e}return e}_setPointSpecificPlacement(e,i){const r=this._firstSymbolLayer;if(r==null)return;const s=this._graphic.layers[0];switch(s!=null?s.getCenterObjectSpace(e.translation):ve(e.translation,0,0,0),r.type){case"icon":case"text":this._setHUDSpecificPlacement(e,i,s);break;case"object":oG(e,i,s)}}_setMeshSpecificPlacement(e,i){const r=this._firstSymbolLayer;r!=null&&r.type==="fill"&&oG(e,i,this._graphic.layers[0])}_setPolygonSpecificPlacement(e,i){const r=this._firstSymbolLayer;if(r!=null&&r.type==="extrude"){const s=this._graphic.layers[0];s!=null?(s.getBoundingBoxObjectSpace(uR),zte(uR,e.translation),e.translation[2]=Zv(uR)/2):ve(e.translation,0,0,0),oG(e,i,s)}}_setHUDSpecificPlacement(e,i,r){const{_graphic:s}=this,n=r!=null?r.getScreenSize():null;if(s.isDraped||n==null)e.hasLabelVerticalOffset||e.anchor==="center"||(Vh[this._class.labelPlacement]&&mA().warnOncePerTick(`the requested placement '${i.placement}' is currently unsupported for draped graphics`),e.anchor="center");else{const a=this._normalizedSymbolAnchorPos;e.screenOffset[0]=n[0]/2*(i.normalizedOffset[0]-a[0]);const o=n[1]/2*(i.normalizedOffset[1]-a[1]);e.hasLabelVerticalOffset?(e.centerOffset[1]=o,e.centerOffsetUnits="screen"):e.screenOffset[1]=o}}get _firstSymbolLayer(){const e=this._graphic.graphics3DSymbol,i=SX(e);return i!=null?i.symbol.symbolLayers.at(0):null}get _normalizedSymbolAnchorPos(){const e=this._graphic.layers[0],i=e?.stageObject.geometries[0].material??null;if(i&&i instanceof Xie){const r=i.parameters.anchorPosition;gA[0]=2*(r[0]-.5),gA[1]=2*(r[1]-.5)}else gA[0]=0,gA[1]=0;return gA}};function aye(t,e){return`the requested label placement '${t}' is currently unsupported for ${e} in SceneView.`}function oG(t,e,i){const r=i!=null?i.getBoundingBoxObjectSpace(uR):uR,s=Ge(r[3]-r[0],r[4]-r[1],r[5]-r[2]),n=Math.sqrt(s[0]*s[0]+s[1]*s[1]);t.centerOffset[0]=n/2*e.normalizedOffset[0];const a=t.translation[2],o=s[2]/2*e.normalizedOffset[1];t.translation[2]=0,t.elevationOffset=a+o;const l=Le(s);t.centerOffset[2]=l/2*e.normalizedOffset[2]}function V1t(t){return t==="above-center"}const Vh={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},oye={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const t in oye){const e=oye[t],i=Vh[t];e.forEach(r=>{Vh[r]=i})}Object.freeze&&(Object.freeze(Vh),Object.keys(Vh).forEach(t=>{Object.freeze(Vh[t]),Object.freeze(Vh[t]?.normalizedOffset)}));const gA=[0,0],uR=ul(),KZt=Object.freeze({left:0,center:.5,right:1}),eYt=Object.freeze({"bottom-left":vs(0,0),bottom:vs(.5,0),"bottom-right":vs(1,0),left:vs(0,.5),center:vs(.5,.5),right:vs(1,.5),"top-left":vs(0,1),top:vs(.5,1),"top-right":vs(1,1)});function U1t(t){switch(t){case"left":return 0;case"right":return 2;default:return 1}}function lye(t){switch(t){case"bottom-left":case"left":case"top-left":return"left";case"bottom":case"center":case"top":return"center";case"bottom-right":case"right":case"top-right":return"right"}}function B1t(t){switch(t){case"bottom-left":case"bottom":case"bottom-right":return"bottom";case"left":case"center":case"right":return"center";case"top-left":case"top":case"top-right":return"top"}}function tYt(t,e){switch(e){case"bottom":return t==="left"?"bottom-left":t==="right"?"bottom-right":"bottom";case"center":return t;case"top":return t==="left"?"top-left":t==="right"?"top-right":"top"}}function iYt(t){return t==="middle"?"center":t}function rYt(t,e){switch(t){case"top":return Cr(e,0,pV);case"bottom":return Cr(e,0,-pV);default:return ko(e,$v)}}const o4e="arial-unicode-ms",cye="woff2",uye=new Map,l4e=new Set;let j1t=class{constructor(e,i){this.fontFace=e,this.promise=i}};async function q1t(t){const e=Z1t(t),i=W1t(t),r=uye.get(e);if(r)return r.promise;const s=new FontFace(t.family,`url('${fr.fontsUrl}/woff2/${i}.${cye}') format('${cye}')`,{style:t.style,weight:t.weight}),n=document.fonts;if(n.has(s)&&s.status==="loading")return s.loaded;const a=s.load().then(()=>(n.add(s),s));return uye.set(e,new j1t(s,a)),l4e.add(s),a}function G1t(t){return l4e.has(t)}function H1t(t){if(!t)return o4e;const e=t.toLowerCase().split(" ").join("-");switch(e){case"serif":return"noto-serif";case"sans-serif":return"arial-unicode-ms";case"monospace":return"ubuntu-mono";case"fantasy":return"cabin-sketch";case"cursive":return"redressed";default:return e}}function W1t(t){const e=c4e(t)+u4e(t);return H1t(t.family)+(e.length>0?e:"-regular")}function Z1t(t){const e=c4e(t)+u4e(t);return(t.family||o4e)+(e.length>0?e:"-regular")}function c4e(t){if(!t.weight)return"";switch(t.weight.toLowerCase()){case"bold":case"bolder":return"-bold"}return""}function u4e(t){if(!t.style)return"";switch(t.style.toLowerCase()){case"italic":case"oblique":return"-italic"}return""}let Y1t=class h4e{constructor(e){this.definition=e,this.key=JSON.stringify(e),this.haloSize=Math.round(e.halo.size),this.textStyle=hye(e.color),this.haloStyle=Q1t(e.halo.color),this.backgroundStyle=e.background.color[3]!==0?hye(e.background.color):null}fontString(e){const i=this.definition.font;return`${i.style} ${i.weight} ${e}px ${i.family}, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol, Noto Color Emoji`}setFontProperties(e,i){e.font=this.fontString(i),e.textAlign="left",e.textBaseline="alphabetic"}static async fromSymbol(e,i){const r=e?.material?.color,s=mt.toUnitRGBA(r)??tn,n=e.size!=null?Bx(e.size):12,a=e.lineHeight,o=e.background!=null?mt.toUnitRGBA(e.background.color):tn,l={family:e.font?.family??"sans-serif",decoration:e.font?.decoration??"none",weight:e.font?.weight??"normal",style:e.font?.style??"normal"},c=e.halo,h=c?.color!=null&&c.size>0?{size:Bx(c.size),color:mt.toUnitRGBA(c.color)}:{size:0,color:tn},f=new h4e({color:s,size:n,background:{color:o,padding:e.background!=null?[.65*n,.5*n]:[0,0],borderRadius:e.background!=null?n*(6/16):0},lineSpacingFactor:a,font:l,halo:h,pixelRatio:i});if(e.font){let y=!1;const _=f.fontString(n);try{y=(await document.fonts.load(_)).some(w=>!G1t(w))}catch{fe.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters").warnOnce(`Failed to preload font '${_}'. Some text symbology may be rendered using the default browser font.`)}if(!y&&!X1t.has(e.font.family))try{await q1t(e.font)}catch{}}return f}};function Q1t(t){return`rgb(${t.slice(0,3).map(e=>Math.floor(255*e)).toString()})`}function hye(t){return`rgba(${t.slice(0,3).map(e=>Math.floor(255*e)).toString()},${t[3]})`}const X1t=new Set(["Arial","Times New Roman","Courier New","serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"]),F_=16;function Iv(t,e){return e=Math.floor(e/F_)*F_,Math.min(Math.round(t/F_)*F_,e)}function lG(t,e){return e=Math.floor(e/F_)*F_,Math.min(Math.ceil(t/F_)*F_,e)}function J1t(t,e){const[i,r]=d4e(t,e);return t.width===i&&t.height===r?t:p4e(t,i,r)}function d4e({width:t,height:e},{maxPreferredTexturePixels:i,maxTextureSize:r}){const s=Math.max(t,e),n=t*e;if(s<=r&&n<=i)return[t,e];const a=Math.min(Math.sqrt(i/n),r/s);return[Iv(Math.round(t*a),r),Iv(Math.round(e*a),r)]}function p4e(t,e,i){if(t instanceof ImageData)return p4e(K1t(t),e,i);const r=document.createElement("canvas");return r.width=e,r.height=i,r.getContext("2d").drawImage(t,0,0,r.width,r.height),r}function K1t(t){const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const i=e.getContext("2d");if(i==null)throw new ee("texture:context-failed","Failed to create 2d context from HTMLCanvasElement");return i.putImageData(t,0,0),e}const D0=4096;let M3=class extends Me{constructor(e){super(e),this.id=ql(),this.events=new Ey,this._glTexture=null,this._atlas=new tbt(256,256),this._needsRepack=!1,this._canRepack=!0,this._elementsToRender=new Map,this._elements=new Map,this._uvCallbacks=new Map,this.updating=!1}initialize(){this._canvas=document.createElement("canvas"),this._canvas.setAttribute("id","textAtlasCanvas"),this._canvas.setAttribute("style","display:none"),this._ctx=this._canvas.getContext("2d"),this._stage=this.view.stage,this._stage.addTexture(this),this._updateCanvasElementSize(this._atlas),this._reset()}unload(){this._glTexture=Rt(this._glTexture),this._frameWorker=Ki(this._frameWorker),this.updating=!1,this.events.emit("unloaded")}get loaded(){return this._glTexture!=null}get glTexture(){return this._glTexture}static get maxSize(){return hR=0,[D0-I0-hR,D0-I0-hR-dye]}load(e){if(this._glTexture)return this._glTexture;const i=new Zi;return i.wrapMode=33071,i.samplingMode=9987,i.hasMipmap=!0,i.preMultiplyAlpha=!0,i.maxAnisotropy=e.parameters.maxMaxAnisotropy,this._glTexture=new Fi(e,i,this._canvas),this._frameWorker=this.view.resourceController.scheduler.registerTask(yt.TEXT_TEXTURE_ATLAS,this),this.setDirty(),this._glTexture}dispose(){this._elements.clear(),this._elementsToRender.clear(),this._frameWorker=Ki(this._frameWorker),this._glTexture&&(this._stage.removeTexture(this),this._glTexture=Rt(this._glTexture)),this._canvas.width=0,this._canvas.height=0,this._canvas=null,this._ctx=null}_updateCanvasElementSize(e){this._canvas.width=e.width,this._canvas.height=e.height}_resizeAtlas(e,i){const{width:r,height:s}=this._atlas;r===e&&s===i||(this._atlas.width=e,this._atlas.height=i,this._glTexture?.resize(e,i),this._glTexture?.updateData(0,0,0,r,s,this._canvas),this._updateCanvasElementSize(this._atlas),this._elements.forEach(n=>this._uvCallbacks.get(n.textRenderer.key)?.forEach(a=>a(n.uv))),this._reset())}_reset(){this._elementsToRender.clear(),this._atlas.reset(),this._needsRepack=!0,this.setDirty()}_addAtlasElement(e,i,r,s){const n=this._atlas;if(n.width<r||n.height<s)return!1;let a=n.cursors.get(s);if(!a){if(n.height<n.nextY+s)return!1;a=[new pye(n.nextY)],n.cursors.set(s,a),n.nextY+=s}let o=a.find(l=>n.width>=l.x+r);if(o==null){if(n.height<n.nextY+s)return!1;o=new pye(n.nextY),n.nextY+=s,a.push(o)}return e.setNewPosition(o),this._elements.set(i,e),this._elementsToRender.set(i,e),o.x+=r,!0}_ensureCallbacks(e){const i=this._uvCallbacks.get(e);if(i)return i;const r=new Set;return this._uvCallbacks.set(e,r),r}_addCallback(e,i){this._ensureCallbacks(e).add(i)}_removeCallback(e,i){const r=this._uvCallbacks.get(e);return!(!r?.delete(i)||r.size!==0)&&(this._uvCallbacks.delete(e),!0)}_processAddition(e){const i=e.textRenderer.key;if(this._needsRepack)return void this._elements.set(i,e);const r=this._atlas,s=e.textRenderer.renderedWidth,n=e.textRenderer.renderedHeight,a=s+I0,o=n+I0+dye;if(!this._addAtlasElement(e,i,a,o)){if(this._canRepack)this._reset();else if(r.width<a){const l=lG(Math.max(a,1.5*r.width),D0);this._resizeAtlas(l,r.height)}else{const l=r.nextY+o,c=lG(Math.max(l,1.5*r.height),D0);if(c>r.height)this._resizeAtlas(r.width,c);else if(r.width<D0){const h=lG(1.5*r.width,D0);this._resizeAtlas(h,r.height)}}this._elements.set(i,e)}}_renderElement(e){const i=e.commitNewPosition(),r=e.textRenderer;this._ctx.clearRect(i[0]-I0,i[1]-I0,r.renderedWidth+2*I0,r.renderedHeight+2*I0),r.render(this._ctx,i[0],i[1]),this._uvCallbacks.get(r.key)?.forEach(s=>s(e.uv))}get readyToRun(){return this.updating}runTask(e){if(this._glTexture==null)return ea;for(;this._needsRepack&&(this._canRepack||this._atlas.height<D0&&this._atlas.height<D0);){this._canRepack=this._needsRepack=!1;const i=this._elements;this._elements=new Map,i.forEach(r=>this._processAddition(r)),e.madeProgress()}if(this._elementsToRender.size>0){for(const[i,r]of this._elementsToRender){if(e.done)break;this._renderElement(r),this._elementsToRender.delete(i),e.madeProgress()}this._glTexture.setData(this._canvas)}this.updating=this._elementsToRender.size>0}addText(e,i){const r=e.key;this._addCallback(r,i);let s=this._elements.get(r);return s?ey(s.uv,tn)||i(s.uv):(s=new ebt(e),this._processAddition(s),this.setDirty()),{remove:()=>this._removeText(e,i)}}_removeText(e,i){const r=e.key;this._elements.get(r)&&this._removeCallback(r,i)&&(this._elements.delete(r),this._elementsToRender.delete(r),this._canRepack=!0)}setDirty(){this._glTexture&&(this.updating=!0)}get test(){}get usedMemory(){return(this._glTexture?.usedMemory??0)+(this._canvas?.width??0)*(this._canvas?.height??0)*4}};d([m({constructOnly:!0})],M3.prototype,"view",void 0),d([m({type:Boolean})],M3.prototype,"updating",void 0),M3=d([k("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],M3);const I0=2,dye=2;let ebt=class{constructor(e){this.textRenderer=e,this._uv=ri(),this._newPosition=[0,0]}get uv(){if(this._xOffset==null||this._yOffset==null)return tn;const{renderedWidth:e,renderedHeight:i}=this.textRenderer;return yr(this._uv,this._xOffset,this._yOffset+i,this._xOffset+e,this._yOffset)}setNewPosition(e){this._newPosition[0]=e.x,this._newPosition[1]=e.y}commitNewPosition(){return this._xOffset=this._newPosition[0],this._yOffset=this._newPosition[1],this._newPosition}get xOffset(){return this._xOffset}get yOffset(){return this._yOffset}},tbt=class{constructor(e,i){this.width=e,this.height=i,this.cursors=new Map,this.nextY=0}reset(){this.cursors.clear(),this.nextY=hR}},pye=class{constructor(e){this.y=e,this.x=hR}},hR=0;const ibt=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","transformationChanged","shaderTransformationChanged","visibilityChanged","occlusionChanged","highlightChanged","geometryAdded","geometryRemoved","attributesChanged"];let rbt=class f4e{get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}constructor(e,i){this.objectToBoundingSphere=e,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new ro,this._objectCount=0,i&&(i.maximumObjectsPerNode!==void 0&&(this._maximumObjectsPerNode=i.maximumObjectsPerNode),i.maximumDepth!==void 0&&(this._maximumDepth=i.maximumDepth))}destroy(){this._degenerateObjects.clear(),ro.clearPool(),$X[0]=null,xb.prune(),Sb.prune()}add(e){const i=Array.from(e);this._grow(i);const r=ro.acquire();for(const s of i)++this._objectCount,this._isDegenerate(s)?this._degenerateObjects.add(s):(r.init(this._root),this._add(s,r));ro.release(r)}remove(e,i=null){this._objectCount-=e.length;const r=ro.acquire();for(const s of e){const n=i??Mv(this.objectToBoundingSphere(s),dbt);UO(n[3])?(r.init(this._root),sbt(s,n,r)):this._degenerateObjects.delete(s)}ro.release(r),this._shrink()}update(e,i){if(!UO(i[3])&&this._isDegenerate(e))return;const r=hbt(e);this.remove(r,i),this.add(r)}forEachAlongRay(e,i,r){const s=Sp(e,i);k1(this._root,n=>{if(!abt(s,n))return!1;const a=n.node;return a.terminals.forAll(o=>{this._intersectsObject(s,o)&&r(o)}),a.residents!==null&&a.residents.forAll(o=>{this._intersectsObject(s,o)&&r(o)}),!0})}forEachAlongRayWithVerticalOffset(e,i,r,s){const n=Sp(e,i);k1(this._root,a=>{if(!obt(n,a,s))return!1;const o=a.node;return o.terminals.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&r(l)}),o.residents!==null&&o.residents.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&r(l)}),!0})}forEach(e){k1(this._root,i=>{const r=i.node;return r.terminals.forAll(e),r.residents!==null&&r.residents.forAll(e),!0}),this._degenerateObjects.forEach(e)}forEachDegenerateObject(e){this._degenerateObjects.forEach(e)}findClosest(e,i,r,s=()=>!0,n=1/0){let a=1/0,o=1/0,l=null;const c=cG(e,i),h=f=>{if(--n,!s(f))return;const y=this.objectToBoundingSphere(f);if(!D_(r,y))return;const _=g_(e,i,Ti(y)),w=_-y[3],x=_+y[3];w<a&&(a=w,o=x,l=f)};return fye(this._root,f=>{if(n<=0||!D_(r,f.bounds)||(le(lh,c,f.halfSize),xe(lh,lh,Ti(f.bounds)),g_(e,i,lh)>o))return!1;const y=f.node;return y.terminals.forAll(_=>h(_)),y.residents!==null&&y.residents.forAll(_=>h(_)),!0},e,i),l}forEachInDepthRange(e,i,r,s,n,a,o){let l=-1/0,c=1/0;const h={setRange:x=>{r===1?(l=Math.max(l,x.near),c=Math.min(c,x.far)):(l=Math.max(l,-x.far),c=Math.min(c,-x.near))}};h.setRange(s);const f=g_(i,r,e),y=cG(i,r),_=cG(i,-r),w=x=>{if(!o(x))return;const S=this.objectToBoundingSphere(x),$=g_(i,r,Ti(S))-f,A=$-S[3],M=$+S[3];A>c||M<l||!D_(a,S)||n(x,h)};fye(this._root,x=>{if(!D_(a,x.bounds)||(le(lh,y,x.halfSize),xe(lh,lh,Ti(x.bounds)),g_(i,r,lh)-f>c)||(le(lh,_,x.halfSize),xe(lh,lh,Ti(x.bounds)),g_(i,r,lh)-f<l))return!1;const S=x.node;return S.terminals.forAll($=>w($)),S.residents!==null&&S.residents.forAll($=>w($)),!0},i,r)}forEachNode(e){k1(this._root,i=>e(i.node,i.bounds,i.halfSize,i.depth))}forEachNeighbor(e,i){const r=Bf(i),s=gy(i,R()),n=l=>{const c=this.objectToBoundingSphere(l),h=Bf(c),f=r+h;return!(on(Ti(c),s)-f*f<=0)||e(l)};let a=!0;const o=l=>{a&&(a=n(l))};k1(this._root,l=>{const c=Bf(l.bounds),h=r+c;if(on(Ti(l.bounds),s)-h*h>0)return!1;const f=l.node;return f.terminals.forAll(o),a&&f.residents!==null&&f.residents.forAll(o),a}),a&&this.forEachDegenerateObject(o)}_intersectsObject(e,i){const r=this.objectToBoundingSphere(i);return!(r[3]>0)||fZ(r,e)}_intersectsObjectWithOffset(e,i,r){const s=this.objectToBoundingSphere(i);return!(s[3]>0)||fZ(r.applyToBoundingSphere(s),e)}_add(e,i){i.advanceTo(this.objectToBoundingSphere(e))?i.node.terminals.push(e):(i.node.residents.push(e),i.node.residents.length>this._maximumObjectsPerNode&&i.depth<this._maximumDepth&&this._split(i))}_split(e){const i=e.node.residents;e.node.residents=null;for(let r=0;r<i.length;r++){const s=ro.acquire().init(e);this._add(i.at(r),s),ro.release(s)}}_grow(e){if(mye(e,i=>this.objectToBoundingSphere(i),km),UO(km[3])&&!this._fitsInsideTree(km))if(m4e(this._root.node))Mv(km,this._root.bounds),this._root.halfSize=1.25*this._root.bounds[3],this._root.updateBoundsRadiusFromHalfSize();else{const i=this._rootBoundsForRootAsSubNode(km);this._placingRootViolatesMaxDepth(i)?this._rebuildTree(km,i):this._growRootAsSubNode(i),ro.release(i)}}_rebuildTree(e,i){pZ(hG,i.bounds),hG[3]=i.halfSize,mye([e,hG],s=>s,dG);const r=ro.acquire().init(this._root);this._root.initFrom(null,dG,dG[3]),this._root.increaseHalfSize(1.25),k1(r,s=>(this.add(s.node.terminals.data),s.node.residents!==null&&this.add(s.node.residents.data),!0)),ro.release(r)}_placingRootViolatesMaxDepth(e){const i=Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E;let r=0;return k1(this._root,s=>(r=Math.max(r,s.depth),r+i<=this._maximumDepth)),r+i>this._maximumDepth}_rootBoundsForRootAsSubNode(e){const i=e[3],r=e;let s=-1/0;const n=this._root.bounds,a=this._root.halfSize;for(let l=0;l<3;l++){const c=n[l]-a-(r[l]-i),h=r[l]+i-(n[l]+a),f=Math.max(0,Math.ceil(c/(2*a))),y=Math.max(0,Math.ceil(h/(2*a)))+1,_=2**Math.ceil(Math.log(f+y)*Math.LOG2E);s=Math.max(s,_),FL[l].min=f,FL[l].max=y}for(let l=0;l<3;l++){let c=FL[l].min,h=FL[l].max;const f=(s-(c+h))/2;c+=Math.ceil(f),h+=Math.floor(f);const y=n[l]-a-c*a*2;uG[l]=y+(h+c)*a}const o=s*a;return uG[3]=o*y4e,ro.acquire().initFrom(null,uG,o,0)}_growRootAsSubNode(e){const i=this._root.node;pZ(km,this._root.bounds),km[3]=this._root.halfSize,this._root.init(e),e.advanceTo(km,null,!0),e.node.children=i.children,e.node.residents=i.residents,e.node.terminals=i.terminals}_shrink(){for(;;){const e=this._findShrinkIndex();if(e===-1)break;this._root.advance(e),this._root.depth=0}}_findShrinkIndex(){if(this._root.node.terminals.length!==0||this._root.isLeaf())return-1;let e=null;const i=this._root.node.children;let r=0,s=0;for(;s<i.length&&e==null;)r=s++,e=i[r];for(;s<i.length;)if(i[s++])return-1;return r}_isDegenerate(e){return!UO(this.objectToBoundingSphere(e)[3])}_fitsInsideTree(e){const i=this._root.bounds,r=this._root.halfSize;return e[3]<=r&&e[0]>=i[0]-r&&e[0]<=i[0]+r&&e[1]>=i[1]-r&&e[1]<=i[1]+r&&e[2]>=i[2]-r&&e[2]<=i[2]+r}toJSON(){const{maximumDepth:e,maximumObjectsPerNode:i,_objectCount:r}=this,s=this._nodeToJSON(this._root.node);return{maximumDepth:e,maximumObjectsPerNode:i,objectCount:r,root:{bounds:this._root.bounds,halfSize:this._root.halfSize,depth:this._root.depth,node:s}}}_nodeToJSON(e){const i=e.children.map(n=>n?this._nodeToJSON(n):null),r=e.residents?.map(n=>this.objectToBoundingSphere(n)),s=e.terminals?.map(n=>this.objectToBoundingSphere(n));return{children:i,residents:r,terminals:s}}static fromJSON(e){const i=new f4e(r=>r,{maximumDepth:e.maximumDepth,maximumObjectsPerNode:e.maximumObjectsPerNode});return i._objectCount=e.objectCount,i._root.initFrom(e.root.node,e.root.bounds,e.root.halfSize,e.root.depth),i}};var kh;let ro=(kh=class{constructor(){this.bounds=ms(),this.halfSize=0,this.initFrom(null,null,0,0)}init(e){return this.initFrom(e.node,e.bounds,e.halfSize,e.depth)}initFrom(e,i,r,s=this.depth){return this.node=e??kh.createEmptyNode(),i&&Mv(i,this.bounds),this.halfSize=r,this.depth=s,this}increaseHalfSize(e){this.halfSize*=e,this.updateBoundsRadiusFromHalfSize()}updateBoundsRadiusFromHalfSize(){this.bounds[3]=this.halfSize*y4e}advance(e){let i=this.node.children[e];i||(i=kh.createEmptyNode(),this.node.children[e]=i),this.node=i,this.halfSize/=2,this.depth++;const r=g4e[e];return this.bounds[0]+=r[0]*this.halfSize,this.bounds[1]+=r[1]*this.halfSize,this.bounds[2]+=r[2]*this.halfSize,this.updateBoundsRadiusFromHalfSize(),this}advanceTo(e,i,r=!1){for(;;){if(this.isTerminalFor(e))return i?.(this,-1),!0;if(this.isLeaf()){if(!r)return i?.(this,-1),!1;this.node.residents=null}const s=this._childIndex(e);i?.(this,s),this.advance(s)}}isLeaf(){return this.node.residents!=null}isTerminalFor(e){return e[3]>this.halfSize/2}_childIndex(e){const i=this.bounds;return(i[0]<e[0]?1:0)+(i[1]<e[1]?2:0)+(i[2]<e[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new _i({shrink:!0}),residents:new _i({shrink:!0})}}static acquire(){return kh._pool.acquire()}static release(e){kh._pool.release(e)}static clearPool(){kh._pool.prune()}},kh._pool=new Wl(()=>new kh),kh);function k1(t,e){let i=ro.acquire().init(t);const r=[i];for(;r.length!==0;){if(i=r.pop(),e(i)&&!i.isLeaf())for(let s=0;s<i.node.children.length;s++)i.node.children[s]&&r.push(ro.acquire().init(i).advance(s));ro.release(i)}}function fye(t,e,i,r=1){let s=ro.acquire().init(t);const n=[s];for(ubt(i,r,yye);n.length!==0;){if(s=n.pop(),e(s)&&!s.isLeaf())for(let a=7;a>=0;--a){const o=yye[a];s.node.children[o]&&n.push(ro.acquire().init(s).advance(o))}ro.release(s)}}function sbt(t,e,i){xb.clear();const r=i.advanceTo(e,(s,n)=>{xb.push(s.node),xb.push(n)})?i.node.terminals:i.node.residents;if(r.removeUnordered(t),r.length===0)for(let s=xb.length-2;s>=0&&nbt(xb.data[s],xb.data[s+1]);s-=2);}function nbt(t,e){return e>=0&&(t.children[e]=null),!!m4e(t)&&(t.residents===null&&(t.residents=new _i({shrink:!0})),!0)}function abt(t,e){return fV(Ti(e.bounds),2*-e.halfSize,_u),fV(Ti(e.bounds),2*e.halfSize,vu),QAe(t.origin,t.direction,_u,vu)}function obt(t,e,i){return fV(Ti(e.bounds),2*-e.halfSize,_u),fV(Ti(e.bounds),2*e.halfSize,vu),i.applyToMinMax(_u,vu),QAe(t.origin,t.direction,_u,vu)}function m4e(t){if(t.terminals.length!==0)return!1;if(t.residents!==null)return t.residents.length===0;for(let e=0;e<t.children.length;e++)if(t.children[e])return!1;return!0}function lbt(t,e){t[0]=Math.min(t[0],e[0]-e[3]),t[1]=Math.min(t[1],e[1]-e[3]),t[2]=Math.min(t[2],e[2]-e[3])}function cbt(t,e){t[0]=Math.max(t[0],e[0]+e[3]),t[1]=Math.max(t[1],e[1]+e[3]),t[2]=Math.max(t[2],e[2]+e[3])}function fV(t,e,i){i[0]=t[0]+e,i[1]=t[1]+e,i[2]=t[2]+e}function mye(t,e,i){_u[0]=1/0,_u[1]=1/0,_u[2]=1/0,vu[0]=-1/0,vu[1]=-1/0,vu[2]=-1/0;for(const r of t){const s=e(r);UO(s[3])&&(lbt(_u,s),cbt(vu,s))}_M(i,Wi(pbt,_u,vu,.5)),i[3]=Math.max(vu[0]-_u[0],vu[1]-_u[1],vu[2]-_u[2])/2}function ubt(t,e,i){if(!Sb.length)for(let r=0;r<8;++r)Sb.push({index:0,distance:0});for(let r=0;r<8;++r){const s=g4e[r];Sb.data[r].index=r,Sb.data[r].distance=g_(t,e,s)}Sb.sort((r,s)=>r.distance-s.distance);for(let r=0;r<8;++r)i[r]=Sb.data[r].index}function cG(t,e){let i,r=1/0;for(let s=0;s<8;++s){const n=g_(t,e,gye[s]);n<r&&(r=n,i=gye[s])}return i}function g_(t,e,i){return e*(t[0]*i[0]+t[1]*i[1]+t[2]*i[2])}function UO(t){return!isNaN(t)&&t!==-1/0&&t!==1/0&&t>0}const g4e=[Ge(-1,-1,-1),Ge(1,-1,-1),Ge(-1,1,-1),Ge(1,1,-1),Ge(-1,-1,1),Ge(1,-1,1),Ge(-1,1,1),Ge(1,1,1)],gye=[Ge(-1,-1,-1),Ge(-1,-1,1),Ge(-1,1,-1),Ge(-1,1,1),Ge(1,-1,-1),Ge(1,-1,1),Ge(1,1,-1),Ge(1,1,1)],y4e=Math.sqrt(3),$X=[null];function hbt(t){return $X[0]=t,$X}const uG=ms(),lh=R(),_u=R(),vu=R(),xb=new _i,dbt=ms(),km=ms(),hG=ms(),dG=ms(),FL=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],Sb=new _i,yye=[0,0,0,0,0,0,0,0],pbt=R();let _4e=class{constructor(e,i,r=""){this.stage=e,this.apiLayerViewUid=r,this.id=ql(),this.events=new Ey,this.visible=!0,this.sliceable=!1,this._objectsAdded=new Array,this._handles=new Fv,this._objects=new Map,this._pickable=!0,this.visible=i?.visible??!0,this._pickable=i?.pickable??!0,this.updatePolicy=i?.updatePolicy??0,e.addLayer(this);for(const s of ibt)this._handles.add(this.events.on(s,n=>e.handleEvent(s,n)))}destroy(){this._handles.size&&(this._handles.destroy(),this.stage.removeLayer(this),this.invalidateSpatialQueryAccelerator())}get objects(){return this._objects}getObject(e){return this._objects.get(e)}set pickable(e){this._pickable=e}get pickable(){return this._pickable&&this.visible}add(e){this._objects.set(e.id,e),e.layer=this,this.events.emit("layerObjectAdded",e),this._octree!=null&&this._objectsAdded.push(e)}remove(e){this._objects.delete(e.id)&&(this.events.emit("layerObjectRemoved",e),e.layer=null,this._octree!=null&&(Ul(this._objectsAdded,e)||this._octree.remove([e])))}addMany(e){for(const i of e)this._objects.set(i.id,i),i.layer=this;this.events.emit("layerObjectsAdded",e),this._octree!=null&&this._objectsAdded.push(...e)}removeMany(e){const i=new Array;for(const r of e)this._objects.delete(r.id)&&i.push(r);if(i.length!==0&&(this.events.emit("layerObjectsRemoved",i),i.forEach(r=>r.layer=null),this._octree!=null)){for(let r=0;r<i.length;)Ul(this._objectsAdded,i[r])?(i[r]=i[i.length-1],i.length-=1):++r;this._octree.remove(i)}}commit(){this.stage.commitLayer(this)}sync(){this.updatePolicy!==1&&this.stage.syncLayer(this.id)}notifyObjectBBChanged(e,i){this._octree==null||this._objectsAdded.includes(e)||this._octree.update(e,i)}getSpatialQueryAccelerator(){return this._octree==null&&this._objects.size>50?(this._octree=new rbt(e=>e.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.values())):this._octree!=null&&this._objectsAdded.length>0&&(this._octree.add(this._objectsAdded),this._objectsAdded.length=0),this._octree}invalidateSpatialQueryAccelerator(){this._octree=Re(this._octree),this._objectsAdded.length=0}get test(){}};function uYt(t){return t&&typeof t.highlight=="function"}function fbt(t){return t&&typeof t.maskOccludee=="function"}function CX(t,e,i){return t==null||t>=i&&(e===0||t<=e)}function mbt(t,e){if(e&&t){const{minScale:i,maxScale:r}=t;if(v4e(i,r))return CX(e,i,r)}return!0}function v4e(t,e){return t!=null&&t>0||e!=null&&e>0}function hYt(t){return!t?.minScale||!t.maxScale||t.minScale>=t.maxScale}const xF=()=>!ie("disable-feature:layer-based-scale-visibility");function dYt(t,e,i){return new ee("layerview:spatial-reference-incompatible",`The spatial reference of this ${t} (wkid: ${e??"undefined"}) is incompatible with the spatial reference of the view (wkid: ${i??"undefined"}).`,{})}let _ye=class{constructor(e,i){this.labelingContext=e,this.graphics3DGraphic=i,this.hasGraphics3DResources=!1,this.visible=!1,this.textureAtlasHandles=[],this.textInitialized=!1,this.textRenderers=new Array,this.textLabelPlacements=new Array}},gbt=class{constructor(e,i,r,s,n){this.labelClass=e,this.graphics3DSymbol=i,this.graphics3DCalloutSymbolLayer=r,this.textRenderParameters=s,this.labelFunction=n,this.calloutSymbolLayerIndex=0,this.graphics=new Map,this.scaleVisibility=null}},ybt=class{constructor(e,i,r,s,n,a,o,l){this.layer=i,this.graphics3DCore=r,this.scaleVisibility=s,this.emptySymbolLabelSupported=n,this.elevationInfoOverride=a,this.disablePlacement=o,this.active=l,this.labelClassAbortController=new AbortController,this._labelClassContexts=new Array,this.graphics=new Map,this.labelsToInitialize=new Map,this.stageLayer=new _4e(e,{pickable:!0},r.owner.layerViewUid)}destroy(){this.stageLayer.destroy()}get labelClassContexts(){return this._labelClassContexts}setLabelClassContext(e,i){this._labelClassContexts[e]=i}resetLabelClassContext(){this._labelClassContexts.length=0}},Tb=class extends Me{constructor(e){super(e),this._hudMaterials=new Map,this._calloutMaterials=new Map,this._dirty=!1,this._focusAreasLabelsQueue=new bC,this._labels=new Map,this._labelingContexts=new Array}setup(){this.dispose(),this.addHandles([K(()=>this.view.state?.camera,()=>this.setDirty()),K(()=>this.view.state?.rasterPixelRatio,()=>this._resetAllLabels()),K(()=>this.view.focusAreasView?.polygons,()=>this._updateFocus()),this.view.resourceController.scheduler.registerTask(yt.LABELER,this)]),xF()&&this.addHandles(K(()=>this.view.scale,()=>this._updateScaleVisibility())),this._textTextureAtlas=new M3({view:this.view})}dispose(){this.removeAllHandles(),this._textTextureAtlas=Rt(this._textTextureAtlas),this._hudMaterials.clear(),this._calloutMaterials.clear(),this._labelingContexts.length=0,this._labels.clear()}destroy(){this.dispose(),Td.graphic=null,Td.renderingInfo=null,Td.layer=null}_updateFocus(){this._focusAreasLabelsQueue.clear(),this._labelingContexts.forEach(e=>{e.graphics.forEach(i=>{this._focusAreasLabelsQueue.push({graphic3DGraphic:i,labelingContext:e})})})}_activateLabelingContext(e){e.graphics.forEach((i,r)=>{const s=new _ye(e,i);this._labels.set(r,s),e.labelsToInitialize.set(r,s),i.setVisibilityFlag(16,1,!0)}),e.active=!0}_deactivateLabelingContext(e){e.graphics.forEach((i,r)=>{i.setVisibilityFlag(16,1,!1),this.setLabelGraphicVisibility(i,!1),i.clearLabelGraphics(),this._labels.delete(r)}),e.active=!1}_addLabelTextureToAtlas(e){if(this._textTextureAtlas)for(const i of e.graphics3DGraphic.labelLayers){if(!i.labelClass)continue;const r=e.textRenderers[i.labelClassContextIndex];r&&(e.textureAtlasHandles.push(this._textTextureAtlas.addText(r,s=>vbt(i.stageObject,s))),_bt(i.stageObject,r))}}_removeLabelTextureFromAtlas(e){e.textureAtlasHandles.forEach(i=>i.remove()),e.textureAtlasHandles.length=0}get readyToRun(){return this.view.ready&&(this._dirty||this.deconflictor.readyToRun||this._focusAreasLabelsQueue.length>0)}runTask(e){return this._updateLabels(e),this._applyFocusAreasUpdates(e),!this._dirty&&this.deconflictor.readyToRun&&this.deconflictor.runTask(e),ea}_updateLabels(e){if(this._dirty){this._dirty=!1;for(const i of this._labelingContexts)if(i.active){if(NL(i))this._dirty=!0;else if(pG(i.labelClassContexts)){if(i.labelClassContexts===null){this._deactivateLabelingContext(i);continue}this._createLabelClassContext(i),this._dirty=!0}else for(const[r,s]of i.labelsToInitialize)if(this._ensureGraphics3DResources(s)&&(this._labels.set(r,s),this.deconflictor.setDirty(),e.madeProgress()),(s.visible&&s.textInitialized||!s.visible&&s.hasGraphics3DResources)&&(i.labelsToInitialize.delete(r),e.madeProgress()),e.done){this._dirty=!0;break}}this._dirty||this.notifyChange("updating")}}_applyFocusAreasUpdates(e){for(;this._focusAreasLabelsQueue.length>0&&!e.done;){e.madeProgress();const{graphic3DGraphic:i,labelingContext:r}=this._focusAreasLabelsQueue.pop();if(i.labelLayers.length===0||!r.active)continue;const s=avt(i.graphic.geometry);if(s==null)continue;const n=this.view.focusAreasView?.containsGeometry(s)??!0;i.labelLayers.forEach(a=>{a.stageObject.geometries.some(o=>o.material.parameters.isFocused!==n)&&(this._removeGraphic(r,i),this._addGraphic(r,i),this.setDirty())})}this._focusAreasLabelsQueue.length===0&&(this.notifyChange("readyToRun"),this.notifyChange("updating"))}async _createLabelClassContextAsync(e){const i=e.labelClassAbortController?.signal;e.layer.when&&await e.layer.when(),st(i),e.scaleVisibility?.updateScaleRangeActive();const r=e.graphics3DCore,s=r.layer,n=s.labelingInfo?.filter(a=>!!a.symbol);!n||n.length===0||(await vte(n,async(a,o)=>{const l=a.symbol,c=SX(r.getOrCreateGraphics3DSymbol(l));if(c==null)return void fe.getLogger(this).error("Failed to create Graphics3DSymbol for label");await c.load(),st(i);let h=null;DMe(l)&&l.hasVisibleCallout()&&(h=Tvt(l,r.symbolCreationContext),await h.load(),st(i));const f=await Xf(Rgt(a,e.layer.fieldsIndex,this.view.spatialReference));if(st(i),f.ok===!0){const y=await this._createTextRenderParameters(c.symbol);st(i);const _=new gbt(a,c,h,y,f.value);this._updateLabelClassContextVisibility(_),e.setLabelClassContext(o,_)}else fe.getLogger(this).error(`Label expression failed to evaluate: ${f.error}`)}),st(i))}async _createLabelClassContext(e){return e.labelClassPromise==null&&(e.labelClassPromise=this._createLabelClassContextAsync(e).catch(i=>{if(Hr(i))throw i;e.resetLabelClassContext()}).then(()=>{e.labelClassAbortController=null,this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating")),e.labelClassPromise}async _createTextRenderParameters(e){const i=e.symbolLayers.at(0);return i?.type!=="text"?null:Y1t.fromSymbol(i,this.view.state.rasterPixelRatio)}_destroyLabelClassContext(e){for(const r of e.labelClassContexts)r&&--r.graphics3DSymbol.referenced;const i=e.labelClassAbortController;e.labelClassAbortController=new AbortController,ps(i),e.resetLabelClassContext(),e.labelClassPromise=null,this.notifyChange("updating")}_createTextSymbolGraphic(e,i,r,s,n,a){if(!this._textTextureAtlas)return null;const o=new R1t(r,lye(r.anchor),B1t(r.anchor),e.text,vs(e.displayWidth,e.displayHeight));return Td.graphic=i,Td.layer=s,Td.renderingInfo=null,n.createLabel(Td,o,this._hudMaterials,this._textTextureAtlas,()=>a.placement?.elevationOffset??null)}_createLineCalloutGraphic(e,i,r,s,n){Td.graphic=e,Td.layer=n;const a=s.screenOffset[0];return Td.renderingInfo=new xvt(null,i,s.translation,s.centerOffset,a,s.centerOffsetUnits,s.elevationOffset),r.createGraphics3DGraphic(Td,this._calloutMaterials)}_ensureGraphics3DResources(e){if(e.hasGraphics3DResources)return!1;const i=e.graphics3DGraphic;if(i.destroyed)return!1;this._ensureTextTextureResources(e);const r=e.labelingContext,s=r.labelClassContexts;if(pG(s)||!r.emptySymbolLabelSupported&&i.layers.length===0)return!1;let n=!1;const a=i.graphic,o=r.layer,l=VL(r.layer);for(let c=0;c<s.length;c++){const h=e.textRenderers[c],f=e.textLabelPlacements[c],y=s[c];if(h==null||f==null||y==null)continue;const _=y.graphics3DSymbol,w=bbt(_),x=_.symbolLayers[0];if(!x)continue;x.setElevationInfoOverride(r.elevationInfoOverride);const S=new nye(i,w,y.labelClass),$=this._createTextSymbolGraphic(h,a,f,o,x,S);if($==null)return!1;$.labelClass=y.labelClass,$.labelClassContextIndex=c,i.addLabelGraphic($,r.stageLayer),this.deconflictor.setPriority(i,y.textRenderParameters?.definition.size??0),i.setVisibilityFlag(16,1,l),i.setVisibilityFlag(16,2,y.scaleVisibility??!0),i.setVisibilityFlag(16,8,!1),xF()&&y.graphics.set(a.uid,i),n=!0;const A=y.graphics3DCalloutSymbolLayer;if(A&&f.hasLabelVerticalOffset){A.setElevationInfoOverride(r.elevationInfoOverride);const M=this._createLineCalloutGraphic(a,w,A,f,o);M!=null&&(y.calloutSymbolLayerIndex=i.labelLayers.length,i.addLabelGraphic(M,r.stageLayer))}break}return n&&r.scaleVisibility?.updateGraphicLabelScaleVisibility(i),e.hasGraphics3DResources=!0,!0}_destroyGraphics3DResources(e){const i=e.labelingContext.labelClassContexts;for(const r of e.graphics3DGraphic.labelLayers){if(r.labelClass==null)continue;i[r.labelClassContextIndex].graphics3DSymbol.symbolLayers[0]?.onRemoveGraphic(r)}e.graphics3DGraphic.clearLabelGraphics(),e.hasGraphics3DResources=!1}_ensureTextTextureResources(e){if(e.textInitialized)return;const i=e.labelingContext,r=i.labelClassContexts;if(pG(r))return;const s=e.graphics3DGraphic.graphic;for(let n=0;n<r.length;n++){const a=r[n];if(e.textRenderers[n]=null,e.textLabelPlacements[n]=null,a?.textRenderParameters==null)continue;const o=a.labelFunction;let l;if(o.type==="arcade")try{const $=o.needsHydrationToEvaluate()?Kmt(s,i.layer,null):s;l=o.evaluate($)}catch{l=null}else l=o.evaluate(s);if(l==null||l===""||/^\s+$/.test(l))continue;const c=a.graphics3DSymbol;if(!c.symbolLayers[0])continue;const h=e.graphics3DGraphic,f=c.symbol?.type==="label-3d"?c.symbol:null,y=a.labelClass,_=i.disablePlacement,w=new nye(h,f,y,_).placement;if(w==null)continue;const x=lye(w.anchor),S=U1t(x);e.textRenderers[n]=new z1t(l,S,a.textRenderParameters,M3.maxSize),e.textLabelPlacements[n]=w}e.textInitialized=!0}_destroyTextTextureResources(e){e.textInitialized=!1,e.textRenderers.length=0,e.textLabelPlacements.length=0}_addGraphic(e,i){const r=i.graphic.uid;if(e.graphics.set(r,i),e.active){const s=new _ye(e,i);this._labels.set(r,s),e.labelsToInitialize.set(r,s)}this.setDirty(),this.deconflictor.setDirty()}_updateGraphicGeometry(e,i){const r=i.graphic.uid,s=this._labels.get(r);if(!s)return!0;for(const n of s.graphics3DGraphic.labelLayers)if(n.labelClass!=null&&!e.labelClassContexts[n.labelClassContextIndex].graphics3DSymbol.symbolLayers[0].updateGeometry(i.graphic,n))return!1;return this.setDirty(),this.deconflictor.setDirty(),!0}_removeGraphic(e,i){const r=i.graphic.uid,s=this._labels.get(r);e.graphics.delete(r),e.labelClassContexts.forEach(n=>n?.graphics.delete(r)),s&&(this._destroyGraphic(s,r),e.labelsToInitialize.delete(r),this.setDirty(),this.deconflictor.setDirty())}_destroyGraphic(e,i){this._labels.delete(i),e.textureAtlasHandles.length&&this._removeLabelTextureFromAtlas(e),this._destroyTextTextureResources(e),e.hasGraphics3DResources&&this._destroyGraphics3DResources(e)}async _labelingInfoChange(e,i){if(!i)return this._visibilityInfoChange(e),this._resetLabels(e),this._createLabelClassContext(e);for(const r of i){const s=e.graphics.get(r);s&&(this._removeGraphic(e,s),this._addGraphic(e,s))}}_globalPropertyChanged(e,i){for(const r of i.labelClassContexts){if(!r)continue;const s=new Map;i.graphics.forEach(a=>s.set(a.graphic.uid,a));const n=a=>a.labelLayers[0];if(r.graphics3DSymbol.symbolLayers[0].globalPropertyChanged(e,s,n),r.graphics3DCalloutSymbolLayer){const a=o=>o.labelLayers[r.calloutSymbolLayerIndex];r.graphics3DCalloutSymbolLayer.globalPropertyChanged(e,s,a)}}}_visibilityInfoChange(e){const i=VL(e.layer);i&&!e.active&&this._activateLabelingContext(e),!i&&e.active&&this._deactivateLabelingContext(e),this.setDirty()}_resetAllLabels(){for(const e of this._labelingContexts)this._resetLabels(e)}_resetLabels(e){e.graphics.forEach((i,r)=>{const s=this._labels.get(r);s&&(this._destroyGraphic(s,r),s.visible=!1,e.labelsToInitialize.set(r,s))}),this._destroyLabelClassContext(e),this.setDirty(),this.deconflictor.setDirty()}_findLabelingContext(e){for(const i of this._labelingContexts)if(i.graphics3DCore===e)return i;return null}addGraphicsOwner(e,i,r){const s=r?.emptySymbolLabelSupported||!1,n=r?.elevationInfoOverride||null,a=r?.disablePlacement||null;if(this._findLabelingContext(e))return;const o=e.layer,l=new ybt(this.view.stage,o,e,i,s,n,a,VL(o));return this._labelingContexts.push(l),this.setDirty(),{addGraphic:c=>this._addGraphic(l,c),removeGraphic:c=>this._removeGraphic(l,c),updateGraphicGeometry:c=>this._updateGraphicGeometry(l,c),layerLabelsEnabled:()=>VL(l.layer),labelingInfoChange:c=>this._labelingInfoChange(l,c),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",l),screenSizePerspectiveEnabledChanged:()=>this._globalPropertyChanged("screenSizePerspectiveEnabled",l),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",l),visibilityInfoChange:()=>this._visibilityInfoChange(l),reset:()=>this._resetLabels(l),remove:()=>this._removeGraphicsOwner(e),setDirty:()=>this.setDirty()}}_removeGraphicsOwner(e){const i=this._findLabelingContext(e);if(!i)return;const r=this._labelingContexts.indexOf(i);this._labelingContexts.splice(r,1),i.graphics.forEach(s=>this._removeGraphic(i,s)),i.destroy(),this.setDirty()}_updateScaleVisibility(){for(const e of this._labelingContexts)if(e.active&&!NL(e))for(const i of e.labelClassContexts)this._updateLabelClassContextVisibility(i)}_updateLabelClassContextVisibility(e){if(!e||!xF())return;const{labelClass:i,graphics:r}=e,s={minScale:i.minScale,maxScale:i.maxScale},n=mbt(s,this.view.scale),a=e.scaleVisibility==null||e.scaleVisibility!==n;e.scaleVisibility=n,a&&r.size&&(r.forEach(o=>o.setVisibilityFlag(16,2,n)),this.deconflictor.setDirty(),this.setDirty())}setLabelGraphicVisibility(e,i){const r=e.graphic.uid,s=this._labels.get(r);s&&s.visible!==i&&(i&&!s.textureAtlasHandles.length?(this._addLabelTextureToAtlas(s),s.textInitialized||s.labelingContext.labelsToInitialize.set(r,s)):!i&&s.textureAtlasHandles.length&&this._removeLabelTextureFromAtlas(s),s.visible=i,this.setDirty())}setDirty(){!this._dirty&&this._labelingContexts.length>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._dirty||this._textTextureAtlas?.updating||this.deconflictor.updating||this._labelingContexts.some(e=>NL(e))||this._focusAreasLabelsQueue.length>0}get updatingProgress(){if(!this.updating||!this._textTextureAtlas)return 1;const e=this._labelingContexts.length>0?this._labelingContexts.reduce((i,r)=>i+(NL(r)?0:1),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*e+.5*this.deconflictor.updatingProgress}get usedMemory(){return this._textTextureAtlas?.usedMemory??0}get test(){}};function _bt(t,e){t.geometries[0].setAttributeData("size",[e.displayWidth,e.displayHeight]),t.geometryVertexAttributeUpdated(t.geometries[0],"size")}function vbt(t,e){t.geometries[0].setAttributeData("uvi",e),t.geometryVertexAttributeUpdated(t.geometries[0],"uvi",!0)}function NL(t){return!!t.labelClassPromise&&!!t.labelClassAbortController}function pG(t){return(t?.length??0)===0}function bbt(t){return t.symbol?.type==="label-3d"?t.symbol:null}function VL(t){return!!t.labelsVisible&&!!t.labelingInfo?.some(e=>!!e.symbol)}d([m({constructOnly:!0})],Tb.prototype,"view",void 0),d([m({constructOnly:!0})],Tb.prototype,"deconflictor",void 0),d([m()],Tb.prototype,"_textTextureAtlas",void 0),d([m({type:Boolean,readOnly:!0})],Tb.prototype,"updating",null),Tb=d([k("esri.views.3d.layers.graphics.Labeler")],Tb);const Td=new Svt(null,null,null);let wbt=class{constructor(e){this._layerView=e,this._lodGlobalDirty=!1}destroy(){this._index=null,this._lodGlobalHandling=null,this._removeNodes=null}startNodeLoading(e,i,r){this._maxLodLevel=r.maxLodLevel,this._index=i,this._removeNodes=e}shouldLoadNode(e){if(e==null)return!1;const i=this._index.nodeTraversalState(e);return!!this._isChosenMaxLOD(i)||!!i.isChosen&&this._childrenRequireLoading(e)}setLodGlobalDirty(){this._lodGlobalDirty=!0}get requiresLODGlobalHandling(){return this._index!=null&&this._lodGlobalDirty===!0}lodGlobalHandling(e){if(!this.requiresLODGlobalHandling)return!1;this._lodGlobalDirty=!1;const i=this._layerView.view.resourceController.memoryController.usedMemory,r=Math.max(0,Math.floor(10*(i-1)));Wp.clear(),this._lodGlobalHandling(this._index.rootNode,r,!1,!!this._layerView.nodeCrossfadingEnabled);const s=Wp.length;this._removeNodes(Wp,e);const n=Wp.length<s;return Wp.length!==0&&(this._lodGlobalDirty=!0),Wp.clear(),n}_lodGlobalHandling(e,i,r,s){if(e==null)return!1;const n=e.index,a=this._index,o=this._layerView,l=a.nodeTraversalState(e),c=this._isChosenMaxLOD(l),h=e.resources.isEmpty;if(c&&h)return e.childrenLoaded>0&&this._removeChildrenRecursive(e),!0;const f=o.isNodeLoaded(n);if(s&&f&&c){const $=!r&&this.hasNoVisibleChildren(e);o.fadeNode(n,0,!$)}const y=f&&(!o.isNodeFullyFadedIn||o.isNodeFullyFadedIn(n));if(f&&(o.updateNodeState(n,c?1:0),c))return y&&this._removeChildrenRecursive(e),y;const _=e.childCount>0;let w=_;if(_)for(let $=0;$<e.childCount;$++){const A=a.getChildIndex(n,$),M=a.getNode(A);M!=null?!a.isGeometryVisible(A)||this._lodGlobalHandling(M,i,r||y,s)||(w=!1):a.isNodeVisible(A)&&(w=!1)}const x=f&&!c&&(w||Wp.length<i);x&&Wp.push(n),!s||x||!f||r||w||o.fadeNode(n,0,!1);const S=e.resources.isEmpty;return w||y&&!x||S}_removeChildrenRecursive(e){this._index.traverseDescendants(e,i=>((this._layerView.isNodeLoaded(i.index)||this._layerView.isNodeReloading(i.index))&&Wp.push(i.index),i.childrenLoaded>0))}hasNoVisibleChildren(e){let i=!0;return this._index.traverseDescendants(e,r=>!(!i||!this._index.isNodeVisible(r.index))&&(this._layerView.isNodeLoaded(r.index)?(i=!1,!1):r.childrenLoaded>0)),i}_childrenRequireLoading(e){let i=!1,r=!0;return this._index.traverseDescendants(e,s=>{if(!r||!this._index.isNodeVisible(s.index))return!1;const n=this._index.nodeTraversalState(s);return this._isChosenMaxLOD(n)&&this._index.isGeometryVisible(s.index)&&(i=!0),this._layerView.isNodeLoaded(s.index)?(r=!1,!1):s.childrenLoaded>0}),r&&i}_isChosenMaxLOD(e){return e.isChosen&&(!e.nodeHasLOD||e.lodLevel===this._maxLodLevel)}static cleanupI3SLodHandling(){Wp.prune()}};const Wp=new _i({deallocator:null});let b4e=class{constructor(e="scene"){this.context=e,this.extent=cy(),this.spatialReference=null}};const xbt=1,vye=Symbol("layerHandles");let LS=class extends Uc{get spatialReference(){return this.view.spatialReference}constructor(e){super(e),this._elevationOffset=0}initialize(){this._renderCoordsHelper=this.view.renderCoordsHelper,this._intersectLayers=[this.stageLayer],this._intersector=new Vc(this.view.state.viewingMode),this._intersector.options.store=0;const e=this._computeLayerExtent(this.spatialReference,this.stageLayer);this._zmin=e[2],this._zmax=e[5];const i=this.stageLayer.events;this.addHandles([i.on(["layerObjectAdded","layerObjectRemoved","transformationChanged","shaderTransformationChanged"],r=>this._objectChanged(r)),i.on(["geometryAdded","geometryRemoved"],({object:r})=>this._objectChanged(r)),i.on("attributesChanged",({attribute:r,object:s})=>kDe(r)&&this._objectChanged(s))],vye)}destroy(){this.removeHandles(vye)}elevationInfoChanged(){const e=this.layer!=null?this.layer.elevationInfo:null;if(e!=null&&e.mode!=="on-the-ground"){const i=_p(this.layer.spatialReference),r=Sre(e.unit??"meters");this._elevationOffset=(e.offset??0)*r/i}else this._elevationOffset=0}getElevation(e,i,r,s){if(ml[0]=e,ml[1]=i,ml[2]=r,!this._renderCoordsHelper.toRenderCoords(ml,s,ml))return fe.getLogger(this).error("could not project point for elevation alignment"),null;const n=this._elevationOffset,a=this._zmin+n,o=this._zmax+n;this._renderCoordsHelper.setAltitude(bye,o,ml),this._renderCoordsHelper.setAltitude(wye,a,ml);const l=c=>!!c.lastValidElevationBB;return this._intersector.reset(bye,wye,null),this._intersector.intersect(this._intersectLayers,null,xbt,null,l),this._intersector.results.min.getIntersectionPoint(ml)?this._renderCoordsHelper.getAltitude(ml):null}_objectChanged(e){const i=this.spatialReference;if(!e.lastValidElevationBB||!i)return;Nc(zm);const r=e.lastValidElevationBB;r.isEmpty()||this._expandExtent(i,r.min,r.max,zm);const{min:s,max:n}=e.boundingVolumeWorldSpace;this._expandExtent(i,s,n,zm),Fte(zm,BO.extent),this._zmin=Math.min(this._zmin,zm[2]),this._zmax=Math.max(this._zmax,zm[5]),BO.spatialReference=i,this.emit("elevation-change",BO),BO.spatialReference=null,r.assignMinMax(s,n)}_computeLayerExtent(e,i){return Nc(zm),e!=null&&i.objects.forEach(r=>this._expandExtent(e,r.boundingVolumeWorldSpace.min,r.boundingVolumeWorldSpace.max,zm)),zm}_expandExtent(e,i,r,s){for(let n=0;n<8;++n)ml[0]=1&n?i[0]:r[0],ml[1]=2&n?i[1]:r[1],ml[2]=4&n?i[2]:r[2],this._renderCoordsHelper.fromRenderCoords(ml,ml,e),LC(s,ml);return s}};d([m({constructOnly:!0})],LS.prototype,"layer",void 0),d([m({constructOnly:!0})],LS.prototype,"stageLayer",void 0),d([m({constructOnly:!0})],LS.prototype,"view",void 0),d([m()],LS.prototype,"spatialReference",null),LS=d([k("esri.views.3d.layers.support.StageLayerElevationProvider")],LS);const zm=Nc(),BO=new b4e;function Sbt(){BO.spatialReference=null}const ml=R(),bye=R(),wye=R();let jO=class extends Me{get parameters(){return this._parameters}get labelParameters(){return this._labelParameters}get _calculations(){return this.view.state.isGlobal?new $bt(this.view.renderCoordsHelper?.referenceEllipsoid.radius??0):new Tbt}constructor(e){super(e),this._parameters=new Yme,this._labelParameters=new Yme}initialize(){this.addHandles([K(()=>({distance:this.view.pointsOfInterest?.centerOnSurfaceInfrequent?.distance??0,fovY:this.view.state.camera.fovY}),e=>this._update(e),At)])}_update(e){const i=this._updateParameters(this._parameters,SF,e),r=this._updateParameters(this._labelParameters,Mbt,e);return i||r}_updateParameters(e,i,r){if(e&&e.camera.fovY===r.fovY&&e.camera.distance===r.distance)return!1;const{scaleStart:s,scaleFallOffRange:n}=i,{fovY:a,distance:o}=r;this._calculations.calculateCurvatureDependentParameters(fG,i,r);const l=this._calculations.surfaceCoverageCompensation(r,fG),{tiltAngle:c,scaleFallOffFactor:h}=fG,f=Math.sin(c)*o,y=.5*Math.PI-c-a*(.5-s*l),_=f/Math.cos(y),w=y+a*n*l,x=(_-h*(f/Math.cos(w)))/(1-h);return e.camera.fovY=r.fovY,e.camera.distance=r.distance,e.offset=x,e.divisor=_-x,e.minPixelSize=i.minPixelSize,!0}};d([m({constructOnly:!0})],jO.prototype,"view",void 0),d([m()],jO.prototype,"_calculations",null),jO=d([k("esri.views.3d.state.ScreenSizePerspective")],jO);let Tbt=class{surfaceCoverageCompensation(e,i){return Z3e(i.tiltAngle,e.fovY)}calculateCurvatureDependentParameters(e,i){e.tiltAngle=i.curvatureDependent.min.tiltAngle,e.scaleFallOffFactor=i.curvatureDependent.min.scaleFallOffFactor}},$bt=class{constructor(e){this._ellipsoidRadius=e}surfaceCoverageCompensation(e,i){return l2(xye,this._ellipsoidRadius),ate(xye,i.tiltAngle,e.distance,e.fovY)}calculateCurvatureDependentParameters(e,i,r){const s=i.curvatureDependent,n=1+r.distance/this._ellipsoidRadius,a=Math.sqrt(n*n-1),[o,l]=[s.min.curvature,s.max.curvature],c=Se((a-o)/(l-o),0,1),[h,f]=[s.min,s.max];e.tiltAngle=ft(h.tiltAngle,f.tiltAngle,c),e.scaleFallOffFactor=ft(h.scaleFallOffFactor,f.scaleFallOffFactor,c)}},Cbt=class{constructor(){this.tiltAngle=0,this.scaleFallOffFactor=0}};const SF={curvatureDependent:{min:{curvature:Lt(10),tiltAngle:Lt(12),scaleFallOffFactor:.5},max:{curvature:Lt(70),tiltAngle:Lt(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},Mbt={...SF,curvatureDependent:{min:{...SF.curvatureDependent.min,scaleFallOffFactor:.7},max:{...SF.curvatureDependent.max,scaleFallOffFactor:.95}},minPixelSize:14},fG=new Cbt,xye=ms();let Qr=class extends Me{constructor(e){super(e),this._propertiesPool=new _y({camera:()=>new nr},this),this._lastSeenCameraProjectionValues=new nr,this.mode=0,this._cssCamera=new nr,this._camera=new nr,this.rasterPixelRatio=1,this.contentPixelRatio=1,this.constraints=new tg({state:this}),this.events=new Ey,this.fading=!1,this._cameraChanged=!1,this._updateQueue=new Array,this._processingUpdates=!1}reset(){this.cameraController=null,this._propertiesPool.destroy(),this._propertiesPool=new _y({camera:()=>new nr},this)}destroy(){this.cameraController=Re(this.cameraController),this._propertiesPool=Re(this._propertiesPool)}createInitialCamera(){if(this.viewingMode===1){const e=or(this.spatialReference).radius;this.camera=new nr({eye:Ge(4*e,0,0),center:Ge(e,0,0),up:Ge(0,0,1)})}else this.camera=new nr({eye:Ge(0,0,100),center:Ge(0,0,0),up:Ge(0,1,0)})}get animation(){return this.cameraController instanceof hD&&this.cameraController.viewAnimation!=null?this.cameraController.viewAnimation:null}get cssCamera(){const e=this._cssCamera.copyFrom(this.camera),{height:i,width:r,pixelRatio:s}=this.camera;return e.pixelRatio=1,e.height=Math.round(i/s),e.width=Math.round(r/s),e}get camera(){return this._camera}set camera(e){e!==ru&&ru.copyFrom(e),ru.computeUp(this.viewingMode),this.events.emit("before-camera-change",{camera:ru});const i=this._camera;if(Ebt(this._lastSeenCameraProjectionValues,ru)&&(this._lastSeenCameraProjectionValues.copyFrom(ru),this.events.emit("camera-projection-changed",this._lastSeenCameraProjectionValues)),!i.equals(ru)&&(this._camera=this._propertiesPool.get("camera").copyFrom(ru),this._cameraChanged=!i.almostEquals(ru),this._cameraChanged)){const r=Rwe(()=>{this._cameraChanged=!1,r.remove()})}}get pixelRatio(){return this.camera.pixelRatio}get alignPixelEnabled(){return this.pixelRatio===this.rasterPixelRatio&&this.mode===2}get updating(){return this.mode!==2}get contentCamera(){return this._contentCamera??this.camera}set contentCamera(e){if(e==null)return void(this._contentCamera=null);const i=e.clone();this.events.emit("before-camera-change",{camera:i,sceneDepthRange:Ua.Infinite}),this._contentCamera=i}get fixedContentCamera(){return this._contentCamera!=null}get isGlobal(){return this.viewingMode===1}get isLocal(){return this.viewingMode===2}get viewingMode(){return uQ(this.view.viewingMode)}get spatialReference(){return this.view.spatialReference}get highlights(){const e=this.view.highlights.items.slice(0,kst);for(let i=0;i<e.length;){const r=e[i],s=e.findIndex(n=>n.name===r.name);s>=0&&i>s?e.splice(i,1):++i}return e}get highlightOrderMap(){const e=new Map;return this.highlights.forEach((i,r)=>e.set(i.name,r)),e}get navigating(){return!!this.cameraController?.isInteractive}get stationary(){return!this._cameraChanged&&!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(e){this.stopActiveCameraController()?(this.removeHandles(Tye),this.cameraController?.destroy(),e&&(this.addHandles(Zs(()=>e.state===4||e.state===3,()=>{this.updateCamera(i=>e.onControllerEnd(i)),this.cameraController===e&&(this._set("cameraController",null),e.destroy())},{sync:!0,once:!0}),Tye),e.onControllerStart(this.camera)),this._set("cameraController",e)):e&&(e.state=1)}switchCameraController(e){this.cameraController=e}stopActiveCameraController(){return!this.cameraController||this.cameraController.stopController()}updateCamera(e){this._updateQueue.push(e),this._processUpdateQueue()}_processUpdateQueue(){if(this._updateQueue.length===0||this._processingUpdates)return;this._processingUpdates=!0;const e=this._updateQueue.shift();ru.copyFrom(this.camera),e(ru),this.camera=ru,this._processingUpdates=!1,this._processUpdateQueue()}static cleanupViewstate(){ru=new nr}};d([m({constructOnly:!0})],Qr.prototype,"view",void 0),d([m()],Qr.prototype,"mode",void 0),d([m({readOnly:!0,type:kC})],Qr.prototype,"animation",null),d([m({type:nr})],Qr.prototype,"cssCamera",null),d([m()],Qr.prototype,"_cssCamera",void 0),d([m({type:nr})],Qr.prototype,"camera",null),d([m()],Qr.prototype,"_camera",void 0),d([m({readOnly:!0})],Qr.prototype,"pixelRatio",null),d([m()],Qr.prototype,"rasterPixelRatio",void 0),d([m()],Qr.prototype,"contentPixelRatio",void 0),d([m({readOnly:!0})],Qr.prototype,"alignPixelEnabled",null),d([m({readOnly:!0})],Qr.prototype,"updating",null),d([m({})],Qr.prototype,"_contentCamera",void 0),d([m({type:nr})],Qr.prototype,"contentCamera",null),d([m({readOnly:!0})],Qr.prototype,"fixedContentCamera",null),d([m({readOnly:!0})],Qr.prototype,"events",void 0),d([m({readOnly:!0})],Qr.prototype,"isGlobal",null),d([m({readOnly:!0})],Qr.prototype,"isLocal",null),d([m({readOnly:!0})],Qr.prototype,"viewingMode",null),d([m({readOnly:!0})],Qr.prototype,"highlights",null),d([m({readOnly:!0})],Qr.prototype,"highlightOrderMap",null),d([m({readOnly:!0})],Qr.prototype,"navigating",null),d([m()],Qr.prototype,"fading",void 0),d([m({readOnly:!0})],Qr.prototype,"stationary",null),d([m()],Qr.prototype,"_cameraChanged",void 0),d([m()],Qr.prototype,"cameraController",null),Qr=d([k("esri.views.3d.state.ViewState")],Qr);const Sye=Qr;function Ebt(t,e){return t.fov!==e.fov||t.fullViewport[0]!==e.fullViewport[0]||t.fullViewport[1]!==e.fullViewport[1]||t.fullViewport[2]!==e.fullViewport[2]||t.fullViewport[3]!==e.fullViewport[3]||t.padding[0]!==e.padding[0]||t.padding[1]!==e.padding[1]||t.padding[2]!==e.padding[2]||t.padding[3]!==e.padding[3]}let ru=new nr;const Tye="ViewStateHandles";function qh(t){let e,i,r=[],s=!1;function n(...a){return s&&e===this&&Abt(a,r)||(i=t.apply(this,a),e=this,r=a,s=!0),i}return n}function Abt(t,e){if(t.length!==e.length)return!1;for(let i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}function w4e(t){return t?Jx:Fbt}function Obt(t,e){return e?.mode?e.mode:w4e(t).mode}function Pbt(t,e){return e??w4e(t)}function x4e(t,e){return Obt(t==null||(t.hasZ??!1),e)}function $Yt(t,e){return Pbt(t==null||(t.hasZ??!1),e)}function CYt(t){const e=T4e(t);return x4e(t.geometry,e)}function Dre(t){const e=T4e(t),i=x4e(t.geometry,e),r=e!=null&&i!=="on-the-ground"?C4e(e):0,s=e?.featureExpressionInfo;return{mode:i,offset:r,featureExpressionInfo:s}}function Rbt(t){return S4e(Dre(t))}function MYt(t){return S4e(t)||Dbt(t)}function Dbt(t){return t?.featureExpressionInfo?.expression==="0"}function S4e(t){if(!t||t.mode==="on-the-ground")return!1;const e=t?.featureExpressionInfo?t.featureExpressionInfo.expression:null;return!(!e||e==="0")}function T4e(t){return t.layer&&"elevationInfo"in t.layer?t.layer.elevationInfo:null}const Ibt=qh((t,e,i)=>{if(!t||e==="decimal-degrees")return 0;const r=e!=="unknown"&&e?e:"meters",s=t2e(i);return s?hi(t,r,s):0});function U8(t,e){return Ibt(t?.offset,t?.unit,e)}function EYt(t,e,i){if(!i?.mode)return;const r=t.hasZ?t.z:0,s=U8(i,t.spatialReference);switch(i.mode){case"absolute-height":return r-s;case"on-the-ground":return 0;case"relative-to-ground":return r-((e.elevationProvider.getElevation(t.x,t.y,r,t.spatialReference,"ground")??0)+s);case"relative-to-scene":return r-((e.elevationProvider.getElevation(t.x,t.y,r,t.spatialReference,"scene")??0)+s)}}function Lbt(t,e,i,r=null){return Ire(t,e.x,e.y,e.hasZ?e.z:0,e.spatialReference,i,r)}function $4e(t,e,i,r,s=null){return Ire(t,e[0],e[1],e.length>2?e[2]:0,i,r,s)}function Ire(t,e,i,r,s,n,a=null){if(n==null)return;const o=a!=null?a.mode:"absolute-height";if(o==="on-the-ground")return 0;const{absoluteZ:l}=kbt(e,i,r,s,t,n);return zbt(l,e,i,r,s,t,a,o)}function kbt(t,e,i,r,s,n){const a=U8(n,r);switch(n.mode){case"absolute-height":return{absoluteZ:i+a,elevation:0};case"on-the-ground":{const o=s.elevationProvider.getElevation(t,e,0,r,"ground")??0;return{absoluteZ:o,elevation:o}}case"relative-to-ground":{const o=s.elevationProvider.getElevation(t,e,i,r,"ground")??0;return{absoluteZ:i+o+a,elevation:o}}case"relative-to-scene":{const o=s.elevationProvider.getElevation(t,e,i,r,"scene")??0;return{absoluteZ:i+o+a,elevation:o}}}}function zbt(t,e,i,r,s,n,a,o){const l=U8(a,s);switch(o){case"absolute-height":return t-l;case"relative-to-ground":return t-((n.elevationProvider.getElevation(e,i,r,s,"ground")??0)+l);case"relative-to-scene":return t-((n.elevationProvider.getElevation(e,i,r,s,"scene")??0)+l)}}function AYt(t,e){if(e==null)return!1;const{mode:i}=e;return i!=null&&(t==="scene"&&i==="relative-to-scene"||t==="ground"&&i!=="absolute-height")}function OYt(t,e,i){return i&&i.mode!==e?`${t} only support ${e} elevation mode`:null}function PYt(t,e,i){return i?.mode===e?`${t} do not support ${e} elevation mode`:null}function RYt(t,e){return e?.featureExpressionInfo!=null&&e.featureExpressionInfo.expression!=="0"?`${t} do not support featureExpressionInfo`:null}function DYt(t,e){e&&t.warn(".elevationInfo=",e)}function C4e(t){return(t?.offset??0)*Sre(t?.unit)}const Jx={mode:"absolute-height",offset:0},Fbt={mode:"on-the-ground",offset:null},Nbt="OBJECTID";let IYt=class extends $4{constructor(e,i){super(i,null),this.point=e}},kYt=class extends $4{constructor(e,i,r,s){super(i,r),this.point=e,this.createGraphic=s}};function Vbt(t){return Vu(t)&&t.intersector===6&&!!t.target}let FYt=class extends nre{constructor(e,i,r,s,n){super(e),this.layerViewUid=e,this.sublayerId=i,this.nodeIndex=r,this.componentIndex=s,this.triangleNr=n}},VYt=class extends $4{constructor(e,i,r){super(i,null),this.point=e,this.createVoxelGraphic=r}},BYt=class extends nre{};function Lre(t){return Vu(t)&&t.intersector===2&&!!t.target}function Ubt(t){return Vu(t)&&t.intersector===9&&!!t.target}function Bbt(t){return Vu(t)&&t.intersector===7&&!!t.target}function qYt(t,e){if(!Vu(e)||!e.target||!("layerViewUid"in e.target))return!1;const i=e.target.layerViewUid;switch(t.allLayerViews.find(s=>s.uid===i)?.layer.type){case"integrated-mesh":case"integrated-mesh-3dtiles":return!0}return!1}let jbt=class extends $4{constructor(e,i,r){super(e,i),this.triangleNr=r}};function qbt(t){return Vu(t)&&t.intersector===5&&!!t.target}function B8(t){return Vu(t)&&t.intersector===4&&!!t.target}function M4e(t,e){return B8(t)||s8(t)?wD(t.target?.object,e):Bbt(t)?e.map?.ground:t.target&&"layerViewUid"in t.target?wD(t.target,e):null}function Gbt(t,e){const i=kre(t,e);return i?.type==="graphic"?i.graphic:null}function kre(t,e,i={}){if(t==null)return null;if(B8(t)||s8(t))return $ye(t.target?.object,e,i);if(Vbt(t)){const r=t.target.createGraphic();return{type:"graphic",graphic:r,layer:r.layer}}if(Ubt(t)){const r=t.target.createVoxelGraphic();return{type:"graphic",graphic:r,layer:r.layer}}return qbt(t)||are(t)?$ye(t.target,e,i):Lre(t)?Hbt(t.target,e,i):null}function $ye(t,e,i){if(t?.graphicUid==null)return null;const r=wD(t,e);if(r==null)return null;if(r===e.graphics)return e.graphicsView==null||typeof t.graphicUid!="number"?null:e.graphicsView.getHit(t.graphicUid,i);const s=e.allLayerViews.find(n=>n.layer===r);return!s||s.suspended||t.graphicUid==null?null:"getHit"in s?s.getHit(t.graphicUid,i):null}function Hbt(t,e,i){const r=wD(t,e);if(r==null)return null;const s=e.allLayerViews.find(a=>a.layer===r);if(!s||s.suspended||!("getGraphicFromIntersectorTarget"in s))return null;const n=i.defer;return Cye(s.getGraphicFromIntersectorTarget(t,{defer:n?a=>n(async()=>Cye(await a())):void 0}))}function Wbt(t,e){const i=wD(t,e);if(i==null)return null;const r=e.allLayerViews.find(s=>s.layer===i);return r&&!r.suspended&&"getAABBFromIntersectorTarget"in r?r.getAABBFromIntersectorTarget(t):null}function Cye(t){return t!=null?{type:"graphic",graphic:t,layer:t.layer}:null}function wD(t,e){return t?.layerViewUid==null?null:e.graphicsView!=null&&t.layerViewUid===e.graphicsView.uid?e.graphics:e.allLayerViews.find(i=>i.uid===t.layerViewUid)?.layer}function HYt(t,e){if(B8(t)||s8(t))return Bf(t.target.object.boundingVolumeWorldSpace.bounds);if(are(t)){a3e(UL,t.transformation);const i=Math.max(UL[0],UL[1],UL[2]);return t.target.baseBoundingSphere.radius*i}if(Lre(t)){const i=Wbt(t.target,e);return i?.5*yrt(i):null}return null}function WYt(t){return!B8(t)&&!s8(t)&&(are(t)?t.target.numLodLevels>1:!!Lre(t))}const UL=R();async function Zbt(t,e,i,r){const s=i?Fre(t,i):r,n=Gs(e.x,e.y);s.requiresGroundFeedback=!0,s.enableDraped=!0;const a=new Vc(t.state.viewingMode);a.options.selectionMode=!0,a.options.store=2,t.sceneIntersectionHelper.intersectIntersectorScreen(n,a,s);const o=await Qbt(t,a.results.all,s.graphics),l=a.results.ground,c=M4e(l,t),h=c!=null&&"type"in c&&Hx(c)?c:null,f={screenPoint:e,results:o,ground:{mapPoint:E3(t,l),distance:Vu(l)?l.distanceInRenderSpace:0,layer:h}};return Ws.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(f.intersector=a),f}function Ybt(t,e,i,r){const s=i?Fre(t,i):r,n=!(!s.graphics?.include&&!s.graphics?.exclude),a=!(!s.mediaElements?.include&&!s.mediaElements?.exclude),o=Xd(e);s.enableDraped=s.include&&!s.include.has(Av)||s.exclude?.has(Av);const l=t.sceneIntersectionHelper,c=new Vc(t.state.viewingMode);if(c.options.selectionMode=!0,c.options.store=n||a?2:0,c.options.excludeLabels=i?.excludeLabels??!1,l.intersectIntersectorScreen(o,c,s),n||a){for(const h of c.results.all){const f=kre(h,t);if(f==null||n&&(f.type!=="graphic"||E4e(s.graphics,f.graphic))||a&&(f.type!=="media"||A4e(s.mediaElements,f.element)))return E3(t,h)}return null}return E3(t,c.results.min)}async function Qbt(t,e,i){const r=new Array;let s,n=null;const a={defer(o){s=o()}};for(let o=0;o<e.length;o++){const l=e[o],c=M4e(l,t);if(c!=null&&(c===t.map.ground||"type"in c&&Hx(c)))break;const h=kre(l,t,a)??await s;if(s=null,h==null)continue;if(h.type==="graphic"){if(n==null&&o!==e.length-1&&(n=new Set),n!=null){const _=zre(h.graphic);if(n.has(_))continue;n.add(_)}if(!E4e(i,h.graphic))continue}const f=E3(t,l),y=l.distanceInRenderSpace;if(h.type==="media"){const _=h.element.toSource(f);r.push({...h,mapPoint:f,distance:y,sourcePoint:_})}else r.push({...h,mapPoint:f,distance:y})}return r}function E3(t,e,i){return e.getIntersectionPoint(A3)?(i=MX(t,A3,i),e.intersector===7&&t.basemapTerrain&&(i.z=Ff(t.basemapTerrain,i)??0),i):null}function zre(t){const e=t.getObjectId()??t.attributes?.[Nbt];return t.origin&&e!=null?`o-${t.origin.id}-${e}`:`u-${t.uid}`}function E4e(t,e){return A4e(t,zre(e))}function A4e(t,e){return t==null||(t.include==null||t.include.has(e))&&(t.exclude==null||!t.exclude.has(e))}function MX(t,e,i){let r=t.spatialReference||Ie.WGS84;return ja(e,t.renderSpatialReference,A3,r)?e=A3:(r=Ie.WGS84,ja(e,t.renderSpatialReference,A3,r)&&(e=A3)),i?(i.x=e[0],i.y=e[1],i.z=e[2],i.spatialReference=r):i=new Qe(e,r),i}function Fre(t,e){const i=EX(t,e.include,0),r=EX(t,e.exclude,1);return{include:i.layerViewUids,exclude:r.layerViewUids,graphics:{include:i.graphicUids,exclude:r.graphicUids},mediaElements:{include:i.mediaElements,exclude:r.mediaElements}}}function EX(t,e,i,r=new Xbt){if(!e)return r;if(e instanceof Gn)Kbt(r,zre(e)),i===0&&(t.graphicsView!=null&&e.layer===t?TF(r,t.graphicsView.uid):e.layer&&mG(r,t,e.layer.uid));else if("layer"in e&&"element"in e)ewt(r,e.element),i===0&&mG(r,t,e.layer.uid);else if(AN(e))for(const s of e)s===t.graphics&&t.graphicsView!=null?TF(r,t.graphicsView.uid):s===t.map.ground?TF(r,Av):EX(t,s,i,r);else"layer"in e&&Jbt(r,t,e),"uid"in e&&mG(r,t,e.uid);return r}let Xbt=class{constructor(){this.layerViewUids=null,this.graphicUids=null,this.mediaElements=null}};function mG(t,e,i){const r=e.allLayerViews.find(s=>s.layer.uid===i);r&&TF(t,r.uid)}function TF(t,e){t.layerViewUids??=new Map,t.layerViewUids.set(e,!0)}function Jbt(t,e,i){const r=e.allLayerViews.find(n=>n.layer.uid===i.layer.uid);if(!r)return;t.layerViewUids??=new Map;const s=t.layerViewUids.get(r.uid);s!==!0&&(s?s.add(i.id):t.layerViewUids.set(r.uid,new Set([i.id])))}function Kbt(t,e){t.graphicUids??=new Set,t.graphicUids.add(e)}function ewt(t,e){t.mediaElements??=new Set,t.mediaElements.add(e)}const A3=R();function Mye(t){return(e,i,r)=>!tte(t,Wi(twt,e,i,r))}const twt=R();let iwt=class{constructor(e,i,r){this.viewingMode=e,this._forEachLayer=i,this._view=r,this._externalIntersectionHandlers=new _i,this._tolerance=FC,this._tmpRay=rn(),this._tmpRegion=Pi(),this._validateHUDIntersector=new Vc(this.viewingMode),this._validateHUDIntersector.options.hud=!1}destroy(){this._externalIntersectionHandlers.prune()}intersectScreen(e,i,r){return this.intersectRay(this._getPickRay(e,this._tmpRay),Eye(this.viewingMode),i,r)}intersectScreenFreePointFallback(e,i,r){return this.intersectRayFreePointFallback(this._getPickRay(e,this._tmpRay),i,r)}intersectRayFreePointFallback(e,i,r){return this.intersectRay(e,Eye(this.viewingMode),i,r)||this._intersectRayFreePointLocal(e,i)}intersectRay(e,i,r,s){return i.options.selectionMode=!1,i.options.store=0,this.computeIntersection(e,i,!1,s),!!i.results.min&&i.results.min.getIntersectionPoint(r)}getCenterRayWithSubpixelOffset(e,i,r=.5,s=.5){return e.getRenderCenter(jL,r,s),jL[0]+=.0466,jL[1]-=.0123,Eie(e,jL,i)}intersectIntersectorScreen(e,i,r){this.computeIntersection(this._getPickRay(e,this._tmpRay),i,!1,r)}intersectToolIntersectorScreen(e,i,r){const s=this._getPickRay(e,this._tmpRay);this.intersectToolIntersectorRay(s,i,r)}intersectToolIntersectorRay(e,i,r){i.options.selectionMode=!0,this.computeIntersection(e,i,!1,r);const s=i.results.min;this._view.basemapTerrain&&this._view.basemapTerrain.opaque||Vu(s)&&s.intersector!==7||(i.options.selectionMode=!1,this.computeIntersection(e,i,!1,r))}setTolerance(e=FC){this._tolerance=e}addIntersectionHandler(e){this._externalIntersectionHandlers.push(e),this._externalIntersectionHandlers.sort((i,r)=>i.type===7?1:r.type===7?-1:0)}removeIntersectionHandler(e){this._externalIntersectionHandlers.removeUnordered(e)!=null&&this._externalIntersectionHandlers.sort((i,r)=>i.type===7?1:r.type===7?-1:0)}_getPickRay(e,i){const r=this._view.state.camera;return Mie(r,e,i)}_intersectRayFreePointLocal(e,i){return this.viewingMode!==2||e==null||xe(i,e.origin,Ee(Ze.get(),e.direction)),!1}intersectElevationFromScreen(e,i,r=0,s=null){return this._intersectElevation(this._getPickRay(e,this._tmpRay),i,r,s)}_intersectElevation(e,i,r=0,s=null){if(e==null)return null;const n=this._view,{renderCoordsHelper:a}=n,o=_p(n.spatialReference),l=i!=null?i.mode:"absolute-height",c=C4e(i)/o,h=(l!=="on-the-ground"?c+r:0)*o/a.unitInMeters,{camera:f}=n.state;if(l==="absolute-height"){const P=a?.getAltitude(f.eye),O=Oe(Ee(yA,e.direction),a.worldUpAtPosition(f.eye,nwt));if(P<h&&O<0||P>=h&&O>0)return null;if(a.intersectInfiniteManifold(e,h,yA)){const D=MX(n,yA);return D.z??=0,D.z-=c,D}return null}const y=f.projectToRenderScreen(e.origin,Ze.get()),_=new Aye(null,this._forEachLayer),w=n.slice.plane,x=w!=null?Mye(w):null,S=new Vc(this.viewingMode);S.options.store=0,S.options.verticalOffset=h,S.options.normalRequired=!1;const $=e.origin,A=xe(Ze.get(),$,e.direction);S.reset($,A,f),S.point=y;let M=null;if(s&&"type"in s&&s.type==="graphics"){const P=n.allLayerViews.find(O=>O.layer===s)?.uid;M=P?O=>O.layerViewUid===P:null}else s&&(M=P=>P.graphicUid!==s.uid);switch(l){case"relative-to-scene":{const P=O=>(!M||M(O))&&!!O.lastValidElevationBB;S.intersect(_.layers,y,this._tolerance,null,P),this._externalIntersectionHandlers.forAll(O=>{if(O.type===2||O.type===7||O.type===8){const D=O.slicePlaneEnabled?x:null;O.intersect(S,D,S.rayBegin,S.rayEnd,y,!1)}});break}case"on-the-ground":case"relative-to-ground":this._externalIntersectionHandlers.forAll(P=>{if(P.isGround){const O=P.slicePlaneEnabled?x:null;P.intersect(S,O,S.rayBegin,S.rayEnd,y,!1)}})}if(S.results.min.getIntersectionPoint(yA)){const P=MX(n,yA);return P.z=r,P}return null}computeIntersection(e,i,r,s){if(e==null)return;const n=this._view.state.camera,a=n.projectToRenderScreen(e.origin,Ze.get()),o=new Aye(s,this._forEachLayer);i.options.selectOpaqueTerrainOnly=!s||!("include"in s||"exclude"in s);const l=e.origin,c=xe(Ze.get(),e.origin,e.direction);i.reset(l,c,n),i.intersect(o.layers,a,this._tolerance);const h=this._view.slice.plane,f=h!=null?Mye(h):null;i.intersect(o.sliceableLayers,a,this._tolerance,f);const y=s&&(s.requiresGroundFeedback||s.enableDraped);this._externalIntersectionHandlers.forAll(S=>{const $=S.layerViewUid,A=S.sublayerId,M=Array.isArray($),P=M?$:[$];M&&(i.options.filteredLayerViewUids=[]);let O=!1;for(const D of P)o.filterLayerViewUid(D,A)?O=!0:M&&i.options.filteredLayerViewUids.push(D);if(i.options.isFiltered=!O,S.isGround&&y||!i.options.isFiltered){const D=S.slicePlaneEnabled?f:null;S.intersect(i,D,l,c,a,r)}});const _=Ze.get(),w=this._view,x=w.basemapTerrain;if(s&&s.enableDraped&&x.spatialReference!=null&&i.results.ground.getIntersectionPoint(_)){const S=w.overlayManager.renderer,$=w.renderCoordsHelper.spatialReference,A=Ze.get();w.renderCoordsHelper.fromRenderCoords(_,A,x.spatialReference),A[2]=w.elevationProvider?.getElevation(_[0],_[1],_[2],$,"ground")??0,S.intersect(i,A,i.results.ground,M=>o.filterRenderGeometry(M))}i.sortResults(),this._processHUDResults(i)}_processHUDResults(e){const i=e.results.hud;Bv(this._tmpRegion,RW);const r=this._view.state.camera,s=[],n=this._tmpRegion,a=$=>{const A=new swt($),M=A.result.target.object.geometries.every(P=>P.material instanceof Xie&&P.material.parameters.occlusionTest);s.push({item:A,occlusionTest:M}),M&&(r.projectToRenderScreen($.target.center,A.screenPoint),A.screenPoint[0]=Math.floor(A.screenPoint[0]),A.screenPoint[1]=Math.floor(A.screenPoint[1]),$u(n,A.screenPoint))};e.sortResults(i.all),i.min.distance!=null&&a(i.min);for(const $ of i.all)i.min.target.object!==$.target.object&&i.max.target.object!==$.target.object&&a($);if(i.max.distance!=null&&i.max.target.object!==i.min.target.object&&a(i.max),!s.length)return;n[0]===n[2]&&(n[2]+=1),n[1]===n[3]&&(n[3]+=1);const o=r.fullWidth,l=r.fullHeight,c=Math.max(0,n[0]-qO),h=Math.max(0,n[1]-qO),f=Math.min(oo(n)+2*qO,o-c),y=Math.min(Bl(n)+2*qO,l-h),_=f>0&&y>0?new Uint8Array(f*y*4):null;_&&this._view.stage.renderer.readHUDVisibility(c,h,f,y,_);let w=!0;const x=e.results.max.distance==null;let S=0;for(const{item:$,occlusionTest:A}of s){let M=!A;if(A&&_)for(const P of rwt){const O=4*(Math.min($.screenPoint[0]+P[0],o)-n[0]+(Math.min($.screenPoint[1]+P[1],l)-n[1])*f);if(O>=0&&O<_.length&&_[O]){M=!0;break}}M&&(w&&(e.results.min.copy($.result),w=!1),x&&e.results.max.copy($.result),e.options.store===2&&e.results.all.splice(S++,0,$.result))}}};const qO=1,rwt=(()=>{const t=[],e=qO;for(let i=-e;i<=e;i++)for(let r=-e;r<=e;r++)t.push([r+e,i+e]);return t})();let swt=class{constructor(e){this.result=e,this.screenPoint=zf()}},BL;function Eye(t){return BL&&BL.viewingMode===t||(BL=new Vc(t)),BL}let Aye=class{constructor(e,i){this.layers=new Array,this.sliceableLayers=new Array,this.include=e?.include,this.exclude=e?.exclude,i(r=>{r.pickable&&this.filterLayerViewUid(r.apiLayerViewUid)&&(r.sliceable?this.sliceableLayers:this.layers).push(r)})}filterLayerViewUid(e,i){const{include:r,exclude:s}=this;if(e==null)return r==null&&s==null;const n=r instanceof Map?r.get(e)??!1:r?.has(e),a=s instanceof Map?s.get(e)??!1:s?.has(e);return(n==null||(typeof n=="boolean"?n:i!=null&&n.has(i)))&&(a==null||!(typeof a=="boolean"?a:i!=null&&a.has(i)))}filterRenderGeometry(e){return this.filterLayerViewUid(e.layerViewUid)}};function Oye(t){return typeof t=="object"&&"intersect"in t}const yA=R(),nwt=R(),jL=zf();let JYt=class{constructor(e,i){this.spatialReference=e,this._view=i}getElevation(e,i,r){return this._view.elevationProvider.getElevation(e,i,0,this.spatialReference,r)}async queryElevation(e,i,r,s,n){return this._view.elevationProvider.queryElevation(e,i,0,this.spatialReference,n,r,s)}},awt=class{constructor(e,i,r,s){this.spatialReference=i,this._getElevationQueryProvider=r,this._queries=new Array,this._queryOptions={...s,ignoreInvisibleLayers:!0},this._frameTask=e.registerTask(yt.ELEVATION_QUERY,this)}destroy({completeTasks:e}={completeTasks:!1}){if(this._frameTask.remove(),this.readyToRun)if(e)this.runTask(sl);else for(const i of this._queries)i.result.reject(Xt())}queryElevation(e,i,r,s=0){const n=lo(),a={x:e,y:i,minDemResolution:s,result:n,signal:r};return this._queries.push(a),qa(r,()=>{tM(this._queries,a),n.reject(Xt())}),n.promise}get readyToRun(){return this._queries.length>0}runTask(e){const i=this._queries;this._queries=[];const r=this._getElevationQueryProvider();if(!r)return i.forEach(h=>h.result.reject()),void e.madeProgress();const s=i.map(h=>[h.x,h.y]),n=i.reduce((h,f)=>Math.min(h,f.minDemResolution),1/0),a=new Po({points:s,spatialReference:this.spatialReference}),o=i.length>1&&i.some(h=>!!h.signal)?new AbortController:null,l=o!=null?o.signal:i[0].signal;if(o!=null){let h=0;i.forEach(f=>qa(f.signal,()=>{h++,f.result.reject(Xt()),h===i.length&&o.abort()}))}const c={...this._queryOptions,minDemResolution:n,signal:l};r.queryElevation(a,c).then(h=>{i.forEach((f,y)=>{f.signal!=null&&f.signal.aborted?f.result.reject(Xt()):f.result.resolve(h.geometry.points[y][2])})}).catch(h=>{i.forEach(f=>f.result.reject(h))}),e.madeProgress()}get test(){}},mV=class{constructor(e=1/0,i=-1/0){this.elevationRangeMin=e,this.elevationRangeMax=i}get elevationRangeValid(){return!Number.isNaN(this.elevationRangeMin)}invalidateElevationRange(){this.elevationRangeMin=NaN}expandElevationRangeValues(e,i){this.elevationRangeMin=Math.min(this.elevationRangeMin,e),this.elevationRangeMax=Math.max(this.elevationRangeMax,i)}expandElevationRange(e){this.elevationRangeMin=Math.min(this.elevationRangeMin,e.elevationRangeMin),this.elevationRangeMax=Math.max(this.elevationRangeMax,e.elevationRangeMax)}setElevationRange(e){this.elevationRangeMin=e.elevationRangeMin,this.elevationRangeMax=e.elevationRangeMax}},GO=class extends Uc{get spatialReference(){return this.view.basemapTerrain?.spatialReference??this.view.spatialReference}constructor(e){super(e),this._providers=[new Array,new Array,new Array],this._lastResult=null,this._cacheEnabled=!1}reset(){this._cachedQuery?.destroy({completeTasks:!0}),this._cachedQuery=this._lastResult=null}enableCache(e){e||(this._lastResult=null),this._cacheEnabled=e}getElevation(e,i,r,s,n){const a=this._cacheEnabled&&this._lastResult;if(a&&e===a.x&&i===a.y&&r===a.z&&fs(s,a.spatialReference)&&n===a.queryContext)return a.result;let o=this._updateElevation(null,1,e,i,r,s,n);return n!=="im"&&o==null&&(o=this._updateElevation(null,0,e,i,r,s,n)),n==="scene"&&(o=this._updateElevation(o,2,e,i,r,s,n)),this._cacheEnabled&&(this._lastResult=new owt(e,i,r,s,n,o)),o}getSphereElevationBounds(e,i,r){let s=null;const n=a=>{for(const o of this._providers[a])if(o.getSphereElevationBounds){const l=o.getSphereElevationBounds(e,i,r);l!=null&&(s??=new mV,s.expandElevationRangeValues(l.elevationRangeMin,l.elevationRangeMax))}};return r!=="im"&&n(0),n(1),r==="scene"&&n(2),s}getRootElevationBounds(){return this._providers.reduce((e,i)=>i.reduce((r,s)=>{const n=s.getRootElevationBounds?.();return n!=null&&(r??=new mV,r.expandElevationRangeValues(n.elevationRangeMin,n.elevationRangeMax)),r},e),null)}async queryElevation(e,i,r,s,n,a=null,o=0){const l=this._getElevationQuery(s);try{const c=await l.queryElevation(e,i,a,o);return n==="scene"?this._updateElevation(c,2,e,i,r,s,n):c}catch(c){return My(c),this.getElevation(e,i,r,s,n)}}register(e,i){this.addHandles(i.on("elevation-change",r=>this.emit("elevation-change",r)),i),this._providers[e].push(i),this.reset()}unregister(e){this.removeHandles(e);for(const i of this._providers){const r=i.indexOf(e);r>-1&&i.splice(r,1)}this.reset()}_getElevationQuery(e=this.view.spatialReference){const i=this._cachedQuery;if(i!=null&&fs(e,i.spatialReference))return i;i?.destroy({completeTasks:!0});const{wkid:r,wkt:s,wkt2:n,latestWkid:a}=e,o=new awt(this.view.resourceController.scheduler,new Ie({wkid:r,wkt:s,wkt2:n,latestWkid:a}),()=>this.view.map?.ground,{maximumAutoTileRequests:4});return this._cachedQuery=o,o}_updateElevation(e,i,r,s,n,a,o){return this._providers[i].reduce((l,c)=>{const h=c.getElevation(r,s,n,a,o);return h==null?l:Math.max(h,l??h)},e)}};d([m({constructOnly:!0})],GO.prototype,"view",void 0),d([m()],GO.prototype,"spatialReference",null),GO=d([k("esri.views.3d.support.CombinedElevationProvider")],GO);let owt=class{constructor(e,i,r,s,n,a){this.x=e,this.y=i,this.z=r,this.spatialReference=s,this.queryContext=n,this.result=a}};var K$;let $F=(K$=class{static isValidProfile(e){return e in gG}static getDefaultProfile(){return ie("esri-iPhone")?"low":"medium"}static apply(e,i){const r=gG[e];i.graphics3D.maxTotalNumberOfFeatures=r.graphics3D.maxTotalNumberOfFeatures,i.graphics3D.maxNumberOfDrawCalls=r.graphics3D.maxNumberOfDrawCalls,i.graphics3D.maxTotalNumberOfVertices=r.graphics3D.maxTotalNumberOfVertices,i.graphics3D.polygonLodFactor=r.graphics3D.polygonLodFactor,i.graphics3D.polylineLodFactor=r.graphics3D.polylineLodFactor,i.graphics3D.snapshotAvailable=r.graphics3D.snapshotAvailable,i.graphics3D.skipHighSymbolLods=r.graphics3D.skipHighSymbolLods;const s=i.sceneService.object,n=r.sceneService.object;s.lodFactor=n.lodFactor,i.sceneService.point.lodFactor=r.sceneService.point.lodFactor,i.sceneService.integratedMesh.lodFactor=r.sceneService.integratedMesh.lodFactor,i.sceneService.pointCloud.lodFactor=r.sceneService.pointCloud.lodFactor,i.tiledSurface.lodBias=r.tiledSurface.lodBias,i.tiledSurface.angledSplitBias=r.tiledSurface.angledSplitBias,i.tiledSurface.vtlContentZoom=r.tiledSurface.vtlContentZoom,i.tiledSurface.elevationLevelDelta=r.tiledSurface.elevationLevelDelta,i.tiledSurface.reduceTileLevelDifferences=r.tiledSurface.reduceTileLevelDifferences,i.gaussianSplat.minimumSplatPixelRadius=r.gaussianSplat.minimumSplatPixelRadius,i.gaussianSplat.minimumOpacity=r.gaussianSplat.minimumOpacity,i.gaussianSplat.maxAllowedVisibleGaussians=r.gaussianSplat.maxAllowedVisibleGaussians,i.heatmap.pixelRatio=r.heatmap.pixelRatio,i.heatmap.maxTotalNumberOfFeatures=r.heatmap.maxTotalNumberOfFeatures,i.flow3D.maxTotalNumberOfStreamlines=r.flow3D.maxTotalNumberOfStreamlines,i.flow3D.maxTracingResolution=r.flow3D.maxTracingResolution,i.fadeDuration=r.fadeDuration,i.antialiasingEnabled=r.antialiasingEnabled,i.physicallyBasedRenderingEnabled=r.physicalBasedRenderingEnabled,i.highQualityTransparency=r.highQualityTransparency,i.highResolutionAtmosphere=r.highResolutionAtmosphere,i.reflections=r.reflections,i.ambientOcclusion=r.ambientOcclusion,i.maxTexturePixels=r.maxTexturePixels,i.memoryLimit=r.memoryLimit,i.additionalCacheMemory=r.additionalCacheMemory,i.frameRate=r.frameRate,i.maximumPixelRatio=r.maximumPixelRatio}},K$.test={reset(){const e=O4e();for(const i of Object.keys(e))gG[i]=e[i]}},K$);const _A={IPhone12Pro:120,GalaxyS20:200,FullHD:240,SurfacePro7:300,FullHDRetina:430},gG=O4e();function O4e(){const t=!!ie("esri-mobile"),e=!!ie("ios"),i=400;return{low:{flow3D:{maxTotalNumberOfStreamlines:25e3,maxTracingResolution:1024},graphics3D:{maxTotalNumberOfFeatures:25e3,maxNumberOfDrawCalls:8e3,maxTotalNumberOfVertices:255e4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1,skipHighSymbolLods:!0},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:.2},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5}},gaussianSplat:{minimumSplatPixelRadius:2,minimumOpacity:.1,maxAllowedVisibleGaussians:4e6},tiledSurface:{lodBias:-1,angledSplitBias:.5,vtlContentZoom:.75,elevationLevelDelta:3,reduceTileLevelDifferences:!0},fadeDuration:0,antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,maxTexturePixels:t?1048576:4194304,memoryLimit:200+_A.IPhone12Pro,additionalCacheMemory:0,frameRate:0,maximumPixelRatio:1},medium:{flow3D:{maxTotalNumberOfStreamlines:1e5,maxTracingResolution:2048},graphics3D:{maxTotalNumberOfFeatures:1e5,maxNumberOfDrawCalls:17e3,maxTotalNumberOfVertices:625e4,polygonLodFactor:t?.8:1,polylineLodFactor:t?1.2:1.5,snapshotAvailable:!e,skipHighSymbolLods:!1},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:13e4},sceneService:{object:{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1}},gaussianSplat:{minimumSplatPixelRadius:1,minimumOpacity:.05,maxAllowedVisibleGaussians:8e6},tiledSurface:{lodBias:0,angledSplitBias:1,vtlContentZoom:1.5,elevationLevelDelta:3,reduceTileLevelDifferences:!ie("disable-feature:reduce-map-tile-levels")},fadeDuration:i,antialiasingEnabled:!1,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,maxTexturePixels:t?4194304:4096**2,memoryLimit:t?600+_A.GalaxyS20:750+_A.FullHD,additionalCacheMemory:t?-100:150,frameRate:0,maximumPixelRatio:1},high:{flow3D:{maxTotalNumberOfStreamlines:1e5,maxTracingResolution:2048},graphics3D:{maxTotalNumberOfFeatures:1e5,maxNumberOfDrawCalls:17e3,maxTotalNumberOfVertices:125e5,polygonLodFactor:t?1.2:2,polylineLodFactor:t?1.2:2,snapshotAvailable:!e,skipHighSymbolLods:!1},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:23e4},sceneService:{object:{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1}},gaussianSplat:{minimumSplatPixelRadius:.5,minimumOpacity:.005,maxAllowedVisibleGaussians:16e6},tiledSurface:{lodBias:0,angledSplitBias:1,vtlContentZoom:1.5,elevationLevelDelta:2,reduceTileLevelDifferences:!ie("disable-feature:reduce-map-tile-levels")},fadeDuration:i,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!0,reflections:!0,ambientOcclusion:!0,maxTexturePixels:t?4096**2:1/0,memoryLimit:t?900+_A.SurfacePro7:1500+_A.FullHDRetina,additionalCacheMemory:t?-150:0,frameRate:0,maximumPixelRatio:t?1:1/0}}}async function lwt(t,e){if(t.type==="2d")return t.hitTest(e);const i=await t.hitTest(e);if(i.results.length===0)return i;const r=i.results[0],s=(r.distance??0)*(1+cwt),n=i.results.findIndex(a=>(a.distance??0)>s);return n!==-1&&(i.results=i.results.slice(0,n)),r&&i.ground.distance>s&&(i.ground.mapPoint=null),i}const cwt=.05;function uwt(t){return t?.type==="graphic"}function hwt(t){return t.find(uwt)??null}async function dwt(t,e){const{results:i,ground:r}=await lwt(t,e),s=(!r.layer||!Hx(r.layer))&&r.mapPoint,n=[],a=mwt(t),o=s?pwt(t,a):fwt;let l=0,c=0;const h=()=>{const y=o.layerViews[c++];if(!s||!y||!("fetchPopupFeaturesAtLocation"in y))return;const _=r.mapPoint,w=y.layer;if(e$(w)&&"effectiveScaleRange"in w){const{minScale:x,maxScale:S}=w.effectiveScaleRange;if(v4e(x,S)){if(T$e(w)&&!CX(t.scale,x,S))return;const $=t.basemapTerrain.getScale(_);if(!CX($,x,S))return}}n.push({mapPoint:_,layerView:y})};let f=null;for(;l<i.length||c<o.layerViews.length;){const y=i[l];if(y&&y.type!=="graphic")++l;else if(y?.layer?.type!=="scene"||y?.layer?.parent!==t?.map?.basemap)if(y){const _=y.layer?.uid,w=o.layerUids.has(_)&&y.distance===r.distance,x=a.get(y.layer?.uid);if(f??=y.mapPoint,c<o.layerViews.length&&(w||(y.distance??0)>r.distance)&&o.layerViews[c]!==x){h();continue}n.push({graphic:y.graphic,layerView:x}),++l}else h();else++l}return f??=r.mapPoint,{hits:n,location:f}}function pwt(t,e){const i=new Set,r=new Set;for(let n=t.basemapTerrain.numLayers(1)-1;n>=0;n--){const a=t.basemapTerrain.layerViewByIndex(n,1);i.add(a.layer.uid),r.add(a)}const s=t.overlayManager.renderer.layers;for(const{uid:n}of s){const a=e.get(n);a&&(i.add(n),r.add(a))}return{layerUids:i,layerViews:Array.from(r).reverse()}}const fwt={layerUids:new Set,layerViews:[]};function mwt(t){const e=new Map;for(const i of t.allLayerViews){const r=i.layer.uid;e.set(r,i)}return e}let xh=class extends Me{constructor(){super(...arguments),this.minTotalNumberOfFeatures=2e3,this.maxTotalNumberOfFeatures=5e4,this.maxNumberOfDrawCalls=17e3,this.maxTotalNumberOfVertices=17e5,this.snapshotAvailable=!0,this.polygonLodFactor=1,this.polylineLodFactor=1,this.skipHighSymbolLods=!1}};d([m()],xh.prototype,"minTotalNumberOfFeatures",void 0),d([m()],xh.prototype,"maxTotalNumberOfFeatures",void 0),d([m()],xh.prototype,"maxNumberOfDrawCalls",void 0),d([m()],xh.prototype,"maxTotalNumberOfVertices",void 0),d([m()],xh.prototype,"snapshotAvailable",void 0),d([m()],xh.prototype,"polygonLodFactor",void 0),d([m()],xh.prototype,"polylineLodFactor",void 0),d([m()],xh.prototype,"skipHighSymbolLods",void 0),xh=d([k("esri.views.3d.support.QualitySettings.Graphics3DSettings")],xh);let qb=class{constructor(){this.minimumSplatPixelRadius=1,this.minimumOpacity=.05,this.maxAllowedVisibleGaussians=8e6}};d([m()],qb.prototype,"minimumSplatPixelRadius",void 0),d([m()],qb.prototype,"minimumOpacity",void 0),d([m()],qb.prototype,"maxAllowedVisibleGaussians",void 0),qb=d([k("esri.views.3d.support.QualitySettings.GaussianSplatSettings")],qb);let lp=class extends Me{constructor(){super(...arguments),this.lodFactor=1}};d([m()],lp.prototype,"lodFactor",void 0),lp=d([k("esri.views.3d.support.QualitySettings.LoDFactorSettings")],lp);let y_=class extends Me{constructor(){super(...arguments),this.object=new lp,this.point=new lp,this.integratedMesh=new lp,this.pointCloud=new lp}};d([m({type:lp})],y_.prototype,"object",void 0),d([m({type:lp})],y_.prototype,"point",void 0),d([m({type:lp})],y_.prototype,"integratedMesh",void 0),d([m({type:lp})],y_.prototype,"pointCloud",void 0),y_=d([k("esri.views.3d.support.QualitySettings.SceneServiceSettings")],y_);let Eg=class extends Me{constructor(){super(...arguments),this.lodBias=0,this.angledSplitBias=1,this.vtlContentZoom=1,this.elevationLevelDelta=3,this.reduceTileLevelDifferences=!0}};d([m()],Eg.prototype,"lodBias",void 0),d([m()],Eg.prototype,"angledSplitBias",void 0),d([m()],Eg.prototype,"vtlContentZoom",void 0),d([m()],Eg.prototype,"elevationLevelDelta",void 0),d([m()],Eg.prototype,"reduceTileLevelDifferences",void 0),Eg=d([k("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],Eg);let O3=class extends Me{constructor(){super(...arguments),this.pixelRatio=1,this.maxTotalNumberOfFeatures=5e4}};d([m()],O3.prototype,"pixelRatio",void 0),d([m()],O3.prototype,"maxTotalNumberOfFeatures",void 0),O3=d([k("esri.views.3d.support.QualitySettings.HeatmapSettings")],O3);let P3=class extends Me{constructor(){super(...arguments),this.maxTotalNumberOfStreamlines=1e5,this.maxTracingResolution=2048}};d([m()],P3.prototype,"maxTotalNumberOfStreamlines",void 0),d([m()],P3.prototype,"maxTracingResolution",void 0),P3=d([k("esri.views.3d.support.QualitySettings.Flow3DSettings")],P3);let vn=class extends Me{constructor(){super(...arguments),this.graphics3D=new xh,this.sceneService=new y_,this.tiledSurface=new Eg,this.gaussianSplat=new qb,this.heatmap=new O3,this.flow3D=new P3,this.fadeDuration=400,this.antialiasingEnabled=!0,this.physicallyBasedRenderingEnabled=!1,this.highQualityTransparency=!0,this.highResolutionAtmosphere=!1,this.reflections=!1,this.ambientOcclusion=!1,this.glow=!1,this.maxTexturePixels=1/0,this.memoryLimit=750,this.additionalCacheMemory=0,this.frameRate=void 0,this.maximumPixelRatio=1/0}};d([m({type:xh})],vn.prototype,"graphics3D",void 0),d([m({type:y_})],vn.prototype,"sceneService",void 0),d([m({type:Eg})],vn.prototype,"tiledSurface",void 0),d([m({type:qb})],vn.prototype,"gaussianSplat",void 0),d([m({type:O3})],vn.prototype,"heatmap",void 0),d([m({type:P3})],vn.prototype,"flow3D",void 0),d([m()],vn.prototype,"fadeDuration",void 0),d([m()],vn.prototype,"antialiasingEnabled",void 0),d([m()],vn.prototype,"physicallyBasedRenderingEnabled",void 0),d([m()],vn.prototype,"highQualityTransparency",void 0),d([m()],vn.prototype,"highResolutionAtmosphere",void 0),d([m()],vn.prototype,"reflections",void 0),d([m()],vn.prototype,"ambientOcclusion",void 0),d([m()],vn.prototype,"glow",void 0),d([m()],vn.prototype,"maxTexturePixels",void 0),d([m()],vn.prototype,"memoryLimit",void 0),d([m()],vn.prototype,"additionalCacheMemory",void 0),d([m()],vn.prototype,"frameRate",void 0),d([m()],vn.prototype,"maximumPixelRatio",void 0),vn=d([k("esri.views.3d.support.QualitySettings")],vn);const Pye=vn;let gwt=class AX{constructor(e,i,r,s){this.viewingMode=e,this.spatialReference=i,this.unitInMeters=r,this._coordinateSystem=s,this._tmpCoordinateSystem=WXe(s),this.referenceEllipsoid=or(i),this.sphericalPCPF=Sv(i)}set extent(e){e&&ZXe(this._coordinateSystem,e,this._coordinateSystem)}get extent(){return YXe(this._coordinateSystem,Pi())}getAltitude(e){return rJe(this._coordinateSystem,e)}setAltitude(e,i,r=e){return g$e(this._coordinateSystem,r,i,e)}setAltitudeOfTransformation(e,i){sJe(this._coordinateSystem,i,e,i)}worldUpAtPosition(e,i){return KXe(this._coordinateSystem,e,i)}worldBasisAtPosition(e,i,r){return eJe(this._coordinateSystem,e,i,r)}basisMatrixAtPosition(e,i){const r=this.worldBasisAtPosition(e,0,Ze.get()),s=this.worldBasisAtPosition(e,1,Ze.get()),n=this.worldBasisAtPosition(e,2,Ze.get());return sm(i,r[0],r[1],r[2],0,s[0],s[1],s[2],0,n[0],n[1],n[2],0,0,0,0,1),i}headingAtPosition(e,i){const r=this.worldUpAtPosition(e,Ze.get()),s=this.worldBasisAtPosition(e,1,Ze.get()),n=F3e(i,s,r);return Ea(n)}intersectManifoldClosestSilhouette(e,i,r){return m7(this._coordinateSystem,i,this._tmpCoordinateSystem),iJe(this._tmpCoordinateSystem,e,r),r}intersectManifold(e,i,r){m7(this._coordinateSystem,i,this._tmpCoordinateSystem);const s=Ze.get();return tJe(this._tmpCoordinateSystem,e,s)?de(r,s):null}intersectInfiniteManifold(e,i,r){if(this.viewingMode===1)return this.intersectManifold(e,i,r);m7(this._coordinateSystem,i,this._tmpCoordinateSystem);const s=this._tmpCoordinateSystem.value,n=Ze.get();return mM(s.plane,e,n)?de(r,n):null}toRenderCoords(e,i,r){return $6(e)?Yl(e,i,this.spatialReference):ja(e,i,r,this.spatialReference)}fromRenderCoords(e,i,r=null){return $6(i)?(r!=null&&(i.spatialReference=r),p2(e,this.spatialReference,i)?i:null):ja(e,this.spatialReference,i,r)?i:null}static create(e,i){switch(e){case 2:return new AX(2,i,Wr(i),JXe());case 1:return new AX(1,i,1,XXe(i))}}static renderUnitScaleFactor(e,i){return zue(e)/zue(i)}};const ywt=(()=>{const t=new Array;return t[0]=10,t[1]=10,t[2]=10,t[3]=10,t[4]=5,t})(),_wt=30;function vwt(t){return"usedMemory"in t&&"unloadedMemory"in t&&"ignoresMemoryFactor"in t}function bwt(t){return new Zo({view:t})}const Rye=.1,qL=1,yG=1,wwt=.75,xwt=.6,Dye=1.3,GL=!!ie("esri-tests-disable-memory-pools");let Zo=class extends Me{constructor(e){super(e),this._quality=1,this._usedMemory=0,this._updating=!1,this._stableQuality=0,this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._predictedMemory=0,this._cacheStorage=new hte,this._warnMemoryUsage=null,this._numQualityChanges=0,this._maxMemory=GL?4096:750,this._additionalCacheMemory=GL?-4096:0,this.addHandles(Rx({prepare:()=>this._updateMemory()}))}destroy(){this._cacheStorage.destroy()}get maxMemory(){return this._maxMemory}set maxMemory(e){e==null||e<=0||GL||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<e&&this._updateQuality(qL),this._maxMemory=e)}get additionalCacheMemory(){return this._additionalCacheMemory}set additionalCacheMemory(e){e==null||GL||(this._additionalCacheMemory=e)}get memoryFactor(){return this._quality}get updating(){return this._updating}get usedMemory(){return this._usedMemory}get usedCacheMemory(){return this._cacheStorage.size}newCache(e,i,r){return new DJe(e,this._cacheStorage,i,r)}resetStableQuality(){this._stableQuality=0}disableMemCache(){this.additionalCacheMemory=-4096}update(){if(this._predictedMemory<=0&&!this._updating)return;let e=this._layersUpdating();if(this._predictedMemory<xwt&&this._canFastRecover)this._downscaleMemoryUsed=0,this._stableQuality=0,this._canFastRecover=!1,this._updateQuality(qL);else if(e){if(this._predictedMemory>1.1*yG||this._usedMemory>yG){if(this._stableQuality>0)this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality);else if(this._quality>Rye&&this._downscaleMemoryUsed<this._usedMemory){if(this._compactAndUpdate())return;this._updateQuality(this._quality/Dye),this._downscaleMemoryUsed=this._usedMemory,this._canFastRecover=!1}}}else if(this._downscaleMemoryUsed=0,this._usedMemory>yG){if(this._compactAndUpdate())return;this._stableQuality=0,this._canFastRecover=!1,e=this._updateQuality(this._quality/Dye),this._downscaleMemoryUsed=this._predictedMemory}else this._stableQuality!==this._quality&&(this._usedMemory<wwt&&this._quality<qL?(this._stableQuality=this._quality,e=this._updateQuality(this._quality+.05)):this._quality<1&&(this._canFastRecover=!0));this._updating=e}_compactAndUpdate(){const e=zct(100),i=this.view.stage.compact(e);return this.view.overlayManager.renderer.compact(e)||i}_updateQuality(e){return(e=Math.min(Math.max(e,Rye),qL))!==this._quality&&(this._quality=e,++this._numQualityChanges,!0)}_layersUpdating(){return this.view.allLayerViews.some(e=>!!e.updating)}_updateMemory(){if(!this.view?.updating||this.view.destroyed||this.view.destroying)return;this.view.stage?.renderer?.tick();const e=this.view.stage?.renderer?.usedMemory;let i=(this.view.basemapTerrain?.usedMemory??0)+(e?e.fbos+e.edges+e.plugins:0)+this.view.deconflictor?.usedMemory+this.view.labeler?.usedMemory,r=0;this.view.allLayerViews&&this.view.allLayerViews.forEach(o=>{if(vwt(o)){const l=o.ignoresMemoryFactor?this._quality:1;i+=o.usedMemory*l,r+=o.unloadedMemory*l}});const s=this._warnMemoryUsage==null||Math.round(10*i)!==Math.round(10*this._warnMemoryUsage),n=1048576*this.maxMemory;if(i>n&&s){this._warnMemoryUsage=i;const o=c=>(c/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB",l=Math.round(100*this._quality);fe.getLogger(this).warn(`Memory Limit exceeded! Limit: ${o(n)} Current: ${o(i)} Projected: ${o(i+r)} Quality: ${l}%`)}this._usedMemory=i/n,this._predictedMemory=(i+r)/n;const a=n-i;this._cacheStorage.maxSize=Math.max(0,a+1048576*this.additionalCacheMemory)}get test(){}};d([m({constructOnly:!0})],Zo.prototype,"view",void 0),d([m()],Zo.prototype,"maxMemory",null),d([m()],Zo.prototype,"additionalCacheMemory",null),d([m({readOnly:!0})],Zo.prototype,"memoryFactor",null),d([m({readOnly:!0})],Zo.prototype,"updating",null),d([m({readOnly:!0})],Zo.prototype,"usedMemory",null),d([m({readOnly:!0})],Zo.prototype,"usedCacheMemory",null),d([m()],Zo.prototype,"_quality",void 0),d([m()],Zo.prototype,"_usedMemory",void 0),d([m()],Zo.prototype,"_updating",void 0),d([m()],Zo.prototype,"_stableQuality",void 0),d([m()],Zo.prototype,"_maxMemory",void 0),d([m()],Zo.prototype,"_additionalCacheMemory",void 0),Zo=d([k("esri.views.3d.support.MemoryController")],Zo);let Swt=class{constructor(e){this.client=e,this._cancelled=!1,this.size=0,this.duration=0}},Twt=class{constructor(e){this.typeWorkerQuota=e,this.tasks=new Array,this.numWorkers=0,this.statistics=new $wt}},$wt=class{constructor(){this.requests=0,this.size=0,this.duration=0,this.speed=0}},Cwt=class{constructor(e,i,r,s){this._workerFunc=e,this._callbackFunc=i,this._maxTotalNumWorkers=r,this._totalNumWorkers=0,this._clients=s.map(n=>new Twt(n))}destroy(){this._clients.length=0}hasQuota(e){const i=this._clients[e];return!!i&&(this._totalNumWorkers<this._maxTotalNumWorkers||i.numWorkers+i.tasks.length<i.typeWorkerQuota)}push(e){const i=this._clients[e.client];i&&(this._totalNumWorkers<this._maxTotalNumWorkers?(i.numWorkers++,this._totalNumWorkers++,this._workerFunc(e,(r,s)=>this._taskCallback(r,s))):i.tasks.push(e))}cancel(e){this._taskFinished(e),e._cancelled=!0}_taskFinished(e){const i=this._clients[e.client];this._totalNumWorkers--,i&&(i.numWorkers--,i.statistics.requests++,i.statistics.size+=e.size||0,i.statistics.duration+=e.duration||0,i.statistics.speed=i.statistics.duration>0?i.statistics.size/i.statistics.duration:0,dt(i.numWorkers>=0)),this._next()}_next(){for(const e of this._clients)if(e&&e.numWorkers<e.typeWorkerQuota&&this._processQueue(e))return;for(const e of this._clients)if(e&&this._processQueue(e))return}_processQueue(e){for(;e.tasks.length>0;)if(this._workerFunc(e.tasks.shift(),(i,r)=>this._taskCallback(i,r)))return e.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(e,i){e._cancelled||(this._callbackFunc(e,i),this._taskFinished(e))}getStatsForType(e){const i=this._clients[e];return i?{quota:i.typeWorkerQuota,workers:i.numWorkers,queueSize:i.tasks.length,requestStats:i.statistics}:null}get test(){}},Mwt=class{constructor(e,i){this.element=e,this.type="image+type",this.isOpaque=i==="image/jpeg"}};function IT(t){return t!=null&&"type"in t&&t.type==="vector-tile"}function P4e(t){return t!=null&&"type"in t&&t.type==="raster-tile"}function R4e(t){return t!=null&&"type"in t&&t.type==="tile-texture"}function j8(t){return t!=null&&"type"in t&&t.type==="image+type"}let CF=class extends Me{constructor(){super(...arguments),this._tasks=new Map,this._onLoadQueue=new Array,this._doneQueue=new Array,this.updating=!1}setup(e,i,r){this._loadQueue=new Cwt((s,n)=>this._startLoading(s,n),(s,n)=>this._doneLoadingCB(s,n),e,i),r&&(this._frameTask=r.registerTask(yt.STREAM_DATA_LOADER,this))}destroy(){this._frameTask=Ki(this._frameTask),this._tasks.forEach(e=>ps(e.abortController)),this._loadQueue=Re(this._loadQueue),this._onLoadQueue.length=0,this._onLoadQueue=null,this._doneQueue.length=0,this._doneQueue=null,this._tasks.forEach(e=>e.destroy()),this._tasks.clear(),this._tasks=null}hasDownloadSlots(e){return this._loadQueue.hasQuota(e)}request(e,i,r,s={}){const n=lo();return n.__signal=s!=null?s.signal:null,this._createOrUpdateTask(e,i,r,s,n),n.promise}_createTask(e,i,r,s,n,a){const o=new Owt(e,i,r,s,n);return this._updateTask(o,a),this._tasks.set(n,o),this._tasks.size===1&&this._set("updating",!0),this._loadQueue.push(o),o}_cancelRequest(e,i){const r=this._tasks.get(e);r&&(Ul(r.resolvers,i),i.reject(Xt()),r.resolvers.length===0&&(r.status===2&&this._loadQueue.cancel(r),r.status=4,this._removeTask(r)))}_updateTask(e,i){e.resolvers.push(i)}_createOrUpdateTask(e,i,r,s,n){const a=Pwt(s?.uid||e,i,r);let o=this._tasks.get(a);o?this._updateTask(o,n):(o=this._createTask(e,s,i,r,a,n),o.abortHandle=qa(s,()=>this._cancelRequest(a,n)))}_doneLoadingCB(e,i){this._loadQueue&&(dt(e.status===2),e.status=3,this._frameTask?this._doneQueue.push({task:e,err:i}):this._doneLoading(e,i))}get readyToRun(){return this._doneQueue.length>0||this._onLoadQueue.length>0}runTask(e){for(;!e.done&&this._onLoadQueue.length>0;){const i=this._onLoadQueue.shift();st(i.task.abortController),i.task.abortController=null,i.callback(i.task),e.madeProgress()}for(;!e.done&&this._doneQueue.length>0;){const i=this._doneQueue.shift();i.task.status!==3&&(i.err=i.err||Xt()),this._doneLoading(i.task,i.err),e.madeProgress()}}_doneLoading(e,i){if(i&&!Hr(i)&&e.numRetries>0)return--e.numRetries,void this._loadQueue.push(e);let r=j8(e.result)||e.result instanceof HTMLImageElement?0:e.resolvers.length;for(const s of e.resolvers)if(i)Hr(i)?s.reject(i):s.reject(new ee("stream-data-loader:request-error",`Failed to request resource at '${e.url}'. ${i}`,{url:e.url,error:i}));else{--r;const n=r>0?Te(e.result):e.result;s.resolve(n)}this._removeTask(e)}_removeTask(e){this._tasks.delete(e.key),e.destroy(),this._tasks.size===0&&this._set("updating",!1)}_startLoading(e,i){if(e.status===4)return!1;let r,s;switch(e.startTime=performance.now(),e.status=2,e.docType){case 1:s="array-buffer",r=0;break;case 2:s="image";break;case 3:s="array-buffer";break;default:s="json"}e.abortController=new AbortController;const n=e.abortController.signal;e.request=$r(e.url,{...e.options,responseType:s,timeout:r,signal:n});const a=l=>{e.duration=performance.now()-e.startTime,e.size=l instanceof ArrayBuffer?l.byteLength:e.size||0,e.result=l,this._frameTask?this._onLoadQueue.push({callback:i,task:e}):(e.abortController=null,i(e))},o=l=>{e.status===2&&i(e,l)};return e.docType!==3?(e.request.then(l=>a(l.data),o),!0):(e.request.then(l=>{const c=l.data,h=Awt(c);if(s="image",e.size=c.byteLength,h==="unknown")return e.request=$r(e.url,{responseType:s,timeout:r,signal:n}),void e.request.then(_=>a(_.data),o);const f=new Blob([c],{type:h}),y=window.URL.createObjectURL(f);e.request=$r(y,{responseType:s,timeout:r,signal:n}),e.request.then(_=>a(new Mwt(_.data,h)),o).finally(()=>window.URL.revokeObjectURL(y))},o),!0)}get test(){}};d([m({readOnly:!0})],CF.prototype,"updating",void 0),CF=d([k("esri.views.3d.support.StreamDataLoader")],CF);const Ewt={numRetries:0};function Awt(t){if(t.byteLength<2)return"unknown";const e=new Uint8Array(t,0,t.byteLength);return e[0]===137&&e[1]===80?"image/png":e[0]===71&&e[1]===73?"image/gif":e[0]===66&&e[1]===77?"image/bmp":e[0]===255&&e[1]===216?"image/jpeg":"unknown"}let Owt=class extends Swt{constructor(e,i,r,s,n){super(s),this.url=e,this.options=i,this.docType=r,this.key=n,this.abortHandle=null,this.result=null,this.status=1,this.request=null,this.abortController=null,this.resolvers=new Array,this.startTime=0,this.numRetries=Ewt.numRetries}destroy(){this.result=null,this.request=null,this.abortController?.abort(),this.abortController=null,this.resolvers.length=0,this.options=null,this.abortHandle=Ki(this.abortHandle)}};function Pwt(t,e,i){return`${t}:${e}:${i}`}let Rwt=class{constructor(e,i){this._loader=e,this._clientType=i}request(e,i,r={}){return this._loader.request(e,i,this._clientType,r)}get busy(){return!this._loader.hasDownloadSlots(this._clientType)}},MF=class extends Me{constructor(){super(...arguments),this.updating=!1}};function Dwt(t){return new uf({view:t})}d([m({readOnly:!0})],MF.prototype,"updating",void 0),MF=d([k("esri.views.3d.support.ResourceController.ResourceControllerMain")],MF);let uf=class extends MF{constructor(){super(...arguments),this._immediateTask=W_,this._normalTask=W_,this._updatingObjects=Pn([]),this._frameTask=null}get immediate(){return this._immediateTask}get normal(){return this._normalTask}initialize(){this._scheduler=Oct(),this._memoryController=bwt(this.view),this._streamDataLoader=new CF,this._streamDataLoader.setup(_wt,ywt,this._scheduler),this.addHandles([K(()=>this.view.stationary,()=>this._stationaryChangedHandler())]),this._frameTask=Rx({update:e=>this._frame(e)}),this._immediateTask=this._scheduler.registerTask(yt.RESOURCE_CONTROLLER_IMMEDIATE),this._normalTask=this._scheduler.registerTask(yt.RESOURCE_CONTROLLER)}destroy(){this._immediateTask.remove(),this._normalTask.remove(),this._frameTask=Ki(this._frameTask),this._streamDataLoader=Re(this._streamDataLoader),this._memoryController=Re(this._memoryController),this._scheduler=Re(this._scheduler),this.view=null}get updating(){return!!(this._memoryController?.updating||this._streamDataLoader?.updating||this._immediateTask?.updating)||this._updatingObjects?.value.some(e=>e.updating)}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}createStreamDataRequester(e){return new Rwt(this._streamDataLoader,e)}addUpdatingObject(e){const i=this._updatingObjects;return i.value=[...i.value,e],ci(()=>{i.value=i.value.filter(r=>r!==e)})}_frame(e){this.view.suspended||this.view.stateManager&&(this.view.stateManager.step(gK(e.deltaTime)),!this._scheduler)||(this._memoryController.update(),this.view.state&&(this._scheduler.state=this.view.state.fading?1:this.view.state.mode,this.view.state.fading=!1),this._scheduler.frame(e))}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}get test(){}};d([m()],uf.prototype,"view",void 0),d([m()],uf.prototype,"_scheduler",void 0),d([m()],uf.prototype,"_memoryController",void 0),d([m()],uf.prototype,"_streamDataLoader",void 0),d([m()],uf.prototype,"_immediateTask",void 0),d([m()],uf.prototype,"_normalTask",void 0),d([m({readOnly:!0})],uf.prototype,"updating",null),uf=d([k("esri.views.3d.support.ResourceController")],uf);let SQt=class{constructor(e,i=0,r=0,s=0,n=0,a=null){this.usedMemory=e,this.displayedFeatures=i,this.totalFeatures=r,this.maximumFeatures=s,this.nodes=n,this.core=a}};function Iwt(t){return"performanceInfo"in t}let Lwt=class{constructor(e){this.layer=null,this.memory=0,this.displayedNumberOfFeatures=0,this.maximumNumberOfFeatures=null,this.totalNumberOfFeatures=null,this.layer=e.layer;const i=e.performanceInfo;this.memory=i.usedMemory,this.displayedNumberOfFeatures=i.displayedFeatures,this.maximumNumberOfFeatures=i.maximumFeatures,this.totalNumberOfFeatures=i.totalFeatures}},kwt=class{constructor(e){if(this.totalMemory=0,this.usedMemory=0,this.quality=1,this.load=0,this.terrainMemory=0,this.edgesMemory=0,this.layerPerformanceInfos=new Array,this.cachedMemory=0,this.fboMemory=0,e.resourceController!=null){const i=e.resourceController.memoryController;this.totalMemory=1048576*(i.maxMemory??0),this.usedMemory=Math.round(i.usedMemory*this.totalMemory),this.quality=e.quality,this.load=e.resourceController.scheduler.load,this.cachedMemory=i.usedCacheMemory}this.terrainMemory=e.basemapTerrain?.usedMemory??0,this.edgesMemory=e.stage?.renderer.usedMemory.edges??0,this.fboMemory=e.stage?.renderer.usedMemory.fbos??0,e.allLayerViews?.items.forEach(i=>{Iwt(i)&&this.layerPerformanceInfos.push(new Lwt(i))}),this.layerPerformanceInfos.sort((i,r)=>r.memory-i.memory)}},zwt=class{constructor(e){this._streamDataRequester=e}async loadJSON(e,i){return this._load(0,e,i)}async loadBinary(e,i){return rm(e)?(st(i),cxe(e)):this._load(1,e,i)}async loadImage(e,i){return this._load(2,e,i)}async _load(e,i,r){if(this._streamDataRequester==null)return(await $r(i,{responseType:Fwt[e]})).data;const s=await Xf(this._streamDataRequester.request(i,e,r));if(s.ok===!0)return s.value;throw My(s.error),new ee("glt-loader-request-error",`Request for resource failed: ${s.error}`)}};const Fwt={2:"image",1:"array-buffer",0:"json",3:void 0};let tm=class D4e{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return this._outer.size===0}get outerSize(){return this._outer.size}get size(){let e=0;for(const i of this._outer.values())e+=i.size;return e}get(e,i){return this._outer.get(e)?.get(i)}getInner(e){return this._outer.get(e)}set(e,i,r){const s=this._outer.get(e);s?s.set(i,r):this._outer.set(e,new Map([[i,r]]))}delete(e,i){const r=this._outer.get(e);r&&(r.delete(i),r.size===0&&this._outer.delete(e))}pop(e,i){const r=this.get(e,i);return this.delete(e,i),r}*outerMap(){for(const e of this._outer)yield e}*values(){for(const e of this._outer.values())yield*e.values()}*[Symbol.iterator](){for(const[e,i]of this._outer)for(const[r,s]of i)yield[e,r,s]}forEach(e){this._outer.forEach((i,r)=>e(i,r))}forAll(e){this._outer.forEach((i,r)=>i.forEach((s,n)=>e(s,r,n)))}copy(){const e=new D4e;return this.forAll((i,r,s)=>e.set(r,s,i)),e}},q8=class OX{constructor(e,i,r=""){this.major=e,this.minor=i,this._context=r}lessThan(e,i){return this.major<e||e===this.major&&this.minor<i}greaterEqual(e,i){return!this.lessThan(e,i)}validate(e){if(this.major!==e.major){const i=this._context&&this._context+":",r=this._context&&this._context+" ";throw new ee(i+"unsupported-version",`Required major ${r}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:e})}}clone(){return new OX(this.major,this.minor,this._context)}static parse(e,i=""){const[r,s]=e.split("."),n=/^\s*\d+\s*$/;if(!r?.match||!n.test(r))throw new ee((i&&i+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:e});if(!s?.match||!n.test(s))throw new ee((i&&i+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:e});const a=parseInt(r,10),o=parseInt(s,10);return new OX(a,o,i)}};async function $y(t,e){const{data:i}=await $r(t,{responseType:"image",...e});return i}function Nwt(t,e){return new Promise((i,r)=>{t.readyState>=HTMLMediaElement.HAVE_CURRENT_DATA?i():(e(DN(t,"canplay",i)),e(DN(t,"error",r)))})}function Vwt(){return Iye??=(async()=>{const t=await te(()=>import("./basis_transcoder-DuG70Smz.js"),[]),e=await t.default({locateFile:i=>Es(`esri/libs/basisu/${i}`)});return e.initializeBasis(),e})(),Iye}let Iye,gp=null,HL=null;async function I4e(){return HL==null&&(HL=Vwt(),gp=await HL),HL}function Uwt(t,e){if(gp==null)return t.byteLength;const i=new gp.BasisFile(new Uint8Array(t)),r=k4e(i)?L4e(i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),e):0;return i.close(),i.delete(),r}function Bwt(t,e){if(gp==null)return t.byteLength;const i=new gp.KTX2File(new Uint8Array(t)),r=z4e(i)?L4e(i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),e):0;return i.close(),i.delete(),r}function L4e(t,e,i,r,s){const n=uie(e?Vs.COMPRESSED_RGBA8_ETC2_EAC:Vs.COMPRESSED_RGB8_ETC2),a=s&&t>1?(4**t-1)/(3*4**(t-1)):1;return Math.ceil(i*r*n*a)}function k4e(t){return t.getNumImages()>=1&&!t.isUASTC()}function z4e(t){return t.getFaces()>=1&&t.isETC1S()}async function jwt(t,e,i){gp==null&&(gp=await I4e());const r=new gp.BasisFile(new Uint8Array(i));if(!k4e(r))return null;r.startTranscoding();const s=F4e(t,e,r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),(n,a)=>r.getImageTranscodedSizeInBytes(0,n,a),(n,a,o)=>r.transcodeImage(o,0,n,a,0,0));return r.close(),r.delete(),s}async function qwt(t,e,i){gp==null&&(gp=await I4e());const r=new gp.KTX2File(new Uint8Array(i));if(!z4e(r))return null;r.startTranscoding();const s=F4e(t,e,r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),(n,a)=>r.getImageTranscodedSizeInBytes(n,0,0,a),(n,a,o)=>r.transcodeImage(o,n,0,0,a,0,-1,-1));return r.close(),r.delete(),s}function F4e(t,e,i,r,s,n,a,o){const{compressedTextureETC:l,compressedTextureS3TC:c}=t.capabilities,[h,f]=l?r?[1,Vs.COMPRESSED_RGBA8_ETC2_EAC]:[0,Vs.COMPRESSED_RGB8_ETC2]:c?r?[3,Vs.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[2,Vs.COMPRESSED_RGB_S3TC_DXT1_EXT]:[13,6408],y=e.hasMipmap?i:Math.min(1,i),_=[];for(let w=0;w<y;w++)_.push(new Uint8Array(a(w,h))),o(w,h,_[w]);return e.internalFormat=f,e.hasMipmap=_.length>1,e.samplingMode=e.hasMipmap?9987:9729,e.width=s,e.height=n,new Fi(t,e,{type:"compressed",levels:_})}const WL=()=>fe.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),Gwt=542327876,Hwt=131072,Wwt=4;function Nre(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}function Zwt(t){return String.fromCharCode(255&t,t>>8&255,t>>16&255,t>>24&255)}const Ywt=Nre("DXT1"),Qwt=Nre("DXT3"),Xwt=Nre("DXT5"),Jwt=31,Kwt=0,ext=1,txt=2,ixt=3,rxt=4,sxt=7,nxt=20,axt=21;function oxt(t,e,i){const r=lxt(i,e.hasMipmap??!1);if(r==null)throw new Error("DDS texture data is null");const{textureData:s,internalFormat:n,width:a,height:o}=r;return e.samplingMode=s.levels.length>1?9987:9729,e.hasMipmap=s.levels.length>1,e.internalFormat=n,e.width=a,e.height=o,new Fi(t,e,s)}function lxt(t,e){const i=new Int32Array(t.buffer,t.byteOffset,Jwt);if(i[Kwt]!==Gwt)return WL().error("Invalid magic number in DDS header"),null;if(!(i[nxt]&Wwt))return WL().error("Unsupported format, must contain a FourCC code"),null;const r=i[axt];let s,n;switch(r){case Ywt:s=8,n=Vs.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case Qwt:s=16,n=Vs.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case Xwt:s=16,n=Vs.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return WL().error("Unsupported FourCC code:",Zwt(r)),null}let a=1,o=i[rxt],l=i[ixt];(3&o||3&l)&&(WL().warn("Rounding up compressed texture size to nearest multiple of 4."),o=o+3&-4,l=l+3&-4);const c=o,h=l;let f,y;i[txt]&Hwt&&e!==!1&&(a=Math.max(1,i[sxt]));let _=t.byteOffset+i[ext]+4;const w=[];for(let x=0;x<a;++x)y=(o+3>>2)*(l+3>>2)*s,f=new Uint8Array(t.buffer,_,y),w.push(f),_+=y,o=Math.max(1,o>>1),l=Math.max(1,l>>1);return{textureData:{type:"compressed",levels:w},internalFormat:n,width:c,height:h}}let Vre=class{constructor(e,i){this._data=e,this.id=ql(),this.events=new Ey,this._parameters={...uxt,...i},this._startPreload(e)}dispose(){this.unload(),this._data=this.update=void 0}_startPreload(e){e instanceof HTMLVideoElement?(this.update=i=>this._update(e,i),this._startPreloadVideoElement(e)):e instanceof HTMLImageElement&&this._startPreloadImageElement(e)}_startPreloadVideoElement(e){if(!(Lx(e.src)||e.preload==="auto"&&e.crossOrigin)&&(e.preload="auto",e.crossOrigin="anonymous",e.src=e.src,e.paused&&e.autoplay)){const i=[];Nwt(e,r=>i.push(r)).then(()=>{e.play()}).finally(()=>i.forEach(r=>r.remove()))}}_startPreloadImageElement(e){rm(e.src)||Lx(e.src)||e.crossOrigin||(e.crossOrigin="anonymous",e.src=e.src)}_createDescriptor(e){const i=new Zi;return i.wrapMode=this._parameters.wrap??10497,i.flipped=!this._parameters.noUnpackFlip,i.samplingMode=this._parameters.mipmap?9987:9729,i.hasMipmap=!!this._parameters.mipmap,i.preMultiplyAlpha=!!this._parameters.preMultiplyAlpha,i.maxAnisotropy=this._parameters.maxAnisotropy??(this._parameters.mipmap?e.parameters.maxMaxAnisotropy:1),i.dataType=this._parameters.dataType??i.dataType,i.pixelFormat=this._parameters.pixelFormat??i.pixelFormat,i.internalFormat=this._parameters.internalFormat??i.internalFormat,i}get glTexture(){return this._glTexture??this._emptyTexture}get loaded(){return this._glTexture!=null}get usedMemory(){return this._glTexture?.usedMemory||cxt(this._data,this._parameters)}load(e){if(this._loadingPromise)return this._loadingPromise;if(this._glTexture)return this._glTexture;const i=this._data;return i==null?(this._glTexture=new Fi(e,this._createDescriptor(e),null),this._glTexture):(this._emptyTexture=e.emptyTexture,this._parameters.reloadable||(this._data=void 0),typeof i=="string"?this._loadFromURL(e,i):i instanceof Image?this._loadFromImageElement(e,i):i instanceof HTMLVideoElement?this._loadFromVideoElement(e,i):i instanceof ImageData||i instanceof HTMLCanvasElement?this._loadFromImage(e,i):mw(i)&&this._parameters.encoding==="image/vnd-ms.dds"?this._loadFromDDSData(e,i):GA(i)&&this._parameters.encoding==="image/vnd-ms.dds"?this._loadFromDDSData(e,new Uint8Array(i)):(GA(i)||mw(i))&&this._parameters.encoding==="image/ktx2"?this._loadFromKTX2(e,i):(GA(i)||mw(i))&&this._parameters.encoding==="image/x.basis"?this._loadFromBasis(e,i):GA(i)?this._loadFromPixelData(e,new Uint8Array(i)):iM(i)?this._loadFromPixelData(e,i):null)}_update(e,i){return this._glTexture==null||e.readyState<HTMLMediaElement.HAVE_CURRENT_DATA||i===e.currentTime?i:(this._glTexture.setData(e),this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this._parameters.updateCallback&&this._parameters.updateCallback(),e.currentTime)}_loadFromDDSData(e,i){return this._glTexture=oxt(e,this._createDescriptor(e),i),this._emptyTexture=null,this._glTexture}_loadFromKTX2(e,i){return this._loadAsync(()=>qwt(e,this._createDescriptor(e),i).then(r=>(this._glTexture=r,r)))}_loadFromBasis(e,i){return this._loadAsync(()=>jwt(e,this._createDescriptor(e),i).then(r=>(this._glTexture=r,r)))}_loadFromPixelData(e,i){dt(this._parameters.width>0&&this._parameters.height>0);const r=this._createDescriptor(e);return r.pixelFormat!==6407&&r.pixelFormat!==6408||(r.compress=this._parameters.compressionOptions),r.width=this._parameters.width??0,r.height=this._parameters.height??0,this._glTexture=new Fi(e,r,i),this._glTexture}_loadFromURL(e,i){return this._loadAsync(async r=>{const s=await $y(i,{signal:r});return st(r),this._loadFromImage(e,s)})}_loadFromImageElement(e,i){return i.complete?this._loadFromImage(e,i):this._loadAsync(async r=>{const s=await Exe(i,i.src,!1,r);return st(r),this._loadFromImage(e,s)})}_loadFromVideoElement(e,i){return i.readyState>=HTMLMediaElement.HAVE_CURRENT_DATA?this._loadFromImage(e,i):this._loadFromVideoElementAsync(e,i)}_loadFromVideoElementAsync(e,i){return this._loadAsync(r=>new Promise((s,n)=>{const a=()=>{i.removeEventListener("loadeddata",o),i.removeEventListener("error",l),Ki(c)},o=()=>{i.readyState>=HTMLMediaElement.HAVE_CURRENT_DATA&&(a(),s(this._loadFromImage(e,i)))},l=h=>{a(),n(h||new ee("texture:load-error","Failed to load video"))};i.addEventListener("loadeddata",o),i.addEventListener("error",l);const c=qa(r,()=>l(Xt()))}))}_loadFromImage(e,i){let r=i;r instanceof HTMLVideoElement||(r=J1t(r,e.parameters));const s=N4e(r);this._parameters.width=s.width,this._parameters.height=s.height;const n=this._createDescriptor(e);return n.width=s.width,n.height=s.height,n.compress=this._parameters.compressionOptions,this._glTexture=new Fi(e,n,r),this._emptyTexture=null,this.events.emit("loaded"),this._glTexture}_loadAsync(e){const i=new AbortController;this._loadingController=i;const r=e(i.signal);this._loadingPromise=r;const s=()=>{this._loadingController===i&&(this._loadingController=null),this._loadingPromise===r&&(this._loadingPromise=null),this._emptyTexture=null};return r.then(s,s),r}unload(){if(this._glTexture=Rt(this._glTexture),this._emptyTexture=null,this._loadingController!=null){const e=this._loadingController;this._loadingController=null,this._loadingPromise=null,e.abort()}this.events.emit("unloaded")}get parameters(){return this._parameters}};function cxt(t,e){if(t==null)return 0;if(GA(t)||mw(t))return e.encoding==="image/ktx2"?Bwt(t,!!e.mipmap):e.encoding==="image/x.basis"?Uwt(t,!!e.mipmap):t.byteLength;const{width:i,height:r}=t instanceof Image||t instanceof ImageData||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement?N4e(t):e,s=e.pixelFormat??6408,n=dct(s);return(e.mipmap?4/3:1)*i*r*n||0}function N4e(t){return t instanceof HTMLVideoElement?{width:t.videoWidth,height:t.videoHeight}:t}const uxt={wrap:{s:10497,t:10497},mipmap:!0,noUnpackFlip:!1,preMultiplyAlpha:!1},ng=()=>fe.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");let hxt=class{constructor(e,i,r){this.resource=e,this.textures=i,this.usedMemory=r}};async function dxt(t,e){const i=await pxt(t,e),r=await yxt(i.textureDefinitions??{},e);let s=0;for(const n in r)if(r.hasOwnProperty(n)){const a=r[n];s+=a?.image?a.image.width*a.image.height*4:0}return new hxt(i,r,s+y6(i))}async function pxt(t,e){const i=e?.streamDataRequester;if(i)return fxt(t,i,e);const r=await Xf($r(t,e));if(r.ok===!0)return r.value.data;My(r.error),V4e(r.error)}async function fxt(t,e,i){const r=await Xf(e.request(t,0,i));if(r.ok===!0)return r.value;My(r.error),V4e(r.error.details.url)}function V4e(t){throw new ee("",`Request for object resource failed: ${t}`)}function mxt(t){const e=t.params,i=e.topology;let r=!0;switch(e.vertexAttributes||(ng().warn("Geometry must specify vertex attributes"),r=!1),e.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const n=e.faces;if(n){if(e.vertexAttributes)for(const a in e.vertexAttributes){const o=n[a];o?.values?(o.valueType!=null&&o.valueType!=="UInt32"&&(ng().warn(`Unsupported indexed geometry indices type '${o.valueType}', only UInt32 is currently supported`),r=!1),o.valuesPerElement!=null&&o.valuesPerElement!==1&&(ng().warn(`Unsupported indexed geometry values per element '${o.valuesPerElement}', only 1 is currently supported`),r=!1)):(ng().warn(`Indexed geometry does not specify face indices for '${a}' attribute`),r=!1)}}else ng().warn("Indexed geometries must specify faces"),r=!1;break}default:ng().warn(`Unsupported topology '${i}'`),r=!1}t.params.material||(ng().warn("Geometry requires material"),r=!1);const s=t.params.vertexAttributes;for(const n in s)s[n].values||(ng().warn("Geometries with externally defined attributes are not yet supported"),r=!1);return r}function OQt(t,e){const i=new Array,r=new Array,s=new Array,n=new tm,a=t.resource,o=q8.parse(a.version||"1.0","wosr");vxt.validate(o);const l=a.model.name,c=a.model.geometries,h=a.materialDefinitions??{},f=t.textures;let y=0;const _=new Map;for(let w=0;w<c.length;w++){const x=c[w];if(!mxt(x))continue;const S=_xt(x),$=x.params.vertexAttributes,A=[],M=Y=>{if(x.params.topology==="PerAttributeArray")return null;const G=x.params.faces;for(const Z in G)if(Z===Y)return G[Z].values;return null},P=$.position,O=P.values.length/P.valuesPerElement;for(const Y in $){const G=$[Y],Z=G.values,H=M(Y)??xM(O);A.push([Y,new Si(Z,H,G.valuesPerElement,!0)])}const D=S.texture,L=f&&f[D];if(L&&!_.has(D)){const{image:Y,parameters:G}=L,Z=new Vre(Y,G);r.push(Z),_.set(D,Z)}const F=_.get(D),U=F?F.id:void 0,N=S.material;let j=n.get(N,D);if(j==null){const Y=h[N.slice(N.lastIndexOf("/")+1)].params;Y.transparency===1&&(Y.transparency=0);const G=L?U4e(L.alphaChannelUsage):void 0,Z={ambient:VR(Y.diffuse),diffuse:VR(Y.diffuse),opacity:1-(Y.transparency||0),textureAlphaMode:G,textureAlphaCutoff:.33,textureId:U,doubleSided:!0,cullFace:0,colorMixMode:Y.externalColorMixMode||"tint",textureAlphaPremultiplied:L?.parameters.preMultiplyAlpha??!1};e?.materialParameters&&Object.assign(Z,e.materialParameters),j=new ODe(Z,e),n.set(N,D,j)}s.push(j);const B=new Xl(j,A);y+=A.find(Y=>Y[0]==="position")?.[1]?.indices.length??0,i.push(B)}return{engineResources:[{name:l,stageResources:{textures:r,materials:s,geometries:i},pivotOffset:a.model.pivotOffset,numberOfVertices:y,lodThreshold:null}],referenceBoundingBox:gxt(i)}}function gxt(t){const e=Nc();return t.forEach(i=>{const r=i.boundingInfo;r!=null&&(LC(e,r.bbMin),LC(e,r.bbMax))}),e}async function yxt(t,e){const i=new Array;for(const n in t){const a=t[n],o=a.images[0].data;if(!o){ng().warn("Externally referenced texture data is not yet supported");continue}const l=a.encoding+";base64,"+o,c="/textureDefinitions/"+n,h=a.channels==="rgba"?a.alphaChannelUsage||"transparency":"none",f={noUnpackFlip:!0,wrap:{s:10497,t:10497},preMultiplyAlpha:U4e(h)!==1},y=e?.disableTextures?Promise.resolve(null):$y(l,e);i.push(y.then(_=>({refId:c,image:_,parameters:f,alphaChannelUsage:h})))}const r=await Promise.all(i),s={};for(const n of r)s[n.refId]=n;return s}function U4e(t){switch(t){case"mask":return 2;case"maskAndTransparency":return 3;case"none":return 1;default:return 0}}function _xt(t){const e=t.params;return{id:1,material:e.material,texture:e.texture,region:e.texture}}const vxt=new q8(1,2,"wosr");let bxt=class{constructor(e){this._gltfLoading=new Map,this._wosrLoading=new Map,this._gltfCache=e("gltf-resources",()=>{}),this._wosrCache=e("wosr-resources",()=>{})}destroy(){this._gltfLoading.forEach(e=>e.abortController.abort()),this._wosrLoading.forEach(e=>e.abortController.abort()),this._gltfCache.destroy(),this._wosrCache.destroy()}loadGLTF(e,i,r){const s=r?`gltfPBR:${e}`:`gltf:${e}`,n=this._gltfCache.get(s);return n?Promise.resolve(n):Lye(this._gltfLoading,this._gltfCache,s,async a=>{const{loadGLTF:o}=await te(()=>import("./loader-D76-4GSr.js"),__vite__mapDeps([365,221]));return o(new zwt(a.streamDataRequester),e,a,r)},i)}loadWOSR(e,i){const r=`wosr:${e}:${i.disableTextures}`,s=this._wosrCache.get(r);return s?Promise.resolve(s):Lye(this._wosrLoading,this._wosrCache,r,n=>dxt(e,n),i)}};async function Lye(t,e,i,r,s){st(s);const n=qa(s,()=>wxt(t,i));let a=t.get(i);if(a)a.refCount++;else{const o=new AbortController;a={refCount:1,abortController:o,promise:r({...s,signal:o.signal})},t.set(i,a)}try{const o=await a.promise;return e.put(i,o),t.delete(i),st(s),o}finally{Ki(n)}}function wxt(t,e){const i=t.get(e);i!=null&&--i.refCount>0||(t.delete(e),i?.abortController.abort())}let R3=class extends Me{constructor(e,i){super({}),this._stage=e,this._textureRequests=new Map,this._frameTask=i?.registerTask(yt.TEXTURE_UNLOAD)??W_}normalizeCtorArgs(){return{}}destroy(){super.destroy(),this._frameTask?.remove(),this._textureRequests?.forEach(e=>this._releaseTextureRequest(e)),this._textureRequests?.clear()}get updating(){return this._frameTask.updating}fromData(e,i){const r=this.makeUid(e);let s=this._textureRequests.get(r);if(!s){const n=new j4e;n.texture=i(),this._stage&&(n.texture.load(this._stage.renderView.renderingContext),this._stage.addTexture(n.texture)),this._textureRequests.set(r,n),s=n}return s.referenceCount++,new B4e(r,s.texture,()=>this._release(r))}_release(e){const i=this._textureRequests.get(e);i?(i.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+e),i.referenceCount--,i.referenceCount<1&&this._frameTask.schedule(()=>this._releaseNow(e))):console.warn(`TextureCollection: texture doesn't exist: '${e}'`)}get test(){}_releaseNow(e){if(!this._textureRequests)return;const i=this._textureRequests.get(e);!i||i.referenceCount>0||(i.texture?.unload(),this._releaseTextureRequest(i),this._textureRequests.delete(e))}_releaseTextureRequest(e){e.texture?this._stage?.removeTexture(e.texture):e.abortController&&(e.abortController.abort(),e.abortController=null)}makeUid(e,i=null){return i!=null?`${e}.${i}px`:e}};d([m()],R3.prototype,"_frameTask",void 0),d([m()],R3.prototype,"updating",null),R3=d([k("esri.views.3d.support.TextureCollection")],R3);let B4e=class{constructor(e,i,r){this.uid=e,this.texture=i,this.release=r}},j4e=class{constructor(){this.referenceCount=0}},xxt=class extends R3{constructor(e,i,r){super(i,r),this._streamDataRequester=e}async fromUrl(e,i,r){st(r);const s=r?.signal,n=this.makeUid(e,i);let a=this._textureRequests.get(n);if(!a){const o=new AbortController,l=this._streamDataRequester.request(e,2,{uid:n,signal:o.signal});a=new j4e,a.abortController=o;const c=a;this._textureRequests.set(n,a),a.textureAsync=l.then(async h=>{const f=this._createTexture(e,h,i);return c.texture=f,c.abortController=null,await f.load(this._stage.renderView.renderingContext),this._stage.addTexture(f),new B4e(n,f,()=>this._release(n))},h=>{throw c.abortController=null,h})}a.referenceCount++;try{return await Px(a.textureAsync,s)}catch(o){throw this._release(n),o}}_createTexture(e,i,r){const s={width:i.width,height:i.height,wrap:{s:33071,t:33071},preMultiplyAlpha:!0,reloadable:!0};if(pxe(e)){if(r||i.width===0&&i.height===0){const n=i.width?i.height/i.width:1;r=r||64,n>1?(i.width=Math.round(r/n),i.height=r):(i.width=r,i.height=Math.round(r*n))}this._stage.renderView?.renderingContext.driverTest.svgPremultipliesAlpha.result&&(s.preMultiplyAlpha=!1)}return new Vre(i,s)}},Sxt=class{constructor(e){this.streamDataRequester=null,this.cimSymbolRasterizer=null,this.streamDataRequester=e.resourceController.createStreamDataRequester(4),this.objectResourceCache=new bxt((i,r)=>e.resourceController.memoryController.newCache(i,r)),this.textures=new xxt(this.streamDataRequester,e.view.stage,e.resourceController.scheduler)}destroy(){this.textures.destroy(),this.streamDataRequester=null}},HO=class extends Me{constructor(e){super(e),this._propertiesPool=new _y({plane:()=>Py()},this),this.isDecoration=!0,this.addHandles(JV(this._propertiesPool))}set plane(e){if(!e)return void this._set("plane",e);const i=this._propertiesPool.get("plane");o2(e,i),this._set("plane",i)}};d([m()],HO.prototype,"plane",null),d([m()],HO.prototype,"isDecoration",void 0),HO=d([k("esri.views.3d.support.ViewSlice")],HO);let Txt=class{constructor(e){this.destination=e}hide(){this.graphic!=null&&(this.destination.remove(this.graphic),this.graphic=null)}},LT=class extends Txt{constructor(e,i,r=""){super(e),this._symbol=new Hd({symbolLayers:new He([new Fa({material:{color:i},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new jn({text:r,halo:{color:"white",size:1/.75},material:{color:i},size:12})])})}show(e,i){if(!i)return;this.hide();const r=new Qe({x:e[0],y:e[1],z:e[2],spatialReference:i});this.graphic=new Gn({geometry:r,symbol:this._symbol}),this.destination.add(this.graphic)}},q4e=class{constructor(e,i){this.layer=e,this.parameters=i}},$xt=class extends q4e{constructor(e,i,r){super(e,r),this.outSpatialReference=i,this.type="geometry"}selectTilesAtLOD(e){if(e<0)this.geometry.coordinates.forEach(i=>i.tile=null);else{const{tileInfo:i,tilemapCache:r}=this.layer,s=xD(i,r)[e].level;this.geometry.coordinates.forEach(n=>n.tile=i.tileAt(s,n.x,n.y))}}allElevationTilesFetched(){return!this.geometry.coordinates.some(e=>!e.elevationTile)}clearElevationTiles(){for(const e of this.geometry.coordinates)e.elevationTile!==this.outsideExtentTile&&(e.elevationTile=null)}populateElevationTiles(e){for(const i of this.geometry.coordinates)!i.elevationTile&&i.tile?.id&&(i.elevationTile=e[i.tile.id])}remapTiles(e){for(const i of this.geometry.coordinates){const r=i.tile?.id;i.tile=r?e[r]:null}}getTilesToFetch(){return q3(this.geometry.coordinates.filter(({tile:e,elevationTile:i})=>e?.id&&!i),(e,i)=>e.tile?.id===i.tile?.id).map(({tile:e})=>e)}forEachTileToFetch(e){for(const i of this.geometry.coordinates)i.tile&&!i.elevationTile&&e(i.tile,()=>i.tile=null)}},Cxt=class extends q4e{constructor(e,i,r,s){super(e,r),this.maskExtents=s,this.type="extent",this.elevationTiles=[],this._candidateTiles=[],this._fetchedCandidates=new Set,this.extent=i.clone().intersection(e.fullExtent)}selectTilesAtLOD(e,i){const r=this._maximumLodForRequests(i),s=Math.min(r,e);s<0?this._candidateTiles.length=0:this._selectCandidateTilesCoveringExtentAt(s)}_maximumLodForRequests(e){const{tileInfo:i,tilemapCache:r}=this.layer,s=xD(i,r);if(!e)return s.length-1;const n=this.extent;if(n==null)return-1;for(let a=s.length-1;a>=0;a--){const o=s[a],l=o.resolution*i.size[0],c=o.resolution*i.size[1];if(Math.ceil(n.width/l)*Math.ceil(n.height/c)<=e)return a}return-1}allElevationTilesFetched(){return this._candidateTiles.length===this.elevationTiles.length}clearElevationTiles(){this.elevationTiles.length=0,this._fetchedCandidates.clear()}populateElevationTiles(e){for(const i of this._candidateTiles){const r=i.id&&e[i.id];r&&(this._fetchedCandidates.add(i),this.elevationTiles.push(r))}}remapTiles(e){this._candidateTiles=kye(this._candidateTiles.map(i=>e[i.id]))}getTilesToFetch(){return this._candidateTiles}forEachTileToFetch(e,i){const r=this._candidateTiles;this._candidateTiles=[],r.forEach(s=>{if(this._fetchedCandidates.has(s))return void i?.(s);let n=!1;e(s,()=>n=!0),n?i?.(s):this._candidateTiles.push(s)}),this._candidateTiles=kye(this._candidateTiles,i)}_selectCandidateTilesCoveringExtentAt(e){this._candidateTiles.length=0;const i=this.extent;if(i==null)return;const{tileInfo:r,tilemapCache:s}=this.layer,n=xD(r,s)[e],a=r.tileAt(n.level,i.xmin,i.ymin),o=a.extent,l=n.resolution*r.size[0],c=n.resolution*r.size[1],h=Math.ceil((i.xmax-o[0])/l),f=Math.ceil((i.ymax-o[1])/c);for(let y=0;y<f;y++)for(let _=0;_<h;_++){const w=new o4(a.level,a.row-y,a.col+_);r.updateTileInfo(w),this._tileIsMasked(w)||this._candidateTiles.push(w)}}_tileIsMasked(e){return this.maskExtents?.some(i=>mU(i,e.extent))??!1}};function Ure(t){return t?.tileInfo!=null}function xD(t,e){const i=t.lods;if(Ure(e)){const{effectiveMinLOD:r,effectiveMaxLOD:s}=e;return i.filter(n=>n.level>=r&&n.level<=s)}return i}function kye(t,e){const i={},r=[];for(const n of t){const a=n.id;a&&!i[a]?(i[a]=n,r.push(n)):e?.(n)}const s=r.sort((n,a)=>n.level-a.level);return s.filter((n,a)=>{for(let o=0;o<a;o++){const l=s[o].extent;if(l&&mU(l,n.extent))return e?.(n),!1}return!0})}let G4e=class{constructor(e,i){this.data=e,this.safeWidth=.99999999*(e.width-1),this.dx=(e.width-1)/(i[2]-i[0]),this.dy=(e.width-1)/(i[3]-i[1]),this.x0=i[0],this.y1=i[3]}},H4e=class{constructor(e,i=null){if(this.key=e,i!=null){const r=e.extent;this._samplerData=new G4e(i,r)}}get zmin(){return this._samplerData!=null?this._samplerData.data.minValue:0}get zmax(){return this._samplerData!=null?this._samplerData.data.maxValue:0}get hasNoDataValues(){return!!this._samplerData?.data.hasNoDataValues}sample(e,i){if(this._samplerData==null)return;const{safeWidth:r,data:s,dx:n,dy:a,y1:o,x0:l}=this._samplerData,{width:c,values:h,noDataValue:f}=s,y=zye(a*(o-i),0,r),_=zye(n*(e-l),0,r),w=Math.floor(y),x=Math.floor(_),S=w*c+x,$=S+c,A=h[S],M=h[$],P=h[S+1],O=h[$+1];if(A!==f&&M!==f&&P!==f&&O!==f){const D=_-x,L=A+(P-A)*D;return L+(M+(O-M)*D-L)*(y-w)}}};function zye(t,e,i){return t<e?e:t>i?i:t}let ZC=class EF{constructor(e){this.geometry=e,this.spatialReference=e.spatialReference}export(){return this._exporter(this.coordinates,this.spatialReference)}clone(e){const i=new EF(this.geometry);return i.spatialReference=this.spatialReference,i.coordinates=e??this.coordinates.map(r=>r.clone()),i._exporter=this._exporter,i}async project(e,i){if(this.spatialReference.equals(e))return this.clone();await wp([{source:this.spatialReference,dest:e}],{signal:i});const r=new Po({spatialReference:this.spatialReference,points:this.coordinates.map(o=>[o.x,o.y])}),s=zo(r,e);if(!s)return null;const n=this.coordinates.map((o,l)=>{const c=o.clone(),h=s.points[l];return c.x=h[0],c.y=h[1],c}),a=this.clone(n);return a.spatialReference=e,a}static fromGeometry(e){const i=new EF(e);if(e instanceof EF)return i.coordinates=e.coordinates.map(r=>r.clone()),i._exporter=(r,s)=>{const n=e.clone(r);return n.spatialReference=s,n},i;switch(e.type){case"point":{const r=e,{hasZ:s,hasM:n}=r;return i.coordinates=s&&n?[new ch(r.x,r.y,r.z,r.m)]:s?[new ch(r.x,r.y,r.z)]:n?[new ch(r.x,r.y,null,r.m)]:[new ch(r.x,r.y)],i._exporter=(a,o)=>e.hasM?new Qe(a[0].x,a[0].y,a[0].z,a[0].m,o):new Qe(a[0].x,a[0].y,a[0].z,o),i}case"multipoint":{const r=e,{hasZ:s,hasM:n}=r;return i.coordinates=s&&n?r.points.map(a=>new ch(a[0],a[1],a[2],a[3])):s?r.points.map(a=>new ch(a[0],a[1],a[2])):n?r.points.map(a=>new ch(a[0],a[1],null,a[2])):r.points.map(a=>new ch(a[0],a[1])),i._exporter=(a,o)=>e.hasM?new Po({points:a.map(l=>[l.x,l.y,l.z??0,l.m??0]),hasZ:!0,hasM:!0,spatialReference:o}):new Po({points:a.map(l=>[l.x,l.y,l.z??0]),spatialReference:o}),i}case"polyline":{const r=e,s=[],n=[],{hasZ:a,hasM:o}=e;let l=0;for(const c of r.paths)if(n.push([l,l+c.length]),l+=c.length,a&&o)for(const h of c)s.push(new ch(h[0],h[1],h[2],h[3]));else if(a)for(const h of c)s.push(new ch(h[0],h[1],h[2]));else if(o)for(const h of c)s.push(new ch(h[0],h[1],null,h[2]));else for(const h of c)s.push(new ch(h[0],h[1]));return i.coordinates=s,i._exporter=(c,h)=>{const f=e.hasM?c.map(_=>[_.x,_.y,_.z??0,_.m??0]):c.map(_=>[_.x,_.y,_.z??0]),y=n.map(_=>f.slice(_[0],_[1]));return new Ps({paths:y,hasM:e.hasM,hasZ:!0,spatialReference:h})},i}}}},ch=class W4e{constructor(e,i,r=null,s=null,n=null,a=null){this.x=e,this.y=i,this.z=r,this.m=s,this.tile=n,this.elevationTile=a}clone(){return new W4e(this.x,this.y,this.z,this.m)}},D3=class extends aD{get spatialReference(){return this.extent.spatialReference}constructor(e){const i=e.noDataValue,r="tiles"in e?e.tiles.map(n=>new kT({tile:n,tileInfo:e.tileInfo,noDataValue:i})):e.samplers;super({noDataValue:i,samplers:r});const s=r[0];if(s){this.extent=s.extent.clone();const{min:n,max:a}=s.demResolution;this.demResolution={min:n,max:a};for(let o=1;o<r.length;o++){const l=r[o];this.extent.union(l.extent),this.demResolution.min=Math.min(this.demResolution.min,l.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,l.demResolution.max)}}else{const n="tileInfo"in e?e.tileInfo:null;this.extent=fU(Pi(),n?.spatialReference??Ie.WGS84),this.demResolution={min:0,max:0}}}elevationAt(e,i){let r;for(const s of this.samplers)if(s.containsAt(e,i)&&(r=s.elevationAt(e,i),r!==s.noDataValue))return r;return r??(fe.getLogger(this).warn("#elevationAt()",`Point used to sample elevation (${e}, ${i}) is outside of the sampler`),this.noDataValue)}};d([m({constructOnly:!0})],D3.prototype,"noDataValue",void 0),d([m({constructOnly:!0})],D3.prototype,"samplers",void 0),D3=d([k("esri.layers.support.TileElevationSampler")],D3);let kT=class extends aD{get spatialReference(){return this.extent.spatialReference}constructor(e){super(e);const i=e.tile.key.extent;this.extent=fU(i,e.tileInfo.spatialReference),this.extent.zmin=e.tile.zmin,this.extent.zmax=e.tile.zmax;const r=Wr(e.tileInfo.spatialReference),s=e.tileInfo.lodAt(e.tile.key.level).resolution*r;this.demResolution={min:s,max:s}}contains(e){const i=this.projectIfRequired(e,this.spatialReference);return i!=null&&this.containsAt(i.x,i.y)}containsAt(e,i){return mC(this.tile.key.extent,e,i)}elevationAt(e,i){return this.containsAt(e,i)?this.tile.sample(e,i)??this.noDataValue:this.noDataValue}};d([m({constructOnly:!0})],kT.prototype,"tile",void 0),d([m({constructOnly:!0})],kT.prototype,"noDataValue",void 0),d([m({constructOnly:!0})],kT.prototype,"tileInfo",void 0),kT=d([k("esri.layers.support.TileElevationSampler.SingleTileElevationSampler")],kT);async function Mxt(t,e,i){if(t=i?.ignoreInvisibleLayers?t.filter(l=>l.visible):t.slice(),!t.length)throw new ee(P4,"Elevation queries require at least one elevation layer to fetch tiles from");const r=ZC.fromGeometry(e),s={...G8,...i,returnSampleInfo:!0},n=t.pop(),a=await Bre(n,r,s),o=await Q4e(t,a,s);return o.geometry=o.geometry.export(),i?.returnSampleInfo||delete o.sampleInfo,o}async function Bre(t,e,i){if(!t)throw new ee(P4,"Elevation queries require an elevation layer to fetch tiles from");if(!e||!(e instanceof ZC)&&e.type!=="point"&&e.type!=="multipoint"&&e.type!=="polyline")throw new ee("elevation-query:invalid-geometry","Only point, polyline and multipoint geometries can be used to query elevation");const r={...G8,...i},s=new $xt(t,e.spatialReference,r),n=r.signal;return await t.load({signal:n}),await Pxt(s,e,n),await X4e(s,n),await H8(s,n),zxt(s),Fxt(s,n)}async function Ext(t,e,i){if(t=Array.isArray(t)?t:[t],(t=i?.ignoreInvisibleLayers?t.filter(n=>n.visible):t.slice()).length===0)throw new ee(P4,"Elevation queries require at least one elevation layer to fetch tiles from");if(!e||e.type!=="extent")throw new ee("elevation-query:invalid-extent","Invalid or undefined extent");const r={...G8,...i,returnSampleInfo:!0},s=Z4e(t[t.length-1],e,r);return t.length===1?s:Y4e(t,e,await s,r)}async function Z4e(t,e,i,r){const s=i.signal;await t.load({signal:s});const n=e.spatialReference,a=t.tileInfo.spatialReference;n.equals(a)||(await wp([{source:n,dest:a}],{signal:s}),e=zo(e,a));const o=new Cxt(t,e,i,r);await X4e(o,s),await H8(o,s);const l=o.elevationTiles,c=o.layer.tileInfo,h=o.parameters.noDataValue;return new D3({noDataValue:h,tiles:l,tileInfo:c})}async function Y4e(t,e,i,r){if(t.pop(),!t.length)return i;const s=i.samplers.filter(l=>!l.tile.hasNoDataValues).map(l=>JK(l.extent)),n=await Z4e(t[t.length-1],e,r,s);if(n.samplers.length===0)return i;const a=i.samplers.concat(n.samplers),o=r.noDataValue;return Y4e(t,e,new D3({samplers:a,noDataValue:o}),r)}async function Q4e(t,e,i){const r=e.geometry.coordinates,s=e.sampleInfo;rM(s);const n=new Array,a=new Array;for(let f=0;f<r.length;f++)s[f].demResolution<0&&t.length&&(n.push(r[f]),a.push(f));const o=t.pop();if(o==null||n.length===0)return e;const l=e.geometry.clone(n),c=await Bre(o,l,i),h=c.sampleInfo;if(!h)throw new Error("no sampleInfo");return a.forEach((f,y)=>{r[f].z=c.geometry.coordinates[y].z,s[f].demResolution=h[y].demResolution,s[f].source=h[y].source}),Q4e(t,e,i)}async function X4e(t,e){t.type==="geometry"&&Rxt(t);const i=t.parameters.demResolution;if(typeof i=="number")Ixt(t,i);else if(i==="finest-contiguous")await Axt(t,e);else{if(i!=="auto")throw new ee("elevation-query:invalid-dem-resolution",`Invalid dem resolution value '${i}', expected a number, "finest-contiguous" or "auto"`);await Oxt(t,e)}}async function Axt(t,e){const{tileInfo:i,tilemapCache:r}=t.layer,s=jre(i,r,t.parameters.minDemResolution);await J4e(t,s,e)}async function J4e(t,e,i){const r=t.layer;if(t.selectTilesAtLOD(e),e<0)return;const s=r.tilemapCache,n=t.getTilesToFetch();try{if(s&&!Ure(s))await Px(Promise.all(n.map(a=>s.fetchAvailability(a.level,a.row,a.col,{signal:i}))),i);else if(await H8(t,i),!t.allElevationTilesFetched())throw t.clearElevationTiles(),new ee("elevation-query:has-unavailable-tiles","Some elevation tiles are unavailable")}catch(a){My(a),await J4e(t,e-1,i)}}async function Oxt(t,e){Lxt(t),kxt(t);const i=t.layer.tilemapCache;if(!i||Ure(i))return K4e(t,e);const r=t.getTilesToFetch(),s={},n=r.map(async a=>{const o=new o4(0,0,0),l=await Xf(i.fetchAvailabilityUpsample(a.level,a.row,a.col,o,{signal:e}));l.ok!==!1?a.id!=null&&(s[a.id]=o):My(l.error)});await Px(Promise.all(n),e),t.remapTiles(s)}async function K4e(t,e){const i=t.layer.tileInfo;await H8(t,e);let r=!1;t.forEachTileToFetch((s,n)=>{i.upsampleTile(s)?r=!0:n()}),r&&await K4e(t,e)}function jre(t,e,i=0){const r=xD(t,e);let s=r.length-1;if(i>0){const n=i/Wr(t.spatialReference),a=r.findIndex(o=>o.resolution<n);a===0?s=0:a>0&&(s=a-1)}return s}const G8={maximumAutoTileRequests:20,noDataValue:0,returnSampleInfo:!1,demResolution:"auto",minDemResolution:0,signal:null};async function Pxt(t,e,i){let r;const s=t.layer.tileInfo.spatialReference;if(e instanceof ZC?r=await e.project(s,i):(await wp([{source:e.spatialReference,dest:s}],{signal:i}),r=zo(e,s)),!r)throw new ee("elevation-query:spatial-reference-mismatch",`Cannot query elevation in '${e.spatialReference.wkid}' on an elevation service in '${s.wkid}'`);t.geometry=ZC.fromGeometry(r)}function Rxt(t){if(t.layer.fullExtent==null)return;const e=new H4e(new o4(-1,-1,-1));e.sample=()=>t.parameters.noDataValue,t.outsideExtentTile=e;const i=t.layer.fullExtent;t.geometry.coordinates.forEach(r=>{const s=r.x,n=r.y;(s<i.xmin||s>i.xmax||n<i.ymin||n>i.ymax)&&(r.elevationTile=e)})}function Dxt(t,e){const{tileInfo:i,tilemapCache:r}=t.layer,s=e/Wr(i.spatialReference),n=xD(i,r);let a=n[0],o=0;for(let l=1;l<n.length;l++){const c=n[l];Math.abs(c.resolution-s)<Math.abs(a.resolution-s)&&(a=c,o=l)}return o}function Ixt(t,e){const i=Dxt(t,e);t.selectTilesAtLOD(i)}function Lxt(t){const{tileInfo:e,tilemapCache:i}=t.layer,r=jre(e,i,t.parameters.minDemResolution);t.selectTilesAtLOD(r,t.parameters.maximumAutoTileRequests)}async function H8(t,e){const i=t.getTilesToFetch(),r={},s=t.parameters.cache,n=t.parameters.noDataValue,a={noDataValue:n,signal:e},o=i.map(async l=>{if(l.id==null)return;const c=`${t.layer.uid}:${l.id}:${n}`,h=s?.get(c),f=h??await t.layer.fetchTile(l.level,l.row,l.col,a);s?.put(c,f),r[l.id]=new H4e(l,f)});await Px(Promise.allSettled(o),e),t.populateElevationTiles(r)}function kxt(t){const e=t.layer.tileInfo;let i=0;const r={},s=o=>{o.id!=null&&(o.id in r?r[o.id]++:(r[o.id]=1,i++))},n=o=>{if(o.id==null)return;const l=r[o.id];l===1?(delete r[o.id],i--):r[o.id]=l-1};t.forEachTileToFetch(s,n);let a=!0;for(;a&&(a=!1,t.forEachTileToFetch(o=>{i<=t.parameters.maximumAutoTileRequests||(n(o),e.upsampleTile(o)&&(a=!0),s(o))},n),a););}function zxt(t){t.geometry.coordinates.forEach(e=>{const i=e.elevationTile;let r=t.parameters.noDataValue;if(i){const s=i.sample(e.x,e.y);s==null?e.elevationTile=null:r=s}e.z=r})}async function Fxt(t,e){const i=await t.geometry.project(t.outSpatialReference,e);rM(i);const r={geometry:i.export(),noDataValue:t.parameters.noDataValue};return t.parameters.returnSampleInfo&&(r.sampleInfo=Nxt(t)),t.geometry.coordinates.forEach(s=>{s.tile=null,s.elevationTile=null}),r}function Nxt(t){const e=t.layer.tileInfo,i=Wr(e.spatialReference);return t.geometry.coordinates.map(r=>{let s=-1;return r.elevationTile&&r.elevationTile!==t.outsideExtentTile&&(s=e.lodAt(r.elevationTile.key.level).resolution*i),{demResolution:s,source:s===-1?void 0:t.layer}})}const P4="elevation-query:invalid-layer",Fye=Object.freeze(Object.defineProperty({__proto__:null,InvalidLayerError:P4,createSampler:Ext,defaultOptions:G8,getFinestLodIndex:jre,query:Bre,queryAll:Mxt},Symbol.toStringTag,{value:"Module"}));let S_=class extends Me{constructor(e){super(e)}};d([m({constructOnly:!0})],S_.prototype,"renderCoordsHelper",void 0),d([m({constructOnly:!0})],S_.prototype,"surface",void 0),d([m({constructOnly:!0})],S_.prototype,"state",void 0),S_=d([k("esri.views.3d.support.pointsOfInterest.PointOfInterest")],S_);let yh=class extends S_{constructor(e){super(e),this._dirty=!1,this._propertiesPool=new _y({location:()=>new Qe,renderLocation:()=>R()},this),this._estimatedSurfaceAltitude=0,this._elevationQueryController=null,this.renderLocation=R(),this._tmpPoint=new Qe}initialize(){if(this.scheduler&&this.addHandles(this.scheduler.registerTask(this.task,this)),this.runTask(),this.map){const e=()=>this._setDirty();this.addHandles(Ys(()=>this.map?.ground?.layers,"change",e,{onListenerAdd:e,onListenerRemove:e}))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest(),this._propertiesPool=Re(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return e.spatialReference=this.state.spatialReference,this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e),e}get scale(){const e=this._camera,i=Ri(e.eye,this.renderLocation),r={renderCoordsHelper:this.renderCoordsHelper,state:{camera:e}};return Zx(r,i)}get updating(){return this._dirty||this._elevationQueryController!=null}updateRenderLocation(){this._setDirty(),this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){const e=this._elevationQueryController;e&&(this._elevationQueryController=null,e.abort(),this.notifyChange("updating"))}get readyToRun(){return!this._elevationQueryController&&this._dirty}runTask(){if(this._cancelPendingRequest(),this._dirty=!1,this.notifyChange("updating"),!this.map?.ground)return this._updateSurfaceAltitude(0),ea;const e=this.state.spatialReference;this._tmpPoint.spatialReference=e,this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this._tmpPoint);const i=(this._tmpPoint.z??0)>Vxt&&this.renderCoordsHelper.viewingMode===1&&(e.isWGS84||e.isWebMercator);let r=new AbortController;return this.map.ground.queryElevation(this._tmpPoint,{signal:r.signal,cache:this.cache,minDemResolution:i?Uxt:0}).then(s=>this._updateSurfaceAltitude(s.geometry.z??0)).catch(s=>{if(s.name===P4)if(this.integratedMeshElevationSampler){this._tmpPoint.spatialReference=this.integratedMeshElevationSampler.spatialReference,this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this._tmpPoint);const n=this.integratedMeshElevationSampler.elevationAt(this._tmpPoint.x,this._tmpPoint.y)??0;this._updateSurfaceAltitude(n===this.integratedMeshElevationSampler.noDataValue?0:n)}else this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._elevationQueryController===r&&(this._elevationQueryController=null,this.notifyChange("updating")),r=null}),this._elevationQueryController=r,ea}_updateSurfaceAltitude(e){this._estimatedSurfaceAltitude!==e&&(this._estimatedSurfaceAltitude=e,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(_G,this._estimatedSurfaceAltitude,this._camera.eye),si(this._get("renderLocation"),_G)||(this._set("renderLocation",de(this._propertiesPool.get("renderLocation"),_G)),this.notifyChange("renderLocation"))}};d([m({constructOnly:!0})],yh.prototype,"scheduler",void 0),d([m({constructOnly:!0})],yh.prototype,"cache",void 0),d([m({constructOnly:!0})],yh.prototype,"map",void 0),d([m({constructOnly:!0})],yh.prototype,"task",void 0),d([m({constructOnly:!0})],yh.prototype,"integratedMeshElevationSampler",void 0),d([m()],yh.prototype,"location",null),d([m()],yh.prototype,"renderLocation",void 0),d([m()],yh.prototype,"scale",null),d([m()],yh.prototype,"updating",null),yh=d([k("esri.views.3d.support.pointsOfInterest.CameraOnSurface")],yh);const _G=R(),Vxt=1e5,Uxt=1e6;let Ch=class extends S_{constructor(e){super(e),this._propertiesPool=new _y({location:()=>new Qe,renderLocation:()=>R()},this),this._currentSurfaceAltitude=0,this._latestSurfaceAltitude=0,this.distance=0,this.renderLocation=R(),this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this),this.runTask()}destroy(){this._frameWorker=Ki(this._frameWorker),this._propertiesPool=Re(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool?.get("location");return e?(e.spatialReference=this.state.spatialReference,this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e),e):new Qe}updateRenderLocation(){this.updating=!0,this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get readyToRun(){return this.updating}runTask(){return this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter(),this._updateRenderLocation(),this.updating=!1,ea}_updateRenderLocation(){const e=jxt;let i=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,e);const r=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!i&&r&&(i=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,e),i&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude));const s=qxt;i&&this._latestSurfaceAltitudeChangesDistanceSignificantly(e,s)&&(de(e,s),this._currentSurfaceAltitude=this._latestSurfaceAltitude),i?this.distance=Ri(this._camera.eye,e):(le(e,this._camera.viewForward,this._get("distance")),xe(e,e,this._camera.eye)),si(this._get("renderLocation"),e)||this._set("renderLocation",de(this._propertiesPool.get("renderLocation"),e))}_calculateSurfaceIntersection(e,i){const r=this._camera;if(!this.renderCoordsHelper.intersectInfiniteManifold(r.ray,e,i))return!1;if(this.state.isGlobal){const s=or(this.renderCoordsHelper.spatialReference).radius,n=s+e,a=On(r.eye),o=a<n*n,l=Ri(r.eye,i);if(o&&l>s/4){const c=n-Math.sqrt(a);return le(i,r.viewForward,c),xe(i,i,r.eye),!0}}else{const s=this.surface?.ready?this.surface.extentAABR:null;s!=null&&Pee(s,this.surface?.spatialReference,vA,this.renderCoordsHelper.spatialReference)&&(i[0]=Se(i[0],vA[0],vA[2]),i[1]=Se(i[1],vA[1],vA[3]))}return!0}_latestSurfaceAltitudeChangesDistanceSignificantly(e,i){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||e==null)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,i)){if(Ws.TESTS_DISABLE_OPTIMIZATIONS)return!0;const r=this._camera.eye,s=Ri(r,e),n=Ri(r,i);if(Math.abs(n-s)/s>Bxt)return!0}return!1}};d([m({constructOnly:!0})],Ch.prototype,"scheduler",void 0),d([m({constructOnly:!0})],Ch.prototype,"task",void 0),d([m()],Ch.prototype,"distance",void 0),d([m({constructOnly:!0})],Ch.prototype,"estimateSurfaceAltitudeAtCenter",void 0),d([m({readOnly:!0})],Ch.prototype,"location",null),d([m({readOnly:!0})],Ch.prototype,"renderLocation",void 0),d([m()],Ch.prototype,"updating",void 0),Ch=d([k("esri.views.3d.support.pointsOfInterest.CenterOnSurface")],Ch);const Bxt=.05,jxt=R(),qxt=R(),vA=Pi();function eIe(t,e,i){const r=i?.createCollection?.()??new He,s=i?.recycleItems?new Gxt:null,n=(l,c=0)=>{if(!l?.length)return;const h=r.splice(c,l.length);s?s.processRemoved(l):h.forEach(gV)},a=(l,c=0)=>{if(!l?.length)return;const h=[];for(const f of l){const y=s?.use(f);if(y)h.push(y);else{const _=e(f);s?.register(f,_),h.push(_)}}r.addMany(h,c)},o=Ys(t,"after-splice",({added:l,start:c,removed:h})=>{n(h,c),a(l,c)},{sync:!0,onListenerRemove:l=>n(l.items),onListenerAdd:l=>a(l.items)});return r.addHandles(o),r}let Gxt=class{constructor(){this._originalToMapped=new Map,this._removedItemCandidates=new Set,this._garbageCollectionQueued=!1}processRemoved(e){if(!e?.length)return;const{_removedItemCandidates:i}=this;for(const r of e)this._getItem(r)?.markRemoved()&&(i.add(r),this._queueGarbageCollection())}use(e){const i=this._getItem(e);return i&&(i.removed=!1),i?.item}register(e,i){this._originalToMapped.set(e,new Hxt(i))}_getItem(e){return this._originalToMapped.get(e)}_queueGarbageCollection(){this._garbageCollectionQueued||(this._garbageCollectionQueued=!0,queueMicrotask(()=>this._garbageCollectCandidates()))}_garbageCollectCandidates(){this._garbageCollectionQueued=!1;const{_removedItemCandidates:e}=this,i=Array.from(e);e.clear(),i.forEach(r=>this._garbageCollectIfRemoved(r))}_garbageCollectIfRemoved(e){const{_originalToMapped:i}=this,r=this._getItem(e);r?.removed&&(gV(r.item),i.delete(e))}},Hxt=class{constructor(e){this.item=e,this.removed=!1}markRemoved(){return this.removed=!0,!0}};function gV(t){typeof t=="object"&&t&&("destroy"in t&&typeof t.destroy=="function"?t.destroy():N8e(t))}function JQt(t,e,i){const r=new He,s=eIe(t,l=>Bc(async c=>{const h=await e(l,c);if(Rn(c))throw gV(h),Xt();return h}),i),n=()=>null,a=async l=>{const c=await l.promise,h=s.indexOf(l);h<0||r.splice(h,1,c)};r.addMany(s.items.map(n));for(const l of s)Hf(a(l));const o=s.on("after-splice",({added:l,start:c,deleteCount:h})=>{const f=r.splice(c,h);for(const y of f)gV(y);if(l?.length){r.addMany(l.map(n),c);for(const y of l)Hf(a(y))}});return r.addHandles([JV(s),o]),r}let Wxt=class{constructor(e,i){this._handles=new Fv,this.events=new Ey,this._handles.add([JV(eIe(()=>e,r=>r.on("visible-geometry-changed",s=>this.events.emit("request-update",s)))),Ys(i,"visible-geometry-changed",()=>this.events.emit("request-update"))])}destroy(){this._handles.destroy()}},Id=class extends S_{constructor(e){super(e),this._propertiesPool=new _y({location:()=>new Qe,renderLocation:()=>R()},this),this._dirty=!0,this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.addHandles([K(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation(),{equals:si}),K(()=>this.state.contentCamera,()=>this.updateRenderLocation())]),this.scheduler&&this.addHandles(this.scheduler.registerTask(yt.POINT_OF_INTEREST_FREQUENT,this))}destroy(){this._propertiesPool=Re(this._propertiesPool)}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const e=this._propertiesPool.get("location");return e.spatialReference=this.state.spatialReference,this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e),e}get worldUnitsPerContentPixel(){const{camera:e,contentPixelRatio:i}=this.state;return e.computeRenderPixelSizeAt(this.renderLocation)*(e.pixelRatio/i)}get readyToRun(){return this._dirty}runTask(){const e=this._get("renderLocation"),i=this.centerOnSurface.renderLocation,r=this.renderCoordsHelper,s=this.state.contentCamera;this._dirty=!1,r.worldUpAtPosition(i,Nye);const n=Math.max(0,(Math.acos(Oe(Nye,s.viewForward))-.5*Math.PI)*(s.aboveGround?1:-1));if(Number.isNaN(n)){if(!e||!Tv(e,i)){const c=this._propertiesPool.get("renderLocation");de(c,i),this._set("renderLocation",c)}return ea}const a=1-Se(n/(.5*Math.PI),0,1),o=a*a*a;this._calculateScreenHorizontalEdgeOnSurface(Vye);const l=this._propertiesPool.get("renderLocation");return Wi(l,i,Vye,o),e&&Tv(e,l)||this._set("renderLocation",l),ea}_calculateScreenHorizontalEdgeOnSurface(e){const i=this.state.contentCamera,r=i.getRenderCenter(zf());if(r[1]=i.aboveGround?i.padding[2]:i.fullHeight-i.padding[0],this.estimateSurfaceIntersectionAtRenderPoint(r,e))return e;const s=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);if(i.unprojectFromRenderScreen(r,bA)){Ce(bA,bA,i.eye);const n=Ee(bA,bA);if(this.renderCoordsHelper.intersectInfiniteManifold(Sp(i.eye,n),s,e))return e}return this.renderCoordsHelper.setAltitude(e,s,i.eye)}updateRenderLocation(){this._dirty=!0}};d([m()],Id.prototype,"_dirty",void 0),d([m({constructOnly:!0})],Id.prototype,"scheduler",void 0),d([m({constructOnly:!0})],Id.prototype,"centerOnSurface",void 0),d([m({constructOnly:!0})],Id.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0),d([m()],Id.prototype,"updating",null),d([m()],Id.prototype,"location",null),d([m()],Id.prototype,"renderLocation",void 0),d([m()],Id.prototype,"worldUnitsPerContentPixel",null),Id=d([k("esri.views.3d.support.pointsOfInterest.Focus")],Id);const Nye=R(),bA=R(),Vye=R();let ag=class extends Me{constructor(e){super(e),this.location=null,this._updateController=null}initialize(){this.view.state.isLocal&&(this.addHandles([K(()=>[this._terrain?.spatialReference,this._terrain?.extent],()=>this._update()),Ys(()=>this._ground?.layers,"change",()=>this._update())]),this._update())}destroy(){this._updateController=ps(this._updateController)}get renderLocation(){if(!this.location)return null;const e=R();return this.view.renderCoordsHelper.toRenderCoords(this.location,e),e}get _ground(){return this.view.map?.ground}get _terrain(){return this.view.basemapTerrain}_update(){if(this._updateController=ps(this._updateController),this._terrain?.extent==null||this._terrain?.spatialReference==null)return void this._set("location",null);const e=h2e(this._terrain.extent),i=new Qe({x:e[0],y:e[1],z:0,spatialReference:this._terrain.spatialReference});this._ground&&this._ground.layers.length>0?(this._set("location",null),this._updateController=new AbortController,this._ground.queryElevation(i,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(r=>{this._updateController=null,this._set("location",r.geometry)}).catch(r=>{})):this._set("location",i)}};d([m({constructOnly:!0})],ag.prototype,"view",void 0),d([m({constructOnly:!0})],ag.prototype,"cache",void 0),d([m({readOnly:!0})],ag.prototype,"location",void 0),d([m({readOnly:!0})],ag.prototype,"renderLocation",null),d([m()],ag.prototype,"_ground",null),d([m()],ag.prototype,"_terrain",null),ag=d([k("esri.views.3d.support.pointsOfInterest.StableSurfaceCenter")],ag);let og=class extends Me{constructor(e){super(e),this._tileGeometryUpdateExtent=cy(),this._tileGeometryUpdateSpatialReference=null,this.events=new Ey,this.updating=!1}initialize(){this.addHandles([this.surface.on("elevation-change",e=>this._tileGeometryChanged(e)),this.scheduler.registerTask(yt.SURFACE_GEOMETRY_UPDATES,this)])}get readyToRun(){return this.updating}runTask(){return this.updating&&(this._tileGeometryUpdateSpatialReference&&this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",Zxt),cy(this._tileGeometryUpdateExtent),this._set("updating",!1)),ea}_tileGeometryChanged(e){this._tileGeometryUpdateSpatialReference=e.spatialReference,H3(this._tileGeometryUpdateExtent,e.extent,this._tileGeometryUpdateExtent),this._set("updating",!0)}_furthestCenterOnSurface(){let e=this.centerOnSurfaces[0];for(let i=1;i<this.centerOnSurfaces.length;i++){const r=this.centerOnSurfaces[i];r.distance>e.distance&&(e=r)}return e}_centerIntersectsExtent(e,i){const r=this.state.contentCamera.eye,s=Yxt,n=this._furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(r,z1,i),this.renderCoordsHelper.fromRenderCoords(n.renderLocation,F1,i),z1[0]<F1[0]?(s[0]=z1[0],s[2]=F1[0]):(s[0]=F1[0],s[2]=z1[0]),z1[1]<F1[1]?(s[1]=z1[1],s[3]=F1[1]):(s[1]=F1[1],s[3]=z1[1]),KK(s,e)}};d([m({constructOnly:!0})],og.prototype,"state",void 0),d([m({constructOnly:!0})],og.prototype,"centerOnSurfaces",void 0),d([m({constructOnly:!0})],og.prototype,"renderCoordsHelper",void 0),d([m({constructOnly:!0})],og.prototype,"scheduler",void 0),d([m({constructOnly:!0})],og.prototype,"surface",void 0),d([m({readOnly:!0})],og.prototype,"updating",void 0),og=d([k("esri.views.3d.support.pointsOfInterest.SurfaceGeometryUpdates")],og);const Zxt={},z1=R(),F1=R(),Yxt=cy();let Al=class extends Me{constructor(e){super(e),this.renderPointOfView=R(),this._pois=new Array,this._updatingHandles=new mp,this._debugCenters=null,this._tmpRay=rn(),this._centerRayDirty=!0,this._surfaceAltitudeAtCenter=0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenter=0,this._contentAltitudeAtCenterDirty=!0,this._propertiesPool=new _y({renderPointOfView:()=>R()},this),this._contentIntersector=new Vc(e.view.state.viewingMode),this._surfaceIntersector=new Vc(e.view.state.viewingMode),this._surfaceIntersector.options.invisibleTerrain=!1,this._surfaceIntersector.options.store=0}initialize(){const{state:e,groundView:i,renderCoordsHelper:r,map:s}=this.view,n=()=>this._estimateSurfaceAltitudeAtCenter(),a=this.view.resourceController.scheduler,o=i?.elevationQueryCache,l={state:e,scheduler:a,surface:i,renderCoordsHelper:r};this._set("centerOnSurfaceInfrequent",new Ch({...l,task:yt.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:n})),this._set("centerOnSurfaceFrequent",new Ch({...l,task:yt.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:n})),this._set("centerOnContent",new Ch({...l,task:yt.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()}));const c=i.integratedMeshElevationSampler;this._set("cameraOnSurface",new yh({...l,cache:o,integratedMeshElevationSampler:c,task:yt.POINT_OF_INTEREST_INFREQUENT,map:s})),this._set("surfaceGeometryUpdates",new og({...l,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]})),this._set("contentGeometryUpdates",new Wxt(this.view.allLayerViews,()=>this.view.graphicsView)),this._set("surfaceOrigin",new ag({cache:o,view:this.view})),this._set("focus",new Id({state:e,scheduler:a,surface:i,renderCoordsHelper:r,centerOnSurface:this.centerOnSurfaceFrequent,estimateSurfaceIntersectionAtRenderPoint:(h,f)=>this._estimateSurfaceIntersectionAtRenderPoint(h,this.view.state.contentCamera,f)})),this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.cameraOnSurface,this.focus),this.addHandles([K(()=>e.contentCamera,h=>this._cameraChanged(h),Yt),this._updatingHandles.add(()=>i.extentAABR,()=>this._updateCenterPointsOfInterest()),this._updatingHandles.add(()=>this.view.map?.ground?.navigationConstraint?.type,h=>{this._surfaceIntersector.options.backfacesTerrain=h==="none"},Wt),Zs(()=>!i.updating,()=>this._updateCenterPointsOfInterest(),Yt),Ys(()=>this.surfaceGeometryUpdates.events,"request-update",()=>this._updateCenterPointsOfInterest()),Ys(()=>this.contentGeometryUpdates.events,"request-update",()=>this._updateCenterOnContent()),this._updatingHandles.add(()=>Ws.SHOW_POI,h=>this._setDebug(h),Wt)]),this._cameraChanged(this.view.state.contentCamera);for(const h of this._pois)h.runTask()}destroy(){this._setDebug(!1),this._propertiesPool.destroy();for(const e of this._pois)e.destroy();this._pois.length=0,this.surfaceOrigin.destroy(),this._updatingHandles.destroy(),this._set("centerOnSurfaceInfrequent",null),this._set("centerOnSurfaceFrequent",null),this._set("centerOnContent",null),this._set("cameraOnSurface",null),this._set("surfaceGeometryUpdates",null),this._set("contentGeometryUpdates",null),this._set("surfaceOrigin",null),this._set("focus",null)}get updating(){return!(!this.surfaceGeometryUpdates?.updating&&!this._pois.some(e=>e.updating))||this._updatingHandles.updating}get _centerRay(){return this._centerRayDirty&&(this._centerRayCached=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.contentCamera,this._tmpRay),this._centerRayDirty=!1),this._centerRayCached}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const e=this._centerRay;return e==null||(this.view.sceneIntersectionHelper.intersectRay(e,this._contentIntersector,kS,Xxt)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(kS):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter()),this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){const{view:e}=this,{groundView:i}=e;if(!i)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const r=this._centerRay;if(r==null)return this._surfaceAltitudeAtCenter;const s=r.origin,n=xe(kS,r.origin,r.direction);return this._surfaceIntersector.resetWithRay(r,e.state.contentCamera),i.intersect(this._surfaceIntersector,null,s,n),this._surfaceIntersector.results.min.getIntersectionPoint(kS)&&(this._surfaceAltitudeAtCenter=e.renderCoordsHelper.getAltitude(kS)),this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(e,i,r){const s=Eie(i,e,Qxt);if(s==null)return null;const n=s.origin,a=xe(kS,s.origin,s.direction);return this._surfaceIntersector.resetWithRay(s,i),this.view.groundView.intersect(this._surfaceIntersector,null,n,a),this._surfaceIntersector.results.min.getIntersectionPoint(r)?r:null}_cameraChanged(e){this._updateCenterPointsOfInterest();const i=e.eye;si(this.renderPointOfView,i)||this._set("renderPointOfView",de(this._propertiesPool.get("renderPointOfView"),i))}_updateCenterPointsOfInterest(){this._centerRayDirty=!0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenterDirty=!0;for(const e of this._pois)e.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0,this.centerOnContent.updateRenderLocation()}_setDebug(e){if(!e)return this._debugCenters?.forEach(i=>i.hide()),void this.removeHandles("debug");if(!this._debugCenters){this._debugCenters=new Map;const i=this.view.graphics;this._debugCenters.set(this.centerOnContent,new LT(i,"red","CenterOnContent")),this._debugCenters.set(this.centerOnSurfaceFrequent,new LT(i,"red","CenterOnSurface")),this._debugCenters.set(this.centerOnSurfaceInfrequent,new LT(i,"red","CenterOnSurface")),this._debugCenters.set(this.cameraOnSurface,new LT(i,"blue","CameraOnSurface")),this._debugCenters.set(this.focus,new LT(i,"green","Focus"))}for(const i of this._pois)this.addHandles(this._updatingHandles.add(()=>i.renderLocation,r=>this._debugCenters?.get(i)?.show(r,i.renderCoordsHelper.spatialReference),Wt),"debug")}get test(){}};d([m()],Al.prototype,"centerOnContent",void 0),d([m()],Al.prototype,"centerOnSurfaceFrequent",void 0),d([m()],Al.prototype,"centerOnSurfaceInfrequent",void 0),d([m()],Al.prototype,"cameraOnSurface",void 0),d([m()],Al.prototype,"focus",void 0),d([m()],Al.prototype,"renderPointOfView",void 0),d([m()],Al.prototype,"surfaceOrigin",void 0),d([m()],Al.prototype,"contentGeometryUpdates",void 0),d([m()],Al.prototype,"surfaceGeometryUpdates",void 0),d([m({constructOnly:!0})],Al.prototype,"view",void 0),d([m()],Al.prototype,"updating",null),Al=d([k("esri.views.3d.support.pointsOfInterest.PointsOfInterest")],Al);const kS=R(),Qxt=rn(),Xxt={exclude:new Set([Av])},Jxt=()=>fe.getLogger("esri/core/MemCachePool");let R4=class{constructor(e,i){this._cache=e(i,(r,s,n)=>{switch(s){case 0:return r.forEach(a=>a.dispose()),0;case 1:{const a=r.shift();return a?(n-=Math.round(a.usedMemory),a.dispose()):n>0&&(Jxt().warn("Encountered empty MemCachePool with non-zero memory."),n=0),n}}})}hitrate(){return this._cache.hitRate}destroy(){this._cache.destroy()}clear(){this._cache.clear()}getSize(e){return this._cache.getSize(e)}pop(e){const i=this._cache.peek(e);if(!i)return;const r=i.pop();return i.length>0?r&&(i.usedMemory=this._cache.getSize(e)-Math.round(r.usedMemory),this._cache.updateSize(e)):this._cache.pop(e),r}put(e,i,r=$$e){const s=this._cache.peek(e);if(!s){const n=new Kxt(i);return void this._cache.put(e,n,r)}s.push(i),s.usedMemory=this._cache.getSize(e)+Math.round(i.usedMemory),this._cache.updateSize(e)}},Kxt=class extends Array{constructor(e){super(),this.item=e,this.usedMemory=e.usedMemory,this.push(e)}},tIe=class{constructor(e){this._store=e}destroy(){this._store.destroy()}get(e){return this._store.get(e)}put(e,i){this._store.put(e,i)}};function oXt(t,e,i){if(t==null||i==null)return!1;let r=!0;return $n[0]=t.xmin!=null?t.xmin:0,$n[1]=t.ymin!=null?t.ymin:0,$n[2]=t.zmin!=null?t.zmin:0,r=r&&Aa($n,t.spatialReference,0,e,i,0),$n[0]=t.xmax!=null?t.xmax:0,$n[1]=t.ymax!=null?t.ymax:0,$n[2]=t.zmax!=null?t.zmax:0,r=r&&Aa($n,t.spatialReference,0,e,i,3),t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.zmin==null&&(e[2]=-1/0),t.xmax==null&&(e[3]=1/0),t.ymax==null&&(e[4]=1/0),t.zmax==null&&(e[5]=1/0),r}function e2t(t,e,i){if(t==null||i==null)return!1;let r=!0;return $n[0]=t.xmin!=null?t.xmin:0,$n[1]=t.ymin!=null?t.ymin:0,$n[2]=t.zmin!=null?t.zmin:0,r=r&&Aa($n,t.spatialReference,0,$n,i,0),e[0]=$n[0],e[1]=$n[1],$n[0]=t.xmax!=null?t.xmax:0,$n[1]=t.ymax!=null?t.ymax:0,$n[2]=t.zmax!=null?t.zmax:0,r=r&&Aa($n,t.spatialReference,0,$n,i,0),e[2]=$n[0],e[3]=$n[1],t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.xmax==null&&(e[2]=1/0),t.ymax==null&&(e[3]=1/0),r}const $n=R(),lXt={value:.5,readOnly:!0},t2t={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}};let I3=class{constructor(e=0,i=0){this.min=e,this.max=i,this.level=0,this.hasNoDataValues=!1}copyFrom(e){this.min=e.min,this.max=e.max,this.level=e.level,this.hasNoDataValues=e.hasNoDataValues}},i2t=class{constructor(e,i,r){this.type="elevation",this.level=e[0],this.i=e[1],this.j=e[2],this.extent=i,this.samplerData=new G4e(r,i)}computeMinMaxValue(e,i,r,s){s.min=1/0,s.max=-1/0,s.hasNoDataValues=!1;const n=e-this.level;if(n<=0)return s;const a=2**n;if(!(Math.floor(i/a)===this.i&&Math.floor(r/a)===this.j))return s;let o=1/0,l=-1/0;const c=this.samplerData.data.width,h=this.samplerData.data.values,f=.5*Kte;let y=(c-1)/a,_=(r-this.j*a)*y,w=(i-this.i*a)*y;if(y<1){const x=Math.floor(_),S=Math.floor(w),$=x+S*c,A=h[$],M=h[$+1],P=h[$+c],O=h[$+c+1];if(A+M+P+O<f){const D=_-x,L=w-S,F=b5(A,M,P,O,D,L),U=b5(A,M,P,O,D+y,L),N=b5(A,M,P,O,D,L+y),j=b5(A,M,P,O,D+y,L+y);return s.min=Math.min(F,U,N,j),s.max=Math.max(F,U,N,j),s}_=x,w=S,y=1}else _=Math.floor(_),w=Math.floor(w),y=Math.ceil(y);for(let x=_;x<=_+y;x++)for(let S=w;S<=w+y;S++){const $=h[x+S*c];$<f?(o=Math.min(o,$),l=Math.max(l,$)):s.hasNoDataValues=!0}return s.min=o,s.max=l,s}};const r2t=.5*Kte;function ls(t,e,i){if(i==null)return null;for(const r of i){if(!r)continue;const s=r.safeWidth;let n=Se(r.dy*(r.y1-e),0,s),a=Se(r.dx*(t-r.x0),0,s);const o=Math.floor(n),l=Math.floor(a),c=r.data.width,h=o*c+l,f=r.data.values,y=f[h],_=f[h+1],w=h+c,x=f[w],S=f[w+1];if(y+x+_+S<r2t){n-=o,a-=l;const $=y+(_-y)*a;return $+(x+(S-x)*a-$)*n}}return null}function iIe(t){return qre(t)||ZD(t)||YD(t)}function qre(t){return ly(t)||RR(t)}function s2t(t,e,i,r){if(t==null)return Jte();const s=t.spatialReference;if(s.isGeographic&&!qre(s))return new ee("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const n=Zd.checkUnsupported(t);return n??(i==null?new ee("tilingscheme:extent-not-exist","The layer does not provide a layer extent."):n2t(t,i)||(e==null||s.equals(e)||e.isWGS84&&s.isWebMercator?null:new ee("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene")))}function n2t(t,e){const i=t.lods,r=i[0].resolution*2**i[0].level,s=[r*t.size[0],r*t.size[1]],n=[t.origin.x,t.origin.y],a=JK(e),o=Pi();Zd.computeRowColExtent(a,s,n,o);const l=(o[2]-o[0])*(o[3]-o[1]);if(l>v3){const c=i[0].scale*2**i[0].level;let h=Math.max((a[3]-a[1])/t.size[1],(a[2]-a[0])/t.size[0])*c/r;const f=Math.floor(Math.log(h)/Math.log(10));return h=Math.ceil(h/10**f)*10**f,new ee("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(c).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+h.toLocaleString()+".",{level0Scale:c,suggestedLevel0Scale:h,requiredNumRootTiles:l,allowedNumRootTiles:v3})}return null}const a2t=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:s2t},Symbol.toStringTag,{value:"Module"}));function o2t(t,e,i,r){if(t==null)return Jte();const s=t?.lods.length-1,n=t.spatialReference;if(n.isWebMercator){if(!Zd.makeWebMercatorAuxiliarySphere(s).compatibleWith(t,r))return new ee("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!iIe(n))return new ee("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!Zd.makeGCSWithTileSize(t.spatialReference,t.size[0],s).compatibleWith(t,r))return t.spatialReference.isWGS84?new ee("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new ee("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return e==null||t.spatialReference.equals(e)?null:new ee("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene")}const l2t=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:o2t},Symbol.toStringTag,{value:"Module"})),c2t={1:l2t,2:a2t};function pa(t,e){t||console.warn("Terrain: "+e)}let Yn=!1,yV=!1;function u2t(t){yV=t,Yn=Yn||t}function h2t(t){Yn=t}function Be(t,e){if(Yn&&!t){const i=new Error().stack?.slice(5);throw console.warn("Terrain internal: "+(e??"")+" at "+i),new Error("Assertion failed"+(e?": "+e:""))}}function _V(t){return t?.type==="imagery-tile"||t?.type==="wcs"}function W8(t){return t?.type==="imagery-tile-3d"}function rIe(t){return t?.type==="tile-3d"}function YC(t){return t?.type==="vector-tile-3d"}function sIe(t){return t?.type==="wmts-3d"}function PX(t){return t?.type==="elevation-3d"}function wA(t){return t?.type==="group"}function SD(t){return t&&(rIe(t)||sIe(t)||W8(t)||YC(t))}function RX(t){return t&&(rIe(t)||W8(t)||YC(t)||sIe(t))}function DX(t){return RX(t)||PX(t)}function d2t(t){return P4e(t?.sourceLayerInfo?.data)}function p2t(t){return nIe(t?.sourceLayerInfo)||!!t?.isVTLBackground}function f2t(t){return R4e(t?.sourceLayerInfo?.data)}function m2t(t){const e=t?.sourceLayerInfo?.data;return j8(e)||e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData}function nIe(t){return IT(t?.data)}function v$(t){return t!=null&&"release"in t&&t.release(),null}function hXt(t){return t.fetchTile&&t.hasOverriddenFetchTile!==!1}function Gre(t,e,i,r,s){return c2t[r].checkIfTileInfoSupportedForViewSR(t,i,e,s)}function Z8(t,e,i){let r=null,s=null;if(t?.type==="wmts"){const a=g2t(t,e,i);r=a.tileInfo,s=a.fullExtent}else{s=_V(t)?t.getCompatibleFullExtent(e):t.fullExtent;const a=i===2;_V(t)?r=t.getCompatibleTileInfo(e,s,a):t?.type==="vector-tile"?r=a&&!y2t(e)||_2t.force512VTL?t.tileInfo:t.tileInfo.getCompatibleForVTL(256):r=t.tileInfo}const n="tilemapCache"in t?t.tilemapCache?.effectiveMaxLOD:void 0;return r!=null&&s!=null&&Gre(r,s,e,i,n)==null?{tileInfo:r,fullExtent:s}:null}function g2t(t,e,i){const r=$Je(t);if(r!=null){if(!He.isCollection(r))return{tileInfo:r.tileInfo,fullExtent:r.fullExtent};{const s=r.find(n=>Gre(n.tileInfo,n.fullExtent,e,i)==null);if(s)return{tileInfo:s.tileInfo,fullExtent:s.fullExtent}}}return{tileInfo:null,fullExtent:null}}function y2t(t){return t.isWGS84||t.isWebMercator||RR(t)||!WD(t)}const _2t={force512VTL:!1};function Uye(t){return"["+t[0]+","+t[1]+","+t[2]+"]"}function Fm(t){return"("+t[0]+","+t[1]+","+t[2]+")"}function Uh(t,e,i=w2t){return Math.abs(t-e)<i}function vV(t){return t===1?5:t===7?3:t===5?1:7}function Hre(t){return t===0?4:t===2?6:t===4?0:2}function v2t(t){return t===7||t===5}function b2t(t){return t===7||t===1}function Bye(t){return t===7||t===6||t===5}function jye(t){return t===1||t===2||t===3}function qye(t){return t===3||t===4||t===5}function Gye(t){return t===1||t===0||t===7}const cp=[0,2,4,6],bV=[1,3,5,7],w2t=1e-5;let Sh=class extends Me{constructor(e){super(e)}initialize(){this.addHandles([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])}destroy(){}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const e=[];return this.layerViews.forEach(i=>{const r=i.layer;if(Hx(r)&&this.viewSpatialReference!=null){const s=aIe(r.fullExtent,this.viewSpatialReference);s!=null&&e.push(JK(s))}}),e}};function x2t(t,e){return t===1?new IX(e):new LX(e)}d([m({readOnly:!0})],Sh.prototype,"layerViewsExtent",null),d([m({readOnly:!0})],Sh.prototype,"tiledLayersExtent",null),d([m({readOnly:!0})],Sh.prototype,"stencilEnabledExtents",null),d([m()],Sh.prototype,"viewSpatialReference",void 0),d([m()],Sh.prototype,"tilingScheme",void 0),d([m()],Sh.prototype,"defaultTiledLayersExtent",void 0),d([m({constructOnly:!0})],Sh.prototype,"layers",void 0),d([m({constructOnly:!0})],Sh.prototype,"layerViews",void 0),Sh=d([k("esri.views.3d.terrain.ExtentHelper")],Sh);let IX=class extends Sh{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?gAe:Kot}};IX=d([k("esri.views.3d.terrain.ExtentHelper.ExtentHelperGlobal")],IX);let LX=class extends Sh{_computeLayerViewsExtent(){const e=cy(),i=this.viewSpatialReference;this.layerViews.forEach(n=>{const a=n.layer;if(n.isResolved()&&(a.type!=="graphics"||!a.internal)){const o=aIe("fullExtentInLocalViewSpatialReference"in n&&n.fullExtentInLocalViewSpatialReference||n.layer.fullExtent,i);H3(e,o,e)}});const r=AW(e)?e:null,s=this._get("layerViewsExtent");return vw(r,s)?s:r}_computeTiledLayersExtent(){const e=this.tilingScheme;if(!e)return null;const i=this.viewSpatialReference,r=cy();this.layers.forEach(a=>{if(a.loaded&&e$(a)){const o=Z8(a,i,2);if(o==null)return;const{tileInfo:l,fullExtent:c}=o,h="tilemapCache"in a?a.tilemapCache?.effectiveMaxLOD:void 0;l!=null&&c!=null&&(_V(a)||e.compatibleWith(l,h)&&c.spatialReference.equals(e.spatialReference))&&H3(r,c,r)}}),H3(r,this.defaultTiledLayersExtent,r);const s=AW(r)?r:null,n=this._get("tiledLayersExtent");return vw(s,n)?n:s}};function aIe(t,e){return t==null||t.spatialReference.equals(e)?t:zP(t,t.spatialReference,e)}LX=d([k("esri.views.3d.terrain.ExtentHelper.ExtentHelperLocal")],LX);const zT=[0,1];let S2t=class{constructor(e,i){this.vec3=e,this.id=i}};function wV(t,e,i,r){return new S2t(Ge(t,e,i),r)}let Hye=class{constructor(){this._extent=Pi(),this.resolution=0,this.renderLocalOrigin=wV(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new T2t}get extent(){return this._extent}setExtent(e){jl(this._extent,e)}setupGeometryViews(e){if(this._setupGeometryView(),!e)return;const i=.001*e.range;if(this._extent[0]-i<=e.min){const r=this.canvasGeometries.extents[this.canvasGeometries.numViews++];JN(this._extent,e.range,0,r)}if(this._extent[2]+i>=e.max){const r=this.canvasGeometries.extents[this.canvasGeometries.numViews++];JN(this._extent,-e.range,0,r)}}_setupGeometryView(){this.canvasGeometries.numViews=1,Bv(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let e=0;e<this.canvasGeometries.numViews;e++){const i=this.canvasGeometries.extents[e];if(i[0]!==i[2]&&i[1]!==i[3])return!0}return!1}},T2t=class{constructor(){this.extents=[Pi(),Pi(),Pi()],this.numViews=0}},$2t=class{constructor(e,i,r){this._fbos=e,this._format=i,this._name=r}get valid(){return this._handle?.getTexture()!=null}dispose(){this._handle=Sr(this._handle)}get texture(){return this._handle?.getTexture()}ensureFramebuffer(e,i){this._handle&&this._handle.fbo?.width===e&&this._handle.fbo?.height===i||(this._handle?.release(),this._handle=this._fbos.acquire(e,i,this._name,this._format))}bind(e){e.bindFramebuffer(this._handle?.fbo)}generateMipMap(){this._handle?.getTexture()?.descriptor?.hasMipmap&&this._handle?.getTexture()?.generateMipmap()}},zS=class{constructor(e,i,r,s,n=1,a=6){this.output=r,this.content=s,this.redrawOnRequest=n,this.fbo=new $2t(e,a,i)}handleRenderRequest(e){return e===1||e===this.redrawOnRequest}get valid(){return this.fbo.valid}},C2t=class{constructor(e){this.targets=[new zS(e,"overlay color",0,0),new zS(e,"overlay IM color",0,1),new zS(e,"overlay highlight",9,2,1,3),new zS(e,"overlay water",3,3,0),new zS(e,"overlay occluded",0,4)],Jh()&&this.targets.push(new zS(e,"overlay olid",10,5,1,5))}getTexture(e){return this.targets[e]?.fbo.texture}dispose(e){if(e!==0)for(const i of this.targets)i.fbo.dispose();else this.targets[3].fbo.dispose()}computeValidity(){return this.targets.reduce((e,i,r)=>i.valid?e|=1<<r:e,0)}},Wre=class extends hr{constructor(){super(...arguments),this.color=Ge(1,1,1)}};function oIe(){const t=new Di;return t.include(Oa),t.fragment.uniforms.add(new zt("tex",e=>e.texture),new _r("uColor",e=>e.color)),t.fragment.main.add(E`vec4 texColor = texture(tex, uv);
fragColor = texColor * vec4(uColor, 1.0);`),t}const M2t=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:Wre,build:oIe},Symbol.toStringTag,{value:"Module"}));let Wye=class extends Ni{constructor(e,i){super(e,"ivec2",1,(r,s,n)=>r.setUniform2iv(e,i(s,n)))}},AM=class extends Ni{constructor(e,i){super(e,"usampler2D",1,(r,s,n)=>r.bindTexture(e,i(s,n)))}},Zre=class extends hr{};function lIe(){const t=new Di,{outputs:e,fragment:i}=t;return t.include(Oa),i.uniforms.add(new AM("highlightTexture",r=>r.highlightTexture)),i.constants.add("outlineWidth","int",Math.ceil(TD)),i.constants.add("cellSize","int",N_),e.add("fragGrid","uvec2"),i.main.add(E`ivec2 inputTextureSize = textureSize(highlightTexture, 0);
ivec2 cellBottomLeftCornerInput = ivec2(ivec2(floor(gl_FragCoord.xy) * vec2(cellSize)));
ivec2 coordMid =  cellBottomLeftCornerInput + ivec2(cellSize >> 1);
uvec2 centreTexel = texelFetch(highlightTexture, coordMid, 0).rg & uvec2(0x55u);
float marginSquare = float(outlineWidth*outlineWidth);
uvec2 outputValue = centreTexel & uvec2(0x55u);
for(int y = -outlineWidth; y <= cellSize + outlineWidth; y+=2) {
int dy = y < 0 ? -y : y > cellSize ? y-cellSize : 0;
int xMargin = dy > 0 ? int(ceil(sqrt(marginSquare - float(dy*dy)))) : outlineWidth;
for(int x = -xMargin; x <= cellSize + xMargin; x+=2) {
ivec2 coord = cellBottomLeftCornerInput + ivec2(x, y);
uvec2[4] texels = uvec2[4] (
texelFetch(highlightTexture,coord+ivec2(0,0),0).rg & uvec2(0x55u),
texelFetch(highlightTexture,coord+ivec2(1,0),0).rg & uvec2(0x55u),
texelFetch(highlightTexture,coord+ivec2(0,1),0).rg & uvec2(0x55u),
texelFetch(highlightTexture,coord+ivec2(1,1),0).rg & uvec2(0x55u)
);
if (texels[0] == texels[1] && texels[1] == texels[2] && texels[2] == texels[3] && texels[3] ==  centreTexel) {
continue;
}
for (int i=0; i<4; ++i){
outputValue |= ((texels[i] ^ centreTexel) << 1);
outputValue |= texels[i];
}
}
}
fragGrid = outputValue;`),t}const N_=32,TD=9,Yre=.4,E2t=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:Zre,blurSize:Yre,build:lIe,gridCellPixelSize:N_,outlineSize:TD},Symbol.toStringTag,{value:"Module"}));function Qre(t){const{vertex:e}=t;e.uniforms.add(new AM("coverageTexture",i=>i.coverageTexture),new Wye("highlightRenderCellCount",i=>Cr(Zye,i.horizontalCellCount,i.verticalCellCount)),new Wye("highlightTextureResolution",({highlightTexture:i})=>Cr(Zye,i.descriptor.width,i.descriptor.height)),new e1("highlightLevel",i=>i.highlightLevel)).constants.add("cellSize","int",N_),t.varyings.add("sUV","vec2"),t.varyings.add("vOutlinePossible","float"),e.code.add(E`const ivec2 cellVertices[4] = ivec2[4](ivec2(0,0), ivec2(1,0), ivec2(0,1), ivec2(1,1));`),e.main.add(E`int cellIndex = gl_InstanceID;
int cellX = cellIndex % highlightRenderCellCount[0];
int cellY = (cellIndex - cellX) / highlightRenderCellCount[0];
ivec2 cellPos = ivec2(cellX, cellY);
uvec2 covTexel = texelFetch(coverageTexture, cellPos, 0).rg;
int channelIndex = (highlightLevel >> 2) & 3;
uint channelValue = covTexel[channelIndex];
int highlightIndex = (highlightLevel & 3) << 1;
bool covered = ((channelValue >> highlightIndex) & 1u) == 1u;
if (!covered) {
gl_Position = vec4(0.0);
return;
}
vOutlinePossible = (((channelValue >> highlightIndex) & 2u) == 2u) ? 1.0 : 0.0;
ivec2 iPosInCell = cellVertices[gl_VertexID];
vec2 sPos = vec2(cellPos * cellSize + iPosInCell * (cellSize));
vec2 vPos = sPos / vec2(highlightTextureResolution);
sUV = vPos;
gl_Position = vec4(2.0 * vPos - vec2(1.0), 0.0, 1.0);`)}const Zye=pt();function cIe(){const t=new Di;t.include(Qre);const{fragment:e}=t;return e.uniforms.add(new zt("blurInput",i=>i.highlightBlurTexture),new pre("blurSize",i=>i.blurSize),new AM("highlightTexture",i=>i.highlightTexture),new zt("highlightOptionsTexture",i=>i.highlightOptionsTexture),new e1("highlightLevel",i=>i.highlightLevel),new ut("occludedIntensityFactor",i=>i.occludedFactor)),e.constants.add("inner","float",1-(TD-Yre)/TD),t.include(Hie),e.main.add(E`vec2 highlightTextureSize = vec2(textureSize(highlightTexture,0));
vec2 uv = sUV;
vec2 center = texture(blurInput, uv).rg;
vec2 blurredHighlightValue = (vOutlinePossible == 0.0)
? center
: center * 0.204164
+ texture(blurInput, uv + blurSize * 1.407333).rg * 0.304005
+ texture(blurInput, uv - blurSize * 1.407333).rg * 0.304005
+ texture(blurInput, uv + blurSize * 3.294215).rg * 0.093913
+ texture(blurInput, uv - blurSize * 3.294215).rg * 0.093913;
float highlightIntensity = blurredHighlightValue.r;
float occlusionWeight = blurredHighlightValue.g;
if (highlightIntensity <= 0.01) {
discard;
}
vec4 fillColor    = texelFetch(highlightOptionsTexture, ivec2(highlightLevel, 0), 0);
vec4 outlineColor = texelFetch(highlightOptionsTexture, ivec2(highlightLevel, 1), 0);
uvec2 centerTexel = texelFetch(highlightTexture, ivec2(uv * highlightTextureSize), 0).rg;
uint centerBits = readLevelBits(centerTexel, highlightLevel);
bool centerFilled = (centerBits & 1u) == 1u;
bool centerOccluded = (centerBits & 3u) == 3u;
bool occluded = centerOccluded || (0.5 * highlightIntensity < occlusionWeight);
float occlusionFactor = occluded ? occludedIntensityFactor : 1.0;
float outlineFactor = centerFilled ? 1.0 : smoothstep(0.0, inner, highlightIntensity);
float fillFactor = centerFilled ? 1.0 : 0.0;
vec4 baseColor = mix(outlineColor, fillColor, fillFactor);
float intensity = baseColor.a * occlusionFactor * outlineFactor;
fragColor = vec4(baseColor.rgb, intensity);`),t}const A2t=Object.freeze(Object.defineProperty({__proto__:null,build:cIe},Symbol.toStringTag,{value:"Module"}));let Yye=class extends Vi{constructor(e,i){super(e,i,new Ii(A2t,()=>te(()=>Promise.resolve().then(()=>kkt),void 0)),ed(u8))}initializePipeline(){return li({blending:em,colorWrite:$i})}},Xre=class extends hr{constructor(){super(...arguments),this.blurSize=pt()}};function uIe(){const t=new Di;return t.include(Qre),t.outputs.add("fragHighlight","vec2",0),t.fragment.uniforms.add(new pre("blurSize",e=>e.blurSize),new Dv("blurInput",e=>e.blurInput)).main.add(E`vec2 highlightTextureSize = vec2(textureSize(blurInput,0));
vec2 center = texture(blurInput, sUV).rg;
if (vOutlinePossible == 0.0) {
fragHighlight = center;
} else {
vec2 sum = center * 0.204164;
sum += texture(blurInput, sUV + blurSize * 1.407333).rg * 0.304005;
sum += texture(blurInput, sUV - blurSize * 1.407333).rg * 0.304005;
sum += texture(blurInput, sUV + blurSize * 3.294215).rg * 0.093913;
sum += texture(blurInput, sUV - blurSize * 3.294215).rg * 0.093913;
fragHighlight = sum;
}`),t}const O2t=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:Xre,build:uIe},Symbol.toStringTag,{value:"Module"}));let Qye=class extends Vi{constructor(e,i){super(e,i,new Ii(O2t,()=>te(()=>Promise.resolve().then(()=>zkt),void 0)),ed(u8))}initializePipeline(){return li({colorWrite:$i})}},vG=class extends Vi{constructor(e,i){super(e,i,new Ii(E2t,()=>te(()=>Promise.resolve().then(()=>Fkt),void 0)),Qs)}initializePipeline(){return li({colorWrite:$i})}},P2t=class extends hr{constructor(){super(...arguments),this.occludedFactor=Dst,this.verticalCellCount=0,this.horizontalCellCount=0,this.highlightLevel=0,this.pixelRatio=1}};function hIe(){const t=new Di;t.include(Qre),t.include(Hie);const{fragment:e}=t;return t.outputs.add("fragSingleHighlight","vec2",0),e.uniforms.add(new AM("highlightTexture",i=>i.highlightTexture),new e1("highlightLevel",i=>i.highlightLevel)),e.main.add(E`ivec2 iuv = ivec2(gl_FragCoord.xy);
uvec2 inputTexel = texelFetch(highlightTexture, iuv, 0).rg;
uint bits = readLevelBits(inputTexel, highlightLevel);
bool hasHighlight = (bits & 1u) == 1u;
bool hasOccluded  = (bits & 2u) == 2u;
fragSingleHighlight = vec2(hasHighlight ? 1.0 : 0.0, hasOccluded ? 1.0 : 0.0);`),t}const R2t=Object.freeze(Object.defineProperty({__proto__:null,build:hIe},Symbol.toStringTag,{value:"Module"}));let Xye=class extends Vi{constructor(e,i){super(e,i,new Ii(R2t,()=>te(()=>Promise.resolve().then(()=>Nkt),void 0)),ed(u8))}initializePipeline(){return li({colorWrite:$i})}},WO=class extends Nl{constructor(){super(...arguments),this.produces=ht.HIGHLIGHTS,this.consumes={required:[ht.HIGHLIGHTS,"highlights"]},this._downsampleDrawParameters=new Zre,this._passParameters=new P2t,this._highlightBlurDrawParameters=new Xre,this._grid=new D2t}initialize(){this.addHandles([K(()=>this._updateOptionsTexture(),()=>{},Wt)])}destroy(){this._grid.coverage=Sr(this._grid.coverage),this._grid.vao=Rt(this._grid.vao),this._passParameters.highlightOptionsTexture=Sr(this._passParameters.highlightOptionsTexture)}_updateOptionsTexture(){if(this._passParameters.highlightOptionsTexture==null){const e=new Zi(16,2);e.internalFormat=6408,e.samplingMode=9728,this._passParameters.highlightOptionsTexture=new Fi(this.renderingContext,e,null)}this._passParameters.highlightOptionsTexture.setData(I2t(this.view.state.highlights)),this.requestRender(1)}precompile(){this.techniques.precompile(vG),this.techniques.precompile(Xye),this.techniques.precompile(Qye),this.techniques.precompile(Yye)}render(e){const i=e.find(({name:a})=>a===ht.HIGHLIGHTS),{techniques:r,bindParameters:s}=this;if(!s.decorations)return i;if(!r.get(vG).compiled)return this.requestRender(1),i;const n=e.find(({name:a})=>a==="highlights").getTexture();return this._renderHighlightPostprocess(n,i),i}_prepareAndDownSample(e){this._gridUpdateResources(e);const i=this.techniques.get(vG),r=this._gridComputeCoverage(i,e),{horizontalCellCount:s,verticalCellCount:n}=r,a=this._passParameters;return a.horizontalCellCount=s,a.verticalCellCount=n,a.coverageTexture=r.coverage?.getTexture(),r}_renderGrid(e){const i=e.verticalCellCount*e.horizontalCellCount;this.renderingContext.bindVAO(e.vao),this.renderingContext.drawElementsInstanced(lr.TRIANGLES,6,ar.UNSIGNED_BYTE,0,i)}_renderHighlightPostprocess(e,i){const{fboCache:r,techniques:s,bindParameters:n,_passParameters:a,renderingContext:o}=this,l=s.get(Xye),c=s.get(Qye),h=s.get(Yye);if(!h.compiled||!c.compiled||!l.compiled)return void this.requestRender(1);a.highlightTexture=e;const f=this._prepareAndDownSample(e),{width:y,height:_}=e.descriptor;a.highlightTexture=e;const{camera:w}=n,{fullWidth:x,fullHeight:S,pixelRatio:$,fullViewport:A}=w,M=Math.ceil(x/$),P=Math.ceil(S/$),{_highlightBlurDrawParameters:O}=this,D=this.view.stage.renderView.renderer,{highlights:L}=n;for(let F=0;F<L.length;++F){const{name:U}=L[F];if(!D.hasHighlight(U))continue;a.highlightLevel=F,o.setClearColor(0,0,0,0);const N=r.acquire(y,_,"single highlight",2);o.bindFramebuffer(N.fbo),o.setViewport(0,0,y,_),o.clear(16384),o.bindTechnique(l,n,a),this._renderGrid(f),O.blurInput=N.getTexture(),Cr(O.blurSize,1/M,0);const j=r.acquire(M,P,"single highlight blur",2);o.unbindTexture(j.fbo?.colorTexture),o.bindFramebuffer(j.fbo),o.setViewport(0,0,M,P),o.clear(16384),o.bindTechnique(c,n,a,O),this._renderGrid(f),N.release(),Cr(O.blurSize,0,1/P),a.highlightBlurTexture=j.getTexture(),o.bindFramebuffer(i.fbo),o.setViewport4fv(A),o.bindTechnique(h,n,a,O),this._renderGrid(f),j.release()}a.coverageTexture=a.highlightTexture=null}_gridUpdateResources(e){const i=this._grid,{width:r,height:s}=e.descriptor;if(i.horizontalCellCount=Math.ceil(r/N_),i.verticalCellCount=Math.ceil(s/N_),i.vao)return;const n=this.renderingContext,a=Uu.createIndex(n,35044,z2t);i.vao=new Op(n,new Hs(n,u8),a)}_gridComputeCoverage(e,i){const r=this.renderingContext,s=this._grid,n=i.descriptor,a=Math.ceil(n.width/N_),o=Math.ceil(n.height/N_);this._downsampleDrawParameters.input=i;const{highlights:l}=this.bindParameters;s.coverage?.release();const c=this.fboCache.acquire(a,o,"highlight coverage",l.length>Jre?3:1);return s.coverage=c,r.bindFramebuffer(c.fbo),r.bindTechnique(e,this.bindParameters,this._passParameters,this._downsampleDrawParameters),r.setViewport(0,0,a,o),r.screen.draw(),s}get test(){}};d([m()],WO.prototype,"produces",void 0),d([m()],WO.prototype,"consumes",void 0),WO=d([k("esri.views.3d.webgl-engine.effects.highlight.Highlight")],WO);let D2t=class{constructor(){this.coverage=null,this.vao=null,this.verticalCellCount=0,this.horizontalCellCount=0,this.viewportWidth=0,this.viewportHeight=0}};function I2t(t){const e=new Uint8Array(128);let i=0;for(const r of t){const s=4*i,n=4*i+64;++i;const{color:a}=r,o=r.haloColor??a;e[s+0]=a.r,e[s+1]=a.g,e[s+2]=a.b,e[s+3]=r.fillOpacity*a.a*255,e[n+0]=o.r,e[n+1]=o.g,e[n+2]=o.b,e[n+3]=r.haloOpacity*o.a*255}return e}let L2t=0;function k2t(t){let e=0;for(const r of t){const{name:s}=r;e+=s.length;const{color:n,fillOpacity:a,haloColor:o,haloOpacity:l}=r;e+=n.r+n.g+n.b+n.a+a,e+=o?o.r+o.g+o.b+o.a+l:0}const i=t.at(0);if(i){const{shadowOpacity:r,shadowDifference:s,shadowColor:n}=i;e+=r+s+n.r+n.g+n.b+n.a}return L2t+++(e>=0?0:1)}const z2t=new Uint8Array([0,1,2,2,1,3]);function dIe(t,e,i,r,s,n=0){const{highlights:a}=r,o=a.length>1?e.acquire(i.width,i.height,"highlight mix",a.length>Jre?3:1):null,{gl:l}=t;if(o){const h=t.getBoundFramebufferObject();t.bindFramebuffer(o.fbo),l.clearBufferuiv(l.COLOR,0,[0,0,0,0]),t.bindFramebuffer(h)}const c=o?.getTexture();r.highlightMixTexture=c,Cr(r.highlightMixOrigin,n,0),a.forEach((h,f)=>{if(f>0){const y=Fi.TEXTURE_UNIT_FOR_UPDATES;t.bindTexture(c,y),t.setActiveTexture(y),l.copyTexSubImage2D(3553,0,0,0,n,0,i.width,i.height),t.bindTexture(null,y)}t.clear(256),r.highlightLevel=f,s()}),r.highlightLevel=null,r.highlightMixTexture=null,o?.release()}const Jre=4;let F2t=class{constructor(e,i,r,s){this.material=e,this.output=i,this.techniques=r,this.textures=s}},pIe=class{constructor(e,i,r,s){this._textures=e,this._techniques=i,this.materialChanged=r,this.requestRender=s,this._id2glMaterialRef=new tm}dispose(){this._textures.destroy()}acquire(e,i,r){if(this._ownMaterial(e),!e.produces.get(i)?.(r))return null;let n=this._id2glMaterialRef.get(r,e.id);if(n==null){const a=e.createGLMaterial(new F2t(e,r,this._techniques,this._textures));n=new N2t(a),this._id2glMaterialRef.set(r,e.id,n)}return n.ref(),n.glMaterial}release(e,i){const r=this._id2glMaterialRef.get(i,e.id);r!=null&&(r.unref(),r.referenced||(Rt(r.glMaterial),this._id2glMaterialRef.delete(i,e.id)))}_ownMaterial(e){e.repository&&e.repository!==this&&fe.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),e.repository=this}},N2t=class{constructor(e){this.glMaterial=e,this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt,dt(this._refCnt>=0)}get referenced(){return this._refCnt>0}};const Jye=8;function V2t(t,e){const{vertex:i,attributes:r}=t;i.uniforms.add(new ut("intrinsicWidth",a=>a.width));const{hasScreenSizePerspective:s,spherical:n}=e;s?(t.include(x8,e),UPe(i),xy(i,e),i.uniforms.add(new Fie("inverseViewMatrix",(a,o)=>nl(Kye,Qh(Kye,o.camera.viewMatrix,a.origin)))),i.code.add(E`
      float applyLineSizeScreenSizePerspective(float size, vec3 pos) {
        vec3 worldPos = (inverseViewMatrix * vec4(pos, 1)).xyz;
        vec3 groundUp = ${n?E`normalize(worldPos + localOrigin)`:E`vec3(0.0, 0.0, 1.0)`};
        float absCosAngle = abs(dot(groundUp, normalize(worldPos - cameraPosition)));

        return screenSizePerspectiveScaleFloat(size, absCosAngle, length(pos), screenSizePerspective);
      }
    `)):i.code.add(E`float applyLineSizeScreenSizePerspective(float size, vec3 pos) {
return size;
}`),e.hasVVSize?(r.add("sizeFeatureAttribute","float"),i.uniforms.add(new _r("vvSizeMinSize",a=>a.vvSize.minSize),new _r("vvSizeMaxSize",a=>a.vvSize.maxSize),new _r("vvSizeOffset",a=>a.vvSize.offset),new _r("vvSizeFactor",a=>a.vvSize.factor),new _r("vvSizeFallback",a=>a.vvSize.fallback)),i.code.add(E`
    float getSize(${_e(s,"vec3 pos")}) {
      float size = isnan(sizeFeatureAttribute)
        ? vvSizeFallback.x
        : intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;

      return ${_e(s,"applyLineSizeScreenSizePerspective(size, pos)","size")};
    }
    `)):(r.add("size","float"),i.code.add(E`
    float getSize(${_e(s,"vec3 pos")}) {
      float fullSize = intrinsicWidth * size;
      return ${_e(s,"applyLineSizeScreenSizePerspective(fullSize, pos)","fullSize")};
    }
    `)),e.hasVVOpacity?(r.add("opacityFeatureAttribute","float"),i.constants.add("vvOpacityNumber","int",8),i.uniforms.add(new Rc("vvOpacityValues",a=>a.vvOpacity.values,Jye),new Rc("vvOpacityOpacities",a=>a.vvOpacity.opacityValues,Jye),new ut("vvOpacityFallback",a=>a.vvOpacity.fallback,{supportsNaN:!0})),i.code.add(E`
    float interpolateOpacity(float value) {
      if (value <= vvOpacityValues[0]) {
        return vvOpacityOpacities[0];
      }

      for (int i = 1; i < vvOpacityNumber; ++i) {
        if (vvOpacityValues[i] >= value) {
          float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
          return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
        }
      }

      return vvOpacityOpacities[vvOpacityNumber - 1];
    }

    vec4 applyOpacity(vec4 color) {
      if (isnan(opacityFeatureAttribute)) {
        // If there is a color vv then it will already have taken care of applying the fallback
        return ${_e(e.hasVVColor,"color","vec4(color.rgb, vvOpacityFallback)")};
      }

      return vec4(color.rgb, interpolateOpacity(opacityFeatureAttribute));
    }
    `)):i.code.add(E`vec4 applyOpacity(vec4 color) {
return color;
}`),e.hasVVColor?(t.include(Rw,e),r.add("colorFeatureAttribute","float"),i.code.add(E`vec4 getColor() {
vec4 color = interpolateVVColor(colorFeatureAttribute);
if (isnan(color.r)) {
return vec4(0);
}
return applyOpacity(color);
}`)):(r.add("color","vec4"),i.code.add(E`vec4 getColor() {
return applyOpacity(color);
}`))}const Kye=it();function U2t(t){t.vertex.code.add("#define noPerspectiveWrite(x, w) (x * w)")}function kX(t){t.fragment.code.add("#define noPerspectiveRead(x) (x * gl_FragCoord.w)")}let fIe=class{constructor(e,i,r){this._createTexture=e,this._parametersKey=i,this._repository=new Map,this._orphanCache=r.newCache(`procedural-texture-repository:${ql()}`,s=>s.dispose())}destroy(){for(const{texture:e}of this._repository.values())e.dispose();this._repository.clear(),this._orphanCache.destroy()}swap(e,i=null){const r=this._acquire(e);return this.release(i),r}release(e){if(e==null)return;const i=this._parametersKey(e),r=this._repository.get(i);if(r&&(r.refCount--,r.refCount===0)){this._repository.delete(i);const{texture:s}=r;this._orphanCache.put(i,s)}}_acquire(e){if(e==null)return null;const i=this._parametersKey(e),r=this._repository.get(i);if(r)return r.refCount++,r.texture;const s=this._orphanCache.pop(i)??this._createTexture(e),n=new B2t(s);return this._repository.set(i,n),s}},B2t=class{constructor(e){this.texture=e,this.refCount=1}};function j2t(t,e){return new fIe(i=>{const{data:r,textureSize:s}=q2t(i),n=new Zi(s,1);return n.dataType=bs.FLOAT,n.pixelFormat=6403,n.internalFormat=tt.R16F,n.wrapMode=10497,new Fi(t,n,r)},i=>`${i.pattern.join(",")}-r${i.pixelRatio}`,e)}function q2t(t){const e=mIe(t),i=1/t.pixelRatio,r=gIe(t),s=[];let n=1;for(const o of e){for(let l=0;l<o;l++){const c=n*(Math.min(l,o-1-l)+.5)*i;s.push(c)}n=-n}const a=Math.round(e[0]/2);return{data:new Float32Array([...s.slice(a),...s.slice(0,a)]),textureSize:r}}function mIe(t){return t.pattern.map(e=>Math.round(e*t.pixelRatio))}function gIe(t){if(t==null)return 1;const e=mIe(t);return Math.floor(e.reduce((i,r)=>i+r))}function G2t(t){return t==null?tn:t.length===4?t:yr(H2t,t[0],t[1],t[2],1)}const H2t=ri();function W2t(t,e){if(!e.stippleEnabled)return void t.fragment.code.add(E`float getStippleAlpha(float lineWidth) { return 1.0; }
void discardByStippleAlpha(float stippleAlpha, float threshold) {}
vec4 blendStipple(vec4 color, float stippleAlpha) { return color; }`);const i=!(e.draped&&e.stipplePreferContinuous),{vertex:r,fragment:s}=t;e.draped||(xy(r,e),r.uniforms.add(new ws("worldToScreenPerDistanceRatio",({camera:n})=>1/n.perScreenPixelRatio)).code.add(E`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),t.varyings.add("vStippleDistance","float"),t.varyings.add("vStippleDistanceLimits","vec2"),t.varyings.add("vStipplePatternStretch","float"),r.code.add(E`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${E.float(Z2t)};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),S4(r),r.code.add(E`
    vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {

      // First check if the segment is long enough to support fully screen space patterns.
      // Force sparse mode for segments that are very large in screen space even if it is not allowed,
      // to avoid imprecision from calculating with large floats.
      if (segmentLengthPseudoScreen >= ${i?"patternLength":"1e4"}) {
        // Round the screen length to get an integer number of pattern repetitions (minimum 1).
        float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
        float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
        float segmentLengthScreenRounded = flooredRepetitions * patternLength;

        float stretch = repetitions / flooredRepetitions;

        // We need to impose a lower bound on the stretch factor to prevent the dots from merging together when there is only 1 repetition.
        // 0.75 is the lowest possible stretch value for flooredRepetitions > 1, so it makes sense as lower bound.
        vStipplePatternStretch = max(0.75, stretch);

        return vec2(0.0, segmentLengthScreenRounded);
      }
      return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
    }
  `),s.uniforms.add(new zt("stipplePatternTexture",n=>n.stippleTexture),new ut("stipplePatternPixelSizeInv",n=>1/yIe(n))),e.stippleOffColorEnabled&&s.uniforms.add(new Xn("stippleOffColor",n=>G2t(n.stippleOffColor))),t.include(kX),s.code.add(E`float getStippleSDF(out bool isClamped) {
float stippleDistanceClamped = noPerspectiveRead(clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y));
float lineSizeInv = noPerspectiveRead(vLineSizeInv);
vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;
float u = stippleDistanceClamped * stipplePatternPixelSizeInv * lineSizeInv;
u = fract(u);
float sdf = texture(stipplePatternTexture, vec2(u, 0.5)).r;
return (sdf - 0.5) * vStipplePatternStretch + 0.5;
}
float getStippleSDF() {
bool ignored;
return getStippleSDF(ignored);
}
float getStippleAlpha(float lineWidth) {
bool isClamped;
float stippleSDF = getStippleSDF(isClamped);
float antiAliasedResult = clamp(stippleSDF * lineWidth + 0.5, 0.0, 1.0);
return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
}`),s.code.add(E`
    void discardByStippleAlpha(float stippleAlpha, float threshold) {
     ${_e(!e.stippleOffColorEnabled,"if (stippleAlpha < threshold) { discard; }")}
    }

    vec4 blendStipple(vec4 color, float stippleAlpha) {
      return ${e.stippleOffColorEnabled?"mix(color, stippleOffColor, stippleAlpha)":"vec4(color.rgb, color.a * stippleAlpha)"};
    }
  `)}function yIe(t){const e=t.stipplePattern;return e?gIe(t.stipplePattern)/e.pixelRatio:1}const Z2t=.4,Kre=128,uw=.5,FXt=jR(uw/2,uw/2,1-uw/2,1-uw/2);function NXt(t){return t==="cross"||t==="x"}function VXt(t,e=Kre,i=e*uw,r=0){const{data:s,parameters:n}=Y2t(t,e,i,r);return new Vre(s,n)}function Y2t(t,e=Kre,i=e*uw,r=0){return{data:_Ie(t,e,i,r),parameters:{mipmap:!1,wrap:{s:33071,t:33071},width:e,height:e,noUnpackFlip:!0,dataType:bs.FLOAT,pixelFormat:6403,internalFormat:tt.R16F,reloadable:!0}}}function _Ie(t,e=Kre,i=e*uw,r=0){switch(t){case"circle":default:return Q2t(e,i);case"square":return X2t(e,i);case"cross":return K2t(e,i,r);case"x":return eSt(e,i,r);case"kite":return J2t(e,i);case"triangle":return tSt(e,i);case"arrow":return iSt(e,i)}}function Q2t(t,e){const i=t/2-.5;return D4(t,wIe(i,i,e/2))}function X2t(t,e){return vIe(t,e,!1)}function J2t(t,e){return vIe(t,e,!0)}function K2t(t,e,i=0){return bIe(t,e,!1,i)}function eSt(t,e,i=0){return bIe(t,e,!0,i)}function tSt(t,e){return D4(t,xIe(t/2,e,e/2))}function iSt(t,e){const i=e,r=e/2,s=t/2,n=.8*i,a=wIe(s,(t-e)/2-n,Math.sqrt(n*n+r*r)),o=xIe(s,i,r);return D4(t,(l,c)=>Math.max(o(l,c),-a(l,c)))}function vIe(t,e,i){return i&&(e/=Math.SQRT2),D4(t,(r,s)=>{let n=r-.5*t+.25,a=.5*t-s-.75;if(i){const o=(n+a)/Math.SQRT2;a=(a-n)/Math.SQRT2,n=o}return Math.max(Math.abs(n),Math.abs(a))-.5*e})}function bIe(t,e,i,r=0){e-=r,i&&(e*=Math.SQRT2);const s=.5*e;return D4(t,(n,a)=>{let o,l=n-.5*t,c=.5*t-a-1;if(i){const h=(l+c)/Math.SQRT2;c=(c-l)/Math.SQRT2,l=h}return l=Math.abs(l),c=Math.abs(c),o=l>c?l>s?Math.sqrt((l-s)*(l-s)+c*c):c:c>s?Math.sqrt(l*l+(c-s)*(c-s)):l,o-=r/2,o})}function wIe(t,e,i){return(r,s)=>{const n=r-t,a=s-e;return Math.sqrt(n*n+a*a)-i}}function xIe(t,e,i){const r=Math.sqrt(e*e+i*i);return(s,n)=>{const a=Math.abs(s-t)-i,o=n-t+e/2+.75,l=(e*a+i*o)/r,c=-o;return Math.max(l,c)}}function D4(t,e){const i=new Float32Array(t*t);for(let r=0;r<t;r++)for(let s=0;s<t;s++)i[s+t*r]=e(s,r)/t;return i}const xV=64,SIe=xV/2,TIe=SIe/5,rSt=xV/TIe,UXt=.25;function sSt(t,e){const i=_Ie(t,xV,SIe,TIe),r=new Zi(xV);return r.internalFormat=tt.R16F,r.dataType=bs.FLOAT,r.pixelFormat=6403,r.wrapMode=33071,new Fi(e,r,i)}function nSt(t,e){const i=t.vertex,r=e.hasScreenSizePerspective;S4(i),i.uniforms.get("markerScale")==null&&i.constants.add("markerScale","float",1),i.constants.add("markerSizePerLineWidth","float",rSt).code.add(E`
  float getLineWidth(${_e(r,"vec3 pos")}) {
     return max(getSize(${_e(r,"pos")}), 1.0) * pixelRatio;
  }

  float getScreenMarkerSize(float lineWidth) {
    return markerScale * markerSizePerLineWidth * lineWidth;
  }
  `),e.space===2&&(i.constants.add("maxSegmentLengthFraction","float",.45),i.uniforms.add(new ws("perRenderPixelRatio",s=>s.camera.perRenderPixelRatio)),i.code.add(E`
  bool areWorldMarkersHidden(vec3 pos, vec3 other) {
    vec3 midPoint = mix(pos, other, 0.5);
    float distanceToCamera = length(midPoint);
    float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
    float worldMarkerSize = getScreenMarkerSize(getLineWidth(${_e(r,"pos")})) * screenToWorldRatio;
    float segmentLen = length(pos - other);
    return worldMarkerSize > maxSegmentLengthFraction * segmentLen;
  }

  float getWorldMarkerSize(vec3 pos) {
    float distanceToCamera = length(pos);
    float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
    return getScreenMarkerSize(getLineWidth(${_e(r,"pos")})) * screenToWorldRatio;
  }
  `))}function aSt(t,e){if(!e.hasAnimation)return;const{attributes:i,varyings:r,vertex:s,fragment:n}=t;i.add("timeStamps","vec4"),r.add("vTimeStamp","float"),r.add("vFirstTime","float"),r.add("vLastTime","float"),r.add("vTransitionType","float"),s.main.add(E`vTimeStamp = timeStamps.x;
vFirstTime = timeStamps.y;
vLastTime = timeStamps.z;
vTransitionType = timeStamps.w;`);const{animation:a}=e;a===3&&n.constants.add("decayRate","float",2.3),n.code.add(E`
    float getTrailOpacity(float x) {
      ${oSt(a)}
    }`),n.uniforms.add(new ut("timeElapsed",o=>o.timeElapsed),new ut("trailLength",o=>o.trailLength),new ut("speed",o=>o.animationSpeed),new Xn("timingOptions",o=>yr(lSt,o.startTime,o.endTime,o.fadeInTime,o.fadeOutTime))),n.code.add(E`float fadeIn(float x) {
return smoothstep(0.0, timingOptions[2], x);
}
float fadeOut(float x) {
return isinf(timingOptions[3]) ? 1.0 : smoothstep(timingOptions[3], 0.0, x);
}`),n.code.add(E`vec4 animate(vec4 color) {
float startTime = timingOptions[0];
float endTime = timingOptions[1];
float totalTime = vLastTime - vFirstTime;
float actualEndTime = int(vTransitionType) == 2 ? min(endTime, startTime + vLastTime / speed) : endTime;
vec4 animatedColor = color;
if (speed == 0.0) {
animatedColor.a *= getTrailOpacity((totalTime - (vTimeStamp - vFirstTime)) / trailLength);
animatedColor.a *= isinf(actualEndTime) ? 1.0 : fadeOut(timeElapsed - actualEndTime);
animatedColor.a *= fadeIn(timeElapsed - startTime);
return animatedColor;
}
float relativeStartTime = mod(startTime, totalTime);
float vHeadRelativeToFirst = mod((timeElapsed - relativeStartTime) * speed - vFirstTime, totalTime);
float vRelativeToHead = vHeadRelativeToFirst + vFirstTime - vTimeStamp;
bool inPreviousCycle = vRelativeToHead < 0.0;
vRelativeToHead += inPreviousCycle ? totalTime : 0.0;
float vAbsoluteTime = timeElapsed - vRelativeToHead / speed;
if (vAbsoluteTime > actualEndTime) {
vRelativeToHead = (timeElapsed - relativeStartTime) * speed - vTimeStamp;
vAbsoluteTime = timeElapsed - vRelativeToHead / speed;
}
animatedColor *= step(startTime, vAbsoluteTime);
animatedColor *= step(vAbsoluteTime, actualEndTime);
animatedColor.a *= isinf(actualEndTime) ? 1.0 : fadeOut(timeElapsed - actualEndTime);
animatedColor.a *= inPreviousCycle ? fadeOut(vHeadRelativeToFirst / speed) : 1.0;
animatedColor.a *= getTrailOpacity(vRelativeToHead / trailLength);
animatedColor.a *= int(vTransitionType) == 0 ? fadeIn(vAbsoluteTime - startTime) : 1.0;
animatedColor.a *= fadeIn(vTimeStamp - vFirstTime);
return animatedColor;
}`)}function oSt(t){switch(t){case 2:return"return x >= 0.0 && x <= 1.0 ? 1.0 : 0.0;";case 3:return`float cutOff = exp(-decayRate);
        return (exp(-decayRate * x) - cutOff) / (1.0 - cutOff);`;default:return"return 1.0;"}}const lSt=ri(),$D=1;function $Ie(t){const e=new Di,{attributes:i,varyings:r,vertex:s,fragment:n}=e,{applyMarkerOffset:a,draped:o,output:l,capType:c,stippleEnabled:h,falloffEnabled:f,roundJoins:y,wireframe:_,innerColorEnabled:w,hasAnimation:x,hasScreenSizePerspective:S}=t;n.include(M4),e.include(V2t,t),e.include(W2t,t),e.include(Gie,t),e.include(T4,t),e.include(aSt,t);const $=a&&!o;$&&(s.uniforms.add(new ut("markerScale",L=>L.markerScale)),e.include(nSt,{space:2,hasScreenSizePerspective:S})),jg(s,t),s.uniforms.add(new Io("inverseProjectionMatrix",L=>L.camera.inverseProjectionMatrix),new Sy("nearFar",L=>L.camera.nearFar),new ut("miterLimit",L=>L.join!=="miter"?0:L.miterLimit),new ao("viewport",L=>L.camera.fullViewport)),s.constants.add("LARGE_HALF_FLOAT","float",65500),i.add("position","vec3"),i.add("previousDelta","vec4"),i.add("nextDelta","vec4"),i.add("lineParameters","vec2"),i.add("u0","float"),r.add("vColor","vec4"),r.add("vpos","vec3",{invariant:!0}),r.add("vLineDistance","float"),r.add("vLineWidth","float");const A=h;A&&r.add("vLineSizeInv","float");const M=c===2,P=h&&M,O=f||P;O&&r.add("vLineDistanceNorm","float"),M&&(r.add("vSegmentSDF","float"),r.add("vReverseSegmentSDF","float")),s.code.add(E`vec2 perpendicular(vec2 v) {
return vec2(v.y, -v.x);
}
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),s.code.add(E`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),s.code.add(E`void clip(
inout vec4 pos,
inout vec4 prev,
inout vec4 next,
bool isStartVertex
) {
float vnp = nearFar[0] * 0.99;
if (pos.z > -nearFar[0]) {
if (!isStartVertex) {
if (prev.z < -nearFar[0]) {
pos = mix(prev, pos, interp(vnp, prev, pos));
next = pos;
} else {
pos = vec4(0.0, 0.0, 0.0, 1.0);
}
} else {
if (next.z < -nearFar[0]) {
pos = mix(pos, next, interp(vnp, pos, next));
prev = pos;
} else {
pos = vec4(0.0, 0.0, 0.0, 1.0);
}
}
} else {
if (prev.z > -nearFar[0]) {
prev = mix(pos, prev, interp(vnp, pos, prev));
}
if (next.z > -nearFar[0]) {
next = mix(next, pos, interp(vnp, next, pos));
}
}
}`),S4(s),s.constants.add("aaWidth","float",h?0:1).main.add(E`bool isStartVertex = abs(abs(lineParameters.y) - 3.0) == 1.0;
vec3 prevPosition = position + previousDelta.xyz * previousDelta.w;
vec3 nextPosition = position + nextDelta.xyz * nextDelta.w;
float coverage = 1.0;
if (lineParameters.y == 0.0) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
}
else {
vec4 pos  = view * vec4(position, 1.0);
vec4 prev = view * vec4(prevPosition, 1.0);
vec4 next = view * vec4(nextPosition, 1.0);
bool isJoin = abs(lineParameters.y) < 3.0;`),$&&s.main.add(E`vec4 other = isStartVertex ? next : prev;
bool markersHidden = areWorldMarkersHidden(pos.xyz, other.xyz);
if (!isJoin && !markersHidden) {
pos.xyz += normalize(other.xyz - pos.xyz) * getWorldMarkerSize(pos.xyz) * 0.5;
}`),e.include(U2t),s.main.add(E`
      clip(pos, prev, next, isStartVertex);

      vec3 clippedPos = pos.xyz;
      vec3 clippedCenter = mix(pos.xyz, isStartVertex ? next.xyz : prev.xyz, 0.5);

      forwardViewPosDepth(pos.xyz);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);

      vec2 left = (pos.xy - prev.xy);
      vec2 right = (next.xy - pos.xy);

      float leftLen = length(left);
      float rightLen = length(right);

      float lineSize = getSize(${_e(S,"clippedPos")});
      ${_e(h&&S,"float patternLineSize = getSize(clippedCenter);")}
      ${_e(h&&!S,"float patternLineSize = lineSize;")}

      if (lineSize < 1.0) {
        coverage = lineSize; // convert sub-pixel coverage to alpha
        lineSize = 1.0;
      }
      lineSize += aaWidth;

      float lineWidth = lineSize * pixelRatio;
      vLineWidth = noPerspectiveWrite(lineWidth, pos.w);
      ${A?E`vLineSizeInv = noPerspectiveWrite(1.0 / lineSize, pos.w);`:""}
  `),(h||M)&&s.main.add(E`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${M?E`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `),s.main.add(E`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * lineParameters.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = perpendicular(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
float subdivisionFactor = lineParameters.x;
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),y?s.main.add(E`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = perpendicular(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = perpendicular(endDir);

        float factor = ${h?E`min(1.0, subdivisionFactor * ${E.float(($D+2)/($D+1))})`:E`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(lineParameters.y) * factor * rotationAngle);
      `):s.main.add(E`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = perpendicular(joinDisplacementDir);`);const D=c!==0;return s.main.add(E`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = perpendicular(joinDisplacementDir);

      ${D?E`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `),s.main.add(E`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(lineParameters.y) * displacementLen + capDisplacementDir * displacementLen;
    float lineDistNorm = noPerspectiveWrite(sign(lineParameters.y), pos.w);

    vLineDistance = lineWidth * lineDistNorm;
    ${O?E`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `),M&&s.main.add(E`vec2 segmentDir = normalize(segment);
vSegmentSDF = noPerspectiveWrite((isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir)), pos.w);
vReverseSegmentSDF = noPerspectiveWrite((isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir)), pos.w);`),h&&(o?s.uniforms.add(new ws("worldToScreenRatio",L=>1/L.screenToPCSRatio)):s.main.add(E`vec3 segmentCenter = mix((nextPosition + position) * 0.5, (position + prevPosition) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),s.main.add(E`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(nextPosition - position, position - prevPosition, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),o?s.main.add(E`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = u0 * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):s.main.add(E`float startPseudoScreen = mix(u0, u0 - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),s.uniforms.add(new ut("stipplePatternPixelSize",L=>yIe(L))),s.main.add(E`float patternLength = patternLineSize * stipplePatternPixelSize;
vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);
vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);
if (segmentLengthScreenDouble >= 0.001) {
vec2 stippleDisplacement = pos.xy - segmentOrigin;
float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);
vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
}
vStippleDistanceLimits = noPerspectiveWrite(vStippleDistanceLimits, pos.w);
vStippleDistance = noPerspectiveWrite(vStippleDistance, pos.w);
vStippleDistanceLimits = isJoin ?
vStippleDistanceLimits :
isStartVertex ?
vec2(-1e34, vStippleDistanceLimits.y) :
vec2(vStippleDistanceLimits.x, 1e34);`)),s.main.add(E`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a = noPerspectiveWrite(vColor.a * coverage, pos.w);

      ${_&&!o?"pos.z -= 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
      forwardObjectAndLayerIdColor();
    }`),e.fragment.include(I_,t),e.include(F8,t),n.include(MM),n.main.add(E`discardBySlice(vpos);
discardByTerrainDepth();`),e.include(kX),n.main.add(E`
    float lineWidth = noPerspectiveRead(vLineWidth);
    float lineDistance = noPerspectiveRead(vLineDistance);
    ${_e(O,E`float lineDistanceNorm = noPerspectiveRead(vLineDistanceNorm);`)}
  `),_?n.main.add(E`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(M&&n.main.add(E`
        float sdf = noPerspectiveRead(min(vSegmentSDF, vReverseSegmentSDF));
        vec2 fragmentPosition = vec2(min(sdf, 0.0), lineDistance);

        float fragmentRadius = length(fragmentPosition);
        float fragmentCapSDF = (fragmentRadius - lineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
        float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

        if (capCoverage < ${E.float(Gr)}) {
          discard;
        }
      `),P?n.main.add(E`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        lineDistanceNorm
      );
      float stippleRadius = length(stipplePosition * lineWidth);
      float stippleCapSDF = (stippleRadius - lineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${E.float(Gr)}, stippleCoverage);
      `):n.main.add(E`float stippleAlpha = getStippleAlpha(lineWidth);`),l!==10&&n.main.add(E`discardByStippleAlpha(stippleAlpha, ${E.float(Gr)});`),e.include(kX),n.uniforms.add(new Xn("intrinsicColor",L=>L.color)).main.add(E`vec4 color = intrinsicColor * vColor;
color.a = noPerspectiveRead(color.a);`),w&&n.uniforms.add(new Xn("innerColor",L=>L.innerColor??L.color),new ut("innerWidth",(L,F)=>L.innerWidth*F.camera.pixelRatio)).main.add(E`float distToInner = abs(lineDistance) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`),n.main.add(E`vec4 finalColor = blendStipple(color, stippleAlpha);`),f&&(n.uniforms.add(new ut("falloff",L=>L.falloff)),n.main.add(E`finalColor.a *= pow(max(0.0, 1.0 - abs(lineDistanceNorm)), falloff);`)),h||n.main.add(E`float featherStartDistance = max(lineWidth - 2.0, 0.0);
float value = abs(lineDistance);
float feather = (value - featherStartDistance) / (lineWidth - featherStartDistance);
finalColor.a *= 1.0 - clamp(feather, 0.0, 1.0);`),x&&n.main.add(E`
        finalColor = animate(finalColor);

        ${_e(l!==10,E`
            if (finalColor.a <= ${E.float(Gr)}) {
              discard;
            }`)}
      `)),n.main.add(E`outputColorHighlightOID(finalColor, vpos, finalColor.rgb);`),e}const cSt=Object.freeze(Object.defineProperty({__proto__:null,build:$Ie,ribbonlineNumRoundJoinSubdivisions:$D},Symbol.toStringTag,{value:"Module"}));let uSt=class extends Vi{constructor(e,i){super(e,i,new Ii(cSt,()=>te(()=>Promise.resolve().then(()=>Vkt),void 0)),CIe(i).locations),this.primitiveType=i.wireframe?lr.LINES:lr.TRIANGLE_STRIP}_makePipelineState(e,i){const{oitPass:r,output:s,hasOccludees:n,hasPolygonOffset:a}=e,o=r===0,l=r===2;return li({blending:ds(s)?C8(r):null,depthTest:{func:Qie(r)},depthWrite:cRe(e),drawBuffers:sw(s,Dw(r,s)),colorWrite:$i,stencilWrite:n?lV:null,stencilTest:n?i?vX:ure:null,polygonOffset:o||l?a?e0e:null:Yie})}initializePipeline(e){if(e.occluder){const i=e.hasPolygonOffset?e0e:null,{output:r,hasOccludees:s}=e;this._occluderPipelineTransparent=li({blending:em,polygonOffset:i,depthTest:Rge,depthWrite:null,colorWrite:$i,stencilWrite:null,stencilTest:s?S0t:null,drawBuffers:sw(r)}),this._occluderPipelineOpaque=li({blending:em,polygonOffset:i,depthTest:s?Rge:Pge,depthWrite:null,colorWrite:$i,stencilWrite:s?v0t:null,stencilTest:s?x0t:null,drawBuffers:sw(r)}),this._occluderPipelineMaskWrite=li({blending:null,polygonOffset:i,depthTest:Pge,depthWrite:null,colorWrite:null,stencilWrite:s?lV:null,stencilTest:s?vX:null,drawBuffers:sw(r)})}return this._occludeePipeline=this._makePipelineState(e,!0),this._makePipelineState(e,!1)}getPipeline(e,i){if(e)return this._occludeePipeline;switch(i){case 11:return this._occluderPipelineTransparent??super.getPipeline();case 10:return this._occluderPipelineOpaque??super.getPipeline();default:return this._occluderPipelineMaskWrite??super.getPipeline()}}};const e0e={factor:0,units:-4};function CIe(t){const e=jc().vec3f("position").vec4f16("previousDelta").vec4f16("nextDelta").f32("u0").vec2f16("lineParameters");return t.hasVVColor?e.f32("colorFeatureAttribute"):e.vec4u8("color",{glNormalized:!0}),t.hasVVSize?e.f32("sizeFeatureAttribute"):e.f32("size"),t.hasVVOpacity&&e.f32("opacityFeatureAttribute"),Jh()&&e.vec4u8("olidColor"),t.hasAnimation&&e.vec4f16("timeStamps"),e}let Js=class extends op{constructor(e){super(),this.spherical=e,this.capType=0,this.emissionSource=0,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.applyMarkerOffset=!1,this.hasVVSize=!1,this.hasVVColor=!1,this.hasVVOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.occluder=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.wireframe=!1,this.discardInvisibleFragments=!1,this.animation=2,this.hasScreenSizePerspective=!1,this.textureCoordinateType=0,this.occlusionPass=!1,this.hasVVInstancing=!1,this.hasSliceTranslatedView=!0,this.overlayEnabled=!1,this.snowCover=!1}get hasAnimation(){return this.animation!==0}};d([oe({count:3})],Js.prototype,"capType",void 0),d([oe({count:8})],Js.prototype,"emissionSource",void 0),d([oe()],Js.prototype,"hasPolygonOffset",void 0),d([oe()],Js.prototype,"writeDepth",void 0),d([oe()],Js.prototype,"draped",void 0),d([oe()],Js.prototype,"stippleEnabled",void 0),d([oe()],Js.prototype,"stippleOffColorEnabled",void 0),d([oe()],Js.prototype,"stipplePreferContinuous",void 0),d([oe()],Js.prototype,"roundJoins",void 0),d([oe()],Js.prototype,"applyMarkerOffset",void 0),d([oe()],Js.prototype,"hasVVSize",void 0),d([oe()],Js.prototype,"hasVVColor",void 0),d([oe()],Js.prototype,"hasVVOpacity",void 0),d([oe()],Js.prototype,"falloffEnabled",void 0),d([oe()],Js.prototype,"innerColorEnabled",void 0),d([oe()],Js.prototype,"hasOccludees",void 0),d([oe()],Js.prototype,"occluder",void 0),d([oe()],Js.prototype,"terrainDepthTest",void 0),d([oe()],Js.prototype,"cullAboveTerrain",void 0),d([oe()],Js.prototype,"wireframe",void 0),d([oe()],Js.prototype,"discardInvisibleFragments",void 0),d([oe({count:4})],Js.prototype,"animation",void 0),d([oe()],Js.prototype,"hasScreenSizePerspective",void 0);let hSt=class extends T8{constructor(e,i){super(e,pSt),this.produces=new Map([[2,r=>iie(r)||ds(r)&&this.parameters.renderOccluded===8],[3,r=>rie(r)],[10,r=>$Q(r)&&this.parameters.renderOccluded===8],[11,r=>$Q(r)&&this.parameters.renderOccluded===8],[4,r=>ds(r)&&this.parameters.writeDepth&&this.parameters.renderOccluded!==8],[8,r=>ds(r)&&!this.parameters.writeDepth&&this.parameters.renderOccluded!==8],[18,r=>Elt(r)]]),this._configuration=new Js(i)}getConfiguration(e,i){super.getConfiguration(e,i,this._configuration),this._configuration.oitPass=i.oitPass,this._configuration.draped=i.slot===18;const r=this.parameters.stipplePattern!=null&&e!==9;return this._configuration.stippleEnabled=r,this._configuration.stippleOffColorEnabled=r&&this.parameters.stippleOffColor!=null,this._configuration.stipplePreferContinuous=r&&this.parameters.stipplePreferContinuous,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.roundJoins=this.parameters.join==="round",this._configuration.capType=this.parameters.cap,this._configuration.applyMarkerOffset=this.parameters.markerParameters!=null&&mSt(this.parameters.markerParameters),this._configuration.hasPolygonOffset=this.parameters.hasPolygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasVVSize=this.parameters.hasVVSize,this._configuration.hasVVColor=this.parameters.hasVVColor,this._configuration.hasVVOpacity=this.parameters.hasVVOpacity,this._configuration.innerColorEnabled=this.parameters.innerWidth>0&&this.parameters.innerColor!=null,this._configuration.falloffEnabled=this.parameters.falloff>0,this._configuration.hasOccludees=i.hasOccludees,this._configuration.occluder=this.parameters.renderOccluded===8,this._configuration.terrainDepthTest=i.terrainDepthTest&&ds(e),this._configuration.cullAboveTerrain=i.cullAboveTerrain,this._configuration.wireframe=this.parameters.wireframe,this._configuration.animation=this.parameters.animation,this._configuration.emissionSource=this.hasEmissions?1:0,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration}get visible(){return this.parameters.color[3]>=Gr||this.parameters.stipplePattern!=null&&(this.parameters.stippleOffColor?.[3]??0)>Gr}setParameters(e,i){e.animation=this.parameters.animation,super.setParameters(e,i)}intersectDraped({attributes:e,screenToWorldRatio:i},r,s,n,a){if(!r.options.selectionMode)return;const o=e.get("size");let l=this.parameters.width;if(this.parameters.vvSize){const S=e.get("sizeFeatureAttribute").data[0];Number.isNaN(S)?l*=this.parameters.vvSize.fallback[0]:l*=Se(this.parameters.vvSize.offset[0]+S*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else o&&(l*=o.data[0]);const c=s[0],h=s[1],f=(l/2+4)*i;let y=Number.MAX_VALUE,_=0;const w=e.get("position").data,x=zX(this.parameters,e)?w.length-2:w.length-5;for(let S=0;S<x;S+=3){const $=w[S],A=w[S+1],M=(S+3)%w.length,P=c-$,O=h-A,D=w[M]-$,L=w[M+1]-A,F=Se((D*P+L*O)/(D*D+L*L),0,1),U=D*F-P,N=L*F-O,j=U*U+N*N;j<y&&(y=j,_=S/3)}y<f*f&&n(a.distance,a.normal,_)}intersect(e,i,r,s,n,a){const{options:o,camera:l,rayBegin:c,rayEnd:h}=r;if(!o.selectionMode||!e.visible||!l)return;if(!eut(i))return void fe.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix");const f=e.attributes,y=f.get("position").data;let _=this.parameters.width;if(this.parameters.vvSize){const M=f.get("sizeFeatureAttribute").data[0];Number.isNaN(M)||(_*=Se(this.parameters.vvSize.offset[0]+M*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0]))}else f.has("size")&&(_*=f.get("size").data[0]);const w=gSt;ko(w,r.point);const x=_*l.pixelRatio/2+4*l.pixelRatio;ve(xA[0],w[0]-x,w[1]+x,0),ve(xA[1],w[0]+x,w[1]+x,0),ve(xA[2],w[0]+x,w[1]-x,0),ve(xA[3],w[0]-x,w[1]-x,0);for(let M=0;M<4;M++)if(!l.unprojectFromRenderScreen(xA[M],Nm[M]))return;Su(l.eye,Nm[0],Nm[1],wG),Su(l.eye,Nm[1],Nm[2],xG),Su(l.eye,Nm[2],Nm[3],SG),Su(l.eye,Nm[3],Nm[0],TG);let S=Number.MAX_VALUE,$=0;const A=zX(this.parameters,f)?y.length-2:y.length-5;for(let M=0;M<A;M+=3){gl[0]=y[M]+i[12],gl[1]=y[M+1]+i[13],gl[2]=y[M+2]+i[14];const P=(M+3)%y.length;if(yl[0]=y[P]+i[12],yl[1]=y[P+1]+i[13],yl[2]=y[P+2]+i[14],va(wG,gl)<0&&va(wG,yl)<0||va(xG,gl)<0&&va(xG,yl)<0||va(SG,gl)<0&&va(SG,yl)<0||va(TG,gl)<0&&va(TG,yl)<0)continue;const O=l.projectToRenderScreen(gl,ySt),D=l.projectToRenderScreen(yl,_St);if(O==null||D==null)continue;if(O[2]<0&&D[2]>0){Ce(Zp,gl,yl);const F=l.frustum,U=-va(F[4],gl)/Oe(Zp,F[4]);if(le(Zp,Zp,U),xe(gl,gl,Zp),!l.projectToRenderScreen(gl,O))continue}else if(O[2]>0&&D[2]<0){Ce(Zp,yl,gl);const F=l.frustum,U=-va(F[4],yl)/Oe(Zp,F[4]);if(le(Zp,Zp,U),xe(yl,yl,Zp),!l.projectToRenderScreen(yl,D))continue}else if(O[2]<0&&D[2]<0)continue;O[2]=0,D[2]=0;const L=O3e(dz(O,D,r0e),w);L<S&&(S=L,de(t0e,gl),de(i0e,yl),$=M/3)}if(S<x*x){let M=Number.MAX_VALUE;if(zQe(dz(t0e,i0e,r0e),dz(c,h,vSt),N1)){Ce(N1,N1,c);const P=Le(N1);le(N1,N1,1/P),M=P/Ri(c,h)}a(M,N1,$)}}get hasEmissions(){return this.parameters.emissiveStrength>0}createBufferWriter(){return new fSt(CIe(this.parameters),this.parameters)}createGLMaterial(e){return new dSt(e)}validateParameters(e){e.join!=="miter"&&(e.miterLimit=0),e.markerParameters!=null&&(e.markerScale=e.markerParameters.width/e.width)}update(e){const{hasAnimation:i}=this.parameters;return!!i&&(this.setParameters({timeElapsed:gK(e.time)},!1),e.dt!==0)}},dSt=class extends Vie{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextures?.release(this._stipplePattern),this._stipplePattern=null}beginSlot(e){const i=this._material.parameters.stipplePattern;return this._stipplePattern!==i&&(this._material.setParameters({stippleTexture:this._stippleTextures.swap(i,this._stipplePattern)}),this._stipplePattern=i),this.getTechnique(uSt,e)}},pSt=class extends _mt{constructor(){super(...arguments),this.width=0,this.color=FU,this.join="miter",this.cap=0,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleTexture=null,this.stipplePreferContinuous=!0,this.markerParameters=null,this.markerScale=1,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.wireframe=!1,this.timeElapsed=0,this.animation=0,this.animationSpeed=1,this.trailLength=1,this.startTime=0,this.endTime=1/0,this.fadeInTime=0,this.fadeOutTime=1/0,this.emissiveStrength=0}get transparent(){return this.color[3]<1||this.hasAnimation||this.stipplePattern!=null&&(this.stippleOffColor?.[3]??0)<1}get hasAnimation(){return this.animation!==0}},fSt=class{constructor(e,i){this.layout=e,this._parameters=i;const r=i.stipplePattern?1:0;switch(this._parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=r;break;case"round":this.numJoinSubdivisions=$D+r}}_isClosed(e){return zX(this._parameters,e)}allocate(e){return this.layout.createBuffer(e)}elementCount(e){const r=e.get("position").indices.length/2+1,s=this._isClosed(e);let n=s?2:4;return n+=((s?r:r-1)-(s?0:1))*(2*this.numJoinSubdivisions+4),n+=2,this._parameters.wireframe&&(n=2+4*(n-2)),n}write(e,i,r,s,n,a){const o=this.layout,l=r.get("position"),c=l.indices,h=l.data.length/3,f=r.get("distanceToStart")?.data;c&&c.length!==2*(h-1)&&console.warn("RibbonLineMaterial does not support indices");const y=o.fields.has("sizeFeatureAttribute");let _=1,w=null;if(y){const ce=r.get("sizeFeatureAttribute");ce.data.length===1?_=ce.data[0]:w=ce.data}else _=r.get("size")?.data[0]??1;let x=[1,1,1,1],S=0,$=null;const A=o.fields.has("colorFeatureAttribute");if(A){const ce=r.get("colorFeatureAttribute");ce.data.length===1?S=ce.data[0]:$=ce.data}else x=r.get("color")?.data??x;const M=r.get("timeStamps")?.data,P=M&&o.fields.has("timeStamps"),O=o.fields.has("opacityFeatureAttribute");let D=0,L=null;if(O){const ce=r.get("opacityFeatureAttribute");ce.data.length===1?D=ce.data[0]:L=ce.data}const F=new Float32Array(n.buffer),U=WAe(n.buffer),N=new Uint8Array(n.buffer),j=o.stride/4;let B=a*j;const Y=B;let G=0;const Z=f?(ce,be,ze)=>G=f[ze]:(ce,be,ze)=>G+=Ri(ce,be),H=F.BYTES_PER_ELEMENT/U.BYTES_PER_ELEMENT,Q=4/H,X=Jh(),ye=(ce,be,ze,Ne,at,Tt,et,It)=>{F[B++]=be[0],F[B++]=be[1],F[B++]=be[2],nge(ce,be,U,B*H),B+=Q,nge(ze,be,U,B*H),B+=Q,F[B++]=It;let $t=B*H;if(U[$t++]=at,U[$t++]=Tt,B=Math.ceil($t/H),A)F[B]=$?.[et]??S;else{const Ct=Math.min(4*et,x.length-4),jt=4*B;N[jt]=255*x[Ct],N[jt+1]=255*x[Ct+1],N[jt+2]=255*x[Ct+2],N[jt+3]=255*x[Ct+3]}if(B++,F[B++]=w?.[et]??_,O&&(F[B++]=L?.[et]??D),X){let Ct=4*B;s?(N[Ct++]=s[0],N[Ct++]=s[1],N[Ct++]=s[2],N[Ct++]=s[3]):(N[Ct++]=0,N[Ct++]=0,N[Ct++]=0,N[Ct++]=0),B=Math.ceil(.25*Ct)}P&&($t=B*H,U[$t++]=Ne[0],U[$t++]=Ne[1],U[$t++]=Ne[2],U[$t++]=Ne[3],B=Math.ceil($t/H))};B+=j,ve(Ts,l.data[0],l.data[1],l.data[2]),P&&yr(_l,M[0],M[1],M[2],M[3]),e&&Mt(Ts,Ts,e);const De=this._isClosed(r);if(De){const ce=l.data.length-3;ve(Qa,l.data[ce],l.data[ce+1],l.data[ce+2]),e&&Mt(Qa,Qa,e)}else ve(zn,l.data[3],l.data[4],l.data[5]),e&&Mt(zn,zn,e),ye(Ts,Ts,zn,_l,1,-4,0,0),ye(Ts,Ts,zn,_l,1,4,0,0),de(Qa,Ts),de(Ts,zn),P&&yr(_l,M[4],M[5],M[6],M[7]);const q=De?0:1,ne=De?h:h-1;for(let ce=q;ce<ne;ce++){const be=(ce+1)%h*3;ve(zn,l.data[be],l.data[be+1],l.data[be+2]),e&&Mt(zn,zn,e),Z(Qa,Ts,ce),ye(Qa,Ts,zn,_l,0,-1,ce,G),ye(Qa,Ts,zn,_l,0,1,ce,G);const ze=this.numJoinSubdivisions;for(let Ne=0;Ne<ze;++Ne){const at=(Ne+1)/(ze+1);ye(Qa,Ts,zn,_l,at,-1,ce,G),ye(Qa,Ts,zn,_l,at,1,ce,G)}if(ye(Qa,Ts,zn,_l,1,-2,ce,G),ye(Qa,Ts,zn,_l,1,2,ce,G),de(Qa,Ts),de(Ts,zn),P){const Ne=(ce+1)%h*4;yr(_l,M[Ne],M[Ne+1],M[Ne+2],M[Ne+3])}}return De?(ve(zn,l.data[3],l.data[4],l.data[5]),e&&Mt(zn,zn,e),G=Z(Qa,Ts,ne),ye(Qa,Ts,zn,_l,0,-1,q,G),ye(Qa,Ts,zn,_l,0,1,q,G)):(G=Z(Qa,Ts,ne),ye(Qa,Ts,Ts,_l,0,-5,ne,G),ye(Qa,Ts,Ts,_l,0,5,ne,G)),bG(F,Y+j,F,Y,j),B=bG(F,B-j,F,B,j),this._parameters.wireframe&&this._addWireframeVertices(n,Y,B,j),null}_addWireframeVertices(e,i,r,s){const n=new Float32Array(e.buffer,r*Float32Array.BYTES_PER_ELEMENT),a=new Float32Array(e.buffer,i*Float32Array.BYTES_PER_ELEMENT,r-i);let o=0;const l=c=>o=bG(a,c,n,o,s);for(let c=0;c<a.length-1;c+=2*s)l(c),l(c+2*s),l(c+1*s),l(c+2*s),l(c+1*s),l(c+3*s)}};function bG(t,e,i,r,s){for(let n=0;n<s;n++)i[r++]=t[e++];return r}function zX(t,e){return t.isClosed?e.get("position").indices.length>2:!1}function mSt(t){return t.anchor===1&&t.hideOnShortSegments&&t.placement==="begin-end"&&t.worldSpace}const gl=R(),yl=R(),Zp=R(),N1=R(),gSt=R(),ySt=zf(),_St=zf(),t0e=R(),i0e=R(),r0e=Oy(),vSt=Oy(),Qa=R(),Ts=R(),zn=R(),_l=ri(),xA=[zf(),zf(),zf(),zf()],Nm=[R(),R(),R(),R()],wG=Oi(),xG=Oi(),SG=Oi(),TG=Oi();let MIe=class{constructor(e){this._originSR=e,this._rootOriginId="root/"+ql(),this._origins=new Map,this._objects=new Map,this._gridSize=5e5}getOrigin(e){const i=this._origins.get(this._rootOriginId);if(i==null){const h=wV(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,h),h}const r=this._gridSize,s=Math.round(e[0]/r),n=Math.round(e[1]/r),a=Math.round(e[2]/r),o=`${s}/${n}/${a}`;let l=this._origins.get(o);const c=.5*r;if(Ce(Ia,e,i.vec3),Ia[0]=Math.abs(Ia[0]),Ia[1]=Math.abs(Ia[1]),Ia[2]=Math.abs(Ia[2]),Ia[0]<c&&Ia[1]<c&&Ia[2]<c){if(l){const h=Math.max(...Ia);if(Ce(Ia,e,l.vec3),Ia[0]=Math.abs(Ia[0]),Ia[1]=Math.abs(Ia[1]),Ia[2]=Math.abs(Ia[2]),Math.max(...Ia)<h)return l}return i}return l||(l=wV(s*r,n*r,a*r,o),this._origins.set(o,l)),l}_drawOriginBox(e,i=fi(1,1,0,1)){const r=window.view,s=r.stage,n=i.toString();if(!this._objects.has(n)){this._material=new hSt({width:2,color:i},!1);const _=new _4e(s,{pickable:!1}),w=new zDe({castShadow:!1});_.add(w),this._objects.set(n,w)}const a=this._objects.get(n),o=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],l=o.length,c=new Array(3*l),h=new Array,f=.5*this._gridSize;for(let _=0;_<l;_++)c[3*_]=e[0]+(1&o[_]?f:-f),c[3*_+1]=e[1]+(2&o[_]?f:-f),c[3*_+2]=e[2]+(4&o[_]?f:-f),_>0&&h.push(_-1,_);Aa(c,this._originSR,0,c,r.renderSpatialReference,0,l);const y=new Xl(this._material,[["position",new Si(c,h,3,!0)]],null,2);a.addGeometry(y)}get test(){}};const Ia=R();function Vy(t=bSt){return[t[0],t[1],t[2],t[3]]}function $G(t,e,i=Vy()){return de(i,t),i[3]=e,i}function s0e(t,e,i){return bt(i,t,e),Ee(i,i),i[3]=-_3e(t,e),i}function YXt(t,e=Vy()){const i=o3e(ZO,t);return EIe(e,Ea(qte(e,i))),e}function n0e(t,e,i=Vy()){return S6(ZO,t,a0e(t)),S6(o0e,e,a0e(e)),n8(ZO,o0e,ZO),EIe(i,Ea(qte(i,ZO)))}function QXt(t,e,i,r=Vy()){return $G(Cee,t,ZL),$G(Mee,e,l0e),$G(py,i,c0e),n0e(ZL,l0e,ZL),n0e(ZL,c0e,r),r}function XXt(t){return t}function JXt(t){return t[3]}function a0e(t){return Lt(t[3])}function EIe(t,e){return t[3]=e,t}const bSt=[0,0,1,0],ZO=Kh(),o0e=Kh();Vy();const ZL=Vy(),l0e=Vy(),c0e=Vy();function wSt(t){return t!=null&&!t.readyToRun}let xSt=class{constructor(){this.startTime=0,this._data=Pn(null),this.coverage=0,this.absorption=0,this._readChannels=0,this.parallax=new u0e,this.parallaxNew=new u0e,this._anchorPoint=R(),this._fadeState=Pn(0),this._fadeFactor=Pn(1)}get data(){return this._data.value}set data(e){this._data.value=e}get readChannels(){return this._readChannels}get fadeState(){return this._fadeState.value}get fadeFactor(){return this._fadeFactor.value}get opacity(){switch(this.fadeState){case 0:return 0;case 4:return 1-this.fadeFactor;case 1:return this.fadeFactor;case 2:case 3:return 1}}fade(e,i,r){this.isFading&&this.fadeFactor<1&&(this._fadeFactor.value=r?Se((i-this.startTime)/(TSt*r),0,1):1,this.fadeFactor===1&&this._endFade()),this._evaluateState(e,i),this._updateParallax(e)}_evaluateState(e,i){const r=e.relativeElevation,s=this._updateAnchorPoint(e);(r>1.7*aw||r<-aw||s>d0e)&&this.opacity>0?this._startFade(0,i):this.isFading||(r>aw||r<-.35*aw||s>$St*d0e?this.opacity>0&&this._startFade(4,i):wSt(this.data)&&(this.opacity===0?this._startFade(1,i):this.data.state===2&&(this.fadeState===2?this._startFade(3,i):this._startFade(2,i))))}_updateParallax(e){const i=On(e.eye);this.parallax.radiusCurvatureCorrection=.84*Math.sqrt(Math.max(i-mi.radius*mi.radius,0))/Math.sqrt(i),s0e(h0e,this.parallax.anchorPoint,FS),Eu(this.parallax.transform,Ro,FS[3],FS),s0e(h0e,this.parallaxNew.anchorPoint,FS),Eu(this.parallaxNew.transform,Ro,FS[3],FS)}_updateAnchorPoint(e){return Ee(this._anchorPoint,e.eye),le(this._anchorPoint,this._anchorPoint,mi.radius),this.fadeState===0&&this.data?.state===2?(de(this.parallax.anchorPoint,this._anchorPoint),0):Le(Ce(SSt,this.parallax.anchorPoint,this._anchorPoint))}requestFade(){this._fadeFactor.value=0}_startFade(e,i){switch(this._fadeState.value=e,this.startTime=i,e){case 3:this.requestFade(),this._switchReadChannels(),de(this.parallaxNew.anchorPoint,this._anchorPoint);break;case 1:this.requestFade(),this._switchReadChannels(),de(this.parallax.anchorPoint,this._anchorPoint),de(this.parallaxNew.anchorPoint,this._anchorPoint);break;case 4:this.requestFade();break;case 2:this._switchReadChannels(),de(this.parallax.anchorPoint,this._anchorPoint),de(this.parallaxNew.anchorPoint,this._anchorPoint),this._endFade();break;case 0:this._endFade()}}_endFade(){switch(this._fadeFactor.value=1,this.data&&this.data.state!==2&&(this.data.state=0),this.fadeState){case 3:de(this.parallax.anchorPoint,this.parallaxNew.anchorPoint),this._fadeState.value=2;break;case 1:this._fadeState.value=2;break;case 4:this._fadeState.value=0;break;case 2:case 0:break;default:this.fadeState}}_switchReadChannels(){this.data?.state===2&&(this._readChannels=1-this._readChannels,this.data.state=3)}get isFading(){return this.fadeState===4||this.fadeState===1||this.fadeState===3}},u0e=class{constructor(){this.anchorPoint=R(),this.radiusCurvatureCorrection=0,this.transform=it()}};const h0e=Ge(0,0,1),FS=Vy(),SSt=R(),TSt=1.25,$St=.5,d0e=2e5;let CSt=class{constructor(e,i){this.width=e,this.height=i}},ese=class{constructor(e){this.shadowMap=e,this.slot=2,this.slicePlane=null,this.hasOccludees=!1,this.enableFillLights=!0,this.oitPass=0,this.alignPixelEnabled=!1,this.decorations=!0,this.overlayStretch=1,this.viewshedEnabled=!1,this.cutFillEnabled=!1,this._camera=new nr,this._inverseViewport=pt(),this._oldLighting=new Zq,this._newLighting=new Zq,this._fadedLighting=new Zq,this._lighting=this._newLighting,this.ssr=new MSt,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.highlights=new Array,this.highlightOrderMap=new Map,this.highlightMixOrigin=pt(),this.highlightMixTexture=null,this.hudRenderStyle=0,this.hudOccludedFragmentOpacity=1,this.snowCover=0,this.clouds=new xSt,this.shadowHighlightsVisible=!1}destroy(){this._camera=null,this.contentCamera=null,this.depth=null,this.geometryDepth=null,this.mainDepth=null,this.overlay=null,this.ssao=null,this.terrainDepth=null}get camera(){return this._camera}set camera(e){this._camera=e,this._inverseViewport[0]=1/e.fullViewport[2],this._inverseViewport[1]=1/e.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}fadeLighting(){switch(this.clouds.fadeFactor){case 0:this._lighting=this._oldLighting;break;default:this._fadedLighting.lerpLighting(this._oldLighting,this._newLighting,this.clouds.fadeFactor),this._lighting=this._fadedLighting;break;case 1:this._lighting=this._newLighting,this._oldLighting.copyFrom(this._newLighting)}}updateLighting(e,i,r,s){this._oldLighting.copyFrom(this.lighting),this._newLighting.noonFactor=i,this._newLighting.globalFactor=r,this._newLighting.set(e),this._oldLighting.updateLegacy(),s===1&&this.clouds.requestFade(),this.fadeLighting()}get highlight(){return this.highlightLevel==null?null:this.highlights[this.highlightLevel]}},MSt=class{constructor(){this.fadeFactor=1,this.reprojectionMatrix=it()}},AIe=class{constructor(e,i,r){this.rctx=e,this.techniques=r,this.lastFrameCamera=new nr,this.output=0,this.renderOccludedMask=CD,this.time=0,this.bind=new ese(i),this.bind.alignPixelEnabled=!0}};const CD=13;let YO=class extends nr{constructor(){super(...arguments),this._projectionMatrix=it()}get projectionMatrix(){return this._projectionMatrix}};d([m()],YO.prototype,"_projectionMatrix",void 0),d([m({readOnly:!0})],YO.prototype,"projectionMatrix",null),YO=d([k("esri.views.3d.webgl-engine.lib.CascadeCamera")],YO);let YL=class{constructor(){this.camera=new YO,this.lightMat=it()}},ESt=class{constructor(){this.maxNumCascadesHighQuality=4,this.maxNumCascadesLowQuality=4,this.textureSizeModHighQuality=1.3,this.textureSizeModLowQuality=.9,this.splitSchemeLambda=0}},tse=class{constructor(e,i){this._fbos=e,this._viewingMode=i,this._snapshots=new Array,this._textureHeight=0,this._numCascades=1,this.settings=new ESt,this._projectionView=it(),this._projectionViewInverse=it(),this._modelViewLight=it(),this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=ri(),this._cascades=[new YL,new YL,new YL,new YL],this._lastOrigin=null,this._enabled=!1,this._maxTextureWidth=Math.min(ie("esri-mobile")?4096:16384,e.rctx.parameters.maxTextureSize)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}get depthTexture(){return this._handle?.getTexture(Ba)}get _textureWidth(){return this._textureHeight*this._numCascades}get numCascades(){return this._numCascades}get cascadeDistances(){return yr(this._usedCascadeDistances,this._cascadeDistances[0],this._numCascades>1?this._cascadeDistances[1]:1/0,this._numCascades>2?this._cascadeDistances[2]:1/0,this._numCascades>3?this._cascadeDistances[3]:1/0)}disposeMainBuffer(){this._handle=Sr(this._handle)}disposeOffscreenBuffers(){this.disposeMainBuffer(),this._discardSnapshots()}set maxCascades(e){this.settings.maxNumCascadesHighQuality=Se(Math.floor(e),1,4)}get maxCascades(){return this.settings.maxNumCascadesHighQuality}set enabled(e){this._enabled=e,e||this.disposeOffscreenBuffers()}get enabled(){return this._enabled}get ready(){return this._enabled&&this.depthTexture!=null}get cascades(){for(let e=0;e<this._numCascades;++e)AF[e]=this._cascades[e];return AF.length=this._numCascades,AF}start(e,i,r,s,n){dt(this.enabled);const{near:a,far:o}=LSt(r);this._computeCascadeDistances(a,o,s),this._textureHeight=this._computeTextureHeight(e,n,s),this._setupMatrices(e,i);const{viewMatrix:l,projectionMatrix:c}=e;for(let h=0;h<this._numCascades;++h)this._constructCascade(h,c,l,i);this._lastOrigin=null,this.clear()}finish(){dt(this.enabled)}getShadowMapMatrices(e){if(!this._lastOrigin||!si(e,this._lastOrigin)){this._lastOrigin=this._lastOrigin||R(),de(this._lastOrigin,e);for(let i=0;i<this._numCascades;++i){Qh(_0e,this._cascades[i].lightMat,e);for(let r=0;r<16;++r)v0e[16*i+r]=_0e[r]}}return v0e}moveSnapshot(e){dt(this.enabled),this._snapshots[e]?.release(),this._snapshots[e]=this._handle,this._handle?.setName(e===0?"shadow map highlight":"shadow map excluding highlight"),this._handle=null}copySnapshot(e){if(!this.enabled||!this._handle?.getTexture(Ba)?.descriptor)return;this._snapshots[e]?.release();const r=e===0?"shadow map highlight":"shadow map excluding highlight",s=this._acquireFBO(r);this._snapshots[e]=s;const n=this._handle?.fbo;if(!n||!s?.fbo)return void console.error("No FBO");const{rctx:a}=this._fbos;a.blitFramebuffer(n,s.fbo,256)}getSnapshot(e){return this.enabled?this._snapshots[e]?.getTexture(Ba):null}clear(){this._ensureFbo(),this.bindFbo(),this._fbos.rctx.clear(256)}_computeTextureHeight({pixelRatio:e,fullWidth:i,fullHeight:r},s,n){const a=Math.min(window.devicePixelRatio,s)/e,o=n?this.settings.textureSizeModHighQuality:this.settings.textureSizeModLowQuality;return Iv(Math.max(i,r)*a*o,this._maxTextureWidth/this._numCascades)}_ensureFbo(){this._handle?.fbo?.width===this._textureWidth&&this._handle?.fbo.height===this._textureHeight||(this._handle?.release(),this._handle=this._acquireFBO("shadow map"))}_acquireFBO(e){const i=this._fbos.acquire(this._textureWidth,this._textureHeight,e,12);return i.getTexture(Ba)?.setShadowFiltering(!0),i}_discardSnapshot(e){this._snapshots[e]=Sr(this._snapshots[e])}_discardSnapshots(){for(let e=0;e<this._snapshots.length;++e)this._discardSnapshot(e);this._snapshots.length=0}bindFbo(){this._fbos.rctx.bindFramebuffer(this._handle?.fbo)}_constructCascade(e,i,r,s){const n=this._cascades[e],a=-this._cascadeDistances[e],o=-this._cascadeDistances[e+1],l=(i[10]*a+i[14])/Math.abs(i[11]*a+i[15]),c=(i[10]*o+i[14])/Math.abs(i[11]*o+i[15]);dt(l<c);for(let _=0;_<8;++_){yr(p0e,_%4==0||_%4==3?-1:1,_%4==0||_%4==1?-1:1,_<4?l:c,1);const w=Ph[_];Dc(w,p0e,this._projectionViewInverse),w[0]/=w[3],w[1]/=w[3],w[2]/=w[3]}Gh(CG,Ph[0]),n.camera.viewMatrix=Qh(ASt,this._modelViewLight,CG);for(let _=0;_<8;++_)Mt(Ph[_],Ph[_],n.camera.viewMatrix);let h=Ph[0][2],f=Ph[0][2];for(let _=1;_<8;++_)h=Math.min(h,Ph[_][2]),f=Math.max(f,Ph[_][2]);h-=200,f+=200,n.camera.near=-f,n.camera.far=-h,ISt(r,s,h,f,n.camera),an(n.lightMat,n.camera.projectionMatrix,n.camera.viewMatrix);const y=this._textureHeight;n.camera.viewport=[e*y,0,y,y]}_setupMatrices(e,i){an(this._projectionView,e.projectionMatrix,e.viewMatrix),nl(this._projectionViewInverse,this._projectionView);const r=this._viewingMode===1?e.eye:ve(CG,0,0,1);kU(this._modelViewLight,[0,0,0],[-i[0],-i[1],-i[2]],r)}_computeCascadeDistances(e,i,r){const s=r?this.settings.maxNumCascadesHighQuality:this.settings.maxNumCascadesLowQuality;this._numCascades=Math.min(1+Math.floor(Kct(i/e,4)),s);const n=(i-e)/this._numCascades,a=(i/e)**(1/this._numCascades);let o=e,l=e;for(let c=0;c<this._numCascades+1;++c)this._cascadeDistances[c]=ft(o,l,this.settings.splitSchemeLambda),o*=a,l+=n}get test(){}};const ASt=it(),p0e=ri(),Ph=[];for(let t=0;t<8;++t)Ph.push(ri());const f0e=pt(),m0e=pt(),OSt=pt(),g0e=pt(),y0e=pt(),CG=R(),AF=[];function PSt(){AF.length=0}const _0e=it(),v0e=Ro.concat(Ro,Ro,Ro),su=pt(),NS=pt(),V1=[pt(),pt(),pt(),pt()],Fn=pt(),MG=pt(),L0=pt(),SA=pt(),VS=pt(),US=pt(),QL=pt();function RSt(t,e,i,r,s,n,a,o){Cr(su,0,0);for(let O=0;O<4;++O)wg(su,su,t[O]);zg(su,su,.25),Cr(NS,0,0);for(let O=4;O<8;++O)wg(NS,NS,t[O]);zg(NS,NS,.25),Ec(V1[0],t[4],t[5],.5),Ec(V1[1],t[5],t[6],.5),Ec(V1[2],t[6],t[7],.5),Ec(V1[3],t[7],t[4],.5);let l=0,c=Ux(V1[0],su);for(let O=1;O<4;++O){const D=Ux(V1[O],su);D<c&&(c=D,l=O)}qs(Fn,V1[l],t[l+4]);const h=Fn[0];let f,y;Fn[0]=-Fn[1],Fn[1]=h,qs(MG,NS,su),en(MG,Fn)<0&&f2e(Fn,Fn),Ec(Fn,Fn,MG,i),KN(Fn,Fn),f=y=en(qs(L0,t[0],su),Fn);for(let O=1;O<8;++O){const D=en(qs(L0,t[O],su),Fn);D<f?f=D:D>y&&(y=D)}ko(r,su),zg(L0,Fn,f-e),wg(r,r,L0);let _=-1,w=1,x=0,S=0;for(let O=0;O<8;++O){qs(SA,t[O],r),KN(SA,SA);const D=Fn[0]*SA[1]-Fn[1]*SA[0];D>0?D>_&&(_=D,x=O):D<w&&(w=D,S=O)}xS(_>0,"leftArea"),xS(w<0,"rightArea"),zg(VS,Fn,f),wg(VS,VS,su),zg(US,Fn,y),wg(US,US,su),QL[0]=-Fn[1],QL[1]=Fn[0];const $=K5(r,t[S],US,wg(L0,US,QL),1,s),A=K5(r,t[x],US,L0,1,n),M=K5(r,t[x],VS,wg(L0,VS,QL),1,a),P=K5(r,t[S],VS,L0,1,o);xS($,"rayRay"),xS(A,"rayRay"),xS(M,"rayRay"),xS(P,"rayRay")}function xi(t,e){return 3*e+t}const b0e=pt();function oc(t,e){return Cr(b0e,t[e],t[e+3]),b0e}const vl=pt(),ot=Ir();function DSt(t,e,i,r,s){qs(vl,i,r),zg(vl,vl,.5),ot[0]=vl[0],ot[1]=vl[1],ot[2]=0,ot[3]=vl[1],ot[4]=-vl[0],ot[5]=0,ot[6]=vl[0]*vl[0]+vl[1]*vl[1],ot[7]=vl[0]*vl[1]-vl[1]*vl[0],ot[8]=1,ot[xi(0,2)]=-en(oc(ot,0),t),ot[xi(1,2)]=-en(oc(ot,1),t);let n=en(oc(ot,0),i)+ot[xi(0,2)],a=en(oc(ot,1),i)+ot[xi(1,2)],o=en(oc(ot,0),r)+ot[xi(0,2)],l=en(oc(ot,1),r)+ot[xi(1,2)];n=-(n+o)/(a+l),ot[xi(0,0)]+=ot[xi(1,0)]*n,ot[xi(0,1)]+=ot[xi(1,1)]*n,ot[xi(0,2)]+=ot[xi(1,2)]*n,n=1/(en(oc(ot,0),i)+ot[xi(0,2)]),a=1/(en(oc(ot,1),i)+ot[xi(1,2)]),ot[xi(0,0)]*=n,ot[xi(0,1)]*=n,ot[xi(0,2)]*=n,ot[xi(1,0)]*=a,ot[xi(1,1)]*=a,ot[xi(1,2)]*=a,ot[xi(2,0)]=ot[xi(1,0)],ot[xi(2,1)]=ot[xi(1,1)],ot[xi(2,2)]=ot[xi(1,2)],ot[xi(1,2)]+=1,n=en(oc(ot,1),e)+ot[xi(1,2)],a=en(oc(ot,2),e)+ot[xi(2,2)],o=en(oc(ot,1),i)+ot[xi(1,2)],l=en(oc(ot,2),i)+ot[xi(2,2)],n=-.5*(n/a+o/l),ot[xi(1,0)]+=ot[xi(2,0)]*n,ot[xi(1,1)]+=ot[xi(2,1)]*n,ot[xi(1,2)]+=ot[xi(2,2)]*n,n=en(oc(ot,1),e)+ot[xi(1,2)],a=en(oc(ot,2),e)+ot[xi(2,2)],o=-a/n,ot[xi(1,0)]*=o,ot[xi(1,1)]*=o,ot[xi(1,2)]*=o,s[0]=ot[0],s[1]=ot[1],s[2]=0,s[3]=ot[2],s[4]=ot[3],s[5]=ot[4],s[6]=0,s[7]=ot[5],s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=ot[6],s[13]=ot[7],s[14]=0,s[15]=ot[8]}function ISt(t,e,i,r,s){const n=1/Ph[0][3],a=1/Ph[4][3];dt(n<a);let o=n+Math.sqrt(n*a);const l=Math.sin(Ga(t[2]*e[0]+t[6]*e[1]+t[10]*e[2]));o/=l,RSt(Ph,o,l,f0e,m0e,OSt,g0e,y0e),DSt(f0e,m0e,g0e,y0e,s.projectionMatrix),s.projectionMatrix[10]=2/(i-r),s.projectionMatrix[14]=-(i+r)/(i-r)}function LSt(t){let{near:e,far:i}=t;return e<2&&(e=2),i<2&&(i=2),e>=i&&(e=2,i=4),{near:e,far:i}}let w0e=class extends Vi{constructor(e,i){super(e,i,new Ii(M2t,()=>te(()=>Promise.resolve().then(()=>Ukt),void 0)),Qs)}initializePipeline(e){return e.hasAlpha?li({blending:em,colorWrite:$i}):li({colorWrite:$i})}},OIe=class extends Fo{constructor(){super(...arguments),this.hasAlpha=!1}};d([oe()],OIe.prototype,"hasAlpha",void 0);let ise=class extends hr{constructor(){super(...arguments),this.overlayIndex=0,this.opacity=1}};function PIe(){const t=new Di;return t.include(Oa),t.fragment.uniforms.add(new zt("tex",e=>e.texture)),t.fragment.uniforms.add(new e1("overlayIdx",e=>e.overlayIndex)),t.fragment.uniforms.add(new ut("opacity",e=>e.opacity)),t.fragment.main.add(E`vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
fragColor = texture(tex, overlayUV) * opacity;`),t}const kSt=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:ise,build:PIe},Symbol.toStringTag,{value:"Module"}));let x0e=class extends Vi{constructor(e,i){super(e,i,new Ii(kSt,()=>te(()=>Promise.resolve().then(()=>Bkt),void 0)),Qs)}},hf=class extends _4{constructor(e){super(e),this._overlays=null,this._renderTargets=null,this._overlayParameters=new ise,this.hasHighlights=!1,this.renderOccludedFlags=1,this._hasWater=!1,this._renderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedRenderers=new _i,this._passParameters=new Wre,this._screenToWorldRatio=1,this._localOriginFactory=null,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._camera=new nr,this.events=new Ey,this.longitudeCyclical=null,this.produces=new Map([[18,i=>i!==9||this.hasHighlights],[19,()=>this._hasWater]]),this._hasTargetWithoutRasterImage=!1,this._hasDrapedFeatureSource=!1,this._hasDrapedRasterSource=!1,this._hasDrapedFlowSource=!1}initialize(){const e=this._view,i=e.stage,r=i.renderer.fboCache,{waterTextures:s,techniques:n}=i.renderView;this._renderContext=new AIe(this._rctx,new tse(r,e.state.viewingMode),n),this.addHandles([K(()=>s.updating,()=>this.events.emit("content-changed"),At),K(()=>this._spatialReference,l=>this._localOriginFactory=new MIe(l),At),Ys(()=>e.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=!0),K(()=>k2t(e.state.highlights),()=>this._sortedDrapeSourceRenderersDirty=!0,Wt),K(()=>e.state.highlights,l=>{this._bindParameters.highlights=l,this._bindParameters.highlightOrderMap=e.state.highlightOrderMap},Wt),e.resourceController.scheduler.registerTask(yt.OVERLAY_RENDERER,this)]);const{_bindParameters:a,_camera:o}=this;o.near=1,o.far=1e4,o.relativeElevation=null,a.slot=18,a.mainDepth=null,a.camera=o,a.oitPass=0,a.updateLighting([new wie(Jb())],0,0,0)}destroy(){this._renderers.forEach(e=>e.destroy()),this._renderers.clear(),this._passParameters.texture=Rt(this._passParameters.texture),this.disposeOverlays(),this._renderContext=null,this._sortedRenderers.prune()}get _bindParameters(){return this._renderContext.bind}get _rctx(){return this._stage.renderView.renderingContext}get _view(){return this.parent.view}get _stage(){return this.parent.view.stage}get _spatialReference(){return this.parent.spatialReference}get _techniques(){return this._stage.renderView.techniques}get rctx(){return this._rctx}get materials(){return this._pluginContext.materials}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}get pluginContext(){return this._pluginContext}initializeRenderContext(e){const i=new pIe(this._view.stage.renderView.textures,this._techniques,()=>{this._onMaterialOrContentChanged(),this.events.emit("content-changed"),this.notifyChange("updating"),this.notifyChange("isEmpty")},()=>this.events.emit("content-changed"));this._pluginContext={...e,materials:i},this._techniques.precompile(x0e)}uninitializeRenderContext(){}acquireTechniques(){return[]}render(){}get updating(){return this._sortedDrapeSourceRenderersDirty||Qd(this._renderers,e=>e.updating||e.canCompact)}get hasOverlays(){return this._overlays!=null&&this._renderTargets!=null}getMaterialRenderer(e){for(const i of this._renderers.values()){const r=i.getMaterialRenderer(e);if(r)return r}return null}get layers(){return this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers(),q3(this._sortedRenderers.map(e=>e.drapeSource.layer).filter(e=>!!e))}registerDrapeSource(e,i){const r=this._renderers.get(e);r?.destroy(),this._renderers.set(e,i),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this.addHandles(K(()=>e.fullOpacity,()=>this.events.emit("content-changed")),e)}removeDrapeSourceRenderer(e){if(e==null)return;const i=this._renderers.get(e);i!=null&&(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(e),this.removeHandles(e),i.destroy())}computeValidity(){return this._renderTargets?.computeValidity()??0}releaseRenderTargets(e){this._renderTargets?.dispose(e)}get overlays(){return this._overlays??[]}ensureDrapeTargets(e){this._hasTargetWithoutRasterImage=!!this._overlays&&a3(e,i=>i.drapeTargetType===1)}ensureDrapeSources(e){this._overlays?(this._hasDrapedFeatureSource=a3(e,i=>i.drapeSourceType===1),this._hasDrapedRasterSource=a3(e,i=>i.drapeSourceType===0),this._hasDrapedFlowSource=a3(e,i=>i.drapeSourceType===2)):this._hasDrapedFeatureSource=this._hasDrapedRasterSource=this._hasDrapedFlowSource=!1}get _needsColorWithoutRasterImage(){return this._hasDrapedRasterSource&&this._hasDrapedFeatureSource&&this._hasTargetWithoutRasterImage}ensureOverlays(e,i,r=this._bindParameters.overlayStretch){this._overlays==null&&(this._renderTargets=new C2t(this._stage.renderer.fboCache),this._overlays=[new Hye,new Hye]),this.ensureDrapeTargets(e),this.ensureDrapeSources(i),this._bindParameters.overlayStretch=r}disposeOverlays(){this._overlays=null,this._renderTargets?.dispose(1),this._renderTargets=null,this.events.emit("textures-disposed")}_useOverlayColorInsteadOfColorNoRasterImage(e){return e===1&&!this._needsColorWithoutRasterImage&&this._hasDrapedFeatureSource}getTexture(e){const i=this._useOverlayColorInsteadOfColorNoRasterImage(e);return this._renderTargets?.getTexture(i?0:e)}get readyToRun(){return this.updating}runTask(e){this._processDrapeSources(e,()=>!0)}_onMaterialOrContentChanged(){this.renderOccludedFlags=Qd(this._renderers,e=>e.hasOccluders)?dR:1}_processDrapeSources(e,i){let r=!1;for(const[s,n]of this._renderers){if(e.done)break;(s.destroyed||i(s))&&n.commitChanges()&&(r=!0,e.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,r=!0,this._updateSortedDrapeSourceRenderers(),e.madeProgress()),this.compact(e),r&&(this._overlays!=null&&this._renderers.size===0&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this._onMaterialOrContentChanged(),this.hasHighlights=Qd(this._renderers,s=>s.hasHighlights),this.events.emit("content-changed"))}compact(e){let i=!1;for(const r of this._renderers.values()){if(e.done)break;i=r.compact(e)||i}return i&&this.notifyChange("updating"),i}hasHighlight(e){return Qd(this._renderers,i=>i.hasHighlight(e))}processSyncDrapeSources(){this._processDrapeSources(sl,e=>e.updatePolicy===1)}get isEmpty(){return!Ws.OVERLAY_DRAW_DEBUG_TEXTURE&&aW(this._renderers,e=>e.isEmpty)}get hasWater(){const e=Qd(this._renderers,({hasWater:i})=>i);return e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water")),this._hasWater}renders(e){if(Ws.OVERLAY_DRAW_DEBUG_TEXTURE&&e!==4&&e!==2)return!0;if(!this._overlays)return!1;const i=this._overlays[0];for(const n of this._overlays)n.setupGeometryViews(this.longitudeCyclical);if(!i.hasSomeSizedView())return!1;const r=this._renderContext.output;this._renderContext.output=this._renderTargets?.targets.find(n=>n.content===e)?.output??0,++this._techniques.precompiling;const s=this._sortedRenderers.some(({renderer:n})=>n.precompile(this._renderContext));return--this._techniques.precompiling,this._renderContext.output=r,s}get mode(){return this.isEmpty?0:this.hasWater&&this.renders(3)?2:this._renderTargets?.getTexture(0)?1:0}updateAnimation(e){let i=!1;return this._renderers.forEach(r=>i=r.updateAnimation(e)||i),i&&this.parent.requestRender(0),i}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}precompileShaders(e){if(!this._overlays||!this._renderTargets)return!1;const i=this._bindParameters;i.alignPixelEnabled=e.alignPixelEnabled,++this._techniques.precompiling;for(const r of this._renderTargets.targets){if(r.content===1&&!this._needsColorWithoutRasterImage)continue;const{output:s}=r;this._renderContext.output=s,i.slot=s===3?19:18,s===9&&(i.highlightMixTexture=i.highlights.length>1?this._rctx.emptyTexture:null);const n=this._renderContext.renderOccludedMask;r.content===4&&(this._renderContext.renderOccludedMask=dR),this._sortedRenderers.forAll(({drapeSource:a,renderer:o})=>{r.content===1&&a.drapeSourceType===0||r.content===4&&o.hasOnlyOccluders||o.precompile(this._renderContext)}),this._renderContext.renderOccludedMask=n,i.highlightMixTexture=null}return--this._techniques.precompiling,!0}drawOverlays(e,i){if(!this._overlays||!this._renderTargets)return;for(const s of this._overlays)s.setupGeometryViews(this.longitudeCyclical);this._bindParameters.alignPixelEnabled=e.alignPixelEnabled;const r=this.allSourcesOccluders;for(const s of this._renderTargets.targets){if(!(s.content===0&&this._hasDrapedFlowSource)&&!s.handleRenderRequest(i)||s.content===1&&!this._needsColorWithoutRasterImage||s.content===4&&r)continue;const n=this._drawTarget(0,s),a=this._drawTarget(1,s);(n||a)&&s.fbo.generateMipMap()}}_drawTarget(e,i){const r=this._overlays[e],s=r.canvasGeometries;if(s.numViews===0)return!1;const n=this._view.state.contentPixelRatio;this._screenToWorldRatio=n*r.mapUnitsPerPixel/this._bindParameters.overlayStretch;const{output:a}=i;if(this.isEmpty||a===3&&!this.hasWater||!r.hasSomeSizedView())return!1;const{_rctx:o,_camera:l,_renderContext:c,_bindParameters:h}=this;if(l.pixelRatio=r.pixelRatio*n,c.output=a,h.screenToWorldRatio=this._screenToWorldRatio,h.screenToPCSRatio=this._screenToWorldRatio*this.parent.worldToPCSRatio,h.slot=a===3?19:18,i.content===4&&(c.renderOccludedMask=dR),!this.renders(i.content))return c.renderOccludedMask=CD,!1;const{resolution:f}=r,y=e===0,_=y?0:f;if(o.setViewport(_,0,f,f),this._bindTargetFBO(i),y)if(i.output!==9)o.setClearColor(0,0,0,0),o.clear(16384);else{const{gl:w}=o;w.clearBufferuiv(w.COLOR,0,[0,0,0,0])}if(Ws.OVERLAY_DRAW_DEBUG_TEXTURE&&i.content!==4&&i.content!==2){this._techniques.precompile(w0e,FX);const w=this._techniques.get(w0e,FX);for(let x=0;x<s.numViews;x++)this._setViewParameters(s.extents[x],r),this._ensureDebugPatternResources(r.resolution,FSt[e]),o.bindTechnique(w,h,this._passParameters),o.screen.draw()}if(i.output===9){const{fboCache:w}=this._stage.renderer,x=this._resolution;this._bindTargetFBO(i),dIe(o,w,{width:x,height:x},h,()=>this._renderAllGeometry(e,i),_)}else this._renderAllGeometry(e,i);return o.bindFramebuffer(null),c.renderOccludedMask=CD,!0}get allSourcesOccluders(){return aW(this._renderers,e=>e.hasOnlyOccluders)}_renderAllGeometry(e,i){const r=this._overlays[e],s=r.canvasGeometries;this._sortedRenderers.forAll(({drapeSource:n,renderer:a})=>{if(i.content===1&&n.drapeSourceType===0)return;const{fullOpacity:o}=n,l=o!=null&&o<1&&i.output===0&&this._bindTemporaryFBO();for(let c=0;c<s.numViews;c++)this._setViewParameters(s.extents[c],r),a.render(this._renderContext);if(l){this._bindTargetFBO(i),this._overlayParameters.texture=l.getTexture(),this._overlayParameters.opacity=o,this._overlayParameters.overlayIndex=e;const c=this._techniques.get(x0e);this._rctx.bindTechnique(c,this._bindParameters,this._overlayParameters),this._rctx.screen.draw(),l.release()}})}_bindTargetFBO(e){const i=this._resolution,r=2*i;e.fbo.ensureFramebuffer(r,i),e.fbo.bind(this._rctx)}_bindTemporaryFBO(){const e=this._resolution,i=2*e,r=this._stage.renderer.fboCache,s=r.acquire(i,e,"overlay tmp");return r.rctx.bindFramebuffer(s.fbo),r.rctx.clear(16384),s}get _resolution(){return this._overlays?.[0].resolution??0}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,i,r,s){this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers();let n=0;for(const{renderer:a}of this._sortedRenderers)n=a.intersect?.(e,i,r,s,n)??n}_updateSortedDrapeSourceRenderers(){if(this._sortedRenderers.clear(),this._renderers.size===0)return;const e=this._view.map.allLayers.map(r=>r.uid),i=e.length;this._renderers.forEach((r,s)=>{const n=e.indexOf(s.layer?.uid),a=n>=0,o=s.renderGroup??(a?0:1),l=s.drapeSourcePriorityOffset??0,c=i*o+(a?n:0)+l;this._sortedRenderers.push(new zSt(s,r,c))}),this._sortedRenderers.sort((r,s)=>r.index-s.index)}_setViewParameters(e,i){const r=this._camera;r.viewport=[0,0,i.resolution,i.resolution],c3e(r.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],r.near,r.far),LU(r.viewMatrix,[-e[0],-e[1],0])}_ensureDebugPatternResources(e,i){if(ve(this._passParameters.color,i[0],i[1],i[2]),this._passParameters.texture)return;const r=new Uint8Array(e*e*4);let s=0;for(let a=0;a<e;a++)for(let o=0;o<e;o++){const l=Math.floor(o/10),c=Math.floor(a/10);l<2||c<2||10*l>e-20||10*c>e-20?(r[s++]=255,r[s++]=255,r[s++]=255,r[s++]=255):(r[s++]=255,r[s++]=255,r[s++]=255,r[s++]=1&l&&1&c?1&o^1&a?0:255:1&l^1&c?0:128)}const n=new Zi(e);n.samplingMode=9728,this._passParameters.texture=new Fi(this._rctx,n,r)}get test(){}};d([m()],hf.prototype,"hasHighlights",void 0),d([m()],hf.prototype,"renderOccludedFlags",void 0),d([m()],hf.prototype,"_sortedDrapeSourceRenderersDirty",void 0),d([m({constructOnly:!0})],hf.prototype,"parent",void 0),d([m({readOnly:!0})],hf.prototype,"_techniques",null),d([m({type:Boolean,readOnly:!0})],hf.prototype,"updating",null),d([m()],hf.prototype,"isEmpty",null),hf=d([k("esri.views.3d.terrain.OverlayRenderer")],hf);let zSt=class{constructor(e,i,r){this.drapeSource=e,this.renderer=i,this.index=r}};const FSt=[[1,.5,.5],[.5,.5,1]],mJt=-2,dR=4,FX=new OIe;FX.hasAlpha=!0;let NX=class{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}clear(){this.adds.length=0,this.removes.length=0,this.updates.length=0}prune(){this.clear()}get empty(){return this.adds.length===0&&this.removes.length===0&&this.updates.length===0}},NSt=class{},VSt=class{constructor(e){this.pending=e,this.adds=new Array,this.removes=new Array,this.updates=new Array}clearAddsAndRemoves(){this.adds.forEach(e=>Ul(this.pending.adds,e)),this.removes.forEach(e=>Ul(this.pending.removes,e)),this.adds.length=0,this.removes.length=0}clearUpdates(){this.updates.forEach(e=>Ul(this.pending.updates,e)),this.updates.length=0}clear(){this.clearUpdates(),this.clearAddsAndRemoves()}};function USt(t){const e=new Map,i=r=>{let s=e.get(r);return s||(s=new VSt(t),e.set(r,s)),s};return t.removes.forEach(r=>{EG(r)&&i(r.material).removes.push(r)}),t.adds.forEach(r=>{EG(r)&&i(r.material).adds.push(r)}),t.updates.forEach(r=>{EG(r.renderGeometry)&&i(r.renderGeometry.material).updates.push(r)}),e}function EG(t){return t.geometry.indexCount>=1}let rse=class{constructor(e=0,i=0){this.from=e,this.to=i}get numElements(){return this.to-this.from}};function S0e(t){if(t.length<2)return;const e=new Map;t.forAll(r=>e.set(r.from,r));let i=!0;for(;i;){i=!1;for(let r=0;r<t.length;++r){const s=t.data[r],n=e.get(s.to);n&&(s.to=n.to,e.delete(n.from),t.removeUnordered(n),i=!0)}}}let T0e=class extends rse{constructor(e,i,r,s){super(i,r),this.geometry=e,this._highlightName=null,this.updateHighlightOptions(s)}updateHighlightOptions(e){const{geometry:i}=this;if(!i.hasHighlights)return void(this._highlightName=null);let r=-1,s=null;i.foreachHighlightOptions(n=>{const a=e.get(n)??-1;a>r&&(r=a,s=n)}),this._highlightName=s}get highlightName(){return this._highlightName}get isVisible(){return this.geometry.visible}get hasHighlights(){return this.isVisible&&this.geometry.hasHighlights}get hasOccludees(){return this.geometry.occludees!=null}},BSt=class{constructor(e){this.baseInstanceData=e,this.dataByOrigin=new Map}get id(){return this.baseInstanceData?.baseInstance.id??EP}dispose(){for(const e of this.dataByOrigin.values())e.dispose();this.dataByOrigin.clear(),this.baseInstanceData?.dispose()}},jSt=class{constructor(e,i,r){this.baseInstance=e,this.baseInstanceBuffer=i,this.baseCommand=r}dispose(){this.baseInstanceBuffer.dispose()}},RIe=class{constructor(){this.first=0,this.count=0}},qSt=class{constructor(e,i){this.vao=e,this.instanceCount=i}dispose(){this.vao.disposeVAOOnly()}},GSt=class{constructor(){this.commandVAOs=new tm,this.drawCommandsDefault=new Array,this.drawCommandsHighlights=new Map,this.drawCommandsOccludees=new Array,this.drawCommandsShadowHighlightRest=new Array}clear(){this.commandVAOs.clear(),this.drawCommandsDefault.length=0,this.drawCommandsHighlights.clear(),this.drawCommandsOccludees.length=0,this.drawCommandsShadowHighlightRest.length=0}dispose(){for(const e of this.commandVAOs.values())e.dispose();this.clear()}},$0e=class{constructor(e){this.targetBuffer=e,this.vaoEndElement=0,this._numElements=0,this._instances=new Map,this.holes=new _i({allocator:i=>i||new rse,deallocator:null}),this.hasHiddenInstances=!1,this.hasOccludees=!1,this.drawCommandsDirty=!0,this.highlightNames=new Set,this.drawCommandsDefault=XL(),this.drawCommandsHighlights=new Map,this.drawCommandsOccludees=XL(),this.drawCommandsShadowHighlightRest=XL(),this._instancedCommandVAOs=null}get numElements(){return this._numElements}get instances(){return this._instances}get writeableInstances(){return this._instances}get hasHighlights(){return this.highlightNames.size>0}get instancedCommandVAOs(){return this._instancedCommandVAOs}resetInstanceSummary(){this.hasHiddenInstances=!1,this.hasOccludees=!1,this.highlightNames.clear()}updateIfDrawCommandsDirty(e){if(this.drawCommandsDirty){this.resetInstanceSummary();for(const i of this.instances.values())this.updateDrawState(i);this.updateDrawCommands(e)}}addInstance(e,i){this.deleteInstance(e),this._instances.set(e,i),this._numElements+=i.numElements}deleteInstance(e){const i=this._instances.get(e);i&&(this._numElements-=i.numElements,this._instances.delete(e))}updateInstances(){let e=0;for(const i of this._instances.values())e+=i.numElements,this.updateDrawState(i);this._numElements=e}updateDrawState(e){if(e.isVisible){const{highlightName:i}=e;i&&this.highlightNames.add(i),e.hasOccludees&&(this.hasOccludees=!0)}else this.hasHiddenInstances=!0}updateDrawCommands(e){this._updateDrawCommands(e),this._updateInstancedCommandVAOs()}_updateDrawCommands(e){if(this.drawCommandsDefault.clear(),this.drawCommandsOccludees.clear(),this.drawCommandsDirty=!1,this._instances.size===0)return;const{sortedInstances:i}=this;if(this._updateHighlightDrawCommands(e,i),!this.needsMultipleCommands){const r=this.drawCommandsDefault.pushNew(),s=this.holes.front();return this.vao&&this.holes.length===1&&s.to===this.vaoEndElement?(r.first=0,void(r.count=s.from)):(r.first=1/0,r.count=0,this._instances.forEach(n=>{r.first=Math.min(r.first,n.from),r.count=Math.max(r.count,n.to)}),void(r.count-=r.first))}for(const r of i)r.isVisible&&AG(r.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,r)}get sortedInstances(){return Array.from(this._instances.values()).sort((e,i)=>e.from===i.from?e.to-i.to:e.from-i.from)}updateHighlights(e){this.highlightNames.clear();const i=this.sortedInstances;for(const r of i)r.updateHighlightOptions(e),r.isVisible&&r.highlightName&&this.highlightNames.add(r.highlightName);this._updateHighlightDrawCommands(e),this._updateInstancedCommandVAOs()}_updateHighlightDrawCommands(e,i=this.sortedInstances){const{drawCommandsHighlights:r,drawCommandsShadowHighlightRest:s}=this;r.clear(),s.clear();for(const n of i){if(n.updateHighlightOptions(e),!n.isVisible)continue;const{highlightName:a}=n;a&&(this.highlightNames.add(a),AG(Cu(r,a,XL),n)),a&&a===Tp||AG(s,n)}}_updateInstancedCommandVAOs(){const e=this.vao;if(this.targetBuffer==="geometry"||e==null)return;this._instancedCommandVAOs??=new GSt;const i=this._instancedCommandVAOs,r=i.commandVAOs.copy();i.clear();const s=i.commandVAOs,n=(a,o)=>{for(const l of a){const{first:c,count:h}=l,f=s.get(c,h)??r.pop(c,h)??new qSt(e.shallowCloneWithBaseInstances(new Map([["instances",l.first]])),l.count);s.set(c,h,f),o.push(f)}};n(this.drawCommandsDefault,i.drawCommandsDefault);for(const[a,o]of this.drawCommandsHighlights){const l=new Array;n(o,l),i.drawCommandsHighlights.set(a,l)}n(this.drawCommandsOccludees,i.drawCommandsOccludees),n(this.drawCommandsShadowHighlightRest,i.drawCommandsShadowHighlightRest);for(const a of r.values())a.dispose();r.clear()}get needsMultipleCommands(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances}};function HSt(t){return t.vao!=null}function C0e(t){return t?"instances":"geometry"}function XL(){return new _i({allocator:t=>t||new RIe,deallocator:t=>t})}function AG(t,e){const i=t.back();if(i==null){const r=t.pushNew();return r.first=e.from,void(r.count=e.numElements)}if(WSt(i,e)){const r=e.from-i.first+e.numElements;i.count=r}else{const r=t.pushNew();r.first=e.from,r.count=e.numElements}}function WSt(t,e){return t.first+t.count>=e.from}let ZSt=class{constructor(e,i){this.origin=e,this.isInstanced=i,this.buffers=new Array}dispose(){if(this.isInstanced)for(const e of this.buffers)e.vao.buffer("instances")?.dispose(),e.vao.disposeVAOOnly(),e.instancedCommandVAOs?.dispose();else for(const e of this.buffers)e.vao.dispose();this.buffers.length=0}findBuffer(e){return this.buffers.find(i=>i.instances.has(e))}},M0e=class{constructor(e,i){this._rctx=i,this._bufferWriter=e.createBufferWriter(),this._vaoCache=i.getVaoCache(Lo(this._bufferWriter.layout))}maxElements(e){return Math.floor(PG/this._targetStrideFloats(e))}_targetStrideFloats(e){return this._targetStrideBytes(e)/4}_targetStrideBytes(e){return this._targetLayout(e)?.stride??0}_targetLayout(e){return e==="geometry"?this._bufferWriter.layout:this._bufferWriter.instanceLayout}endElement(e){return Math.floor((e.vao?.getByteLength(e.targetBuffer)??0)/this._targetStrideBytes(e.targetBuffer))}evaluateBufferAllocation(e,i,r,s){const n=this._targetStrideFloats(s.targetBuffer),a=i.reduce((f,{geometry:y})=>f+this.elementCount(y),0),o=r.reduce((f,{geometry:y})=>f+this.elementCount(y),0),l=Math.min((e+a-o)*n,PG),c=s.vao?.buffer(s.targetBuffer),h=(c?.sizeBytes??0)/4;return l>pR&&l<h/2?0:l>h?1:2}deleteBuffer(e){if(e.targetBuffer==="instances")return e.instancedCommandVAOs?.dispose(),e.vao?.buffer("instances")?.dispose(),e.vao?.disposeVAOOnly(),void(e.vao=null);this._vaoCache.deleteVao(e.vao)}createBaseInstanceData(e){const{_bufferWriter:i}=this;if(e==null||i.writeBaseInstance==null||i.elementCountBaseInstance==null)return null;const r=i.layout,s=i.elementCountBaseInstance(e.attributes),n=s*this._targetStrideFloats("geometry"),a=new Hs(this._rctx,Lo(r));a.setSize(Math.ceil(4*n));const o=U1(n),l=r.createView(o.buffer);i.writeBaseInstance(e.attributes,l),a.setSubData(o,0,0,n);const c=new RIe;return c.first=0,c.count=s,new jSt(e,a,c)}_allocateInstanceBuffer(e){const i=this._bufferWriter.instanceLayout;dt(i!=null,"Trying to allocate an instance buffer, but the BufferWriter does not support instancing");const r=e*this._targetStrideFloats("instances"),s=new Hs(this._rctx,Lo(i,1));return s.setSize(RG(r)),s}_createInstancedVao(e,i){return new Op(this._rctx,new Map([["geometry",e],["instances",i]]))}reallocateBuffer(e,i,r){if(this.deleteBuffer(i),e!=null){const n=e.baseInstanceBuffer,a=this._allocateInstanceBuffer(r);return this._createInstancedVao(n,a)}const s=r*this._targetStrideFloats("geometry");return this._vaoCache.newVao(RG(s))}elementCount(e){return this._bufferWriter.elementCount(e.attributes)}canGrow(e,i){const{targetBuffer:r,vao:s}=e;if(s==null)return!0;const n=4*(i*this._targetStrideFloats(r));return s.getByteLength(r)<RG(PG-pR)&&n>s.getByteLength(r)}clearHoles(e,{vao:i,targetBuffer:r}){const s=this._targetStrideFloats(r),n=e.reduce((l,c)=>Math.max(l,c.numElements),0)*s,a=U1(n);a.fill(0,0,n);const o=i.buffer(r);for(const l of e)o?.setSubData(a,l.from*s,0,l.numElements*s)}clearHolesMetal(e,i,r,{vao:s,targetBuffer:n}){const a=this._targetStrideFloats(n),o=(r-i)*a,l=U1(o),c=this._targetLayout(n).createView(l.buffer);l.fill(0,0,o);for(const h of e){if(!(h.from>=i&&h.to<=r))continue;const f=h.from-i;this._writeGeometry(h.geometry,c,f)}s.buffer(n)?.setSubData(l,i*a,0,o)}writeRandomInstances(e,i,{vao:r,targetBuffer:s}){const n=this._targetStrideFloats(s),a=U1(e*n),o=this._targetLayout(s).createView(a.buffer);let l=0,c=0,h=0;const f=r.buffer(s);for(const _ of i){if(h!==_.from){const w=h-c;w>0&&f?.setSubData(a,c*n,0,w*n),c=_.from,l=0}this._writeGeometry(_.geometry,o,l),l+=_.numElements,h=_.to}const y=h-c;y>0&&f?.setSubData(a,c*n,0,y*n)}writeInstanceRangeMetal(e,i,r,{vao:s,targetBuffer:n}){const a=this._targetStrideFloats(n),o=e-i,l=o*a,c=U1(l),h=this._targetLayout(n).createView(c.buffer);c.fill(0,0,l);for(const f of r){if(!(f.from>=i&&f.to<=e))continue;const y=f.from-i;this._writeGeometry(f.geometry,h,y)}o>0&&s.buffer(n)?.setSubData(c,i*a,0,l)}rebuildInstances(e,i,{vao:r,targetBuffer:s}){const n=this._targetStrideFloats(s),a=U1(e*n),o=this._targetLayout(s).createView(a.buffer);let l=0;for(const c of i){this._writeGeometry(c.geometry,o,l);const h=l;l+=this.elementCount(c.geometry.geometry),c.from=h,c.to=l}return r?.buffer(s)?.setSubData(a,0,0,l*n),l}updateInstance(e,{vao:i,targetBuffer:r}){const{_bufferWriter:s}=this,n=this._targetStrideFloats(r),a=U1(s.elementCount(e.geometry.geometry.attributes)*n),o=this._targetLayout(r).createView(a.buffer);this._writeGeometry(e.geometry,o,0),i.buffer(r)?.setSubData(a,e.from*n,0,e.numElements*n)}updateInstancesMetal(e){for(const[i,r]of e){let s=1/0,n=-1/0;for(const a of r)s=Math.min(s,a.from),n=Math.max(n,a.to);this.writeInstanceRangeMetal(n,s,i.instances.values(),i)}}_writeGeometry(e,i,r){const{_bufferWriter:s}=this;s!=null&&(pn(BS,e.transformation),BS[12]-=e.localOrigin.vec3[0],BS[13]-=e.localOrigin.vec3[1],BS[14]-=e.localOrigin.vec3[2],nl(JL,BS),Ql(JL,JL),s.write(BS,JL,e.geometry.attributes,e.geometry.olidColor,i,r))}static prune(){OF=new Float32Array(pR)}};const BS=it(),JL=it(),pR=65536,OG=4*pR,E0e=1024,DIe=16777216,PG=DIe/4;let OF=new Float32Array(pR);function U1(t){return OF.length<t&&(OF=new Float32Array(t)),OF}function RG(t){const e=4*t;return e<=E0e?E0e:e<OG?Nje(e):Math.max(Math.min(Math.ceil(1.5*e/OG)*OG,DIe),e)}let Gb=class extends Me{constructor(e){super(e),this._vaoWriter=null,this._useMetalWorkaround=!1,this._hasOccludees=!1}destroy(){this.uninitializeRenderContext()}initializeRenderContext(e){this._useMetalWorkaround=e.renderContext.rctx.isAssumedMetalDriver,this._vaoWriter=new M0e(this.material,e.renderContext.rctx)}uninitializeRenderContext(){this._useMetalWorkaround=!1,this._vaoWriter=null}get hasOccludees(){return this._hasOccludees}modify(e,i){this._applyUpdates(e,i),this._applyAddsAndRemoves(e),this._updateDrawCommands()}get canCompact(){for(const e of this.dataByBaseInstance.values())for(const i of e.dataByOrigin.values())if(i.buffers.some(r=>r.holes.length>1))return!0;return!1}compact(e){if(!this.canCompact)return!1;let i=!1;for(const r of this.dataByBaseInstance.values())for(const s of r.dataByOrigin.values()){const n=new Array;for(let a=0;a<s.buffers.length&&!e.done;){const o=s.buffers[a];o.holes.length<=1?++a:(o.instances.forEach(({geometry:l})=>n.push(l)),this._vaoWriter?.deleteBuffer(o),Ul(s.buffers,o,void 0,{last:a}),e.madeProgress())}if(n.length>0){const{baseInstanceData:a}=r;s.buffers.forEach(l=>this._applyAdds(a,l,n));const o=C0e(a!=null);for(;n.length>0;)s.buffers.push(this._applyAndRebuild(a,new $0e(o),n,null));i=!0}}return i}updateHighlights(e){this.highlightOrderMap=e;for(const i of this.dataByBaseInstance.values())for(const r of i.dataByOrigin.values())for(const s of r.buffers)s.updateHighlights(e)}_applyUpdates(e,i){const r=this._vaoWriter;if(r==null)return void e.clearUpdates();let s;const n=this._useMetalWorkaround?(a,o)=>{s??=new Map;let l=s.get(o);l||(l=[],s.set(o,l)),l.push(a)}:(a,o)=>r.updateInstance(a,o);for(const a of e.updates){if(i.done)return;const{renderGeometry:o,updateType:l}=a;Ul(e.pending.updates,a),i.madeProgress();const c=this.dataByBaseInstance.get(o.geometry.baseGeometry?.id??EP),h=c?.dataByOrigin.get(o.localOrigin.id)?.findBuffer(o.id);if(h==null)return;const f=h.instances.get(o.id);6&l&&n(f,h),25&l&&(h.drawCommandsDirty=!0)}s&&r.updateInstancesMetal(s)}_computeDeltas(e,i){const r=new Map;for(const s of e){const n=s.localOrigin;if(n==null)continue;const a=s.geometry.baseGeometry,o=Cu(r,a??null,O0e);let l=o.get(n,null);l==null&&(l=new A0e(n.vec3,a),o.set(n,null,l)),l.changes.push(s)}for(const s of i){const n=s.localOrigin;if(n==null)continue;const a=s.geometry.baseGeometry,o=this.dataByBaseInstance.get(a?.id??EP),l=o?.dataByOrigin.get(n.id)?.findBuffer(s.id);if(l==null)continue;const c=Cu(r,a??null,O0e);let h=c.get(n,l);h==null&&(h=new A0e(n.vec3,a),c.set(n,l,h)),h.changes.push(s)}return r}_applyAddsAndRemoves(e){const{_vaoWriter:i,dataByBaseInstance:r}=this;if(i==null)return void e.clearAddsAndRemoves();const s=this._computeDeltas(e.adds,e.removes);for(const[n,a]of s){const o=Cu(r,n?.id??EP,()=>new BSt(i.createBaseInstanceData(n))),l=n!=null;for(const[c,h]of a.outerMap()){const f=h.get(null),y=f?.changes??[];a.delete(c,null);const _=Cu(o.dataByOrigin,c.id,()=>new ZSt(c.vec3,l));for(const[w,x]of h){if(a.delete(c,w),w==null&&dt(!1,"No VAO for removed geometries"),w.instances.size===x.changes.length){i.deleteBuffer(w),Ul(_.buffers,w),_.buffers.length===0&&y.length===0&&o.dataByOrigin.delete(c.id);continue}const S=w.numElements;switch(i.evaluateBufferAllocation(S,y,x.changes,w)){case 0:x.changes.forEach(({id:$})=>w.deleteInstance($)),w.instances.forEach(({geometry:$})=>y.push($)),i.deleteBuffer(w),Ul(_.buffers,w);break;case 1:this._applyAndRebuild(o.baseInstanceData,w,y,x);break;case 2:this._applyRemoves(w,x)}}if(y.length>0){const{baseInstanceData:w}=o,x=C0e(l);for(const S of _.buffers)this._applyAdds(w,S,y);for(;y.length>0;)_.buffers.push(this._applyAndRebuild(w,new $0e(x),y,null))}}o.dataByOrigin.size===0&&(o.dispose(),r.delete(o.id))}e.clearAddsAndRemoves()}_updateDrawCommands(){this._hasOccludees=!1;for(const e of this.dataByBaseInstance.values())for(const i of e.dataByOrigin.values())for(const r of i.buffers)r.updateIfDrawCommandsDirty(this.highlightOrderMap),this._hasOccludees||=r.hasOccludees}_applyAndRebuild(e,i,r,s){if(s)for(const h of s.changes)i.deleteInstance(h.id);const n=this._vaoWriter,a=n.maxElements(i.targetBuffer);let o=i.numElements;for(;r.length>0;){const h=r.pop(),f=n.elementCount(h.geometry);if(o+f>a&&o>0){r.push(h);break}o+=f;const y=new T0e(h,0,0,this.highlightOrderMap);dt(i.instances.get(h.id)==null),i.addInstance(h.id,y)}i.resetInstanceSummary(),i.vao=n.reallocateBuffer(e,i,o),i.vaoEndElement=n.endElement(i);const l=n.rebuildInstances(o,i.writeableInstances.values(),i);i.updateInstances(),i.holes.clear();const c=i.holes.pushNew();return c.from=l,c.to=i.vaoEndElement,i.updateDrawCommands(this.highlightOrderMap),i}_applyRemoves(e,i){const{_vaoWriter:r}=this;if(i.changes.length===0||r==null)return;let s=1/0,n=-1/0;for(const a of i.changes){const o=a.id,l=e.instances.get(o);if(!l)continue;e.deleteInstance(o),this._useMetalWorkaround&&(s=Math.min(s,l.from),n=Math.max(n,l.to));const c=Vm.back();if(c){if(c.to===l.from){c.to=l.to;continue}if(c.from===l.to){c.from=l.from;continue}}const h=Vm.pushNew();h.from=l.from,h.to=l.to}S0e(Vm),this._useMetalWorkaround?r.clearHolesMetal(e.instances.values(),s,n,e):r.clearHoles(Vm,e),e.holes.pushArray(Vm.data,Vm.length),Vm.forAll((a,o)=>Vm.data[o]=null),Vm.clear(),e.drawCommandsDirty=!0}_applyAdds(e,i,r){if(r.length===0||this._vaoWriter==null)return;if(!HSt(i))return void this._applyAndRebuild(e,i,r,null);const s=this._vaoWriter,n=i.numElements,a=r.reduce((y,{geometry:_})=>y+s.elementCount(_),0),o=Math.min(n+a,s.maxElements(i.targetBuffer));if(s.canGrow(i,o))return void this._applyAndRebuild(e,i,r,null);S0e(i.holes);const l=new Array;let c=1/0,h=-1/0;for(const{geometry:y}of r){const _=s.elementCount(y),w=YSt(i.holes,_);l.push(w),this._useMetalWorkaround&&w!=null&&(c=Math.min(w,c),h=Math.max(w+_,h))}const f=this._addInstances(r,i,l);if(this._useMetalWorkaround){for(const y of f);s.writeInstanceRangeMetal(h,c,i.instances.values(),i)}else s.writeRandomInstances(o,f,i);YV(r,(y,_)=>l[_]==null)}*_addInstances(e,i,r){const s=e.length,n=this._vaoWriter;for(let a=0;a<s;++a){const o=r[a];if(o==null)continue;const l=e[a],c=n.elementCount(l.geometry),h=new T0e(l,o,o+c,this.highlightOrderMap);dt(i.instances.get(l.id)==null),i.addInstance(l.id,h),i.drawCommandsDirty=!0,yield h}}static prune(){M0e.prune()}};d([m({constructOnly:!0})],Gb.prototype,"dataByBaseInstance",void 0),d([m({constructOnly:!0})],Gb.prototype,"material",void 0),d([m()],Gb.prototype,"highlightOrderMap",void 0),Gb=d([k("esri.views.3d.webgl-engine.materials.renderers.MergedBuffer")],Gb);let A0e=class{constructor(e,i){this.origin=e,this.baseInstance=i,this.changes=new Array}};function YSt(t,e){const i=t.find(s=>s.numElements>=e);if(i==null)return null;const r=i.from;return i.from+=e,i.from>=i.to&&t.removeUnordered(i),r}const Vm=new _i({allocator:t=>t||new rse,deallocator:null});function O0e(){return new tm}let QSt=class{constructor(e,i){this._material=e,this._repository=i,this._map=new Map}dispose(){this._map.forEach((e,i)=>{e!=null&&this._repository.release(this._material,i)})}load(e,i,r){if(!this._material.produces.get(i)?.(r))return null;this._map.has(r)||this._map.set(r,this._repository.acquire(this._material,i,r));const n=this._map.get(r);if(n){if(n.ensureResources(e)===2)return n;this._repository.requestRender()}return null}},IIe=class extends rDe{constructor(e=R()){super(),this.origin=e}get slicePlaneLocalOrigin(){return this.origin}},QO=class extends Me{constructor(e){super(e),this._glMaterials=null,this._drawParameters=new IIe,this._highlightNames=new Set,this._produces=new Map}initialize(){this._updateProduces()}destroy(){this.uninitializeRenderContext()}get _hasHighlights(){return this._highlightNames.size>0}hasHighlight(e){return this._highlightNames.has(e)}get produces(){return this._produces}_updateProduces(){this.material.produces.forEach((e,i)=>{this._produces.set(i,r=>!(this.dataByBaseInstance.size===0||!(r!==9&&r!==5||this._hasHighlights))&&e(r))})}initializeRenderContext(e){this._glMaterials=new QSt(this.material,e.materials)}uninitializeRenderContext(){this._glMaterials=Rt(this._glMaterials)}acquireTechniques(e){if(!this.material.shouldRender(e))return null;const{output:i,bind:r}=e;if(!this.material.produces.get(r.slot)?.(i))return null;const{highlight:n,slot:a}=r,o=i===5,l=i===9,c=l||o,h=n?.name;if(c&&(this._highlightNames.size===0||l&&h&&!this._highlightNames.has(h)))return null;const f=w=>l&&!!h&&!w.has(h),y=i===6,_=!(c||y);for(const w of this.dataByBaseInstance.values())for(const x of w.dataByOrigin.values())for(const S of x.buffers){if(f(S.highlightNames))continue;const $=o?S.drawCommandsHighlights.get(Tp):c?h?S.drawCommandsHighlights.get(h):S.drawCommandsHighlights.size>0:((y&&S.needsMultipleCommands?S.drawCommandsShadowHighlightRest:S.drawCommandsDefault)||null)?.length??!1,A=_&&S.drawCommandsOccludees||null;if($||A?.length){const M=this._glMaterials.load(e.rctx,a,i),P=M?.beginSlot(r);if(P)return P}}return null}render(e,i){const{output:r,bind:s}=e,{slot:n,highlight:a}=s,o=r===9,l=a?.name??"";if(o&&!a)return;const c=r===5,h=o||c,f=r===6,y=!(h||f),_=n===10||n===11?n:null,{rctx:w}=e;w.runAppleAmdDriverHelper();const x=w.bindTechnique(i,s,this.material.parameters);for(const S of this.dataByBaseInstance.values()){const{baseInstanceData:$}=S,A=$!=null,M=A?eTt:KSt,P=A?JSt:XSt;for(const O of S.dataByOrigin.values()){this._drawParameters.origin=O.origin;for(const D of O.buffers){if(o&&(!D.hasHighlights||!D.drawCommandsHighlights.has(l))||c&&(!D.hasHighlights||!D.drawCommandsHighlights.has(Tp)))continue;const L=P(D),F=tTt(L,D.needsMultipleCommands,l,c,h,f),U=iTt(L,y);(F?.length||U?.length)&&(x.bindDraw(s,this.material.parameters,this._drawParameters),M(w,D,$,i,F,U,_))}}}}updateHighlights(){const{_highlightNames:e}=this;e.clear();for(const i of this.dataByBaseInstance.values())for(const r of i.dataByOrigin.values())for(const s of r.buffers)for(const n of s.highlightNames)e.add(n);this._updateProduces()}get test(){}};d([m({constructOnly:!0})],QO.prototype,"material",void 0),d([m({constructOnly:!0})],QO.prototype,"dataByBaseInstance",void 0),QO=d([k("esri.views.3d.webgl-engine.materials.renderers.VaoRenderer")],QO);const XSt=t=>t,JSt=t=>t.instancedCommandVAOs,KSt=(t,{vao:e},i,r,s,n,a)=>{r.ensureAttributeLocations(e),t.bindVAO(e),P0e(t,r,s,a,!1),P0e(t,r,n,a,!0)},eTt=(t,e,{baseCommand:i},r,s,n,a)=>{R0e(t,r,i,s,a,!1),R0e(t,r,i,n,a,!0)};function P0e(t,e,i,r,s){if(i?.length){t.setPipelineState(e.getPipeline(s,r));for(const n of i)t.drawArrays(e.primitiveType,n.first,n.count)}}function R0e(t,e,{first:i,count:r},s,n,a){if(s?.length){t.setPipelineState(e.getPipeline(a,n));for(const{vao:o,instanceCount:l}of s)e.ensureAttributeLocations(o),t.bindVAO(o),t.drawArraysInstanced(e.primitiveType,i,r,l)}}function tTt(t,e,i,r,s,n){const a=s&&!r?t.drawCommandsHighlights.get(i)??null:null;return r?t.drawCommandsHighlights.get(Tp):s?a:n&&e?t.drawCommandsShadowHighlightRest:t.drawCommandsDefault}function iTt(t,e){return e&&t.drawCommandsOccludees||null}let L3=class extends _4{constructor(e){super(e),this._dataByBaseInstance=new Map,this._buffer=null,this._renderer=null,this.drapedPriority=0}initialize(){this._buffer=new Gb({material:this.material,dataByBaseInstance:this._dataByBaseInstance,highlightOrderMap:this.highlightOrderMap}),this._renderer=new QO({material:this.material,dataByBaseInstance:this._dataByBaseInstance})}destroy(){for(const e of this._dataByBaseInstance.values())e.dispose();this._dataByBaseInstance.clear(),this._buffer.destroy(),this._renderer.destroy()}hasHighlight(e){return this._renderer.hasHighlight(e)}initializeRenderContext(e){this._buffer.initializeRenderContext(e),this._renderer.initializeRenderContext(e)}uninitializeRenderContext(){this._buffer.uninitializeRenderContext(),this._renderer.uninitializeRenderContext()}get produces(){return this._renderer.produces}get hasOccludees(){return this._buffer.hasOccludees}get hasOnlyOccluders(){return!!(-2&this.renderOccludedFlags)}get hasEmitters(){return this.material.hasEmissions}get isDecoration(){return this.material.parameters.isDecoration}get renderOccludedFlags(){return this.material.renderOccludedFlags}get numGeometries(){let e=0;for(const i of this._dataByBaseInstance.values())for(const r of i.dataByOrigin.values())e+=r.buffers.reduce((s,n)=>s+n.instances.size,0);return e}get usedMemory(){let e=0;for(const i of this._dataByBaseInstance.values())for(const r of i.dataByOrigin.values())e+=r.buffers.reduce((s,n)=>s+n.vao.usedMemory,0);return e}forEachGeometry(e){for(const i of this._dataByBaseInstance.values())for(const r of i.dataByOrigin.values())for(const s of r.buffers)for(const{geometry:n}of s.instances.values())e(n)}modify(e,i){this._buffer.modify(e,i),this._renderer.updateHighlights()}get canCompact(){return this._buffer.canCompact}compact(e){return this._buffer.compact(e)}updateHighlights(e){this.highlightOrderMap=e,this._buffer.updateHighlights(e),this._renderer.updateHighlights()}updateAnimation(e){return this.material.update(e)}acquireTechniques(e){return this._renderer.acquireTechniques(e)}render(e,i){return this._renderer.render(e,i)}static prune(){Gb.prune()}get test(){}};d([m({constructOnly:!0})],L3.prototype,"material",void 0),d([m()],L3.prototype,"highlightOrderMap",void 0),L3=d([k("esri.views.3d.webgl-engine.materials.renderers.MergedRenderer")],L3);let fR=class extends Me{constructor(e){super(e),this._renderers=new Map}destroy(){this._renderers.forEach(e=>!e.destroyed&&e.destroy()),this._renderers.clear()}initialize(){this.addHandles(K(()=>this.stage.view.state.highlights,()=>this.updateHighlights()))}getMaterialRenderer(e){return this._renderers.get(e)}updateHighlights(){this._renderers.forEach(e=>e.updateHighlights(this.stage.view.state.highlightOrderMap))}commit(e,i,r){const{adds:s,removes:n,updates:a}=e;if(s.length===0&&n.length===0&&a.length===0)return!1;USt(e).forEach((l,c)=>{if(i.done)return;let h=this._renderers.get(c);h==null&&l.adds.length>0&&(h=new L3({material:c,highlightOrderMap:this.stage.view.state.highlightOrderMap}),h.initializeRenderContext(r),this.rendererAdded(h),this._renderers.set(c,h)),h?(h.modify(l,i),h.updateHighlights(this.stage.view.state.highlightOrderMap),h.numGeometries===0&&(this._renderers.delete(h.material),this.rendererRemoved(h),h.destroy())):(l.clear(),i.madeProgress())});let o=0;for(const l of this._renderers.values())l.drapedPriority=o++;return!0}get canCompact(){for(const e of this._renderers.values())if(e.canCompact)return!0;return!1}compact(e){let i=!1;for(const r of this._renderers.values()){if(e.done)return i;i=r.compact(e)||i}return i}get renderers(){return this._renderers}};d([m({constructOnly:!0})],fR.prototype,"stage",void 0),fR=d([k("esri.views.3d.webgl-engine.lib.RendererBase")],fR);let df=class extends fR{constructor(e){super(e),this._pending=new rTt,this._changes=new NX,this._sortedRenderers=new _i,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this.destroyed||(this._changes.prune(),this._sortedRenderers.prune(),this._geometries.clear(),this._pending.clear())}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}hasHighlight(e){return Qd(this.renderers,i=>i.hasHighlight(e))}get hasWater(){return this._hasWater}get hasOccluders(){return this.renderers&&Qd(this.renderers,e=>e.hasOnlyOccluders)}get hasOnlyOccluders(){return aW(this.renderers,e=>e.hasOnlyOccluders)}get isEmpty(){return!this.updating&&this.renderers.size===0&&this._geometries.size===0}get sortedRenderers(){return this._sortedRenderers}commitChanges(){return!!this.updating&&(this._processAddsRemoves(),this.commit(this._changes,sl,this.rendererContext.pluginContext)&&(this._updateSortedMaterialRenderers(),this._hasHighlights=Qd(this.renderers,e=>{const i=e.produces.get(18);return!!i&&i(9)}),this._hasWater=Qd(this.renderers,e=>{const i=e.produces.get(19);return!!i&&i(3)})),this.notifyChange("updating"),!0)}rendererAdded(){this._sortedRenderers.clear()}rendererRemoved(){this._sortedRenderers.clear()}addGeometries(e,i){if(e.length===0)return;const r=this._validateRenderGeometries(e);for(const n of r)this._geometries.set(n.id,n);const s=this._pending.empty;for(const n of r)this._pending.adds.add(n);switch(s&&this.notifyChange("updating"),i){case 0:this._notifyGraphicVisibilityChanged(e);break;case 1:this._notifyGraphicGeometryChanged(e)}}removeGeometries(e,i){if(this.destroyed)return;const r=this._pending.empty,s=this._pending.adds;for(const n of e)s.has(n)?(this._pending.removed.add(n),s.delete(n)):this._pending.removed.has(n)||this._pending.removes.add(n),this._geometries.delete(n.id);r&&!this._pending.empty&&this.notifyChange("updating"),i===1&&this._notifyGraphicGeometryChanged(e)}modifyGeometries(e,i){const r=this._changes.updates.length===0;for(const s of e){const n=new NSt;this._changes.updates.push(n),n.renderGeometry=this._ensureValidRenderGeometry(s),n.updateType=i}switch(r&&this._changes.updates.length>0&&this.notifyChange("updating"),i){case 4:case 2:return this._notifyGraphicGeometryChanged(e);case 1:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let i=!1;return this._sortedRenderers.forAll(r=>i=!!r.updateAnimation&&r.updateAnimation(e)||i),i}precompile(e){return this._sortedRenderers.reduce((i,r)=>r.precompile(e)||i,!1)}render(e){this._sortedRenderers.forAll(i=>{const r=i.acquireTechniques(e);r&&i.render(e,r)})}intersect(e,i,r,s,n){for(const a of this._geometries.values()){if(!s(a))continue;this._intersectRenderGeometry(a,r,i,0,e,n);const o=this.rendererContext.longitudeCyclical;o&&(a.boundingSphere[0]-a.boundingSphere[3]<o.min&&this._intersectRenderGeometry(a,r,i,o.range,e,n),a.boundingSphere[0]+a.boundingSphere[3]>o.max&&this._intersectRenderGeometry(a,r,i,-o.range,e,n)),n++}return n}_updateSortedMaterialRenderers(){if(!(this._sortedRenderers.length>0)){for(const e of this.renderers.values())this._sortedRenderers.push(e);this._sortedRenderers.sort((e,i)=>i.material?.renderPriority===e.material?.renderPriority?e.drapedPriority-i.drapedPriority:(i.material?.renderPriority||0)-(e.material?.renderPriority||0))}}_processAddsRemoves(){this._changes.adds.length=0,this._changes.removes.length=0,Uce(this._changes.adds,Array.from(this._pending.adds)),Uce(this._changes.removes,Array.from(this._pending.removes)),YV(this._changes.updates,({renderGeometry:e})=>!this._pending.has(e)),this._pending.clear()}_intersectRenderGeometry(e,i,r,s,n,a){if(!e.visible||!e.material.visible||!e.material.intersectDraped)return;let o=0;s+=e.transformation[12],o=e.transformation[13],DG[0]=r[0]-s,DG[1]=r[1]-o,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersectDraped(e,n,DG,(l,c,h)=>{sTt(i,h,a,e.material.renderPriority,n,e.layerViewUid,e.graphicUid)},i)}_notifyGraphicGeometryChanged(e){if(this.drapeSource.notifyGraphicGeometryChanged==null)return;let i;for(const{graphicUid:r}of e)r!=null&&r!==i&&(this.drapeSource.notifyGraphicGeometryChanged(r),i=r)}_notifyGraphicVisibilityChanged(e){if(this.drapeSource.notifyGraphicVisibilityChanged==null)return;let i;for(const{graphicUid:r}of e)r!=null&&r!==i&&(this.drapeSource.notifyGraphicVisibilityChanged(r),i=r)}_validateRenderGeometries(e){for(const i of e)this._ensureValidRenderGeometry(i);return e}_ensureValidRenderGeometry(e){return e.localOrigin==null&&(e.localOrigin=this._localOriginFactory.getOrigin(Ti(e.boundingSphere))),e}get test(){}};d([m({constructOnly:!0})],df.prototype,"drapeSource",void 0),d([m({constructOnly:!0})],df.prototype,"rendererContext",void 0),d([m()],df.prototype,"updating",null),d([m()],df.prototype,"rctx",null),d([m()],df.prototype,"_localOriginFactory",null),d([m({readOnly:!0})],df.prototype,"isEmpty",null),d([m()],df.prototype,"_geometries",void 0),df=d([k("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],df);let rTt=class{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return this.adds.size===0&&this.removes.size===0&&this.removed.size===0}has(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}};function sTt(t,e,i,r,s,n,a){const o=new jbt(n,a,e),l=c=>{c.set(5,o,t.distance,t.normal,t.transformation,i,r)};if((s.results.min.drapedLayerOrder==null||i>=s.results.min.drapedLayerOrder)&&(s.results.min.distance==null||s.results.ground.distance<=s.results.min.distance)&&l(s.results.min),s.options.store!==0&&(s.results.max.drapedLayerOrder==null||i<s.results.max.drapedLayerOrder)&&(s.results.max.distance==null||s.results.ground.distance>s.results.max.distance)&&l(s.results.max),s.options.store===2){const c=new G_(s.ray);l(c),s.results.all.push(c)}}const DG=pt();function LIe(){const t=globalThis.require?.modules;if(t){const e=Object.keys(t);for(const i of e)i.includes(".glsl")&&delete t[i]}}let D0e=class{constructor(e,i){this.screen=e,this.olid=i}};const kIe=1.3,nTt=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let k0,Sl=class extends Me{constructor(e){super(e),this._renderSR=null,this._overlaySREqualsRenderSR=!0,this._drapeSources=new Set,this._drapeTargets=new Set,this._placementDirty=!1,this._contentUpdated=!1,this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1,this._latestOriginId=0,this.groundView=e.view.groundView}initialize(){const{view:e}=this;this.renderer=new hf({parent:this}),e.stage.renderer.plugins.add(this.renderer);const i=()=>this.requestRender();this._groundIntersector=new Vc(e.state.viewingMode),this._groundIntersector.options.backfacesTerrain=!0,this._groundIntersector.options.invisibleTerrain=!0,this._groundIntersector.options.hud=!1,this.addHandles([K(()=>this.renderer.hasHighlights,i),this.renderer.events.on("has-water",()=>e.stage?.renderer.updateHasFlags()),this.renderer.events.on("content-changed",i),K(()=>e.state.camera.pixelRatio,i),K(()=>e.state.alignPixelEnabled,i),this.renderer.events.on("textures-disposed",()=>this.groundView.requestRender(1)),K(()=>[e.pointsOfInterest?.renderPointOfView,e.pointsOfInterest?.centerOnSurfaceFrequent?.location],()=>this.setPlacementDirty()),K(()=>[e.state?.pixelRatio,e.state?.contentPixelRatio],()=>this.setPlacementDirty(),Yt),Zs(()=>this.groundView,r=>r.on("elevation-change",()=>this.setPlacementDirty())),e.on("resize",()=>this.setPlacementDirty()),e.resourceController.scheduler.registerTask(yt.OVERLAY,this)]),e.stage.renderer.overlay=this}destroy(){this.view?.stage&&(this.view.stage.renderer.plugins.remove(this.renderer),this.view.stage.renderer.overlay=null,Re(this.renderer)),k0&&(k0.hide(),k0=null),this.renderer=null}get spatialReference(){return this._spatialReference}set spatialReference(e){this._spatialReference=e,this.renderer.longitudeCyclical=null;const i=this.view.renderSpatialReference;e!=null&&i!=null?(this._renderSR=i,this._overlaySREqualsRenderSR=e.equals(this._renderSR),this._isSpherical&&(this.renderer.longitudeCyclical=i8(e))):this.renderer.disposeOverlays()}get readyToRun(){return this._placementDirty&&(this._drapeSources.size>0||this.view.graphics.length>0||Ws.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&(this.terrainSurface.ready||!this.terrainSurface.enabled)}get _isSpherical(){return this.view.state.isGlobal}get worldToPCSRatio(){return this._spatialReference!=null&&this._spatialReference.isGeographic&&!this.view.state.isLocal?or(this._spatialReference).metersPerDegree:1}get _overlayStretch(){return kIe/this.view.resolutionScale}get longitudeCyclical(){return this.renderer.longitudeCyclical}get suspended(){return this.terrainSurface.enabled&&this.terrainSurface.suspended}get updating(){return this.readyToRun||!!this.renderer?.updating||this._contentUpdated}render(){return this._contentUpdated=!1,this.renderer.processSyncDrapeSources(),this.renderer.precompileShaders(this.view.state)?this._drawOverlays():null}get hasOverlays(){return this.renderer.hasOverlays}registerDrapeSource(e,i){this._drapeSources.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources),this.renderer.registerDrapeSource(e,i),this._updateDrapeSourceExtent(e),this._setContentDirty(),this.notifyChange("readyToRun")}registerGeometryDrapeSource(e){const i=new df({stage:this.view.stage,drapeSource:e,rendererContext:this.renderer});return this.registerDrapeSource(e,i),i}_updateDrapeSourceExtent(e){this.renderer.overlays.length===2&&e.setDrapingExtent!=null&&this._spatialReference!=null&&e.setDrapingExtent(this.renderer.overlays,this._spatialReference)}unregisterDrapeSource(e){this._drapeSources.has(e)&&(this._drapeSources.delete(e),this.renderer.removeDrapeSourceRenderer(e),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("readyToRun"))}registerDrapeTarget(e){this._drapeTargets.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}unregisterDrapeTarget(e){this._drapeTargets.delete(e),this.renderer.ensureDrapeTargets(this._drapeTargets)}_setContentDirty(){this.setPlacementDirty(),this.requestRender()}setPlacementDirty(){this._placementDirty=!0}runTask(e){return this.updateOverlays(e,this.view.state.contentCamera,1)}updateOverlays(e,i,r){if(!this._spatialReference)return ea;const s=this._computeOverlayHeight(i);this._computeOverlayExtents(i,s,Yp),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources,Yp.stretch);const n=this._updateOverlay(0,Yp.inner,s,1*Yp.pixelRatioAdjustment,Yp.mapUnitsPerPixel),a=oo(Yp.inner)/oo(Yp.outer),o=this._updateOverlay(1,Yp.outer,s,a*Yp.pixelRatioAdjustment,Yp.mapUnitsPerPixel);n!==1&&o!==1||(this._drapeSources.forEach(l=>this._updateDrapeSourceExtent(l)),this.groundView.updateOverlayParameters(),this.groundView.requestRender(r)),n===0&&o===0||this.requestRender(),this._placementDirty=!1,e.madeProgress()}_computeOverlayHeight(e){const i=this.view.state.contentPixelRatio*this.view.resolutionScale,r=e.fullWidth/e.pixelRatio*i,s=e.fullHeight/e.pixelRatio*i,n=Math.ceil(1.5*Math.max(r,s)),{maxPreferredTexturePixels:a,maxTextureSize:o}=this.view.stage.renderView.renderingContext.parameters,l=.5*o;return Iv(d4e({width:n,height:n},{maxPreferredTexturePixels:2*a,maxTextureSize:l})[1],l)}get overlays(){return this.renderer.overlays}_updateOverlay(e,i,r,s,n){if(this.renderer.overlays.length===0)return 0;const a=this.renderer.overlays[e],o=a.mapUnitsPerPixel;if(a.mapUnitsPerPixel=n,a.pixelRatio=s,aTt(i,a.extent)&&r===a.resolution)return o===n?0:2;a.setExtent(i),a.resolution=r;const l=h2e(a.extent);return a.renderLocalOrigin=wV(l[0],l[1],0,"OV_"+this._latestOriginId++),1}overlayPixelSizeInMapUnits(e,i){if(this.renderer.overlays.length===0)return i();const r=this.renderer.overlays[0],s=this.renderer.overlays[1],n=this._pointIsInExtent(e,r.extent)?r:s;return(n.extent[2]-n.extent[0])/n.resolution}reloadShaders(){LIe(),this.requestRender(),this.runTask(sl)}requestRender(e=1){this.renderer.hasOverlays?(e===1?(this._contentUpdated=!0,this._drawTexturesDirty=!0):this._drawTexturesAnimateDirty=!0,this.view.stage.renderView.requestRender(e)):this.setPlacementDirty()}_intersectGroundFromView(e,i,r,s,n){const a=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(e,uTt,i,r);if(a==null)return!1;const o=a.origin,l=xe(KL,a.origin,a.direction);this._groundIntersector.reset(o,l,e),this._groundIntersector.intersect([]),this.view.groundView.intersect(this._groundIntersector,null,o,l);const c=this._groundIntersector.results.min;return c.getIntersectionPoint(n)&&c.withinDistance(s)}_findHorizonBasedPointOfInterest(e,i){let r=.5;const s=.55,n=this.view.renderCoordsHelper.getAltitude(e.eye),a=this.view.pointsOfInterest.centerOnSurfaceFrequent,o=1e-5,l=Se(a.estimatedSurfaceAltitude,e.aboveGround?-1/0:n+o,e.aboveGround?n-o:1/0),c=e.aboveGround;if(this.view.viewingMode==="global"){const h=KL;vM(l2(GU,or(this.view.spatialReference).radius+l),Sp(e.eye,e.viewForward),h),Ce(h,h,e.eye);const f=hv.normalize(F3e(e.viewForward,h,e.viewRight))/e.fovY+.5,y=f<=0||f>=1?.5:s;r=c?y*f:f+y*(1-f)}else{const h=.5*Math.PI-Math.acos(-e.viewForward[2]),f=Math.tan(h),y=fi(0,f,1,0),_=Dc(y,y,e.projectionMatrix)[1],w=Se(.5+.5*_,0,1);r=w===1||w===0?.5:c?w*s:1-(1-w)*s}return this._intersectGroundFromView(e,.5,r,a.distance,i)}_computeOverlayExtents(e,i,r){const{view:s}=this,n=s.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,a=R();this._findHorizonBasedPointOfInterest(e,a)||de(a,n);const o=this._renderSR;Ws.OVERLAY_SHOW_CENTER?(k0==null&&(k0=new LT(s.graphics,"red")),k0.show(a,o)):k0?.hide();const l=Math.max(.1,Ri(e.eye,a)),c=vy(s.renderCoordsHelper,n,e.eye),h=this._spatialReference;this._overlaySREqualsRenderSR||ja(a,o,a,h);const f=this._isSpherical,y=this.groundView.extentAABR,_=!f&&h?.isGeographic,w=_&&h?1/or(h).metersPerDegree:1,x=s.state.contentPixelRatio,S=e.perScreenPixelRatio/x*l*w;r.mapUnitsPerPixel=S/this.worldToPCSRatio,r.stretch=this._overlayStretch;let $=i*S/2*r.stretch,A=!1,M=_?90:1/0;f&&y&&h&&(h.isWebMercator?($/=Math.cos(CW(a[1])),M=y[3]):(A=!0,$/=or(h).metersPerDegree,M=90),$>=M&&($=M,a[1]=0,h.isWebMercator&&(a[0]=0)));let P=1;A&&(P=1/Math.max(.2,Math.cos(Math.abs(Lt(a[1])))),$*P>180&&(P=180/$),r.mapUnitsPerPixel*=P);const O=Math.log(2)/12;$=Math.exp(Math.round(Math.log($)/O)*O);const D=$*P,L=32,F=.5*i/(L*D),U=.5*i/(L*$);a[0]=Math.round(a[0]*F)/F,a[1]=Math.round(a[1]*U)/U;const N=r.inner;N[0]=a[0]-D,N[1]=a[1]-$,N[2]=a[0]+D,N[3]=a[1]+$,f&&this._shiftExtentToFitBounds(N,1/0,M);const j=r.outer;if(6*D>oo(y))Bv(j,y);else if(Math.PI/2-Math.abs(c-Math.PI/2)<=.25*Math.PI)j[0]=N[0]-D,j[1]=N[1]-$,j[2]=N[2]+D,j[3]=N[3]+$;else{ja(e.eye,o,KL,h),qs(B1,a,KL);let Y=-Math.atan2(B1[1],B1[0])+.125*Math.PI;Y<0&&(Y+=2*Math.PI);const G=Math.floor(Y/(.25*Math.PI));Cv(B1,nTt[G],2*$),B1[0]*=P,B1[2]*=P,Uee(j,N,B1)}if(f)j[0]=this.longitudeCyclical.clamp(j[0]),j[2]=this.longitudeCyclical.clamp(j[2]),j[1]=Math.max(j[1],-M),j[3]=Math.min(j[3],M);else{const Y=OW(N,y,lTt),G=OW(j,y,cTt);mU(Y,G)&&(j[2]=j[0],j[3]=j[1])}const B=Math.abs(N[2]-N[0])/i;r.mapUnitsPerPixel=Math.max(r.mapUnitsPerPixel,B),r.pixelRatioAdjustment=r.mapUnitsPerPixel/B}_drawOverlays(e=this.view.state){if(!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return this.renderer;const i=!this._drawTexturesDirty&&this._drawTexturesAnimateDirty?0:1;this._drawTexturesDirty=this._drawTexturesAnimateDirty=!1;const r=this.renderer.computeValidity();return this.renderer.releaseRenderTargets(i),this.renderer.drawOverlays(e,i),r!==this.renderer.computeValidity()&&(this.groundView.updateOverlayParameters(),this.groundView.requestRender(1)),this.groundView.requestRender(i),i===1&&this.terrainSurface.requestUpdate(),this.renderer}_pointIsInExtent(e,i){if(this.longitudeCyclical)return this.longitudeCyclical.contains(i[0],i[2],e.x)&&e.y>=i[1]&&e.y<=i[3];const r=e.x,s=e.y;return r>i[0]&&r<i[2]&&s>i[1]&&s<i[3]}_shiftExtentToFitBounds(e,i,r){let s=0,n=0;e[0]<-i?s=e[0]+i:e[2]>i&&(s=i-e[2]),e[1]<-r?n=e[1]+r:e[3]>r&&(n=r-e[3]),JN(e,s,n)}get test(){}};function aTt(t,e){const r=Ws.TESTS_DISABLE_OPTIMIZATIONS?0:1e-5*Math.max(t[2]-t[0],t[3]-t[1],e[2]-e[0],e[3]-e[1]);return Math.abs(e[0]-t[0])<=r&&Math.abs(e[1]-t[1])<=r&&Math.abs(e[2]-t[2])<=r&&Math.abs(e[3]-t[3])<=r}d([m()],Sl.prototype,"_spatialReference",void 0),d([m({readOnly:!0})],Sl.prototype,"readyToRun",null),d([m()],Sl.prototype,"_placementDirty",void 0),d([m()],Sl.prototype,"_contentUpdated",void 0),d([m()],Sl.prototype,"_isSpherical",null),d([m()],Sl.prototype,"worldToPCSRatio",null),d([m()],Sl.prototype,"renderer",void 0),d([m({constructOnly:!0})],Sl.prototype,"view",void 0),d([m({constructOnly:!0})],Sl.prototype,"groundView",void 0),d([m({constructOnly:!0})],Sl.prototype,"terrainSurface",void 0),d([m()],Sl.prototype,"suspended",null),d([m()],Sl.prototype,"updating",null),Sl=d([k("esri.views.3d.terrain.OverlayManager")],Sl);let oTt=class{constructor(){this.inner=Pi(),this.outer=Pi(),this.mapUnitsPerPixel=0,this.pixelRatioAdjustment=1,this.stretch=kIe}};const B1=ri(),KL=R(),Yp=new oTt,lTt=Pi(),cTt=Pi(),uTt=rn();let hTt=class{constructor(){this.sinLonLUT=new Array(SO+1),this.cosLonLUT=new Array(SO+1),this.sinLatLUT=new Array(SO+1),this.cosLatLUT=new Array(SO+1)}update(e,i,r){const s=i[0],n=i[2];for(let a=0;a<=e;a++){const o=a/e,l=s*(1-o)+n*o;this.sinLonLUT[a]=Math.sin(l),this.cosLonLUT[a]=Math.cos(l);const c=r(o);this.sinLatLUT[a]=Math.sin(c),this.cosLatLUT[a]=Math.cos(c)}}},dTt=class{constructor(){this.numVerticesPerSide=0,this.samplerData=null,this.samplerDataVersion=0,this.clippingArea=null,this.wireframe=!1,this.cornerPeerNeighbors=[null,null,null,null],this.cornerNeighborCornerTiles=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],this.cornerNeighborCornerTileSamplerVersions=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],this.edgeResolutions=[-1,-1,-1,-1],this.edgePeerNeighbors=[null,null,null,null],this.edgePeerNeighborSamplerVersions=[-1,-1,-1,-1]}};function pTt(t){return t<=Hl?new Array(t):new Int16Array(t)}function Kx(t,e,i,r,s,n=2){const a=1/(Math.abs(i)+Math.abs(r)+Math.abs(s)),o=i*a,l=r*a,c=s<=0?(o>=0?1:-1)*(1-Math.abs(l)):o,h=s<=0?(l>=0?1:-1)*(1-Math.abs(o)):l,f=e*n;t[f]=I0e(c),t[f+1]=I0e(h)}function jJt(t){const e=t.length/3,i=pTt(2*e);let r=0;for(let s=0;s<e;++s)Kx(i,s,t[r++],t[r++],t[r++]);return i}function qJt(t,e){const i=t.length/3,r=new Int16Array(2*i);let s=0;const n=R();for(let a=0;a<i;++a)n[0]=t[s++],n[1]=t[s++],n[2]=t[s++],rl(n,n,e),Kx(r,a,n[0],n[1],n[2]);return r}function fTt(t,e,i,r=2){const s=i*r,n=L0e(e[s]),a=L0e(e[s+1]),o=1-Math.abs(n)-Math.abs(a);return t[2]=o,o<0?(t[0]=(n>=0?1:-1)*(1-Math.abs(a)),t[1]=(a>=0?1:-1)*(1-Math.abs(n))):(t[0]=n,t[1]=a),Ee(t,t)}function I0e(t){return Se(Math.round(32767*t),-32767,32767)}function L0e(t){return Se(t/32767,-1,1)}let mTt=class{constructor(){this.indices=null,this.indexCount=0,this.edgeIndicesStartIndex=0,this.poleIndicesStartIndex=0,this.vertexAttributes=null,this.edgeVerticesStartIndex=0,this.poleVerticesStartIndex=0,this.maxEdgeVertexCount=0,this.boundingBox=Nc(),this.numVerticesPerSide=0,this.minu=0,this.minv=0,this.maxu=1,this.maxv=1,this.outerEdgesOffsetAndLength=[0,0,0,0,0,0,0,0]}release(){this.vertexAttributes=Sr(this.vertexAttributes),this.indices=null}reset(){this.indices=null,this.vertexAttributes=null,Nc(this.boundingBox),this.numVerticesPerSide=0}getEdgeFirstVertexIndex(e){return this.outerEdgesOffsetAndLength[2*e]}getEdgeCount(e){return this.outerEdgesOffsetAndLength[2*e+1]}getEdgeVertexIndex(e,i){return this.getEdgeAttributeIndex(e,i)}getEdgeVertexPosition(e,i,r,s){this._getEdgeVertexRaw(this.getEdgeAttributeIndex(e,s),i),xe(i,i,r)}getEdgeNormal(e,i,r){const{typedBuffer:s,typedBufferStride:n}=this.vertexAttributes.normalCompressed;fTt(i,s,this.getEdgeAttributeIndex(e,r),n)}setEdgeNormalFromValues(e,i,r,s,n){this._setNormal(this.getEdgeAttributeIndex(e,i),r,s,n)}setEdgeVertexFromValuesRawPositionUV(e,i,r,s,n,a,o){const l=this.getEdgeAttributeIndex(e,i);this.vertexAttributes.position.setValues(l,r,s,n),this._setUV(l,a,o)}setEdgeVertexFromValuesRawPositionUVNormal(e,i,r,s,n,a,o,l,c,h){const f=this.getEdgeAttributeIndex(e,i);this.vertexAttributes.position.setValues(f,r,s,n),this._setUV(f,a,o),this._setNormal(f,l,c,h)}_getEdgeVertexRaw(e,i){this.vertexAttributes.position.getVec(e,i)}_setNormal(e,i,r,s){const{typedBuffer:n,typedBufferStride:a}=this.vertexAttributes.normalCompressed;Kx(n,e,i,r,s,a)}_setUV(e,i,r){this.vertexAttributes.uv0.setValues(e,Math.round(i*An),Math.round(r*An))}getEdgeAttributeIndex(e,i){return Be(0<=i&&i<this.getEdgeCount(e)),this.getEdgeFirstVertexIndex(e)+i}};var Qg;let gTt=(Qg=class{constructor(e){this._getFadeDuration=e,this._fadeStart=0,this._delayedTime=0}clear(){this._current=Re(this._current),this._next=Re(this._next),this._waiting=Re(this._waiting),this._delayed=Re(this._delayed)}get current(){if(this._current==null)return null;if(!this._isFadingEnabled){let i=null;this._delayed?(i=this._delayed,this._delayed=null):this._waiting?(i=this._waiting,this._waiting=null):this._next&&(i=this._next,this._next=null),i&&(this.clear(),this._current=i)}let e=Qg.test.fadeMoment;if(this._delayed&&(e=e||performance.now(),e>=this._delayedTime&&(this._push(this._delayed,0),this._delayed=null)),this._next){e=e||performance.now();const i=this._fadeDuration,r=this._current!=null&&this._next.texture===this._current.texture,s=this._next.type!==0,n=e-this._fadeStart>=i;(r||s||n)&&(Re(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(e))}return this._current}get next(){return this._next}get fadeFactor(){if(this._next==null)return 1;const e=Qg.test.fadeMoment||performance.now(),i=Math.max(0,e-this._fadeStart),r=this._fadeDuration;return i>r?0:1-i/r}get isFading(){return this._next!=null||this._delayed!=null}push(e,i=0){this._delayed=Re(this._delayed),this._push(e,i)}_push(e,i){if(this._isFadingEnabled||this.clear(),this._current==null)return void(this._current=e);const r=Qg.test.fadeMoment||performance.now();return i!==0?(this._delayed=e,void(this._delayedTime=r+i)):this._next==null?(this._next=e,void(this._fadeStart=this._alignFadeStart(r))):void(e!=null&&(Re(this._waiting),this._waiting=e))}get _fadeDuration(){const e=this._getFadeDuration();return this._waiting?.5*e:e}_alignFadeStart(e){const i=this._getFadeDuration();return e+i-e%i}get _isFadingEnabled(){return this._getFadeDuration()>0}},Qg.test={fadeMoment:0},Qg),PF=class{constructor(e,i,r,s,n,a){this.texture=e,this.type=i,this.offsetAndScale=r,e.retain(),this.opacities=Ge(s,n,a)}destroy(){this.texture.release()}},yTt=class{constructor(){this._scales=fi(-1,-1,-1,-1),this._offsets=fi(-1,-1,-1,-1)}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1,this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1}setScale(e,i,r){this._scales[2*e]=i,this._scales[2*e+1]=r}setOffset(e,i,r){this._offsets[2*e]=i,this._offsets[2*e+1]=r}get scales(){return this._scales}get offsets(){return this._offsets}},zIe=class{constructor(){this._queue=new _i,this.remove=()=>{}}get done(){return this._queue.length===0&&(!this._last||this._last.leaf)}resetOne(e){this._queue.clear(),this._queue.push(e),this._last=void 0}reset(e=null){this._queue.clear(),e!=null&&this._queue.pushArray(e),this._last=void 0}skipSubtree(){this._last=void 0}next(){const e=this._last?.children;return e?.[0]&&this._queue.pushArray(e),this._last=this._queue.pop(),this._last}},_Tt=class{constructor(){this._q=new _i}get done(){return this._q.length===0}reset(e){if(this._q.clear(),e!=null){this._q.pushArray(e);for(let i=0;i<this._q.length;++i){const r=this._q.data[i];r.leaf||this._q.pushArray(r.children)}}}next(){return this._q.pop()}};function Iw(t,e){if(e==null||e.destroyed)return!1;const i=vTt(e);if(i?.fullExtent==null)return!1;const r=i.fullExtent,s=t.extent;if(r.xmin>s[2]||r.ymin>s[3]||r.xmax<s[0]||r.ymax<s[1])return!1;const n=t.surface.tilingScheme.levels[t.level].scale,a=i.minScale;if(a>0&&n>1.00000001*a)return!1;const o=i.maxScale;return!(o>0&&n<.99999999*o)}function vTt(t){return W8(t)?{fullExtent:t.fullExtent,minScale:t.layer.minScale,maxScale:t.layer.maxScale}:t.layer}function bTt(t){return!W8(t)&&t.layer&&"tilemapCache"in t.layer?t.layer.tilemapCache:null}function Vf(t,e){const i=t.lij,r=e.lij;return i[0]-r[0]||i[1]-r[1]||i[2]-r[2]}function FIe(t,e=null){return e==null||e.length===0?t.sort(wTt):t.sort((i,r)=>xTt(i,r,e))}function wTt(t,e){const i=t.screenDepth-e.screenDepth;if(i!==0)return i;const r=t.lij,s=e.lij;return r[0]-s[0]||r[1]-s[1]||r[2]-s[2]}function NIe(t,e){const i=t.screenDepth,r=e.screenDepth;return i<r?-1:i>r?1:Vf(t,e)}function xTt(t,e,i){return k0e(t,i)===k0e(e,i)?NIe(t,e):t?1:-1}function k0e(t,e){for(const i of e)if(t.intersectsExtent(i))return!0;return!1}function STt(t,e){const i=t.distanceToPOI-e.distanceToPOI;if(i!==0)return i;const r=t.lij,s=e.lij;return r[0]-s[0]||r[1]-s[1]||r[2]-s[2]}function TTt(t,e){const i=t.length;for(let r=0;r<i;++r)t.at(r).updateDistanceToPOI(e);t.sort(STt)}function $Tt(t,e,i){let r=1,s=0,n=0;for(;t!==e;)if(r*=.5,s*=.5,n*=.5,1&t.lij[2]&&(s+=.5),1&t.lij[1]||(n+=.5),(t=t.parent)==null)throw new Error("tile was not a descendant of upsampleTile");i.init(e,s,n,r)}function CTt(t){for(let e=0;e<t.length;e++){const i=t[e],r=i.parent;if(r)for(let s=0;s<4;s++){const n=r.children[s];if(n&&n!==i)return!0}}return!1}function QJt(t,e){if(!t||!e||t[0]===e[0])return!1;const i=t[0]<e[0],r=i?t:e,s=i?e:t,n=1<<s[0]-r[0];return Math.floor(s[1]/n)===r[1]&&Math.floor(s[2]/n)===r[2]}let MTt=class{constructor(){this.geometry=new mTt,this.geometryState=null,this._texture=null,this._textureOpacity=1,this._textureRef=new gTt(()=>this._tile.surface.fadeDuration),this.overlay=new yTt,this._localOrigin=null,this._geometryStateChangedSinceLastUpdate=!0,this._hasGeometry=!1,this._modifiedFlags=0}get tile(){return this._tile}get localOrigin(){return this._localOrigin}init(e,i){this.clear(),this._tile=e,this.geometry.reset(),this.intersectionData=null,this.geometryState=new dTt,this._localOrigin=i,this.overlay.clear()}clear(){this.releaseGeometry(),this.releaseTexture(),this._textureRef.clear(),this._tile=null,this.intersectionData=null,this.geometryState=null}updateGeometryIfNeeded(e){if((!this._vao||this._geometryStateChangedSinceLastUpdate||this.wireframeChanged||this.clippingAreaChanged||this.samplerDataChanged||this.numVerticesPerSideChanged||this.dirtyCorners||this.dirtyEdgeResolutions||this.dirtyEdges)&&(this._updateGeometry(e),this._geometryStateChangedSinceLastUpdate=!1),Yn&&this.tile.intersectsClippingArea)for(let i=0;i<4;++i)Be(this.geometry.getEdgeCount(i)===this.geometryState.edgeResolutions[i]+1)}_calculateEdgeResolution(e,i){const r=this.tile,s=this.geometryState.numVerticesPerSide-1;if(!r.surface.isGlobal){const l=r.surface.extent;if(l!=null&&(e===0&&r.extent[3]>l[3]||e===1&&r.extent[2]>l[2]||e===2&&r.extent[1]<l[1]||e===3&&r.extent[0]<l[0]))return s}const n=r.level,a=cp[e];if(!i)return Be(r.surface?.rootTiles==null||r.surface.updatingRootTiles||!r.shouldHaveNeighbor(a)),s;if(i.loaded){const l=i,c=l.renderData.geometryState,h=n-l.level;if(Be(h>=0),h===0){const _=c.numVerticesPerSide-1;return Math.max(_,s)}const f=2**h,y=c.edgeResolutions[(e+2)%4]/f;return Math.max(1,y)}Be(!i.leaf);let o=s;return i.forAllSubtreeOnSide(Hre(a),l=>l===r||(l.loaded?(o=Math.max(o,2**(l.level-n)),!0):(Be(!l.leaf),!1))),o}updateNeighborData(){const e=this.tile;if(!e.intersectsClippingArea)return;const i=e.renderData.geometryState,r=a=>(a.loaded||a.level===e.level)&&a?.intersectsClippingArea,s=i.edgePeerNeighbors,n=i.edgePeerNeighborSamplerVersions;for(let a=0;a<4;++a){const o=e.findNeighborTile(cp[a],r),l=Hb(e,o),c=l?.renderData?.geometryState.samplerDataVersion??-1,h=s[a],f=l!==Hb(e,h),y=n[a]!==c;Yn&&o&&(Be(e.level>=o.level),Be(e.level-o.level<=Tn)),s[a]=o,(f||y)&&(n[a]=c,this._markEdgeDirty(a));const _=i.edgeResolutions[a],w=this._calculateEdgeResolution(a,o);Be(Dx(w)),Be(w>=1),i.edgeResolutions[a]=w,_!==w&&this._markEdgeResolutionDirty(a)}for(let a=0;a<4;++a){const o=e.findNeighborTile(bV[a],r);i.cornerPeerNeighbors[a]=o;const l=Hb(e,s[a]),c=Hb(e,s[(a+1)%4]),h=Hb(e,o);$d[a]=h,$d[(a+1)%4]=c,$d[(a+2)%4]=e,$d[(a+3)%4]=l,Be($d.some(w=>w?.loaded||w===e));const f=$d.reduce((w,x)=>Math.min(w,x?.level??1/0),1/0);$d.forEach((w,x)=>{w&&w?.level>f&&($d[x]=null)}),Be($d.some(w=>w?.loaded||w===e));const y=i.cornerNeighborCornerTiles,_=i.cornerNeighborCornerTileSamplerVersions;for(let w=0;w<4;++w){const x=$d[w],S=x?.renderData.geometryState.samplerDataVersion??-1,$=4*a+w,A=y[$]!==x,M=!A&&_[$]!==S;(A||M)&&(y[$]=x,_[$]=S,this._markCornerDirty(a))}Yn&&Be(sse.some(w=>y[4*a+w]?.loaded||y[4*a+w]===e))}Yn&&Be(this.geometryState.edgeResolutions.every(a=>a>0));for(let a=0;a<4;++a)$d[a]=null}_updateGeometry(e){if(!this.tile.intersectsClippingArea)return;Yn&&Be(!this.tile.intersectsClippingArea||this.geometryState.edgeResolutions.every(_=>_>0)),this.intersectionData=null;const{tile:i,_vao:r,geometry:s,geometryState:n}=this,a=!r||!1||this.wireframeChanged||this.samplerDataChanged||this.clippingAreaChanged||this.numVerticesPerSideChanged,o=this.dirtyEdgeResolutions!==0,l=n.edgeResolutions.reduce((_,w)=>_+w+1,0),c=a||o&&l>(s?.maxEdgeVertexCount??0),h=!c&&o,f=!h&&(this.dirtyEdges!==0||o),y=!f&&this.dirtyCorners!==0;c?(this.releaseGeometry(),this._createGeometry(e)):h?i.updateEdgeElevationsAndResolutions():f||y?i.updateEdgeElevations():y?i.updateCornerElevations():console.warn("Update for no reason?"),this._modifiedFlags=0}get hasGeometry(){return this._hasGeometry}releaseGeometry(){return this._hasGeometry=!1,this.intersectionData=null,!!this._vao&&(this._vao=Rt(this._vao),this.geometry.release(),!0)}ensureTexture(e,i,r,s){const n=i?6408:6407;return this._texture!=null&&(r===0&&this._tile.surface.fadeDuration>0&&this._isTextureVisible(this._texture)||this._texture.descriptor.width!==e||this._texture.descriptor.pixelFormat!==n)&&this.releaseTexture(),this._texture==null&&(this._texture=s(),this.tile.setMemoryDirty()),this._texture}releaseTexture(){this._texture&&(this._texture=Sr(this._texture),this.tile.setMemoryDirty())}reuseTexture(e,i){return!(!e||!this._texture)&&(e.setTextureReference(new PF(this._texture,0,i,this._textureOpacity,0,1)),!0)}get numVerticesPerSideChanged(){return(this._modifiedFlags&ATt)!==0}get samplerDataChanged(){return(this._modifiedFlags&OTt)!==0}get clippingAreaChanged(){return(this._modifiedFlags&PTt)!==0}get wireframeChanged(){return(this._modifiedFlags&RTt)!==0}get dirtyEdges(){return this._modifiedFlags>>IG&15}get dirtyCorners(){return this._modifiedFlags>>LG&15}get dirtyEdgeResolutions(){return this._modifiedFlags>>kG&15}_markCornerDirty(e){const i=1<<e<<LG;this._modifiedFlags|=i}_markEdgeDirty(e){const i=1<<e<<IG;this._modifiedFlags|=i,this._markCornerDirty((e+0)%4),this._markCornerDirty((e+3)%4)}_markEdgeResolutionDirty(e){const i=1<<e<<kG;this._modifiedFlags|=i,this._markEdgeDirty(e)}_markAllEdgesAndCornersDirty(){this._modifiedFlags|=15<<LG|15<<IG|15<<kG}updateGeometryState(){const e=this._elevationInfo,i=this.tile,r=e.samplerData?i.getElevationVerticesPerSide(e.maxTileLevel):i.minimumVerticesPerSide,s=Math.max(r,5);let n=i.clippingArea;i.intersectsClippingArea&&!i.withinClippingArea||(n=null);const a=this.geometryState;let o=!1;a.numVerticesPerSide!==s&&(this._modifiedFlags|=1,a.numVerticesPerSide=s,a.samplerDataVersion++,o=!0),e.changed&&(this._modifiedFlags|=2,a.samplerData=e.samplerData,a.samplerDataVersion++,o=!0),sy(a.clippingArea,n)||(this._modifiedFlags=4,a.clippingArea=n,o=!0);const l=i.surface.wireframe;return a.wireframe!==l&&(this._modifiedFlags=8,a.wireframe=l,o=!0),this._geometryStateChangedSinceLastUpdate||=o,o&&this._markAllEdgesAndCornersDirty(),this._hasGeometry=!0,this._geometryStateChangedSinceLastUpdate}_createGeometry(e){this.tile.createGeometry();const{vertexAttributes:i,indices:r}=this.geometry,s=e.gl;this._vao=new Op(e,new Hs(e,Lo(i.layout),i.buffer),Uu.createIndex(e,s.STATIC_DRAW,r)),this._hasGeometry=!0}get vao(){return this._vao}setTextureReference(e,i=0){e?.texture===this._texture?this._textureOpacity=e.opacities[0]:this.releaseTexture(),this._textureRef.push(e,i)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_isTextureVisible(e){return this._textureRef.current?.texture===e||this._textureRef.next?.texture===e&&this._textureRef.fadeFactor<1}get _elevationInfo(){const e=this.geometryState.samplerData,i=this.tile.layerInfo[0],r=i.length,s=new Array(r);let n=0,a=0,o=!1;for(let h=0;h<r;h++){const f=i[h],y=f.upsampleInfo?.tile;if(y){const _=y.layerInfo[0][h].data,w=_&&_.samplerData;e&&e[n]===w||(o=!0),s[n++]=w,a=Math.max(a,y.lij[0])}else if(f.data){const _=this.tile.surface.layerViewByIndex(h,0);if(Iw(this.tile,_)){const w=f.data;e&&e[n]===w.samplerData||(o=!0),s[n++]=w.samplerData,a=this.tile.level}}}e!=null&&e.length!==n&&(o=!0);const l=n>0,c=l?s:null;return l&&(s.length=n),{changed:o,samplerData:c,maxTileLevel:a}}get estimatedGeometryMemoryUsage(){const e=this.intersectionData?.estimatedMemoryUsage??0;return(this.geometry.indices?.byteLength??0)+(this.geometry.vertexAttributes?.byteLength??0)+e}get texture(){return this._texture}get test(){}checkGeometryWaterproofness(){if(!Yn)return;const e=this.tile;if(!e.loaded||!e.intersectsClippingArea||e.level===0)return void Be(e?.loaded);const i=e.surface.extent;if(i!=null&&!e.intersectsExtent(i))return;const r=cp.map((o,l)=>i!=null&&(l<2?-1:1)*(e.extent[3-l]-i[3-l])<0),s=e.level;Be(this.dirtyCorners===0),Be(this.dirtyEdges===0),Be(this.dirtyEdgeResolutions===0),Be(!this.numVerticesPerSideChanged),Be(!this.samplerDataChanged),Be(!this.clippingAreaChanged),Be(!this.wireframeChanged);const n=bV.map(o=>e.findNeighborCornerTileExact(o,l=>!l.intersectsClippingArea||l.loaded||l.level===e.level)??null).map(o=>o?.intersectsClippingArea?o:null),a=this.geometryState;for(let o=0;o<4;++o){const l=a.cornerPeerNeighbors[o],c=n[o];Be(c===l,`Tile[${e.lij}].corner[${o}] out of date: cur=[${l?.lij}] exp=[${c?.lij}]`)}cp.forEach((o,l)=>{if(r[l])return;const c=e.findNeighborTile(o,q=>(q.level===s||q?.loaded)&&q?.intersectsClippingArea);if(!c){const q=!e.surface.updatingRootTiles&&e.surface.rootTiles!=null&&e.surface.rootTiles.length>0&&e.shouldHaveNeighbor(o);return void Be(!q)}Be(c.loaded||c.level===e.level),Be(c===this.geometryState.edgePeerNeighbors[l]);const h=s-c.level;if(!c.loaded)return Be(!c.leaf),void Be(h===0);const f=c.renderData;Be(e.isEdgeNeighbor(c,o)),Be(h>=0);const y=2**h;if(h<0)return void Be(!1);const _=e.renderData,w=_.geometry,x=_.localOrigin,S=w.getEdgeCount(l),$=w.numVerticesPerSide-1,A=f.geometry;if(!A)return void Be(!1);const M=f.localOrigin,P=this.geometryState.edgePeerNeighbors[l];if(P?.loaded){const q=P.renderData;Be(_.geometryState.edgePeerNeighborSamplerVersions[l]===q.geometryState.samplerDataVersion),Be(this.geometryState.edgePeerNeighborSamplerVersions[l]===q.geometryState.samplerDataVersion)}const O=(l+2)%4,D=A.getEdgeCount(O),L=S-1,F=D-1;Be(L*y===F,`Tile[${e.lij}]:e${l},res=${L} edgeRes mismatch with Neighbor[${c.lij}]:e${O},res=${F} (expected:${L*y})`);const U=e.extent,N=o===0||o===4,j=D-1,B=j>>h,Y=S-1;if(B<1)return void Be(Y===1);Be(B===Y),Be(Dx(B));const G=A.numVerticesPerSide-1;Be(h>0||B===Math.max(G,$));const Z=e.getNeighborEdgeStartVertexIndex(l,c);Be(0<=Z&&Z<y);const H=Z*B;Be(0<=H&&H<=j-B);let Q=0,X=H;w.getEdgeVertexPosition(l,Qp,x,0),w.getEdgeVertexPosition(l,Xp,x,S-1);const ye=Ri(Qp,Xp),De=Math.max(ETt,1e-4*ye);for(let q=0;q<=B;++q){w.getEdgeVertexPosition(l,Qp,x,Q),A.getEdgeVertexPosition(O,Xp,M,X);const ne=q/B,ce=N?U[0]+ne*(U[2]-U[0]):o===6?U[0]:U[2],be=N?o===4?U[1]:U[3]:U[1]+ne*(U[3]-U[1]),ze=e.surface.extent;if(ze==null||mC(ze,ce,be)){const Ne=s4(Qp,Xp),at=gu(Qp)-mi.radius,Tt=gu(Xp)-mi.radius,et=Ne<De;if(!et){console.warn(`Tile edge vertex position mismatch: between [${e.lij}].edge${l}[${Q}/${S}] and [${c.lij}].edge${O}[${X}/${D}]`),ze!=null&&console.warn("  surface extent= ",ze," x,y=",ce,",",be);const Ct=R();Ce(Ct,_.localOrigin,f.localOrigin),gu(Ct)>0&&console.warn(`   localOrigins: ${_.localOrigin} vs ${f.localOrigin} d=${gu(Ct)} [${Ct}]`),(()=>{const Ft=cr(Qp),qe=cr(Xp);e.updateEdgeElevations(),c.updateEdgeElevations(),w.getEdgeVertexPosition(l,Qp,x,Q),A.getEdgeVertexPosition(O,Xp,M,X);const je=R();ui(je,Qp,Ft),gu(je)>0&&console.warn(`  XXX Tile[${e.lij}] edge out of date: ${Ft} vs ${Qp} d=${gu(je)} [${je}]`),ui(je,Xp,qe),gu(je)>0&&console.warn(`  XXX Neighbor[${c.lij}] edge out of date: ${qe} vs ${Xp} d=${gu(je)} [${je}]`)})();const jt=w.getEdgeCount(l),Ue=A.getEdgeCount(D);Be(et,`Mismatch in tile [${e.lij}].edge[${l}][${Q}/${jt}] vs neighbor [${c.lij}].edge[${O}][${X}/${Ue}] ${Fm(Qp)} vs ${Fm(Xp)}  dist=${Ne} h(t|n|d)=${at}|${Tt}|${Tt-at}`)}w.getEdgeNormal(l,jS,Q),A.getEdgeNormal(O,qS,X),Ee(z0e,jS),Ee(F0e,qS);const It=Oe(z0e,F0e),$t=1-It<.01||!1||e===c;if(!$t){const Ct=R();ui(Ct,jS,qS);const jt=()=>`Mismatch in tile edge normal ${Uye(e.lij)} (${Q}/${S-1}) edge ${l} vs neighbor ${Uye(c.lij)}  (${X}/${D-1}) nedge ${O} :${Fm(jS)} vs ${Fm(qS)}  dot = ${It} : ${Fm(Ct)}`;console.warn("Mismatch in tile edge normal: ",jt());{e.updateEdgeElevations(),c.updateEdgeElevations();const Ue=R(),Ft=R();w.getEdgeNormal(l,Ue,Q),A.getEdgeNormal(O,Ft,X),Tv(jS,Ue)||console.warn("Missing update in tile normal: ",Fm(jS)," => ",Fm(Ue)),Tv(qS,Ft)||console.warn("Missing update in neighbor normal: ",Fm(qS)," => ",Fm(Ft))}Be($t,jt())}}Q+=1,X+=1}})}};const Qp=R(),Xp=R(),jS=R(),qS=R(),z0e=R(),F0e=R(),ETt=1,$d=[null,null,null,null];function Hb(t,e){return e?.loaded||e===t?e:null}const ATt=1,OTt=2,PTt=4,RTt=8,IG=4,LG=8,kG=12,sse=[0,1,2,3];let nse=class{get updating(){return!!this._tileRequested}init(e,i,r,s){this.tile=e,this._layerIdx=i,this._layerClass=r,this._suspended=s,this._tileLayerInfo=e.getLayerInfo(i,r),this._tileRequested=null;const n=this._findAncestorWithData();this._setUpsampleTile(n)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null),this.tile=null,this._tileLayerInfo=null}setSuspension(e){e!==this._suspended&&(this._suspended=e,e?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){const e=this._findAncestorWithData();return this._setUpsampleTile(e),this._requestNext()}dataArrived(e,i){this._setUpsampleTile(e,i),this._tileRequested=null,e===this.tile?this.tile.updateRenderData(this._layerClass,0,i):this._requestNext()}dataMissing(){this._tileRequested=null,this._tileLayerInfo.data=null,this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass),this.dispose()}_requestNext(){if(this._suspended)return!0;const e=this._findNextDownload();if(this._tileRequested){if(e===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null}return e!=null?e.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=e):this._agentDone(),!!this._tileRequested}_findNextDownload(){const e=this._layerIdx,i=this._layerClass,r=this.tile.surface.layerViewByIndex(e,i),{minLevel:s,maxLevel:n}=r.dataLevelRange,a=this._desiredMinLevelDelta,o=this._progressiveLevelModulo+a,l=this._scaleRangeEnabled?Iw:()=>!0;let c=this.tile;const h=c.level;let f;const y=this._tileLayerInfo.upsampleInfo,_=y?.tile?.level??-1,w=y!=null&&_-h>=a,x=bTt(r),S=r.type==="vector-tile-3d"?r.schemaHelper:null;for(;c&&l(c,r)&&c.level>=s;){const $=c.level,A=h-$,M=c.layerInfo[i][e];if(M.data&&A>=a){(!w||$>_)&&this._setUpsampleTile(c),M.dataInvalidated&&(f=c);break}const P=S?.getLevelRowColumn(c.lij)??c.lij;if(x?.getAvailability(P[0],P[1],P[2])!=="unavailable"&&$<=n&&!M.data&&!M.dataMissing&&((!f||c.level===s||$%mAe===0||h-f.level<a)&&(f=c),A>=o))break;c=c.parent}if(f!=null&&h-f.level<a)if(y)f=null;else{const $=this._findAncestorWithData();$!=null&&(this._setUpsampleTile($),f=$.layerInfo[i][e].dataInvalidated?$:null)}return f}_findAncestorWithData(){const e=this.tile.elevationLevel,i=this._desiredMinLevelDelta;let r;for(let s=this.tile;s;s=s.parent)if(s.hasLayerData(this._layerIdx,this._layerClass)){if(e-s.level>=i)return s;r=s}return r}_setUpsampleTile(e,i){this._tileLayerInfo.setUpsampleInfo(this.tile,e),this.tile.updateRenderData(this._layerClass,0,i)}get test(){}},DTt=class extends nse{constructor(){super(...arguments),this.type="none"}get _desiredMinLevelDelta(){throw N0e}get _progressiveLevelModulo(){throw N0e}dispose(){}};const N0e=new Error("Abstract method called on TileAgent"),lc=new DTt;let ITt=class extends nse{constructor(){super(...arguments),this.type="elevation",this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return this.tile.elevationLevelDelta-(this.tile.elevationLevel-this.tile.level)}get _progressiveLevelModulo(){return 0}};function LTt(t){return t.type==="elevation"}let kTt=class{constructor(e){this.tile=e}get usedMemory(){return this.tile.mapDataMemory}},zTt=class extends nse{constructor(){super(),this.type="map",this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return mAe}};function FTt(t){return t.type==="map"}let RF=class{constructor(){this.waitingAgents=new _i,this.pendingUpdates=0}static acquire(e){const i=DF.acquire();return i._init(e),i}release(){this.dispose(),mR.delete(this),DF.release(this)}dispose(){this.loadingAgent=Rt(this.loadingAgent),this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this._data=v$(this._data)}static prune(){DF.prune(0)}_init(e){this.waitingAgents.clear(),this._data=v$(this._data),this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.abortRequest(),this.loadingAgent=null,this.pendingUpdates=0,this._pool=e,this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=ps(this.requestAbort),this.requestPromise=null}_unsetUpsampleInfo(){this.upsampleInfo&&(this.upsampleInfo.tile?.unrefMapData(),this._pool.release(this.upsampleInfo),this.upsampleInfo=null)}setUpsampleInfo(e,i){if(e!==i&&i!=null){if(this.upsampleInfo==null)this.upsampleInfo=this._pool.acquire();else{if(this.upsampleInfo.tile===i)return;this.upsampleInfo.tile?.unrefMapData()}i.refMapData(),$Tt(e,i,this.upsampleInfo)}else this._unsetUpsampleInfo()}get data(){return this._data}set data(e){v$(this._data),this._data=e}};const DF=new Wl(()=>new RF,null,()=>{}),mR=new Map;function NTt(){mR.size>0&&(console.log(`${mR.size} live TilePerLayerInfo allocations:`),mR.forEach(t=>console.log(t,`
`)))}function VTt(){DF.prune(),mR.clear()}const UTt=.1;let ase=class{constructor(){this._lij=[0,0,0],this._children=[null,null,null,null],this._pendingUpdates=0,this._dirty=!0,this._previouslyRendered=!1,this.extent=Pi(),this._elevationBoundsMin=NaN,this._elevationBoundsMax=0,this.layerInfo=[[],[]],this.extentInRadians=Pi(),this.centerAtSeaLevel=R(),this._center=[R(),ms(),R()],this.up=Tee(),this._withinClippingArea=!0,this._intersectsClippingArea=!0,this._maxTesselation=0,this._usedMemory=0,this._rasterTileMemory=0,this._vectorTileMemory=0,this._mapDataRefCount=0,this.screenDepth=0,this.renderOrder=0,this._edgeLen=0,this._edgeLen2=0,this._curvatureHeight=0,this.onCompressionFinished=()=>{this.setPendingUpdate(16),this.setMemoryDirty()},this.extentMidX=0,this.extentMidY=0,this.distanceToPOI=-1,this._lastPOI=R(),this.maxLevelDeltaNeighborCount=0,this.unmergableChildCount=0}get lij(){return this._lij}get spatialReference(){return this._surface.spatialReference??this._surface.tilingScheme.spatialReference}get elevationLevelDelta(){return this._surface.getElevationLevelDelta(this.level)}static prune(){ose.prune(0),lse.prune(0),RF.prune()}get _cached(){return!this.leaf&&this._mapDataRefCount<=0}get withinClippingArea(){return this._withinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBoundsMin(){return this._elevationBoundsMin}get elevationBoundsMax(){return this._elevationBoundsMax}get level(){return this._lij[0]}get key(){return`${this._lij[0]}/${this._lij[1]}/${this._lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[1][3]}get visible(){return this._dirty&&this.computeVisibility(),this._visible}get frustumVisibility(){return this._dirty&&this.computeVisibility(),this._frustumVisibility}computeVisibility(){this._dirty=!1;const e=this.parent,i=e?.frustumVisibility??1;this._frustumVisibility=i===0?0:i===2?2:this._calculateFrustumVisibility(this.surface.frustum);const r=this._frustumVisibility!==2&&this._intersectsClippingArea;r!==this._visible&&(this._visible=r,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setDirty(),this.updateAgentSuspension())}get _loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const e=!!this.renderData;return e!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=e,this._surface.renderer.setDirty()),e}init(e,i,r,s,n){this._lij[0]=e,this._lij[1]=i,this._lij[2]=r,this.ellipsoid=or(n.tilingScheme.spatialReference),n.tilingScheme.getExtent(e,i,r,this.extent),n.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians),this.extentMidX=.5*(this.extent[0]+this.extent[2]),this.extentMidY=.5*(this.extent[1]+this.extent[3]),this._withinClippingArea=!0,this._intersectsClippingArea=!0,this._clippingArea=null,this._mapDataRefCount=0,n.upsampleMapCache.pop(this.key),this._edgeLen=0,this._edgeLen2=0,this._center[1][3]=0,this.elevationLevel=e,s&&!Number.isNaN(s.elevationBoundsMin)?(this._elevationBoundsMin=s.elevationBoundsMin,this._elevationBoundsMax=s.elevationBoundsMax):(this._elevationBoundsMin=0,this._elevationBoundsMax=0),this._pendingUpdates=0,this.renderData=null,this.screenDepth=0,this._visible=!1,this._previouslyRendered=!1,this._parent=s,this.clearChildren(),this._surface=n,this.updateVisibility(),this.maxLevelDeltaNeighborCount=0,this.unmergableChildCount=0;for(const a of zT){const o=n.numLayers(a),l=this.layerInfo[a];for(const c of l)c.release();l.length=o;for(let c=0;c<o;c++)l[c]=RF.acquire(this._surface.upsampleInfoPool),a===0&&this.findElevationBoundsForLayer(c,-1)}this.computeElevationBounds(),this._maxTesselation=Math.min(n.tilingScheme.pixelSize,SO)}dispose(){pa(!this.renderData,"tile.renderData was not unloaded"),this._surface?.upsampleMapCache.pop(this.key),this.layerInfo.forEach(e=>{e.forEach(i=>i.release()),e.length=0}),this._surface=this._parent=null,this.clearChildren(),this.setMemoryDirty()}refMapData(){++this._mapDataRefCount,this._cached||this._surface.upsampleMapCache.pop(this.key)}unrefMapData(){--this._mapDataRefCount,this._cached&&this.cachedMemory>0&&this._surface.upsampleMapCache.put(this.key,new kTt(this))}setMemoryDirty(){this._usedMemory=0}get usedMemory(){return this._ensureUsedMemory()+(this._cached?0:this.mapDataMemory)}get cachedMemory(){return this._ensureUsedMemory(),this._surface==null?this.usedMemory:this._cached?this.mapDataMemory:0}get mapDataMemory(){return this._rasterTileMemory+this._vectorTileMemory}get _cpuImageMemorySize(){const i=this._surface.tilingScheme.pixelSize;return i*i*4}_ensureUsedMemory(){if(this._usedMemory>0)return this._vectorTileMemory=this.layerInfo[1].reduce((e,{data:i})=>e+(IT(i)?i.usedMemoryPerReference:0),0),this._usedMemory;this._usedMemory=this._baseUsedMemory,this._rasterTileMemory=0,this._vectorTileMemory=0;for(const{data:e}of this.layerInfo[1])IT(e)?this._vectorTileMemory+=e.usedMemoryPerReference:this._rasterTileMemory+=this.getTerrainDataMemory(e);for(const e of this.layerInfo[0])this._usedMemory+=e.data?this._cpuImageMemorySize:0;return this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._rasterTileMemory+=this.renderData.texture?.usedMemory??0),this._cached&&this._surface.upsampleMapCache.updateSize(this.key),this._usedMemory}getUsedMemoryForLayer(e,i){const r=this.layerInfo[e][i];return r?.data?e===1?this._cached?0:this.getTerrainDataMemory(r.data):e===0?this._cpuImageMemorySize:0:0}getTerrainDataMemory(e){return R4e(e)?e.texture.usedMemory:P4e(e)?e.memoryUsage:IT(e)?e.usedMemoryPerReference:j8(e)||e instanceof HTMLImageElement?this._cpuImageMemorySize:0}updateScreenDepth(e){const i=this._center[1],r=e,s=i[0],n=i[1],a=i[2],o=r[2]*s+r[6]*n+r[10]*a+r[14];this.screenDepth=o<0?0:o/(r[3]*s+r[7]*n+r[11]*a+r[15])}shouldSplit(e,i,r){if(!this.visible||e.frustum&&(!this._intersectsClippingArea||this._calculateFrustumVisibility(e.frustum)===2))return 0;const s=this.level;Ce(tk,Ti(this._center[1]),i);let n=On(tk),a=tk,o=gy(this._center[1],R());Ce(zG,this._center[0],i);const l=On(zG);l<n&&(n=l,a=zG,o=this._center[0]),Ce(FG,this._center[2],i);const c=On(FG);if(c<n&&(n=c,a=FG,o=this._center[2]),this._edgeLen2>n&&s<e.maxLod)return 1;const h=Math.sqrt(n),f=e.fovX*h*2,y=this._edgeLen/f,_=()=>{if(s<e.maxLod)return this.elevationLevel=s,0;const L=s+Math.ceil(-Math.log2(e.relativeWidthLimit/y));return L!==this.elevationLevel?(this.elevationLevel=L,2):0},w=r!=null?r-s:1/0;if(w<=.5)return _();const x=Oe(this.up,tk),S=this._elevationBoundsMax-this._elevationBoundsMin,$=S/this.edgeLen;if(e.aboveGround&&x>0&&$<.001&&x/h-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-$>0)return 0;const A=r!=null?3-Math.min(w,2):1;if(y*A<e.relativeWidthLimit||s>=e.maxLod)return _();if(s<7)return 1;le(La,this.up,x),Ce(La,La,a);const M=On(La);if(M<=this.radius*this.radius)return 1;le(La,La,this.radius/Math.sqrt(M)),xe(La,La,o),Ce(La,i,La);const P=Math.min(1,(Math.abs(Oe(La,this.up))+.5*S+this._curvatureHeight)/Le(La)),O=UTt/e.angledSplitBias,D=e.fovY*h*2;return P*(this._edgeLen/D*A)<O*e.relativeHeightLimit?0:1}createChildren(){const e=this._children,i=this.lij[0]+1,r=2*this.lij[1],s=2*this.lij[2];return e[0]=this.surface.createTile(i,r,s,this),e[1]=this.surface.createTile(i,r,s+1,this),e[2]=this.surface.createTile(i,r+1,s,this),e[3]=this.surface.createTile(i,r+1,s+1,this),e}clearChildren(){this._children[0]=this._children[1]=this._children[2]=this._children[3]=null}get loaded(){return this.renderData?.hasGeometry??!1}load(){this.refMapData();for(const e of zT)this._createOrUpdateAgents(0,e);this.surface.renderer.loadTile(this)}unload(){this.renderData&&this.unrefMapData(),this.surface.renderer.unloadTile(this);for(const e of zT){const i=this.layerInfo[e];for(const r of i)r.loadingAgent&&r.loadingAgent!==lc&&(ek(r.loadingAgent),r.loadingAgent=null),r.pendingUpdates=0}this.resetPendingUpdate(8),this.resetPendingUpdate(16),this.resetPendingUpdate(32)}unloadMapData(){const e=this.layerInfo[1];for(const i of e)i.loadingAgent&&i.loadingAgent!==lc&&(ek(i.loadingAgent),i.loadingAgent=null),i.pendingUpdates=0,i.invalidateSourceData();this.renderData?.releaseTexture(),this.setMemoryDirty()}updateClippingStatus(e){if(vw(e,this._clippingArea))return!1;const i=this._intersectsClippingArea,r=this._withinClippingArea;e!=null?(this._intersectsClippingArea=this.intersectsExtent(e),this._withinClippingArea=this._isWithinExtent(e)):(this._intersectsClippingArea=!0,this._withinClippingArea=!0),this._clippingArea=e,this.updateVisibility();const s=r&&this._withinClippingArea,n=!(r||i||this._withinClippingArea||this._intersectsClippingArea);return!this.renderData||s||n||this.setPendingUpdate(8),!0}updateVisibility(){this._dirty=!0,this._surface.setTileTreeDirty()}getLayerInfo(e,i){return this.layerInfo[i][e]}hasLayerData(e,i){const r=this.layerInfo[i][e];return!(!r?.data||r.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(const e of zT){const i=this.layerInfo[e];for(const r of i)if(r.loadingAgent&&r.loadingAgent!==lc&&r.loadingAgent.updating)return!0}return!1}_isSuspended(e){return!!this.hasPendingUpdate(1)||e!==0&&!this._loadable}get hasPendingUpdates(){return this._pendingUpdates!==0}hasPendingUpdate(e){return(this._pendingUpdates&e)===e}setPendingUpdate(e){const i=this._pendingUpdates;return this._pendingUpdates|=e,e===1||e===4?this._surface.setTileTreeDirty():this._surface.requestUpdate(),i!==this._pendingUpdates}resetPendingUpdate(e){return!!this.hasPendingUpdate(e)&&(this._pendingUpdates&=~e,!0)}requestLayerData(e,i,r){const s=this.layerInfo[i][e];if(s.waitingAgents.has(r))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this._lij.toString(),r.tile.lij.toString(),i,e),!0;if(s.waitingAgents.push(r),s.data&&!s.dataInvalidated){console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this._lij.toString(),r.tile.lij.toString(),i,e);const o=IT(s.data);return r.dataArrived(this,o),!0}if(s.requestPromise)return!0;ps(s.requestAbort),s.requestAbort=new AbortController;const n=this._surface.requestTileData(this,e,i,s.requestAbort);if(!n)return s.requestAbort=null,!1;const a=()=>{s.requestPromise===n&&(s.requestPromise=null,s.requestAbort=null)};return s.requestPromise=n,n.then(a,a),!0}get leaf(){return this._children[0]==null}hasLij(e){return this._lij[0]===e[0]&&this._lij[1]===e[1]&&this._lij[2]===e[2]}findByLij(e){if(this.hasLij(e))return this;const i=this._children;return i[0]?i[0].findByLij(e)||i[1].findByLij(e)||i[2].findByLij(e)||i[3].findByLij(e):null}distanceToSquared(e){return On(Ce(La,Ti(this._center[1]),e))}containsPoint(e){const i=this.extent;return e[0]>=i[0]&&e[1]>=i[1]&&e[0]<=i[2]&&e[1]<=i[3]}containsPointXY(e,i){const r=this.extent;return e>=r[0]&&i>=r[1]&&e<=r[2]&&i<=r[3]}unrequestLayerData(e,i,r){const s=this.layerInfo[i][e],n=s.waitingAgents,a=n.removeUnordered(r)!=null;pa(a,"agent has not requested this piece of map data"),n.length<1&&(s.abortRequest(),this.setMemoryDirty())}dataArrived(e,i,r){const s=IT(r),n=this.layerInfo[i][e];n.data=r,n.dataInvalidated=!1,n.waitingAgents.forAll(a=>a.dataArrived(this,s)),n.waitingAgents.clear(),this.setMemoryDirty()}dataMissing(e,i){const r=this.layerInfo[i][e];r.dataMissing=!0,r.waitingAgents.forAll(s=>s.dataMissing()),r.waitingAgents.clear(),this.setMemoryDirty()}updateRenderData(e,i,r){switch(r&&this.forEachLoadedNeighbor(s=>s.updateRenderData(e,i)),e){case 1:return this._updateTexture(i);case 0:return this._updateGeometry()}}_updateTexture(e){this.renderData&&(this.resetPendingUpdate(e===0?16:32),this.setPendingUpdate(e===0?32:16))}_updateGeometry(){this.setPendingUpdate(8);for(const e of this.layerInfo[0])e.pendingUpdates|=8}invalidateLayerData(e,i){this.layerInfo[i][e].invalidateSourceData(),this.restartAgents(i)}computeElevationBounds(){const e=this._elevationBoundsMin,i=this._elevationBoundsMax;let r=1/0,s=-1/0;const n=this.layerInfo[0];let a=!0;for(const o of n)o.elevationBounds!=null&&(r=Math.min(r,o.elevationBounds.min),s=Math.max(s,o.elevationBounds.max),o.elevationBounds.hasNoDataValues||(a=!1));a&&(r=Math.min(r,0),s=Math.max(s,0)),e===r&&i===s||(this._elevationBoundsMin=r,this._elevationBoundsMax=s,this.updateRadiusAndCenter(),this._surface.setTileTreeDirty())}_updateCenter(){const e=this._elevationBoundsMin,i=this._elevationBoundsMax,r=.5*(e+i),s=this._center;le(La,this.up,r),_M(s[1],xe(GTt,this.centerAtSeaLevel,La)),le(La,this.up,e),xe(s[0],this.centerAtSeaLevel,La),le(La,this.up,i),xe(s[2],this.centerAtSeaLevel,La)}findElevationBoundsForLayer(e,i){const r=this.layerInfo[0][e],s=this.elevationLevelDelta,n=Math.max(this.elevationLevel-s,0),a=r.elevationBounds;if(a!=null&&a.level>=i&&a.level<=n)return;const o=this._surface.layerViewByIndex(e,0);if(!Iw(this,o))return;const l=jTt;let c=!1;const h=r.data;if(h&&h.level<=n){const f=r.data;l.min=f.samplerData.data.minValue,l.max=f.samplerData.data.maxValue,l.hasNoDataValues=f.samplerData.data.hasNoDataValues,l.level=this.level,c=!0}else{let f,y,_=0;for(let w=this._parent;w&&(!y||_<s)&&(_=this.elevationLevel-w.level,f=y||f,y=w.layerInfo[0][e].data,!(!y&&f&&w.level<=n));w=w.parent);y=y||f,y&&(y.computeMinMaxValue(this._lij[0],this._lij[1],this._lij[2],l),l.min!==1/0&&(l.level=y.level,c=!0))}c&&(r.elevationBounds==null&&(r.elevationBounds=new I3),r.elevationBounds.copyFrom(l))}modifyLayers(e,i,r){const s=this.layerInfo[r];for(const o of s)o.loadingAgent&&o.loadingAgent!==lc&&(ek(o.loadingAgent),o.loadingAgent=null),o.waitingAgents.clear();for(let o=0;o<s.length;++o)e[o]===void 0&&s[o].release();const n=new Array(...s),a=i.length;s.length=a;for(let o=0;o<a;o++){const l=i[o];s[o]=l>-1?n[l]:RF.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()}restartAgents(e){this.renderData&&(this._createOrUpdateAgents(0,e),this.updateRenderData(e,0))}updateAgents(e){if(this.renderData){const i=this.layerInfo[e];for(const r of i)r.loadingAgent===lc&&(r.loadingAgent=null);this._createOrUpdateAgents(0,e)}}updateAgentSuspension(){for(const e of zT){const i=this._isSuspended(e);for(const r of this.layerInfo[e])r.loadingAgent&&r.loadingAgent!==lc&&(r.loadingAgent.setSuspension(i),r.loadingAgent===lc&&this.updateRenderData(e,0))}}removeLayerAgent(e,i){const r=this.layerInfo[i][e];r.loadingAgent&&r.loadingAgent!==lc&&r.loadingAgent.dispose(),r.loadingAgent=null}agentDone(e,i){const r=this.layerInfo[i][e];r.loadingAgent=lc,r.data||r.upsampleInfo!=null||this._createOrUpdateAgents(e+1,i)}_hasBlendableAncestor(e){return e.blendMode!=="normal"||PC(e.parent)&&this._hasBlendableAncestor(e.parent)}_hasBlendModes(e,i,r){for(let s=e;s<i;++s){const n=this._surface.layerViewByIndex(s,r);if(SD(n)&&n?.layer?.blendMode!=="normal"||PC(n?.layer?.parent)&&this._hasBlendableAncestor(n?.layer?.parent))return!0}return!1}_createOrUpdateAgents(e,i){const r=this.layerInfo[i];if(r.length===0)return;const s=this._isSuspended(i);for(let n=e;n<r.length;++n){const a=r[n],o=this._surface.layerViewByIndex(n,i);let l=!1;if(a.loadingAgent?Iw(this,o)?(a.loadingAgent!==lc&&a.loadingAgent.setSuspension(s),a.loadingAgent!==lc&&(l=a.loadingAgent.update())):a.dispose():Iw(this,o)&&(a.loadingAgent=BTt(this,n,i,s),l=a.loadingAgent.startLoading(),l?a.loadingAgent===lc&&this.setPendingUpdate(8):(ek(a.loadingAgent),a.loadingAgent=lc)),a.loadingAgent===lc&&this.updateRenderData(i,0),!o.destroyed&&!this._hasBlendModes(e,r.length,i)&&l&&o.isOpaque)return}}_isWithinExtent(e){const i=this.extent;return i[0]>=e[0]&&e[2]>=i[2]&&i[1]>=e[1]&&e[3]>=i[3]}intersectsExtent(e){const i=this.extent;return i[2]>=e[0]&&e[2]>=i[0]&&i[3]>=e[1]&&e[3]>=i[1]}getElevationVerticesPerSide(e){const i=this.elevationLevel-this.level,r=Math.max(this.level-e,this.elevationLevelDelta-i),s=Se(1+(this._maxTesselation>>r),2,this._maxTesselation+1),n=this.minimumVerticesPerSide;return Math.max(s,n)}_findLIJ(e,i){if(!e)return null;const r=this.surface.rootTiles;if(r!=null){for(const s of r)if(qTt(s,e)){let n=s,a=e[0]-n.level-1;for(;a>=0&&!n.leaf&&!i(n);){const o=e[1]>>a&1,l=e[2]>>a&1;n=n.children[2*o+l],a--}return i(n)?n:null}}return null}findNeighborTile(e,i){const r=this._lij,s=this._getNeighborLIJ(r,e);return s?IF(r,s)?i(this)?this:null:this._findLIJ(s,i):null}findCorner(e,i){const r=e===1?1:e===7?0:e===5?2:3;let s=this;for(;s.children[0]&&(!i||!i(s));)s=s.children[r];return s}findNeighborCornerTileExact(e,i){return this.findNeighborTile(e,r=>i(r)||r.level===this.level)?.findCorner(vV(e),i)||null}forAllSubtreeOnSide(e,i){const r=e===0?[0,1]:e===1?[1]:e===2?[1,3]:e===3?[3]:e===4?[2,3]:e===5?[2]:e===6?[0,2]:[0],s=n=>{const a=n.children;!i(n)&&a[0]&&r.forEach(o=>s(a[o]))};s(this)}getNeighborEdgeStartVertexIndex(e,i){if(!i)return 0;const r=this.level-i.level;if(Be(!Yn||r>=0),r===0)return 0;const s=2**r,n=!(1&~e),a=n?0:1,o=i.lij[a+1]*s,l=this._lij[a+1],c=l-o,h=n?s-1-c:c;return Yn&&(Be(o<=l&&l<o+s),Be(0<=h&&h<s)),h}forEachLoadedNeighbor(e){const i=this.level,r=s=>s.level===i||s.loaded;cp.forEach(s=>{const n=this.findNeighborTile(s,r);n!=null&&n!==this&&n.forAllSubtreeOnSide(Hre(s),a=>!!a.loaded&&(e(a,s),!0))}),bV.forEach(s=>{const n=this.findNeighborTile(s,r)?.findCorner(vV(s),a=>a.loaded);Be(!n||VX(this,n,s)),n?.loaded&&e(n,s)})}_getNeighborLIJ(e,i){const r=Gye(i)?-1:qye(i)?1:0,s=Bye(i)?-1:jye(i)?1:0,n=[e[0],e[1]+r,e[2]+s];return n[1]<0?null:this.surface.isGlobal?this._wrapLIJ(n):n[2]<0?null:n}_wrapLIJ(e){return!e||e[1]<0||e[1]>=2**e[0]?null:this.surface.wrapEastWest(e)}isEdgeNeighbor(e,i){if(e==null)return!1;if(this.level===0&&e.level===0&&(this._eastEnd&&e._westEnd&&i===2||this._westEnd&&e._eastEnd&&i===6))return!0;const r=Math.max(1e-6*(this.extent[2]-this.extent[0]),1);switch(i){case 0:return Uh(this.extent[3],e.extent[1],r);case 4:return Uh(this.extent[1],e.extent[3],r);case 2:return Uh(this.extent[2],e.extent[0],r)||Uh(this.extent[2],-e.extent[0],r);case 6:return Uh(this.extent[0],e.extent[2],r)||Uh(this.extent[0],-e.extent[2],r)}}get _eastEnd(){return this._lij[2]===this.surface.lijEastEnd(this.level)-1}get _westEnd(){return this._lij[2]===0}checkGeometryWaterproofness(){yV&&(Be(this.loaded),this.renderData?.checkGeometryWaterproofness())}shouldHaveNeighbor(e){const i=this.extent,r=this.surface.rootTilesExtent,s=.25*(i[2]-i[0]);if(Gye(e)&&i[3]+s>=r[3]||qye(e)&&i[1]-s<=r[1])return!1;const n=this.surface.isGlobal;return!(!n&&Bye(e)&&i[0]-s<=r[0])&&!(!n&&jye(e)&&i[2]+s>=r[2])}updateDistanceToPOI(e){const i=this._lastPOI;if(this.distanceToPOI>=0&&i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2])return;de(this._lastPOI,e);const r=this._center[1],s=e[0]-r[0],n=e[1]-r[1],a=e[2]-r[2];this.distanceToPOI=s*s+n*n+a*a}updateOverlayParameters(e){const{renderData:i}=this;if(!i)return;const{overlays:r,longitudeCyclical:s}=e,n=i.overlay;if(r.length===0)this._clearTileOverlayData(0,n),this._clearTileOverlayData(1,n);else{const[a,o]=r,l=this.extent;xqe(a.extent,l,s)||Gue(l,a.extent,s)||Gue(l,o.extent,s)?(this._setOverlayData(r,s,l,0,n),this._setOverlayData(r,s,l,1,n)):(this._clearTileOverlayData(0,n),this._clearTileOverlayData(1,n))}}_setOverlayData(e,i,r,s,n){const a=e[s].extent,o=oo(a),l=Bl(a);let c=r[0];if(i){c=i.minimalMonotonic(a[0],c);const h=i.minimalMonotonic(a[0],r[2]);c>h&&(c=h-(r[2]-r[0]))}n.setScale(s,oo(r)/o,Bl(r)/l),n.setOffset(s,(c-a[0])/o,(r[1]-a[1])/l)}_clearTileOverlayData(e,i){i.setScale(e,-1,-1),i.setOffset(e,-1,-1)}};function BTt(t,e,i,r){const s=i===0?lse.acquire():ose.acquire();return s.init(t,e,i,r),s}function ek(t){t.dispose(),LTt(t)?lse.release(t):FTt(t)&&ose.release(t)}const ose=new Wl(()=>new zTt),lse=new Wl(()=>new ITt),jTt=new I3;function qTt(t,e){const i=t.lij,r=e[0]-i[0];return!(r<0)&&e[1]>>r===i[1]&&e[2]>>r===i[2]}function IF(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function VX(t,e,i){return t!=null&&e!=null&&e!==t&&(t.level>=e.level?V0e(t,e,i):V0e(e,t,vV(i)))}function V0e(t,e,i){Be(t.level>=e.level);const r=v2t(i),s=b2t(i),n=t.extent,a=e.extent,o=[r?n[0]:n[2],s?n[3]:n[1]],l=[r?a[2]:a[0],s?a[1]:a[3]],c=1e-5*(n[2]-n[0]),h=Uh(o[0],l[0],c)||t.surface.isGlobal&&Uh(o[0],-l[0],c),f=Uh(o[1],l[1],c);if(h&&f)return!0;if(t.level===e.level||!h&&!f)return Be(!1),!1;const y=h?U0e(a[1],a[3],n[1],n[3],c):U0e(a[0],a[2],n[0],n[2],c);return Be(y),y}function U0e(t,e,i,r,s){return t-s<=i&&i<=r&&r<=e+s}const tk=R(),zG=R(),FG=R(),La=R(),GTt=R(),HTt=65536;function WTt(t,e){const{tile:i,geometry:r,geometryState:s}=t,{extentInRadians:n,surface:a}=i,{isWebMercator:o,renderer:l}=a,{numVerticesPerSide:c,wireframe:h}=s,f=c-1,y=(c-2)**2,_=o&&(e===2||e===3),w=o&&(e===1||e===3),x=((_?1:0)+(w?1:0))*LF*c,S=e5e(s),$=y+x+4*S,A=l.tileGeometryCache.acquire($);r.numVerticesPerSide=c,r.vertexAttributes=A,r.maxEdgeVertexCount=S;const{boundingBox:M}=r;Nc(M);const P=use(t);za.update(f,n,P),YTt(t),r.poleVerticesStartIndex=y;const O=ZTt(t,_,w);r.edgeVerticesStartIndex=y+x,dse(t),cse(t),HIe(r,O,h),t.intersectionData=null}function ZTt(t,e,i){const{tile:r,localOrigin:s,geometry:n}=t,{extent:a,ellipsoid:o}=r,{boundingBox:l,numVerticesPerSide:c,vertexAttributes:h,poleVerticesStartIndex:f}=n,y=c-1,_=s[0],w=s[1],x=s[2],S=o.radius,$=a[1],A=a[3],M=[];let P=f;const O=(D,L)=>{const F=L*c;Yh(-_,-w,D*S-x,l),M.push(new p3t(D===1,F,D===1?0:2,P,LF));const U=BIe(D===-1?$:A,S),N=D*Math.PI/2-U,j=.99*(D===1?1:-1),B=S+0,{position:Y,uv0:G}=h,{typedBuffer:Z,typedBufferStride:H}=h.normalCompressed;for(let Q=1;Q<=LF;++Q){const X=U+N*(Q/LF),ye=Math.cos(X),De=Math.sin(X);for(let q=0;q<=y;q++){const ne=q/y,ce=za.sinLonLUT[q],be=za.cosLonLUT[q]*ye,ze=ce*ye,Ne=De,at=be*B-_,Tt=ze*B-w,et=Ne*B-x;Yh(at,Tt,et,l),Y.setValues(P,at,Tt,et),G.setValues(P,Math.round(ne*An),Math.round(j*An)),Kx(Z,P,be,ze,Ne,H),++P}}};return e&&O(-1,0),i&&O(1,y),M}function YTt(t){const{tile:e}=t;if(!e.intersectsClippingArea)return;const{geometry:i,geometryState:r,localOrigin:s}=t,{numVerticesPerSide:n,samplerData:a}=r,o=n-2,l=n-1,{vertexAttributes:c,boundingBox:h}=i,{position:f,uv0:y}=c,{typedBuffer:_,typedBufferStride:w}=c.normalCompressed,{extent:x}=e,S=x[0],$=x[2],A=x[1],M=x[3],P=e.ellipsoid.radius,O=s[0],D=s[1],L=s[2],F=f.typedBuffer,U=f.typedBufferStride,N=1/l;let j=0;if(1<=o){const B=N,Y=A*(1-B)+M*B,G=za.sinLatLUT[1],Z=za.cosLatLUT[1];for(let H=1;H<=o;H++){const Q=H*N,X=S*(1-Q)+$*Q,ye=za.sinLonLUT[H],De=za.cosLonLUT[H],q=P+ls(X,Y,a),ne=q*De*Z-O,ce=q*ye*Z-D,be=q*G-L;Yh(ne,ce,be,h);const ze=(H-1)*U;F[ze]=ne,F[ze+1]=ce,F[ze+2]=be,y.setValues(H-1,Math.round(Q*An),Math.round(B*An))}}for(let B=1;B<=o;B++){const Y=B*N,G=A*(1-Y)+M*Y,Z=za.sinLatLUT[B],H=za.cosLatLUT[B],Q=B+1,X=Q*N,ye=A*(1-X)+M*X,De=za.sinLatLUT[Q],q=za.cosLatLUT[Q],ne=za.sinLonLUT[0],ce=za.cosLonLUT[0],be=P+ls(S,G,a);let ze=ce*H*be-O,Ne=ne*H*be-D,at=Z*be-L;const Tt=j*U;let et=F[Tt],It=F[Tt+1],$t=F[Tt+2];for(let Ct=1;Ct<=o;Ct++){const jt=Ct*N,Ue=S*(1-jt)+$*jt,Ft=za.sinLonLUT[Ct],qe=za.cosLonLUT[Ct];let je=0,gt=0,ct=0;if(Ct<o){const Ei=(j+1)*U;je=F[Ei],gt=F[Ei+1],ct=F[Ei+2]}else{const Ei=za.sinLonLUT[l],Er=za.cosLonLUT[l],Fr=P+ls($,G,a);je=Er*H*Fr-O,gt=Ei*H*Fr-D,ct=Z*Fr-L}const Ot=ze,Xe=Ne,We=at;ze=et,Ne=It,at=$t,et=je,It=gt,$t=ct;const Ye=je-Ot,rt=gt-Xe,Zt=ct-We;let Li=0,Ci=0,ei=0;if(B>1){const Ei=(j-o)*U;Li=F[Ei],Ci=F[Ei+1],ei=F[Ei+2]}else{const Ei=za.sinLatLUT[0],Er=za.cosLatLUT[0],Fr=P+ls(Ue,A,a);Li=qe*Er*Fr-O,Ci=Ft*Er*Fr-D,ei=Ei*Fr-L}const Gi=P+ls(Ue,ye,a),Ui=qe*q*Gi-O,gi=Ft*q*Gi-D,yi=De*Gi-L;if(B<o){const Ei=j+o,Er=Ei*U;F[Er]=Ui,F[Er+1]=gi,F[Er+2]=yi,Yh(Ui,gi,yi,h),y.setValues(Ei,Math.round(jt*An),Math.round(X*An))}const ti=Li-Ui,wt=Ci-gi,Nt=ei-yi;let Vt=qe*H,Mi=Ft*H,Mr=Z;Mr*Mr<.999&&(Vt=Zt*wt-rt*Nt,Mi=Ye*Nt-Zt*ti,Mr=rt*ti-Ye*wt);const Bi=1/Math.sqrt(Vt*Vt+Mi*Mi+Mr*Mr);Kx(_,j,Vt*Bi,Mi*Bi,Mr*Bi,w),++j}}}function QTt(t){t.tile.intersectsClippingArea&&(cse(t),OM(t),t.intersectionData=null)}function XTt(t){t.tile.intersectsClippingArea&&(YIe(t),cse(t),OM(t),JIe(t),t.intersectionData=null)}function JTt(t){t.tile.intersectsClippingArea&&(UIe(t),VIe(t,!0),OM(t),t.intersectionData=null)}function cse(t){t.tile.intersectsClippingArea&&(UIe(t),VIe(t))}function VIe(t,e=!1){const{geometry:i,geometryState:r,tile:s,localOrigin:n}=t,{level:a,extent:o,extentInRadians:l,ellipsoid:c}=s,h=c.radius,f=l[0],y=l[2],_=l[1],w=l[3],{samplerData:x}=r,S=o[0],$=o[2],A=o[1],M=o[3],P=use(t),{boundingBox:O,vertexAttributes:D}=i,L=n[0],F=n[1],U=n[2],{position:N,uv0:j}=D,B=N.typedBuffer,Y=N.typedBufferStride;for(let G=0;G<4;++G){const Z=G===1||G===3,H=r.edgeResolutions[G];Be(Dx(H));const Q=H+1,X=Hb(s,r.edgePeerNeighbors[G]);if(KIe(s,X,G)){QIe(t,G,X);continue}const ye=X!=null;Be(!ye||X.level===s.level),Be(!ye||Vf(s,X)<=0);const De=X?.renderData,q=De?.geometryState;if(Yn){const Ye=s.surface;if(!X&&Ye&&!Ye.updatingRootTiles){const rt=cp[G],Zt=s.findNeighborTile(rt,Li=>Li.loaded||Li.leaf||Li.level===s.level);Zt?Zt.intersectsClippingArea&&(Be(!Zt.loaded),Be(!Zt.leaf),Be(Zt.level===a)):Be(Ye?.rootTiles==null||!s.shouldHaveNeighbor(rt))}}const ne=G===1?o[2]:o[0],ce=X?.extent,be=ce&&Z?G===1?ce[0]:ce[2]:ne,ze=G===0?o[3]:o[1],Ne=G===1?1:0,at=G===0?1:0,Tt=G===1?y:f,et=G===0?w:_,It=Math.sin(Tt),$t=Math.cos(Tt),Ct=Math.sin(et),jt=Math.cos(et),Ue=q?.samplerData,Ft=ye?(Ye,rt,Zt)=>.5*(ls(Ye,rt,x)+ls(Zt,rt,Ue)):(Ye,rt,Zt)=>ls(Ye,rt,x),qe=i.outerEdgesOffsetAndLength[2*G+0],je=e&&Q>3?Q-3:1,gt=x!=null&&x.some(Ye=>Ye!=null),ct=Ue!=null&&Ue.some(Ye=>Ye!=null),Ot=gt||ct,Xe=1/H,We=qe;Be(!ce||Uh(ce[2]-ce[0],o[2]-o[0])),(()=>{const Ye=G===1?-1:G===3?1:0,rt=G===0?-1:G===2?1:0,Zt=(o[2]-o[0])*Xe,Li=Ye*Zt,Ci=rt*Zt,ei=Z?Ye*((y-f)*Xe):0,Gi=Z?0:rt*Xe,Ui=at,gi=Z?Tt+ei:Tt,yi=Z?Math.sin(gi):It,ti=Z?Math.cos(gi):$t,wt=Z?Tt-ei:Tt,Nt=Z?Math.sin(wt):It,Vt=Z?Math.cos(wt):$t,Mi=Z?et:P(Ui+Gi),Mr=Z?Ct:Math.sin(Mi),Bi=Z?jt:Math.cos(Mi),Ei=Z?et:P(Ui-Gi),Er=Z?Ct:Math.sin(Ei),Fr=Z?jt:Math.cos(Ei);let gs=0,ia=0,ln=0;{const Jt=0*Xe,Nr=Z?ne:S*(1-Jt)+$*Jt,Hi=Z?be:Nr,Ss=Z?A*(1-Jt)+M*Jt:ze,Je=Z?Tt:f*(1-Jt)+y*Jt,Ha=Z?It:Math.sin(Je),mo=Z?$t:Math.cos(Je),er=Z?P(Jt):et,ra=Z?Math.sin(er):Ct,Rs=Z?Math.cos(er):jt,vi=h+Ft(Nr,Ss,Hi);gs=mo*Rs*vi,ia=Ha*Rs*vi,ln=ra*vi}let fo=0,ue=0,ii=0;{const Jt=1*Xe,Nr=Z?ne:S*(1-Jt)+$*Jt,Hi=Z?be:Nr,Ss=Z?A*(1-Jt)+M*Jt:ze,Je=Z?Tt:f*(1-Jt)+y*Jt,Ha=Z?It:Math.sin(Je),mo=Z?$t:Math.cos(Je),er=Z?P(Jt):et,ra=Z?Math.sin(er):Ct,Rs=Z?Math.cos(er):jt,vi=h+Ft(Nr,Ss,Hi);fo=mo*Rs*vi,ue=Ha*Rs*vi,ii=ra*vi}for(let Jt=1;Jt<Q-1;Jt+=je){let Nr=0,Hi=0,Ss=0;{const ji=(Jt+1)*Xe,Ra=Z?ne:S*(1-ji)+$*ji,Vr=Z?be:Ra,Dn=Z?A*(1-ji)+M*ji:ze,qc=Z?Tt:f*(1-ji)+y*ji,No=Z?It:Math.sin(qc),dl=Z?$t:Math.cos(qc),od=Z?P(ji):et,sa=Z?Math.sin(od):Ct,Dp=Z?Math.cos(od):jt,Ip=h+Ft(Ra,Dn,Vr);Nr=dl*Dp*Ip,Hi=No*Dp*Ip,Ss=sa*Ip}const Je=Nr,Ha=Hi,mo=Ss,er=fo,ra=ue,Rs=ii;fo=Je,ue=Ha,ii=mo;{const ji=We+Jt,Ra=ji*Y,Vr=er-L,Dn=ra-F,qc=Rs-U;B[Ra]=Vr,B[Ra+1]=Dn,B[Ra+2]=qc,Yh(Vr,Dn,qc,O);const No=Jt*Xe,dl=Z?Ne:No,od=Z?No:at;j.setValues(ji,Math.round(dl*An),Math.round(od*An))}const vi=gs,Pa=ia,nd=ln;gs=er,ia=ra,ln=Rs;const qt=er,om=ra,ad=Rs,lm=1/Math.sqrt(qt*qt+om*om+ad*ad),Rp=ad*lm;let Jl=0,hl=0,go=0;if(Ot&&Rp*Rp<.999){let ji=0,Ra=0,Vr=0;{const Dn=G===0?-1:1;ji=Dn*(Je-vi),Ra=Dn*(Ha-Pa),Vr=Dn*(mo-nd)}{const Dn=Jt*Xe,qc=Z?ne:S*(1-Dn)+$*Dn,No=Z?be:qc,dl=Z?A*(1-Dn)+M*Dn:ze,od=Z?Tt:f*(1-Dn)+y*Dn,sa=Z?It:Math.sin(od),Dp=Z?$t:Math.cos(od),Ip=Z?P(Dn):et,ld=Z?Math.sin(Ip):Ct,Lp=Z?Math.cos(Ip):jt;let W=qt,he=om,Ve=ad;if(ye){const Pt=h+ls(No-Li,dl-Ci,Ue),ki=Z?Lp:Fr;W=(Z?Vt:Dp)*ki*Pt,he=(Z?Nt:sa)*ki*Pt,Ve=(Z?ld:Er)*Pt}{const Pt=h+ls(qc+Li,dl+Ci,x),ki=Z?Lp:Bi,is=(Z?ti:Dp)*ki*Pt,ys=(Z?yi:sa)*ki*Pt,In=(Z?ld:Mr)*Pt;ye||(W=2*qt-is,he=2*om-ys,Ve=2*ad-In);const Vo=G===3?-1:1,w2=Vo*(W-is),kM=Vo*(he-ys),x2=Vo*(Ve-In);Jl=Vr*kM-Ra*x2,hl=ji*x2-Vr*w2,go=Ra*w2-ji*kM;const kp=1/Math.sqrt(Jl*Jl+hl*hl+go*go);Jl*=kp,hl*=kp,go*=kp}}}else Jl=qt*lm,hl=om*lm,go=ad*lm;i.setEdgeNormalFromValues(G,Jt,Jl,hl,go)}})()}}function UIe(t){XIe(t)}function BIe(t,e){return Math.PI/2-2*Math.atan(Math.exp(-t/e))}function KTt(t,e,i,r){return BIe(t*(1-r)+e*r,i)}function e3t(t,e,i){return t*(1-i)+e*i}function use(t){const{tile:e}=t;if(e.surface.isWebMercator){const r=e.extent,s=e.ellipsoid.radius;return n=>KTt(r[1],r[3],s,n)}const i=e.extentInRadians;return r=>e3t(i[1],i[3],r)}function t3t(t,e){const{tile:i,geometryState:r,geometry:s}=t,{extent:n,surface:a}=i,{wireframe:o}=r,l=n[0],c=n[1],h=n[2]-l,f=n[3]-c,{numVerticesPerSide:y,clippingArea:_}=r,w=_!=null?Math.max(0,(_[0]-l)/h):0,x=_!=null?Math.max(0,(_[1]-c)/f):0,S=_!=null?Math.min(1,(_[2]-l)/h):1,$=_!=null?Math.min(1,(_[3]-c)/f):1,A=(y-2)**2,M=e5e(r),P=A+4*M,O=a.renderer.tileGeometryCache.acquire(P),{boundingBox:D}=s;Nc(D),s.numVerticesPerSide=y,s.vertexAttributes=O,s.maxEdgeVertexCount=M,s.minu=w,s.minv=x,s.maxu=S,s.maxv=$,i3t(t),s.edgeVerticesStartIndex=A,dse(t),hse(t),HIe(s,[],o),t.intersectionData=null}function i3t(t){const e=t.tile;if(!e.intersectsClippingArea)return;const{geometry:i,geometryState:r,localOrigin:s}=t,{samplerData:n,clippingArea:a,numVerticesPerSide:o}=r,{surface:l,extent:c,ellipsoid:h}=e,{isWebMercatorOnPlateCarree:f}=l,y=a??pse,_=c[0],w=c[1],x=c[2],S=c[3],$=Math.max(_,y[0]),A=Math.min(x,y[2]),M=Math.max(w,y[1]),P=Math.min(S,y[3]),O=h.radius,D=e.horizontalScale,L=o-1,F=o-2,{minu:U,minv:N,maxu:j,maxv:B,boundingBox:Y,vertexAttributes:G}=i,{position:Z,uv0:H}=G,{typedBuffer:Q,typedBufferStride:X}=G.normalCompressed,ye=s[0],De=s[1],q=s[2],ne=Z.typedBuffer,ce=Z.typedBufferStride;let be=0;const ze=Se(w,M,P),Ne=f?(Math.PI/2-2*Math.atan(Math.exp(-ze/O)))*O:ze*D,at=1/L,Tt=Se(w*(1-at)+S*at,M,P);let et=Ne,It=f?(Math.PI/2-2*Math.atan(Math.exp(-Tt/O)))*O:Tt*D;for(let $t=1;$t<=F;$t++){const Ct=$t/L,jt=Se(w*(1-Ct)+S*Ct,M,P),Ue=Se(Ct,N,B),Ft=It,qe=($t-1)/L,je=Se(w*(1-qe)+S*qe,M,P),gt=et,ct=($t+1)/L,Ot=Se(w*(1-ct)+S*ct,M,P),Xe=f?(Math.PI/2-2*Math.atan(Math.exp(-Ot/O)))*O:Ot*D,We=Se(ct,N,B);et=It,It=Xe;const Ye=Se(_,$,A);let rt=Ye*D,Zt=ls(Ye,jt,n);const Li=1/L,Ci=Se(Li,U,j),ei=Se(_*(1-Ci)+x*Ci,$,A);let Gi=Ci,Ui=ei,gi=ei*D,yi=ls(ei,jt,n);if($t===1){const ti=gi-ye,wt=et-De,Nt=yi-q,Vt=0*ce;ne[Vt]=ti,ne[Vt+1]=wt,ne[Vt+2]=Nt,Yh(ti,wt,Nt,Y);const Mi=Se(Li,U,j);H.setValues(be,Math.round(Mi*An),Math.round(Ue*An))}for(let ti=1;ti<=F;ti++){const wt=gi,Nt=yi,Vt=(ti+1)/L,Mi=Se(Vt,U,j),Mr=Se(_*(1-Vt)+x*Vt,$,A),Bi=Ui;Ui=Mr;{const ue=be+1,ii=ue*ce;if($t===1||ti===F){const Jt=Mr*D,Nr=ls(Mr,jt,n);if($t===1&&ti<F){const Hi=Jt-ye,Ss=Ft-De,Je=Nr-q;ne[ii]=Hi,ne[ii+1]=Ss,ne[ii+2]=Je,Yh(Hi,Ss,Je,Y),H.setValues(ue,Math.round(Mi*An),Math.round(Ue*An))}gi=Jt,yi=Nr}else gi=ne[ii]+ye,yi=ne[ii+2]+q}const Ei=gi,Er=yi,Fr=rt,gs=Zt;rt=wt,Zt=Nt;const ia=(be-F)*ce,ln=$t===1?ls(Bi,je,n):ne[ia+2]+q,fo=ls(Bi,Ot,n);if($t<F){const ue=be+F,ii=ue*ce,Jt=wt-ye,Nr=Xe-De,Hi=fo-q;ne[ii]=Jt,ne[ii+1]=Nr,ne[ii+2]=Hi,Yh(Jt,Nr,Hi,Y);const Ss=Gi;Gi=Mi,H.setValues(ue,Math.round(Ss*An),Math.round(We*An))}{const ue=Ei-Fr,ii=gt-Xe,Jt=ii*(Er-gs),Nr=ue*(ln-fo),Hi=-ii*ue,Ss=Jt*Jt+Nr*Nr+Hi*Hi;if(Ss===0)Kx(Q,be,0,0,1,X);else{const Je=1/Math.sqrt(Ss);Kx(Q,be,Jt*Je,Nr*Je,Hi*Je,X)}}++be}}}function r3t(t,e){t.tile.intersectsClippingArea&&(qIe(t),jIe(t,!0),OM(t),t.intersectionData=null)}function s3t(t,e){t.tile.intersectsClippingArea&&(YIe(t),hse(t),OM(t),JIe(t),t.intersectionData=null)}function n3t(t,e){t.tile.intersectsClippingArea&&(hse(t),OM(t),t.intersectionData=null)}function hse(t,e){t.tile.intersectsClippingArea&&(qIe(t),jIe(t,!1))}function jIe(t,e){const{geometry:i,geometryState:r,localOrigin:s}=t,n=t.tile,{surface:a,extent:o}=n,{clippingArea:l,samplerData:c}=r,h=l??pse,f=o[0],y=o[2],_=o[1],w=o[3],x=[w>h[3],y>h[2],_<h[1],f<h[0]],S=n.horizontalScale,$=GIe(a.isWebMercatorOnPlateCarree,n.ellipsoid.radius,S),{minu:A,minv:M,maxu:P,maxv:O,boundingBox:D}=i,L=Math.max(f,h[0]),F=Math.min(y,h[2]),U=Math.max(_,h[1]),N=Math.min(w,h[3]),j=s[0],B=s[1],Y=s[2];for(let G=0;G<4;++G){const Z=G===1||G===3,H=r.edgeResolutions[G];Be(Dx(H));const Q=H+1,X=x[G],ye=Hb(n,r.edgePeerNeighbors[G]);if(!X&&KIe(n,ye,G)){QIe(t,G,ye);continue}const De=ye!=null&&!X,q=ye?.renderData,ne=q?.geometryState;if(Yn&&(Be(!De||ye.level===n.level),Be(!De||Vf(n,ye)<=0),n&&!ye&&!a.updatingRootTiles)){const Xe=cp[G],We=n.findNeighborTile(Xe,Ye=>Ye.loaded||Ye.leaf||Ye.level===n.level);a.updatingRootTiles||(We?We.intersectsClippingArea&&(Be(!We.loaded),Be(!We.leaf),Be(We.level===n.level)):Be(a?.rootTiles==null||!n.shouldHaveNeighbor(Xe)))}const ce=Se(G===1?y:f,L,F),be=Se(G===0?w:_,U,N),ze=ne?.samplerData,Ne=e&&Q>3?Q-3:1,at=Se(G===1?1:0,A,P),Tt=Se(G===0?1:0,M,O),et=De?(Xe,We)=>.5*(ls(Xe,We,ze)+ls(Xe,We,c)):(Xe,We)=>ls(Xe,We,c),It=(y-f)/H,$t=Z?G===1?It:-It:0,Ct=Z?0:G===0?It:-It,jt=-$t,Ue=-Ct;let Ft=0,qe=0,je=0;{const Xe=0/H,We=Z?ce:Se(f*(1-Xe)+y*Xe,L,F),Ye=Z?Se(_*(1-Xe)+w*Xe,U,N):be,rt=et(We,Ye);Ft=We*S,qe=$(Ye),je=rt}let gt=0,ct=0,Ot=0;{const Xe=1/H,We=Z?ce:Se(f*(1-Xe)+y*Xe,L,F),Ye=Z?Se(_*(1-Xe)+w*Xe,U,N):be,rt=et(We,Ye);gt=We*S,ct=$(Ye),Ot=rt}for(let Xe=1;Xe<Q-1;Xe+=Ne){const We=Xe/H,Ye=gt,rt=ct,Zt=Ot;{const Nt=Z?at:Se(We,A,P),Vt=Z?Se(We,M,O):Tt,Mi=Ye-j,Mr=rt-B,Bi=Zt-Y;Yh(Ye,Mr,Bi,D),i.setEdgeVertexFromValuesRawPositionUV(G,Xe,Mi,Mr,Bi,Nt,Vt)}{const Nt=(Xe+1)/H,Vt=Z?ce:Se(f*(1-Nt)+y*Nt,L,F),Mi=Z?Se(_*(1-Nt)+w*Nt,U,N):be,Mr=et(Vt,Mi);gt=Vt*S,ct=$(Mi),Ot=Mr}const Li=gt,Ci=Ot,ei=Ft,Gi=qe,Ui=je;Ft=Ye,qe=rt,je=Zt;let gi=0,yi=0,ti=0;if(Z){const Nt=ct-rt,Vt=Ci-Zt,Mi=Gi-rt,Mr=Ui-Zt,Bi=Se(_*(1-We)+w*We,U,N),Ei=ce+jt,Er=Ei*S-Ye,Fr=ls(Ei,Bi,c)-Zt,gs=G===3?-1:1;if(gi=gs*(-Mi+Nt)*Fr,yi=gs*Er*(-Mr+Vt),ti=-gs*Er*(-Mi+Nt),De){const ia=ce+$t,ln=ia*S-Ye;gi=(-Mi+Nt)*(Fr-(ls(ia,Bi,ze)-Zt)),yi=(Er-ln)*(-Mr+Vt),ti=-(Er-ln)*(-Mi+Nt)}}else{const Nt=Li-Ye,Vt=Ci-Zt,Mi=ei-Ye,Mr=Ui-Zt,Bi=Se(f*(1-We)+y*We,L,F),Ei=be+Ue,Er=ls(Bi,Ei,c)-Zt,Fr=$(Ei)-rt,gs=G===2?-1:1;if(gi=gs*Fr*(-Mr+Vt),yi=gs*(-Mi+Nt)*Er,ti=-gs*Fr*(-Mi+Nt),De){const ia=Bi,ln=be+Ct,fo=$(ln)-rt;gi=(-Fr+fo)*(-Mr+Vt),yi=(-Mi+Nt)*(-Er+(ls(ia,ln,ze)-Zt)),ti=-(-Fr+fo)*(-Mi+Nt)}}const wt=1/Math.sqrt(gi*gi+yi*yi+ti*ti);i.setEdgeNormalFromValues(G,Xe,gi*wt,yi*wt,ti*wt)}}}function qIe(t,e){XIe(t)}function a3t(t,e){return(Math.PI/2-2*Math.atan(Math.exp(-t/e)))*e}function o3t(t,e){return t*e}function GIe(t,e,i){return t?r=>a3t(r,e):r=>o3t(r,i)}function HIe(t,e,i){const{numVerticesPerSide:r,vertexAttributes:s,maxEdgeVertexCount:n}=t,a=r-1,o=s.count,l=2*(r-3)*(r-3),c=4*(a+n-3),h=sse.reduce((x,S)=>x+(a+t.getEdgeCount(S)-3),0),f=e.reduce((x,S)=>x+a*(2*(S.latitudeResolution-1)+1),0),y=3*(i?2:1),_=(l+c+f)*y,w=o>=HTt?new Uint32Array(_):new Uint16Array(_);for(let x=0;x<_;++x)w[x]=0;t.indices=w,t.indexCount=(l+h+f)*y,t.poleIndicesStartIndex=l*y,t.edgeIndicesStartIndex=(l+f)*y,i?(u3t(t),h3t(t,e),ZIe(t)):(l3t(t),c3t(t,e),WIe(t))}function l3t(t){const{numVerticesPerSide:e,indices:i,vertexAttributes:r}=t,{position:s}=r,{typedBuffer:n,typedBufferStride:a}=s,o=e-2,l=e-3,c=0,h=e-3;let f=0;for(let y=0;y<l;++y){const _=y*o;for(let w=c;w<h;++w){const x=_+w,S=x+1,$=S+o,A=$-1;t5e(x,S,$,A,a,n)?(i[f]=x,i[f+1]=S,i[f+2]=$,i[f+3]=$,i[f+4]=A,i[f+5]=x):(i[f]=x,i[f+1]=S,i[f+2]=A,i[f+3]=A,i[f+4]=S,i[f+5]=$),f+=6}}}function c3t(t,e){const{numVerticesPerSide:i,indices:r,poleIndicesStartIndex:s}=t,n=i-1;let a=s;for(const o of e){const l=o.isNorth?1:2,c=o.isNorth?2:1,h=o.isNorth?3:4,f=o.isNorth?4:3;let y=t.getEdgeVertexIndex(o.connectedOuterEdgeOffset,0),_=1;for(let w=0;w<o.latitudeResolution;++w){const x=w===0?o.rowOffset:y+i;for(let S=0;S<n;S++){const $=x+S;r[a]=y,r[a+l]=y+1,r[a+c]=$,w<o.latitudeResolution-1?(r[a+h]=y+1,r[a+f]=$+1,r[a+5]=$,a+=6):a+=3,y+=_}y=x,_=1}}}function WIe(t){const{indices:e,numVerticesPerSide:i,edgeIndicesStartIndex:r}=t,s=i-1,n=s-2;let a=r;for(let o=0;o<4;++o){const l=fse[o];let c=0,h=0;const f=t.getEdgeCount(o),y=l.count;Be(y===s-1);const _=o===1||o===2,w=_?1:2,x=_?2:1,S=t.getEdgeFirstVertexIndex(o),$=1,A=l.vertex0Index,M=l.stride;for(;c<f-1||h<y-1;){const P=A+h*M,O=S+c*$,D=c<f-1,L=h<y-1,F=D&&(!L||(D?0+s*(c+.5)/(f-1):0)<=(L?1+n*(h+.5)/(y-1):0));F?++c:++h;const U=F?O+$:P+M;e[a]=P,e[a+w]=O,e[a+x]=U,a+=3}}t.indexCount=a}function u3t(t){const{indices:e,numVerticesPerSide:i,vertexAttributes:r}=t,{position:s}=r,{typedBuffer:n,typedBufferStride:a}=s,o=i-2;let l=0;for(let c=0;c<i-3;++c){const h=c*o;for(let f=0;f<i-3;++f){const y=c*o+f,_=y+1,w=_+o,x=w-1,S=h+f,$=S+1,A=$+o;t5e(S,$,A,A-1,a,n)?(k3(e,l,y,_,w),l+=6,k3(e,l,w,x,y)):(k3(e,l,y,_,x),l+=6,k3(e,l,x,w,_)),l+=6}}}function h3t(t,e){const{indices:i,numVerticesPerSide:r,poleIndicesStartIndex:s}=t,n=r-1;let a=s;for(const o of e){const l=o.connectedOuterEdgeOffset;let c=t.getEdgeVertexIndex(l,0),h=1;for(let f=0;f<o.latitudeResolution;++f){const y=f===0?o.rowOffset:c+r;for(let _=0;_<n;_++)k3(i,a,c,c+1,y+_),a+=6,f<o.latitudeResolution-1&&(k3(i,a,c+1,y+_+1,y+_),a+=6),c+=h;c=y,h=1}}}function ZIe(t){const{indices:e,numVerticesPerSide:i,edgeIndicesStartIndex:r}=t,s=i-1,n=s-2;let a=r;for(let o=0;o<4;++o){const l=fse[o];let c=0,h=0;const f=t.getEdgeCount(o),y=l.count;Be(y===s-1);const _=o===1||o===2,w=_?1:3,x=_?3:1,S=t.getEdgeFirstVertexIndex(o),$=1,A=l.vertex0Index,M=l.stride;for(;c<f-1||h<y-1;){const P=A+h*M,O=S+c*$,D=c<f-1,L=h<y-1,F=D&&(!L||(D?0+s*(c+.5)/(f-1):0)<=(L?1+n*(h+.5)/(y-1):0));F?++c:++h;const U=F?O+$:P+M;e[a]=P,e[a+w]=O,e[a+w+1]=O,e[a+x]=U,e[a+x+1]=U,e[a+5]=P,a+=6}}t.indexCount=a}function dse(t){const{geometry:e,geometryState:i}=t,{edgeResolutions:r}=i,{numVerticesPerSide:s,edgeVerticesStartIndex:n}=e,a=s-2;let o=n;for(let l=0;l<4;++l){{const c=l===0||l===2,h=(l===0?a-1:0)*a+(l===1?a-1:0),f=(c?0:1)*a+(c?1:0),y=fse[l];y.vertex0Index=h,y.stride=f,y.count=a}{const c=r[l]+1;e.outerEdgesOffsetAndLength[2*l+0]=o,e.outerEdgesOffsetAndLength[2*l+1]=c,o+=c}}}function YIe(t){dse(t),t.geometryState.wireframe?ZIe(t.geometry):WIe(t.geometry)}function QIe(t,e,i){const{geometryState:r,geometry:s,tile:n,localOrigin:a}=t,o=e===1||e===3,l=r.edgeResolutions[e];Be(Dx(l));const c=l+1,{boundingBox:h,minu:f,minv:y,maxu:_,maxv:w,vertexAttributes:x}=s,S=Se(e===1?1:0,f,_),$=Se(e===0?1:0,y,w),A=i.renderData,M=A.geometryState,P=A.geometry,O=(e+2)%4,D=P.getEdgeCount(O),L=n.getNeighborEdgeStartVertexIndex(e,i)*l,F=l*2**(n.level-i.level);Be(M.edgeResolutions[O]===F),Be(D-1===F);const U=A.localOrigin[0]-a[0],N=A.localOrigin[1]-a[1],j=A.localOrigin[2]-a[2],B=s.getEdgeFirstVertexIndex(e),{position:Y,uv0:G}=x,Z=Y.typedBuffer,H=Y.typedBufferStride,Q=x.normalCompressed,X=Q.typedBuffer,ye=Q.typedBufferStride,De=P.vertexAttributes,q=P.getEdgeFirstVertexIndex(O),ne=De.position.typedBuffer,ce=De.position.typedBufferStride,be=De.normalCompressed.typedBuffer,ze=De.normalCompressed.typedBufferStride;for(let Ne=1;Ne<c-1;++Ne){const at=B+Ne,Tt=q+(L+Ne),et=at*H,It=Tt*ce,$t=ne[It]+U,Ct=ne[It+1]+N,jt=ne[It+2]+j;Z[et]=$t,Z[et+1]=Ct,Z[et+2]=jt,Yh($t,Ct,jt,h);const Ue=at*ye,Ft=Tt*ze;X[Ue]=be[Ft],X[Ue+1]=be[Ft+1];const qe=Ne/l,je=o?S:Se(qe,f,_),gt=o?Se(qe,y,w):$;G.setValues(at,Math.round(je*An),Math.round(gt*An))}}function XIe(t){const{geometry:e,geometryState:i,localOrigin:r}=t,{clippingArea:s,samplerData:n}=i,{minu:a,minv:o,maxu:l,maxv:c,boundingBox:h,vertexAttributes:f}=e,y=t.tile,{surface:_,ellipsoid:w,extent:x,extentInRadians:S,horizontalScale:$}=y,A=_.view?.viewingMode==="local",M=w.radius;let P=0,O=0,D=0;const L=(Ue,Ft,qe)=>{const je=S[Ft===0?1:3],gt=S[Ue===0?0:2],ct=Math.cos(je),Ot=Math.sin(je),Xe=Math.sin(gt),We=Math.cos(gt),Ye=M+qe;P=We*ct*Ye,O=Xe*ct*Ye,D=Ot*Ye},F=A?(()=>{const Ue=s,Ft=Ue!=null&&(x[3]>Ue[3]||x[2]>Ue[2]||x[1]<Ue[1]||x[0]<Ue[0]),qe=GIe(_.isWebMercatorOnPlateCarree,M,$);return(je,gt,ct)=>{const Ot=je===0?x[0]:x[2],Xe=gt===0?x[1]:x[3],We=Ft?Se(Ot,Ue[0],Ue[2]):Ot,Ye=Ft?Se(Xe,Ue[1],Ue[3]):Xe,rt=ct;P=We*$,O=qe(Ye),D=rt}})():L;let U=0,N=0,j=0,B=0,Y=0,G=0,Z=0,H=0,Q=0;const X=A&&_.isWebMercatorOnPlateCarree,ye=(Ue,Ft,qe,je,gt)=>{let ct=0,Ot=0,Xe=0;if(A){const We=Ft*$,Ye=X?(Math.PI/2-2*Math.atan(Math.exp(-qe/M)))*M:qe*$;ct=We-P,Ot=Ye-O,Xe=je-D}else{const We=use(Ue),Ye=Ue.tile,rt=Ye.extent,Zt=Ye.extentInRadians,Li=(Ft-rt[0])/(rt[2]-rt[0]),Ci=(qe-rt[1])/(rt[3]-rt[1]),ei=Zt[0]*(1-Li)+Zt[2]*Li,Gi=We(Ci),Ui=Math.cos(Gi),gi=Math.sin(Gi),yi=Math.sin(ei),ti=Math.cos(ei),wt=M+je;ct=ti*Ui*wt-P,Ot=yi*Ui*wt-O,Xe=gi*wt-D}switch(gt){case 0:Z+=ct,H+=Ot,Q+=Xe;break;case 1:B-=ct,Y-=Ot,G-=Xe;break;case 2:Z-=ct,H-=Ot,Q-=Xe;break;case 3:B+=ct,Y+=Ot,G+=Xe}},De=s??pse,q=x[0],ne=x[2],ce=x[1],be=x[3],ze=[be>De[3],ne>De[2],ce<De[1],q<De[0]],Ne=Math.max(q,De[0]),at=Math.min(ne,De[2]),Tt=Math.max(ce,De[1]),et=Math.min(be,De[3]),It=Ue=>Math.max(De[0],Math.min(De[2],Ue)),$t=Ue=>Math.max(De[1],Math.min(De[3],Ue)),Ct=Ue=>{const Ft=i.cornerNeighborCornerTiles;U=0,N=0,j=1,B=0,Y=0,G=0,Z=0,H=0,Q=0;let qe=1/0;for(let We=0;We<4;++We){const Ye=Ft[4*Ue+We];qe=Math.min(qe,Ye?.level??1/0)}for(let We=0;We<4;++We){const Ye=Ft[4*Ue+We];TA[We]=Ye?.level===qe?Ye:null}let je=1,gt=0;for(let We=0;We<4;++We){const Ye=TA[We];Ye&&(je=Math.max(je,Ye?.renderData.geometryState.numVerticesPerSide),gt=Ye.extent[2]-Ye.extent[0])}const ct=gt,Ot=je;Be(Ot>1);const Xe=ct/Ot;for(let We=0;We<4;++We){const Ye=TA[(We+3)%4],rt=TA[We%4];if(!Ye&&!rt)continue;const Zt=We===0?1:We===1?2:We===2?3:0,Li=We===0?2:We===1?3:We===2?0:1;if(Ye&&rt){const Ci=NG[We][0]*Xe,ei=NG[We][1]*Xe,Gi=Ye.extent,Ui=It(Gi[Zt===0||Zt===1?2:0]+Ci),gi=$t(Gi[Zt===0||Zt===3?3:1]+ei),yi=rt.extent,ti=It(yi[Li===0||Li===1?2:0]+Ci),wt=$t(yi[Li===0||Li===3?3:1]+ei),Nt=Ye.renderData,Vt=rt.renderData,Mi=ls(Ui,gi,Nt.geometryState.samplerData),Mr=ls(ti,wt,Vt.geometryState.samplerData);ye(Nt,Ui,gi,.5*(Mi+Mr),We)}else{const Ci=Ye??rt,ei=Ye?Zt:Li,Gi=Ci.extent,Ui=NG[We],gi=It(Gi[ei===0||ei===1?2:0]+Ui[0]*Xe),yi=$t(Gi[ei===0||ei===3?3:1]+Ui[1]*Xe),ti=Ci.renderData,wt=ls(gi,yi,ti.geometryState.samplerData);ye(ti,gi,yi,wt,We)}}if(!A){const We=Math.sqrt(P*P+O*O+D*D);U=P/We,N=O/We,j=D/We}if(A||j*j<.999){const We=Math.sqrt(B*B+Y*Y+G*G);B/=We,Y/=We,G/=We;const Ye=Math.sqrt(Z*Z+H*H+Q*Q);Z/=Ye,H/=Ye,Q/=Ye,U=G*H-Y*Q,N=B*Q-G*Z,j=Y*Z-B*H;const rt=1/Math.sqrt(U*U+N*N+j*j);U*=rt,N*=rt,j*=rt}},jt=i.cornerNeighborCornerTiles;for(let Ue=0;Ue<4;++Ue){const Ft=Ue,qe=(Ue+1)%4,je=Ue===0||Ue===1?1:0,gt=Ue===0||Ue===3?1:0,ct=Se(je,a,l),Ot=Se(gt,o,c),Xe=e.getEdgeFirstVertexIndex(Ft),We=e.getEdgeCount(Ft),Ye=Ue===0||Ue===3?We-1:0,rt=e.getEdgeFirstVertexIndex(qe),Zt=e.getEdgeCount(qe),Li=Ue===0||Ue===1?Zt-1:0;let Ci=-1;for(let Ui=0;Ui<4;++Ui){const gi=jt[4*Ue+Ui],yi=jt[4*Ue+Ci];gi&&(Ci===-1||Vf(yi,gi)>0)&&(Ci=Ui)}const ei=Ci,Gi=jt[4*Ue+ei];if(Gi!==y){const Ui=y.level-Gi.level,gi=2**Ui,yi=[Gi.lij[0]+Ui,Gi.lij[1]*gi,Gi.lij[2]*gi],ti=[yi[1]+gi===y.lij[1],Ue===0&&(ei===1||ei===0&&Gi!==jt[4*Ue+3])||Ue===1&&(ei===0||ei===1&&Gi!==jt[4*Ue+2]),yi[1]===y.lij[1]+1,Ue===2&&(ei===3||ei===2&&Gi!==jt[4*Ue+1])||Ue===3&&(ei===2||ei===3&&Gi!==jt[4*Ue+0])],wt=ti.reduce((Bi,Ei)=>Bi+(Ei?1:0),0);Be(wt===1||wt===2);let Nt=-1,Vt=-1;const Mi=Gi.renderData;if(wt===1){const Bi=ti.findIndex(Er=>Er);Be(0<=Bi&&Bi<=3),Nt=(Bi+2)%4;const Ei=i.edgeResolutions[Bi];Vt=y.getNeighborEdgeStartVertexIndex(Bi,Gi)*Ei+Ei*(Bi===0&&Ue===0||Bi===1&&Ue===0||Bi===2&&Ue===1||Bi===3&&Ue===3?1:0)}else{Be(ti[1]||ti[3]),Nt=ti[1]?3:1;const Bi=Mi.geometryState.edgeResolutions[Nt];Vt=Ue===0||Ue===3?0:Bi}const Mr=Mi.geometry;{const Bi=Xe+Ye,Ei=rt+Li,Er=Mr.getEdgeFirstVertexIndex(Nt)+Vt,Fr=Mr.vertexAttributes,gs=Mi.localOrigin,ia=Fr.position,ln=ia.typedBuffer,fo=Er*ia.typedBufferStride,ue=ln[fo]+gs[0]-r[0],ii=ln[fo+1]+gs[1]-r[1],Jt=ln[fo+2]+gs[2]-r[2];Yh(ue,ii,Jt,h);const Nr=f.position,Hi=Nr.typedBuffer,Ss=Bi*Nr.typedBufferStride;Hi[Ss]=ue,Hi[Ss+1]=ii,Hi[Ss+2]=Jt;const Je=Ei*Nr.typedBufferStride;Hi[Je]=ue,Hi[Je+1]=ii,Hi[Je+2]=Jt;const Ha=f.uv0;Ha.setValues(Bi,Math.round(ct*An),Math.round(Ot*An)),Ha.setValues(Ei,Math.round(ct*An),Math.round(Ot*An));{const mo=Fr.normalCompressed.typedBuffer,er=Er*Fr.normalCompressed.typedBufferStride,ra=f.normalCompressed,Rs=ra.typedBuffer;{const vi=Bi*ra.typedBufferStride;Rs[vi]=mo[er],Rs[vi+1]=mo[er+1]}{const vi=Ei*ra.typedBufferStride;Rs[vi]=mo[er],Rs[vi+1]=mo[er+1]}}}}else{const Ui=ze[Ft],gi=ze[qe];let yi;if(Ui||gi){const Vt=Se(q*(1-je)+ne*je,Ne,at),Mi=Se(ce*(1-gt)+be*gt,Tt,et);yi=ls(Vt,Mi,n)}else yi=d3t(jt,Ue);F(je,gt,yi),Ct(Ue);const ti=P-r[0],wt=O-r[1],Nt=D-r[2];Yh(ti,wt,Nt,h),e.setEdgeVertexFromValuesRawPositionUVNormal(Ft,Ye,ti,wt,Nt,ct,Ot,U,N,j),e.setEdgeVertexFromValuesRawPositionUVNormal(qe,Li,ti,wt,Nt,ct,Ot,U,N,j)}}for(let Ue=0;Ue<4;++Ue)TA[Ue]=null}function d3t(t,e){const i=4*e,r=sse.reduce((o,l)=>Math.min(o,t[i+l]?.level??1/0),1/0);Yn&&(Be(!t[i+0]||!t[i+2]||VX(t[i+0],t[i+2],5)),Be(!t[i+1]||!t[i+3]||VX(t[i+1],t[i+3],7)));let s=0,n=0;for(let o=0;o<4;++o){const l=t[i+o];if(l&&l.level===r){const c=o===0||o===1,h=o===0||o===3,f=l.extent,y=f[c?0:2],_=f[h?1:3],w=l.renderData?.geometryState?.samplerData;n+=ls(y,_,w),s++}}const a=s?n/s:0;return Be(a!=null),a}function OM(t){const{vao:e,geometry:i}=t,{vertexAttributes:r,edgeVerticesStartIndex:s}=i,n=r.position.typedBuffer;e.buffer()?.setSubData(n,s,s,n.length)}function JIe(t){const{vao:e,geometry:i}=t,{indices:r,indexCount:s,edgeIndicesStartIndex:n}=i;e.indexBuffer.setSubData(r,n,n,s)}let p3t=class{constructor(e,i,r,s,n){this.isNorth=e,this.connectedRowOffset=i,this.connectedOuterEdgeOffset=r,this.rowOffset=s,this.latitudeResolution=n}};const NG=[[0,1],[1,0],[0,-1],[-1,0]],za=new hTt,pse=pU(-1/0,-1/0,1/0,1/0),TA=[null,null,null,null];function KIe(t,e,i){if(!e)return!1;const r=Vf(t,e);return r>0||r===0&&i>=2}let ik=class{constructor(){this.vertex0Index=0,this.stride=1,this.count=0}getVertexIndex(e){return Be(0<=e&&e<this.count),this.vertex0Index+this.stride*e}};const fse=[new ik,new ik,new ik,new ik];function Yh(t,e,i,r){t<r[0]?r[0]=t:t>r[3]&&(r[3]=t),e<r[1]?r[1]=e:e>r[4]&&(r[4]=e),i<r[2]?r[2]=i:i>r[5]&&(r[5]=i)}function e5e(t){const{edgeResolutions:e,numVerticesPerSide:i}=t,r=1+Math.max(...e);return Math.max(i,r)}function t5e(t,e,i,r,s,n){const a=t*s,o=n[a],l=n[a+1],c=n[a+2],h=e*s,f=n[h],y=n[h+1],_=n[h+2],w=i*s,x=n[w],S=n[w+1],$=n[w+2],A=r*s,M=n[A],P=n[A+1],O=n[A+2];return(f-M)*(f-M)+(y-P)*(y-P)+(_-O)*(_-O)>(o-x)*(o-x)+(l-S)*(l-S)+(c-$)*(c-$)}function k3(t,e,i,r,s){t[e]=i,t[e+1]=r,t[e+2]=r,t[e+3]=s,t[e+4]=s,t[e+5]=i}const LF=6;let f3t=class extends ase{constructor(e,i,r,s,n){super(),this._horizontalScaleFactor=1,this._extentInRenderSR=Pi(),this._baseUsedMemory=900,this._subtreeGeometryElevationBoundMin=0,this._subtreeGeometryElevationBoundMax=0,this.init(e,i,r,s,n)}init(e,i,r,s,n){super.init(e,i,r,s,n);const a=n.view.renderSpatialReference,o=n.spatialReference,l=a!=null&&DR(a)&&o!=null&&o.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this._horizontalScaleFactor=l;const{isWebMercatorOnPlateCarree:c}=n,h=this._extentInRenderSR,f=this.extent;if(c){const y=Ge(f[0],f[1],0);ja(y,Ie.WebMercator,y,Ie.PlateCarree);const _=Ge(f[2],f[3],0);ja(_,Ie.WebMercator,_,Ie.PlateCarree),h[0]=y[0],h[1]=y[1],h[2]=_[0],h[3]=_[1]}else for(let y=0;y<4;++y)h[y]=f[y]*l;this.centerAtSeaLevel[0]=.5*(h[0]+h[2]),this.centerAtSeaLevel[1]=.5*(h[1]+h[3]),this.centerAtSeaLevel[2]=0,this._edgeLen=Math.max(h[2]-h[0],h[3]-h[1]),this._edgeLen2=this._edgeLen*this._edgeLen,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();const e=this._extentInRenderSR,i=.5*(e[2]-e[0]),r=.5*(e[3]-e[1]),s=Math.sqrt(i*i+r*r),n=.5*(this.elevationBoundsMax-this.elevationBoundsMin),a=Math.max(s,n);this._center[1][3]=a}_calculateFrustumVisibility(e){const i=this._aabb(),r=i[0],s=i[1],n=i[2],a=i[3],o=i[4],l=i[5];let c=!0;for(let h=0;h<6;h++){const f=e[h],y=f[0],_=f[1],w=f[2],x=f[3];if(y*(y>0?r:a)+_*(_>0?s:o)+w*(w>0?n:l)+x>=0)return 2;c=c&&y*(y<0?r:a)+_*(_<0?s:o)+w*(w<0?n:l)+x<=0}return c?0:1}_aabb(){const e=this._extentInRenderSR;return xrt(e[0],e[1],Math.min(this.elevationBoundsMin,this._subtreeGeometryElevationBoundMin),e[2],e[3],Math.max(this.elevationBoundsMax,this._subtreeGeometryElevationBoundMax))}intersectsRay(e,i,r,s){return rk[0]=1/i[0],rk[1]=1/i[1],rk[2]=1/i[2],lre(this._aabb(),e,rk,r,s)}createGeometry(){t3t(this.renderData,this._horizontalScaleFactor),this._updateSubtreeGeometryElevationsBounds(),this.setMemoryDirty()}_updateSubtreeGeometryElevationsBounds(){const e=this._subtreeGeometryElevationBoundMin,i=this._subtreeGeometryElevationBoundMax,r=this.renderData;let s=e,n=i;if(r){const a=r.geometry.boundingBox;s=a[2],n=a[5]}else if(!this.leaf){s=1/0,n=-1/0;for(const a of this.children){const o=a;s=Math.min(s,o._subtreeGeometryElevationBoundMin),n=Math.max(n,o._subtreeGeometryElevationBoundMax)}}(s!==this._subtreeGeometryElevationBoundMin||n!==this._subtreeGeometryElevationBoundMax)&&(this._subtreeGeometryElevationBoundMin=s,this._subtreeGeometryElevationBoundMax=n,this.parent?._updateSubtreeGeometryElevationsBounds())}get minimumVerticesPerSide(){return this.level<9?3:2}updateCornerElevations(){r3t(this.renderData,this._horizontalScaleFactor),this._updateSubtreeGeometryElevationsBounds()}updateEdgeElevations(){n3t(this.renderData,this._horizontalScaleFactor),this._updateSubtreeGeometryElevationsBounds()}updateEdgeElevationsAndResolutions(){s3t(this.renderData,this._horizontalScaleFactor),this._updateSubtreeGeometryElevationsBounds()}get horizontalScale(){return this._horizontalScaleFactor}};const rk=R();let m3t=class{constructor(e){this.capacity=e,this._head=0,this._tail=0,this._data=new Array(e)}push(e){const i=this._tail;if(!(i<this.capacity))throw new Error("Queue full");this._data[i]=e,this._tail=i+1}pushAll(e){const i=e.length;if(i===0)return;const r=this._tail;if(!(r+i<=this.capacity))throw new Error("Queue full");for(let s=0;s<i;++s)this._data[r+s]=e[s];this._tail=r+i}pop(){const e=this._head;if(e<this._tail){const i=this._data[e];return this._head=e+1,i}}get empty(){return this._head>=this._tail}get full(){return this._tail>=this._data.length}},g3t=class{constructor(){this.extent=ri(),this.minLevel=0,this.maxLevel=0,this.callback=null}},kF=class extends Me{constructor(){super(...arguments),this._queries=new _i({initialSize:10}),this._queriesInvPtr=0,this._queryQueue=new _i({initialSize:30}),this._queryPool=new Wl(()=>new g3t)}queryVisibleLevelRange(e,i,r,s){const n=this._queryPool.acquire();jl(n.extent,e),n.minLevel=i??-Number.MAX_VALUE,n.maxLevel=r??Number.MAX_VALUE,n.callback=s,this._queryQueue.push(n),this.notifyChange("updating")}get updating(){return this._queryQueue.length!==0}prepare(){for(;this._queries.length<this._queries.data.length&&this._queryQueue.length>0;){const e=this._queryQueue.pop();this._queries.push(e)}this._queriesInvPtr=this._queries.length}process(){for(let e=0;e<this._queries.length;e++){const i=this._queries.data[e];this._queryPool.release(i),i.callback(e>=this._queriesInvPtr),i.callback=null}this._queries.clear(),this.notifyChange("updating")}queriesForTile(e){const i=e.level;let r=0;for(;r<this._queriesInvPtr;){const s=this._queries.data[r],n=s.extent;i>=s.minLevel&&i<=s.maxLevel&&n[0]<=e.extent[2]&&n[2]>=e.extent[0]&&n[1]<=e.extent[3]&&n[3]>=e.extent[1]?(this._queries.swapElements(r,this._queriesInvPtr-1),this._queriesInvPtr--):r++}}};d([m()],kF.prototype,"updating",null),kF=d([k("esri.views.3d.terrain.ScaleRangeQueries")],kF);function y3t(t,e,i,r){const s=Math.cos(i);t[0]=Math.cos(e)*s*r,t[1]=Math.sin(e)*s*r,t[2]=Math.sin(i)*r}let _3t=class extends ase{constructor(e,i,r,s,n){super(),this._convexHull=new Array(24),this._boundingSphere=ms(),this._baseUsedMemory=1816,this.init(e,i,r,s,n)}init(e,i,r,s,n){super.init(e,i,r,s,n);const a=this.ellipsoid.radius,o=this.extentInRadians[0],l=this.extentInRadians[1],c=this.extentInRadians[2],h=this.extentInRadians[3],f=ft(l,h,.5),y=ft(o,c,.5),_=e===0?0:Math.min(Math.abs(l),Math.abs(h));this._edgeLen=(c-o)*Math.cos(_)*a,this._edgeLen2=this._edgeLen*this._edgeLen,this._curvatureHeight=a-Math.sqrt(a*a-this._edgeLen2/4),y3t(this.centerAtSeaLevel,y,f,this.ellipsoid.radius),Ee(this.up,this.centerAtSeaLevel),this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateBoundingVolumes();const e=this._center;if(this.lij[0]===0)o$e(e[1],0,0,0),ve(e[0],0,0,0),ve(e[2],0,0,0),e[1][3]=this.ellipsoid.radius+this.elevationBoundsMax;else{this._updateCenter();const i=e[1],r=this.convexHull;let s=0;const n=Ti(i);for(let a=0;a<8;++a)s=Math.max(s,v3t(n,r,3*a));e[1][3]=Math.sqrt(s)}}_calculateFrustumVisibility(e){if(!D_(e,this._boundingSphere))return 2;if(this.lij[0]<10)return 1;const i=this.convexHull,r=this.surface.view.state.camera.near;let s=!0;for(let n=0;n<wM;n++){const a=n===4,o=e[n],l=o[0],c=o[1],h=o[2],f=o[3]-(a?r:0);let y=!1;for(let _=0;_<8;++_){const w=3*_;if(l*i[w]+c*i[w+1]+h*i[w+2]+f<0){if(y=!0,!s)break}else s=!1}if(!y)return 2}return s?0:1}computeElevationBounds(){super.computeElevationBounds(),this._updateBoundingVolumes()}createGeometry(){WTt(this.renderData,this._getPatchType()),this._updateBoundingVolumes(),this.setMemoryDirty()}_updateBoundingVolumes(){this._updateConvexHull(),this._updateBoundingSphere(),Yn&&this._checkBVs()}_updateBoundingSphere(){const e=this._boundingSphere,i=this.elevationBoundsMin,r=this.elevationBoundsMax,s=this.ellipsoid.radius,n=r;if(this.level===0)l$e(e,0,0,0,s+n);else{const a=this.extentInRadians,o=.5*(a[0]+a[2]),l=a[1],c=a[3];j1(q0e,o,l,s),j1(G0e,o,c,s),xe(GS,q0e,G0e),le(GS,GS,(s+.5*(i+r))/gu(GS));const h=this.convexHull;let f=0;const y=(_,w)=>{const x=_[0]-h[3*w],S=_[1]-h[3*w+1],$=_[2]-h[3*w+2];return Math.sqrt(x*x+S*S+$*$)};for(let _=0;_<8;++_){const w=y(GS,_);f=Math.max(f,w)}yM(e,GS,f+2)}}_updateConvexHull(){const e=this.extentInRadians,i=this.ellipsoid.radius;if(this.level===0)return;const r=this.elevationBoundsMin,s=this.elevationBoundsMax,n=this._getPatchType(),a=this.surface.isWebMercator,o=a&&n===1,l=a&&n===2,c=l||o,h=Math.PI/2,f=e[0],y=e[2],_=l?-h:e[1],w=o?h:e[3],x=.5*(f+y),S=r,$=i+(c?Math.min(0,S-1):S),A=(Q,X,ye)=>j1(Q,X,ye,$),M=R(),P=R(),O=R(),D=R();A(M,f,_),A(P,f,w),A(O,y,w),A(D,y,_);const L=(Q,X)=>{for(let ye=0;ye<3;++ye)this._convexHull[3*X+ye]=Q[ye]};L(M,0),L(P,1),L(O,2),L(D,3);const F=s,U=i+(c?Math.max(0,F+1):F),N=R(),j=R(),B=R();j1(j,x,w,$),j1(B,x,_,$),xe(N,j,B),Ee(N,N);const Y=R(),G=R(),Z=(Q,X)=>{ui(G,Q,X),Ee(G,G);const ye=-Oe(Q,Y)/Oe(G,Y);Be(ye>=0),le(G,G,ye),xe(Q,Q,G)};if(2**this.lij[0]>2*this.lij[1]){const Q=B,X=R();bt(X,j0e,Q),Ee(X,X),bt(Y,Q,X),Ee(Y,Y),Be(Uh(Oe(Y,Q)/gu(Q),0)),Z(M,P),Z(D,O),L(M,0),L(D,3)}else if(2**this.lij[0]!==2*this.lij[1]){const Q=j,X=R();bt(X,j0e,Q),Ee(X,X),bt(Y,X,Q),Ee(Y,Y),Z(P,M),Z(O,D),L(P,1),L(O,2)}const H=(Q,X)=>{const ye=U/Oe(X,N);for(let De=0;De<3;++De)this._convexHull[3*Q+De]=X[De]*ye};H(4,M),H(5,P),H(6,O),H(7,D)}_getPatchType(){const e=this.lij[1],i=e===0,r=e===(1<<this.level)-1;return i?r?3:1:r?2:0}intersectsRay(e,i,r,s){const n=this._boundingSphere,a=n[3]+r,o=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],l=n[0]-e[0],c=n[1]-e[1],h=n[2]-e[2],f=(l*i[0]+c*i[1]+h*i[2])/o,y=i[0]*f-l,_=i[1]*f-c,w=i[2]*f-h;return y*y+_*_+w*w<a*a}get minimumVerticesPerSide(){return this.level<B0e.length?B0e[this.level]+1:2}updateCornerElevations(){JTt(this.renderData),this._updateBoundingVolumes()}updateEdgeElevations(){QTt(this.renderData),this._updateBoundingVolumes()}updateEdgeElevationsAndResolutions(){XTt(this.renderData),this._updateBoundingVolumes()}_checkBVs(){if(!Yn||this.level<=2)return;const e=this._boundingSphere,i=e[3],r=gy(e,R()),s=R(),n=this.ellipsoid.radius,a=this.elevationBoundsMin,o=this.elevationBoundsMax,l=n+a,c=1,h=0,f=this._center[1];gy(f,R());const y=f[3],_=this.convexHull,w=(qe,je)=>{for(let gt=0;gt<3;++gt)qe[gt]=_[3*je+gt]};{const qe=R(),je=R(),gt=R(),ct=R(),Ot=R(),Xe=(We,Ye,rt,Zt)=>{w(je,We),w(gt,Ye),w(ct,rt),ui(je,je,gt),ui(ct,ct,gt),bt(qe,je,ct),Ee(qe,qe);const Li=Oe(qe,gt);w(Ot,Zt);const Ci=Oe(qe,Ot),ei=Math.abs(Ci-Li);Be(Uh(ei,0),`Non coplanar ${We},${Ye},${rt},${Zt} diff = ${ei}`)};Xe(0,1,2,3),Xe(4,5,6,7),Xe(0,1,4,5),Xe(1,2,5,6),Xe(2,3,6,7),Xe(3,0,7,4)}const x=iD(24),S=(qe,je,gt)=>{const ct=4*qe;for(let Ot=0;Ot<3;++Ot)x[ct+Ot]=je[Ot];x[ct+3]=gt},$=R(),A=R(),M=R(),P=R(),O=(qe,je,gt,ct)=>{w($,je),w(A,gt),w(M,ct),ui($,$,A),Ee($,$),ui(M,M,A),Ee(M,M),bt(P,$,M),Ee(P,P);const Ot=Oe(P,A);S(qe,P,Ot)};O(0,0,1,2),O(1,1,0,4),O(2,1,5,2),O(3,3,2,6),O(4,4,0,3),O(5,4,6,5);const D=(qe,je,gt,ct)=>{const Ot=4*qe;return x[Ot]*je+x[Ot+1]*gt+x[Ot+2]*ct-x[Ot+3]},L=(qe,je,gt,ct)=>D(qe,je,gt,ct)>=-1,F=(qe,je)=>L(qe,je[0],je[1],je[2]),U=2**this.lij[0]>2*this.lij[1],N=(qe,je,gt)=>Math.sqrt(i5e(qe,je,gt,r[0],r[1],r[2]))<i,j=qe=>N(qe[0],qe[1],qe[2]),B=(qe,je)=>N(qe[je],qe[je+1],qe[je+2]),Y=this.extentInRadians,G=.5*(Y[0]+Y[2]),Z=Y[1],H=Y[3],Q=R(),X=R();j1(Q,G,H,l),j1(X,G,Z,l);const ye=U?"Upper":"Lower";let De=!0;for(let qe=0;qe<6;++qe){for(let je=0;je<8;++je){const gt=3*je,ct=L(qe,_[gt],_[gt+1],_[gt+2]);De&&=ct,Be(ct,`Tile[${this.lij}] Convex hull point ${je} outside of plane ${qe}`)}Be(F(qe,X),`Tile[${this.lij}] (${ye}) bottom mid outside of plane ${qe}`),Be(F(qe,Q),`Tile[${this.lij}] (${ye}) top mid outside of plane ${qe}`)}Be(De,"Not all convex hull points are inside  convex hull polyhedron"),Be(j(X),`Tile[${this.lij}] (${ye}) bottom mid outside of bounding sphere`),Be(j(Q),`Tile[${this.lij}] (${ye}) top mid outside of bounding sphere`);for(let qe=0;qe<8;++qe){const je=B(_,3*qe);Be(je,`Tile[${this.lij}] Convex hull point ${qe} outside of bounding sphere`)}for(let qe=0;qe<6;++qe)for(let je=0;je<8;++je){const gt=3*je;L(qe,_[gt],_[gt+1],_[gt+2])||console.error(`Tile[${this.lij}] Convex hull point ${je} outside of plane ${qe}`)}const{extentInRadians:q}=this,ne=Math.max(q[2]-q[0],q[3]-q[1]),ce=Math.round(ne*n),{renderData:be}=this;if(!be)return;const{geometry:ze,geometryState:Ne,localOrigin:at}=be,Tt=ze.vertexAttributes?.position;if(!Tt)return;const et=R(),It=ze.numVerticesPerSide-2,{indices:$t,indexCount:Ct,edgeVerticesStartIndex:jt,poleVerticesStartIndex:Ue}=ze;if(!$t)return;const Ft=new Set;for(let qe=0;qe<Ct;++qe){const je=$t[qe];if(Ft.has(je))continue;Ft.add(je);const gt=je<Ue,ct=je>=jt;let Ot=!1,Xe=-1;if(ct){let wt=jt;for(let Nt=0;Nt<4;++Nt){const Vt=Ne.edgeResolutions[Nt];if(je===wt||je===wt+Vt-1){Ot=!0;break}if(wt+=Vt,je<wt){Xe=Nt;break}}}const We=ct?Ne.edgePeerNeighbors[Xe]:null,Ye=ct&&We&&Vf(this,We)>0;Tt.getVec(je,s),xe(et,s,at);const rt=gu(et)-n;let Zt=0,Li=!1;const Ci=a-rt,ei=rt-o,Gi=Ci>c,Ui=ei>c,gi=Gi||Ui,yi=()=>{const wt=gt?"internal":ct&&!Ot?"edge":Ot?"corner":"pole";return`Tile[${this.lij}].vertex[${je}]:${wt}`+(Gi?"(below)":Ui?"(above)":"")+(Ye?"(Neighbor)":"")},ti=s4(et,r);if(ti>=i+h){const wt=ti-i;gi||(console.error(`${yi()} is out of the bounding sphere by ${wt.toFixed(0)} / ${i.toFixed(0)}[tol=${h}] h=${rt.toFixed(0)} / [${a.toFixed(0)}..${o.toFixed(0)}] (${(wt/i).toFixed(0)})`),Li=!0)}for(let wt=0;wt<6;++wt)if(!L(wt,et[0],et[1],et[2])){const Nt=D(wt,et[0],et[1],et[2]),Vt=je%It,Mi=(je-Vt)/It;wt===0&&Ci||wt===5&&ei||(console.error(`${yi()} (${Vt},${Mi})|${It}] is out of the bounding trapezoid plane ${wt} h=${Math.round(rt)} / [${Math.round(a)}..${Math.round(o)}] dist=${Math.round(Nt)} radii = ${Math.round(i)}/${Math.round(y)}} : maxL = ${ce}`),++Zt)}if(Li||Zt>0)break}}get convexHull(){return this._convexHull}};const B0e=[128,64,64,32,16,8,8,4];function v3t(t,e,i){return i5e(t[0],t[1],t[2],e[i],e[i+1],e[i+2])}function i5e(t,e,i,r,s,n){const a=r-t,o=s-e,l=n-i;return a*a+o*o+l*l}const j1=(t,e,i,r)=>{const s=Math.cos(e),n=Math.sin(e),a=Math.cos(i),o=Math.sin(i);t[0]=r*a*s,t[1]=r*a*n,t[2]=r*o},j0e=[0,0,1],q0e=R(),G0e=R(),GS=R();let Ld=class extends Me{constructor(){super(...arguments),this.fovX=0,this.fovY=0,this.relativeWidthLimit=0,this.relativeHeightLimit=0,this.maxLod=0,this.angledSplitBias=0,this.aboveGround=!0}};d([m()],Ld.prototype,"fovX",void 0),d([m()],Ld.prototype,"fovY",void 0),d([m()],Ld.prototype,"relativeWidthLimit",void 0),d([m()],Ld.prototype,"relativeHeightLimit",void 0),d([m()],Ld.prototype,"maxLod",void 0),d([m()],Ld.prototype,"angledSplitBias",void 0),d([m()],Ld.prototype,"aboveGround",void 0),d([m()],Ld.prototype,"frustum",void 0),Ld=d([k("esri.views.3d.terrain.SplitLimits")],Ld);const r5e=jc().vec3f("position").vec2u16("uv0",{glNormalized:!0}).vec2i16("normalCompressed",{glNormalized:!0});let b3t=class{constructor(e){this._storage=new R4((i,r)=>e.newCache(i,r),"TileGeometry")}acquire(e){const r=Math.ceil(e/4)*4,s=this._storage,n=w3t(r),a=s.pop(n);if(a)return a;const o=r5e.createBuffer(r);return o.release=()=>s.put(n,o),o}clear(){this._storage.clear()}destroy(){this._storage.destroy()}};function w3t(t){return t.toString()}function H0e(t){return T$e(t.layer)}let s5e=class extends hr{constructor(){super(...arguments),this.scale=1,this.offset=$v}};function n5e(t){t.attributes.add("position","vec2"),t.attributes.add("uv0","vec2"),t.varyings.add("uv","vec2"),t.varyings.add("vuv","vec2"),t.vertex.uniforms.add(new ut("scale",e=>e.scale),new ll("offset",e=>e.offset)).main.add(E`gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;`)}function mse(t){t.code.add(E`
    float lineFactorAtPosition(float value) {
      float pos = value * ${E.float(257)};
      if(pos < 0.5 || pos > ${E.float(257-.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec3 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec3(1.0, 0.972, 0.918) * line;
    }`)}function x3t(t,e){const i=e.blendMode;i!==0&&(i===30&&t.code.add(E`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`),i!==6&&i!==13||t.code.add(E`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`),i!==9&&i!==13||t.code.add(E`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`),i===10&&t.code.add(E`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`),i===12&&t.code.add(E`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`),i===11&&t.code.add(E`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`),i===13&&t.code.add(E`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`),i!==14&&i!==15&&i!==17&&i!==16||(t.code.add(E`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),i!==14&&i!==15||t.code.add(E`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`)),t.code.add(E`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${i===8?E`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===1?E`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===2?E`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===7?E`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===3?E`return vec4(cl * ol + cb * ob, ol + ob);`:i===4?E`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:i===28?E`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:i===5?E`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===26?E`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===29?E`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:i===18?E`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:i===19?E`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:i===21?E`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:i===22?E`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:i===24?E`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:i===25?E`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:i===20?E`return vec4(cb * ob * ol, ol * ob);`:i===23?E`return vec4(cl * ol * ob, ol * ob);`:i===14?E`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===15?E`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===17?E`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===16?E`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===27?E`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===30?E`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===6?E`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===9?E`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===10?E`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===11?E`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===12?E`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===13?E`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:E``}
    }
  `))}function a5e(t,e){const{output:i,blendMode:r,baseOpacityMode:s,premultipliedSource:n}=e,a=t.fragment,o=s===1;o&&a.uniforms.add(new ut("baseOpacity",f=>f.baseOpacity));const l=r!==0,c=!l&&n!==1&&(i===1&&!o||i===4);a.include(x3t,e);let h="";switch(i){case 4:case 0:h=E`vec4(0.0)`;break;case 2:a.uniforms.add(new _r("backgroundColor",f=>f.backgroundColor)),h=E`vec4(backgroundColor, 1.0)`;break;case 3:a.include(mse),h=E`vec4(gridColor(uv), 1.0)`;break;case 1:a.uniforms.add(new zt("fboColor",f=>f.fboTexture)),h=E`texelFetch(fboColor, ivec2(gl_FragCoord.xy), 0)`}a.code.add(E`
    vec4 getBackground(vec2 uv) {
      return ${_e(o,E`baseOpacity *`)} ${h};
    }

    vec4 blendLayers(vec2 bgUV, vec4 colorLayer, float opacity) {
      ${l?E`
          vec3 cl = colorLayer.a == 0.0 ? colorLayer.rgb : colorLayer.rgb / colorLayer.a;
          vec4 bgColor = getBackground(bgUV);
          vec3 cb = bgColor.a == 0.0 ? bgColor.rgb : bgColor.rgb / bgColor.a;
          return applyBlendMode(clamp(cl, vec3(0.0), vec3(1.0)), colorLayer.a * opacity, cb, bgColor.a);`:E`
          float composeAlpha = colorLayer.a * opacity;
          ${c?E`return colorLayer * opacity;`:E`
            vec4 bgColor = getBackground(bgUV);
            return bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`}`}
    }`)}function o5e(t){const e=new Di,i=e.fragment;if(e.include(n5e),t.background===1){const r=t.output===2;return r?i.uniforms.add(new _r("backgroundColor",s=>s.backgroundColor)):i.include(mse),i.main.add(E`fragColor = vec4(${r?E`backgroundColor`:E`gridColor(uv)`}, 1.0);`),e}return e.include(a5e,t),i.uniforms.add(new zt("tex",r=>r.texture),new ut("opacity",r=>r.opacity)),i.main.add(E`fragColor = blendLayers(uv, texture(tex, uv), opacity);`),e}const S3t=Object.freeze(Object.defineProperty({__proto__:null,build:o5e},Symbol.toStringTag,{value:"Module"}));let T3t=class extends s5e{constructor(){super(...arguments),this.opacity=1,this.baseOpacity=1,this.texture=null,this.fboTexture=null,this.backgroundColor=Kn}},W0e=class extends Vi{constructor(e,i){super(e,i,new Ii(S3t,()=>te(()=>Promise.resolve().then(()=>jkt),void 0)),ed(g4))}};var bu;let v2=(bu=class{static getId(e,i,r,s){return typeof e=="object"?`${e.level}/${e.row}/${e.col}/${e.world}`:`${e}/${i}/${r}/${s}`}constructor(e,i,r,s){this.set(e,i,r,s)}get key(){return this}get id(){return this.toString()}get normalizedId(){return`${this.level}/${this.row}/${this.col}`}set id(e){this.set(e)}get hash(){const e=4095&this.row,i=4095&this.col,r=63&this.level;return(3&this.world)<<30|i<<22|e<<8|r}acquire(e,i,r,s){this.set(e,i,r,s)}contains(e){const i=e.level-this.level;return i>=0&&this.row===e.row>>i&&this.col===e.col>>i&&this.world===e.world}containsChild(e){const i=e.level-this.level;return i>0&&this.row===e.row>>i&&this.col===e.col>>i&&this.world===e.world}equals(e){return this.level===e.level&&this.row===e.row&&this.col===e.col&&this.world===e.world}clone(){return new bu(this)}release(){this.level=0,this.row=0,this.col=0,this.world=0}set(e,i,r,s){if(e==null)this.level=0,this.row=0,this.col=0,this.world=0;else if(typeof e=="object")this.level=e.level||0,this.row=e.row||0,this.col=e.col||0,this.world=e.world||0;else if(typeof e=="string"){const[n,a,o,l]=e.split("/");this.level=parseFloat(n),this.row=parseFloat(a),this.col=parseFloat(o),this.world=parseFloat(l)}else this.level=+e,this.row=+i,this.col=+r,this.world=+s||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return this.level<=0?null:new bu(this.level-1,this.row>>1,this.col>>1,this.world)}getNormalizedNeighbor(e,i,r){const s=this.clone();return s.col+=e,s.row+=i,r.normalizeKey(s),s}getChildKeys(){const e=this.level+1,i=this.row<<1,r=this.col<<1,s=this.world;return[new bu(e,i,r,s),new bu(e,i,r+1,s),new bu(e,i+1,r,s),new bu(e,i+1,r+1,s)]}compareRowMajor(e){return this.row<e.row?-1:this.row>e.row?1:this.col<e.col?-1:this.col>e.col?1:0}},bu.pool=new Wl(()=>new bu(""),null,null,25,50),bu);function HS(t,e){return[t,e]}function q1(t,e,i){return t[0]=e,t[1]=i,t}function $3t(t,e,i,r,s){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t}const Cd=new v2("0/0/0/0");let C3t=class l5e{static create(e,i,r=null){const s=Ru(e.spatialReference),n=i.origin||HS(e.origin.x,e.origin.y),a=HS(e.size[0]*i.resolution,e.size[1]*i.resolution),o=HS(-1/0,-1/0),l=HS(1/0,1/0),c=HS(1/0,1/0);r!=null&&(q1(o,Math.max(0,Math.floor((r.xmin-n[0])/a[0])),Math.max(0,Math.floor((n[1]-r.ymax)/a[1]))),q1(l,Math.max(0,Math.floor((r.xmax-n[0])/a[0])),Math.max(0,Math.floor((n[1]-r.ymin)/a[1]))),q1(c,l[0]-o[0]+1,l[1]-o[1]+1));const{cols:h,rows:f}=i;let y,_,w,x;return!r&&h&&f&&(q1(o,h[0],f[0]),q1(l,h[1],f[1]),q1(c,h[1]-h[0]+1,f[1]-f[0]+1)),e.isWrappable?(y=HS(Math.ceil(Math.round((s.valid[1]-s.valid[0])/i.resolution)/e.size[0]),c[1]),_=!0,w=s.origin,x=s.valid):(y=c,_=!1),new l5e(i.level,i.resolution,i.scale,n,o,l,c,a,y,_,w,x)}constructor(e,i,r,s,n,a,o,l,c,h,f,y){this.level=e,this.resolution=i,this.scale=r,this.origin=s,this.first=n,this.last=a,this.size=o,this.norm=l,this.worldSize=c,this.wrap=h,this._spatialReferenceOrigin=f,this._spatialReferenceValid=y}normalizeCol(e){if(!this.wrap)return e;const i=this.worldSize[0];return e<0?i-1-Math.abs((e+1)%i):e%i}normalizeKey(e){if(!this.wrap)return;const i=this.worldSize[0],r=e.col;r<0?(e.col=r+i,e.world-=1):r>=i&&(e.col=r-i,e.world+=1)}denormalizeCol(e,i){return this.wrap?this.worldSize[0]*i+e:e}getWorldForColumn(e){return this.wrap?Math.floor(e/this.worldSize[0]):0}getFirstColumnForWorld(e){return e*this.worldSize[0]+this.first[0]}getLastColumnForWorld(e){return e*this.worldSize[0]+this.first[0]+this.size[0]-1}getColumnForX(e){return(e-this.origin[0])/this.norm[0]}getXForColumn(e){const i=this.origin[0]+e*this.norm[0],r=this._spatialReferenceOrigin,s=this._spatialReferenceValid;return this.wrap&&r&&s?i===r[0]?s[0]:this.origin[0]===r[0]&&e===this.worldSize[0]?s[1]:i:i}getRowForY(e){return(this.origin[1]-e)/this.norm[1]}getYForRow(e){return this.origin[1]-e*this.norm[1]}getTileBounds(e,i,r=!1){Cd.set(i);const s=r?Cd.col:this.denormalizeCol(Cd.col,Cd.world),n=Cd.row;return $3t(e,this.getXForColumn(s),this.getYForRow(n+1),this.getXForColumn(s+1),this.getYForRow(n)),e}getTileCoords(e,i,r=!1){Cd.set(i);const s=r?Cd.col:this.denormalizeCol(Cd.col,Cd.world);return Array.isArray(e)?q1(e,this.getXForColumn(s),this.getYForRow(Cd.row)):(e.x=this.getXForColumn(s),e.y=this.getYForRow(Cd.row)),e}};var Mx;let M3t=(Mx=class{constructor(){this.spans=[]}acquire(e){this.lodInfo=e}release(){this.lodInfo=null,this.spans.length=0}*keys(){const e=this.lodInfo;for(const{row:i,colFrom:r,colTo:s}of this.spans)for(let n=r;n<=s;n++){const a=e.getWorldForColumn(n);yield new v2(e.level,i,e.normalizeCol(n),a)}}forEach(e,i){const{spans:r,lodInfo:s}=this,{level:n}=s;if(r.length!==0)for(const{row:a,colFrom:o,colTo:l}of r)for(let c=o;c<=l;c++)e.call(i,n,a,s.normalizeCol(c),s.getWorldForColumn(c))}},Mx.pool=new Wl(()=>new Mx),Mx),VG=class{constructor(e,i,r){this.row=e,this.colFrom=i,this.colTo=r}};const Ls=new v2("0/0/0/0");let E3t=class c5e{static create(e,i){e[1]>i[1]&&([e,i]=[i,e]);const[r,s]=e,[n,a]=i,o=n-r,l=a-s,c=l!==0?o/l:0,h=(Math.ceil(s)-s)*c,f=(Math.floor(s)-s)*c;return new c5e(r,Math.floor(s),Math.ceil(a),c,o<0?h:f,o<0?f:h,o<0?n:r,o<0?r:n)}constructor(e,i,r,s,n,a,o,l){this.x=e,this.ymin=i,this.ymax=r,this.invM=s,this.leftAdjust=n,this.rightAdjust=a,this.leftBound=o,this.rightBound=l}incrRow(){this.x+=this.invM}getLeftCol(){return Math.max(this.x+this.leftAdjust,this.leftBound)}getRightCol(){return Math.min(this.x+this.rightAdjust,this.rightBound)}};const nu=[[0,0],[0,0],[0,0],[0,0]],A3t=1e-6;let _Kt=class{constructor(e,i=null,r=e.lods[0].level,s=e.lods[e.lods.length-1].level){this.tileInfo=e,this.fullExtent=i,this.scales=[],this._infoByScale={},this._infoByLevel={};const n=e.lods.filter(o=>o.level>=r&&o.level<=s);this.minScale=n[0].scale,this.maxScale=n[n.length-1].scale;const a=this._lodInfos=n.map(o=>C3t.create(e,o,i));n.forEach((o,l)=>{this._infoByLevel[o.level]=a[l],this._infoByScale[o.scale]=a[l],this.scales[l]=o.scale},this),this._wrap=e.isWrappable}get spatialReference(){return this.tileInfo.spatialReference}getLODInfoAt(e){return this._infoByLevel[typeof e=="number"?e:e.level]}getTileBounds(e,i,r=!1){Ls.set(i);const s=this._infoByLevel[Ls.level];return s?s.getTileBounds(e,Ls,r):e}getTileCoords(e,i,r=!1){Ls.set(i);const s=this._infoByLevel[Ls.level];return s?s.getTileCoords(e,Ls,r):e}getTileCoverage(e,i=192,r=!0,s="closest"){if(!r&&(e.scale>this.minScale||e.scale<this.maxScale))return null;const n=s==="closest"?this.getClosestInfoForScale(e.scale):this.getSmallestInfoForScale(e.scale),a=M3t.pool.acquire(n),o=this._wrap;let l,c,h,f=1/0,y=-1/0;const _=a.spans;nu[0][0]=nu[0][1]=nu[1][1]=nu[3][0]=-i,nu[1][0]=nu[2][0]=e.size[0]+i,nu[2][1]=nu[3][1]=e.size[1]+i;for(const $ of nu)e.toMap($,$),$[0]=n.getColumnForX($[0]),$[1]=n.getRowForY($[1]);const w=[];let x=3;for(let $=0;$<4;$++){if(nu[$][1]===nu[x][1]){x=$;continue}const A=E3t.create(nu[$],nu[x]);f=Math.min(A.ymin,f),y=Math.max(A.ymax,y),w[A.ymin]===void 0&&(w[A.ymin]=[]),w[A.ymin].push(A),x=$}if(f==null||y==null||y-f>100)return null;let S=[];for(l=f;l<y;){w[l]!=null&&(S=S.concat(w[l])),c=1/0,h=-1/0;for(let $=S.length-1;$>=0;$--){const A=S[$];c=Math.min(c,A.getLeftCol()),h=Math.max(h,A.getRightCol())}if(c=Math.floor(c),h=Math.floor(h),l>=n.first[1]&&l<=n.last[1])if(o)if(n.size[0]<n.worldSize[0]){const $=Math.floor(h/n.worldSize[0]);for(let A=Math.floor(c/n.worldSize[0]);A<=$;A++)_.push(new VG(l,Math.max(n.getFirstColumnForWorld(A),c),Math.min(n.getLastColumnForWorld(A),h)))}else _.push(new VG(l,c,h));else c>n.last[0]||h<n.first[0]||(c=Math.max(c,n.first[0]),h=Math.min(h,n.last[0]),_.push(new VG(l,c,h)));l+=1;for(let $=S.length-1;$>=0;$--){const A=S[$];A.ymax>=l?A.incrRow():S.splice($,1)}}return a}getTileParentId(e){Ls.set(e);const i=this._infoByLevel[Ls.level],r=this._lodInfos.indexOf(i)-1;return r<0?null:(this._getTileIdAtLOD(Ls,this._lodInfos[r],Ls),Ls.id)}getTileResolution(e){const i=this._infoByLevel[typeof e=="object"?e.level:e];return i?i.resolution:-1}getTileScale(e){const i=this._infoByLevel[e.level];return i?i.scale:-1}intersects(e,i){Ls.set(i);const r=this._infoByLevel[Ls.level],s=e.lodInfo;if(s.resolution>r.resolution){this._getTileIdAtLOD(Ls,s,Ls);const a=s.denormalizeCol(Ls.col,Ls.world);for(const o of e.spans)if(o.row===Ls.row&&o.colFrom<=a&&o.colTo>=a)return!0}if(s.resolution<r.resolution){const[a,o,l,c]=e.spans.reduce((x,S)=>(x[0]=Math.min(x[0],S.row),x[1]=Math.max(x[1],S.row),x[2]=Math.min(x[2],S.colFrom),x[3]=Math.max(x[3],S.colTo),x),[1/0,-1/0,1/0,-1/0]),h=r.denormalizeCol(Ls.col,Ls.world),f=s.getColumnForX(r.getXForColumn(h)),y=s.getRowForY(r.getYForRow(Ls.row)),_=s.getColumnForX(r.getXForColumn(h+1))-1,w=s.getRowForY(r.getYForRow(Ls.row+1))-1;return!(f>c||_<l||y>o||w<a)}const n=s.denormalizeCol(Ls.col,Ls.world);return e.spans.some(a=>a.row===Ls.row&&a.colFrom<=n&&a.colTo>=n)}normalizeBounds(e,i,r){if(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],this._wrap){const s=Ru(this.tileInfo.spatialReference),n=-r*(s.valid[1]-s.valid[0]);e[0]+=n,e[2]+=n}return e}getSmallestInfoForScale(e){const i=this.scales;if(this._infoByScale[e])return this._infoByScale[e];if(e>i[0])return this._infoByScale[i[0]];for(let r=1;r<i.length-1;r++)if(e>i[r]+A3t)return this._infoByScale[i[r-1]];return this._infoByScale[i[i.length-1]]}getClosestInfoForScale(e){const i=this.scales;return this._infoByScale[e]||(e=i.reduce((r,s)=>Math.abs(s-e)<Math.abs(r-e)?s:r,i[0])),this._infoByScale[e]}scaleToLevel(e){const i=this.scales;if(this._infoByScale[e])return this._infoByScale[e].level;for(let r=i.length-1;r>=0;r--)if(e<i[r])return r===i.length-1?this._infoByScale[i[i.length-1]].level:this._infoByScale[i[r]].level+(i[r]-e)/(i[r]-i[r+1]);return this._infoByScale[i[0]].level}scaleToZoom(e){return this.tileInfo.scaleToZoom(e)}zoomToScale(e){return this.tileInfo.zoomToScale(e)}_getTileIdAtLOD(e,i,r){const s=this._infoByLevel[r.level];return e.set(r),i.resolution<s.resolution?null:(i.resolution===s.resolution||(e.level=i.level,e.col=Math.floor(r.col*s.resolution/i.resolution+.01),e.row=Math.floor(r.row*s.resolution/i.resolution+.01)),e)}},O3t=class{constructor(e,i){this.item=e,this.controller=i,this.promise=null}},u5e=class{constructor(e){this._schedule=null,this._task=null,this._deferreds=new s$,this._controllers=new s$,this._processingItems=new s$,this._pausedSignal=Pn(!1),this.concurrency=1,e.concurrency&&(this.concurrency=e.concurrency),this._queue=new bC(e.peeker),this.process=e.process;const i=e.scheduler;e.priority&&i&&(this._task=i.registerTask(e.priority,this))}destroy(){this.clear(),this._schedule=Ki(this._schedule),this._task=Ki(this._task)}get updating(){return!!this._task?.updating||this.readyToRun}get length(){return this._processingItems.size+this._queue.length}abort(e){const i=this._controllers.get(e);i&&i.abort()}clear(){this._queue.clear();const e=[];this._controllers.forEach(i=>e.push(i)),this._controllers.clear(),e.forEach(i=>i.abort()),this._processingItems.clear(),this._cancelNext()}forEach(e){this._deferreds.forEach((i,r)=>e(r))}get(e){const i=this._deferreds.get(e);return i?i.promise:void 0}isOngoing(e){return this._processingItems.has(e)}has(e){return this._deferreds.has(e)}pause(){this._pausedSignal.value||(this._pausedSignal.value=!0,this._cancelNext())}push(e,i){const r=this.get(e);if(r)return r;const s=new AbortController;let n=null;i&&(n=qa(i,()=>s.abort()));const a=()=>{const h=this._processingItems.get(e);h&&h.controller.abort(),o(),c.reject(Xt())},o=()=>{l.remove(),n?.remove(),this._removeItem(e),this._queue.remove(e),this._scheduleNext()},l=jD(s.signal,a),c=lo();return this._deferreds.set(e,c),this._controllers.set(e,s),c.promise.then(o,o),this._queue.push(e),this._scheduleNext(),c.promise}last(){return this._queue.last()}lastPromise(){const e=this.last();return e?this.get(e):null}peek(){return this._queue.peek()}popLast(){const e=this._queue.popLast();return e&&(this._deferreds.get(e)?.reject(Xt()),this._removeItem(e)),e}reset(){const e=Array.from(this._processingItems.values());this._processingItems.clear();for(const i of e)this._queue.push(i.item),i.controller.abort();this._scheduleNext()}resume(){this._pausedSignal.value&&(this._pausedSignal.value=!1,this._scheduleNext())}takeAll(){const e=[];for(;this._queue.length;)e.push(this._queue.pop());return this.clear(),e}get readyToRun(){return!this._pausedSignal.value&&this._queue.length>0&&this._processingItems.size<this.concurrency}runTask(e){for(;!e.done&&this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop()),e.madeProgress()}_removeItem(e){this._deferreds.delete(e),this._controllers.delete(e),this._processingItems.delete(e)}_scheduleNext(){this._task||this._pausedSignal.value||this._schedule||(this._schedule=oM(()=>{this._schedule=null,this._next()}))}_next(){for(;this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())}_cancelNext(){this._schedule&&(this._schedule.remove(),this._schedule=null)}_processResult(e,i){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).resolve(i))}_processError(e,i){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).reject(i))}_canProcessFulfillment(e){return!!this._deferreds.get(e.item)&&this._processingItems.get(e.item)===e}_process(e){if(e==null)return;let i;const r=new AbortController,s=new O3t(e,r);this._processingItems.set(e,s);try{i=this.process(e,r.signal)}catch(n){this._processError(s,n)}$a(i)?(s.promise=i,i.then(n=>this._processResult(s,n),n=>this._processError(s,n))):this._processResult(s,i)}get test(){}};const Z0e=[0,0];let z0=class extends Me{constructor(e){super(e),this._keyToItem=new Map,this._tilesByScale=new Map,this.concurrency=6}initialize(){const{concurrency:e,process:i,scheduler:r,priority:s}=this;this._queue=new u5e({concurrency:e,scheduler:r,priority:s,process:(n,a)=>{const o=this._keyToItem.get(n);return i(o,{signal:a})},peeker:n=>this._peek(n)})}destroy(){this.clear(),this._queue=Re(this._queue)}get length(){return this._queue?this._queue.length:0}abort(e){const i=typeof e=="string"?e:e.id;this._queue.abort(i)}clear(){this._queue.clear(),this._keyToItem.clear(),this._tilesByScale.clear()}has(e){return typeof e=="string"?this._keyToItem.has(e):this._keyToItem.has(e.id)}pause(){this._queue.pause()}push(e){const i=e.key.id;if(this._queue.has(i))return this._queue.get(i);const r=this._queue.push(i),s=this.tileInfoView.getTileScale(e.key),n=Cu(this._tilesByScale,s,()=>new Set),a=()=>{n.delete(e.key),n.size===0&&this._tilesByScale.delete(s),this._keyToItem.delete(i)};return n.add(e.key),this._keyToItem.set(i,e),r.then(a,a),r}reset(){this._queue.reset()}resume(){this._queue.resume()}_peek(e){if(!this.state)return e.values().next().value;const i=new Set;for(const a of e)i.add(this._keyToItem.get(a).key);const r=this.state.scale;let s,n=Number.POSITIVE_INFINITY;for(const[a,o]of this._tilesByScale)if(a3(o,l=>i.has(l))){const l=Math.abs(a-r);l<n&&(s=o,n=l)}return this._getClosestTileKey(s,e).id}_getClosestTileKey(e,i){const r=this.tileInfoView,s=this.state.center;let n,a=Number.POSITIVE_INFINITY;for(const o of e)if(i.has(o.id)){r.getTileCoords(Z0e,o);const l=Zf(Z0e,s);l<a&&(a=l,n=o)}return n}};d([m({constructOnly:!0})],z0.prototype,"concurrency",void 0),d([m({constructOnly:!0})],z0.prototype,"priority",void 0),d([m({constructOnly:!0})],z0.prototype,"process",void 0),d([m({constructOnly:!0})],z0.prototype,"scheduler",void 0),d([m()],z0.prototype,"state",void 0),d([m({constructOnly:!0})],z0.prototype,"tileInfoView",void 0),z0=d([k("esri.views.2d.tiling.TileQueue")],z0);new v2(0,0,0,0);const Y0e=512,MD=4096,SKt=8,P3t=.125;function Lw(){const t=new Float32Array(9);return t[0]=1,t[4]=1,t[8]=1,t}function h5e(t){const e=new Float32Array(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function R3t(t,e,i,r,s,n,a,o,l){const c=new Float32Array(9);return c[0]=t,c[1]=e,c[2]=i,c[3]=r,c[4]=s,c[5]=n,c[6]=a,c[7]=o,c[8]=l,c}Object.freeze(Object.defineProperty({__proto__:null,clone:h5e,create:Lw,fromValues:R3t},Symbol.toStringTag,{value:"Module"}));const TKt=!0,D3t=32,UX=200,I3t=512;let Ao=class XO{constructor(e,i){this.x=e,this.y=i}static fromArray(e){return new XO(e[0],e[1])}clone(){return new XO(this.x,this.y)}equals(e,i){return e===this.x&&i===this.y}isEqual(e){return e.x===this.x&&e.y===this.y}setCoords(e,i){return this.x=e,this.y=i,this}normalize(){const e=this.x,i=this.y,r=Math.sqrt(e*e+i*i);return this.x/=r,this.y/=r,this}rightPerpendicular(){const e=this.x;return this.x=this.y,this.y=-e,this}leftPerpendicular(){const e=this.x;return this.x=-this.y,this.y=e,this}move(e,i){return this.x+=e,this.y+=i,this}assign(e){return this.x=e.x,this.y=e.y,this}assignAdd(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this}assignSub(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this}rotate(e,i){const r=this.x,s=this.y;return this.x=r*e-s*i,this.y=r*i+s*e,this}rotateReverse(e,i){const r=this.x,s=this.y;return this.x=r*e+s*i,this.y=-r*i+s*e,this}scale(e){return this.x*=e,this.y*=e,this}length(){const e=this.x,i=this.y;return Math.sqrt(e*e+i*i)}sub(e){return this.x-=e.x,this.y-=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}static distance(e,i){const r=i.x-e.x,s=i.y-e.y;return Math.sqrt(r*r+s*s)}static add(e,i){return new XO(e.x+i.x,e.y+i.y)}static sub(e,i){return new XO(e.x-i.x,e.y-i.y)}},sk=class{constructor(e,i,r){this.ratio=e,this.x=i,this.y=r}},CKt=class{constructor(e,i,r,s=8,n=8){this._lines=[],this._starts=[],this.validateTessellation=!0,this._pixelRatio=s,this._pixelMargin=n,this._tileSize=I3t*s,this._dz=e,this._yPos=i,this._xPos=r}setPixelMargin(e){e!==this._pixelMargin&&(this._pixelMargin=e,this.setExtent(this._extent))}setExtent(e){this._extent=e,this._finalRatio=this._tileSize/e*(1<<this._dz);let i=this._pixelRatio*this._pixelMargin;i/=this._finalRatio;const r=e>>this._dz;i>r&&(i=r),this._margin=i,this._xmin=r*this._xPos-i,this._ymin=r*this._yPos-i,this._xmax=this._xmin+r+2*i,this._ymax=this._ymin+r+2*i}reset(e){this._type=e,this._lines=[],this._starts=[],this._line=null,this._start=0}moveTo(e,i){this._pushLine(),this._prevIsIn=this._isIn(e,i),this._moveTo(e,i,this._prevIsIn),this._prevPt=new Ao(e,i),this._firstPt=new Ao(e,i),this._dist=0}lineTo(e,i){const r=this._isIn(e,i),s=new Ao(e,i),n=Ao.distance(this._prevPt,s);let a,o,l,c,h,f,y,_;if(r)this._prevIsIn?this._lineTo(e,i,!0):(a=this._prevPt,o=s,l=this._intersect(o,a),this._start=this._dist+n*(1-this._r),this._lineTo(l.x,l.y,!0),this._lineTo(o.x,o.y,!0));else if(this._prevIsIn)o=this._prevPt,a=s,l=this._intersect(o,a),this._lineTo(l.x,l.y,!0),this._lineTo(a.x,a.y,!1);else{const w=this._prevPt,x=s;if(w.x<=this._xmin&&x.x<=this._xmin||w.x>=this._xmax&&x.x>=this._xmax||w.y<=this._ymin&&x.y<=this._ymin||w.y>=this._ymax&&x.y>=this._ymax)this._lineTo(x.x,x.y,!1);else{const S=[];if((w.x<this._xmin&&x.x>this._xmin||w.x>this._xmin&&x.x<this._xmin)&&(c=(this._xmin-w.x)/(x.x-w.x),_=w.y+c*(x.y-w.y),_<=this._ymin?f=!1:_>=this._ymax?f=!0:S.push(new sk(c,this._xmin,_))),(w.x<this._xmax&&x.x>this._xmax||w.x>this._xmax&&x.x<this._xmax)&&(c=(this._xmax-w.x)/(x.x-w.x),_=w.y+c*(x.y-w.y),_<=this._ymin?f=!1:_>=this._ymax?f=!0:S.push(new sk(c,this._xmax,_))),(w.y<this._ymin&&x.y>this._ymin||w.y>this._ymin&&x.y<this._ymin)&&(c=(this._ymin-w.y)/(x.y-w.y),y=w.x+c*(x.x-w.x),y<=this._xmin?h=!1:y>=this._xmax?h=!0:S.push(new sk(c,y,this._ymin))),(w.y<this._ymax&&x.y>this._ymax||w.y>this._ymax&&x.y<this._ymax)&&(c=(this._ymax-w.y)/(x.y-w.y),y=w.x+c*(x.x-w.x),y<=this._xmin?h=!1:y>=this._xmax?h=!0:S.push(new sk(c,y,this._ymax))),S.length===0)h?f?this._lineTo(this._xmax,this._ymax,!0):this._lineTo(this._xmax,this._ymin,!0):f?this._lineTo(this._xmin,this._ymax,!0):this._lineTo(this._xmin,this._ymin,!0);else if(S.length>1&&S[0].ratio>S[1].ratio)this._start=this._dist+n*S[1].ratio,this._lineTo(S[1].x,S[1].y,!0),this._lineTo(S[0].x,S[0].y,!0);else{this._start=this._dist+n*S[0].ratio;for(let $=0;$<S.length;$++)this._lineTo(S[$].x,S[$].y,!0)}this._lineTo(x.x,x.y,!1)}}this._dist+=n,this._prevIsIn=r,this._prevPt=s}close(){if(this._line.length>2){const e=this._firstPt,i=this._prevPt;e.x===i.x&&e.y===i.y||this.lineTo(e.x,e.y);const r=this._line;let s=r.length;for(;s>=4&&(r[0].x===r[1].x&&r[0].x===r[s-2].x||r[0].y===r[1].y&&r[0].y===r[s-2].y);)r.pop(),r[0].x=r[s-2].x,r[0].y=r[s-2].y,--s}}result(e=!0){return this._pushLine(),this._lines.length===0?null:(this._type===3&&e&&L3t.simplify(this._tileSize,this._margin*this._finalRatio,this._lines),this._lines)}resultWithStarts(){if(this._type!==2)throw new Error("Only valid for lines");this._pushLine();const e=this._lines,i=e.length;if(i===0)return null;const r=[];for(let s=0;s<i;s++)r.push({line:e[s],start:this._starts[s]||0});return r}_isIn(e,i){return e>=this._xmin&&e<=this._xmax&&i>=this._ymin&&i<=this._ymax}_intersect(e,i){let r,s,n;if(i.x>=this._xmin&&i.x<=this._xmax)s=i.y<=this._ymin?this._ymin:this._ymax,n=(s-e.y)/(i.y-e.y),r=e.x+n*(i.x-e.x);else if(i.y>=this._ymin&&i.y<=this._ymax)r=i.x<=this._xmin?this._xmin:this._xmax,n=(r-e.x)/(i.x-e.x),s=e.y+n*(i.y-e.y);else{s=i.y<=this._ymin?this._ymin:this._ymax,r=i.x<=this._xmin?this._xmin:this._xmax;const a=(r-e.x)/(i.x-e.x),o=(s-e.y)/(i.y-e.y);a<o?(n=a,s=e.y+a*(i.y-e.y)):(n=o,r=e.x+o*(i.x-e.x))}return this._r=n,new Ao(r,s)}_pushLine(){this._line&&(this._type===1?this._line.length>0&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===2?this._line.length>1&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===3&&this._line.length>3&&(this._lines.push(this._line),this._starts.push(this._start))),this._line=[],this._start=0}_moveTo(e,i,r){this._type!==3?r&&(e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),i=Math.round((i-(this._ymin+this._margin))*this._finalRatio),this._line.push(new Ao(e,i))):(r||(e<this._xmin&&(e=this._xmin),e>this._xmax&&(e=this._xmax),i<this._ymin&&(i=this._ymin),i>this._ymax&&(i=this._ymax)),e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),i=Math.round((i-(this._ymin+this._margin))*this._finalRatio),this._line.push(new Ao(e,i)),this._isH=!1,this._isV=!1)}_lineTo(e,i,r){let s,n;if(this._type!==3)if(r){if(e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),i=Math.round((i-(this._ymin+this._margin))*this._finalRatio),this._line.length>0&&(s=this._line[this._line.length-1],s.equals(e,i)))return;this._line.push(new Ao(e,i))}else this._line&&this._line.length>0&&this._pushLine();else if(r||(e<this._xmin&&(e=this._xmin),e>this._xmax&&(e=this._xmax),i<this._ymin&&(i=this._ymin),i>this._ymax&&(i=this._ymax)),e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),i=Math.round((i-(this._ymin+this._margin))*this._finalRatio),this._line&&this._line.length>0){s=this._line[this._line.length-1];const a=s.x===e,o=s.y===i;if(a&&o)return;this._isH&&a||this._isV&&o?(s.x=e,s.y=i,n=this._line[this._line.length-2],n.x===e&&n.y===i?(this._line.pop(),this._line.length<=1?(this._isH=!1,this._isV=!1):(n=this._line[this._line.length-2],this._isH=n.x===e,this._isV=n.y===i)):(this._isH=n.x===e,this._isV=n.y===i)):(this._line.push(new Ao(e,i)),this._isH=a,this._isV=o)}else this._line.push(new Ao(e,i))}},EKt=class{setExtent(e){this._ratio=e===4096?1:4096/e}get validateTessellation(){return this._ratio<1}reset(e){this._lines=[],this._line=null}moveTo(e,i){this._line&&this._lines.push(this._line),this._line=[];const r=this._ratio;this._line.push(new Ao(e*r,i*r))}lineTo(e,i){const r=this._ratio;this._line.push(new Ao(e*r,i*r))}close(){const e=this._line;e&&!e[0].isEqual(e[e.length-1])&&e.push(e[0])}result(){return this._line&&this._lines.push(this._line),this._lines.length===0?null:this._lines}},L3t=class e_{static simplify(e,i,r){if(!r)return;const s=-i,n=e+i,a=-i,o=e+i,l=[],c=[],h=r.length;for(let y=0;y<h;++y){const _=r[y];if(!_||_.length<2)continue;let w,x=_[0];const S=_.length;for(let $=1;$<S;++$)w=_[$],x.x===w.x&&(x.x<=s&&(x.y>w.y?(l.push(y),l.push($),l.push(0),l.push(-1)):(c.push(y),c.push($),c.push(0),c.push(-1))),x.x>=n&&(x.y<w.y?(l.push(y),l.push($),l.push(1),l.push(-1)):(c.push(y),c.push($),c.push(1),c.push(-1)))),x.y===w.y&&(x.y<=a&&(x.x<w.x?(l.push(y),l.push($),l.push(2),l.push(-1)):(c.push(y),c.push($),c.push(2),c.push(-1))),x.y>=o&&(x.x>w.x?(l.push(y),l.push($),l.push(3),l.push(-1)):(c.push(y),c.push($),c.push(3),c.push(-1)))),x=w}if(l.length===0||c.length===0)return;e_.fillParent(r,c,l),e_.fillParent(r,l,c);const f=[];e_.calcDeltas(f,c,l),e_.calcDeltas(f,l,c),e_.addDeltas(f,r)}static fillParent(e,i,r){const s=r.length,n=i.length;for(let a=0;a<n;a+=4){const o=i[a],l=i[a+1],c=i[a+2],h=e[o][l-1],f=e[o][l];let y=8092,_=-1;for(let w=0;w<s;w+=4){if(r[w+2]!==c)continue;const x=r[w],S=r[w+1],$=e[x][S-1],A=e[x][S];switch(c){case 0:case 1:if(nk(h.y,$.y,A.y)&&nk(f.y,$.y,A.y)){const M=Math.abs(A.y-$.y);M<y&&(y=M,_=w)}break;case 2:case 3:if(nk(h.x,$.x,A.x)&&nk(f.x,$.x,A.x)){const M=Math.abs(A.x-$.x);M<y&&(y=M,_=w)}}}i[a+3]=_}}static calcDeltas(e,i,r){const s=i.length;for(let n=0;n<s;n+=4){const a=[],o=e_.calcDelta(n,i,r,a);e.push(i[n]),e.push(i[n+1]),e.push(i[n+2]),e.push(o)}}static calcDelta(e,i,r,s){const n=i[e+3];if(n===-1)return 0;const a=s.length;return a>1&&s[a-2]===n?0:(s.push(n),e_.calcDelta(n,r,i,s)+1)}static addDeltas(e,i){const r=e.length;let s=0;for(let n=0;n<r;n+=4){const a=e[n+3];a>s&&(s=a)}for(let n=0;n<r;n+=4){const a=i[e[n]],o=e[n+1],l=s-e[n+3];switch(e[n+2]){case 0:a[o-1].x-=l,a[o].x-=l,o===1&&(a[a.length-1].x-=l),o===a.length-1&&(a[0].x-=l);break;case 1:a[o-1].x+=l,a[o].x+=l,o===1&&(a[a.length-1].x+=l),o===a.length-1&&(a[0].x+=l);break;case 2:a[o-1].y-=l,a[o].y-=l,o===1&&(a[a.length-1].y-=l),o===a.length-1&&(a[0].y-=l);break;case 3:a[o-1].y+=l,a[o].y+=l,o===1&&(a[a.length-1].y+=l),o===a.length-1&&(a[0].y+=l)}}}};const nk=(t,e,i)=>t>=e&&t<=i||t>=i&&t<=e,OKt=Number.POSITIVE_INFINITY,gse=Math.PI,PKt=2*gse,k3t=128/gse,z3t=256/360,RKt=gse/180,F3t=1/Math.LN2;function d5e(t,e){return(t%=e)>=0?t:t+e}function DKt(t){return d5e(t*k3t,256)}function IKt(t){return d5e(t*z3t,256)}function LKt(t){return Math.log(t)*F3t}function kKt(t,e,i){return t*(1-i)+e*i}const N3t=8,V3t=14,U3t=16;function zKt(t){return N3t+Math.max((t-V3t)*U3t,0)}function FKt(t,e,i){let r,s,n,a=0;for(const o of i){r=o.length;for(let l=1;l<r;++l)s=o[l-1],n=o[l],s.y>e!=n.y>e&&((n.x-s.x)*(e-s.y)-(n.y-s.y)*(t-s.x)>0?a++:a--)}return a!==0}function NKt(t,e,i,r){let s,n,a,o;const l=r*r;for(const c of i){const h=c.length;if(!(h<2)){s=c[0].x,n=c[0].y;for(let f=1;f<h;++f){if(a=c[f].x,o=c[f].y,IGe(t,e,s,n,a,o)<l)return!0;s=a,n=o}}}return!1}function B3t(t,e,i,r,s,n,a){const o=Math.max(r,Math.min(e,n))-e,l=Math.max(s,Math.min(i,a))-i;return o*o+l*l<=t*t}function VKt(t,e){if(e===0||Number.isNaN(e))return t;const i=[],r=new Ao(0,0),s=new Ao(0,0),n=new Ao(0,0);for(let a=0;a<t.length;a++){const o=t[a],l=[];for(let c=0;c<o.length;c++){const h=o[c-1],f=o[c],y=o[c+1];c===0?r.setCoords(0,0):r.assignSub(f,h).normalize().rightPerpendicular(),c===o.length-1?s.setCoords(0,0):s.assignSub(y,f).normalize().rightPerpendicular(),n.assignAdd(r,s).normalize();const _=n.x*s.x+n.y*s.y;_!==0&&n.scale(1/_),l.push(Ao.add(f,n.scale(e)))}i.push(l)}return i}function UKt(t,e,i,r){const s=new Ao(t[0],t[1]);if(s.scale(r),e==="viewport"){const n=-i*(Math.PI/180),a=Math.cos(n),o=Math.sin(n);s.rotate(a,o)}return s}let j3t=class{constructor(e,i){this.sourceTile=i,this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.featureIndex=0,this.uniqueSymbol=null,this._colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=e}colliders(){return this._colliders}},q3t=class{constructor(e){this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1,this.lastShow=!1,this.tileSymbols=[e],this.id=e.id}};function G3t(t,e,i,r){return p5e(t,e,i.level,i.col,r.key.level,r.key.col)}function H3t(t,e,i,r){return p5e(t,e,i.level,i.row,r.level,r.row)}function p5e(t,e,i,r,s,n){const a=i-s;if(a>=0)return(e>>a)+(r-(n<<a))*(t>>a);const o=-a;return e-(n-(r<<o))*(t>>o)<<o}let f5e=class{constructor(e,i,r){this._rows=Math.ceil(i/r),this._columns=Math.ceil(e/r),this._cellSize=r,this.cells=new Array(this._rows);for(let s=0;s<this._rows;s++){this.cells[s]=new Array(this._columns);for(let n=0;n<this._columns;n++)this.cells[s][n]=[]}}getCell(e,i){const r=Math.min(Math.max(Math.floor(i/this._cellSize),0),this._rows-1),s=Math.min(Math.max(Math.floor(e/this._cellSize),0),this._columns-1);return this.cells[r]&&this.cells[r][s]||null}getCellSpan(e,i,r,s){return[Math.min(Math.max(Math.floor(e/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(s/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}};function W3t(t,e,i,r,s,n,a){const o=e[r++];for(let l=0;l<o;l++){const c=new j3t(n,a);c.xTile=e[r++],c.yTile=e[r++],c.hash=e[r++],c.priority=e[r++],c.featureIndex=e[r++];const h=e[r++],f=c.colliders();for(let w=0;w<h;w++){const x=e[r++],S=e[r++],$=e[r++],A=e[r++],M=!!e[r++],P=e[r++],O=i[r++],D=i[r++],L=e[r++],F=e[r++];f.push({xTile:x,yTile:S,dxPixels:$,dyPixels:A,hard:M,partIndex:P,width:L,height:F,minLod:O,maxLod:D})}const y=t[r++];for(let w=0;w<y;w++)c.textVertexRanges.push([t[r++],t[r++]]);const _=t[r++];for(let w=0;w<_;w++)c.iconVertexRanges.push([t[r++],t[r++]]);s.push(c)}return r}function Z3t(t,e,i){for(const[r,s]of t.symbols)Y3t(t,e,i,s,r)}function Y3t(t,e,i,r,s){const n=t.layerData.get(s);if(n.type===3){for(const a of r){const o=a.uniqueSymbol;let l;if(a.selectedForRendering){const c=o.parts[0];c.startOpacity;const h=c.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&h===0;const f=h?255:0;l=f<<24|f<<16|f<<8|f}else l=0;for(const[c,h]of a.iconVertexRanges)for(let f=c;f<c+h;f+=4)n.iconOpacity[f/4]=l;if(a.selectedForRendering){const c=o.parts[1];c.startOpacity;const h=c.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&h===0;const f=h?255:0;l=f<<24|f<<16|f<<8|f}else l=0;for(const[c,h]of a.textVertexRanges)for(let f=c;f<c+h;f+=4)n.textOpacity[f/4]=l}n.lastOpacityUpdate=e,n.opacityChanged=!0}}function Q3t(t,e,i,r){const s=t.colliders();let n,a,o,l;for(const c of s)if(t.uniqueSymbol?.show&&t.uniqueSymbol.parts[c.partIndex].show&&(n=c.xScreen-r[0]+c.dxScreen,a=c.yScreen-r[1]+c.dyScreen,o=n+c.width,l=a+c.height,B3t(i,e.x,e.y,n,a,o,l)))return!0;return!1}let X3t=class{constructor(e,i,r,s,n,a){this._symbols=e,this._styleRepository=s,this._zoom=n,this._currentLayerCursor=0,this._currentSymbolCursor=0,this._styleProps=new Map,this._allNeededMatrices=new Map,this._gridIndex=new f5e(i,r,D3t),this._si=Math.sin(Math.PI*a/180),this._co=Math.cos(Math.PI*a/180),s.cachedStyles&&(this._styleProps=s.cachedStyles);for(const o of e)for(const l of o.symbols)this._allNeededMatrices.has(l.tile)||this._allNeededMatrices.set(l.tile,h5e(l.tile.transforms.tileUnitsToPixels))}work(e){const i=performance.now();for(;this._currentLayerCursor<this._symbols.length;this._currentLayerCursor++,this._currentSymbolCursor=0){const r=this._symbols[this._currentLayerCursor],s=this._getProperties(r.styleLayerUID),n=this._styleRepository.layerContexts?.get(r.styleLayerUID);for(;this._currentSymbolCursor<r.symbols.length;this._currentSymbolCursor++){if(this._currentSymbolCursor%100==99&&performance.now()-i>e)return!1;const a=r.symbols[this._currentSymbolCursor];if(!a.uniqueSymbol?.show)continue;const o=this._computeCoordinates(a,s,n),l=a.uniqueSymbol;if(!l.show)continue;const{iconAllowOverlap:c,textAllowOverlap:h}=s;for(const f of o){if(!f.enabled)continue;const y=l.parts[f.partIndex];y.show&&!(f.partIndex?h:c)&&this._doesCollide(f)&&(f.hard?l.show=!1:y.show=!1)}l.show&&this._insertColliders(l.parts,o,s)}}return!0}_insertColliders(e,i,r){const{iconIgnorePlacement:s,textIgnorePlacement:n}=r;for(const a of i){if(!a.enabled||(a.partIndex?n:s)||!e[a.partIndex].show)continue;const o=a.xScreen+a.dxScreen,l=a.yScreen+a.dyScreen,c=o+a.width,h=l+a.height,[f,y,_,w]=this._gridIndex.getCellSpan(o,l,c,h);for(let x=y;x<=w;x++)for(let S=f;S<=_;S++)this._gridIndex.cells[x][S].push(a)}}_computeCoordinates(e,i,r){const{iconRotationAlignment:s,textRotationAlignment:n,iconTranslate:a,iconTranslateAnchor:o,textTranslate:l,textTranslateAnchor:c}=i,h=this._si,f=this._co,y=this._zoom,_=this._allNeededMatrices.get(e.tile),w=e.uniqueSymbol,x=e.colliders(r);let S=0;for(const $ of x){const[A,M]=$.partIndex===0?a:l,P=$.partIndex===0?o:c,O=$.minLod<=y&&y<=$.maxLod;S+=O?0:1,$.enabled=O,$.xScreen=$.xTile*_[0]+$.yTile*_[3]+_[6],$.yScreen=$.xTile*_[1]+$.yTile*_[4]+_[7],P===0?($.xScreen+=f*A-h*M,$.yScreen+=h*A+f*M):($.xScreen+=A,$.yScreen+=M),($.partIndex===0?s:n)===1?($.dxScreen=$.dxPixels,$.dyScreen=$.dyPixels):($.dxScreen=f*($.dxPixels+$.width/2)-h*($.dyPixels+$.height/2)-$.width/2,$.dyScreen=h*($.dxPixels+$.width/2)+f*($.dyPixels+$.height/2)-$.height/2)}return x.length>0&&S===x.length&&w&&(w.show=!1),x}_getProperties(e){const i=this._styleProps.get(e);if(i)return i;const r=this._styleRepository.getLayerStyleProperties?.(e,this._zoom);return this._styleProps.set(e,r),r}_doesCollide(e){const i=e.xScreen+e.dxScreen,r=e.yScreen+e.dyScreen,s=i+e.width,n=r+e.height,[a,o,l,c]=this._gridIndex.getCellSpan(i,r,s,n);for(let h=o;h<=c;h++)for(let f=a;f<=l;f++){const y=this._gridIndex.cells[h][f];for(const _ of y){if(_.labelId!=null&&e.labelId!=null&&_.labelId===e.labelId)continue;const w=_.xScreen+_.dxScreen,x=_.yScreen+_.dyScreen,S=w+_.width,$=x+_.height;if(!(s<w||i>S||n<x||r>$))return!0}}return!1}},Y8=class{constructor(e,i){this.layerUIDs=[],this.isDestroyed=!1,this._data=e;let r=1;const s=new Uint32Array(e);this.layerUIDs=[];const n=s[r++];for(let a=0;a<n;a++)this.layerUIDs[a]=s[r++];this.bufferDataOffset=r,i&&(this.layer=i.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return this._data==null}get offset(){return this.bufferDataOffset}get data(){return this._data}destroy(){this.isDestroyed||(this.doDestroy(),this._data=null,this.isDestroyed=!0)}prepareForRendering(e){this._data!=null&&(this.doPrepareForRendering(e,this._data,this.bufferDataOffset),this._data=null)}},J3t=class extends Y8{constructor(e,i){super(e,i),this.type=2,this.lineIndexStart=0,this.lineIndexCount=0;const r=new Uint32Array(e);let s=this.bufferDataOffset;this.lineIndexStart=r[s++],this.lineIndexCount=r[s++];const n=r[s++];if(n>0){this.patternMap=new Map;for(let a=0;a<n;a++){const o=r[s++],l=r[s++],c=r[s++];this.patternMap.set(o,[l,c])}}this.bufferDataOffset=s}get usedMemory(){return(this.data?.byteLength??0)+(this.vao?.usedMemory??0)}hasData(){return this.lineIndexCount>0}triangleCount(){return this.lineIndexCount/3}doDestroy(){this.vao=Rt(this.vao)}doPrepareForRendering(e,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),a=s[r++],o=this.layer.lineMaterial,l=new Hs(e,o.geometryLayout,new Int32Array(n.buffer,4*r,a));r+=a;const c=s[r++],h=Uu.createIndex(e,35044,new Uint32Array(s.buffer,4*r,c));r+=c,this.vao=new by(e,l,h)}},K3t=class extends Y8{constructor(e,i){super(e,i),this.type=1,this.fillIndexStart=0,this.fillIndexCount=0,this.outlineIndexStart=0,this.outlineIndexCount=0;const r=new Uint32Array(e);let s=this.bufferDataOffset;this.fillIndexStart=r[s++],this.fillIndexCount=r[s++],this.outlineIndexStart=r[s++],this.outlineIndexCount=r[s++];const n=r[s++];if(n>0){this.patternMap=new Map;for(let a=0;a<n;a++){const o=r[s++],l=r[s++],c=r[s++];this.patternMap.set(o,[l,c])}}this.bufferDataOffset=s}get usedMemory(){return(this.data?.byteLength??0)+(this.fillVAO?.usedMemory??0)+(this.outlineVAO?.usedMemory??0)}hasData(){return this.fillIndexCount>0||this.outlineIndexCount>0}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){this.fillVAO=Rt(this.fillVAO),this.outlineVAO=Rt(this.outlineVAO)}doPrepareForRendering(e,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),a=s[r++],o=this.layer,l=o.fillMaterial,c=new Hs(e,l.geometryLayout,new Int32Array(n.buffer,4*r,a));r+=a;const h=s[r++],f=Uu.createIndex(e,35044,new Uint32Array(s.buffer,4*r,h));r+=h;const y=s[r++],_=o.outlineMaterial,w=new Hs(e,_.geometryLayout,new Int32Array(n.buffer,4*r,y));r+=y;const x=s[r++],S=Uu.createIndex(e,35044,new Uint32Array(s.buffer,4*r,x));r+=x,this.fillVAO=new by(e,c,f),this.outlineVAO=new by(e,w,S)}},e$t=class extends Y8{constructor(e,i,r){super(e,i),this.type=3,this.iconPerPageElementsMap=new Map,this.glyphPerPageElementsMap=new Map,this.symbolInstances=[],this.isIconSDF=!1,this.opacityChanged=!1,this.lastOpacityUpdate=0,this.symbols=[];const s=new Uint32Array(e),n=new Int32Array(e),a=new Float32Array(e);let o=this.bufferDataOffset;this.isIconSDF=!!s[o++];const l=s[o++],c=s[o++],h=s[o++],f=new v2(l,c,h,0),y=s[o++];for(let S=0;S<y;S++){const $=s[o++],A=s[o++],M=s[o++];this.iconPerPageElementsMap.set($,[A,M])}const _=s[o++];for(let S=0;S<_;S++){const $=s[o++],A=s[o++],M=s[o++];this.glyphPerPageElementsMap.set($,[A,M])}const w=s[o++],x=s[o++];this.iconOpacity=new Int32Array(w),this.textOpacity=new Int32Array(x),o=W3t(s,n,a,o,this.symbols,r,f),this.bufferDataOffset=o}get usedMemory(){return(this.data?.byteLength??0)+(this.iconVAO?.usedMemory??0)+(this.textVAO?.usedMemory??0)+Wx(this.iconOpacity)+Wx(this.textOpacity)}hasData(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}triangleCount(){let e=0;for(const i of this.iconPerPageElementsMap.values())e+=i[1];for(const i of this.glyphPerPageElementsMap.values())e+=i[1];return e/3}doDestroy(){this.iconVAO=Rt(this.iconVAO),this.textVAO=Rt(this.textVAO)}updateOpacityInfo(){if(!this.opacityChanged)return;this.opacityChanged=!1;const e=this.iconOpacity,i=this.iconVAO.buffer("opacity");e.length>0&&e.byteLength===i.usedMemory&&i.setSubData(e,0,0,e.length);const r=this.textOpacity,s=this.textVAO.buffer("opacity");r.length>0&&r.byteLength===s.usedMemory&&s.setSubData(r,0,0,r.length)}doPrepareForRendering(e,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),a=s[r++],o=this.layer,l=o.iconMaterial,c=new Hs(e,l.geometryLayout,new Int32Array(n.buffer,4*r,a));r+=a;const h=s[r++],f=Uu.createIndex(e,35044,new Uint32Array(s.buffer,4*r,h));r+=h;const y=s[r++],_=o.textMaterial,w=new Hs(e,_.geometryLayout,new Int32Array(n.buffer,4*r,y));r+=y;const x=s[r++],S=Uu.createIndex(e,35044,new Uint32Array(s.buffer,4*r,x));r+=x;const $=new Hs(e,l.opacityLayout,this.iconOpacity.buffer),A=new Hs(e,_.opacityLayout,this.textOpacity.buffer);this.iconVAO=new by(e,new Map([["geometry",c],["opacity",$]]),f),this.textVAO=new by(e,new Map([["geometry",w],["opacity",A]]),S)}},t$t=class extends Y8{constructor(e,i){super(e,i),this.type=4,this.circleIndexStart=0,this.circleIndexCount=0;const r=new Uint32Array(e);let s=this.bufferDataOffset;this.circleIndexStart=r[s++],this.circleIndexCount=r[s++],this.bufferDataOffset=s}get usedMemory(){return(this.data?.byteLength??0)+(this.vao?.usedMemory??0)}hasData(){return this.circleIndexCount>0}triangleCount(){return this.circleIndexCount/3}doDestroy(){this.vao=Rt(this.vao)}doPrepareForRendering(e,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),a=s[r++],o=this.layer.circleMaterial,l=new Hs(e,o.geometryLayout,new Int32Array(n.buffer,4*r,a));r+=a;const c=s[r++],h=Uu.createIndex(e,35044,new Uint32Array(s.buffer,4*r,c));r+=c,this.vao=new by(e,l,h)}},pf=class extends Me{constructor(e){super(e),this.computedOpacity=1,this.computedVisible=!0,this.opacity=1,this.visible=!0,this._fadeOutResolver=null,this._fadeInResolver=null}get transitioning(){return(this._fadeOutResolver||!this.visible?0:this.opacity)!==this.computedOpacity}endTransition(){this._fadeInResolver?.(),this._fadeOutResolver?.(),this._fadeInResolver=this._fadeOutResolver=null,this.computedOpacity=this.visible?this.opacity:0}fadeIn(){return this._fadeInResolver||(this.opacity=1,this.computedOpacity=0,this._fadeOutResolver?.(),this._fadeOutResolver=null,this._fadeInResolver=lo()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this.opacity=0,this._fadeInResolver?.(),this._fadeInResolver=null,this._fadeOutResolver=lo()),this._fadeOutResolver.promise}transitionStep(e,i){const r=ie("mapview-transitions-duration"),s=r?1/r:0;if(s===0)this.computedOpacity=this.opacity,this.computedVisible=this.visible;else{const n=this._fadeOutResolver||!this.visible?0:this.opacity,a=this.computedOpacity;if(a===n)this.computedVisible=this.visible;else{const o=e*s;this.computedOpacity=a>n?Math.max(n,a-o):Math.min(n,a+o),this.computedVisible=this.computedOpacity>0}}this.transitioning||(this._fadeInResolver?.(),this._fadeOutResolver?.(),this._fadeOutResolver=this._fadeInResolver=null)}};d([m()],pf.prototype,"computedOpacity",void 0),d([m()],pf.prototype,"computedVisible",void 0),d([m()],pf.prototype,"opacity",void 0),d([m()],pf.prototype,"visible",void 0),d([m()],pf.prototype,"transitioning",null),d([m()],pf.prototype,"_fadeOutResolver",void 0),d([m()],pf.prototype,"_fadeInResolver",void 0),pf=d([k("esri.views.2d.engine.transitions.FadeTransition")],pf);let i$t=class extends tSe{constructor(){super(...arguments),this._transitionables=null,this._clips=null,this._fadeTransition=null,this._isReady=!1,this._opacity=1,this.parent=null,this._stage=null,this._visible=!0}get computedOpacity(){return this._fadeTransition?.computedOpacity??this.opacity}get clips(){return this._clips}set clips(e){this._clips=e,this.requestRender()}get fadeTransitionEnabled(){return this._fadeTransition!==null}set fadeTransitionEnabled(e){!this._fadeTransition&&e?(this._fadeTransition=new pf({opacity:this.opacity,visible:this.visible}),this.addTransitionable(this._fadeTransition)):this._fadeTransition&&!e&&(this.removeTransitionable(this._fadeTransition),this._fadeTransition=null)}get inFadeTransition(){return this._fadeTransition?.transitioning??!1}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(e){this._opacity!==e&&(this._opacity=Math.min(1,Math.max(e,0)),this._fadeTransition&&(this._fadeTransition.opacity=this._opacity),this.requestRender())}get stage(){return this._stage}set stage(e){if(this._stage===e)return;const i=this._stage;this._stage=e,e?this._stage?.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):i?.trashDisplayObject(this)}get transforms(){return this._transforms==null&&(this._transforms=this._createTransforms()),this._transforms}get transitioning(){return this.isTransitioning()}get usedMemory(){return 0}get visible(){return this._visible}set visible(e){this._visible!==e&&(this._visible=e,this._fadeTransition&&(this._fadeTransition.visible=this._visible),this.requestRender())}get hasLabels(){return!1}get hasHighlight(){return!1}get hasBlending(){return!1}addTransitionable(e){this._transitionables??=[],this._transitionables.push(e),this.requestRender()}removeTransitionable(e){e.endTransition(),this._transitionables&&tM(this._transitionables,e),this.requestRender()}fadeIn(){this.fadeTransitionEnabled=!0;const e=this._fadeTransition.fadeIn();return this.opacity=1,this.requestRender(),e}fadeOut(){this.fadeTransitionEnabled=!0;const e=this._fadeTransition.fadeOut();return this.opacity=0,this.requestRender(),e}endTransitions(){if(this._transitionables){for(const e of this._transitionables)e.endTransition();this.requestRender()}}beforeRender(e){this.transitionStep(e.deltaTime,e.state.scale),this.setTransform(e.state)}afterRender(e){this.transitioning&&this.requestRender()}remove(){this.parent?.removeChild(this)}setTransform(e){}processRender(e){this.stage&&(this._fadeTransition?.computedVisible??this.visible)&&this.doRender(e)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this.endTransitions(),this.onDetach(),this.emit("detach")}isTransitioning(){return this._transitionables?.some(e=>e.transitioning)??!1}transitionStep(e,i){if(this._transitionables)for(const r of this._transitionables)r.transitionStep(e,i)}onAttach(){}onDetach(){}doRender(e){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}},m5e=class extends i$t{constructor(e,i,r,s,n,a,o=n,l=a){super(),this.tileDebugInfoTexture=null,this.debugInfo={display:{length:0,minOrderedLength:0,minUnorderedLength:0,triangleCount:0},memory:{bytesUsed:0,bytesReserved:0}},this._destroyed=!1,this.key=new v2(e),this.resolution=i,this.x=r,this.y=s,this.width=n,this.height=a,this.rangeX=o,this.rangeY=l}destroy(){super.destroy(),this.tileDebugInfoTexture&&(this.tileDebugInfoTexture.dispose(),this.tileDebugInfoTexture=null),this._destroyed=!0}get debugSlot(){let e=this;for(;e.parent!==this._stage;){if(!e.parent)return 0;e=e.parent}return this._stage.children.indexOf(e)}setTransform(e){const i=this.resolution/(e.resolution*e.pixelRatio),r=this.transforms.tileMat3,[s,n]=e.toScreenNoRotation([0,0],[this.x,this.y]),a=this.width/this.rangeX*i,o=this.height/this.rangeY*i;B_(r,a,0,0,0,o,0,s,n,1),gC(this.transforms.displayViewScreenMat3,e.displayViewMat3,r)}get destroyed(){return this._destroyed}},r$t=class g5e extends m5e{constructor(e,i,r,s,n,a,o,l=null){super(e,i,r,s,n,a,MD,MD),this.styleRepository=o,this._owner=l,this.type="vector-tile",this._referenced=1,this._hasSymbolBuckets=!1,this._usedMemory=256,this.layerData=new Map,this.status="loading",this.allSymbolsFadingOut=!1,this.lastOpacityUpdate=0,this.symbols=new Map,this.isCoverage=!1,this.neededForCoverage=!1,this.decluttered=!1,this.parentTile=null,this.childrenTiles=new Set,this.featureIndex=null,this.triangleCount=0,this._processed=!1,this.id=e.id}get styleLayerUIDs(){return Array.from(this.layerData.keys())}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<UX}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<UX)}get wasRequested(){return this.status==="errored"||this.status==="loaded"||this.status==="reloading"}setData(e){this.changeDataImpl(e),this.requestRender(),this.ready(),this._processed=!0}deleteLayerData(e){let i=!1;for(const r of e){const s=this.layerData.get(r);s&&(this._usedMemory-=s.usedMemory,s.type===3&&this.symbols.delete(r)&&(i=!0),s.destroy(),this.layerData.delete(r))}this._owner?.updateTileSize(this),i&&(this.featureIndex?.clear(),this.emit("symbols-changed")),this.requestRender()}processed(){return this._processed}hasData(){return this.layerData.size>0}hasFeatures(){const e=this.layerData.values();for(const i of e)if(i.hasData())return!0;return!1}dispose(){this.status!=="unloaded"&&(g5e._destroyRenderBuckets(this.layerData),this.layerData.clear(),this.featureIndex=null,this._usedMemory=0,this.destroy(),this.status="unloaded")}release(){--this._referenced===0&&(this._owner?.onDisposeTile(this),this.dispose(),this.stage=null)}retain(){++this._referenced}get usedMemory(){return this._usedMemory}get usedMemoryPerReference(){return this._usedMemory/(this._referenced||1)}changeDataImpl(e){this.featureIndex?.clear();let i=!1;if(e){const{bucketsWithData:r,emptyBuckets:s}=e,n=this._createRenderBuckets(r);if(s&&s.byteLength>0){const a=new Uint32Array(s);for(const o of a)this._deleteLayerData(o)}for(const[a,o]of n)this._deleteLayerData(a),o.type===3&&(this.symbols.set(a,o.symbols),i=!0),this._usedMemory+=o.usedMemory,this.layerData.set(a,o);this._owner?.updateTileSize(this)}this._hasSymbolBuckets=!1;for(const r of this.layerData.values())r.type===3&&(this._hasSymbolBuckets=!0);i&&this.emit("symbols-changed")}attachWithContext(e){this.stage={context:e,trashDisplayObject(i){i.processDetach()},untrashDisplayObject:()=>!1}}setTransform(e){super.setTransform(e);const i=this.resolution/(e.resolution*e.pixelRatio),r=this.width/this.rangeX*i,s=this.height/this.rangeY*i,n=[0,0];e.toScreen(n,[this.x,this.y]);const a=this.transforms.tileUnitsToPixels;vU(a),yC(a,a,n),bU(a,a,Math.PI*e.rotation/180),KD(a,a,[r,s,1])}_createTransforms(){return{displayViewScreenMat3:Lw(),tileMat3:Lw(),tileUnitsToPixels:Lw()}}static _destroyRenderBuckets(e){if(!e)return;const i=new Set;for(const r of e.values())i.has(r)||(r.destroy(),i.add(r));e.clear()}_createRenderBuckets(e){const i=new Map,r=new Map;for(const s of e){const n=this._deserializeBucket(s,r);for(const a of n.layerUIDs)i.set(a,n)}return i}_deserializeBucket(e,i){let r=i.get(e);if(r)return r;switch(new Uint32Array(e)[0]){case 1:r=new K3t(e,this.styleRepository);break;case 2:r=new J3t(e,this.styleRepository);break;case 3:r=new e$t(e,this.styleRepository,this);break;case 4:r=new t$t(e,this.styleRepository)}return i.set(e,r),r}_deleteLayerData(e){if(!this.layerData.has(e))return;const i=this.layerData.get(e);this._usedMemory-=i.usedMemory,i.destroy(),this.layerData.delete(e)}};const eei=512,tei=29,iei=24,rei=4,s$t=6,y5e=1<<s$t,n$t=y5e<<1,sei=1.05,nei=5,aei=6,oei=1.15,lei=4,cei=1,uei=10,hei=1024,dei=256,pei=32,fei=512;function ak(t){return(t.uniqueSymbol?.show&&t.uniqueSymbol?.lastShow)??!1}function a$t(t,e){if(t.priority-e.priority)return t.priority-e.priority;if(ak(t)&&!ak(e))return-1;if(ak(e)&&!ak(t))return 1;const i=t.tile.key,r=e.tile.key;return i.world-r.world?i.world-r.world:i.level-r.level?i.level-r.level:i.row-r.row?i.row-r.row:i.col-r.col?i.col-r.col:t.xTile-e.xTile?t.xTile-e.xTile:t.yTile-e.yTile}let o$t=class{get running(){return this._running}constructor(e,i,r,s,n,a,o,l){this.selectionMode=e,this._visibleTiles=i,this._symbolRepository=r,this._styleRepository=s,this._createCollisionJob=n,this._assignTileSymbolsOpacity=a,this._symbolLayerSorter=o,this._isLayerVisible=l,this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}setScreenSize(e,i){this._screenWidth===e&&this._screenHeight===i||this.restart(),this._screenWidth=e,this._screenHeight=i}restart(){this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}continue(e){if(this._selectionJob||(this._selectionJob=this._createSelectionJob()),!this._selectionJobCompleted){const i=performance.now();if(!this._selectionJob.work(e)||(this._selectionJobCompleted=!0,(e=Math.max(0,e-(performance.now()-i)))===0))return!1}if(this._collisionJob||(this._collisionJob=this._createCollisionJob(this._selectionJob.sortedSymbols,this._screenWidth,this._screenHeight)),!this._collisionJobCompleted){const i=performance.now();if(!this._collisionJob.work(e)||(this._collisionJobCompleted=!0,(e=Math.max(0,e-(performance.now()-i)))===0))return!1}if(this._opacityJob||(this._opacityJob=this._createOpacityJob()),!this._opacityJobCompleted){const i=performance.now();if(!this._opacityJob.work(e)||(this._opacityJobCompleted=!0,(e=Math.max(0,e-(performance.now()-i)))===0))return!1}return this._running=!1,!0}_isFeatureFiltered(e,i,r){const s=i.getFilterFlags(e),n=s&y5e,a=r.featureEffect==null||r.featureEffect.excludedLabelsVisible||s&n$t;return!(n&&a)}_getFilteredByLayer(){let e;if(this._styleRepository?.layerContexts)for(const i of this._symbolRepository.uniqueSymbols){const r=this._styleRepository.layerContexts?.get(i.styleLayerUID);if(r?.attributeView)for(const s of i.uniqueSymbols){e??=new Map,e.get(i.styleLayerUID)||e.set(i.styleLayerUID,new Set);const n=e.get(i.styleLayerUID),a=r.attributeView,o=r.layerView;this._isFeatureFiltered(s.id,a,o)&&n.add(s.id)}}return e}_resetSelection(){for(let e=0;e<this._symbolRepository.uniqueSymbols.length;e++){const i=this._symbolRepository.uniqueSymbols[e];for(let r=0;r<i.uniqueSymbols.length;r++){const s=i.uniqueSymbols[r];for(const n of s.tileSymbols)n.selectedForRendering=!1}}}_createSelectionJob(){const e=this.selectionMode==="feature-tile"?c$t:u$t,i=this._symbolRepository.uniqueSymbols;this._resetSelection();const r=[];let s=0,n=0;const a=this._isLayerVisible,o=this._getFilteredByLayer(),l=this._styleRepository?.layerContexts;function c(f){let y;const _=performance.now();for(;n<i.length;n++,s=0){const w=i[n],x=w.styleLayerUID,S=o?.get(x);let $=0;if(l){const M=l.get(x).layerView;$=M.view.allLayerViews.items.indexOf(M)}if(!a(x)){r[n]||(r[n]={styleLayerUID:x,layerOrder:$,symbols:[]});continue}r[n]||={styleLayerUID:x,symbols:[],layerOrder:$};const A=r[n];for(;s<w.uniqueSymbols.length;s++){if(y=w.uniqueSymbols[s],s%100==99&&performance.now()-_>f)return!1;if(y.lastShow=y.show,y.id&&S?.has(y.id)){y.show=!1,y.parts[0].show=!1,y.parts[1].show=!1;continue}const M=e(y);if(M){M.selectedForRendering=!0,A.symbols.push(M),y.show=!0;for(const P of y.parts)P.show=!0}else y.show=!1}}for(const w of r)w.symbols.sort(a$t);return r.sort((w,x)=>x.layerOrder-w.layerOrder),!0}const h=this._symbolLayerSorter;return{work:c,get sortedSymbols(){return r.sort(h)}}}_createOpacityJob(){const e=this._assignTileSymbolsOpacity,i=this._visibleTiles;let r=0;function s(n,a){for(const o of n.symbols.values())l$t(o,a);e(n,a);for(const o of n.childrenTiles)s(o,a)}return{work(n){const a=performance.now();for(;r<i.length;r++){if(performance.now()-a>n)return!1;const o=i[r];if(o.parentTile!=null)continue;const l=performance.now();o instanceof r$t?s(o,l):e(o,l)}return!0}}}};function l$t(t,e){for(const i of t){const r=i.uniqueSymbol;for(const s of r.parts){const n=s.targetOpacity>.5?1:-1;s.startOpacity+=n*((e-s.startTime)/UX),s.startOpacity=Math.min(Math.max(s.startOpacity,0),1),s.startTime=e,s.targetOpacity=r.show&&s.show?1:0}}}function c$t(t){let e=null,i=null,r=null;for(const s of t.tileSymbols){const n=s.tile;n.isReady&&n.isCoverage?e=s:n.isReady?i=s:n.rendering&&(r=s)}return e??i??r}function u$t(t){let e=null,i=!1,r=!1;for(const s of t.tileSymbols)if(!r||!i){const n=s.tile;(!e||n.isCoverage||n.neededForCoverage&&!i)&&(e=s,(n.neededForCoverage||n.isCoverage)&&(r=!0),n.isCoverage&&(i=!0))}return r?e:null}let h$t=class BX{static fromSymbols(e,i){let r=e.length;if(r>=d$t){let s=i;do s/=2,r/=4;while(r>p$t&&s>f$t);const n=new f5e(i,i,s);for(const a of e)n.getCell(a.xTile,a.yTile).push(a);return new BX(i,e,n)}return new BX(i,e,null)}constructor(e,i,r){this.tileCoordRange=e,this._symbols=i,this._index=r}addSymbols(e){for(const i of e)this._symbols.push(i);if(this._index)for(const i of e)this._index.getCell(i.xTile,i.yTile).push(i)}removeSymbols(e){const i=new Set(e);if(this._symbols=this._symbols.filter(r=>!i.has(r)),this._index)for(const r of this._index.cells)for(let s=0;s<r.length;s++)r[s]=r[s].filter(n=>!i.has(n))}getSymbols(){return this._symbols}getCandidate(e,i,r,s){if(!this._index){for(const h of this._symbols)if(r===h.hash&&Math.abs(e-h.xTile)<=s&&Math.abs(i-h.yTile)<=s)return h;return null}const n=this._index.getCellSpan(e-s,i-s,e+s,i+s),[a,o,l,c]=n;for(let h=o;h<=c;h++)for(let f=a;f<=l;f++){const y=this._index.cells[h][f];for(const _ of y)if(r===_.hash&&Math.abs(e-_.xTile)<=s&&Math.abs(i-_.yTile)<=s)return _}return null}};const d$t=32,p$t=8,f$t=64,Q0e=20;let m$t=class{constructor(e,i){this.tileCoordRange=e,this._visibleTiles=i,this._indexMapByTile=new Map,this._uniqueSymbolsByStyleLayerId=new Map}get uniqueSymbols(){return this._uniqueSymbolLayerArray==null&&(this._uniqueSymbolLayerArray=this._createUniqueSymbolLayerArray()),this._uniqueSymbolLayerArray}registerVectorTile(e,i){const r=this._ensureIndexMap(e),s=i?.values()??r.keys();for(const n of s){const a=r.get(n);a&&(this._removeSymbols(n,a.getSymbols()),r.delete(n))}this._addSymbols(e.key,r,e.symbols),this._invalidate()}unregisterVectorTile(e){this._removeTile(e),this._invalidate()}registerFeatureTile(e){this._ensureIndexMap(e),this._invalidate()}unregisterFeatureTile(e){this._removeTile(e),this._invalidate()}insertFeatureTileMetrics(e,i){const r=this._indexMapByTile.get(e);if(!r)throw new Error(`tile ${e.id} not registered!`);this._addSymbols(e.key,r,X0e(i)),this._invalidate()}removeFeatureTileMetrics(e,i){const r=this._indexMapByTile.get(e);if(!r)return;const s=X0e(i);for(const[n,a]of r.entries()){const o=s.get(n);o&&(a.removeSymbols(o),this._removeSymbols(n,o))}this._invalidate()}deleteStyleLayers(e){for(const i of this._indexMapByTile.values())for(const r of e){const s=i.get(r);s&&(this._removeSymbols(r,s.getSymbols()),i.delete(r))}this._invalidate()}querySymbols(e,i,r,s){const n=[];for(const[a,o]of this._uniqueSymbolsByStyleLayerId.entries())for(const l of o){const c=l.tileSymbols.find(h=>h.selectedForRendering);c&&Q3t(c,e,i*(window.devicePixelRatio||1),r)&&n.push({vtlSymbol:c,styleLayerUID:a,tileKey:c.tile.key})}return n}_ensureIndexMap(e){let i=this._indexMapByTile.get(e);return i||(i=new Map,this._indexMapByTile.set(e,i)),i}_invalidate(){this._uniqueSymbolLayerArray=null}_addSymbols(e,i,r){for(const[s,n]of r){let a=i.get(s);a?a.addSymbols(n):(a=h$t.fromSymbols(n,this.tileCoordRange),i.set(s,a))}this._updateUniqueSymbols(e,r)}_removeTile(e){const i=this._indexMapByTile.get(e);if(i){for(const[r,s]of i.entries())this._removeSymbols(r,s.getSymbols());this._indexMapByTile.delete(e),this._invalidate()}}_removeSymbols(e,i){for(const r of i){const s=r.uniqueSymbol;if(s){if(s.tileSymbols=s.tileSymbols.filter(n=>n!==r),s.tileSymbols.length===0){const n=this._uniqueSymbolsByStyleLayerId.get(e);n.delete(s),n.size===0&&this._uniqueSymbolsByStyleLayerId.delete(e)}r.uniqueSymbol=null}}}_updateUniqueSymbols(e,i){if(i.size!==0){for(const r of this._visibleTiles)r.parentTile||r.key.world!==e.world||r.key.level===e.level&&!r.key.equals(e)||this._matchSymbols(r,e,i);for(const[r,s]of i)for(const n of s)if(!n.uniqueSymbol){n.uniqueSymbol=new q3t(n);let a=this._uniqueSymbolsByStyleLayerId.get(r);a||(a=new Set,this._uniqueSymbolsByStyleLayerId.set(r,a)),a.add(n.uniqueSymbol)}}}_matchSymbols(e,i,r){if(e.key.level>i.level){const n=e.key.level-i.level;if(e.key.row>>n!==i.row||e.key.col>>n!==i.col)return}if(i.level>e.key.level){const n=i.level-e.key.level;if(i.row>>n!==e.key.row||i.col>>n!==e.key.col)return}const s=new Map;for(const[n,a]of r){const o=[],l=e.key.level<i.level?1:1<<Math.abs(e.key.level-i.level),c=this._indexMapByTile.get(e),h=c?.get(n);if(h)for(const f of a){if(f.uniqueSymbol)continue;const y=G3t(this.tileCoordRange,f.xTile,i,e.key),_=H3t(this.tileCoordRange,f.yTile,i,e.key),w=-Q0e,x=this.tileCoordRange+Q0e;if(!(y>=w&&y<x&&_>=w&&_<x)){o.push(f);continue}const S=h.getCandidate(y,_,f.hash,l),$=S?.uniqueSymbol;$?(f.uniqueSymbol=$,$.tileSymbols.push(f)):o.push(f)}o.length>0&&s.set(n,o)}for(const n of e.childrenTiles||[])this._matchSymbols(n,i,s)}_createUniqueSymbolLayerArray(){const e=this._uniqueSymbolsByStyleLayerId,i=new Array(e.size);let r,s=0;for(const[n,a]of e){const o=new Array(a.size);r=0;for(const l of a)o[r++]=l;i[s]={styleLayerUID:n,uniqueSymbols:o},s++}return i}};function X0e(t){const e=new Map;for(const i of t){const r=i.labelClassId;let s=e.get(r);s||(s=[],e.set(r,s)),s.push(i)}return e}function g$t(t,e){const i=t.transforms.tileUnitsToPixels,r=tee(e),s=Math.cos(r),n=Math.sin(r),a=Math.ceil(512*(Math.abs(n)+Math.abs(s)));vU(Jp),yC(Jp,Jp,[a/2,a/2]),bU(Jp,Jp,r),yC(Jp,Jp,[-256,-256]),KD(Jp,Jp,[1/8,1/8,1]),t.transforms.tileUnitsToPixels=Jp;const o=[],l=new m$t(MD,o),c=new o$t("vector-tile",o,l,null,(h,f,y)=>new X3t(h,f,y,t.styleRepository,t.key.level,e),(h,f)=>{Z3t(h,f,!1)},()=>0,h=>{const f=t.styleRepository.getStyleLayerByUID(h).getLayoutProperty("visibility");return!f||f.getValue()!==1});o.push(t),l.registerVectorTile(t),c.setScreenSize(a,a),c.continue(1/0),l.unregisterVectorTile(t),t.transforms.tileUnitsToPixels=i}const Jp=Lw();let y$t=class extends m5e{_createTransforms(){return{displayViewScreenMat3:Lw(),tileMat3:Lw()}}},_$t=class{constructor(){this._candidateTiles=[]}schedule(e){this._candidateTiles.includes(e)||this._candidateTiles.push(e)}reshuffle(e){const i=[];for(const r of this._candidateTiles)e>0?(r.reshuffle(),e--):i.push(r);this._candidateTiles=i}},v$t=class{constructor(){this._renderParams={reshuffleManager:new _$t,context:null,drawPhase:1,state:new b$t,stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,allowDelayedRender:!1,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1,highlightGradient:null,stencilSymbols:!0,is3D:!0,backgroundColor:null,animationsEnabled:!0},this._backgroundTile=new y$t(new v2(0,0,0,0),0,0,0,Y0e,Y0e,MD,MD),this._heading=0,this._declutteredForHeading=new WeakMap}dispose(){this._renderParams=null}renderBackground(e,i,r,s,n,a,o,l,c,h){const f=this._backgroundTile;this._updateRenderParameters(e,i,f,r,n,a,o,l,c,h),this._renderParams.stencilSymbols=!1,r.drawBackground(this._renderParams,f,s)}renderContent(e,i,r,s,n,a,o,l,c,h,f,y){this._declutter(r),s.forAll(({sourceLayerInfo:{data:x}})=>this._declutter(x));const _=s.length>0;_&&this._stencilSymbols(e,i,r,s,n,a,o,l,c,h,f,y);let w=1;r.stencilRef=_?w:0,e.setStencilFunction(514,r.stencilRef,255),this._render(e,i,r,n,a,o,l,c,h,f,y),s.forAll(({sourceLod:x,offset:S,sourceLayerInfo:{data:$}})=>{$.stencilRef=++w,this._renderSymbols(e,x,$,n,a,o,l,S,h,f,y)})}_stencilSymbols(e,i,r,s,n,a,o,l,c,h,f,y){let _=1;r.stencilRef=_,e.setDepthTestEnabled(!1),e.setDepthWriteEnabled(!1),e.setStencilTestEnabled(!0),e.setBlendingEnabled(!1),e.setColorMask(!1,!1,!1,!1),e.setStencilOp(7680,7680,7681),e.setStencilWriteMask(255),e.setStencilFunction(519,r.stencilRef,255),this._stencilTileSymbols(e,i,r,n,a,o,l,c,h,f,y),s.forAll(({sourceLod:w,offset:x,sourceLayerInfo:{data:S}})=>{S.stencilRef=++_,e.setStencilFunction(519,S.stencilRef,255),this._stencilTileSymbols(e,w,S,n,a,o,l,x,h,f,y)}),e.setStencilWriteMask(0),e.setBlendingEnabled(!0),e.setDepthTestEnabled(!0),e.setColorMask(!0,!0,!0,!0)}_renderSymbols(e,i,r,s,n,a,o,l,c,h,f){e.setStencilFunction(514,r.stencilRef,255),this._render(e,i,r,s,n,a,o,l,c,h,f,3)}_render(e,i,r,s,n,a,o,l,c,h,f,y){this._updateRenderParameters(e,i,r,s,a,o,l,c,h,f),this._renderParams.stencilSymbols=!1,s.drawTile(this._renderParams,r,n,y)}_stencilTileSymbols(e,i,r,s,n,a,o,l,c,h,f){this._updateRenderParameters(e,i,r,s,a,o,l,c,h,f),this._renderParams.stencilSymbols=!0,r.triangleCount=0,s.drawSymbols(this._renderParams,r,n)}_updateRenderParameters(e,i,r,s,n,a,o,l,c,h){"type"in r&&r.type==="vector-tile"&&!r.stage&&r.attachWithContext(e);const f=i[0]-n.getLevelShift(i[0]),y=this._renderParams;y.context=e,y.painter=s,y.glyphMosaic=s.glyphMosaic,y.spriteMosaic=s.spriteMosaic,y.pixelRatio=c*h,y.displayLevel=f,y.requiredLevel=f;const _=n.getScale(i[0]),[w,x]=n.getOffset(i,a*_),S=P3t*a*_/l,$=r.transforms.displayViewScreenMat3;$[0]=S,$[4]=-S,$[6]=-1-w-o[0]*a*2,$[7]=1+x+(1-o[1])*a*2-2;const A=y.state,M=l/h;A.size[0]=M,A.size[1]=M,A.pixelRatio=h,A.rotation=(360-this._heading)%360;const P=2/M;B_(A.displayViewMat3,P,0,0,0,-P,0,-1,1,1);const O=vU(A.displayMat3),D=tee(this._heading);yC(O,O,[M/2,M/2]),bU(O,O,D),yC(O,O,[-M/2,-M/2]),gC(O,A.displayViewMat3,O)}updateHeading(e){this._heading=e}_declutter(e){this._declutteredForHeading.get(e)!==this._heading&&(g$t(e,(360-this._heading)%360),this._declutteredForHeading.set(e,this._heading))}},b$t=class{constructor(){this.size=[0,0],this.pixelRatio=1,this.rotation=0,this.displayMat3=Ir(),this.displayViewMat3=Ir(),this.transform=null,this.inverseTransform=null,this.viewMat2d=null,this.viewMat3=null,this.id=0,this.extent=null,this.center=null,this.scale=1,this.resolution=0,this.worldScreenWidth=0,this.spatialReference=null,this.viewpoint=null,this.getScreenTransform=null,this.toMap=null,this.toScreen=null,this.clone=null,this.copy=null,this.toJSON=null}},_5e=class extends Fo{constructor(){super(...arguments),this.blendMode=0}};d([oe({count:31})],_5e.prototype,"blendMode",void 0);let gR=class extends _5e{constructor(){super(...arguments),this.output=1,this.baseOpacityMode=0,this.premultipliedSource=0}};d([oe({count:5})],gR.prototype,"output",void 0),d([oe({count:2})],gR.prototype,"baseOpacityMode",void 0),d([oe({count:2})],gR.prototype,"premultipliedSource",void 0);let v5e=class extends gR{constructor(){super(...arguments),this.background=0}};d([oe({count:2})],v5e.prototype,"background",void 0);function w$t(t){t.fragment.uniforms.add(new zt("u_colormap",e=>e.u_colormap),new ut("u_colormapOffset",e=>e.colormap.u_colormapOffset),new ut("u_colormapMaxIndex",e=>e.colormap.u_colormapMaxIndex),new ut("u_opacity",e=>e.common.u_opacity)),t.fragment.code.add(E`vec4 colormap(vec4 currentPixel, bool isFloat) {
float colorIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
vec4 result;
if (currentPixel.a == 0.0 || colorIndex > u_colormapMaxIndex) {
result = vec4(0.0, 0.0, 0.0, 0.0);
} else {
vec2 texelCoordinates = vec2((colorIndex + 0.5), 0.5);
result = texelFetch(u_colormap, ivec2(texelCoordinates), 0);
}
return result;
}`)}function x$t(t){t.fragment.uniforms.add(new zt("u_transformGrid",e=>e.u_transformGrid),new ll("u_transformSpacing",e=>e.common.u_transformSpacing),new ll("u_targetImageSize",e=>e.common.u_targetImageSize)),t.fragment.code.add(E`vec2 projectPixelLocation(vec2 coords) {
vec2 index_image = floor(coords * u_targetImageSize);
vec2 oneTransformPixel = vec2(4.0, 1.0);
vec2 index_transform = floor(index_image / u_transformSpacing) * oneTransformPixel;
vec2 pos = fract((index_image + 0.5) / u_transformSpacing);
vec2 transform_location = index_transform + 0.5;
vec2 srcLocation;
if (pos.s <= pos.t) {
vec3 ll_abc = texelFetch(u_transformGrid, ivec2(transform_location), 0).rgb;
vec3 ll_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 1.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ll_abc, vec3(pos, 1.0));
srcLocation.t = dot(ll_def, vec3(pos, 1.0));
} else {
vec3 ur_abc = texelFetch(u_transformGrid, ivec2(transform_location.s + 2.0, transform_location.t), 0).rgb;
vec3 ur_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 3.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ur_abc, vec3(pos, 1.0));
srcLocation.t = dot(ur_def, vec3(pos, 1.0));
}
return srcLocation;
}`)}let S$t=class extends s5e{constructor(e,i,r){super(),this.common=e,this.u_image=i,this.u_transformGrid=r}};function T$t(t,e){t.include(x$t),t.fragment.uniforms.add(new zt("u_image",r=>r.u_image),new VC("u_flipY",r=>r.common.u_flipY),new VC("u_applyTransform",r=>r.common.u_applyTransform));const{requireBilinearWithNN:i}=e;i&&t.fragment.uniforms.add(new ll("u_srcImageSize",r=>r.common.u_srcImageSize)),t.fragment.code.add(E`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}`),i?t.fragment.code.add(E`vec4 sampleBilinear(sampler2D sampler, vec2 coords, vec2 texSize) {
vec2 texelStart = floor(coords * texSize);
vec2 coord0 = texelStart / texSize;
vec2 coord1 = (texelStart +  vec2(1.0, 0.0)) / texSize;
vec2 coord2 = (texelStart +  vec2(0.0, 1.0)) / texSize;
vec2 coord3 = (texelStart +  vec2(1.0, 1.0)) / texSize;
vec4 color0 = texture(sampler, coord0);
vec4 color1 = texture(sampler, coord1);
vec4 color2 = texture(sampler, coord2);
vec4 color3 = texture(sampler, coord3);
vec2 blend = fract(coords * texSize);
vec4 color01 = mix(color0, color1, blend.x);
vec4 color23 = mix(color2, color3, blend.x);
vec4 color = mix(color01, color23, blend.y);
float alpha = floor(color0.a * color1.a * color2.a * color3.a + 0.5);
color = color * alpha + (1.0 - alpha) * texture(sampler, coords);
return color;
}
vec4 getPixel(vec2 pixelLocation) {
return sampleBilinear(u_image, pixelLocation, u_srcImageSize);
}`):t.fragment.code.add(E`vec4 getPixel(vec2 pixelLocation) {
return texture(u_image, pixelLocation);
}`)}let Q8=class extends S$t{constructor(e,i,r,s,n,a){super(e,s,n),this.colormap=i,this.symbolizer=r,this.u_colormap=a,this.backgroundColor=Kn,this.fboTexture=null,this.baseOpacity=1}},b5e=class extends Q8{},w5e=class extends Q8{};function x5e(t){const e=new Di;return e.include(n5e),e.include(T$t,t),e.include(w$t,t),e.include(a5e,t),e.fragment.code.add(E`vec4 applyBackgroundBlend(vec4 layerColor) {
return blendLayers(vuv, layerColor, u_opacity);
}`),t.colorizerType===0?C$t(e,t):t.colorizerType===1?$$t(e):t.colorizerType===2&&M$t(e,t),e}function $$t(t){t.fragment.main.add(E`vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
fragColor = applyBackgroundBlend(colormap(currentPixel, true));`)}function C$t(t,e){t.fragment.uniforms.add(new e1("u_bandCount",r=>r.symbolizer.u_bandCount),new Rc("u_minCutOff",r=>r.symbolizer.u_minCutOff,3),new Rc("u_maxCutOff",r=>r.symbolizer.u_maxCutOff,3),new Rc("u_factor",r=>r.symbolizer.u_factor,3),new ut("u_minOutput",r=>r.symbolizer.u_minOutput),new ut("u_maxOutput",r=>r.symbolizer.u_maxOutput),new VC("u_useGamma",r=>r.symbolizer.u_useGamma),new Rc("u_gamma",r=>r.symbolizer.u_gamma,3),new Rc("u_gammaCorrection",r=>r.symbolizer.u_gammaCorrection,3),new ut("u_opacity",r=>r.common.u_opacity)),t.fragment.code.add(E`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const i=e.applyColormap?E`fragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:E`fragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;t.fragment.main.add(E`
    vec2 pixelLocation = getPixelLocation(uv);
    if (isOutside(pixelLocation)) {
      fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
      return;
    }

    vec4 currentPixel = getPixel(pixelLocation);
    ${e.stretchType===0?E`fragColor = applyBackgroundBlend(currentPixel);`:E`
    if (currentPixel.a == 0.0) {
      fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
      return;
    }
    if (u_bandCount == 1) {
      float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
      ${i}
    } else {
      float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
      float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
      float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
      fragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
    }`}`)}function M$t(t,e){const i=t.fragment;i.uniforms.add(new zt("u_image",s=>s.u_image),new e1("u_hillshadeType",s=>s.symbolizer.u_hillshadeType),new Rc("u_sinZcosAs",s=>s.symbolizer.u_sinZcosAs,6),new Rc("u_sinZsinAs",s=>s.symbolizer.u_sinZsinAs,6),new Rc("u_cosZs",s=>s.symbolizer.u_cosZs,6),new Rc("u_weights",s=>s.symbolizer.u_weights,6),new ll("u_factor",s=>s.symbolizer.u_factor),new ut("u_minValue",s=>s.symbolizer.u_minValue),new ut("u_maxValue",s=>s.symbolizer.u_maxValue),new ll("u_srcImageSize",s=>s.common.u_srcImageSize)),i.include(MM),i.code.add(E`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec4 color = colormap(vec4(val, val, val, 1.0), false);
vec3 hsv = rgb2hsv(color.rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv), 1.0) * alpha * color.a;
}`),i.code.add(E`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);const r=e.applyColormap?E`fragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:E`hillshade *= alpha;
fragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;i.main.add(E`
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture(u_image, pixelLocation);
      vec4 vf = texture(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${r}`)}const E$t=Object.freeze(Object.defineProperty({__proto__:null,ColorizerHillshadeUniforms:w5e,ColorizerStretchUniforms:b5e,ColorizerUniforms:Q8,build:x5e},Symbol.toStringTag,{value:"Module"}));let J0e=class extends Vi{constructor(e,i){super(e,i,new Ii(E$t,()=>te(()=>Promise.resolve().then(()=>qkt),void 0)),ed(g4))}},JO=class extends gR{constructor(){super(...arguments),this.colorizerType=0,this.stretchType=0,this.applyColormap=!0,this.requireBilinearWithNN=!1}};d([oe({count:3})],JO.prototype,"colorizerType",void 0),d([oe({count:2})],JO.prototype,"stretchType",void 0),d([oe()],JO.prototype,"applyColormap",void 0),d([oe()],JO.prototype,"requireBilinearWithNN",void 0);let K0e=class{constructor(e){this._rctx=e,this._fbos=new Map}get(e){return this._getPool(e)}dispose(){this._fbos.forEach(e=>e.dispose()),this._fbos.clear()}_getPool(e){const i=this._fbos.get(e);if(i)return i;const r=new Xv(this._rctx,new Zi(e),new pct(Kf.DEPTH24_STENCIL8,e));return this._fbos.set(e,r),r}};function i1(t,e=0,i=-1,r=1){const s=e===1,n=s?np?new Float32Array([i,i,0,r,i,0,i,r,0,r,r,0]):new Float32Array([i,i,0,0,r,i,1,0,i,r,0,1,r,r,1,1]):new Float32Array([i,i,r,i,i,r,r,r]);if(s&&np){const a=WAe(n.buffer);a[10]=a[17]=a[22]=a[23]=1}return new Op(t,new Hs(t,s?np?g4:oct:lie,n))}const A$t=4;function S5e(t){const e=new Zi(A$t);return e.samplingMode=9728,new Fi(t,e)}const O$t=()=>fe.getLogger("esri.views.3d.terrain");let P$t=class{constructor(e,i){this._rctx=e,this._techniques=i,this._fbos=[],this._vectorTileHelper=new v$t,this._bindParameters=new ese(null),this._blendConfiguration=new v5e,this._current=0,this._lastUsedIds=new Array,this._lastCreatedBufferId=0,this._onHoldIds=new Array,this._vao=i1(this._rctx,1)}dispose(){this._fbos.forEach(Rt),this._fbos=null,this._vtFBO=Rt(this._vtFBO),this._vao=Rt(this._vao),this._vectorTileHelper=Rt(this._vectorTileHelper)}updateHeading(e){this._vectorTileHelper?.updateHeading(e)}_acquireBlendTechnique(e,i,r,s=0,n=0){return this._blendConfiguration.output=i,this._blendConfiguration.blendMode=e,this._blendConfiguration.baseOpacityMode=r,this._blendConfiguration.premultipliedSource=s,this._blendConfiguration.background=n,this._techniques.precompile(W0e,this._blendConfiguration),this._techniques.get(W0e,this._blendConfiguration)}drawBackground(e,i){const r=this._acquireBlendTechnique(0,i?2:3,0,0,1),s=this._rctx.bindTechnique(r,this._bindParameters,e);this._render(s)}_render(e){this._rctx.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),this._rctx.drawArrays(lr.TRIANGLE_STRIP,0,this._vao.vertexCount("geometry"))}drawGroup(e,i,r,s,n=1){i===1&&(e.fboTexture=this._fbos[this.getLastOnHoldId()].get(r).colorTexture,e.fboTexture==null&&(e.fboTexture=this._rctx.emptyTexture)),e.texture=this.currentFBO(r).colorTexture,this.closeGroup(r);const a=e.baseOpacity<1?1:0,o=this._acquireBlendTechnique(s,i,a,n),l=this._rctx.bindTechnique(o,this._bindParameters,e);this._render(l)}drawImageData(e,i,r,s,n=0){if(e.texture==null)return;const a=e.baseOpacity<1?1:0;e.fboTexture=i===4||s===0&&a===0&&n===0?null:this.switch(r).colorTexture,e.fboTexture==null&&(e.fboTexture=this._rctx.emptyTexture);const o=this._acquireBlendTechnique(s,i,a,n),l=this._rctx.bindTechnique(o,this._bindParameters,e);this._render(l)}drawRasterData(e,i,r,s,n){const a=n.sourceLayerInfo.data;if(!a.source||(n.tile.surface.layerViewByIndex(n.layerIndex,1).ensureSymbolizerParameters(a),!a.bind(this._rctx)))return;const o=e.baseOpacity<1?1:0;e.fboTexture=s===0&&o===0?null:this.switch(r).colorTexture;const l=this._acquireRasterTechnique(a,i,s,o);if(!l)return;a.opacity=e.opacity;const c=a.getUniforms(this._rctx);c.scale=n.scale,c.offset=n.offset,c.backgroundColor=e.backgroundColor,c.fboTexture=e.fboTexture,c.baseOpacity=e.baseOpacity;const h=this._rctx.bindTechnique(l,this._bindParameters,c);this._render(h)}_acquireRasterTechnique(e,i,r,s){if(!this._rctx.capabilities.colorBufferFloat)return null;const n=e.symbolizerParameters,a=["stretch","lut","hillshade"].indexOf(n.type);return this._rasterConfiguration??=new JO,this._rasterConfiguration.output=i,this._rasterConfiguration.blendMode=r,this._rasterConfiguration.baseOpacityMode=s,this._rasterConfiguration.colorizerType=a,this._rasterConfiguration.applyColormap=!!n.colormap,this._rasterConfiguration.requireBilinearWithNN=e.isBilinearWithStretchColorRamp,this._rasterConfiguration.stretchType=e.hasStretchTypeNone()?0:1,this._techniques.precompile(J0e,this._rasterConfiguration),this._techniques.get(J0e,this._rasterConfiguration)}drawVectorData(e,i,r,s,n,a,o,l){const c=this._rctx,h=n.sourceLayerInfo.data,f=n.tile.surface.layerViewByIndex(n.layerIndex,1),y=e.baseOpacity<1?1:0,_=y===1||e.opacity<1||s!==0||i!==1,w=_?1:0,x=this._acquireBlendTechnique(s,i,y,w);c.setPipelineState(x.getPipeline());let S=null,$=null;_?($=this.currentFBO(r),this._vtFBO==null&&(this._vtFBO=new K0e(this._rctx)),S=this._vtFBO.get(r),c.bindFramebuffer(S),this._clearCurrentFBO()):l&&c.clear(256);try{this._vectorTileHelper.renderBackground(c,n.sourceLod,f.painter,f.layer.styleRepository,f.schemaHelper,Math.round(1/n.scale),n.offset,o,a,f.contentZoom),h&&this._vectorTileHelper.renderContent(c,n.sourceLod,h,n.vtlNeighborInfos,f.painter,f.layer.styleRepository,f.schemaHelper,Math.round(1/n.scale),n.offset,o,a,f.contentZoom)}catch(A){O$t().warnOnce("A render call containing vector tiles did not resolve correctly.",A)}return!S||(c.bindFramebuffer($),e.texture=S.colorTexture,e.offset=$v,e.scale=1,this.drawImageData(e,i,r,s,w),l)}copyFBOToTexture(e){const i=this._rctx,r=i.bindTexture(e.texture,Fi.TEXTURE_UNIT_FOR_UPDATES),s=e.descriptor;i.gl.copyTexImage2D(3553,0,s.pixelFormat,0,0,s.width,s.height,0),e.generateMipmap(),i.bindTexture(r,Fi.TEXTURE_UNIT_FOR_UPDATES)}_clearCurrentFBO(){this._rctx.setStencilWriteMask(255),this._rctx.setClearColor(0,0,0,0),this._rctx.setClearDepth(1),this._rctx.setClearStencil(0),this._rctx.clear(17664)}_initFBO(e,i,r){this._rctx.bindFramebuffer(e),r&&(this._rctx.setViewport(0,0,i,i),this._clearCurrentFBO())}ensureBuffer(e){this._lastUsedIds.length=0,this._lastUsedIds.push(1),this._lastCreatedBufferId=1,this._onHoldIds.length=0,this.bind(e)}bind(e,i=0,r=!0){if(this._current=i,i>=this._fbos.length)for(let s=this._fbos.length;s<=i;s++)this._fbos.push(new K0e(this._rctx));this._initFBO(this._fbos[i].get(e),e,r)}_bindNextFreeBuffer(e){this._lastUsedIds.length>0?this.bind(e,this._lastUsedIds.pop()):(this._lastCreatedBufferId++,this.bind(e,this._lastCreatedBufferId))}openGroup(e){this._onHoldIds.push(this._current),this._bindNextFreeBuffer(e)}switch(e){const i=this.currentFBO(e),r=this._current;return this._bindNextFreeBuffer(e),this._lastUsedIds.push(r),i}getLastOnHoldId(){return this._onHoldIds[this._onHoldIds.length-1]}closeGroup(e){const i=this._current;this._bindNextFreeBuffer(e),this._lastUsedIds.push(i),this._lastUsedIds.push(this._onHoldIds.pop())}unbind(){this._rctx.bindFramebuffer(null)}currentFBO(e){return this._fbos[this._current].get(e)}},R$t=class{constructor(){this.sourceLod=[0,0,0],this.offset=[0,0],this.scale=1,this.layerIndex=0,this.isVTLBackground=!1,this.vtlNeighborInfos=new _i({allocator:e=>e||new D$t})}},D$t=class{constructor(){this.sourceLayerInfo=null,this.sourceLod=[0,0,0],this.offset=[-1,0]}},e_e=class{constructor(e,i){this._texture=e,this._cache=i,this.type="tile-texture",this._refCount=1,this._texture.descriptor.context.instanceCounter.increment(Bs.TileTexture,this)}retain(){++this._refCount}release(){--this._refCount,this._refCount===0&&(this._cache?(this._texture.abortCompression(),this._cache.put(jX(this.descriptor),this)):this.dispose())}dispose(){this._texture.descriptor.context.instanceCounter.decrement(Bs.TileTexture,this),this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}get descriptor(){return this._texture.descriptor}get usedMemory(){return this._texture.usedMemory}};function jX(t,e=UAe(t.internalFormat)){return`${t.width} ${t.pixelFormat} ${e}`}const qX={normal:0,average:1,lighten:2,lighter:3,screen:5,plus:4,"color-dodge":6,darken:7,multiply:8,"color-burn":9,overlay:10,"soft-light":11,"hard-light":12,"vivid-light":13,hue:14,saturation:15,luminosity:16,color:17,difference:26,exclusion:27,minus:28,invert:29,reflect:30,"destination-over":18,"destination-atop":19,"destination-in":20,"destination-out":21,"source-atop":22,"source-in":23,"source-out":24,xor:25};function I$t(t){return t===18||t===19||t===20||t===21||t===22||t===23||t===24||t===25}let L$t=class{constructor(e,i,r,s,n={}){this._mainMethod=i,this._transferLists=r,this._listeners=[],this._promise=nYe(e,{...n,schedule:s}).then(a=>{if(this._thread===void 0){this._thread=a,this._promise=null,n.hasInitialize&&this.broadcast({},"initialize");for(const o of this._listeners)this._connectListener(o)}else a.close()}),this._promise.catch(a=>fe.getLogger("esri.core.workers.WorkerHandle").error(`Failed to initialize ${e} worker: ${a}`))}on(e,i){const r={removed:!1,eventName:e,callback:i,threadHandle:null};return this._listeners.push(r),this._connectListener(r),ci(()=>{r.removed=!0,tM(this._listeners,r),this._thread&&r.threadHandle!=null&&r.threadHandle.remove()})}destroy(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null,this._listeners.length=0,this._transferLists={}}invoke(e,i,r){return this.invokeMethod(this._mainMethod,e,i,r)}invokeMethod(e,i,r,s){if(this._thread){const n=this._transferLists[e],a=n?n(i):[];return this._thread.invoke(e,i,{transferList:a,signal:r,priority:s})}return this._promise?this._promise.then(()=>(st(r),this.invokeMethod(e,i,r))):Promise.reject(null)}broadcast(e,i){return this._thread?Promise.all(this._thread.broadcast(i,e)).then(k$t):this._promise?this._promise.then(()=>this.broadcast(e,i)):Promise.reject()}get promise(){return this._promise}_connectListener(e){this._thread&&this._thread.on(e.eventName,e.callback).then(i=>{e.removed||(e.threadHandle=i)})}};function k$t(){}function T5e(t,e){let i=e.width,r=e.height;return(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement)&&(i=t.width,r=t.height),(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof Uint8Array)&&(e.pixelFormat===6408||e.pixelFormat===6407)&&Dx(i)&&Dx(r)&&i>=16&&r>=16}let z$t=class extends L$t{constructor(e){super("TextureCompressionWorker","compress",{compress:i=>[i.data]},e)}async destroyWorkerAndSelf(){await this.broadcast({},"destroy"),this.destroy()}isCompressible(e,i){return T5e(e,i)}},F$t=class{constructor(e,i,r,s,n,a){this.start=e,this.end=i,this.blendMode=r,this.opacity=s,this.output=n,this.baseOpacity=a}},N$t=class{constructor(e,i,r,s,n){this._rctx=e,this.tileSize=i,this._techniques=r,this._cache=s,this._compressionTracker=n,this._passParameters=new T3t,this._backgroundColor=null,this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy,this._compositor=new P$t(this._rctx,this._techniques)}dispose(){this._compositor=Rt(this._compositor),this._backgroundTexture=Sr(this._backgroundTexture)}get backgroundIsGrid(){return this._backgroundColor==null}get backgroundColor(){return this._backgroundColor}updateHeading(e){this._compositor?.updateHeading(e)}updateTileTexture(e,i){if(!e.renderData)return;const r=e.surface,s=r.baseOpacity;let n=0,a=0,o=this.tileSize,l=!1,c=!1;const h=r.view.state.contentPixelRatio;let f=!1;SV.clear(),WS.length=0;const y=e.layerInfo[1];let _=0,w=null;for(;_<y.length;_++){const S=r.layerViewByIndex(_,1),$=S.layer,A=!Iw(e,S),M=$.opacity,P=S.fullOpacity;if(c=c||fz($),H0e(S))continue;if(SD(S)){let L=S.layer.blendMode!=="normal";if(PC($.parent)){const F=$.parent.uid;F!=null&&F!==""&&(L=$5e($.parent)||L)}L&&(f=L,l=!1)}if((A||M===0)&&!f){y[_].pendingUpdates&=-1;continue}++a;const O=YC(S),D=UG(e,_,O);if(D){if(y[_].pendingUpdates&=-1,PC($.parent)){const L=$.parent.uid;L!=null&&L!==""&&C5e($.parent,_)}O?o=Math.max(o,this.tileSize*h):s===1&&P===1&&(S.isOpaque||this._dataToTexture(D,y7($))&&D.sourceLayerInfo.data.descriptor.isOpaque)&&(l=!0),++n,w===null&&(w=_)}}const x=o/this.tileSize;n!==0&&w!==null?n===1&&!f&&this._useLayerTexture(e,w)||this._composeLayers(e,i,_-1,c,o,x,!l||f,SV,f):this._useBackgroundTexture(e,a,i!==0)}setBackground(e){this._backgroundColor!==e&&(this._backgroundColor=e,this._backgroundTexture&&this._drawBackgroundTexture(this._backgroundTexture))}_ensureBackgroundTexture(){return this._backgroundTexture==null&&(this._backgroundTexture=this._buildTexture(this.tileSize,!1),this._drawBackgroundTexture(this._backgroundTexture)),this._backgroundTexture}_drawBackgroundTexture(e){this._compositor.bind(this.tileSize),this._passParameters.offset=$v,this._passParameters.scale=1,this._passParameters.opacity=1,this.backgroundColor&&(this._passParameters.backgroundColor=this.backgroundColor),this._compositor.drawBackground(this._passParameters,this.backgroundColor!=null),this._compositor.copyFBOToTexture(e),this._compositor.unbind()}_useBackgroundTexture(e,i,r){const s=e.renderData,n=!r&&s.textureReference!=null&&(e.surface.view.layerViewManager.updating||i>0)?5e3:0,a=this._ensureBackgroundTexture();s.setTextureReference(new PF(a,0,t_e,e.surface.baseOpacity,0,1),n)}_useLayerTexture(e,i){const r=e.surface.layerViewByIndex(i,1),s=fz(r.layer),n=s?e.surface.baseOpacity:1,a=s?1:e.surface.baseOpacity,o=r.fullOpacity,l=UG(e,i,!1);return!!this._dataToTexture(l,y7(r.layer))&&(e.renderData.setTextureReference(new PF(l.sourceLayerInfo.data,0,fi(l.offset[0],l.offset[1],l.scale,l.scale),n,a,o)),!0)}_composeLayers(e,i,r,s,n,a,o,l,c){this._compositor.ensureBuffer(n);const h=e.surface.baseOpacity;let f=!1,y=9987,_=!1,w=0;for(let A=r;A>=0;A--){const M=e.surface.layerViewByIndex(A,1),P=M.layer,O=YC(M),D=UG(e,A,O),L=P.opacity,F=!Iw(e,M);if(!D||(L===0||F)&&!c||H0e(M))continue;const U=!fz(P)&&!f;U&&(f=!0);let N=!1;l.forEach(Y=>{Y.start===A&&(Y.output=s?1:o&&U?this.backgroundIsGrid?3:2:1,Y.baseOpacity=U?h:1,WS.push(Y),this._compositor.openGroup(n),N=!0)});const j=N?4:o&&w===0?this.backgroundIsGrid?3:2:1,B=qX[SD(M)?M.layer.blendMode:"normal"];for(this._passParameters.baseOpacity=U&&!N&&h<1?h:1,this._passParameters.opacity=L,p2t(D)?_=this._compositor.drawVectorData(this._passParameters,j,n,B,D,a,this.tileSize,_):d2t(D)?(this._compositor.drawRasterData(this._passParameters,j,n,B,D),V$t(D)&&(y=9728)):this._dataToTexture(D,y7(P))&&(this._passParameters.texture=D.sourceLayerInfo.data.texture,this._passParameters.offset=D.offset,this._passParameters.scale=D.scale,this._compositor.drawImageData(this._passParameters,j,n,B));WS.length>0&&WS[WS.length-1].end===A;){const Y=WS.pop();this._passParameters.baseOpacity=Y.baseOpacity,this._passParameters.opacity=Y.opacity,this._passParameters.offset=$v,this._passParameters.scale=1,this._compositor.drawGroup(this._passParameters,Y.output,n,qX[Y.blendMode])}w++}const x=e.renderData,S=c||f&&h<1,$=x.ensureTexture(n,S,i,()=>this._buildTexture(n,S,y));this._compositor.copyFBOToTexture($),this._compositor.unbind(),x.setTextureReference(new PF($,i,t_e,f?1:h,0,1))}_dataToTexture(e,i){if(m2t(e)){const r=e.sourceLayerInfo,s=e.scale===1&&!i;r.data=this._buildTexture(r.data,!0,s,e.tile.onCompressionFinished),e.tile.setMemoryDirty()}return f2t(e)}_buildTexture(e,i,r=9987,s=()=>{}){if(e==null)return null;const n=new Zi;n.wrapMode=33071,n.samplingMode=typeof r=="boolean"?9987:r,n.maxAnisotropy=this._maxAnisotropy,n.preMultiplyAlpha=!0,n.flipped=!0,n.hasMipmap=!0,i||(n.pixelFormat=6407);const a=this._rctx,o=typeof r=="boolean"&&r;let l;if(typeof e=="number")n.width=n.height=e,l=this._buildTileTexture(n);else if(j8(e))n.isOpaque=e.isOpaque,n.isOpaque&&(n.pixelFormat=6407),n.width=e.element.width,n.height=e.element.height,l=this._buildTileTexture(n,o,s,e.element);else try{n.width=e.width,n.height=e.height,l=this._buildTileTexture(n,o,s,e)}catch{l=new e_e(S5e(a)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}const c=a.bindTexture(l.texture,Fi.TEXTURE_UNIT_FOR_UPDATES);return l.generateMipmap(),a.bindTexture(c,Fi.TEXTURE_UNIT_FOR_UPDATES),l}_buildTileTexture(e,i=!1,r=()=>{},s){const n=this._cache.pop(jX(e,!1))??this._cache.pop(jX(e,!0));if(i&&=T5e(s,e),n)return n.retain(),i?n.texture.enableCompression({compressionTracker:this._compressionTracker,compressionCallback:r}):n.texture.disableCompression(),n.texture.setData(s),n;e.compress=i?{compressionTracker:this._compressionTracker,compressionCallback:r}:void 0;const a=new Fi(this._rctx,e,s);return new e_e(a,this._cache)}get test(){}};function UG(t,e,i){fa.layerIndex=e,fa.vtlNeighborInfos.clear();const r=t.layerInfo[1][e];if(Cr(fa.offset,0,0),fa.tile=t,fa.scale=1,fa.sourceLod=t.lij,fa.sourceLayerInfo=r,fa.isVTLBackground=i,r.data)return i&&t.forEachLoadedNeighbor((a,o)=>{if(a.level!==t.level)return;const l=a.layerInfo[1][e];if(!nIe(l)||r.data===l.data)return;const c=fa.vtlNeighborInfos.pushNew();c.offset=lg[o],c.sourceLod=a.lij,c.sourceLayerInfo=l}),fa;const s=r.upsampleInfo,n=s?.tile?.layerInfo[1][e];return n&&s.tile?(fa.tile=s.tile,ko(fa.offset,s.offset),fa.scale=s.scale,fa.sourceLod=s.tile.lij,fa.sourceLayerInfo=n,fa):i?fa:null}function V$t(t){const e=t.sourceLayerInfo.data;return!!e.source&&e.interpolation==="nearest"}function $5e(t){let e=t.blendMode!=="normal";return PC(t.parent)&&(e=$5e(t.parent)||e),e}function C5e(t,e){PC(t.parent)&&C5e(t.parent,e);const i=t.uid;if(i!=null&&i!==""){const r=SV.get(i);r?r.start=e:SV.set(i,new F$t(e,e,t.blendMode,t.opacity,1,1))}}const SV=new Map,WS=new Array,fa=new R$t,t_e=fi(0,0,1,1),lg=new Array;function U$t(){fa.sourceLayerInfo=null,fa.tile=null,fa.vtlNeighborInfos.prune()}lg[0]=[0,-1],lg[1]=[-1,-1],lg[2]=[-1,0],lg[3]=[-1,1],lg[4]=[0,1],lg[5]=[1,1],lg[6]=[1,0],lg[7]=[1,-1];const B$t=200,BG=40,j$t=.8,q$t=10,KO=1e-6;function G$t(t,e,i){const r=e,s=i;let n=0,a=1/0;for(let o=0;o<3;++o){{const l=t[o];if(r[o]<l){if(s[o]<=KO)return!1;const c=(l-r[o])/s[o];n=Math.max(n,c)}else if(s[o]<=-KO){const c=(l-r[o])/s[o];a=Math.min(a,c)}if(n>a)return!1}{const l=t[o+3];if(r[o]>l){if(s[o]>=-KO)return!1;const c=(l-r[o])/s[o];n=Math.max(n,c)}else if(s[o]>=KO){const c=(l-r[o])/s[o];a=Math.min(a,c)}if(n>a)return!1}}return!0}let i_e=class{constructor(e,i,r,s,n){this.aabb=e,this.axis=i,this.d=r,this.midStartIndex=s,this.rightStartIndex=n}};var nv;let M5e=(nv=class{constructor(e,i,r,s){this.globalTriangleVertexIndices=e,this.firstTriangleIndex=i,this.positions=s,this._rayDirection=R(),this._callback=s_e,this._intersectionOptions=r_e,this.bspNodeTree=new Array;const n=r-i,a=new(n<Q$t?Uint8Array:n<X$t?Uint16Array:Uint32Array)(n);this.triangleIndexMap=a;for(let o=0;o<n;++o)a[o]=o;{const o=Y$t(e,i,r,s.data,s.stride),l=Se(Math.log2(n/BG),2,q$t),c=(h,f,y)=>{const _=W$t(a,o,h,f),w=f-h;if(w<=BG){const P=new i_e(_,void 0,0,h,f);return this.bspNodeTree.push(P),P}const{axis:x,midValue:S}=Z$t(_),$=H$t(a,o,h,f,x,S),A=(P,O)=>{if(y>l)return;const D=O-P;return D<BG||D>=j$t*w?void 0:c(P,O,y+1)},M=new i_e(_,x,S,$.next,$.mid);return this.bspNodeTree.push(M),M.leftNode=A(h,$.next),M.rightNode=A($.mid,f),M};c(0,n,0)}}intersectRayTriangleRange(e,i){if(e>=i)return;const r=this.positions;QRe(this._rayFrom,this._rayDirection,e,i,this.globalTriangleVertexIndices,r.data,r.stride,this._intersectionOptions.normalRequired,this._callback,this.triangleIndexMap,this.firstTriangleIndex),nv.numFacesTested+=i-e}intersectRay(e,i,r,s){nv.numFacesTested=0;const n=e,a=i,o=a[0]-n[0],l=a[1]-n[1],c=a[2]-n[2];if(o*o+l*l+c*c<KO)return;this._rayFrom=n;const h=this._rayDirection;h[0]=o,h[1]=l,h[2]=c;const f=this.triangleIndexMap.length;this._callback=s,this._intersectionOptions=r,this.intersectRayBSP(this.bspNodeTree[0],0,f),this._callback=s_e,this._intersectionOptions=r_e}intersectRayBSP(e,i,r){const s=this._rayFrom,n=this._rayDirection;if(!G$t(e.aabb,s,n))return;const a=e.axis,o=e.d;if(s[a]<o||n[a]<0){const l=i,c=e.midStartIndex;if(l<c){const h=e.leftNode;h!==void 0?this.intersectRayBSP(h,l,c):this.intersectRayTriangleRange(l,c)}}if(this.intersectRayTriangleRange(e.midStartIndex,e.rightStartIndex),s[a]>o||n[a]>0){const l=e.rightStartIndex,c=r;if(l<c){const h=e.rightNode;h!==void 0?this.intersectRayBSP(h,l,c):this.intersectRayTriangleRange(l,c)}}}get estimatedMemoryUsage(){return this.triangleIndexMap.byteLength}},nv.numFacesTested=0,nv);const ZS=[1/0,1/0,1/0],YS=[-1/0,-1/0,-1/0];function H$t(t,e,i,r,s,n){let a=i,o=r;for(;a<o;){const c=t[a];e[6*c+s+3]<=n?++a:(--o,t[a]=t[o],t[o]=c)}let l=a;for(o=r;l<o;){const c=t[o-1];e[6*c+s]>=n?--o:(t[o-1]=t[l],t[l]=c,++l)}return{next:a,mid:l}}function W$t(t,e,i,r){if(r<=i)return IC(NaN,NaN,NaN,NaN,NaN,NaN);{const s=6*t[i];for(let n=0;n<3;++n)ZS[n]=e[s+0+n],YS[n]=e[s+3+n]}for(let s=i+1;s<r;++s){const n=6*t[s];for(let a=0;a<3;++a)ZS[a]=Math.min(ZS[a],e[n+0+a]),YS[a]=Math.max(YS[a],e[n+3+a])}return IC(ZS[0],ZS[1],ZS[2],YS[0],YS[1],YS[2])}function Z$t(t){const e=t[3]-t[0],i=t[4]-t[1],r=t[5]-t[2],s=e>i?e>r?0:i>r?1:2:i>r?1:r>e?2:0;return{axis:s,midValue:(t[s]+t[s+3])/2}}function Y$t(t,e,i,r,s){const n=i-e,a=new Float32Array(6*n);for(let o=0;o<n;++o){const l=3*(o+e),c=t[l]*s,h=t[l+1]*s,f=t[l+2]*s;for(let y=0;y<3;++y){const _=r[c+y],w=r[h+y],x=r[f+y];a[6*o+y]=Math.min(_,w,x),a[6*o+3+y]=Math.max(_,w,x)}}return a}const Q$t=255,X$t=65535,r_e=new M8,s_e=()=>{};function Vei(t){t.code.add(E`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function J$t(t){t.code.add(E`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}function K$t(t,e){if(!e.screenSpaceReflections)return;const i=t.fragment;i.include(rd),i.uniforms.add(new Sy("nearFar",r=>r.camera.nearFar),new po("depthMap",r=>r.depth?.attachment),new Io("proj",r=>r.camera.projectionMatrix),new ws("invResolutionHeight",r=>1/r.camera.height),new Io("reprojectionMatrix",r=>r.ssr.reprojectionMatrix)).code.add(E`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${e.highStepCount?"150":"75"};

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);
    float dDepthBefore = 0.0;

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        float weight = dDepth / (dDepth - dDepthBefore);
        vec2 Pf = mix(P - dP, P, 1.0 - weight);
        if (abs(Pf.y - projectedCoordStart.y) > invResolutionHeight) {
          return vec3(Pf, depth);
        }
        else {
          return vec3(P, depth);
        }
      }

      // continue with ray marching
      P = clamp(P + dP, vec2(0.0), vec2(0.999));
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
      dDepthBefore = dDepth;
    }
    return vec3(P, 0.0);
  }
  `)}function eCt(t){t.fragment.uniforms.add(new ws("cloudAbsorption",e=>e.clouds.absorption),new ws("cloudCoverage",e=>e.clouds.coverage)).code.add(E`vec4 lookupCloudsFromTextureArray(sampler2DArray cubeMap, vec3 rayDir) {
int faceIndex;
vec2 uv;
if(rayDir.z <= 0.0) {
float hazeFactor = smoothstep(-0.01, mix(0.0, 0.075, cloudCoverage), abs(dot(rayDir, vec3(0, 0, 1))));
float shading = clamp(1.0 - cloudAbsorption, 0.6, 1.0) * (1.0 - hazeFactor);
float totalTransmittance = hazeFactor;
return vec4(shading, totalTransmittance, shading, totalTransmittance);
}
if (abs(rayDir.x) >= abs(rayDir.y) && abs(rayDir.x) >= abs(rayDir.z)) {
if(rayDir.x > 0.0) {
faceIndex = 0;
uv = rayDir.yz / rayDir.x;
uv = vec2(-uv.x, uv.y);
} else {
faceIndex = 1;
uv = rayDir.yz / rayDir.x;
uv = vec2(-uv.x, -uv.y);
}
} else if (abs(rayDir.y) >= abs(rayDir.x) && abs(rayDir.y) >= abs(rayDir.z)) {
if(rayDir.y > 0.0) {
faceIndex = 2;
uv = rayDir.xz / rayDir.y;
} else {
faceIndex = 3;
uv = rayDir.xz / rayDir.y;
uv = vec2(uv.x, -uv.y);
}
} else {
if(rayDir.y < 0.0) {
faceIndex = 4;
uv = rayDir.xy / rayDir.z;
uv = vec2(uv.x, -uv.y);
} else {
faceIndex = 5;
uv = rayDir.xy / rayDir.z;
uv = vec2(uv.x, -uv.y);
}
}
uv = 0.5 * (uv + 1.0);
if(faceIndex != 5) {
uv.y = uv.y - 0.5;
}
uv.y = uv.y * 2.0;
vec4 s = texture(cubeMap, vec3(uv, float(faceIndex)));
return s;
}`)}let tCt=class extends Ni{constructor(e,i){super(e,"sampler2DArray",0,(r,s)=>r.bindTexture(e,i(s)))}};function E5e(t){const e=t.fragment;e.constants.add("radiusCloudsSquared","float",iCt).code.add(E`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos) {
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusCloudsSquared;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
return (cameraPosition + dir * pointIntDist) - spherePos;
}`),e.uniforms.add(new ws("radiusCurvatureCorrection",({clouds:l})=>l.parallax.radiusCurvatureCorrection)).code.add(E`vec3 correctForPlanetCurvature(vec3 dir) {
dir.z = dir.z * (1.0 - radiusCurvatureCorrection) + radiusCurvatureCorrection;
return dir;
}`),e.code.add(E`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec) {
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),$p(e),Ty(e);const i=Ge(.28,.175,.035);e.constants.add("RIM_COLOR","vec3",i),e.code.add(E`
    vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds) {
      float upDotLight = dot(cameraPosition, mainLightDirection);
      float dirDotLight = max(dot(worldSpaceRay, mainLightDirection), 0.0);
      float sunsetTransition = clamp(pow(max(upDotLight, 0.0), ${E.float(.3)}), 0.0, 1.0);

      // Base color of the clouds that depends on lighting of the sun and sky
      vec3 ambientLight = calculateAmbientIrradiance(cameraPosition,  0.0);
      vec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
      vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));

      // Rim light around the edge of the clouds simulating scattering of the direct lun light
      float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
      float rimLightIntensity = 0.5 + 0.5 * pow(max(upDotLight, 0.0), 0.35);
      vec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, ${E.float(140)})) * scatteringMod;

      // Brighten the clouds around the sun at the sunsets
      float additionalLight = ${E.float(.2)} * pow(dirDotLight, ${E.float(10)}) * (1. - pow(sunsetTransition, ${E.float(.3)})) ;

      return vec3(baseCloudColor * (1.0 + additionalLight) + directSunScattering);
    }
  `),t.include(eCt),e.uniforms.add(new rV("readChannelsRG",l=>l.clouds.readChannels===0),new tCt("cubeMap",l=>l.clouds.data?.cubeMap?.colorTexture)).code.add(E`vec4 sampleCloud(vec3 rayDir, bool readOtherChannel) {
vec4 s = lookupCloudsFromTextureArray(cubeMap, rayDir);
bool readRG = readChannelsRG ^^ readOtherChannel;
s = readRG ? vec4(vec3(s.r), s.g) : vec4(vec3(s.b), s.a);
return length(s) == 0.0 ? vec4(s.rgb, 1.0) : s;
}`),e.uniforms.add(new co("anchorPoint",l=>l.clouds.parallax.anchorPoint),new co("anchorPointNew",l=>l.clouds.parallaxNew.anchorPoint),new Io("rotationClouds",l=>l.clouds.parallax.transform),new Io("rotationCloudsNew",l=>l.clouds.parallaxNew.transform),new ws("cloudsOpacity",l=>l.clouds.opacity),new ws("fadeFactor",l=>l.clouds.fadeFactor),new rV("crossFade",l=>l.clouds.fadeState===3)).code.add(E`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition) {
vec3 intersectionPoint = intersectWithCloudLayer(worldRay, cameraPosition, anchorPoint);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = sampleCloud(worldRayRotatedCorrected, crossFade);
vec3 cameraPositionN = normalize(cameraPosition);
vec4 cloudColor = vec4(calculateCloudColor(cameraPositionN, worldRay, cloudData), cloudData.a);
if(crossFade) {
intersectionPoint = intersectWithCloudLayer(worldRay, cameraPosition, anchorPointNew);
worldRayRotated = rotateDirectionToAnchorPoint(rotationCloudsNew, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = sampleCloud(worldRayRotatedCorrected, false);
vec4 cloudColorNew = vec4(calculateCloudColor(cameraPositionN, worldRay, cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorNew, fadeFactor);
}
float totalTransmittance = length(cloudColor.rgb) == 0.0 ?
1.0 :
clamp(cloudColor.a * cloudsOpacity + (1.0 - cloudsOpacity), 0.0 , 1.0);
return vec4(cloudColor.rgb, totalTransmittance);
}`)}const iCt=(mi.radius+Cut)**2;function rCt(t,e){const i=t.fragment;i.include(Y0t,e),i.include(t1),i.include(J$t),e.cloudReflections&&t.include(E5e),t.include(K$t,e),i.include(EM,e),i.constants.add("fresnelSky","vec3",[.02,1,15]),i.constants.add("fresnelMaterial","vec2",[.02,.1]),i.constants.add("roughness","float",.015),i.constants.add("foamIntensityExternal","float",1.7),i.constants.add("ssrIntensity","float",.65),i.constants.add("ssrHeightFadeStart","float",gDe),i.constants.add("ssrHeightFadeEnd","float",uV),i.constants.add("waterDiffusion","float",.92),i.constants.add("waterSeaColorMod","float",.8),i.constants.add("correctionViewingPowerFactor","float",.4),i.constants.add("skyZenitColor","vec3",[.52,.68,.9]),i.constants.add("skyColor","vec3",[.67,.79,.9]),i.constants.add("cloudFresnelModifier","vec2",[1.2,.01]),i.code.add(E`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),i.uniforms.add(new ws("lightingSpecularStrength",r=>r.lighting.mainLight.specularStrength),new ws("lightingEnvironmentStrength",r=>r.lighting.mainLight.environmentStrength)),i.code.add(E`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
float NdotL = clamp(dot(n, l), 0.0, 1.0);
specular = lightingSpecularStrength * NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),e.cloudReflections&&i.uniforms.add(new ws("cloudsOpacity",r=>r.clouds.opacity)).code.add(E`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y * cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * cloudsOpacity;`),e.screenSpaceReflections?i.uniforms.add(new Io("view",r=>r.camera.viewMatrix),new po("lastFrameColorTexture",r=>r.ssr.lastFrameColor?.getTexture()),new ws("fadeFactorSSR",r=>r.ssr.fadeFactor)).code.add(E`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view * vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view * vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3 * dCoords.y), 0.0, 1.0) * heightMod * fadeFactorSSR;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture(lastFrameColorTexture, reprojectedCoordinate).xyz) *
reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod * 0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor +
reflSea * seaColorMod + specular + foam);`):i.code.add(E`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),e.cloudReflections?e.screenSpaceReflections?i.code.add(E`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):i.code.add(E`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):i.code.add(E`return waterRenderedColor;
}`)}function sCt(t,e){const{vertex:i,fragment:r}=t;i.uniforms.add(new yD("overlayTexOffset",(s,n)=>oCt(s,n)),new yD("overlayTexScale",(s,n)=>lCt(s,n))),r.constants.add("overlayOpacity","float",1),r.uniforms.add(new zt("ovColorTex",(s,n)=>nCt(s,n))),A5e(t,e)}function nCt(t,e){return t.identifier===0&&ds(t.output)?t.occludedGround?e.overlay?.allSourcesOccluders?e.overlay?.getTexture(1):e.overlay?.getTexture(4):e.overlay?.getTexture(1):t.identifier===0&&t.output===10?e.overlay?.getTexture(5):t.identifier===2?e.overlay?.getTexture(2):null}function $A(t,e){const{vertex:i,fragment:r}=t,{output:s}=e;i.uniforms.add(new n_e("overlayTexOffset"),new n_e("overlayTexScale")),r.uniforms.add(new ut("overlayOpacity",n=>n.overlayOpacity)),s!==9&&r.uniforms.add(new zt("ovColorTex",(n,a)=>a.overlay?.getTexture(n.overlayContent))),A5e(t,e)}function aCt(t,e){switch(t){case 0:case 1:return e.slot!==9||e.overlay?.allSourcesOccluders?0:4;case 2:case 3:return 0;case 9:return 2;case 4:case 6:case 7:case 8:return null;case 10:return 5}return null}function A5e(t,e){const i=e.pbrMode===3||e.pbrMode===4||e.pbrMode===6;i&&t.include(rCt,e);const{vertex:r,fragment:s,varyings:n}=t;n.add("vtcOverlay","vec4");const{output:a}=e,o=a===9;r.code.add(E`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`),s.code.add(E`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),o?s.uniforms.add(new AM("overlayHighlightTexture",(l,c)=>c.overlay?.getTexture(2))).code.add(E`uvec2 getAllOverlayHighlightValuesEncoded() {
vec4 texCoords = vtcOverlay;
vec2 uvInner = texCoords.xy;
vec2 uvOuter = texCoords.zw;
bool isValidInner = isValid(uvInner, fwidth(uvInner));
bool isValidOuter = isValid(uvOuter, vec2(0.0, 0.0));
vec2 texelCoordInner = uvInner * vec2(0.5, 1.0);
vec2 texelCoordOuter = uvOuter * vec2(0.5, 1.0) + vec2(0.5,0.0);
vec2 texDim =  vec2(textureSize(overlayHighlightTexture, 0));
uvec2 texelValueInner = texelFetch(overlayHighlightTexture, ivec2(texelCoordInner * texDim), 0).rg;
uvec2 texelValueOuter = texelFetch(overlayHighlightTexture, ivec2(texelCoordOuter * texDim), 0).rg;
return
isValidInner ? texelValueInner :
isValidOuter ? texelValueOuter :
uvec2(0);
}`):(s.code.add(E`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`),s.code.add(E`vec4 getOverlayColorTexel() {
vec4 texCoords = vtcOverlay;
vec2 texDim =  vec2(textureSize(ovColorTex, 0));
vec4 color0 = texelFetch(ovColorTex, ivec2(vec2(texCoords.x * 0.5, texCoords.y) * texDim), 0);
vec4 color1 = texelFetch(ovColorTex, ivec2(vec2(texCoords.z * 0.5 + 0.5, texCoords.w) * texDim), 0);
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`)),i&&($p(s),Ty(s),s.code.add(E`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, mainLightDirection, colorInput.rgb, mainLightIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`))}function oCt(t,e){const i=e.overlay?.overlays[0]?.extent;XN(i)&&(Df[0]=t.toMapSpace[0]/oo(i)-i[0]/oo(i),Df[1]=t.toMapSpace[1]/Bl(i)-i[1]/Bl(i));const r=e.overlay?.overlays[1]?.extent;return XN(r)&&(Df[2]=t.toMapSpace[0]/oo(r)-r[0]/oo(r),Df[3]=t.toMapSpace[1]/Bl(r)-r[1]/Bl(r)),Df}function lCt(t,e){const i=e.overlay?.overlays[0]?.extent;XN(i)&&(Df[0]=t.toMapSpace[2]/oo(i),Df[1]=t.toMapSpace[3]/Bl(i));const r=e.overlay?.overlays[1]?.extent;return XN(r)&&(Df[2]=t.toMapSpace[2]/oo(r),Df[3]=t.toMapSpace[3]/Bl(r)),Df}const Df=ri();let n_e=class extends Ni{constructor(e){super(e,"vec4")}};function cCt(t,e){t.varyings.add("tbnTangent","vec3"),t.varyings.add("tbnBiTangent","vec3"),e.spherical?t.vertex.code.add(E`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):t.vertex.code.add(E`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`),t.fragment.code.add(E`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)}function O5e(t,e){e.output===9&&(t.include(CM,e),t.fragment.code.add(E`
    void calculateOcclusionAndOutputHighlight(uvec2 highlightToAdd) {
      uint levelBits = readLevelBits(highlightToAdd, highlightLevel);
      if ((levelBits & 1u) == 0u) discard;
      outputHighlight(isHighlightOccluded());
    }
  `))}function uCt(t,e){e.spherical?t.vertex.code.add(E`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):t.vertex.code.add(E`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),e.spherical?t.vertex.code.add(E`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):t.vertex.code.add(E`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}let hCt=class extends yre{constructor(){super(...arguments),this.overlayOpacity=1}};function dCt(t,e){const{vertex:i,fragment:r,varyings:s}=t;s.add("vtc","vec2"),i.uniforms.add(new a_e("texOffsetAndScale")),r.uniforms.add(new o_e("tex")),r.uniforms.add(new jG("textureOpacities"));const n=e.textureFadingEnabled&&!e.renderOccluded;n&&(i.uniforms.add(new a_e("nextTexOffsetAndScale")),s.add("nvtc","vec2"),r.uniforms.add(new o_e("texNext")),r.uniforms.add(new jG("nextTexOpacities")),r.uniforms.add(new pCt("fadeFactor")));const a=e.tileBlendInput===1,o=e.tileBlendInput===2;o&&r.include(mse),a&&r.uniforms.add(new jG("backgroundColor")),i.code.add(E`
  void forwardTextureCoordinatesWithTransform(in vec2 uv) {
    vtc = texOffsetAndScale.xy + uv * texOffsetAndScale.zw;
    ${_e(n,"nvtc = nextTexOffsetAndScale.xy + uv * nextTexOffsetAndScale.zw;")}
  }`),r.code.add(E`
    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${_e(o||a,E`if (opacities.y <= 0.0) {
           return color * opacities.z * opacities.x;
         }
         vec4 bg = vec4(${a?E`backgroundColor`:E`gridColor(uv)`} * opacities.y, opacities.y);
         vec4 layer = color * opacities.z;
         return (bg * (1.0 - layer.a) + layer) * opacities.x;`,"return color;")}
    }`),n?r.code.add(E`vec4 getTileColor() {
vec4 color = getColor(texture(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):r.code.add(E`vec4 getTileColor() {
return getColor(texture(tex, vtc), vtc, textureOpacities);
}`)}let pCt=class extends Ni{constructor(e){super(e,"float")}},jG=class extends Ni{constructor(e){super(e,"vec3")}},a_e=class extends Ni{constructor(e){super(e,"vec4")}},o_e=class extends Ni{constructor(e){super(e,"sampler2D")}},yse=class extends hCt{};function P5e(t){const e=new Di,{attributes:i,vertex:r,fragment:s,varyings:n}=e;i.add("position","vec3"),e.include(C4,t),e.include(Gg,t);const a=()=>{e.include(uCt,t),r.code.add(E`vec3 getNormal() {
float z = 1.0 - abs(normalCompressed.x) - abs(normalCompressed.y);
vec3 n = vec3(normalCompressed + vec2(normalCompressed.x >= 0.0 ? 1.0 : -1.0,
normalCompressed.y >= 0.0 ? 1.0 : -1.0) * min(z, 0.0), z);
return normalize(n);
}`)};jg(r,t),e.include(k_);const{output:o,pbrMode:l,overlayMode:c,tileBorders:h,spherical:f,transparencyMode:y,overlayEnabled:_}=t,w=y===2||y===3,x=_&&w;switch(o){case 1:case 0:{e.include(dCt,t),e.include(HC,t),_&&(t.pbrMode=l===5?6:3,e.include($A,t),t.pbrMode=l);const S=c===2;S&&e.include(cCt,t),n.add("vnormal","vec3"),n.add("vpos","vec3",{invariant:!0}),n.add("vup","vec3"),a(),r.main.add(E`
          vpos = position;
          vec3 positionWorld = position + localOrigin;
          gl_Position = transformPosition(proj, view, vpos);
          vnormal = getNormal();
          vup = getLocalUp(position, localOrigin);
          ${_e(S,E`forwardVertexTangent(vnormal);`)}

          forwardTextureCoordinatesWithTransform(uv0);
          ${_e(_,"setOverlayVTC(uv0);")}
          ${_e(h,"forwardTextureCoordinates();")}
          forwardLinearDepthToReadShadowMap();`),e.include(vre,t),s.include(I_,t),e.include(HC,t),s.include(k8,t),xy(s,t),z8(s),GC(s),s.uniforms.add(r.uniforms.get("localOrigin"),new co("viewDirection",({camera:A})=>Ee(l_e,ve(l_e,A.viewMatrix[12],A.viewMatrix[13],A.viewMatrix[14])))),S&&s.uniforms.add(new po("ovWaterTex",A=>A.overlay?.getTexture(3)),new Fie("view",({origin:A},{camera:M})=>Qh(fCt,M.viewMatrix,A)));const $=.2;s.code.add(E`float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`),$p(s),Ty(s),s.main.add(E`
          vec3 normal = normalize(vnormal);
          float vndl = dot(normal, mainLightDirection);

          float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));
          float shadow = readShadow(additionalAmbientScale, vpos);
          float ssao = evaluateAmbientOcclusionInverse();
          vec4 tileColor = getTileColor();

          ${_e(_,E`vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
                   vec4 overlayColor = overlayOpacity * overlayColorOpaque;
                   ${_e(w,`if (overlayColor.a < ${E.float(Gr)}) { discard; }`)}
                   vec4 groundColor = tileColor;
                   tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`)}

          // If combined alpha is 0 we can discard pixel. The performance impact by having a discard here
          // is neglectable because terrain typically renders first into the framebuffer.
          if(tileColor.a < ${E.float(Gr)}) {
            discard;
          }

          bool sliced = rejectBySlice(vpos);
          if (sliced) {
            tileColor *= ${E.float($)};
          }

          vec3 albedo = tileColor.rgb;

          // heuristic shading function used in the old terrain, now used to add ambient lighting

          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

          ${l===5||l===6?E`fragColor = vec4(evaluatePBRSimplifiedLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight, normalize(vpos - cameraPosition), vup), tileColor.a);`:E`fragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);`}
          ${_e(S,E`vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
                   float waterNormalLength = length(overlayWaterMask);
                   if (waterNormalLength > 0.95) {
                     mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
                     vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
                     vec4 viewPosition = view*vec4(vpos, 1.0);
                     vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + localOrigin);
                     vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                     float opacity = sliced ? ${E.float($)} : 1.0;
                     // un-gamma the ground color to mix in linear space
                     fragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w) * opacity;
                   }`)}
          ${_e(t.visualizeNormals,f?E`
                  vec3 localUp = normalize(vpos + localOrigin);
                  vec3 right = normalize(cross(vec3(0.0, 0.0, 1.0), localUp));
                  vec3 forward = normalize(cross(localUp, right));
                  mat3 tbn = mat3(right, forward, localUp);
                  vec3 tNormal = normalize(normal * tbn);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);`:E`
                  vec3 tNormal = normalize(normal);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);`)}
          ${_e(h,E`vec2 dVuv = fwidth(vuv0);
                 vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv0, 1.0 - vuv0));
                 float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
                 fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`)}
          fragColor = applySlice(fragColor, vpos);`)}break;case 2:x&&e.include($A,t),r.main.add(E`
        ${_e(x,"setOverlayVTC(uv0);")}
        gl_Position = transformPosition(proj, view, position);`),s.main.add(`${_e(x,`if (getCombinedOverlayColor().a < ${E.float(Gr)}) discard;`)}`);break;case 4:case 5:case 6:case 7:case 8:e.include(dre,t),oDe(e),hre(e),r.main.add(E`gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);`),s.main.add(E`outputDepth(linearDepth);`);break;case 3:x&&e.include($A,t),n.add("vnormal","vec3"),Nie(r),a(),r.main.add(E`
        ${_e(x,"setOverlayVTC(uv0);")}
        gl_Position = transformPosition(proj, view, position);
        vnormal = normalize((viewNormal * vec4(getNormal(), 1.0)).xyz);`),s.main.add(E`
        ${_e(x,`if (getCombinedOverlayColor().a < ${E.float(Gr)}) discard;`)}
        vec3 normal = normalize(vnormal);
        if (gl_FrontFacing == false) {
          normal = -normal;
        }
        fragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);`);break;case 9:_&&(e.include($A,t),e.include(O5e,t)),r.main.add(E`
        ${_e(_,"setOverlayVTC(uv0);")}
        gl_Position = transformPosition(proj, view, position);`),e.include(CM,t),s.main.add(E`
        ${_e(_,E`
           calculateOcclusionAndOutputHighlight(getAllOverlayHighlightValuesEncoded());`,"calculateOcclusionAndOutputHighlight();")}
      `)}if(o===10)if(_)t.pbrMode=0,e.include($A,t),t.pbrMode=l,r.main.add(E`gl_Position = transformPosition(proj, view, position);
setOverlayVTC(uv0);`),s.main.add(E`fragColor = getOverlayColorTexel();`);else{const S=y===0;r.main.add(E`${_e(S,"gl_Position = transformPosition(proj, view, position);")}`),s.main.add(E`fragColor = vec4(0.0);`)}return e}const fCt=it(),l_e=R(),mCt=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:yse,build:P5e},Symbol.toStringTag,{value:"Module"}));let gCt=class extends Vi{constructor(e,i){super(e,i,new Ii(mCt,()=>te(()=>Promise.resolve().then(()=>Gkt),void 0)),r5e.locations),this.type="TerrainTechnique",this.useStencil=!1}initializePipeline(e){return this._stencilPipelineState=this._createPipeline(e,!0),this._createPipeline(e,!1)}_createPipeline(e,i){const{renderOccluded:r,output:s}=e,n=e.backfaceCullingEnabled&&!r;return li({blending:r?Qv:null,culling:n?oie:null,depthTest:r?null:{func:513},depthWrite:r?null:m4,colorWrite:$i,stencilTest:i?b0t(1):null,drawBuffers:sw(s)})}getPipeline(){return this.useStencil?this._stencilPipelineState:super.getPipeline()}},pc=class extends op{constructor(e){super(),this.spherical=e,this.overlayMode=0,this.tileBlendInput=0,this.transparencyMode=0,this.pbrMode=5,this.receiveShadows=!1,this.backfaceCullingEnabled=!1,this.textureFadingEnabled=!1,this.renderOccluded=!1,this.screenSpaceReflections=!1,this.cloudReflections=!1,this.receiveAmbientOcclusion=!1,this.tileBorders=!1,this.visualizeNormals=!1,this.normalType=1,this.textureCoordinateType=1,this.highStepCount=!1,this.useCustomDTRExponentForWater=!1,this.useFillLights=!1,this.hasColorTexture=!0,this.draped=!1}get overlayEnabled(){return this.overlayMode!==0}};d([oe({count:3})],pc.prototype,"overlayMode",void 0),d([oe({count:3})],pc.prototype,"tileBlendInput",void 0),d([oe({count:4})],pc.prototype,"transparencyMode",void 0),d([oe({count:7})],pc.prototype,"pbrMode",void 0),d([oe()],pc.prototype,"receiveShadows",void 0),d([oe()],pc.prototype,"backfaceCullingEnabled",void 0),d([oe()],pc.prototype,"textureFadingEnabled",void 0),d([oe()],pc.prototype,"renderOccluded",void 0),d([oe()],pc.prototype,"screenSpaceReflections",void 0),d([oe()],pc.prototype,"cloudReflections",void 0),d([oe()],pc.prototype,"receiveAmbientOcclusion",void 0),d([oe()],pc.prototype,"tileBorders",void 0),d([oe()],pc.prototype,"visualizeNormals",void 0);const qG=7,yCt=10,GG=ul();let _h=class extends _4{get visibleTiles(){return Array.from(this._visiblePatchesByOrigin.values()).flat()}get _isGlobal(){return this._stage.viewingMode===1}get _techniques(){return this._context.techniques}get _rctx(){return this._context.renderContext.rctx}constructor(e,i,r,s,n){super({}),this._overlayRenderer=e,this._stage=i,this._allTiles=r,this._compressionTracker=s,this.type=7,this.isGround=!0,this._passParameters=new yse,this._drawParameters=new IIe,this._renderDataPool=new Wl(()=>new MTt),this._visiblePatchesByOrigin=new Map,this._allPatchesByOrigin=new Map,this._patchesByOriginDirty=!0,this._patchSortingDirty=!0,this._tileIterator=new zIe,this._castShadows=!1,this._inViewshed=!1,this._cutFillEnabled=!1,this._tileRenderer=null,this._stencilEnabledLayerExtents=new Array,this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this.renderOccludedFlags=1,this.produces=new Map([[1,()=>this._produces()&&this.transparency===0],[6,()=>this._produces()&&(this.transparency===1||this.transparency===2)],[9,()=>this._produces()&&this.renderOccludedFlags===dR]]),this._tileSize=256,this._configuration=new pc(i.viewingMode===1),this._tileTextureCache=new R4((a,o)=>n.newCache(a,o),"TileTexture"),this.tileGeometryCache=new b3t(n)}normalizeCtorArgs(){return{}}initialize(){this._stage.addRenderPlugin(this),this.addHandles(K(()=>this._overlayRenderer.renderOccludedFlags,e=>{this.renderOccludedFlags=e,this.setNeedsRender()},Yt))}destroy(){this._stage.removeRenderPlugin(this),this._tileTextureCache.destroy(),this.tileGeometryCache.destroy(),this._allTiles.prune(),this._tileRenderer=null}_produces(){return this.visible&&!!this._rootTiles&&!this.renderingDisabled}consumes(){return this._overlayRenderer.hasWater?Mut:wOe}set renderingDisabled(e){this._set("renderingDisabled",!!e),this.setDirty()}set visible(e){this._set("visible",!!e),this.setDirty()}updateHeading(e){this._tileRenderer?.updateHeading(e)}set transparency(e){this._configuration.transparencyMode!==e&&(this._configuration.transparencyMode=e,this.setNeedsRender())}get transparency(){return this._configuration.transparencyMode}get renderPatchBorders(){return this._configuration.tileBorders}set renderPatchBorders(e){this._configuration.tileBorders!==e&&(this._configuration.tileBorders=e,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get visualizeNormals(){return this._configuration.visualizeNormals}set visualizeNormals(e){this._configuration.visualizeNormals!==e&&(this._configuration.visualizeNormals=e,this.setNeedsRender(),this.notifyChange("visualizeNormals"))}get cullBackFaces(){return this._configuration.backfaceCullingEnabled}set cullBackFaces(e){this._configuration.backfaceCullingEnabled!==e&&(this._configuration.backfaceCullingEnabled=e,this.notifyChange("cullBackFaces"),this.setNeedsRender())}get layerViewUid(){return Av}get slicePlaneEnabled(){return this._configuration.hasSlicePlane}set slicePlaneEnabled(e){this._configuration.hasSlicePlane!==e&&(this._configuration.hasSlicePlane=e,this.setNeedsRender())}set textureFadingEnabled(e){this._configuration.textureFadingEnabled!==e&&(this._configuration.textureFadingEnabled=e,this.setNeedsRender())}set pbrMode(e){this._configuration.pbrMode!==e&&(this._configuration.pbrMode=e,this.setNeedsRender())}setRootTiles(e){this._rootTiles=e,this.setDirty()}setStencilEnabledLayerExtents(e){this._stencilEnabledLayerExtents=e,this._setSortingDirty()}set tileSize(e){this._tileSize=e,this._tileRenderer!=null&&(this._tileRenderer.tileSize=e),this.setDirty()}get tileSize(){return this._tileSize}_ensureRenderData(e){e.renderData||(e.renderData=this._renderDataPool.acquire(),e.renderData.init(e,this._getLocalOriginOfTile(e)))}loadTile(e){this._ensureRenderData(e),this.updateTileGeometryState(e),this.reuseTextureFromParent(e)||this.updateTileTexture(e,32)}reuseTextureFromParent(e){const i=e.parent;if(!i)return!1;const r=fi(1&e.lij[2]?.5:0,1&e.lij[1]?0:.5,.5,.5);return i.renderData?.reuseTexture(e.renderData,r)??!1}updateTileTexture(e,i){this._tileRenderer!=null&&(this._tileRenderer.updateTileTexture(e,i===32?0:2),this.setNeedsRender(),e.resetPendingUpdate(i))}updateTileGeometryState(e){for(const r of e.layerInfo[0])r.pendingUpdates&=-9;e.resetPendingUpdate(8);const i=e.renderData.updateGeometryState();return i&&this.setDirty(),i}updateGeometryIfNeeded(e){e.loaded&&e.renderData.updateGeometryIfNeeded(this._rctx)}unloadTile(e){const i=e.renderData;i&&(i.releaseGeometry(),this._renderDataPool.release(i),i.clear(),e.renderData=null,e.setMemoryDirty(),this.setDirty())}_getLocalOriginOfTile(e){const i=yCt-qG,r=Math.max(0,Math.floor((e.level-i)/qG)*qG);if(this._isGlobal&&r===0)return Kn;for(;e.parent&&e.level>r;)e=e.parent;return e.centerAtSeaLevel}getStats(){return{numTilesRendered:this._numTilesRendered,numTilesCulled:this._numTilesCulled,numOriginsRendered:this._numOriginsRendered}}set wireframe(e){this._get("wireframe")!==e&&(this._set("wireframe",e),this.setNeedsRender())}setDirty(e=1){this._patchesByOriginDirty=!0,this._context.requestRender(e)}_setSortingDirty(e=1){this._patchSortingDirty=!0,this._context.requestRender(e)}setNeedsRender(e=1){this._context.requestRender(e)}initializeRenderContext(e){this._context=e,this._tileRenderer=new N$t(this._rctx,this._tileSize,this._techniques,this._tileTextureCache,this._compressionTracker),this.updateTileBackground()}uninitializeRenderContext(){this._tileRenderer=Rt(this._tileRenderer)}intersect(e,i,r,s){if(!this._rootTiles||e.options.selectOpaqueTerrainOnly&&e.options.selectionMode&&this.transparency!==0)return;const n=_Ct,a=vCt;Ce(n,s,r),ve(a,1/n[0],1/n[1],1/n[2]);const o=e.results.min,l=e.results.max,c=e.results.ground,h=e.options.store===0,f=!!e.results.ground.target,y=Oat(e.verticalOffset),_=e.tolerance;let w,x=h&&o.distance!=null?o.distance:1/0;const S=e.options,$=S.normalRequired||!S.backfacesTerrain,A=new M8(_,!1,$),M=O=>{const D=O.renderData;if(!D?.vao)return;const L=D.geometry;t8(GG,L.boundingBox);const F=D.localOrigin;y!=null&&(y.localOrigin=F,y.applyToAabb(GG));const U=GG;if(QS[0]=r[0]-F[0],QS[1]=r[1]-F[1],QS[2]=r[2]-F[2],!lre(U,QS,a,_,x))return;const N=(ye,De,q)=>{ye.set(this.type,O,De,q),x=h&&o.distance!=null?o.distance:1/0},j=(ye,De,q)=>{if((!$||q!=null)&&ye>=0&&(S.backfacesTerrain||Oe(q,n)<0)&&(S.invisibleTerrain||!S.selectionMode||i==null||i(r,s,ye))){if((c.distance==null||ye<c.distance)&&N(c,ye,q),S.isFiltered)return;S.store===2&&(w==null?(w=new G_(e.ray),N(w,ye,q),e.results.all.push(w)):ye<w.distance&&N(w,ye,q)),(o.distance==null||ye<o.distance)&&N(o,ye,q),S.store!==0&&(l.distance==null||ye>l.distance)&&N(l,ye,q)}},B=bCt;Ce(B,s,F);const{indices:Y,indexCount:G}=L,Z=L.vertexAttributes,H=Z.getField("position",Z_),Q=new d4(H.typedBuffer,3,Z.stride/4),X=G/3;if(!y&&X>B$t){const ye=O.renderData;ye.intersectionData==null&&(ye.intersectionData=new M5e(Y,0,X,Q)),ye.intersectionData.intersectRay(QS,B,A,j)}else i0t(QS,B,0,X,Y,Q,y,A,j)},P=this._rootTiles;P!=null&&(()=>{const O=this._tileIterator;O.reset(P);const D=e.options.invisibleTerrain;for(let L=O.next();L;L=O.next())!(L.visible||D&&L.intersectsClippingArea)||y==null&&!L.intersectsRay(r,n,_,x)||f&&this._useStencilForTile(L)?O.skipSubtree():M(L)})()}processScaleRangeQueries(e,i){if(!i.done&&e)for(this._updatePatchGroups();e.updating&&!i.done;){e.prepare();for(const r of this._visiblePatchesByOrigin.values())for(const s of r)s.renderData?.textureReference!=null&&e.queriesForTile(s);e.process(),i.madeProgress()}}acquireTechniques(e){const i=!!ie("enable-feature:terrain-shadows")&&e.bind.shadowMap.enabled;i!==this._castShadows&&(this._castShadows=i,this._patchesByOriginDirty=!0);const r=e.bind.viewshedEnabled;this._inViewshed!==r&&(this._inViewshed=r,this._patchesByOriginDirty=!0);const s=e.bind.cutFillEnabled;if(this._cutFillEnabled!==s&&(this._cutFillEnabled=s,this._patchesByOriginDirty=!0),e.bind.slot===9){if((e.renderOccludedMask&dR)===0)return null}else{const a=this.transparency===0?1:6;if(e.bind.slot!==a)return null}if(this.transparency===3)return null;const n=this._configuration;switch(n.screenSpaceReflections=n.cloudReflections=n.receiveShadows=n.receiveAmbientOcclusion=n.renderOccluded=n.hasHighlightMixTexture=!1,n.overlayMode=this._overlayRenderer.mode,e.output){case 0:case 1:{n.screenSpaceReflections=e.bind.ssr.lastFrameColor!=null,n.cloudReflections=e.bind.clouds.data!=null;const a=e.bind.slot===9;return n.receiveShadows=e.bind.shadowMap.ready&&!a,n.renderOccluded=a,n.receiveAmbientOcclusion=!a&&e.bind.ssao!=null,this._acquireTechnique(e.output)}case 4:case 6:return this._castShadows?this._acquireTechnique(4):null;case 7:return this._inViewshed?this._acquireTechnique(7):null;case 8:return this._cutFillEnabled?this._acquireTechnique(8):null;case 2:case 3:return this._acquireTechnique(e.output);case 10:return this._acquireTechnique(10);case 9:return n.hasHighlightMixTexture=e.bind.highlightMixTexture!=null,this._overlayRenderer.hasHighlights?this._acquireTechnique(9):null}return null}render(e,i){switch(this._updatePatchGroups(),i.useStencil=!1,this._passParameters.overlayContent=aCt(e.output,e.bind),e.output){case 0:case 1:this._renderMaterialPass(e,i);break;case 2:case 3:case 10:this._renderAuxiliaryPass(e,i,this._visiblePatchesByOrigin);break;case 9:{const r=e.bind.highlight?.name;r&&this._overlayRenderer.hasHighlights&&this._overlayRenderer.renders(2)&&this._overlayRenderer.hasHighlight(r)&&this._renderAuxiliaryPass(e,i,this._visiblePatchesByOrigin);break}case 4:case 6:case 7:case 8:this._renderAuxiliaryPass(e,i,this._allPatchesByOrigin)}}updateTileBackground(e){if(this._tileRenderer==null)return;const i=this._tileRenderer;let r;if(e!=null){const s=mt.toUnitRGBA(e);r=Ge(s[0]||0,s[1]||0,s[2]||0)}i.setBackground(r),this._allTiles.forAll(s=>i.updateTileTexture(s,0)),this._configuration.tileBlendInput=i.backgroundIsGrid?2:i.backgroundColor!=null?1:0,this.setNeedsRender()}_updatePatchGroups(){if(this._patchesByOriginDirty&&(this._rebuildPatchGroups(),this._patchesByOriginDirty=!1,this._patchSortingDirty=!0),this._patchSortingDirty){const e=Array.from(this._visiblePatchesByOrigin.values()),i=this._stencilEnabledLayerExtents;for(const r of e)FIe(r,i);e.sort((r,s)=>NIe(r[0],s[0])),this._visiblePatchesByOrigin=new Map(e.map(r=>[r[0].renderData.localOrigin,r])),this.notifyChange("visibleTiles"),this._patchSortingDirty=!1}}_rebuildPatchGroups(){const e=this._rootTiles;if(e!=null){e[0]?.surface.checkAllTilesWaterproofness(),this._visiblePatchesByOrigin.clear(),this._allPatchesByOrigin.clear();for(const i of e)this._rebuildPatchGroupsForRootTile(i)}}_rebuildPatchGroupsForRootTile(e){const i=this._tileIterator;for(i.resetOne(e);!i.done;){const r=i.next(),s=r.renderData;if(!s){this._numTilesCulled++;continue}const n=s.localOrigin;if(this._castShadows||this._inViewshed||this._cutFillEnabled){let o=this._allPatchesByOrigin.get(n);o||(o=[],this._allPatchesByOrigin.set(n,o)),o.push(r)}if(!r.visible){this._numTilesCulled++,i.skipSubtree();continue}let a=this._visiblePatchesByOrigin.get(n);a||(a=[],this._visiblePatchesByOrigin.set(n,a)),a.push(r),i.skipSubtree()}}_useStencilForTile(e){for(const i of this._stencilEnabledLayerExtents)if(e.intersectsExtent(i))return!0;return!1}_renderAuxiliaryPass(e,i,r){const{rctx:s,bind:n}=e;s.bindTechnique(i,n,this._passParameters);const a=this._stencilEnabledLayerExtents.length>0;r.forEach(o=>{this._drawParameters.origin=o[0].renderData.localOrigin,i.program.bindDraw(n,this._passParameters,this._drawParameters);for(let l=0;l<o.length;l++)this._renderPatch(s,i,o[l],lr.TRIANGLES,a,this._passParameters.overlayContent===null)}),s.bindVAO(null)}_renderMaterialPass(e,i){const{rctx:r,bind:s}=e;r.bindTechnique(i,s,this._passParameters),this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0;const n=i.program,a=this._stencilEnabledLayerExtents.length>0,o=s.slot===9;o&&(n.bindTexture("tex",r.emptyTexture),n.setUniform3fv("textureOpacities",Kn),n.setUniform4fv("texOffsetAndScale",tn));const l=this._tileRenderer?.backgroundColor!=null?this._tileRenderer.backgroundColor:Kn;this._configuration.tileBlendInput===1&&n.setUniform3fv("backgroundColor",l);const c=this.wireframe?lr.LINES:lr.TRIANGLES;this._configuration.textureFadingEnabled&&n.bindTexture("texNext",r.emptyTexture);const h=this._visiblePatchesByOrigin;for(const f of h.values()){const y=f[0].renderData.localOrigin;this._drawParameters.origin=y,i.program.bindDraw(s,this._passParameters,this._drawParameters),this._numOriginsRendered++;for(const _ of f){const w=_.renderData,x=w.textureReference;if(x!=null){if(!o){n.setUniform4fv("texOffsetAndScale",x.offsetAndScale),n.bindTexture("tex",x.texture.texture);const S=w.textureFadeFactor,$=S<1?w.nextTextureReference:null;this._configuration.textureFadingEnabled&&$&&S<1?(n.setUniform1f("fadeFactor",S),n.setUniform4fv("nextTexOffsetAndScale",$.offsetAndScale),n.setUniform3fv("nextTexOpacities",$.opacities),n.bindTexture("texNext",$.texture.texture)):n.setUniform1f("fadeFactor",1),w.textureIsFading&&this.setNeedsRender(2),n.setUniform3fv("textureOpacities",x.opacities)}this._renderPatch(r,i,_,c,a),_.renderOrder=this._numTilesRendered,this._numTilesRendered++}}}r.bindVAO(null)}_renderPatch(e,i,r,s,n,a=!1){const o=r.renderData,l=o.vao,c=l?.indexBuffer;if(!l||c==null)return void(Yn&&console.error("Rendered tile with no indices: ",r.lij," : ",o));const h=i.program;a||this._overlayRenderer.isEmpty||this._bindOverlayPatchData(h,o.overlay),n&&(i.useStencil=this._useStencilForTile(r),e.setPipelineState(i.getPipeline()));const f=o.geometry.indexCount;e.bindVAO(l),h.assertCompatibleVertexAttributeLocations(l),e.drawElements(s,f,c.indexType,0)}_bindOverlayPatchData(e,i){e.setUniform4fv("overlayTexOffset",i.offsets),e.setUniform4fv("overlayTexScale",i.scales)}_acquireTechnique(e){return this._configuration.output=e,this._techniques.get(gCt,this._configuration)}get test(){}hasHighlight(e){return this._overlayRenderer.hasHighlight(e)}};d([m({readOnly:!0})],_h.prototype,"visibleTiles",null),d([m({readOnly:!0})],_h.prototype,"_isGlobal",null),d([m()],_h.prototype,"renderOccludedFlags",void 0),d([m({value:!1})],_h.prototype,"renderingDisabled",null),d([m({value:!0})],_h.prototype,"visible",null),d([m()],_h.prototype,"renderPatchBorders",null),d([m()],_h.prototype,"visualizeNormals",null),d([m()],_h.prototype,"cullBackFaces",null),d([m()],_h.prototype,"wireframe",null),_h=d([k("esri.views.3d.terrain.TerrainRenderer")],_h);const _Ct=R(),vCt=R(),QS=R(),bCt=R();let wCt=class{constructor(){this.numNodes=0,this.numLeaves=0,this.numVisible=0,this.numRendered=0,this.numSplit=0,this.numMerged=0,this.numRenderedPerLevel=new Array,this.numLoadedPerLevel=new Array}},ff=class extends Me{constructor(e){super(e)}initialize(){this.addHandles([this.layers.on("change",()=>this._update()),K(()=>this.extentHelper.layerViewsExtent,()=>this._setAdHocTilingScheme())]),this._update(),this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._waitTask=null,this.layers.destroy()}_update(){if(this._waitTask=null,this.tilingSchemeLocked)return;let e;if(this.layers.some(i=>!(!e$(i)||i.isRejected())&&!(i.isFulfilled()&&!xCt(i,this.viewSpatialReference,this.viewingMode))&&(e=i,!(i?.type==="vector-tile"||_V(i)))),e)if(e.isResolved()){const i=Z8(e,this.viewSpatialReference,this.viewingMode);if(i!=null){const r=new Zd(i.tileInfo);this._lockTilingScheme(r)}}else this._updateWhen(e)}_updateWhen(e){const i=e.when().catch(()=>{}).then(()=>{i!==this._waitTask||this.destroyed||this._update()});this._waitTask=i}_lockTilingScheme(e){if(this.viewingMode===1){const i=e.levels.length-1,r=e.spatialReference;r.isWebMercator?e=Zd.makeWebMercatorAuxiliarySphere(i):qre(r)&&(e=Zd.makeGCSWithTileSize(e.spatialReference,e.pixelSize,i))}this.tilingSchemeLocked=!0,this.tilingScheme=e,this.extentHelper.tilingScheme=this.tilingScheme,this._updateTiledLayerExtent(),this.removeAllHandles(),this.addHandles(K(()=>this.extentHelper.tiledLayersExtent,()=>this._updateTiledLayerExtent()))}_updateTiledLayerExtent(){this._set("extent",this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===1){const e=this.extentHelper.viewSpatialReference;e.isWebMercator?this.tilingScheme=Zd.WebMercatorAuxiliarySphere:iIe(e)&&(this.tilingScheme=Zd.makeGCSWithTileSize(e,256)),this._set("extent",this.extentHelper.layerViewsExtent)}else{const e=this.extentHelper.layerViewsExtent;e==null||vw(e,this.extent)||(this.tilingScheme=Zd.fromExtent(e,this.extentHelper.viewSpatialReference),this._set("extent",e))}}get test(){}};function xCt(t,e,i){return Z8(t,e,i)!=null}d([m()],ff.prototype,"tilingScheme",void 0),d([m({readOnly:!0})],ff.prototype,"extent",void 0),d([m({value:!1})],ff.prototype,"tilingSchemeLocked",void 0),d([m({constructOnly:!0})],ff.prototype,"viewSpatialReference",void 0),d([m({constructOnly:!0})],ff.prototype,"layers",void 0),d([m({constructOnly:!0})],ff.prototype,"extentHelper",void 0),d([m({constructOnly:!0})],ff.prototype,"viewingMode",void 0),ff=d([k("esri.views.3d.terrain.TilingSchemeLogic")],ff);let SCt=class{constructor(){this._offset=pt(),this.scale=0}get offset(){return this._offset}init(e,i,r,s){this.tile=e,this._offset[0]=i,this._offset[1]=r,this.scale=s}dispose(){this.tile=null,this._offset[0]=0,this._offset[1]=0,this.scale=0}},TCt=class{constructor(){this._pendingCompressionTasks=Pn(0)}get compressing(){return!!this._pendingCompressionTasks.value}increment(){this._pendingCompressionTasks.value++}decrement(){this._pendingCompressionTasks.value--}};var zF,Ex;let Gt=(Ex=class extends Uc{get allTiles(){return this._allTiles}get renderedTiles(){return FIe(YV(this._allTiles.toArray(),e=>e.visible&&e.rendered))}get demResolution(){const{_allTiles:e,tilingScheme:i}=this;if(e.length===0)return{min:1,max:1};const r=Wr(i.spatialReference);let s=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY;for(const a of e){const o=i.resolutionAtLevel(a.level)*r;s=Math.min(s,o),n=Math.max(n,o)}return{min:s,max:n}}constructor(e){super(e),this.terrainTextureCompressionTracker=new TCt,this._iteratorPool=new Wl(()=>new zIe,r=>r.remove=()=>this._iteratorPool.release(r)),this._postorderIterator=new _Tt,this._hasPendingUpdates=!1,this._pendingUpdates=0,this._asyncWorkItems=0,this._allTilesDirty=!0,this._allTilesSorted=!0,this._usedMemory=null,this._performanceInfo=new wCt,this._viewChanged=!1,this.heading=0,this._inFrameTask=!1,this._viewChangeUpdateDirty=!1,this._eyePosRenderSR=R(),this._eyePosSurfaceSR=R(),this._splitLimits=new Ld,this._layerViews=[new Array,new Array],this._layerIndexByUid=[new Map,new Map],this._basemapLayerViewHandles=new Map,this._watchUpdatingTracking=new mp,this._frameTask=W_,this._allTiles=new _i,this._upsampleInfoPool=new Wl(()=>new SCt),this._shouldEmitChangeEvent=!1,this._rootTilesExtent=Pi(),this.updatingProgress=.5,this._maxNumUpdating=1,this.maxTextureScale=1.2,this._spatialReference=Ie.WebMercator,this._elevationProjectorCache=new Map,this.visibleElevationBounds=new I3(1/0,-1/0),this.rootTileElevationBounds=new I3(1/0,-1/0),this._projectorCache=new Map,this._tilingSchemeSpatialReference=null,this._updatingRootTiles=!1,this._pendingTilesForElevationUpdateEvent=new Set,this._pendingTilesToUpdate=new Set,this.totalGeometryUpdates=0,this.totalTileUpdates=0,this._oneBatchPerFrameTask=!0,this._layerViewsDirty=!1,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._isWebMercator=!1,this._isWebMercatorOnPlateCarree=!1,this.enabled=!0;const{view:i}=e;this.overlayManager=new Sl({...e,terrainSurface:this}),this._isGlobal=!i.state?.isLocal,this._isGeographic=this._spatialReference?.isGeographic??!1,this._tileConstructor=this._isGlobal?_3t:f3t,this._ellipsoid=or(i.spatialReference),this._renderer=new _h(this.overlayManager.renderer,i.stage,this._allTiles,this.terrainTextureCompressionTracker,i.resourceController.memoryController),xF()||(this._scaleRangeQueries=new kF)}initialize(){const{view:e}=this,{resourceController:i}=e,{memoryController:r}=i;this._tileCache=new R4((c,h)=>r.newCache(c,h),"terrain-tile"),this._upsampleMapCache=r.newCache("terrain-upsample",({tile:c})=>c.unloadMapData()),this._elevationQueryCache=new tIe(r.newCache("elevation-query"));const s=this.overlayManager;this.addHandles([K(()=>s.renderer.isEmpty,()=>this._evaluateTransparency()),K(()=>this.renderer.visible,c=>this.suspended=!c),K(()=>this.heading,c=>{this._renderer.updateHeading(c),this._updateTileTextures(0)}),K(()=>({heading:e.camera?.heading,state:e.state?.mode}),({heading:c,state:h})=>{if(c==null)return;if(this.isGlobal&&this.isGeographic||this.isWebMercatorOnPlateCarree)return void(this.heading=90*Math.round(c/90)%360);const f=Math.round(c)%360,y=Math.abs(f-this.heading);(h===2||Math.min(y,360-y)>=30)&&(this.heading=f)})],"overlayManager"),this.addHandles([K(()=>this.baseOpacity,()=>{this._handleLayerViewChanges(),this._updateTileTextures(this._evaluateTransparency()?1:2)},At),K(()=>this.hasCompositeBlendMode,()=>this._updateTileTextures(this._evaluateTransparency()?1:2),At),K(()=>this.backgroundColor,(c,h)=>{c?.equals(h)||(this._handleLayerViewChanges(),this._renderer.updateTileBackground(c))},Yt),K(()=>this.snapLevel,()=>this._viewChanged=!0,Yt),K(()=>this.view.pointsOfInterest,c=>{this._renderer.pointsOfInterest=c,this._watchUpdatingTracking.removeAll(),c&&this._watchUpdatingTracking.add(()=>c.focus?.renderLocation,()=>this._allTilesSorted=!1,{equals:si})}),K(()=>Ws.TERRAIN_TILE_TREE_SHOW_TILES,c=>{c&&!this._treeDebugger?te(async()=>{const{TerrainTileTree3DDebugger:h}=await import("./TerrainTileTree3DDebugger-DAiUujml.js");return{TerrainTileTree3DDebugger:h}},__vite__mapDeps([366,367])).then(({TerrainTileTree3DDebugger:h})=>{!this._treeDebugger&&Ws.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new h({view:e}))}):c||(this._treeDebugger=Re(this._treeDebugger))},Wt)]);const{spatialReference:n}=e;this._extentHelper=x2t(this.viewingMode,{layers:e.map.allLayers,layerViews:e.allLayerViews,viewSpatialReference:n});const a=new Jd({getCollections:()=>e.defaultsFromMap?.mapCollections?.map(({layers:c})=>c),getChildrenFunction:c=>c&&"layers"in c?c.layers:null}),o=new ff({layers:a,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:n});this._set("tilingSchemeLogic",o),this._updateTilingScheme(),this._elevationDataRequester=i.createStreamDataRequester(0),this._mapDataRequester=i.createStreamDataRequester(1);const l=i.scheduler;this._frameTask=l.registerTask(yt.TERRAIN_SURFACE,this),this.addHandles([K(()=>this._extentHelper.stencilEnabledExtents,c=>this._renderer.setStencilEnabledLayerExtents(c),Wt),K(()=>this.tilingSchemeLogic.tilingScheme,()=>this._updateTilingScheme(),Yt),K(()=>this.extent,()=>this._updateRootTiles(),Wt),e.on("resize",()=>this._viewChangeUpdate()),K(()=>{const c=e.state;return[this._lodBias,this.lodSnappingEnabled,e.quality,c.camera,c.contentCamera,c.fixedContentCamera]},()=>this._viewChangeUpdate(),At),K(()=>e.qualitySettings?.fadeDuration,c=>this._renderer.textureFadingEnabled=c>0,Wt),K(()=>e.qualitySettings?.physicallyBasedRenderingEnabled,c=>this._renderer.pbrMode=c?5:0,Wt),K(()=>e.qualitySettings?.tiledSurface.elevationLevelDelta,()=>this._updateAllTileGeometries()),K(()=>this._userClippingExtent,()=>this._updateClippingExtent(),Yt)]),this.addHandles(e.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0)),this._layerViewsDirty=!0,this._handleLayerViewChanges(),this._renderer.updateTileBackground(this.backgroundColor)}clearHandles(){this._watchUpdatingTracking?.removeAll(),this.removeAllHandles(),this._basemapLayerViewHandles.forEach((e,i)=>this._unregisterTiledLayerView(i)),this._basemapLayerViewHandles.clear()}destroy(){this._frameTask.remove(),this._frameTask=W_,this._watchUpdatingTracking?.destroy(),this._removeAllTiles(),this._set("tilingSchemeLogic",Re(this.tilingSchemeLogic)),this._basemapLayerViewHandles.forEach((e,i)=>this._unregisterTiledLayerView(i)),this._basemapLayerViewHandles.clear(),this._elevationDataRequester=null,this._mapDataRequester=null,this._set("overlayManager",Re(this.overlayManager)),this._tileCache=Re(this._tileCache),this._allTiles.prune(),ase.prune(),this._treeDebugger=Re(this._treeDebugger),this._renderer.destroyed||this._renderer.destroy(),this._renderer=null,this._iteratorPool=Re(this._iteratorPool),this._upsampleMapCache=Re(this._upsampleMapCache),this._elevationQueryCache=Re(this._elevationQueryCache),this._set("view",null),this._extentHelper=Re(this._extentHelper),this._upsampleInfoPool=Re(this._upsampleInfoPool),NTt(),this._layerViews.forEach(e=>e.length=0),this._performanceInfo=null}get renderer(){return this._renderer}get frustum(){return this.view.state.camera.frustum}get snapLevel(){return this.lodSnappingEnabled?this.view.terrainLevel:null}get lodSnappingEnabled(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get hasStencilEnabledExtents(){return this._extentHelper.stencilEnabledExtents.length>0}get _userClippingExtent(){const{spatialReference:e}=this,i=this.view?.clippingArea;if(i==null||e==null)return null;const r=Pi(),s=e2t(i,r,e)?r:null,n=this._get("extent");return vw(s,n)?n:s}get rootTilesExtent(){return this._rootTilesExtent}get extent(){const e=OW(this.groundExtent,this._userClippingExtent,Pi()),i=this._get("extent");return vw(e,i)?i:e}get groundExtent(){return this._tilingSchemeExtent!=null?this._tilingSchemeExtent:this._rootTilesExtent}get _tilingSchemeExtent(){return this.tilingSchemeLogic?.extent}get updating(){return this._hasPendingUpdates||(this._maxNumUpdating=1),this.enabled&&!!((this.readyToRun||this._watchUpdatingTracking?.updating||this._asyncWorkItems>0)&&this.ready&&!this.suspended||this.overlayManager?.updating||this.terrainTextureCompressionTracker.compressing)}get readyToRun(){return this.enabled&&(this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||!this._allTilesSorted||this._layerViewsDirty||this._scaleRangeQueries?.updating||this._frameTask.updating)&&this.ready&&!this.suspended}get updatingProgressValue(){return this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating),1-this._pendingUpdates/this._maxNumUpdating}get baseOpacity(){return this.view?.map?.ground?.opacity??1}set baseOpacity(e){this.view.map.ground.opacity=e}get viewingMode(){return this.view.state.viewingMode}get ready(){return!this.enabled||this._rootTiles!=null}get rootTiles(){return this._rootTiles}get spatialReference(){return this.tilingScheme?.spatialReference??null}get backgroundColor(){return this.view?.map?.ground?.surfaceColor}set backgroundColor(e){this.view.map.ground.surfaceColor=e}set slicePlaneEnabled(e){this._renderer.slicePlaneEnabled=e,this._set("slicePlaneEnabled",e),this._evaluateTransparency()}get tilingSchemeLocked(){return this.tilingSchemeLogic?.tilingSchemeLocked??!1}get wireframe(){return this._renderer?.wireframe}set wireframe(e){e!==this._renderer.wireframe&&(this._renderer.wireframe=e,this._updateAllTileGeometries())}get opaque(){return this._renderer.transparency===0}get invisible(){return this._renderer.transparency===3}set suspended(e){this._set("suspended",e),this._viewChangeUpdate()}get fadeDuration(){return this.view.qualitySettings.fadeDuration??0}intersect(e,i,r,s){this._renderer.intersect(e,i,r,s)}getElevationLevelDelta(e){return e<4?3:this.view.qualitySettings.tiledSurface.elevationLevelDelta}get _xNormalizer(){return i8(this._spatialReference)}getElevation(e,i,r,s){const n=this._rootTiles;if(!n?.length||!this.enabled||n[0].layerInfo[0].length===0)return null;let a=this._elevationProjectorCache.get(s);if(a===void 0&&(a=jx(s,this._spatialReference)??null,this._elevationProjectorCache.set(s,a)),a==null)return fe.getLogger(this).error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;const o=ve(CA,e,i,r);return a(o,0,o,0),u_e(n,this._xNormalizer?.normalize(o[0])??o[0],o[1])}getElevations(e,i,r){const s=this._rootTiles,n=s?s[0].layerInfo[0].length:0;if(s?.length&&n!==0&&this.enabled)for(let a=0;a<i;++a){const o=3*a;r(a,u_e(s,e[o],e[o+1]))}else for(let a=0;a<i;++a)r(a,null)}getLayerIndexByUID(e,i){return this._layerIndexByUid[e].get(i)}getScale(e){if(!this.tilingScheme)return null;if(!Yl(e,CA,this.spatialReference))return fe.getLogger(this).error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;const i=this._rootTiles;if(i!=null){for(const r of i)if(r?.containsPoint(CA)){let s=r;for(;s.children[0]&&!s.rendered;){const n=s.children[0].extent;let a=0;CA[0]>n[2]&&(a+=1),CA[1]<n[1]&&(a+=2),s=s.children[a]}return this._getLodBiasCorrectedScale(s.level)}}return 1/0}_ensureProjector(e){const i=this._projectorCache.get(e);if(i)return i;const r=jx(e,this._tilingSchemeSpatialReference)??null;return this._projectorCache.set(e,r),r}getSphereElevationBounds(e,i){if(!this.enabled||this._rootTiles==null)return null;const r=this._ensureProjector(i);if(r==null)return fe.getLogger(this).error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;Mv(e,XS);const s=gy(XS,R());r(s,0,s,0),_M(XS,s);const n=new mV,a=this._rootTiles;if(a!=null){const o=[];for(const c of a)o.push(c);let l=0;for(;l<o.length;){const c=o[l];if(++l,!que(c.extent,XS))continue;const h=c.children;if(h[0]==null||c.rendered)n.expandElevationRangeValues(c.elevationBoundsMin,c.elevationBoundsMax);else for(const f of h)o.push(f)}}return n}getRootElevationBounds(){return this.enabled&&this._rootTiles!=null?new mV(this.rootTileElevationBounds.min,this.rootTileElevationBounds.max):null}getLowerBoundRadius(){const e=(this._ellipsoid.radius+this.visibleElevationBounds.min)*Wxe;return Math.min(e,this._ellipsoid.radius)}getSphereScale(e,i){if(!this.tilingScheme)return null;if(!Yl(e,d_e,this.spatialReference))return fe.getLogger(this).error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;yM(XS,d_e,i);let r=null;const s=a=>{if(a&&que(a.extent,XS)){const o=a.children;if(o[0]&&!a.rendered)for(const l of o)s(l);else{const l=this._getLodBiasCorrectedScale(a.level);r=r==null?l:Math.min(r,l)}}},n=this._rootTiles;if(n!=null)for(const a of n)s(a);return r}queryVisibleScaleRange(e,i,r,s){if(!this._scaleRangeQueries)return;const n=i?this.tilingScheme.levelAtScale(i):0,a=r?this.tilingScheme.levelAtScale(r):1/0,o=this._lodBias;this._scaleRangeQueries.queryVisibleLevelRange(e,n+o,a+o,s)}_evaluateTransparency(){const e=this.baseOpacity,i=this.overlayManager.renderer.isEmpty,r=this._renderer.transparency,s=this._isFullyTransparent?i?3:2:e>=1&&!this.hasCompositeBlendMode&&!this._renderer.slicePlaneEnabled?0:1;return this._renderer.transparency=s,r!==s}_updateTilingScheme(){const{tilingScheme:e}=this.tilingSchemeLogic;if(e===this.tilingScheme)return;pa(!!e,"tiling scheme cannot be reset to undefined"),this._isGlobal=!this.view?.state?.isLocal,this.tilingScheme&&this._removeAllTiles();const i=e?.spatialReference??Ie.WebMercator;this._spatialReference=i,this._isWebMercator=!!i?.isWebMercator,this._isWebMercatorOnPlateCarree=this._isWebMercator&&DR(this.view?.renderSpatialReference),this._isGeographic=i?.isGeographic??!1,this._set("tilingScheme",e),this._tilingSchemeSpatialReference=this.tilingScheme?.spatialReference,this._projectorCache.clear(),this._updateClippingExtent(),e&&(this._updateTiledLayers(),this._renderer.tileSize=e.pixelSize,this.overlayManager.spatialReference=e.spatialReference,this._updateRootTiles())}_acquireTile(e,i,r,s){const n=this._tileCache.pop(zF._tileMemcacheKey);return n?(n.init(e,i,r,s,this),n):new this._tileConstructor(e,i,r,s,this)}get updatingRootTiles(){return this._updatingRootTiles}_updateRootTiles(){const{extent:e,tilingScheme:i}=this;if(!i)return;const r=$Ct;let s=i.rootTilesInExtent(e,r,5*v3);if(this._rootTiles!=null){if(s.length>v3)return void fe.getLogger(this).warn(elt);const n=this._rootTiles.map(o=>o.lij),a=$N(n,s,IF);if(this._updatingRootTiles=!0,a.removed.length>0||a.added.length>0){const o=this._rootTiles.filter(l=>!(a.removed.findIndex(c=>IF(c,l.lij))>-1)||(this._purgeTile(l),!1));a.added.forEach(l=>o.push(this._newRootTile(l))),this._setRootTiles(o)}}else this._updatingRootTiles=!0,s.length>v3&&(fe.getLogger(this).warn(tlt),s=i.rootTilesInExtent(e,r,v3)),this._setRootTiles(s.map(n=>this._newRootTile(n)));vw(r,this._rootTilesExtent)||(this._rootTilesExtent=Pi(r)),this.renderer.visible=!0,this._viewChangeUpdate(),this.overlayManager.setPlacementDirty(),this.notifyChange("ready"),this._updateAllTileGeometries(),this._updatingRootTiles=!1,this.checkAllTilesWaterproofness()}_updateAllTileGeometries(){const e=this._allTiles.filter(i=>i.loaded&&i.intersectsClippingArea);e.sort(Vf),e.forEach(i=>this._renderer.updateTileGeometryState(i)),e.forEach(i=>i.renderData.updateNeighborData()),this._updateTilesGeometries(e),this._pendingTilesToUpdate.clear()}_updateTilesGeometries(e){if(e.length===0)return;e.sort(Vf);const i=this.renderer;e.forEach(r=>i.updateGeometryIfNeeded(r)),e.forEach(r=>this._pendingTilesForElevationUpdateEvent.add(r))}_shouldSplit(e){return e.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.snapLevel)===1}_newRootTile(e){const i=this._acquireTile(0,e[1],e[2],null);return this._shouldSplit(i)&&i.setPendingUpdate(1),this._loadTile(i),this._markTileToUpdate(i),this._updateRootTileElevationBounds(),i}_setRootTiles(e){if(this._rootTiles=e,this._allTiles.clear(),e!=null){const i=this._iteratorPool.acquire();for(i.reset(e);!i.done;)this._allTiles.push(i.next());i.remove()}this._renderer.setRootTiles(this._rootTiles),this._updateTilesVisibility(e),this.notifyChange("demResolution"),this.emit("tiles-changed",{allTiles:this.allTiles})}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this.renderer.visible&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this._rootTiles)))}_updateClippingStatus(e){e.updateClippingStatus(this.extent)&&e.resetPendingUpdate(8)&&this._updateTileGeometryState(e)}_updateTilesVisibility(e){if(e==null)return;const i=CTt(e),r=this.visibleElevationBounds;let s=i?r.min:1/0,n=i?r.max:-1/0;const a=this.extent,o=this.view.state.contentCamera.viewProjectionMatrix;this.setTileTreeDirty();const l=this._iteratorPool.acquire();for(l.reset(e);!l.done;){const c=l.next();c.updateClippingStatus(a)&&c.resetPendingUpdate(8)&&this._updateTileGeometryState(c),c.computeVisibility(),c.updateScreenDepth(o),c.renderData&&(s=Math.min(c.elevationBoundsMin,s),n=Math.max(c.elevationBoundsMax,n))}l.remove(),this._viewChanged=!0,this._allTilesDirty=!0,this._updatePendingTileGeometries(),isFinite(s)&&isFinite(n)&&(r.min!==s||r.max!==n)&&(this.visibleElevationBounds=new I3(s,n))}_updateRootTileElevationBounds(){let e=1/0,i=-1/0;const r=this._rootTiles;r?.forEach(({elevationBoundsMin:n,elevationBoundsMax:a})=>{e=Math.min(e,n),i=Math.max(i,a)});const s=this.rootTileElevationBounds;s.min===e&&s.max===i||(this.rootTileElevationBounds=new I3(e,i))}_updateViewDependentParameters(){const{camera:e,contentCamera:i}=this.view.state,r=Math.tan(.5*i.fovX),s=Math.tan(.5*i.fovY),n=this.tilingScheme.pixelSize,a=2**-this._lodBias*e.pixelRatio;this._splitLimits.aboveGround=e.aboveGround,this._splitLimits.fovX=r,this._splitLimits.fovY=s,this._splitLimits.relativeWidthLimit=n/e.width*this.maxTextureScale*a,this._splitLimits.relativeHeightLimit=n/e.height*this.maxTextureScale*a,this._splitLimits.maxLod=this.tilingScheme.getMaxLod(),this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias,this.view.state.fixedContentCamera?this._splitLimits.frustum=vEe(this._splitLimits.frustum??jte(),i.frustum):this._splitLimits.frustum=null,de(this._eyePosRenderSR,i.eye),ja(e.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateTileGeometryState(e){e.updateVisibility(),this._renderer.updateTileGeometryState(e)&&this._markTileToUpdate(e),this.setMemoryDirty()}_markAllTileNeighborsForUpdate(e){e.forEachLoadedNeighbor(i=>{this._layerViews[1].some(YC)&&i.setPendingUpdate(32),this._pendingTilesToUpdate.add(i)})}_updateTileTexture(e,i){const r=e.resetPendingUpdate(32)?32:!!e.resetPendingUpdate(16)&&16;r&&(this._renderer.updateTileTexture(e,r),this._usedMemory=null,i.madeProgress())}_emitElevationUpdateEventForTiles(){if(!this._shouldEmitChangeEvent)return;const e=HG.extent;cy(e),this._pendingTilesForElevationUpdateEvent.forEach(i=>H3(e,i.extent,e)),this._pendingTilesForElevationUpdateEvent.clear(),HG.spatialReference=this.spatialReference,this.emit("elevation-change",HG),this._shouldEmitChangeEvent=!1}runTask(e){this._handleLayerViewChanges(e),this._frameTask.processQueue(e),this.renderer.processScaleRangeQueries(this._scaleRangeQueries,e),this._inFrameTask=!0,this._pendingUpdates=0,this._hasPendingUpdates=!1,this._updateAllTilesStatus(e),this._sortTiles(e);const i=!this.view.state.fixedContentCamera;if(this._mergeAndSplit(e,i),this._updateElevation(e),this._updateTextures(e),i||this._mergeAndSplit(e,!0),this._inFrameTask=!1,this._runViewChangeUpdateIfDirty(),this._updatePendingTileGeometries(),this._emitElevationUpdateEventForTiles(),e.done&&e.hasProgressed&&this.requestUpdate(),this.notifyChange("updatingProgressValue"),Yn&&this._checkTileInvariant(),!e.hasProgressed)return ea}_checkTileInvariant(){const e=new Map;this._allTiles.forAll(i=>e.set(i,new Set)),this._allTiles.forAll(i=>{if(pa(i.rendered===i.leaf,` rendered ${i.rendered} != ${i.leaf} leaf`),!i.leaf){const r=n=>n.unmergableChildCount===0&&n.maxLevelDeltaNeighborCount===0,s=i.children.reduce((n,a)=>n+(r(a)?0:1),0);if(pa(i.unmergableChildCount===s,` Tile[${i.lij.toString()}] unmergeable child count mismatch: actual ${i.unmergableChildCount} vs ${s}`),i.hasPendingUpdate(4)){pa(!i.hasPendingUpdate(1),"Tile can be both split and merge at the same time");for(const n of i.children)pa(n.leaf||n.hasPendingUpdate(4),"Child of tile to merge must also merge")}}for(let r=0;r<4;++r){if(i.rendered){const o=i.renderData?.geometryState.edgePeerNeighbors[r];if(o!=null){{const l=i.level-o.level<=Tn;l||(console.log(`tile level delta [${i.lij.toString()}] vs [${o.lij.toString()}] > ${Tn}  (edge[${r}])`),pa(l,`tile level delta [${i.level}] vs [${o.level}] > ${Tn}`))}pa(i.level-o.level<=Tn,`Max tile lod delta exceeded: [${i.lij.toString()}] vs [${o.lij.toString()}]`)}}const s=i.level-Tn,n=o=>o.leaf||o.level===i.level,a=i.findNeighborTile(cp[r],n);if(a!=null){if(i.leaf&&i.level>=Tn){let o=a;for(;i.level-o.level<Tn;)o=o.parent;const l=[s,i.lij[1]>>Tn,i.lij[2]>>Tn];if(!IF(l,o.lij)){const c=e.get(o);pa(!c.has(i),"Cannot already have neighbor"),c.add(i)}}pa(a.rendered||a.level===i.level,"Non-same-level-neighbor of rendered must be rendered"),pa(i.level-a.level<=Tn,`Tile level delta [${i.level}] vs [${a.level}] > ${Tn}`)}}}),this._allTiles.forAll(i=>{const r=i.maxLevelDeltaNeighborCount,s=e.get(i);pa(r===s.size,`Tile[${i.lij.toString()}] merge-blocker mismatch: actual ${r} vs ${s.size}`)})}_updateAllTilesStatus(e){if(!this._viewChanged||!this._rootTiles||e.done)return;this._viewChanged=!1;const i=new m3t(this._allTiles.length);i.pushAll(this._rootTiles);const r=this.snapLevel,s=this._splitLimits,n=this._eyePosRenderSR;this._allTiles.forAll(o=>{o.maxLevelDeltaNeighborCount=0,o.unmergableChildCount=0});const a=this.view.state.contentCamera.viewProjectionMatrix;for(;!i.empty;){const o=i.pop(),l=o.parent,c=l?.hasPendingUpdate(4),h=c?4:o.shouldSplit(s,n,r),f=h===1;o.leaf?WG(o,f):i.pushAll(o.children),c?(o.resetPendingUpdate(1),o.leaf||o.setPendingUpdate(4),this._updateClippingStatus(o),o.updateVisibility(),o.updateScreenDepth(a)):f?(o.resetPendingUpdate(4),o.leaf&&o.setPendingUpdate(1)):(o.resetPendingUpdate(1)&&o.updateAgentSuspension(),h===2&&o.updateAgents(0),o.leaf||(o.setPendingUpdate(4),o.resetPendingUpdate(1)))}this.requestUpdate(),(this._shortBatches||!this._oneBatchPerFrameTask)&&this._updatePendingTileGeometries(),e.madeProgress()}_sortTiles(e){e.done||this._allTilesSorted||!this.view.pointsOfInterest?.focus||(TTt(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger?.update(),e.madeProgress())}_markTileToUpdate(e){Be(e.loaded),e.intersectsClippingArea&&(this._pendingTilesToUpdate.add(e),this._markAllTileNeighborsForUpdate(e))}_updatePendingTileGeometries(){const e=this._pendingTilesToUpdate,i=Array.from(e.keys()).filter(n=>n.loaded&&n.intersectsClippingArea);if(i.length===0)return void e.clear();const r=(n,a)=>{!a?.loaded||!a.intersectsClippingArea||a.level<n.level||e.has(a)||(e.add(a),i.push(a),a.renderData.updateNeighborData())};i.sort(Vf);const s=i.length;for(let n=0;n<s;++n){const a=i[n];Be(a.loaded),Be(a.intersectsClippingArea);const o=a.renderData;o.updateNeighborData();const l=o.dirtyEdgeResolutions,c=o.geometryState,h=f=>{const y=bV[f];r(a,c.cornerPeerNeighbors[f]?.findCorner(vV(y),_=>_.loaded))};for(let f=0;f<4;++f)if(l&1<<f){const y=o.geometryState.edgePeerNeighbors[f];y&&y?.level>=a.level&&y.forAllSubtreeOnSide(Hre(cp[f]),_=>!(!_.loaded||!_.intersectsClippingArea)&&(Be(e.has(_)||Vf(a,_)<0),r(a,_),!0)),h((f+1)%4),h(f)}}e.clear(),this._updateTilesGeometries(i),this._shouldEmitChangeEvent=!0,Yn&&yV&&this.checkAllTilesWaterproofness()}_mergeAndSplit(e,i){if(this.suspended||e.done||!this._allTilesDirty)return;this._allTilesDirty=!1,this.requestUpdate();let r=!1;const s=this.view.state.fixedContentCamera;let n=!1;for(;!e.done;){n=!0;let a=!1;const o=!this._allTiles.some(l=>{if(!r&&!s&&!l.visible)return e.done;let c=l;if(l.hasPendingUpdate(4)){if(!i||l.unmergableChildCount>0)return e.done;for(l.resetPendingUpdate(4);c.parent!=null&&c.parent.unmergableChildCount===0&&c.parent.resetPendingUpdate(4);)c=c.parent;this._mergeTile(c),a=!0,e.madeProgress()}else if(l.resetPendingUpdate(1)){let h=!0;const f=l.level;if(f>=Tn){const y=_=>_.leaf||f-_.level<Tn;for(let _=0;_<4;++_){const w=l.findNeighborTile(cp[_],y);w!=null&&f-w.level===Tn&&(h=!1,Yn&&(Be(w.leaf),Be(w.hasPendingUpdate(1))))}}h?(this._splitTile(l),e.madeProgress(),a=!0):l.setPendingUpdate(1)}return e.done});if(a&&(this._allTilesSorted=!1,this._allTilesDirty=!0,!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries()),o){if(!r){r=!0;continue}if(!a)break}else this._allTilesDirty=!0}n?e.madeProgress():this._allTilesDirty=!0,!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries(),this._sortTiles(e)}_updateElevation(e){e.done||(this._allTiles.some(i=>(i.resetPendingUpdate(8)&&(this._updateTileGeometryState(i),this._shortBatches&&this._updatePendingTileGeometries(),e.madeProgress()),e.done)),!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries())}_updateTextures(e){e.done||this._allTiles.some(i=>(this._updateTileTexture(i,e),e.done))}_updateClippingExtent(){this.spatialReference&&(this.updateOverlayParameters(),this.requestRender(1),this.overlayManager.setPlacementDirty(),this._updateRootTiles())}get _lodBias(){const e=this.view.quality;return this.view.qualitySettings.tiledSurface.lodBias-(1-e)*Jot}_getLodBiasCorrectedScale(e){const i=this.tilingScheme.levels,r=Se(e-this._lodBias,0,i.length-1),s=r-Math.floor(r);return i[Math.floor(r)].scale*(1-s)+i[Math.ceil(r)].scale*s}_removeAllTiles(){this._rootTiles!=null&&(this._rootTiles.forEach(e=>this._purgeTile(e)),this._setRootTiles(null),this.notifyChange("ready")),this._allTiles.clear(),this.notifyChange("demResolution"),this.emit("tiles-changed",{allTiles:this.allTiles}),this.renderer.visible=!1}_purgeSubtree(e){const i=e.children;i[0]&&(this._purgeTile(i[0]),this._purgeTile(i[1]),this._purgeTile(i[2]),this._purgeTile(i[3]),e.clearChildren())}_purgeTile(e){e.leaf?h_e(e):this._purgeSubtree(e),this._allTiles.removeUnordered(e),this._unloadTile(e),e.dispose(),this._tileCache.put(zF._tileMemcacheKey,e),this.notifyChange("demResolution"),this.emit("tiles-changed",{allTiles:this.allTiles})}_unloadTile(e){this._pendingTilesToUpdate.delete(e),this._pendingTilesForElevationUpdateEvent.delete(e),e.unload()}_splitTile(e){pa(e.leaf,"Tile that is already split should not be split again!"),pa(e.rendered,"Tile marked to split is not rendered"),h_e(e);const i=e.createChildren();this._allTiles.pushArray(i),this.notifyChange("demResolution"),this.emit("tiles-changed",{allTiles:this.allTiles}),e.updateAgentSuspension(),pa(e.rendered,"parent should be rendered"),i.forEach(r=>this._loadTile(r)),i.forEach(r=>this._pendingTilesToUpdate.add(r)),this._unloadTile(e),this._markAllTileNeighborsForUpdate(e),this._emitTileScaleChange(e,e.level+1),this._allTilesDirty=!0,this._shortBatches&&this._updatePendingTileGeometries(),i.forEach(r=>WG(r,r.hasPendingUpdate(1))),++this._performanceInfo.numSplit}_emitTileScaleChange(e,i=e.level){ok.spatialReference=this.spatialReference,ok.extent=e.extent,ok.scale=this._getLodBiasCorrectedScale(i),this.emit("scale-change",ok)}createTile(e,i,r,s){pa(!!s,"createTile sanity check");const n=this._acquireTile(e,i,r,s);return n.updateClippingStatus(this.extent),n.updateScreenDepth(this.view.state.contentCamera.viewProjectionMatrix),this._shouldSplit(n)&&n.setPendingUpdate(1),n}get _shortBatches(){return this.view.state.mode!==2}_mergeTile(e){pa(!e.hasPendingUpdate(1),"_mergeTile sanity check"),pa(!e.leaf,"Cannot merge a leaf"),e.leaf||(this._purgeSubtree(e),pa(!e.renderData,"Merging tile with existing render data?"),this._loadTile(e),this._markTileToUpdate(e),this._emitTileScaleChange(e),this._shortBatches&&this._updatePendingTileGeometries(),WG(e,!1),this._allTilesDirty=!0,++this._performanceInfo.numMerged)}_loadTile(e){e.load(),this.requestUpdate(),this._allTilesDirty=!0,this.overlayManager?.hasOverlays&&e.updateOverlayParameters(this.overlayManager)}_handleLayerViewChanges(e=sl){if(!this._layerViewsDirty)return;this._layerViewsDirty=!1;let i=!1;const r=new Set;let s=-1;for(let n=this.view.allLayerViews.length-1;n>=0;n--){const a=this.view.allLayerViews.items[n];if(r.add(a.uid),DX(a)||wA(a))if(this._basemapLayerViewHandles.has(a.uid)&&!wA(a)){const o=this._layerClassFromLayerView(a),l=this.getLayerIndexByUID(o,a.uid);l!=null&&((l<s||s==null)&&(i=!0),s=l)}else this._registerTiledLayerView(a),a.layer.loaded&&(i=!0)}this._basemapLayerViewHandles.forEach((n,a)=>{r.has(a)||(this._unregisterTiledLayerView(a),i=!0)}),i&&this._updateTiledLayers(),this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._evaluateTransparency(),e.madeProgress()}get _isFullyTransparent(){if(this.view.map?.ground?.opacity>0)return!1;for(const e of this.view.allLayerViews.items)if(RX(e)&&!fz(e.layer)&&e.fullOpacity!==0)return!1;return!0}_hasCompositeBlendMode(){for(const e of this.view.allLayerViews.items)if((SD(e)||wA(e))&&I$t(qX[e.layer.blendMode]))return!0;return!1}_layerClassFromLayerView(e){return PX(e)?0:1}_registerTiledLayerView(e){const i=[];if((SD(e)||wA(e))&&i.push(K(()=>e.layer.blendMode,()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._updateTileTextures(2)})),!wA(e)){const r=this._layerClassFromLayerView(e);i.push(K(()=>!e.destroyed&&e.suspended,()=>this._updateTiledLayers())),i.push(K(()=>!e.destroyed&&e.fullOpacity,()=>this._updateTileTextures(2)));const{layer:s}=e;"effectiveScaleRange"in s&&i.push(K(()=>!e.destroyed&&s.effectiveScaleRange,()=>this._restartAllAgents(r))),i.push(e.on("data-changed",()=>{const n=this.getLayerIndexByUID(r,e.uid);n!=null&&this._invalidateLayerData(n,r)}))}this._unregisterTiledLayerView(e.uid),this._basemapLayerViewHandles.set(e.uid,i)}_unregisterTiledLayerView(e){const i=this._basemapLayerViewHandles.get(e);if(i){for(const r of i)r.remove();this._basemapLayerViewHandles.delete(e)}}_updateTiledLayers(){if(!this.tilingScheme||this.view.suspended)return;const e=this.view.allLayerViews,i=[[],[]];let r=null;e.forEach(s=>{if(!s.layer||s.suspended||!DX(s)||!s.fullExtent)return;const n=this._layerClassFromLayerView(s);if(n===1){const a=s.displayLevelRange.maxLevel;a!==1/0&&(r===null||a>r)&&(r=a)}i[n].push(s)});for(const s of zT){const n=this._layerViews[s],a=i[s];a.reverse();const o=a.length;let l=n.length!==o;const c=new Array(o),h=new Array(n.length);this._layerIndexByUid[s].clear();for(let f=0;f<o;f++){const y=a[f].uid;this._layerIndexByUid[s].set(y,f);const _=n.indexOf(a[f]);c[f]=_,f!==_&&(l=!0),_>-1&&(h[_]=f)}if(l){const f=this._postorderIterator;for(f.reset(this._rootTiles);!f.done;)f.next().modifyLayers(h,c,s);this._layerViews[s]=a,this._restartAllAgents(s),this._updateTilesVisibility(this._rootTiles)}}this.tilingScheme.ensureMaxLod(r)&&(this._viewChangeUpdate(),this.notifyChange("tilingScheme"))}_restartAllAgents(e){const i=this._postorderIterator;for(i.reset(this._rootTiles);!i.done;){const r=i.next();r.restartAgents(e),e===0&&r.computeElevationBounds()}this._updateRootTileElevationBounds()}layerViewByIndex(e,i){return this._layerViews[i][e]}numLayers(e){return this._layerViews[e].length}_updateTileTextures(e){this._allTiles.forAll(i=>{i.updateAgents(1),e===1?this.renderer.updateTileTexture(i,16):i.updateRenderData(1,e)}),this._evaluateTransparency()}_invalidateLayerData(e,i){this._allTiles.forAll(r=>r.removeLayerAgent(e,i)),this._allTiles.forAll(r=>r.invalidateLayerData(e,i))}setTileTreeDirty(){this._allTilesDirty=!0}requestRender(e=1){this.renderer.setNeedsRender(e)}requestUpdate(){++this._pendingUpdates===1&&(this._hasPendingUpdates=!0)}requestTileData(e,i,r,s){const n=this.layerViewByIndex(i,r),a=n.layer;return!a.tilemapCache||YC(n)?this._requestTileData(e,r,n,s):(++this._asyncWorkItems,a.tilemapCache.fetchAvailability(e.level,e.lij[1],e.lij[2],{...s,timeout:6e3}).then(()=>--this._asyncWorkItems).catch(o=>{throw--this._asyncWorkItems,st(s),Hr(o)||this._dataMissing(e,r,n),o}).then(()=>this._frameTask.schedule(()=>this._requestTileData(e,r,n,s),s.signal)))}_requestTileData(e,i,r,s){if(this.destroying)return Promise.resolve();const n=i===0;return s.requester??=n?this._elevationDataRequester:this._mapDataRequester,n?PX(r)?this._requestElevationTileData(e,r,s):Promise.reject():RX(r)?this._requestMapTileData(e,r,s):Promise.reject()}_requestElevationTileData(e,i,r){++this._asyncWorkItems;const s=a=>{!Rn(r)&&a&&(this.setMemoryDirty(),this.requestUpdate(),this._elevationDataArrived(e,i,a))},n=a=>{Hr(a)||(fe.getLogger(this).error(`Tile ${e.lij.toString()} layer 0/${i.uid} error ${a}`),this._dataMissing(e,0,i),this.requestUpdate())};return i.fetchElevationTile(e,r).then(a=>this._frameTask.schedule(()=>s(a)),n).finally(()=>--this._asyncWorkItems)}_elevationDataArrived(e,i,r){const s=this._layerIndexByUid[0].get(i.uid);if(s==null)return void fe.getLogger(this).warn("TerrainSurface: received data from unknown layer %d %s",0,e.lij.toString());const n=new i2t(e.lij,e.extent,r);e.dataArrived(s,0,n),this.emit("tile-data-changed",{tile:e,layerIndex:s,layerClass:0});const a=[e],o=e.level,l=this._iteratorPool.acquire();for(l.reset(a);!l.done;){const c=l.next();c.findElevationBoundsForLayer(s,o),c.computeElevationBounds()}o===0&&this._updateRootTileElevationBounds(),l.remove(),this._updateTilesVisibility(a)}_requestMapTileData(e,i,r){++this._asyncWorkItems;const s=(l,c)=>{v$(c),Rn(r)||(console.error(`Tile ${e.lij.toString()} layer 1/${i.uid} error ${l}`),this._dataMissing(e,1,i),this.requestUpdate())},n=l=>c=>s(c,l),a=l=>this._frameTask.schedule(()=>{this.requestUpdate(),Rn(r)?v$(l):this._mapTileDataArrived(e,i,l)},r.signal,n(l)).catch(n(l)),o=(l,c=null)=>this._frameTask.schedule(()=>s(l,c));return i.fetchTile(e.lij,r).then(a,o).finally(()=>--this._asyncWorkItems)}_mapTileDataArrived(e,i,r){const s=this.getLayerIndexByUID(1,i.uid);if(s==null)return v$(r),void fe.getLogger(this).warn("TerrainSurface: received data from unknown layer");e.dataArrived(s,1,r),this.emit("tile-data-changed",{tile:e,layerIndex:s,layerClass:1})}_dataMissing(e,i,r){const s=this.getLayerIndexByUID(i,r.uid);s!=null?(e.dataMissing(s,i),this.emit("tile-data-changed",{tile:e,layerIndex:s,layerClass:i})):fe.getLogger(this).warn("TerrainSurface: received data from unknown layer")}get performanceInfo(){const e=this._performanceInfo;return e.numNodes=this._allTiles.length,e.numLeaves=e.numVisible=e.numRendered=e.numLoadedPerLevel.length=e.numRenderedPerLevel.length=0,this._allTiles.forAll(i=>{i.leaf&&e.numLeaves++;const r=i.level;i.renderData&&(e.numLoadedPerLevel[r]=(e.numLoadedPerLevel[r]||0)+1),i.visible&&(e.numVisible++,i.rendered&&(e.numRenderedPerLevel[r]=(e.numRenderedPerLevel[r]||0)+1,e.numRendered++))}),e}setMemoryDirty(){this._usedMemory=null}get usedMemory(){return this.tilingScheme?(this._usedMemory==null&&(this._usedMemory=this._recalculateUsedMemory()),this._usedMemory??0):0}_recalculateUsedMemory(){return this.tilingScheme?Math.round(this._allTiles.reduce((e,i)=>e+i.usedMemory,0)):null}getUsedMemoryForLayerView(e){let i=0;const r=this._layerClassFromLayerView(e),s=this.getLayerIndexByUID(r,e.uid);return s!=null&&this._allTiles.forAll(n=>i+=n.getUsedMemoryForLayer(r,s)),i}get renderPatchBorders(){return this._renderer.renderPatchBorders}set renderPatchBorders(e){this._renderer.renderPatchBorders=e}get visualizeNormals(){return this._renderer.visualizeNormals}set visualizeNormals(e){this._renderer.visualizeNormals=e}get renderingDisabled(){return this._renderer.renderingDisabled}set renderingDisabled(e){this._renderer.renderingDisabled=e}get test(){}checkAllTilesWaterproofness(){if(!yV)return;const e=this._rootTiles;if(e==null)return;const i=a=>a?.renderData?.geometry?.indices?.length>0,r=(a,o)=>{i(a)&&console.error("Tile[",a.lij,"] has geometry although parent[",o.lij,"] has geom")},s=a=>{if(a.intersectsClippingArea)if(a.renderData&&!a.renderData.geometryState&&console.error("Tile[",a.lij,"] has renderData but not geometryState"),a.renderData&&!a.renderData.geometry&&console.error("Tile[",a.lij,"] has renderData but not geometryInfo"),!a.renderData?.geometry||(a.renderData.geometry.indices?.length??0)>0||console.error("Tile[",a.lij,"] has renderData but no indices - geometryInfo: ",a.renderData.geometry),i(a)){a.checkGeometryWaterproofness();for(const o of a.children)r(o,a)}else if(a.leaf)console.error("Tile[",a.lij,"] has no geometry and no children, from root to leaf");else for(const o of a.children)s(o)},n=a=>{const o=a.parent?.visible??!0,l=a.visible;a.computeVisibility();const c=a.visible;if(l!==c&&o&&console.error(" Tile[",a.lij,"] has out of date visibility: ",l," instead of ",c),!a.leaf)for(const h of a.children)n(h)};for(const a of e)s(a),n(a)}get isGlobal(){return this._isGlobal}get isGeographic(){return this._isGeographic}get isWebMercator(){return this._isWebMercator}get isWebMercatorOnPlateCarree(){return this._isWebMercatorOnPlateCarree}isEastEndWrap(e){return this._isGlobal&&e[2]===this.lijEastEnd(e[0])-1}isWestEndWrap(e){return this._isGlobal&&e[2]===0}lijEastEnd(e){return 1<<e+(this._isGeographic?1:0)}wrapEastWest(e){const i=this.lijEastEnd(e[0]),r=e[2];if(0<=r&&r<i)return e;if(!this._isGlobal)return null;const s=(r+(r<0?i:0))%i;return[e[0],e[1],s]}enableInternalChecks(e){h2t(e)}enableWaterproofnessChecks(e){u2t(e)}static cleanupTerrainSurface(){CCt.prune()}enable(e){e!==this.enabled&&(e?(this._updateRootTiles(),this.suspended=!1):(this.suspended=!0,this._removeAllTiles(),this._setRootTiles(null)),this._set("enabled",e),this.notifyChange("ready"))}updateOverlayParameters(){const{overlayManager:e}=this;this.allTiles.forAll(i=>i.updateOverlayParameters(e))}},zF=Ex,Ex._tileMemcacheKey="TerrainTileMemcache",Ex);d([m()],Gt.prototype,"_renderer",void 0),d([m({constructOnly:!0})],Gt.prototype,"_scaleRangeQueries",void 0),d([m({constructOnly:!0})],Gt.prototype,"view",void 0),d([m({constructOnly:!0})],Gt.prototype,"overlayManager",void 0),d([m({constructOnly:!0})],Gt.prototype,"terrainTextureCompressionTracker",void 0),d([m()],Gt.prototype,"_hasPendingUpdates",void 0),d([m()],Gt.prototype,"_asyncWorkItems",void 0),d([m()],Gt.prototype,"_allTilesDirty",void 0),d([m()],Gt.prototype,"_allTilesSorted",void 0),d([m()],Gt.prototype,"_viewChanged",void 0),d([m({type:Number})],Gt.prototype,"heading",void 0),d([m()],Gt.prototype,"_splitLimits",void 0),d([m({readOnly:!0})],Gt.prototype,"_watchUpdatingTracking",void 0),d([m()],Gt.prototype,"_frameTask",void 0),d([m()],Gt.prototype,"demResolution",null),d([m({readOnly:!0})],Gt.prototype,"snapLevel",null),d([m({readOnly:!0})],Gt.prototype,"lodSnappingEnabled",null),d([m()],Gt.prototype,"_userClippingExtent",null),d([m()],Gt.prototype,"_rootTilesExtent",void 0),d([m({readOnly:!0})],Gt.prototype,"extent",null),d([m({readOnly:!0})],Gt.prototype,"groundExtent",null),d([m({readOnly:!0})],Gt.prototype,"_tilingSchemeExtent",null),d([m({readOnly:!0})],Gt.prototype,"updating",null),d([m({readOnly:!0})],Gt.prototype,"readyToRun",null),d([m(t2t)],Gt.prototype,"updatingProgress",void 0),d([m({readOnly:!0})],Gt.prototype,"updatingProgressValue",null),d([m()],Gt.prototype,"_maxNumUpdating",void 0),d([m()],Gt.prototype,"baseOpacity",null),d([m()],Gt.prototype,"hasCompositeBlendMode",void 0),d([m({readOnly:!0})],Gt.prototype,"viewingMode",null),d([m()],Gt.prototype,"maxTextureScale",void 0),d([m({readOnly:!0})],Gt.prototype,"ready",null),d([m({readOnly:!0})],Gt.prototype,"rootTiles",null),d([m()],Gt.prototype,"_rootTiles",void 0),d([m({readOnly:!0})],Gt.prototype,"spatialReference",null),d([m({type:mt})],Gt.prototype,"backgroundColor",null),d([m({value:!1})],Gt.prototype,"slicePlaneEnabled",null),d([m({readOnly:!0})],Gt.prototype,"tilingScheme",void 0),d([m({readOnly:!0})],Gt.prototype,"tilingSchemeLocked",null),d([m({readOnly:!0})],Gt.prototype,"tilingSchemeLogic",void 0),d([m()],Gt.prototype,"wireframe",null),d([m({value:!1})],Gt.prototype,"suspended",null),d([m()],Gt.prototype,"fadeDuration",null),d([m()],Gt.prototype,"_xNormalizer",null),d([m()],Gt.prototype,"visibleElevationBounds",void 0),d([m()],Gt.prototype,"rootTileElevationBounds",void 0),d([m()],Gt.prototype,"_layerViewsDirty",void 0),d([m()],Gt.prototype,"renderPatchBorders",null),d([m()],Gt.prototype,"visualizeNormals",null),d([m()],Gt.prototype,"renderingDisabled",null),d([m({readOnly:!0})],Gt.prototype,"enabled",void 0),Gt=zF=d([k("esri.views.3d.terrain.TerrainSurface")],Gt);const c_e=Gt,CA=R(),XS=ms(),$Ct=Pi(),CCt=new _i,HG=new b4e("ground"),ok={spatialReference:null,extent:null,scale:0};function u_e(t,e,i){for(const r of t){if(!r.containsPointXY(e,i))continue;let s=r;for(;s&&!s.renderData;){const a=(e>s.extentMidX?1:0)+(i<s.extentMidY?2:0);s=s.children[a]}const n=s?.renderData?.geometryState.samplerData??null;return ls(e,i,n)}return null}function WG(t,e){!t.leaf||t.level<Tn||_se(t,i=>{e&&R5e(i);const r=GX(i);if(i.maxLevelDeltaNeighborCount++,r){let s=i.parent;for(;s;){const n=GX(s);if(s.unmergableChildCount++,!n)break;s=s.parent}}})}function R5e(t){if(t.hasPendingUpdate(1))return;let e=t.parent;for(;e?.resetPendingUpdate(4);)e=e.parent;t.resetPendingUpdate(4),t.leaf&&t.setPendingUpdate(1),t.level<Tn||_se(t,i=>{R5e(i)})}function h_e(t){t.level<Tn||_se(t,e=>{if(e.maxLevelDeltaNeighborCount--,e.maxLevelDeltaNeighborCount===0&&e.unmergableChildCount===0){let i=e.parent;for(;i&&(i.unmergableChildCount--,GX(i));)i=i.parent}})}function GX(t){return t.maxLevelDeltaNeighborCount===0&&t.unmergableChildCount===0}function _se(t,e){if(t.level<Tn)return;const i=t.level-Tn,r=t.lij[1]>>Tn,s=t.lij[2]>>Tn,n=a=>a.leaf||a.level===i;for(let a=0;a<4;++a){const o=t.findNeighborTile(cp[a],n);if(!o||o.level!==i)continue;const l=o.lij;l[1]===r&&l[2]===s||e(o)}}const d_e=R();let MCt=class{constructor(e,i,r,s){this.operation=e,this.geometry=i,this.states=r,this.sync=s}},eP=class extends Me{constructor(e){super(e),this._residentGeomRecords=new tm,this._dirtyGeomRecords=new tm,this._dirtyRecordCount=0}get dirty(){return this._dirtyRecordCount>0}commitLayer(e,i){const r=this._dirtyGeomRecords.getInner(e),s=this.model.getLayer(e);if(!r||!s)return;let n=0;r.forEach((a,o)=>{const l=this._ensureGeomRecord(e,o);this._dirtyGeomRecords.delete(e,o),n+=a.size,a.forEach(({geometry:c,operation:h,states:f},y)=>{let _=!1;if(h===1){const w=l.get(y);if(w){if(4&f){const x=s.getObject(o);this.model.updateRenderGeometryTransformation(x,c,w)&&(_=!0)}_||i.updates.push({renderGeometry:w,updateType:f})}else dt(!1,"ModelDirtySet.commitLayer: invalid update")}if(h===2||_){const w=l.get(y);w?(i.removes.push(w),l.delete(y)):h===2&&dt(!1,"ModelDirtySet.commitLayer: invalid remove")}if(h===0||_){const w=s.getObject(o);if(w!=null){const x=this.model.getRenderGeometry(w,c);i.adds.push(x),l.set(y,x)}}}),l.size===0&&this._residentGeomRecords.delete(e,o)}),this._dirtyRecordCount-=n}commitSyncUpdates(e,i){const r=this._dirtyGeomRecords.getInner(e),s=this.model.getLayer(e);r&&s&&r.forEach((n,a)=>{const o=this._ensureGeomRecord(e,a);n.forEach(({geometry:l,operation:c,states:h,sync:f},y)=>{let _=!1;if(c===1&&f){const w=o.get(y);if(w){if(4&h){const x=s.getObject(a);this.model.updateRenderGeometryTransformation(x,l,w)&&(_=!0)}_||i.updates.push({renderGeometry:w,updateType:h})}else dt(!1,"ModelDirtySet.commitSyncUpdates: invalid update")}})})}_objectStateChanged(e,i){for(const r of i.geometries)this._updateOrCreateDirtyRecord(i,r,1,e)}visibilityChanged(e){this._objectStateChanged(1,e)}highlightChanged(e){this._objectStateChanged(8,e)}occlusionChanged(e){this._objectStateChanged(16,e)}attributesChanged({object:e,geometry:i,sync:r}){this._updateOrCreateDirtyRecord(e,i,1,2,r)}layerAdded(e){e.objects.forEach(i=>this.layerObjectAdded(i))}layerRemoved(e){e.objects.forEach(i=>this.layerObjectRemoved(i))}layerObjectAdded(e){for(const i of e.geometries)this._geometryAdded(e,i)}layerObjectRemoved(e){for(const i of e.geometries)this._geometryRemoved(e,i)}layerObjectsAdded(e){for(const i of e)this.layerObjectAdded(i)}layerObjectsRemoved(e){for(const i of e)this.layerObjectRemoved(i)}transformationChanged(e){const i=this._getLayerId(e),r=e.id;this._ensureGeomRecord(i,r).forEach(({geometry:s})=>this._updateOrCreateDirtyRecord(e,s,1,4))}shaderTransformationChanged(e){const i=this._getLayerId(e),r=e.id;this._ensureGeomRecord(i,r).forEach(s=>s.objectShaderTransformationChanged(e.shaderTransformation))}geometryAdded(e){this._geometryAdded(e.object,e.geometry)}_geometryAdded(e,i){this._updateOrCreateDirtyRecord(e,i,0)}geometryRemoved(e){this._geometryRemoved(e.object,e.geometry)}_geometryRemoved(e,i){this._updateOrCreateDirtyRecord(e,i,2)}_updateOrCreateDirtyRecord(e,i,r,s=0,n=!1){const a=this._getLayerId(e),o=e.id,l=i.id,c=this._ensureDirtyRecord(a,o),h=c.get(l);if(h){const f=h.operation;f===2&&r===0&&h.states!==0?h.operation=1:f===2&&r===0||f===0&&r===2?(c.delete(l),this._dirtyRecordCount--):f!==1||r!==2&&r!==1?(dt((f===2||f===0)&&r===1,"ModelDirtySet.objectGeometryAdded: inconsistent state"),h.states|=s):(h.operation=r,h.states|=s),h.sync=h.sync||n}else c.set(l,new MCt(r,i,s,n)),this._dirtyRecordCount++}_ensureGeomRecord(e,i){let r=this._residentGeomRecords.get(e,i);return r||(r=new Map,this._residentGeomRecords.set(e,i,r)),r}assertLayerClean(e){dt(this._dirtyGeomRecords.getInner(e)==null,"Dirty geometry records for removed layer")}_ensureDirtyRecord(e,i){const r=this.model.getLayer(e);dt(r!=null,"Updating geometry record for an unregistered layer");let s=this._dirtyGeomRecords.get(e,i);return s||(s=new Map,this._dirtyGeomRecords.set(e,i,s)),s}_getLayerId(e){return e.layer?.id??EP}formatDebugInfo(){const e=["ADD","UPD",void 0,"REM"];let i="";return this._dirtyGeomRecords.forAll((r,s,n)=>{i.length>0&&(i+=`
`),i+=s+"."+n;const a=[];r.forEach(o=>{const l=o.operation;a[l]||(a[l]=[]),a[l].push(o.geometry.id)});for(let o=0;o<a.length;o++)if(a[o]){i+=" "+e[o-1]+": ";for(let l=0;l<a[o].length;l++)i+=a[o][l]+", "}}),i}get test(){}};d([m({constructOnly:!0})],eP.prototype,"model",void 0),d([m()],eP.prototype,"_dirtyRecordCount",void 0),eP=d([k("esri.views.3d.webgl-engine.lib.ModelDirtySet")],eP);const ECt=eP;let ACt=class{constructor(e,i={}){this.geometry=e,this.screenToWorldRatio=1,this._transformation=it(),this._shaderTransformation=null,this._boundingSphere=null,this.id=ql(),this.layerViewUid=i.layerViewUid,this.graphicUid=i.graphicUid,this.castShadow=i.castShadow??!1,i.objectShaderTransformation&&this.objectShaderTransformationChanged(i.objectShaderTransformation)}get transformation(){return this._transformation}set transformation(e){pn(this._transformation,e),this._boundingSphere=null}get boundingInfo(){return this.geometry.boundingInfo}objectShaderTransformationChanged(e){e==null?this._shaderTransformation=null:(this._shaderTransformation??=it(),an(this._shaderTransformation,e,this.geometry.transformation)),this._boundingSphere=null}get boundingSphere(){return this.boundingInfo?(this._boundingSphere==null&&(this._boundingSphere??=ms(),OC(this._boundingSphere,this.boundingInfo.center,this.shaderTransformation),this._boundingSphere[3]=this.boundingInfo.radius*HR(this.shaderTransformation)),this._boundingSphere):r$e}get material(){return this.geometry.material}get type(){return this.geometry.type}get shaderTransformation(){return this._shaderTransformation??this.transformation}get attributes(){return this.geometry.attributes}get positionAttribute(){return this.geometry.positionAttribute}foreachHighlightOptions(e){this.geometry.foreachHighlightOptions(e)}get hasHighlights(){return this.geometry.hasHighlights}get occludees(){return this.geometry.occludees}get visible(){return this.geometry.visible}set visible(e){this.geometry.visible=e}},FF=class extends Me{constructor(){super(...arguments),this.dirtySet=new ECt({model:this}),this._originFactory=new MIe(null),this._textures=new Map,this._layers=new Map}hasTexture(e){return this._textures.has(e.id)}getTexture(e){return e==null?null:this._textures.get(e)}addTexture(e){const i=e.id;dt(!this._textures.has(i),"Model/Stage already contains texture to be added"),this._textures.set(i,e)}removeTexture(e){return this._textures.delete(e.id)}addTextures(e){for(const i of e)i&&(dt(!this._textures.has(i.id),"Model/Stage already contains object to be added"),this._textures.set(i.id,i))}removeTextures(e){for(const i of e)i&&(dt(this._textures.has(i.id),"Model/Stage doesn't contain object to be removed"),this._textures.delete(i.id))}forEachTexture(e){this._textures.forEach(i=>e(i))}hasLayer(e){return this._layers.has(e.id)}getLayer(e){return e==null?null:this._layers.get(e)}addLayer(e){const i=e.id;dt(!this._layers.has(i),"Model/Stage already contains layer to be added"),this._layers.set(i,e)}removeLayer(e){return this._layers.delete(e.id)}getRenderGeometry(e,i){const r=new ACt(i,{castShadow:e.castShadow,objectShaderTransformation:e.shaderTransformation}),s=i.localOrigin;return r.transformation=e.getCombinedStaticTransformation(i,p_e),r.localOrigin=s??this._originFactory.getOrigin(Ti(r.boundingSphere)),r}updateRenderGeometryTransformation(e,i,r){if(e==null)return!1;r.transformation=e.getCombinedStaticTransformation(i,p_e);const s=this._originFactory.getOrigin(Ti(r.boundingSphere));return r.localOrigin!==s}get test(){}};d([m({constructOnly:!0})],FF.prototype,"dirtySet",void 0),FF=d([k("esri.views.3d.webgl-engine.parts.Model")],FF);const p_e=it();function OCt(t,e,i=0){const r=Se(t,0,DCt);for(let s=0;s<4;s++)e[i+s]=Math.floor(256*I5e(r*D5e[s]))}function PCt(t,e,i=0){const r=Se(t,0,ICt);for(let s=0;s<3;s++)e[i+s]=Math.floor(256*I5e(r*D5e[s]))}function vse(t,e=0){let i=0;for(let r=0;r<4;r++)i+=t[e+r]*RCt[r];return i}const D5e=[1,256,65536,16777216],RCt=[1/256,1/65536,1/16777216,1/4294967296],DCt=vse(new Uint8ClampedArray([255,255,255,255])),ICt=vse(new Uint8ClampedArray([255,255,255,0]));function I5e(t){return t-Math.floor(t)}function LCt(t){return"r"in t&&"g"in t&&"b"in t}function L5e(t){return"h"in t&&"s"in t&&"v"in t}function k5e(t){return"l"in t&&"a"in t&&"b"in t}function z5e(t){return"l"in t&&"c"in t&&"h"in t}function kCt(t){return"x"in t&&"y"in t&&"z"in t}const zCt=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],FCt=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function F5e(t,e){const i=[];let r,s;if(t[0].length!==e.length)throw new Error("dimensions do not match");const n=t.length,a=t[0].length;let o=0;for(r=0;r<n;r++){for(o=0,s=0;s<a;s++)o+=t[r][s]*e[s];i.push(o)}return i}function N5e(t){const e=[t.r/255,t.g/255,t.b/255].map(r=>r<=.04045?r/12.92:((r+.055)/1.055)**2.4),i=F5e(zCt,e);return{x:100*i[0],y:100*i[1],z:100*i[2]}}function bse(t){const e=F5e(FCt,[t.x/100,t.y/100,t.z/100]).map(i=>{const r=i<=.0031308?12.92*i:1.055*i**.4166666666666667-.055;return Math.min(1,Math.max(r,0))});return{r:Math.round(255*e[0]),g:Math.round(255*e[1]),b:Math.round(255*e[2])}}function V5e(t){const e=[t.x/95.047,t.y/100,t.z/108.883].map(i=>i>.008856451679035631?i**.3333333333333333:7.787037037037035*i+.13793103448275862);return{l:116*e[1]-16,a:500*(e[0]-e[1]),b:200*(e[1]-e[2])}}function U5e(t){const e=t.l,i=[(e+16)/116+t.a/500,(e+16)/116,(e+16)/116-t.b/200].map(r=>r>6/29?r**3:3*(6/29)**2*(r-4/29));return{x:95.047*i[0],y:100*i[1],z:108.883*i[2]}}function NCt(t){const e=t.l,i=t.a,r=t.b,s=Math.sqrt(i*i+r*r);let n=Math.atan2(r,i);return n=n>0?n:n+2*Math.PI,{l:e,c:s,h:n}}function VCt(t){const e=t.l,i=t.c,r=t.h;return{l:e,a:i*Math.cos(r),b:i*Math.sin(r)}}function UCt(t){return V5e(N5e(t))}function BCt(t){return bse(U5e(t))}function jCt(t){return NCt(V5e(N5e(t)))}function qCt(t){return bse(U5e(VCt(t)))}function GCt(t){const e=t.r,i=t.g,r=t.b,s=Math.max(e,i,r),n=s-Math.min(e,i,r);let a=s,o=n===0?0:s===e?(i-r)/n%6:s===i?(r-e)/n+2:(e-i)/n+4,l=n===0?0:n/a;return o<0&&(o+=6),o*=60,l*=100,a*=100/255,{h:o,s:l,v:a}}function HCt(t){const e=(t.h+360)%360/60,i=t.s/100,r=t.v/100*255,s=r*i,n=s*(1-Math.abs(e%2-1));let a;switch(Math.floor(e)){case 0:a={r:s,g:n,b:0};break;case 1:a={r:n,g:s,b:0};break;case 2:a={r:0,g:s,b:n};break;case 3:a={r:0,g:n,b:s};break;case 4:a={r:n,g:0,b:s};break;case 5:case 6:a={r:s,g:0,b:n};break;default:a={r:0,g:0,b:0}}return a.r=Math.round(a.r+r-s),a.g=Math.round(a.g+r-s),a.b=Math.round(a.b+r-s),a}function I4(t){return LCt(t)?t:z5e(t)?qCt(t):k5e(t)?BCt(t):kCt(t)?bse(t):L5e(t)?HCt(t):t}function WCt(t){return L5e(t)?t:GCt(I4(t))}function ZCt(t){return k5e(t)?t:UCt(I4(t))}function ati(t){return z5e(t)?t:jCt(I4(t))}function YCt(t,e){const{r:i,g:r,b:s}=t;return .2126*i+.7152*r+.0722*s}function oti(t,e=225){return YCt(t)>e?new mt([0,0,0,t.a]):new mt([255,255,255,t.a])}function lti(t,e){const i=ZCt(t);i.l*=1-e;const r=I4(i),s=t.clone();return s.setColor(r),s.a=t.a,s}function cti(t,e){const i=t.clone();return i.a*=e,i}function uti(t,e){const i=WCt(t);i.s*=e;const r=I4(i),s=t.clone();return s.setColor(r),s.a=t.a,s}function wse(t){return mt.toUnitRGBA(t)}function hti(t,e){return t===e||t!=null&&t.equals(e)}function dti(t,e){return t===e||t!=null&&e!=null&&GR(t,e)}function pti(t){return fi(t[0],t[1],t[2],t.length>3?t[3]:1)}function QCt(t){return t[0]??=0,t[1]??=0,t[2]??=0,t}function fti(t){return t.length=4,QCt(t),t[3]??=1,Se(t[3],0,1),t}function mti(t,e){const i=mt.toUnitRGBA(t);return i[3]*=e,i}function gti(t,e,i={}){if(t.length===0||e<=0)return[];if((t=t.map(r=>typeof r=="string"?new mt(r):r)).length===1||e===1){const r=[],s=t[0];for(let n=0;n<e;n++)r.push(s.clone());return r}if(i.shuffle&&(t=jbe(Te(t),i.seed)),t.length>=e){const r=[],s=(t.length-1)/(e-1);for(let n=0;n<e;n++){const a=Math.round(n*s);r.push(t[a].clone())}return r}return XCt(t,e,i)}function XCt(t,e,i={}){const r=[],s=t.length-1,n=Math.ceil((e-t.length)/s);e:for(let a=0;a<s;a++){const o=t[a],l=t[a+1];for(let c=1;c<=n;c++){const h=c/(n+1);if(r.push(JCt(o,l,h,i)),r.length+t.length===e)break e}}return[...t.map(a=>a.clone()),...jbe(r,i.seed??1)]}const ZG=(t,e)=>{const i=Math.floor(10*e())-5;return Math.min(255,Math.max(0,t+i))};function JCt(t,e,i,r={}){const s=t.r,n=t.g,a=t.b,o=e.r,l=e.g,c=e.b,h=Math.round(s+(o-s)*i),f=Math.round(n+(l-n)*i),y=Math.round(a+(c-a)*i);if(!r.offset)return new mt([h,f,y]);const _=cK(r.seed);return new mt([ZG(h,_),ZG(f,_),ZG(y,_)])}let B5e=class extends hr{constructor(){super(...arguments),this.radii=pt(),this.heightParameters=ri()}};function KCt(t){t.uniforms.add(new ll("radii",e=>e.radii),new Xn("heightParameters",e=>e.heightParameters)),t.constants.add("scaleHeight","float",mi.scaleHeight*mi.atmosphereHeight),t.code.add(E`float chapmanApproximation(float thickness, float height, float cosZenith) {
float c = sqrt(thickness + height);
float cExpH = c * exp(-height);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (thickness + height);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(thickness - x0) - cExpH / (1.0 - c * cosZenith);
}
}`),t.code.add(E`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`),t.code.add(E`vec4 planetIntersect(vec3 cameraPos, vec3 rayDir) {
float reducedPlanetRadius = radii[0] - 20000.0;
float rayPlanetDistance = heightParameters[1] - reducedPlanetRadius * reducedPlanetRadius;
vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, rayPlanetDistance);
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, heightParameters[2]);
bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
bool insideAtmosphere = heightParameters[0] < radii[1];
if (!(hitsAtmosphere || insideAtmosphere)) {
return vec4(1.0, 0.0, 0.0, 0.0);
}
bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;
float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;
if (heightParameters[0] < reducedPlanetRadius) {
if (dot(rayDir, normalize(cameraPos)) < -0.025) {
return vec4(1.0, 0.0, 0.0, 0.0);
}
start = rayPlanetIntersect.y;
}
float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
return vec4(0.0, hitsPlanet ? 1.0 : 0.0, start, end);
}`)}function j5e(t,e){t.include(KCt);const i=6;t.uniforms.add(new co("cameraPosition",r=>r.camera.eye)),t.constants.add("betaRayleigh","vec3",Gz),t.constants.add("betaCombined","vec3",Jat),t.constants.add("betaMie","float",Xat),t.code.add(E`
    vec3 raymarchAtmosphere(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      vec4 ray = planetIntersect(cameraPos, rayDir);
      if(ray.x == 1.0) {
        return vec3(0);
      }
      ${_e(e,"if (terrainDepth != -1.0) { ray.w = terrainDepth; }")}

      vec3 samplePoint = cameraPos + rayDir * ray.w;
      float multiplier = ray.y == 1.0 ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (ray.w - ray.z) / ${E.float(i)};

      for (int i = 0; i < ${E.int(i)}; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
          ${_e(!e,"scattering *= mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0))")};
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {
          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);
          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${_e(!e,"scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);")}
        }
        lastOpticalDepth = opticalDepth;
      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.0596831 * mumu;
      ${e?"return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;":E`const float g = 0.8;
             const float gg = g * g;
             float phaseMie = 0.1193662 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg));
             phaseMie = clamp(phaseMie, 0.0, 128.0);
             return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }`)}function L4(t,e={needUVs:!0,needEyeDirection:!0}){t.attributes.add("position","vec2"),t.varyings.add("worldRay","vec3");const{needUVs:i,needEyeDirection:r}=e;i&&t.varyings.add("uv","vec2"),r&&t.varyings.add("eyeDir","vec3"),t.vertex.uniforms.add(new Io("inverseProjectionMatrix",s=>s.camera.inverseProjectionMatrix),new Io("inverseViewMatrix",s=>i3e(eMt,s.camera.viewMatrix))),t.vertex.main.add(E`
    vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
    ${_e(r,"eyeDir = posViewNear;")}
    worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
    ${_e(i,"uv = position * 0.5 + vec2(0.5);")}
    gl_Position = vec4(position, 1, 1);
  `)}const eMt=it();function q5e(t){const e=new Di;e.include(L4);const{reduced:i}=t,{fragment:r}=e;return $p(r),r.include(t1),r.include(f4),r.include(EM),r.include(j5e,!1),r.uniforms.add(new _r("backgroundColor",s=>s.backgroundColor),new ut("innerFadeDistance",s=>s.innerFadeDistance),new ut("altitudeFade",s=>s.altitudeFade),new po("depthTexture",s=>s.mainDepth)).code.add(E`vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
float rayPlanetDistance = heightParameters[1] - radii[0] * radii[0];
vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, rayPlanetDistance);
if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
return fragColor;
}
float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
if (relDist > 1.0) {
return surfaceColor;
}
return mix(fragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
}
float getGlow(float dist, float radius, float intensity) {
return pow(radius / max(dist, 1e-6), intensity);
}
vec3 getSun(vec3 cameraPos, vec3 rayDir, vec3 lightDir){
float scaleFract = (length(cameraPos) - radii[0]) / scaleHeight;
float sunOpticalDepth = getOpticalDepth(cameraPos, rayDir, max(scaleFract, 0.0));
vec3 sunTransmittance = exp(-(mix(betaCombined, betaRayleigh, 0.5)) * max(0.0, sunOpticalDepth));
float mu = clamp(dot(rayDir, lightDir), 0.0, 1.0);
float sunDisc = 256.0 * smoothstep(0.0, 128.0, clamp(getGlow(1.0 - mu, 3e-5, 3.0), 0.0, 128.0));
return normalize(sunTransmittance) * sunDisc;
}`).main.add(E`
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${_e(!i,E`float depthSample = texture(depthTexture, uv).r;
             if (depthSample != 1.0) {
                fragColor = vec4(0);
                return;
             }`)}

      vec3 col = linearizeGamma(backgroundColor);
      col += raymarchAtmosphere(cameraPosition, rayDir, mainLightDirection, terrainDepth);
      col += getSun(cameraPosition, rayDir, mainLightDirection);
      float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));

      col = tonemapACES(col);
      fragColor = delinearizeGamma(vec4(col, alpha));
      fragColor = applyUndergroundAtmosphere(rayDir, mainLightDirection, fragColor);
  `),e}const tMt=Object.freeze(Object.defineProperty({__proto__:null,build:q5e},Symbol.toStringTag,{value:"Module"}));let iMt=class extends B5e{constructor(){super(...arguments),this.innerFadeDistance=0,this.altitudeFade=0,this.backgroundColor=R()}},YG=class extends Vi{constructor(e,i){super(e,i,new Ii(tMt,()=>te(()=>Promise.resolve().then(()=>Hkt),void 0)),ed(g4))}initializePipeline(e){return li({blending:e.reduced?aie:g2(770,771),depthTest:{func:e.reduced?519:515},colorWrite:$i})}},G5e=class extends Fo{constructor(){super(...arguments),this.reduced=!1}};d([oe()],G5e.prototype,"reduced",void 0);let xse=class extends hr{};function H5e(){const t=new Di;return t.include(Oa),t.fragment.uniforms.add(new zt("colorTexture",e=>e.color),new po("depthTexture",e=>e.mainDepth)),t.fragment.main.add(E`float depthSample = texture(depthTexture, uv).r;
if (depthSample != 1.0 ) {
fragColor = vec4(0);
return;
}
fragColor = texture(colorTexture, uv);`),t}const rMt=Object.freeze(Object.defineProperty({__proto__:null,AtmosphereCompositingPassParameters:xse,build:H5e},Symbol.toStringTag,{value:"Module"}));let f_e=class extends Vi{constructor(e,i){super(e,i,new Ii(rMt,()=>te(()=>Promise.resolve().then(()=>Wkt),void 0)),Qs)}initializePipeline(){return li({blending:g2(770,771),depthTest:{func:519},colorWrite:$i})}},HX=class extends Nf{constructor(){super(...arguments),this.requireGeometryDepth=!0,this._compositingPassParameters=new xse,this._vao=null,this._passParameters=new iMt,this._configuration=new G5e}initialize(){this.techniques.precompile(YG,this._configuration),this.techniques.precompile(f_e),this._configuration.reduced=!0,this.techniques.precompile(YG,this._configuration),this._configuration.reduced=!1,this.addHandles([K(()=>this.view.environment.background,e=>{const i=e instanceof jOe?wse(e.color):tn;ve(this._passParameters.backgroundColor,i[0]*i[3],i[1]*i[3],i[2]*i[3])},At),K(()=>this.view.stage?.renderer?.fullResolutionAtmosphere,e=>this._configuration.reduced=!e,At),K(()=>this.view.environment.atmosphereEnabled,e=>e?this._enable():this._disable(),At)])}destroy(){this._vao=Rt(this._vao)}render(e){const i=e.find(({name:S})=>S===ht.OPAQUE_ENVIRONMENT);if(!this.bindParameters.mainDepth)return i;const r=this.renderingContext;this._vao??=i1(r,1);const s=i.getAttachment(Ba);this._update();const n=this.techniques.get(YG,this._configuration);if(!n.compiled)return this.requestRender(1),i;if(!this._configuration.reduced)return i.detachDepth(),r.bindFramebuffer(i.fbo),r.bindTechnique(n,this.bindParameters,this._passParameters),r.bindVAO(this._vao),r.drawArrays(lr.TRIANGLE_STRIP,0,4),i.attachDepth(s),i;const a=this.techniques.get(f_e);if(!a.compiled)return this.requestRender(1),i;const o=r.getViewport(),l=this.bindParameters.camera,c=Le(l.eye)-mi.radius;let h;const f=mi.atmosphereHeight;if(c<f){const S=Math.min(1,Math.max(0,c/f));h=ft(.2,.3,S)}else{const S=Math.min(1,Math.max(0,(c-f)/(15*f)));h=ft(.3,.6,S)}const y=this.renderingContext.parameters.maxTextureSize,_=Iv(Math.round(h*l.fullViewport[2]),y),w=Iv(Math.round(h*l.fullViewport[3]),y);r.setViewport(0,0,_,w);const x=this.fboCache.acquire(_,w,"chapman",5);return r.bindFramebuffer(x.fbo),r.clearFramebuffer([0,0,0,1],!0,!0),r.bindTechnique(n,this.bindParameters,this._passParameters),r.bindVAO(this._vao),r.drawArrays(lr.TRIANGLE_STRIP,0,4),r.setViewport(o.x,o.y,o.width,o.height),this._compositingPassParameters.color=x.getTexture(),i.detachDepth(),r.bindFramebuffer(i.fbo),r.bindTechnique(a,this.bindParameters,this._compositingPassParameters),r.screen.draw(),i.attachDepth(s),x.release(),i}_update(){const e=this.bindParameters.camera,i=On(e.eye),r=Math.sqrt(i),s=i-this._passParameters.radii[1]**2,n=Se((r-this._passParameters.radii[0])/mi.atmosphereHeight,0,1);yr(this._passParameters.heightParameters,r,i,s,n);const a=this.view.basemapTerrain?.getLowerBoundRadius()??0;Cr(this._passParameters.radii,a,a+mi.atmosphereHeight),this._passParameters.innerFadeDistance=2*Math.sqrt((2*a-bQ)*bQ),this._passParameters.altitudeFade=Zte(r-a)}};HX=d([k("esri.views.3d.environment.ChapmanAtmosphere")],HX);function W5e(){const t=new Di,{fragment:e}=t;return t.include(L4,{needUVs:!1,needEyeDirection:!1}),e.include(MM),t.include(vDe,{pbrMode:0,lightingSphericalHarmonicsOrder:2}),e.include(M4),e.include(t1),t.include(E5e),e.uniforms.add(new co("cameraPosition",i=>i.camera.eye),new ws("cloudsOpacity",i=>i.clouds.opacity)).main.add(E`vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
fragColor = vec4(cloudsOpacity * cloudsColor.rgb, cloudsColor.a);`),t}const sMt=Object.freeze(Object.defineProperty({__proto__:null,build:W5e},Symbol.toStringTag,{value:"Module"}));let m_e=class extends Vi{constructor(e,i){super(e,i,new Ii(sMt,()=>te(()=>Promise.resolve().then(()=>Zkt),void 0)),Qs)}initializePipeline(){return li({blending:Ly(1,0,770,1),depthTest:{func:515},colorWrite:$i})}},WX=class extends Nf{constructor(e){super(e),this._planetRadius=or(e.view.spatialReference).radius}initialize(){this.techniques.precompile(m_e),this.addHandles([K(()=>this.view.environment.weather!=null&&this.view.environment.atmosphereEnabled,e=>e?this._enable():this._disable(),Wt)])}destroy(){this._vao=Rt(this._vao)}render(e){const i=e.find(({name:o})=>o===ht.OPAQUE_ENVIRONMENT),r=this.bindParameters.clouds;if(!r.data)return i;const s=this.techniques.get(m_e);if(!s.compiled)return this.requestRender(1),i;const n=this.renderingContext;this._vao??=i1(n);const a=n.bindTechnique(s,this.bindParameters);return n.bindVAO(this._vao),a.assertCompatibleVertexAttributeLocations(this._vao),n.drawArrays(lr.TRIANGLE_STRIP,0,4),r.isFading&&this.requestRender(2),i}};WX=d([k("esri.views.3d.environment.CloudsComposition")],WX);let Z5e=class extends hr{constructor(){super(...arguments),this.atmosphereC=1}};function Y5e(t){t.include(f4),t.uniforms.add(new ut("atmosphereC",e=>e.atmosphereC),new co("cameraPosition",e=>e.camera.eye)),t.code.add(E`float getDistanceFalloff(float dist, vec3 rayDir, float weight) {
if(dist == -1.0){
dist = 0.055 * sphereIntersect(cameraPosition, rayDir, atmosphereC).y;
}
return (1.0 - exp(-dist * weight));
}`)}let Sse=class extends Z5e{constructor(){super(...arguments),this.color=R(),this.strength=4e-6,this.amount=0,this.fogColorDistanceWeight=1}};function Q5e(t){const e=new Di;e.include(L4,{needUVs:!0,needEyeDirection:!0});const i=e.fragment,{hasEmissive:r}=t;return i.uniforms.add(new po("depthTexture",s=>s.mainDepth),new ut("fogStrength",s=>s.strength),new ut("fogAmount",s=>s.amount),new _r("fogColor",s=>s.color),new ut("fogColorDistanceWeight",s=>s.fogColorDistanceWeight)),r&&i.uniforms.add(new zt("emissionTexture",s=>s.emission)),i.include(Y5e),i.include(t1),i.include(EM),i.include(rd),i.main.add(E`
    vec3 rayDir = normalize(worldRay);
    float terrainDepth = -1.0;

    float depthSample = depthFromTexture(depthTexture, uv);
    if(depthSample < 1.0 && depthSample > 0.0){
      vec3 cameraSpaceRay = normalize(eyeDir);
      cameraSpaceRay /= cameraSpaceRay.z;
      cameraSpaceRay *= linearizeDepth(depthSample);
      terrainDepth = max(0.0, length(cameraSpaceRay));
    }

    float fogAmount = fogAmount * getDistanceFalloff(terrainDepth, rayDir, fogStrength);

    ${_e(r,E`vec3 emission = texture(emissionTexture, uv).rgb;
           vec3 emissionDistanceCorrected = mix(emission, vec3(0.0), fogAmount * fogColorDistanceWeight);
           vec3 finalFogColor = fogColor * fogAmount + emissionDistanceCorrected;
           vec4 fog = vec4(finalFogColor, fogAmount);`,E`vec4 fog = vec4(fogColor, 1.0) * fogAmount;`)}
    fragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));`),e}const nMt=Object.freeze(Object.defineProperty({__proto__:null,FogPassParameters:Sse,build:Q5e},Symbol.toStringTag,{value:"Module"}));let QG=class extends Vi{constructor(e,i){super(e,i,new Ii(nMt,()=>te(()=>Promise.resolve().then(()=>Ykt),void 0)),Qs)}initializePipeline(){return li({blending:Ly(770,0,771,1),colorWrite:$i})}},X5e=class extends Fo{constructor(){super(...arguments),this.hasEmissive=!1}};d([oe()],X5e.prototype,"hasEmissive",void 0);function J5e(t){t.code.add(E`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}`),t.code.add(E`const vec4 RGBA_TO_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgbaTofloat(vec4 rgba) {
return dot(rgba, RGBA_TO_FLOAT_FACTORS);
}`),t.code.add(E`const vec4 uninterpolatedRGBAToFloatFactors = vec4(
1.0 / 256.0,
1.0 / 256.0 / 256.0,
1.0 / 256.0 / 256.0 / 256.0,
1.0 / 256.0 / 256.0 / 256.0 / 256.0
);
float uninterpolatedRGBAToFloat(vec4 rgba) {
return (dot(round(rgba * 255.0), uninterpolatedRGBAToFloatFactors) - 0.5) * 2.0;
}`),t.code.add(E`const vec3 uninterpolatedRGBToFloatFactors = vec3(
1.0 / 256.0,
1.0 / 256.0 / 256.0,
1.0 / 256.0 / 256.0 / 256.0
);
float uninterpolatedRGBToFloat(vec3 rgb) {
return (dot(round(rgb * 255.0), uninterpolatedRGBToFloatFactors) - 0.5) * 2.0;
}`)}let X8=class extends hr{constructor(){super(...arguments),this.opacity=1}};function K5e(t){const e=new Di,{blitEmissiveMode:i,blitMode:r,hasOpacityFactor:s}=t;e.include(Oa),e.fragment.uniforms.add(new zt("tex",o=>o.texture)),s&&e.fragment.uniforms.add(new ut("opacity",o=>o.opacity));const n=r===3;n&&(e.fragment.uniforms.add(new Sy("nearFar",o=>o.camera.nearFar)),e.fragment.include(rd),e.fragment.include(J5e));const a=i===1;return a&&(e.outputs.add("fragColor","vec4",0),e.outputs.add("fragEmission","vec4",1)),e.fragment.main.add(E`
    ${n?E`
          float normalizedLinearDepth = (-linearDepthFromTexture(tex, uv) - nearFar[0]) / (nearFar[1] - nearFar[0]);
          fragColor = float2rgba(normalizedLinearDepth);`:E`
          fragColor = texture(tex, uv) ${s?"* opacity":""};`}
    ${_e(a,"fragEmission = vec4(0.0, 0.0, 0.0, fragColor.a);")}`),e}const aMt=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:X8,build:K5e},Symbol.toStringTag,{value:"Module"}));let Of=class extends Vi{constructor(e,i){super(e,i,new Ii(aMt,()=>te(()=>Promise.resolve().then(()=>Qkt),void 0)),Qs)}initializePipeline(e){const{blitMode:i,blitEmissiveMode:r}=e,s=r?1:0;switch(i){case 0:case 3:return li({colorWrite:$i,drawBuffers:Dw(0,s)});case 1:return li({blending:em,colorWrite:$i,drawBuffers:Dw(0,s)});default:return li({blending:Qv,colorWrite:$i,drawBuffers:Dw(0,s)})}}},yR=class extends Fo{constructor(){super(...arguments),this.blitMode=0,this.blitEmissiveMode=0,this.hasOpacityFactor=!1}};d([oe({count:4})],yR.prototype,"blitMode",void 0),d([oe({count:4})],yR.prototype,"blitEmissiveMode",void 0),d([oe()],yR.prototype,"hasOpacityFactor",void 0);let Tse=class{constructor(e,i=0){this._techniques=e,this._parameters=new X8,this._configuration=new yR,this._configuration.blitMode=i,e.precompile(Of,this._configuration),this._configuration.hasOpacityFactor=!0,e.precompile(Of,this._configuration),this._configuration.hasOpacityFactor=!1}blit(e,i,r,s){this.blitTexture(e,i.getTexture(),r,s)}blitTexture(e,i,r,s){e.bindFramebuffer(r.fbo),e.setClearColor(0,0,0,1),e.clear(16384),this._parameters.texture=i;const n=this._techniques.get(Of,this._configuration);e.bindTechnique(n,s,this._parameters),e.screen.draw()}blend(e,i,r,s,n=1){this._configuration.hasOpacityFactor=n<1;const a=this._techniques.get(Of,this._configuration);return!!a.compiled&&(e.bindFramebuffer(r.fbo),this._parameters.texture=i.getTexture(),this._parameters.opacity=n,e.bindTechnique(a,s,this._parameters),e.screen.draw(),!0)}};const oMt=.95,lMt=1;let NF=class extends Ow{constructor(e){super(e),this.consumes={required:[ht.TRANSPARENT_ENVIRONMENT]},this._configuration=new X5e,this.requireGeometryDepth=!0,this._newParameters=new XG,this._oldParameters=new XG,this._fadedParameters=new XG,this._parameters=this._newParameters,this._passParameters=new Sse,this._blit=null;const i=or(e.view.spatialReference);this._planetRadius=i.radius,this._atmosphereRadius=i.radius+i.atmosphereHeight;const r=e.view.stage.renderView.techniques;r.precompile(QG,this._configuration),this._configuration.hasEmissive=!this._configuration.hasEmissive,r.precompile(QG,this._configuration),this._configuration.hasEmissive=!this._configuration.hasEmissive}toogle(){this.view.environment.atmosphereEnabled&&this.view.environment.weather?this._enable():this._disable()}initialize(){this.addHandles([K(()=>this.view.environment.atmosphereEnabled,()=>this.toogle(),At),K(()=>this.view.environment.weather,()=>this.toogle(),At),K(()=>this._updateFogParameters(),()=>{},At)]),this.addHandles(K(()=>this._fadeFactor,e=>this._fade(e),At))}get _fadeFactor(){return this.view.stage?.renderer.renderContext.bind.clouds.fadeFactor??1}_fade(e){const{_newParameters:i,_oldParameters:r}=this;e>=1?(this._parameters=i,this._oldParameters.copyFrom(this._newParameters)):e<=0?this._parameters=r:(this._fadedParameters.lerp(r,i,e),this._parameters=this._fadedParameters)}_updateFogParameters(){const e=this.view.environment.weather,i=e.type==="foggy"||e.type==="snowy"||e.type==="rainy";this._newParameters.strength=e.type==="foggy"?ft(3e-5,.005,e.fogStrength**3):e.type==="snowy"||e.type==="rainy"?ft(4e-6,2e-4,(e.precipitation??0)**3):0,this._newParameters.amount=i?1:0,e.type!=="foggy"&&e.type!=="snowy"||de(this._newParameters.color,uMt),e.type==="rainy"&&de(this._newParameters.color,cMt),this._fadeFactor>=1&&this._oldParameters.copyFrom(this._newParameters),this.requestRender(1)}render(e){const i=e.find(({name:y})=>y===ht.TRANSPARENT_ENVIRONMENT);if(this._parameters.amount===0||(this._update(),this._passParameters.amount<=0))return i;const r=i.getAttachment(Do);this._configuration.hasEmissive=r!=null;const s=this.techniques.get(QG,this._configuration);if(!s.compiled)return this.requestRender(1),i;const n=i.getAttachment(Ba),a=this.renderingContext,{fullWidth:o,fullHeight:l}=this.bindParameters.camera,c=o,h=l;let f=null;return r&&(f=this.fboCache.acquire(c,h,"glow horizontal",8),this._blit??=new Tse(this.techniques),this._blit.blitTexture(a,r?.attachment,f,this.bindParameters)),i.attachDepth(null),a.bindFramebuffer(i.fbo),r&&(this._passParameters.emission=f?.getTexture()),a.bindTechnique(s,this.bindParameters,this._passParameters),a.screen.draw(),i.attachDepth(n),f?.release(),i}_update(){const e=this.bindParameters.camera;Ee(g_e,e.eye);const i=Math.max(0,Oe(g_e,this.bindParameters.lighting.mainLight.direction)),r=this._parameters.color;le(y_e,r,.1),Wi(this._passParameters.color,y_e,r,i);const s=Le(e.eye);this._passParameters.atmosphereC=s**2-this._atmosphereRadius**2,this._passParameters.amount=(1-sC(oMt*aw,lMt*aw,Math.abs(s-this._planetRadius)))*this._parameters.amount,this._passParameters.strength=this._parameters.strength}get test(){return{parameters:this._passParameters}}};d([m()],NF.prototype,"consumes",void 0),NF=d([k("esri.views.3d.environment.Fog")],NF);let XG=class{constructor(){this.color=R(),this.strength=0,this.amount=0}copyFrom(e){this.amount=e.amount,this.strength=e.strength,de(this.color,e.color)}lerp(e,i,r){this.amount=ft(e.amount,i.amount,r),this.strength=ft(e.strength,i.strength,r),Wi(this.color,e.color,i.color,r)}};const g_e=R(),y_e=R(),cMt=Ge(.5,.5,.5),uMt=Ge(1.5,1.5,1.5);let J8=class extends hr{constructor(){super(...arguments),this.texV=pt(),this.altitudeFade=0,this.innerScale=0,this.undergroundFadeAlpha=0,this.silhouette=new $se}},$se=class{constructor(){this.center=R(),this.v1=R(),this.v2=R()}};function eLe(t){const e=new Di,{vertex:i,fragment:r}=e;if($p(i),t.geometry===2)e.attributes.add("position","vec2"),e.varyings.add("color","vec4"),i.uniforms.add(new co("cameraPosition",s=>s.camera.eye),new ut("undergroundFadeAlpha",s=>s.undergroundFadeAlpha)),i.main.add(E`float ndotl = dot(normalize(cameraPosition), mainLightDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);`),r.main.add(E`fragColor = color;`);else{e.include(k_),e.attributes.add("position","vec3"),e.varyings.add("vtc","vec2"),e.varyings.add("falloff","float");const s=t.geometry===1;i.uniforms.add(new Io("proj",o=>o.camera.projectionMatrix),new Io("view",o=>o.camera.viewMatrix)),s||(e.varyings.add("innerFactor","float"),i.uniforms.add(new _r("silCircleCenter",o=>o.silhouette.center)),i.uniforms.add(new _r("silCircleV1",o=>o.silhouette.v1)),i.uniforms.add(new _r("silCircleV2",o=>o.silhouette.v2)),i.uniforms.add(new ll("texV",o=>o.texV)),i.uniforms.add(new ut("innerScale",o=>o.innerScale)));const n=6.2831853,a=1/128;i.main.add(E`
      ${s?E`
      vec3 pos = position;
      float ndotl = mainLightDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:E`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${E.float(n*a)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), mainLightDirection);
      vtc.x = position.x  * ${E.float(a)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
	  `),r.uniforms.add(new zt("tex",o=>o.texture)),s||r.uniforms.add(new ut("altitudeFade",o=>o.altitudeFade)),r.main.add(E`
			vec4 atmosphereColor = texture(tex, vtc) * falloff;
      ${s?E`fragColor = atmosphereColor;`:E`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			fragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));`}`)}return e}const hMt=Object.freeze(Object.defineProperty({__proto__:null,SilhouetteCircle:$se,SimpleAtmospherePassParameters:J8,build:eLe},Symbol.toStringTag,{value:"Module"}));let z3=class extends Vi{constructor(e,i){super(e,i,new Ii(hMt,()=>te(()=>Promise.resolve().then(()=>Xkt),void 0)),ED.locations)}initializePipeline(e){const i=e.geometry===1;return li({blending:em,culling:i?oie:void 0,depthTest:{func:515},colorWrite:$i})}};const ED=jc().vec3f("position").freeze();let Cse=class extends op{constructor(){super(...arguments),this.geometry=0}};d([oe({count:3})],Cse.prototype,"geometry",void 0);const dMt=new Uint8ClampedArray([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,16,0,0,16,16,0,0,16,16,0,0,16,16,0,0,16,15,0,0,17,15,0,0,17,15,0,0,17,15,0,0,17,14,0,0,18,14,0,0,18,14,0,0,18,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,20,13,0,0,20,13,0,0,20,13,0,0,20,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,22,12,0,0,22,12,0,0,22,12,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,27,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,29,18,0,0,29,18,0,0,29,17,0,0,30,17,0,0,30,17,0,0,30,17,0,0,30,16,0,0,31,16,0,0,31,16,0,0,31,16,0,0,32,16,0,0,32,16,0,0,32,15,0,0,33,15,0,0,33,15,0,0,33,15,0,0,34,15,8,0,34,15,8,0,34,15,8,0,34,15,7,0,35,15,7,0,35,15,7,0,35,21,7,0,36,21,7,0,36,21,7,0,36,21,7,0,37,21,7,0,37,21,7,0,37,20,7,0,38,20,7,0,38,20,7,0,38,20,7,0,39,20,7,0,39,20,7,0,39,20,7,0,39,19,6,0,40,19,6,0,40,19,6,0,40,19,6,0,41,19,6,0,41,19,6,0,41,18,6,0,42,18,6,0,42,18,6,0,42,24,6,0,43,24,6,0,43,24,6,0,43,23,6,0,44,23,6,0,44,23,6,0,44,23,6,0,45,23,6,0,45,23,6,0,45,22,6,0,46,22,6,0,46,22,6,0,46,22,5,0,47,22,5,0,47,22,5,0,47,21,5,0,48,21,5,0,48,21,5,0,48,21,5,0,49,21,5,0,49,26,5,0,49,25,5,0,50,25,5,0,50,25,5,0,50,25,5,0,51,25,5,0,51,25,5,0,51,25,5,0,52,25,5,0,52,25,5,0,52,24,5,0,53,24,5,0,53,24,5,0,53,24,9,0,54,28,9,0,54,28,9,0,54,28,9,0,55,28,9,0,55,27,9,0,56,27,9,0,56,27,9,0,56,27,9,4,57,27,9,4,57,27,9,4,57,26,9,4,58,26,9,4,58,26,9,4,58,26,9,4,59,26,9,4,59,26,9,4,59,26,8,4,60,30,8,4,60,30,8,4,60,29,8,4,61,29,8,4,61,29,8,4,62,29,8,4,62,29,8,4,62,28,8,4,63,28,8,4,63,28,8,4,63,28,12,4,64,28,12,4,64,28,12,4,64,27,12,4,65,27,12,8,65,27,12,8,65,31,12,8,66,31,12,8,66,30,11,8,67,30,11,8,67,30,11,8,67,30,11,8,68,30,11,8,68,30,11,8,68,30,15,7,69,30,15,7,69,30,15,7,69,33,15,11,70,33,15,11,70,32,14,11,71,32,14,11,71,32,14,11,71,32,18,14,72,32,18,14,72,32,18,14,72,31,17,14,73,35,17,14,73,34,17,17,74,34,21,17,74,34,21,17,74,34,20,17,75,34,20,20,75,34,20,20,75,34,23,20,76,34,23,20,76,36,23,23,77,36,23,23,77,36,23,23,77,36,23,23,78,36,26,26,78,36,26,26,78,36,26,26,79,36,26,29,79,38,26,29,80,38,29,29,80,38,29,29,80,38,28,31,81,38,28,31,81,38,31,31,81,37,31,34,82,37,31,34,82,37,31,37,83,40,34,37,83,40,34,37,83,39,33,39,84,39,33,39,84,39,36,42,84,39,36,42,85,39,36,42,85,39,36,42,85,39,39,44,86,39,39,44,86,41,38,47,87,41,41,47,87,41,41,50,87,41,41,49,88,41,41,52,88,40,43,52,89,43,43,52,89,43,43,54,89,42,45,54,90,42,45,57,90,42,45,57,90,42,45,59,91,42,48,59,91,44,47,61,92,44,47,61,92,44,50,61,92,44,49,63,93,44,49,63,93,44,52,66,93,43,52,65,94,46,54,68,94,46,54,70,95,46,54,70,95,46,54,70,95,45,56,72,96,45,56,72,96,45,58,74,97,47,58,76,97,47,58,76,97,47,60,78,98,47,60,78,98,47,60,81,98,49,62,80,99,49,62,82,99,48,61,84,100,48,64,84,100,48,64,84,100,50,63,86,101,50,66,86,101,50,66,88,101,50,65,90,102,52,67,89,103,51,69,91,104,51,68,92,105,52,69,93,107,52,71,94,108,54,70,96,109,53,71,96,111,52,73,98,112,54,72,98,114,53,73,100,115,54,72,100,117,54,73,102,118,55,74,104,120,55,76,105,121,56,77,106,123,56,76,107,124,57,79,107,126,58,78,110,128,57,79,111,129,56,80,113,131,58,79,112,132,57,82,114,134,58,81,116,136,60,82,117,137,59,83,117,139,60,83,119,141,59,84,120,142,60,85,122,144,59,86,122,146,60,86,126,148,62,87,127,149,61,88,127,151,62,88,128,153,63,89,130,155,62,90,131,156,63,90,132,158,64,91,134,160,65,91,135,162,64,92,136,163,63,93,138,165,66,95,139,167,65,95,140,169,66,95,142,171,67,96,142,172,66,97,144,174,67,99,145,176,67,97,148,178,67,99,147,180,68,100,149,181,68,100,150,183,69,101,152,185,70,102,153,187,71,103,155,188,70,103,156,190,70,104,157,192,71,105,158,194,71,106,160,195,72,106,161,197,72,108,161,199,73,108,163,200,73,109,164,202,74,109,165,204,74,110,167,206,75,111,168,207,74,112,170,209,75,112,170,210,76,113,171,212,76,114,173,214,77,115,174,215,78,115,175,217,78,116,175,218,78,117,177,220,78,118,178,221,79,118,180,223,80,120,180,224,81,120,181,226,81,120,182,227,82,121,184,229,82,122,185,230,84,123,186,232,83,123,187,233,84,124,189,234,84,125,188,235,85,126,189,237,86,126,190,238,86,127,191,239,87,127,192,240,87,129,193,242,88,129,194,243,89,130,195,244,90,131,196,245,90,132,197,246,91,132,197,247,92,133,198,248,92,134,199,249,93,135,200,250,94,136,201,251,95,137,202,252,96,138,203,253,97,140,204,254,98,141,205,254,99,142,206,255,101,143,207,255,102,144,208,255,103,146,209,255,104,147,209,255,106,148,210,255,107,149,211,255,108,151,212,255,110,152,213,255,111,153,213,255,112,154,214,255,114,156,215,255,115,157,215,255,117,158,216,255,118,160,217,255,120,161,217,255,121,162,218,255,123,164,218,255,124,165,219,255,125,166,219,255,127,167,220,255,129,169,220,255,130,170,221,255,132,171,221,255,133,173,222,255,134,174,222,255,136,175,223,255,139,178,224,255,142,180,224,255,144,182,225,255,147,185,226,255,150,187,226,255,153,189,227,255,155,191,228,255,158,194,228,255,160,196,229,255,163,198,229,255,165,200,230,255,168,202,231,255,170,203,231,255,172,205,232,255,174,207,232,255,176,209,233,255,178,210,234,255,180,212,234,255,182,214,235,255,184,215,236,255,186,217,237,255,188,219,238,255,190,220,238,255,192,221,239,255,193,222,240,255,194,224,240,255,196,225,241,255,197,226,241,255,198,226,242,255,199,227,242,255,200,228,242,255,201,228,243,255,202,229,243,255,203,230,243,255,204,230,244,255,205,231,244,255,207,232,244,255,208,233,245,255,209,233,245,255,211,234,246,255,213,235,246,255,217,238,247,255,222,240,248,255,226,242,249,255,231,245,250,255,236,247,251,255,241,249,252,255,245,251,253,255,249,252,254,255,255,255,255,255]);let ZX=class extends Nf{constructor(){super(...arguments),this._configuration=new Cse,this._passParameters=new J8,this._vao=null,this._vaoCount=0}initialize(){this._configuration.geometry=1,this.addHandles([K(()=>this.view.environment.atmosphereEnabled,e=>e?this._enable():this._disable(),Wt)])}destroy(){this._passParameters.texture=Rt(this._passParameters.texture),this._vao=Rt(this._vao)}precompile(){this.techniques.precompile(z3,this._configuration)}render(e){const i=e.find(({name:a})=>a===ht.OPAQUE_ENVIRONMENT),r=this.techniques.get(z3,this._configuration);if(!r.compiled)return this.requestRender(1),i;const s=this.renderingContext;if(this._vao||(this._vao=pMt(s),this._vaoCount=this._vao.vertexCount("geometry")),!this._passParameters.texture){const a=new Zi(1,512);a.wrapMode=33071,a.flipped=!0,this._passParameters.texture=new Fi(s,a,dMt)}const n=s.bindTechnique(r,this.bindParameters,this._passParameters);return fMt(__e,this.bindParameters.camera.viewMatrix),n.setUniformMatrix4fv("view",__e),s.bindVAO(this._vao),n.assertCompatibleVertexAttributeLocations(this._vao),s.drawArrays(lr.TRIANGLES,0,this._vaoCount),i}};function pMt(t){const e=HRe(1,2,!1),{data:i,indices:r}=e[0][1],s=ED.createBuffer(r.length),n=s.position;for(let a=0;a<r.length;++a){const o=3*r[a%3==0?a+2:a%3==2?a-2:a];n.set(a,0,i[o]),n.set(a,1,i[o+1]),n.set(a,2,i[o+2])}return new Op(t,new Hs(t,Lo(ED),s.buffer))}function fMt(t,e){pn(t,e),t[12]=0,t[13]=0,t[14]=0,t[15]=1}ZX=d([k("esri.views.3d.environment.LocalAtmosphere")],ZX);const __e=it(),mMt=new Uint8ClampedArray([0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,16,0,0,0,16,0,0,0,16,0,0,0,17,0,0,0,17,0,0,0,18,0,0,0,18,0,0,0,19,0,0,0,19,0,0,0,19,0,0,0,20,0,0,0,20,0,0,0,21,0,0,0,21,0,0,0,22,0,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,28,9,0,0,28,9,0,0,29,9,0,0,29,8,0,0,30,8,0,0,30,8,0,0,31,8,0,0,31,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,33,8,0,0,33,8,0,0,34,7,0,0,35,7,0,0,35,7,0,0,36,7,0,0,36,7,7,0,37,7,7,0,37,7,7,0,38,7,7,0,38,13,7,0,39,13,7,0,39,13,6,0,40,13,6,0,40,12,6,0,41,12,6,0,41,12,6,0,41,12,6,0,42,12,6,0,42,12,6,0,43,12,6,0,43,12,6,0,44,12,6,0,44,11,6,0,45,11,6,6,45,11,6,6,46,11,5,5,47,11,5,5,47,11,5,5,48,11,5,5,48,10,5,5,49,10,5,5,49,10,5,5,50,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,52,15,5,5,52,14,5,5,53,14,5,5,54,14,5,5,54,14,5,5,55,14,5,5,55,14,5,5,56,13,4,4,57,13,4,4,57,13,4,4,58,13,4,4,58,13,4,4,59,13,4,4,59,17,4,4,60,17,4,4,60,17,4,4,60,17,4,4,61,17,4,4,61,16,4,4,62,16,4,4,63,16,4,4,63,16,8,4,64,16,8,4,64,16,8,4,65,15,8,4,66,15,8,4,66,15,8,4,67,19,8,4,68,19,8,4,68,18,7,4,69,18,7,4,69,18,7,4,69,18,7,4,70,18,7,4,70,18,7,4,71,18,7,4,71,18,7,4,72,17,7,3,73,17,7,3,73,21,7,3,74,21,7,3,74,20,7,3,75,20,7,3,76,20,7,3,76,20,7,3,77,20,7,3,77,20,7,3,78,20,7,3,78,20,7,7,78,19,6,6,79,19,10,6,80,19,10,6,80,22,9,6,81,22,9,6,81,22,9,6,82,22,9,6,83,22,9,6,83,21,9,6,84,21,9,6,84,21,9,6,85,21,9,6,86,21,9,6,86,23,9,6,87,23,9,6,87,23,9,6,87,23,9,6,88,23,9,6,88,23,9,6,89,23,8,6,90,23,8,6,90,22,8,6,91,22,8,6,91,25,8,6,92,25,8,5,93,25,8,5,93,24,8,5,94,24,8,5,94,24,11,5,95,24,11,5,96,24,11,5,96,26,11,5,97,26,11,5,97,26,11,5,97,26,10,5,98,26,10,5,98,26,10,5,99,25,10,5,100,25,10,5,100,25,10,5,101,25,10,5,101,25,10,5,102,27,10,5,103,27,10,5,103,27,10,5,104,27,10,5,104,27,12,5,105,26,12,5,106,26,12,5,106,29,12,5,106,29,12,5,106,29,12,7,107,28,12,7,108,28,12,7,108,28,12,7,109,28,12,7,109,30,12,7,110,30,11,7,111,30,11,7,111,30,11,7,112,30,11,7,112,29,11,7,113,29,11,7,114,29,11,7,114,31,11,7,115,31,11,7,115,31,11,7,115,31,11,7,116,31,11,7,116,33,13,7,117,33,13,9,117,32,13,9,118,32,13,9,118,32,13,9,119,34,15,8,120,34,15,8,120,34,15,8,121,36,15,8,121,36,15,8,122,36,15,8,122,35,15,8,123,37,14,8,124,37,14,8,124,37,14,8,124,37,14,8,124,39,14,8,125,39,16,8,125,38,16,8,126,38,16,8,127,38,16,8,127,40,16,10,128,40,16,10,128,40,16,10,129,42,18,10,129,41,18,10,130,41,18,10,130,43,18,10,131,43,18,10,131,42,17,10,132,42,17,12,132,42,17,12,133,44,17,12,133,44,17,12,133,46,17,11,134,46,17,11,134,45,19,11,135,45,19,11,135,47,19,11,136,47,19,11,136,47,19,11,137,47,19,11,137,48,20,11,138,48,20,11,138,50,20,13,139,50,20,13,139,49,20,13,140,49,22,13,140,51,22,13,141,51,22,13,141,50,22,13,142,52,22,13,142,52,21,12,143,53,21,12,143,53,21,12,143,53,21,12,143,53,21,14,144,53,23,14,144,55,23,14,145,55,23,14,145,56,23,14,146,56,23,14,146,57,24,14,147,57,24,14,147,59,24,16,148,59,24,16,148,58,24,15,149,58,26,15,149,58,26,15,149,60,26,15,150,60,26,15,150,61,25,15,151,61,25,15,151,62,25,17,152,62,25,17,152,64,25,17,152,64,27,17,152,63,27,17,153,63,27,17,153,65,27,17,153,66,28,17,154,66,28,17,154,67,28,16,155,67,28,16,155,67,30,16,155,69,29,18,156,69,29,18,156,68,29,18,157,70,29,18,157,70,29,18,157,71,31,18,158,71,31,18,158,72,30,19,159,72,30,19,159,74,30,19,159,73,30,19,160,73,32,19,160,74,32,19,161,74,32,21,161,76,32,21,161,78,33,21,161,78,33,21,161,79,35,20,162,78,34,20,163,79,34,22,164,81,36,22,164,82,36,22,165,81,35,22,166,82,37,21,167,84,37,21,167,85,36,21,168,86,38,23,169,88,38,23,169,88,38,23,170,88,39,23,170,89,39,24,171,91,40,24,171,92,40,24,172,93,40,24,173,94,41,25,173,95,41,25,174,96,42,25,175,98,42,25,175,99,43,26,176,99,43,26,177,101,45,26,177,102,44,26,178,103,46,27,179,104,46,27,179,105,46,27,179,106,45,28,180,108,47,28,180,108,46,28,181,109,48,28,182,111,48,29,182,111,49,29,183,114,49,29,184,114,50,30,184,114,50,30,185,116,51,30,185,117,51,30,186,119,52,31,187,119,53,31,187,121,53,31,188,122,54,33,188,123,54,32,189,124,55,32,189,125,55,32,189,126,56,34,190,128,56,34,190,128,57,33,191,130,57,33,191,131,58,35,192,131,58,35,192,133,59,34,193,134,60,35,194,135,60,35,194,136,61,37,195,139,61,37,195,139,62,36,196,141,62,36,196,141,63,38,197,142,63,38,197,143,64,39,198,144,64,39,198,146,66,39,198,146,67,39,198,147,67,38,199,147,68,40,199,149,68,40,200,150,69,40,200,152,70,41,201,154,71,41,201,154,71,42,202,155,72,42,202,156,73,41,203,157,73,43,203,158,74,42,204,160,75,44,204,161,76,44,204,162,77,44,205,164,77,45,205,165,78,45,206,166,79,45,206,168,80,46,207,169,81,46,207,170,83,47,207,171,83,47,207,172,83,47,207,174,85,48,208,175,85,48,208,177,85,48,209,178,87,49,209,180,87,49,210,181,87,49,210,182,89,50,210,182,89,50,211,185,91,50,211,186,91,51,212,186,93,51,212,189,94,52,212,190,95,51,213,192,96,51,213,193,96,53,213,194,97,52,214,195,98,54,214,197,98,55,215,198,100,55,215,199,101,55,215,200,102,55,216,202,103,55,216,203,104,55,216,204,105,57,216,205,106,57,216,207,107,58,216,208,108,58,217,209,109,59,217,210,110,60,217,211,111,60,218,212,112,61,218,213,113,61,218,214,114,62,219,217,115,63,219,217,116,64,219,218,118,64,220,219,119,65,220,220,121,66,220,222,121,67,221,222,122,67,221,222,123,68,221,223,124,69,222,224,125,70,222,225,127,71,222,226,128,72,223,228,129,73,223,228,130,74,223,229,132,75,223,230,135,79,224,231,138,81,224,233,141,84,224,233,144,87,225,235,147,91,225,236,150,94,225,237,154,97,225,238,158,102,225,239,161,107,225,239,165,110,225,240,168,114,226,241,172,118,226,241,176,122,226,241,181,126,226,242,183,130,227,243,186,135,227,243,190,139,227,244,194,143,227,244,197,147,228,244,200,150,228,245,204,154,228,245,207,157,228,245,210,161,229,246,212,164,229,246,215,167,229,246,217,169,229,246,220,172,230,247,221,174,230]),lk=128,v_e=-bQ,b_e=0,JG=50,gMt=()=>1-511/512,yMt=pz([[50,.1015625],[500,.21875],[5e3,1-250/512],[5e4,.4140625]]);let YX=class extends Nf{constructor(e){super(e),this._passParameters=new J8,this._configuration=new Cse,this._vao=null,this._fadeVao=null,this._texV1=1;const i=e.view,r=or(i.spatialReference),{outerAtmosphereRimWidth:s,radius:n}=r;this._planetRadius=n,this._innerRimFactor=1+v_e/n,this._middleRimFactor=1+b_e/n,this._outerRimFactor=1+s/n,this._texV0=b_e/s,this._texVScale=this._texV1-this._texV0;const a=i.stage.renderView.techniques;a.precompile(z3,this._configuration),this._configuration.geometry=2,a.precompile(z3,this._configuration)}initialize(){this.addHandles(K(()=>this.view.environment.atmosphereEnabled,e=>e?this._enable():this._disable(),Wt))}destroy(){this._passParameters.texture=Rt(this._passParameters.texture),this._fadeVao=Rt(this._fadeVao),this._vao=Rt(this._vao)}render(e){const i=e.find(({name:s})=>s===ht.OPAQUE_ENVIRONMENT);this._update();const r=this.renderingContext;if(!this._passParameters.texture){const s=new Zi(1,512);s.wrapMode=33071,s.flipped=!0,this._passParameters.texture=new Fi(r,s,mMt)}if(this._passParameters.undergroundFadeAlpha<1){this._vao??=this._createRibbon(r),this._configuration.geometry=0;const s=this.techniques.get(z3,this._configuration);if(!s.compiled)return this.requestRender(1),i;r.bindTechnique(s,this.bindParameters,this._passParameters),r.bindVAO(this._vao),r.drawArrays(lr.TRIANGLES,0,this._vao.vertexCount("geometry"))}if(this._passParameters.undergroundFadeAlpha>0){this._fadeVao??=i1(r),this._configuration.geometry=2;const s=this.techniques.get(z3,this._configuration);if(!s.compiled)return this.requestRender(1),i;r.bindTechnique(s,this.bindParameters,this._passParameters),r.bindVAO(this._fadeVao),r.drawArrays(lr.TRIANGLE_STRIP,0,this._fadeVao.vertexCount("geometry"))}return i}_update(){const e=this.bindParameters.camera,i=R(),r=this._planetRadius,s=Le(e.eye),n=s-r;if(n<0){const _=Math.min(-n/5e3,1);this._passParameters.undergroundFadeAlpha=_}else this._passParameters.undergroundFadeAlpha=0;const a=Math.max(JG,n),o=r+v_e;this._passParameters.innerScale=_Mt(r+a,r,o)-1,this._passParameters.altitudeFade=Zte(n),le(i,e.eye,(r+JG)/s),w_e(i,e.center,e.up,r,this._passParameters.silhouette);const l=this._computeScreenRimWidth(e,i,e.up,this._passParameters.silhouette),c=gMt(),h=yMt(n);let f=this._texV0+c*this._texVScale,y=this._texV0+l*h*this._texVScale;if(n>JG){w_e(e.eye,e.center,e.up,r,this._passParameters.silhouette);const _=this._computeScreenRimWidth(e,e.eye,e.up,this._passParameters.silhouette),w=Se((_-1.5)/(l-1.5),0,1);f=this._texV0+w*c*this._texVScale,y=this._texV0+ft(this._texV1,l*h,w)*this._texVScale}Cr(this._passParameters.texV,f,y)}_createRibbon(e){const i=Lu(3+3*lk*3),r=new Uint32Array(3*lk*5);i[0]=0,i[1]=0,i[2]=-1;for(let a=0;a<lk;a++){const o=9*a+3;i[o]=a,i[o+1]=this._innerRimFactor,i[o+2]=-1,i[o+3]=a,i[o+4]=this._middleRimFactor,i[o+5]=0,i[o+6]=a,i[o+7]=this._outerRimFactor,i[o+8]=1;const l=3*a+1,c=a===lk-1?1:l+3,h=15*a;r[h]=l,r[h+1]=l+1,r[h+2]=c+1,r[h+3]=c+1,r[h+4]=c,r[h+5]=l,r[h+6]=l+1,r[h+7]=l+2,r[h+8]=c+2,r[h+9]=c+2,r[h+10]=c+1,r[h+11]=l+1,r[h+12]=l,r[h+13]=c,r[h+14]=0}const s=ED.createBuffer(r.length),n=s.position;for(let a=0;a<r.length;++a){const o=3*r[a];n.set(a,0,i[o]),n.set(a,1,i[o+1]),n.set(a,2,i[o+2])}return new Op(e,new Hs(e,Lo(ED),s.buffer))}_computeScreenRimWidth(e,i,r,s){return xe(JS,s.center,s.v2),le(ck,JS,this._outerRimFactor),kU(KG,i,JS,r),xfe(JS,KG,e.projectionMatrix,e.viewport,JS),xfe(ck,KG,e.projectionMatrix,e.viewport,ck),Ri(JS,ck)/e.height}};function w_e(t,e,i,r,s){const n=Le(t),a=r*Math.sqrt(n*n-r*r)/n,o=Math.sqrt(r*r-a*a),l=s.v1,c=s.v2;return le(s.center,t,o/n),bt(l,t,e),On(l)<1&&bt(l,t,i),le(l,l,a/Le(l)),bt(c,l,t),le(c,c,a/Le(c)),a}YX=d([k("esri.views.3d.environment.MarsAtmosphere")],YX);const KG=it(),JS=R(),ck=R();function _Mt(t,e,i){return t*t/(Math.sqrt(t*t-e*e)*Math.sqrt(t*t-i*i)+e*i)}function vMt(t,e,i){tLe(t.typedBuffer,e.typedBuffer,i,t.typedBufferStride,e.typedBufferStride)}function tLe(t,e,i,r=3,s=r){if(t.length/r!==Math.ceil(e.length/s))return t;const n=t.length/r,a=i[0],o=i[1],l=i[2],c=i[4],h=i[5],f=i[6],y=i[8],_=i[9],w=i[10],x=i[12],S=i[13],$=i[14];let A=0,M=0;for(let P=0;P<n;P++){const O=e[A],D=e[A+1],L=e[A+2];t[M]=a*O+c*D+y*L+x,t[M+1]=o*O+h*D+_*L+S,t[M+2]=l*O+f*D+w*L+$,A+=s,M+=r}return t}function iLe(t,e,i){rLe(t.typedBuffer,e.typedBuffer,i,t.typedBufferStride,e.typedBufferStride)}function rLe(t,e,i,r=3,s=r){if(t.length/r!==Math.ceil(e.length/s))return;const n=t.length/r,a=i[0],o=i[1],l=i[2],c=i[3],h=i[4],f=i[5],y=i[6],_=i[7],w=i[8];let x=0,S=0;for(let $=0;$<n;$++){const A=e[x],M=e[x+1],P=e[x+2];t[S]=a*A+c*M+y*P,t[S+1]=o*A+h*M+_*P,t[S+2]=l*A+f*M+w*P,x+=s,S+=r}}function bMt(t,e,i){sLe(t.typedBuffer,e.typedBuffer,i,t.typedBufferStride,e.typedBufferStride)}function sLe(t,e,i,r=3,s=r){const n=Math.min(t.length/r,e.length/s);let a=0,o=0;for(let l=0;l<n;l++)t[o]=i*e[a],t[o+1]=i*e[a+1],t[o+2]=i*e[a+2],a+=s,o+=r;return t}function wMt(t,e,i,r){nLe(t.typedBuffer,e.typedBuffer,i,r,t.typedBufferStride,e.typedBufferStride)}function nLe(t,e,i,r,s=3,n=s){const a=Math.min(t.length/s,e.length/n);let o=0,l=0;const c=1/DC;for(let h=0;h<a;h++)t[l]=r*(i*e[o])**c,t[l+1]=r*(i*e[o+1])**c,t[l+2]=r*(i*e[o+2])**c,o+=n,l+=s}function xMt(t,e,i,r=3,s=r){const n=t.length/r;if(n!==Math.ceil(e.length/s))return t;let a=0,o=0;for(let l=0;l<n;l++)t[o]=e[a]+i[0],t[o+1]=e[a+1]+i[1],t[o+2]=e[a+2]+i[2],a+=s,o+=r;return t}function SMt(t,e){aLe(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function aLe(t,e,i=3,r=i){const s=Math.min(t.length/i,e.length/r);let n=0,a=0;for(let o=0;o<s;o++){const l=e[n],c=e[n+1],h=e[n+2],f=l*l+c*c+h*h;if(f>0){const y=1/Math.sqrt(f);t[a]=y*l,t[a+1]=y*c,t[a+2]=y*h}n+=r,a+=i}}function TMt(t,e,i){const r=Math.min(t.count,e.count),s=t.typedBuffer,n=t.typedBufferStride,a=e.typedBuffer,o=e.typedBufferStride;let l=0,c=0;for(let h=0;h<r;h++)s[c]=a[l]>>i,s[c+1]=a[l+1]>>i,s[c+2]=a[l+2]>>i,l+=o,c+=n}Object.freeze(Object.defineProperty({__proto__:null,linearToSRGB:nLe,linearToSRGBView:wMt,normalize:aLe,normalizeView:SMt,scale:sLe,scaleView:bMt,shiftRight:TMt,transformMat3:rLe,transformMat3View:iLe,transformMat4:tLe,transformMat4View:vMt,translate:xMt},Symbol.toStringTag,{value:"Module"}));function $Mt(t,e){Mse(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function Mse(t,e,i=3,r=i){const s=e.length/r;let n=0,a=0;for(let o=0;o<s;++o)t[n]=e[a],t[n+1]=e[a+1],t[n+2]=e[a+2],n+=i,a+=r}function CMt(t,e,i,r,s){const n=t.typedBuffer,a=t.typedBufferStride,o=s?.count??t.count;let l=(s?.dstIndex??0)*a;for(let c=0;c<o;++c)n[l]=e,n[l+1]=i,n[l+2]=r,l+=a}Object.freeze(Object.defineProperty({__proto__:null,copy:Mse,copyView:$Mt,fill:CMt},Symbol.toStringTag,{value:"Module"}));let MMt=class{constructor(e){this._totalCount=e,this._componentCountCache=-1,this._indexRanges=[0,e]}allVisible(){return this.componentCount===this._totalCount}allInvisible(){return this._indexRanges.length===0}isVisible(e){if(e<0||e>=this._totalCount)return!1;if(this.allVisible())return!0;const i=this._indexRanges;let r=0,s=i.length/2;if(e<i[2*r]||e>i[2*s]+i[2*s+1])return!1;for(;s-r>0;){const n=Math.floor(.5*(r+s)),a=i[2*n];if(e<a){if(s-r===1)return!1;s=n;continue}if(e<a+i[2*n+1])return!0;if(s-r===1)return!1;r=n+1}return!1}get componentCount(){if(this._componentCountCache===-1){const e=this._indexRanges;let i=0;for(let r=0;r<e.length;r+=2)i+=e[r+1];this._componentCountCache=i}return this._componentCountCache}reset(e){e==="all"||e.length===this._totalCount?this._indexRanges=[0,this._totalCount]:this._indexRanges=EMt(e),this._componentCountCache=-1}forEachComponent(e){const i=this._indexRanges;for(let r=0;r<i.length;r+=2){const s=i[r],n=s+i[r+1];for(let a=s;a<n;a++)if(!e(a))return!1}return!0}forEachComponentRange(e){const i=this._indexRanges;for(let r=0;r<i.length;r+=2){const s=i[r];if(!e(s,s+i[r+1]))return!1}return!0}computeOffsetRanges(e){const i=new Array(this._indexRanges.length),r=this._indexRanges;for(let s=0;s<r.length;s+=2){const n=r[s],a=n+r[s+1],o=e[n],l=e[a];i[s]=o,i[s+1]=l-o}return i}};function EMt(t){const e=new Array;if(t.length===0)return e;let i=t[0],r=1;for(let s=1;s<t.length;s++){const n=t[s];i+r===n?r+=1:(e.push(i),e.push(r),i=n,r=1)}return e.push(i),e.push(r),e}let AMt=class{constructor(e,i){this.offsets=i,this._highlightsInOrder=[],this.pickability=null,this.componentHighlights=new Map,this.verticalOffsets=null,this._cachedGeometryRanges=null,this._cachedHighlightRangesMap=null,this._cachedShadowmapRanges=null;const r=this.count;this.visibility=new MMt(r),this.materialDataBuffer=e.getBuffer(r),this.materialDataIndices=new Uint16Array(r);for(let s=0;s<r;s++)this.materialDataIndices[s]=this.materialDataBuffer.acquireIndex()}destroy(){for(let e=0;e<this.count;e++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[e])}get count(){return this.offsets.length-1}get geometryRanges(){return this._cachedGeometryRanges==null&&(this._cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets)),this._cachedGeometryRanges}get highlightRangesMap(){return this.componentHighlights.size===0?null:(this._updateCachedHighlightRanges(),this._cachedHighlightRangesMap)}get shadowmapRanges(){return this.componentHighlights.size===0?this.geometryRanges:(this._updateCachedHighlightRanges(),this._cachedShadowmapRanges)}markHighlightsDirty(){this._cachedHighlightRangesMap=null,this._cachedShadowmapRanges=null}markVisibilityDirty(){this._cachedGeometryRanges=null,this.markHighlightsDirty()}updateHighlights(e){this._updateHighlightOrder(e)&&(this.markHighlightsDirty(),this._updateCachedHighlightRanges())}_updateHighlightOrder(e){const{_highlightsInOrder:i}=this;let r=i.length!==e.length;i.length=Math.min(e.length,8);for(let s=0;s<e.length;++s){const n=e.at(s).name;i.length<s?(r=!0,i.push(n)):i[s]!==n&&(i[s]=n,r=!0)}return r}_updateCachedHighlightRanges(){if(this._cachedHighlightRangesMap==null||this._cachedShadowmapRanges==null){const{highlightRangesMap:e,shadowmapRangesMap:i}=OMt(this.componentHighlights,this.visibility,this.offsets,this._highlightsInOrder);this._cachedHighlightRangesMap=e,this._cachedShadowmapRanges=i}}};function OMt(t,e,i,r){const s=new Map,n=[];if(t.size>0){let a=i.length;e.forEachComponent(o=>{let l=!1;for(let c=r.length-1;c>=0;--c){const h=r[c];if((t.get(h)?.[o]??0)>0){const y=Cu(s,h,()=>[]),_=i[o],w=i[o+1];y.push(_),y.push(w-_),l||=h===Tp;break}}return l||(a!==o-1&&(n.length>0&&n.push(i[a+1]-n[n.length-1]),n.push(i[o])),a=o),!0}),n.length>0&&n.push(i[a+1]-n[n.length-1])}return{highlightRangesMap:s,shadowmapRangesMap:n}}let PMt=class{constructor(e,i,r,s,n,a){this.transform=e,this.toMapSpace=i,this.obb=r,this.componentData=s,this.renderable=n,this.intersectionGeometry=a,this.visible=!1,this.offsetObb=null,this._aabbInWorldCoordinates=null}destroy(){this.intersectionGeometry=Re(this.intersectionGeometry),this.renderable=Re(this.renderable),this.componentData=Re(this.componentData)}get aabbInWorldCoordinates(){let e=this._aabbInWorldCoordinates;return e||(e=this._computeAabbInWorldCoordinates(),this._aabbInWorldCoordinates=e),e}_computeAabbInWorldCoordinates(){const e=ul(),{positions:i}=this.intersectionGeometry;if(Math.floor(i.length/3)>0){const{rotationScale:r,position:s}=this.transform;let n=1/0,a=1/0,o=1/0,l=-1/0,c=-1/0,h=-1/0;const f=R();for(let y=0;y<i.length;y+=3)ve(f,i[y+0],i[y+1],i[y+2]),rl(f,f,r),xe(f,f,s),n=Math.min(n,f[0]),a=Math.min(a,f[1]),o=Math.min(o,f[2]),l=Math.max(l,f[0]),c=Math.max(c,f[1]),h=Math.max(h,f[2]);e[0]=n,e[1]=a,e[2]=o,e[3]=l,e[4]=c,e[5]=h}return e}};function RMt(t,e,i,r,s,n,a){const o=n-a,l=e-t,c=new Float64Array(4*l);for(let h=0;h<l;++h){const f=3*(h+t),y=s*i[f+0],_=r[y+0],w=r[y+1],x=o/(r[y+2]-a),S=_*x,$=w*x,A=s*i[f+1],M=r[A+0],P=r[A+1],O=o/(r[A+2]-a),D=M*O,L=P*O,F=s*i[f+2],U=r[F+0],N=r[F+1],j=o/(r[F+2]-a),B=U*j,Y=N*j,G=4*h;c[G+0]=Math.min(S,D,B),c[G+1]=Math.min($,L,Y),c[G+2]=Math.max(S,D,B),c[G+3]=Math.max($,L,Y)}return c}function DMt(t,e,i,r,s){const n=e-t,a=new Float64Array(4*n);for(let o=0;o<n;++o){const l=3*(o+t),c=s*i[l+0],h=r[c+0],f=r[c+1],y=s*i[l+1],_=r[y+0],w=r[y+1],x=s*i[l+2],S=r[x+0],$=r[x+1],A=4*o;a[A+0]=Math.min(h,_,S),a[A+1]=Math.min(f,w,$),a[A+2]=Math.max(h,_,S),a[A+3]=Math.max(f,w,$)}return a}function IMt(t,e){return new(LMt(t))(e)}function LMt(t){return t<128?Uint8Array:t<32768?Uint16Array:t<1<<31?Uint32Array:Array}function x_e(t,e,i,r){const[s,n,a]=r??t,o=a-i,l=e/Math.sqrt(s*s+n*n+o*o);t[0]+=s*l,t[1]+=n*l,t[2]+=o*l}let oLe=class{constructor(e,i){this.elementCount=e,this.model=i,this._elementIndexMap=null,this._bspNodes=[],this._generatedBVH=!1,this.localMode=i.localMode,this.planetCenterZ=i.planetCenterZ,this.geometryMinZ=i.geometryMinZ,this.planetCenter=Ge(0,0,this.planetCenterZ),this.maxBspNodeDepth=i.maxBspNodeDepth??8,this.minElementCountForBVH=i.minElementCountForBVH??15,this.minBspNodeElementCount=i.minBspNodeElementCount??5}get elementIndexMap(){return this._ensureBVH(),this._elementIndexMap}get _skipBVH(){return this.elementCount<this.minElementCountForBVH||this.geometryMinZ<.5*this.planetCenterZ}_ensureBVH(){this._generatedBVH||this._skipBVH||this._bspNodes.length===0&&this._generateBsp()}intersectRay(e,i,r){this.elementCount<1||(this._skipBVH?this._intersectRayWithoutBVH(r):this._intersectRayWithBVH(e,i,r))}_intersectRayWithoutBVH(e){this._intersectRange(0,this.elementCount)}_intersectRange(e,i){this.model.intersectRange(e,i)}_intersectRayWithBVH(e,i,r){this._ensureBVH(),r?this._intersectGeometryWithBVHVerticalRay(e):this._intersectGeometryWithBVHGeneralRay(e,i)}_intersectGeometryWithBVHVerticalRay(e){let i=e[0],r=e[1];if(!this.localMode){const{geometryMinZ:a,planetCenterZ:o}=this,l=(a-o)/(e[2]-o);i=e[0]*l,r=e[1]*l}const{_bspNodes:s}=this;let n=0;for(;n>=0;){const a=s[n],{d:o,dim:l,minIndexIndex:c,minMidIndexIndex:h,maxMidIndexIndex:f,maxIndexIndex:y,aabb2D:_}=a;if(i<_[0]||i>_[2]||r<_[1]||r>_[3])break;if(l===-1||a.child0===-1&&a.child1===-1){this._intersectRange(c,y);break}{this._intersectRange(h,f);const w=(l===0?i:r)-o;if(w<0){if(a.child0===-1){this._intersectRange(c,h);break}n=a.child0}else{if(!(w>0))break;if(a.child1===-1){this._intersectRange(f,y);break}n=a.child1}}}}_intersectGeometryWithBVHGeneralRay(e,i){let r=e[0],s=e[1],n=i[0],a=i[1];const{geometryMinZ:o}=this;if(!this.localMode){let w=0,x=1;const S=Math.min(.5*this.planetCenterZ,o),$=e[2],A=i[2];if($<S&&A<S||($<S&&(w=(S-$)/(A-$)),A<S&&(x=(S-$)/(A-$)),w>x))return;const M=(1-w)*e[0]+w*i[0],P=(1-w)*e[1]+w*i[1],O=(1-w)*e[2]+w*i[2],D=(1-x)*e[0]+x*i[0],L=(1-x)*e[1]+x*i[1],F=(1-x)*e[2]+x*i[2],{planetCenterZ:U}=this,N=o-U,j=N/(O-U);r=M*j,s=P*j;const B=N/(F-U);n=D*B,a=L*B}const l=n-r,c=a-s,h=this._bspNodes;let f=1;{const{aabb2D:w}=h[0],x=(A,M,P,O)=>{if(Math.abs(M)<1e-5*Math.max(O-P,1))return!1;const D=M>0,L=D?O:P,F=A+f*M;return(D?F<L:F>L)&&(f=Math.max((L-A)/M,f),!0)},S=()=>x(r,l,w[0],w[2]),$=()=>x(s,c,w[1],w[3]);Math.abs(l)>=Math.abs(c)?S()||$():$()||S()}const y=[0,0,f];let _=0;for(;_<y.length;){const w=y[_];let x=y[_+1],S=y[_+2];if(_+=3,x>S)continue;const $=h[w],{minIndexIndex:A,maxIndexIndex:M}=$,{child0:P,child1:O,minMidIndexIndex:D,maxMidIndexIndex:L,aabb2D:F,d:U,dim:N}=$;{const j=r+x*l,B=r+S*l,Y=Math.min(j,B),G=Math.max(j,B),Z=F[0],H=F[2];if(G<Z||H<Y)continue;if(Y<Z){const Q=(Z-r)/l;l>0?x=Math.max(x,Q):S=Math.min(S,Q)}if(H<G){const Q=(H-r)/l;l>0?S=Math.min(S,Q):x=Math.max(x,Q)}}{const j=s+x*c,B=s+S*c,Y=Math.min(j,B),G=Math.max(j,B),Z=F[1],H=F[3];if(G<Z||H<Y)continue;if(Y<Z){const Q=(Z-s)/c;c>0?x=Math.max(x,Q):S=Math.min(S,Q)}if(H<G){const Q=(H-s)/c;c>0?S=Math.min(S,Q):x=Math.max(x,Q)}}if(P===-1&&O===-1)this._intersectRange(A,M);else{const j=N===0?r:s,B=N===0?l:c,Y=j+x*B,G=j+S*B,Z=Math.min(Y,G),H=Math.max(Y,G),Q=Se((U-j)/B,0,f);A<D&&Z<=U&&(P!==-1?(y.push(P),y.push(B>=0?x:Math.max(x,Q)),y.push(B>=0?Math.min(S,Q):S)):this._intersectRange(A,D)),this._intersectRange(D,L),L<M&&U<=H&&(O!==-1?(y.push(O),y.push(B>=0?Math.max(x,Q):x),y.push(B>=0?S:Math.min(S,Q))):this._intersectRange(L,M))}}}_generateBsp(){const{elementCount:e}=this;if(e<1)return;const i=IMt(e,e);this._elementIndexMap=i;for(let _=0;_<e;++_)i[_]=_;const r=this.model.getAabbs2D();let s=0;const n=this._bspNodes;n.length=0;const{localMode:a}=this;let o=!1;if(!a){const{planetCenterZ:_,geometryMinZ:w}=this;o=_>=0||w<.5*_}const l=[],c=(_,w,x,S,$)=>{l.push(_),l.push(w),l.push(x),l.push(S<0?-1:($?0:1)+2*S)},{maxBspNodeDepth:h,minBspNodeElementCount:f}=this,y=(_,w,x,S,$)=>{const A=n.length;if(A>0&&(o||x>=h||w-_<f))return;const M=Pi();NMt(M,_,w,i,r);const{d:P,dim:O}=a?kMt(M):zMt(M),{rangeMidStart:D,rangeMidEnd:L}=FMt(_,w,O,P,i,r),F=x===h-1,U=!F&&D>=_+f,N=!F&&w>=L+f;if(U||N||A===0){const j=new VMt(_,D,L,w,O,P,M);if(U&&c(_,D,x+1,A,!0),N&&c(L,w,x+1,A,!1),n.push(j),S!==-1){const B=n[S];$?B.child0=A:B.child1=A}}};for(c(0,e,0,-1,!1);s<l.length;){const _=l[s],w=l[s+1],x=l[s+2],S=l[s+3];s+=4;const $=S>>1;y(_,w,x,$,S-($<<1)==0)}this._generatedBVH=!0}};function kMt(t){const e=t[0],i=t[1],r=t[2],s=t[3];let n,a;return r-e>=s-i?(a=.5*(e+r),n=0):(a=.5*(i+s),n=1),{d:a,dim:n}}function zMt(t){const e=t[0],i=t[1],r=t[2],s=t[3];let n,a;return r-e>=s-i?(n=0,a=.5*(e+r)):(n=1,a=.5*(i+s)),{dim:n,d:a}}function FMt(t,e,i,r,s,n){let a=t;{let h=e;for(;a<h;){const f=s[a];S_e(f,i,r,n)<0?++a:(--h,s[a]=s[h],s[h]=f)}}const o=a;let l=a,c=e;for(;l<c;){const h=s[c-1];S_e(h,i,r,n)>0?--c:(s[c-1]=s[l],s[l]=h,++l)}return{rangeMidStart:o,rangeMidEnd:c}}function S_e(t,e,i,r){const s=4*t,n=r[s+0+e];return r[s+2+e]<i?-1:n>i?1:0}function NMt(t,e,i,r,s){let n=1/0,a=1/0,o=-1/0,l=-1/0;for(let c=e;c<i;++c){const h=4*r[c];n=Math.min(n,s[h+0]),a=Math.min(a,s[h+1]),o=Math.max(o,s[h+2]),l=Math.max(l,s[h+3])}t[0]=n,t[1]=a,t[2]=o,t[3]=l}let VMt=class{constructor(e,i,r,s,n,a,o){this.minIndexIndex=e,this.minMidIndexIndex=i,this.maxMidIndexIndex=r,this.maxIndexIndex=s,this.dim=n,this.d=a,this.aabb2D=o,this.child0=-1,this.child1=-1}},UMt=class{constructor(e,i,r,s,n,a,o,l,c){this.componentIndex=e,this.vertexData=i,this.vertexStride=r,this.indexData=s,this.startTriangleNumber=n,this.endTriangleNumber=a,this.geometryMinZ=o,this.planetCenterZ=l,this.localMode=c,this.maxBspNodeDepth=8,this.minElementCountForBVH=20,this.minBspNodeElementCount=10,this.rayDirection=R(),this.ray0=R(),this.isVerticalRay=!1,this._triangleHitCallback=T_e,this.totalElevationOffset=0,this.normalRequired=!1,this._bvh=new oLe(a-n,this)}getAabbs2D(){return this.localMode?DMt(this.startTriangleNumber,this.endTriangleNumber,this.indexData,this.vertexData,this.vertexStride):RMt(this.startTriangleNumber,this.endTriangleNumber,this.indexData,this.vertexData,this.vertexStride,this.geometryMinZ,this.planetCenterZ)}get numTriangles(){return this.endTriangleNumber-this.startTriangleNumber}intersectRay(e,i,r,s,n,a){de(this.ray0,e),ui(this.rayDirection,i,e),this.isVerticalRay=r,this.totalElevationOffset=s,this.normalRequired=a,this._triangleHitCallback=n,this._bvh.intersectRay(e,i,r),this._triangleHitCallback=T_e}intersectRange(e,i){const r=this._bvh.elementIndexMap;lLe(this.ray0,this.rayDirection,e,i,this.indexData,this.vertexData,this.vertexStride,this.totalElevationOffset,this.planetCenterZ,this.normalRequired,this._triangleHitCallback,r,this.startTriangleNumber)}getTriangleElevationOffset(e){return this.totalElevationOffset}};function lLe(t,e,i,r,s,n,a,o,l,c,h,f=null,y=0){o!==0?n0t(t,e,i,r,s,n,a,o,l,c,h,f,y):QRe(t,e,i,r,s,n,a,c,h,f,y)}function T_e(){}function BMt(t,e,i){const r=t.count;if(e>=r)return;t.pickability??=new Uint32Array(0);let s=t.pickability;const n=uLe(s),a=e/n|0,o=e-n*a,l=(r-1)/n|0,c=s;if(!(e<c.length*n)&&!i){const h=a+1,f=Math.ceil(c.length*ZV),y=l+1;let _=Math.max(h,f);_=Math.min(_,y),t.pickability=s=new Uint32Array(_),s.set(c)}a<s.length&&(s[a]=qMt(s[a],o,!i))}function cLe(t,e){if(t==null)return!0;const i=uLe(t);return!(e<t.length*i)||jMt(t,e,i)}function jMt(t,e,i){const r=e/i|0,s=e-r*i;return!GMt(t[r],s)}function uLe(t){return t.BYTES_PER_ELEMENT*8}function qMt(t,e,i){return t&~(1<<e)|(i?1:0)<<e}function GMt(t,e){return!!(t&1<<e)}let HMt=class{constructor(e,i,r,s,n,a,o,l){this.vertexData=e,this.vertexStride=i,this.indexData=r,this._components=s,this._componentAabbs3D=n,this.geometryMinZ=a,this.planetCenterZ=o,this.localMode=l,this.maxBspNodeDepth=6,this.minElementCountForBVH=10,this.minBspNodeElementCount=3,this._ray0=QMt,this._ray1=XMt,this._invDir=R(),this._componentVerticalOffsets=null,this._verticalOffset=null,this._tolerance=0,this._intersectionOptions=JMt,this._callback=$_e,this.rayDirectionC=R(),this._componentIndexMap=null,this._bvh=new oLe(s.count,this),this.componentIntersectionData=new Array(s.count)}get numComponents(){return this._components.count}get minZGlobal(){return this.geometryMinZ-this.planetCenterZ}getAabbs2D(){return this.localMode?this.getAabbs2DLocal():this.getAabbs2DGlobal()}getAabbs2DGlobal(){const{numComponents:e,planetCenterZ:i,minZGlobal:r}=this,s=iD(4*e),n=this._componentAabbs3D;for(let a=0;a<e;++a){const o=6*a,l=n[o+0],c=n[o+1],h=n[o+2],f=n[o+3],y=n[o+4],_=r/(h-i),w=r/(n[o+5]-i),x=Math.min(l*_,l*w),S=Math.min(c*_,c*w),$=Math.max(f*_,f*w),A=Math.max(y*_,y*w),M=4*a;s[M+0]=x,s[M+1]=S,s[M+2]=$,s[M+3]=A}return s}getAabbs2DLocal(){const{numComponents:e}=this,i=iD(4*e),r=this._componentAabbs3D;for(let s=0;s<e;++s){const n=6*s,a=r[n+0],o=r[n+1],l=r[n+3],c=r[n+4],h=4*s;i[h+0]=a,i[h+1]=o,i[h+2]=l,i[h+3]=c}return i}intersectRay(e,i,r,s,n,a){const{isVerticalRay:o}=r;this._ray0=e,this._ray1=i,this._componentVerticalOffsets=n??null,this._verticalOffset=a??null,this._tolerance=r.tolerance,this._intersectionOptions=r,this._componentIndexMap=this._bvh.elementIndexMap,h0t(e,i,this._invDir),this._callback=s,this._bvh.intersectRay(e,i,o),this._callback=$_e}intersectRange(e,i){const r=this._componentIndexMap,{pickability:s,visibility:n}=this._components;for(let a=e;a<i;++a){const o=r?r[a]:a;cLe(s,o)&&n.isVisible(o)&&this._intersectComponent(o)}}getComponentTriangleCount(e){const i=this._components.offsets,r=i[e]/3;return i[e+1]/3-r}getComponentAabb3D(e,i){const r=this._componentAabbs3D,s=6*e;return i[0]=r[s],i[1]=r[s+1],i[2]=r[s+2],i[3]=r[s+3],i[4]=r[s+4],i[5]=r[s+5],i}_intersectComponent(e){const i=this.getComponentAabb3D(e,WMt);let r=!1;const{localMode:s,_componentVerticalOffsets:n,_verticalOffset:a,_ray0:o,_ray1:l,_invDir:c,planetCenterZ:h,_tolerance:f,rayDirectionC:y,componentIntersectionData:_}=this,{isVerticalRay:w}=this._intersectionOptions,x=this._components.offsets,S=de(ZMt,o),$=de(YMt,l),A=n?.[e]??0,M=A+(a?.offset??0);if(M!==0&&(s?(S[2]=o[2]-M,$[2]=l[2]-M,r=!0):(a!=null&&(a.componentOffset=A),w&&(x_e(S,-M,h,o),x_e($,-M,h,l),r=!0))),a==null||r||M===0||a.applyToAabb(i),!JRe(i,S,c,f))return;ui(y,$,S);const P=x[e]/3,O=x[e+1]/3,D=O-P,L=(Y,G,Z)=>{this._callback(Y,G,e,Z)},{vertexData:F,vertexStride:U,indexData:N,_intersectionOptions:j}=this,{normalRequired:B}=j;if(D>KMt){let Y=_[e];Y==null&&(Y=new UMt(e,F,U,N,P,O,this.geometryMinZ,h,s),_[e]=Y),Y.intersectRay(S,$,w,r?0:M,L,B)}else lLe(S,y,P,O,N,F,U,r?0:M,h,B,L)}};const WMt=ul(),ZMt=R(),YMt=R(),QMt=R(),XMt=R(),$_e=()=>{},JMt=new M8,KMt=40;let eEt=class{constructor(e,i,r,s,n,a){this._componentOffsets=a,this._accelerationData=new M5e(r,s,n,new d4(e,3,i))}intersectRay(e,i,r,s){const n=(a,o,l)=>{const c=tEt(this._componentOffsets,o);s(a,o,c,l)};this._accelerationData.intersectRay(e,i,r,n)}};function tEt(t,e){const{length:i}=t;if(i===0||e<t[0])return-1;if(e>t[i-1])return i;let r=0,s=i-1;for(;s-r>1;){const n=Math.round(.5*(r+s));e<=t[n]?s=n:r=n}return r}let iEt=class{constructor(e,i,r,s){this.viewingMode=e,this.positionData=i,this._components=r,this._needsElevationAlignment=s,this.verticalOffset=null,this.componentVerticalOffsets=null,this._planetCenter=R(),this._componentBvh=null,this._aabb=ul(),this._indices=i.indices?d8(i.indices):xM(i.positions.length/3),this._positions=i.positions}destroy(){this._positions=null,this._indices=null,this._perComponentAabbs=null,this._componentBvh=null}getComponentAabb(e,i){const r=this._ensureComponentAabbs(),s=6*e;return i[0]=r[s],i[1]=r[s+1],i[2]=r[s+2],i[3]=r[s+3],i[4]=r[s+4],i[5]=r[s+5],i}getComponentAabbs(){return this._ensureComponentAabbs()}_ensureComponentAabbs(){return this._perComponentAabbs||(this._perComponentAabbs=this._computePerComponentAabbs()),this._perComponentAabbs}getComponentPositions(e,i){i.indices=this._indices,i.data=this._positions,i.stride=3,i.startIndex=this._components.offsets[e],i.endIndex=this._components.offsets[e+1]}intersect(e,i,r,s,n,a,o){this.verticalOffset=r,this.componentVerticalOffsets=s;const{position:l}=n,c=ui(rEt,e,l),h=ui(sEt,i,l),f=i2(nEt,n.rotationScale);rl(c,c,f),rl(h,h,f);const y=qv(oEt,f);if(this.viewingMode===1){const w=this._planetCenter;Gh(w,l),rl(w,w,f)}const _=(w,x,S,$)=>{o(S,w,$?rl(aEt,$,y):null,x)};this._intersectComponents(c,h,s,r,_,a)}_computePerComponentAabbs(){const e=this._aabb,i=.5*(e[0]+e[3]),r=.5*(e[1]+e[4]),s=.5*(e[2]+e[5]),n=this._components.count,a=Lu(6*n),o=this._indices,l=this._positions,c=this._components.offsets;let h=0,f=1/0,y=1/0,_=1/0,w=-1/0,x=-1/0,S=-1/0;for(let $=0;$<n;$++){const A=c[$],M=c[$+1];let P=1/0,O=1/0,D=1/0,L=-1/0,F=-1/0,U=-1/0;if(A<M)for(let N=A;N<M;N++){const j=3*o[N],B=l[j],Y=l[j+1],G=l[j+2];P=Math.min(P,B),O=Math.min(O,Y),D=Math.min(D,G),L=Math.max(L,B),F=Math.max(F,Y),U=Math.max(U,G)}else P=i,O=r,D=s,L=i,F=r,U=s;a[h++]=P,a[h++]=O,a[h++]=D,a[h++]=L,a[h++]=F,a[h++]=U,f=Math.min(f,P),y=Math.min(y,O),_=Math.min(_,D),w=Math.max(w,L),x=Math.max(x,F),S=Math.max(S,U)}return this._aabb[0]=f,this._aabb[1]=y,this._aabb[2]=_,this._aabb[3]=w,this._aabb[4]=x,this._aabb[5]=S,a}_intersectComponents(e,i,r,s,n,a){let o=this._componentBvh;o==null&&(o=this._needsElevationAlignment?new HMt(this._positions,C_e,this._indices,this._components,this._ensureComponentAabbs(),this.geometryMinZ,this.planetCenterZ,this.localMode):new eEt(this._positions,C_e,this._indices,0,this.numTriangles,this._components.offsets),this._componentBvh=o),o.intersectRay(e,i,a,n,r??void 0,s??void 0)}get geometryMinZ(){return this._aabb[2]}get planetCenterZ(){return this._planetCenter[2]}get numTriangles(){return this._indices.length/3}get localMode(){return this.viewingMode===2}get positions(){return this._positions}get indices(){return this._indices}get aabb(){return this._ensureComponentAabbs(),this._aabb}};const rEt=R(),sEt=R(),nEt=Ir(),aEt=R(),oEt=Ir(),C_e=3;let lEt=class{constructor(e,i,r){this.material=e,this.geometry=i,this.meta=r}destroy(){this.material.dispose(),this.geometry.dispose()}},cEt=class{constructor(e,i,r,s){this.vao=e,this.primitiveType=i,this.parameters=r,this.indexed=s}dispose(){this.vao.dispose()}};function uEt(t,e){const i=new Ua,{eye:r,frustum:s,viewForward:n}=t;e.forAll(a=>{const o=a.offsetObb!=null?a.offsetObb:a.obb,l=Oe(ui(fu,o.center,r),n),c=o.projectedRadius(n);if(i.within(l-c)&&i.within(l+c))return;const h=mEt(o,s);if(h===-1)return;if(h===0)return Um.far=l+c,Um.near=l-c,void i.union(Um);const f=uk.pushNew();f.near=l-c,f.far=l+c,f.mask=h,f.object=a});for(let a=0;a<uk.length;a++){const o=uk.data[a];if(i.within(o.near)&&i.within(o.far))continue;Um.far=o.far,Um.near=1/0,fEt(o.object.offsetObb!=null?o.object.offsetObb:o.object.obb,r,hEt,c=>{let h=dEt;for(let f=0;f<hLe&&c.length>0;f++){if(!(o.mask&1<<f))continue;pEt(s[f],c,h);const y=c;c=h,h=y}for(let f=0;f<c.length;f+=3){ve(Ol,c.data[f],c.data[f+1],c.data[f+2]);const y=Oe(ui(Ol,Ol,r),n);Um.near=Math.min(Um.near,y)}})===0&&(Um.near=0),i.union(Um)}return uk.length=0,i}const uk=new _i({allocator:t=>t||{near:1/0,far:-1/0,mask:0,object:null},deallocator:t=>(t.object=null,t)}),Um=new Ua,Ol=R(),G1=R(),hEt=new _i({deallocator:null}),dEt=new _i({deallocator:null});function pEt(t,e,i){i.length=0;const r=e.length-3;eH(Ol,e,r);const s=va(t,Ol);s<=0&&(i.push(Ol[0]),i.push(Ol[1]),i.push(Ol[2]));let n=0,a=s;for(;n<r;n+=3){eH(G1,e,n);const o=va(t,G1);a*o<0&&(Wi(Ol,G1,Ol,o/(o-a)),Pl(i,Ol)),o<=0&&Pl(i,G1),a=o,de(Ol,G1)}a*s<0&&(eH(G1,e,r),Wi(Ol,G1,Ol,s/(s-a)),Pl(i,Ol))}function eH(t,e,i){return ve(t,e.data[i],e.data[i+1],e.data[i+2])}function Pl(t,e){t.push(e[0]),t.push(e[1]),t.push(e[2])}function fEt(t,e,i,r){H_(E_e,t.quaternion),ui(fu,e,t.center),Tc(fu,fu,E_e);const s=t.halfSize,n=8*((fu[0]<-s[0]?-1:fu[0]>s[0]?1:0)+3*(fu[1]<-s[1]?-1:fu[1]>s[1]?1:0)+9*(fu[2]<-s[2]?-1:fu[2]>s[2]?1:0)+13),a=M_e[n];if(a===0)return a;kR(hk,t.quaternion),KD(hk,hk,t.halfSize);const o=(l,c)=>{const h=M_e[n+c+1];return ve(l,((1&h)<<1)-1,(2&h)-1,((4&h)>>1)-1),rl(l,l,hk),xe(l,t.center,l)};return i.length=0,Pl(i,o(tH,0)),Pl(i,o(A_e,1)),Pl(i,o(fu,2)),Pl(i,o(O_e,3)),r(i),a===1||(i.length=0,Pl(i,tH),Pl(i,O_e),Pl(i,o(fu,4)),Pl(i,o(P_e,5)),r(i),a===2||(i.length=0,Pl(i,tH),Pl(i,P_e),Pl(i,o(fu,6)),Pl(i,A_e),r(i))),a}const M_e=(()=>{const t=new Array(216);let e=0;const i=r=>{for(let s=0;s<r.length;s++)t[e+s]=r[s];e+=8};return i([3,0,6,2,3,1,5,4]),i([2,0,2,3,1,5,4,0]),i([3,1,0,2,3,7,5,4]),i([2,0,1,3,2,6,4,0]),i([1,0,1,3,2,0,0,0]),i([2,1,5,7,3,2,0,0]),i([3,2,0,1,3,7,6,4]),i([2,2,0,1,3,7,6,0]),i([3,3,0,1,5,7,6,2]),i([2,0,1,5,4,6,2,0]),i([1,0,1,5,4,0,0,0]),i([2,1,3,7,5,4,0,0]),i([1,0,2,6,4,0,0,0]),i([0,0,0,0,0,0,0,0]),i([1,1,3,7,5,0,0,0]),i([2,2,3,7,6,4,0,0]),i([1,2,3,7,6,0,0,0]),i([2,3,1,5,7,6,2,0]),i([3,4,0,1,5,7,6,2]),i([2,5,7,6,4,0,1,0]),i([3,5,0,1,3,7,6,4]),i([2,4,5,7,6,2,0,0]),i([1,4,5,7,6,0,0,0]),i([2,5,1,3,7,6,4,0]),i([3,6,0,2,3,7,5,4]),i([2,6,2,3,7,5,4,0]),i([3,7,6,2,3,1,5,4]),t})(),hLe=4;function mEt(t,e){let i=0;for(let r=0;r<hLe;r++){const s=t.intersectPlane(e[r]);if(s>0)return-1;s===0&&(i|=1<<r)}return i}const hk=Ir(),E_e=Kh(),fu=R(),tH=R(),A_e=R(),O_e=R(),P_e=R();let gEt=class{constructor(e){this._objects=e}destroy(){this._objects=null}submit(e,i){this._objects.preSubmit(i),this._objects.visibleObjects.forAll(r=>r.renderable.material.submit(e,i,r))}queryDepthRange(e){return this._objects.visibleObjects.length?uEt(e,this._objects.visibleObjects):null}get hasEmissions(){return this._objects.visibleObjects.some(e=>e.renderable.material.hasEmissions)}hasHighlight(e){return this._objects.hasHighlight(e)}},eii=class{constructor(e,i,r,s){this.vertices=e,this.positionData=i,this.indices=r,this.componentOffsets=s}},iii=class extends hr{constructor(e,i,r,s,n){super(),this.hasVertexColors=e,this.textureCoordinateType=i,this.hasNormals=r,this.shadeNormals=s,this.applySSAO=n}};function dLe(t){const e=jc().vec3f("position");return t.hasNormals&&e.vec2i16("normalCompressed",{glNormalized:!0}),t.textureCoordinateType===1?e.vec2f("uv0"):t.textureCoordinateType===2&&(e.vec2f("uv0"),e.vec4u16("uvRegion",{glNormalized:!0})),t.hasVertexColors&&e.vec4u8("color",{glNormalized:!0}),e.freeze()}let yEt=class{constructor(){this.externalColor=ri(),this.externalColorMixMode=1,this.castShadows=!0,this.pickable=!0,this.elevationOffset=0,this.emissiveStrength=__t,this.emissiveSource=0}};function _Et(t){t.vertex.code.add(E`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${E.int(1)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${E.int(3)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${E.int(4)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${E.int(1)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)}let vEt=class extends Ni{constructor(e,i){super(e,"int",2,(r,s,n)=>r.setUniform1i(e,i(s,n)))}};const pLe=429496.7296;function bEt(t,e){OCt(t/pLe*.5+.5,e)}const fLe=1e6;function wEt(t,e){PCt(t/fLe*.5+.5,e)}function mLe(){return 3+(Jh()?1:0)}function xEt(t,e){switch(e.componentData){case 1:return SEt(t,e);case 0:return TEt(t,e);case 2:return;default:e.componentData}}function SEt(t,e){const{vertex:i,fragment:r}=t;i.include(J5e),i.uniforms.add(new Dv("componentColorTex",o=>o.componentParameters.texture.texture)),t.attributes.add("componentIndex","float"),t.varyings.add("vExternalColorMixMode","mediump float"),t.varyings.add("vExternalColor","vec4");const{output:s}=e,n=s===10;n&&t.varyings.add("vObjectAndLayerIdColor","vec4");const a=s===1;a&&(t.varyings.add("emissiveStrength","float"),t.varyings.add("emissiveSource","int")),t.include(_Et),i.constants.add("stride","float",mLe()),i.code.add(E`vec2 getComponentTextureCoordinates(float componentIndex, float typeOffset) {
float index = componentIndex * stride + typeOffset;
float texSize = float(textureSize(componentColorTex, 0).x);
float coordX = mod(index, texSize);
float coordY = floor(index / texSize);
return vec2(coordX, coordY) + 0.5;
}`),i.code.add(E`
  vec4 _readComponentColor() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 0.0);
    return texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
   }

  float readElevationOffset() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 1.0);
    vec4 encodedElevation = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
    return uninterpolatedRGBAToFloat(encodedElevation) * ${E.float(pLe)};
  }

  void forwardEmissiveStrength() {
    ${_e(a,E`vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 2.0);
           vec4 encodedEmissive = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
           emissiveStrength = uninterpolatedRGBToFloat(encodedEmissive.rgb) * ${E.float(fLe)};
           emissiveSource = encodedEmissive.a == 0.0 ? 0 : 1;`)}
  }

  void forwardObjectAndLayerIdColor() {
    ${_e(n,E`vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 3.0);
           vObjectAndLayerIdColor = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);`)}
  }

  vec4 forwardExternalColor(out bool castShadows) {
    vec4 componentColor = _readComponentColor() * 255.0;

    float shadowFlag = mod(componentColor.b * 255.0, 2.0);
    componentColor.b -= shadowFlag;
    castShadows = shadowFlag >= 1.0;

    int decodedColorMixMode;
    vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // = 1/255;
    vExternalColorMixMode = float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts

    return vExternalColor;
  }
`),r.code.add(E`
  void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
    externalColor = vExternalColor;
    externalColorMixMode = int(vExternalColorMixMode);
  }

  void outputObjectAndLayerIdColor() {
     ${n?E`fragColor = vObjectAndLayerIdColor;`:""}
  }
`)}function TEt(t,e){const{vertex:i,fragment:r}=t;t.varyings.add("vExternalColor","vec4"),r.uniforms.add(new R8("emissiveStrength",n=>n.componentParameters.emissiveStrength)),i.uniforms.add(new yD("externalColor",n=>n.componentParameters.externalColor)).code.add(E`float readElevationOffset() {
return 0.0;
}
void forwardObjectAndLayerIdColor() {}
void forwardEmissiveStrength() {}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`);const s=e.output===10;r.uniforms.add(new vEt("externalColorMixMode",n=>n.componentParameters.externalColorMixMode)).code.add(E`
    void readExternalColor(out vec4 color, out int colorMixMode) {
      color = vExternalColor;
      colorMixMode = externalColorMixMode;
    }

    void outputObjectAndLayerIdColor() {
      ${_e(s,"fragColor = vec4(0, 0, 0, 0);")}
    }
  `)}function R_e(t,e){const i=t.fragment;switch(e.doubleSidedMode){case 0:i.code.add(E`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case 1:t.include(lR,e),i.code.add(E`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case 2:i.code.add(E`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:e.doubleSidedMode;case 3:}switch(e.normalType){case 0:case 1:t.include(O8,e),i.main.add(E`vec3 fragmentFaceNormal = _adjustDoublesided(normalize(vNormalWorld));
vec3 fragmentFaceNormalView = gl_FrontFacing ? normalize(vNormalView) : -normalize(vNormalView);`);break;case 2:t.include(lR,e),i.main.add(E`vec3 fragmentFaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
vec3 fragmentFaceNormalView = normalize(cross(dFdx(vPosition_view), dFdy(vPosition_view)));`)}e.shadeNormals?i.main.add(E`vec3 fragmentShadingNormal = fragmentFaceNormal;`):e.spherical?(t.include(lR,e),i.main.add(E`vec3 fragmentShadingNormal = normalize(positionWorld());`)):i.main.add(E`vec3 fragmentShadingNormal = vec3(0.0, 0.0, 1.0);`)}function $Et(t,e){t.include(P8,e),t.fragment.include(bre);const i=t.fragment;i.uniforms.add(new yD("baseColor",r=>r.baseColor)),i.uniforms.add(new R8("objectOpacity",r=>r.objectOpacity)),e.hasVertexColors?i.code.add(E`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):i.code.add(E`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`),i.code.add(E`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)}function CEt(t,e){const i=e.hasColorTexture&&(ds(e.output)||e.alphaDiscardMode!==1);i&&(t.include(D8,e),t.fragment.uniforms.add(new Dv("baseColorTexture",r=>r.texture))),t.fragment.code.add(E`
    vec4 readBaseColorTexture() {
      return ${i?"textureLookup(baseColorTexture, vuv0)":"vec4(1.0)"};
    }
  `)}function MEt(t,e){t.fragment.uniforms.add(new ao("heightParameters",i=>{const r=i.camera,s=On(r.eye),n=Math.sqrt(s),a=e.radius,o=s-a*a;let l=sC(4e6,5e6,n-a);return l=Math.min(l,.98),fi(l,o,0,0)}),new co("cameraPosition",i=>i.camera.eye)),t.fragment.include(f4),t.fragment.code.add(E`float sphereFade() {return heightParameters[0];}
float sphereDepthInterpolate(vec3 worldRay, vec3 viewRay, float currentLinearDepth) {
vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, worldRay, heightParameters[1]);
bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;
if (hitsPlanet) {
float sphereDepth = rayPlanetIntersect.x;
viewRay *= viewRay.z*sphereDepth;
float linearDepth = length(viewRay);
float sphereFade = heightParameters[0];
return (-linearDepth)*sphereFade + currentLinearDepth*(1.0-sphereFade);
}
return currentLinearDepth;
}`)}function gLe(t){const e=new Di,{vertex:i,fragment:r}=e;e.include(lR,t),e.include(O8,t),e.include(P8,t),e.include(Gg,t),e.include(xEt,t),e.include(L0t,t),r.include(lmt,t),e.include(CEt,t),e.include(T4,t);const{output:s,pbrMode:n,hasNormalTexture:a,snowCover:o,receiveShadows:l,shadeNormals:c,spherical:h,ellipsoidMode:f,overlayEnabled:y,componentData:_,vertexDiscardMode:w,renderOccluded:x}=t,S=n===1||n===2;S&&(e.include(mre,t),a&&e.include(mDe,t));const $=s===4||s===5||s===6,A=$&&_===1,M=f===1,P=f===1?mi.radius:M?dp.radius:oy.radius;y&&(e.include(HC,t),e.include(sCt,t),i.code.add(`
      ${_e(h,`const float invRadius = ${E.float(1/P)};`)}
      vec2 projectOverlay(vec3 pos) { return pos.xy ${_e(h,"/ (1.0 + invRadius * pos.z);")}; }`));const O=y&&ds(s)&&n===4;O&&(e.varyings.add("tbnTangent","vec3"),e.varyings.add("tbnBiTangent","vec3"),e.varyings.add("groundNormal","vec3"));const D=w===0,L=w===2,F=1-1/255;if(e.include(_re,t),e.include(P0t,t),i.main.add(E`
    bool castShadows;
    vec4 externalColor = forwardExternalColor(castShadows);
    ${_e(A,"if(!castShadows) { gl_Position = vec4(vec3(1e38), 1.0); return; }")}

    ${_e(!D,`{ if (externalColor.a ${L?">":"<="} ${E.float(F)}) { gl_Position = vec4(vec3(1e38), 1.0); return; } }`)}

    ${_e(s===10,"externalColor.a = 1.0;")}

    forwardPosition(readElevationOffset());
    forwardViewPosDepth(vPosition_view);
    forwardNormal();
    forwardTextureCoordinates();
    forwardVertexColor();
    forwardLinearDepthToReadShadowMap();
    forwardLinearDepthToWriteShadowMap();
    forwardEmissiveStrength();
    forwardObjectAndLayerIdColor();
    ${_e(O,h?E`
            groundNormal = normalize(positionWorld());
            tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
            tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:E`
            groundNormal = vec3(0.0, 0.0, 1.0);
            tbnTangent = vec3(1.0, 0.0, 0.0);
            tbnBiTangent = vec3(0.0, 1.0, 0.0);`)}
    ${_e(y,"setOverlayVTC(projectOverlay(position));")}

    if (externalColor.a < ${E.float(Gr)}) {
      // Discard this vertex
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    }
  `),ds(s))return e.include($Et,t),e.include(R_e,t),e.include(HC,t),e.include(F8,t),r.include(wre,t),r.code.add(E`
      float evaluateShadow() {
        return ${l?"readShadowMap(vPositionWorldCameraRelative, linearDepth)":"0.0"};
      }`),r.main.add(E`
      discardBySlice(vPositionWorldCameraRelative);
      discardByTerrainDepth();

      vec4 textureColor = readBaseColorTexture();
      discardOrAdjustAlpha(textureColor);

      /* When rendering the occluded overlay, we still need to read the base color texture
       * because we need to use the same discard logic. However after that to render only the
       * draped overlay, we simply set the base texture color to zero. */
      ${_e(x,E`textureColor = vec4(0);`)}

      ${_e(y,E`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`)}

      /* Early discard to only emit when we have overlay */
      ${_e(y&&x,E`if (overlayColor.a < ${E.float(Gr)}) { discard; }`)}

      vec4 externalColor;
      int externalColorMixMode;
      readExternalColor(externalColor, externalColorMixMode);

      vec4 materialColor = computeMaterialColor(textureColor, externalColor, externalColorMixMode);
    `),S?(Ty(r),h&&GC(r),r.main.add(E`
        applyPBRFactors();
        ${_e(n===1,E`if (externalColorMixMode == 3) {
              mrr = vec3(0.0, 0.6, 0.2);
            }`)}
        float additionalIrradiance = 0.02 * mainLightIntensity[2];
        ${_e(a,"mat3 tangentSpace = computeTangentSpace(fragmentFaceNormal, vPositionWorldCameraRelative, vuv0);")}
        vec3 shadingNormal = ${a?"computeTextureNormal(tangentSpace, vuv0)":"fragmentShadingNormal"};
        vec3 groundNormal = ${h?E`normalize(positionWorld())`:E`vec3(0.0, 0.0, 1.0)`};

        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        float ssao = 1.0 - occlusion * evaluateAmbientOcclusionInverse();
        ${_e(o,E`float snow = getSnow(fragmentFaceNormal, normalize(positionWorld()));
                 materialColor.rgb = mix(materialColor.rgb, vec3(1.1), snow);
                 ssao = mix(ssao, 0.5 * ssao, snow);
                 shadingNormal = mix(shadingNormal, fragmentFaceNormal, snow);`)}
        ${_e(y,"materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;")}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        ${_e(h,"float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());")}
        ${h?E`float shadow = max(lightingGlobalFactor * (1.0 - additionalAmbientScale), evaluateShadow());`:"float shadow = evaluateShadow();"}
        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, shadow, ssao, additionalLight, viewDir, groundNormal, mrr, additionalIrradiance), materialColor.a);
        `)):($p(r),h&&GC(r),O&&r.uniforms.add(new po("ovNormalTex",Y=>Y.overlay?.getTexture(3))),r.main.add(E`
        ${_e(h,"float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());")}
        float shadow = ${l?h?"max(lightingGlobalFactor * (1.0 - additionalAmbientScale), evaluateShadow())":"evaluateShadow()":h?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

        ${_e(l&&!c,E`
            float dotFL = dot(fragmentFaceNormal, mainLightDirection);
            if( dotFL <= 0.0) shadow = 1.0;
        `)}
        ${_e(o,E`float snow = getSnow(fragmentFaceNormal, normalize(positionWorld()));
               materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`)}

        // At global scale we create some additional ambient light based on the main light to simulate global illumination
        float ssao = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());

        ${_e(y,"materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;")}

        vec4 shadedColor = vec4(evaluateSceneLighting(fragmentShadingNormal, materialColor.rgb, shadow, ssao, additionalLight), materialColor.a);
        ${_e(O,E`vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
                 float waterNormalLength = length(overlayWaterMask);
                 if (waterNormalLength > 0.95) {
                   mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                   vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                   vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                   // un-gamma the ground color to mix in linear space
                   shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
                 }`)}
      `)),r.main.add(`outputColorHighlightOID(shadedColor, vPositionWorldCameraRelative, materialColor.rgb ${_e(o,", snow")});`),t.sphereDepthInterpolate&&(e.include(MEt,{radius:P*Wxe}),e.fragment.include(rd),r.main.add(E`if (sphereFade()>0.0) {
vec3 worldRay = normalize(vPositionWorldCameraRelative);
vec3 viewRay = normalize(vPosition_view);
gl_FragDepth = delinearizeDepth(sphereDepthInterpolate(worldRay, viewRay, linearizeDepth(gl_FragCoord.z)));
} else {
gl_FragDepth = gl_FragCoord.z;
}`)),e;const U=s===3,N=s===10,j=s===9,B=$||s===7||s===8;return B&&e.include(dre,t),U&&e.include(R_e,t),y&&e.include(O5e,t),e.include(CM,t),r.main.add(E`
    discardBySlice(vPositionWorldCameraRelative);

    vec4 textureColor = readBaseColorTexture();
    discardOrAdjustAlpha(textureColor);

    ${_e(B,"outputDepth(linearDepth);")}
    ${_e(U,E`fragColor = vec4(vec3(0.5) + 0.5 * fragmentFaceNormalView, 1.0);`)}
    ${_e(N,y?"fragColor = getOverlayColorTexel();":"outputObjectAndLayerIdColor();")}
    ${_e(j,_e(y,E`calculateOcclusionAndOutputHighlight(getAllOverlayHighlightValuesEncoded());`,E`calculateOcclusionAndOutputHighlight();`))}`),e}const EEt=Object.freeze(Object.defineProperty({__proto__:null,build:gLe},Symbol.toStringTag,{value:"Module"}));let AEt=class extends Vi{constructor(e,i){super(e,i,new Ii(EEt,()=>te(()=>Promise.resolve().then(()=>Jkt),void 0)),c8([Lo(dLe(i)),yLe]))}initializePipeline(e){const{integratedMeshMode:i,output:r,blendingEnabled:s,cullFace:n,hasOccludees:a,hasPolygonOffset:o,oitPass:l,renderOccluded:c}=e,h=i!==0,f=l===0,y=l===2;return li({blending:c?Qv:ds(r)&&s?C8(l):null,culling:MAe(n),depthTest:c?null:{func:Qie(l)},depthWrite:c||!f&&!y?null:m4,drawBuffers:sw(r,Dw(l,r)),colorWrite:$i,stencilWrite:!c&&h||a?lV:null,stencilTest:h?w0t(1):a?ure:null,polygonOffset:f||y?o?{factor:2,units:2}:null:Yie})}};const yLe=Lo(jc().u16("componentIndex"));let Xi=class extends Fo{constructor(e){super(),this.spherical=e,this.output=0,this.textureCoordinateType=0,this.componentData=0,this.cullFace=2,this.vertexDiscardMode=0,this.doubleSidedMode=2,this.alphaDiscardMode=1,this.integratedMeshMode=0,this.oitPass=0,this.ellipsoidMode=1,this.pbrMode=0,this.normalType=0,this.emissionSource=0,this.hasVertexColors=!1,this.hasNormals=!1,this.shadeNormals=!0,this.hasSlicePlane=!1,this.hasColorTexture=!1,this.hasHighlightMixTexture=!1,this.receiveAmbientOcclusion=!0,this.receiveShadows=!0,this.blendingEnabled=!0,this.screenSpaceReflections=!1,this.hasPolygonOffset=!1,this.hasMetallicRoughnessTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasOccludees=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.hasNormalTextureTransform=!1,this.cloudReflections=!0,this.snowCover=!1,this.olidColor=!1,this.renderOccluded=!1,this.sphereDepthInterpolate=!1,this.discardInvisibleFragments=!1,this.occlusionPass=!1,this.bindType=2,this.useCustomDTRExponentForWater=!1,this.hasVertexTangents=!1,this.highStepCount=!1,this.instanced=!1,this.instancedDoublePrecision=!1,this.hasModelTransformation=!1,this.useFillLights=!0,this.draped=!1}get overlayEnabled(){return(this.integratedMeshMode===2||this.integratedMeshMode===3)&&XP(this.output)}};d([oe({count:11})],Xi.prototype,"output",void 0),d([oe({count:3})],Xi.prototype,"textureCoordinateType",void 0),d([oe({count:2})],Xi.prototype,"componentData",void 0),d([oe({count:3})],Xi.prototype,"cullFace",void 0),d([oe({count:3})],Xi.prototype,"vertexDiscardMode",void 0),d([oe({count:3})],Xi.prototype,"doubleSidedMode",void 0),d([oe({count:4})],Xi.prototype,"alphaDiscardMode",void 0),d([oe({count:4})],Xi.prototype,"integratedMeshMode",void 0),d([oe({count:3})],Xi.prototype,"oitPass",void 0),d([oe({count:4})],Xi.prototype,"ellipsoidMode",void 0),d([oe({count:7})],Xi.prototype,"pbrMode",void 0),d([oe({count:3})],Xi.prototype,"normalType",void 0),d([oe({count:8})],Xi.prototype,"emissionSource",void 0),d([oe()],Xi.prototype,"hasVertexColors",void 0),d([oe()],Xi.prototype,"hasNormals",void 0),d([oe()],Xi.prototype,"shadeNormals",void 0),d([oe()],Xi.prototype,"hasSlicePlane",void 0),d([oe()],Xi.prototype,"hasColorTexture",void 0),d([oe()],Xi.prototype,"hasHighlightMixTexture",void 0),d([oe()],Xi.prototype,"receiveAmbientOcclusion",void 0),d([oe()],Xi.prototype,"receiveShadows",void 0),d([oe()],Xi.prototype,"blendingEnabled",void 0),d([oe()],Xi.prototype,"screenSpaceReflections",void 0),d([oe()],Xi.prototype,"hasPolygonOffset",void 0),d([oe()],Xi.prototype,"hasMetallicRoughnessTexture",void 0),d([oe()],Xi.prototype,"hasOcclusionTexture",void 0),d([oe()],Xi.prototype,"hasNormalTexture",void 0),d([oe()],Xi.prototype,"hasOccludees",void 0),d([oe()],Xi.prototype,"terrainDepthTest",void 0),d([oe()],Xi.prototype,"cullAboveTerrain",void 0),d([oe()],Xi.prototype,"hasNormalTextureTransform",void 0),d([oe()],Xi.prototype,"cloudReflections",void 0),d([oe()],Xi.prototype,"snowCover",void 0),d([oe()],Xi.prototype,"olidColor",void 0),d([oe()],Xi.prototype,"renderOccluded",void 0),d([oe()],Xi.prototype,"sphereDepthInterpolate",void 0);let OEt=class extends hr{constructor(){super(...arguments),this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){if(this._dirty=!1,this._parameterBlocks!=null)for(const e of this._parameterBlocks)this[e]._setClean()}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(this._parameterBlocks==null)return!1;for(const e of this._parameterBlocks)if(this[e].dirty)return!0;return!1}},Ese=class{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1}get dirty(){return this._dirty}};function br(t={}){return(e,i)=>{const r=e._parameterCount??0;if(e._parameterCount=r+1,t.vectorOps){const s=t.vectorOps;Object.defineProperty(e,i,{get(){return this[r]},set(n){const a=this[r];if(a==null)this[r]=Array.from(n);else{if(s.equals(a,n))return;s.copy(a,n)}this._setDirty()}})}else Object.defineProperty(e,i,{get(){return this[r]},set(s){this[r]!==s&&(t.dispose&&this[r]&&this[r].dispose(),this[r]=s,this._setDirty())}})}}function D_e(){return(t,e)=>{const i=t._parameterCount??0;t._parameterCount=i+1,t._parameterBlocks=t._parameterBlocks||[],t._parameterBlocks.push(i),Object.defineProperty(t,e,{get(){return this[i]},set(r){this[i]!==r&&(this[i]=r,this._setDirty())}})}}let _Le=class{constructor(e){this._low=R(),this._high=R(),e&&this.set(e)}get low(){return this._low}get high(){return this._high}set(e){de(this._low,de(I_e,e));const i=ui(I_e,e,this._low);de(this._high,i)}get(e){return xe(e,this._low,this._high)}getLowScaled(e){return le(e,this._low,1)}};const I_e=Ac();let bn=class extends OEt{constructor(e,i){super(),this.toMapSpace=i,this.baseColor=jR(1,1,1,1),this.usePBR=!1,this.hasParametersFromSource=!1,this.sphereDepthInterpolate=!1,this.mrrFactors=nDe,this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.normalTexture=null,this.occlusionTexture=null,this.emissionTexture=null,this.emissiveBaseColor=bv(0,0,0),this.emissiveStrength=0,this.commonMaterialParameters=new VF,this.componentParameters=new Wb,this.objectOpacity=1,this.textureAlphaCutoff=Gr,this.alphaDiscardMode=1,this.isIntegratedMesh=!1,this.polygonOffsetEnabled=!1,this.ellipsoidMode=1,this.hasOccludees=!1;const r=new _Le(e.position),s=$2e(e.rotationScale);i2(s,s),qv(s,s),this.transformNormalGlobalFromModel=s,this.transformWorldFromModelTL=r.low,this.transformWorldFromModelTH=r.high,this.transformWorldFromModelRS=e.rotationScale}dispose(){this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null}get _hasEmissiveBase(){return this.emissionTexture!=null||!si(this.emissiveBaseColor,Kn)}get _hasEmissiveStrength(){return this.componentParameters.emissiveOverride!==2}get hasEmissions(){return this._hasEmissiveStrength&&(this._hasEmissiveBase||this.componentParameters.emissiveSourceOverride!==2)}get texture(){return this.baseColorTexture?.glTexture}get textureMetallicRoughness(){return this.metallicRoughnessTexture?.glTexture}get textureEmissive(){return this.emissionTexture?.glTexture}get textureOcclusion(){return this.occlusionTexture?.glTexture}get textureNormal(){return this.normalTexture?.glTexture}acquireTechnique(e,i,r,s){const n=new Xi(e.context.spherical);n.renderOccluded=r.slot===9,n.hasVertexColors=s.hasVertexColors,n.hasNormals=s.hasNormals,n.textureCoordinateType=s.textureCoordinateType,n.hasMetallicRoughnessTexture=this.metallicRoughnessTexture!=null,n.hasOcclusionTexture=this.occlusionTexture!=null,n.hasNormalTexture=this.normalTexture!=null,n.sphereDepthInterpolate=this.sphereDepthInterpolate&&e.viewingMode===1,n.oitPass=i.identifier===0&&r.oitPass!=null?r.oitPass:0,n.terrainDepthTest=i.identifier===0&&r.terrainDepthTest,n.cullAboveTerrain=i.identifier===0&&r.cullAboveTerrain,n.ellipsoidMode=this.ellipsoidMode,n.componentData=this.componentParameters.type,n.cullFace=this.commonMaterialParameters.cullFace,n.doubleSidedMode=this.commonMaterialParameters.doubleSided?1:0,n.hasColorTexture=this.baseColorTexture!=null;const a=this._computeWhichMaterialPass();n.blendingEnabled=a===1||a===2,n.alphaDiscardMode=this.alphaDiscardMode,n.integratedMeshMode=this.isIntegratedMesh?DEt(r)?REt(r)?3:2:1:0,n.hasPolygonOffset=this.polygonOffsetEnabled,n.pbrMode=n.integratedMeshMode===3?4:this.usePBR?this.hasParametersFromSource?s.shadeNormals&&this.isIntegratedMesh?0:2:1:0;const o=this.componentParameters.emissiveSourceOverride===1,l=this.componentParameters.emissiveSourceOverride===2,c=this.emissionTexture!=null;if(n.emissionSource=this.hasEmissions?this._hasEmissiveBase&&n.pbrMode===1?l?c?4:2:o?c?5:7:6:o?7:6:0,n.shadeNormals=s.shadeNormals,n.normalType=n.hasNormals?1:2,n.hasSlicePlane=r.slicePlane!=null&&this.commonMaterialParameters.hasSlicePlane,n.receiveAmbientOcclusion=n.hasOccludees=n.receiveShadows=n.screenSpaceReflections=n.cloudReflections=n.hasHighlightMixTexture=!1,i.identifier===1)n.output=4,n.vertexDiscardMode=0;else if(i.identifier===3)n.output=7,n.vertexDiscardMode=0;else if(i.identifier===2)n.output=9,n.vertexDiscardMode=0,n.hasHighlightMixTexture=r.highlightMixTexture!=null;else{switch(n.vertexDiscardMode=a===2?i.transparent?2:1:0,n.output=i.output,i.output){case 0:case 1:n.receiveAmbientOcclusion=s.applySSAO&&r.ssao?.getTexture()!=null,n.hasOccludees=r.hasOccludees,n.receiveShadows=r.shadowMap.ready,n.screenSpaceReflections=r.ssr.lastFrameColor!=null,n.cloudReflections=r.clouds.data?.cubeMap?.colorTexture!=null;break;case 10:n.olidColor=!0}n.snowCover=r.snowCover>0}const h=e.get(AEt,n);return this._setClean(),h}submit(e,i,r){if(this.objectOpacity<=0)return;const{componentData:s,renderable:n}=r,{geometry:a}=n,o=n.meta.cameraDepthSquared;s.updateHighlights(i.highlights);const{geometryRanges:l,highlightRangesMap:c,shadowmapRanges:h}=s;switch(this._computeWhichMaterialPass()){case 0:e.opaque.submitDraw(this,a,l,o);break;case 1:e.transparent.submitDraw(this,a,l,o);break;case 2:e.opaque.submitDraw(this,a,l,o),e.transparent.submitDraw(this,a,l,o);break;case 3:e.integratedMesh.submitDraw(this,a,l,o),IEt(i)&&e.occludedGround.submitDraw(this,a,l,o),PEt(i)&&e.highlightIntegratedMesh.submitDraw(this,a,l,o);break;case 4:e.transparentIntegratedMesh.submitDraw(this,a,l,o)}if(this.componentParameters.castShadows!==2){if(c!=null)for(const f of c)f[0]===Tp&&e.highlightShadowMap.submitDraw(this,a,f[1],o,f[0]);h!=null&&e.defaultShadowMap.submitDraw(this,a,h,o),e.shadowMap.submitDraw(this,a,l,o)}if(c!=null)for(const f of c)e.highlight.submitDraw(this,a,f[1],o,f[0]);i.viewshedEnabled&&e.viewshedShadowMap.submitDraw(this,a,l,o)}_computeWhichMaterialPass(){if(this.isIntegratedMesh&&this.objectOpacity>=1)return 3;if(this.isIntegratedMesh&&this.objectOpacity<1)return 4;if(this.objectOpacity<1)return 1;if(this.componentParameters.opaqueOverride===0)return 0;if(this.baseColor[3]<1||this.alphaDiscardMode===0||this.alphaDiscardMode===3)return 1;switch(this.componentParameters.transparent){case 2:return 0;case 0:return 1;case 1:return 2}}};d([br({vectorOps:z3e})],bn.prototype,"baseColor",void 0),d([br()],bn.prototype,"usePBR",void 0),d([br()],bn.prototype,"hasParametersFromSource",void 0),d([br()],bn.prototype,"sphereDepthInterpolate",void 0),d([br({vectorOps:ade})],bn.prototype,"mrrFactors",void 0),d([br({dispose:!0})],bn.prototype,"baseColorTexture",void 0),d([br({dispose:!0})],bn.prototype,"metallicRoughnessTexture",void 0),d([br({dispose:!0})],bn.prototype,"normalTexture",void 0),d([br({dispose:!0})],bn.prototype,"occlusionTexture",void 0),d([br({dispose:!0})],bn.prototype,"emissionTexture",void 0),d([br({vectorOps:ade})],bn.prototype,"emissiveBaseColor",void 0),d([br()],bn.prototype,"emissiveStrength",void 0),d([D_e()],bn.prototype,"commonMaterialParameters",void 0),d([D_e()],bn.prototype,"componentParameters",void 0),d([br()],bn.prototype,"objectOpacity",void 0),d([br()],bn.prototype,"textureAlphaCutoff",void 0),d([br()],bn.prototype,"alphaDiscardMode",void 0),d([br()],bn.prototype,"isIntegratedMesh",void 0),d([br()],bn.prototype,"polygonOffsetEnabled",void 0),d([br()],bn.prototype,"ellipsoidMode",void 0),d([br()],bn.prototype,"hasOccludees",void 0);let VF=class extends Ese{constructor(){super(...arguments),this.doubleSided=!1,this.cullFace=2,this.hasSlicePlane=!0}};d([br()],VF.prototype,"doubleSided",void 0),d([br()],VF.prototype,"cullFace",void 0),d([br()],VF.prototype,"hasSlicePlane",void 0);let Wb=class extends Ese{constructor(){super(...arguments),this.externalColor=fi(1,1,1,1),this.externalColorMixMode=1,this.emissiveStrength=0,this.emissiveSource=0,this.castShadows=0}get transparent(){return this.externalColor[3]<1?0:2}get opaqueOverride(){return this.externalColorMixMode===3&&this.externalColor[3]===1?0:2}get emissiveOverride(){return this.emissiveStrength>0?0:2}get emissiveSourceOverride(){return this.emissiveSource===1?0:2}get visible(){return this.externalColor[3]>0?0:2}get type(){return 0}};d([br({vectorOps:z3e})],Wb.prototype,"externalColor",void 0),d([br()],Wb.prototype,"externalColorMixMode",void 0),d([br()],Wb.prototype,"emissiveStrength",void 0),d([br()],Wb.prototype,"emissiveSource",void 0),d([br()],Wb.prototype,"castShadows",void 0);let $b=class extends Ese{constructor(){super(...arguments),this.texture=null,this.transparent=2,this.opaqueOverride=2,this.emissiveOverride=2,this.emissiveSourceOverride=2,this.castShadows=2}get type(){return 1}};function PEt(t){return t.overlay?.getTexture(2)!=null}function REt(t){return t.overlay?.getTexture(3)!=null}function DEt(t){return t.overlay?.getTexture(1)!=null}function IEt(t){return t.overlay?.getTexture(t.overlay?.allSourcesOccluders?1:4)!=null}d([br()],$b.prototype,"texture",void 0),d([br()],$b.prototype,"transparent",void 0),d([br()],$b.prototype,"opaqueOverride",void 0),d([br()],$b.prototype,"emissiveOverride",void 0),d([br()],$b.prototype,"emissiveSourceOverride",void 0),d([br()],$b.prototype,"castShadows",void 0);let LEt=class{constructor(e){this._maxCount=e,this._nextIndex=0,this._recycledIndices=[]}get activeCount(){return this._nextIndex-this._recycledIndices.length}get availableCount(){return this._recycledIndices.length+this._maxCount-this._nextIndex}acquire(){return this._recycledIndices.length>0?this._recycledIndices.pop():this.availableCount?this._nextIndex++:void 0}release(e){this._recycledIndices.push(e)}},kEt=class{constructor(e,i=1){this._rctx=e,this._fieldCount=i,this.textureWidth=4096,this._dirty=!0;const r=new Zi(this.textureWidth,1);r.samplingMode=9728,r.wrapMode=33071,this._texture=new Fi(this._rctx,r),this._data=new Bu(new ArrayBuffer(4*this.textureWidth))}dispose(){this._texture.dispose(),this._texture=void 0,this._data=void 0}setData(e,i,r,s,n,a){const o=e*this._fieldCount+i;this._dirty=!0,this._data.set(o,0,r),this._data.set(o,1,s),this._data.set(o,2,n),this._data.set(o,3,a)}setDataElement(e,i,r,s){const n=e*this._fieldCount+i;this._dirty=!0,this._data.set(n,r,s)}getDataElement(e,i,r){const s=e*this._fieldCount+i;return this._dirty=!0,this._data.get(s,r)}resizeToFit(e){const i=(e+1)*this._fieldCount;if(i>this._data.count){const r=Math.ceil(i/this.textureWidth)*this.textureWidth,s=new Bu(new ArrayBuffer(4*r));s.typedBuffer.set(this._data.typedBuffer),this._data=s}}updateTexture(){if(!this._dirty)return;const e=this._texture.descriptor.width,i=this._texture.descriptor.height;this._data.count>e*i&&this._texture.resize(e,this._data.count/e),this._texture.setData(this._data.typedBuffer),this._dirty=!1}get texture(){return this._texture}};const vLe=65536;let zEt=class{constructor(e,i=1){this.textureBuffer=new kEt(e,i),this._indexManager=new LEt(vLe)}dispose(){this.textureBuffer.dispose(),this.textureBuffer=void 0}get availableCount(){return this._indexManager.availableCount}get activeCount(){return this._indexManager.activeCount}acquireIndex(){const e=this._indexManager.acquire();return this.textureBuffer.resizeToFit(e),e}releaseIndex(e){this._indexManager.release(e)}},FEt=class{constructor(e,i=1){this._rctx=e,this._fieldCount=i,this._buffers=[]}garbageCollect(){this._buffers=this._buffers.filter(e=>e.activeCount!==0||(e.dispose(),!1))}destroy(){this._buffers.forEach(e=>e.dispose()),this._buffers=[]}getBuffer(e){for(const r of this._buffers)if(r.availableCount>=e)return r;if(e>vLe)return null;const i=new zEt(this._rctx,this._fieldCount);return this._buffers.push(i),i}updateTextures(){for(const e of this._buffers)e.textureBuffer.updateTexture()}};const dk=()=>fe.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");let NEt=class{constructor(e,i){this._renderManager=e,this._viewingMode=i,this._elevationRangeCacheVerticalOffset=NaN,this._elevationRangeCacheMin=NaN,this._elevationRangeCacheMax=NaN,this._activeHighlightOptions=new Map,this._visible=new _i,this._hidden=new _i,this._renderSubmit=new gEt(this),this._renderManager.register(this._renderSubmit),this._componentBufferManager=new FEt(e.rctx,mLe())}destroy(){dt(this._hidden.length===0&&this._visible.length===0,"ObjectCollection should be empty upon disposal"),this._componentBufferManager.destroy(),this._componentBufferManager=null,this._visible.forAll(e=>e.destroy()),this._visible.prune(),this._hidden.forAll(e=>e.destroy()),this._hidden.prune(),this._renderSubmit.destroy()}createObject(e){const{geometry:i}=e,r=new AMt(this._componentBufferManager,d8(i.componentOffsets)),s=this._createRenderable(e,r),n=new iEt(this._viewingMode,i.positionData,r,e.elevationAlignable),a=new PMt(e.transform,e.toMapSpace,e.obb.clone(),r,s,n);return(a.visible?this._visible:this._hidden).push(a),a}destroyObject(e){const i=e;(i.visible?this._visible:this._hidden).removeUnordered(i),i.destroy(),this._notifyDirty()}setObjectVisibility(e,i){const r=e;i!==r.visible&&(i?(this._hidden.removeUnordered(r),this._visible.push(r)):(this._visible.removeUnordered(r),this._hidden.push(r)),r.visible=i,this._notifyDirty())}preSubmit(e){const i=e.camera.eye;this.visibleObjects.forAll(r=>r.renderable.meta.cameraDepthSquared=on(i,r.obb.center))}getMaterial(e){return e.renderable.material}updateMaterial(e,i){const r=e.renderable.material;i(r),r.dirty&&this._notifyDirty()}setAllComponentVisibilities(e,i){const r=e;r.componentData.visibility.reset(i),r.componentData.markVisibilityDirty(),this._notifyDirty()}forEachVisibleComponent(e,i){return e.componentData.visibility.forEachComponent(i)}getComponentCount(e){const i=e,r=i.componentData.visibility.componentCount;return{visible:r,invisible:i.componentData.count-r}}setComponentData(e,i){const r=e,{renderable:s,componentData:n}=r,a=s.material,o=n.materialDataBuffer,l=n.materialDataIndices,c=new yEt,h=o.textureBuffer,f=new Uint8Array(4),y=new Uint32Array(f.buffer);let _=0,w=0,x=0,S=0,$=0,A=n.verticalOffsets,M=1/0,P=-1/0,O=!1,D=!1,L=!1,F=0;for(let U=0;U<n.count;U++){i(U,c),_+=+(c.externalColor[3]<1),w+=+(c.externalColorMixMode===3&&c.externalColor[3]===1),S+=+(c.emissiveStrength>0),$+=+(c.emissiveSource===1),D||=c.emissiveStrength!==1,x+=+c.castShadows,H_t(c.externalColor,c.externalColorMixMode,f),f[2]=254&f[2]|+c.castShadows,h.setData(l[U],0,f[0],f[1],f[2],f[3]),O||=U>0&&F!==y[0],F=y[0],L||=c.elevationOffset!==0,L&&A==null&&(A=new Array(U).fill(0)),A!=null&&(A[U]=c.elevationOffset),M=Math.min(M,c.elevationOffset),P=Math.max(P,c.elevationOffset),bEt(c.elevationOffset,f),h.setData(l[U],1,f[0],f[1],f[2],f[3]),wEt(c.emissiveStrength,f),h.setData(l[U],2,f[0],f[1],f[2],c.emissiveSource===0?0:255);const N=c.olidColor;N!=null&&h.setData(l[U],3,N[0],N[1],N[2],N[3]),c.pickable!==cLe(n.pickability,U)&&BMt(n,U,c.pickable)}n.verticalOffsets=L?A:null,r.offsetObb=L?DEe(r.obb,M,P,this._viewingMode,r.offsetObb??r.obb.clone()):null,O||L||Jh()||(D||$>0)&&S>0?(a.componentParameters=new $b,a.componentParameters.castShadows=MA(x,n.count),a.componentParameters.transparent=MA(_,n.count),a.componentParameters.opaqueOverride=MA(w,n.count),a.componentParameters.emissiveOverride=MA(S,n.count),a.componentParameters.emissiveSourceOverride=MA($,n.count),a.componentParameters.texture=h,h.updateTexture()):(a.componentParameters=new Wb,a.componentParameters.castShadows=c.castShadows?0:2,a.componentParameters.externalColor=c.externalColor,a.componentParameters.externalColorMixMode=c.externalColorMixMode,a.componentParameters.emissiveStrength=c.emissiveStrength,a.componentParameters.emissiveSource=c.emissiveSource),this._elevationRangeCacheVerticalOffset=NaN,this._notifyDirty()}getComponentAabb(e,i,r,s=!1){e.intersectionGeometry.getComponentAabb(i,r);const n=e,a=n.componentData.verticalOffsets;if(s||a==null)return r;const o=a[i];if(this._viewingMode===2||o===0)return r[2]+=o,r[5]+=o,r;const l=Bpe(o);return l.localOrigin=n.transform.position,l.applyToAabb(r)}getComponentObb(e){return e.obb}getObjectTransform(e){return e.transform}getComponentPositions(e,i,r){return e.intersectionGeometry.getComponentPositions(i,r)}expandRangeWithComponentObjectElevationRange(e,i,r,s){Number.isNaN(this._elevationRangeCacheVerticalOffset)||this._elevationRangeCacheVerticalOffset!==i||s.expandElevationRangeValues(this._elevationRangeCacheMin,this._elevationRangeCacheMax);const n=e,a=n.componentData,o=a.count,l=a.verticalOffsets,c=n.intersectionGeometry,h=this._viewingMode===2,f=c.getComponentAabbs(),y=VEt;let _=1/0,w=-1/0;for(let x=0;x<o;x++){const S=6*x,$=l?.[x]??0;let A=1/0,M=-1/0;if(h)A=f[S+2]+$+i,M=f[S+5]+$+i;else{if(y[0]=f[S],y[1]=f[S+1],y[2]=f[S+2],y[3]=f[S+3],y[4]=f[S+4],y[5]=f[S+5],$!==0){const L=Bpe($);L.localOrigin=n.transform.position,L.applyToAabb(y)}const P=Math.max(Math.abs(y[3]),Math.abs(y[0])),O=Math.max(Math.abs(y[4]),Math.abs(y[1])),D=i+y[5]+r;s.expandElevationRangeValues(i+y[2],Math.sqrt(P*P+O*O+D*D)-r)}s.expandElevationRangeValues(A,M),_=Math.min(_,A),w=Math.max(w,M)}this._elevationRangeCacheVerticalOffset=i,this._elevationRangeCacheMin=_,this._elevationRangeCacheMax=w}intersect(e,i,r,s,n,a){const o=e,{transform:l,componentData:c,intersectionGeometry:h}=o;return s!=null&&(s.localOrigin=l.position),h.intersect(i,r,s,c.verticalOffsets,l,n,a)}addEdges(e,i,r,s,n){const a=e,{indices:o,positions:l}=a.intersectionGeometry,c=a.componentData.offsets;return i.addComponentObject(a,l,o,c,r,s,n)}async extractEdgeInformation(e,i,r){const s=e,n=s.componentData.visibility;if(n.allInvisible()){const{extractComponentsEdgeLocationsLayout:_}=await te(()=>import("./edgeProcessing-DSSE0mj0.js"),__vite__mapDeps([29,30,28]));return{buffer:_.createBuffer(0),origin:[0,0,0]}}const{indices:a,positions:o}=s.intersectionGeometry,l=s.componentData.offsets,{EdgeInputBufferLayout:c}=await te(async()=>{const{EdgeInputBufferLayout:_}=await import("./bufferLayouts-Dp2_bRf1.js");return{EdgeInputBufferLayout:_}},[]),h=c.createBuffer(o.length/3);Mse(h.position.typedBuffer,o,h.position.typedBufferStride,3),iLe(h.position,h.position,s.transform.rotationScale),this._setComponentIndices(h.componentIndex,a,l);const f=h.count,y=this._computeVisibilityIndices(a,n,l,f);return{origin:cr(s.transform.position),buffer:await i.extractComponentsEdgeLocations({indices:y,indicesLength:y.length,skipDeduplicate:!0,data:h,writerSettings:{reducedPrecision:!1,variants:0}},r)}}_setComponentIndices(e,i,r){let s=0;for(let n=0;n<r.length-1;n++){const a=r[n],o=r[n+1];for(let l=a;l<o;l++){const c=i?i[l]:l;e.set(c,s)}s++}}_computeVisibilityIndices(e,i,r,s){if(e&&i.allVisible())return e;let n=0;i.forEachComponentRange((l,c)=>(n+=r[c]-r[l],!0));const a=iM(e)?e?.BYTES_PER_ELEMENT===2||s<=65536?new Uint16Array(n):new Uint32Array(n):new Array(n);let o=0;return i.forEachComponentRange((l,c)=>{const h=r[l],f=r[c];for(let y=h;y<f;y++)a[o++]=e?e[y]:y;return!0}),a}addComponentHighlight(e,i,r){const s=e.componentData,n=Cu(s.componentHighlights,r,()=>new Uint32Array(s.count+1));{const a=this._activeHighlightOptions.get(r)??0;this._activeHighlightOptions.set(r,a+1)}n[i]++===0&&(s.markHighlightsDirty(),this._notifyDirty()),n[s.count]++}removeComponentHighlight(e,i,r){const{componentData:s}=e,n=s.componentHighlights.get(r);if(n===void 0)return void dk().warn("Removing non-existing highlight.");const a=n[i];if(a===0)return void dk().warn("Removing non-existing highlight.");this._removeActiveHighlight(r);const o=n[s.count];if(a>1)return n[i]=a-1,void(n[s.count]=o-1);n[i]=0,o===1?s.componentHighlights.delete(r):n[s.count]=o-1,s.markHighlightsDirty(),this._notifyDirty()}_removeActiveHighlight(e,i=1){const r=this._activeHighlightOptions.get(e);if(r===void 0)dk().warn("Removing non-existing highlight.");else{const s=r-i;s<0&&dk().warn("Removing non-existing highlight."),s<=0?this._activeHighlightOptions.delete(e):this._activeHighlightOptions.set(e,s)}}clearHighlights(e){const{componentData:i}=e,{componentHighlights:r}=i;if(r.size>0){for(const s of r)this._removeActiveHighlight(s[0],s[1][i.count]);r.clear(),i.markHighlightsDirty(),this._notifyDirty()}}hasHighlight(e){return this._activeHighlightOptions.has(e)}getObjectGPUMemoryUsage(e){return e.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._visible}_createRenderable(e,i){const r=this._renderManager.rctx,s=e.geometry,n=s.vertices.layoutParameters,a=Lo(dLe(n)),o=new Hs(r,a,s.vertices.data),l=s.indices?Uu.createIndex(r,35044,s.indices):null,c=new Uint16Array(s.vertices.count);for(let x=0;x<i.count;x++){const S=i.offsets[x],$=i.offsets[x+1],A=i.materialDataIndices[x];if(s.indices!=null)for(let M=S;M<$;M++)c[s.indices[M]]=A;else for(let M=S;M<$;M++)c[M]=A}const h=new Hs(r,yLe,c.buffer),f=new bn(e.transform,e.toMapSpace),y=new Op(r,new Map([["geometry",o],["componentIndices",h]]),l),_=new cEt(y,lr.TRIANGLES,n,l!=null),w={cameraDepthSquared:.5,gpuMemoryEstimate:o.usedMemory+h.usedMemory+(l!=null?l.usedMemory:0)};return new lEt(f,_,w)}_notifyDirty(){this._renderManager.notifyDirty()}};function MA(t,e){return t===e?0:t===0?2:1}const VEt=ul();let UEt=class{constructor(e,i,r,s,n){this.rctx=e,this.viewingMode=i,this.stippleTextures=r,this.waterTextures=s,this.markerTextures=n}get spherical(){return this.viewingMode===1}},BEt=class{constructor(e){this._context=e,this._debug=!1,this._precompiling=this._debug?0:1,this._cache=new tm}get context(){return this._context}get precompiling(){return this._precompiling}set precompiling(e){this._precompiling=e,e===0&&this.context.rctx.gl.flush()}get viewingMode(){return this.context.viewingMode}destroy(){this._cache.forAll(e=>e.destroy()),this._cache.clear(),this._context=null}precompile(e,i=L_e){++this.precompiling,this.get(e,i),--this.precompiling}get(e,i=L_e){const r=i.key.code;let s=this._cache.get(e,r);if(s==null){if(this._precompiling===0){let n=`Uncached shader compile in ${new Error().stack}
  for configuration
${i.decode()}`;const a=this._cache.getInner(e);throw a?.size&&(n+=`

  cached configurations:
`,n+=Array.from(a.values()).map(o=>i.decode(o.key)).sort().join(`

`)),console.log(n),new ee("shader:uncached-compile",n)}s=new e(this.context,i),this._cache.set(e,r,s)}return s}async reloadAll(){const e=new Array;this._cache.forEach(i=>e.push(jEt(i))),await Promise.all(e)}};async function jEt(t){let e=!0;t.forEach(async i=>{await i.reload(e),e=!1})}const L_e=new Fo;let tP=class extends Nl{constructor(e){super(e),this.consumes={required:["olid"]},this.produces="olid"}destroy(){}render(e){const i=e.find(({name:s})=>s==="olid"),r=this.renderingContext;return r.bindFramebuffer(i.fbo),r.clearFramebuffer(tn,!0,!0),this.view.stage.renderer.renderAllGeometry(10),r.clear(1280),this.view.stage.renderer.renderHUD(1),i}};d([m()],tP.prototype,"consumes",void 0),d([m()],tP.prototype,"produces",void 0),tP=d([k("esri.views.3d.webgl-engine.effects.geometry.ObjectAndLayerIDRenderNode")],tP);let iP=class extends Nl{constructor(e){super(e),this.consumes={required:[ht.OCCLUDED]},this.produces=ht.OCCLUDED,this._blit=new Tse(e.view.stage.renderView.techniques,2)}precompile(){const e=this.view.stage.renderer;e.plugins.plugins.forEach(i=>{e.precompileSlots(i,9,11),i.material&&e.precompileOccludedSlots(i,XX)})}render(e){const i=e.find(({name:r})=>r===this.produces);return this._renderOccludedAndTransparentStencil(i),this._renderOccludedComposite(i),i}_renderOccludedAndTransparentStencil(e){const i=this.view.stage.renderer,r=QX;r.clear();for(const s of i.plugins.plugins)8&s.renderOccludedFlags&&r.push(s);r.length!==0&&(i.renderSlots(r,10),this._renderAndComposite(e,e.getAttachment(Ba),.5,()=>i.renderSlots(r,11),!1,!1),r.clear())}_renderOccludedComposite(e){const i=this.view.stage.renderer,r=QX;r.clear();let s=0;for(const o of i.plugins.plugins){const l=o.renderOccludedFlags&GEt;s|=l,l&&r.push(o)}if(!s)return void r.clear();const n=this._getDepthStencilAttachment(e);let a=n.clearStencil;for(const o of XX)s&o&&(this._renderAndComposite(e,n.depth,o===16?1:.5,()=>i.renderOccludedSlots(r,o),!0,a),a=!1);n.release(),r.clear()}_renderAndComposite(e,i,r,s,n,a){const o=this.renderingContext,{width:l,height:c}=e.fbo,h=this.fboCache.acquire(l,c,"tmp color");h.attachDepth(i),o.bindFramebuffer(h.fbo),o.clearFramebuffer(tn,n,a),s(),h.detachDepth(),this._blit.blend(o,h,e,this.bindParameters,r),h.release()}_getDepthStencilAttachment(e){const{width:i,height:r}=e.fbo;if(!this.view.stage.renderer.occludedRequiresIntegratedMeshStencil){const n=this.fboCache.acquireDepth(13,i,r,"retained stencil");return{depth:n,release:()=>n.release(),clearStencil:!0}}const s=this.fboCache.acquire(i,r,"retained stencil",13);return this.renderingContext.blitFramebuffer(e.fbo,s.fbo,1024),{depth:s.getAttachment(Ba),release:()=>s.release(),clearStencil:!1}}};d([m()],iP.prototype,"consumes",void 0),d([m()],iP.prototype,"produces",void 0),iP=d([k("esri.views.3d.webgl-engine.effects.geometry.RenderOccludedRenderNode")],iP);const QX=new _i;function qEt(){QX.prune()}const XX=[4,2,16],GEt=XX.reduce((t,e)=>t|e,0);function bLe(){return new Float32Array(4)}function HEt(t){const e=new Float32Array(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function PM(t,e,i,r){const s=new Float32Array(4);return s[0]=t,s[1]=e,s[2]=i,s[3]=r,s}function wLe(){return bLe()}function xLe(){return PM(1,1,1,1)}function SLe(){return PM(1,0,0,0)}function TLe(){return PM(0,1,0,0)}function $Le(){return PM(0,0,1,0)}function CLe(){return PM(0,0,0,1)}const K8=wLe(),WEt=xLe(),ZEt=SLe(),YEt=TLe(),QEt=$Le(),XEt=CLe();Object.freeze(Object.defineProperty({__proto__:null,ONES:WEt,UNIT_W:XEt,UNIT_X:ZEt,UNIT_Y:YEt,UNIT_Z:QEt,ZEROS:K8,clone:HEt,create:bLe,fromValues:PM,ones:xLe,unitW:CLe,unitX:SLe,unitY:TLe,unitZ:$Le,zeros:wLe},Symbol.toStringTag,{value:"Module"}));const UF={sunny:.0022,rainy:.0022,cloudy:.0022,snowy:.0022,foggy:.0022};let k_e=class{constructor(e){this.presets=e,this.presets=MLe(e)}};const TV={minDisperse:new k_e([.8,.12,.06,.02,0,0]),maxDisperse:new k_e([0,0,.06,.12,.25,.57])};function MLe(t,e=1){const i=t[0]+t[1]+t[2]+t[3]+t[4]+t[5];return i<=e?t:[t[0]/i,t[1]/i,t[2]/i,t[3]/i,t[4]/i,t[5]/i]}let Ase=class extends hr{constructor(){super(...arguments),this.blurRadius=UF.sunny}};function ELe(t){const e=new Di,i=e.fragment;e.include(Oa),i.include(t1),i.uniforms.add(new zt("colorTexture",l=>l.emissionsToDownsample),new ut("blurRadius",l=>l.blurRadius));let r="";const s=15;for(let l=0;l<s;l++)r+=`locations1D[${l}] = ${(l/(s-1)*2-1).toFixed(3).toString()};`;const n=2;let a="";for(let l=0;l<s;l++)a+=`locations1DWeights[${l}] = ${Vje(l-Math.floor(s/2),n).toFixed(7).toString()};`;const o=t.glowStage===0;return i.code.add(E`
    float locations1D[${E.int(s)}];
    float locations1DWeights[${E.int(s)}];

    vec3 blurUniformSamples(sampler2D toBlur) {
      vec3 res = vec3(0.0);
      vec2 size = vec2(textureSize(toBlur, 0));
      vec2 aspectCorrection = vec2(1.0, size.x / size.y);
      vec2 uvInPixel = uv * size;

      ${r}
      ${a}
      vec2 pixelCenterShift = 0.5 / size;

      for(int i=0;i < ${E.int(s)}; i++) {
        float uv1D = locations1D[i] + ${o?"pixelCenterShift.x":"pixelCenterShift.y"};
        vec2 uvOffset = ${o?"vec2(uv1D, 0.0)":"vec2(0.0, uv1D)"};

        vec2 uvDistorted = uv + uvOffset * blurRadius * aspectCorrection;
        vec3 sampleColor = texture(toBlur, uvDistorted).rgb;
        res += sampleColor * locations1DWeights[i];
      }
      return res;
    }
  `).main.add(E`fragColor = vec4(blurUniformSamples(colorTexture), 0.0);`),e}const JEt=Object.freeze(Object.defineProperty({__proto__:null,GlowBlurPassParameters:Ase,build:ELe},Symbol.toStringTag,{value:"Module"}));let pk=class extends Vi{constructor(e,i){super(e,i,new Ii(JEt,()=>te(()=>Promise.resolve().then(()=>Kkt),void 0)),Qs)}initializePipeline(){return li({colorWrite:$i})}},JX=class extends Fo{constructor(){super(...arguments),this.glowStage=0}};d([oe({count:2})],JX.prototype,"glowStage",void 0);let Ose=class extends Z5e{constructor(){super(...arguments),this.lodFactors=[0,0,0,0,0,0],this.glowLod=-1,this.dispersionWeight=1,this.distanceModifier=1e-4}};function ALe(t){const e=new Di,i=e.fragment,{blurEnabled:r,tonemappingEnabled:s}=t;return e.include(L4,{needUVs:!0,needEyeDirection:!0}),i.include(t1),i.include(Y5e),i.include(rd),e.outputs.add("fragColor","vec4",0),e.outputs.add("fragEmission","vec3",1),i.include(EM),i.uniforms.add(new zt("colorTexture",n=>n.color),new zt("emissionTexture",n=>n.emission)),r?(i.uniforms.add(new po("depthTexture",n=>n.mainDepth),new ut("distanceModifier",n=>n.distanceModifier),new zt("lodTexture0",n=>n.lodTexture0),new zt("lodTexture1",n=>n.lodTexture1),new zt("lodTexture2",n=>n.lodTexture2),new zt("lodTexture3",n=>n.lodTexture3),new zt("lodTexture4",n=>n.lodTexture4),new e1("glowLod",n=>n.glowLod),new Rc("minDisperse",()=>TV.minDisperse.presets,6),new Rc("maxDisperse",()=>TV.maxDisperse.presets,6),new ut("dispersionWeight",n=>n.dispersionWeight)).main.add(E`
    vec4 color = texture(colorTexture, uv);
    color = vec4(linearizeGamma(color.rgb), color.a);

    vec3 lod0 = texture(emissionTexture, uv).rgb;
    vec3 lod1 = texture(lodTexture0, uv).rgb;
    vec3 lod2 = texture(lodTexture1, uv).rgb;
    vec3 lod3 = texture(lodTexture2, uv).rgb;
    vec3 lod4 = texture(lodTexture3, uv).rgb;
    vec3 lod5 = texture(lodTexture4, uv).rgb;

    float terrainDepth = -1.0;
    float depthSample = depthFromTexture(depthTexture, uv);
    if(depthSample < 1.0 && depthSample > 0.0){
      vec3 cameraSpaceRay = normalize(eyeDir);
      cameraSpaceRay /= cameraSpaceRay.z;
      cameraSpaceRay *= linearizeDepth(depthSample);
      terrainDepth = max(0.0, length(cameraSpaceRay));
    }
    vec3 rayDir = normalize(worldRay);
    float dispersionByDistance = getDistanceFalloff(terrainDepth, rayDir, distanceModifier);
    float dispersionPerPixel = dispersionWeight * dispersionByDistance;

    float lodFactor0 = mix(minDisperse[0], maxDisperse[0], dispersionPerPixel);
    float lodFactor1 = mix(minDisperse[1], maxDisperse[1], dispersionPerPixel);
    float lodFactor2 = mix(minDisperse[2], maxDisperse[2], dispersionPerPixel);
    float lodFactor3 = mix(minDisperse[3], maxDisperse[3], dispersionPerPixel);
    float lodFactor4 = mix(minDisperse[4], maxDisperse[4], dispersionPerPixel);
    float lodFactor5 = mix(minDisperse[5], maxDisperse[5], dispersionPerPixel);

    vec3 emission = lodFactor0 * lod0;
    emission += lodFactor1 * lod1;
    emission += lodFactor2 * lod2;
    emission += lodFactor3 * lod3;
    emission += lodFactor4 * lod4;
    emission += lodFactor5 * lod5;

    // only for glow editor lod debugging
    emission = glowLod == 0 ? lodFactor0 * lod0 : glowLod == 1 ? lodFactor1 * lod1 : glowLod == 2 ? lodFactor2 * lod2 : glowLod == 3 ? lodFactor3 * lod3 : glowLod == 4 ? lodFactor4 * lod4 : glowLod == 5 ? lodFactor5 * lod5 : emission;

    fragEmission = emission;
    // tonemapping is only applied to the emissive part since main color values are not in HDR.
    ${_e(s,"emission = tonemapACES(emission);")}

    fragColor = delinearizeGamma(vec4(color.rgb + emission.rgb, color.w));
  `),e):(i.main.add(E`
      vec4 color = texture(colorTexture, uv);
      color = vec4(linearizeGamma(color.rgb), color.a);

      // emission is already in linear color space here.
      vec3 emission = texture(emissionTexture, uv).rgb;

      ${_e(s,"emission = tonemapACES(emission);")}
      fragColor = delinearizeGamma(vec4(color.rgb + emission, color.w));
    `),e)}const KEt=Object.freeze(Object.defineProperty({__proto__:null,GlowCompositionPassParameters:Ose,build:ALe},Symbol.toStringTag,{value:"Module"}));let fk=class extends Vi{constructor(e,i){super(e,i,new Ii(KEt,()=>te(()=>Promise.resolve().then(()=>ezt),void 0)),Qs)}initializePipeline(e){return li({colorWrite:$i,drawBuffers:{buffers:e.blurEnabled?[Dr,Do]:[Dr]}})}},KX=class extends Fo{constructor(){super(...arguments),this.blurEnabled=!1,this.tonemappingEnabled=!0}};d([oe()],KX.prototype,"blurEnabled",void 0),d([oe()],KX.prototype,"tonemappingEnabled",void 0);let hw=class extends Ow{constructor(e){super(e),this.consumes={required:[ht.TRANSPARENT_ENVIRONMENT,"emissive"]},this.produces=ht.TRANSPARENT_ENVIRONMENT,this._blurHorizontalConfiguration=new JX,this._blurVerticalConfiguration=new JX,this._compositionConfiguration=new KX,this._compositionParameters=new Ose,this._blurParameters=new Ase,this._blurScale=3.06,this._glowEnabled=!1,this._glowResults=new Array;const i=or(e.view.spatialReference);this._atmosphereRadius=i.radius+i.atmosphereHeight,e.view.stage.renderView.techniques.precompile(fk,this._compositionConfiguration)}initialize(){this.addHandles([K(()=>this._updateFogParameters(),()=>{},At),K(()=>this.view.qualitySettings.glow,e=>{this._glowEnabled=e,this.precompile(),this.requestRender(1)},At)])}_updateFogParameters(){const e=this.view.environment.weather;if(e.type==="sunny"||e.type==="cloudy")this._blurParameters.blurRadius=UF[e.type],this._compositionParameters.distanceModifier=0;else{const i=e.type==="foggy"?e.fogStrength:e.precipitation;this._blurParameters.blurRadius=ft(UF.cloudy,UF[e.type],i),this._compositionParameters.distanceModifier=e.type==="foggy"?ft(3e-5,.005,e.fogStrength**3):ft(4e-6,2e-4,(e.precipitation??0)**3)}this._computeLodFactors(),this.requestRender(1)}_computeLodFactors(e=TV.minDisperse.presets,i=TV.maxDisperse.presets){e.forEach((r,s)=>{this._compositionParameters.lodFactors[s]=ft(r,i[s],this._compositionParameters.dispersionWeight)})}precompile(){this._glowEnabled&&(this.techniques.precompile(pk,this._blurHorizontalConfiguration),this._blurVerticalConfiguration.glowStage=1,this.techniques.precompile(pk,this._blurVerticalConfiguration)),this._compositionConfiguration.blurEnabled=this._glowEnabled,this.techniques.precompile(fk,this._compositionConfiguration)}render(e){const i=e.find(({name:O})=>O===ht.TRANSPARENT_ENVIRONMENT),r=i.getAttachment(Do);if(!r?.attachment)return i;const s=i.getAttachment(Ba);if(!this._glowEnabled){const O=this.techniques.get(fk,this._compositionConfiguration);if(!O.compiled)return this.requestRender(1),i;const D=i.getTexture(),L=this.fboCache,{fullWidth:F,fullHeight:U}=this.bindParameters.camera,N=this.renderingContext,j=L.acquire(D.descriptor.width,D.descriptor.height,this.produces);return this._prepareFBO(j,F,U),this._compositionParameters.color=D,this._compositionParameters.emission=r.attachment,N.bindTechnique(O,this.bindParameters,this._compositionParameters),N.screen.draw(),j.attachDepth(s),j.attachColor(r,Do),j}const n=this.techniques.get(pk,this._blurHorizontalConfiguration),a=this.techniques.get(pk,this._blurVerticalConfiguration),o=this.techniques.get(fk,this._compositionConfiguration);if(!n.compiled||!a.compiled||!o.compiled)return this.requestRender(1),i;const l=i.getTexture(),c=this.fboCache,{fullWidth:h,fullHeight:f}=this.bindParameters.camera,y=this.renderingContext;let _=r.attachment,w=Math.ceil(h/2),x=Math.ceil(f/2);const S=5,$=this._blurParameters.blurRadius;for(let O=0;O<S;O++){const D=c.acquire(w,x,"glow horizontal",8);this._blurParameters.emissionsToDownsample=_,this._prepareFBO(D,w,x),y.bindTechnique(n,this.bindParameters,this._blurParameters),y.screen.draw();const L=c.acquire(w,x,"glow vertical",8);this._blurParameters.emissionsToDownsample=D.getTexture(),this._prepareFBO(L,w,x),y.bindTechnique(a,this.bindParameters,this._blurParameters),y.screen.draw(),D.release(),this._glowResults[O]=L,w=Math.ceil(w/2),x=Math.ceil(x/2),_=this._glowResults[O].getTexture(),this._blurParameters.blurRadius*=this._blurScale}this._blurParameters.blurRadius=$;const A=this.bindParameters.camera,M=Le(A.eye);this._compositionParameters.atmosphereC=M**2-this._atmosphereRadius**2,this._compositionParameters.color=l,this._compositionParameters.emission=r.attachment,this._compositionParameters.lodTexture0=this._glowResults[0].getTexture(),this._compositionParameters.lodTexture1=this._glowResults[1].getTexture(),this._compositionParameters.lodTexture2=this._glowResults[2].getTexture(),this._compositionParameters.lodTexture3=this._glowResults[3].getTexture(),this._compositionParameters.lodTexture4=this._glowResults[4].getTexture();const P=c.acquire(l.descriptor.width,l.descriptor.height,this.produces);return P.acquireColor(Do,8,"emissive glow"),this._prepareFBO(P,h,f,!0),y.bindTechnique(o,this.bindParameters,this._compositionParameters),y.screen.draw(),this._glowResults.forEach(O=>O.release()),P.attachDepth(s),P}_prepareFBO(e,i,r,s=!1){const n=this.renderingContext;n.bindFramebuffer(e.fbo),n.setViewport(0,0,i,r),n.setClearColor(0,0,0,0),n.clear(16384),s&&n.clearBuffer(1,K8)}get test(){return{compositionParameters:this._compositionParameters,blurParameters:this._blurParameters,setBlurLodCombination:e=>{this._compositionParameters.dispersionWeight=e,this._computeLodFactors()},setLodFactors:e=>{this._computeLodFactors(MLe(e))},toggleTonemapping:e=>{this._compositionConfiguration.tonemappingEnabled=e,this.requestRender(1)}}}};d([m()],hw.prototype,"consumes",void 0),d([m()],hw.prototype,"produces",void 0),hw=d([k("esri.views.3d.webgl-engine.effects.glow.GlowRenderNode")],hw);let Pse=class extends hr{};function OLe(){const t=new Di;return t.include(Oa),t.fragment.uniforms.add(new zt("colorTexture",e=>e.color),new po("depthTexture",e=>e.mainDepth)),t.fragment.main.add(E`float depthSample = texture(depthTexture, uv).r;
if (depthSample == 1.0 ) {
fragColor = vec4(0);
return;
}
fragColor = texture(colorTexture, uv);`),t}const eAt=Object.freeze(Object.defineProperty({__proto__:null,HazeCompositingPassParameters:Pse,build:OLe},Symbol.toStringTag,{value:"Module"}));let z_e=class extends Vi{constructor(e,i){super(e,i,new Ii(eAt,()=>te(()=>Promise.resolve().then(()=>tzt),void 0)),Qs)}initializePipeline(){return li({blending:Ly(1,0,769,1),depthTest:{func:519},colorWrite:$i})}};function PLe(t){const e=new Di,{fragment:i}=e;e.include(L4),$p(i),i.include(t1),i.include(rd),i.include(f4),i.include(EM),i.include(j5e,!0),i.uniforms.add(new po("depthTexture",s=>s.mainDepth),new ut("hazeStrength",s=>s.hazeStrength));const{reduced:r}=t;return r&&i.code.add(E`float getDepth(vec2 uv){
return linearDepthFromTexture(depthTexture, uv);
}
float textureBilinear(vec2 uv) {
vec2 depthTextureSize = vec2(textureSize(depthTexture, 0));
vec2 texelSize = 1.0 / depthTextureSize;
vec2 depthUV = (uv * depthTextureSize) - vec2(0.5);
vec2 f = fract(depthUV);
vec2 snapUV = (floor(depthUV) + vec2(0.5)) / depthTextureSize;
float d0 = getDepth(snapUV);
float d1 = getDepth(snapUV + vec2(texelSize.x, 0.0));
float d2 = getDepth(snapUV + vec2(0.0, texelSize.y));
float d3 = getDepth(snapUV + texelSize);
return mix(mix(d0, d1, f.x), mix(d2, d3, f.x), f.y);
}`),i.main.add(E`
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;

      float depthSample = texture(depthTexture, uv).r;
      if (depthSample != 1.0) {
        vec3 cameraSpaceRay = normalize(eyeDir);
        cameraSpaceRay /= cameraSpaceRay.z;

        cameraSpaceRay *= ${_e(r,"-textureBilinear(uv)","-linearDepthFromTexture(depthTexture, uv)")};
        terrainDepth = max(0.0, length(cameraSpaceRay));
      } else {
        discard;
      }

      // Alpha is ignored for haze blending
      vec3 col = vec3(0);
      float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
      if(depthSample != 1.0){
        col = (1.0 - fadeOut) * hazeStrength * raymarchAtmosphere(cameraPosition, rayDir, mainLightDirection, terrainDepth);
      }
      float alpha = 1.0;

      col = tonemapACES(col);
      fragColor = delinearizeGamma(vec4(col, alpha));
  `),e}const tAt=Object.freeze(Object.defineProperty({__proto__:null,build:PLe},Symbol.toStringTag,{value:"Module"}));let iAt=class extends B5e{constructor(){super(...arguments),this.hazeStrength=1}},iH=class extends Vi{constructor(e,i){super(e,i,new Ii(tAt,()=>te(()=>Promise.resolve().then(()=>izt),void 0)),ed(g4))}initializePipeline(e){return e.reduced?li({blending:aie,depthTest:{func:519},colorWrite:$i}):li({blending:Ly(1,0,769,1),colorWrite:$i})}},BF=class extends Fo{constructor(){super(...arguments),this.reduced=!1}};d([oe()],BF.prototype,"reduced",void 0);let eJ=class extends Ow{constructor(e){super(e),this._compositingPassParameters=new Pse,this._passParameters=new iAt,this._hazeConfiguration=new BF,this.requireGeometryDepth=!0,this._oldAmount=1,this._newAmount=1,this._amount=this._newAmount;const i=e.view.stage.renderView.techniques;i.precompile(iH,new BF);const r=new BF;r.reduced=!0,i.precompile(iH,r),i.precompile(z_e)}initialize(){this.addHandles([K(()=>this.view.environment.atmosphereEnabled,e=>e?this._enable():this._disable(),At),K(()=>this.view.stage?.renderer.renderContext.bind.clouds.fadeFactor??1,e=>this._fade(e),At),K(()=>this.view.environment.weather.type,e=>this._newAmount=e==="rainy"?0:1,At),K(()=>this.view.stage.renderer?.fullResolutionAtmosphere,e=>this._hazeConfiguration.reduced=!e,At)])}_fade(e){e>=1?(this._amount=this._newAmount,this._oldAmount=this._newAmount):this._amount=e<=0?this._oldAmount:ft(this._oldAmount,this._newAmount,e)}destroy(){this._vao=Rt(this._vao)}render(e){const i=e.find(({name:S})=>S===ht.TRANSPARENT_ENVIRONMENT);if(!this.bindParameters.mainDepth)return i;const r=this.renderingContext,s=this.techniques.get(iH,this._hazeConfiguration);if(!s.compiled)return i;const n=i.getAttachment(Ba);if(this._update(),!this._hazeConfiguration.reduced)return i.detachDepth(),r.bindFramebuffer(i.fbo),r.bindTechnique(s,this.bindParameters,this._passParameters),this._renderCommon(r),i.attachDepth(n),i;const a=this.techniques.get(z_e);if(!a.compiled)return i;const o=r.getViewport(),l=this.camera,c=Le(l.eye)-mi.radius;let h;const f=mi.atmosphereHeight;if(c<f){const S=Math.min(1,Math.max(0,c/f));h=ft(.4,.5,S)}else{const S=Math.min(1,Math.max(0,(c-f)/(15*f)));h=ft(.5,1,S)}const y=this.renderingContext.parameters.maxTextureSize,_=Iv(Math.round(h*l.fullViewport[2]),y),w=Iv(Math.round(h*l.fullViewport[3]),y);r.setViewport(0,0,_,w);const x=this.fboCache.acquire(_,w,"haze",5);return r.bindFramebuffer(x.fbo),r.clearFramebuffer([0,0,0,1],!0,!0),r.bindTechnique(s,this.bindParameters,this._passParameters),this._renderCommon(r),r.setViewport(o.x,o.y,o.width,o.height),this._compositingPassParameters.color=x.getTexture(),i.detachDepth(),r.bindFramebuffer(i.fbo),r.bindTechnique(a,this.bindParameters,this._compositingPassParameters),r.screen.draw(),i.attachDepth(n),x.release(),i}_renderCommon(e){this._vao??=i1(e,1),e.bindVAO(this._vao),e.drawArrays(lr.TRIANGLE_STRIP,0,4)}_update(){const e=this.bindParameters.camera,i=On(e.eye),r=Math.sqrt(i),s=i-this._passParameters.radii[1]*this._passParameters.radii[1],n=Se((r-this._passParameters.radii[0])/mi.atmosphereHeight,0,1);yr(this._passParameters.heightParameters,r,i,s,n);const a=this.view.basemapTerrain?.getLowerBoundRadius()??0;Cr(this._passParameters.radii,a,a+mi.atmosphereHeight),this._passParameters.hazeStrength=ft(ft(.6,1,sC(9500,10500,r-mi.radius)),1,this._amount)}};eJ=d([k("esri.views.3d.webgl-engine.effects.haze.Haze")],eJ);function rH(t){if(!t.highlights)return null;const e=t.highlights.findIndex(i=>i.name==="default");return e===-1?null:t.highlights.items[e]}function rAt(t){const e=t.fragment;t.include(I8),e.include(rd),e.code.add(E`vec3 normalFromDepth(sampler2D depthMap, vec3 pixelPos, vec2 fragCoord, vec2 uv) {
ivec2 iuv = ivec2(uv * vec2(textureSize(depthMap, 0)));
float leftPixelDepth = linearizeDepth(texelFetch(depthMap, iuv + ivec2(-1, 0), 0).r);
float rightPixelDepth = linearizeDepth(texelFetch(depthMap, iuv + ivec2(1, 0), 0).r);
float bottomPixelDepth = linearizeDepth(texelFetch(depthMap, iuv + ivec2(0, -1), 0).r);
float topPixelDepth = linearizeDepth(texelFetch(depthMap, iuv + ivec2(0, 1), 0).r);
bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);
vec3 fragCoordHorizontal = pickLeft
? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
: vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
vec3 fragCoordVertical = pickBottom
? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
: vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);
vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);
vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
return pickLeft == pickBottom ? normal : -normal;
}`)}function RLe(t){t.include(SDe),sAt(t)}function sAt(t){t.fragment.include(rd),t.include(I8),t.fragment.uniforms.add(new Io("inverseViewMatrix",({camera:e})=>nl(F_e,Qh(F_e,e.viewMatrix,e.center)))).code.add(E`vec3 calculateUVZShadowAndPixelPosFromDepth(
in vec2 _uv,
ivec2 shadowMapSize,
in sampler2D _depthMap,
out vec4 currentPixelPos
) {
float depth = depthFromTexture(_depthMap, _uv);
if (depth >= 1.0 || depth <= 0.0) {
return invalidShadowmapUVZ;
}
float currentPixelDepth = linearizeDepth(depth);
currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
float linearDepth = -currentPixelDepth;
return calculateUVZShadow(worldSpacePos.xyz, linearDepth, shadowMapSize);
}
vec3 calculateUVZShadowFromDepth(
in vec2 _uv,
ivec2 shadowMapSize,
in sampler2D _depthMap
) {
vec4 currentPixelPos;
return calculateUVZShadowAndPixelPosFromDepth(_uv, shadowMapSize, _depthMap, currentPixelPos);
}`)}const F_e=it(),nAt=.025;function DLe(){const t=new Di;t.include(RLe),t.include(gre),t.include(Oa),t.include(rAt);const e=t.fragment;return e.uniforms.add(new hV("shadowMapExcludingHighlight",i=>i.shadowMap.getSnapshot(1)),new hV("shadowMapHighlight",i=>i.shadowMap.getSnapshot(0)),new po("depthMap",i=>i.depth?.attachment),new AM("highlightTexture",i=>i.highlightTexture),new Xn("uColor",i=>i.shadowColor),new ut("opacity",i=>i.shadowOpacity),new ut("occludedOpacity",i=>i.occludedShadowOpacity),new ut("terminationFactor",i=>i.opacityElevation*i.dayNightTerminator),new co("lightingMainDirectionView",({lighting:i,camera:r})=>Ee(N_e,Mt(N_e,i.mainLight.direction,r.viewInverseTransposeMatrix)))),e.main.add(E`
    ivec2 highlightTextureSize = textureSize(highlightTexture, 0);
    ivec2 highlightIUV = ivec2(uv * vec2(highlightTextureSize));
    uvec2 highlightInfo = texelFetch(highlightTexture, highlightIUV, 0).rg;

    fragColor = vec4(0.0);

    // Calculate bit mask to check if pixel is highlit unoccluded at any level
    uint ored = (highlightInfo.r << 0) | (highlightInfo.g << 8);

    bool visiblyHighlighted = ((ored & ~(ored >> 1)) & (1u+4u+16u+64u)) != 0u;
    if (visiblyHighlighted) {
      return;
    }

    vec4 currentPixelPos;
    vec3 uvzShadow = calculateUVZShadowAndPixelPosFromDepth(uv, textureSize(shadowMapHighlight,0), depthMap, currentPixelPos);
    if (uvzShadow.z < 0.0) {
      return;
    }

    float shadowHighlightFactor = readShadowMapUVZ(uvzShadow, shadowMapHighlight);
    if (shadowHighlightFactor == 0.0) {
      return;
    }

    float shadowExcludingHighlightFactor = readShadowMapUVZ(uvzShadow, shadowMapExcludingHighlight);

    vec3 normal = normalFromDepth(depthMap, currentPixelPos.xyz, gl_FragCoord.xy, uv);
    bool shaded = dot(normal, lightingMainDirectionView) < ${E.float(nAt)};

    float occludedFactor = max(shadowExcludingHighlightFactor, shaded ? 1.0 : 0.0);
    float fragOpacity = mix(opacity, occludedOpacity, occludedFactor);
    fragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
  `),t}const N_e=R(),aAt=Object.freeze(Object.defineProperty({__proto__:null,build:DLe},Symbol.toStringTag,{value:"Module"}));let oAt=class extends yre{constructor(){super(...arguments),this.shadowColor=fi(1,0,1,1),this.shadowOpacity=.2,this.occludedShadowOpacity=.1,this.opacityElevation=1,this.dayNightTerminator=1}},V_e=class extends Vi{constructor(e,i){super(e,i,new Ii(aAt,()=>te(()=>Promise.resolve().then(()=>rzt),void 0)),Qs),this.primitiveType=lr.TRIANGLE_STRIP}initializePipeline(){return li({blending:em,colorWrite:$i,depthTest:null,depthWrite:null})}};const lAt=1/512,cAt=4e4,uAt=5e4;let FT=class extends Nl{constructor(e){super(e),this.produces=es.COMPOSITE,this.consumes={required:[es.COMPOSITE,"highlights"]},this._passParameters=new oAt,this._maxOpacity=1,this._shadowDifference=.2}initialize(){this.addHandles([K(()=>rH(this.view)?.shadowOpacity,e=>{this._passParameters.shadowOpacity=e??JMe,this._updateOccludedShadowOpacity(),this._ensureMaxOpacity()},At),K(()=>rH(this.view)?.shadowDifference,e=>{this._shadowDifference=e??KMe,this._updateOccludedShadowOpacity(),this._ensureMaxOpacity()},At),K(()=>rH(this.view)?.shadowColor,e=>{this._passParameters.shadowColor=wse(e??XMe),this._ensureMaxOpacity()},At)])}_updateOccludedShadowOpacity(){this._passParameters.occludedShadowOpacity=this._passParameters.shadowOpacity*(1-this._shadowDifference)}_ensureMaxOpacity(){const e=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity);this._maxOpacity=e*this._passParameters.shadowColor[3],this.requestRender(1)}precompile(){this.techniques.precompile(V_e)}render(e){const i=e.find(({name:a})=>a===es.COMPOSITE),r=this.bindParameters;if(!r.shadowHighlightsVisible||!r.depth||!this._ensureIfVisible(r.camera,r.lighting.mainLight.direction))return i;const s=this.techniques.get(V_e);if(!s.compiled)return this.requestRender(1),i;this._passParameters.highlightTexture=e.find(({name:a})=>a==="highlights")?.getTexture(),this._passParameters.origin=r.camera.center;const n=this.renderingContext;return n.bindFramebuffer(i.fbo),n.bindTechnique(s,r,this._passParameters),n.screen.draw(),i}_ensureIfVisible(e,i){this._passParameters.opacityElevation=1-sC(cAt,uAt,e.relativeElevation);const r=this.viewingMode===1?Ee(U_e,e.center):ve(U_e,0,0,1),s=Oe(r,i);return this._passParameters.dayNightTerminator=sC(0,1,Se(30*s,0,1)),this._maxOpacity*this._passParameters.opacityElevation*this._passParameters.dayNightTerminator>=lAt}};d([m()],FT.prototype,"produces",void 0),d([m()],FT.prototype,"consumes",void 0),d([m({constructOnly:!0})],FT.prototype,"viewingMode",void 0),FT=d([k("esri.views.3d.webgl-engine.effects.highlight.ShadowHighlight")],FT);const U_e=R();let Rse=class extends hr{constructor(){super(...arguments),this.mask=null,this.overlay=null,this.input=null,this.size=0}};function ILe(){const t=new Di;return t.attributes.add("position","vec2"),t.vertex.uniforms.add(new Xn("drawPosition",(e,i)=>hAt(e,i))),t.varyings.add("vUV","vec2"),t.vertex.main.add(E`vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);`),t.fragment.uniforms.add(new zt("textureInput",e=>e.input)),t.fragment.uniforms.add(new zt("textureMask",e=>e.mask)),t.fragment.uniforms.add(new zt("textureOverlay",e=>e.overlay)),t.fragment.uniforms.add(new VC("maskEnabled",e=>e.magnifier.maskEnabled)),t.fragment.uniforms.add(new VC("overlayEnabled",e=>e.magnifier.overlayEnabled)),t.fragment.code.add(E`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}`),t.fragment.main.add(E`float mask = maskEnabled ? texture(textureMask, vUV).a : 1.0;
vec4 inputColor = texture(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture(textureOverlay, vUV) : vec4(0);
fragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;`),t}function hAt(t,e){const i=e.camera.pixelRatio,r=t.magnifier.offset.x*i,s=t.magnifier.offset.y*i;Xd(t.magnifier.position,B_e);const n=e.camera.screenToRender(B_e,dAt),a=Math.ceil(i*t.magnifier.size),{fullWidth:o,fullHeight:l}=e.camera;return yr(pAt,(n[0]+r)/o*2-1,(n[1]-s)/l*2-1,a/o*2,a/l*2)}const B_e=Gs(),dAt=CU(),pAt=ri(),fAt=Object.freeze(Object.defineProperty({__proto__:null,MagnifierPassParameters:Rse,build:ILe},Symbol.toStringTag,{value:"Module"}));let j_e=class extends Vi{constructor(e,i){super(e,i,new Ii(fAt,()=>te(()=>Promise.resolve().then(()=>szt),void 0)),Qs)}initializePipeline(){return li({blending:Qv,depthTest:null,depthWrite:null,colorWrite:$i})}};async function mAt(t){const e=te(()=>import("./mask-svg-BZIDpTf0.js"),[]),i=te(()=>import("./overlay-svg-DKwEt0oU.js"),[]),r=$y((await e).default,{signal:t}),s=$y((await i).default,{signal:t}),n={mask:await r,overlay:await s};return st(t),n}let Cb=class extends Nl{constructor(){super(...arguments),this.produces=ht.MAGNIFIER,this.consumes={required:[ht.MAGNIFIER]},this._imageSources=null,this._imageLoadTask=null,this._passParameters=new Rse,this._magnifier=null,this._tmpScreenPoint=Gs(),this._tmpRenderPoint=CU()}initialize(){this.addHandles([K(()=>this.view.magnifier,e=>this._update(e),At)])}_update(e){if(e===this._magnifier)return;this.removeAllHandles(),this._magnifier=e;const i=()=>{const r=this._validMagnifier;r?(this._loadResources(r),this.produces=ht.MAGNIFIER):this.produces="disabled",this.requestRender()};this._magnifier&&this.addHandles(K(()=>this._magnifier?.version,i)),i()}get _validMagnifier(){return this._magnifier?.visible&&this._magnifier?.position&&this._magnifier?.size>0?this._magnifier:null}get _factor(){return this._magnifier?.factor||1}destroy(){this._magnifier=null,this._imageLoadTask!=null&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null),this._disposeTextures(),this._vao=Rt(this._vao)}_disposeTextures(){this._passParameters.mask=Rt(this._passParameters.mask),this._passParameters.overlay=Rt(this._passParameters.overlay),this._passParameters.input=Rt(this._passParameters.input)}precompile(){this._imageSources&&this.techniques.precompile(j_e)}render(e){const i=this._validMagnifier,r=e.find(({name:$})=>$===ht.MAGNIFIER);if(i==null)return r;if(this._imageSources==null)return this.requestRender(1),r;const s=this.renderingContext,n=this.camera.pixelRatio,a=Math.ceil(n*i.size);this._vao??=i1(s,0,0,1);const o=this.techniques.get(j_e);if(this._ensureTextureResources(s,a),!o.compiled||!this._passParameters.input)return this.requestRender(1),r;const l=Math.ceil(1/this._factor*a),c=this._passParameters.input;c.resize(l,l),Xd(i.position,this._tmpScreenPoint);const h=this.camera.screenToRender(this._tmpScreenPoint,this._tmpRenderPoint),f=this.camera.fullWidth,y=this.camera.fullHeight,_=.5*l,w=.5*l;h[0]=Se(h[0],_,f-_-1),h[1]=Se(h[1],w,y-w-1);const x=Math.floor(h[0]-_),S=Math.floor(h[1]-w);return s.bindFramebuffer(r.fbo),o.program.bindTexture("textureInput",c),s.gl.copyTexImage2D(c.descriptor.target,0,c.descriptor.pixelFormat,x,S,l,l,0),this._passParameters.magnifier=i,s.bindTechnique(o,this.bindParameters,this._passParameters),s.bindVAO(this._vao),s.drawArrays(lr.TRIANGLE_STRIP,0,4),r}_loadResources(e){const{maskUrl:i,overlayUrl:r}=e;this._imageLoadTask?.maskUrl===i&&this._imageLoadTask?.overlayUrl===r||(this._imageLoadTask?.task.abort(),this._imageLoadTask=this._imageSources=null),this._imageSources||this._imageLoadTask||(this._imageLoadTask={maskUrl:i,overlayUrl:r,task:Bc(async s=>{const n=i==null||r==null?mAt(s):null,a=i!=null?$y(i,{signal:s}):n.then(l=>l.mask),o=r!=null?$y(r,{signal:s}):n.then(l=>l.overlay);this._imageSources={mask:await a,overlay:await o}})})}_ensureTextureResources(e,i){this._imageSources==null||this._passParameters.size===i&&this._passParameters.input&&this._passParameters.mask&&this._passParameters.overlay||(this._disposeTextures(),this._imageSources.overlay.width=this._imageSources.mask.width=i,this._imageSources.overlay.height=this._imageSources.mask.height=i,this._passParameters.overlay=new Fi(e,this._createTextureDescriptor(i,6408,this._imageSources.overlay),this._imageSources.overlay),this._passParameters.mask=new Fi(e,this._createTextureDescriptor(i,6406,this._imageSources.mask),this._imageSources.mask),this._passParameters.input=new Fi(e,this._createTextureDescriptor(i,6408,null)))}_createTextureDescriptor(e,i,r){const s=this.renderingContext,n=new Zi(e);return n.pixelFormat=n.internalFormat=i,n.wrapMode=33071,n.flipped=!!r,n.preMultiplyAlpha=!(i!==6408||!r||pxe(r.src)&&s.driverTest.svgPremultipliesAlpha.result),n}};d([m()],Cb.prototype,"produces",void 0),d([m()],Cb.prototype,"consumes",void 0),d([m()],Cb.prototype,"_imageSources",void 0),d([m()],Cb.prototype,"_imageLoadTask",void 0),Cb=d([k("esri.views.3d.webgl-engine.effects.magnifier.Magnifier")],Cb);const EA=8,gAt=16;function LLe(){const t=new Di;t.include(Oa),t.fragment.uniforms.add(new zt("edgesTexture",i=>i.inputTexture),new zt("areaTexture",i=>i.areaTexture),new zt("searchTexture",i=>i.searchTexture)),t.fragment.constants.add("smaaAreaTexPixelSize","vec2",[1/160,1/560]);const e=1/7;return t.fragment.code.add(E`
    vec4 sampleLevelZeroOffset(vec2 coord, vec2 offset, vec2 resolution) {
      return texture(edgesTexture, coord + offset.x * resolution);
    }

    float searchLength(vec2 e, float bias, float scale) {
      e.r = bias + e.r * scale;
      return 255.0 * texture(searchTexture, e).r;
    }

    float searchLeft(vec2 texcoord, float end, vec2 resolution) {
      vec2 e = vec2(0.0, 1.0);
      for (int i = 0; i < ${E.int(EA)}; ++i) {
        e = texture(edgesTexture, texcoord).rg;
        texcoord -= vec2(2.0, 0.0) * resolution;
        if (! (texcoord.x > end && e.g > 0.8281 && e.r == 0.0)) break;
      }
      texcoord.x += 0.25 * resolution.x;
      texcoord.x += resolution.x;
      texcoord.x += 2.0 * resolution.x;
      texcoord.x -= resolution.x * searchLength(e, 0.0, 0.5);
      return texcoord.x;
    }

    float searchRight(vec2 texcoord, float end, vec2 resolution) {
      vec2 e = vec2(0.0, 1.0);
      for (int i = 0; i < ${E.int(EA)}; ++i) {
        e = texture(edgesTexture, texcoord).rg;
        texcoord += vec2(2.0, 0.0) * resolution;
        if (! (texcoord.x < end && e.g > 0.8281 && e.r == 0.0)) break;
      }
      texcoord.x -= 0.25 * resolution.x;
      texcoord.x -= resolution.x;
      texcoord.x -= 2.0 * resolution.x;
      texcoord.x += resolution.x * searchLength(e, 0.5, 0.5);
      return texcoord.x;
    }

    float searchUp(vec2 texcoord, float end, vec2 resolution) {
      vec2 e = vec2(1.0, 0.0);
      for (int i = 0; i < ${E.int(EA)}; ++i) {
        e = texture(edgesTexture, texcoord).rg;
        texcoord += vec2(0.0, 2.0) * resolution;
        if (! (texcoord.y > end && e.r > 0.8281 && e.g == 0.0)) break;
      }
      texcoord.y -= 0.25 * resolution.y;
      texcoord.y -= resolution.y;
      texcoord.y -= 2.0 * resolution.y;
      texcoord.y += resolution.y * searchLength(e.gr, 0.0, 0.5);
      return texcoord.y;
    }

    float searchDown(vec2 texcoord, float end, vec2 resolution) {
      vec2 e = vec2(1.0, 0.0);
      for (int i = 0; i < ${E.int(EA)}; ++i) {
        e = texture(edgesTexture, texcoord).rg;
        texcoord -= vec2(0.0, 2.0) * resolution;
        if (! (texcoord.y < end && e.r > 0.8281 && e.g == 0.0)) break;
      }
      texcoord.y += 0.25 * resolution.y;
      texcoord.y += resolution.y;
      texcoord.y += 2.0 * resolution.y;
      texcoord.y -= resolution.y * searchLength(e.gr, 0.5, 0.5);
      return texcoord.y;
    }

    vec2 getArea(sampler2D areaTex, vec2 dist, float e1, float e2, float offset) {
      vec2 texcoord = float(${E.int(gAt)}) * round(4.0 * vec2(e1, e2)) + dist;
      texcoord = smaaAreaTexPixelSize * texcoord + (0.5 * smaaAreaTexPixelSize);
      texcoord.y += ${E.float(e)} * offset;
      return texture(areaTex, texcoord).rg;
    }`),t.fragment.main.add(E`
    vec2 size = vec2(textureSize(edgesTexture, 0));
    vec2 resolution = 1.0 / size;
    vec2 pixelCoord = uv * size;
    vec4 offsets[2];
    offsets[0] = uv.xyxy + resolution.xyxy * vec4(-0.25, 0.125, 1.25, 0.125);
    offsets[1] = uv.xyxy + resolution.xyxy * vec4(-0.125, 0.25, -0.125, -1.25);
    vec4 maxOffset = vec4(offsets[0].xz, offsets[1].yw) + vec4(-2.0, 2.0, -2.0, 2.0) * resolution.xxyy * float(${E.int(EA)});
    ivec4 subsampleIndices = ivec4(0.0);
    vec4 weights = vec4(0.0);
    vec2 e = texture(edgesTexture, uv).rg;
    if (e.r > 0.0) {
      vec2 d;
      vec2 coords;
      coords.y = searchUp(offsets[1].xy, maxOffset.z, resolution);
      coords.x = offsets[0].x;
      d.x = coords.y;
      float e1 = texture(edgesTexture, coords).g;
      coords.y = searchDown(offsets[1].zw, maxOffset.w, resolution);
      d.y = coords.y;
      d = d * size.y - pixelCoord.y;
      vec2 sqrt_d = sqrt(abs(d));
      coords.y -= 1.0 * resolution.y;
      float e2 = sampleLevelZeroOffset(coords, vec2(0.0, 1.0), resolution).g;
      weights.ba = getArea(areaTexture, sqrt_d, e1, e2, float(subsampleIndices.x));
      // for some reason the following lines are necessary to prevent
      // texture lookup precision issues on some Intel integrated graphics chips
      vec4 dbg = (offsets[0] + offsets[1] + maxOffset + coords.xyyx);
      weights.r += 0.00000001 * dot(vec4(0, 1, 0, 1), dbg);
    }
    if (e.g > 0.0) {
      vec2 d;
      vec2 coords;
      coords.x = searchLeft(offsets[0].xy, maxOffset.x, resolution);
      coords.y = offsets[1].y;
      d.x = coords.x;
      float e1 = texture(edgesTexture, coords).r;
      coords.x = searchRight(offsets[0].zw, maxOffset.y, resolution);
      d.y = coords.x;
      d = d * size.x - pixelCoord.x;
      vec2 sqrt_d = sqrt(abs(d));
      coords.y -= 1.0 * resolution.y;
      float e2 = sampleLevelZeroOffset(coords, vec2(1.0, 0.0), resolution).r;
      weights.rg = getArea(areaTexture, sqrt_d, e1, e2, float(subsampleIndices.y));
    }
    fragColor = weights;
  `),t}const yAt=Object.freeze(Object.defineProperty({__proto__:null,build:LLe},Symbol.toStringTag,{value:"Module"}));let q_e=class extends Vi{constructor(e,i){super(e,i,new Ii(yAt,()=>te(()=>Promise.resolve().then(()=>nzt),void 0)),Qs)}initializePipeline(){return li({colorWrite:$i})}};function kLe(){const t=new Di;return t.include(Oa),t.fragment.uniforms.add(new zt("blendWeightsTexture",e=>e.inputTexture),new zt("colorTexture",e=>e.color)),t.fragment.main.add(E`vec2 resolution = 1.0 / vec2(textureSize(colorTexture, 0));
vec4 offsets = vec4(uv.x + resolution.x, uv.y, uv.x, uv.y - resolution.y);
vec4 a;
a.rb = texture(blendWeightsTexture, uv).rb;
a.g = texture(blendWeightsTexture, offsets.zw).g;
a.a = texture(blendWeightsTexture, offsets.xy).a;
if ( dot(a, vec4(1.0)) < 1e-5 ) {
fragColor = texture( colorTexture, uv, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture( colorTexture, uv, 0.0 );
vec4 Cop = texture( colorTexture, uv + sign( offset ) * resolution.xy, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
fragColor = mix(C, Cop, s);
}`),t}const _At=Object.freeze(Object.defineProperty({__proto__:null,build:kLe},Symbol.toStringTag,{value:"Module"}));let G_e=class extends Vi{constructor(e,i){super(e,i,new Ii(_At,()=>te(()=>Promise.resolve().then(()=>azt),void 0)),Qs)}initializePipeline(){return li({colorWrite:$i})}};const vAt=.05,bAt=2;function zLe(){const t=new Di;return t.include(Oa),t.outputs.add("fragEdges","vec2"),t.fragment.code.add(E`float absMax3(vec3 v) {
vec3 t = abs(v);
return max(max(t.r, t.g), t.b);
}`),t.fragment.uniforms.add(new zt("colorTexture",e=>e.color)).main.add(E`
    vec2 resolution = 1.0 / vec2(textureSize(colorTexture, 0));
    vec4 offsets[3];
    offsets[0] = vec4(uv.x - resolution.x, uv.y, uv.x, uv.y + resolution.y);
    offsets[1] = vec4(uv.x + resolution.x, uv.y, uv.x, uv.y - resolution.y);
    offsets[2] = vec4(uv.x - 2.0 * resolution.x, uv.y, uv.x, uv.y + 2.0 * resolution.y);

    // Calculate color deltas:
    vec3 C = texture(colorTexture, uv).rgb;
    vec3 Cleft = texture(colorTexture, offsets[0].xy).rgb;
    vec3 Ctop = texture(colorTexture, offsets[0].zw).rgb;
    vec2 delta = vec2(absMax3(C - Cleft), absMax3(C - Ctop));
    vec2 edges = step(vec2(${E.float(vAt)}), delta);

    // discard if there is no edge:
    if (dot(edges, vec2(1.0)) == 0.0) {
      fragEdges = vec2(0.0);
    }
    else {
      // Calculate right and bottom deltas:
      vec3 Cright = texture(colorTexture, offsets[1].xy).rgb;
      float horizontal = absMax3(C - Cright);

      vec3 Cbottom  = texture(colorTexture, offsets[1].zw).rgb;
      float vertical = absMax3(C - Cbottom);

      // Calculate the maximum delta in the direct neighborhood:
      float maxDelta = max(max(max(delta.x, delta.y), horizontal), vertical);

      // Calculate left-left and top-top deltas:
      vec3 Cleftleft  = texture(colorTexture, offsets[2].xy).rgb;
      horizontal = absMax3(C - Cleftleft);

      vec3 Ctoptop = texture(colorTexture, offsets[2].zw).rgb;
      vertical = absMax3(C - Ctoptop);

      // Calculate the final maximum delta:
      maxDelta = max(max(maxDelta, horizontal), vertical);

      // Local contrast adaptation in action:
      fragEdges = edges * step(maxDelta, float(${E.float(bAt)}) * delta);
    }
  `),t}const wAt=Object.freeze(Object.defineProperty({__proto__:null,build:zLe},Symbol.toStringTag,{value:"Module"}));let H_e=class extends Vi{constructor(e,i){super(e,i,new Ii(wAt,()=>te(()=>Promise.resolve().then(()=>ozt),void 0)),Qs)}initializePipeline(){return li({colorWrite:$i})}},xAt=class extends hr{},Mb=class extends Nl{constructor(e){super(e),this.produces="disabled",this.consumes={required:[ht.ANTIALIASING],optional:[es.COMPOSITE]},this._areaTexture=null,this._searchTexture=null,this._smaaParameters=new xAt}initialize(){this.addHandles([K(()=>this.isEnabled(),e=>e?this.enable():this.disable(),At)])}async enable(){if(this.destroyed||(this.produces=ht.ANTIALIASING,this.requestRender(1),this._abortController||this._areaTexture&&this._searchTexture))return;this._abortController=new AbortController;const e=this._abortController.signal;try{const i=await te(()=>import("./SMAAData-DCEZ61Cs.js"),[]);st(e),await this._loadTextures(i,e),st(e),this.requestRender(1)}catch(i){Hr(i)||fe.getLogger(this).errorOnce(i)}this._abortController=null}async _loadTextures(e,i){st(i);const[r,s]=await Promise.allSettled([$y(e.areaTexture,{signal:i}),$y(e.searchTexure,{signal:i})]);if(st(i),r.status!=="fulfilled"||s.status!=="fulfilled")return;const n=this.renderingContext;this._areaTexture=W_e(n,9729,6407,r.value),this._searchTexture=W_e(n,9728,6409,s.value)}disable(){this.produces="disabled",this.requestRender(1)}destroy(){this._abortController=ps(this._abortController),this._searchTexture=Rt(this._searchTexture),this._areaTexture=Rt(this._areaTexture)}precompile(){this.techniques.precompile(H_e),this.techniques.precompile(q_e),this.techniques.precompile(G_e)}render(e){const i=e.find(({name:_})=>_===ht.ANTIALIASING),r=e.find(({name:_})=>_===es.COMPOSITE);if(!r)return i;if(!this._areaTexture||!this._searchTexture)return this.view.stage.renderer.blitFBO(r,i,!1),this.requestRender(1),i;const s=this.techniques.get(H_e),n=this.techniques.get(q_e),a=this.techniques.get(G_e);if(!s.compiled||!n.compiled||!a.compiled)return this.view.stage.renderer.blitFBO(r,i,!1),this.requestRender(1),i;const o=r.fbo.width,l=r.fbo.height,c=this.renderingContext;c.setViewport(0,0,o,l);const h=this.fboCache.acquire(o,l,"smaa edges",2);c.bindFramebuffer(h.fbo),c.setClearColor(0,0,0,1),c.clear(16384),this._smaaParameters.color=r.getTexture();const f=this.bindParameters;c.bindTechnique(s,f,this._smaaParameters),c.screen.draw();const y=this.fboCache.acquire(o,l,"smaa blend");return c.bindFramebuffer(y.fbo),c.setClearColor(0,0,1,1),c.clear(16384),this._smaaParameters.inputTexture=h.getTexture(),this._smaaParameters.areaTexture=this._areaTexture,this._smaaParameters.searchTexture=this._searchTexture,c.bindTechnique(n,f,this._smaaParameters),c.screen.draw(),h.release(),c.bindFramebuffer(i.fbo),c.setClearColor(0,1,0,1),c.clear(16384),this._smaaParameters.inputTexture=y.getTexture(),c.bindTechnique(a,f,this._smaaParameters),c.screen.draw(),y.release(),i}};function W_e(t,e,i,r){const s=new Zi(r.width,r.height);return s.pixelFormat=i,s.wrapMode=33071,s.samplingMode=e,new Fi(t,s,r)}d([m()],Mb.prototype,"produces",void 0),d([m()],Mb.prototype,"consumes",void 0),d([m({constructOnly:!0})],Mb.prototype,"isEnabled",void 0),d([m()],Mb.prototype,"_abortController",void 0),Mb=d([k("esri.views.3d.webgl-engine.effects.smaa.SMAA")],Mb);function FLe(){const t=new Di;return t.attributes.add("position","vec3"),t.attributes.add("color","vec4"),t.attributes.add("size","float"),t.varyings.add("vcolor","vec4"),t.varyings.add("vsize","float"),t.vertex.uniforms.add(new cre("transform",(e,i)=>SAt(e,i)),new ao("viewport",e=>e.camera.fullViewport),new ws("pixelRatio",e=>e.camera.pixelRatio)),t.vertex.main.add(E`gl_Position = transform * vec4(position, 0);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;`),t.fragment.main.add(E`float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
fragColor = vec4(vcolor.xyz, intensity);`),t}function SAt(t,e){return pn(F0,e.camera.projectionMatrix),F0[10]=24e-8-1,F0[11]=-1,F0[14]=(24e-8-2)*e.camera.near,an(F0,F0,e.camera.viewMatrix),an(F0,F0,t.modelMatrix)}const F0=it(),TAt=Object.freeze(Object.defineProperty({__proto__:null,build:FLe},Symbol.toStringTag,{value:"Module"}));let $At=class extends hr{constructor(){super(...arguments),this.modelMatrix=it()}},Z_e=class extends Vi{constructor(e,i){super(e,i,new Ii(TAt,()=>te(()=>Promise.resolve().then(()=>lzt),void 0)),tJ.locations)}initializePipeline(){return li({blending:em,depthTest:{func:515},colorWrite:$i})}};const tJ=jc().vec3f("position").vec4u8("color").f32("size").freeze();let iJ=class extends Nf{constructor(){super(...arguments),this._numPoints=0,this._passParameters=new $At}initialize(){this.addHandles([K(()=>this.view.environment.starsEnabled,e=>e?this._enable():this._disable(),Wt),K(()=>this.view.environment.lighting.type==="virtual"?null:this.view.environment.lighting.date,e=>this._update(e),At)])}_enable(){super._enable(),this._loadDataTask=this._createLoadDataTask()}get loading(){return!!this._loadDataTask&&!this._loadDataTask.finished}destroy(){this._loadDataTask=ps(this._loadDataTask),this._numPoints=0,this._vao=Rt(this._vao),this._starData=null}precompile(){this.techniques.precompile(Z_e)}render(e){const i=e.find(({name:n})=>n===ht.OPAQUE_ENVIRONMENT),r=this.renderingContext;if(this.loading)return this.requestRender(1),i;if(!this._starData)return i;this._vao??=this._ensureResources(this._starData,r);const s=this.techniques.get(Z_e);return s.compiled?(r.bindTechnique(s,this.bindParameters,this._passParameters),r.bindVAO(this._vao),r.drawArrays(lr.POINTS,0,this._numPoints),i):(this.requestRender(1),i)}_ensureResources(e,i){return this._numPoints=e.byteLength/NLe,CAt(i,new Float32Array(e,0,2*this._numPoints),new Uint8Array(e,2*this._numPoints*4,this._numPoints),this._numPoints)}_update(e){if(!e)return;const i=(e.getHours()/12+e.getMinutes()/60*(2/24)+e.getSeconds()/60*(2/1440)-.9972222)%2,r=2*MAt(e),s=pn(this._passParameters.modelMatrix,DAt);MC(s,s,-r*Math.PI),an(s,RAt,s),MC(s,s,-i*Math.PI),this.requestRender(1)}_createLoadDataTask(){if(this._starData)return null;const e=Bc(async i=>{const{data:r}=await l7e("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:i});EAt(r),this._starData=r});return e.promise.catch(i=>{Hr(i)||fe.getLogger(this).error(i)}).then(()=>{this.destroyed||this.requestRender(1)}),e}};function CAt(t,e,i,r){const s=tJ.createBuffer(r),n=s.position,a=s.color,o=s.size;for(let l=0;l<r;l++){const c=e[2*l],h=e[2*l+1];n.set(l,0,-Math.cos(c)*Math.sin(h)),n.set(l,1,-Math.sin(c)*Math.sin(h)),n.set(l,2,-Math.cos(h));const f=OAt(i[l]),y=AAt(PAt[f[1]]);a.set(l,0,255*y[0]),a.set(l,1,255*y[1]),a.set(l,2,255*y[2]),a.set(l,3,255),o.set(l,f[0])}return new Op(t,new Hs(t,Lo(tJ),s.buffer))}function MAt(t){const e=t,i=new Date(t.getFullYear(),0,1,11,58,56);return(+e-+i)/(+new Date(t.getFullYear()+1,0,1,11,58,55)-+i)}function EAt(t){if(!t)throw new ee("stars:no-data-received","Failed to create stars because star catalogue is missing");const e=t.byteLength/NLe;if(e%1!=0||e>5e4||e<5e3)throw new ee("stars:invalid-data","Failed to create stars because star catalogue data is invalid")}function AAt(t){return[parseInt(t.slice(0,2),16),parseInt(t.slice(2,4),16),parseInt(t.slice(4,6),16)]}function OAt(t){return t>=192?[2.9,t-192]:t>=160?[2.5,t-160]:t>=128?[2,t-128]:t>=96?[1.5,t-96]:t>=64?[1,t-64]:t>=32?[.7,t-32]:[.4,t]}iJ=d([k("esri.views.3d.webgl-engine.effects.stars.Stars")],iJ);const PAt=["9bb2ff","9eb5ff","aabfff","bbccff","ccd8ff ","dae2ff","e4e9ff","eeefff","f8f6ff","fff9fb","fff5ef","fff1e5","ffeddb","ffe9d2","ffe6ca","ffe3c3","ffe0bb","ffddb4","ffdaad","ffd6a5","ffd29c","ffcc8f","ffc178","ffa94b","ff7b00"],RAt=Lee(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),DAt=Lee(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),NLe=9;let Dse=class extends hr{};function VLe(){const t=new Di;return t.include(Oa),t.fragment.uniforms.add(new zt("tex",e=>e.texture)),t.fragment.main.add(E`fragColor = vec4(1.0 - texture(tex, uv).a);`),t}const IAt=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:Dse,build:VLe},Symbol.toStringTag,{value:"Module"}));let Y_e=class extends Vi{constructor(e,i){super(e,i,new Ii(IAt,()=>te(()=>Promise.resolve().then(()=>czt),void 0)),Qs)}initializePipeline(){return li({colorWrite:{r:!1,g:!0,b:!1,a:!1}})}},LAt=class{constructor(e,i){this._rctx=e,this._techniques=i,this._configuration=new yR,this._passParameters=new X8,this._hudParameters=new Dse,this._configuration.blitMode=2,this._techniques.precompile(Of,this._configuration),this._configuration.blitEmissiveMode=1,this._techniques.precompile(Of,this._configuration),this._configuration.blitMode=1,this._techniques.precompile(Of,this._configuration),this._configuration.blitEmissiveMode=0,this._techniques.precompile(Of,this._configuration),this._configuration.blitMode=3,this._techniques.precompile(Of,this._configuration),this._techniques.precompile(Y_e)}compositeHUD(e,i){this._hudParameters.texture=i;const r=this._techniques.get(Y_e);this._rctx.bindTechnique(r,e,this._hudParameters),this._rctx.screen.draw()}compositePreMultipliedAlpha(e,i,r){this._composite(e,i,2,r)}composite(e,i,r){this._composite(e,i,1,r)}blitDepthToLinearDepth(e,i){this._composite(e,i,3)}_composite(e,i,r,s=0){this._configuration.blitMode=r,this._configuration.blitEmissiveMode=s,this._passParameters.texture=i;const n=this._techniques.get(Of,this._configuration);this._rctx.bindTechnique(n,e,this._passParameters),this._rctx.screen.draw()}},kAt=class{constructor(){this.declaredClass="esri.views.3d.webgl-engine.lib.ObjectAndLayerIdRenderHelper",this.colorZero=new Bu(new ArrayBuffer(4)),this._layerToOidToColor=new tm,this._colorToUID=new Map,this._layerViewUidToGraphicsUidToObjectId=new tm,this._layerViewUidToLayerId=new Map,this._layerViewUidToPopupEnabled=new Map}setUidToObjectAndLayerId(e,i,r,s,n,a=null,o=null,l=null){e&&i&&r&&s&&(this._layerViewUidToLayerId.set(s,r),this._layerViewUidToPopupEnabled.set(s,n),n&&this._layerViewUidToGraphicsUidToObjectId.set(s,i,{objectId:e,attributeNodeId:a,attributeIndex:o,subLayerId:l}))}getObjectAndLayerIdColor(e){const i=this.getObjectAndLayerIdColorArray(e);return fi(i.get(0,1),i.get(0,2),i.get(0,3),255)}getObjectAndLayerIdColorArray(e){if(!e.layerViewUid||!e.graphicUid)return this.colorZero;const i=this._layerViewUidToPopupEnabled.get(e.layerViewUid);if(i===void 0)return this.colorZero;if(i===!1)return this.colorZero;const r=this._layerViewUidToGraphicsUidToObjectId.get(e.layerViewUid,e.graphicUid)?.objectId;if(!r)return this.colorZero;let s=this._layerToOidToColor.get(e.layerViewUid,r);if(!s){if(ie("enable-feature:objectAndLayerId-screenshot-testing"))s=r;else for(;!s;){const a=Math.floor(16777214*Math.random())+1;this._colorToUID.has(a)||(s=a)}if(s>16777215)throw new Error("Object ID Overflow");this._layerToOidToColor.set(e.layerViewUid,r,s),this._colorToUID.set(s,e)}const n=new ArrayBuffer(4);return new DataView(n).setUint32(0,s,!1),new Bu(n)}getColorToObjectAndLayerIdMapping(){const e=new Map;for(const[i,r]of this._colorToUID.entries()){const s=this._layerViewUidToGraphicsUidToObjectId.get(r.layerViewUid,r.graphicUid),n=this._layerViewUidToLayerId.get(r.layerViewUid);s&&n&&e.set(i,s.attributeNodeId?{type:"object-and-layer-and-i3s-id",olid:s.objectId,lid:n,attrId:s.attributeNodeId,attrIdx:s.attributeIndex,subLayerId:s.subLayerId}:{type:"object-and-layer-id",olid:s.objectId,lid:n})}return e}},ULe=class{constructor(e,i){this.key=e,this._free=i,this.incarnation=0,this._refCount=1}retain(e=1){this._refCount+=e}release(){return this._refCount===0?(console.log(`Releasing already released FBO attachment "${this.name}" in ${new Error().stack}`),!0):(--this._refCount,this._refCount===0&&(this._free(),!0))}get test(){}},BLe=class extends ULe{constructor(e,i,r){super(e,r),this.attachment=i,this.name=""}dispose(){this.attachment.dispose()}get usedMemory(){return this.attachment.usedMemory}},zAt=class extends BLe{constructor(e,i,r){super(e,i,r),this.attachment=i,this.type=2}},FAt=class extends BLe{constructor(){super(...arguments),this.type=1}},NAt=class extends FAt{constructor(e,i,r){super(e,i,r),this.attachment=i}};function VAt(t){return t?.attachment.type===1}let jLe=class extends ULe{constructor(e,i,r,s,n,a){super(e,a),this.fbo=r,this.type=0,this._colors=new Map,this._name=es.COMPOSITE,this.acquireColor=null,this.acquireDepth=null,this._name=i,this.acquireColor=s,this.acquireDepth=n}dispose(){this.fbo?.dispose()}get usedMemory(){return this.fbo?.usedMemory||0}get numberOfColorAttachments(){return this._colors.size}get name(){return this._name}setName(e){this._name=e}getTexture(e=Dr){return e===Ba?this.fbo?.depthStencilTexture:this.fbo?.getColorTexture(e)}get depthTexture(){return this.getTexture(Ba)}getAttachment(e=Dr){return e===Ba?this._depth:this._colors.get(e)}hasAttachment(e){return Qd(this._colors,i=>i.name===e)}attachDepth(e){return e?.retain(),this.detachDepth(),e&&this.fbo?.attachDepthStencil(e.attachment),this._depth=e,this}detachDepth(){this.fbo?.detachDepthStencilTexture(),this.fbo?.detachDepthStencilBuffer(),this._depth=Sr(this._depth)}obtainDepthTexture(){const e=this._depth;return VAt(e)?(this.fbo?.detachDepthStencilTexture(),this._depth=null,e):null}attachColor(e,i){return e.retain(),this.detachColor(i),this.fbo?.attachColorTexture(e.attachment,i),this._colors.set(i,e),this}detachColor(e){this.fbo?.detachColorTexture(e);const i=this._colors.get(e);this._colors.delete(e),i?.release()}detachAllColors(){this._colors.forEach((e,i)=>this.detachColor(i))}detachAll(){this.detachAllColors(),this.detachDepth()}detachAllColorsBut0(){this._colors.forEach((e,i)=>{i!==Dr&&this.detachColor(i)})}detachAllButColor0(){this.detachAllColorsBut0(),this.detachDepth()}};function UAt(t){switch(t){case 0:return"R8UNORM";case 1:return"R8UINT";case 2:return"RG8UNORM";case 3:return"RG8UINT";case 4:return"RGBA4UNORM";case 5:return"RGBA8UNORM";case 6:return"RGBA8UNORM_MIPMAP";case 7:return"R16FLOAT";case 8:return"RGBA16FLOAT";case 9:return"R32FLOAT";case 10:return"RG32FLOAT";case 11:return"RGBA32UINT";case 12:return"COUNT"}}function BAt(t){switch(t){case 12:return"DEPTH16";case 13:return"DEPTH24_STENCIL8"}}function sH(t){return rJ(t)?BAt(t):UAt(t)}function rJ(t){return t>=12}const jF=new Zi;jF.pixelFormat=6403,jF.internalFormat=tt.R8,jF.wrapMode=33071;const rP=new Zi;rP.pixelFormat=36244,rP.internalFormat=tt.R8UI,rP.wrapMode=33071,rP.samplingMode=9728;const qF=new Zi;qF.pixelFormat=33319,qF.internalFormat=tt.RG8,qF.wrapMode=33071;const sP=new Zi;sP.pixelFormat=33320,sP.internalFormat=tt.RG8UI,sP.wrapMode=33071,sP.samplingMode=9728;const GF=new Zi;GF.internalFormat=tt.RGBA4,GF.dataType=bs.UNSIGNED_SHORT_4_4_4_4,GF.wrapMode=33071;const qLe=new Zi;qLe.wrapMode=33071;const nP=new Zi;nP.wrapMode=33071,nP.samplingMode=9987,nP.hasMipmap=!0,nP.maxAnisotropy=8;const aP=new Zi;aP.pixelFormat=6403,aP.dataType=bs.HALF_FLOAT,aP.internalFormat=tt.R16F,aP.samplingMode=9728;const HF=new Zi;HF.dataType=bs.HALF_FLOAT,HF.internalFormat=tt.RGBA16F,HF.wrapMode=33071;const oP=new Zi;oP.pixelFormat=6403,oP.dataType=bs.FLOAT,oP.internalFormat=tt.R32F,oP.samplingMode=9728;const lP=new Zi;lP.pixelFormat=33319,lP.dataType=bs.FLOAT,lP.internalFormat=tt.RG32F,lP.samplingMode=9728;const NT=new Zi;NT.pixelFormat=36249,NT.dataType=bs.UNSIGNED_INT,NT.internalFormat=tt.RGBA32UI,NT.samplingMode=9728,NT.wrapMode=33071;const jAt={0:jF,1:rP,2:qF,3:sP,4:GF,5:qLe,6:nP,7:aP,8:HF,9:oP,10:lP,11:NT,12:null},qAt={[Hh.DEPTH_COMPONENT16]:bs.UNSIGNED_SHORT,[Hh.DEPTH_COMPONENT24]:bs.UNSIGNED_INT,[Hh.DEPTH_COMPONENT32F]:bs.FLOAT,[Kf.DEPTH24_STENCIL8]:bs.UNSIGNED_INT_24_8,[Kf.DEPTH32F_STENCIL8]:bs.FLOAT_32_UNSIGNED_INT_24_8_REV},GAt={13:Q_e(Kf.DEPTH24_STENCIL8),12:Q_e(Hh.DEPTH_COMPONENT16)};function Q_e(t){const e=new Zi;return e.pixelFormat=hie(t)?6402:34041,e.dataType=qAt[t],e.samplingMode=9728,e.wrapMode=33071,e.internalFormat=t,e.hasMipmap=!1,e.isImmutable=!0,e}let nH=class{constructor(e,i){this._last=new _i,this._incarnation=0,this._cache=new R4(e,i)}destroy(){this._last?.forAll(e=>e.dispose()),this._last?.prune(),this._last=null,this._cache.destroy()}set interactive(e){e&&!this._last?this._last=new _i:e||(this._last?.forAll(i=>i.dispose()),this._last=null)}clean(){this._last?.filterInPlace(e=>!(e.incarnation<this._incarnation)||(this._cache.put(e.key,e),!1))}frame(){++this._incarnation}pop(e){if(this._last){const i=this._last.find(r=>r.key===e);if(i)return this._last.removeUnordered(i),i}return this._cache.pop(e)}put(e){e.incarnation=this._incarnation,this._last?this._last.push(e):this._cache.put(e.key,e)}get usedMemory(){return this._last?.reduce((e,i)=>e+i.usedMemory,0)??0}},HAt=class{constructor(e){this.rctx=e,this._interactive=!1,this._usage=new Map,this._acquired=new Set,this._cache=new nH(e.newCache,"FBOCache"),this._depthCache=new nH(e.newCache,"DepthAttachmentCache"),this._colorCache=new nH(e.newCache,"ColorAttachmentCache")}destroy(){this._cache.destroy(),this._depthCache.destroy(),this._colorCache.destroy()}clean(){this._cache.clean(),this._colorCache.clean(),this._depthCache.clean()}frameStart(){this._cache.frame(),this._colorCache.frame(),this._depthCache.frame(),this.debugCallback?.(),this._usage.clear()}frameEnd(){const{debugCallback:e}=this;e&&this._acquired.forEach(i=>e(i.name,i.fbo,this._usage))}get usedMemory(){return Array.from(this._acquired.values()).reduce((e,i)=>e+i.usedMemory,this._cache.usedMemory+this._colorCache.usedMemory+this._depthCache.usedMemory)}set interactive(e){this._cache.interactive=this._colorCache.interactive=this._depthCache.interactive=e,this._interactive=e}get interactive(){return this._interactive}acquire(e,i,r,s=5){const n=aH(s,e,i);let a=this._cache.pop(n);const{rctx:o}=this;if(a){a.retain(),a.setName(r);const l=a.getAttachment(Ba);l&&(l.name=J_e(r));const c=a.getAttachment(Dr);c&&(c.name=X_e(r,0));const h=a.fbo;h?o.temporaryBindFramebufferObject(h,()=>{o.setDrawBuffers([Dr]),o.unbindTexture(h.colorTexture)}):fe.getLogger("esri.views.3d.webgl-engine.core.FBOCache").errorOnce("Encountered an invalid cached framebuffer")}else{const l=new Xv(o),c=(y,_,w)=>{_??=5;const x=this._acquireColor(_,e,i,w??X_e(a.name,y-Dr));return this.rctx.unbindTexture(x.attachment),a.attachColor(x,y),x.release(),a},h=y=>{y??=13;const _=this.acquireDepth(y,e,i,J_e(a.name));return a.attachDepth(_),_.release(),a},f=()=>{if(!a)return;this.debugCallback?.(a.name,a.fbo),this._acquired.delete(a);const y=rJ(s);y&&a.getAttachment(Ba)!=null||!y&&a.getAttachment(Dr)!=null?(y?(a.fbo?.invalidateAttachments([Ba]),a.detachAllColors()):(a.fbo?.invalidateAttachments([Dr]),a.detachAllButColor0()),this._cache.put(a)):a.dispose()};a=new jLe(n,r,l,c,h,f),rJ(s)?a.acquireDepth(s):a.acquireColor(Dr,s,r)}return this._trackUsage(a,"fbo "+sH(s),e,i),this._trackHandle(a)}acquireDepth(e,i,r,s){const n=aH(e,i,r);let a=this._depthCache.pop(n);if(a)a.retain(),a.attachment.setShadowFiltering(!1);else{const o=new Fi(this.rctx,{...GAt[e],width:i,height:r});a=new NAt(n,o,()=>this._depthCache.put(a))}return a.name=s,this._trackUsage(a,"depth "+sH(e),i,r),a}_acquireColor(e,i,r,s){const n=aH(e,i,r);let a=this._colorCache.pop(n);if(a)a.retain();else{const o=new Fi(this.rctx,{...jAt[e],width:i,height:r});a=new zAt(n,o,()=>this._colorCache.put(a))}return a.name=s,this._trackUsage(a,"color "+sH(e),i,r),a}_trackHandle(e){return this._acquired.add(e),e}_trackUsage(e,i,r,s){this.debugCallback&&(this._usage.has(e)?this._usage.get(e)[2].push(e.name):this._usage.set(e,[i,`${r}x${s}`,[e.name]]))}};function X_e(t,e=0){return`${t}.color${e}`}function J_e(t){return`${t}.depth`}const QC=new jLe("default","default",null,()=>QC,()=>QC,()=>{});function aH(t,e,i){return`${e}x${i}:${t}`}QC.release=()=>!1;let Md=class{constructor(e,i,r=0){this._rctx=e,this._techniques=i,this._sorting=r,this._draws=new _i({allocator:s=>s??{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._previouslyBoundDraw=new Map}submitDraw(e,i,r,s,n){const a=this._draws.pushNew();a.geometry=i,a.geometryRanges=r,a.material=e,a.depthSquaredHint=s,a.indexType=(i.indexed?i.vao.indexBuffer.indexType:null)??0,a.highlightName=n}acquire(e,i){return this._draws.map(r=>r.material.acquireTechnique(this._techniques,e,i,r.geometry.parameters))}dispatch(e,i,r){const s=this._rctx;this._previouslyBoundDraw.clear();let n=null;const a=this._draws.length,o=i.highlight?.name;for(let l=0;l<a;l++){const c=this._draws.data[l];if(e.identifier===2){const $=c.highlightName;if($){if($!==o)continue}else if(!o||!i.overlay?.hasHighlight(o))continue}const h=r[l];h===n&&i.oitPass===0||(s.bindTechnique(h,i,e),n=h);const{geometryRanges:f,indexType:y,geometry:_,material:w}=c;s.bindVAO(_.vao),this._previouslyBoundDraw.get(h)!==w&&(h.program.bindDraw(i,e,w),this._previouslyBoundDraw.set(h,w));const x=f.length,{primitiveType:S}=_;for(let $=0;$<x;$+=2){const A=f[$],M=f[$+1];if(y!==0){const P=WF.get(y);s.drawElements(S,M,y,A*P)}else s.drawArrays(S,A,M)}}}prepareSubmit(){this._draws.clear()}finishSubmit(){const e=this._sorting===0?1:-1;this._draws.sort((i,r)=>e*(i.depthSquaredHint-r.depthSquaredHint)||i.geometry.vao.usedMemory-r.geometry.vao.usedMemory)}get count(){return this._draws.length}};const WF=new Map;WF.set(ar.UNSIGNED_BYTE,1),WF.set(ar.UNSIGNED_SHORT,2),WF.set(ar.UNSIGNED_INT,4);let WAt=class{constructor(e){const i=e.renderContext.rctx,r=e.techniques;this.opaque=new Md(i,r),this.transparent=new Md(i,r,1),this.integratedMesh=new Md(i,r),this.transparentIntegratedMesh=new Md(i,r),this.occludedGround=new Md(i,r),this.shadowMap=new Md(i,r),this.highlight=new Md(i,r),this.highlightIntegratedMesh=new Md(i,r),this.highlightShadowMap=new Md(i,r),this.viewshedShadowMap=new Md(i,r),this.defaultShadowMap=new Md(i,r)}},eB=class extends iDe{constructor(){super(...arguments),this.slicePlaneLocalOrigin=R(),this.origin=this.slicePlaneLocalOrigin}},ZAt=class extends eB{constructor(){super(...arguments),this.identifier=0,this.output=0,this.transparent=!1,this.occludedGround=!1}},YAt=class extends eB{constructor(){super(...arguments),this.identifier=1}},QAt=class extends eB{constructor(){super(...arguments),this.identifier=2}},XAt=class extends eB{constructor(){super(...arguments),this.identifier=3}},sJ=class extends _4{constructor(){super(...arguments),this.produces=new Map([[2,e=>this._produces(e,2)],[4,e=>this._produces(e,4)],[0,e=>this._produces(e,0)],[7,e=>this._produces(e,7)],[9,e=>this._produces(e,9)]]),this._materialPassParameters=new ZAt,this._shadowPassParameters=new YAt,this._highlightPassParameters=new QAt,this._viewshedPassParameters=new XAt,this._systems=new Set}initializeRenderContext(e){this._context=e,this._passes=new WAt(e)}get rctx(){return this._context.renderContext.rctx}uninitializeRenderContext(){}dispose(){this._context=null,this._systems.clear(),this._passes=null}register(e){this._systems.add(e)}_produces(e,i){return!!this._invoke(e,i,r=>r.count>0)}prepareRender(e){const{_systems:i,_passes:r}=this;if(i.size!==0&&r!=null){for(const s of Object.values(r))s.prepareSubmit();i.forEach(s=>s.submit(r,e.bind));for(const s of Object.values(r))s.finishSubmit()}}acquireTechniques(e){if(this._systems.size===0)return null;const i=e.output===4||e.output===5||e.output===6?this._shadowPassParameters:e.output===7?this._viewshedPassParameters:e.output===9?this._highlightPassParameters:this._materialPassParameters,r=e.bind;return this._updateParameters(r.camera,i,r.slot),this._materialPassParameters.output=e.output,this._invoke(e.output,e.bind.slot,(s,n)=>s.acquire(n,e.bind))}render(e,i){this._invoke(e.output,e.bind.slot,(r,s)=>r.dispatch(s,e.bind,i))}_invoke(e,i,r){if(this._passes==null)return null;switch(i){case 2:switch(e){case 0:case 1:case 2:case 3:case 10:return r(this._passes.opaque,this._materialPassParameters);case 9:return r(this._passes.highlight,this._highlightPassParameters);case 4:return r(this._passes.shadowMap,this._shadowPassParameters);case 5:return r(this._passes.highlightShadowMap,this._shadowPassParameters);case 6:return r(this._passes.defaultShadowMap,this._shadowPassParameters);case 7:return r(this._passes.viewshedShadowMap,this._viewshedPassParameters)}break;case 4:switch(e){case 0:case 1:case 2:case 3:case 10:return r(this._passes.transparent,this._materialPassParameters)}break;case 0:switch(e){case 0:case 1:case 2:case 3:case 10:case 8:return r(this._passes.integratedMesh,this._materialPassParameters);case 9:return r(this._passes.highlightIntegratedMesh,this._highlightPassParameters)}break;case 7:switch(e){case 0:case 1:return r(this._passes.transparentIntegratedMesh,this._materialPassParameters)}break;case 9:switch(e){case 0:case 1:case 2:case 3:case 10:return r(this._passes.occludedGround,this._materialPassParameters)}}return null}notifyDirty(){this._context.requestRender()}queryDepthRange(e){const i=new Ua;return this._systems.forEach(r=>i.union(r.queryDepthRange(e))),i}get hasEmitters(){let e=!1;return this._systems.forEach(i=>e=i.hasEmissions||e),e}_updateParameters(e,i,r){const s=e.viewInverseTransposeMatrix,n=r===4,a=r===9;ve(oH,s[3],s[7],s[11]),lH.set(oH),de(i.transformWorldFromViewTH,lH.high),de(i.transformWorldFromViewTL,lH.low),de(i.slicePlaneLocalOrigin,oH),jv(i.transformViewFromCameraRelativeRS,e.viewMatrix),pn(i.transformProjFromView,e.projectionMatrix),i.identifier===0&&(this._materialPassParameters.transparent=n,this._materialPassParameters.occludedGround=a,qv(K_e,i.transformViewFromCameraRelativeRS),i2(i.transformNormalViewFromGlobal,K_e))}hasHighlight(e){for(const i of this._systems)if(i.hasHighlight(e))return!0;return!1}};sJ=d([k("esri.views.3d.webgl-engine.core.renderPasses.RenderPassManager")],sJ);const oH=R(),K_e=Ir(),lH=new _Le;function JAt(t){return t.name}let KAt=class{constructor(e){this._context=e,this._nodes=new _i}destroy(){this._nodes.forEach(e=>e.destroy()),this._nodes.prune()}add(e){this._nodes.push(e)}remove(e){this._nodes.remove(e)}produces(e){return this._nodes.some(({produces:i})=>i===e)}require(e,...i){const r=this._nodes,s=n=>r.reduce((a,{consumes:o,produces:l})=>a+(!o.required.includes(e)||n!=null&&l!==n?0:1),0);return i.length===0?s():i.reduce((n,a)=>n+s(a),0)}optional(e,...i){const r=this._nodes,s=n=>r.reduce((a,{consumes:o,produces:l})=>a+(!o.optional?.includes(e)||n!=null&&l!==n?0:1),0);return i.length===0?s():i.reduce((n,a)=>n+s(a),0)}updateAnimation(e){return this._nodes.reduce((i,r)=>r.updateAnimation(e)||i,!1)}precompile(...e){++this._context.techniques.precompiling;for(const i of e)this._nodes.forEach(r=>{r.produces===i&&r.precompile()});--this._context.techniques.precompiling}render(e,i,r=()=>{}){return this._render(e,i,r)??(JAt(e)?e:QC)}produce(e,i,r=()=>{}){return this._render(e,i,r)}_render(e,i,r=()=>{}){const s=typeof e=="string"?e:e.name,n=this._nodes.filter(({produces:o})=>o===s);if(n.length===0)return;let a=typeof e=="string"?null:e;return n.some(o=>{const l=a?[a]:[],c=a==null;for(const h of o.consumes.required){if(h===s){if(c)return!1;continue}const f=i.get(h);if(f)l.push(f);else if(h!=="emissive"||!i.get(s)?.hasAttachment(h))return r?.(l),!1}if(o.consumes.optional)for(const h of o.consumes.optional){if(h===s)continue;const f=i.get(h);f&&l.push(f)}try{const h=o.doRender(l);h&&h!==a&&(s!==h.name&&(fe.getLogger(o).errorOnce(`RenderNode produced ${h.name}, expected ${s}`),h.setName(s)),a?.release(),a=h,i.set(s,a))}catch(h){fe.getLogger(o).errorOnce(h)}return r?.(l),c&&a!=null}),this._context.rctx.enforceState(),a}requireGeometryDepth(){return this._nodes.some(e=>e.produces!=="disabled"&&e.requireGeometryDepth)}get test(){return{nodes:this._nodes}}},eOt=class{constructor(e){this.context=e,this._renderPlugins=new Array,this._slots=new Array,this._version=Pn(0);for(let i=0;i<21;++i)this._slots[i]=[]}destroy(){this._renderPlugins.forEach(e=>e.destroy()),this._renderPlugins.length=0}get plugins(){return this._renderPlugins}add(e,i){const r=()=>{if(i?.aborted)throw e.uninitializeRenderContext(),Xt();this._renderPlugins.push(e),e.produces.forEach((n,a)=>this._slots[a].push(e)),this.context.requestRender(),this._version.value++},s=e.initializeRenderContext(this.context,i);if($a(s))return s.then(r);r()}remove(e){Ul(this._renderPlugins,e),e.uninitializeRenderContext();for(let i=0;i<this._slots.length;++i)this._slots[i]=this._slots[i].filter(r=>r!==e);this.context.requestRender(),this._version.value++}prepareRender(){this._renderPlugins.forEach(e=>{e.prepareRender&&e.prepareRender(this.context.renderContext)})}updateAnimation(e){let i=!1;return this._renderPlugins.forEach(r=>i=r.updateAnimation?.(e)||i),i}precompile(...e){++this.context.techniques.precompiling;const i=this.context.renderContext.bind.slot;for(const r of e)this.context.renderContext.bind.slot=r,this._forEachRender(()=>{});this.context.renderContext.bind.slot=i,--this.context.techniques.precompiling}render(...e){for(const i of e)this.context.renderContext.bind.slot=i,this._forEachRender((r,s)=>r.render(this.context.renderContext,s))}_forEachRender(e){const i=this.context.renderContext.bind.slot,r=this.context.renderContext.output;this._slots[i].forEach(s=>{if(!s.produces.get(i)?.(r)||s.isDecoration&&!this.context.renderContext.bind.decorations)return;const a=s.acquireTechniques(this.context.renderContext);a&&e(s,a)})}queryDepthRange(e){const i=new Ua;return this._renderPlugins.forEach(r=>{const s=r.queryDepthRange?.(e);i.union(s)}),i}get updating(){return this._version.value>=0&&this._renderPlugins.some(e=>e.readyToRun)}produces(e,...i){return i.some(r=>this._slots[r].some(s=>{const n=s.produces.get(r);return!!n&&n(e)}))}consumes(e){return this._renderPlugins.some(i=>i.consumes().required.includes(e))}hasHighlight(e){return tOt.some(i=>this._slots[i].some(r=>r.hasHighlight(e)))}get hasDecorations(){return this._renderPlugins.some(e=>e.isDecoration)}get hasOccludees(){return this._renderPlugins.some(e=>e.hasOccludees)}get hasEmitters(){return this._renderPlugins.some(e=>e.hasEmitters)}get renderOccludedFlags(){return this._renderPlugins.reduce((e,i)=>e|(i.renderOccludedFlags??0),0)}get usedMemory(){return this._renderPlugins.reduce((e,i)=>i.material?e:e+(i.usedMemory??0),0)}get test(){}};const tOt=[2,4,18,13,14];let Ise=class extends hr{};function GLe(t){const e=new Di;e.include(Oa);const{hasEmitters:i,dimEmissive:r}=t,s=e.fragment;return s.uniforms.add(new zt("colorTexture",n=>n.colorTexture),new zt("alphaTexture",n=>n.alphaTexture)),e.outputs.add("fragColor","vec4",0),i&&e.outputs.add("fragEmission","vec4",1),r?(s.main.add(E`float srcAlpha = texture(alphaTexture, uv).r;
vec4 srcColor = texture(colorTexture, uv);
srcColor.rgb = clamp(srcColor.rgb, vec3(0.0), srcColor.rgb);
vec3 dimming = srcAlpha > 1.0 ? mix(vec3(1.0), srcColor.rgb, 1.0 / srcAlpha) : mix(vec3(1.0), srcColor.rgb, srcAlpha);
fragEmission = vec4(dimming, 0.0);`),e):(s.uniforms.add(new zt("frontFaceTexture",n=>n.frontFaceTexture)),i&&(s.uniforms.add(new zt("emissionTexture",n=>n.emissionTexture)),s.uniforms.add(new zt("emissionFrontFaceTexture",n=>n.emissionFrontFaceTexture))),s.main.add(E`
      float srcAlpha = texture(alphaTexture, uv).r;
      if(srcAlpha == 0.0){
        fragColor = vec4(0.0);
        ${_e(i,"fragEmission = vec4(0.0);")}
        return;
      }

      vec4 srcColor = texture(colorTexture, uv);
      vec4 frontFace = texture(frontFaceTexture, uv);
      fragColor = vec4(mix(srcColor.rgb / srcAlpha, frontFace.rgb, frontFace.a), 1.0 - srcColor.a);

      ${_e(i,`vec4 emission = texture(emissionTexture, uv);
         vec4 emissionFrontFace = texture(emissionFrontFaceTexture, uv);

         // Modulate transparent emitter by front faces. This case is important for surfaces which contain emitter and 
         // non-emitter at the same time. Non-emitter surface parts need to modulate emissions as well.
         emission.rgb = emission.rgb * (1.0 - frontFace.a);

         fragEmission = vec4(mix(emission.rgb / srcAlpha, emissionFrontFace.rgb, emissionFrontFace.a), 1.0 - srcColor.a);`)}
    `),e)}const iOt=Object.freeze(Object.defineProperty({__proto__:null,OITBlendPassParameters:Ise,build:GLe},Symbol.toStringTag,{value:"Module"}));let AA=class extends Vi{constructor(e,i){super(e,i,new Ii(iOt,()=>te(()=>Promise.resolve().then(()=>uzt),void 0)),Qs)}initializePipeline(e){return li({blending:e.dimEmissive?Llt:em,colorWrite:$i,drawBuffers:e.dimEmissive?{buffers:[M6,Do]}:e.hasEmitters?{buffers:[Dr,Do]}:{buffers:[Dr]}})}},nJ=class extends Fo{constructor(){super(...arguments),this.hasEmitters=!1,this.dimEmissive=!1}};d([oe()],nJ.prototype,"hasEmitters",void 0),d([oe()],nJ.prototype,"dimEmissive",void 0);let rOt=class{constructor(e){this._techniques=e,this._parameters=new Ise,this._configuration=new nJ,e.precompile(AA,this._configuration),this._configuration.hasEmitters=!0,e.precompile(AA,this._configuration),this._configuration.dimEmissive=!0,e.precompile(AA,this._configuration),this._configuration.dimEmissive=!1,this._configuration.hasEmitters=!1}blend(e,i,r,s,n,a){if(this._parameters.colorTexture=i.getTexture(),this._parameters.alphaTexture=i.getTexture(n?nie:Do),this._parameters.frontFaceTexture=r.getTexture(),this._configuration.hasEmitters=n,n&&a){this._configuration.dimEmissive=!0;const l=this._techniques.get(AA,this._configuration);e.bindTechnique(l,s,this._parameters),e.screen.draw(),this._configuration.dimEmissive=!1}n&&(this._parameters.emissionTexture=i.getTexture(Do),this._parameters.emissionFrontFaceTexture=r.getTexture(Do));const o=this._techniques.get(AA,this._configuration);e.bindTechnique(o,s,this._parameters),e.screen.draw()}},sOt=class{constructor(e,i){this._camera=e,this._dt=0,this._time=0,this._lastUpdate=0,this._lastUpdate=i,this._time=i}advance(e,i,r){const s=i-this._lastUpdate;this._dt=s/r,this._time=this._time+s,this._lastUpdate=i,this._camera=e}get camera(){return this._camera}get dt(){return this._dt}get time(){return this._time}},nOt=class{constructor(){this._step=ive,this._dilation=1,this._firstIdleTime=0}frame(e,i){if(i?this._firstIdleTime===0&&(this._firstIdleTime=performance.now()):this._firstIdleTime=0,ie("disable-feature:high-quality-idle"))this._dilation=1;else{const s=i?performance.now()-this._firstIdleTime:0;if(s>=eve+oOt)return this._step=1/0,void(this._dilation=1);this._dilation=s>=eve?lOt:1}const r=Se(e/aOt,ive,uOt);this._step===1/0?this._step=r:this._step=this._step*tve+r*(1-tve)}get value(){return this._step}get timeDilation(){return this._dilation}clear(){this._step=this._firstIdleTime=0}};const aOt=.5,eve=12e4,oOt=1e4,lOt=10,tve=.9,cOt=30,ive=1e3/1,uOt=1e3/cOt,hOt=1e4,aJ=100,dOt=500,pOt=500,fOt=.1;function rve(t,e,i,r){let s=0;if(!e.some(a=>!!a.material&&(s+=a.numGeometries,s>=hOt)))return SOt.compute(t,e,r);const n=new Ua;return i.forEach(a=>n.union(mOt(t,a))),n}function mOt(t,e){if(!e.visible)return;const i=new Ua,r=e.getSpatialQueryAccelerator();return r?gOt(i,t,r):yOt(i,t,e.objects),i}function gOt(t,e,i){const{eye:r,viewForward:s,frustum:n}=e,a=l=>l.visible,o=i.objectCount;if(o<dOt)Rh.set(e.near,Math.min(t.near,e.far)),i.forEachInDepthRange(r,s,1,Rh,(l,c)=>{oJ(t,e,l),Rh.far=t.near,c.setRange(Rh)},n,a),Rh.set(Math.max(t.far,e.near),e.far),i.forEachInDepthRange(r,s,-1,Rh,(l,c)=>{oJ(t,e,l),Rh.near=t.far,c.setRange(Rh)},n,a);else{const l=Math.max(Math.min(o,pOt),Math.ceil(o*fOt)),c=i.findClosest(s,1,n,a,l),h=i.findClosest(s,-1,n,a,l);c&&h&&(sve(t,e,c.boundingVolumeWorldSpace.bounds),sve(t,e,h.boundingVolumeWorldSpace.bounds))}}function yOt(t,e,i){KS.clear(),i.forEach(r=>{r.visible&&r.geometries.length!==0&&KS.add(r)}),KS.empty||(KS.sort(e),Rh.set(e.near,Math.min(t.near,e.far)),KS.forEachInDepthRange(Rh,1,(r,s)=>{s<t.near&&oJ(t,e,r)}),Rh.set(Math.max(t.far,e.near),e.far),KS.forEachInDepthRange(Rh,-1,(r,s,n)=>{t.far=Math.max(t.far,n)}))}function oJ(t,e,i){if(!i.visible||!D_(e.frustum,i.boundingVolumeWorldSpace.bounds))return;const r=i.transformation,s=xOt;i.geometries.forEach(n=>{an(s,r,n.transformation);const a=HR(s);HLe(t,e,n.boundingInfo,s,a)})}function HLe(t,e,i,r,s){if(i==null)return;OC(Na,i.center,r);const{eye:n,viewForward:a}=e,o=a[0]*(Na[0]-n[0])+a[1]*(Na[1]-n[1])+a[2]*(Na[2]-n[2]);if(Na[3]=i.radius*s,!(o-Na[3]>t.near&&o+Na[3]<t.far)&&D_(e.frustum,Na))if(i.radius>aJ&&i.getChildren())for(const l of i.getChildren())HLe(t,e,l,r,s);else lJ.unionDepthRangeWithAABB(t,e.viewProjectionMatrix,r,i.bbMin,i.bbMax)}function sve(t,e,i){const r=e.eye,s=e.viewForward,n=(i[0]-r[0])*s[0]+(i[1]-r[1])*s[1]+(i[2]-r[2])*s[2];t.near=Math.min(t.near,n-i[3]),t.far=Math.max(t.far,n+i[3])}let _Ot=class{constructor(){this._items=new _i({allocator:e=>e||{object:null,distance:0,near:0,far:0},deallocator:e=>(e.object=null,e.distance=0,e.near=0,e.far=0,e)})}get length(){return this._items.length}get empty(){return this._items.length===0}clear(){this._items.clear()}add(e){this._items.pushNew().object=e}sort(e){const i=e.eye,r=e.viewForward;this._items.forAll(s=>{const n=s.object.boundingVolumeWorldSpace.bounds,a=(n[0]-i[0])*r[0]+(n[1]-i[1])*r[1]+(n[2]-i[2])*r[2];s.distance=a,s.near=a-n[3],s.far=a+n[3]}),this._items.sort((s,n)=>s.distance-n.distance)}forEachInDepthRange(e,i,r){if(i===1)for(let s=0;s<this._items.length;++s){const n=this._items.data[s];n.far<e.near||n.near>e.far||r(n.object,n.near,n.far)}else for(let s=this._items.length-1;s>=0;--s){const n=this._items.data[s];n.far<e.near||n.near>e.far||r(n.object,n.near,n.far)}}},vOt=class{constructor(){this._geometries=new Array,this._near=[],this._far=[],this._nearCandidates=[],this._farCandidates=[],this._looseRange=new Ua(0,0)}compute(e,i,r){this._reset();const{viewMatrix:s}=e;i.forEach(c=>{c.forEachGeometry(h=>{if(!h.visible||r===0&&!h.castShadow)return;const f=h.boundingSphere,y=s[2]*f[0]+s[6]*f[1]+s[10]*f[2]+s[14],_=y-f[3],w=y+f[3];this._geometries.push(h),this._near.push(-w),this._far.push(-_)})});const n=new Ua;if(this._geometries.length===0)return n;for(let c=0;c<this._geometries.length;++c)this._near[c]>n.far&&(n.far=this._near[c]),this._near[c]>2&&this._far[c]<n.near&&(n.near=this._far[c]);const a=this._looseRange;a.near=Math.max(.5*n.near,2),a.far=2*n.far;let o=0,l=0;for(let c=0;c<this._geometries.length;++c)this._near[c]<n.near&&(this._near[c]>=a.near?n.near=this._near[c]:this._nearCandidates[o++]=c),this._far[c]>n.far&&(this._far[c]<=a.far?n.far=this._far[c]:this._farCandidates[l++]=c);if(this._nearCandidates.length===0&&this._farCandidates.length===0)return n;this._nearCandidates.sort((c,h)=>this._near[c]<this._near[h]?-1:this._near[c]>this._near[h]?1:0),this._farCandidates.sort((c,h)=>this._far[c]<this._far[h]?1:this._far[c]>this._far[h]?-1:0);for(let c=0;c<this._nearCandidates.length;++c){const h=this._nearCandidates[c];if(this._near[h]<n.near){const f=this._geometries[h],{boundingInfo:y,shaderTransformation:_}=f;this._includeNearBoundingInfoRec(e,y,_,n)}}for(let c=0;c<this._farCandidates.length;++c){const h=this._farCandidates[c];if(this._far[h]>n.far){const f=this._geometries[h],{boundingInfo:y,shaderTransformation:_}=f;this._includeFarBoundingInfoRec(e,y,_,n)}}return this._reset(),n}_reset(){this._geometries.length=0,this._near.length=0,this._far.length=0,this._nearCandidates.length=0,this._farCandidates.length=0}_isOutsideSidePlanes(e,i){const r=Ti(e),s=Bf(e);return i[0][0]*r[0]+i[0][1]*r[1]+i[0][2]*r[2]+i[0][3]>s||i[1][0]*r[0]+i[1][1]*r[1]+i[1][2]*r[2]+i[1][3]>s||i[2][0]*r[0]+i[2][1]*r[1]+i[2][2]*r[2]+i[2][3]>s||i[3][0]*r[0]+i[3][1]*r[1]+i[3][2]*r[2]+i[3][3]>s}_includeNearBoundingInfoRec(e,i,r,s){if(i==null)return;const n=i.center;OC(Na,n,r),Na[3]=i.radius*HR(r);const{frustum:a}=e;if(this._isOutsideSidePlanes(Na,a))return;const o=Na[0],l=Na[1],c=Na[2],h=Na[3],{viewMatrix:f}=e,y=f[2]*o+f[6]*l+f[10]*c+f[14],_=y+h;if(!(-(y-h)<2||-_>=s.near))if(-_>this._looseRange.near)s.near=-_;else{if(h>aJ){const w=i.getChildren();if(w!==void 0){for(const x of w)this._includeNearBoundingInfoRec(e,x,r,s);return}}lJ.unionDepthRangeWithAABB(s,e.viewProjectionMatrix,r,i.bbMin,i.bbMax)}}_includeFarBoundingInfoRec(e,i,r,s){if(i==null)return;const n=i.center;OC(Na,n,r),Na[3]=i.radius*HR(r);const{frustum:a}=e;if(this._isOutsideSidePlanes(Na,a))return;const[o,l,c,h]=Na,{viewMatrix:f}=e,y=f[2]*o+f[6]*l+f[10]*c+f[14]-h;if(!(-y<=s.far))if(-y<this._looseRange.far)s.far=-y;else{if(h>aJ){const _=i.getChildren();if(_!==void 0){for(const w of _)this._includeFarBoundingInfoRec(e,w,r,s);return}}lJ.unionDepthRangeWithAABB(s,e.viewProjectionMatrix,r,i.bbMin,i.bbMax)}}},bOt=class{constructor(){this._modelViewProj=it(),this._clipPosition=[ri(),ri(),ri(),ri(),ri(),ri(),ri(),ri()]}unionDepthRangeWithAABB(e,i,r,s,n){const a=this._modelViewProj;an(a,i,r);let o=!1;for(let l=0;l<8;++l){const c=this._clipPosition[l],h=l===0||l===3||l===4||l===7?s[0]:n[0],f=l===0||l===1||l===4||l===5?s[1]:n[1],y=l<4?s[2]:n[2];c[0]=a[0]*h+a[4]*f+a[8]*y+a[12],c[1]=a[1]*h+a[5]*f+a[9]*y+a[13],c[2]=a[2]*h+a[6]*f+a[10]*y+a[14],c[3]=a[3]*h+a[7]*f+a[11]*y+a[15]}for(let l=0;l<12;++l){const c=wOt(this._clipPosition[uH[l][0]],this._clipPosition[uH[l][1]],this._clipPosition[uH[l][2]]);let h=!0;for(let f=0;f<c.length;++f)if(c[f][3]>=2){h=!1;break}if(!h){o=!0;for(let f=0;f<c.length;++f){const y=c[f][3];Number.isFinite(y)&&(e.near=Math.min(y,e.near),e.far=Math.max(y,e.far))}}}return o}};function wOt(t,e,i){let r=[t,e,i];for(let s=0;s<4;++s){const n=r;r=[];for(let a=0;a<n.length;++a){const o=n[a],l=n[(a+1)%n.length];cH(l,s)?(cH(o,s)||r.push(nve(o,l,s)),r.push(l)):cH(o,s)&&r.push(nve(o,l,s))}}return r}function cH(t,e){return e===0?t[0]>=-t[3]:e===1?t[1]>=-t[3]:e===2?t[0]<=t[3]:e===3?t[1]<=t[3]:void dt(!1)}function nve(t,e,i){let r=0;return i===0?r=(-t[3]-t[0])/(e[0]-t[0]+e[3]-t[3]):i===1?r=(-t[3]-t[1])/(e[1]-t[1]+e[3]-t[3]):i===2?r=(t[3]-t[0])/(e[0]-t[0]-e[3]+t[3]):i===3&&(r=(t[3]-t[1])/(e[1]-t[1]-e[3]+t[3])),qee(ri(),t,e,r)}const uH=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],Na=ms(),xOt=it(),Rh=new Ua,KS=new _Ot,SOt=new vOt,lJ=new bOt,TOt={idleOpacity:.8,navigatingOpacity:.4,maxDelta:.1,tiltFadeStart:20,tiltFadeEnd:30,altitudeStart:1e4,altitudeEnd:2e4};let $Ot=class{constructor(e){this._fbos=e,this._requiresEmission=!1,this._size=new CSt(0,0),this._clearColor=ri()}dispose(){this._color=Sr(this._color),this.releaseDepth()}initialize(e,i,r,s){this._size.width=e,this._size.height=i,nw(this._size,this._fbos.rctx.parameters.maxTextureSize);const n=this._color;return this._color=null,this.releaseDepth(),this._requiresEmission=s,jl(this._clearColor,r),n}releaseDepth(){this._color?.detachDepth(),this._depth=Sr(this._depth)}update(e){const i=this._ensureColor();i.attachDepth(this.depth),this._color=e(i)}bind(){const{rctx:e}=this._fbos,i=this._color==null;this.color.attachDepth(this.depth),e.bindFramebuffer(this.color.fbo),i&&(e.setClearStencil(0),e.setClearColor(this._clearColor[0],this._clearColor[1],this._clearColor[2],this._clearColor[3]),e.clear(17664),this._requiresEmission&&e.clearBuffer(1,K8))}_acquireColor(){return this._requiresEmission?this._fbos.acquire(this._size.width,this._size.height,"main color").acquireColor(Do,8,"emissive"):this._fbos.acquire(this._size.width,this._size.height,"main color")}_acquireDepth(){return this._fbos.acquireDepth(13,this._size.width,this._size.height,"main depth")}get size(){return this._size}get color(){return this._ensureColor()}get depth(){return this._depth??=this._acquireDepth(),this._depth}_ensureColor(){return this._color??=this._acquireColor(),this._color}};function ave(t=!ie("disable-feature:high-quality-idle"),e=null){const i=new tm;return t?(i.set(2,0,e!=="low"),i.set(2,3,e!=="low"),i.set(2,1,!0),i.set(2,4,!0),i.set(2,5,!0),i.set(2,8,!0)):(i.set(0,6,!0),i.set(0,7,!0),i.set(1,6,!0),i.set(1,7,!0)),i.set(2,6,!0),i.set(2,7,!0),i.set(2,2,!0),i}let COt=class{constructor(){this._inputs=new Map}set(e,i){this._inputs.set(e,i)}get(e){return this._inputs.get(e)}has(e){return this._inputs.has(e)}release(e){this._inputs.get(e)?.release()&&this._inputs.delete(e)}};function MOt(t){t.code.add(`
  vec4 blendColorsPremultiplied(vec4 source, vec4 dest) {
    float oneMinusSourceAlpha = 1.0 - source.a;
    return source + dest * oneMinusSourceAlpha;
  }
  `)}function OA(t,e){return t[0]=e[0]*e[3],t[1]=e[1]*e[3],t[2]=e[2]*e[3],t[3]=e[3],t}const k4=255,EOt=1/k4;function WLe(t){const e=new Di,{fragment:i}=e;e.include(Oa),e.include(RLe),e.include(gre),i.uniforms.add(new hV("shadowMap",s=>s.shadowMap.depthTexture),new po("depthMap",s=>s.depth?.attachment)),i.constants.add("sampleValue","float",EOt);const r=t.index===1?"vec2":"float";return e.outputs.add("sampleCount",r),i.main.add(E`
    sampleCount = ${r}(0.0);

    vec3 uvzShadow = calculateUVZShadowFromDepth(uv, textureSize(shadowMap,0), depthMap);
    if (uvzShadow.z < 0.0) {
      return;
    }

    // The shadow map sampler returns a value between 0 and 1, we take the midpoint as we count discrete samples
    bool shadow = readShadowMapUVZ(uvzShadow, shadowMap) > 0.5;

    if (shadow) {
      sampleCount = ${r}(sampleValue); // Add 1 to the sample count
    }
  `),e}const AOt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastMaxSamples:k4,build:WLe},Symbol.toStringTag,{value:"Module"}));let Lse=class extends hr{constructor(e){super(),this._data=e,this.sampleScale=pt(),this.opacityFromElevation=1,this.gradientColor=K3(OOt),this.thresholdColor=K3(POt),this.bandedGradientColor=K3(ROt),this.bandSize=.1,this.threshold=.5}get shadowCastMap(){return this._data.shadowCastTexture}};const kse=.7,hH=50/255,OOt=fi(0,0,1,kse),POt=fi(1,0,0,kse),ROt=fi(hH,hH,hH,kse);function ZLe(t){const e=new Di,i=e.fragment;e.include(I8),e.include(Oa);const{visualization:r}=t;i.constants.add("inverseSampleValue","float",k4),i.uniforms.add(new zt("shadowCastMap",h=>h.shadowCastMap),new ll("sampleScale",h=>h.sampleScale),new ut("opacityFromElevation",h=>h.opacityFromElevation));const s=r===2,n=r===3,a=r===1;switch(n&&i.include(MOt),r){case 0:i.uniforms.add(new Xn("uColor",h=>OA(PA,h.gradientColor)));break;case 1:i.uniforms.add(new Xn("uColor",h=>OA(PA,h.bandedGradientColor)),new ut("bandSize",h=>h.bandSize));break;case 3:i.uniforms.add(new Xn("uColor",h=>OA(PA,h.thresholdColor)),new Xn("gradientColor",h=>OA(PA,h.gradientColor)),new ut("threshold",h=>h.threshold));break;case 2:i.uniforms.add(new Xn("uColor",h=>OA(PA,h.thresholdColor)),new ut("threshold",h=>h.threshold))}const{type:o,selector:l,thresholdStrengthSelector:c}=n?{type:"vec2",selector:"rg",thresholdStrengthSelector:"strength.x"}:{type:"float",selector:"r",thresholdStrengthSelector:"strength"};return i.main.add(E`
    ${o} numSamples = texture(shadowCastMap, uv).${l} * inverseSampleValue;

    fragColor = vec4(0.0);

    // early out if we do not have any samples in one or more channels
    if (dot(numSamples, ${o}(1)) < 1.0) {
      return;
    }

    // sampleScale is the number of total samples taken, so this brings strength to a 0-1 range.
    // note that sampleScale is always a vec2 even if we have only the primary channel.
    ${o} strength = numSamples * sampleScale.${l};

    // in threshold mode, step the strength to 0 if we are at or below the threshold, 1 otherwise.
    ${_e(s||n,E`
      ${c} = 1.0 - step(${c}, threshold);
    `)}

    // bail out if we are below the threshold
    ${_e(s,E`if (${c} == 0.0) { return; }`)}

    ${_e(a,E`strength = ceil(strength / bandSize) * bandSize;`)}

    ${o} attenuation = opacityFromElevation * strength;

    // in ThresholdAndGradient mode we blend the threshold color on top of the gradient color
    fragColor = ${_e(n,E`blendColorsPremultiplied(uColor * attenuation.r, gradientColor * attenuation.g)`,E`uColor * attenuation`)};
  `),e}const PA=ri(),DOt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastVisualizePassParameters:Lse,build:ZLe},Symbol.toStringTag,{value:"Module"}));let ove=class extends Vi{constructor(e,i){super(e,i,new Ii(DOt,()=>te(()=>Promise.resolve().then(()=>hzt),void 0)),Qs),this.primitiveType=lr.TRIANGLE_STRIP}initializePipeline(){return li({blending:Qv,colorWrite:$i,depthTest:null,depthWrite:null})}},YLe=class extends Fo{constructor(){super(...arguments),this.visualization=0}};d([oe({count:4})],YLe.prototype,"visualization",void 0);const IOt=4e4,LOt=5e4,QLe=1/512;let ZF=class extends Me{constructor(e,i,r,s){super({}),this._techniques=e,this._rctx=i,this._data=r,this._requestRender=s,this._passParameters=new Lse(this._data),this._configuration=new YLe,this._enabled=!1,this._vao=i1(i)}dispose(){this._stop(),this._vao=Rt(this._vao)}precompile(){this._showVisualization&&this._techniques.precompile(ove,this._configuration)}render(e){if(!this._showVisualization)return;const[i,r]=this._data.computedSamples;this._passParameters.sampleScale=[i?1/i:0,r?1/r:0];const s=this._techniques.get(ove,this._configuration);this._rctx.bindVAO(this._vao),this._rctx.bindTechnique(s,e,this._passParameters),this._rctx.drawArrays(s.primitiveType,0,this._vao.vertexCount("geometry"))}setOptions(e){e.enabled!==void 0&&this._setEnabled(e.enabled),e.thresholdColor!==void 0&&this._setThresholdColor(e.thresholdColor),e.gradientColor!==void 0&&this._setGradientColor(e.gradientColor),e.bandedGradientColor!==void 0&&this._setBandedGradientColor(e.bandedGradientColor),e.threshold!==void 0&&(this._threshold=e.threshold),e.visualization!==void 0&&(this._visualization=e.visualization),e.bandSize!==void 0&&(this._bandSize=e.bandSize)}get opacityFromElevation(){return this._passParameters.opacityFromElevation}set opacityFromElevation(e){this._passParameters.opacityFromElevation!==e&&(this._passParameters.opacityFromElevation=e,this.notifyChange("opacityFromElevation"))}get _showVisualization(){return this._enabled&&(this._data.computedSamples[0]>0||this._data.computedSamples[1]>0)&&this.opacityFromElevation>QLe}get _threshold(){return this._passParameters.threshold}set _threshold(e){this._threshold!==e&&(this._passParameters.threshold=e,this._requestRenderIfEnabled())}get _visualization(){return this._configuration.visualization}set _visualization(e){e!==this._visualization&&(this._configuration.visualization=e,this._requestRenderIfEnabled())}get _bandSize(){return this._passParameters.bandSize}set _bandSize(e){e!==this._bandSize&&(this._passParameters.bandSize=e,this._requestRenderIfEnabled())}_setThresholdColor(e){const i=this._passParameters.thresholdColor;ey(e,i)||(jl(this._passParameters.thresholdColor,e),this._requestRenderIfEnabled())}_setGradientColor(e){const i=this._passParameters.gradientColor;ey(e,i)||(jl(this._passParameters.gradientColor,e),this._requestRenderIfEnabled())}_setBandedGradientColor(e){const i=this._passParameters.bandedGradientColor;ey(e,i)||(jl(this._passParameters.bandedGradientColor,e),this._requestRenderIfEnabled())}_setEnabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfEnabled(){this._enabled&&this._requestRender()}_start(){this._enabled=!0,this._requestRender()}_stop(){this._enabled=!1,this._requestRender()}};d([m()],ZF.prototype,"opacityFromElevation",null),ZF=d([k("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],ZF);let XLe=class extends Vi{constructor(e,i){super(e,i,new Ii(AOt,()=>te(()=>Promise.resolve().then(()=>dzt),void 0)),Qs),this.primitiveType=lr.TRIANGLE_STRIP}initializePipeline(e){const i={r:e.index===0,g:e.index===1,b:!1,a:!1};return li({blending:Ilt,colorWrite:i,depthTest:null,depthWrite:null})}},cJ=class extends Fo{constructor(e){super(),this.index=0,this.index=e}};d([oe({count:2})],cJ.prototype,"index",void 0);function JLe(t){const e=new Di,{fragment:i}=e;e.include(Oa);const r=t.index===1?"vec2":"float",s="value";return e.outputs.add(s,r),i.main.add(E`${s} = ${r}(0.0);`),e}const kOt=Object.freeze(Object.defineProperty({__proto__:null,build:JLe},Symbol.toStringTag,{value:"Module"}));let KLe=class extends Vi{constructor(e,i){super(e,i,new Ii(kOt,()=>te(()=>Promise.resolve().then(()=>pzt),void 0)),Qs),this.primitiveType=lr.TRIANGLE_STRIP}initializePipeline(e){const i={r:e.index===0,g:e.index===1,b:!1,a:!1};return li({blending:null,colorWrite:i,depthTest:null,depthWrite:null})}},Tl=class extends Me{updateDepthRange(e){this._depthRange.equals(e)||(this._depthRange=e)}constructor(e,i,r,s,n,a){super({}),this.fbos=e,this._techniques=i,this._stage=r,this._prepareForShadowMapPass=s,this._renderToShadowMap=n,this._requestRender=a,this._primarySet=new cve(new cJ(0),()=>this._requestRenderIfEnabled()),this._contextSet=new cve(new cJ(1),()=>this._requestRenderIfEnabled()),this._passParameters=new yre,this._depthRange=Ua.Zero,this._previewing=!1,this._shadowAccumulatorKey=Symbol("shadowAccumulator"),this._rctx=e.rctx,this._bindParameters=new ese(new tse(e,r.viewingMode)),this._bindParameters.shadowMap.enabled=!0,this._vao=i1(this._rctx),this._accumulationRenderer=new ZF(i,this._rctx,this,a);const o=this._stage.view.resourceController.scheduler;this.addHandles([o.registerTask(yt.SHADOW_ACCUMULATOR,this),K(()=>this._previewing,()=>this._requestRenderIfEnabled(),Yt),K(()=>this._numActive===2,()=>this._numActiveChanged(),Yt),K(()=>this._depthRange,()=>this._invalidateAccumulationSets(),Yt)],this._shadowAccumulatorKey);for(const l of this._accumulationSets())l.precompile(i)}*_accumulationSets(){yield this._primarySet,yield this._contextSet}normalizeCtorArgs(){return{}}destroy(){this._disable(),this.removeHandles(this._shadowAccumulatorKey),this._accumulationRenderer=Rt(this._accumulationRenderer),this._bindParameters.shadowMap.dispose(),this._fbo=Rt(this._fbo),this._vao=Rt(this._vao);for(const e of this._accumulationSets())e.destroy();this._contextSet=null,this._primarySet=null,this._bindParameters.destroy()}get computedSamples(){return[this._primarySet.progress,this._contextSet.progress]}get shadowCastTexture(){return this._fbo?.colorTexture}get accumulating(){return this.active&&this._previewing||this._refining}get _refining(){return this.active&&!this._doneAccumulating&&!this._previewing}get active(){return this._fbo!=null&&[...this._accumulationSets()].some(e=>e.active)}get canAccumulate(){return this._bindParameters.depth!=null&&this._depthRange!==Ua.Zero&&this._opacityFromElevation>QLe}get _doneAccumulating(){return[...this._accumulationSets()].every(e=>e.doneAccumulating)}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(e){this._accumulationRenderer.opacityFromElevation=e}get _numActive(){return[...this._accumulationSets()].reduce((e,i)=>e+(i.active?1:0),0)}get _pixelFormat(){return this._numActive===2?{pixelFormat:33319,internalFormat:tt.RG8}:{pixelFormat:6403,internalFormat:tt.R8}}get readyToRun(){return this._refining&&this.canAccumulate&&[...this._accumulationSets()].some(e=>e.running)}runTask(e){this._clearBuffersOnAccumulationStart(),this._prepareForShadowMapPass(this._bindParameters);let i=!1;for(const r of this._accumulationSets())this._runTaskForSet(r,e)&&(i=!0);i&&this._requestRender()}_runTaskForSet(e,i){let r=!1;for(;!i.done&&!e.doneAccumulating;)this._accumulateShadow(e),i.madeProgress(),r=!0;return r}renderAccumulation(e,i,r,s){return this._updateCamera(i),this._bindParameters.contentCamera=r,this._bindParameters.depth=e,this._passParameters.origin=this._bindParameters.camera.center,this.notifyChange("canAccumulate"),!(!this.accumulating||!this.canAccumulate)&&(this._previewing||s?(this._clearFramebuffer(),this._reset()):this._clearBuffersOnAccumulationStart(),this._accumulateSetsForRenderFrame(s))}_clearBuffersOnAccumulationStart(){if([...this._accumulationSets()].every(e=>e.progress===0))this._clearFramebuffer();else for(const e of this._accumulationSets())e.progress===0&&this._clearFramebufferForSet(this._fbo,e)}_accumulateSetsForRenderFrame(e){let i=!1;for(const r of this._accumulationSets())this._accumulateSetForRenderFrame(r,e)&&(i=!0);return i&&this._requestRender(),i}_accumulateSetForRenderFrame(e,i){let r=i?e.sampleCount:Math.min(zOt,e.sampleCount);r-=e.progress;for(let s=0;s<r;++s)this._accumulateShadow(e);return r>0}precompile(){this._accumulationRenderer.precompile()}render(e){this._accumulationRenderer.render(e)}setOptions(e){e.previewing!==void 0&&(this._previewing=e.previewing),e.lightDirections!==void 0&&(this._primarySet.lightDirections=e.lightDirections),e.lightDirectionsContext!==void 0&&(this._contextSet.lightDirections=e.lightDirectionsContext),e.enabled===!0?this._enable():e.enabled===!1&&this._disable(),this._accumulationRenderer.setOptions(e)}readAccumulatedShadow(e,i){const r=this._primarySet.progress;return!this.active||!this._fbo||r<1||e<0||e>=this._fbo.width||i<0||i>=this._fbo.height?0:(this._fbo.readPixels(e,i,1,1,6408,bs.UNSIGNED_BYTE,lve),lve[0]/r)}_numActiveChanged(){if(!this._fbo)return;const e=this._numActive===2,i=this._createFBO();i.resize(this._fbo.width,this._fbo.height),e&&(this._clearFramebuffer(i),this._contextSet.reset()),this._fbo.width&&this._fbo.height&&this._rctx.blitFramebuffer(this._fbo,i),this._fbo.dispose(),this._fbo=i,this._requestRender()}_enable(){this._fbo||(this._fbo=this._createFBO(),this._invalidateAccumulationSets())}_createFBO(){const{pixelFormat:e,internalFormat:i}=this._pixelFormat,r=new Zi;return r.pixelFormat=e,r.internalFormat=i,r.wrapMode=33071,new Xv(this._rctx,r)}_invalidateAccumulationSets(){for(const e of this._accumulationSets())e.reset();this._requestRenderIfEnabled()}_disable(){this._fbo&&(this._fbo=Rt(this._fbo),this._requestRender())}_reset(){for(const e of this._accumulationSets())e.reset()}_clearFramebuffer(e=this._fbo){e&&e.width&&e.height&&(this._rctx.bindFramebuffer(e),this._rctx.setClearColor(0,0,0,0),this._rctx.clear(16384))}_clearFramebufferForSet(e,i){if(!e)return;const r=this._techniques.get(KLe,i.configuration);this._rctx.bindFramebuffer(e),this._rctx.bindTechnique(r,this._bindParameters,this._passParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(r.primitiveType,0,this._vao.vertexCount("geometry"))}_accumulateShadow(e){this._renderToShadowMap(this._bindParameters,e.lightDirections[e.progress++],this._depthRange);const i=this._techniques.get(XLe,e.configuration);this._rctx.bindFramebuffer(this._fbo),this._rctx.bindTechnique(i,this._bindParameters,this._passParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(i.primitiveType,0,this._vao.vertexCount("geometry"))}_updateCamera(e){const i=this._fbo;if(i==null)return;const r=this._bindParameters.camera;e.equals(r)||r.copyFrom(e),i.resize(e.fullWidth,e.fullHeight),this._opacityFromElevation=1-sC(IOt,LOt,e.relativeElevation)}_requestRenderIfEnabled(){this._fbo&&this._requestRender()}get test(){}};d([m()],Tl.prototype,"_fbo",void 0),d([m()],Tl.prototype,"_depthRange",void 0),d([m()],Tl.prototype,"_previewing",void 0),d([m()],Tl.prototype,"_accumulationRenderer",void 0),d([m()],Tl.prototype,"_refining",null),d([m()],Tl.prototype,"active",null),d([m()],Tl.prototype,"canAccumulate",null),d([m()],Tl.prototype,"_doneAccumulating",null),d([m()],Tl.prototype,"_opacityFromElevation",null),d([m()],Tl.prototype,"_numActive",null),d([m()],Tl.prototype,"_pixelFormat",null),d([m()],Tl.prototype,"readyToRun",null),Tl=d([k("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],Tl);const zOt=6,lve=new Uint8Array(4);let cve=class{constructor(e,i){this.configuration=e,this._notifyChange=i,this._cachedLightDirections=[],this._progress=Pn(0),this._sampleCount=Pn(0)}get progress(){return this._progress.value}set progress(e){this._progress.value=e}get sampleCount(){return this._sampleCount.value}get doneAccumulating(){return this.progress>=this.sampleCount}get running(){return this.progress>0}get active(){return this.sampleCount>0}get lightDirections(){return this._cachedLightDirections}set lightDirections(e){const i=this._cachedLightDirections,r=Math.min(k4,e.length);if(!Ube(i,0,i.length,e,0,r,Tv)){i.length=r,this._sampleCount.value=r;for(let s=0;s<r;++s)i[s]=de(i[s]??R(),e[s]);this.reset(),this._notifyChange()}}destroy(){this._cachedLightDirections.length=0,this._sampleCount.value=0}reset(){this.progress=0}precompile(e){e.precompile(XLe,this.configuration),e.precompile(KLe,this.configuration)}};const FOt=Py();let NOt=class{constructor(){this._plane=Py(),this._isDecoration=!0}get plane(){return this._plane}get isDecoration(){return this._isDecoration}update({plane:e,isDecoration:i}){let r=!1;return this._isDecoration!==i&&(this._isDecoration=i,r=!0),e??=FOt,J3e(e,this._plane)?r:(o2(e,this._plane),!0)}},uve=class{constructor(e,i,r,s,n,a,o,l,c){this.createQuery=e,this.deleteQuery=i,this.resultAvailable=r,this.getResult=s,this.disjoint=n,this.beginTimeElapsed=a,this.endTimeElapsed=o,this.createTimestamp=l,this.timestampBits=c}},cg=!1;function VOt(t,e){if(e.disjointTimerQuery)return null;let i=t.getExtension("EXT_disjoint_timer_query_webgl2");return i?new uve(()=>t.createQuery(),r=>{t.deleteQuery(r),cg=!1},r=>t.getQueryParameter(r,t.QUERY_RESULT_AVAILABLE),r=>t.getQueryParameter(r,t.QUERY_RESULT),()=>t.getParameter(i.GPU_DISJOINT_EXT),r=>{cg||(cg=!0,t.beginQuery(i.TIME_ELAPSED_EXT,r))},()=>{t.endQuery(i.TIME_ELAPSED_EXT),cg=!1},r=>i.queryCounterEXT(r,i.TIMESTAMP_EXT),()=>t.getQuery(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)):(i=t.getExtension("EXT_disjoint_timer_query"),i?new uve(()=>i.createQueryEXT(),r=>{i.deleteQueryEXT(r),cg=!1},r=>i.getQueryObjectEXT(r,i.QUERY_RESULT_AVAILABLE_EXT),r=>i.getQueryObjectEXT(r,i.QUERY_RESULT_EXT),()=>t.getParameter(i.GPU_DISJOINT_EXT),r=>{cg||(cg=!0,i.beginQueryEXT(i.TIME_ELAPSED_EXT,r))},()=>{i.endQueryEXT(i.TIME_ELAPSED_EXT),cg=!1},r=>i.queryCounterEXT(r,i.TIMESTAMP_EXT),()=>i.getQueryEXT(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)):null)}function UOt(t,e){const i=t.capabilities.disjointTimerQuery;return i==null?null:new BOt(i,e)}let BOt=class{constructor(e,i){this._timer=e,this._queryPool=new Array,this._queryResults=new Map,this._currentQuery=null,i.forEach(r=>{const s=this._timer.createQuery(),n=this._timer.createQuery();this._queryPool.push(s,n),this._queryResults.set(r,null)})}start(){cg||(this._currentQuery=this._queryPool.pop(),this._currentQuery!=null&&(this._timer.disjoint(),this._timer.beginTimeElapsed(this._currentQuery)))}stop(e){if(this._timer.disjoint()||this._currentQuery==null||!this._queryResults.has(e))return this.abort(),null;this._timer.endTimeElapsed();const i=this._queryResults.get(e);if(i==null)return this._queryResults.set(e,this._currentQuery),this._currentQuery=null,null;if(!this._timer.resultAvailable(i))return this._queryPool.unshift(this._currentQuery),this._currentQuery=null,null;const r=this._timer.getResult(i)/1e6;return this._queryPool.unshift(i),this._queryResults.set(e,this._currentQuery),this._currentQuery=null,r}abort(){this._currentQuery!=null&&(this._timer.deleteQuery(this._currentQuery),this._queryPool.unshift(this._timer.createQuery()),this._currentQuery=null)}dispose(){this._currentQuery!=null&&this._timer.deleteQuery(this._currentQuery),this._queryPool.forEach(e=>{this._timer.deleteQuery(e)}),this._queryResults.forEach(e=>{e!=null&&this._timer.deleteQuery(e)})}};const Ns={OVERLAY:"overlay",PREPARE:"prepare",SHADOW_MAP:"shadow map",DEPTH:"depth",ACCUMULATED_SHADOWS:"accumulated shadows",APPLY_ACCUMULATED_SHADOWS:"apply accumulated shadows",OBJECT_AND_LAYER_ID_COLOR:"object/layer id color",NORMALS:"normals",SSAO:"SSAO",HIGHLIGHTS:"highlights",OPAQUE_EDGES:"opaque edges",VOXEL:"voxel",TRANSPARENT:"transparent",TRANSPARENT_EDGES:"transparent edges",HUD_VISIBILITY:"HUD visibility",TRANSPARENT_TERRAIN:"transparent terrain",TRANSPARENT_MATERIAL_WITHOUT_DEPTH:"transparent material without depth",OPAQUE_ENVIRONMENT:"opaque environment",TRANSPARENT_ENVIRONMENT:"transparent environment",OCCLUDED:"occluded",HUD:"HUD",HUD_OCCLUDED:"HUD occluded",FINISH:"finish",FOCUS_AREA_MASK:"focus area mask"},dH=Object.values(es).concat(Object.values(ht)).concat(Object.values(Ns)),hve="Total";let jOt=class{constructor(e){this._rctx=e,this._startTimeStampCPU=0,this._lastTimeStampCPU=0,this._totalCPUTime=new Bg(hve),this._cpuTimeSamplers=new Map(dH.map(i=>[i,new Bg(i)])),this._enableGPUTimer=0,this._totalGPUTime=new Bg("GPU"),this._gpuTimeSamplers=new Map(dH.map(i=>[i,new Bg(i)])),this._totalTime=0,this._totalFrameCount=0}get totalCPUTimeSampler(){return this._totalCPUTime}get cpuTimeSamplers(){return Array.from(this._cpuTimeSamplers.values())}get totalGPUTimeSampler(){return this._totalGPUTime}get gpuTimeSamplers(){return Array.from(this._gpuTimeSamplers.values())}get gpuSamplingEnabled(){return this._gpuTimerPool!=null}get totalTime(){return this._totalTime}get totalFrameCount(){return this._totalFrameCount}get elapsedTime(){return performance.now()-this._startTimeStampCPU}enableGPUPerformanceInfo(){if(this._gpuTimerPool==null){const i=[...dH,hve];this._gpuTimerPool=UOt(this._rctx,i)}if(this._gpuTimerPool==null)return{hasGPUTimerSupport:!1,remove:()=>{}};++this._enableGPUTimer;let e=!1;return{hasGPUTimerSupport:!0,remove:()=>{e||(e=!0,--this._enableGPUTimer,this._enableGPUTimer===0&&(this._gpuTimerPool=Rt(this._gpuTimerPool)))}}}startFrame(){this._startTimeStampCPU=this._lastTimeStampCPU=performance.now(),this._gpuTimerPool&&(this._gpuTimeSamplers.forEach(e=>e.push(0)),this._gpuTimerPool.start())}advance(e){const i=performance.now();if(this._cpuTimeSamplers.get(e).push(i-this._lastTimeStampCPU),this._lastTimeStampCPU=i,this._gpuTimerPool){const r=this._gpuTimerPool.stop(e);this._gpuTimeSamplers.get(e).set(r),this._gpuTimerPool.start()}}finishFrame(){if(this._gpuTimerPool){const i=this._gpuTimerPool.stop(Ns.FINISH);this._gpuTimeSamplers.get(Ns.FINISH).set(i),this._rctx.gl.flush()}const e=performance.now()-this._startTimeStampCPU;this._totalTime=this._totalTime+e,this._totalCPUTime.push(e),this._gpuTimerPool&&this._totalGPUTime.push(this.gpuTimeSamplers.reduce((i,r)=>i+(r.last||0),0)),++this._totalFrameCount}},VT=class extends fR{constructor(e,i,r,s,n,a){super({stage:e}),this._techniques=r,this._rctx=s,this._compositingHelper=n,this._requestRender=a,this._pluginsHas={hudElements:!1,water:!1},this.renderPassManager=new sJ,this._isRendering=!1,this._inGlobeView=!1,this._backgroundColor=fi(0,0,0,1),this._sliceHelper=new NOt,this._blit=null,this._oitblend=null,this.sceneDepthRange=Pn(Ua.Infinite),this._state=Pn(2),this._highQualityTransparencyEnabled=!0,this._ssrEnabled=!1,this._hasAnimations=!1,this._animationTimestep=new nOt,this._loadEdgeViewTask=null,this._edgeViewCallbacks=[],this._reprojectionMatrixVersion=Pn(0),this._lastFrameTime=0,this._renderHiddenTransparentEdges=()=>{},this._pluginInput=new COt,this._releaseNormals=o=>{o.some(({name:l})=>l==="normals")&&this._pluginInput.release("normals")},this._debugNeedsDepth=!1,this._fboCache=new HAt(s),this._renderStateFeatures=Pn(ave(!ie("disable-feature:high-quality-idle"),e.view.qualityProfile)),this._framebuffer=new $Ot(this.fboCache),this._performanceInfo=new jOt(this._rctx),this._shadowMap=new tse(this.fboCache,e.viewingMode),this._shadowAccumulator=new Tl(this.fboCache,r,e,o=>{const l=this.shadowsEnabled;this._shadowMap.enabled=!0,this._ensureBindParametersCamera(o.camera,o.contentCamera),this._plugins.prepareRender(),this._shadowMap.enabled=l},(o,l,c)=>{const h=e.view.qualitySettings.maximumPixelRatio;o.shadowMap.start(o.camera,l,c,!0,h),this._renderShadowCascades(4,o.shadowMap),o.shadowMap.finish(),o.camera.setGLViewport(this._rctx),this._ensureBindParametersCamera(o.camera,o.contentCamera)},a),this._renderContext=new AIe(this._rctx,this._shadowMap,r),this._nodes=new KAt(this._renderContext),this._plugins=new eOt({renderContext:this._renderContext,techniques:r,materials:i,requestRender:a,controller:e,fbos:this.fboCache,isFeatureEnabled:o=>this.isFeatureEnabled(o)}),this._plugins.add(this.renderPassManager),this.addHandles([K(()=>e.view.state.camera,()=>a(),At),K(()=>Ws.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES,o=>{this._renderHiddenTransparentEdges=o?()=>this._renderEdges(0):()=>{},a()},Wt),K(()=>e.view.environment.background?.color,o=>{const l=o?wse(o):tn;yr(this._backgroundColor,l[0]*l[3],l[1]*l[3],l[2]*l[3],l[3]),a()},At),K(()=>e.view.state.camera.relativeElevation,o=>this._inGlobeView=(o??1/0)>=uV,At),K(()=>this._bindParameters.clouds.fadeFactor,()=>{this._bindParameters.fadeLighting(),this._requestRender(2)},Yt),K(()=>this._bindParameters.clouds.data?.state,()=>a(),Yt),K(()=>e.view.state.highlights,o=>{this._bindParameters.highlights=o,a()},Wt)])}destroy(){this._gpuTimerHandle=Ki(this._gpuTimerHandle),this._nodes.destroy(),this._framebuffer.dispose(),this._shadowMap.dispose(),this._shadowAccumulator.destroy(),this._shadowAccumulator=null,this._loadEdgeViewTask=ps(this._loadEdgeViewTask),this._edgeView=Re(this._edgeView),this.renderPassManager.dispose(),this._releaseFBOs(),this._disposeOffscreenBuffers(),this._fboCache.destroy(),this._fboCache=null,this._plugins.destroy(),this._plugins=null,this._pluginInput=null,this._blit=null,this._oitblend=null,this._compositingHelper=null,this._nodes=null,this._framebuffer=null,this._shadowMap=null,this._renderContext=null,this._performanceInfo=null,DRe.prune(),L3.prune(),jct()}get renderContext(){return this._renderContext}get _bindParameters(){return this._renderContext.bind}get _framebufferSize(){return this._framebuffer.size}get performanceInfo(){return this._performanceInfo}updateRenderFeatures(e=null,i=!ie("disable-feature:high-quality-idle")){this._renderStateFeatures.value=ave(i,e),this._requestRender()}isFeatureEnabled(e,i=this._state.value){return this._renderStateFeatures.value.get(i,e)??!1}setFeatureEnabled(e,i,r){this._renderStateFeatures.mutate(s=>s.set(i,e,r)),this._requestRender()}get _highQualityTransparency(){return this._highQualityTransparencyEnabled||this.isFeatureEnabled(1)}get hasReflections(){return this._pluginsHas.water&&(this._ssrEnabled||this.isFeatureEnabled(5))}get _hasHighlights(){return this._plugins.produces(9,2,4,18,13,14)}hasHighlight(e){return this._plugins.hasHighlight(e)}get _hasHUDHighlights(){return this._plugins.produces(9,13,14)}get hasSSAO(){return(this.stage.view.qualitySettings.ambientOcclusion||this.isFeatureEnabled(4))&&!this._inGlobeView}get hasSMAA(){return this.stage.view.qualitySettings.antialiasingEnabled||this.isFeatureEnabled(0)}get hasEmitters(){return this._plugins.hasEmitters&&this.stage.view.qualitySettings.physicallyBasedRenderingEnabled}get fullResolutionAtmosphere(){return this.stage.view.qualitySettings.highResolutionAtmosphere||this.isFeatureEnabled(3)}get fboCache(){return this._fboCache}_releaseFBOs(){this._bindParameters.ssr.lastFrameColor=Sr(this._bindParameters.ssr.lastFrameColor),this._bindParameters.terrainDepth=Sr(this._bindParameters.terrainDepth),this._bindParameters.geometryDepth=Sr(this._bindParameters.geometryDepth)}_disposeOffscreenBuffers(){this._framebuffer.dispose(),this._disposeBindBuffers()}_disposeBindBuffers(){this._shadowMap.disposeOffscreenBuffers(),this._bindParameters.depth=Sr(this._bindParameters.depth),this._bindParameters.hudVisibility=Sr(this._bindParameters.hudVisibility)}get updating(){return this._loadEdgeViewTask&&!this._loadEdgeViewTask.finished||this._edgeView?.updating||this._shadowAccumulator.readyToRun||this._plugins.updating||!this.isCameraFinal}loadEdgeView(){return this._loadEdgeViewTask||(this._loadEdgeViewTask=Bc(async e=>{const{EdgeView:i}=await te(()=>import("./EdgeView-B1fsha5-.js"),__vite__mapDeps([368,28,369,27,29,30]));st(e);const r=this._edgeView=new i({rctx:this._rctx,renderSR:this.stage.view.renderSpatialReference,viewingMode:this.stage.view.stage.viewingMode,techniques:this._techniques,setNeedsRender:()=>this._requestRender(),schedule:WOt(this.stage.view.resourceController)});return this.addHandles(K(()=>r.updating,()=>this._requestRender(),Yt)),this._requestRender(),this._edgeViewCallbacks.forEach(s=>s(r)),this._edgeViewCallbacks.length=0,r})),this._loadEdgeViewTask.promise}withEdgeView(e){this.loadEdgeView(),this._edgeView==null?this._edgeViewCallbacks.push(e):e(this._edgeView)}get edgeView(){return this._edgeView}get isCameraFinal(){return this._reprojectionMatrixVersion.value>=0&&Ree(this._bindParameters.ssr.reprojectionMatrix,Ro)}set _reprojectionMatrix(e){w8e(this._bindParameters.ssr.reprojectionMatrix,e)&&this._reprojectionMatrixVersion.value++}get shadowsEnabled(){return!!this._shadowMap?.enabled}setParameters(e){const{_shadowMap:i,_bindParameters:r}=this;if(e.qualitySettings?.reflections!==void 0&&this._ssrEnabled!==e.qualitySettings.reflections&&(this._ssrEnabled=e.qualitySettings.reflections,this._requestRender()),e.shadowMap!==void 0&&this._shadowMap.enabled!==e.shadowMap&&(this._shadowMap.enabled=e.shadowMap,this._requestRender()),e.shadowMapMaxCascades!==void 0&&i.maxCascades!==e.shadowMapMaxCascades&&(i.maxCascades=e.shadowMapMaxCascades,this._requestRender()),e.environment){e.environment.weather!==void 0&&(this._bindParameters.weather=e.environment.weather);const s=e.environment.lighting.type!=="virtual";r.enableFillLights!==s&&(r.enableFillLights=s,this._requestRender())}e.highQualityTransparency!==void 0&&this._highQualityTransparencyEnabled!==e.highQualityTransparency&&(this._highQualityTransparencyEnabled=e.highQualityTransparency,this._requestRender()),e.shadowCast!==void 0&&this._shadowAccumulator.setOptions(e.shadowCast)}set slice(e){this._sliceHelper.update(e)&&this._requestRender()}get plugins(){return this._plugins}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlend.result}get _oitEnabled(){return this._highQualityTransparency&&this._hasOITSupport}commit(e,i){return this._isRendering&&console.warn("Renderer.modify called while rendering"),!!super.commit(e,i,this._plugins.context)&&(this.updateHasFlags(),!0)}rendererAdded(e){this._plugins.add(e)}rendererRemoved(e){this._plugins.remove(e)}get occludedRequiresStencil(){return this.occludedRequiresOccludeeStencil||this.occludedRequiresIntegratedMeshStencil}get occludedRequiresOccludeeStencil(){return this._bindParameters.hasOccludees&&!!(8&this.plugins.renderOccludedFlags)}get occludedRequiresIntegratedMeshStencil(){return this._plugins.produces(0,0)&&this._plugins.produces(0,9)}updateHasFlags(){const e=this._pluginsHas;e.hudElements=this._plugins.produces(0,...DA),e.water=this._plugins.produces(3,19),this._bindParameters.hasOccludees=this._plugins.hasOccludees,this._requestRender()}updateAnimation(e,i){this._animationTimer??=new sOt(e.camera,i),this._animationTimer.advance(e.camera,i,this._animationTimeDilation);const r=this._hasAnimations;return this._hasAnimations=this._plugins.updateAnimation(this._animationTimer),this._hasAnimations=this._nodes.updateAnimation(this._animationTimer)||this._hasAnimations,this._hasAnimations!==r&&(this._gpuTimerHandle=r?Ki(this._gpuTimerHandle):this.performanceInfo.enableGPUPerformanceInfo()),this._hasAnimations}get animationTimestep(){return this._animationTimestep.value}get _animationTimeDilation(){return this._animationTimestep.timeDilation}resetAnimation(){this._animationTimestep.clear()}tick(){this.fboCache.clean()}render(e,i,r,s=!1){try{return this._isRendering=!0,this._render(e,i,r,s)}catch(n){console.error(`Exception during rendering: ${n}`)}finally{this._isRendering=!1}return new D0e(this._pluginInput.get(es.FINAL),null)}_updateHUDOccludedFragmentOpacity(e,i){const{idleOpacity:r,navigatingOpacity:s,maxDelta:n,tiltFadeStart:a,tiltFadeEnd:o,altitudeStart:l,altitudeEnd:c}=TOt,h=this.stage.view,f=h.stateManager.camera,y=h.qualitySettings.fadeDuration,_=e===2?r:s,w=Se((f.tilt-a)/(o-a),0,1),x=Se(((f.position.z??0)-l)/(c-l),0,1),S=ft(ft(1,_,w),1,x),$=this._bindParameters.hudOccludedFragmentOpacity;if(y<=0||$===S||this._lastFrameTime===0||this._lastFrameTime>i)return this._bindParameters.hudOccludedFragmentOpacity=S,void(this._lastFrameTime=i);const A=i-this._lastFrameTime;this._lastFrameTime=i;const M=Math.max(1-r,Math.abs(r-s)),P=Math.min(M*A/y,n);P>=Math.abs(S-$)?this._bindParameters.hudOccludedFragmentOpacity=S:(this._bindParameters.hudOccludedFragmentOpacity=$+Math.sign(S-$)*P,this._requestRender())}_render(e,i,r,s){const n=r===0;this.performanceInfo.startFrame(),this.fboCache.frameStart(),this.fboCache.interactive=n,this._disposeBindBuffers();const{camera:a,contentCamera:o,mode:l,alignPixelEnabled:c}=e;this._state.value=l;const h=this._nodes.produces("magnifier-color"),f=this._nodes.produces(es.FINAL),y=this.hasEmitters,_=y?1:0;this._renderContext.time=i,this._renderContext.output=_,this._bindParameters.oitPass=0,this._bindParameters.alignPixelEnabled=c,this._bindParameters.decorations=!s,this._bindParameters.mainDepth=null;const w=!s||!this._sliceHelper.isDecoration;this._bindParameters.slicePlane=w?this._sliceHelper.plane:null,this._bindParameters.viewshedEnabled=this._nodes.produces(ht.VIEWSHED),this._bindParameters.cutFillEnabled=this._nodes.produces(ht.CUTFILL_DEPTH),this._renderOverlay(),a.setGLViewport(this._rctx);const x=this._framebuffer,S=x.initialize(a.fullWidth,a.fullHeight,this._backgroundColor,y);this.hasReflections?(S?.setName("last frame color"),this._bindParameters.ssr.lastFrameColor=S):S?.release(),this._ensureBindParametersCamera(a,o),this._updateHUDOccludedFragmentOpacity(l,i),this._plugins.prepareRender(),this._bindParameters.shadowHighlightsVisible=this._needsShadowHighlight&&!s;const $=this._highQualityTransparency&&this._hasTransparentTerrain,A=this._plugins.produces(0,...RA);this._precompilePrepasses(),this.performanceInfo.advance(Ns.PREPARE);const M=this._computeShadowDepthRange(a);this._renderShadowMap(a,this._bindParameters.lighting.mainLight.direction,M),this._pluginInput.set("normals",this._renderNormals()),this._renderRemainingGeometryDepth(),this._renderShadowAccumulation(M,a,o,!n),this._ensureBindParametersSSR(i),this._precompileShaders($,A,_),this._renderContext.output=_,x.bind(),this._bindParameters.mainDepth=x.depth.attachment,this._renderOpaque($),this._renderTransparent(A,$,_),this._shadowMap.disposeMainBuffer(),this._pluginInput.set(ht.FOCUSAREA,this._renderFocusAreaGeometry()),this._pluginInput.set(ht.CUTFILL_DEPTH,this._renderCutFillDepth()),x.update(j=>this._renderNodes(ht.TRANSPARENT_ENVIRONMENT,j)),x.update(j=>this._renderNodes(ht.VIEWSHED,j)),x.update(j=>this._renderNodes(ht.LASERLINES,j)),x.update(j=>this._renderNodes(ht.FOCUSAREA_COLOR,j)),this._pluginInput.release(ht.FOCUSAREA),this._pluginInput.release(ht.CUTFILL_DEPTH),x.update(j=>this._renderNodes(ht.OCCLUDED,j)),this._pluginInput.set("highlights",this._renderHighlightPrepass()),this._renderHighlightShadowMap(a,this._bindParameters.lighting.mainLight.direction,M);const P=r===2?this._renderObjectAndLayerIdColor():null;x.update(j=>this._renderNodes(es.COMPOSITE,j)),this._shadowMap.disposeOffscreenBuffers();const O=n&&!f&&!(h&&!s),D=this._pluginInput.get(es.COMPOSITE),L=O?QC:this.fboCache.acquire(D.fbo.width,D.fbo.height,ht.ANTIALIASING),F=this._nodes.produces(ht.ANTIALIASING)?this._renderNodes(ht.ANTIALIASING,L):this.blitFBO(D,L,!1);let U;this._pluginInput.set(ht.ANTIALIASING,F),this._hasHUDHighlights?(this._renderHUD(1,F,_),U=this._renderNodes(ht.HIGHLIGHTS,F)):(U=this._renderNodes(ht.HIGHLIGHTS,F),this._renderHUD(1,U,_));const N=this._renderNodes(ht.MAGNIFIER,U);return n&&h&&!s&&!f&&this.blitFBO(N),f?(N.attachDepth(x.depth),this.blitFBO(this._renderNodes(es.FINAL,N)),N.detachDepth()):this._pluginInput.set(es.FINAL,N),this._pluginInput.release("highlights"),this.onPostRender&&this.onPostRender(),this._releaseFBOs(),x.releaseDepth(),this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera),this.fboCache.frameEnd(),this.performanceInfo.finishFrame(),n||(this._releaseFBOs(),this._disposeOffscreenBuffers()),new D0e(this._pluginInput.get(es.FINAL),P)}_precompileShaders(e,i,r){++this._plugins.context.techniques.precompiling,this._renderContext.output=r,this._precompileOpaqueGeometry(),this._nodes.precompile(ht.OPAQUE_ENVIRONMENT),this._bindParameters.terrainDepthTest=e,this._bindParameters.cullAboveTerrain=e,this._renderContext.output=2,this._plugins.precompile(6),this._plugins.precompile(7),e&&(this._precompileOpaqueGeometry(),this._precompileTransparentGeometry()),this._renderContext.output=r,this._plugins.precompile(6),this._plugins.precompile(7),i&&(this._precompileTransparentGeometry(),this._hasTransparentTerrain&&(this._bindParameters.cullAboveTerrain=!1,this._precompileTransparentGeometry(),this._bindParameters.cullAboveTerrain=e)),this._nodes.precompile(ht.FOCUSAREA),this._needsHUDVisibility&&this._plugins.precompile(12),this._plugins.precompile(15),this._precompileHUD(0),this._bindParameters.terrainDepthTest=!1,this._bindParameters.cullAboveTerrain=!1,this._nodes.precompile(ht.VIEWSHED,ht.CUTFILL_DEPTH,ht.CUTFILL_COLOR,ht.LASERLINES,ht.FOCUSAREA_COLOR,ht.OCCLUDED,ht.ANTIALIASING,ht.HIGHLIGHTS);const s=this._bindParameters;s.highlightMixTexture=s.highlights.length>1?this._rctx.emptyTexture:null,this._precompileHUD(1),this._hasHighlights&&(s.highlights.forEach((n,a)=>{s.highlightLevel=a,this._precompileAllGeometry(9)}),s.highlightLevel=null),s.highlightMixTexture=null,this._nodes.precompile(es.COMPOSITE,ht.MAGNIFIER),this._shadowAccumulator.precompile(),this._plugins.precompile(8),--this._plugins.context.techniques.precompiling}_renderFocusAreaGeometry(){const e=this._nodes.produce(ht.FOCUSAREA,this._pluginInput);return e&&this.performanceInfo.advance(Ns.FOCUS_AREA_MASK),e}_renderObjectAndLayerIdColor(){if(!this._nodes.produces("olid"))return null;const e=this._renderContext.output;++this._techniques.precompiling;const i=this._framebufferSize;let r=this.fboCache.acquire(i.width,i.height,"olid");return r.acquireDepth(13),r=this._nodes.render(r,this._pluginInput),--this._techniques.precompiling,this.performanceInfo.advance(Ns.OBJECT_AND_LAYER_ID_COLOR),this._renderContext.output=e,r}finish(e){this._hasAnimations||this._animationTimestep.clear();const i=this.performanceInfo.gpuSamplingEnabled,r=e===0;if(r||i){const s=r?this.performanceInfo.elapsedTime:0;let n=0;i?n=this.performanceInfo.totalGPUTimeSampler.last:this._rctx.gl.finish();const a=Math.max(s,n);this._animationTimestep.frame(a,r)}}readMainDepth(e,i){const{mainDepth:r,camera:s}=this._bindParameters;if(!r)return;const n=this.fboCache.acquire(this._framebufferSize.width,this._framebufferSize.height,"linear depth");this._rctx.bindFramebuffer(n.fbo),s.setGLViewport(this._rctx),this._rctx.setScissorRect(e[0],e[1],e[2],e[3]),this._rctx.setScissorTestEnabled(!0),this._rctx.clearFramebuffer(tn),this._compositingHelper.blitDepthToLinearDepth(this._bindParameters,r),this._rctx.setScissorTestEnabled(!1),this._rctx.setScissorRect(0,0,this._rctx.gl.canvas.width,this._rctx.gl.canvas.width),n.fbo?.readPixels(e[0],e[1],e[2],e[3],6408,bs.UNSIGNED_BYTE,i),n.release()}readHUDVisibility(e,i,r,s,n){this._bindParameters.hudVisibility?.fbo?.readPixels(e,i,r,s,6408,bs.UNSIGNED_BYTE,n)}readAccumulatedShadow(e){return this._shadowAccumulator.readAccumulatedShadow(e[0],e[1])}_renderEdges(e){const i=this._edgeView;if(!i?.shouldRender())return;const r=this._renderContext.output,s=this._framebufferSize,n=this.fboCache.acquire(s.width,s.height,"edges"),a=()=>i.render(this._bindParameters,e),o=this._bindParameters.geometryDepth;this.renderToTargets(a,n,o??this._framebuffer.depth,tn),this._framebuffer.bind(),this._compositingHelper.composite(this._bindParameters,n.getTexture(),u$(r)?1:0),n.release(),this.performanceInfo.advance(e===1?Ns.OPAQUE_EDGES:Ns.TRANSPARENT_EDGES)}_renderOverlay(){this._bindParameters.overlay=this.overlay?.render(),this._bindParameters.overlay&&this.performanceInfo.advance(Ns.OVERLAY)}_renderShadowMap(e,i,r){if(!this.shadowsEnabled)return;const{contentCamera:s}=this._bindParameters,n=this._shadowMap;n.start(e,i,r,this.isFeatureEnabled(6),this.stage.view.qualitySettings.maximumPixelRatio),this._needsShadowHighlight?(this._renderShadowCascades(6,this._shadowMap),n.copySnapshot(1),this._renderShadowCascades(5,this._shadowMap)):this._renderShadowCascades(4),n.finish(),e.setGLViewport(this._rctx),this._ensureBindParametersCamera(e,s),this.performanceInfo.advance(Ns.SHADOW_MAP)}_renderHighlightShadowMap(e,i,r){if(!this.shadowsEnabled||!this._needsShadowHighlight)return;const{contentCamera:s}=this._bindParameters,n=this._shadowMap;n.start(e,i,r,this.isFeatureEnabled(6),this.stage.view.qualitySettings.maximumPixelRatio),this._renderShadowCascades(5,this._shadowMap),n.moveSnapshot(0),n.finish(),e.setGLViewport(this._rctx),this._ensureBindParametersCamera(e,s),this.performanceInfo.advance(Ns.SHADOW_MAP)}_renderCutFillDepth(){return this._nodes.produce(ht.CUTFILL_DEPTH,this._pluginInput)}_precompileShadowCascades(e){for(const i of this._shadowMap.cascades)i.camera.setGLViewport(this._rctx),this._ensureBindParametersCamera(i.camera,i.camera),this._precompileAllGeometry(e)}_renderShadowCascades(e,i=this._shadowMap){i.bindFbo();for(const r of i.cascades)r.camera.setGLViewport(this._rctx),this._ensureBindParametersCamera(r.camera,r.camera),this.renderAllGeometry(e)}get _needsDepth(){return this._plugins.consumes(2)||this._nodes.requireGeometryDepth()||this.hasReflections||this._needsShadowHighlight||this._shadowAccumulator.active||this._debugNeedsDepth}_renderRemainingGeometryDepth(){const e=this._pluginInput.get("normals");e?(this._pluginInput.set(ht.SSAO,this._renderSSAO()),this._needsDepth?(this._rctx.bindFramebuffer(e.fbo),this._rctx.clear(1024),this._renderGeometryWithoutNormals(2),Sr(this._bindParameters.depth),this._bindParameters.depth=e.obtainDepthTexture(),this.performanceInfo.advance(Ns.DEPTH)):(e.detachDepth(),this._bindParameters.depth=Sr(this._bindParameters.depth)),this.hasSSAO&&this._pluginInput.release("normals")):this._renderAllGeometryDepth()}_renderAllGeometryDepth(){if(!this._needsDepth)return void(this._bindParameters.depth=Sr(this._bindParameters.depth));const e=this._framebufferSize,i=this.fboCache.acquire(e.width,e.height,"geometry depth",13);this._rctx.bindFramebuffer(i.fbo),this._rctx.clear(1280),this.renderAllGeometry(2),Sr(this._bindParameters.depth),this._bindParameters.depth=i.obtainDepthTexture(),i.release(),this.performanceInfo.advance(Ns.DEPTH)}_renderTerrainDepth(e){if(this._bindParameters.terrainDepthTest=e,this._bindParameters.cullAboveTerrain=e,!e)return void(this._bindParameters.terrainDepth=Sr(this._bindParameters.terrainDepth));const i=this._renderContext.output;this._renderContext.output=2;const r=this._framebufferSize,s=this.fboCache.acquire(r.width,r.height,"terrain depth",13);this._rctx.bindFramebuffer(s.fbo),this._rctx.clear(1280),this._renderTransparentTerrain(),Sr(this._bindParameters.terrainDepth),this._bindParameters.terrainDepth=s.obtainDepthTexture(),this._renderContext.output=i,s.release()}_renderGeometryDepth(e){if(!e)return void(this._bindParameters.geometryDepth=Sr(this._bindParameters.geometryDepth));const i=this._renderContext.output,{width:r,height:s}=this._framebufferSize,n=this.fboCache.acquire(r,s,"geometry depth",13);this._rctx.bindFramebuffer(n.fbo),this._rctx.clear(1280),this._renderOpaqueAndTransparentGeometry(2),this._renderContext.output=i,Sr(this._bindParameters.geometryDepth),this._bindParameters.geometryDepth=n.obtainDepthTexture(),n.release()}get _needsShadowDepthRange(){return this._shadowMap.enabled||this._shadowAccumulator.active}_computeShadowDepthRange(e){if(!this._needsShadowDepthRange)return Ua.Zero;const i=rve(e,this._plugins.plugins,this.stage.layers,0);return i.union(this._plugins.queryDepthRange(e)),i.near=Math.max(e.near,i.near),i.far=Math.min(e.far,i.far),i}updateSceneDepthRange(e){if(!this.stage.view.state.isGlobal)return void(this.sceneDepthRange.value=Ua.Infinite);if((this.stage.view.renderCoordsHelper?.getAltitude(e.eye)??0)<vQ)return void(this.sceneDepthRange.value=Ua.Infinite);const i=e.clone();i.near=o8,i.far=1e10;const r=rve(i,this._plugins.plugins,this.stage.layers,1);r.union(this._plugins.queryDepthRange(i)),this.sceneDepthRange.value.equals(r)||(this.sceneDepthRange.value=r)}get _normalsRequired(){const e=this._nodes.require("normals",es.FINAL,es.COMPOSITE,es.OPAQUE,es.TRANSPARENT,ht.VIEWSHED,ht.LASERLINES);return(this.hasSSAO?1:0)+e}_precompilePrepasses(){this._normalsRequired&&this._precompileAllGeometry(3),this._needsDepth&&this._precompileAllGeometry(2),this.shadowsEnabled&&(this._needsShadowHighlight?(this._precompileShadowCascades(5),this._precompileShadowCascades(6),this._precompileShadowCascades(5)):this._precompileShadowCascades(4)),this._shadowAccumulator.active&&this._precompileAllGeometry(4)}_renderNormals(){const e=this._normalsRequired;if(e===0)return;const i=this._framebufferSize,r=this.fboCache.acquire(i.width,i.height,"normals",5);r.acquireDepth(13),this._rctx.bindFramebuffer(r.fbo),this._rctx.clearFramebuffer(tn,!0,!0),this._renderGeometryWithNormals(3);const s=this._nodes.optional("normals",es.FINAL,es.COMPOSITE,es.OPAQUE,es.TRANSPARENT,ht.VIEWSHED);return r.retain(e+s-1),this.performanceInfo.advance(Ns.NORMALS),r}_renderSSAO(){const e=this._pluginInput.get("normals");if(!this.hasSSAO||!e)return;const i=this._nodes.produce(ht.SSAO,this._pluginInput);return this._bindParameters.ssao=i,i&&this.performanceInfo.advance(Ns.SSAO),i}_precompileAllGeometry(e){const i=this._renderContext.output;this._renderContext.output=e,this._precompileOpaqueGeometry(),this._precompileTransparentGeometry(),this._plugins.precompile(6),this._plugins.precompile(7),this._renderContext.output=i}renderAllGeometry(e){this._renderContext.output=e,this._renderOpaqueAndTransparentGeometry(e),this._renderTransparentTerrain()}precompileSlots(e,...i){for(const r of i)this._bindParameters.slot=r,e.precompile(this._renderContext)}precompileOccludedSlots(e,i){for(const r of i)this._renderContext.renderOccludedMask=r,this.precompileSlots(e,...dve);this._renderContext.renderOccludedMask=CD}renderSlots(e,...i){for(const r of i)this._bindParameters.slot=r,e.forAll(s=>{const n=s.acquireTechniques(this._renderContext);n&&s.render(this._renderContext,n)})}renderOccludedSlots(e,i){this._renderContext.renderOccludedMask=i,this.plugins.renderOccludedFlags>1&&this._plugins.render(9),this.renderSlots(e,...dve),this._renderContext.renderOccludedMask=CD}renderHUD(e){this._bindParameters.hudRenderStyle=e,this._plugins.render(13)}precompileViewshedShadowMap(){this._precompileAllGeometry(7)}precompileCutFill(){const i=this._renderContext.output;this._renderContext.output=8,this._plugins.precompile(0,1,6),this._renderContext.output=i}renderViewshedShadowMap(e){const{camera:i,contentCamera:r}=this._bindParameters,s=this._renderContext.output;e.setGLViewport(this._rctx),this._ensureBindParametersCamera(e,e),this.renderAllGeometry(7),this._ensureBindParametersCamera(i,r),this._bindParameters.camera.setGLViewport(this._rctx),this._renderContext.output=s}renderCutFillReferenceDepth(e){const{camera:i,contentCamera:r}=this._bindParameters,s=this._renderContext.output;e.setGLViewport(this._rctx),this._ensureBindParametersCamera(e,e),this._renderContext.output=8,this._plugins.render(0,1),this._plugins.render(6),this._ensureBindParametersCamera(i,r),i.setGLViewport(this._rctx),this._renderContext.output=s}_renderOpaqueAndTransparentGeometry(e){this._renderContext.output=e,this._renderOpaqueGeometry(),this._renderTransparentGeometry()}_renderGeometryWithNormals(e){this._renderContext.output=e,this._plugins.render(...qOt),this._renderTransparentTerrain()}_renderGeometryWithoutNormals(e){this._renderContext.output=e,this._plugins.render(...GOt)}_precompileOpaqueGeometry(){this._plugins.precompile(...pH),this._nodes.precompile("opaque-color")}_renderOpaqueGeometry(){this._plugins.render(...pH)}_renderTransparentGeometry(){this._plugins.render(...RA)}get _hasTransparentTerrain(){return this._plugins.produces(0,6)}get _hasTransparentIntegratedMesh(){return this._plugins.produces(this._renderContext.output,7)}_renderTransparentTerrain(){const e=()=>this._plugins.render(6);if(!ds(this._renderContext.output))return void e();const i=this._framebufferSize,r=this.fboCache.acquire(i.width,i.height,"transparent terrain");return this.renderToTargets(e,r,this._framebuffer.depth,tn),r}_renderTransparentIntegratedMesh(){const e=()=>this._plugins.render(7);if(!ds(this._renderContext.output))return void e();const i=this._framebufferSize,r=this.fboCache.acquire(i.width,i.height,"transparent integrated mesh");return this.renderToTargets(e,r,this._framebuffer.depth,tn),r}get _needsHUDVisibility(){return this._plugins.produces(this._renderContext.output,12)}_renderHUDVisibility(){if(!this._needsHUDVisibility)return void(this._bindParameters.hudVisibility=Sr(this._bindParameters.hudVisibility));const{width:e,height:i}=this._framebufferSize;let r=this._bindParameters.hudVisibility;r?.fbo?.width===e&&r?.fbo?.height===i||(r?.release(),r=this.fboCache.acquire(e,i,"hud visibility",4),this._bindParameters.hudVisibility=r);const s=this._bindParameters.geometryDepth;r.attachDepth(s||this._framebuffer.depth),this._rctx.bindFramebuffer(r.fbo),this._rctx.clearFramebuffer([0,1,0,1]),this._plugins.render(12),r.detachDepth(),this._framebuffer.bind(),this.performanceInfo.advance(Ns.HUD_VISIBILITY)}_renderLineCallouts(e){if(this._bindParameters.hudRenderStyle=e,e===0){const i=()=>this._plugins.render(15),r=this._framebufferSize,s=this.fboCache.acquireDepth(12,r.width,r.height,"line callouts");this.renderToTargets(i,this._framebuffer.color,s,void 0,!0,!0),s.release()}else this._plugins.render(15)}_precompileHUD(e){if(this._precompileHUDOutput(e),this._hasHighlights){const i=this._renderContext.output;this._renderContext.output=9,this._precompileHUDOutput(e),this._renderContext.output=i}}_precompileHUDOutput(e){const i=this._bindParameters.hudRenderStyle;this._bindParameters.hudRenderStyle=e,this._oitEnabled&&ds(this._renderContext.output)?(this._bindParameters.oitPass=1,this._plugins.precompile(...DA),this._bindParameters.oitPass=2,this._plugins.precompile(...DA),this._bindParameters.oitPass=0):this._plugins.precompile(...DA),this._bindParameters.hudRenderStyle=i}_renderHUD(e,i,r){if(this._pluginsHas.hudElements){if(this._oitEnabled){const s=this._renderOIT(1,r,e);this._rctx.bindFramebuffer(i.fbo),this._compositingHelper.compositePreMultipliedAlpha(this._bindParameters,s.getTexture(),0),s.release()}else if(this._renderContext.output=r,e===0){const s=()=>this._renderHUDElements(e),n=this._framebufferSize,a=this.fboCache.acquireDepth(12,n.width,n.height,"hud");this.renderToTargets(s,this._framebuffer.color,a,void 0,!0,!0),a.release()}else i.acquireDepth(12),this._rctx.bindFramebuffer(i.fbo),this._renderHUDElements(e),i.detachDepth();this.performanceInfo.advance(e===0?Ns.HUD_OCCLUDED:Ns.HUD)}}_renderHUDElements(e){this._bindParameters.hudRenderStyle=e,this._plugins.render(...DA)}get _needsShadowHighlight(){return this.shadowsEnabled&&this._plugins.produces(5,2)}_renderHighlightPrepass(){if(!this._hasHighlights)return;const{fboCache:e,_rctx:i,_bindParameters:r}=this,s=this._framebufferSize,{highlights:n}=r,a=e.acquire(s.width,s.height,"highlights",n.length>Jre?3:1);a.acquireDepth(13);const o=this._plugins.produces(9,0);return o&&this._framebuffer.color.fbo&&a.fbo&&i.blitFramebuffer(this._framebuffer.color.fbo,a.fbo,1024),i.bindFramebuffer(a.fbo),i.gl.clearBufferuiv(6144,0,[0,0,0,0]),o||i.clear(1024),this._renderContext.output=9,i.bindFramebuffer(a.fbo),dIe(i,e,s,r,()=>this._renderHighlightGeometries()),a.detachDepth(),this.performanceInfo.advance(Ns.HIGHLIGHTS),a}_renderHighlightGeometries(){this._plugins.render(...HOt),this._rctx.clear(256),this._renderHUDElements(2)}_renderShadowAccumulation(e,i,r,s){this._shadowAccumulator.updateDepthRange(e),this._shadowAccumulator.accumulating&&this._bindParameters.depth&&this._shadowAccumulator.renderAccumulation(this._bindParameters.depth,i,r,s)&&this.performanceInfo.advance(Ns.ACCUMULATED_SHADOWS)}_precompileTransparentGeometry(){this._oitEnabled&&ds(this._renderContext.output)?(this._bindParameters.oitPass=1,this._plugins.precompile(...RA),this._bindParameters.oitPass=2,this._plugins.precompile(...RA),this._bindParameters.oitPass=0):this._plugins.precompile(...RA)}_renderOIT(e,i,r=2){const s=e===1,n=this._framebufferSize,a=s?this.fboCache.acquire(n.width,n.height,"oit hud composite"):null,o=s?()=>this._renderHUDElements(r):()=>this._renderTransparentGeometry(),l=this._bindParameters,c=this._renderContext.output;this._renderContext.output=i,l.oitPass=1;const h=a?"oit hud color+alpha":"oit color+alpha",f=this.fboCache.acquire(n.width,n.height,h,8),y=i===1;y&&f.acquireColor(Do,8,"oit emissive"),f.acquireColor(y?nie:Do,7),a||f.attachDepth(this._framebuffer.depth),this._rctx.bindFramebuffer(f.fbo),this._rctx.clearFramebuffer([0,0,0,1]),y&&this._rctx.clearBuffer(1,K8),o(),f.detachDepth(),l.oitPass=2;const _=this.fboCache.acquire(n.width,n.height,a?"oit hud front":"oit front");return y&&_.acquireColor(Do,8,"oit emissive front"),a?_.acquireDepth(12):_.attachDepth(this._framebuffer.depth),this._rctx.bindFramebuffer(_.fbo),this._rctx.clearFramebuffer(tn,!!a),o(),_.detachDepth(),l.oitPass=0,a?(this._rctx.bindFramebuffer(a.fbo),this._rctx.setClearColor(0,0,0,1e-13),this._rctx.clear(16384)):this._framebuffer.bind(),this._oitblend??=new rOt(this._techniques),this._oitblend.blend(this._rctx,f,_,l,y,!s),a?.detachDepth(),_.release(),f.release(),this._renderContext.output=c,a}_renderOpaque(e){const i=this.plugins.produces(0,...pH);if(i){this._plugins.render(0,1);const s=this._framebuffer;s.update(n=>this._renderNodes(ht.CUTFILL_COLOR,n)),s.update(n=>this._renderNodes(ht.OPAQUE_TERRAIN,n)),s.bind(),this._plugins.render(2,3)}const r=this._framebuffer;this._renderTerrainDepth(e),r.update(s=>this._renderNodes(es.OPAQUE,s,i)),this.fboCache.debugCallback?.(es.OPAQUE,r.color.fbo),r.update(s=>this._renderNodes(ht.OPAQUE_ENVIRONMENT,s)),this.fboCache.debugCallback?.(ht.OPAQUE_ENVIRONMENT,r.color.fbo),this._renderEdges(1)}_renderTransparent(e,i,r){const s=this._framebuffer;s.bind(),this._renderPlugins(20,Ns.VOXEL),this._renderHiddenTransparentEdges(),e&&(this._oitEnabled?this._renderOIT(0,r):this._renderTransparentGeometry()),s.update(o=>this._renderNodes(es.TRANSPARENT,o,e)),this.fboCache.debugCallback?.(es.TRANSPARENT,s.color.fbo),this._renderGeometryDepth(i),this._renderHUDVisibility(),i||this._plugins.render(15),this._renderEdges(0);const n=this._hasTransparentTerrain?this._renderTransparentTerrain():null;n&&(this.performanceInfo.advance(Ns.TRANSPARENT_TERRAIN),this._bindParameters.hudVisibility&&(i?this._renderLineCallouts(0):(this._rctx.bindFramebuffer(this._bindParameters.hudVisibility?.fbo),this._compositingHelper.compositeHUD(this._bindParameters,n.getTexture())),this._renderHUD(0,s.color,r))),this._bindParameters.cullAboveTerrain=!1,n&&(s.bind(),this._compositingHelper.compositePreMultipliedAlpha(this._bindParameters,n.getTexture(),u$(r)?1:0),n.release(),i&&(this._renderEdges(1),e&&(this._oitEnabled?this._renderOIT(0,r):this._renderTransparentGeometry(),this.performanceInfo.advance(Ns.TRANSPARENT)),this._renderEdges(0)));const a=this._hasTransparentIntegratedMesh?this._renderTransparentIntegratedMesh():null;a&&(s.bind(),this._compositingHelper.composite(this._bindParameters,a.getTexture(),u$(r)?1:0),a.release()),this._bindParameters.ssao=Sr(this._bindParameters.ssao),i&&this._renderLineCallouts(1),this._bindParameters.terrainDepthTest=!1,this._renderTransparentEnvironment()}_renderTransparentEnvironment(){this._shadowAccumulator.render(this._bindParameters),this.performanceInfo.advance(Ns.APPLY_ACCUMULATED_SHADOWS),this._framebuffer.bind(),this._plugins.render(8),this.performanceInfo.advance(Ns.TRANSPARENT_MATERIAL_WITHOUT_DEPTH)}_renderPlugins(e,i){this._plugins.produces(this._renderContext.output,e)&&(this._plugins.render(e),this.performanceInfo.advance(i))}_renderNodes(e,i,r=!1){if(i.setName(e),this._pluginInput.set(e,i),!this._nodes.produces(e))return r&&this.performanceInfo.advance(e),i;const s=this._nodes.render(i,this._pluginInput,this._releaseNormals);return this.performanceInfo.advance(e),s}blitFBO(e,i=QC,r=!0){return this._blit??=new Tse(this._techniques),this._blit.blit(this._rctx,e,i,this._bindParameters),this._pluginInput.set(e.name,i),r&&e.release(),i}_ensureBindParametersCamera(e,i){this._bindParameters.camera=e,this._bindParameters.contentCamera=i}_ensureBindParametersSSR(e){if(this._bindParameters.ssr.lastFrameColor){this._ssrEnableTime==null&&(this._ssrEnableTime=e),this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=Ro:(nl(fve,this._bindParameters.camera.viewMatrix),nl(pve,this._bindParameters.camera.projectionMatrix),an(eT,fve,pve),an(eT,this._renderContext.lastFrameCamera.viewMatrix,eT),an(eT,this._renderContext.lastFrameCamera.projectionMatrix,eT),this._reprojectionMatrix=eT);const i=this.stage.view.qualitySettings.fadeDuration;this._bindParameters.ssr.fadeFactor=i>0?Math.min(i,e-this._ssrEnableTime)/i:1,this._bindParameters.ssr.fadeFactor<1&&this._requestRender()}else this._reprojectionMatrix=Ro,this._ssrEnableTime=null}addRenderNode(e){this._nodes.add(e),this._requestRender()}removeRenderNode(e){this._nodes.remove(e),this._requestRender()}updateLighting(e,i,r,s){this._bindParameters.updateLighting(e,i,r,s),this._requestRender(1)}get usedMemory(){return{fbos:this.fboCache.usedMemory,plugins:this._plugins.usedMemory,edges:this.edgeView?.usedMemory??0}}renderToTargets(e,i,r,s,n=!1,a=!1){i.attachDepth(r),this._rctx.bindFramebuffer(i.fbo),this._rctx.clearFramebuffer(s,n,a),e(),i.detachDepth()}get test(){}};d([m({readOnly:!0})],VT.prototype,"fullResolutionAtmosphere",null),d([m()],VT.prototype,"_edgeView",void 0),d([m()],VT.prototype,"updating",null),VT=d([k("esri.views.3d.webgl-engine.lib.Renderer")],VT);const qOt=[0,1,2,4],GOt=[3,5],pH=[0,1,2,3],RA=[4,5],dve=[2,4,8],DA=[16,13,14],HOt=[4,5,2,3,6,0,1],pve=it(),fve=it(),eT=it();function WOt(t){return e=>t.immediate.schedule(e)}let ZOt=class{constructor(e){this._rctx=e,this._vao=YOt(e)}destroy(){this._vao=Rt(this._vao)}draw(){this._vao!=null&&(this._rctx.bindVAO(this._vao),this._rctx.drawArrays(lr.TRIANGLES,0,3))}get test(){}};function YOt(t){const e=new Float32Array([-1,-1,3,-1,-1,3]);return new Op(t,new Hs(t,lie,e))}let QOt=class{constructor(e,i){this._rctx=e,this._layout=i,this._cache=new R4(e.newCache,"VAOCache")}dispose(){this._cache.destroy()}newVao(e){const i=e.toString();let r=this._cache.pop(i);return r||(r=new Op(this._rctx,new Hs(this._rctx,this._layout)),r.buffer()?.setSize(e),r)}deleteVao(e){if(e==null)return;const i=e.getByteLength("geometry").toString();this._cache.put(i,e)}},eke=class tke{constructor(e){this._rctx=e,this._indexBuffer=this._createIndexbuffer(),this._program=this._createHelperProgram()}static getShaderSources(){return{vertex:`#version 300 es
    precision highp float;

    void main(void) {
      gl_Position = vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);
    }`,fragment:`#version 300 es
    precision highp float;

    out vec4 fragColor;

    void main(void) {
      fragColor = vec4(0.0, 0.0, 0.0, 1.0);
    }`}}_createHelperProgram(){const e=tke.getShaderSources();return this._rctx.programCache.acquire(e.vertex,e.fragment,new Map([]))}_createIndexbuffer(){return Uu.createIndex(this._rctx,35044,new Uint32Array([0]))}run(){this._program.compiled&&this._indexBuffer&&(this._rctx.bindVAO(null),this._rctx.useProgram(this._program),this._rctx.bindBuffer(this._indexBuffer,34963),this._rctx.drawElements(lr.POINTS,1,ar.UNSIGNED_INT,0))}dispose(){this._program.dispose(),this._indexBuffer.dispose()}get test(){}},mve=class{constructor(){this.blend=!1,this.blendColor={r:0,g:0,b:0,a:0},this.blendFunction={srcRGB:1,dstRGB:0,srcAlpha:1,dstAlpha:0},this.blendEquation={mode:32774,modeAlpha:32774},this.colorMask={r:!0,g:!0,b:!0,a:!0},this.faceCulling=!1,this.cullFace=1029,this.frontFace=2305,this.scissorTest=!1,this.scissorRect={x:0,y:0,width:0,height:0},this.depthTest=!1,this.depthFunction=513,this.clearDepth=1,this.depthWrite=!0,this.depthRange={zNear:0,zFar:1},this.viewport=null,this.stencilTest=!1,this.polygonOffsetFill=!1,this.polygonOffset=[0,0],this.stencilFunction={face:1032,func:519,ref:0,mask:1},this.clearStencil=0,this.stencilWriteMask=1,this.stencilOperation={face:1032,fail:7680,zFail:7680,zPass:7680},this.clearColor={r:0,g:0,b:0,a:0},this.program=null,this.vertexBuffer=null,this.indexBuffer=null,this.uniformBuffer=null,this.pixelPackBuffer=null,this.pixelUnpackBuffer=null,this.copyReadBuffer=null,this.copyWriteBuffer=null,this.transformFeedbackBuffer=null,this.uniformBufferBindingPoints=new Array,this.transformBufferBindingPoints=new Array,this.readFramebuffer=null,this.drawFramebuffer=null,this.drawBuffers={defaultFramebuffer:[$T],fbos:new WeakMap},this.renderbuffer=null,this.activeTexture=0,this.textureUnitMap=new Array,this.vertexArrayObject=null}},XOt=class{constructor(){for(this._current=new Array,this._allocations=null;this._current.length<Bs.COUNT;)this._current.push(0)}increment(e,i,r=1){this._current[e]+=r,this._allocations?.add(i)}decrement(e,i,r=1){this._current[e]-=r,this._allocations?.remove(i)}get current(){return this._current}get total(){return this.current.reduce((e,i,r)=>e+(r<Bs.UNCOUNTED?i:0),0)}get resourceInformation(){let e="";if(this.total>0){e+=`Live objects:
`;for(let i=0;i<Bs.COUNT;++i){const r=this._current[i];r>0&&(e+=`${P8e(Bs,i)}: ${r}
`)}}return e+=this._allocations?.resetLog(),e}},gve=class{constructor(e,i,r){const s=i.textureFilterAnisotropic;this.versionString=e.getParameter(e.VERSION),this.maxVertexTextureImageUnits=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this.maxVertexAttributes=e.getParameter(e.MAX_VERTEX_ATTRIBS);const n=r.maxAnisotropy;this.maxMaxAnisotropy=s?Math.min(e.getParameter(s.MAX_TEXTURE_MAX_ANISOTROPY),n):1,this.maxTextureImageUnits=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.maxPreferredTexturePixels=r.maxPreferredTexturePixels,this.maxRenderbufferSize=e.getParameter(e.MAX_RENDERBUFFER_SIZE),this.maxViewportDims=e.getParameter(e.MAX_VIEWPORT_DIMS),this.maxUniformBufferBindings=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS),this.maxVertexUniformBlocks=e.getParameter(e.MAX_VERTEX_UNIFORM_BLOCKS),this.maxFragmentUniformBlocks=e.getParameter(e.MAX_FRAGMENT_UNIFORM_BLOCKS),this.maxUniformBlockSize=e.getParameter(e.MAX_UNIFORM_BLOCK_SIZE),this.uniformBufferOffsetAlignment=e.getParameter(e.UNIFORM_BUFFER_OFFSET_ALIGNMENT),this.maxArrayTextureLayers=e.getParameter(e.MAX_ARRAY_TEXTURE_LAYERS),this.maxSamples=e.getParameter(e.MAX_SAMPLES),this.maxDrawBuffers=e.getParameter(e.MAX_DRAW_BUFFERS)}};const JOt=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"],KOt=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","uvec2","uvec3","uvec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","usampler1D","usampler2D","usampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"],yve=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"],ePt=["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT","textureSize","texelFetch"];var Ed=999,_ve=9999,fH=0,mH=1,vve=2,bve=3,wve=4,mk=5,tPt=6,iPt=7,rPt=8,xve=9,sPt=10,Sve=11,nPt=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function aPt(){var t,e,i,r=0,s=0,n=Ed,a=[],o=[],l=1,c=0,h=0,f=!1,y=!1,_="";return function(B){return o=[],B!==null?x(B.replace?B.replace(/\r\n/g,`
`):B):S()};function w(B){B.length&&o.push({type:nPt[n],data:B,position:h,line:l,column:c})}function x(B){var Y;for(r=0,i=(_+=B).length;t=_[r],r<i;){switch(Y=r,n){case fH:r=O();break;case mH:r=P();break;case vve:r=M();break;case bve:r=D();break;case wve:r=U();break;case Sve:r=F();break;case mk:r=N();break;case _ve:r=j();break;case xve:r=A();break;case Ed:r=$()}Y!==r&&(_[Y]===`
`?(c=0,++l):++c)}return s+=r,_=_.slice(r),o}function S(B){return a.length&&w(a.join("")),n=sPt,w("(eof)"),o}function $(){return a=a.length?[]:a,e==="/"&&t==="*"?(h=s+r-1,n=fH,e=t,r+1):e==="/"&&t==="/"?(h=s+r-1,n=mH,e=t,r+1):t==="#"?(n=vve,h=s+r,r):/\s/.test(t)?(n=xve,h=s+r,r):(f=/\d/.test(t),y=/[^\w_]/.test(t),h=s+r,n=f?wve:y?bve:_ve,r)}function A(){return/[^\s]/g.test(t)?(w(a.join("")),n=Ed,r):(a.push(t),e=t,r+1)}function M(){return t!=="\r"&&t!==`
`||e==="\\"?(a.push(t),e=t,r+1):(w(a.join("")),n=Ed,r)}function P(){return M()}function O(){return t==="/"&&e==="*"?(a.push(t),w(a.join("")),n=Ed,r+1):(a.push(t),e=t,r+1)}function D(){if(e==="."&&/\d/.test(t))return n=mk,r;if(e==="/"&&t==="*")return n=fH,r;if(e==="/"&&t==="/")return n=mH,r;if(t==="."&&a.length){for(;L(a););return n=mk,r}if(t===";"||t===")"||t==="("){if(a.length)for(;L(a););return w(t),n=Ed,r+1}var B=a.length===2&&t!=="=";if(/[\w_\d\s]/.test(t)||B){for(;L(a););return n=Ed,r}return a.push(t),e=t,r+1}function L(B){for(var Y,G,Z=0;;){if(Y=yve.indexOf(B.slice(0,B.length+Z).join("")),G=yve[Y],Y===-1){if(Z--+B.length>0)continue;G=B.slice(0,1).join("")}return w(G),h+=G.length,(a=a.slice(G.length)).length}}function F(){return/[^a-fA-F0-9]/.test(t)?(w(a.join("")),n=Ed,r):(a.push(t),e=t,r+1)}function U(){return t==="."||/[eE]/.test(t)?(a.push(t),n=mk,e=t,r+1):t==="x"&&a.length===1&&a[0]==="0"?(n=Sve,a.push(t),e=t,r+1):/[^\d]/.test(t)?(w(a.join("")),n=Ed,r):(a.push(t),e=t,r+1)}function N(){return t==="f"&&(a.push(t),e=t,r+=1),/[eE]/.test(t)||t==="-"&&/[eE]/.test(e)?(a.push(t),e=t,r+1):/[^\d]/.test(t)?(w(a.join("")),n=Ed,r):(a.push(t),e=t,r+1)}function j(){if(/[^\d\w_]/.test(t)){var B=a.join("");return n=KOt.indexOf(B)>-1?rPt:ePt.indexOf(B)>-1?iPt:tPt,w(a.join("")),n=Ed,r}return a.push(t),e=t,r+1}}function oPt(t){var e=aPt(),i=[];return i=(i=i.concat(e(t))).concat(e(null))}function lPt(t){return oPt(t)}function cPt(t){return t.map(e=>e.type!=="eof"?e.data:"").join("")}const gH=new Set(["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"]);function uPt(t,e="100",i="300 es"){const r=/^\s*#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const s of t)if(s.type==="preprocessor"){const n=r.exec(s.data);if(n){const a=n[1].replaceAll(/\s{2,}/g," ");if(a===i)return a;if(a===e)return s.data="#version "+i,e;throw new Error("unknown glsl version: "+a)}}return t.splice(0,0,{type:"preprocessor",data:"#version "+i},{type:"whitespace",data:`
`}),null}function hPt(t,e){for(let i=e-1;i>=0;i--){const r=t[i];if(r.type!=="whitespace"&&r.type!=="block-comment"){if(r.type!=="keyword")break;if(r.data==="attribute"||r.data==="in")return!0}}return!1}function cP(t,e,i,r){r=r||i;for(const s of t)if(s.type==="ident"&&s.data===i)return r in e?e[r]++:e[r]=0,cP(t,e,r+"_"+e[r],r);return i}function ike(t,e,i="afterVersion"){function r(l,c){for(let h=c;h<l.length;h++){const f=l[h];if(f.type==="operator"&&f.data===";")return h}return null}function s(l){let c=-1,h=0,f=-1;for(let y=0;y<l.length;y++){const _=l[y];if(_.type==="preprocessor"&&(/#(if|ifdef|ifndef)\s+.+/.test(_.data)?++h:/#endif\s*.*/.test(_.data)&&--h),i!=="afterVersion"&&i!=="afterPrecision"||_.type==="preprocessor"&&_.data.startsWith("#version")&&(f=Math.max(f,y)),i==="afterPrecision"&&_.type==="keyword"&&_.data==="precision"){const w=r(l,y);if(w===null)throw new Error("precision statement not followed by any semicolons!");f=Math.max(f,w)}c<f&&h===0&&(c=y)}return c+1}const n={data:`
`,type:"whitespace"},a=l=>l<t.length&&/[^\r\n]$/.test(t[l].data);let o=s(t);a(o-1)&&t.splice(o++,0,n);for(const l of e)t.splice(o++,0,l);a(o-1)&&a(o)&&t.splice(o,0,n)}function dPt(t,e,i,r="lowp"){ike(t,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function pPt(t,e,i,r,s="lowp"){ike(t,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:r.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:s},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function fPt(t,e){let i,r,s=-1;for(let n=e;n<t.length;n++){const a=t[n];if(a.type==="operator"&&(a.data==="["&&(i=n),a.data==="]")){r=n;break}a.type==="integer"&&(s=parseInt(a.data,10))}return i&&r&&t.splice(i,r-i+1),s}function Tve(t,e){if(t.startsWith("#version 300"))return t;const i=lPt(t);if(uPt(i,"100","300 es")==="300 es")return t;let r=null,s=null;const n={},a={};for(let o=0;o<i.length;++o){const l=i[o];switch(l.type){case"keyword":e===35633&&l.data==="attribute"?l.data="in":l.data==="varying"&&(l.data=e===35633?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(l.data.trim())&&(l.data=l.data.replaceAll(/(2D|Cube|EXT)/g,"")),e===35632&&l.data==="gl_FragColor"&&(r||(r=cP(i,n,"fragColor"),dPt(i,r,"vec4")),l.data=r),e===35632&&l.data==="gl_FragData"){const c=fPt(i,o+1),h=cP(i,n,"fragData");pPt(i,h,"vec4",c,"mediump"),l.data=h}else e===35632&&l.data==="gl_FragDepthEXT"&&(s||(s=cP(i,n,"gl_FragDepth")),l.data=s);break;case"ident":if(JOt.includes(l.data)){if(e===35633&&hPt(i,o))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");l.data in a||(a[l.data]=cP(i,n,l.data)),l.data=a[l.data]}}}for(let o=i.length-1;o>=0;--o){const l=i[o];if(l.type==="preprocessor"){const c=l.data.match(/#extension\s+(.*):/);if(c?.[1]&&gH.has(c[1].trim())){const y=i[o+1];i.splice(o,y&&y.type==="whitespace"?2:1)}const h=l.data.match(/#ifdef\s+(.*)/);h?.[1]&&gH.has(h[1].trim())&&(l.data="#if 1");const f=l.data.match(/#ifndef\s+(.*)/);f?.[1]&&gH.has(f[1].trim())&&(l.data="#if 0")}}return mPt(t,cPt(i))}function mPt(t,e){return e}const gPt=4294967295,yPt=!!ie("esri-tests-disable-gpu-memory-measurements");let _Pt=class{constructor(e,i,r,s,n=new Map,a=[]){this._context=e,this._refCount=1,this._compiled=!1,this._linesOfCode=0,this._nameToUniformLocation=new Map,this._nameToUniform1=new Map,this._nameToUniform1v=new Map,this._nameToUniform2=new Map,this._nameToUniform3=new Map,this._nameToUniform4=new Map,this._nameToUniformMatrix3=new Map,this._nameToUniformMatrix4=new Map,e||console.error("RenderingContext isn't initialized!"),i.length===0&&console.error("Shaders source should not be empty!"),i=Tve(i,35633),r=Tve(r,35632),this._vShader=$ve(this._context,35633,i),this._fShader=$ve(this._context,35632,r),this._vShader&&this._fShader||console.error("Error loading shaders!"),e.instanceCounter.increment(Bs.Shader,this),CQ()&&(this.vertexShader=i,this.fragmentShader=r),this.usedMemory=yPt?0:i.length+r.length;const o=this._context.gl,l=o.createProgram();o.attachShader(l,this._vShader),o.attachShader(l,this._fShader),s.forEach((c,h)=>o.bindAttribLocation(l,c,h)),this.hasTransformFeedbackVaryings=!!a?.length,this.hasTransformFeedbackVaryings&&o.transformFeedbackVaryings(l,a,o.SEPARATE_ATTRIBS),o.linkProgram(l),CQ()&&!o.getProgramParameter(l,o.LINK_STATUS)&&console.error(`Could not link shader
validated: ${o.getProgramParameter(l,o.VALIDATE_STATUS)}, gl error ${o.getError()}, vertex: ${o.getShaderParameter(this._vShader,o.COMPILE_STATUS)}, fragment: ${o.getShaderParameter(this._fShader,o.COMPILE_STATUS)}, info log: ${o.getProgramInfoLog(l)}, vertex source: ${this.vertexShader}, fragment source: ${this.fragmentShader}`);for(const[c,h]of n){const f=o.getUniformBlockIndex(l,c);f<gPt&&o.uniformBlockBinding(l,f,h)}this._glName=l,e.instanceCounter.increment(Bs.Program,this)}get glName(){return this._glName}get hasGLName(){return this._glName!=null}get compiled(){return!!this._compiled||(this._context.capabilities.parallelShaderCompile&&this.glName!=null?(this._compiled=!!this._context.gl.getProgramParameter(this.glName,37297),this._compiled):(this._compiled=!0,!0))}dispose(){if(--this._refCount>0)return;const e=this._context.gl,i=this._context.instanceCounter;this._nameToUniformLocation.forEach(r=>r&&i.decrement(Bs.Uniform,r)),this._nameToUniformLocation.clear(),this._vShader&&(this._linesOfCode>0&&(i.decrement(Bs.LinesOfCode,this._vShader,this._linesOfCode),this._linesOfCode=0),e.deleteShader(this._vShader),this._vShader=null,i.decrement(Bs.Shader,this)),this._fShader&&(e.deleteShader(this._fShader),this._fShader=null),this._glName&&(e.deleteProgram(this._glName),this._glName=null,i.decrement(Bs.Program,this))}ref(){++this._refCount}_getUniformLocation(e){const i=this._nameToUniformLocation.get(e);if(i!==void 0)return i;if(this.glName){const r=this._context.gl.getUniformLocation(this.glName,e);return this._nameToUniformLocation.set(e,r),r&&this._context.instanceCounter.increment(Bs.Uniform,r),r}return null}hasUniform(e){return this._getUniformLocation(e)!=null}setUniform1i(e,i,r){IA(r,i);const s=this._nameToUniform1.get(e);s!==void 0&&i===s||(this._context.gl.uniform1i(this._getUniformLocation(e),i),this._nameToUniform1.set(e,i))}setUniform1iv(e,i,r){vh(r,i),Kp(this._nameToUniform1v,e,i)&&this._context.gl.uniform1iv(this._getUniformLocation(e),i)}setUniform2iv(e,i,r){vh(r,i),Kp(this._nameToUniform2,e,i)&&this._context.gl.uniform2iv(this._getUniformLocation(e),i)}setUniform3iv(e,i,r){vh(r,i),Kp(this._nameToUniform3,e,i)&&this._context.gl.uniform3iv(this._getUniformLocation(e),i)}setUniform4iv(e,i,r){vh(r,i),Kp(this._nameToUniform4,e,i)&&this._context.gl.uniform4iv(this._getUniformLocation(e),i)}setUniform1f(e,i,r){IA(r,i);const s=this._nameToUniform1.get(e);s!==void 0&&i===s||(this._context.gl.uniform1f(this._getUniformLocation(e),i),this._nameToUniform1.set(e,i))}setUniform1fv(e,i,r){vh(r,i),Kp(this._nameToUniform1v,e,i)&&this._context.gl.uniform1fv(this._getUniformLocation(e),i)}setUniform2f(e,i,r,s){IA(s,i,r);const n=this._nameToUniform2.get(e);n===void 0?(this._context.gl.uniform2f(this._getUniformLocation(e),i,r),this._nameToUniform2.set(e,[i,r])):i===n[0]&&r===n[1]||(this._context.gl.uniform2f(this._getUniformLocation(e),i,r),n[0]=i,n[1]=r)}setUniform2fv(e,i,r){vh(r,i),Kp(this._nameToUniform2,e,i)&&this._context.gl.uniform2fv(this._getUniformLocation(e),i)}setUniform3f(e,i,r,s,n){IA(n,i,r,s);const a=this._nameToUniform3.get(e);a===void 0?(this._context.gl.uniform3f(this._getUniformLocation(e),i,r,s),this._nameToUniform3.set(e,[i,r,s])):i===a[0]&&r===a[1]&&s===a[2]||(this._context.gl.uniform3f(this._getUniformLocation(e),i,r,s),a[0]=i,a[1]=r,a[2]=s)}setUniform3fv(e,i,r){vh(r,i);const s=this._getUniformLocation(e);s!=null&&Kp(this._nameToUniform3,e,i)&&this._context.gl.uniform3fv(s,i)}setUniform4f(e,i,r,s,n,a){IA(a,i,r,s,n);const o=this._nameToUniform4.get(e);o===void 0?(this._context.gl.uniform4f(this._getUniformLocation(e),i,r,s,n),this._nameToUniform4.set(e,[i,r,s,n])):o!==void 0&&i===o[0]&&r===o[1]&&s===o[2]&&n===o[3]||(this._context.gl.uniform4f(this._getUniformLocation(e),i,r,s,n),o[0]=i,o[1]=r,o[2]=s,o[3]=n)}setUniform4fv(e,i,r){vh(r,i);const s=this._getUniformLocation(e);s!=null&&Kp(this._nameToUniform4,e,i)&&this._context.gl.uniform4fv(s,i)}setUniformMatrix3fv(e,i,r=!1,s){vh(s,i);const n=this._getUniformLocation(e);n!=null&&Kp(this._nameToUniformMatrix3,e,i)&&this._context.gl.uniformMatrix3fv(n,r,i)}setUniformMatrix4fv(e,i,r=!1,s){vh(s,i);const n=this._getUniformLocation(e);if(n!=null){const a=this._nameToUniformMatrix4,o=a.get(e);let l=!1;if(o){const c=i.length;if(o.length!==c)a.set(e,Array.from(i)),l=!0;else for(let h=0;h<c;++h){const f=i[h];if(o[h]!==f){for(o[h]=f;h<c;++h)o[h]=i[h];l=!0;break}}}else a.set(e,Array.from(i)),l=!0;l&&this._context.gl.uniformMatrix4fv(n,r,i)}}setUniformMatrices4fv(e,i,r=!1,s){vh(s,i);const n=this._getUniformLocation(e);n!=null&&Kp(this._nameToUniformMatrix4,e,i)&&this._context.gl.uniformMatrix4fv(n,r,i)}stop(){}};function $ve(t,e,i){const r=t.gl,s=r.createShader(e);return r.shaderSource(s,i),r.compileShader(s),CQ()&&!r.getShaderParameter(s,r.COMPILE_STATUS)&&(console.error("Compile error in ".concat(e===35633?"vertex":"fragment"," shader")),console.error(r.getShaderInfoLog(s)),console.error(vPt(i))),s}function vPt(t){let e=2;return t.replaceAll(`
`,()=>`
`+bPt(e++)+":")}function bPt(t){return t>=1e3?t.toString():("  "+t).slice(-3)}function Kp(t,e,i){const r=t.get(e);if(!r)return t.set(e,Array.from(i)),!0;const s=i.length;if(r.length!==s)return t.set(e,Array.from(i)),!0;for(let n=0;n<s;++n){const a=i[n];if(r[n]!==a){for(r[n]=a;n<s;++n)r[n]=i[n];return!0}}return!1}const IA=Ko()?(t,...e)=>vh(t,e):()=>{},vh=Ko()?(t,e)=>{if(t?.supportsNaN)return;const i=e.length;for(let r=0;r<i;++r){const s=e[r];Number.isNaN(s)&&console.error(`Got ${s} as uniform value from ${new Error().stack}`)}}:()=>{};let wPt=class{constructor(e){this._rctx=e,this._store=new Map}dispose(){this._store.forEach(e=>e.dispose()),this._store.clear()}acquire(e,i,r,s){const n=e+i+JSON.stringify(Array.from(r.entries())),a=this._store.get(n);if(a!=null)return a.ref(),a;const o=new _Pt(this._rctx,e,i,r,s);return o.ref(),this._store.set(n,o),o}get test(){}},zse=class{constructor(){this._result=!1}dispose(){this._program=Rt(this._program)}get result(){return this._program!=null&&(this._result=this._test(this._program),this.dispose()),this._result}},xPt=class extends zse{constructor(e){super(),this._rctx=e,this._helperProgram=null,ie("mac")&&ie("chrome")&&(this._program=this._prepareProgram(),this._helperProgram=this._prepareHelperProgram())}dispose(){super.dispose(),this._helperProgram?.dispose(),this._helperProgram=null}_test(e){const i=this._rctx,r=i.getBoundFramebufferObject(),{x:s,y:n,width:a,height:o}=i.getViewport();i.resetState();const l=new Zi(1);l.wrapMode=33071,l.samplingMode=9728;const c=new Xv(i,l),h=Uu.createIndex(this._rctx,35044,new Uint8Array([0]));i.bindFramebuffer(c),i.setViewport(0,0,1,1),i.useProgram(this._helperProgram),i.bindBuffer(h,34963),i.drawElements(lr.POINTS,1,ar.UNSIGNED_BYTE,0),i.useProgram(e),i.bindVAO(null),i.drawArrays(lr.TRIANGLES,0,258);const f=new Uint8Array(4);return c.readPixels(0,0,1,1,6408,bs.UNSIGNED_BYTE,f),i.setViewport(s,n,a,o),i.bindFramebuffer(r),c.dispose(),h.dispose(),f[0]===255}_prepareProgram(){const i=`#version 300 es
    precision highp float;

    out float triangleId;

    const vec3 triangleVertices[3] = vec3[3](vec3(-0.5, -0.5, 0.0), vec3(0.5, -0.5, 0.0), vec3(0.0, 0.5, 0.0));

    void main(void) {
      triangleId = floor(float(gl_VertexID)/3.0);

      vec3 position = triangleVertices[gl_VertexID % 3];
      float offset = triangleId / ${E.float(85)};
      position.z = 0.5 - offset;

      gl_Position = vec4(position, 1.0);
    }
    `,r=`#version 300 es
    precision highp float;

    in float triangleId;

    out vec4 fragColor;

    void main(void) {
      fragColor = triangleId == ${E.float(85)} ? vec4(0.0, 1.0, 0.0, 1.0) : vec4(1.0, 0.0, 0.0, 1.0);
    }
    `;return this._rctx.programCache.acquire(i,r,new Map([]))}_prepareHelperProgram(){const e=eke.getShaderSources();return this._rctx.programCache.acquire(e.vertex,e.fragment,new Map([]))}};const Fse=[new Ov("position",2,ar.UNSIGNED_SHORT,0,4)],rke=ed(Fse);let SPt=class extends zse{constructor(e){if(super(),this._rctx=e,!e.gl||!(e.capabilities.colorBufferFloat?.textureFloat&&e.capabilities.colorBufferFloat?.floatBlend))return;const i=`
    precision highp float;
    attribute vec2 position;

    void main() {
      gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);
    }
    `,r=`
     precision highp float;

     void main() {
      gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);
     }
    `;this._program=e.programCache.acquire(i,r,rke)}_test(e){const i=this._rctx,r=new Zi(1);r.wrapMode=33071,r.dataType=bs.FLOAT,r.internalFormat=tt.RGBA32F,r.samplingMode=9728;const s=new Xv(i,r),n=new Hs(i,Fse,new Uint16Array([0,0,1,0,0,1,1,1])),a=new by(i,n);i.gl.getError(),i.useProgram(e);const o=i.getBoundFramebufferObject(),{x:l,y:c,width:h,height:f}=i.getViewport();i.bindFramebuffer(s),i.setViewport(0,0,1,1),i.bindVAO(a),i.drawArrays(lr.TRIANGLE_STRIP,0,4);const y=li({blending:Dlt});i.setPipelineState(y),i.drawArrays(lr.TRIANGLE_STRIP,0,4);const _=i.gl.getError();return i.setViewport(l,c,h,f),i.bindFramebuffer(o),a.dispose(),s.dispose(),_!==i.gl.INVALID_OPERATION||(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1)}},TPt=class extends zse{constructor(e){super(),this._rctx=e;const i=`
    precision highp float;

    attribute vec2 position;
    varying vec2 v_uv;

    void main() {
      v_uv = position;
      gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);
    }
    `,r=`
    precision highp float;

    varying vec2 v_uv;

    uniform sampler2D u_texture;

    void main() {
      gl_FragColor = texture2D(u_texture, v_uv);
    }
    `;this._program=e.programCache.acquire(i,r,rke)}dispose(){super.dispose()}_test(e){const i=this._rctx;if(!i.gl)return e.dispose(),!0;const r=new Zi(1);r.wrapMode=33071,r.samplingMode=9728;const s=new Xv(i,r),n=new Hs(i,Fse,new Uint16Array([0,0,1,0,0,1,1,1])),a=new by(i,n),o=new Zi;o.samplingMode=9729,o.wrapMode=33071;const l=new Fi(i,o,uP);i.useProgram(e),i.bindTexture(l,0),e.setUniform1i("u_texture",0);const c=i.getBoundFramebufferObject(),{x:h,y:f,width:y,height:_}=i.getViewport();i.bindFramebuffer(s),i.setViewport(0,0,1,1),i.setClearColor(0,0,0,0),i.setBlendingEnabled(!1),i.clear(16384),i.bindVAO(a),i.drawArrays(lr.TRIANGLE_STRIP,0,4);const w=new Uint8Array(4);return s.readPixels(0,0,1,1,6408,bs.UNSIGNED_BYTE,w),a.dispose(),s.dispose(),l.dispose(),i.setViewport(h,f,y,_),i.bindFramebuffer(c),w[0]!==255}};const uP=new Image;uP.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",uP.width=5,uP.height=5,uP.decode();let $Pt=class{constructor(e){this.rctx=e,this.floatBufferBlend=new SPt(e),this.svgPremultipliesAlpha=new TPt(e),this.drawArraysRequiresIndicesTypeReset=new xPt(e)}dispose(){this.svgPremultipliesAlpha.dispose(),this.floatBufferBlend.dispose(),this.drawArraysRequiresIndicesTypeReset.dispose()}},CPt=class{constructor(e){this.getUnmaskedRenderer=e}};function ske(t){const e=t.getExtension("WEBGL_debug_renderer_info");return e?new CPt(()=>t.getParameter(e.UNMASKED_RENDERER_WEBGL)):null}function MPt(t,e){if(e.compressedTextureETC)return null;const i=t.getExtension("WEBGL_compressed_texture_etc");return i?{COMPRESSED_R11_EAC:i.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:i.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:i.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:i.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:i.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:i.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}function EPt(t,e){if(e.compressedTextureS3TC)return null;const i=t.getExtension("WEBGL_compressed_texture_s3tc");return i?{COMPRESSED_RGB_S3TC_DXT1:i.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:i.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:i.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:i.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}function APt(t,e){if(e.textureFilterAnisotropic)return null;const i=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return i?{MAX_TEXTURE_MAX_ANISOTROPY:i.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:i.TEXTURE_MAX_ANISOTROPY_EXT}:null}function OPt(t,e){const i=!e.colorBufferHalfFloat&&t.getExtension("EXT_color_buffer_half_float")||!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),r=!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),s=!e.floatBlend&&!e.colorBufferFloat&&t.getExtension("EXT_float_blend");return i||r||s?{textureFloat:!!r,textureHalfFloat:!!i,floatBlend:!!s,R16F:t.R16F,RG16F:t.RG16F,RGBA16F:t.RGBA16F,R32F:t.R32F,RG32F:t.RG32F,RGBA32F:t.RGBA32F,R11F_G11F_B10F:t.R11F_G11F_B10F,RGB16F:t.RGB16F}:null}function Cve(t,e,i,r,s){if(e[i])return!1;for(const n of s)if(t.getExtension(n))return!0;return!1}function PPt(t,e){if(e.textureNorm16)return null;const i=t.getExtension("EXT_texture_norm16");return i?{R16:i.R16_EXT,RG16:i.RG16_EXT,RGB16:i.RGB16_EXT,RGBA16:i.RGBA16_EXT,R16_SNORM:i.R16_SNORM_EXT,RG16_SNORM:i.RG16_SNORM_EXT,RGB16_SNORM:i.RGB16_SNORM_EXT,RGBA16_SNORM:i.RGBA16_SNORM_EXT}:null}function RPt(t,e){const i=e.loseContext&&t.getExtension("WEBGL_lose_context");return i?{loseRenderingContext:()=>i.loseContext()}:null}let DPt=class{constructor(e,i){this._gl=e,this._compressedTextureETC=null,this._compressedTextureS3TC=null,this._textureFilterAnisotropic=null,this._colorBufferFloat=null,this._loseContext=null,this._textureNorm16=null,this._textureFloatLinear=null,this._parallelShaderCompile=null,this._rendererInfo=null,this._disabledExtensions=i.disabledExtensions,this._debugWebGLExtensions=i.debugWebGLExtensions}get compressedTextureETC(){return this._compressedTextureETC??=MPt(this._gl,this._disabledExtensions),this._compressedTextureETC}get compressedTextureS3TC(){return this._compressedTextureS3TC??=EPt(this._gl,this._disabledExtensions),this._compressedTextureS3TC}get textureFilterAnisotropic(){return this._textureFilterAnisotropic??=APt(this._gl,this._disabledExtensions),this._textureFilterAnisotropic}get disjointTimerQuery(){return this._disjointTimerQuery??=VOt(this._gl,this._disabledExtensions),this._disjointTimerQuery}get colorBufferFloat(){return this._colorBufferFloat??=OPt(this._gl,this._disabledExtensions),this._colorBufferFloat}get textureNorm16(){return this._textureNorm16??=PPt(this._gl,this._disabledExtensions),this._textureNorm16}get textureFloatLinear(){return this._textureFloatLinear??=Cve(this._gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"]),this._textureFloatLinear}get parallelShaderCompile(){return this._parallelShaderCompile??=Cve(this._gl,this._disabledExtensions,"parallelShaderCompile",!1,["KHR_parallel_shader_compile"]),this._parallelShaderCompile}get loseContext(){return this._loseContext??=RPt(this._gl,this._debugWebGLExtensions),this._loseContext}get rendererInfo(){return this._rendererInfo??=ske(this._gl),this._rendererInfo}enable(e){return this[e]}},IPt=class{constructor(e,i){this.gl=e,this.instanceCounter=new XOt,this._programCache=new wPt(this),this._transformFeedbackRequestInfo=null,this._state=new mve,this._numOfDrawCalls=0,this._numOfTriangles=0,this._options=i,this.configure(i)}configure(e){this._options=e,this._capabilities=new DPt(this.gl,e),this._parameters=new gve(this.gl,this._capabilities,e),Fi.TEXTURE_UNIT_FOR_UPDATES=this._parameters.maxTextureImageUnits-1;const i=this.gl.getParameter(this.gl.VIEWPORT);this._state=new mve,this._state.viewport={x:i[0],y:i[1],width:i[2],height:i[3]},this._stateTracker=new rct({setBlending:r=>{if(r){this.setBlendingEnabled(!0),this.setBlendEquationSeparate(r.opRgb,r.opAlpha),this.setBlendFunctionSeparate(r.srcRgb,r.dstRgb,r.srcAlpha,r.dstAlpha);const s=r.color;this.setBlendColor(s.r,s.g,s.b,s.a)}else this.setBlendingEnabled(!1)},setCulling:r=>{r?(this.setFaceCullingEnabled(!0),this.setCullFace(r.face),this.setFrontFace(r.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:r=>{r?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(r.factor,r.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:r=>{r?(this.setDepthTestEnabled(!0),this.setDepthFunction(r.func)):this.setDepthTestEnabled(!1)},setStencilTest:r=>{if(r){this.setStencilTestEnabled(!0);const s=r.function;this.setStencilFunction(s.func,s.ref,s.mask);const n=r.operation;this.setStencilOp(n.fail,n.zFail,n.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:r=>{r?(this.setDepthWriteEnabled(!0),this.setDepthRange(r.zNear,r.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:r=>{r?this.setColorMask(r.r,r.g,r.b,r.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:r=>{r?this.setStencilWriteMask(r.mask):this.setStencilWriteMask(0)},setDrawBuffers:r=>{if(r)this.setDrawBuffers(r.buffers);else{const{drawFramebuffer:s}=this._state;s===null?this.setDrawBuffers([$T]):s.colorAttachments.length===0?this.setDrawBuffers([M6]):this.setDrawBuffers([Dr])}}}),this.enforceState(),Rt(this._driverTest),this._driverTest=new $Pt(this)}updateOptions(e){this._options={...this._options,...e},this._parameters=new gve(this.gl,this._capabilities,this._options)}dispose(){this._driverTest=Rt(this._driverTest),this._programCache=Rt(this._programCache),this.bindVAO(null),this.unbindBuffer(34962),this.unbindBuffer(34963),this.unbindBuffer(35345),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(35051),this.unbindBuffer(35052),this.unbindBuffer(36662),this.unbindBuffer(36663),this._state.textureUnitMap.length=0,this._state=null,this._capabilities=null,this._stateTracker=null,Ko()&&console.log(this.instanceCounter.resourceInformation)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}get programCache(){return this._programCache}setPipelineState(e){this._stateTracker.setPipeline(e)}setBlendingEnabled(e){this._state.blend!==e&&(e===!0?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=e,this._stateTracker.invalidateBlending())}externalProgramUpdate(){this._state.program?.stop(),this._state.program=null}externalTextureUnitUpdate(e,i){for(let r=0;r<e.length;++r)this._state.textureUnitMap[e[r]]=null;i>=0&&(this._state.activeTexture=i)}externalVertexArrayObjectUpdate(){this.gl.bindVertexArray(null),this._state.vertexArrayObject=null,this._state.vertexBuffer=null,this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(e,i,r,s){e===this._state.blendColor.r&&i===this._state.blendColor.g&&r===this._state.blendColor.b&&s===this._state.blendColor.a||(this.gl.blendColor(e,i,r,s),this._state.blendColor.r=e,this._state.blendColor.g=i,this._state.blendColor.b=r,this._state.blendColor.a=s,this._stateTracker.invalidateBlending())}setBlendFunction(e,i){e===this._state.blendFunction.srcRGB&&i===this._state.blendFunction.dstRGB||(this.gl.blendFunc(e,i),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=e,this._state.blendFunction.dstRGB=i,this._state.blendFunction.dstAlpha=i,this._stateTracker.invalidateBlending())}setBlendFunctionSeparate(e,i,r,s){this._state.blendFunction.srcRGB===e&&this._state.blendFunction.srcAlpha===r&&this._state.blendFunction.dstRGB===i&&this._state.blendFunction.dstAlpha===s||(this.gl.blendFuncSeparate(e,i,r,s),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=r,this._state.blendFunction.dstRGB=i,this._state.blendFunction.dstAlpha=s,this._stateTracker.invalidateBlending())}setBlendEquation(e){this._state.blendEquation.mode!==e&&(this.gl.blendEquation(e),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=e,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(e,i){this._state.blendEquation.mode===e&&this._state.blendEquation.modeAlpha===i||(this.gl.blendEquationSeparate(e,i),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=i,this._stateTracker.invalidateBlending())}setColorMask(e,i,r,s){this._state.colorMask.r===e&&this._state.colorMask.g===i&&this._state.colorMask.b===r&&this._state.colorMask.a===s||(this.gl.colorMask(e,i,r,s),this._state.colorMask.r=e,this._state.colorMask.g=i,this._state.colorMask.b=r,this._state.colorMask.a=s,this._stateTracker.invalidateColorWrite())}setClearColor(e,i,r,s){this._state.clearColor.r===e&&this._state.clearColor.g===i&&this._state.clearColor.b===r&&this._state.clearColor.a===s||(this.gl.clearColor(e,i,r,s),this._state.clearColor.r=e,this._state.clearColor.g=i,this._state.clearColor.b=r,this._state.clearColor.a=s)}setFaceCullingEnabled(e){this._state.faceCulling!==e&&(e===!0?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=e,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(e){this._state.polygonOffsetFill!==e&&(e===!0?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=e,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(e,i){this._state.polygonOffset[0]===e&&this._state.polygonOffset[1]===i||(this._state.polygonOffset[0]=e,this._state.polygonOffset[1]=i,this.gl.polygonOffset(e,i),this._stateTracker.invalidatePolygonOffset())}setCullFace(e){this._state.cullFace!==e&&(this.gl.cullFace(e),this._state.cullFace=e,this._stateTracker.invalidateCulling())}setFrontFace(e){this._state.frontFace!==e&&(this.gl.frontFace(e),this._state.frontFace=e,this._stateTracker.invalidateCulling())}setScissorTestEnabled(e){this._state.scissorTest!==e&&(e===!0?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=e)}setScissorRect(e,i,r,s){this._state.scissorRect.x===e&&this._state.scissorRect.y===i&&this._state.scissorRect.width===r&&this._state.scissorRect.height===s||(this.gl.scissor(e,i,r,s),this._state.scissorRect.x=e,this._state.scissorRect.y=i,this._state.scissorRect.width=r,this._state.scissorRect.height=s)}setDepthTestEnabled(e){this._state.depthTest!==e&&(e===!0?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=e,this._stateTracker.invalidateDepthTest())}setClearDepth(e){this._state.clearDepth!==e&&(this.gl.clearDepth(e),this._state.clearDepth=e)}setDepthFunction(e){this._state.depthFunction!==e&&(this.gl.depthFunc(e),this._state.depthFunction=e,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(e){this._state.depthWrite!==e&&(this.gl.depthMask(e),this._state.depthWrite=e,this._stateTracker.invalidateDepthWrite())}setDepthRange(e,i){this._state.depthRange.zNear===e&&this._state.depthRange.zFar===i||(this.gl.depthRange(e,i),this._state.depthRange.zNear=e,this._state.depthRange.zFar=i,this._stateTracker.invalidateDepthWrite())}setStencilTestEnabled(e){this._state.stencilTest!==e&&(e===!0?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=e,this._stateTracker.invalidateStencilTest())}setClearStencil(e){e!==this._state.clearStencil&&(this.gl.clearStencil(e),this._state.clearStencil=e)}setStencilFunction(e,i,r){this._state.stencilFunction.func===e&&this._state.stencilFunction.ref===i&&this._state.stencilFunction.mask===r||(this.gl.stencilFunc(e,i,r),this._state.stencilFunction.face=1032,this._state.stencilFunction.func=e,this._state.stencilFunction.ref=i,this._state.stencilFunction.mask=r,this._stateTracker.invalidateStencilTest())}setStencilFunctionSeparate(e,i,r,s){this._state.stencilFunction.face===e&&this._state.stencilFunction.func===i&&this._state.stencilFunction.ref===r&&this._state.stencilFunction.mask===s||(this.gl.stencilFuncSeparate(e,i,r,s),this._state.stencilFunction.face=e,this._state.stencilFunction.func=i,this._state.stencilFunction.ref=r,this._state.stencilFunction.mask=s,this._stateTracker.invalidateStencilTest())}setStencilWriteMask(e){this._state.stencilWriteMask!==e&&(this.gl.stencilMask(e),this._state.stencilWriteMask=e,this._stateTracker.invalidateStencilWrite())}setStencilOp(e,i,r){this._state.stencilOperation.face===1032&&this._state.stencilOperation.fail===e&&this._state.stencilOperation.zFail===i&&this._state.stencilOperation.zPass===r||(this.gl.stencilOp(e,i,r),this._state.stencilOperation.face=1032,this._state.stencilOperation.fail=e,this._state.stencilOperation.zFail=i,this._state.stencilOperation.zPass=r,this._stateTracker.invalidateStencilTest())}setStencilOpSeparate(e,i,r,s){this._state.stencilOperation.face===e&&this._state.stencilOperation.fail===i&&this._state.stencilOperation.zFail===r&&this._state.stencilOperation.zPass===s||(this.gl.stencilOpSeparate(e,i,r,s),this._state.stencilOperation.face=e,this._state.stencilOperation.fail=i,this._state.stencilOperation.zFail=r,this._state.stencilOperation.zPass=s,this._stateTracker.invalidateStencilTest())}setActiveTexture(e,i=!1){const r=this._state.activeTexture;return e>=0&&(i||e!==this._state.activeTexture)&&(this.gl.activeTexture(Q7+e),this._state.activeTexture=e),r}setDrawBuffers(e){const{drawFramebuffer:i}=this._state,r=i===null,s=r?this._state.drawBuffers.defaultFramebuffer:this._state.drawBuffers.fbos.get(i);if(s?.length!==e.length||!s.every((n,a)=>n===e[a]))if(e.length>this.parameters.maxDrawBuffers)console.error("Setting more active draw buffers than GL.MAX_DRAW_BUFFERS allows.");else{if(r){if(e.length>1)return void console.error("The default framebuffer can only have one active draw buffer.");if(e[0]!==$T&&e[0]!==M6)return void console.error("The default framebuffer can only use the constants GL.BACK or GL.NONE as draw buffers.")}r||!e.includes($T)?(this.gl.drawBuffers(e),r?this._state.drawBuffers.defaultFramebuffer=e:this._state.drawBuffers.fbos.set(i,e),this._stateTracker.invalidateDrawBuffers()):console.error("A framebuffer object can only use the constants GL.COLOR_ATTACHMENTi or GL.NONE as draw buffers.")}}clear(e,i=255){if(e){if(16384&e){const r=this._state.drawFramebuffer?.colorAttachments;r&&this.setDrawBuffers(r),this.setColorMask(!0,!0,!0,!0)}256&e&&this.setDepthWriteEnabled(!0),1024&e&&this.setStencilWriteMask(i),this.gl.clear(e)}}clearFramebuffer(e,i=!1,r=!1){let s=0;if(e){const a=Math.max(1e-13,e[3]);this.setClearColor(e[0],e[1],e[2],a),s|=16384}i&&(s|=256),r===!1?r=0:(r===!0&&(r=255),s|=1024),s&&this.clear(s,r)}clearBuffer(e,i,r=6144,s=void 0){this.gl.clearBufferfv(r,e,i,s)}clearBufferInteger(e,i,r=6144,s=void 0){this.gl.clearBufferiv(r,e,i,s)}clearBufferUnsignedInteger(e,i,r=6144,s=void 0){this.gl.clearBufferuiv(r,e,i,s)}drawArrays(e,i,r){if(this._transformFeedbackRequestInfo){if(e!==this._transformFeedbackRequestInfo.primitiveType)throw new Error("DrawArrays called during transform feedback, but primitiveType does not match that of the current transform feedback request");if(this._state.program?.hasTransformFeedbackVaryings==null)throw new Error("DrawArrays called during transform feedback, but the shader program was not linked with a transform feedback varying")}if(Ko()&&(this._numOfDrawCalls++,this._numOfTriangles+=Mve(e,r),ie("enable-feature:webgl-debug:textureReadWrite"))){const s=this._state.textureUnitMap;for(let n=0;n<s.length;n++){const a=s[n];if(a!=null&&a===this._state.drawFramebuffer?.colorTexture)throw new Error(`Detected readWrite. Texture already bound at index ${n}`)}}this.gl.drawArrays(e,i,r),Cc(this.gl)}drawArraysInstanced(e,i,r,s){this.gl.drawArraysInstanced(e,i,r,s),Cc(this.gl)}drawElements(e,i,r,s){if(this._transformFeedbackRequestInfo)throw new Error("Cannot called drawElements during a transform feedback request");if(Ko()&&(this._numOfDrawCalls++,this._numOfTriangles+=Mve(e,i)),this.gl.drawElements(e,i,r,s),Ko()){const n=sie(this.gl);if(n){const a=this.getBoundVAO(),o=a?.indexBuffer,l=a?.buffers,c={indexBuffer:o,vertexBuffers:l},h={mode:e,count:i,type:r,offset:s},f=o?.size??0,y=s+i,_=f<y?`. Buffer is too small. Attempted to draw index ${y} of ${f}`:"";console.error(`drawElements: ${n}${_}`,{args:h,vao:c})}}}drawElementsInstanced(e,i,r,s,n){this.gl.drawElementsInstanced(e,i,r,s,n),Cc(this.gl)}logInfo(){Ko()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){Ko()&&(this._numOfDrawCalls=0,this._numOfTriangles=0)}get capabilities(){return this._capabilities}setViewport(e,i,r,s){r=Math.max(Math.round(r),1),s=Math.max(Math.round(s),1);const n=this._state.viewport;n.x===e&&n.y===i&&n.width===r&&n.height===s||(n.x=e,n.y=i,n.width=r,n.height=s,this.gl.viewport(e,i,r,s))}setViewport4fv(e){this.setViewport(e[0],e[1],e[2],e[3])}restoreViewport({x:e,y:i,width:r,height:s}){this.setViewport(e,i,r,s)}getViewport(){const e=this._state.viewport;return{x:e.x,y:e.y,width:e.width,height:e.height}}useProgram(e){this._state.program!==e&&(this._state.program?.stop(),this._state.program=e,this.gl.useProgram(e?.glName??null))}bindTexture(e,i,r=!1){(i>=this.parameters.maxTextureImageUnits||i<0)&&console.error("Input texture unit is out of range of available units!");const s=this._state.textureUnitMap[i];return e?.glName==null?(s!=null&&(this.setActiveTexture(i,r),this.gl.bindTexture(s.descriptor.target,null)),this._state.textureUnitMap[i]=null,s):r||s!==e?(this.setActiveTexture(i,r),this.gl.bindTexture(e.descriptor.target,e.glName),e.applyChanges(),this._state.textureUnitMap[i]=e,s):(e.isDirty&&(this.setActiveTexture(i,r),e.applyChanges()),s)}unbindTexture(e){if(e!=null)for(let i=0;i<this.parameters.maxTextureImageUnits;i++)this._state.textureUnitMap[i]===e&&(this.bindTexture(null,i),this._state.textureUnitMap[i]=null)}bindFramebuffer(e,i=!1){if(i||this._state.readFramebuffer!==e||this._state.drawFramebuffer!==e){if(this._stateTracker.invalidateDrawBuffers(),e==null)return this.gl.bindFramebuffer(36160,null),void(this._state.readFramebuffer=this._state.drawFramebuffer=null);e.initializeAndBind(36160),this._state.readFramebuffer=e,this._state.drawFramebuffer=e}}bindFramebufferSeparate(e,i,r=!1){const s=i===36008,n=s?this._state.readFramebuffer:this._state.drawFramebuffer;(r||n!==e)&&(e==null?this.gl.bindFramebuffer(i,null):e.initializeAndBind(i),s?this._state.readFramebuffer=e??null:(this._stateTracker.invalidateDrawBuffers(),this._state.drawFramebuffer=e??null))}blitFramebuffer(e,i,r=16384,s=9728,n=0,a=0,o=e.width,l=e.height,c=0,h=0,f=i.width,y=i.height){this.bindFramebufferSeparate(e,36008,!0),this.bindFramebufferSeparate(i,36009,!0),this.gl.blitFramebuffer(n,a,o,l,c,h,f,y,r,s)}bindBuffer(e,i){if(e)switch(i??=e.bufferType,i){case 34962:this._state.vertexBuffer=bl(this.gl,e,i,this._state.vertexBuffer);break;case 34963:this._state.indexBuffer=bl(this.gl,e,i,this._state.indexBuffer);break;case 35345:this._state.uniformBuffer=bl(this.gl,e,i,this._state.uniformBuffer);break;case 35051:this._state.pixelPackBuffer=bl(this.gl,e,i,this._state.pixelPackBuffer);break;case 35052:this._state.pixelUnpackBuffer=bl(this.gl,e,i,this._state.pixelUnpackBuffer);break;case 36662:this._state.copyReadBuffer=bl(this.gl,e,i,this._state.copyReadBuffer);break;case 36663:this._state.copyWriteBuffer=bl(this.gl,e,i,this._state.copyWriteBuffer);break;case 35982:this._state.transformFeedbackBuffer=bl(this.gl,e,i,this._state.transformFeedbackBuffer)}}bindRenderbuffer(e){const i=this.gl;e||(i.bindRenderbuffer(i.RENDERBUFFER,null),this._state.renderbuffer=null),this._state.renderbuffer!==e&&(i.bindRenderbuffer(i.RENDERBUFFER,e.glName),this._state.renderbuffer=e)}_getBufferBinding(e,i){if(i>=this.parameters.maxUniformBufferBindings||i<0)return console.error("Uniform buffer binding point is out of range!"),null;const r=e===35345?this._state.uniformBufferBindingPoints:this._state.transformBufferBindingPoints;let s=r[i];return s==null&&(s={buffer:null,offset:0,size:0},r[i]=s),s}bindBufferBase(e,i,r){const s=this._getBufferBinding(e,i);s!=null&&(s.buffer===r&&s.offset===0&&s.size===0||(this.gl.bindBufferBase(e,i,r?r.glName:null),s.buffer=r,s.offset=0,s.size=0))}bindBufferRange(e,i,r,s,n){const a=this._getBufferBinding(e,i);a!=null&&(a.buffer===r&&a.offset===s&&a.size===n||(s%this._parameters.uniformBufferOffsetAlignment===0?(this.gl.bindBufferRange(e,i,r.glName,s,n),a.buffer=r,a.offset=s,a.size=n):console.error("Uniform buffer binding offset is not a multiple of the context offset alignment")))}bindUBO(e,i,r,s){i!=null?(Ko()&&(s??i.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),i.initialize(),r!==void 0&&s!==void 0?this.bindBufferRange(35345,e,i.buffer,r,s):this.bindBufferBase(35345,e,i.buffer)):this.bindBufferBase(35345,e,null)}unbindUBO(e){for(let i=0,r=this._state.uniformBufferBindingPoints.length;i<r;i++){const s=this._state.uniformBufferBindingPoints[i];s!=null&&s.buffer===e.buffer&&this.bindBufferBase(35345,i,null)}}unbindBuffer(e){switch(e){case 34962:this._state.vertexBuffer=bl(this.gl,null,e,this._state.vertexBuffer);break;case 34963:this._state.indexBuffer=bl(this.gl,null,e,this._state.indexBuffer);break;case 35345:this._state.uniformBuffer=bl(this.gl,null,e,this._state.uniformBuffer);break;case 35051:this._state.pixelPackBuffer=bl(this.gl,null,e,this._state.pixelPackBuffer);break;case 35052:this._state.pixelUnpackBuffer=bl(this.gl,null,e,this._state.pixelUnpackBuffer);break;case 36662:this._state.copyReadBuffer=bl(this.gl,null,e,this._state.copyReadBuffer);break;case 36663:this._state.copyWriteBuffer=bl(this.gl,null,e,this._state.copyWriteBuffer)}}bindVAO(e,i){if(e==null)return this._state.vertexArrayObject?.unbind(),void(this._state.vertexArrayObject=null);this._state.vertexArrayObject!==e&&(e.bind(i),this._state.vertexArrayObject=e)}bindTransformFeedback(e){const{gl:i}=this;i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,e.glName)}beginTransformFeedback(e,i){if(this._transformFeedbackRequestInfo)throw new Error("Already in a transform feedback request");const{gl:r}=this;r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,e.glName),r.beginTransformFeedback(i),this._transformFeedbackRequestInfo={primitiveType:i}}endTransformFeedback(){if(!this._transformFeedbackRequestInfo)throw new Error("Not in a transform feedback request");const{gl:e}=this;e.endTransformFeedback(),e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),this._transformFeedbackRequestInfo=null}async clientWaitAsync(e=10){const{gl:i}=this,r=i.fenceSync(37143,0);if(!r)throw new Error("Client wait failed, could not create sync object");let s;this.instanceCounter.increment(Bs.Sync,r),i.flush();do await iU(e),s=i.clientWaitSync(r,0,0);while(s===37147);if(this.instanceCounter.decrement(Bs.Sync,r),i.deleteSync(r),s===37149)throw new Error("Client wait failed")}getBoundFramebufferObject(e=36160){return e===36008?this._state.readFramebuffer:this._state.drawFramebuffer}temporaryBindFramebufferObject(e,i,r=!1){const s=this.getBoundFramebufferObject();try{this.bindFramebuffer(e,r),i()}finally{this.bindFramebuffer(s,r)}}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null),this.bindVAO(null),this.bindFramebuffer(null,!0),this.unbindBuffer(34962),this.unbindBuffer(34963),this.unbindBuffer(35345),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(35051),this.unbindBuffer(35052),this.unbindBuffer(36662),this.unbindBuffer(36663);for(let e=0;e<this.parameters.maxTextureImageUnits;++e)this.bindTexture(null,e);this.setBlendingEnabled(!1),this.setBlendFunction(1,0),this.setBlendEquation(32774),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(1029),this.setFrontFace(2305),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(513),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(519,0,0),this.setStencilOp(7680,7680,7680),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setDrawBuffers([$T]),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){const{gl:e}=this;e.bindVertexArray(null);for(let r=0;r<this.parameters.maxVertexAttributes;r++)e.disableVertexAttribArray(r);this._state.vertexBuffer?e.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):e.bindBuffer(34962,null),this._state.indexBuffer?e.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):e.bindBuffer(34963,null),this._state.uniformBuffer?e.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):e.bindBuffer(35345,null);for(let r=0;r<this._parameters.maxUniformBufferBindings;r++){const s=this._state.uniformBufferBindingPoints[r];if(s!=null){const{buffer:n,offset:a,size:o}=s;n!==null?a===0&&o===0?e.bindBufferBase(35345,r,n.glName):e.bindBufferRange(35345,r,n.glName,a,o):e.bindBufferBase(35345,r,null)}}if(this._state.pixelPackBuffer?e.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):e.bindBuffer(35051,null),this._state.pixelUnpackBuffer?e.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):e.bindBuffer(35052,null),this._state.copyReadBuffer?e.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):e.bindBuffer(36662,null),this._state.copyWriteBuffer?e.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):e.bindBuffer(36663,null),e.bindFramebuffer(36008,null),e.readBuffer(e.BACK),this._state.readFramebuffer&&(e.bindFramebuffer(36008,this._state.readFramebuffer.glName),e.readBuffer(Dr)),e.bindFramebuffer(36009,this._state.drawFramebuffer?.glName??null),this._state.drawFramebuffer===null){const r=this._state.drawBuffers.defaultFramebuffer;e.drawBuffers(r??[$T])}else{const r=this._state.drawBuffers.fbos.get(this._state.drawFramebuffer);e.drawBuffers(r??[Dr])}if(this._state.vertexArrayObject){const r=this._state.vertexArrayObject;this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null),this.bindVAO(r)}e.useProgram(this._state.program?.glName??null),e.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a),e.bindRenderbuffer(e.RENDERBUFFER,this._state.renderbuffer?.glName??null),this._state.blend===!0?e.enable(this.gl.BLEND):e.disable(this.gl.BLEND),e.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha),e.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha),e.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a),e.clearDepth(this._state.clearDepth),e.clearStencil(this._state.clearStencil),e.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a),e.cullFace(this._state.cullFace),e.depthFunc(this._state.depthFunction),e.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar),this._state.depthTest===!0?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),e.depthMask(this._state.depthWrite),e.frontFace(this._state.frontFace),e.lineWidth(1),this._state.faceCulling===!0?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),e.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]),this._state.polygonOffsetFill===!0?e.enable(e.POLYGON_OFFSET_FILL):e.disable(e.POLYGON_OFFSET_FILL),e.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height),this._state.scissorTest===!0?e.enable(e.SCISSOR_TEST):e.disable(e.SCISSOR_TEST),e.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask),e.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass),this._state.stencilTest===!0?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),e.stencilMask(this._state.stencilWriteMask);for(let r=0;r<this.parameters.maxTextureImageUnits;r++){e.activeTexture(Q7+r),e.bindTexture(3553,null),e.bindTexture(34067,null),e.bindTexture(32879,null),e.bindTexture(35866,null);const s=this._state.textureUnitMap[r];s!=null&&e.bindTexture(s.descriptor.target,s.glName)}e.activeTexture(Q7+this._state.activeTexture);const i=this._state.viewport;e.viewport(i.x,i.y,i.width,i.height),this.resetInfo()}};function bl(t,e,i,r){return e?r!==e&&t.bindBuffer(i,e.glName):t.bindBuffer(i,null),e}function Mve(t,e){switch(t){case lr.POINTS:return 2*e;case lr.TRIANGLES:return e/3;case lr.TRIANGLE_STRIP:case lr.TRIANGLE_FAN:return e-2;default:return 0}}let LPt=class extends IPt{constructor(e,i){super(e,i),this.emptyTexture=S5e(this),this._vaoCaches=new Map,this._appleAmdDriverHelper=null,this._refCount=1,this._newCache=i.newCache,this._screen=new ZOt(this)}configure(e){super.configure(e),this._newCache=e.newCache}destroy(){this._vaoCaches.forEach(e=>e.dispose()),this._vaoCaches.clear(),--this._refCount>0||this.dispose()}ref(){++this._refCount}get refCount(){return this._refCount}dispose(){this.emptyTexture.dispose(),this._screen.destroy(),this._screen=null,super.dispose(),this._appleAmdDriverHelper?.dispose(),this._vaoCaches.forEach(e=>e.dispose()),this._vaoCaches.clear()}get newCache(){return this._newCache}get screen(){return this._screen}getVaoCache(e){const i=JSON.stringify(e),r=this._vaoCaches.get(i);if(r)return r;const s=new QOt(this,e);return this._vaoCaches.set(i,s),s}bindTechnique(e,i,r,s){return this.useProgram(e.program),this.setPipelineState(e.getPipeline()),e.program.bind(i),r&&(e.program.bindPass(r,i),s&&e.program.bindDraw(i,r,s)),e.program}runAppleAmdDriverHelper(){this.driverTest.drawArraysRequiresIndicesTypeReset.result&&(this._appleAmdDriverHelper??=new eke(this),this._appleAmdDriverHelper.run())}get isAssumedMetalDriver(){if(this._isAssumedMetalDriver==null&&(this._isAssumedMetalDriver=!!ie("ios")||!!ie("safari"),!this._isAssumedMetalDriver&&ie("mac")&&ie("chrome"))){const e=this.capabilities.rendererInfo?.getUnmaskedRenderer().toLowerCase(),i=e?.includes("apple")&&e?.includes("angle")&&e?.includes("metal");this._isAssumedMetalDriver=i??!0}return this._isAssumedMetalDriver}get test(){}},kPt=class{constructor(e={},i={},r=8,s=1/0){this.disabledExtensions=e,this.debugWebGLExtensions=i,this.maxAnisotropy=r,this.maxPreferredTexturePixels=s}},zPt=class extends kPt{constructor(e){super(e.options.deactivatedWebGLExtensions||{},e.options.debugWebGLExtensions||{},8,e.view.qualitySettings.maxTexturePixels),this.newCache=(i,r)=>e.view.resourceController.memoryController.newCache(i,r)}};function Eve(t){return!!t.update}let FPt=class{constructor(){this._updating=new Map}destroy(){this._updating.clear()}add(e){this._updating.set(e.id,new NPt(e))}remove(e){this._updating.delete(e.id)}run(){let e=!1;return this._updating.forEach(i=>{const r=i.texture.update(i.previousToken);r>=0&&r!==i.previousToken&&(i.previousToken=r,e=!0)}),e}},NPt=class{constructor(e){this.texture=e,this.previousToken=-1}},UT=class extends Me{constructor(e){super({}),this._stage=e,this._textures=new Map,this._loadingCount=0,this.events=new Ey,this.updater=new FPt,this._frameTask=e.view.resourceController.scheduler.registerTask(yt.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}destroy(){this._frameTask.remove(),this.updater.destroy(),this._textures.forEach(e=>e.unload())}get updating(){return this._loadingCount>0||this._frameTask.updating}acquire(e){const i=this._textures.get(e);return i?(i.ref(),i.loadingPromise??i):this._createNewRef(e)}update(){this.updater.run()&&this.events.emit("changed",0)}_createNewRef(e){const i=this._stage.getTexture(e);if(i==null)return null;const r=i.events.on("unloaded",()=>{r.remove(),this._onTextureUnloaded(i)}),s=new VPt(i,()=>{this._frameTask.schedule(()=>{s.isUnreferenced&&i.unload()})});return this._textures.set(e,s),s.ref(),i.loaded?(this._updateGLTexture(s,i.glTexture),Eve(i)&&this.updater.add(i),s):(this._loadingCount++,s.loadingPromise=this._stage.schedule(()=>{const n=i.load(this._stage.renderView.renderingContext),a=l=>(this._loadingCount--,s.loadingPromise=null,this._updateGLTexture(s,l),Eve(i)&&this.updater.add(i),s),o=l=>(i.unload(),this._loadingCount--,s.loadingPromise=null,Hr(l)||fe.getLogger(this).error(l),null);return $a(n)?n.then(a,o):a(n)}),s.loadingPromise)}_updateGLTexture(e,i){e.glTexture=i,this.events.emit("changed",1)}_onTextureUnloaded(e){this._textures.delete(e.id),this.updater.remove(e)}};d([m()],UT.prototype,"_loadingCount",void 0),d([m()],UT.prototype,"_frameTask",void 0),d([m()],UT.prototype,"updating",null),UT=d([k("esri.views.3d.webgl-engine.lib.TextureRepository")],UT);let VPt=class{constructor(e,i){this._texture=e,this._release=i,this._refCount=0}get id(){return this._texture.id}get isUnreferenced(){return this._refCount===0}ref(){++this._refCount}release(){--this._refCount,this._refCount>0||(this._refCount!==0?(fe.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository.RefCountedTextureImpl").error("Cannot dereference texture that has no references!"),this._refCount=0):this._release())}unload(){this._texture.unload()}};function UPt(t,e){return new fIe(i=>sSt(i,t),i=>i,e)}let hP=class extends Me{constructor(){super(...arguments),this._passParameters=new BPt,this._resourcesTask=null}get passParameters(){return this._passParameters}destroy(){this._resourcesTask=ps(this._resourcesTask),this._passParameters.waveNormal=Rt(this._passParameters.waveNormal),this._passParameters.wavePerturbation=Rt(this._passParameters.wavePerturbation)}get updating(){return!!this._resourcesTask&&!this._resourcesTask.finished}ensureResources(e){return this._resourcesTask||(this._resourcesTask=Bc(async i=>{await Promise.allSettled([this._loadImageResource(e,Es("esri/images/materials/water/normals.jpg"),r=>this._passParameters.waveNormal=r,i),this._loadImageResource(e,Es("esri/images/materials/water/perturbation.jpg"),r=>this._passParameters.wavePerturbation=r,i)])})),this._resourcesTask.finished?2:1}async _loadImageResource(e,i,r,s){try{const n=await $y(i,{signal:s});st(s);const a=new Zi(n.width,n.height);a.pixelFormat=6407,a.samplingMode=9987,a.hasMipmap=!0,a.maxAnisotropy=8,r(new Fi(e,a,n))}catch(n){fe.getLogger(this).error("Failed to load water material normal texture.",n)}}};d([m()],hP.prototype,"_resourcesTask",void 0),d([m({type:Boolean,readOnly:!0})],hP.prototype,"updating",null),hP=d([k("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],hP);let BPt=class extends hr{},LA=null,$V=!0;function YF(t,e,i){if(!t||!e)throw new Error("Cannot construct image data without dimensions");if($V)try{return new ImageData(t,e)}catch{$V=!1}return nke(t,e,i)}function msi(t,e,i,r){if(!e||!i)throw new Error("Cannot construct image data without dimensions");if($V)try{return new ImageData(t,e,i)}catch{$V=!1}const s=nke(e,i,r);return s.data.set(t,0),s}function jPt(){return LA||(LA=document.createElement("canvas"),LA.width=1,LA.height=1),LA}function nke(t,e,i){return i||(i=jPt()),i.getContext("2d").createImageData(t,e)}async function qPt(t,e){const i=window.URL.createObjectURL(t);try{const{data:r}=await $r(i,{...e,responseType:"image"});return r}catch(r){throw Hr(r)?r:new ee("invalid-image",`Could not fetch requested image at ${i}`)}finally{window.URL.revokeObjectURL(i)}}async function gsi(t,e){const{arrayBuffer:i,mediaType:r}=await GPt(t,e),s=r==="image/png";if(r==="image/gif"){const{isAnimatedGIF:n,parseGif:a}=await te(()=>import("./gif-BfnROlh-.js"),[]);if(n(i))return a(i,e)}if(s){const{isAnimatedPNG:n,parseApng:a}=await te(()=>import("./apng-DlHvO5H3.js"),__vite__mapDeps([370,11]));if(n(i))return a(i,e)}return qPt(new Blob([i],{type:r}),e)}async function GPt(t,e){const i=aC(t);if(i?.isBase64)return{arrayBuffer:rxe(i.data),mediaType:i.mediaType};const r=await $r(t,{responseType:"array-buffer",...e});return{arrayBuffer:r.data,mediaType:r.getHeader?.("Content-Type")??""}}const Ave=2048,HPt=1.5,WPt=8;function ake(t,e){const{format:i,quality:r,rotation:s,disableDecorations:n}=t||{},a=Nse(t,e.padding),o=iRt(t,{width:e.width-a.left-a.right,height:e.height-a.top-a.bottom}),{width:l,height:c}=tRt(t,o),h=hke(i),f=dke[h];return{format:h,quality:Se(r??f,0,100),area:o,width:l,height:c,rotation:s,disableDecorations:!!n,ignoreBackground:!!t?.ignoreBackground,ignorePadding:!!t?.ignorePadding}}function ZPt(t,e){const i=ake(t,e),r=i.area,s=i.width/r.width,n=Nse(i,e.padding),a=n.left+n.right,o=n.top+n.bottom,l=e.width-a,c=e.height-o,h=Math.floor(l*s+a),f=Math.floor(c*s+o),y=t?.layers??[],_=i.ignoreBackground,w=i.ignorePadding;return{framebufferWidth:h,framebufferHeight:f,region:{x:Math.floor(r.x*s)+n.left,y:Math.floor(r.y*s)+n.top,width:i.width,height:i.height},format:i.format,quality:i.quality,rotation:i.rotation,pixelRatio:s,layers:y,disableDecorations:i.disableDecorations,ignoreBackground:_,ignorePadding:w,olidColor:!1}}function YPt(t,e,i){const{ctx:r,canvas:s}=oke(t,i),n=r.getImageData(0,0,t.width,t.height),a=cke(s,e);return lke(s),{dataUrl:a,data:n}}function QPt(t,e){const{ctx:i,canvas:r}=oke(t,e),s=i.getImageData(0,0,t.width,t.height);return lke(r),s}function oke(t,e){const i=XPt();e.premultipliedAlpha&&aRt(t),i.width=t.width,i.height=t.height;const r=i.getContext("2d",{willReadFrequently:!0});return r.putImageData(t,0,0),e.flipY&&nRt(r),{ctx:r,canvas:i}}function lke(t){t.width=0,t.height=0}function XPt(){return yH==null&&(yH=document.createElement("canvas")),yH}let yH=null;function cke(t,e){const i=oRt[e.format],r=e.quality/100;return t.toDataURL(i,r)}function JPt(t,e){const i=hke(t),r=dke[i];return{format:i,quality:Se(e??r,0,100)}}function KPt(t,e){return e/Math.max(t[0],t[1])}function uke(t,e,i,r=0,s=0,n=t.width-r,a=t.height-s,o=!1){const{data:l}=t,{width:c,height:h,data:f}=e,y=n/c,_=a/h,w=Math.ceil(y/2),x=Math.ceil(_/2),S=t.width;for(let $=0;$<h;$++)for(let A=0;A<c;A++){const M=4*(A+(o?h-$-1:$)*c);let P=0,O=0,D=0,L=0,F=0,U=0;const N=($+.5)*_;for(let j=Math.floor($*_);j<($+1)*_;j++){const B=Math.abs(N-(j+.5))/x,Y=(A+.5)*y,G=B*B;for(let Z=Math.floor(A*y);Z<(A+1)*y;Z++){const H=Math.abs(Y-(Z+.5))/w,Q=Math.sqrt(G+H*H);if(Q>=1)continue;let X=2*Q*Q*Q-3*Q*Q+1;const ye=4*(r+Z+(s+j)*S);U+=X*l[ye+3],O+=X,!i&&l[ye+3]<255&&(X=X*l[ye+3]/255),D+=X*l[ye],L+=X*l[ye+1],F+=X*l[ye+2],P+=X}}f[M]=D/P,f[M+1]=L/P,f[M+2]=F/P,f[M+3]=U/O}return e}function eRt(t,e,i){if(!e)return t;const{framebufferWidth:r,framebufferHeight:s,pixelRatio:n,region:a}=t,o=Nse(t,i),l=o.left+o.right,c=o.top+o.bottom,h=r-l,f=s-c,y=Math.min(WPt,Math.min((Ave-l)/h,(Ave-c)/f));return y<HPt?t:{...t,framebufferWidth:Math.round(h*y)+l,framebufferHeight:Math.round(f*y)+c,pixelRatio:n*y,resample:{region:{x:Math.round((a.x-o.left)*y)+o.left,y:Math.round((a.y-o.top)*y)+o.top,width:Math.round(a.width*y),height:Math.round(a.height*y)},width:r,height:s}}}function tRt(t,e){if(!t)return e;const i=t.width,r=t.height;if(i!=null&&r!=null)return{width:Math.floor(i),height:Math.floor(r)};if(i==null&&r==null)return e;const s=e.width/e.height;return r==null?{width:Math.floor(i),height:Math.floor(i/s)}:{width:Math.floor(r*s),height:Math.floor(r)}}function iRt(t,e){const i={x:0,y:0,width:e.width,height:e.height};if(t?.area){t.area.x!=null&&(i.x=Math.floor(t.area.x)),t.area.y!=null&&(i.y=Math.floor(t.area.y));const r=t.area.width!=null?Math.floor(t.area.width):null,s=t.area.height!=null?Math.floor(t.area.height):null;if(i.width=e.width-i.x,i.height=e.height-i.y,r!=null&&s!=null)i.width=Math.min(i.width,r),i.height=Math.min(i.height,s);else if(r==null&&s!=null){const n=Math.min(i.width,r);i.height=n/i.width*i.height,i.width=n}else if(r!=null&&s==null){const n=Math.min(i.height,s);i.width=n/i.height*i.width,i.height=n}}return rRt(sRt(i,t),e)}function rRt(t,e){const i=Math.floor(Math.max(t.x,0)),r=Math.floor(Math.max(t.y,0)),s={x:i,y:r,width:Math.floor(Math.min(t.width,e.width-i)),height:Math.floor(Math.min(t.height,e.height-r))},n=s.width/s.height,a=t.width/t.height;if(a===n)return s;if(a>n){const c=Math.floor(s.width/a),h=s.height-c;return{x:s.x,y:Math.floor(s.y+h/2),width:s.width,height:c}}const o=Math.floor(s.height*a),l=s.width-o;return{x:Math.floor(s.x+l/2),y:s.y,width:o,height:s.height}}function sRt(t,e){if(e?.width==null||e.height==null)return t;const i=e.width/e.height,r=t.width/t.height;if(r===i)return t;if(r<i){const n=Math.floor(t.height*i);return t.x-=(n-t.width)/2,t.width=n,t}const s=Math.floor(t.width/i);return t.y-=(s-t.height)/2,t.height=s,t}function Nse(t,e){return!e||t?.ignorePadding?cRt:e}function hke(t){switch(t){case"png":case"jpg":case"jpeg":return t;default:return lRt}}function nRt(t){t.save(),t.globalCompositeOperation="copy",t.scale(1,-1),t.translate(0,-t.canvas.height),t.drawImage(t.canvas,0,0),t.restore()}function aRt(t){const e=t.data,i=e.length;for(let r=0;r<i;r+=4){const s=e[r+3];if(s!==255&&s>0){const n=255/s;e[r]=e[r]*n,e[r+1]=e[r+1]*n,e[r+2]=e[r+2]*n}}}const oRt={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},Ove=98,lRt="png",dke={png:100,jpg:Ove,jpeg:Ove},cRt={top:0,right:0,bottom:0,left:0},kA=Object.freeze(Object.defineProperty({__proto__:null,completeUserSettings:ake,createEmptyImageData:YF,encode:YPt,encodeData:QPt,getFormatAndQuality:JPt,getMaximumResolutionScale:KPt,resampleHermite:uke,screenshotSuperSampleSettings:eRt,toDataUrl:cke,toRenderSettings:ZPt},Symbol.toStringTag,{value:"Module"}));let uRt=class{constructor(e,i){this.parameters=e,this.fbos=i}},hRt=class{constructor(e,i,r){this._rctx=e,this._renderFunctions=i,this._forceCameraHook=r,this.supersample=!0,this._screenshotQueue=new Array}destroy(){this._rctx=null}async takeScreenshot(e){await this._renderFunctions.prepareOverlay(),this._renderFunctions.requestRenderScene(0);const i=lo();return this._screenshotQueue.push({settings:e,resolver:i}),i.promise}update(e,i){for(const r of this._screenshotQueue){if(this._rctx==null){r.resolver.reject();continue}const s={...r.settings,pixelRatio:r.settings.pixelRatio*e.parameters.camera.pixelRatio},n=this._renderScreenshot(e,s,i);r.resolver(n)}this._screenshotQueue.length=0}_renderScreenshotOverlay(e,i,r){e.width=i.width,e.height=i.height;const s=e.getContext("2d",{willReadFrequently:!0}),n=r.pixelRatio;return s.save(),s.translate(0,i.height),s.scale(1,-1),r.region&&s.translate(-r.region.x,-r.region.y),s.scale(n,n),i=this._renderFunctions.renderOverlay(e,r.disableDecorations,i),s.restore(),i}_readbackScreenshot(e,i){return e.resample?this._readbackScreenshotResampled({...e,resample:e.resample},i):this._readbackScreenshotImmediate(e,i)}_readbackScreenshotResampled(e,i){const{framebufferWidth:r,framebufferHeight:s,region:n,resample:a}=e,o=this._ensureScreenshotEncodeCanvas();let l=YF(r,s,o);this._rctx.gl.readPixels(0,0,r,s,6408,ar.UNSIGNED_BYTE,new Uint8Array(l.data.buffer)),i(),l=this._renderScreenshotOverlay(o,l,{...e,region:void 0});const c=YF(n.width,n.height,o);return uke(l,c,!0,a.region.x,s-(a.region.y+a.region.height),a.region.width,a.region.height)}_readbackScreenshotImmediate(e,i){const{framebufferHeight:r,region:s}=e,n=this._ensureScreenshotEncodeCanvas(),a=YF(s.width,s.height,n);return this._rctx.gl.readPixels(s.x,r-(s.y+s.height),s.width,s.height,6408,ar.UNSIGNED_BYTE,new Uint8Array(a.data.buffer)),i(),this._renderScreenshotOverlay(n,a,e)}_renderScreenshot(e,i,r){const s=e.parameters.camera,{framebufferWidth:n,framebufferHeight:a,ignorePadding:o,pixelRatio:l,disableDecorations:c,olidColor:h}=i,f={width:n,height:a};nw(f,Math.min(this._rctx.parameters.maxTextureSize,this._rctx.parameters.maxRenderbufferSize));let y=!1;const _=f.width!==s.fullWidth||f.height!==s.fullHeight,w=o&&s.pixelRatio!==l,x=_||c||w||h;let S=null,$=null;if(x){const O=s.clone();if(o){const N=K3(O.padding);for(let j=0;j<4;j++)N[j]=Math.round(N[j]/O.pixelRatio*l);O.padding=N}O.fullWidth=f.width,O.fullHeight=f.height,O.pixelRatio=l;const D=s.fovX-O.fovX,L=s.fovY-O.fovY;D<0&&D<L?O.fovX=s.fovX:L<0&&L<D&&(O.fovY=s.fovY);const F={camera:O,contentCamera:O,mode:2,alignPixelEnabled:!0,contentPixelRatio:O.pixelRatio};this._forceCameraHook(F),y=!0;const U=this._renderFunctions.renderScene(F,r,h?2:1,c);$=U.screen,S=U.olid}const A=()=>{this._rctx.bindFramebuffer(null),$?.release()};this._rctx.bindFramebuffer($?.fbo);const M=this._readbackScreenshot(i,A);let P=null;if(h){const O=()=>{this._rctx.bindFramebuffer(null),S?.release()};this._rctx.bindFramebuffer(S?.fbo),P=this._readbackScreenshot(i,O),this._rctx.bindFramebuffer(null)}if(x&&!this._rctx.contextAttributes.alpha)for(let O=3;O<M.data.length;O+=4)M.data[O]=255;if(P&&!this._rctx.contextAttributes.alpha)for(let O=3;O<P.data.length;O+=4)P.data[O]=255;return y&&this._forceCameraHook(e.parameters),[M,P]}_ensureScreenshotEncodeCanvas(){return this._screenshotEncodeCanvas??=document.createElement("canvas"),this._screenshotEncodeCanvas}},Yo=class extends Me{constructor(e){super(e),this._waterTextures=new hP,this.olidRenderHelper=Jh()?new kAt:null,this._needsUpdate=!0,this._needsRender=!0,this._idleSuspend=!0,this._needsWaterReflectionUpdate=!1,this._lastAnimationUpdate=0,this.glow=null,this.fog=null,this.test=null;const i=e.stage;try{this._initializeContext(i)}catch(a){return void console.error("Failed to initialize context",a)}const{memoryController:r}=i.view.resourceController;this._stippleTextures=j2t(this._rctx,r),this.notifyChange("stippleTextures"),this._markerTextures=UPt(this._rctx,r),this.notifyChange("markerTextures"),this._techniques=new BEt(new UEt(this._rctx,i.viewingMode,this.stippleTextures,this.waterTextures,this.markerTextures)),this._textures=new UT(i),this.addHandles(this._textures.events.on("changed",a=>this.requestRender(a)));const s=new pIe(this._textures,this._techniques,()=>this.requestRender(),()=>this.requestRender());this._compositingHelper=new LAt(this._rctx,this._techniques),this._renderer=new VT(i,s,this._techniques,this._rctx,this._compositingHelper,a=>this.requestRender(a)),this.notifyChange("renderer"),this.addHandles([K(()=>i.view.ready,a=>{a&&this._createRenderNodes()},Wt),K(()=>this.waterTextures?.updating,()=>this.requestRender(),Wt),K(()=>i.view.qualityProfile,a=>this.renderer?.updateRenderFeatures(a),At)]);const n={renderScene:(a,o,l,c)=>this.renderer.render(a,o,l,c),requestRenderScene:a=>this.requestRender(a),prepareOverlay:()=>i.options.screenshot.prepareOverlay(),renderOverlay:(a,o,l)=>i.options.screenshot.renderOverlay(a,o,l)};this._screenshotManager=new hRt(this._rctx,n,a=>i.view.overlayManager.updateOverlays(sl,a.camera,0)),this._registerFrameTask(i)}destroy(){const e=this.stage?.container;e?.contains(this._canvas)&&e.removeChild(this._canvas),this._frameTask=Ki(this._frameTask),this._techniques=Re(this._techniques),this._componentObjectCollection=Re(this._componentObjectCollection),this._set("componentObjectCollection",null),this._screenshotManager=Re(this._screenshotManager),Re(this.renderer),this._textures=Re(this._textures),Re(this.waterTextures),Re(this.markerTextures),Re(this.stippleTextures),this._waterTextures=null,this._markerTextures=null,this._stippleTextures=null,this._canvas=null,this._rctx=Re(this._rctx),this._compositingHelper=null,this._renderer=null,this._set("renderer",null),this.test?.destroy()}_createRenderNodes(){const{view:e,viewingMode:i}=this.stage;new iJ({view:e}),YD(e.spatialReference)||(i===2?(new ZX({view:e}),this.glow=new hw({view:e})):ZD(e.spatialReference)?(new YX({view:e}),this.glow=new hw({view:e})):(new HX({view:e}),new WX({view:e}),this.glow=new hw({view:e}),new eJ({view:e}),this.fog=new NF({view:e}))),new RT({view:e,isEnabled:()=>this.renderer.hasSSAO}),new Mb({view:e,isEnabled:()=>this.renderer.hasSMAA}),new Cb({view:e}),new WO({view:e}),new FT({view:e,viewingMode:i}),new iP({view:e}),Jh()&&new tP({view:e})}requestRender(e=1){switch(e){case 2:this.stage.view.state.fading=!0;case 1:this._needsUpdate=!0;case 0:this._needsRender=!0}}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this.renderer.updating||this._textures.updating||this.waterTextures.updating}get textures(){return this._textures}get techniques(){return this._techniques}get compositingHelper(){return this._compositingHelper}setIdleSuspend(e){this._idleSuspend!==e&&(this._idleSuspend=e,this.requestRender())}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}get canvas(){return this._canvas}takeScreenshot(e){return this._screenshotManager.takeScreenshot(e)}getAlpha(){return!!this._rctx.contextAttributes.alpha}getMinimalDepthForArea(e,i,r,s,n,a=n){const o=s.constrainWindowSize(i,r,n*s.pixelRatio,a*s.pixelRatio),l=this._ensureLinearDepthArrayBuffer(o);this.renderer.readMainDepth(o,l);const c=(f,y,_)=>vse(y,f)*(_[1]-_[0])+_[0];let h=Number.MAX_VALUE;for(let f=0;f<o[2]*o[3];f++){const y=c(4*f,l,s.nearFar);h>y&&y!==s.nearFar[0]&&y!==s.nearFar[1]&&(h=y)}if(e){const f=e.pickDepth(i*s.pixelRatio,r*s.pixelRatio,s);f!=null&&h>f&&f!==s.nearFar[0]&&f!==s.nearFar[1]&&(h=f)}return h===Number.MAX_VALUE?void 0:h}_ensureLinearDepthArrayBuffer(e){const i=4*e[2]*e[3];return(this._tmpDepthBuffer==null||this._tmpDepthBuffer.byteLength<i)&&(this._tmpDepthBuffer=new Uint8Array(i)),this._tmpDepthBuffer}async reloadShaders(){LIe(),await this._techniques.reloadAll(),this.renderer.overlay?.reloadShaders(),this.requestRender()}_registerFrameTask(e){const i=e.view.state;let r=!1,s=0,n=!1;const a={preRender:({time:o})=>{r=this.updating,s=this._needsUpdate?1:0,this._needsRender&&this.renderer.updateSceneDepthRange(i.camera),e.commitSyncLayers(),o=this.test?.time??o,(o-this._lastAnimationUpdate>this.renderer.animationTimestep||r||this._needsRender)&&(this.renderer.updateAnimation(i,o)&&this.requestRender(0),this._lastAnimationUpdate=o)},render:({time:o})=>{if((this._needsRender||!this._idleSuspend||!this.renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&i.camera.fullWidth>0&&i.camera.fullHeight>0){const l=this._needsUpdate&&this._idleSuspend&&this.renderer.isCameraFinal;this._needsRender=!1,this._needsUpdate=!1,this._needsWaterReflectionUpdate=!1,o=this.test?.time??o,this.renderer.render(i,o,0),n=!0,l&&this.renderer.hasReflections&&(this.requestRender(0),this._needsWaterReflectionUpdate=!0)}},update:({time:o})=>{this._textures.update();const l=new uRt(i,this.renderer.fboCache);o=this.test?.time??o,this._screenshotManager.update(l,o)},finish:()=>{n&&(this.renderer.finish(i.mode===2?s:1),n=!1)}};this._frameTask=Rx(a)}_initializeContext(e){const{options:i}=e,r=i.canvas??document.createElement("canvas");r.setAttribute("style","width: 100%; height:100%; display:block;"),this._canvas=r;const s={alpha:i.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:i.stencil??!0,powerPreference:"high-performance",preserveDrawingBuffer:i.preserveDrawingBuffer??!1},n=r.getContext("webgl2",s);if(n==null)return void fe.getLogger(this).error("A WebGL2 context could not be created.");Cc(n,!0),this._rctx=dRt(n,e),this._loadShaderOnlyExtensions(),!i.alpha&&this._rctx.contextAttributes.alpha&&fe.getLogger(this).error("WebGL context has alpha channel even though no alpha channel was requested");const{container:a}=e;!this._rctx.contextAttributes.alpha&&ie("safari")>=11&&(a.style.backgroundColor="black"),a.contains(r)||a.appendChild(r)}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("textureFloatLinear")}get _viewingMode(){return this.stage.viewingMode}get stippleTextures(){return this._stippleTextures}get markerTextures(){return this._markerTextures}get waterTextures(){return this._waterTextures}getObjectAndLayerIdColor(e){return this.olidRenderHelper?.getObjectAndLayerIdColor(e)}get renderer(){return this._renderer}get componentObjectCollection(){return this._componentObjectCollection==null&&(this._componentObjectCollection=new NEt(this.renderer.renderPassManager,this._viewingMode)),this._componentObjectCollection}set componentObjectCollection(e){this._componentObjectCollection=e}updateQualitySettings(e){this.test?.time!=null&&(this.test.savedFadeDuration=e.fadeDuration,e.fadeDuration=0),this._rctx.updateOptions({maxPreferredTexturePixels:this.stage.view.qualitySettings.maxTexturePixels})}};function dRt(t,e){const i=new zPt(e);return new LPt(t,i)}d([m({type:Boolean,readOnly:!0})],Yo.prototype,"updating",null),d([m({constructOnly:!0})],Yo.prototype,"stage",void 0),d([m({readOnly:!0})],Yo.prototype,"stippleTextures",null),d([m({readOnly:!0})],Yo.prototype,"markerTextures",null),d([m({readOnly:!0})],Yo.prototype,"waterTextures",null),d([m({readOnly:!0})],Yo.prototype,"olidRenderHelper",void 0),d([m()],Yo.prototype,"_textures",void 0),d([m({readOnly:!0})],Yo.prototype,"renderer",null),d([m()],Yo.prototype,"_screenshotManager",void 0),d([m()],Yo.prototype,"componentObjectCollection",null),d([m()],Yo.prototype,"_componentObjectCollection",void 0),d([m()],Yo.prototype,"_needsUpdate",void 0),d([m()],Yo.prototype,"_needsWaterReflectionUpdate",void 0),Yo=d([k("esri.views.3d.webgl-engine.parts.RenderView")],Yo);let bh=class extends Me{constructor(e){super(e),this._model=new FF,this._canCompact=Pn(!1),this._layers=new Array,this._asyncChangeSet=new NX,this._syncChangeSet=new NX,this._layerSyncSet=new Set,this._textures=new R3(this,e.view.resourceController.scheduler),this._frameTask=e.view.resourceController.scheduler.registerTask(yt.STAGE,this),this.addHandles(this._frameTask)}initialize(){this._renderView=new Yo({stage:this})}destroy(){this.removeAllHandles(),this._textures.destroy(),this._set("textures",null),this._renderView=Re(this._renderView),this._set("renderView",null),this._layers.length=0,this._model=null,this._set("renderer",null),this.options.canvas=null,this._set("options",null)}get viewingMode(){return this.view.state.viewingMode}get updating(){return!this.destroyed&&!this.destroying&&(this.readyToRun||this.renderView.updating||this._frameTask.updating||this.textures.updating)}get renderView(){return this._renderView}get renderer(){return this.renderView?.renderer}get textures(){return this._textures}addTexture(e){this._model.addTexture(e),this.renderView.requestRender()}removeTexture(e){e!=null&&!this.destroyed&&this._model.hasTexture(e)&&(this._model.removeTexture(e),this.renderView.requestRender())}addTextures(e){e!=null&&(this._model.addTextures(e),this.renderView.requestRender())}removeTextures(e){e!=null&&(this._model?.removeTextures(e),this.renderView.requestRender())}forEachTexture(e){this._model.forEachTexture(e)}getTexture(e){return this._model.getTexture(e)}addLayer(e){this._layers.includes(e)||(this._model.addLayer(e),this._layers.push(e),this._model.dirtySet.layerAdded(e),this.renderView.requestRender())}removeLayer(e){e!=null&&!this.destroyed&&this._model.hasLayer(e)&&(this._model.dirtySet.layerRemoved(e),this.commitLayer(e),Ul(this._layers,e),this._model.dirtySet.assertLayerClean(e.id),this._model.removeLayer(e),this.renderView.requestRender())}getLayer(e){return this._model.getLayer(e)}handleEvent(e,i){this.destroyed||(this._model.dirtySet[e](i),this.renderView.requestRender())}get readyToRun(){return this._model.dirtySet.dirty||!this._asyncChangeSet.empty||this._canCompact.value}runTask(e){if(this._frameTask.processQueue(e),this._commit(e),this.renderer.compact(e),this._canCompact.value=this.renderer.canCompact,!e.hasProgressed)return ea}compact(e){return this._canCompact.value=!1,this.renderer.compact(e)}_commit(e){const i=this._model.dirtySet;this._asyncChangeSet.empty||e.done||(this.renderer.commit(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()),this._layers.forEach(r=>{if(e.done)return;const s=this._layerSyncSet.has(r.id)||r.updatePolicy===1,n=s?this._syncChangeSet:this._asyncChangeSet;i.commitLayer(r.id,n),this._layerSyncSet.delete(r.id),n.empty||(this.renderer.commit(n,s?sl:e),this.renderView.requestRender(),e.madeProgress())}),this._syncChangeSet.empty||(this.renderer.commit(this._syncChangeSet,sl),this.renderView.requestRender(),e.madeProgress()),this._layers.forEach(r=>{e.done||this._layerSyncSet.has(r.id)||r.updatePolicy!==0||(i.commitLayer(r.id,this._asyncChangeSet),this._asyncChangeSet.empty||(this.renderer.commit(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()))}),this._layerSyncSet.clear(),this.notifyChange("readyToRun")}commitSyncLayers(){const e=this._model.dirtySet;this._layers.forEach(i=>{this._layerSyncSet.has(i.id)||i.updatePolicy===1?(e.commitLayer(i.id,this._syncChangeSet),this._layerSyncSet.delete(i.id)):e.commitSyncUpdates(i.id,this._syncChangeSet)});for(const i of this._layerSyncSet)e.commitLayer(i,this._syncChangeSet);this._layerSyncSet.clear(),this._syncChangeSet.empty||(this.renderer.commit(this._syncChangeSet,sl),this.renderView.requestRender())}commitLayer(e){this._model.dirtySet.commitLayer(e.id,this._syncChangeSet),this._layerSyncSet.delete(e.id),this._syncChangeSet.empty||(this.renderer.commit(this._syncChangeSet,sl),this.renderView.requestRender())}schedule(e,i){return this._frameTask.schedule(e,i)}reschedule(e,i){return this._frameTask.reschedule(e,i)}syncLayer(e){this._layerSyncSet.add(e),this.renderView.requestRender()}get layers(){return this._layers}addRenderPlugin(e,i){const r=this.renderer.plugins.add(e,i),s=()=>{Oye(e)&&this.view.sceneIntersectionHelper.addIntersectionHandler(e)};if($a(r))return r.then(s);s()}removeRenderPlugin(e){this.destroyed||(Oye(e)&&this.view.sceneIntersectionHelper.removeIntersectionHandler(e),this.renderer.plugins.remove(e))}get test(){}};d([m({constructOnly:!0})],bh.prototype,"view",void 0),d([m({constructOnly:!0})],bh.prototype,"options",void 0),d([m({readOnly:!0})],bh.prototype,"viewingMode",null),d([m({constructOnly:!0})],bh.prototype,"container",void 0),d([m({readOnly:!0})],bh.prototype,"updating",null),d([m({readOnly:!0})],bh.prototype,"renderView",null),d([m({readOnly:!0})],bh.prototype,"renderer",null),d([m({readOnly:!0})],bh.prototype,"textures",null),d([m({readOnly:!0})],bh.prototype,"readyToRun",null),bh=d([k("esri.views.3d.webgl-engine.Stage")],bh);let pRt=class{constructor(){this.position0=R(),this.position1=R(),this.faceNormal0=R(),this.faceNormal1=R(),this.componentIndex=0,this.cosAngle=0}};const QF=-1;function xsi(t,e,i){const r=t.vertices.position,s=t.vertices.componentIndex,n=cc.position0,a=cc.position1,o=cc.faceNormal0,l=cc.faceNormal1,{edges:c,normals:h}=yRt(t),f=c.length/4,y=e.allocate(f);let _=0;const w=f,x=i?.allocate(w);let S=0,$=0,A=0;dP.length=0;for(let F=0;F<f;++F){const U=4*F;r.getVec(c.data[U],n),r.getVec(c.data[U+1],a);const N=dP.pushNew();N.index=4*F,N.length=Ri(n,a)}dP.sort((F,U)=>U.length-F.length);const M=new Array,P=new Array;dP.forAll(({length:F,index:U})=>{const N=c.data[U],j=c.data[U+1],B=c.data[U+2],Y=c.data[U+3],G=Y===QF;if(r.getVec(N,n),r.getVec(j,a),G){const Z=3*B;ve(o,h.data[Z],h.data[Z+1],h.data[Z+2]),de(l,o),cc.componentIndex=s.get(N),cc.cosAngle=Oe(o,l)}else{let Z=3*B;if(ve(o,h.data[Z],h.data[Z+1],h.data[Z+2]),Z=3*Y,ve(l,h.data[Z],h.data[Z+1],h.data[Z+2]),cc.componentIndex=s.get(N),cc.cosAngle=Oe(o,l),mRt(cc,wRt))return;cc.cosAngle<-.9999&&de(l,o)}$+=F,A++,G||fRt(cc,SRt)?(e.write(y,_++,cc),M.push(F)):gRt(cc,pke)&&(x&&i&&i.write(x,S++,cc),P.push(F))});const O=new Float32Array(M.reverse()),D=new Float32Array(P.reverse()),L=x&&i?{instancesData:x.slice(0,S),lodInfo:{lengths:D}}:void 0;return{regular:{instancesData:y.slice(0,_),lodInfo:{lengths:O}},silhouette:L,averageEdgeLength:$/A}}function fRt(t,e){return t.cosAngle<e}function mRt(t,e){return t.cosAngle>e}function gRt(t,e){const i=Ga(t.cosAngle);return Hv(Pve,t.position1,t.position0),i*(Oe(bt(bRt,t.faceNormal0,t.faceNormal1),Pve)>0?-1:1)>e}function yRt(t){const e=t.faces.length/3,i=t.faces,r=t.neighbors,s=t.vertices.position;$l.length=XF.length=0;for(let n=0;n<e;n++){const a=3*n,o=r[a],l=r[a+1],c=r[a+2],h=i[a],f=i[a+1],y=i[a+2];s.getVec(h,H1),s.getVec(f,gk),s.getVec(y,yk),Ce(gk,gk,H1),Ce(yk,yk,H1),bt(H1,gk,yk),Ee(H1,H1),XF.pushArray(H1),(o===QF||h<f)&&($l.push(h),$l.push(f),$l.push(n),$l.push(o)),(l===QF||f<y)&&($l.push(f),$l.push(y),$l.push(n),$l.push(l)),(c===QF||y<h)&&($l.push(y),$l.push(h),$l.push(n),$l.push(c))}return{edges:$l,normals:XF}}let _Rt=class{constructor(){this.index=0,this.length=0}};function vRt(){dP.prune(),$l.prune(),XF.prune()}const dP=new _i({allocator:t=>t||new _Rt,deallocator:null}),$l=new _i({deallocator:null}),XF=new _i({deallocator:null}),cc=new pRt,bRt=R(),Pve=R(),H1=R(),gk=R(),yk=R(),pke=Lt(4),wRt=Math.cos(pke),xRt=Lt(35),SRt=Math.cos(xRt),Rve=Symbol("analyses-owner-handles");let t_=class extends Me{constructor(e){super(e),this._allAnalysisViews=new He,this._creatingViewCount=0,this._attachedToViewResolver=Dve(),this._items=new Map,this._moduleMap=new Map,this._scheduledUpdateHandle=null,this._emitOnView=(i,r)=>this.view.emit(i,r)}destroy(){this._disconnectOwners(),this._attachedToViewResolver.reject(Xt("AnalysisViewManager was destroyed")),this._set("view",null)}attach(){this._connectOwners(),this._attachedToViewResolver.resolve()}detach(){this._disconnectOwners(),this._attachedToViewResolver.reject(Xt()),this._attachedToViewResolver=Dve()}get updating(){return!this.view.ready||this._creatingViewCount!==0||this._allAnalysisViews.some(e=>e.updating)}get testInfo(){}async whenAnalysisView(e){await this._attachedToViewResolver.promise;const i=this._items.get(e);if(i==null||i.state.list===1)throw new ee("AnalysisViewManager:no-analysis-view-for-analysis","The analysis does not exist in view.analyses",{analysis:e});return i.createAnalysisViewTask.promise}_connectOwners(){this.addHandles(this._connectAnalysesCollection(this.view.analyses),Rve)}_disconnectOwners(){this.removeHandles(Rve),this._update(),this._creatingViewCount=0}_connectAnalysesCollection(e){for(const s of e)this._addAnalysis(s);const i=e.on("after-add",s=>this._addAnalysis(s.item)),r=e.on("after-remove",s=>this._removeAnalysis(s.item));return ci(()=>{i.remove(),r.remove();for(const s of e)this._removeAnalysis(s)})}_addAnalysis(e){const i=this._items.get(e);if(i==null){const r={state:{view:0,list:0},analysis:e,view:null,createAnalysisViewTask:null};this._items.set(e,r),r.createAnalysisViewTask=Bc(s=>this._createAnalysisViewPromise(r,s).then(n=>(this._emitOnView("analysis-view-create",{analysis:e,analysisView:n}),n),n=>{throw this._emitOnView("analysis-view-create-error",{analysis:e,error:n}),n}))}else i.state.list=0}_removeAnalysis(e){const i=this._items.get(e);i!=null?(i.state.list=1,this._scheduleUpdate()):fe.getLogger(this).error("Trying to remove analysis which was not added")}_scheduleUpdate(){this._scheduledUpdateHandle==null&&(this._scheduledUpdateHandle=oM(()=>this._update()))}_update(){this._scheduledUpdateHandle=Ki(this._scheduledUpdateHandle),this._items.forEach(e=>{if(e.state.list!==1)return;const{analysis:i,view:r}=e;switch(this._items.delete(i),e.state.view){case 0:e.createAnalysisViewTask=ps(e.createAnalysisViewTask);break;case 1:r!=null&&(this._allAnalysisViews.remove(r),e.view=Re(r),e.createAnalysisViewTask=null,this._emitOnView("analysis-view-destroy",{analysis:i,analysisView:r}))}})}async _createAnalysisViewPromise(e,i){const{analysis:r}=e;if(this._creatingViewCount+=1,!this._moduleMap.has(r.type))try{this._moduleMap.set(r.type,await this.importAnalysisViewModule(r))}catch{throw this._creatingViewCount-=1,new ee("AnalysisViewManager:no-analysis-view-for-analysis",`Analysis of type "${r.type}" is not supported`)}if(Rn(i))throw this._creatingViewCount-=1,Xt("AnalysisView creation aborted");const s=new(this._moduleMap.get(r.type)).default({analysis:r,view:this.view});let n=!0;qa(i,()=>{n&&this._destroyAnalysisView(r,s)});try{await s.when()}catch(a){throw n=!1,this._destroyAnalysisView(r,s),a}if(Rn(i))throw Xt();return n=!1,e.view=s,e.state.view=1,this._allAnalysisViews.add(s),this._creatingViewCount-=1,s}_destroyAnalysisView(e,i){i.destroyed||(this._creatingViewCount-=1,i.destroy(),this._emitOnView("analysis-view-destroy",{analysis:e,analysisView:i}))}};d([m()],t_.prototype,"updating",null),d([m({constructOnly:!0})],t_.prototype,"importAnalysisViewModule",void 0),d([m({constructOnly:!0})],t_.prototype,"view",void 0),d([m()],t_.prototype,"_allAnalysisViews",void 0),d([m()],t_.prototype,"_creatingViewCount",void 0),t_=d([k("esri.views.support.AnalysisViewManager")],t_);const TRt=t_;function Dve(){const t=lo();return t.promise.catch(()=>{}),t}function _H(t,e){return e?"xoffset"in e&&e.xoffset?Math.max(t,Math.abs(e.xoffset)):"yoffset"in e&&e.yoffset?Math.max(t,Math.abs(e.yoffset||0)):t:t}function $Rt(t){let e=0,i=0;for(let r=0;r<t.length;r++){const s=t[r].size;typeof s=="number"&&(e+=s,i++)}return e/i}function Ive(t,e){return typeof t=="number"?t:t?.stops?.length?$Rt(t.stops):e}function CRt(t,e){if(!e)return t;const i=e.filter(a=>a.type==="size").map(a=>{const{maxSize:o,minSize:l}=a;return(Ive(o,t)+Ive(l,t))/2});let r=0;const s=i.length;if(s===0)return t;for(let a=0;a<s;a++)r+=i[a];const n=Math.floor(r/s);return Math.max(n,t)}function MRt(t){const e=t?.renderer,i=t?.pointerType,r=i==="touch"?9:6;if(!e)return r;const s="visualVariables"in e?CRt(r,e.visualVariables):r;if(e.type==="simple")return _H(s,e.symbol);if(e.type==="unique-value"){let n=s;return e.uniqueValueInfos?.forEach(a=>{n=_H(n,a.symbol)}),n}if(e.type==="class-breaks"){let n=s;return e.classBreakInfos.forEach(a=>{n=_H(n,a.symbol)}),n}return e.type==="dot-density"||e.type,s}function ERt(t,e,i,r=new Bt){let s=0;if(i.type==="2d")s=e*(i.resolution??0);else if(i.type==="3d"){const h=i.overlayPixelSizeInMapUnits(t),f=i.basemapSpatialReference;s=f==null||f.equals(i.spatialReference)?e*h:Wr(f)/Wr(i.spatialReference)}const n=t.x-s,a=t.y-s,o=t.x+s,l=t.y+s,{spatialReference:c}=i;return r.xmin=Math.min(n,o),r.ymin=Math.min(a,l),r.xmax=Math.max(n,o),r.ymax=Math.max(a,l),r.spatialReference=c,r}function $si(t,e,i){const r=i.toMap(t);return r==null?!1:ERt(r,MRt(),i,fke).intersects(e)}let fke=new Bt;function ARt(){fke=new Bt}function ORt(t){return e=>{if(t.destroyed){const r=e(sl);return $a(r)?r:Promise.resolve(r)}if(t.immediate)return t.immediate.schedule(e);const i="No immediate scheduler";throw console.error(i),new Error(i)}}const CV=new Set,mke=()=>fe.getLogger("esri/views/support/TextureCompressionHelper");function PRt(t,e){return Fi.compressionWorkerHandle??=new z$t(ORt(e)),CV.has(t)?mke().warn("Repeated texture compression worker initialization by the same view."):CV.add(t),Fi.compressionWorkerHandle}function RRt(t){const e=Fi.compressionWorkerHandle;e&&(CV.delete(t)||mke().warn("Unknown view attempted to destroy the texture compression worker."),CV.size||(e.destroyWorkerAndSelf(),Fi.compressionWorkerHandle=null))}let Lve;function DRt(){return Lve??=kRt(),Lve}let IRt=class{constructor(){this.available=!1,this.majorPerformanceCaveat=!1,this.maxTextureSize=0,this.supportsVertexShaderSamplers=!1,this.supportsHighPrecisionFragment=!1,this.supportsColorBufferFloat=!1,this.supportsColorBufferFloatBlend=!1,this.supportsColorBufferHalfFloat=!1,this.unmaskedRenderer="unloaded"}};function LRt(t){if(typeof WebGL2RenderingContext>"u")return null;const e=document.createElement("canvas");if(!e)return null;let i=e.getContext("webgl2",{failIfMajorPerformanceCaveat:!0});if(i==null&&(i=e.getContext("webgl2"),i!=null&&(t.majorPerformanceCaveat=!0,t.unmaskedRenderer=ske(i)?.getUnmaskedRenderer()??"unknown")),i==null)return i;t.available=!0,t.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),t.supportsVertexShaderSamplers=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;const r=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT);return r&&(t.supportsHighPrecisionFragment=r.precision>0),i}function kRt(){const t=new IRt,e=LRt(t);return e==null||(t.supportsColorBufferFloat=e.getExtension("EXT_color_buffer_float")!==null,t.supportsColorBufferFloatBlend=e.getExtension("EXT_float_blend")!==null,t.supportsColorBufferHalfFloat=t.supportsColorBufferFloat||e.getExtension("EXT_color_buffer_half_float")!==null),t}function zRt(t){const e=DRt();return e.available?t==="3d"&&e.majorPerformanceCaveat?new ee("webgl:major-performance-caveat-detected",`Your WebGL implementation (${e.unmaskedRenderer}) doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist.`):e.supportsHighPrecisionFragment?e.supportsVertexShaderSamplers?null:new ee("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported."):new ee("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported."):new ee("webgl:required","WebGL2 is required but not supported.",new Error().stack)}const FRt="--esri-calcite-mode-name";function NRt(){const t=getComputedStyle(document.body).getPropertyValue(FRt).replaceAll(/\W/g,"").toLowerCase();return t==="dark"||t==="light"?t:void 0}const gke="calcite-mode-";function yke(t){return NRt()??EUe(t??document.body)}function Msi(t){return yke(t)==="dark"}function VRt(t){return`${gke}${yke(t)}`}function URt(t){const e=VRt(t);BRt(t),t.classList.add(e)}function BRt(t){Array.from(t.classList).forEach(e=>{e.startsWith(gke)&&t.classList.remove(e)})}const jRt={left:0,top:0,bottom:0,right:0},_ke={bottom:30,top:15,right:15,left:15},Bm="esri-ui",uc={ui:Bm,corner:`${Bm}-corner`,innerContainer:`${Bm}-inner-container`,manualContainer:`${Bm}-manual-container`,cornerContainer:`${Bm}-corner-container`,topLeft:`${Bm}-top-left`,topRight:`${Bm}-top-right`,bottomLeft:`${Bm}-bottom-left`,bottomRight:`${Bm}-bottom-right`};function qRt(t){return t&&!t._started&&typeof t.postMixInProperties=="function"&&typeof t.buildRendering=="function"&&typeof t.postCreate=="function"&&typeof t.startup=="function"}function _k(t){return t===0?"0":`${t}px`}function vH(t){const e=typeof t=="object"&&t!==null&&Object.getPrototypeOf(t);return(e===null||e===Object.prototype)&&("component"in t||"index"in t||"position"in t)?t:null}function bH(t,{top:e,bottom:i,left:r,right:s}){t.style.top=e,t.style.bottom=i,t.style.left=r,t.style.right=s}let mf=class extends Uc{constructor(e){super(e),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentMap=new Map,this._removeWidgetHandleKey=Symbol("componentOnRemoveSymbol"),this._locale=Lc(),this.view=null,this._applyViewPadding=()=>{const i=this.container;i&&bH(i,this._toPixelPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const i=this._innerContainer;i&&bH(i,this._toPixelPosition(this.padding))},this._initContainers()}initialize(){this.addHandles([K(()=>[this.view?.padding,this.container],this._applyViewPadding,Wt),K(()=>this.padding,this._applyUIPadding,Wt),K(()=>[this.container,this._locale],([e,i])=>{e&&e.setAttribute("lang",i)},Wt),fSe(e=>{this._locale=e})])}destroy(){this.removeAllHandles(),this.container=null;for(const e of this._components)e.destroy();this._components.length=0,this._componentMap.clear(),this.view=null,this._set("view",null)}set container(e){const i=this._get("container");e!==i&&(e&&(e.classList.add(uc.ui),URt(e),this._attachContainers(e)),i&&(i.classList.remove(uc.ui),bH(i,{top:"",bottom:"",left:"",right:""}),i.textContent=""),this._set("container",e))}get height(){const e=this.view?.height??0;if(e===0)return e;const i=this._getViewPadding(),{top:r,bottom:s}=i;return Math.max(e-r-s,0)}get padding(){return this._get("padding")}set padding(e){this._overrideIfSome("padding",e)}castPadding(e){return typeof e=="number"?{bottom:e,top:e,right:e,left:e}:{..._ke,...e}}get width(){const e=this.view?.width??0;if(e===0)return e;const i=this._getViewPadding(),{left:r,right:s}=i;return Math.max(e-r-s,0)}add(e,i){let r,s,n;if(Array.isArray(e))return void e.forEach(o=>this.add(o,i));const a=vH(e);a&&({index:r,position:i,component:e,key:s}=a),i&&typeof i=="object"&&({index:r,key:s,position:i,internal:n}=i),!e||i&&!this._isValidPosition(i)||this._add(e,i,r??this._getNumComponentsAtPosition(i),s,n)}remove(e,i){if(!e)return;if(Array.isArray(e))return e.map(s=>this.remove(s,i));const r=this._find(e);if(r){const s=this._componentMap.get(r);if(!s||s.key!==i)return;const n=this._components.indexOf(r);return r.node.parentNode?.removeChild(r.node),this._componentMap.delete(r),r.widget?.removeHandlesReference(this._removeWidgetHandleKey),this._components.forEach(o=>{const l=this._componentMap.get(o);l&&l.position===s.position&&l.index>s.index&&l.index--}),this._components.splice(n,1)[0]}}empty(e,i={removeInternal:!1}){if(Array.isArray(e)){for(const n of e)this.empty(n,i);return}const r=this._positionNameToContainerLookup[e??"manual"],s=Array.prototype.slice.call(r.children).map(n=>this._findByNode(n)).filter(n=>n==null?!1:!(this._componentMap.get(n)?.internal??!1)||i.removeInternal);for(const n of s)this.remove(n)}move(e,i){if(Array.isArray(e)&&e.forEach(a=>this.move(a,i)),!e)return;let r;const s=vH(e)||vH(i);if(s&&(r=s.index,i=s.position,e=s.component||e),i&&!this._isValidPosition(i))return;const n=this.remove(e);n&&this.add(n,{position:i,index:r})}find(e){if(!e)return null;const i=this._findById(e);return i&&(i.widget||i.node)}getComponents(e,i={includeInternal:!1}){return e?Array.isArray(e)?e.flatMap(r=>this._getComponentsAtPosition(r,i)):this._getComponentsAtPosition(e,i):this._components.filter(r=>i.includeInternal||!this._componentMap.get(r)?.internal).map(({widget:r,node:s})=>r??s)}getPosition(e){for(const i in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[i].contains(e))return i;return null}_add(e,i,r,s,n){e instanceof eR||(e=new eR({node:e}));const{widget:a}=e;a!=null&&a instanceof Me&&a.addHandles(ci(()=>{queueMicrotask(()=>this.remove(e))}),this._removeWidgetHandleKey);const o=this._positionNameToContainerLookup[i];this._components.some(l=>{const c=this._componentMap.get(l)?.position,h=c?this._positionNameToContainerLookup[c]:null;return o===h&&this._componentMap.get(l)?.index===r})&&this._components.forEach(l=>{const c=this._componentMap.get(l),h=c?.position,f=h?this._positionNameToContainerLookup[h]:null;c&&f===o&&c.index>=r&&c.index++}),this._place({component:e,position:i,index:r}),this._components.push(e),this._componentMap.set(e,{key:s,position:i,internal:n,index:r})}_find(e){return e?e instanceof eR?this._findByComponent(e):typeof e=="string"?this._findById(e):"domNode"in e?this._findByNode(e.domNode):this._findByNode(e):null}_getViewPadding(){return this.view?.padding??jRt}_attachContainers(e){e.appendChild(this._innerContainer),e.appendChild(this._manualContainer)}_initContainers(){const e=document.createElement("div");e.classList.add(uc.innerContainer,uc.cornerContainer);const i=document.createElement("div");i.classList.add(uc.innerContainer,uc.manualContainer);const r=document.createElement("div");r.classList.add(uc.topLeft,uc.corner),e.appendChild(r);const s=document.createElement("div");s.classList.add(uc.topRight,uc.corner),e.appendChild(s);const n=document.createElement("div");n.classList.add(uc.bottomLeft,uc.corner),e.appendChild(n);const a=document.createElement("div");a.classList.add(uc.bottomRight,uc.corner),e.appendChild(a),this._innerContainer=e,this._manualContainer=i;const o=Opt();this._cornerNameToContainerLookup={"top-left":r,"top-right":s,"bottom-left":n,"bottom-right":a,"top-leading":o?s:r,"top-trailing":o?r:s,"bottom-leading":o?a:n,"bottom-trailing":o?n:a},this._positionNameToContainerLookup={manual:i,...this._cornerNameToContainerLookup}}_isValidPosition(e){return!!this._positionNameToContainerLookup[e]}_place(e){const i=e.position??"manual",{component:r,index:s}=e,n=this._positionNameToContainerLookup[i],a=s!=null&&s>-1;if(qRt(r.widget)&&r.widget.startup(),!a)return void n.appendChild(r.node);const o=Array.from(n.children);if(o.length!==0){for(const l of o){const c=this._findByNode(l);if(c&&s<(this._componentMap.get(c)?.index??0))return void l.parentNode?.insertBefore(r.node,l)}n.appendChild(r.node)}else n.appendChild(r.node)}_toPixelPosition(e){return{top:_k(e.top),left:_k(e.left),right:_k(e.right),bottom:_k(e.bottom)}}_findByComponent(e){return this._components.find(i=>i===e)??null}_findById(e){return this._components.find(({id:i})=>i===e)??null}_findByNode(e){return e?this._components.find(({node:i})=>i===e):null}_getComponentsAtPosition(e,i){const r=this._positionNameToContainerLookup[e];return Array.prototype.slice.call(r.children).map(s=>this._findByNode(s)).filter(qf).filter(s=>i.includeInternal||!this._componentMap.get(s)?.internal).map(({widget:s,node:n})=>s??n)}_getNumComponentsAtPosition(e){return this._positionNameToContainerLookup[e]?.children.length??0}};d([m()],mf.prototype,"_locale",void 0),d([m()],mf.prototype,"container",null),d([m()],mf.prototype,"height",null),d([m({value:_ke})],mf.prototype,"padding",null),d([qr("padding")],mf.prototype,"castPadding",null),d([m()],mf.prototype,"view",void 0),d([m()],mf.prototype,"width",null),mf=d([k("esri.views.ui.UI")],mf);const GRt=mf,Asi=-1,HRt=-2;let pP,fP=null;const V_=new Map;async function Osi(t){fP==null&&(pP==null&&(pP=te(()=>import("./Lyr3DWasmPerSceneView-DcYURmqY.js"),__vite__mapDeps([371,93]))),fP=await pP);const e=t.view;let i=V_.get(e);i||(i=new fP.default({view:e}),V_.set(e,i));const r=!!e.stage.renderView.renderingContext.capabilities.compressedTextureS3TC,s=!!e.stage.renderView.renderingContext.capabilities.compressedTextureETC;await i.initializeWasm(r,s);const n=i.addLayerView(t);if(n.wasmLayerId<0)throw i.getValidLayerViewCount()<1&&(V_.delete(e),V_.size===0&&(pP=null,fP=null)),n.wasmLayerId===HRt?new ee("tiles3d:addLayer-failure","The 3d tiles layer web assembly module failed to download.",{}):new ee("tiles3d:addLayer-failure",n.check?.errorDescription??"The 3d tiles layer description was invalid.",{});return n.wasmLayerId}function WRt(t){return V_.get(t)}function Psi(t){const e=t.view,i=V_.get(e);i&&i.removeLayerView(t)<1&&(V_.delete(e),V_.size===0&&(pP=null,fP=null))}function kve(t,e){return t&&"copyright"in t&&(!e||typeof t.originOf=="function"&&t.originOf("copyright")==="user")}function ZRt(t,e){return t.length!==e.length||t.some((i,r)=>i.text!==e[r].text)}function vk(t,e,i){!i||!e||t.find(r=>r.layerView===e&&r.text===i)||t.push({text:i,layerView:e})}function YRt(t){return t.type==="bing-maps"}const ef=[];let BT=class extends Me{constructor(e){super(e),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.removeHandles("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new He,this.view=null,this._allLayerViewsChange=i=>{this.removeHandles("suspension"),this.removeHandles("visible-geometry-changed");const r=this.view?.allLayerViews;r&&(this.addHandles(r.map(s=>K(()=>[s.suspended,s.layer?.attributionVisible],()=>this._updateAttributionItems())).toArray(),"suspension"),r.forEach(s=>{s.declaredClass==="esri.views.3d.layers.IntegratedMesh3DTilesLayerView3D"&&this.addHandles(s.on("visible-geometry-changed",()=>this._updateAttributionItems()),"visible-geometry-changed")})),i?.removed&&i.removed.forEach(s=>{this._pendingAttributions.delete(s),this._fetchedAttributionData.delete(s)}),this._updateAttributionItems()},this.addHandles([Ys(()=>this.view?.allLayerViews,"change",i=>this._allLayerViewsChange(i),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),Zs(()=>this.view?.stationary===!0,()=>this._updateAttributionItems())])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){return this.view?.ready?this._pendingAttributions.size>0?"loading":"ready":"disabled"}_updateAttributionItems(){const e=this.view,i=e?.allLayerViews;ef.length=0;let r=!1,s=null;if(!e||!i)return void this._clear();i.forEach(a=>{if(a.suspended||!a.layer?.attributionVisible)return;const o=a.layer;if(kve(o,"user"))return void vk(ef,a,o.copyright);if(o.type==="integrated-mesh-3dtiles"&&o.hasGoogleUrl&&(r=!0,s=a),o.hasAttributionData){if(this._fetchedAttributionData.has(a)){const c=this._fetchedAttributionData.get(a);return void(c?vk(ef,a,this._getDynamicAttribution(c,e,o)):kve(o)&&vk(ef,a,o.copyright))}return void this._fetchAttributionData(a)}const l="portalItem"in o?o.portalItem?.accessInformation:void 0;vk(ef,a,l||o.copyright)});const n=i.find(a=>a.layer?.type==="integrated-mesh-3dtiles");if(this.view&&n){const a=WRt(this.view);if(a){const o=a.getAttributionText();for(let l=o.length-1;l>-1;--l)ef.unshift({text:o[l],layerView:n})}}r&&s&&ef.unshift({text:"Google Maps",layerView:s}),ZRt(this.items,ef)&&(this.items.removeAll(),this.items.addMany(ef)),ef.length=0,this.notifyChange("state")}async _fetchAttributionData(e){if(this._pendingAttributions.has(e))return;this._pendingAttributions.add(e);const i=await Xf(e.layer.fetchAttributionData());if(this._pendingAttributions.has(e)){const r=i.ok?this._createContributionIndex(i.value,YRt(e.layer)):null;this._pendingAttributions.delete(e),this._fetchedAttributionData.set(e,r)}this._updateAttributionItems()}_createContributionIndex(e,i){const r=e.contributors,s={};if(!r)return s;for(let n=0;n<r.length;n++){const a=r[n],o=a.coverageAreas;if(!o)return;for(const l of o){const c=l.bbox,h=l.zoomMin-(i&&l.zoomMin?1:0),f=l.zoomMax-(i&&l.zoomMax?1:0),y=new Bt({xmin:c[1],ymin:c[0],xmax:c[3],ymax:c[2],spatialReference:Ie.WGS84}),_={extent:U_(y),attribution:a.attribution||"",score:l.score!=null?l.score:100,id:n};for(let w=h;w<=f;w++)s[w]??=[],s[w].push(_)}}return s.maxKey=Math.max.apply(null,Object.keys(s)),s}_getDynamicAttribution(e,i,r){const{extent:s,scale:n}=i;let a=r.tileInfo?.scaleToZoom(n)??0;if(a=Math.min(e.maxKey??0,Math.round(a)),!s||a==null||a<=-1)return"";const o=e[a],l=QD(s.center.clone().normalize(),Ie.WebMercator),c=new Set;return o?o.filter(h=>{const f=h.id,y=!c.has(f)&&l&&h.extent&&XK(h.extent,l);return y&&c.add(f),y}).sort((h,f)=>f.score-h.score||h.objectId-f.objectId).map(h=>h.attribution).join(", "):""}};d([m({readOnly:!0,type:He})],BT.prototype,"items",void 0),d([m({readOnly:!0})],BT.prototype,"state",null),d([m()],BT.prototype,"view",void 0),BT=d([k("esri.widgets.Attribution.AttributionViewModel")],BT);const vke=BT,ku={button:"esri-button",buttonDisabled:"esri-button--disabled",buttonHalf:"esri-button--half",buttonSecondary:"esri-button--secondary",buttonSmall:"esri-button--small",buttonTertiary:"esri-button--tertiary",buttonThird:"esri-button--third",empty:"esri-widget__content--empty",heading:"esri-widget__heading",interactive:"esri-interactive",panel:"esri-widget--panel",table:"esri-widget__table",widget:"esri-widget",widgetButton:"esri-widget--button",widgetDisabled:"esri-widget--disabled"};function QRt(){return function(t,e){if(!t[e])throw new TypeError(`Cannot auto bind undefined function '${String(e)}'`);return{value:JRt(t[e])}}}function XRt(t){const e=t?.type;return t instanceof KeyboardEvent||e==="keyup"||e==="keydown"||e==="keypress"}function JRt(t){return function(e,...i){XRt(e)?Ppt(e.key)&&(e.preventDefault(),e.stopPropagation(),e.target.click()):t.call(this,e,...i)}}const tT="esri-attribution",iT={base:tT,poweredBy:`${tT}__powered-by`,sources:`${tT}__sources`,open:`${tT}--open`,sourcesOpen:`${tT}__sources--open`,link:`${tT}__link`};let Cl=class extends Pp{constructor(e,i){super(e,i),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._sourcesNode=null,this._overflowRequestAnimationFrame=null,this._resizeObserver=new ResizeObserver(r=>{r.forEach(({target:s})=>{this._scheduleOverflowCheck(s)})}),this._mutationObserver=new MutationObserver(r=>{let s=!1;for(const n of r)if(n.type==="childList"||n.type==="characterData"||n.type==="attributes"){s=!0;break}s&&this._sourcesNode&&this._scheduleOverflowCheck(this._sourcesNode)}),this.itemDelimiter=" | ",this.messages=null,this.viewModel=new vke}initialize(){this.addHandles(Ys(()=>this.viewModel?.items,"change",()=>this.scheduleRender()))}destroy(){this._resizeObserver?.disconnect(),this._mutationObserver?.disconnect(),this._overflowRequestAnimationFrame!=null&&(cancelAnimationFrame(this._overflowRequestAnimationFrame),this._overflowRequestAnimationFrame=null)}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}_scheduleOverflowCheck(e){this._overflowRequestAnimationFrame==null&&(this._overflowRequestAnimationFrame=requestAnimationFrame(()=>{this._overflowRequestAnimationFrame=null,this._checkSourceTextOverflow(e)}))}get attributionText(){return this.viewModel.items.reduce((e,i)=>(e.includes(i.text)||e.push(i.text),e),[]).join(this.itemDelimiter)}get icon(){return"description"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e={[iT.open]:this._isOpen};return St("div",{bind:this,class:this.classes(iT.base,ku.widget,e),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this._renderSourcesNode(),this._renderPoweredBy())}_renderPoweredBy(){return St("div",{class:iT.poweredBy},"Powered by"," ",St("a",{class:iT.link,href:"https://www.esri.com/",rel:"noreferrer",target:"_blank"},"Esri"))}_renderSourcesNode(){const e=this._isOpen,i=this._isInteractive,r=i?0:void 0,{attributionText:s}=this,n={[iT.sourcesOpen]:e,[ku.interactive]:i};return St("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes(iT.sources,n),innerHTML:s,tabIndex:r})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth,this._sourcesNode=e,this._resizeObserver.observe(e),this._mutationObserver.observe(e,{subtree:!0,childList:!0,characterData:!0,attributes:!0}),this._scheduleOverflowCheck(e)}_checkSourceTextOverflow(e){let i=!1;const{clientHeight:r,clientWidth:s,scrollWidth:n}=e,a=n>s,o=this._attributionTextOverflowed!==a;if(this._attributionTextOverflowed=a,o&&(i=!0),this._isOpen){const l=r<this._prevSourceNodeHeight;this._prevSourceNodeHeight=r,l&&(this._isOpen=!1,i=!0)}i&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};d([m()],Cl.prototype,"_isOpen",void 0),d([m()],Cl.prototype,"_isInteractive",null),d([m()],Cl.prototype,"_attributionTextOverflowed",void 0),d([m()],Cl.prototype,"_prevSourceNodeHeight",void 0),d([m({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],Cl.prototype,"attributionText",null),d([m()],Cl.prototype,"icon",null),d([m()],Cl.prototype,"itemDelimiter",void 0),d([m()],Cl.prototype,"label",null),d([m(),Wh("esri/widgets/Attribution/t9n/Attribution")],Cl.prototype,"messages",void 0),d([m()],Cl.prototype,"view",null),d([m({type:vke})],Cl.prototype,"viewModel",void 0),d([QRt()],Cl.prototype,"_toggleState",null),Cl=d([k("esri.widgets.Attribution")],Cl);const KRt=Cl;function eDt(){const t=ie("mapview-essential-goto-duration");return t==null?t:t}function tDt(t){return t?.spatialReference?.isWebMercator||t?.spatialReference?.isGeographic||!1}function iDt(t,e,i){return t.goTo(e,i)}const rDt=t=>{const e=t;let i=class extends e{constructor(...r){super(...r),this.goToOverride=null,this.view=null}callGoTo(r){const{view:s}=this;return rM(s),this.goToOverride?this.goToOverride(s,r):iDt(s,r.target,r.options)}};return d([m()],i.prototype,"goToOverride",void 0),d([m()],i.prototype,"view",void 0),i=d([k("esri.widgets.support.GoTo")],i),i};let Eb=class extends rDt(Me){constructor(e){super(e),this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this._watchForView(Wt)}destroy(){this.view=null}get canShowNorth(){return tDt(this.view)}get state(){return!this.view?.ready||this.view.type==="2d"&&!this.view.constraints.rotationEnabled?"disabled":this.canShowNorth?"compass":"rotation"}reset(){this.view?.ready&&(this.view?.type==="2d"?this.callGoTo({target:{rotation:0},options:{animationMode:"always",duration:eDt()}}):this.callGoTo({target:{heading:0}}))}_updateForRotation(e){e!=null&&this._set("orientation",{z:e})}_updateForCamera(e){if(!e)return;const i=-e.heading;this._set("orientation",{x:0,y:0,z:i})}_updateRotationWatcher(e){this.removeAllHandles(),this._watchForView(),e&&this.addHandles(e.type==="2d"?K(()=>e?.rotation,this._updateForRotation,Wt):K(()=>e?.camera,this._updateForCamera,Wt))}_watchForView(e){this.addHandles(K(()=>this.view,this._updateRotationWatcher,e))}};d([m({readOnly:!0})],Eb.prototype,"canShowNorth",null),d([m({readOnly:!0})],Eb.prototype,"orientation",void 0),d([m({readOnly:!0})],Eb.prototype,"state",null),d([m()],Eb.prototype,"view",void 0),Eb=d([k("esri.widgets.Compass.CompassViewModel")],Eb);const bke=Eb,zve="esri-compass",Fve={base:zve,iconContainer:`${zve}__icon-container`};let ug=class extends Pp{constructor(e,i){super(e,i),this.messages=null,this.viewModel=new bke,this._reset=()=>{this.viewModel.reset()},this._toRotationTransform=r=>({transform:`rotateZ(${r.z}deg)`})}loadDependencies(){return Jv({button:()=>te(()=>import("./index-Bqoy6DTr.js"),__vite__mapDeps([372,373,374,375,376])),icon:()=>te(()=>Promise.resolve().then(()=>vbe),void 0)})}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get icon(){return this.viewModel.state==="rotation"?"arrow-up":"compass-needle"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}reset(){return this.viewModel.reset()}render(){const{orientation:e,state:i}=this.viewModel,{messages:r}=this;return St("div",{class:this.classes(Fve.base,ku.widget)},St("calcite-button",{class:ku.widgetButton,disabled:i==="disabled",kind:"neutral",label:r.reset,onclick:this._reset,round:!0,scale:"s",title:r.reset},St("div",{"aria-hidden":"true",class:Fve.iconContainer,title:r.reset},St("calcite-icon",{icon:this.icon,styles:this._toRotationTransform(e)}))))}};d([m()],ug.prototype,"goToOverride",null),d([m()],ug.prototype,"icon",null),d([m()],ug.prototype,"label",null),d([m(),Wh("esri/widgets/Compass/t9n/Compass")],ug.prototype,"messages",void 0),d([m()],ug.prototype,"view",null),d([m({type:bke})],ug.prototype,"viewModel",void 0),ug=d([k("esri.widgets.Compass")],ug);const sDt=ug,Nve="esri-navigation-toggle",Vve={base:Nve,isLayoutHorizontal:`${Nve}--horizontal`};let jT=class extends Me{constructor(e){super(e),this._navigationMode="pan",this.view=null,e?.isDefaultViewModel||tBe(fe.getLogger(this),"Navigation Toggle","arcgis-navigation-toggle",{version:"4.33"})}normalizeCtorArgs(e={}){const{isDefaultViewModel:i,...r}=e;return r}initialize(){this.addHandles(Zs(()=>this.view?.navigation?.actionMap,()=>this._updateNavigationActionMap()))}destroy(){this.view=null}get state(){return this.view?.ready&&this.view?.type==="3d"?"ready":"disabled"}get navigationMode(){return this._navigationMode}set navigationMode(e){this._navigationMode=e,this._updateNavigationActionMap()}toggle(){this.state!=="disabled"&&(this.navigationMode=this.navigationMode!=="pan"?"pan":"rotate")}_updateNavigationActionMap(){const e=this.view?.navigation?.actionMap;if(!e)return;const i=this._navigationMode==="pan";e.dragPrimary=i?"pan":"rotate",e.dragSecondary=i?"rotate":"pan"}};d([m({readOnly:!0})],jT.prototype,"state",null),d([m()],jT.prototype,"_navigationMode",void 0),d([m()],jT.prototype,"view",void 0),jT=d([k("esri.widgets.NavigationToggle.NavigationToggleViewModel")],jT);const wke=jT;let hg=class extends Pp{constructor(e,i){super(e,i),this.messages=null,this.viewModel=new wke({isDefaultViewModel:!0}),this.toggle=()=>this.viewModel.toggle(),this._panButton=null,this._rotateButton=null,this._toggle=()=>{const r=this.viewModel?.navigationMode==="pan"?this._rotateButton:this._panButton;Rpt(r),this.toggle()},e?.isDefaultUI||eBe(fe.getLogger(this),"Navigation Toggle","arcgis-navigation-toggle",{version:"4.32"})}normalizeCtorArgs(e={}){const{isDefaultUI:i,...r}=e;return r}loadDependencies(){return Jv({button:()=>te(()=>import("./index-Bqoy6DTr.js"),__vite__mapDeps([372,373,374,375,376]))})}get icon(){return"move"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e=this.viewModel?.state==="disabled",i=this.viewModel?.navigationMode==="pan",r=this.messages.toggle;return St("div",{class:this.classes(Vve.base,ku.widget,{[Vve.isLayoutHorizontal]:this.layout==="horizontal"})},St("calcite-button",{afterCreate:s=>{this._panButton=s},appearance:i?"outline-fill":"solid",class:ku.widgetButton,disabled:e,iconStart:"move",kind:"neutral",label:r,onclick:this._toggle,tabIndex:i?void 0:-1,title:r}),St("calcite-button",{afterCreate:s=>{this._rotateButton=s},appearance:i?"solid":"outline-fill",class:ku.widgetButton,disabled:e,iconStart:"rotate",kind:"neutral",label:r,onclick:this._toggle,tabIndex:i?-1:void 0,title:r}))}};d([m()],hg.prototype,"icon",null),d([m()],hg.prototype,"label",null),d([m({value:"vertical"})],hg.prototype,"layout",null),d([m(),Wh("esri/widgets/NavigationToggle/t9n/NavigationToggle")],hg.prototype,"messages",void 0),d([m()],hg.prototype,"view",null),d([m({type:wke})],hg.prototype,"viewModel",void 0),hg=d([k("esri.widgets.NavigationToggle")],hg);const nDt=hg;let Ab=class extends Me{get canZoomIn(){if(!this.view?.ready)return!1;const i=this.view?.constraints?.effectiveMaxScale;return i===0||this._scale>i}get canZoomOut(){const{view:e}=this;if(!e?.ready)return!1;const r=e.constraints?.effectiveMinScale;return r===0||this._scale<r}get _scale(){const e=this.view?.animation?.target;return(e&&"then"in e?void 0:e?.scale)??this.view?.scale??0}};d([m({readOnly:!0})],Ab.prototype,"canZoomIn",null),d([m({readOnly:!0})],Ab.prototype,"canZoomOut",null),d([m()],Ab.prototype,"view",void 0),d([m()],Ab.prototype,"_scale",null),Ab=d([k("esri.widgets.Zoom.ZoomConditions2D")],Ab);const aDt=Ab;let qT=class extends Me{get canZoomIn(){return!!this.view.ready}get canZoomOut(){return!!this.view.ready}};d([m({readOnly:!0})],qT.prototype,"canZoomIn",null),d([m({readOnly:!0})],qT.prototype,"canZoomOut",null),d([m()],qT.prototype,"view",void 0),qT=d([k("esri.widgets.Zoom.ZoomConditions3D")],qT);const oDt=qT;let i_=class extends Me{constructor(e){super(e)}destroy(){this.view=null}get canZoomIn(){return this._zoomConditions!=null&&this._zoomConditions.canZoomIn}get canZoomOut(){return this._zoomConditions!=null&&this._zoomConditions?.canZoomOut}get state(){return this.view?.ready?"ready":"disabled"}set view(e){e?e.type==="2d"?this._zoomConditions=new aDt({view:e}):e.type==="3d"&&(this._zoomConditions=new oDt({view:e})):this._zoomConditions=null,this._set("view",e)}zoomIn(){const e=this.view;this.canZoomIn&&e&&(e.type==="2d"?e.mapViewNavigation.zoomIn():Hf(e.goTo({zoomFactor:2})))}zoomOut(){const e=this.view;this.canZoomOut&&e&&(e.type==="2d"?e.mapViewNavigation.zoomOut():Hf(e.goTo({zoomFactor:.5})))}};d([m()],i_.prototype,"_zoomConditions",void 0),d([m()],i_.prototype,"canZoomIn",null),d([m()],i_.prototype,"canZoomOut",null),d([m({readOnly:!0})],i_.prototype,"state",null),d([m()],i_.prototype,"view",null),i_=d([k("esri.widgets.Zoom.ZoomViewModel")],i_);const xke=i_,Uve={base:"esri-zoom",horizontalLayout:"esri-zoom--horizontal"};let dg=class extends Pp{constructor(e,i){super(e,i),this.messages=null,this.viewModel=new xke,this.zoomIn=()=>this.viewModel.zoomIn(),this.zoomOut=()=>this.viewModel.zoomOut()}loadDependencies(){return Jv({button:()=>te(()=>import("./index-Bqoy6DTr.js"),__vite__mapDeps([372,373,374,375,376]))})}get icon(){return"magnifying-glass-plus"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}set view(e){this.viewModel.view=e}get view(){return this.viewModel.view}render(){const e={[Uve.horizontalLayout]:this.layout==="horizontal"},{canZoomIn:i,canZoomOut:r}=this.viewModel,{zoomIn:s,zoomOut:n}=this.messages;return St("div",{class:this.classes(Uve.base,ku.widget,e)},St("calcite-button",{class:ku.widgetButton,disabled:!i,iconStart:"plus",kind:"neutral",label:s,onclick:this.zoomIn,title:s}),St("calcite-button",{class:ku.widgetButton,disabled:!r,iconStart:"minus",kind:"neutral",label:n,onclick:this.zoomOut,title:n}))}};d([m()],dg.prototype,"icon",null),d([m()],dg.prototype,"label",null),d([m({value:"vertical"})],dg.prototype,"layout",null),d([m(),Wh("esri/widgets/Zoom/t9n/Zoom")],dg.prototype,"messages",void 0),d([m()],dg.prototype,"view",null),d([m({type:xke})],dg.prototype,"viewModel",void 0),dg=d([k("esri.widgets.Zoom")],dg);const lDt=dg;function cDt(t){return t?.view!==void 0}let JF=class extends GRt{constructor(e){super(e),this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},this.components=[],this._updateViewAwareWidgets=i=>{this.components.forEach(r=>{const s=this._find(r),n=s?.widget;cDt(n)&&(n.view=i)})},this._componentsWatcher=(i,r)=>{this._removeComponents(r),this._addComponents(i),this._adjustPadding(i)}}initialize(){this.addHandles([K(()=>this.components,this._componentsWatcher,Wt),K(()=>this.view,this._updateViewAwareWidgets,Wt)])}_add(e,i,r,s,n){let a=e;if(typeof e=="string"&&this._defaultPositionLookup[e]){if(this._find(e))return;a=this._createComponent(e)}super._add(a,i,r,s,n)}_removeComponents(e){e.forEach(i=>{const r=this._find(i);r&&(this.remove(r),r.destroy())})}_adjustPadding(e){if(!e.includes("attribution")&&!this._isOverridden("padding")){const{top:i}=this.padding;this.padding=i}}_addComponents(e){this.constructed&&e.forEach(i=>this.add(this._createComponent(i),this._defaultPositionLookup[i]))}_createComponent(e){const i=this._createWidget(e);return new eR({id:e,node:i})}_createWidget(e){const i=this.view;switch(e){case"attribution":return new KRt({view:i});case"compass":return new sDt({view:i});case"navigation-toggle":return new nDt({view:i,isDefaultUI:!0});case"zoom":return new lDt({view:i})}}};d([m()],JF.prototype,"components",void 0),JF=d([k("esri.views.ui.DefaultUI")],JF);const Ske=JF;let KF=class extends Ske{constructor(e){super(e),this.components=["attribution","zoom","navigation-toggle","compass"]}};d([m()],KF.prototype,"components",void 0),KF=d([k("esri.views.ui.3d.DefaultUI3D")],KF);const Tke=KF;var uJ;const Bve=Symbol(),wH=Symbol();var av;let Ke=(av=class extends GJe(_et(eet(Ape))){constructor(e){super(e),this._userClippingArea=null,this._clippingArea=null,this._initialDefaultSpatialReference=null,this._overrideDefaultEnvironmentOnly=!0,this._resolveWhenReady=[],this._resourceController=Dwt(this),this.deconflictor=new yX({view:this}),this.labeler=new Tb({view:this,deconflictor:this.deconflictor.labels}),this.sharedSymbolResources=null,this.analyses=new RC,this.animationsEnabled=!0,this.basemapTerrain=null,this.elevationProvider=new GO({view:this}),this._canvas=null,this.constraints=new Vb,this._environment=new PT,this.environmentManager=new Dd,this.floors=new He,this.fullOpacity=1,this.graphicsView=null,this.analysisViewManager=new TRt({importAnalysisViewModule:r=>nlt(r),view:this}),this.groundView=null,this.map=null,this._featureTileTreeClients=new tHe,this._featureTiles=null,this._featureTreeDebugger=null,this.state=new Sye({view:this}),this.slice=new HO,this.spatialReference=null,this.preserveDrawingBufferEnabled=!1,this.supersampleScreenshotsEnabled=!0,this.type="3d",this.ui=new Tke,this._numUpdating=0,this._lastUpdateTime=0,this.updatingProgress=.5,this._importControllers=new Map,sYe();const i=(r=null)=>{r!=null&&r.type===4||(this._updatingChanged(),this.map?.allLayers.forEach(async s=>{try{await s.when()}catch{}this._updatingChanged()}))};this.addHandles([Ys(()=>this.map?.allLayers,"after-changes",r=>i(r),{onListenerAdd:()=>i(),onListenerRemove:()=>i(),sync:!0}),this.allLayerViews.on("after-changes",r=>this._updateUpdatingMonitors(r)),K(()=>this.scene,r=>r?.load().catch(()=>{}))]),this.inputManager=new Aft({view:this}),this.stateManager=new ks({view:this}),this.screenSizePerspective=new jO({view:this})}initialize(){if(ie("enable-feature:esri-compress-textures")&&ie("wasm-simd")){const e=PRt(this,this.resourceController);this.addResolvingPromise(e.promise)}this.groundView=new du({view:this}),this._updateUpdatingMonitors(),this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,e=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=e)},Wt),this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,e=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=e)},Wt),this.updatingHandles.add(()=>this.qualitySettings.frameRate??0,e=>zBe(e>0?1e3/Math.ceil(e):0),Wt),this.addHandles([K(()=>this.spatialReference,()=>this.notifyChange("clippingArea"),Yt),K(()=>({plane:this.slice.plane,isDecoration:this.slice.isDecoration}),()=>this._updateSlice(),Yt)])}destroy(){this.destroyed||(RRt(this),this.updatingHandles.removeAll(),this.basemapTerrain?.clearHandles(),this.elevationProvider.destroy(),this.ui.removeAllHandles(),this.layerViewManager.clearHandles(),this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._set("analysisViewManager",Re(this.analysisViewManager)),this._exitSurface(),this._disposeGraphicsView(),this._disposeFocusAreasView(),this.sharedSymbolResources=Re(this.sharedSymbolResources),this._set("labeler",Re(this.labeler)),this._set("deconflictor",Re(this.deconflictor)),this._resourceController=Re(this._resourceController),this._set("stateManager",Re(this.stateManager)),this._set("inputManager",Re(this.inputManager)),this.state.destroy(),this.highlights.destroy(),this.removeHandles("updatingMonitors"),this._set("environmentManager",Re(this.environmentManager)),this._set("environment",Re(this.environment)),this.groundView=Re(this.groundView),this.slice.destroy(),this._updatingObjectsWithProgress.length=0,this._updatingObjects.length=0,this.ui?.destroy(),this._set("ui",null),this._set("renderCanvas",null),this._set("canvas",null),this._canvas=null,this.screenSizePerspective.destroy())}get stage(){return this._stage}get renderSpatialReference(){return this.renderCoordsHelper?.spatialReference}get basemapSpatialReference(){return this.basemapTerrain?.spatialReference}get animation(){return this.state?.animation}get overlayManager(){return this.basemapTerrain?.overlayManager}get camera(){return this.stateManager?.camera}set camera(e){this.stateManager&&(this.stateManager.camera=e)}get contentCamera(){return this.stateManager?.contentCamera}set contentCamera(e){this.stateManager&&(this.stateManager.contentCamera=e)}installContentCameraReset(e={sticky:!1}){return this.stateManager.installContentCameraReset(e)}get canvas(){return this._canvas}get center(){return this.stateManager?.center}set center(e){this.stateManager&&(this.stateManager.center=e)}get clippingArea(){if(this.viewingMode==="global")return null;const e=this.map;let i=this._userClippingArea||eue(e,"clippingArea");return!this._userClippingArea&&!eue(e,"clippingEnabled")||i==null?(this._clippingArea=null,null):i instanceof Bt?this.spatialReference&&(i=bk(i,this.spatialReference),i==null)?(fe.getLogger(this).error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea):(i=i.clone(),i.intersection(this._groundAndLayersExtent)==null&&(i.xmin=i.xmax,i.ymin=i.ymax),i.zmin=void 0,i.zmax=void 0,i.equals(this._clippingArea)||(this._clippingArea=i),this._clippingArea):(fe.getLogger(this).error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea)}set clippingArea(e){this.ready&&this.viewingMode==="global"&&e!=null?fe.getLogger(this).error("#clippingArea=","Clipping area is only supported in local viewingMode"):this._userClippingArea=e}get renderDataExtent(){if(this.state.viewingMode===1)return null;const e=this.renderSpatialReference,i=this.dataExtent;return i==null||e==null||i.spatialReference.equals(e)?i:bk(i,e)}get tileInfo(){return this.basemapTerrain?.tilingScheme?.toTileInfo()}get dataExtent(){let e=this._groundAndLayersExtent;const i=this.spatialReference||Ie.WGS84,r=bk(this.clippingArea,i);r!=null&&(e=e!=null?e.intersection(r):r);const s=this._get("dataExtent");return e!=null&&e.equals(s)?s:e}get _groundAndLayersExtent(){const e=this.spatialReference||Ie.WGS84;let i;const r=o=>{const l=bk(o,e);l!=null&&(i!=null?i.union(l):i=l.clone())},{basemapTerrain:s}=this;if(s?.spatialReference){const o=s.groundExtent;r(new Bt({xmin:o[0],ymin:o[1],zmin:0,xmax:o[2],ymax:o[3],zmax:0,spatialReference:s.spatialReference}))}const n=o=>{o.fullExtent==null||o.type==="graphics"&&o.internal||r(o.fullExtent)};if(this.map?.allLayers.forEach(o=>n(o)),i==null)return null;i.hasZ?(i.zmin=Math.min(0,i.zmin??0),i.zmax=Math.max(0,i.zmax??0)):(i.zmin=0,i.zmax=0);const a=this._get("_groundAndLayersExtent");return i.equals(a)?a:i}get environment(){return this._environment}set environment(e){if(this._environment===e)return;const{_environment:i}=this;this._environment=null,i?.destroy(),this._environment=e,this.notifyChange("environment")}castEnvironment(e){return e?e instanceof PT?e:e instanceof b4?this.environment?.cloneWithWebsceneEnvironment(e)??PT.fromWebsceneEnvironment(e):Ca(PT,e):new PT}get extent(){return this.stateManager?.extent}set extent(e){this.stateManager&&(this.stateManager.extent=e)}get screenCenter(){return this.stateManager?.screenCenter}get frustum(){return this.stateManager?.frustum}get layerviewCollections(){return[this.basemapView?.baseLayerViews,this.basemapView?.groundLayerViews,this.groundView?.layerViews,this.layerViews,this.basemapView?.referenceLayerViews]}get _layerToLayerviewMapping(){return uJ._layerToLayerview}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get defaultsFromMapSettings(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}get interacting(){return this.navigating||(this.toolViewManager?.interacting??!1)}get stationary(){return!this.animation&&!this.resizing&&(this.state?.stationary??!0)}get navigating(){return this.state?.navigating??!1}get scene(){return this.map&&P$e in this.map?this.map:null}get padding(){return this.stateManager?.padding}set padding(e){this.stateManager&&(this.stateManager.padding=e)}get featureTiles(){return this._featureTiles}set qualityProfile(e){$F.isValidProfile(e)&&($F.apply(e,this.qualitySettings),this.stage?.renderView.updateQualitySettings(this.qualitySettings),this._set("qualityProfile",e))}get qualityProfile(){return this._get("qualityProfile")||$F.getDefaultProfile()}_updateSlice(){this.stage!=null&&(this.stage.renderer.slice=this.slice)}get typeSpecificPreconditionsReady(){return!!this.viewingMode&&!!this.stateManager?.preinit(this.spatialReference)}get resolution(){return this.spatialReference!=null?aJe(this.scale,this.spatialReference):0}get scale(){return this.stateManager?.scale}set scale(e){this.stateManager&&(this.stateManager.scale=e)}get terrainLevel(){const e=this.basemapTerrain?.tilingScheme,{scale:i}=this;if(!e||!i)return null;const r=e.levelAtScale(i)+this.qualitySettings.tiledSurface.lodBias,s=e.getMaxLod();return r<=0?null:Math.max(0,Math.min(r,s||1/0))}get heightModelInfo(){const e=this.getDefaultHeightModelInfo();return e!=null?Eo.deriveUnitFromSR(e,this.spatialReference):null}get alphaCompositingEnabled(){return this._get("alphaCompositingEnabled")}set alphaCompositingEnabled(e){this._stage&&fe.getLogger(this).warn("alphaCompositingEnabled cannot be changed after the view has become ready"),this._set("alphaCompositingEnabled",e)}get updating(){if(this.destroying||this.destroyed)return!1;let e=0,i=this.layerViewManager.updating,r=i?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(n=>{if(n.isFulfilled()){if(n.updating){if(i=!0,n.suspended||DX(n))return;++r,e+=n.updatingProgress}}else++r});for(const n of this._updatingObjects)n!=null&&n.updating&&(r+=.1,e+=.5*.1);for(const n of this._updatingObjectsWithProgress)n!=null&&n.updating&&(++r,e+=n.updatingProgress);const s=!this.stateManager.test.updatingIgnoreRenderState&&this.state.updating;if(i=!!(i||r>0||this.updatingHandles.updating||!this.ready||!this.stationary||s||this._importControllers.size>0||this.inputManager?.updating||this.map?.allLayers?.some(n=>!n.isFulfilled())),i?(this._numUpdating=Math.max(r,this._numUpdating),e+=this._numUpdating-r):this._numUpdating=0,this._numUpdating>0?e/=this._numUpdating:e=i?0:1,this._get("updatingProgress")!==e){const n=performance.now();if(e<1){const a=Math.min((n-this._lastUpdateTime)/2e3,1);e=this.updatingProgress*(1-a)+e*a}this._set("updatingProgress",e),this._lastUpdateTime=i&&e<1?n:0}return i}get _updatingObjects(){return[this.graphicsView,this.basemapView,this._resourceController,this.stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this._featureTreeDebugger,this.toolViewManager,this.analysisViewManager]}get _updatingObjectsWithProgress(){return[this.deconflictor,this.labeler,this.basemapTerrain]}get viewingMode(){const e=this._predeterminedViewingMode;if(e!=null)return N7(e);const i=this.spatialReference;return i?this.defaultsFromMap?.viewingMode!=null&&i.equals(this.defaultsFromMap.spatialReference)?N7(this.defaultsFromMap.viewingMode):rD(i,1)?"global":"local":"global"}set viewingMode(e){this.ready?fe.getLogger(this).error("#viewingMode","viewingMode cannot be set once view is ready"):this._overrideIfSome("viewingMode",e)}get viewpoint(){return this.stateManager?.viewpoint}set viewpoint(e){this.stateManager&&(this.stateManager.viewpoint=e)}get visibleArea(){return this.stateManager?.visibleArea}get zoom(){return this.stateManager.zoom}set zoom(e){this.stateManager&&(this.stateManager.zoom=e)}get highlightOptions(){return this.highlights.find(({name:e})=>e===Tp)??new Aw}set highlightOptions(e){for(let i=0;i<this.highlights.length;++i)if(this.highlights.at(i).name===Tp)return void this.highlights.items[i].assignFrom(e)}get resourceController(){return this._resourceController}get quality(){return this._resourceController?.memoryController?.memoryFactor??1}get resolutionScale(){return Math.sqrt(Math.min(1,this.quality/.75))}get performanceInfo(){return new kwt(this)}on(e,i,r,s){return this.viewEvents.on(e,i,r,s)||super.on(e,i)}hasEventListener(e){return super.hasEventListener(e)||this.viewEvents.hasHandler(e)}toMap(e,i){if(!this.ready)return fe.getLogger(this).error("#toMap()","Scene view cannot be used before it is ready"),null;const r=$pe(e)?Tpe(this,e):e;return Ybt(this,r,i,this._defaultToMapOptions)}toScreen(e){if(!this.ready)return fe.getLogger(this).error("#toScreen()","Scene view cannot be used before it is ready"),null;const i=(e.z==null?Ff(this.elevationProvider,e):null)??0;return Yl(e,wk,this.renderSpatialReference,i),this.state.camera.projectToScreen(wk,xH),Zl(xH[0],xH[1])}pixelSizeAt(e,i){if(!this.ready)return fe.getLogger(this).error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null;if(!e)return 0;const r=this.renderSpatialReference;Yl(e,wk,r);const s=this.state.camera.computeScreenPixelSizeAt(wk);return i&&r!==i?s*Wr(r)/Wr(i):s}overlayPixelSizeInMapUnits(e){return this.overlayManager?.overlayPixelSizeInMapUnits(e,()=>this.pixelSizeAt(e))??1}hitTest(e,i){if(!this.ready)return fe.getLogger(this).error("#hitTest()","Scene view cannot be used before it is ready"),null;const r=$pe(e)?Tpe(this,e):e;return Zbt(this,r,i,this._defaultHitTestOptions)}async popupHitTest(e){return dwt(this,e)}goTo(e,i){return this.updatingHandles.addPromise(this.stateManager.goTo(e,i))}async whenAnalysisView(e){if(e.parent==null)throw new ee("view:no-analysisview-for-analysis","The analysis does not exist in view.analyses",{analysis:e});switch(e.parent.type){case"line-of-sight":case"dimension":case"viewshed":return(await this.whenLayerView(e.parent)).whenAnalysisView();default:return this.analysisViewManager.whenAnalysisView(e)}}whenLayerView(e){return super.whenLayerView(e)}async takeScreenshot(e){const i=await this._completeSettings(e);await this.whenReady();const r=(await this.stage.renderView.takeScreenshot(i))[0];return(await te(async()=>{const{encode:s}=await Promise.resolve().then(()=>kA);return{encode:s}},void 0)).encode(r,i,this._pixelFormat())}async _takeScreenshot(e){const i=await this._completeSettings(e);await this.whenReady();const r=(await this.stage.renderView.takeScreenshot(i))[0];return(await te(async()=>{const{encodeData:s}=await Promise.resolve().then(()=>kA);return{encodeData:s}},void 0)).encodeData(r,this._pixelFormat())}async _takeScreenshotWithObjectAndLayerId(e){const i=await this._completeSettings(e);i.olidColor=!0,await this.whenReady();const r=await this.stage.renderView.takeScreenshot(i),{encodeData:s}=await te(async()=>{const{encodeData:n}=await Promise.resolve().then(()=>kA);return{encodeData:n}},void 0);return[s(r[0],this._pixelFormat()),s(r[1],this._pixelFormat())]}async _completeSettings(e){const{toRenderSettings:i,screenshotSuperSampleSettings:r}=await te(()=>Promise.resolve().then(()=>kA),void 0),s=i(e,this);return s.pixelRatio/=this.state.pixelRatio,r(s,this.supersampleScreenshotsEnabled,this.padding)}_pixelFormat(){return{flipY:!0,premultipliedAlpha:this.stage?.renderView.getAlpha()??!1}}get test(){}async takeScreenshotWithObjectAndLayerId(e){if(!Jh())throw new ee("360vr:objectAndLayerId-rendering-disabled","has enable-feature:objectAndLayerId-rendering must be true");const{encode:i}=await te(()=>Promise.resolve().then(()=>kA),void 0),r=await this._completeSettings(e);r.olidColor=!0,await this.whenReady();const s=await this.stage.renderView.takeScreenshot(r),n=i(s[0],r,this._pixelFormat()),a=await this._completeSettings(e);return a.format="png",[n,i(s[1],a,this._pixelFormat())]}getColorToObjectAndLayerIdMapping(){const e=this.stage.renderView.olidRenderHelper;if(e)return e.getColorToObjectAndLayerIdMapping();throw new ee("360vr:objectAndLayerId-rendering-disabled","has enable-feature:objectAndLayerId-rendering must be true")}addUpdatingPromise(e){return this.updatingHandles.addPromise(e)}importLayerView(e){return nfe.importLayerView(e)}hasLayerViewModule(e){return nfe.hasLayerViewModule(e)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){return this.scene?.initialViewProperties?.spatialReference||this.defaultsFromMap?.spatialReference||this.defaultsFromMap?.ready&&this._initialDefaultSpatialReference||null}getSurface(){return this.surface}async validate(){let e=zRt(this.type);const i=ie("safari");if(i&&i<9&&(e=new ee("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:i})),e!=null)throw fe.getLogger(this).warn("#validate()",e.message),e}get _predeterminedViewingMode(){const e=this._isOverridden("viewingMode")?this._get("viewingMode"):this.scene?.initialViewProperties?.viewingMode;return e!=null?uQ(e):null}getSpatialReferenceSupport(e,i){const r=this._predeterminedViewingMode;if(r!=null)return this._validateSpatialReferenceForViewingMode(e,i,r)?{constraints:this._makeSpatialReferenceConstraints(e,i,r)}:null;const s=this._validateSpatialReferenceForViewingMode(e,i,2),n=this._validateSpatialReferenceForViewingMode(e,i,1);return s||n?s&&n?{constraints:this._makeSpatialReferenceConstraints(e,i,null)}:s?{constraints:this._makeSpatialReferenceConstraints(e,i,2)}:{constraints:this._makeSpatialReferenceConstraints(e,i,1)}:null}_validateSpatialReferenceForViewingMode(e,i,r){return!!rD(e,r)&&(i==null||!!Tde(i)||(!e$(i)||Z8(i,e,r)!=null)&&(!Sde(i)||r!==1))}_makeSpatialReferenceConstraints(e,i,r){if(i==null)return[{spatialReference:e,viewingMode:r}];const{isWebMercator:s,isWGS84:n}=e;return Tde(i)&&(s||n)?!n||r===2||Gre(i.tileInfo,i.fullExtent,e,1)===null?[{spatialReference:e,viewingMode:r},{spatialReference:Ie.WebMercator,viewingMode:r}]:[{spatialReference:s?Ie.WGS84:Ie.WebMercator,viewingMode:r}]:e$(i)||Sde(i)||!s&&!n?e$(i)&&s&&r!==1?[{spatialReference:e,viewingMode:r},{spatialReference:Ie.WGS84,viewingMode:2}]:[{spatialReference:e,viewingMode:r}]:[{spatialReference:e,viewingMode:r},{spatialReference:s?Ie.WGS84:Ie.WebMercator,viewingMode:r}]}_validateSpatialReference(e){const i=this.getSpatialReferenceSupport(e)!=null,r=this._predeterminedViewingMode;return i||(r!=null?fe.getLogger(this).warnOnce(`Spatial reference defined on view not supported in ${N7(r)} viewing mode.`):e.isGeographic&&fe.getLogger(this).warnOnce("Spatial reference is geographic but not supported.")),i}whenReady(){return new Promise(e=>{this.ready?e(this):this._resolveWhenReady.push(e)})}trackGraphicState(e){if(!e.graphic)return fe.getLogger(this).error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const i=this.getViewForGraphic(e.graphic);let r=null,s=!1;const n=a=>{!s&&a!=null&&"processor"in a&&a.processor?.type==="graphics-3d"&&a.processor.graphicsCore&&(r=a.processor.graphicsCore.trackGraphicState(e))};return i!=null?n(i):this.whenViewForGraphic(e.graphic,{waitForLayer:!0}).then(a=>n(a),()=>{}).catch(()=>{}),ci(()=>{s=!0,r!=null&&(r.remove(),r=null)})}maskOccludee(e){if(!e)return fe.getLogger(this).error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const i=this.getViewForGraphic(e);let r=null,s=!1;const n=a=>{!s&&a!=null&&fbt(a)&&(r=a.maskOccludee(e))};return i!=null?n(i):this.whenViewForGraphic(e,{waitForLayer:!0}).then(a=>n(a),()=>{}).catch(()=>{}),ci(()=>{s=!0,r!=null&&(r.remove(),r=null)})}getViewForGraphic(e){return e.layer===this?this.graphicsView:e.layer?this.allLayerViews.filter(i=>i.type!=="media-3d").find(i=>i.layer===e.layer):null}graphicChanged(e){this.graphicsView!=null&&this.graphicsView.graphicChanged(e)}async whenViewForGraphic(e,i){return e.layer===this?(await mv(()=>this.graphicsView),this.graphicsView):e.layer&&this.map?i&&i.waitForLayer&&!this.map.allLayers.includes(e.layer)?new Promise((r,s)=>{const n=this.map.allLayers.on("change",a=>{a.added.includes(e.layer)&&(n.remove(),this.whenLayerView(e.layer).then(r,s))})}):this.whenLayerView(e.layer):null}enableFeatureTiles(){const e=Symbol();return this._featureTileTreeClients.add(e),ci(()=>this._featureTileTreeClients.delete(e))}async _importModule(e,i){const r=new AbortController;this._importControllers.set(e,r),this._updatingChanged();try{const s=await uDt[e]();if(i&&(EBe(this),st(r.signal),await i(r.signal)),this.destroyed)throw Xt();return st(r.signal),s}catch{return null}finally{this._importControllers.delete(e),this._updatingChanged()}}_abortImport(e){this._importControllers.get(e)?.abort(),this._importControllers.delete(e),this._updatingChanged()}_initBasemapTerrain(){this._set("basemapTerrain",new c_e({view:this})),this.elevationProvider.register(0,this.basemapTerrain)}_exitBasemapTerrain(){const{basemapTerrain:e,elevationProvider:i}=this;e&&(this._set("basemapTerrain",null),i.unregister(e),e.destroy())}_initGlobe(){this._initCoordinateSystem(),this.state.createInitialCamera(),this._initBasemapTerrain(),this._set("pointsOfInterest",new Al({view:this})),this.addHandles([this.updatingHandles.add(()=>Ws.FEATURE_TILE_TREE_SHOW_TILES,e=>{e&&!this._featureTreeDebugger?this.updatingHandles.addPromise(te(()=>import("./FeatureTileTree3DDebugger-BYUhEwbV.js"),__vite__mapDeps([377,367]))).then(({FeatureTileTree3DDebugger:i})=>{!this._featureTreeDebugger&&Ws.FEATURE_TILE_TREE_SHOW_TILES&&(this._featureTreeDebugger=new i({view:this}))}):e||(this._featureTreeDebugger=Re(this._featureTreeDebugger))},At),this.updatingHandles.add(()=>({basemapExtent:this.basemapTerrain?.extent,basemapSpatialReference:this.basemapTerrain?.spatialReference,clippingArea:this.clippingArea,featureTiles:this._featureTiles}),({basemapExtent:e,basemapSpatialReference:i,clippingArea:r,featureTiles:s})=>{if(!s)return;const n=!!e;if(r||n)if(n&&i){const a=e&&i?zo(fU(e,i),this.spatialReference):null;s.filterExtent=r?r.intersection(a):a}else s.filterExtent=r;else s.filterExtent=null},At),this.updatingHandles.add(()=>this._featureTileTreeClients.size>0,e=>{e?this.updatingHandles.addPromise(this._ensureFeatureTileTree()):this._featureTiles=Re(this._featureTiles)},Yt)],Bve),this.stateManager.init()}async _ensureFeatureTileTree(){if(this._featureTiles||this._importControllers.has("FeatureTileTree3D"))return;const e=(await this.updatingHandles.addPromise(this._importModule("FeatureTileTree3D")))?.FeatureTileTree3D;e&&(this._featureTiles=new e({renderCoordsHelper:this.renderCoordsHelper,pointsOfInterest:this.pointsOfInterest,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}),this._updatingChanged())}_exitTerrain(){this.stateManager.exit(),this.removeHandles(wH),this.removeHandles(Bve),this._featureTiles=Re(this.featureTiles),this._set("pointsOfInterest",Re(this.pointsOfInterest)),this._exitBasemapTerrain(),this.state.reset(),this._exitCoordinateSystem()}_initCoordinateSystem(){if(this.spatialReference){const e=this.spatialReference,i=this.state.isGlobal,r=nJe(i,e);r!==this.renderSpatialReference&&(this._set("renderCoordsHelper",gwt.create(this.state.viewingMode,r)),i||this.addHandles(K(()=>this.basemapTerrain?.extent,s=>{const n=this.renderCoordsHelper.spatialReference;s==null||s[0]===0&&s[1]===0&&s[2]===0&&s[3]===0||!Pee(s,this.basemapTerrain.spatialReference,jve,n)||(this.renderCoordsHelper.extent=jve)},Yt),wH),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(FC/this.renderCoordsHelper.unitInMeters))}else this._set("renderCoordsHelper",null)}_exitCoordinateSystem(){this.removeHandles(wH),this._set("renderCoordsHelper",null)}_updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(e=null){e!=null&&e.type===4||(this.removeHandles("updatingMonitors"),this.allLayerViews.forEach(i=>{i.destroyed||(this.addHandles(K(()=>[i.updating,i.updatingProgress],()=>this._updatingChanged(),Yt),"updatingMonitors"),i.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),this._updatingChanged())}async _prepareScreenshotOverlay(){this.overlay&&await this.overlay.prepare()}_renderScreenshotOverlay(e,i,r){if(!this.overlay||!this.overlay.hasVisibleItems)return r;const s=e.getContext("2d",{willReadFrequently:!0});return s.putImageData(r,0,0),this.overlay.renderCanvas(e,{disableDecorations:i}),s.getImageData(0,0,r.width,r.height)}_initStage(){const e={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{prepareOverlay:()=>this._prepareScreenshotOverlay(),renderOverlay:(s,n,a)=>this._renderScreenshotOverlay(s,n,a)}},i=new iwt(this.state.viewingMode,s=>this.stage.layers.forEach(s),this);this._set("sceneIntersectionHelper",i);const r=$U(this.surface);this._stage=new bh({view:this,options:e,container:r}),this.notifyChange("stage"),this._updateSlice(),this.addHandles([this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,s=>this.stage.renderer.setParameters({highQualityTransparency:s}),Wt),this.on("pointer-move",()=>this.stage?.renderer.resetAnimation()),aM(this.stage.renderView.canvas,"webglcontextlost",s=>{this.fatalError=new ee("webgl-context-lost",s.statusMessage)})],"stage"),this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(FC/this.renderCoordsHelper.unitInMeters),this._set("canvas",this.stage.renderView.canvas)}_exitStage(){this.sceneIntersectionHelper?.destroy(),this._set("sceneIntersectionHelper",null),this._stage=Re(this.stage),this._set("stage",null),this.removeHandles("stage"),this._set("canvas",null)}_initSurface(){this._exitSurface(),this._initStage(),this._initGlobe(),this.sharedSymbolResources=new Sxt({view:this,resourceController:this._resourceController})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitTerrain(),this._exitStage())}async _ensureGraphicsView(){if(this.graphicsView||this._importControllers.has("GraphicsView3D")||this.graphics.length===0)return;this.removeHandles("GraphicsView3D");const e=(await this.updatingHandles.addPromise(this._importModule("GraphicsView3D",i=>mv(()=>this.basemapTerrain?.ready,i))))?.default;e&&this._set("graphicsView",new e({view:this,getGraphics:()=>this.graphics})),this._updatingChanged()}_disposeGraphicsView(){this._abortImport("GraphicsView3D"),this.removeHandles("GraphicsView3D"),this.graphicsView&&(this.removeHandles(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))}_disposeFocusAreasView(){this._abortImport("FocusAreasView"),this.removeHandles("FocusAreasView"),this.focusAreasView=Re(this.focusAreasView)}async _ensureFocusAreasView(e){if(this.focusAreasView||this._importControllers.has("FocusAreasView")||e===0)return;this.removeHandles("FocusAreasView");const i=(await this.updatingHandles.addPromise(this._importModule("FocusAreasView")))?.FocusAreasView;i&&(this.focusAreasView=new i({view:this})),this._updatingChanged()}_startup(){uQ(this.viewingMode)===1&&(this._clippingArea=null),this._initSurface(),this._set("ready",!0),this.addHandles(Ys(()=>this.graphics,"after-changes",()=>this._ensureGraphicsView()),"GraphicsView3D"),this._ensureGraphicsView(),this.addHandles(K(()=>this.map?.focusAreas?.areas.length??0,s=>this._ensureFocusAreasView(s),{initial:!0}),"FocusAreasView");const e=this.scene?.initialViewProperties??null,i=e?.environment;i&&(this._overrideDefaultEnvironmentOnly?ATe(this.environment,i):this.environment=this.environment.cloneWithWebsceneEnvironment(i)),this.timeExtent=e?.timeExtent,e?.analyses.applyTo(this),this.labeler.setup(),this.environmentManager.connectView(this),this.inputManager.connect();const r=this._resolveWhenReady;this._resolveWhenReady=[],r.forEach(s=>s(this))}_teardown(){this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.disconnectView(),this._overrideDefaultEnvironmentOnly=!1,this.labeler.dispose(),this._disposeGraphicsView(),this._disposeFocusAreasView(),this._exitSurface(),this._set("ready",!1)}get _defaultToMapOptions(){const e={include:new Set};if(!this.map)return e;this.map.ground&&e.include.add(Av);for(const i of this.allLayerViews)Hx(i.layer)&&e.include.add(i.uid);return e}get _defaultHitTestOptions(){const e={exclude:new Set};if(!this.map)return e;this.map.ground&&this.map.ground.opacity<1&&e.exclude.add(Av);for(const i of this.allLayerViews)Hx(i.layer)&&i.layer.opacity<1&&e.exclude.add(i.uid);return e}static clearStatics(){kie(),vK(),nHe(),vRt(),npt(),zat(),Sbt(),BYe(),ARt(),BJe(),U$t(),PSt(),hdt(),$dt(),dYe(),NBe(),qEt(),VTt(),wbt.cleanupI3SLodHandling(),B0.cleanupTilemapCache(),Sye.cleanupViewstate(),c_e.cleanupTerrainSurface()}},uJ=av,av._layerToLayerview=Ape._layerToLayerview.concat([["view.map.ground.layers","view.groundView.layerViews"]]),av.type="3d",av);function bk(t,e){return t!=null&&Nu(t.spatialReference,e)?zo(t,e):null}d([m()],Ke.prototype,"_userClippingArea",void 0),d([m()],Ke.prototype,"_resourceController",void 0),d([m()],Ke.prototype,"stage",null),d([m({readOnly:!0})],Ke.prototype,"deconflictor",void 0),d([m({readOnly:!0})],Ke.prototype,"labeler",void 0),d([m(o6(RC,"analyses"))],Ke.prototype,"analyses",void 0),d([m({type:kC,readOnly:!0})],Ke.prototype,"animation",null),d([m()],Ke.prototype,"animationsEnabled",void 0),d([m({readOnly:!0})],Ke.prototype,"basemapTerrain",void 0),d([m({readOnly:!0})],Ke.prototype,"overlayManager",null),d([m({readOnly:!0})],Ke.prototype,"elevationProvider",void 0),d([m()],Ke.prototype,"camera",null),d([m({type:ol})],Ke.prototype,"contentCamera",null),d([m({readOnly:!0})],Ke.prototype,"canvas",null),d([m({type:Qe})],Ke.prototype,"center",null),d([m({type:Bt})],Ke.prototype,"clippingArea",null),d([m({type:Vb,nonNullable:!0})],Ke.prototype,"constraints",void 0),d([m({type:Bt,readOnly:!0})],Ke.prototype,"renderDataExtent",null),d([m({readOnly:!0})],Ke.prototype,"tileInfo",null),d([m({type:Bt,readOnly:!0})],Ke.prototype,"dataExtent",null),d([m({type:Bt,readOnly:!0})],Ke.prototype,"_groundAndLayersExtent",null),d([m({type:PT})],Ke.prototype,"environment",null),d([qr("environment")],Ke.prototype,"castEnvironment",null),d([m({readOnly:!0})],Ke.prototype,"environmentManager",void 0),d([m({type:Bt})],Ke.prototype,"extent",null),d([m({type:He})],Ke.prototype,"floors",void 0),d([m()],Ke.prototype,"screenCenter",null),d([m()],Ke.prototype,"frustum",null),d([m({type:Number,readOnly:!0})],Ke.prototype,"fullOpacity",void 0),d([m({readOnly:!0})],Ke.prototype,"graphicsView",void 0),d([m()],Ke.prototype,"analysisViewManager",void 0),d([m()],Ke.prototype,"groundView",void 0),d([m({readOnly:!0})],Ke.prototype,"layerviewCollections",null),d([m({type:Boolean})],Ke.prototype,"initialExtentRequired",null),d([m()],Ke.prototype,"defaultsFromMapSettings",null),d([m()],Ke.prototype,"interacting",null),d([m()],Ke.prototype,"stationary",null),d([m()],Ke.prototype,"navigating",null),d([m()],Ke.prototype,"map",void 0),d([m()],Ke.prototype,"padding",null),d([m({type:Al,readOnly:!0})],Ke.prototype,"pointsOfInterest",void 0),d([m()],Ke.prototype,"_featureTiles",void 0),d([m()],Ke.prototype,"featureTiles",null),d([m()],Ke.prototype,"_featureTreeDebugger",void 0),d([m({constructOnly:!0})],Ke.prototype,"deactivatedWebGLExtensions",void 0),d([m({constructOnly:!0})],Ke.prototype,"debugWebGLExtensions",void 0),d([m({constructOnly:!0})],Ke.prototype,"renderCanvas",void 0),d([m({constructOnly:!0})],Ke.prototype,"state",void 0),d([m()],Ke.prototype,"screenSizePerspective",void 0),d([m({readOnly:!0})],Ke.prototype,"inputManager",void 0),d([m({readOnly:!0})],Ke.prototype,"stateManager",void 0),d([m({type:["low","medium","high"]})],Ke.prototype,"qualityProfile",null),d([m({type:Pye,get(){let t=this._get("qualitySettings");return t||(t=new Pye,$F.apply(this.qualityProfile,t)),t}})],Ke.prototype,"qualitySettings",void 0),d([m()],Ke.prototype,"slice",void 0),d([m({readOnly:!0})],Ke.prototype,"typeSpecificPreconditionsReady",null),d([m({readOnly:!0})],Ke.prototype,"renderCoordsHelper",void 0),d([m({readOnly:!0})],Ke.prototype,"sceneIntersectionHelper",void 0),d([m({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],Ke.prototype,"resolution",null),d([m({type:Number})],Ke.prototype,"scale",null),d([m({readOnly:!0,type:Number})],Ke.prototype,"terrainLevel",null),d([m()],Ke.prototype,"heightModelInfo",null),d([m()],Ke.prototype,"spatialReference",void 0),d([m({type:Boolean,value:!1})],Ke.prototype,"alphaCompositingEnabled",null),d([m({constructOnly:!0})],Ke.prototype,"preserveDrawingBufferEnabled",void 0),d([m({type:Boolean})],Ke.prototype,"supersampleScreenshotsEnabled",void 0),d([m({readOnly:!0})],Ke.prototype,"type",void 0),d([m(),qr(t=>t instanceof Ske?t:qD(Tke,t))],Ke.prototype,"ui",void 0),d([m({type:Boolean,readOnly:!0,dependsOn:["graphicsView.updating","basemapView.updating","basemapTerrain.updating","layerViewManager.updating","layerViewManager.updatingRemaining","_resourceController.updating","stage.updating","featureTiles.updating","pointsOfInterest.updating","environmentManager.updating","overlay.updating","updatingHandles.updating","featureTreeDebugger.updating","labeler.updating","deconflictor.updating","ready","stationary","inputManager.updating","toolViewManager.updating","analysisViewManager.updating","state.updating","textures.updating"]})],Ke.prototype,"updating",null),d([m()],Ke.prototype,"_updatingObjects",null),d([m()],Ke.prototype,"_updatingObjectsWithProgress",null),d([m({type:Number,readOnly:!0,dependsOn:["updating"]})],Ke.prototype,"updatingProgress",void 0),d([m({type:["global","local"]})],Ke.prototype,"viewingMode",null),d([m({type:Yf})],Ke.prototype,"viewpoint",null),d([m({readOnly:!0})],Ke.prototype,"visibleArea",null),d([m({type:Number})],Ke.prototype,"zoom",null),d([m({type:Aw})],Ke.prototype,"highlightOptions",null),d([m({readOnly:!0})],Ke.prototype,"quality",null),d([m({readOnly:!0})],Ke.prototype,"resolutionScale",null),d([m()],Ke.prototype,"focusAreasView",void 0),d([m()],Ke.prototype,"_defaultToMapOptions",null),d([m()],Ke.prototype,"_defaultHitTestOptions",null),Ke=uJ=d([k("esri.views.SceneView")],Ke);const wk=R(),xH=Gs(),jve=Pi(),uDt={GraphicsView3D:()=>te(()=>import("./GraphicsView3D-ClZ3AD8P.js"),__vite__mapDeps([378,254,47,241,99,224,98,81,74,100,101,57,25,102,21,199,242,226,227])),FocusAreasView:()=>te(()=>import("./FocusAreasView-VdEdISLd.js"),__vite__mapDeps([379,380,64,330,331,328,332,333,337,334,335,352,20,241,99,325,30,323,304,296,305,258,324])),FeatureTileTree3D:()=>te(()=>import("./FeatureTileTree3D-CtaKqhwB.js"),__vite__mapDeps([381,107]))},hDt=Ke;let dDt=class $ke{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(JH),this._values=new Map,this.multipleOriginsSupported=!0}clone(e){const i=new $ke,r=this._originStores[0];r&&r.forEach((s,n)=>{i.set(n,Te(s),0)});for(let s=2;s<JH;s++){const n=this._originStores[s];n&&n.forEach((a,o)=>{e&&e.has(o)||i.set(o,Te(a),s)})}return i}get(e,i){const r=i===void 0?this._values:this._originStores[i];return r?r.get(e):void 0}keys(e){const i=e==null?this._values:this._originStores[e];return i?[...i.keys()]:[]}set(e,i,r=7){let s=this._originStores[r];if(s||(s=new Map,this._originStores[r]=s),s.set(e,i),!this._values.has(e)||this._propertyOriginMap.get(e)<=r){const n=this._values.get(e);return this._values.set(e,i),this._propertyOriginMap.set(e,r),n!==i}return!1}delete(e,i=7){const r=this._originStores[i];if(!r)return;const s=r.get(e);if(r.delete(e),this._values.has(e)&&this._propertyOriginMap.get(e)===i){this._values.delete(e);for(let n=i-1;n>=0;n--){const a=this._originStores[n];if(a&&a.has(e)){this._values.set(e,a.get(e)),this._propertyOriginMap.set(e,n);break}}}return s}has(e,i){const r=i===void 0?this._values:this._originStores[i];return!!r&&r.has(e)}revert(e,i){for(;i>0&&!this.has(e,i);)--i;const r=this._originStores[i],s=r?.get(e),n=this._values.get(e);return this._values.set(e,s),this._propertyOriginMap.set(e,i),n!==s}originOf(e){return this._propertyOriginMap.get(e)||0}isAtOrigin(e,i){return this.has(e,i)&&this.originOf(e)===i}isBelowOrigin(e,i){return!this.has(e)||this.originOf(e)<i}forEach(e){this._values.forEach(e)}};const Cke=t=>{const e=t;let i=class extends e{constructor(...r){super(...r);const s=al(this),n=s.store,a=new dDt;s.store=a,Qwe(s,n,a)}read(r,s){Jwe(this,r,s)}getAtOrigin(r,s){const n=SH(this),a=Ug(s);if(typeof r=="string")return n.get(r,a);const o={};return r.forEach(l=>{o[l]=n.get(l,a)}),o}originOf(r){return ON(this.originIdOf(r))}originIdOf(r){return SH(this).originOf(r)}revert(r,s){const n=SH(this),a=Ug(s),o=al(this);let l;l=typeof r=="string"?r==="*"?n.keys(a):[r]:r,l.forEach(c=>{o.invalidate(c),n.revert(c,a),o.commit(c)})}};return i=d([k("esri.core.ReadOnlyMultiOriginJSONSupport")],i),i};function SH(t){return al(t).store}Cke(Me);const pDt=t=>{const e=t;let i=class extends e{constructor(...r){super(...r)}clear(r,s="user"){al(this).clearOrigin(r,Ug(s))}write(r,s){return exe(this,r=r||{},s),r}setAtOrigin(r,s,n){al(this).setAtOrigin(r,s,Ug(n))}removeOrigin(r){const s=qve(this),n=Ug(r),a=s.keys(n);for(const o of a)s.originOf(o)===n&&s.set(o,s.get(o,n),7)}updateOrigin(r,s){const n=qve(this),a=Ug(s),o=tp(this,r);for(let l=a+1;l<JH;++l)n.delete(r,l);n.set(r,o,a)}toJSON(r){return this.write({},r)}};return i=d([k("esri.core.MultiOriginJSONSupport.WriteableMultiOriginJSONSupport")],i),i.prototype.toJSON.isDefaultToJSON=!0,i};function qve(t){return al(t).store}const Mke=t=>{const e=pDt(Cke(t));let i=class extends e{};return i=d([k("esri.core.MultiOriginJSONSupport")],i),i},fDt=Mke(Me);function Gve(t){t?.writtenProperties&&t.writtenProperties.forEach(({target:e,propName:i,newOrigin:r})=>{dCe(e)&&r&&e.originOf(i)!==r&&e.updateOrigin(i,r)})}function qsi(t,e){return{...Eke(t,e),readResourcePaths:[]}}function Hve(t,e,i){const r=Ma(t.itemUrl);return{...Eke(t,e),messages:[],writtenProperties:[],blockedRelativeUrls:[],verifyItemRelativeUrls:r?{rootPath:r.path,writtenUrls:[]}:null,resources:i?{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}:null}}function Eke(t,e){return{origin:e,url:Ma(t.itemUrl),portal:t.portal||Fe.getDefault(),portalItem:t}}async function mDt(t){const e=t.spatialReference;if(e.isWGS84)return t.clone();if(e.isWebMercator)return l3(t);const i=Ie.WGS84;return await wp(e,i),zo(t,i)}function gDt(t,e){if(!Ake(t,e)){const i=t.typeKeywords;i?i.push(e):t.typeKeywords=[e]}}function Ake(t,e){return!!t.typeKeywords?.includes(e)}function Gsi(t){return Ake(t,hJ.HOSTED_SERVICE)}function yDt(t,e){const i=t.typeKeywords;if(i){const r=i.indexOf(e);r>-1&&i.splice(r,1)}}function Wve(t,e,i){i?gDt(t,e):yDt(t,e)}async function Hsi(t){const e=t.clone().normalize();let i;if(e.length>1)for(const r of e)i?r.width>i.width&&(i=r):i=r;else i=e[0];return mDt(i)}const hJ={CHARTS:"Charts",DYNAMIC:"Dynamic",DEVELOPER_BASEMAP:"DeveloperBasemap",GROUP_LAYER_MAP:"Map",HOSTED_SERVICE:"Hosted Service",JSAPI:"ArcGIS API for JavaScript",LOCAL_SCENE:"ViewingMode-Local",METADATA:"Metadata",MULTI_LAYER:"Multilayer",ORIENTED_IMAGERY_LAYER:"OrientedImageryLayer",SINGLE_LAYER:"Singlelayer",SUBTYPE_GROUP_LAYER:"SubtypeGroupLayer",SUBTYPE_GROUP_TABLE:"SubtypeGroupTable",TABLE:"Table",TILED_IMAGERY:"Tiled Imagery"};function Wsi(t){const{portal:e,isOrgItem:i,itemControl:r}=t,s=e.user?.privileges;let n=!s||s.includes("features:user:edit"),a=!!i&&!!s?.includes("features:user:fullEdit");const o=r==="update"||r==="admin";return o?a=n=!0:a&&(n=!0),{features:{edit:n,fullEdit:a},content:{updateItem:o}}}let r_=class extends ke{constructor(e){super(e),this.facilityIdField=null,this.layerId=null,this.nameField=null,this.siteIdField=null,this.sublayerId=null}};d([m({type:String,json:{write:{isRequired:!0}}})],r_.prototype,"facilityIdField",void 0),d([m({type:String,json:{write:{isRequired:!0}}})],r_.prototype,"layerId",void 0),d([m({type:String,json:{write:{isRequired:!0}}})],r_.prototype,"nameField",void 0),d([m({type:String,json:{write:!0}})],r_.prototype,"siteIdField",void 0),d([m({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],r_.prototype,"sublayerId",void 0),r_=d([k("esri.layers.support.FacilityLayerInfo")],r_);const _Dt=r_;let kd=class extends ke{constructor(e){super(e),this.facilityIdField=null,this.layerId=null,this.levelIdField=null,this.levelNumberField=null,this.longNameField=null,this.shortNameField=null,this.sublayerId=null,this.verticalOrderField=null}};d([m({type:String,json:{write:{isRequired:!0}}})],kd.prototype,"facilityIdField",void 0),d([m({type:String,json:{write:{isRequired:!0}}})],kd.prototype,"layerId",void 0),d([m({type:String,json:{write:{isRequired:!0}}})],kd.prototype,"levelIdField",void 0),d([m({type:String,json:{write:{isRequired:!0}}})],kd.prototype,"levelNumberField",void 0),d([m({type:String,json:{write:{isRequired:!0}}})],kd.prototype,"longNameField",void 0),d([m({type:String,json:{write:{isRequired:!0}}})],kd.prototype,"shortNameField",void 0),d([m({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],kd.prototype,"sublayerId",void 0),d([m({type:String,json:{write:{isRequired:!0}}})],kd.prototype,"verticalOrderField",void 0),kd=d([k("esri.layers.support.LevelLayerInfo")],kd);const vDt=kd;let Ob=class extends ke{constructor(e){super(e),this.layerId=null,this.nameField=null,this.siteIdField=null,this.sublayerId=null}};d([m({type:String,json:{write:{isRequired:!0}}})],Ob.prototype,"layerId",void 0),d([m({type:String,json:{write:{isRequired:!0}}})],Ob.prototype,"nameField",void 0),d([m({type:String,json:{write:{isRequired:!0}}})],Ob.prototype,"siteIdField",void 0),d([m({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],Ob.prototype,"sublayerId",void 0),Ob=d([k("esri.layers.support.SiteLayerInfo")],Ob);const bDt=Ob;let GT=class extends ke{constructor(e){super(e),this.levelLayer=null,this.facilityLayer=null,this.siteLayer=null}};d([m({type:vDt,json:{write:{isRequired:!0}}})],GT.prototype,"levelLayer",void 0),d([m({type:_Dt,json:{write:{isRequired:!0}}})],GT.prototype,"facilityLayer",void 0),d([m({type:bDt,json:{write:!0}})],GT.prototype,"siteLayer",void 0),GT=d([k("esri.support.MapFloorInfo")],GT);const wDt=GT;var dJ;let gf=dJ=class extends ke{constructor(t){super(t),this.enabled=!1,this.longNames=!1,this.minimized=!1,this.pinnedLevels=!1,this.site=null,this.facility=null,this.level=null}clone(){return new dJ(Te({enabled:this.enabled,longNames:this.longNames,minimized:this.minimized,pinnedLevels:this.pinnedLevels,site:this.site,facility:this.facility,level:this.level}))}};d([m({type:Boolean,json:{read:{source:"enabled"},write:{target:"enabled"}}})],gf.prototype,"enabled",void 0),d([m({type:Boolean,json:{read:{source:"longNames"},write:{target:"longNames"}}})],gf.prototype,"longNames",void 0),d([m({type:Boolean,json:{read:{source:"minimized"},write:{target:"minimized"}}})],gf.prototype,"minimized",void 0),d([m({type:Boolean,json:{read:{source:"pinnedLevels"},write:{target:"pinnedLevels"}}})],gf.prototype,"pinnedLevels",void 0),d([m({type:String,json:{read:{source:"site"},write:{target:"site"}}})],gf.prototype,"site",void 0),d([m({type:String,json:{read:{source:"facility"},write:{target:"facility"}}})],gf.prototype,"facility",void 0),d([m({type:String,json:{read:{source:"level"},write:{target:"level"}}})],gf.prototype,"level",void 0),gf=dJ=d([k("esri.webdoc.widgets.FloorFilter")],gf);const xDt=gf;var pJ;const xk=new ta({slider:"slider",picker:"picker"});let HT=pJ=class extends ke{constructor(t){super(t),this.interactionMode=null,this.numStops=null,this.stopInterval=null}clone(){return new pJ({interactionMode:this.interactionMode,numStops:this.numStops,stopInterval:this.stopInterval})}};d([m({type:xk.apiValues,nonNullable:!0,json:{type:xk.jsonValues,default:null,read:{reader:xk.read},write:{isRequired:!0,writer:xk.write}}})],HT.prototype,"interactionMode",void 0),d([m({type:qi,json:{read:{source:"numberOfStops"},write:{target:"numberOfStops",overridePolicy(){const t=this.stopInterval!=null;return{enabled:!t,isRequired:!t}}}}})],HT.prototype,"numStops",void 0),d([m({type:Number,json:{write:{overridePolicy(){return{isRequired:this.numStops==null}}}}})],HT.prototype,"stopInterval",void 0),HT=pJ=d([k("esri.webdoc.widgets.Range")],HT);const SDt=HT,Oke=cl()({esriTimeUnitsMilliseconds:"milliseconds",esriTimeUnitsSeconds:"seconds",esriTimeUnitsMinutes:"minutes",esriTimeUnitsHours:"hours",esriTimeUnitsDays:"days",esriTimeUnitsWeeks:"weeks",esriTimeUnitsMonths:"months",esriTimeUnitsYears:"years",esriTimeUnitsDecades:"decades",esriTimeUnitsCenturies:"centuries",esriTimeUnitsUnknown:void 0});let F3=class extends ur(ke){constructor(e){super(e),this.unit="milliseconds",this.value=0}toMilliseconds(){return v$e(this.value,this.unit,"milliseconds")}};d([Et(Oke,{nonNullable:!0})],F3.prototype,"unit",void 0),d([m({type:Number,json:{write:!0},nonNullable:!0})],F3.prototype,"value",void 0),F3=d([k("esri.time.TimeInterval")],F3);var fJ;let ka=fJ=class extends ke{constructor(t){super(t),this.currentTimeExtent=null,this.fullTimeExtent=null,this.loop=!1,this.numStops=null,this.numThumbs=null,this.stopDelay=null,this.stopInterval=null,this.stops=null}readCurrentTimeExtent(t){return t?Mn.fromArray(t):void 0}writeCurrentTimeExtent(t,e,i){t&&Uf(i,t.toArray(),e)}readFullTimeExtent(t,e){const i=e.properties;if(!i)return;const r=i.endTime!=null?new Date(i.endTime):null,s=i.startTime!=null?new Date(i.startTime):null;return new Mn({start:s,end:r})}writeFullTimeExtent(t,e){if(!t)return;const i=e.properties=e.properties||{},r=t.end,s=t.start;r&&(i.endTime=r!=null?r.getTime():null),s&&(i.startTime=s!=null?s.getTime():null)}readStopInterval(t,e,i){return t?F3.fromJSON({value:t.interval,unit:t.units},i):null}writeStopInterval(t,e,i,r){if(!t)return;const s=t.toJSON(r);Uf("properties.timeStopInterval",{interval:s.value,units:s.unit},e)}readStops(t){return t?.length?t.map(e=>new Date(e)):null}writeStops(t,e,i){t?.length&&Uf(i,t.map(r=>r.getTime()),e)}clone(){return new fJ(Te({currentTimeExtent:this.currentTimeExtent,fullTimeExtent:this.fullTimeExtent,loop:this.loop,numStops:this.numStops,numThumbs:this.numThumbs,stopDelay:this.stopDelay,stopInterval:this.stopInterval,stops:this.stops}))}};d([m({type:Mn,json:{type:[[qi,GD]],read:{source:"properties.currentTimeExtent"},write:{target:"properties.currentTimeExtent"}}})],ka.prototype,"currentTimeExtent",void 0),d([di("currentTimeExtent")],ka.prototype,"readCurrentTimeExtent",null),d([Ht("currentTimeExtent")],ka.prototype,"writeCurrentTimeExtent",null),d([m({type:Mn,json:{read:{source:["properties.endTime","properties.startTime"]},write:{target:{"properties.endTime":{type:Number},"properties.startTime":{type:Number}}}}})],ka.prototype,"fullTimeExtent",void 0),d([di("fullTimeExtent")],ka.prototype,"readFullTimeExtent",null),d([Ht("fullTimeExtent")],ka.prototype,"writeFullTimeExtent",null),d([m({type:Boolean,nonNullable:!0,json:{default:!1,read:{source:"properties.loop"},write:{target:"properties.loop"}}})],ka.prototype,"loop",void 0),d([m({type:qi,json:{read:{source:"properties.numberOfStops"},write:{target:"properties.numberOfStops",overridePolicy(){const t=!!this.stopInterval,e=!!this.stops?.length,i=!(t||e);return{enabled:i,isRequired:i}}}}})],ka.prototype,"numStops",void 0),d([m({type:[1,2],nonNullable:!0,json:{type:qi,read:{source:"properties.thumbCount"},write:{target:"properties.thumbCount",isRequired:!0}}})],ka.prototype,"numThumbs",void 0),d([m({type:Number,nonNullable:!0,json:{read:{source:"properties.thumbMovingRate"},write:{target:"properties.thumbMovingRate",isRequired:!0}}})],ka.prototype,"stopDelay",void 0),d([m({type:F3,json:{read:{source:"properties.timeStopInterval"},write:{target:{"properties.timeStopInterval.interval":{type:Number},"properties.timeStopInterval.units":{type:Oke.jsonValues.filter(t=>t!=="esriTimeUnitsUnknown")}},overridePolicy(){const t=this.numStops!=null,e=!!this.stops?.length;return{enabled:!e,isRequired:!(t||e)}}}}})],ka.prototype,"stopInterval",void 0),d([di("stopInterval")],ka.prototype,"readStopInterval",null),d([Ht("stopInterval")],ka.prototype,"writeStopInterval",null),d([m({type:[Date],json:{type:[qi],read:{source:"properties.stops"},write:{target:"properties.stops",overridePolicy(){return{isRequired:this.numStops==null&&!this.stopInterval}}}}})],ka.prototype,"stops",void 0),d([di("stops")],ka.prototype,"readStops",null),d([Ht("stops")],ka.prototype,"writeStops",null),ka=fJ=d([k("esri.webdoc.widgets.TimeSlider")],ka);const TDt=ka;var mJ;let WT=mJ=class extends ke{constructor(t){super(t),this.range=null,this.timeSlider=null,this.floorFilter=null}clone(){return new mJ(Te({range:this.range,timeSlider:this.timeSlider,floorFilter:this.floorFilter}))}};d([m({type:SDt,json:{write:!0}})],WT.prototype,"range",void 0),d([m({type:TDt,json:{write:!0}})],WT.prototype,"timeSlider",void 0),d([m({type:xDt,json:{write:!0}})],WT.prototype,"floorFilter",void 0),WT=mJ=d([k("esri.webdoc.Widgets")],WT);const $Dt=WT;async function CDt(t,e={},i){await t.load(i);const r=Mp(t.itemUrl,"resources"),{start:s=1,num:n=10,sortOrder:a="asc",sortField:o="resource"}=e,l={query:{start:s,num:n,sortOrder:a,sortField:o,token:t.apiKey},signal:i?.signal},c=await t.portal.request(r,l);return{total:c.total,nextStart:c.nextStart,resources:c.resources.map(({created:h,size:f,resource:y})=>({created:new Date(h),size:f,resource:t.resourceFromPath(y)}))}}async function MDt(t,e,i,r){const s=new Map;for(const{resource:a,content:o,compress:l,access:c}of e){if(!a.hasPath())throw new ee(`portal-item-resource-${i}:invalid-path`,"Resource does not have a valid path");const[h,f]=Pke(a.path),y=`${h}/${l??""}/${c??""}`;s.has(y)||s.set(y,{prefix:h,compress:l,access:c,files:[]}),s.get(y).files.push({fileName:f,content:o})}await t.load(r);const n=Mp(t.userItemUrl,i==="add"?"addResources":"updateResources");for(const{prefix:a,compress:o,access:l,files:c}of s.values())for(let f=0;f<c.length;f+=25){const y=c.slice(f,f+25),_=new FormData;a&&a!=="."&&_.append("resourcesPrefix",a),o&&_.append("compress","true"),l&&_.append("access",l);let w=0;for(const{fileName:x,content:S}of y)_.append("file"+ ++w,S,x);_.append("f","json"),await t.portal.request(n,{method:"post",body:_,signal:r?.signal})}}async function EDt(t,e,i){if(!e.hasPath())throw new ee("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await t.load(i);const r=Mp(t.userItemUrl,"removeResources");await t.portal.request(r,{method:"post",query:{resource:e.path},signal:i?.signal}),e.portalItem=null}async function ADt(t,e){await t.load(e);const i=Mp(t.userItemUrl,"removeResources");return t.portal.request(i,{method:"post",query:{deleteAll:!0},signal:e?.signal})}function Pke(t){const e=t.lastIndexOf("/");return e===-1?[".",t]:[t.slice(0,e),t.slice(e+1)]}function Vse(t){const[e,i]=ODt(t),[r,s]=Pke(e);return[r,s,i]}function ODt(t){const e=zK(t);return e==null?[t,""]:[t.slice(0,t.length-e.length-1),`.${e}`]}async function eN(t){return t.type==="blob"?t.blob:t.type==="json"?new Blob([t.jsonString],{type:"application/json"}):(await $r(t.url,{responseType:"blob"})).data}function PDt(t,e){if(!t.hasPath())return null;const[i,,r]=Vse(t.path);return t.portalItem.resourceFromPath(Mp(i,e+r))}function Rke(t,e){if(!t.hasPath())return null;const[i,,r]=Vse(t.path);return t.portalItem.resourceFromPath(Mp(i,e+r))}const N3=Object.freeze(Object.defineProperty({__proto__:null,addOrUpdateResources:MDt,contentToBlob:eN,fetchResources:CDt,getSiblingOfSameType:PDt,getSiblingOfSameTypeI:Rke,removeAllResources:ADt,removeResource:EDt,splitPrefixFileNameAndExtension:Vse},Symbol.toStringTag,{value:"Module"}));async function RDt(t,e,i){const r=await Dke(t,e,i);await Ike(r,e,i)}async function DDt(t,e,i,r,s){const n=await Dke(i,r,s);await t.update({data:e}),await Ike(n,r,s)}async function Dke(t,e,i){if(!e?.resources)return;const r=e.portalItem===t.portalItem?new Set(t.paths):new Set;t.paths.length=0,t.portalItem=e.portalItem;const s=new Set(e.resources.toKeep.map(f=>f.resource.path)),n=new Set,a=[];s.forEach(f=>{r.delete(f),t.paths.push(f)});const o=[],l=[],c=[];for(const f of e.resources.toUpdate)if(r.delete(f.resource.path),s.has(f.resource.path)||n.has(f.resource.path)){const{resource:y,content:_,finish:w}=f,x=Rke(y,u2());t.paths.push(x.path),o.push({resource:x,content:await eN(_),compress:f.compress}),w&&c.push(()=>w(x))}else{t.paths.push(f.resource.path),l.push({resource:f.resource,content:await eN(f.content),compress:f.compress});const y=f.finish;y&&c.push(()=>y(f.resource)),n.add(f.resource.path)}for(const f of e.resources.toAdd)if(t.paths.push(f.resource.path),r.has(f.resource.path))r.delete(f.resource.path);else{o.push({resource:f.resource,content:await eN(f.content),compress:f.compress});const y=f.finish;y&&c.push(()=>y(f.resource))}if(o.length||l.length){const{addOrUpdateResources:f}=await te(()=>Promise.resolve().then(()=>N3),void 0);await f(e.portalItem,o,"add",i),await f(e.portalItem,l,"update",i)}if(c.forEach(f=>f()),a.length===0)return r;const h=await OBe(a);if(st(i),h.length>0)throw new ee("save:resources","Failed to save one or more resources",{errors:h});return r}async function Ike(t,e,i){if(!t||!e.portalItem)return;const r=[];for(const s of t){const n=e.portalItem.resourceFromPath(s);r.push(n.portalItem.removeResource(n,i))}await tU(r)}async function Ksi(t){const e=[];for(const i of t.allLayers)if("beforeSave"in i&&typeof i.beforeSave=="function"){const r=i.beforeSave();r&&e.push(r)}await Promise.allSettled(e)}const IDt=new Set(["layer:unsupported","property:unsupported","symbol:unsupported","symbol-layer:unsupported","url:unsupported"]);function LDt(t,e,i){let r=(t.messages??[]).filter(({type:s})=>s==="error").map(({name:s,message:n,details:a})=>new ee(s,n,a));if(t.blockedRelativeUrls&&(r=r.concat(t.blockedRelativeUrls.map(s=>new ee("url:unsupported",`Relative url '${s}' is not supported`)))),i){const{ignoreUnsupported:s,supplementalUnsupportedErrors:n=[],requiredPropertyChecksDisabled:a}=i;s&&(r=r.filter(({name:o})=>!(IDt.has(o)||n.includes(o)))),a&&(r=r.filter(o=>o.name!=="web-document-write:property-required"))}if(r.length>0)throw new ee(e.errorName,"Failed to save due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:r})}const kDt={width:600,height:400},Sk=1.5;function zDt(t,e){e=e||kDt;let{width:i,height:r}=e;const s=i/r;return s<Sk?r=i/Sk:s>Sk&&(i=r*Sk),i>t.width&&(r*=t.width/i,i=t.width),r>t.height&&(i*=t.height/r,r=t.height),{width:Math.round(i),height:Math.round(r)}}let Pb=class extends ke{constructor(e){super(e),this.geometries=[],this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const e=this.geometries.map(s=>s.toJSON()),i=this.geometries[0],r={};return r.outSR=ZN(this.outSpatialReference),r.inSR=ZN(i.spatialReference),r.geometries=JSON.stringify({geometryType:e4(i),geometries:e}),this.transformation&&(r.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),this.transformForward!=null&&(r.transformForward=this.transformForward),r}};d([m()],Pb.prototype,"geometries",void 0),d([m({type:Ie,json:{read:{source:"outSR"}}})],Pb.prototype,"outSpatialReference",void 0),d([m()],Pb.prototype,"transformation",void 0),d([m()],Pb.prototype,"transformForward",void 0),Pb=d([k("esri.rest.support.ProjectParameters")],Pb);const FDt=Ca(Pb);async function tni(t,e,i){e=FDt(e);const r=dEe(t),s={...r.query,f:"json",...e.toJSON()},n=e.outSpatialReference,a=e4(e.geometries[0]),o=rnt(s,i);return $r(r.path+"/project",o).then(({data:{geometries:l}})=>pEe(l,a,n))}["NatGeo_World_Map","Ocean_Basemap","USA_Topo_Maps","World_Imagery","World_Street_Map","World_Terrain_Base","World_Topo_Map","World_Hillshade","Canvas/World_Light_Gray_Base","Canvas/World_Light_Gray_Reference","Canvas/World_Dark_Gray_Base","Canvas/World_Dark_Gray_Reference","Ocean/World_Ocean_Base","Ocean/World_Ocean_Reference","Reference/World_Boundaries_and_Places","Reference/World_Reference_Overlay","Reference/World_Transportation"].map(t=>t.toLowerCase());async function NDt(t,e){const{item:i,authenticated:r}=t;return i?.id&&i.typeKeywords?.includes("useOnly")?i.portal.portalHostname!==e.portalHostname?{copyAllowed:!1,itemReloaded:!1}:(r||await i.reload(),{copyAllowed:i.itemControl==="admin"||i.itemControl==="update",itemReloaded:!0}):{copyAllowed:!0,itemReloaded:!1}}async function VDt(t,e,i,r){const s=t.portal,{item:n}=e,{folder:a}=r;let o=!1;if(n?.id&&S9e(n.portal.url,s.url)&&parseInt(n.portal.currentVersion,10)>=2023){const{total:l}=await n.fetchResources();o=!!l}if(o){const l=await n.copy({copyResources:"all",folder:a});t.id=l.id,t.portal=l.portal;const c=t.toJSON();await t.load(),t.read(c),await t.update({data:i})}else await s.user.addItem({item:t,folder:a,data:i});return o}function Zve(t){return{enabled:!!t?.length}}var gJ;let ZT=gJ=class extends ke{constructor(t){super(t),this.exactMatch=!1,this.name=null,this.type=null}clone(){return new gJ({exactMatch:this.exactMatch,type:this.type,name:this.name})}};d([m({type:Boolean,json:{write:!0}})],ZT.prototype,"exactMatch",void 0),d([m({type:String,json:{write:!0}})],ZT.prototype,"name",void 0),d([Et(Ute)],ZT.prototype,"type",void 0),ZT=gJ=d([k("esri.webdoc.applicationProperties.SearchLayerField")],ZT);const UDt=ZT;var yJ;let YT=yJ=class extends ke{constructor(t){super(t),this.field=null,this.id=null,this.subLayer=null}clone(){return new yJ(Te({field:this.field,id:this.id,subLayer:this.subLayer}))}};d([m({type:UDt,json:{write:{isRequired:!0}}})],YT.prototype,"field",void 0),d([m({type:String,json:{write:{isRequired:!0}}})],YT.prototype,"id",void 0),d([m({type:qi,json:{write:!0}})],YT.prototype,"subLayer",void 0),YT=yJ=d([k("esri.webdoc.applicationProperties.SearchLayer")],YT);const BDt=YT;var _J;let QT=_J=class extends ke{constructor(t){super(t),this.exactMatch=!1,this.name=null,this.type=null}clone(){return new _J({exactMatch:this.exactMatch,type:this.type,name:this.name})}};d([m({type:Boolean,json:{write:!0}})],QT.prototype,"exactMatch",void 0),d([m({type:String,json:{write:!0}})],QT.prototype,"name",void 0),d([Et(Ute)],QT.prototype,"type",void 0),QT=_J=d([k("esri.webdoc.applicationProperties.SearchTableField")],QT);const jDt=QT;var vJ;let mP=vJ=class extends ke{constructor(t){super(t),this.field=null,this.id=null}clone(){return new vJ(Te({field:this.field,id:this.id}))}};d([m({type:jDt,json:{write:{isRequired:!0}}})],mP.prototype,"field",void 0),d([m({type:String,json:{write:{isRequired:!0}}})],mP.prototype,"id",void 0),mP=vJ=d([k("esri.webdoc.applicationProperties.SearchTable")],mP);const qDt=mP;var bJ;const Lke=He.ofType(BDt),kke=He.ofType(qDt);let yf=bJ=class extends ke{constructor(t){super(t),this.addressSearchEnabled=!0,this.enabled=!0,this.hintText=null,this.layers=new Lke,this.tables=new kke}readAddressSearchEnabled(t){return!t}writeAddressSearchEnabled(t,e,i){e[i]=!t}clone(){return new bJ(Te({addressSearchEnabled:this.addressSearchEnabled,enabled:this.enabled,hintText:this.hintText,layers:this.layers,tables:this.tables}))}};d([m({type:Boolean,nonNullable:!0,json:{read:{source:"disablePlaceFinder"},write:{target:"disablePlaceFinder",isRequired:!0},origins:{"web-scene":{read:!1,write:!1}}}})],yf.prototype,"addressSearchEnabled",void 0),d([di("addressSearchEnabled")],yf.prototype,"readAddressSearchEnabled",null),d([Ht("addressSearchEnabled")],yf.prototype,"writeAddressSearchEnabled",null),d([m({type:Boolean,nonNullable:!0,json:{write:!0,origins:{"web-map":{write:{isRequired:!0}},"web-scene":{default:!0,write:!0}}}})],yf.prototype,"enabled",void 0),d([m({type:String,json:{write:!0}})],yf.prototype,"hintText",void 0),d([m({type:Lke,json:{write:{overridePolicy:Zve},origins:{"web-scene":{write:{isRequired:!0}}}}})],yf.prototype,"layers",void 0),d([m({type:kke,json:{read:!0,write:{overridePolicy:Zve}}})],yf.prototype,"tables",void 0),yf=bJ=d([k("esri.webdoc.applicationProperties.Search")],yf);const GDt=yf;var wJ;let tN=wJ=class extends ke{constructor(t){super(t),this.search=null}clone(){return new wJ(Te({search:this.search}))}};d([m({type:GDt,json:{write:!0}})],tN.prototype,"search",void 0),tN=wJ=d([k("esri.webdoc.applicationProperties.Viewing")],tN);const HDt=tN;var xJ;let iN=xJ=class extends ke{constructor(t){super(t),this.viewing=null}clone(){return new xJ({viewing:this.viewing?.clone()??null})}};d([m({type:HDt,json:{write:!0}})],iN.prototype,"viewing",void 0),iN=xJ=d([k("esri.webscene.ApplicationProperties")],iN);const WDt=iN,zke={type:Mn,json:{read:{source:"timeExtent",reader:t=>t?Array.isArray(t)?Mn.fromArray(t):Mn.fromJSON(t):null},write:{writer:(t,e,i,r)=>{t&&(t.isEmpty?r?.messages&&r.messages.push(new ee("invalid-timeExtent","TimeExtent cannot be empty")):e[i]=t.toArray())},target:{timeExtent:{type:[[qi,GD]]}}}}};let rN=class extends Nv{constructor(e){super(e),this.type="web-scene"}equals(e){return this.type===e.type}};d([m()],rN.prototype,"type",void 0),rN=d([k("esri.analysis.support.AnalysisOriginWebScene")],rN);const Yve=rN,ZDt=["slice"];let kw=class extends He{constructor(e){super(e),this.addHandles([this.on("after-add",i=>{this._setOrigin(i.item)}),this.on("before-remove",i=>{const{origin:r}=i.item;r?.type==="web-scene"&&this._setOrigin(i.item,null)})])}initialize(){for(const e of this.items)this._setOrigin(e)}_setOrigin(e,i=new Yve){e.origin=i}updateFrom(e){const i=e.analyses.filter(r=>Qve(r));this.removeAll(),i.length&&this.addMany(i.map(r=>(r.origin=new Yve,r.clone())))}applyTo(e){e.analyses.destroyMany(e.analyses.filter(({origin:i})=>i?.type==="web-scene")),e.analyses.addMany(this.map(i=>i.clone()))}toJSON(e){return this.items.filter(Qve).map(i=>i.toJSON(e))}};function Fke(t){return{type:kw,cast:DU,clonable:e=>new kw({items:e.items.map(i=>i.clone())}),set(e){this._set(t,kc(e,this._get(t),kw))},json:{read(e,i,r){r?.hooks?.onAfterLoad(()=>YDt(this[t],e,r))},write:{overridePolicy:e=>({enabled:e.length>0})}}}}function Qve(t){return ZDt.includes(t.type)&&t.valid}async function YDt(t,e,i){if(!e)return;const r=await Promise.allSettled(e.map(s=>QDt(s,i)));for(const s of r)s.status==="fulfilled"&&t.add(s.value)}async function QDt(t,e){const i=new(await XDt[t.type]());return i.read(t,e),i}kw=d([k("esri.webscene.support.analysisUtils.WebSceneAnalysesCollection")],kw);const XDt={slice:async()=>{const{default:t}=await te(()=>import("./SliceAnalysis--DtWfgy-.js"),__vite__mapDeps([382,383,344]));return t}};let pg=class extends ur(ke){constructor(e){super(e),this.analyses=new kw,this.environment=new b4,this.spatialReference=null,this.viewpoint=null,this.timeExtent=null}set viewingMode(e){this._set("viewingMode",e)}};d([m(Fke("analyses"))],pg.prototype,"analyses",void 0),d([m({type:b4,json:{write:{isRequired:!0}}})],pg.prototype,"environment",void 0),d([m({type:Ie,json:{default:()=>Ie.WebMercator}})],pg.prototype,"spatialReference",void 0),d([m({type:["local","global"],json:{default:"global"}})],pg.prototype,"viewingMode",null),d([m({type:Yf,json:{write:{isRequired:!0}}})],pg.prototype,"viewpoint",void 0),d([m(zke)],pg.prototype,"timeExtent",void 0),pg=d([k("esri.webscene.InitialViewProperties")],pg);const MV=pg;var SJ;let ep=SJ=class extends ke{constructor(){super(...arguments),this.url=""}destroy(){this.url=""}get isSecureUrl(){return hxe(this.url)}get isDataURI(){return rm(this.url)}clone(){return new SJ({url:this.url})}};d([m({type:String,json:{write:{isRequired:!0}}})],ep.prototype,"url",void 0),d([m()],ep.prototype,"isSecureUrl",null),d([m()],ep.prototype,"isDataURI",null),ep=SJ=d([k("esri.webdoc.support.SlideThumbnail")],ep);let sN=class extends ur(ke){constructor(){super(...arguments),this.text=""}};d([m({type:String,json:{write:{isRequired:!0}}})],sN.prototype,"text",void 0),sN=d([k("esri.webscene.support.Description")],sN);const nN=sN;let aN=class extends ur(ke){constructor(e){super(e),this.visible=!1}};d([m({type:Boolean,json:{default:!1,write:!0}})],aN.prototype,"visible",void 0),aN=d([k("esri.webscene.SlideLegendInfo")],aN);const JDt=aN,Xve=new ta({globalId:"global-id",objectId:"object-id"},{ignoreUnknown:!0});let oN=class extends ur(ke){constructor(e){super(e),this.type=null}};d([m({type:Xve.apiValues,readOnly:!0,json:{type:Xve.jsonValues,read:!1,write:!0}})],oN.prototype,"type",void 0),oN=d([k("esri.webscene.support.FeatureReferenceId")],oN);const Use=oN;let gP=class extends Use{constructor(e){super(e),this.type="object-id",this.value=null}};d([Et({objectId:"object-id"}),m({type:["object-id"],json:{read:!1,write:{isRequired:!0}},nonNullable:!0})],gP.prototype,"type",void 0),d([m({type:[Number,String],json:{read:!0,write:{isRequired:!0}}})],gP.prototype,"value",void 0),gP=d([k("esri.webscene.support.FeatureReferenceObjectId")],gP);const Nke=gP;let yP=class extends Use{constructor(e){super(e),this.type="global-id",this.value=null}};d([Et({globalId:"global-id"}),m({type:["global-id"],json:{read:!1,write:{isRequired:!0}},nonNullable:!0})],yP.prototype,"type",void 0),d([m({type:String,json:{read:!0,write:{isRequired:!0}}})],yP.prototype,"value",void 0),yP=d([k("esri.webscene.support.FeatureReferenceGlobalId")],yP);const KDt=yP,e4t={key:"type",base:Use,typeMap:{"object-id":Nke,"global-id":KDt}};let _P=class extends ur(ke){constructor(e){super(e),this.layerId=null,this.sublayerId=null}};d([m({type:String,json:{write:{isRequired:!0}},nonNullable:!0})],_P.prototype,"layerId",void 0),d([m({type:Number,json:{write:!0}})],_P.prototype,"sublayerId",void 0),_P=d([k("esri.webscene.support.LayerReference")],_P);const Vke=_P;let vP=class extends ur(ke){constructor(e){super(e),this.layerReference=new Vke,this.id=new Nke}};d([m({nonNullable:!0,json:{write:{isRequired:!0}},type:Vke})],vP.prototype,"layerReference",void 0),d([m({json:{read:!0,write:{isRequired:!0}},nonNullable:!0,types:e4t})],vP.prototype,"id",void 0),vP=d([k("esri.webscene.support.FeatureReference")],vP);const t4t=vP,Uke=He.ofType(t4t);let XT=class extends ur(ke){constructor(e){super(e),this.features=new Uke,this.selectedFeatureIndex=0,this.location=null}};d([m({type:Uke,nonNullable:!0,json:{read:!0,write:{isRequired:!0}}})],XT.prototype,"features",void 0),d([m({type:Number,nonNullable:!0,json:{write:!0}})],XT.prototype,"selectedFeatureIndex",void 0),d([m({type:Qe,json:{write:{isRequired:!0}}})],XT.prototype,"location",void 0),XT=d([k("esri.webscene.support.SlidePopupInfo")],XT);const i4t=XT;let JT=class extends ur(ke){constructor(e){super(e),this.analyses=new kw,this.legendInfo=null,this.popupInfo=null}};d([m(Fke("analyses"))],JT.prototype,"analyses",void 0),d([m({type:JDt,json:{write:!0}})],JT.prototype,"legendInfo",void 0),d([m({type:i4t,json:{write:!0}})],JT.prototype,"popupInfo",void 0),JT=d([k("esri.webscene.support.SlideElements")],JT);const Bke=JT;let V3=class extends ur(ke){constructor(){super(...arguments),this.lighting=new Qx,this.weather=new P6}};d([m({types:UOe,json:{write:!0}})],V3.prototype,"lighting",void 0),d([m({types:yie,json:{write:!0}})],V3.prototype,"weather",void 0),V3=d([k("esri.webscene.support.SlideEnvironment")],V3);var TJ;const r4t={type:Number,json:{type:qi,name:"transparency",read:$te,write:(t,e,i)=>{e[i]=Tte(t)}}};let lN=TJ=class extends ur(ke){constructor(){super(...arguments),this.opacity=null}cloneAndApplyTo(t){return this.opacity==null||((t=t?.clone()??new ZR).opacity=this.opacity),t}static fromGround(t){return new TJ({opacity:t.opacity})}};d([m(r4t)],lN.prototype,"opacity",void 0),lN=TJ=d([k("esri.webscene.support.SlideGround")],lN);const jke=lN;let U3=class extends ur(ke){constructor(e){super(e),this.id="",this.sublayerIds=null}};d([m({type:String,json:{write:!0}})],U3.prototype,"id",void 0),d([m({type:[qi],json:{name:"subLayerIds",write:!0}})],U3.prototype,"sublayerIds",void 0),U3=d([k("esri.webscene.support.SlideVisibleLayer")],U3);let cN=class extends ur(ke){constructor(){super(...arguments),this.text=""}};d([m({type:String,json:{write:{isRequired:!0}}})],cN.prototype,"text",void 0),cN=d([k("esri.webscene.support.Title")],cN);const _R=cN;let s4t=0;const $J=He.ofType(U3),n4t=["caption","cover","none"];let wn=class extends ur(ke){constructor(e){super(e),this.id=Date.now().toString(16)+"-slide-"+s4t++,this.title=new _R,this.description=new nN,this.hidden=!1,this.thumbnail=new ep,this.viewpoint=null,this.basemap=null,this.ground=null,this.layout="caption",this.enabledFocusAreas=null,this.environment=new V3,this.timeExtent=null,this.elements=new Bke,this.visibleLayers=new $J}destroy(){this.visibleLayers.removeAll(),this.enabledFocusAreas=null,this.basemap=null,this.thumbnail=Re(this.thumbnail),this.description=null,this.title=null,this.thumbnail=null,this.elements.destroy()}castTitle(e){return typeof e=="string"?new _R({text:e}):Ca(_R,e)}castDescription(e){return typeof e=="string"?new nN({text:e}):Ca(nN,e)}castThumbnail(e){return typeof e=="string"?new ep({url:e}):Ca(ep,e)}castBasemap(e){return Mte(e)}set visibleLayers(e){this._set("visibleLayers",kc(e,this._get("visibleLayers"),$J))}castVisibleLayers(e){return e&&typeof e.map=="function"?e.map(i=>{if(typeof i=="string")return{id:i};if(i instanceof Ms){const r=Jve(i);return{id:i.id,sublayerIds:r}}return i.id?{id:i.id,sublayerIds:"sublayerIds"in i?i.sublayerIds:void 0}:(fe.getLogger(this).warn('Invalid visible layer, expected { id }, Layer or "id"'),i)}):null}async _updateVisibleLayers(e){const i=[];await Promise.allSettled(this._getLayers(e.map).map(r=>e.whenLayerView(r).then(s=>{if(s.visible){const n=Jve(r);i.push(new U3({id:s.layer.id,sublayerIds:n}))}})).toArray()),this.visibleLayers.removeAll(),this.visibleLayers.addMany(i)}async updateFrom(e,i){const r={format:"png",quality:80,width:120,height:75,disableDecorations:!0,...i?.screenshot};await e.when(),this.viewpoint=e.viewpoint.clone(),this.environment.lighting=e.environment.lighting.type==="virtual"?v4.prototype.clone.apply(e.environment.lighting):Qx.prototype.clone.apply(e.environment.lighting),this.environment.weather=e.environment.weather.clone(),this.enabledFocusAreas=new He(e.focusAreasView?.enabledAreas.map(({id:n})=>n)??[]),this.basemap=e.map.basemap?.clone()||null,this.ground=e.map.ground?jke.fromGround(e.map.ground):null,this.timeExtent=e.timeExtent?.clone()??null,this.elements.analyses.updateFrom(e),await this._updateVisibleLayers(e);const s=await e.takeScreenshot(r);return this.thumbnail=new ep({url:s.dataUrl}),this}async applyTo(e,i){this._applyToController!=null&&this._applyToController.abort();let r=new AbortController;this._applyToController=r;const s=jD(i,()=>r?.abort()),n=()=>{this._applyToController===r&&(this._applyToController=null),r=null,s?.remove()};try{await mv(()=>e.ready,r.signal)}catch(f){throw n(),f}if(r.signal.aborted)throw n(),Xt();const a=e.resourceController.scheduler.registerTask(yt.SLIDE);let o=!1;const l={animate:!0,...i,signal:this._applyToController.signal},c=async()=>{await Promise.all([a.schedule(async()=>o=await this._setViewpointOfInterest(e,l)),a.schedule(()=>this._applyBasemap(e,l),l.signal),a.schedule(()=>this._loadLayersWithSublayerVisibility(e))]),await Promise.all([a.schedule(()=>this._applyLayerVisibility(e),l.signal),a.schedule(()=>this._applyFocusAreaEnabled(e.map?.focusAreas.areas)),a.schedule(()=>this._applyGround(e),l.signal),a.schedule(()=>this.elements.analyses.applyTo(e),l.signal),a.schedule(()=>this._applyViewpoint(e,l),l.signal),a.schedule(()=>e.timeExtent=this.timeExtent?.clone()??null,l.signal),a.schedule(()=>e.environment.weather=this.environment.weather.clone())])},h=await Xf(e.addUpdatingPromise(c()));if(o&&(e.contentCamera=null),a.remove(),n(),h.ok===!1)throw h.error;return this}async _applyBasemap(e,i){if(this.basemap){try{await this.basemap.load(i)}catch(r){if(Hr(r))throw r}e.map.basemap=Rtt(this.basemap,e.map.basemap)}}_applyGround(e){this.ground&&(e.map.ground=this.ground.cloneAndApplyTo(e.map.ground))}_applyFocusAreaEnabled(e){if(e&&this.enabledFocusAreas)for(const i of e)i.enabled=this.enabledFocusAreas.includes(i.id)}_getLayers(e){const i=new He;return this._collectLayers(e,i),this._collectLayers(e.ground,i),i}_collectLayers(e,i){e.layers.forEach(r=>{r.persistenceEnabled&&(i.add(r),"layers"in r&&this._collectLayers(r,i))})}async _loadLayersWithSublayerVisibility(e){this.visibleLayers&&await Promise.allSettled(this._getLayers(e.map).items.map(i=>this.visibleLayers.find(s=>s.id===i.id)?.sublayerIds?i.load():null))}_applyLayerVisibility(e){this.visibleLayers&&this._getLayers(e.map).forEach(i=>{const r=this.visibleLayers.find(a=>a.id===i.id);i.visible=r!=null;const s=r?.sublayerIds,n=qke(i);s&&n&&n.forEach(a=>a.visible=s.includes(a.id))})}async _setViewpointOfInterest(e,i){if(e.state.fixedContentCamera||!this.viewpoint||i?.ignoreViewpoint||!i?.useDestinationCamera)return!1;const{toCameraAsync:r}=await te(()=>Promise.resolve().then(()=>Jdt),void 0),s=await r(e,this.viewpoint);return e.contentCamera=s,s!=null}async _applyViewpoint(e,i){if(this._applyCachedCameraTrackingEnabled(e),this.viewpoint&&!i.ignoreViewpoint){const r=this.environment.lighting;if(i.animate&&r.type==="sun"&&r.date)return this._animateToLighting(e,i);i.animate&&(e.environment.applyLighting(r.clone()),await e.goTo(this.viewpoint,i)),e.viewpoint=this.viewpoint}e.environment.applyLighting(this.environment.lighting.clone())}async _animateToLighting(e,i){let r=null;return e.environment.lighting.type!=="virtual"&&this.environment.lighting.type!=="virtual"&&(e.viewingMode==="global"&&(r=this._animateLightingWithCamera(e,e.environment.lighting,this.environment.lighting)),e.environment.cachedCameraTrackingEnabled=e.environment.lighting.cameraTrackingEnabled,e.environment.lighting.cameraTrackingEnabled=!1),e.environment.lighting.directShadowsEnabled=this.environment.lighting.directShadowsEnabled,this.environment.lighting.type==="virtual"||e.environment.lighting.type==="virtual"?(e.environment.applyLighting(this.environment.lighting.clone()),e.environment.lighting.type!=="virtual"&&(e.environment.cachedCameraTrackingEnabled=e.environment.lighting.cameraTrackingEnabled,e.environment.lighting.cameraTrackingEnabled=!1)):this.environment.lighting.displayUTCOffset!=null&&(e.environment.lighting.displayUTCOffset=this.environment.lighting.displayUTCOffset),e.goTo(this.viewpoint,i).then(()=>{this._applyCachedCameraTrackingEnabled(e),e.environment.applyLighting(this.environment.lighting.clone())}).catch(s=>{throw e.animation==null&&this._applyCachedCameraTrackingEnabled(e),s}).finally(()=>{Ki(r)})}_applyCachedCameraTrackingEnabled(e){e.environment.cachedCameraTrackingEnabled!=null&&(e.environment.lighting.cameraTrackingEnabled=e.environment.cachedCameraTrackingEnabled,e.environment.cachedCameraTrackingEnabled=null)}_getTime(e){return[e.getTime(),3600*e.getUTCHours()+60*e.getUTCMinutes()+e.getUTCSeconds()]}_setTime(e,i,r){return e.setTime(i),e.setUTCHours(r/3600),e.setUTCMinutes(r%3600/60),e.setUTCSeconds(r%3600%60),e}_animateLightingWithCamera(e,i,r){const s=new Date(i.date.toString()),[n,a]=this._getTime(s),[o,l]=this._getTime(r.date),c=o4t(a,l),h=e.renderCoordsHelper,f=R();h.toRenderCoords(e.camera.position,f);const y=R(),_=R();this.viewpoint.camera!=null&&h.toRenderCoords(this.viewpoint.camera.position,y);const w=new Date;return Zs(()=>e.camera,x=>{h.toRenderCoords(x.position,_);const S=on(f,_),$=on(y,_);let A=0;S+$!==0&&(A=S/(S+$));const M=n+(o-n)*A,P=l4t(a,c*A);i.date=this._setTime(w,M,P)})}write(e,i){const r=super.write(e,i);return r?.elements&&Object.keys(r.elements).length===0&&delete r.elements,r}static createFrom(e,i){return new this().updateFrom(e,i)}};d([m({type:String,json:{write:{isRequired:!0}}})],wn.prototype,"id",void 0),d([m({type:_R,json:{default:()=>new _R({text:""}),write:{isRequired:!0}}})],wn.prototype,"title",void 0),d([qr("title")],wn.prototype,"castTitle",null),d([m({type:nN,json:{write:{overridePolicy:t=>({enabled:!(!t||!t.text)})}}})],wn.prototype,"description",void 0),d([qr("description")],wn.prototype,"castDescription",null),d([m({type:Boolean,nonNullable:!0,json:{write:!0,default:!1}})],wn.prototype,"hidden",void 0),d([m({type:ep,json:{default:()=>new ep({url:""}),write:{isRequired:!0}}})],wn.prototype,"thumbnail",void 0),d([qr("thumbnail")],wn.prototype,"castThumbnail",null),d([m({type:Yf,nonNullable:!0,json:{write:{isRequired:!0}}})],wn.prototype,"viewpoint",void 0),d([m({type:t$,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],wn.prototype,"basemap",void 0),d([qr("basemap")],wn.prototype,"castBasemap",null),d([m({type:jke,json:{write:!0}})],wn.prototype,"ground",void 0),d([m({type:n4t,json:{write:!0,default:"caption"},nonNullable:!0})],wn.prototype,"layout",void 0),d([m({type:$J,json:{write:{isRequired:!0}}})],wn.prototype,"visibleLayers",null),d([qr("visibleLayers")],wn.prototype,"castVisibleLayers",null),d([m({type:He.ofType(String),json:{write:!0},clonable:t=>t?new He(t.items):null})],wn.prototype,"enabledFocusAreas",void 0),d([m({type:V3,json:{write:!0}})],wn.prototype,"environment",void 0),d([m(zke)],wn.prototype,"timeExtent",void 0),d([m({type:Bke,nonNullable:!0,json:{write:!0}})],wn.prototype,"elements",void 0),wn=d([k("esri.webscene.Slide")],wn);const a4t=wn;function qke(t){if(t.type==="building-scene"||t.type==="map-image")return t.allSublayers.toArray()}function Jve(t){const e=qke(t);if(e)return e.filter(i=>i.visible).map(i=>i.id)}const CJ=86400,Kve=43200;function o4t(t,e){let i=e-t;return i>Kve&&(i-=CJ),i<-Kve&&(i+=CJ),i}function l4t(t,e){return Gje(t+e,CJ)}const MJ=He.ofType(a4t);let uN=class extends ur(ke){constructor(e){super(e),this.slides=new MJ}destroy(){this.slides.forEach(e=>e.destroy()),this.slides.removeAll()}set slides(e){e&&(e=e.filter(i=>!!i.viewpoint)),this._set("slides",kc(e,this._get("slides"),MJ))}};d([m({type:MJ,nonNullable:!0,json:{write:!0}}),qr(DU)],uN.prototype,"slides",null),uN=d([k("esri.webscene.Presentation")],uN);const Gke=uN;var EJ;let KT=EJ=class extends ke{constructor(t){super(t)}clone(){return new EJ({name:this.name,path:this.path,title:this.title})}};d([m({type:String,json:{write:{isRequired:!0}}})],KT.prototype,"name",void 0),d([m({type:String,json:{write:{isRequired:!0}}})],KT.prototype,"path",void 0),d([m({type:String,json:{write:{isRequired:!0}}})],KT.prototype,"title",void 0),KT=EJ=d([k("esri.webscene.TransportationNetwork")],KT);const c4t=KT;let EV=class extends q8{constructor(e,i){super(e,i,"webscene")}get supportsGround(){return this.greaterEqual(1,8)}get supportsVisibleElevationLayersInSlides(){return this.lessThan(1,8)}};var e1e;const Zb=new EV(1,38),u4t=()=>{const e=[],i=Zb.major;for(let r=8;r<=Zb.minor;r++)e.push(`${i}.${r}`);return e},TH="Web Scene";var eC;let mr=(eC=class extends _$e(cte(Mke(ACe))){constructor(e){super(e),this[e1e]=!0,this._layersIdGCTimeoutId=void 0,this._updateFromPromise=null,this._afterLoadHooks=[],this.applicationProperties=null,this.clippingArea=null,this.clippingEnabled=!1,this.floorInfo=null,this.heightModelInfo=void 0,this.sourceVersion=null,this.transportationNetworks=null,this.presentation=new Gke,this.initialViewProperties=new MV,this.portalItem=null,this.resourceInfo=null,this.widgets=null,this._debouncedSaveOperations=wwe(async(i,r,s)=>{switch(i){case 0:return this._saveImpl(r);case 1:return this._saveAsImpl(s,r)}}),this._loadContext={origin:"web-scene",initiator:this,hooks:{onAfterLoad:i=>this._afterLoadHooks.push(i)}},this._resourceReferences={portalItem:null,paths:[]},this.authoringApp=null,this.authoringAppVersion=null,this._isAuthoringAppSetByUser=!1,this._isAuthoringAppVersionSetByUser=!1}initialize(){if(this.when().catch(e=>{fe.getLogger(this).error("#load()","Failed to load web scene",e)}),this.resourceInfo){let e;try{e=this._validateJSON(this.resourceInfo)}catch(i){return void this.addResolvingPromise(Promise.reject(i))}this.read(e),this.addResolvingPromise(this._validateSpatialReference()),this.addResolvingPromise(this._validateHeightModelInfo())}this.addHandles(Ys(()=>this.allLayers,"change",()=>this._scheduleLayersIdGC()))}destroy(){this._unscheduleLayersIdGC(),this.presentation&&this.presentation.destroy(),this.portalItem=Re(this.portalItem)}writeClippingArea(e,i){i.clippingArea||(i.clippingArea={}),i.clippingArea.geometry=e.toJSON()}readClippingEnabled(e,i){return!!i.clippingArea&&!!i.clippingArea.clip}writeClippingEnabled(e,i){this.clippingArea&&(i.clippingArea||(i.clippingArea={}),i.clippingArea.clip=e)}writeLayers(e,i,r,s){i[r]=this._layersToJSON(e,"operational-layers",s)}get loaded(){return super.loaded}readSourceVersion(e,i){const[r,s]=i.version.split(".");return new EV(parseInt(r,10),parseInt(s,10))}writeSourceVersion(e,i,r){i[r]=`${Zb.major}.${Zb.minor}`}writeTables(e,i,r,s){const n=this._layersToJSON(e,"tables",s);n.length&&(i[r]=n)}get thumbnailUrl(){return this.portalItem?.thumbnailUrl??null}set thumbnailUrl(e){e?this._override("thumbnailUrl",e):(this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"))}set authoringApp(e){this._isAuthoringAppSetByUser=!0,this._set("authoringApp",e)}writeAuthoringApp(e,i){e&&this._isAuthoringAppSetByUser?i.authoringApp=e:i.authoringApp="ArcGIS API for JavaScript"}set authoringAppVersion(e){this._isAuthoringAppVersionSetByUser=!0,this._set("authoringAppVersion",e)}writeAuthoringAppVersion(e,i){e&&this._isAuthoringAppVersionSetByUser?i.authoringAppVersion=e:i.authoringAppVersion=vxe}writeGround(e,i,r,s){i[r]=e?e.write({},s):{transparency:0,layers:[]}}readInitialViewProperties(e,i,r){const{viewingMode:s,spatialReference:n}=i,a=new MV,o={...i.initialState};return n!==void 0&&(o.spatialReference=n),s!==void 0&&(o.viewingMode=s),a.read(o,r),a}get spatialReference(){return this.initialViewProperties?.spatialReference??Ie.WebMercator}get viewingMode(){return this.initialViewProperties?.viewingMode??"global"}load(e){const i=this.ground;return this.addResolvingPromise(this._loadFromSource().then(()=>{i&&i!==this.ground&&i.destroy(),this._validateFeatureLayerSymbolVisibility()})),Promise.resolve(this)}loadAll(){return xte(this,e=>{const i=this.presentation&&this.presentation.slides;e(this.ground,this.basemap,this.layers,i&&i.map(r=>r.basemap),this.tables)})}read(e,i){i??=this._loadContext,i.origin="web-scene";const r=this._isAuthoringAppVersionSetByUser,s=this._isAuthoringAppSetByUser;if(Kje(this,e,n=>super.read(e,n),i),s||(this._isAuthoringAppSetByUser=!1),r||(this._isAuthoringAppVersionSetByUser=!1),e.baseMap&&Array.isArray(e.baseMap.elevationLayers)&&this.sourceVersion?.supportsVisibleElevationLayersInSlides){const n=e.baseMap.elevationLayers.map(l=>({id:l.id})),a=this.presentation.slides,o=n.filter(l=>!a.some(c=>c.visibleLayers.some(h=>h.id===l.id)));a.forEach(l=>l.visibleLayers.addMany(o))}}_writeBasemapElevationLayers(e){const i=e.ground?.layers;!e.baseMap&&i?.length&&(e.baseMap={title:"Basemap",baseMapLayers:[]}),e.baseMap&&(e.baseMap.elevationLayers=Te(i))}_layersToJSON(e,i,r){const s={...r,layerContainerType:i};return e.map(n=>this._verifyWritableLayer(n,r)?n.write({},s):null).filter(n=>!!n).toArray()}_verifyWritableLayer(e,i){return!!e.persistenceEnabled&&("write"in e||(i?.messages?.push(new ee("layer:unsupported",`Layers (${e.title}, ${e.id}) of type '${e.declaredClass}' cannot be persisted in web scenes`,{layer:e})),!1))}write(e,i){if(this.loadStatus!=="loaded"){const n=new ee("webscene:not-loaded","Web scene must be loaded before it can be serialized");throw fe.getLogger(this).error("#toJSON()","Web scene must be loaded before it can be serialized",this.loadError||this.loadStatus),n}this._runLayersIdGC();const r=!i?.messages;i={messages:[],...i,origin:"web-scene"};const s=super.write(e,i);if(r){const n=i.messages?.filter(a=>a.name==="web-document-write:property-required")??[];if(n.length){const a=new ee("web-document:property-required","One or more properties that are required in the webscene JSON are missing, see details for the specific errors",{errors:n});throw fe.getLogger(this).error("#toJSON()","One or more properties that are required in the webscene JSON are missing",n),a}}return this._writeBasemapElevationLayers(s),s}async save(e){return this._debouncedSaveOperations(0,e)}async _saveImpl(e){if(!this.portalItem)throw new ee("webscene:portal-item-not-set","Portal item to save to has not been set on the WebScene");if(this.portalItem?.type!==TH)throw new ee("webscene:portal-item-wrong-type",`Portal item needs to have type "${TH}"`);const i=this._updateFromPromise;await this._ensureLoadBeforeSave();const r=this._enableVerifyItemRelativeUrls(Hve(this.portalItem,"web-scene",!0)),s=this.write({},r);return await Promise.all(r.resources.pendingOperations),await this._verifySave(s,r,0,e),this._updateTypeKeywords(this.portalItem),await DDt(this.portalItem,s,this._resourceReferences,r),Gve(r),i&&await i,await this._saveThumbnail(),this.portalItem}async saveAs(e,i){return this._debouncedSaveOperations(1,i,e)}async _saveAsImpl(e,i){let r=Kt.from(e);if(!r)throw new ee("webscene:portal-item-required","saveAs requires a portal item to save to");r.id&&(r=r.clone(),r.id=null);const s=r.portal||Fe.getDefault();await this._ensureLoadBeforeSave(),r.type=TH,r.portal=s;const n=this._enableVerifyItemRelativeUrls(Hve(r,"web-scene",!0)),a=this.write({},n);await Promise.all(n.resources.pendingOperations),await this._verifySaveAs(a,n,i);const o=this.thumbnailUrl,l=!this._isOverridden("thumbnailUrl");this._updateTypeKeywords(r),await s.signIn();const c=this.portalItem,h={item:c,authenticated:!(!c?.id||!c.portal.user)},{copyAllowed:f,itemReloaded:y}=await NDt(h,s);if(h.authenticated||=y,!f)throw new ee(`${n.name}:save-as-copy-not-allowed`,"Owner of this map does not allow others to save a copy");const _={...i};return await VDt(r,h,a,_)&&(this._resourceReferences.portalItem=r),await RDt(this._resourceReferences,n),this.portalItem=r,fDt.prototype.read.call(this,{version:a.version,authoringApp:a.authoringApp,authoringAppVersion:a.authoringAppVersion},{name:"web-scene",ignoreDefaults:!0,url:r.itemUrl?Ma(r.itemUrl):void 0}),Gve(n),o&&(this.thumbnailUrl=l?mxe(o,"w","8192"):o),n.portalItem=r,await this._saveThumbnail(),r}async _saveThumbnail(){this._isOverridden("thumbnailUrl")&&(await this.portalItem?.updateThumbnail({thumbnail:this.thumbnailUrl}),this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"))}async _verifySave(e,i,r,s){if(!WD(this.spatialReference))throw new ee("webscene:unsupported-spatial-reference","Webscenes using spatial reference systems from Mars or Moon can not be saved currently.");const{ignoreUnsupported:n,requiredPropertyChecksDisabled:a,strictSchemaValidationEnabled:o}=s||{};LDt(i,{errorName:"webscene:save"},{ignoreUnsupported:n,supplementalUnsupportedErrors:["scenemodification:unsupported"],requiredPropertyChecksDisabled:a})}_verifySaveAs(e,i,r){return this._verifySave(e,i,1,r)}verifySaveAs(e){const i=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),r=this.write({},i);return this._verifySaveAs(r,i,e)}canNotSaveAs(){return!1}async updateFrom(e,i={}){const r=this._updateFrom(e,i);this._updateFromPromise=r,await r,this._updateFromPromise===r&&(this._updateFromPromise=null)}async _updateFrom(e,i={}){if(await e.whenReady(),!i.environmentExcluded&&e.environment&&(this.initialViewProperties.environment=b4.prototype.clone.apply(e.environment)),!i.viewpointExcluded&&e.viewpoint&&(this.initialViewProperties.viewpoint=e.viewpoint.clone()),this.initialViewProperties.spatialReference=e.spatialReference.clone(),this.initialViewProperties.viewingMode=e.viewingMode,this.initialViewProperties.timeExtent=e.timeExtent?.clone()??null,this.initialViewProperties.analyses.updateFrom(e),e.clippingArea!=null?e.clippingArea!==this.clippingArea&&(this.clippingArea=e.clippingArea.clone(),this.clippingEnabled=!0):this.clippingEnabled=!1,e.heightModelInfo&&(this.heightModelInfo=e.heightModelInfo.clone()),e.map===this)for(const r of e.allLayerViews){const s="visible";s in r&&s in r.layer&&r._isOverridden(s)&&(r.layer[s]=r[s])}if(!i.widgetsExcluded)for(const r of e.persistableViewModels)r.updateWebDocument(this);(i.thumbnailExcluded===!1||i.thumbnailExcluded==null&&!i.viewpointExcluded)&&await this.updateThumbnail(e,{size:i.thumbnailSize})}async updateThumbnail(e,i){const r=zDt(e,i?.size),s=await e.takeScreenshot({format:"jpg",width:r.width,height:r.height,disableDecorations:!0});this.thumbnailUrl=s.dataUrl}async _loadFromSource(){this.resourceInfo?await this._loadFromJSON(this.resourceInfo):this.portalItem?.id?await this._loadFromItem(this.portalItem):await this._loadObjectsWithLayers(),await this._afterLoad()}async _afterLoad(){for(;this._afterLoadHooks.length;){const e=this._afterLoadHooks.slice();this._afterLoadHooks.length=0,await Promise.allSettled(e.map(i=>i(this._loadContext)))}}_readAndLoadFromJSON(e){const i=this._loadContext,r=this._validateJSON(e);return this.read(r,i),this._loadFromJSON(r)}_extractOperationalLayers(e){const i=[];if(!this.sourceVersion?.supportsGround&&e.baseMap&&Array.isArray(e.baseMap.elevationLayers))for(const n of e.baseMap.elevationLayers)i.push(n);const r=[],s=n=>(n.layers&&(n.layers=n.layers.filter(s)),n.layerType!=="ArcGISTiledElevationServiceLayer"||(this.sourceVersion?.supportsGround||r.push(n),!1));return{operationalLayers:e.operationalLayers?e.operationalLayers.filter(s):[],operationalElevationLayers:r,basemapElevationLayers:i}}async _loadFromJSON(e){const i=new He;await this._validateSpatialReference(),await this._validateHeightModelInfo();const{populateOperationalLayers:r}=await te(()=>import("./layersCreator-i2Z_AdV6.js"),__vite__mapDeps([176,117,116,115,118,114,167])),{operationalLayers:s,operationalElevationLayers:n,basemapElevationLayers:a}=this._extractOperationalLayers(e),o=[],l={context:{...this._loadContext,layerContainerType:"operational-layers"}};if(this.portalItem&&(l.context.portal=this.portalItem.portal||Fe.getDefault()),a.length>0){const c={...l,context:{...l.context,layerContainerType:"ground"}};c.defaultLayerType="ArcGISTiledElevationServiceLayer",o.push(r(this.ground.layers,a,c))}if(n.length>0){const c={...l,context:{...l.context,layerContainerType:"ground"}};c.defaultLayerType="ArcGISTiledElevationServiceLayer",o.push(r(i,n,c))}s&&s.length>0&&o.push(r(this.layers,s,l)),e.tables?.length&&o.push(r(this.tables,e.tables,{...l,context:{...l.context,layerContainerType:"tables"},defaultLayerType:"ArcGISFeatureLayer"})),await Promise.allSettled(o),await this._loadObjectsWithLayers(),this.ground.layers.addMany(i.filter(c=>c.type==="base-elevation"||c.type==="elevation"))}async _ensureLoadBeforeSave(){await this.load(),await this._loadObjectsWithLayers();const e=[],i=[...this.allLayers.items];for(const{basemap:r}of this.presentation.slides.items)r&&(i.push(...r.baseLayers.items),i.push(...r.groundLayers.items),i.push(...r.referenceLayers.items));for(const r of i)if("beforeSave"in r&&typeof r.beforeSave=="function"){const s=r.beforeSave();s&&e.push(s)}await Promise.allSettled(e)}async _loadObjectsWithLayers(){const e=[];this.ground&&e.push(this.ground.load()),this.basemap&&e.push(this.basemap.load()),this.presentation.slides.forEach(i=>{i.basemap&&e.push(i.basemap.load())}),await Promise.allSettled(e)}async _loadFromItem(e){if(await e.load().catch(s=>{throw new ee("webscene:load-portal-item","Failed to load portal item",{error:s})}),e.type!=="Web Scene")throw new ee("webscene:invalid-portal-item","Invalid portal item type '${type}', expected 'Web Scene'",{type:e.type});const i=await e.fetchData();this.resourceInfo=i;const r=this._loadContext;r.url=Ma(e.itemUrl),r.portal=e.portal||Fe.getDefault(),r.portalItem=e,r.readResourcePaths=[],await this._readAndLoadFromJSON(i),this._resourceReferences={portalItem:e,paths:r.readResourcePaths??[]}}_validateSpatialReference(){const e=this.initialViewProperties,i=this._sceneSpatialReference;let r;if(e.viewingMode!=="local"){if(!rD(i,1))return Promise.reject(new ee("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in global mode, only Web Mercator, WGS84 GCS or CGCS2000 are supported",{spatialReference:i,viewingMode:e.viewingMode}));r=l=>!l||Nu(l,i)}else{if(!rD(i,2))return Promise.reject(new ee("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in local mode, only projected coordinate systems are supported",{spatialReference:i,viewingMode:e.viewingMode}));r=l=>!l||l.equals(i)}const s=l=>l?.camera?.position.spatialReference??l?.targetGeometry?.spatialReference,n=e.viewpoint,a=s(n);if(a&&!r(a))return Promise.reject(new ee("webscene:incompatible-camera-spatial-reference","Camera spatial reference (${cameraSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{cameraSpatialReference:a,sceneSpatialReference:i,viewingMode:e.viewingMode}));const o=this.presentation.slides.find(l=>!r(s(l.viewpoint)));if(o){const l=s(o.viewpoint);return Promise.reject(new ee("webscene:incompatible-slide-spatial-reference","Slide spatial reference (${slideSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{slideSpatialReference:l,sceneSpatialReference:i,viewingMode:e.viewingMode}))}return Promise.resolve()}_validateHeightModelInfo(){const e=this._sceneSpatialReference,i=Bst(this.heightModelInfo,e);return i?Promise.reject(i):Promise.resolve()}_validateFeatureLayerSymbolVisibility(){this.sourceVersion?.greaterEqual(1,35)||this.layers.forEach(e=>{e.type==="feature"&&e.addHandles(K(()=>e.loaded,()=>{e.elevationInfo?.mode==="on-the-ground"&&e.renderer?.type==="simple"&&e.renderer.symbol?.type==="polygon-3d"&&e.renderer.symbol.symbolLayers.some(i=>i.type==="fill"&&i.material!=null&&(!i.material.color||i.material.color.a*e.opacity<Gr)&&(e.loadWarnings.push(new ay("feature-layer:invisible-draped-symbols","FeatureLayer has fully transparent symbols which will no longer render or highlight",{layer:e})),!0))},{once:!0,sync:!0}))})}_validateJSON(e){const i=EV.parse(e.version||"","webscene");return Zb.validate(i),e.version=`${i.major}.${i.minor}`,i.major===1&&i.minor<=2&&(e.spatialReference=Ie.WebMercator.toJSON()),e}_updateTypeKeywords(e){Wve(e,hJ.LOCAL_SCENE,this.initialViewProperties.viewingMode==="local"),Wve(e,hJ.DEVELOPER_BASEMAP,Zde(this.basemap)||this.presentation.slides.some(({basemap:i})=>!!i&&Zde(i))),e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter((i,r,s)=>s.indexOf(i)===r))}get _sceneSpatialReference(){return this.initialViewProperties.spatialReference||Ie.WebMercator}get _verifyItemRelativeRootPath(){return this.portalItem?.itemUrl?Ma(this.portalItem.itemUrl).path:null}_enableVerifyItemRelativeUrls(e){const i=this._verifyItemRelativeRootPath;return i&&(e.verifyItemRelativeUrls={rootPath:i,writtenUrls:[]}),e}_unscheduleLayersIdGC(){this._layersIdGCTimeoutId&&(clearTimeout(this._layersIdGCTimeoutId),this._layersIdGCTimeoutId=0)}_scheduleLayersIdGC(){this._unscheduleLayersIdGC(),this._layersIdGCTimeoutId=setTimeout(()=>{this._layersIdGCTimeoutId=0,this._runLayersIdGC()},3e3)}_runLayersIdGC(){this._unscheduleLayersIdGC();const e=this.applicationProperties?.viewing?.search,i=s=>this.allLayers.some(n=>n.id===s&&n.persistenceEnabled);e?.layers&&(e.layers=e.layers.filter(s=>i(s.id)));const r=this.presentation&&this.presentation.slides;r&&r.forEach(s=>{s.visibleLayers&&(s.visibleLayers=s.visibleLayers.filter(n=>i(n.id)))})}static fromJSON(e){if(!e)throw new ee("webscene:empty-resource","Expected a JSON resource but got nothing");return new this({resourceInfo:e})}},e1e=P$e,eC.version=`${Zb.major}.${Zb.minor}`,eC);d([m({type:WDt,json:{write:!0}})],mr.prototype,"applicationProperties",void 0),d([m({type:Bt,json:{read:{source:"clippingArea.geometry",reader:hy},write:{target:"clippingArea.geometry"}}})],mr.prototype,"clippingArea",void 0),d([Ht("clippingArea")],mr.prototype,"writeClippingArea",null),d([m({type:Boolean,json:{write:{target:"clippingArea.clip"}}})],mr.prototype,"clippingEnabled",void 0),d([di("clippingEnabled",["clippingArea"])],mr.prototype,"readClippingEnabled",null),d([Ht("clippingEnabled")],mr.prototype,"writeClippingEnabled",null),d([m({type:wDt,json:{read:{source:"mapFloorInfo"},write:{target:"mapFloorInfo"}}})],mr.prototype,"floorInfo",void 0),d([m({type:Eo,json:{write:!0}})],mr.prototype,"heightModelInfo",void 0),d([m({json:{write:{target:"operationalLayers",ignoreOrigin:!0}}})],mr.prototype,"layers",void 0),d([Ht("layers")],mr.prototype,"writeLayers",null),d([m({readOnly:!0,type:EV,json:{type:u4t(),write:{ignoreOrigin:!0,target:"version",isRequired:!0,overridePolicy:()=>({enabled:!0,allowNull:!0,ignoreOrigin:!0})}}})],mr.prototype,"sourceVersion",void 0),d([di("sourceVersion",["version"])],mr.prototype,"readSourceVersion",null),d([Ht("sourceVersion")],mr.prototype,"writeSourceVersion",null),d([m({json:{read:!1,write:{enabled:!0,ignoreOrigin:!0}}})],mr.prototype,"tables",void 0),d([Ht("tables")],mr.prototype,"writeTables",null),d([m()],mr.prototype,"thumbnailUrl",null),d([m({type:String,json:{write:{writerEnsuresNonNull:!0,ignoreOrigin:!0}}})],mr.prototype,"authoringApp",null),d([Ht("authoringApp")],mr.prototype,"writeAuthoringApp",null),d([m({type:String,json:{write:{writerEnsuresNonNull:!0,ignoreOrigin:!0}}})],mr.prototype,"authoringAppVersion",null),d([Ht("authoringAppVersion")],mr.prototype,"writeAuthoringAppVersion",null),d([m({json:{write:{isRequired:!0,enabled:!0,overridePolicy:()=>({isRequired:!0,enabled:!0,allowNull:!0,ignoreOrigin:!0})}}})],mr.prototype,"ground",void 0),d([Ht("ground")],mr.prototype,"writeGround",null),d([m({type:He.ofType(c4t),json:{write:!0}})],mr.prototype,"transportationNetworks",void 0),d([m({type:Gke,nonNullable:!0,json:{write:{ignoreOrigin:!0,writer:(t,e,i,r)=>{if(t.slides&&t.slides.length>0){const s={...r,isPresentation:!0};e.presentation=t.write({},s)}}}}})],mr.prototype,"presentation",void 0),d([m({type:MV,nonNullable:!0,json:{write:{target:"initialState",isRequired:!0,ignoreOrigin:!0},default:()=>new MV({viewingMode:"global",spatialReference:Ie.WebMercator})}})],mr.prototype,"initialViewProperties",void 0),d([di("initialViewProperties",["initialState","spatialReference","viewingMode"])],mr.prototype,"readInitialViewProperties",null),d([m({type:Ie,json:{read:!1,write:{isRequired:!0,ignoreOrigin:!0}}})],mr.prototype,"spatialReference",null),d([m({type:["local","global"],json:{read:!1,write:{isRequired:!0,ignoreOrigin:!0}}})],mr.prototype,"viewingMode",null),d([m({type:Kt})],mr.prototype,"portalItem",void 0),d([m()],mr.prototype,"resourceInfo",void 0),d([m({type:$Dt,json:{write:!0}})],mr.prototype,"widgets",void 0),mr=d([k("esri.WebScene")],mr);const h4t=mr,ca=(t,e)=>{const r=eM().manager;r.onLoaded(()=>r.onLifecycle(()=>Ys(t,e,s.emit)));const s=XJ();return s},Hke=(t,e)=>i=>d4t(i,t);class Wke extends jV{constructor(e,i){super(e),this.Y=new Map,this.A=void 0,this.#t=owe();const r=this;r.#i=i,r.Z(),r.setProvisionalExports(Zke(e,new WeakRef(r),e.M.length-1,r.instance,r.Y),!1),YJ(e,s=>{if(s){const n=K(()=>e[s],a=>{if(a===r.instance)return;const o=r.instance;r.exports=a,r.instance=a,r.Y.forEach((l,c)=>e.requestUpdate(l,o[c])),r.#e&&o.destroy(),r.#e=!1},{sync:!0});r.onDestroy(n.remove)}},r.exports)}#e;#t;#i;get exports(){return lwe(this.#t),super.exports}set exports(e){super.exports=e,this.#t.notify()}Z(){const e=this;e.instance="prototype"in e.#i&&"declaredClass"in e.#i.prototype?new e.#i:e.#i(),e.#e=!0}hostConnected(){this.exports=this.instance}hostDestroy(){this.#e&&this.instance.destroy?.()}}const d4t=rK(Wke),Zke=(t,e,i,r,s)=>new Proxy(r,{get:(n,a)=>{const o=n[a];if(typeof a=="symbol"||s.has(a))return o;const l=t.M[i];return l.A=a,QJ(t,c=>{if(l.A=void 0,c!==void 0){const h=c.key;s.set(a,h);const f=t.constructor.getPropertyOptions(h),y=a!==h&&h.toLowerCase().includes("disable");p4t(e,f,a,h,y),f.i===void 0&&f4t(f,i,a,y)}},o)}}),p4t=(t,e,i,r,s,n)=>n=K(()=>{const a=t.deref();return a===void 0||a.component.manager.destroyed?n=n.remove():a.exports[i]},(a,o)=>{if(!n)return;t.deref().component?.requestUpdate(r,s?!o:o),e.c=!1},{sync:!0}),f4t=(t,e,i,r)=>{t.d.get=function(){const s=this.M[e]?.exports[i];return r?!s:s},t.d.set=function(s){const n=this.M[e];n.A!==i&&(n.exports[i]=r?!s:s)}},m4t=t=>t.Y,g4t=(t,e)=>{const i=e.manager.useRefSync(t);i?.hostDestroy(),i?.Z(),i?.hostConnected()};const wo="arcgis-map",Ks={base:wo,containerUI:`${wo}-container-ui`,containerElement:`${wo}-container-ui__element`,containerElementDefaultSlot:`${wo}-container-ui__element-default`,containerElementPopupSlot:`${wo}-container-ui__element-popup`,containerTopLeftColumn:`${wo}-container-ui__top-left-column`,containerTopRightColumn:`${wo}-container-ui__top-right-column`,containerBottomLeftRow:`${wo}-container-ui__bottom-left-row`,containerBottomRightRow:`${wo}-container-ui__bottom-right-row`,containerElementTopLeft:`${wo}-container-ui__element-top-left`,containerElementTopRight:`${wo}-container-ui__element-top-right`,containerElementBottomLeft:`${wo}-container-ui__element-bottom-left`,containerElementBottomRight:`${wo}-container-ui__element-bottom-right`,containerElementTopStart:`${wo}-container-ui__element-top-start`,containerElementTopEnd:`${wo}-container-ui__element-top-end`,containerElementBottomStart:`${wo}-container-ui__element-bottom-start`,containerElementBottomEnd:`${wo}-container-ui__element-bottom-end`},au={topLeft:"top-left",topRight:"top-right",bottomLeft:"bottom-left",bottomRight:"bottom-right",topStart:"top-start",topEnd:"top-end",bottomStart:"bottom-start",bottomEnd:"bottom-end",popup:"popup"};function y4t(t,e,i){return En`<div class=${gr({[Ks.containerElementPopupSlot]:!0})}><slot name=${au.popup} @slotchange=${e}></slot></div><div class=${gr({[Ks.containerElementDefaultSlot]:!0})}>${i}<slot></slot></div><div class=${gr({[Ks.containerTopLeftColumn]:!0})}><div class=${gr({[Ks.containerElement]:!0,[Ks.containerElementTopLeft]:!0})}><slot name=${au.topLeft}></slot></div><div class=${gr({[Ks.containerElement]:!0,[Ks.containerElementTopStart]:!0})}><slot name=${t==="ltr"?au.topStart:au.topEnd}></slot></div></div><div class=${gr({[Ks.containerTopRightColumn]:!0})}><div class=${gr({[Ks.containerElement]:!0,[Ks.containerElementTopRight]:!0})}><slot name=${au.topRight}></slot></div><div class=${gr({[Ks.containerElement]:!0,[Ks.containerElementTopEnd]:!0})}><slot name=${t==="ltr"?au.topEnd:au.topStart}></slot></div></div><div class=${gr({[Ks.containerBottomLeftRow]:!0})}><div class=${gr({[Ks.containerElement]:!0,[Ks.containerElementBottomLeft]:!0})}><slot name=${au.bottomLeft}></slot></div><div class=${gr({[Ks.containerElement]:!0,[Ks.containerElementBottomStart]:!0})}><slot name=${t==="ltr"?au.bottomStart:au.bottomEnd}></slot></div></div><div class=${gr({[Ks.containerBottomRightRow]:!0})}><div class=${gr({[Ks.containerElement]:!0,[Ks.containerElementBottomRight]:!0})}><slot name=${au.bottomRight}></slot></div><div class=${gr({[Ks.containerElement]:!0,[Ks.containerElementBottomEnd]:!0})}><slot name=${t==="ltr"?au.bottomEnd:au.bottomStart}></slot></div></div>`}const _4t=zv`:host{--arcgis-internal-color-black-30: color-mix(in srgb, #000000 30.2%, transparent);--arcgis-internal-box-shadow: var(--calcite-spacing-none) var(--calcite-spacing-px) var(--calcite-spacing-base) var(--arcgis-internal-color-black-30);--arcgis-internal-top-max-width: calc(min(100cqw, 100vw) - var(--calcite-spacing-xxxl));--arcgis-internal-panel-width: 300px;--arcgis-internal-panel-height: 100%;--arcgis-internal-panel-height-sm: 240px;--arcgis-internal-panel-height-md: 420px;--arcgis-internal-panel-height-lg: 540px;--arcgis-internal-panel-height-xl: 680px;--arcgis-internal-basemap-gallery-width-lg: 450px;--arcgis-expand-max-height: var(--calcite-spacing-xxxl);--arcgis-collapse-icon-flip: scaleX(1);--arcgis-row-direction: row;--arcgis-legend-internal-width: 300px;--arcgis-layout-overlay-space-top: 0px;--arcgis-layout-overlay-space-bottom: 0px;--arcgis-layout-overlay-space-left: 0px;--arcgis-layout-overlay-space-right: 0px;--arcgis-internal-sketch-justify-content: flex-start}:host{display:block;position:relative;height:100%;width:100%;padding:var(--calcite-spacing-none);margin:var(--calcite-spacing-none);container:arcgis-map-container/size;contain:layout}::slotted(:is([closed],[closed="true"])){display:none}:dir(rtl) ::slotted(:not(arcgis-swipe)){direction:rtl}::slotted(:is(arcgis-area-measurement-2d,arcgis-area-measurement-3d,arcgis-attachments,arcgis-basemap-gallery,arcgis-basemap-layer-list,arcgis-bookmarks,arcgis-building-explorer,arcgis-catalog-layer-list,arcgis-coordinate-conversion,arcgis-daylight,arcgis-directions,arcgis-direct-line-measurement-3d,arcgis-distance-measurement-2d,arcgis-editor,arcgis-elevation-profile,arcgis-expand,arcgis-feature-form,arcgis-features,arcgis-feature-table,arcgis-fullscreen,arcgis-grid-controls,arcgis-home,arcgis-layer-list,arcgis-legend,arcgis-line-of-sight,arcgis-link-chart-layout-switcher,arcgis-locate,arcgis-measurement,arcgis-navigation-toggle,arcgis-oriented-imagery-viewer,arcgis-print,arcgis-search,arcgis-shadow-cast,arcgis-slice,arcgis-table-list,arcgis-time-slider,arcgis-time-zone-label,arcgis-track,arcgis-utility-network-associations,arcgis-utility-network-trace,arcgis-utility-network-validate-topology,arcgis-version-management,arcgis-video-player,arcgis-weather,arcgis-zoom)){box-shadow:var(--arcgis-internal-box-shadow)}::slotted(:is(arcgis-area-measurement-2d,arcgis-area-measurement-3d,arcgis-basemap-gallery,arcgis-basemap-layer-list,arcgis-bookmarks,arcgis-building-explorer,arcgis-catalog-layer-list,arcgis-directions,arcgis-direct-line-measurement-3d,arcgis-distance-measurement-2d,arcgis-editor,arcgis-feature-form,arcgis-features,arcgis-layer-list,arcgis-line-of-sight,arcgis-print,arcgis-shadow-cast,arcgis-slice,arcgis-table-list,arcgis-utility-network-trace,arcgis-grid-controls)){width:var(--arcgis-internal-panel-width);min-width:var(--calcite-spacing-xxxl);min-height:var(--calcite-spacing-xxxl);transition:max-height .25s ease-in-out;overflow-y:auto}.arcgis-map-container-ui{position:absolute;inset:var(--calcite-spacing-none);padding:var(--calcite-spacing-none);z-index:var(--calcite-z-index);pointer-events:none;background:none}.arcgis-map-container-ui__element{display:flex;flex-direction:column;pointer-events:none;width:max-content;max-width:100%}.arcgis-map-container-ui__element .esri-widget--panel{min-width:var(--arcgis-internal-panel-width)}.arcgis-map-container-ui__element-popup,.arcgis-map-container-ui__element-default{pointer-events:none;max-width:100%;position:absolute;display:block;inset:var(--calcite-spacing-none);width:100%;::slotted(:not(arcgis-swipe)){pointer-events:auto}}.arcgis-map-container-ui__top-left-column{position:absolute;top:var(--calcite-spacing-none);left:var(--calcite-spacing-none);display:flex;flex-direction:column;justify-content:flex-start;align-items:flex-start;margin-top:var(--calcite-spacing-lg);margin-left:var(--calcite-spacing-lg);padding-top:var(--arcgis-layout-overlay-space-top);padding-left:var(--arcgis-layout-overlay-space-left);::slotted(*){max-width:var(--arcgis-internal-top-max-width)}::slotted(arcgis-sketch[layout="vertical"]){--sketch-pad-flex-flow: column wrap}}.arcgis-map-container-ui__top-left-column:dir(rtl){align-items:flex-end;::slotted(arcgis-floor-filter){--arcgis-row-direction: row-reverse}}.arcgis-map-container-ui__top-right-column{position:absolute;top:var(--calcite-spacing-none);right:var(--calcite-spacing-none);display:flex;flex-direction:column;align-items:flex-end;margin-top:var(--calcite-spacing-lg);margin-right:var(--calcite-spacing-lg);padding-top:var(--arcgis-layout-overlay-space-top);padding-right:var(--arcgis-layout-overlay-space-right);::slotted(*){max-width:var(--arcgis-internal-top-max-width)}::slotted(arcgis-expand){--arcgis-internal-sketch-justify-content: flex-end}}.arcgis-map-container-ui__top-right-column:dir(rtl){align-items:flex-start;::slotted(arcgis-floor-filter){--arcgis-row-direction: row}}.arcgis-map-container-ui__element-top-left{top:var(--calcite-spacing-none);left:var(--calcite-spacing-none);display:flex;justify-content:flex-start;align-items:flex-start;::slotted(arcgis-expand){--arcgis-expand-icon-number-left: none;--arcgis-expand-icon-number-right: calc(-1 * var(--calcite-spacing-xs))}::slotted(:is(arcgis-floor-filter,arcgis-expand)){--arcgis-collapse-icon-flip: scaleX(-1)}::slotted(arcgis-sketch){--sketch-pad-flex-flow: wrap}::slotted(*){margin-bottom:var(--calcite-spacing-sm-plus)}}.arcgis-map-container-ui__element-top-left:dir(rtl){align-items:flex-end}.arcgis-map-container-ui__element-top-right{position:relative;justify-content:flex-start;align-items:flex-end;margin-left:auto;::slotted(arcgis-expand){--arcgis-expand-icon-number-left: calc(-1 * var(--calcite-spacing-xs));--arcgis-expand-icon-number-right: none}::slotted(arcgis-floor-filter){--arcgis-row-direction: row-reverse}::slotted(arcgis-sketch){--sketch-pad-flex-flow: row-reverse wrap}::slotted(arcgis-sketch[layout="vertical"]){--sketch-pad-flex-flow: column wrap-reverse}::slotted(*){margin-bottom:var(--calcite-spacing-sm-plus)}}.arcgis-map-container-ui__element-top-right:dir(rtl){align-items:flex-start}.arcgis-map-container-ui__element-top-start{position:relative;justify-content:flex-start;align-items:flex-start;::slotted(arcgis-expand){--arcgis-expand-icon-number-left: none;--arcgis-expand-icon-number-right: calc(-1 * var(--calcite-spacing-xs))}::slotted(arcgis-sketch[layout="vertical"]){--sketch-pad-flex-flow: column wrap}::slotted(:is(arcgis-floor-filter,arcgis-expand)){--arcgis-collapse-icon-flip: scaleX(-1)}::slotted(*){margin-bottom:var(--calcite-spacing-sm-plus)}}.arcgis-map-container-ui__element-top-start:dir(rtl){align-items:flex-end;--arcgis-internal-sketch-justify-content: flex-start;::slotted(arcgis-sketch){--sketch-pad-flex-flow: row-reverse wrap-reverse}}.arcgis-map-container-ui__element-top-end{position:relative;justify-content:flex-start;align-items:flex-end;::slotted(arcgis-expand){--arcgis-expand-icon-number-left: calc(-1 * var(--calcite-spacing-xs));--arcgis-expand-icon-number-right: none}::slotted(arcgis-floor-filter){--arcgis-row-direction: row-reverse}::slotted(arcgis-sketch){--sketch-pad-flex-flow: row-reverse wrap}::slotted(arcgis-sketch[layout="vertical"]){--sketch-pad-flex-flow: column wrap-reverse}::slotted(*){margin-bottom:var(--calcite-spacing-sm-plus)}}.arcgis-map-container-ui__element-top-end:dir(rtl){align-items:flex-start;--arcgis-internal-sketch-justify-content: flex-end}.arcgis-map-container-ui__bottom-left-row{position:absolute;bottom:var(--calcite-spacing-none);left:var(--calcite-spacing-none);display:flex;flex-direction:row;align-items:flex-end;max-width:100%;margin-left:var(--calcite-spacing-lg);margin-bottom:var(--calcite-spacing-xxxl);padding-left:var(--arcgis-layout-overlay-space-left);padding-bottom:var(--arcgis-layout-overlay-space-bottom);::slotted(:last-child){margin-right:var(--calcite-spacing-xxl)}::slotted(arcgis-floor-filter){--arcgis-internal-floor-filter-column-direction: column-reverse;--arcgis-internal-floor-filter-button-border-width: 0 0 1px}::slotted(*){max-width:var(--arcgis-internal-top-max-width)}}.arcgis-map-container-ui__bottom-left-row:dir(rtl){flex-direction:row-reverse;::slotted(arcgis-floor-filter){--arcgis-row-direction: row-reverse}}.arcgis-map-container-ui__bottom-right-row{position:absolute;bottom:var(--calcite-spacing-none);right:var(--calcite-spacing-none);display:flex;flex-direction:row-reverse;align-items:flex-end;max-width:100%;margin-right:var(--calcite-spacing-lg);margin-bottom:var(--calcite-spacing-xxxl);padding-right:var(--arcgis-layout-overlay-space-right);padding-bottom:var(--arcgis-layout-overlay-space-bottom);::slotted(:last-child){margin-left:var(--calcite-spacing-xxl)}::slotted(arcgis-floor-filter){--arcgis-internal-floor-filter-column-direction: column-reverse;--arcgis-internal-floor-filter-button-border-width: 0 0 1px}::slotted(*){max-width:var(--arcgis-internal-top-max-width)}::slotted(arcgis-expand){--arcgis-internal-sketch-justify-content: flex-end}::slotted(arcgis-sketch[layout="vertical"]){--sketch-pad-flex-flow: column-reverse wrap-reverse}}.arcgis-map-container-ui__bottom-right-row:dir(rtl){flex-direction:row;::slotted(arcgis-floor-filter){--arcgis-row-direction: row}}.arcgis-map-container-ui__element-bottom-left{bottom:var(--calcite-spacing-none);left:var(--calcite-spacing-none);display:flex;flex-direction:column;align-items:flex-end;justify-content:flex-end;flex-flow:row;::slotted(arcgis-coordinate-conversion){--arcgis-coordinate-conversion-flex-direction: column-reverse}::slotted(arcgis-expand){--arcgis-expand-icon-number-left: none;--arcgis-expand-icon-number-right: calc(-1 * var(--calcite-spacing-xs))}::slotted(:is(arcgis-floor-filter,arcgis-expand)){--arcgis-collapse-icon-flip: scaleX(-1)}::slotted(arcgis-sketch){--sketch-pad-flex-flow: wrap-reverse}::slotted(arcgis-sketch[layout="vertical"]){--sketch-pad-flex-flow: column-reverse wrap}::slotted(arcgis-floor-filter){--arcgis-floor-filter-align-items: flex-end}::slotted(*){margin-right:var(--calcite-spacing-sm-plus)}}.arcgis-map-container-ui__element-bottom-right{bottom:var(--calcite-spacing-none);right:var(--calcite-spacing-none);align-items:flex-end;justify-content:flex-end;margin-left:auto;flex-flow:row-reverse;::slotted(arcgis-coordinate-conversion){--arcgis-coordinate-conversion-flex-direction: column-reverse}::slotted(arcgis-expand){--arcgis-expand-icon-number-left: calc(-1 * var(--calcite-spacing-xs));--arcgis-expand-icon-number-right: none}::slotted(arcgis-sketch){--sketch-pad-flex-flow: row-reverse wrap-reverse}::slotted(arcgis-sketch[layout="vertical"]){--sketch-pad-flex-flow: column-reverse wrap-reverse}::slotted(arcgis-floor-filter){--arcgis-floor-filter-align-items: flex-end;--arcgis-row-direction: row-reverse}::slotted(*){margin-left:var(--calcite-spacing-sm-plus)}}.arcgis-map-container-ui__element-bottom-start{bottom:var(--calcite-spacing-none);left:var(--calcite-spacing-none);display:flex;flex-direction:column;align-items:flex-end;justify-content:flex-end;flex-flow:row;::slotted(arcgis-coordinate-conversion){--arcgis-coordinate-conversion-flex-direction: column-reverse}::slotted(arcgis-expand){--arcgis-expand-icon-number-left: none;--arcgis-expand-icon-number-right: calc(-1 * var(--calcite-spacing-xs))}::slotted(:is(arcgis-floor-filter,arcgis-expand)){--arcgis-collapse-icon-flip: scaleX(-1)}::slotted(arcgis-sketch){--sketch-pad-flex-flow: wrap-reverse}::slotted(arcgis-sketch[layout="vertical"]){--sketch-pad-flex-flow: column-reverse wrap}::slotted(arcgis-floor-filter){--arcgis-floor-filter-align-items: flex-end}::slotted(*){margin-right:var(--calcite-spacing-sm-plus)}::slotted(:dir(rtl)){margin-right:var(--calcite-spacing-none);--arcgis-internal-sketch-justify-content: flex-start}}.arcgis-map-container-ui__element-bottom-end{bottom:var(--calcite-spacing-none);right:var(--calcite-spacing-none);align-items:flex-end;justify-content:flex-end;margin-left:auto;flex-flow:row-reverse;::slotted(arcgis-coordinate-conversion){--arcgis-coordinate-conversion-flex-direction: column-reverse}::slotted(arcgis-expand){--arcgis-expand-icon-number-left: calc(-1 * var(--calcite-spacing-xs));--arcgis-expand-icon-number-right: none}::slotted(arcgis-sketch){--sketch-pad-flex-flow: row-reverse wrap-reverse}::slotted(arcgis-sketch[layout="vertical"]){--sketch-pad-flex-flow: column-reverse wrap-reverse}::slotted(arcgis-floor-filter){--arcgis-floor-filter-align-items: flex-end;--arcgis-row-direction: row-reverse}::slotted(*){margin-left:var(--calcite-spacing-sm-plus)}::slotted(:dir(rtl)){margin-left:var(--calcite-spacing-none);--arcgis-internal-sketch-justify-content: flex-end}}.arcgis-map-container-ui__element>*{pointer-events:auto}@container arcgis-map-container (height >= 0){::slotted(arcgis-sketch){--responsive-toolbar-vert-width: var(--calcite-spacing-none);--responsive-toolbar-vert-height: min(100vh - 120px, 100cqh - 120px);--responsive-toolbar-horiz-width: min(100vw - 60px, 100cqw - 60px);--responsive-toolbar-horiz-height: var(--calcite-spacing-none)}}@container arcgis-map-container (max-height: 544px) or (max-width: 544px){::slotted(:is(arcgis-floor-filter)){--arcgis-internal-floor-filter-button-display: none;--arcgis-internal-floor-filter-menu-width: 225px}}@container arcgis-map-container (max-height: 499.99px){.arcgis-map-container-ui__element>*{--arcgis-expand-max-height: var(--arcgis-internal-panel-height-sm);--arcgis-internal-panel-height: var(--arcgis-internal-panel-height-sm)}::slotted(:is(arcgis-area-measurement-2d,arcgis-area-measurement-3d,arcgis-basemap-gallery,arcgis-basemap-layer-list,arcgis-bookmarks,arcgis-building-explorer,arcgis-catalog-layer-list,arcgis-directions,arcgis-direct-line-measurement-3d,arcgis-distance-measurement-2d,arcgis-editor,arcgis-feature-form,arcgis-features,arcgis-layer-list,arcgis-legend,arcgis-line-of-sight,arcgis-print,arcgis-shadow-cast,arcgis-slice,arcgis-table-list,arcgis-utility-network-trace,arcgis-grid-controls)){max-height:var(--arcgis-internal-panel-height-sm)}}@container arcgis-map-container (min-height: 500px){.arcgis-map-container-ui__element>*{--arcgis-expand-max-height: var(--arcgis-internal-panel-height-md);--arcgis-internal-panel-height: var(--arcgis-internal-panel-height-md)}::slotted(:is(arcgis-area-measurement-2d,arcgis-area-measurement-3d,arcgis-basemap-gallery,arcgis-basemap-layer-list,arcgis-bookmarks,arcgis-building-explorer,arcgis-catalog-layer-list,arcgis-directions,arcgis-direct-line-measurement-3d,arcgis-distance-measurement-2d,arcgis-editor,arcgis-feature-form,arcgis-features,arcgis-layer-list,arcgis-legend,arcgis-line-of-sight,arcgis-print,arcgis-shadow-cast,arcgis-slice,arcgis-table-list,arcgis-utility-network-trace,arcgis-grid-controls)){max-height:var(--arcgis-internal-panel-height-md)}::slotted(:is(arcgis-floor-filter)){--arcgis-internal-floor-filter-menu-max-height: 320px;--arcgis-internal-floor-filter-levels-max-height: 320px}}@container arcgis-map-container (min-height: 768px){.arcgis-map-container-ui__element>*{--arcgis-expand-max-height: var(--arcgis-internal-panel-height-lg);--arcgis-internal-panel-height: var(--arcgis-internal-panel-height-lg)}::slotted(:is(arcgis-area-measurement-2d,arcgis-area-measurement-3d,arcgis-basemap-gallery,arcgis-basemap-layer-list,arcgis-bookmarks,arcgis-building-explorer,arcgis-catalog-layer-list,arcgis-directions,arcgis-direct-line-measurement-3d,arcgis-distance-measurement-2d,arcgis-editor,arcgis-feature-form,arcgis-features,arcgis-layer-list,arcgis-legend,arcgis-line-of-sight,arcgis-print,arcgis-shadow-cast,arcgis-slice,arcgis-table-list,arcgis-utility-network-trace,arcgis-grid-controls)){max-height:var(--arcgis-internal-panel-height-lg)}::slotted(:is(arcgis-floor-filter)){--arcgis-internal-floor-filter-menu-max-height: 420px;--arcgis-internal-floor-filter-levels-max-height: 420px}}@container arcgis-map-container (min-height: 992px){.arcgis-map-container-ui__element>*{--arcgis-expand-max-height: var(--arcgis-internal-panel-height-lg);--arcgis-internal-panel-height: var(--arcgis-internal-panel-height-lg)}::slotted(:is(arcgis-area-measurement-2d,arcgis-area-measurement-3d,arcgis-basemap-gallery,arcgis-basemap-layer-list,arcgis-bookmarks,arcgis-building-explorer,arcgis-catalog-layer-list,arcgis-directions,arcgis-direct-line-measurement-3d,arcgis-distance-measurement-2d,arcgis-editor,arcgis-feature-form,arcgis-features,arcgis-layer-list,arcgis-legend,arcgis-line-of-sight,arcgis-print,arcgis-shadow-cast,arcgis-slice,arcgis-table-list,arcgis-utility-network-trace,arcgis-grid-controls)){max-height:var(--arcgis-internal-panel-height-lg)}}@container arcgis-map-container (min-height: 1200px){.arcgis-map-container-ui__element>*{--arcgis-expand-max-height: var(--arcgis-internal-panel-height-xl);--arcgis-internal-panel-height: var(--arcgis-internal-panel-height-xl)}::slotted(:is(arcgis-area-measurement-2d,arcgis-area-measurement-3d,arcgis-basemap-gallery,arcgis-basemap-layer-list,arcgis-bookmarks,arcgis-building-explorer,arcgis-catalog-layer-list,arcgis-directions,arcgis-direct-line-measurement-3d,arcgis-distance-measurement-2d,arcgis-editor,arcgis-feature-form,arcgis-features,arcgis-layer-list,arcgis-legend,arcgis-line-of-sight,arcgis-print,arcgis-shadow-cast,arcgis-slice,arcgis-table-list,arcgis-utility-network-trace,arcgis-grid-controls)){max-height:var(--arcgis-internal-panel-height-xl)}}@container arcgis-map-container (min-width: 544px){::slotted(:is(arcgis-area-measurement-2d,arcgis-area-measurement-3d,arcgis-basemap-gallery,arcgis-basemap-layer-list,arcgis-bookmarks,arcgis-building-explorer,arcgis-catalog-layer-list,arcgis-directions,arcgis-direct-line-measurement-3d,arcgis-distance-measurement-2d,arcgis-editor,arcgis-feature-form,arcgis-features,arcgis-layer-list,arcgis-line-of-sight,arcgis-print,arcgis-shadow-cast,arcgis-slice,arcgis-table-list,arcgis-utility-network-trace,arcgis-grid-controls)){width:var(--arcgis-internal-panel-width)}}@container arcgis-map-container (min-width: 768px){::slotted(:is(arcgis-legend[card-style-layout="auto"])){--arcgis-legend-internal-width: auto}::slotted(:is(arcgis-area-measurement-2d,arcgis-area-measurement-3d,arcgis-basemap-gallery,arcgis-basemap-layer-list,arcgis-bookmarks,arcgis-building-explorer,arcgis-catalog-layer-list,arcgis-directions,arcgis-direct-line-measurement-3d,arcgis-distance-measurement-2d,arcgis-editor,arcgis-feature-form,arcgis-features,arcgis-layer-list,arcgis-line-of-sight,arcgis-print,arcgis-shadow-cast,arcgis-slice,arcgis-table-list,arcgis-utility-network-trace,arcgis-grid-controls)){width:var(--arcgis-internal-panel-width)}}@container arcgis-map-container (min-width: 992px){::slotted(:is(arcgis-area-measurement-2d,arcgis-area-measurement-3d,arcgis-basemap-gallery,arcgis-basemap-layer-list,arcgis-bookmarks,arcgis-building-explorer,arcgis-catalog-layer-list,arcgis-directions,arcgis-direct-line-measurement-3d,arcgis-distance-measurement-2d,arcgis-editor,arcgis-feature-form,arcgis-features,arcgis-layer-list,arcgis-line-of-sight,arcgis-print,arcgis-shadow-cast,arcgis-slice,arcgis-table-list,arcgis-utility-network-trace,arcgis-grid-controls)){width:var(--arcgis-internal-panel-width)}}@container arcgis-map-container (min-width: 1200px){::slotted(:is(arcgis-basemap-gallery)){width:var(--arcgis-internal-basemap-gallery-width-lg)}::slotted(:is(arcgis-area-measurement-2d,arcgis-area-measurement-3d,arcgis-basemap-layer-list,arcgis-bookmarks,arcgis-building-explorer,arcgis-catalog-layer-list,arcgis-directions,arcgis-direct-line-measurement-3d,arcgis-distance-measurement-2d,arcgis-editor,arcgis-feature-form,arcgis-features,arcgis-layer-list,arcgis-line-of-sight,arcgis-print,arcgis-shadow-cast,arcgis-slice,arcgis-table-list,arcgis-utility-network-trace,arcgis-grid-controls)){width:var(--arcgis-internal-panel-width)}}`;let v4t=class extends jV{constructor(e){super(e),this.direction=zUe(),this.component.listen("arcgisViewClick",i=>{this._handleOpenPopup(i.detail)}),this.component.listenOn(globalThis,"unhandledrejection",i=>{if(i.reason?.name==="webgl:required"){const{name:r}=i.reason;this.webGLError={name:r}}})}hostLifecycle(){return Zs(()=>this.component.view.popup?.visible,()=>{this.popupRef?.visible&&(this.popupRef.visible=!1)})}openPopup(e){this.popupRef?this.popupRef.open(e):this.component.view.openPopup(e)}closePopup(){this.popupRef?this.popupRef.visible=!1:this.component.view.closePopup()}async _handleOpenPopup(e){if(this.popupRef&&!this.component.popupDisabled){e.stopPropagation();const{location:i,promises:r}=await this.popupRef?.handleViewClick(e);r?.length&&(this.component.view.closePopup(),this.popupRef?.open({location:i,promises:r}))}}_handlePopupSlotChange(e){const i=$Ue(e.target,"arcgis-popup");!this.popupRef&&i.length?this.popupRef=i[0]:i.length||(this.popupRef=void 0)}_webGLErrorAlert(){return this.webGLError?En`<calcite-alert icon=x-octagon kind=danger open .label=${this.webGLError.name}><div slot=title>Unable to display map. WebGL2 support is required.</div><div slot=message>Ensure that your browser and hardware meet the minimum requirements.</div><calcite-link slot=link href=https://esriurl.com/webgl-faq>https://esriurl.com/webgl-faq</calcite-link></calcite-alert>`:null}render(){return y4t(this.direction,e=>this._handlePopupSlotChange(e),this._webGLErrorAlert())}};const b4t=sK((t,e)=>{const i=Pc();return e.onLifecycle(()=>K(()=>{const{map:r}=t;if(!r||r.destroyed)return[];const s=[];return r.loadError&&s.push(r),r.basemap?.loadError&&s.push(r.basemap),r.ground.loadError&&s.push(r.ground),[...r.allLayers,...r.allTables].forEach(n=>{n.loadError&&s.push(n)}),s},r=>{r.length&&(t.loadErrorSources=r,i.emit())})),i}),w4t=sK((t,e)=>{const i=Pc();return e.onLifecycle(()=>K(()=>t.view?.readyState,r=>{(r==="map-content-error"||r==="rendering-error")&&i.emit()})),i});const x4t=zv`@charset "UTF-8";@keyframes esri-basemap-slide{0%{opacity:0;margin-top:0;margin-left:0}75%{opacity:0;margin-top:0;margin-left:0}to{opacity:1;margin-top:5px;margin-left:5px}}@keyframes esri-docking-animation{0%{opacity:0}25%{opacity:0}to{opacity:1}}@keyframes popup-intro-animation-down{0%{opacity:0;transform:translateY(-5px)}to{opacity:1;transform:translate(0)}}@keyframes popup-intro-animation-up{0%{opacity:0;transform:translateY(5px)}to{opacity:1;transform:translate(0)}}@supports (-ms-ime-align: auto){.esri-slider__anchor:focus{outline:1px dotted #000}}@keyframes esri-spinner--start-animation{0%{opacity:0;transform:scale(0)}to{opacity:1;transform:scale(1)}}@keyframes esri-spinner--finish-animation{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(0)}}@keyframes esri-spinner--rotate-animation{0%{transform:rotate(0)}to{transform:rotate(360deg)}}@media (prefers-reduced-motion){.esri-utility-network-trace__reset-prompt{animation:none!important}}@media (prefers-reduced-motion){.esri-popup--aligned-top-center,.esri-popup--aligned-top-left,.esri-popup--aligned-top-right,.esri-popup--aligned-bottom-center,.esri-popup--aligned-bottom-left,.esri-popup--aligned-bottom-right,.esri-popup--is-docked{animation:none!important}}@keyframes esri-fade-in-down{0%{opacity:0;transform:translateY(-5px)}25%{opacity:0;transform:translateY(-5px)}to{opacity:1;transform:translate(0)}}@keyframes esri-fade-in-up{0%{opacity:0;transform:translateY(5px)}25%{opacity:0;transform:translateY(5px)}to{opacity:1;transform:translate(0)}}@keyframes esri-fade-in{0%{opacity:0}25%{opacity:0}to{opacity:1}}@keyframes esri-fade-in-scale{0%{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}@keyframes looping-progresss-bar-ani{0%{width:0;left:0}20%{width:20%;left:0}80%{width:20%;left:80%}to{width:0;left:100%}}@keyframes esri-rotate{0%{transform:rotate(0)}to{transform:rotate(360deg)}}@keyframes panel-advance{0%{opacity:0;transform:translate(50px) scale(.99)}to{opacity:1;transform:translate(0) scale(1)}}@keyframes panel-retreat{0%{opacity:0;transform:translate(-50px) scale(.99)}to{opacity:1;transform:translate(0) scale(1)}}@keyframes panel-advance--rtl{0%{opacity:0;transform:translate(-50px) scale(.99)}to{opacity:1;transform:translate(0) scale(1)}}@keyframes panel-retreat--rtl{0%{opacity:0;transform:translate(50px) scale(.99)}to{opacity:1;transform:translate(0) scale(1)}}.esri-view{--esri-view-outline-color: var(--calcite-color-brand);--esri-view-outline: 2px solid var(--esri-view-outline-color);--esri-view-outline-offset: -2px;margin:0;padding:0;display:flex;height:100%;width:100%}.esri-view .esri-view-user-storage{overflow:hidden}.esri-view .esri-view-root{-webkit-tap-highlight-color:var(--calcite-color-foreground-1);-webkit-tap-highlight-color:transparent;border:none;flex:100%;margin:0;padding:0;position:relative}.esri-view .esri-view-surface{-webkit-user-select:none;user-select:none;direction:ltr;border:none;outline:0;width:100%;height:100%;margin:0;padding:0;position:absolute;top:0;left:0;overflow:clip}.esri-view .esri-view-surface--touch-none{touch-action:none}.esri-view .esri-view-surface--touch-pan{touch-action:pan-x pan-y}.esri-view .esri-view-surface:focus:after{box-sizing:border-box;z-index:999;outline:var(--esri-view-outline);outline-offset:var(--esri-view-outline-offset);content:"";pointer-events:none;width:100%;height:100%;position:absolute;top:0;left:0;overflow:hidden}.esri-view .esri-view-surface[data-navigating=true]{cursor:grabbing}.esri-view .esri-view-surface[data-cursor=copy]{cursor:copy}.esri-view .esri-view-surface[data-cursor=crosshair]{cursor:crosshair}.esri-view .esri-view-surface[data-cursor=help]{cursor:help}.esri-view .esri-view-surface[data-cursor=move]{cursor:move}.esri-view .esri-view-surface[data-cursor=pointer]{cursor:pointer}.esri-view .esri-view-surface[data-cursor=progress]{cursor:progress}.esri-view .esri-view-surface[data-cursor=grab]{cursor:grab}.esri-view .esri-view-surface[data-cursor=grabbing]{cursor:grabbing}.esri-view .esri-view-surface[data-cursor=n-resize]{cursor:n-resize}.esri-view .esri-view-surface[data-cursor=e-resize]{cursor:e-resize}.esri-view .esri-view-surface[data-cursor=s-resize]{cursor:s-resize}.esri-view .esri-view-surface[data-cursor=w-resize]{cursor:w-resize}.esri-view .esri-view-surface[data-cursor=ne-resize]{cursor:ne-resize}.esri-view .esri-view-surface[data-cursor=nw-resize]{cursor:nw-resize}.esri-view .esri-view-surface[data-cursor=se-resize]{cursor:se-resize}.esri-view .esri-view-surface[data-cursor=sw-resize]{cursor:sw-resize}.esri-view .esri-view-surface[data-cursor=ew-resize]{cursor:ew-resize}.esri-view .esri-view-surface[data-cursor=ns-resize]{cursor:ns-resize}.esri-view .esri-view-surface[data-cursor=nesw-resize]{cursor:nesw-resize}.esri-view .esri-view-surface[data-cursor=nwse-resize]{cursor:nwse-resize}.esri-view .esri-view-surface[data-cursor=none]{cursor:none}.esri-view .esri-display-object,.esri-view .esri-bitmap{-webkit-user-drag:none;-webkit-user-select:none;user-select:none;border:none;margin:0;padding:0;position:absolute}.esri-view .esri-bitmap{transform-origin:0 0;max-width:none}:root{view-transition-name:none}::view-transition{pointer-events:none}.esri-ui{box-sizing:border-box;z-index:0;pointer-events:none;contain:layout;font-size:var(--calcite-font-size);position:absolute;inset:0;overflow:hidden;container:esri-view-canvas/size}.esri-ui calcite-flow,.esri-ui calcite-panel{z-index:1;position:relative}.esri-ui .esri-component{pointer-events:auto}.esri-ui .esri-fov-overlay-outer{pointer-events:none;place-content:center;width:100%;height:100%;display:grid}.esri-ui .esri-fov-overlay{text-shadow:0 0 1px var(--calcite-color-foreground-1),0 0 2px var(--calcite-color-foreground-1),0 0 3px var(--calcite-color-foreground-1);color:var(--calcite-color-text-1);font-size:var(--calcite-font-size-3);-webkit-user-select:none;user-select:none;pointer-events:none;flex-direction:row;align-items:center;gap:7px;animation:1s forwards fadeInAnimation;display:flex}.esri-ui .esri-fov-overlay-reset{cursor:pointer;pointer-events:auto}.esri-ui .esri-fov-overlay-text{pointer-events:none}@keyframes fadeInAnimation{0%{opacity:0}to{opacity:1}}@media (prefers-reduced-motion: reduce){.esri-fov-overlay{animation:none!important}}.esri-ui-corner{display:flex;position:absolute}.esri-ui-inner-container{position:absolute;inset:0}.esri-ui-manual-container>.esri-component{position:absolute}.esri-ui-manual-container .esri-swipe{z-index:-1}.esri-ui-top-left,.esri-ui-top-right{flex-flow:column}.esri-ui-top-left{align-items:flex-start;top:0;left:0}.esri-ui-top-right{align-items:flex-end;top:0;right:0}.esri-ui-bottom-left,.esri-ui-bottom-right{flex-flow:row;align-items:flex-end}.esri-ui-bottom-right{flex-flow:row-reverse;bottom:0;right:0}.esri-ui-bottom-right .esri-component{margin-left:10px}.esri-ui-top-right .esri-component,.esri-ui-top-left .esri-component{margin-bottom:10px}.esri-ui-bottom-left{bottom:0;left:0}.esri-ui-bottom-left .esri-component{margin-right:10px}:dir(rtl) .esri-ui-top-left{align-items:flex-end}:dir(rtl) .esri-ui-top-right{align-items:flex-start}:dir(rtl) .esri-ui-bottom-left{flex-direction:row-reverse}:dir(rtl) .esri-ui-bottom-right{flex-direction:row}.esri-zoom-box__container{width:100%;height:100%;position:relative}.esri-zoom-box__overlay{cursor:crosshair;width:100%;height:100%;position:absolute;top:0;left:0}.esri-zoom-box__overlay-background{fill:#0000001a}.esri-zoom-box__outline{fill:var(--calcite-color-transparent);stroke:var(--calcite-color-brand);stroke-dasharray:1 1;stroke-width:var(--calcite-spacing-base)}.esri-overlay-surface{z-index:0;pointer-events:none;-webkit-user-select:none;user-select:none;border:none;width:100%;height:100%;margin:0;padding:0;position:absolute;top:0;left:0;overflow:clip}.esri-text-overlay-item{white-space:nowrap;font-size:var(--calcite-font-size);line-height:var(--calcite-font-line-height-relative-tight);display:block;position:absolute;overflow:hidden}.esri-text-overlay-item-anchor-bottom{transform:translate(-50%,-100%)}.esri-text-overlay-item-anchor-bottom-right{transform:translate(-100%,-100%)}.esri-text-overlay-item-anchor-bottom-left{transform:translateY(-100%)}.esri-text-overlay-item-anchor-top{transform:translate(-50%)}.esri-text-overlay-item-anchor-top-right{transform:translate(-100%)}.esri-text-overlay-item-anchor-top-left{transform:translate(0)}.esri-text-overlay-item-anchor-center{transform:translate(-50%,-50%)}.esri-text-overlay-item-anchor-right{transform:translate(-100%,-50%)}.esri-text-overlay-item-anchor-left{transform:translateY(-50%)}.esri-line-overlay-item,.esri-outline-overlay-item,.esri-box-overlay-item{white-space:nowrap;display:block;position:absolute;overflow:hidden}.esri-shadow-cast__tooltip{color:var(--calcite-color-text-2);font-size:var(--calcite-font-size-sm)}.esri-shadow-cast__tooltip__content{margin-top:-8px-var(--calcite-spacing-xxs);padding:var(--calcite-spacing-xs) var(--calcite-spacing-sm);background:var(--calcite-color-foreground-1);width:max-content;position:absolute;transform:translate(-50%,-100%)}.esri-shadow-cast__tooltip__content:after{content:"";border:8px solid var(--calcite-color-transparent);border-top-color:var(--calcite-color-foreground-1);box-sizing:inherit;width:0;height:0;display:block;position:absolute;bottom:1px;left:50%;transform:translate(-50%,100%)}.esri-attribution{position:absolute;bottom:0;left:0;right:0;background-color:var(--calcite-color-transparent-tint)!important;flex-flow:row;justify-content:space-between;align-items:center;font-size:var(--calcite-font-size-sm)!important;line-height:var(--calcite-font-line-height-fixed-base)!important;display:flex}.esri-attribution__link{color:var(--calcite-color-text-1)}.esri-attribution__link:hover,.esri-attribution__link:active,.esri-attribution__link:visited,.esri-attribution__link:focus{color:var(--calcite-color-text-1)}.esri-attribution__sources{text-overflow:ellipsis;white-space:nowrap;flex:1 0;align-self:flex-start;padding:0 5px;font-weight:var(--calcite-font-weight-light);overflow:hidden}.esri-attribution__sources[role=button]{font-size:1em}.esri-attribution__powered-by{color:var(--calcite-color-text-2);text-align:right;white-space:nowrap;align-self:flex-end;padding:0 5px;font-weight:var(--calcite-font-weight-normal)}.esri-attribution--open{z-index:2}.esri-attribution__sources--open{white-space:normal}.esri-button{box-sizing:border-box;cursor:pointer;white-space:normal;word-break:normal;color:var(--calcite-color-text-1);background-color:var(--calcite-color-status-info);border:var(--calcite-spacing-px) solid var(--calcite-color-status-info);justify-content:center;align-items:center;width:100%;min-height:var(--calcite-spacing-xxxl);padding:6px 7px;font-family:inherit;font-size:var(--calcite-font-size);transition:background-color .125s ease-in-out,border .125s ease-in-out;display:flex;overflow:hidden;&:hover{color:var(--calcite-color-text-1);background-color:var(--calcite-color-status-info-hover);border:var(--calcite-spacing-px) solid var(--calcite-color-status-info-hover)}}.esri-button:hover{color:var(--calcite-color-text-1);background-color:var(--calcite-color-text-2);border:1px solid var(--calcite-color-text-2)}.esri-button.esri-button--small{min-height:var(--calcite-spacing-xl);font-size:var(--calcite-font-size-sm)}.esri-button.esri-button--half{width:50%;display:inline-block}.esri-button.esri-button--third{width:33%;display:inline-block}.esri-button--secondary{color:var(--calcite-color-text-1);background-color:var(--calcite-color-foreground-1)}.esri-button--tertiary{color:var(--calcite-color-brand);background-color:var(--calcite-color-transparent);border-color:var(--calcite-color-transparent)}.esri-button--tertiary:hover{color:var(--calcite-color-brand-hover);background-color:var(--calcite-color-foreground-2);border-color:var(--calcite-color-transparent)}.esri-button--disabled{opacity:.4;pointer-events:none}.esri-button--drill-in{outline-offset:-4px;cursor:pointer;text-align:unset;background-color:var(--calcite-color-foreground-1);border:none;border-radius:2px;justify-content:space-between;align-items:center;margin:var(--calcite-spacing-md) 7px;padding:var(--calcite-spacing-md) 7px;text-decoration:none;transition:background-color .125s ease-in-out;display:flex;box-shadow:0 0 0 1px #adadad4d}.esri-button--drill-in:hover,.esri-button--drill-in:focus{background-color:var(--calcite-color-foreground-2)}.esri-button--drill-in__title{font-size:var(--calcite-font-size)}.esri-button--drill-in [class^=esri-icon-],.esri-button--drill-in [class*=" esri-icon-"]{padding:0 7px}.esri-widget--button{cursor:pointer;text-align:center;color:var(--calcite-color-text-2);background-color:var(--calcite-color-foreground-1);flex-flow:row;justify-content:center;align-items:center;width:var(--calcite-spacing-xxxl);height:var(--calcite-spacing-xxxl);margin:0;padding:0;font-size:var(--calcite-font-size);transition:background-color .125s ease-in-out;display:flex;overflow:hidden}.esri-widget--button:is(calcite-button):not(:hover){--calcite-icon-color: var(--calcite-color-text-3)}.esri-widget--button:not([appearance]),.esri-widget--button[appearance=solid]{--calcite-color-foreground-3: var(--calcite-color-foreground-1)}.esri-widget--button:is(calcite-button){--calcite-offset-invert-focus: 1}.esri-widget--button calcite-loader[inline]{margin:auto}.esri-button--secondary{color:var(--calcite-color-brand);background-color:var(--calcite-color-foreground-1);&:hover{color:var(--calcite-color-text-inverse);background-color:var(--calcite-color-status-info);border:1px solid var(--calcite-color-status-info)}}.esri-widget__heading{color:var(--calcite-color-text-2);margin:0 0 .5rem;font-weight:var(--calcite-font-weight-semibold)}h1.esri-widget__heading{font-size:var(--calcite-font-size-xl)}h2.esri-widget__heading{font-size:var(--calcite-font-size-md)}h3.esri-widget__heading,h4.esri-widget__heading,h5.esri-widget__heading,h6.esri-widget__heading{font-size:var(--calcite-font-size)}.esri-widget{--esri-widget-padding-x: 15px;--esri-widget-padding-y: var(--calcite-spacing-md);--esri-widget-padding: var(--esri-widget-padding-y) var(--esri-widget-padding-x);box-sizing:border-box;color:var(--calcite-color-text-2);background-color:var(--calcite-color-foreground-1);font-size:var(--calcite-font-size);line-height:var(--calcite-font-line-height-relative-tight)}.esri-widget *,.esri-widget :before,.esri-widget :after{box-sizing:inherit}.esri-widget.esri-widget--disabled>*{opacity:.4;pointer-events:none}.esri-widget.esri-widget--compact{--esri-widget-padding-y: 0;--esri-widget-padding-x: 0}.esri-widget__anchor{color:var(--calcite-color-text-2)}.esri-widget__anchor:hover{color:var(--calcite-color-text-3)}.esri-widget__anchor:hover,.esri-widget__anchor:focus{text-decoration:underline}.esri-widget__anchor--disabled{opacity:.4;pointer-events:none}.esri-widget__header{background-color:var(--calcite-color-foreground-1);flex:1 0 100%;justify-content:space-between;align-items:center;width:100%;min-height:48px;padding:12px 0 12px 15px;display:flex}.esri-widget__header .esri-widget__heading{width:calc(100% - 48px);text-align:initial;color:var(--calcite-color-text-1);align-items:center;margin:0;padding:0;display:flex}.esri-widget__header-button{appearance:none;cursor:pointer;color:var(--calcite-color-text-2);background-color:var(--calcite-color-foreground-1);border:none;flex:0 0 48px;justify-content:center;align-self:stretch;align-items:center;width:48px;padding:0;display:flex}.esri-widget__footer{background-color:var(--calcite-color-foreground-1);justify-content:center;align-items:center;width:100%;min-height:48px;display:flex}.esri-widget__footer-pagination{color:var(--calcite-color-text-2);justify-content:space-between;align-items:center;display:flex}.esri-widget__footer-pagination-previous-button,.esri-widget__footer-pagination-next-button{cursor:pointer;background-color:var(--calcite-color-foreground-1);border:0;margin:0 7px;padding:12px 15px;transition:background-color .125s ease-in-out}.esri-widget__footer-pagination-previous-button:hover,.esri-widget__footer-pagination-previous-button:focus,.esri-widget__footer-pagination-next-button:hover,.esri-widget__footer-pagination-next-button:focus{color:var(--calcite-color-text-1);background-color:var(--calcite-color-foreground-1)}.esri-menu{visibility:hidden;z-index:1;background-clip:padding;background-color:var(--calcite-color-foreground-1);background-clip:padding-box;width:100%;max-height:0;margin:2px 0 0;padding:0;font-size:var(--calcite-font-size);line-height:var(--calcite-spacing-xl);position:absolute;top:100%;left:0;overflow:hidden;box-shadow:0 1px 2px #0000004d}.esri-menu .esri-menu__header{color:var(--calcite-color-text-inverse);background-color:var(--calcite-color-inverse);padding:6px 12px}.esri-menu__list{margin:0;padding:0;list-style:none}.esri-menu__list-item{cursor:pointer;border-top:1px solid #adadad4d;border-left:3px solid #0000;padding:.8em 1em}.esri-menu__list-item [class^=esri-icon-],.esri-menu__list-item [class*=" esri-icon-"]{padding-right:2.8px}.esri-menu__list-item:first-child{border-top:none}.esri-menu__list-item--focus,.esri-menu__list-item:hover,.esri-menu__list-item:focus{background-color:var(--calcite-color-foreground-1)}.esri-menu__list-item:active{background-color:var(--calcite-color-foreground-current)}.esri-menu__list-item--active,.esri-menu__list-item--active:hover,.esri-menu__list-item--active:focus{background-color:var(--calcite-color-foreground-1);border-left-color:var(--calcite-color-brand)}.esri-widget__table{border-collapse:collapse;color:var(--calcite-color-text-1);border:none;width:100%;line-height:var(--calcite-font-line-height-relative-tight)}.esri-widget__table tr:nth-child(odd){background-color:var(--calcite-color-transparent)}.esri-widget__table tr:nth-child(2n){background-color:var(--calcite-color-transparent-press)}.esri-widget__table tr a{color:var(--calcite-color-text-2)}.esri-widget__table tr a:hover,.esri-widget__table tr a:focus{color:var(--calcite-color-text-1)}.esri-widget__table tr td,.esri-widget__table tr th{vertical-align:top;word-break:break-word;padding:.5em .7em;font-size:var(--calcite-font-size-sm);font-weight:var(--calcite-font-weight-regular)}.esri-widget__table tr th{text-align:left;border-right:3px solid #0000000d;width:50%}.esri-widget__table tr td{width:50%}.esri-input{color:var(--calcite-color-text-1);background-color:var(--calcite-color-foreground-1);border:1px solid #959595;font-size:var(--calcite-font-size)}.esri-input::-ms-clear{display:none}.esri-input::placeholder{opacity:1;color:var(--calcite-color-text-2)}.esri-input:placeholder-shown{text-overflow:ellipsis}.esri-input[type=text],.esri-input[type=password],.esri-input[type=number]{height:32px;padding:0 .5em}calcite-combobox.esri-input{border:none}.esri-widget__content--empty{text-align:center;color:var(--calcite-color-border-input);flex-flow:column wrap;align-items:center;padding:18px 22px;display:flex}.esri-widget__content--empty h1.esri-widget__heading,.esri-widget__content--empty h2.esri-widget__heading,.esri-widget__content--empty h3.esri-widget__heading,.esri-widget__content--empty h4.esri-widget__heading,.esri-widget__content--empty h5.esri-widget__heading{font-weight:var(--calcite-font-weight-regular)}.esri-widget__content-illustration--empty{width:128px;padding:1rem 0}.esri-widget__content-icon--empty{width:32px;padding:.5rem 0}.esri-select{appearance:none;cursor:pointer;color:var(--calcite-color-text-2);background:var(--calcite-color-foreground-1) url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='-8 -8 32 32' width='32' height='32'%3E%3Cpath d='M8 11.207l-4-4V5.793l4 4 4-4v1.414z' fill='%23adadad' fillrule='nonzero'/%3E%3C/svg%3E") 100% no-repeat;border:1px solid #959595;border-radius:0;width:100%;height:32px;margin:0;padding:0 .5em;font-family:inherit;font-size:.85em;display:block}.esri-select[disabled]{cursor:auto}.esri-select::-ms-expand{display:none}.esri-disabled a,.esri-disabled [role=menu],.esri-disabled [role=checkbox],.esri-disabled [class^=esri-icon-],.esri-disabled [class*=" esri-icon-"]{color:var(--calcite-color-text-3)}.keynav-mode .esri-widget:focus,.keynav-mode .esri-widget :focus{z-index:1;outline-offset:2px;outline:2px solid #adadad}.esri-widget__loader-animation{border:.15em solid #adadad4d;border-top-color:var(--calcite-color-border-input);border-radius:100%;width:1em;height:1em;font-size:var(--calcite-font-size-md);animation:1.25s linear infinite esri-rotate;display:block;transform:translateZ(0)}:dir(rtl) .esri-widget__table th{text-align:right;border-left:3px solid #0000000d;border-right:none}:dir(rtl) .esri-select{background-position:0}:dir(rtl) .esri-menu__list-item{border-left:none;border-right:3px solid #0000}:dir(rtl) .esri-menu__list-item [class^=esri-icon-],:dir(rtl) .esri-menu__list-item [class*=" esri-icon-"]{padding-left:2px;padding-right:0}:dir(rtl) .esri-menu__list-item--active{border-right-color:var(--calcite-color-brand)}.esri-icon-font-fallback-text{clip:rect(0 0 0 0);width:1px;height:1px;position:absolute;overflow:hidden}.esri-rotating{animation:1.25s linear infinite esri-rotate;transform:translateZ(0)}.esri-clearfix:before,.esri-clearfix:after{content:" ";display:table}.esri-clearfix:after{clear:both}.esri-interactive{cursor:pointer}.esri-invisible{visibility:hidden!important}.esri-offscreen{position:absolute;top:-999em;left:-999em}.esri-match-height{flex-direction:column;flex:auto;display:flex;overflow:hidden}.esri-hidden{display:none!important}[class^=esri-icon-],[class*=" esri-icon-"]{speak:none;font-variant:normal;text-transform:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;font-style:normal;font-weight:var(--calcite-font-weight-normal);line-height:1;font-family:CalciteWebCoreIcons!important}.esri-icon-close:before{content:"";color:inherit}.esri-icon-drag-horizontal:before{content:"";color:inherit}.esri-icon-drag-vertical:before{content:"";color:inherit}.esri-icon-handle-horizontal:before{content:"";color:inherit}.esri-icon-handle-vertical:before{content:"";color:inherit}.esri-icon-check-mark:before{content:"";color:inherit}.esri-icon-left-triangle-arrow:before{content:"";color:inherit}.esri-icon-right-triangle-arrow:before{content:"";color:inherit}.esri-icon-down-arrow:before{content:"";color:inherit}.esri-icon-up-arrow:before{content:"";color:inherit}.esri-icon-overview-arrow-bottom-left:before{content:"";color:inherit}.esri-icon-overview-arrow-bottom-right:before{content:"";color:inherit}.esri-icon-overview-arrow-top-left:before{content:"";color:inherit}.esri-icon-overview-arrow-top-right:before{content:"";color:inherit}.esri-icon-maximize:before{content:"";color:inherit}.esri-icon-minimize:before{content:"";color:inherit}.esri-icon-checkbox-unchecked:before{content:"";color:inherit}.esri-icon-checkbox-checked:before{content:"";color:inherit}.esri-icon-radio-unchecked:before{content:"";color:inherit}.esri-icon-radio-checked:before{content:"";color:inherit}.esri-icon-up-arrow-circled:before{content:"";color:inherit}.esri-icon-down-arrow-circled:before{content:"";color:inherit}.esri-icon-left-arrow-circled:before{content:"";color:inherit}.esri-icon-right-arrow-circled:before{content:"";color:inherit}.esri-icon-zoom-out-fixed:before{content:"";color:inherit}.esri-icon-zoom-in-fixed:before{content:"";color:inherit}.esri-icon-refresh:before{content:"";color:inherit}.esri-icon-edit:before{content:"";color:inherit}.esri-icon-authorize:before{content:"";color:inherit}.esri-icon-map-pin:before{content:"";color:inherit}.esri-icon-blank-map-pin:before{content:"";color:inherit}.esri-icon-table:before{content:"";color:inherit}.esri-icon-plus:before{content:"+";color:inherit}.esri-icon-minus:before{content:"";color:inherit}.esri-icon-beginning:before{content:"";color:inherit}.esri-icon-reverse:before{content:"";color:inherit}.esri-icon-pause:before{content:"";color:inherit}.esri-icon-play:before{content:"";color:inherit}.esri-icon-forward:before{content:"";color:inherit}.esri-icon-end:before{content:"";color:inherit}.esri-icon-erase:before{content:"";color:inherit}.esri-icon-up-down-arrows:before{content:"";color:inherit}.esri-icon-left:before{content:"";color:inherit}.esri-icon-right:before{content:"";color:inherit}.esri-icon-announcement:before{content:"";color:inherit}.esri-icon-notice-round:before{content:"";color:inherit}.esri-icon-notice-triangle:before{content:"";color:inherit}.esri-icon-home:before{content:"";color:inherit}.esri-icon-locate:before{content:"";color:inherit}.esri-icon-expand:before{content:"";color:inherit}.esri-icon-collapse:before{content:"";color:inherit}.esri-icon-layer-list:before{content:"";color:inherit}.esri-icon-basemap:before{content:"";color:inherit}.esri-icon-globe:before{content:"";color:inherit}.esri-icon-applications:before{content:"";color:inherit}.esri-icon-arrow-up-circled:before{content:"";color:inherit}.esri-icon-arrow-down-circled:before{content:"";color:inherit}.esri-icon-arrow-left-circled:before{content:"";color:inherit}.esri-icon-arrow-right-circled:before{content:"";color:inherit}.esri-icon-minus-circled:before{content:"";color:inherit}.esri-icon-plus-circled:before{content:"";color:inherit}.esri-icon-add-attachment:before{content:"";color:inherit}.esri-icon-attachment:before{content:"";color:inherit}.esri-icon-calendar:before{content:"";color:inherit}.esri-icon-close-circled:before{content:"";color:inherit}.esri-icon-browser:before{content:"";color:inherit}.esri-icon-collection:before{content:"";color:inherit}.esri-icon-comment:before{content:"";color:inherit}.esri-icon-configure-popup:before{content:"";color:inherit}.esri-icon-contact:before{content:"";color:inherit}.esri-icon-dashboard:before{content:"";color:inherit}.esri-icon-deny:before{content:"";color:inherit}.esri-icon-description:before{content:"";color:inherit}.esri-icon-directions:before{content:"";color:inherit}.esri-icon-directions2:before{content:"";color:inherit}.esri-icon-documentation:before{content:"";color:inherit}.esri-icon-duplicate:before{content:"";color:inherit}.esri-icon-review:before{content:"";color:inherit}.esri-icon-environment-settings:before{content:"";color:inherit}.esri-icon-error:before{content:"";color:inherit}.esri-icon-error2:before{content:"";color:inherit}.esri-icon-experimental:before{content:"";color:inherit}.esri-icon-feature-layer:before{content:"";color:inherit}.esri-icon-filter:before{content:"";color:inherit}.esri-icon-grant:before{content:"";color:inherit}.esri-icon-group:before{content:"";color:inherit}.esri-icon-key:before{content:"";color:inherit}.esri-icon-labels:before{content:"";color:inherit}.esri-icon-tag:before{content:"";color:inherit}.esri-icon-layers:before{content:"";color:inherit}.esri-icon-left-arrow:before{content:"";color:inherit}.esri-icon-right-arrow:before{content:"";color:inherit}.esri-icon-link-external:before{content:"";color:inherit}.esri-icon-link:before{content:"";color:inherit}.esri-icon-loading-indicator:before{content:"";color:inherit}.esri-icon-maps:before{content:"";color:inherit}.esri-icon-marketplace:before{content:"";color:inherit}.esri-icon-media:before{content:"";color:inherit}.esri-icon-media2:before{content:"";color:inherit}.esri-icon-menu:before{content:"";color:inherit}.esri-icon-mobile:before{content:"";color:inherit}.esri-icon-phone:before{content:"";color:inherit}.esri-icon-navigation:before{content:"";color:inherit}.esri-icon-pan:before{content:"";color:inherit}.esri-icon-printer:before{content:"";color:inherit}.esri-icon-pie-chart:before{content:"";color:inherit}.esri-icon-chart:before{content:"";color:inherit}.esri-icon-line-chart:before{content:"";color:inherit}.esri-icon-question:before{content:"";color:inherit}.esri-icon-resend-invitation:before{content:"";color:inherit}.esri-icon-rotate:before{content:"";color:inherit}.esri-icon-save:before{content:"";color:inherit}.esri-icon-settings:before{content:"";color:inherit}.esri-icon-settings2:before{content:"";color:inherit}.esri-icon-share:before{content:"";color:inherit}.esri-icon-sign-out:before{content:"";color:inherit}.esri-icon-support:before{content:"";color:inherit}.esri-icon-user:before{content:"";color:inherit}.esri-icon-time-clock:before{content:"";color:inherit}.esri-icon-trash:before{content:"";color:inherit}.esri-icon-upload:before{content:"";color:inherit}.esri-icon-download:before{content:"";color:inherit}.esri-icon-zoom-in-magnifying-glass:before{content:"";color:inherit}.esri-icon-search:before{content:"";color:inherit}.esri-icon-zoom-out-magnifying-glass:before{content:"";color:inherit}.esri-icon-locked:before{content:"";color:inherit}.esri-icon-unlocked:before{content:"";color:inherit}.esri-icon-favorites:before{content:"";color:inherit}.esri-icon-compass:before{content:"";color:inherit}.esri-icon-down:before{content:"";color:inherit}.esri-icon-up:before{content:"";color:inherit}.esri-icon-chat:before{content:"";color:inherit}.esri-icon-dock-bottom:before{content:"";color:inherit}.esri-icon-dock-left:before{content:"";color:inherit}.esri-icon-dock-right:before{content:"";color:inherit}.esri-icon-organization:before{content:"";color:inherit}.esri-icon-north-navigation:before{content:"";color:inherit}.esri-icon-locate-circled:before{content:"";color:inherit}.esri-icon-dial:before{content:"";color:inherit}.esri-icon-polygon:before{content:"";color:inherit}.esri-icon-polyline:before{content:"";color:inherit}.esri-icon-visible:before{content:"";color:inherit}.esri-icon-non-visible:before{content:"";color:inherit}.esri-icon-link-vertical:before{content:"";color:inherit}.esri-icon-unlocked-link-vertical:before{content:"";color:inherit}.esri-icon-link-horizontal:before{content:"";color:inherit}.esri-icon-unlocked-link-horizontal:before{content:"";color:inherit}.esri-icon-swap:before{content:"";color:inherit}.esri-icon-cta-link-external:before{content:"";color:inherit}.esri-icon-reply:before{content:"";color:inherit}.esri-icon-public:before{content:"";color:inherit}.esri-icon-share2:before{content:"";color:inherit}.esri-icon-launch-link-external:before{content:"";color:inherit}.esri-icon-rotate-back:before{content:"";color:inherit}.esri-icon-pan2:before{content:"";color:inherit}.esri-icon-tracking:before{content:"";color:inherit}.esri-icon-expand2:before{content:"";color:inherit}.esri-icon-arrow-down:before{content:"";color:inherit}.esri-icon-arrow-up:before{content:"";color:inherit}.esri-icon-hollow-eye:before{content:"";color:inherit}.esri-icon-play-circled:before{content:"";color:inherit}.esri-icon-volume-off:before{content:"";color:inherit}.esri-icon-volume-on:before{content:"";color:inherit}.esri-icon-bookmark:before{content:"";color:inherit}.esri-icon-lightbulb:before{content:"";color:inherit}.esri-icon-sketch-rectangle:before{content:"";color:inherit}.esri-icon-north-navigation-filled:before{content:"";color:inherit}.esri-icon-default-action:before{content:"";color:inherit}.esri-icon-undo:before{content:"";color:inherit}.esri-icon-redo:before{content:"";color:inherit}.esri-icon-cursor:before{content:"";color:inherit}.esri-icon-cursor-filled:before{content:"";color:inherit}.esri-icon-measure:before{content:"";color:inherit}.esri-icon-measure-line:before{content:"";color:inherit}.esri-icon-measure-area:before{content:"";color:inherit}.esri-icon-legend:before{content:"";color:inherit}.esri-icon-sliders:before{content:"";color:inherit}.esri-icon-sliders-horizontal:before{content:"";color:inherit}.esri-icon-cursor-marquee:before{content:"";color:inherit}.esri-icon-lasso:before{content:"";color:inherit}.esri-icon-elevation-profile:before{content:"";color:inherit}.esri-icon-slice:before{content:"";color:inherit}.esri-icon-line-of-sight:before{content:"";color:inherit}.esri-icon-zoom-to-object:before{content:"";color:inherit}.esri-icon-urban-model:before{content:"";color:inherit}.esri-icon-measure-building-height-shadow:before{content:"";color:inherit}.esri-icon-partly-cloudy:before{content:"";color:inherit}.esri-attachments__progress-bar:before,.esri-attachments__progress-bar:after{opacity:var(--calcite-opacity-100);content:"";height:1px;transition:opacity .5s ease-in-out;position:absolute;top:0}.esri-attachments__progress-bar:before{z-index:0;background-color:var(--calcite-color-foreground-2);width:100%}.esri-attachments__progress-bar:after{z-index:0;background-color:var(--calcite-color-text-2);width:20%;animation:1.5s linear infinite looping-progresss-bar-ani}.esri-attachments{background-color:var(--calcite-color-background)!important;width:100%}.esri-attachments__loader-container{justify-content:center;align-items:center;height:150px;padding:0;display:flex}.esri-attachments__loader{background:url(data:image/gif;base64,R0lGODlhIQAnALMKAAB6wrze86TR7Y3F53W44V6s2kaf1C+TzheGyNPq+f///wAAAAAAAAAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh/wtYTVAgRGF0YVhNUDw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMDE0IDc5LjE1Njc5NywgMjAxNC8wOC8yMC0wOTo1MzowMiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1MkRGQzEzOEQ3MUIxMUU0QjJCRTkxRjI3NjA5MTc2MyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo2RDdDRTgwM0Q3MjAxMUU0QjJCRTkxRjI3NjA5MTc2MyIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo2RDdDRTgwMkQ3MjAxMUU0QjJCRTkxRjI3NjA5MTc2MyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxNCAoTWFjaW50b3NoKSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOmQyYThhNjgzLWIwNjctNDhhZi05Nzc0LTZiOTZkM2RhMjI2OCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo1MkRGQzEzOEQ3MUIxMUU0QjJCRTkxRjI3NjA5MTc2MyIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PgH//v38+/r5+Pf29fTz8vHw7+7t7Ovq6ejn5uXk4+Lh4N/e3dzb2tnY19bV1NPS0dDPzs3My8rJyMfGxcTDwsHAv769vLu6ubi3trW0s7KxsK+urayrqqmop6alpKOioaCfnp2cm5qZmJeWlZSTkpGQj46NjIuKiYiHhoWEg4KBgH9+fXx7enl4d3Z1dHNycXBvbm1sa2ppaGdmZWRjYmFgX15dXFtaWVhXVlVUU1JRUE9OTUxLSklIR0ZFRENCQUA/Pj08Ozo5ODc2NTQzMjEwLy4tLCsqKSgnJiUkIyIhIB8eHRwbGhkYFxYVFBMSERAPDg0MCwoJCAcGBQQDAgEAACH5BAkEAAoALAAAAAAhACcAAASOUMlJq70W6L2xv1z4jVPIkaTZoZ+qsa0Ley4wY7WU7Dyv9z1JTgEMEos7oeyI/DUVQ2SSWVSqnFUq0GrCbrXGqNQbXkoTZB/UPAarxc8zV+SeytfXOlo/P/H/cFl3gV+DbHFthEaGeXeMXX+PdI6Jh4KVjW2SfpRPQzcVn6AlS6OkeaZ9K6l4kKyirLEXEQAh+QQJBAAKACwAAAAAIQAnAAAEqFDJSau9OOutkP8fx4GkuJGgqaGhirGe+8JSYN+3CCM1jkuJoFAo2fV8NuBwWKQpkDnFktlxQpPSabDJOiKVWi7K6wNPxaXn1bxEp9RQNtUI/2bD1W69fD/nx3s/fW1/aVcBckSFb4eJW4stjYNzVmuTinSSWo+ZlpsJbpGem6ExgVGfpTynWKmQppqkr6uxeJ1xl5yVuCdOMhV0vxTBwqrFw77HysvFEQAh+QQFBAAKACwAAAAAIQAnAAAEqFDJSau9OOvNez5gGHqaaJKfOaKXugpwHHcuKMk4Xd/4rCTAYFBSO/B6AolwSdwpkDDlcqgoHnvSaaLpuuZ+2m3VCU2CtVyVV5adpk9PaJs57saRc+FbtPaFxVZ3WGdudWqCX397L3KEdIFleVSQjYqGcJGOepd8iGyak2SVYYs2nn6knIx4oEClRqdRrYCirJaUtqm4gxu7X71OLBWBwhTExcjJysseEQAh+QQJBAAKACwBAAMAFAAhAAAEU9DIOZW9WNGd+6Zd9lXKYJ7nKFloqxpsm6qxPLy1jJf2TfO2Xc83yrl+Q2FPGUQunc0iUAelSpPV4/W5jX6MKKb1O9WSsd0xpxzOtqUhyy6u+dEjACH5BAkEAAoALAAAAAAhACcAAASAUMlJq7046827/10hjiOIkahErCwboqXSzi9cqLPL2SKeEzWYLxdMyX7AHW9IU9qYrSIJqtvwbsefNIZMWpdZolMYbn6f5ejY2N320lXNlbpyY9vrKbye5yLtdF5yYHhnZIWDaIgZc3uCjIR/fW+LJ5Fak3eShkYmnp+goaKjHREAIfkECQQACgAsAAAAACEAJwAABKhQyUmrvTjrzbv/IFaMJNkRaJpKZXuqKtuaHBwrM73ZK54XkoRwOJTwULJckEg0HpOzJVPo5EFdimlRcSRcS9Jp1falaancp0+ZPY9h5VGY+b79gG1tvXefN9NWa1F5YoBkglhnCXtIiGCEdIZwjmZuknY/fltdcXiKjF6UcpB/nKKelqZ9pJtqq5+XfJmsaKqzsLZsuK6zO7xsvoGrIRXDxMfIycrLxBEAIfkEBQQACgAsAAAAACEAJwAABKdQyUmrvTjrzbu3RiiKXzaeJXaO3eC+r7SSHGzLs9HasZLrioRwOJTwej8JcWk8DnAz5bKocD59Oek00TxCV9ppl/dFBbfcqrPMOm/HN2zULVZ75WA6007Gm9FpVmw0gHAwgyFhe4J+bYV8cUl6RIZIWZNUjJKPmpeca42EaJUuiECfd5ujkIehiZhCpFeqb6yWc6h9khudcykVu78TwcKuQMXIycrKEQAh+QQJBAAKACwBAAMAFAAhAAAEVVDJSdW5GNed+65dJowkKYVYqZ7ooZYs+ppWO49xeAt5t/eiGzAlrMmKLRfStjzOhpefUdekPqe+avaalHa1QS5T7HxBlWSrGRtef9OezyQpn7fq5wgAIfkECQQACgAsAAAAACEAJwAABIBQyUmrvTjrzZH/H9eBoLiRpZmhoYqxnhjMNC3BiFzXN6zvsx7rBxSiiDsjCclT4Jg2p48DjD6p1YAytclqpUNsddvqZskxcRF8VCfZS3fzah7DuRovOie3TutrdHlnd2WDdoIZeoVpgG+JGIuQF5J/LhWTl5kumyqdJp+XoqMiEQAh+QQJBAAKACwAAAAAIQAnAAAEjlDJSau9OIPNef5VJ4KkInYleHqptgKtu8bYC5NJruuSLe3AH5BnegmHieOwZ1Qgc8pgceZ8RndM6jNZRWZPV+L2O+ouzVIfGrsmqsdt6BQc58Lf1joZpe/jvX5NcHeCeYRahnl/Z4d0g4qFgI1lj4CLUpN8lWeXbCpNNCGgoRNqpKWjp6anc2WsrXyvrBEAIfkECQQACgAsAAAAACEAJwAABKlQyUmrvTjrzZH/H9eBoLiRpZmhoYqxnvvCUmDft5TsPC/BiBoOp+v1fjTFkKgwHhVA4TJQdCaQLOmy6sSitEOu0UsCM607cmpqEz+jSrbbB02yqU20unWfp+tZcVN+V4Bfglt5VnsxiGGKXYZljmd6kmtykGOXfJlohXB9mm92npahpoucjaKfjEGUOaN0qIOzf7WJJ6W2u4EyFXDAFMLDr8bEScjLzBoRACH5BAUEAAoALAAAAAAhACcAAASqUMlJq7046827t0coil82niV2jum1koogz3P3hhKtS0nv+5LbIaerKX7I4I1YFPCQQIWQWXxCE8oXdXe8YqXLWNPZvWZXW5oVekaJm+skWPuultlzdJ3r/U73andyf2NkfW0sgEaHeW6FcT+IMI+CkY2JlIyEY5BRm3CVnmGZXpI4ijKdPaZDqIall5Ocoauxp6Rmtq2UG592vaOzwHQtFH/FE8fIy8zNzBEAIfkECQQACgAsDAADABQAIQAABFPQyDmVvVjRnfumXfZVymCe5yhZaKsabJuqsTy8tYyX9k3ztl3PN8q5fkNhTxlELp3NIlAHpUqT1eP1uY1+jCim9TvVkrHdMacczralIcsurvnRIwAh+QQJBAAKACwAAAAAIQAnAAAEgFDJSau9OOvNu/8gVowkGV5lKhFs23ZpubouHI8zzdp3rvMxHw2oUuhenBvOeCQQZczj0xT9JZXC2rVXHW6DXe1GWcgix9jwWUM2777FphMOlU+Xdjo1j+by2Wl/GW1qb31ggiKBTXdlhXOHcYx6eJORdZaAfpmDaSefoKGio58RACH5BAkEAAoALAAAAAAhACcAAASoUMlJq7046827/2AoFWRZdkSqqqNpouvauiQcpzMtJXzfSzeWgnZS+I7AICHn2h1/CuVySCw4n4lkkPkyYrNRJbf4BUvHNS9We0Nb1U92zH2Nh7dUYh15b+d1cHxnf02BPnIyhF1liEJVb4x9c4pkX404lGmRg497h5KJnYZQnFWepGKZkJagjqajPJdTopuptKylehy5gBu8hb62ryIUosTHyMnKyxIRACH5BAUEAAoALAAAAAAhACcAAASpUMlJq7046827/5IhjiOIkah5oWQ3vDAcsqIbxzMtJXzfSzecglZT+I7A4CvH2h1/CuVySHQ+E0klM2W8YqPSbat7zQbFJfLTfEMXvV/pwG2wrsFaqk6NxJ/1TXw+bEJEdYJQcnR2fYqAXHCEMo9jkX5tlGmWjoaMg5eFVYg8klOdo3FhmW9epXOrh5uqp7J5tK2gk6cbnKK8s74qE7vCi8XDwcfKy8wWEQAh+QQJBAAKACwMAAMAFAAhAAAEVVDJSdW5GNed+65dJowkKYVYqZ7ooZYs+ppWO49xeAt5t/eiGzAlrMmKLRfStjzOhpefUdekPqe+avaalHa1QS5T7HxBlWSrGRtef9OezyQpn7fq5wgAIfkECQQACgAsAAAAACEAJwAABIBQyUmrvTjrzTf6INh5YThqpXliqbhe7dcFdF1LMTLbNh7vPJqvBQwOU0XesZTsKXLN2/PHCUqhVWtgqdpot1Ni1sp1ebVl2dgYRq6VbebbiT2T413NN62bX6l2bHV6aHhmhHeDGXuGaoFwihiMkReTgC8UlC+aK5wnniOgmKOjEQAh+QQJBAAKACwAAAAAIQAnAAAEjlDJSau9OGsFuvdbyH2fuJGlmaGgirGd+8LyBQNSou97zvOSm++nGxKDNAWxp1wmkCzjTwocRZtLKlOIPXanVpS2+K1ync/yNokep89ON1SsJrfDJHn9zY7v53l/gnBZg32Fd4ReiYeLfopgjFd3knSUj42RmJN+lYE1FFygE6KjeCmmpy2ppaOtoK+pFhEAIfkECQQACgAsAAAAACEAJwAABI1QyUmrvTjrzTf6INh5YThqpXliqbhe7ffCsZTcOG7nuRQjO94tKPTVFEIdMpkwtog8aE/xkyqZTeoRax1qn8tkN1sNF83Rb2rMVpfaXLcqHi/Tmc41elrf4vdKdn99YHdici6GZ4KHhHqKaYxnjm+AXpRzg3+SaZguMxRloBOio4gypnmVqaWjramwLxEAIfkEBQQACgAsAAAAACEAJwAABIpQyUmrvTjrzbv/0iGOI4iRqHmhpGqxpUvBopTcOG7neUjvvBsw6IMNeceegnZI6hTBJ9MphEYTRRYVa41mU11iGLn8jZVX7vT8TH9b7Kq7bIxz5+s53qy/vmN9XnRadlt/NYWJeX6KfIx7dYFii4KQhJJklGKWYJhKazKHTaGipKWmoKGppqytrBEAIfkECQQACgAsFwADAAkAIQAABBLQyEmrvTjrzbv/YCiOZGmeZQQAIfkECQQACgAsAAAAACEAJwAABFBQyUmrvTjrzbv/YCgVZFmKlqmilWqylHvCo1zQtYwr9o33O+DPFiQOdUdXEUkTNo1PJsw5hValLGrWusWitF9u2CsCl8Vncsi8Ru/e8PguAgAh+QQJBAAKACwAAAAAIQAnAAAEhlDJSau9OOvNu/9gKIZEaZpjda4ptZ5SIs9zTNPSiyo3zveynI5gAxZ7Qt3xtvQNiT9jFKl4NmtTZnV4DWad3C8W6LWKveRE8tVVn93mdHvNes+3Srs+Tr7zpXJ4bHqBf1SFYYGIeYp9gnWNUoZai4ORVJM+lXUtjzCdnjudZqClpqeoqRsRACH5BAUEAAoALAAAAAAhACcAAASFUMlJq7046827/2AojuQ2nChaTmkrJXAcv7IstSldw/p+46deTWhTAIOK3SypTPyAxGXTaTxGeUzlE3elTreurE88rELJxa+Zi5Y2wbk2Vn0cdO/rsJpulXvfeXF7gHV4fGeDWoEqfniFjZCPiWOSgIdsk2WVipdhK4+ffSujpKWmp6grEQAh+QQJBAAKACwXAAYACQAbAAAEEFDISau9OOvNu/9gKI5kyUUAIfkECQQACgAsAAAAACEAJwAABElQyUmrvTjrzbv/YCiOZGkqQaqqJ7qu7QufMkvXQYzrNS/7L+DMhMvdesdfMrgclopCG3HXlD6pU2RWuWV2nSRoa0wum8/o9CYCACH5BAUEAAoALAAAAAAhACcAAARsUMlJq7046827/2AojmRpckmqqtLqti6rxDKdwjQe6+9s8ytg7efLFXfHni0hvCWDz6Fx2WRGndSrNcsldqfeMHiM/JbFZ7ISvVZDze20PE5/s+1u6Ry/19f9fH9Yd4CFTieIiYqLjI2OjyQRACH5BAUEAAoALAAAAAABAAEAAAQCUEUAIfkEBQQACgAsAAAAAAEAAQAABAJQRQA7) 50% no-repeat;width:100%;height:64px}.esri-attachments__actions{flex-flow:wrap;padding:6px 7px;display:flex}.esri-attachments__item-add-icon{font-size:var(--calcite-font-size-xl);margin:0;padding:0 7px}.esri-attachments__delete-button{color:var(--calcite-color-status-danger);width:auto;margin-right:auto}.esri-attachments .esri-attachments__items{width:100%;margin:0;padding:0;display:flex}.esri-attachments .esri-attachments__item{margin:0;line-height:var(--calcite-font-line-height-relative-tight);list-style-type:none}.esri-attachments__item-button{outline-offset:-4px;cursor:pointer;width:100%;text-align:unset;color:var(--calcite-color-text-2);background-color:var(--calcite-color-foreground-2);border:1px solid var(--calcite-color-foreground-1);border-radius:var(--calcite-border-width-md);align-items:center;margin:0 0 var(--calcite-spacing-xs);padding:var(--calcite-spacing-xs) 7px;text-decoration:none;transition:border-color .125s ease-in-out;display:flex;box-shadow:0 1px var(--calcite-color-foreground-1)}.esri-attachments__item-button:focus,.esri-attachments__item-button:hover{border-color:var(--calcite-color-border-white)}.esri-attachments__item-link{text-decoration:none;display:block;position:relative}.esri-attachments__item-link:hover .esri-attachments__item-link-overlay,.esri-attachments__item-link:focus .esri-attachments__item-link-overlay{opacity:1}.esri-attachments__item-add{background-color:var(--calcite-color-background);padding:6px 0}.esri-attachments__add-attachment-button{align-items:baseline!important;border-radius:var(--calcite-corner-radius-xs);border:none!important;justify-content:flex-start!important;padding:12px 3px!important;font-size:var(--calcite-font-size-sm)!important;transition:background-color .25s ease-in-out}.esri-attachments__add-attachment-button:hover{background-color:var(--calcite-color-foreground-1)!important;text-decoration:none;box-shadow:0 1px 2px #0000004d}.esri-attachments__item-link-overlay{opacity:0;pointer-events:none;-webkit-user-select:none;user-select:none;justify-content:center;align-items:center;transition:opacity .25s ease-in-out;display:flex;position:absolute;inset:0}.esri-attachments__item-link-overlay-icon{color:var(--calcite-color-foreground-2);background-color:var(--calcite-color-foreground-1);border-radius:100%;justify-content:center;align-items:center;padding:18px;display:flex}.esri-attachments__item-link-overlay-icon svg{fill:var(--calcite-color-foreground-1)}.esri-attachments__item-mask{justify-content:center;align-items:center;width:64px;height:64px;display:flex;position:relative;overflow:hidden;box-shadow:0 0 0 1px var(--calcite-color-foreground-1)}.esri-attachments__item-mask--icon{background-color:var(--calcite-color-foreground-2);padding:24px 0}.esri-attachments__item-mask--icon .esri-attachments__image{width:var(--calcite-spacing-xxxl);height:var(--calcite-spacing-xxxl)}.esri-attachments__metadata{justify-content:space-between;margin-top:3px;display:flex}.esri-attachments__metadata .esri-attachments__metadata-fieldset{text-align:center;background-color:var(--calcite-color-foreground-1);border:none;flex:0 calc(50% - 1px);margin:0;padding:6px 7px;font-size:var(--calcite-font-size-sm)}.esri-attachments__file-name{white-space:pre-wrap;word-break:break-word;word-wrap:break-word;margin-bottom:3px;font-size:var(--calcite-font-size-sm);display:inline-block}.esri-attachments__file-fieldset{border:none;margin:0;padding:var(--calcite-spacing-md) 7px}.esri-attachments__file-input{opacity:0;z-index:-1;width:.1px;height:.1px;position:absolute;overflow:hidden}.esri-attachments__container--list .esri-attachments__items{flex-flow:column}.esri-attachments__container--list .esri-attachments__item-mask{flex:none;margin-right:7px;position:relative}.esri-attachments__container--list .esri-attachments__image{max-width:unset;max-height:unset;left:50%}.esri-attachments__container--list .esri-attachments__label{flex:auto;justify-content:space-between;display:flex}.esri-attachments__container--list .esri-attachments__filename{white-space:pre-wrap;word-break:break-word;word-wrap:break-word;cursor:pointer;flex:1 0 0}.esri-attachments__container--list .esri-attachments__item-chevron-icon{cursor:pointer;flex:none;padding:0 15px}.esri-attachments__container--preview .esri-attachments__items{flex-flow:wrap;align-items:center}.esri-attachments__container--preview .esri-attachments__item{width:100%;margin-bottom:var(--calcite-spacing-md)}.esri-attachments__container--preview .esri-attachments__item-mask{width:100%;height:auto}.esri-attachments__container--preview .esri-attachments__item-button{box-shadow:none;flex-flow:column}.esri-attachments__container--preview .esri-attachments__item-button .esri-attachments__label{margin:var(--calcite-spacing-md) 0}.esri-attachments__container--preview .esri-attachments__image{max-width:100%}.esri-attachments__container--preview .esri-attachments__filename{white-space:pre-wrap;word-break:break-word;word-wrap:break-word;text-align:center;text-overflow:ellipsis;width:calc(100% - 15px);margin-top:var(--calcite-spacing-md);overflow:hidden}.esri-attachments__container--preview .esri-attachments__item-mask--icon{background-color:var(--calcite-color-foreground-1)}.esri-attachments__form-node{background-color:var(--calcite-color-foreground-1);padding:6px 7px;box-shadow:var(--calcite-shadow-sm)}.esri-attachments__form-node .esri-attachments__item-mask{box-shadow:none;width:unset;height:unset}.esri-attachments__form-node .esri-attachments__image{max-width:100%}.esri-attachments__error-message{background-color:var(--calcite-color-foreground-1);border-top:3px solid var(--calcite-color-status-danger);margin:6px 7px;padding:var(--calcite-spacing-md) 15px;animation:.25s ease-in-out esri-fade-in-down;box-shadow:0 1px 2px #0000004d}.esri-attachments__progress-bar{width:100%;position:absolute}.esri-attachments__item-mask:dir(rtl){margin-left:7px;margin-right:0}.esri-feature-form{letter-spacing:0em;background:var(--calcite-color-background);padding:var(--esri-widget-padding)}.esri-feature-form__disabled-notice{margin-bottom:var(--calcite-spacing-xl)}.esri-feature-form .esri-feature-utility-network-associations,.esri-feature-form .esri-feature-form-utility-network-association-list{margin-block-end:var(--calcite-spacing-md)}.esri-feature-form .esri-feature-utility-network-associations .esri-feature-element-info__description{color:var(--calcite-color-text-2)}.esri-feature-form .esri-feature-utility-network-associations .esri-feature-element-info h5{font-size:inherit}.esri-feature-form__form{flex-direction:column;display:flex}.esri-feature-form__centered-button{align-self:center}.esri-feature-form__description-text{color:var(--calcite-color-text-2);font-size:var(--calcite-font-size-sm)}.esri-feature-form__list-observer{z-index:2;text-align:center;position:relative;bottom:var(--calcite-spacing-xxl)}.esri-feature-form__related-records_header{margin-bottom:var(--calcite-spacing-xs);display:flex}.esri-feature-form__related-records_header span{flex-grow:1}.esri-feature-form__related-records_label calcite-notice,.esri-feature-form__related-records_label .esri-feature-form__description-text{margin-bottom:var(--calcite-spacing-xs)}.esri-feature-form__related-records_list{min-height:40px;margin-bottom:var(--calcite-spacing-xs)}label.esri-feature-form__label{gap:.5em;margin-bottom:var(--calcite-spacing-md)}.esri-feature-form__label{opacity:1;flex-direction:column;justify-content:space-between;margin-bottom:var(--calcite-spacing-xs);transition:opacity .25s,margin .25s;display:flex;position:relative}.esri-feature-form__label:last-child{margin-bottom:0}.esri-feature-form__label-text-content{white-space:pre-wrap;word-break:break-word;word-wrap:break-word;align-items:center;display:flex}.esri-feature-form__form-header{margin-bottom:var(--calcite-spacing-md)}.esri-feature-form__form-header .esri-feature-form__description-text~.esri-widget__heading{margin-bottom:0}.esri-feature-form__input{width:100%}.esri-feature-form__input:focus{outline:2px solid var(--calcite-color-brand);outline-offset:-2px}textarea.esri-feature-form__input{resize:vertical}.esri-feature-form__input--disabled{background-color:var(--calcite-color-background);font-weight:var(--calcite-font-weight-medium)}.esri-feature-form__field-error-message{padding:7px 0;font-size:var(--calcite-font-size-sm)}.esri-feature-form__date-input-container{flex-direction:column;display:flex}.esri-feature-form__date-input-container .esri-feature-form__input{margin-bottom:3px}.esri-feature-form__date-input-container :last-child{margin-bottom:0}.esri-feature-form__input--radio-group{flex-direction:column;display:flex}.esri-feature-form__input--radio-label{align-items:center;display:flex}.esri-feature-form__input--switch{margin:7px 0}.esri-feature-form__group{margin:0 0 var(--calcite-spacing-md);background-color:inherit;margin-inline:-10px}.esri-feature-form__group--sequential{border-bottom:none;border-inline-start:3px solid #adadad4d}.esri-feature-form__group--active{border-inline-start-color:var(--calcite-color-status-info)}.esri-feature-form__text-element{color:var(--calcite-color-text-3);line-height:var(--calcite-font-line-height-relative-snug);font-size:var(--calcite-font-size--1);font-weight:var(--calcite-font-weight-normal)}.esri-feature-form__text-element a{transition:background-color,block-size,border-color,box-shadow,color,inset-block-end,inset-block-start,inset-inline-end,inset-inline-start inset-size,opacity,outline-color,transform var(--calcite-animation-timing) ease-in-out 0s,outline 0s,outline-offset 0s;background-color:var(--calcite-color-background);background-image:linear-gradient(currentColor,currentColor),linear-gradient(var(--calcite-color-brand-underline),var(--calcite-color-brand-underline));color:var(--calcite-color-text-link);background-position-x:0%,100%;background-position-y:min(1.5em,100%);background-repeat:no-repeat,no-repeat;background-size:0% 1px,100% 1px;border-style:none;padding:0;text-decoration:none;display:inline;position:relative}.esri-feature-form__text-element a:hover,.esri-feature-form__text-element a:focus{background-size:100% 1px,100% 1px}.esri-feature-form__text-element a:active{background-size:100% 2px,100% 2px}.esri-feature-form__text-element a.calcite--rtl{background-position:100% 100%,100% 100%}.esri-feature-form__text-element code{border:1px solid var(--calcite-color-border-3);background-color:var(--calcite-color-foreground-3);white-space:normal;word-break:break-word;color:var(--calcite-color-text-2);font-family:var(--calcite-code-family);border-radius:var(--calcite-spacing-base);padding:.25em;font-size:85%}.esri-feature-form__text-element h1,.esri-feature-form__text-element h2,.esri-feature-form__text-element h3,.esri-feature-form__text-element h4,.esri-feature-form__text-element h5{color:var(--calcite-color-text-1);line-height:var(--calcite-font-line-height-relative-snug);font-size:var(--calcite-font-size-0);font-weight:var(--calcite-font-weight-bold);margin-bottom:var(--calcite-spacing-xxs)}.esri-feature-form__text-element h5{font-weight:var(--calcite-font-weight-medium)}.esri-feature-form__text-element h6{color:var(--calcite-color-text-2);line-height:var(--calcite-font-line-height-relative-snug);font-size:var(--calcite-font-size--1);font-weight:var(--calcite-font-weight-medium);margin-bottom:var(--calcite-spacing-xxs)}.esri-feature-form__text-element p{color:var(--calcite-color-text-3);line-height:var(--calcite-font-line-height-relative-snug);font-size:var(--calcite-font-size--1);font-weight:var(--calcite-font-weight-normal);margin-bottom:var(--calcite-spacing-xl)}.esri-feature-form__text-element strong{font-weight:var(--calcite-font-weight-bold)}:dir(rtl) .esri-feature-form__date-input-part:first-child .esri-feature-form__input{border-left:none;border-right:1px solid #adadad4d}.esri-feature-form-utility-network-association-layers{background-color:var(--calcite-color-background)}.esri-feature-form-utility-network-association-layers__header>*{margin-block-end:var(--calcite-spacing-md)}.esri-feature-form-utility-network-association-layers__header>:last-child{color:var(--calcite-color-text-3)}.esri-feature-form-utility-network-association-layers__heading-content{align-items:center;display:flex}.esri-feature-form-utility-network-association-layers__heading-content calcite-icon{margin-inline-end:var(--calcite-spacing-md)}.esri-feature-form-utility-network-association-layers__list-container{min-height:var(--calcite-spacing-xxxl);margin-bottom:var(--calcite-spacing-md)}.esri-feature-form-utility-network-association-layers__feature-observer{z-index:2;text-align:center;position:relative;bottom:20px}.esri-feature-form-utility-network-association-layers__filter-container{z-index:1;margin-bottom:var(--calcite-spacing-md);top:var(--calcite-spacing-md)}.esri-feature-form-utility-network-association-layers__filter-options-container{flex-direction:column;display:flex}.esri-feature-form-utility-network-association-layers__filter-options-header{flex-direction:row;align-items:baseline;display:flex}.esri-feature-form-utility-network-association-layers__filter-options-header span{flex-grow:1}.esri-feature-form-utility-network-association-layers__spatial-select-container{flex-direction:column;align-items:flex-end;gap:6px;display:flex}.esri-feature-form-utility-network-association-layers__spatial-select-toolbar{--calcite-action-group-border-color: transparent;border-width:var(--calcite-border-width-sm, 1px);border-radius:var(--calcite-corner-radius-round, 4px);border-style:solid;border-color:var(--calcite-color-border-3, var(--calcite-color-inverse));width:100%;min-height:min-content;overflow:hidden}.esri-feature-form-utility-network-association-layers__sticky-loading-container{z-index:2;pointer-events:none;justify-content:center;align-items:center;height:var(--calcite-spacing-xxxl);margin:0;padding:0;display:flex;position:sticky;bottom:10px}.esri-feature-form-utility-network-association-layers__loading-container{justify-content:center;width:100%;padding:var(--calcite-spacing-md) 0;display:flex}.esri-feature-form-utility-network-association-list{background-color:var(--calcite-color-foreground-1)}.esri-feature-form-utility-network-association-list__header>*{margin-block-end:var(--calcite-spacing-md)}.esri-feature-form-utility-network-association-list__header>:last-child{color:var(--calcite-color-text-3)}.esri-feature-form-utility-network-association-list__header calcite-block{margin-block-start:-18px;margin-inline:-15px}.esri-feature-form-utility-network-association-list__heading-content{align-items:center;display:flex}.esri-feature-form-utility-network-association-list__heading-content calcite-icon{margin-inline-end:var(--calcite-spacing-md)}.esri-feature-form-utility-network-association-list__list-container{flex-direction:column;min-height:var(--calcite-spacing-xxxl);display:flex}.esri-feature-form-utility-network-association-list__list-container calcite-fab{margin-block:var(--calcite-spacing-md);flex-direction:row;align-self:center;display:flex}.esri-feature-form-utility-network-association-settings{--calcite-block-padding: 0;background-color:var(--calcite-color-foreground-1);flex-direction:column;display:flex}.esri-feature-form-utility-network-association-settings calcite-block{border:1px solid var(--calcite-color-border-3);margin-block:0}.esri-feature-form-utility-network-association-settings calcite-block:first-of-type{border-radius:var(--calcite-spacing-sm) var(--calcite-spacing-sm) 0 0}.esri-feature-form-utility-network-association-settings calcite-block:last-of-type{border-top:none;border-radius:0 0 var(--calcite-spacing-sm) var(--calcite-spacing-sm);margin-block-end:var(--calcite-spacing-md)}.esri-feature-form-utility-network-association-settings calcite-block calcite-label{margin-inline:var(--calcite-spacing-md)}.esri-feature-form-utility-network-association-settings__info-container{flex-direction:column;display:flex}.esri-feature-form-utility-network-association-settings__info-container>*{margin-block-end:var(--calcite-spacing-md)}.esri-feature{letter-spacing:0em;isolation:isolate;position:relative;width:100%}.esri-feature__title{word-break:break-word;word-wrap:break-word;font-size:var(--calcite-font-size);display:block}.esri-feature calcite-icon{box-sizing:content-box}.esri-feature__attachments{display:flex}.esri-feature__loading-container{justify-content:center;width:100%;padding:var(--calcite-spacing-md) 0;display:flex}.esri-feature-relationship{position:relative}.esri-feature-relationship__list{min-height:var(--calcite-spacing-xxxl)}.esri-feature-relationship__list-item--hidden{display:none}.esri-feature-utility-network-associations{position:relative}.esri-feature__filter-container{z-index:1;margin-bottom:var(--calcite-spacing-md);position:sticky;top:var(--calcite-spacing-md)}.esri-feature__feature-observer{z-index:2;text-align:center;position:relative;bottom:var(--calcite-spacing-xxl)}.esri-feature__sticky-loading-container{z-index:2;pointer-events:none;justify-content:center;align-items:center;height:var(--calcite-spacing-xxxl);margin:0;padding:0;display:flex;position:sticky;bottom:10px}.esri-icon-loading-indicator{display:inline-block}.esri-feature__content-element{margin-bottom:24px;padding:0 7px}.esri-feature__content-element .esri-widget__heading{line-height:var(--calcite-font-line-height-relative-tight)}.esri-feature__content-element:only-child,.esri-feature__content-node--text{margin-bottom:3px}.esri-feature__content-node{flex-direction:column;display:flex}.esri-feature__text{line-height:var(--calcite-font-line-height-relative-tight)}.esri-feature-attachments{flex-flow:column wrap;align-items:flex-start}.esri-feature__last-edited-info{padding-top:var(--calcite-spacing-xs);font-size:var(--calcite-font-size-sm)}:dir(rtl) .esri-feature__attachments-title{margin:0 0 0 auto}:dir(rtl) .esri-feature__attachments--list .esri-feature__attachment-item-mask{margin-left:7px;margin-right:0}.esri-feature-content__loader-container{justify-content:center;align-items:center;height:150px;padding:0;display:flex}.esri-feature-content__loader{background:url(./assets/attachments/images/loading-throb.gif) 50% no-repeat;width:100%;height:64px}.esri-feature-content{font-size:var(--calcite-font-size)}.esri-feature-content h1,.esri-feature-content h2,.esri-feature-content h3,.esri-feature-content h4,.esri-feature-content h5,.esri-feature-content h6{letter-spacing:0;color:var(--calcite-color-text-2);margin:.5em 0;font-weight:var(--calcite-font-weight-semibold);line-height:normal}.esri-feature-content h1{font-size:1.75em}.esri-feature-content h2{font-size:1.5em}.esri-feature-content h3{font-size:1.25em}.esri-feature-content h4,.esri-feature-content h5,.esri-feature-content h6{font-size:1em}.esri-widget__heading.esri-feature-element-info__title{color:var(--calcite-color-text-2);margin-top:0;margin-bottom:.2em;font-size:var(--calcite-font-size-xl);font-weight:var(--calcite-font-weight-normal)}.esri-feature-element-info__description{margin-bottom:var(--calcite-font-size-xs);font-size:var(--calcite-font-size-sm);font-weight:var(--calcite-font-weight-normal)}.esri-feature-content p{margin:0 0 1.2em;font-size:var(--calcite-font-size)}.esri-feature-content p:last-child{margin-block-end:0}.esri-feature-content img{image-orientation:from-image;max-width:100%;max-height:100%}.esri-feature-content video{max-width:100%;max-height:100%}.esri-feature-content figure{margin:0;padding:0}.esri-feature-content figcaption{margin:.2em 0 0;padding:0;font-size:var(--calcite-font-size-sm);font-style:italic;display:block}.esri-feature-content ul,.esri-feature-content ol{margin-block:1rem}.esri-feature-content ul:first-child,.esri-feature-content ol:first-child{margin-block-start:0}.esri-feature-content a{color:var(--calcite-color-text-3)}.esri-feature-content a:hover,.esri-feature-content a:focus{color:var(--calcite-color-text-2)}.esri-features{--calcite-color-background: $background-color;flex-direction:column;display:flex}.esri-features img{image-orientation:from-image}.esri-features__flow-item--collapsed{--calcite-flow-item-header-border-block-end: none}.esri-features__container{background-color:var(--calcite-color-background)}.esri-features__container:not(:empty){padding:var(--calcite-spacing-md)}.esri-features .esri-feature,.esri-features .esri-feature-relationship,.esri-features .esri-feature-utility-network-associations{background-color:#0000}.esri-features__heading{word-break:break-word;word-wrap:break-word}.esri-features__header,.esri-features__footer{background-color:var(--calcite-color-foreground-1);flex:1;justify-content:flex-end;align-items:center;display:flex}.esri-features__pagination-text{padding-inline:var(--calcite-spacing-sm);color:var(--calcite-color-text-3);font-size:var(--calcite-font-size-sm)}.esri-features__loader{align-self:center;padding-inline:1rem}.esri-features__pagination-action-bar{flex:1}.esri-features__pagination-menu-button{border-inline-start:1px solid var(--calcite-color-border-3)}.esri-features__icon{flex:0 0 var(--calcite-spacing-lg);width:var(--calcite-spacing-lg);height:var(--calcite-spacing-lg);display:inline-block}.esri-features__action-image{background-position:50%;background-repeat:no-repeat;background-size:contain;flex:0 0 var(--calcite-spacing-lg);width:var(--calcite-spacing-lg);height:var(--calcite-spacing-lg)}.esri-features__header{border-block-end:1px solid var(--calcite-color-border-3)}.esri-features__content-feature{--calcite-flow-item-footer-padding: 0}.esri-features__feature-menu-observer{z-index:2;text-align:center;position:relative;bottom:20px}.esri-features__action--exit{transform:scaleX(-1)}.esri-feature-media__container{flex-flow:wrap;align-items:center;width:100%;min-height:150px;margin-top:var(--calcite-spacing-xs);display:flex}.esri-feature-media__container .esri-feature-media__pagination-button{cursor:pointer;color:var(--calcite-color-text-3);background:0 0;border:none;justify-content:center;align-items:center;padding-block:var(--calcite-spacing-xs);padding-inline:var(--calcite-spacing-sm);display:flex}.esri-feature-media__container .esri-feature-media__pagination-button:hover,.esri-feature-media__container .esri-feature-media__pagination-button:focus{color:var(--calcite-color-text-2);fill:var(--calcite-color-text-2);background-color:var(--calcite-color-foreground-2)}.esri-feature-media__item-title{margin:0;font-size:var(--calcite-font-size-md)}.esri-feature-media__item-caption{padding-block-start:3px;font-size:var(--calcite-font-size-sm)}.esri-feature-media__item{justify-content:center;align-items:flex-start;width:100%;height:auto;margin-block:var(--calcite-spacing-xs);display:flex}.esri-feature-media__item-navigation{flex:0 100%;justify-content:space-between;align-items:flex-start;margin-block-end:var(--calcite-spacing-xs);display:flex}.esri-feature-media__item-text{margin-inline-end:var(--calcite-spacing-md)}.esri-feature-media__pagination{flex:none;align-items:center;display:flex;overflow:hidden}.esri-feature-media__pagination:only-child{margin-inline-start:auto}.esri-feature-media__pagination-text{color:var(--calcite-color-text-3);padding-inline:var(--calcite-spacing-base);font-size:var(--calcite-font-size-sm)}.esri-feature-media__item-container{flex:0 auto;width:100%}.esri-feature-media__item-container img{max-width:100%}.esri-feature-media__item-container img[src$=".SVG"],.esri-feature-media__item-container img[src$=".svg"]{width:100%}.esri-feature-media__chart{background-color:var(--calcite-color-foreground-1);width:100%;height:155px}:dir(rtl) .esri-feature-media__image-summary{margin:0 .5em 0 0}:dir(rtl) .esri-feature-media__pagination-icon{transform:rotate(180deg)}.esri-identity-modal__info,.esri-identity-modal__notice{margin:0;margin-bottom:var(--calcite-spacing-md)}.esri-ui .esri-popup{z-index:1;pointer-events:none;flex-flow:column;display:flex;position:absolute}.esri-ui .esri-popup .esri-features{flex:1;width:100%}.esri-ui .esri-popup .esri-widget__heading{margin:0}.esri-ui .esri-popup--hidden{display:none}.esri-popup--shadow{box-shadow:0 1px 4px #000c}.esri-popup--aligned-top-center{transform-origin:50% 100%}.esri-popup--aligned-bottom-center{transform-origin:50% -5%}.esri-popup--aligned-top-left,.esri-popup--aligned-bottom-left{transform-origin:100%}.esri-popup--aligned-top-right,.esri-popup--aligned-bottom-right{transform-origin:-5%}.esri-popup--aligned-top-center,.esri-popup--aligned-top-left,.esri-popup--aligned-top-right{animation:.2s ease-in-out popup-intro-animation-down}.esri-popup--aligned-bottom-center,.esri-popup--aligned-bottom-left,.esri-popup--aligned-bottom-right{animation:.2s ease-in-out popup-intro-animation-up}.esri-popup__main-container{z-index:1;pointer-events:auto;background-color:var(--calcite-color-foreground-1);width:340px;min-height:48px;max-height:340px;display:flex;position:relative;overflow:hidden}.esri-popup__pointer{width:0;height:0;position:absolute}.esri-popup__pointer-direction{content:"";background-color:var(--calcite-color-foreground-1);width:var(--calcite-spacing-md);height:var(--calcite-spacing-md);position:absolute}.esri-popup--aligned-top-center .esri-popup__pointer{margin:0 0 0 -6px;top:100%;left:50%}.esri-popup--aligned-bottom-center .esri-popup__pointer{margin:0 0 0 -6px;bottom:100%;left:50%}.esri-popup--aligned-top-left .esri-popup__pointer{bottom:var(--calcite-spacing-xs);right:var(--calcite-spacing-xs);transform:rotate(-45deg)}.esri-popup--aligned-bottom-left .esri-popup__pointer{top:var(--calcite-spacing-xs);right:var(--calcite-spacing-xs);transform:rotate(45deg)}.esri-popup--aligned-top-right .esri-popup__pointer{bottom:var(--calcite-spacing-xs);left:var(--calcite-spacing-xs);transform:rotate(45deg)}.esri-popup--aligned-bottom-right .esri-popup__pointer{top:var(--calcite-spacing-xs);left:var(--calcite-spacing-xs);transform:rotate(-45deg)}.esri-popup--aligned-top-center .esri-popup__pointer-direction,.esri-popup--aligned-bottom-center .esri-popup__pointer-direction{transform:scale(.75,2) rotate(45deg)}.esri-popup--aligned-top-left .esri-popup__pointer-direction,.esri-popup--aligned-bottom-left .esri-popup__pointer-direction,.esri-popup--aligned-top-right .esri-popup__pointer-direction,.esri-popup--aligned-bottom-right .esri-popup__pointer-direction{top:-6px;left:-6px;transform:scaleY(3.5) rotate(45deg)}.esri-popup--aligned-top-center .esri-popup__pointer-direction{top:-6px;left:0}.esri-popup--aligned-bottom-center .esri-popup__pointer-direction{bottom:-6px;left:0}.esri-view-width-xlarge .esri-popup__main-container{width:460px}.esri-view-width-large .esri-popup__main-container{width:400px}.esri-view-width-medium .esri-popup__main-container{width:340px}.esri-view-width-less-than-medium .esri-popup__main-container{width:280px}.esri-view-width-xsmall .esri-popup--is-docked-bottom-center{margin-bottom:var(--calcite-spacing-xl)}.esri-view-width-xsmall .esri-popup--is-docked-top-center,.esri-view-width-xsmall .esri-popup--is-docked-bottom-center{width:auto;margin:0}.esri-view-width-xsmall .esri-popup--is-docked-top-center .esri-popup__main-container,.esri-view-width-xsmall .esri-popup--is-docked-bottom-center .esri-popup__main-container{width:100%;max-height:75%;position:absolute;left:0;right:0}.esri-view-width-xsmall .esri-popup--is-docked-bottom-center .esri-popup__main-container{bottom:0}.esri-view-width-xsmall .esri-popup--is-docked-top-center .esri-popup__main-container{top:0}.esri-view-height-xlarge .esri-popup__main-container{max-height:460px}.esri-view-height-xlarge.esri-popup--feature-menu-open .esri-popup__feature-menu-viewport{max-height:410px}.esri-view-height-large .esri-popup__main-container{max-height:400px}.esri-view-height-large.esri-popup--feature-menu-open .esri-popup__feature-menu-viewport{max-height:350px}.esri-view-height-less-than-medium .esri-popup__main-container{max-height:300px}.esri-view-height-less-than-medium.esri-popup--feature-menu-open .esri-popup__feature-menu-viewport{max-height:250px}.esri-popup--is-docked{margin:15px 15px 30px;animation:.25s ease-out esri-docking-animation;inset:0}.esri-ui .esri-popup--is-docked{flex-flow:row}.esri-popup--is-docked-top-left,.esri-popup--is-docked-top-center,.esri-popup--is-docked-top-right{align-items:flex-start}.esri-popup--is-docked-bottom-left,.esri-popup--is-docked-bottom-center,.esri-popup--is-docked-bottom-right{align-items:flex-end}.esri-popup--is-docked-top-left,.esri-popup--is-docked-bottom-left{justify-content:flex-start}.esri-popup--is-docked-top-center,.esri-popup--is-docked-bottom-center{justify-content:center}.esri-popup--is-docked-top-right,.esri-popup--is-docked-bottom-right{justify-content:flex-end}.esri-popup--is-docked-top-left .esri-popup__main-container,.esri-popup--is-docked-top-right .esri-popup__main-container,.esri-popup--is-docked-bottom-left .esri-popup__main-container,.esri-popup--is-docked-bottom-right .esri-popup__main-container{max-height:80%}.esri-popup--is-docked-top-center .esri-popup__main-container,.esri-popup--is-docked-bottom-center .esri-popup__main-container{max-height:40%}@media (prefers-reduced-motion){.esri-popup--aligned-top-center,.esri-popup--aligned-top-left,.esri-popup--aligned-top-right,.esri-popup--aligned-bottom-center,.esri-popup--aligned-bottom-left,.esri-popup--aligned-bottom-right,.esri-popup--is-docked{animation:none}}.esri-tooltip{--calcite-input-padding-inline: .5rem;--calcite-input-height: 1.5rem;--field-height: .875rem;--field-height--input: var(--calcite-input-height);--field-row-gap: 1px;--field-column-gap: var(--calcite-app-spacing-2);--field-input-width: 6.5rem;--field-title-extra-margin: var(--calcite-app-spacing-6);--field-title-color: var(--calcite-color-text-2);--field-value-color: var(--calcite-color-text-1);--font-size: var(--calcite-font-size--3);--font-size--input: var(--calcite-font-size--2);--content-padding-inline: var(--calcite-app-spacing-2);--content-padding-block: var(--calcite-app-spacing-2);--help-message-border-spacing: var(--calcite-app-spacing-2);--help-message-min-width: 7rem;--icon-size--feedback: .625rem;z-index:1;will-change:transform;width:fit-content;position:absolute;top:0;left:0;overflow:visible}.esri-tooltip-content{gap:var(--content-padding-block);border:solid 1px var(--calcite-color-border-3);padding-block:var(--content-padding-block);padding-inline:var(--content-padding-inline);color:var(--calcite-color-text-2);width:min-content;line-height:var(--calcite-font-line-height-relative-tight);font-size:var(--font-size);-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px);touch-action:none;view-transition-name:tooltip-content;background:var(--calcite-color-foreground-2);border-radius:.25rem;flex-direction:column;display:flex;position:relative;box-shadow:0 6px 20px -4px #0000001a,0 4px 12px -2px #00000014;outline:none!important}.esri-tooltip-content:empty{opacity:0}.esri-tooltip-content__header{margin-block-start:calc(var(--content-padding-block) * -1);margin-inline:calc(var(--content-padding-inline) * -1);border-block-end:solid 1px var(--calcite-color-border-3);justify-content:flex-start;block-size:24px;padding-block-end:0;display:flex}.esri-tooltip-content__header__spacer{flex-grow:1;flex-shrink:1}.esri-tooltip-content__header__actions{flex-grow:0;flex-shrink:0;padding-inline-end:var(--content-padding-inline)}.esri-tooltip-content__header calcite-button{--calcite-offset-invert-focus: 1}.esri-tooltip-content--input{--field-height: var(--field-height--input);background:var(--calcite-color-foreground-1);pointer-events:all;-webkit-backdrop-filter:none;backdrop-filter:none}.esri-tooltip-content--input:not(:focus-within){opacity:.8}.esri-tooltip.calcite-mode-dark .esri-tooltip-content,.esri-tooltip.calcite-mode-dark .esri-tooltip-content--input{background:var(--calcite-color-foreground-1)}.esri-tooltip-table{grid-gap:var(--field-row-gap) var(--field-column-gap);grid-template-columns:max-content 1fr max-content max-content;align-items:flex-start;width:max-content;display:grid}.esri-tooltip-field{display:contents}.esri-tooltip-field__title,.esri-tooltip-field__value{block-size:var(--field-height);white-space:nowrap;color:var(--calcite-color-text-3);justify-content:flex-start;align-items:center;display:flex}.esri-tooltip-field__title{color:var(--field-title-color);margin-inline-end:var(--field-title-extra-margin)}.esri-tooltip-field__value{color:var(--field-value-color);grid-column:span 3}.esri-tooltip-editable-field{display:contents}.esri-tooltip-editable-field__title,.esri-tooltip-editable-field__value{block-size:var(--field-height);white-space:nowrap;justify-content:flex-start;align-items:center}.esri-tooltip-editable-field__title{display:flex}.esri-tooltip-editable-field__value{font-variant-numeric:tabular-nums;display:contents}.esri-tooltip-editable-field__value__content{grid-column:span 3;align-items:center;min-width:max-content;display:flex}.esri-tooltip-editable-field__value__content--read-only{padding-inline:var(--calcite-input-padding-inline);block-size:var(--calcite-input-height);line-height:var(--calcite-input-height);font-size:var(--calcite-font-size--2)}.esri-tooltip-editable-field--feedback.esri-tooltip-editable-field--locked .esri-tooltip-editable-field__value__content{grid-column:span 2}.esri-tooltip-editable-field--feedback .esri-tooltip-editable-field__title{color:var(--field-title-color);margin-inline-end:var(--field-title-extra-margin)}.esri-tooltip-editable-field--feedback .esri-tooltip-editable-field__value__content{color:var(--field-value-color);align-self:center}.esri-tooltip-editable-field--feedback .esri-tooltip-editable-field__lock-icon{width:var(--icon-size--feedback);min-width:var(--icon-size--feedback);height:var(--icon-size--feedback);min-height:var(--icon-size--feedback);align-self:center;margin-top:-2px}.esri-tooltip-editable-field--input{padding:0}.esri-tooltip-editable-field--input .esri-tooltip-editable-field__title{font-size:var(--font-size--input)}.esri-tooltip-editable-field__input-wrapper{inline-size:var(--field-input-width)}.esri-tooltip-editable-field__input-message{text-wrap:auto;width:100%;margin-block-end:var(--calcite-input-message-spacing-value)}.esri-tooltip-editable-field__input-suffix{line-height:var(--field-height--input)}.esri-tooltip-editable-field__button{width:var(--field-height--input)}.esri-tooltip-value-by-value span:nth-child(2){margin-inline:7px}.esri-tooltip-help-message{gap:var(--calcite-app-spacing-2);margin-inline:calc(var(--content-padding-inline) * -1);border-block-start:solid 1px var(--calcite-color-border-3);padding-block-start:var(--content-padding-inline);padding-inline:var(--content-padding-inline);width:auto;min-width:var(--help-message-min-width);text-align:left;text-wrap:balance;white-space:break-spaces;font-size:var(--font-size);border-block-end:1px solid var(--calcite-color-foreground-1);justify-content:center;align-items:center;display:flex}.esri-tooltip-help-message:only-child{border-block:none;padding-block-start:var(--field-row-gap)}.esri-tooltip-help-message__icon{color:var(--calcite-color-status-info)}.esri-tooltip-help-message__text{padding-block-start:2px}.esri-tooltip ::view-transition-old(tooltip-content){animation-duration:.1s}.esri-tooltip ::view-transition-new(tooltip-content){animation-duration:.1s}.esri-tooltip{--offset-start: calc(-100% - var(--offset))}.esri-tooltip--debug:after{--size: 10px;margin-top:calc(var(--size) * -.5);margin-left:calc(var(--size) * -.5);width:var(--size);height:var(--size);content:"";background:var(--calcite-color-status-danger);position:absolute;top:0;left:0}.esri-tooltip--bottom .esri-tooltip-content{transform:translate(-50%,var(--offset))}.esri-tooltip--bottom-left.esri-tooltip--ltr .esri-tooltip-content,.esri-tooltip--bottom-right.esri-tooltip--rtl .esri-tooltip-content,.esri-tooltip--bottom-start.esri-tooltip--ltr .esri-tooltip-content,.esri-tooltip--bottom-end.esri-tooltip--rtl .esri-tooltip-content{transform:translate(var(--offset-start),var(--offset))}.esri-tooltip--bottom-right.esri-tooltip--ltr .esri-tooltip-content,.esri-tooltip--bottom-left.esri-tooltip--rtl .esri-tooltip-content,.esri-tooltip--bottom-start.esri-tooltip--rtl .esri-tooltip-content,.esri-tooltip--bottom-end.esri-tooltip--ltr .esri-tooltip-content{transform:translate(var(--offset),var(--offset))}.esri-tooltip--leading.esri-tooltip--ltr .esri-tooltip-content,.esri-tooltip--trailing.esri-tooltip--rtl .esri-tooltip-content{transform:translate(var(--offset-start),-50%)}.esri-tooltip--leading-start.esri-tooltip--ltr .esri-tooltip-content,.esri-tooltip--trailing-start.esri-tooltip--rtl .esri-tooltip-content{transform:translate(var(--offset-start),var(--offset-start))}.esri-tooltip--leading-end.esri-tooltip--ltr .esri-tooltip-content,.esri-tooltip--trailing-end.esri-tooltip--rtl .esri-tooltip-content{transform:translate(var(--offset-start),var(--offset))}.esri-tooltip--top .esri-tooltip-content{transform:translate(-50%,var(--offset-start))}.esri-tooltip--top-left.esri-tooltip--ltr .esri-tooltip-content,.esri-tooltip--top-right.esri-tooltip--rtl .esri-tooltip-content,.esri-tooltip--top-start.esri-tooltip--ltr .esri-tooltip-content,.esri-tooltip--top-end.esri-tooltip--rtl .esri-tooltip-content{transform:translate(var(--offset-start),var(--offset-start))}.esri-tooltip--top-right.esri-tooltip--ltr .esri-tooltip-content,.esri-tooltip--top-left.esri-tooltip--rtl .esri-tooltip-content,.esri-tooltip--top-start.esri-tooltip--rtl .esri-tooltip-content,.esri-tooltip--top-end.esri-tooltip--ltr .esri-tooltip-content{transform:translate(var(--offset),var(--offset-start))}.esri-tooltip--trailing.esri-tooltip--ltr .esri-tooltip-content,.esri-tooltip--leading.esri-tooltip--rtl .esri-tooltip-content{transform:translate(var(--offset),-50%)}.esri-tooltip--trailing-start.esri-tooltip--ltr .esri-tooltip-content,.esri-tooltip--leading-start.esri-tooltip--rtl .esri-tooltip-content{transform:translate(var(--offset),var(--offset-start))}.esri-tooltip--trailing-end.esri-tooltip--ltr .esri-tooltip-content,.esri-tooltip--leading-end.esri-tooltip--rtl .esri-tooltip-content{transform:translate(var(--offset),var(--offset))}`;const S4t={"top-left":"top-left","top-right":"top-right","bottom-left":"bottom-left","bottom-right":"bottom-right","bottom-leading":"bottom-start","bottom-trailing":"bottom-end","top-leading":"top-start","top-trailing":"top-end"},T4t=["manual"];function Tk(t){t.el.childElem&&(t.el.childElem.ownedBy=t.el),t.position&&T4t.includes(t.position)?t.el.removeAttribute("slot"):t.position&&(t.el.slot=S4t[t.position]);const e=$4t(t);if(!e){const i=R4t(t);if(!i){Yke(t);return}return i1e(i,t,!0),i}return C4t(e,t.el.parent)||(t.el.parent=e,e.localName==="arcgis-expand"?M4t(e,t):e.localName==="arcgis-placement"?E4t(e,t):i1e(e,t,!1)),e}function $4t({el:t}){for(let e=t.parentElement;e;e=e?.parentElement??null){if(t1e.has(e.localName))return e;if("ownedBy"in e&&e.ownedBy instanceof HTMLElement&&t1e.has(e.ownedBy.localName))return e.ownedBy}}const t1e=new Set(["arcgis-map","arcgis-scene","arcgis-link-chart","arcgis-expand","arcgis-placement"]);function C4t(t,e){if(t!==e)return!1;const i=t.localName;return i==="arcgis-expand"||i==="arcgis-placement"}function tB(t,e,i="arcgisReady"){const r=t;if(r.view)e(r.view);else{let s=function(n){n.target===t&&(tB(t,e,i),t.removeEventListener(i,s))};t.addEventListener(i,s)}}const M4t=(t,e)=>tB(t,i=>{const r=jse(e);e.el.shadowRoot?t.content=e.el:e.el.childElem&&t.content!=null&&r.append(e.el.childElem),e.el.view=i}),E4t=(t,e)=>tB(t,i=>{const r=jse(e);e.el.childElem&&r.append(e.el.childElem),e.el.view=i}),i1e=(t,e,i)=>tB(t,r=>{i&&Yke(e),e.el.view=r,e.referenceElement=t},"arcgisViewReadyChange");function A4t(t,e){return e!=null&&t?.position===e.position&&t?.heading===e.heading&&t?.tilt===e.tilt&&t?.fov===e.fov}function O4t(t,e){return e===void 0||t?.targetGeometry!==e?.targetGeometry||t?.rotation!==e?.rotation||t?.scale!==e?.scale}function P4t(t,e){return Bse(e?.center,t)}function Bse(t,e){if(typeof e=="string")return Bse(t,e.split(",").map(Number));if(!t)return e;if(Array.isArray(e)){const i=e[0],r=e[1],s=e.length>2?e[2]:void 0;if(i!==t.longitude||r!==t.latitude||s!==t.z)return e}else if(e&&!t?.equals(e))return e}function Yke(t){t.el.childElem&&jse(t).append(t.el.childElem)}function jse(t){return t.el.shadowRoot??t.el}function R4t(t,e){const i=t.referenceElement;if(typeof i!="string")return i??void 0;const r=i.includes("#")||i.includes(".")||i.includes("["),s=t.el.getRootNode();return(r?void 0:s.querySelector(`#${i}`))??s.querySelector(i)??void 0}const D4t=Hke(h4t),I4t=Hke(hDt);var Ax;let L4t=(Ax=class extends lv{constructor(){super(),this._containerRef=TR(),this._mapRef=TR(),this._uiController=new v4t(this),this._cameraProperties={},this.arcgisLoadError=b4t(this),this.arcgisViewReadyError=w4t(this),this._map=D4t(this),this.view=I4t(this),this.allLayerViews=this.view.allLayerViews,this.alphaCompositingEnabled=this.view.alphaCompositingEnabled,this.analyses=this.view.analyses,this.autoDestroyDisabled=!1,this.basemap=this._map.basemap,this.basemapView=this.view.basemapView,this.clippingArea=this.view.clippingArea,this.constraints=this.view.constraints,this.displayFilterDisabled=this.view.displayFilterEnabled,this.environment=this.view.environment,this.fatalError=this.view.fatalError,this.floors=this.view.floors,this.graphics=this.view.graphics,this.ground=this._map.ground,this.groundView=this.view.groundView,this.highlights=this.view.highlights,this.highlightOptions=this.view.highlightOptions,this.layerViews=this.view.layerViews,this.magnifier=this.view.magnifier,this.map=this.view.map,this.navigation=this.view.navigation,this.padding=this.view.padding,this.popup=this.view.popup,this.popupDisabled=this.view.popupEnabled,this.qualityProfile=this.view.qualityProfile,this.ready=this.view.ready,this.spatialReference=this.view.spatialReference,this.suspended=this.view.suspended,this.theme=this.view.theme,this.timeExtent=this.view.timeExtent,this.updating=this.view.updating,this.viewingMode=this.view.viewingMode,this.visibleArea=this.view.visibleArea,this.arcgisViewAnalysisViewCreate=ca(()=>this.view,"analysis-view-create"),this.arcgisViewAnalysisViewCreateError=ca(()=>this.view,"analysis-view-create-error"),this.arcgisViewAnalysisViewDestroy=ca(()=>this.view,"analysis-view-destroy"),this.arcgisViewChange=Pc(),this.arcgisViewClick=ca(()=>this.view,"click"),this.arcgisViewDoubleClick=ca(()=>this.view,"double-click"),this.arcgisViewDrag=ca(()=>this.view,"drag"),this.arcgisViewHold=ca(()=>this.view,"hold"),this.arcgisViewImmediateClick=ca(()=>this.view,"immediate-click"),this.arcgisViewImmediateDoubleClick=ca(()=>this.view,"immediate-double-click"),this.arcgisViewKeyDown=ca(()=>this.view,"key-down"),this.arcgisViewKeyUp=ca(()=>this.view,"key-up"),this.arcgisViewLayerviewCreate=ca(()=>this.view,"layerview-create"),this.arcgisViewLayerviewCreateError=ca(()=>this.view,"layerview-create-error"),this.arcgisViewLayerviewDestroy=ca(()=>this.view,"layerview-destroy"),this.arcgisViewMouseWheel=ca(()=>this.view,"mouse-wheel"),this.arcgisViewPointerDown=ca(()=>this.view,"pointer-down"),this.arcgisViewPointerEnter=ca(()=>this.view,"pointer-enter"),this.arcgisViewPointerLeave=ca(()=>this.view,"pointer-leave"),this.arcgisViewPointerMove=ca(()=>this.view,"pointer-move"),this.arcgisViewPointerUp=ca(()=>this.view,"pointer-up"),this.arcgisViewReadyChange=Pc(),this.view.ui={components:["attribution"]}}get aria(){return this.view?.aria??null}set aria(e){this.view&&(this.view.aria=e)}get camera(){return this.view.camera}set camera(e){A4t(this.camera,e)||(this.view.camera=e)}get cameraFov(){const{view:e}=this;return e.ready?this.view.camera?.fov:this._cameraProperties.fov}set cameraFov(e){e!=null&&this._mutateCamera(i=>{i.fov=e})}get cameraHeading(){const{view:e}=this;return e.ready?e.camera?.heading:this._cameraProperties.heading}set cameraHeading(e){e!=null&&this._mutateCamera(i=>{i.heading=e})}get cameraPosition(){const{view:e}=this;if(e.ready)return e.camera?.position;const{position:i}=this._cameraProperties;return i?new Qe(i):void 0}set cameraPosition(e){const i=Bse(this.view.camera?.position,e);i&&this._mutateCamera(r=>{r.position=i})}get cameraTilt(){const{view:e}=this;return e.ready?e.camera?.tilt:this._cameraProperties.tilt}set cameraTilt(e){e!=null&&this._mutateCamera(i=>{i.tilt=e})}get center(){return this.view.center}set center(e){const i=P4t(e,this.view);i&&(this.view.center=i)}get extent(){return this.view.extent}set extent(e){e&&!this.extent.equals(e)&&(this.view.extent=e)}get focusAreas(){return this.map?this.map?.focusAreas:{areas:[],style:"bright"}}set focusAreas(e){this.map&&(this.map.focusAreas=e)}get gamepad(){return this.view.input.gamepad}get interacting(){return this.view.interacting}get itemId(){return this._map.portalItem?.id}set itemId(e){g4t(this._map,this),this._map.portalItem={id:e},this.view.map=this._map}get navigating(){return this.view.navigating}get performanceInfo(){return this.view.performanceInfo}get resolution(){return this.view.resolution}get scale(){return this.view.scale}set scale(e){this.view.scale=e}get stationary(){return this.view.stationary}get viewpoint(){return this.view.viewpoint}set viewpoint(e){O4t(this.viewpoint,e)&&(this.view.viewpoint=e)}get zoom(){return this.view.zoom}set zoom(e){this.view.zoom=e}async addLayer(e,i){this.map?.add(e,i)}async addLayers(e,i){this.map?.addMany(e,i)}async addTable(e){this.map?.tables.add(e)}async addTables(e,i){this.map?.tables.addMany(e,i)}async closePopup(){this._uiController.closePopup()}async destroy(){await this.manager.destroy()}async goTo(e,i){return await this.view.goTo(e,i)}async hitTest(e,i){return await this.view.hitTest(e,i)}async openPopup(e){this._uiController.openPopup(e)}async takeScreenshot(e){return await this.view.takeScreenshot(e)}toMap(e,i){return this.view.toMap(e,i)}toScreen(e){return this.view.toScreen(e)}async tryFatalErrorRecovery(){this.view.tryFatalErrorRecovery()}async viewOnReady(e,i){return await this.componentOnReady(),await this.view.whenReady().then(()=>e?.()).catch(i)}async whenAnalysisView(e){return await this.view.whenAnalysisView(e)}async whenLayerView(e){return await this.view.whenLayerView(e)}loaded(){const e=this;e.el.childElem=this._mapRef.value,this.view.container??=e.el.childElem,this.map||=this._map,this.manager.onLifecycle(()=>[K(()=>this.map,i=>{i&&(this._map=i)},{initial:!0,sync:!0}),K(()=>this.view.stationary,()=>this.arcgisViewChange.emit(),{initial:!0}),K(()=>this.view.ready,i=>{i&&(this.camera=this.view.camera.clone().set(this._cameraProperties),this._cameraProperties={}),this.arcgisViewReadyChange.emit()},{initial:this.view.ready})])}_mutateCamera(e){if(!this.view.ready){e(this._cameraProperties);return}const i=this.view.camera?.clone()??new ol;e(i),this.camera=i}renderMain(){return En`<div class=${gr(Ks.base)} ${iC(this._mapRef)}></div>`}render(){return En`<section class=${gr(Ks.containerUI)} ${iC(this._containerRef)}>${this._uiController.render()}</section>${this.renderMain()}`}},Ax.properties={_map:16,aria:0,view:32,allLayerViews:0,alphaCompositingEnabled:5,analyses:0,autoDestroyDisabled:5,basemap:1,basemapView:0,camera:0,cameraFov:9,cameraHeading:9,cameraPosition:1,cameraTilt:9,center:1,clippingArea:0,constraints:0,displayFilterDisabled:5,environment:0,extent:0,fatalError:0,floors:0,focusAreas:0,gamepad:32,graphics:0,ground:1,groundView:0,highlights:0,highlightOptions:0,interacting:32,itemId:3,layerViews:0,magnifier:0,map:0,navigating:32,navigation:0,padding:0,performanceInfo:32,popup:0,popupDisabled:5,qualityProfile:1,ready:4,resolution:32,scale:9,spatialReference:0,stationary:32,suspended:7,theme:0,timeExtent:0,updating:4,viewingMode:1,viewpoint:0,visibleArea:0,zoom:9,loadErrorSources:0},Ax.styles=[x4t,_4t],Ax);cwe("arcgis-scene",L4t);const Xa="esri-elevation-profile",ua={base:`${Xa}`,refined:`${Xa}--refined`,mainContainer:`${Xa}__main-container`,promptContainer:`${Xa}__prompt-container`,header:`${Xa}__header`,zoomOutButton:`${Xa}__zoom-out-button`,clearButton:`${Xa}__clear-button`,actionButton:`${Xa}__action-button`,sketchButton:`${Xa}__sketch-button`,sketchCancelButton:`${Xa}__sketch-cancel-button`,sketchDoneButton:`${Xa}__sketch-done-button`,selectButton:`${Xa}__select-button`,selectCancelButton:`${Xa}__select-cancel-button`,chartContainer:`${Xa}__chart-container`,chartSpinner:`${Xa}__chart-spinner`,chartSpinnerVisible:`${Xa}__chart-spinner--visible`,chartSpinnerSmall:`${Xa}__chart-spinner--small`,footer:`${Xa}__footer`},k4t={base:"esri-elevation-profile-legend"},jm="esri-elevation-profile-legend-item",qm={base:jm,disabled:`${jm}--disabled`,expanded:`${jm}--expanded`,colorIndicator:`${jm}__color-indicator`,header:`${jm}__header`,content:`${jm}__content`,collapseToggle:`${jm}__collapse-toggle`,label:`${jm}__label`,checkbox:`${jm}__checkbox`},zA="esri-elevation-profile-statistics",FA={base:zA,statistic:`${zA}__statistic`,statisticLabel:`${zA}__statistic__label`,statisticValue:`${zA}__statistic__value`,slopeValue:`${zA}__slope-value`},$k="esri-elevation-profile-settings",Ck={base:`${$k}`,popoverContent:`${$k}__popover-content`,uniformChartScalingLabel:`${$k}__uniform-scaling-label`,uniformChartScalingCheckbox:`${$k}__uniform-scaling-checkbox`};function z4t(t){const e="metric";if(t==null)return e;const i=t.map,r=(i&&"portalItem"in i?i.portalItem?.portal:null)??Fe.getDefault();switch(r.user?.units??r.units){case e:return e;case"english":return"imperial"}return G7e(t.spatialReference)??e}const F4t={readOnly:!0,get(){return z4t(this.view)}};function Qke(t,e,i,r){let s=null,n=1e3;typeof e=="number"?(n=e,r=i):(s=e??null,n=i);const a=Pn(0);let o;const l=()=>{a.value=0,t.apply(r,o)},c=(...h)=>{s&&s.apply(r,h),o=h,n?a.value||(a.value=setTimeout(l,n)):l()};return c.remove=()=>{a.value&&(clearTimeout(a.value),a.value=0)},c.forceUpdate=()=>{a.value&&(clearTimeout(a.value),l())},c.hasPendingUpdates=()=>!!a.value,c}let Xke={noDataValue:-5e5,defaultQueryOptions:()=>({noDataValue:Xke.noDataValue,demResolution:"auto",maximumAutoTileRequests:150,ignoreInvisibleLayers:!0}),updateThrottleMillis:100,delayAfterPreviewMillis:500,defaultDemResolution:hi(10,"centimeters","meters"),densificationMaxSamples:3e3,largeChartSamples:1e4,maxTotalSamples:1e5,maxChartRatio:300,minSlopeSampleDistance:10,formatPrecision:1,profileLinesStyle3D:{width:3,falloff:0,innerWidth:0,innerColor:fi(0,0,0,0),renderOccluded:16},profileLinesUpdateThrottleMillis:100,hoveredPointsStyle:{size:14,borderStyle:"solid",borderWidth:3,borderColor:"#ffffff",boxShadow:"0px 0px 0px 5px rgba(255,255,255,0.2)"}};function yp(){return Xke}const N4t="  ",V4t={progress:1,hasZ:!1,samples:[],statistics:null,spatialReference:null};function Jke(t){if(!t)return null;const e=t.wkid;if(e)return _Ye[e];const i=t.wkt2??t.wkt;return i?U4t(i):null}function U4t(t){const e=gYe.exec(t);if(!e||e.length!==2)return null;const i=e[1].split(",");if(!i||i.length<3)return null;const r=parseFloat(i[1]),s=parseFloat(i[2]);return isNaN(r)||isNaN(s)?null:{a:r,f:s===0?0:1/s}}function iB(t){const e=Jke(t);if(B4t(e))return e;const i=e.a*(1-e.f);return Object.assign(e,{b:i,eSq:1-(i/e.a)**2,radius:(2*e.a+i)/3,densificationRatio:1e4/((2*e.a+i)/3)})}function B4t(t){return t!=null&&"b"in t&&"eSq"in t&&"radius"in t}function Mk(t,e,i){const{a:r,eSq:s}=iB(i),n=Math.sqrt(s),a=Math.sin(e[1]*Il),o=r*e[0]*Il;let l;return s>0?l=r*((1-s)*(a/(1-s*(a*a))-1/(2*n)*Math.log((1-n*a)/(1+n*a))))*.5:l=r*a,t[0]=o,t[1]=l,t}function b2(t){return Uv(t)&&!!Jke(t)}function j4t(t,e="square-meters"){if(t.some(a=>!b2(a.spatialReference)))throw new ee("geodesic-areas:invalid-spatial-reference","the input geometries spatial reference is not supported");const i=[];for(let a=0;a<t.length;a++){const o=t[a],l=o.spatialReference,{radius:c,densificationRatio:h}=iB(l),f=c*h;i.push(q4t(o,f))}const r=[],s=[0,0],n=[0,0];for(let a=0;a<i.length;a++){const{rings:o,spatialReference:l}=i[a];let c=0;for(let h=0;h<o.length;h++){const f=o[h];Mk(s,f[0],l),Mk(n,f[f.length-1],l);let y=n[0]*s[1]-s[0]*n[1];for(let _=0;_<f.length-1;_++)Mk(s,f[_+1],l),Mk(n,f[_],l),y+=n[0]*s[1]-s[0]*n[1];c+=y}c=hi(c,"square-meters",e),r.push(c/-2)}return r}function Kke(t,e="meters"){if(!t)throw new ee("geodesic-lengths:invalid-geometries","the input geometries type is not supported");if(t.some(r=>!b2(r.spatialReference)))throw new ee("geodesic-lengths:invalid-spatial-reference","the input geometries spatial reference is not supported");const i=[];for(let r=0;r<t.length;r++){const s=t[r],{spatialReference:n}=s,a=s.type==="polyline"?s.paths:s.rings;let o=0;for(let l=0;l<a.length;l++){const c=a[l];let h=0;for(let f=1;f<c.length;f++){const y=c[f-1][0],_=c[f][0],w=c[f-1][1],x=c[f][1];if(w!==x||y!==_){const S=new z4;RM(S,[y,w],[_,x],n),h+=S.distance}}o+=h}o=hi(o,"meters",e),i.push(o)}return i}function q4t(t,e){if(t.type!=="polyline"&&t.type!=="polygon")throw new ee("geodesic-densify:invalid-geometry","the input geometry is neither polyline nor polygon");const{spatialReference:i}=t;if(!b2(i))throw new ee("geodesic-densify:invalid-spatial-reference","the input geometry spatial reference is not supported");const r=t.type==="polyline"?t.paths:t.rings,s=[],n=[0,0],a=new z4;for(const l of r){const c=[];s.push(c),c.push([l[0][0],l[0][1]]);let h,f,y=l[0][0],_=l[0][1];for(let w=0;w<l.length-1;w++){if(h=l[w+1][0],f=l[w+1][1],y===h&&_===f)continue;const x=[y,_];RM(a,[y,_],[h,f],i);const{azimuth:S,distance:$}=a,A=$/e;if(A>1){for(let M=1;M<=A-1;M++)Q_(n,x,S,M*e,i),c.push(n.slice());Q_(n,x,S,($+Math.floor(A-1)*e)/2,i),c.push(n.slice())}Q_(n,x,S,$,i),c.push(n.slice()),y=n[0],_=n[1]}}const o=qD(Ie,i);return t.type==="polyline"?new Ps({paths:s,spatialReference:o}):new os({rings:s,spatialReference:o})}let z4=class{constructor(e=0,i=void 0,r=void 0){this.distance=e,this.azimuth=i,this.reverseAzimuth=r}};function Q_(t,e,i,r,s){const n=e[0],a=e[1],o=n*Il,l=a*Il,c=(i??0)*Il,{a:h,b:f,f:y}=iB(s),_=Math.sin(c),w=Math.cos(c),x=(1-y)*Math.tan(l),S=1/Math.sqrt(1+x*x),$=x*S,A=Math.atan2(x,w),M=S*_,P=M*M,O=1-P,D=O*(h*h-f*f)/(f*f),L=1+D/16384*(4096+D*(D*(320-175*D)-768)),F=D/1024*(256+D*(D*(74-47*D)-128));let U,N,j,B=r/(f*L),Y=2*Math.PI;for(;Math.abs(B-Y)>1e-12;)j=Math.cos(2*A+B),U=Math.sin(B),N=Math.cos(B),Y=B,B=r/(f*L)+F*U*(j+F/4*(N*(2*j*j-1)-F/6*j*(4*U*U-3)*(4*j*j-3)));const G=$*U-S*N*w,Z=Math.atan2($*N+S*U*w,(1-y)*Math.sqrt(P+G*G)),H=y/16*O*(4+y*(4-3*O)),Q=Math.atan2(U*_,S*N-$*U*w)-(1-H)*y*M*(B+H*U*(j+H*N*(2*j*j-1)));return t[0]=(o+Q)/Il,t[1]=Z/Il,t}function RM(t,e,i,r){const s=e[0]*Il,n=e[1]*Il,a=i[0]*Il,o=i[1]*Il,{a:l,b:c,f:h,radius:f}=iB(r),y=a-s,_=Math.atan((1-h)*Math.tan(n)),w=Math.atan((1-h)*Math.tan(o)),x=Math.sin(_),S=Math.cos(_),$=Math.sin(w),A=Math.cos(w);let M,P,O,D,L,F,U,N,j,B,Y=1e3,G=y;do{if(U=Math.sin(G),N=Math.cos(G),O=Math.sqrt(A*U*(A*U)+(S*$-x*A*N)*(S*$-x*A*N)),O===0)return t.distance=0,t.azimuth=void 0,t.reverseAzimuth=void 0,t;L=x*$+S*A*N,F=Math.atan2(O,L),j=S*A*U/O,P=1-j*j,D=L-2*x*$/P,isNaN(D)&&(D=0),B=h/16*P*(4+h*(4-3*P)),M=G,G=y+(1-B)*h*j*(F+B*O*(D+B*L*(2*D*D-1)))}while(Math.abs(G-M)>1e-12&&--Y>0);if(Y===0){const De=f,q=Math.acos(Math.sin(n)*Math.sin(o)+Math.cos(n)*Math.cos(o)*Math.cos(a-s))*De,ne=a-s,ce=Math.sin(ne)*Math.cos(o),be=Math.cos(n)*Math.sin(o)-Math.sin(n)*Math.cos(o)*Math.cos(ne),ze=Math.atan2(ce,be);return t.azimuth=ze/Il,t.distance=q,t.reverseAzimuth=void 0,t}const Z=P*(l*l-c*c)/(c*c),H=Z/1024*(256+Z*(Z*(74-47*Z)-128)),Q=c*(1+Z/16384*(4096+Z*(Z*(320-175*Z)-768)))*(F-H*O*(D+H/4*(L*(2*D*D-1)-H/6*D*(4*O*O-3)*(4*D*D-3)))),X=Math.atan2(A*Math.sin(G),S*$-x*A*Math.cos(G)),ye=Math.atan2(S*Math.sin(G),S*$*Math.cos(G)-x*A);return t.azimuth=X/Il,t.distance=Q,t.reverseAzimuth=ye/Il,t}function xni(t){return b2(t)?t:Fu(t)?Ie.WGS84:null}const eze="ProfileGenerationError";let b$=class extends Error{constructor(e){super("profile could not be generated",{cause:e}),this.type=eze}};function G4t(t){return t.type===eze}async function H4t(t,e,i,r,s,n,a){let o,l,c;const h=t.spatialReference,f=h.isGeographic||h.isWebMercator;let y=0;if(!f){const{execute:w}=await te(()=>import("./lengthOperator-xl-ca8hZ.js").then(x=>x.l),__vite__mapDeps([384,328,331,330,332,64,333,335,334]));st(a),y=w(t,{unit:"meters"}),st(a)}const _=1/Wr(r);if(f){await wp([{source:h,dest:r},{source:h,dest:Ie.WGS84}],a);const w=rIt(t);o=Kke([w],"meters")[0];const x=r1e(o,s);if(a1e(t,o,x)>n)throw new b$("too-complex");const S=s1e(w,e,i);({densifiedPath:l,distances:c}=Q4t(S,x,_)),l=zo(l,r)}else{await wp([{source:h,dest:r}],a),o=y;const w=r1e(o,s);if(a1e(t,o,w)>n)throw new b$("too-complex");const x=s1e(t,e,i);({densifiedPath:l,distances:c}=Y4t(x,w,_)),st(a),l=zo(l,r)}return{densifiedPath:l,pathLength:o*_,distances:c}}function r1e(t,e){const i=t/e.densificationMaxSamples;return Math.max(e.samplingDistance,i)}function s1e(t,e,i){if(e==null)return n1e(t);const r=t.spatialReference,s=e.mode,n=U8(e,r);let a=null;switch(i.type){case"2d":a=W4t(t,s,n);break;case"3d":a=Z4t(t,s,n,i)}return a==null?n1e(t):new Ps({hasZ:!0,hasM:!1,spatialReference:r,paths:tze(t.paths,a)})}function W4t({hasZ:t},e,i){return e==="absolute-height"?t?([r,s,n])=>[r,s,n+i]:([r,s])=>[r,s,i]:null}function Z4t({spatialReference:t,hasZ:e},i,r,{elevationProvider:s}){const n=(a,o,l,c)=>s?.getElevation(a,o,l,t,c)??0;switch(i){case"on-the-ground":return([a,o])=>[a,o,n(a,o,0,"ground")];case"absolute-height":return e?([a,o,l])=>[a,o,l+r]:([a,o])=>[a,o,r];case"relative-to-ground":return e?([a,o,l])=>[a,o,l+n(a,o,l,"ground")+r]:([a,o])=>[a,o,n(a,o,0,"ground")+r];case"relative-to-scene":return e?([a,o,l])=>[a,o,l+n(a,o,l,"scene")+r]:([a,o])=>[a,o,n(a,o,0,"scene")+r];default:return null}}function n1e(t){return t.hasZ?new Ps({hasZ:!1,hasM:!1,spatialReference:t.spatialReference,paths:tze(t.paths,([e,i])=>[e,i])}):t}function tze(t,e){const i=t.length,r=new Array(i);for(let s=0;s<i;++s){const n=t[s],a=n.length,o=new Array(n.length);r[s]=o;for(let l=0;l<a;++l)o[l]=e(n[l])}return r}function qse(t){return F4(t)&&t.paths.length>0&&t.paths.every(e=>e.length>=2)}function F4(t){return t!=null&&t.type==="polyline"}function ize(t,e,i,r,s){const{spatialReference:n,hasZ:a}=t,o={from:null,to:null,distance:0,azimuth:0,reverseAzimuth:0,spatialReference:n,metersPerSR:Wr(n)},l=[],c=[];let h=0;for(let f=0;f<t.paths.length;++f){const y=t.paths[f],_=new Array,w=new Array;let x=0;for(let S=1;S<y.length;++S){const $=y[S-1],A=y[S],M=r(o,$,A);let P;for(P=x;P<M.distance&&!jje(P,M.distance);P+=e)_.push(s(M,P)),w.push((h+P)*i);x=P-M.distance,h+=M.distance,_.push(A),w.push(h*i)}l[f]=_,c[f]=w}return{densifiedPath:new Ps({spatialReference:n,hasZ:a,paths:l}),distances:c}}function Y4t(t,e,i){const{hasZ:r}=t;return ize(t,e,i,J4t,r?iIt:tIt)}function Q4t(t,e,i){const{hasZ:r}=t;return ize(t,e,i,X4t,r?eIt:K4t)}function X4t(t,e,i){return t.distance=0,RM(t,e,i,t.spatialReference),t.from=e,t.to=i,t}function J4t(t,e,i){return t.from=e,t.to=i,t.distance=Zf(i,e)*t.metersPerSR,t}function K4t({from:t,azimuth:e,spatialReference:i},r){return Q_([0,0],t,e,r,i)}function eIt({from:t,to:e,azimuth:i,distance:r,spatialReference:s},n){const a=n/r,o=[0,0,ft(t[2],e[2],a)];return Q_(o,t,i,n,s),o}function tIt({from:t,to:e,distance:i},r){return Ec([0,0],t,e,r/i)}function iIt({from:t,to:e,distance:i},r){return Wi([0,0,0],t,e,r/i)}function rIt(t){return b2(t.spatialReference)?t:zo(t,Ie.WGS84)}function rze(t){return t.paths.reduce((e,i)=>e+i.length,0)}function a1e(t,e,i){return rze(t)+Math.floor(e/i)+Math.max(0,t.paths.reduce(r=>1+r,0)-1)}function sIt(t,e){const i=t.length;if(i===0)return null;const r=t[0],s=r.sampledZ;let n=s,a=s,o=0,l=0,c=null,h=null,f=s??0,y=0,_=0,w=s!=null?1:0,x=0,S=0;const $=Wr(e),A=_p(e),M=yp().minSlopeSampleDistance/$,P=2*M,O=new o1e,D=new o1e,L=()=>{U(),O.copy(D),D.reset()},F=(N,j)=>{L(),N>0&&N-O.start<=P&&(N=O.start+M),D.restart(N,j)},U=()=>{if(O.isHole||D.isHole)return;const N=D.avgElevation-O.avgElevation,j=D.start-O.start,B=N*A,Y=j*$,G=hi(Math.atan2(B,Y),"radians","degrees");G>0?(y+=G,c=Hg(c,G),x++):G<0&&(_-=G,h=Hg(h,-G),S++)};r.sampledZ!=null&&F(r.distance,r.sampledZ);for(let N=1;N<i;++N){const j=t[N-1],B=t[N],Y=B.sampledZ;if(Y==null){D.isHole||L();continue}w++,f+=Y,n=Gse(n,Y),a=Hg(a,Y),D.isHole||B.distance-D.start>=M?F(B.distance,Y):D.insert(Y);const G=j.sampledZ;if(G!=null){const Z=Y-G;Z>0?o+=Z:Z<0&&(l-=Z)}}return L(),w===0?null:{maxDistance:t[i-1].distance,minElevation:n,maxElevation:a,avgElevation:w===0?null:f/w,elevationGain:o,elevationLoss:l,maxPositiveSlope:c,maxNegativeSlope:h,avgPositiveSlope:x===0?null:y/x,avgNegativeSlope:S===0?null:_/S}}function nIt(t){const e=t.filter(qf),i=e.length;if(i===0)return null;const r=e[0];if(i===1)return r;let s=r.maxDistance,n=r.minElevation,a=r.maxElevation,o=r.maxPositiveSlope,l=r.maxNegativeSlope;for(let c=1;c<e.length;++c){const h=e[c];s=Hg(s,h.maxDistance),n=Gse(n,h.minElevation),a=Hg(a,h.maxElevation),o=Hg(o,h.maxPositiveSlope),l=Hg(l,h.maxNegativeSlope)}return{maxDistance:s,minElevation:n,maxElevation:a,avgElevation:null,elevationGain:null,elevationLoss:null,maxPositiveSlope:o,maxNegativeSlope:l,avgPositiveSlope:null,avgNegativeSlope:null}}function aIt(t){let e=null,i=null,r=null;for(const s of t){if(s==null)continue;const{statistics:n,spatialReference:a}=s;if(n==null)continue;const o=Wr(a);e=Hg(e,$H(n.maxDistance,o));const l=_p(a);r=Gse(r,$H(n.minElevation,l)),i=Hg(i,$H(n.maxElevation,l))}return{minDistance:0,maxDistance:e??0,minElevation:r??0,maxElevation:i??0}}function Gse(t,e){return e==null?t:t!=null?Math.min(t,e):e}function Hg(t,e){return e==null?t:t!=null?Math.max(t,e):e}function $H(t,e){return t!=null&&e!=null?t*e:null}let o1e=class{constructor(){this._start=0,this._totalElevation=0,this._sampleCount=0}get avgElevation(){return this._totalElevation/this._sampleCount}get isHole(){return this._sampleCount===0}get start(){return this._start}copy(e){this._start=e._start,this._sampleCount=e._sampleCount,this._totalElevation=e._totalElevation}reset(){this._start=0,this._sampleCount=0,this._totalElevation=0}restart(e,i){this._start=e,this._sampleCount=1,this._totalElevation=i}insert(e){++this._sampleCount,this._totalElevation+=e}};function oIt(t,e,i=[]){if(t>=e||(i.push(t),e-t<2))return i;const r=e-1;i.push(r);const s=AJ(t+1,r);for(;;){const n=s.next();if(n.done)break;i.push(n.value)}return i}function*AJ(t,e){if(t>=e)return;const i=t+Math.floor((e-t)/2);yield i;const r=AJ(t,i),s=AJ(i+1,e);for(;;){const n=r.next(),a=s.next();if(n.done&&a.done)break;n.done||(yield n.value),a.done||(yield a.value)}}async function*lIt(t,e){const{view:i,geometry:r,elevationInfo:s,providers:n,options:a}=t,o=i.spatialReference;if(!o||r==null||!qse(r))throw new b$("invalid-geometry");const l=n.length;if(l===0)return null;const c=Math.round(a.maxTotalSamples/l);if(rze(r)>c)throw new b$("too-complex");const h=await H4t(r,s,i,o,a,c,e);let f=0;const y=new Array(l),_=new Array(l);for(let S=0;S<l;S++){const $=fIt(h);y[S]=$,f+=$.samples.length;const A={...t,provider:n[S],result:$,densificationResult:h};_[S]=cIt(A,e)[Symbol.iterator]()}if(f>a.maxTotalSamples)throw new b$("too-complex");const w=await Promise.all(_.map(S=>{const $=S.next();return $.done===!0?Promise.resolve(null):$.value}));st(e);for(let S=0;S<l;S++)y[S]=w[S];yield y,await iU(t.delayAfterPreview??yp().delayAfterPreviewMillis,null,e.signal);const x=[];try{let S;do{S=!1;for(let $=0;$<l;$++){const A=_[$].next();A.done===!1&&(x.push({resultPromise:A.value,index:$}),S=!0)}}while(S)}finally{_.forEach(S=>S.return?.())}for(const{resultPromise:S,index:$}of x)y[$]=await S,st(e),yield y;for(const S of y)S!=null&&(S.progress=1);yield y}function*cIt(t,e){const{densificationResult:i}=t,r={...t,abortOptions:e,densificationResult:i},s=oIt(0,r.result.samples.length),n=s.slice(0,r.provider.numSamplesForPreview);yield l1e(r,n,!0);const a=S8e(s,r.provider.numSamplesPerChunk);for(const o of a)yield l1e(r,o,!1)}async function l1e({densificationResult:t,result:e,provider:i,queue:r,abortOptions:s,cache:n},a,o){const{densifiedPath:l,pathLength:c}=t,h=e.spatialReference,{samples:f}=e,y=[];for(let _=0;_<a.length;_++){const w=f[a[_]];y[_]=[...w.coordinate]}try{return await r.push({geometry:new Po({spatialReference:h,points:y,hasZ:l.hasZ}),provider:i,indices:a,preview:o,result:e,queryOptions:{...yp().defaultQueryOptions(),minDemResolution:Math.round(o?c/i.numSamplesForPreview:c/f.length),cache:n}},s),{...e}}catch(_){return Hr(_)?null:V4t}}function uIt(t){return new u5e({priority:yt.ELEVATION_PROFILE,concurrency:1,scheduler:t,process:async e=>{st(e.queryOptions);try{await hIt(e)}catch(i){KH(i)}}})}async function hIt({geometry:t,provider:e,indices:i,preview:r,result:s,queryOptions:n}){if(i.length===0)return;const a=(await yIt(e,t,n)).geometry,{hasZ:o,points:l}=a,c=n.noDataValue,{samples:h}=s;for(let f=0;f<i.length;f++){const y=h[i[f]];if(y.isHole)continue;const _=o?l[f][2]:null;_===null||_===c?y.sampledZ=null:(s.hasZ=!0,y.sampledZ=_),y.sampled=!0}dIt(h),s.progress=r?0:s.progress+i.length/h.length,s.statistics=sIt(s.samples,s.spatialReference)}function dIt(t){const e=t.length-1;let i=0;for(let r=1;r<=e;r++)(t[r].sampled||r===e)&&(pIt(t,i,r),i=r)}function pIt(t,e,i){if(i-e===1)return;const r=t[e],s=r.sampledZ,n=t[i],a=n.sampledZ;if(s==null||a==null){for(let c=e+1;c<i;c++)t[c].sampledZ=null;return}const o=r.distance,l=n.distance-o;for(let c=e+1;c<i;c++){const h=t[c],f=(h.distance-o)/l;h.sampledZ=ft(s,a,f)}}function fIt({densifiedPath:t,distances:e}){const i=t.spatialReference,r=Ru(i),s=t.paths,n=s.length,a=[];let o=null,l=0;for(let c=0;c<n;c++){const h=s[c],f=h.length,y=e[c];for(let _=0;_<f;_++){const w=h[_],x=y[_];r&&(w[0]=Y2e(w[0],r.valid[0],r.valid[1])),o&&_===0&&mIt(a,o,w,l,x),a.push(gIt(w,x)),o=w,l=x}}return{progress:0,samples:a,hasZ:!1,statistics:null,spatialReference:i}}function mIt(t,e,i,r,s){t.push(c1e(e,r)),t.push(c1e(i,s))}function gIt(t,e){return{coordinate:t,distance:e,sampledZ:null,sampled:!1,isHole:!1}}function c1e(t,e){return{coordinate:t,distance:e,sampledZ:null,sampled:!0,isHole:!0}}async function yIt(t,e,i){try{return await t.queryElevation(e,i)}catch{throw new b$("elevation-query-error")}}function _It(t,e,i){if(!t||t.length===0)return;const r=t.length-1,s=t[0];if(e<=i(s))return s;const n=t[r];if(e>=i(n))return n;let a=0,o=0,l=r;for(;a<l;){o=a+Math.floor((l-a)/2);const c=t[o],h=i(c);if(h===e)return c;if(e<h){if(o>0){const f=t[o-1],y=i(f);if(e>y)return e-y>=h-e?c:f}l=o}else{if(o<r){const f=t[o+1],y=i(f);if(e<y)return e-h>=y-e?f:c}a=o+1}}return t[o]}const u1e=Symbol("line-change");let s_=class extends Me{constructor(e){super(e),this._updateTask=null,this._paramsPerProfile=new Map,this._getUpdateParametersMemoized=qh((i,r,s)=>({stationary:i,visibleProfiles:r,generationParameters:s})),this._getGenerationParametersMemoized=qh((i,r,s,n,a,o,l)=>F4(r)&&qse(r)&&n!=null?{view:i,geometry:r,elevationInfo:s,options:o,queue:n,cache:a,slicePlane:l}:null),this._getElevationInfoMemoized=qh((i,r)=>({mode:i,offset:r})),this._getOptionsMemoized=qh((i,r)=>{const{densificationMaxSamples:s,maxTotalSamples:n}=yp();return{samplingDistance:i,densificationMaxSamples:Math.round(s/r),maxTotalSamples:n}}),this._updateThrottled=Qke(i=>this._update(i),yp().updateThrottleMillis)}initialize(){const e=this.viewModel;this.addHandles([K(()=>({visible:e.visible,profiles:e.profiles.toArray()}),({visible:i,profiles:r})=>{this._abortUpdate(),this._paramsPerProfile.clear(),this.removeHandles(u1e),i&&r.length!==0&&this.addHandles([...r.map(s=>qu([s.attach(this.viewModel),s.on("change",()=>{this._invalidateProfile(s)})])),K(()=>this._updateParameters,this._updateThrottled,At),this._updateThrottled],u1e)},At)])}destroy(){this._paramsPerProfile.clear()}get _updateParameters(){const{viewModel:e}=this,i=e.view;return this._getUpdateParametersMemoized(i==null||i.stationary,this.viewModel.visibleProfiles,this._generationParameters)}get _generationParameters(){const{view:e,input:i,queue:r,tileCache:s}=this.viewModel;return e!=null&&e.ready?this._getGenerationParametersMemoized(e,i?.geometry,this._elevationInfo,r,s,this._options,e.type==="3d"?e.slice.plane:null):null}get _elevationInfo(){const e=this.viewModel.input,i=e?Rbt(e)?null:Dre(e):null;return i!=null?this._getElevationInfoMemoized(i.mode,i.offset):null}get _options(){const e=this.viewModel,i=e.visibleProfiles.length;let r=e.minDemResolution??yp().defaultDemResolution;return r=parseFloat(r.toFixed(2)),this._getOptionsMemoized(r,i)}_update({stationary:e,visibleProfiles:i,generationParameters:r}){this._abortUpdate(),e&&(r!=null?this._updateTask=Bc(async s=>{this.viewModel.error=null;const n=i.filter(o=>!this._isProfileValid(o,r)),a=lIt({...r,providers:n},{signal:s});try{for await(const o of a){st(s),this._clearInvalidResults(r);for(let l=0;l<n.length;l++)n[l].result=o[l]}for(const o of n)this._paramsPerProfile.set(o,r)}catch(o){My(o),this._abortUpdate(),this.viewModel.error=o,n.forEach(l=>{l.result=null})}}):this._clearResults())}_abortUpdate(){this._updateTask=ps(this._updateTask)}_isProfileValid(e,i){return this._paramsPerProfile.has(e)&&this._paramsPerProfile.get(e)===i}_invalidateProfile(e){this._paramsPerProfile.delete(e),this._updateThrottled(this._updateParameters)}_clearInvalidResults(e){for(const i of this.viewModel.profiles.items)this._isProfileValid(i,e)||(i.result=null,this._paramsPerProfile.delete(i))}_clearResults(){for(const e of this.viewModel.profiles.items)e.result=null,this._paramsPerProfile.delete(e)}};d([m({nonNullable:!0})],s_.prototype,"viewModel",void 0),d([m()],s_.prototype,"_updateParameters",null),d([m()],s_.prototype,"_generationParameters",null),d([m()],s_.prototype,"_elevationInfo",null),d([m()],s_.prototype,"_options",null),s_=d([k("esri.widgets.ElevationProfile.ElevationProfileController")],s_);function vIt(t,e){if(t==null||e==null)return null;const{samples:i,spatialReference:r}=t,{distance:s,elevation:n}=e,a=Wr(r),o=_p(r),l=i.length,c=new Array(l);for(let h=0;h<l;++h){const f=i[h],y=f.sampledZ,_=f.coordinate;c[h]={x:_[0],y:_[1],z:y,distance:sze(f.distance,a,s),elevation:e3(y,o,n)}}return c}function bIt(t,e){if(t==null||e==null||t.statistics==null||t.spatialReference==null)return null;const{distance:i,elevation:r}=e,{statistics:s,spatialReference:n}=t,a=Wr(n),o=_p(n);return{maxDistance:sze(s.maxDistance,a,i),minElevation:e3(s.minElevation,o,r),maxElevation:e3(s.maxElevation,o,r),avgElevation:e3(s.avgElevation,o,r),elevationGain:e3(s.elevationGain,o,r),elevationLoss:e3(s.elevationLoss,o,r),maxPositiveSlope:s.maxPositiveSlope,maxNegativeSlope:s.maxNegativeSlope,avgPositiveSlope:s.avgPositiveSlope,avgNegativeSlope:s.avgNegativeSlope}}function sze(t,e,i){return t==null?null:hi(t*e,"meters",i)}function e3(t,e,i){return t==null?null:hi(t*e,"meters",i)}let cn=class extends Uc{constructor(e){super(e),this.type=null,this.id=u2(),this.title=null,this.color=new mt("#000000"),this.visible=!0,this._getSamplesMemoized=qh((i,r)=>vIt(i,r)),this._getStatisticsMemoized=qh((i,r)=>bIt(i,r)),this.viewVisualizationEnabled=!0,this.result=null,this.effectiveUnits=null,this.numSamplesForPreview=30,this.numSamplesPerChunk=200,this.chartFillEnabled=!0,this.chartStrokeWidth=1.5,this.chartStrokeOffsetY=0,this._viewModel=null}get progress(){return this.result!=null&&this.visible?this.result.progress:0}get samples(){return this._getSamplesMemoized(this.result,this.effectiveUnits)}get statistics(){return this._getStatisticsMemoized(this.result,this.effectiveUnits)}get hoveredPoint(){const e=this._viewModel?.hoveredChartPosition;return e!=null?this._getPoint(e):null}get available(){return!0}get hasZ(){const e=this.result;return e!=null&&e.hasZ}get minDemResolution(){return yp().defaultDemResolution}queryElevation(){throw new Error("not implemented")}attach(e){return this._viewModel=e,qu([K(()=>e.effectiveUnits,i=>{this.effectiveUnits=i},At),K(()=>[e.input],()=>this._onChange(),Yt)])}toggleVisibility(e){this.visible=e===void 0?!this.visible:e}_onChange(){this.emit("change")}_getPoint(e){const{samples:i,result:r}=this;if(i==null||r==null)return null;const s=i.length;if(s===0)return null;const n=i[s-1].distance,a=_It(i,e*n,h=>h.distance);if(a==null)return null;const{x:o,y:l,z:c}=a;return c==null?null:new Qe({x:o,y:l,z:c,spatialReference:r.spatialReference})}};d([m({nonNullable:!0})],cn.prototype,"id",void 0),d([m()],cn.prototype,"title",void 0),d([m({type:mt,nonNullable:!0})],cn.prototype,"color",void 0),d([m({nonNullable:!0})],cn.prototype,"visible",void 0),d([m({readOnly:!0})],cn.prototype,"progress",null),d([m({readOnly:!0})],cn.prototype,"samples",null),d([m({readOnly:!0})],cn.prototype,"statistics",null),d([m()],cn.prototype,"hoveredPoint",null),d([m()],cn.prototype,"viewVisualizationEnabled",void 0),d([m()],cn.prototype,"available",null),d([m()],cn.prototype,"result",void 0),d([m()],cn.prototype,"effectiveUnits",void 0),d([m()],cn.prototype,"numSamplesForPreview",void 0),d([m()],cn.prototype,"numSamplesPerChunk",void 0),d([m()],cn.prototype,"chartFillEnabled",void 0),d([m()],cn.prototype,"chartStrokeWidth",void 0),d([m()],cn.prototype,"chartStrokeOffsetY",void 0),d([m({readOnly:!0})],cn.prototype,"hasZ",null),d([m({readOnly:!0})],cn.prototype,"minDemResolution",null),d([m()],cn.prototype,"_viewModel",void 0),cn=d([k("esri.widgets.ElevationProfile.ElevationProfileLine")],cn);const N4=cn;function nze(t){if(t==null)return null;if(jet(t))return aze(t);const e=t.tileInfo;if(e==null)return null;const i=e.lods?.at(-1);return i==null?null:i.resolution*Wr(e.spatialReference)}function aze(t){if(t==null)return null;const e=t.layers.items.map(wIt).filter(qf);return Vbe(e)??null}function wIt(t){return t&&"tileInfo"in t?nze(t):null}let _f=class extends N4{constructor(e){super(e),this.type="ground",this.color=new mt("#ff7f00"),this.viewVisualizationEnabled=!0,this.numSamplesForPreview=50,this.numSamplesPerChunk=1e3,this._getQueryElevationDependencies=qh((i,r)=>({ground:i,groundLayers:r}))}get available(){const e=this._ground;return e!=null&&e.layers.some(i=>i.visible)}get minDemResolution(){return aze(this._ground)}get _queryElevationDependencies(){return this._getQueryElevationDependencies(this._ground,this._groundLayers)}get _ground(){return this._viewModel?.view?.map?.ground}get _groundLayers(){return this._ground?.layers?.toArray()??[]}async queryElevation(e,i){const r=this._queryElevationDependencies;if(r==null)throw new Error("ElevationProfileLineGround: no dependencies");const{ground:s}=r;if(s==null)throw new Error("No ground configured in the view");const n=await s.queryElevation(e,i),a=_p(e.spatialReference),o=_p(s.layers.at(0).spatialReference);if(a!==o){const l=n.geometry;l.points=l.points.map(([c,h,f])=>[c,h,f===i.noDataValue?f:f*o/a])}return n}attach(e){return qu([super.attach(e),K(()=>this._queryElevationDependencies,()=>this._onChange())])}};d([m({type:mt,nonNullable:!0})],_f.prototype,"color",void 0),d([m()],_f.prototype,"viewVisualizationEnabled",void 0),d([m()],_f.prototype,"available",null),d([m({readOnly:!0})],_f.prototype,"minDemResolution",null),d([m()],_f.prototype,"_queryElevationDependencies",null),d([m()],_f.prototype,"_ground",null),d([m()],_f.prototype,"_groundLayers",null),_f=d([k("esri.widgets.ElevationProfile.ElevationProfileLineGround")],_f);const oze=_f;let fg=class extends N4{constructor(e){super(e),this.type="input",this.color=new mt("#00c8c8"),this.viewVisualizationEnabled=!1,this.numSamplesForPreview=50,this.numSamplesPerChunk=500,this.chartFillEnabled=!1,this.chartStrokeOffsetY=-1,this._getQueryElevationDependencies=qh((i,r,s,n,a)=>i?{elevationInfo:i,visibleLayers:r,view:s,stationary:n,spatialReference:a}:null)}get queryElevationDependencies(){const e=this._viewModel?.view;return e==null?null:this._getQueryElevationDependencies(this._elevationInfo,this._visibleLayers,e,e.stationary,e.spatialReference)}get available(){return!this._viewModel?.inputIsSketched}get _elevationInfo(){const e=this._viewModel?.input;return e?Dre(e):null}get _visibleLayers(){return this._viewModel?.view?.map?.allLayers?.filter(e=>e.visible).toArray()??[]}async queryElevation(e,{noDataValue:i,signal:r}){const s=this.queryElevationDependencies;if(s==null)throw new Error("ElevationProfileLineInput: no dependencies");const{view:n,elevationInfo:a,spatialReference:o}=s;if(a.mode==="on-the-ground"&&n.type==="3d"&&o){const l=await ZC.fromGeometry(e).project(o,r);if(!l)return{geometry:e,noDataValue:i};const c=n.elevationProvider;return l.coordinates.forEach(h=>{h.z=c.getElevation(h.x,h.y,0,o,"ground")??0}),{geometry:l.export(),noDataValue:i}}return{geometry:e,noDataValue:i}}attach(e){const i=()=>this._onChange();return qu([super.attach(e),K(()=>this.queryElevationDependencies,i),Ys(()=>e.elevationProvider,"elevation-change",i,{onListenerAdd:i,onListenerRemove:i})])}};d([m({type:mt,nonNullable:!0})],fg.prototype,"color",void 0),d([m()],fg.prototype,"viewVisualizationEnabled",void 0),d([m()],fg.prototype,"queryElevationDependencies",null),d([m()],fg.prototype,"available",null),d([m()],fg.prototype,"_elevationInfo",null),d([m()],fg.prototype,"_visibleLayers",null),fg=d([k("esri.widgets.ElevationProfile.ElevationProfileLineInput")],fg);const xIt=fg;let n_=class extends N4{constructor(e){super(e),this.type="query",this.color=new mt("#db334a"),this.viewVisualizationEnabled=!0,this.source=null,this.numSamplesForPreview=50,this.numSamplesPerChunk=500}get minDemResolution(){return nze(this.source)}get available(){const e=this.source;return!!e&&(e.visible==null||e.visible)&&(e.layers==null||e.layers.some(i=>i.visible))}queryElevation(e,i){if(!this.source)throw new Error("No source configured for the elevation profile line");return this.source.queryElevation(e,i)}attach(e){return qu([super.attach(e),K(()=>this.source,()=>this._onChange(),Yt)])}};d([m({type:mt,nonNullable:!0})],n_.prototype,"color",void 0),d([m()],n_.prototype,"viewVisualizationEnabled",void 0),d([m()],n_.prototype,"source",void 0),d([m({readOnly:!0})],n_.prototype,"minDemResolution",null),d([m()],n_.prototype,"available",null),n_=d([k("esri.widgets.ElevationProfile.ElevationProfileLineQuery")],n_);const SIt=n_,TIt=2e5;let Ml=class extends N4{constructor(e){super(e),this.type="view",this.color=new mt("#cf4ccf"),this.viewVisualizationEnabled=!0,this.include=null,this.exclude=null,this.numSamplesForPreview=50,this.numSamplesPerChunk=25,this._getQueryElevationDependencies=qh((i,r,s,n,a,o,l)=>({inputGraphicUid:i!=null?lze(i):null,visibleLayers:r,maxIntersectionDistance:s,intersectOptions:n,view:a,stationary:o,spatialReference:l})),this._vecA=R(),this._vecB=R(),this._ray=rn()}get minDemResolution(){const e=this._viewModel?.view;if(e==null||e.type!=="3d")return null;const i=e.pointsOfInterest?.focus?.worldUnitsPerContentPixel;return i==null?null:i*_p(e.spatialReference)}get queryElevationDependencies(){const e=this._view;return e?this._getQueryElevationDependencies(this._viewModel?.input,this._visibleLayers,this._maxIntersectionDistance,this._intersectOptions,e,e.stationary,e.spatialReference):null}get _visibleLayers(){return this._view?.map?.allLayers?.filter(e=>e.visible).toArray()??[]}get _intersectOptions(){const e=this._view;return e==null||e.destroyed?{}:Fre(e,{include:this.include,exclude:[...this._pointCloudLayers,...AN(this.exclude)?this.exclude:this.exclude?[this.exclude]:[]]})}get _pointCloudLayers(){const e=this._view;return e==null?[]:e.allLayerViews.toArray().filter(i=>i.layer?.type==="point-cloud").map(i=>i.layer)}get _view(){const e=this._viewModel?.view;return e!=null&&e.type==="3d"?e:null}get _maxIntersectionDistance(){const e=this._view;return e?.renderCoordsHelper?or(e.spatialReference).radius/e.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY}get _intersector(){const e=this._view;if(e==null)return null;const i=new Vc(e.state.viewingMode),r=i.options;return r.hud=!1,r.invisibleTerrain=!1,r.backfacesTerrain=!1,r.selectionMode=!1,r.store=2,i}async queryElevation(e,{noDataValue:i,signal:r}){const s=this.queryElevationDependencies;if(s==null)throw new Error("ElevationProfileLineInput: no dependencies");const n=this._intersector;if(n==null)throw new Error("ElevationProfileLineInput: no view");const{intersectOptions:a,view:o,spatialReference:l}=s,c=o.renderCoordsHelper,h=o.sceneIntersectionHelper,f=this._vecA,y=this._vecA,_=this._vecB,w=this._ray;if(!l)return{geometry:e,noDataValue:i};const x=await ZC.fromGeometry(e).project(l,r);if(!x)return{geometry:e,noDataValue:i};const S=x.coordinates,$=S.length;for(let A=0;A<$;++A){const M=S[A];ve(_,M.x,M.y,M.z??0),c.toRenderCoords(_,l,_),c.setAltitude(f,TIt,_);const P=Qee(f,_,w);h.computeIntersection(P,n,!0,a);const O=$It(s,n.results.all);O?(O.getIntersectionPoint(y),c.fromRenderCoords(y,y,l),M.z=y[2]):M.z=i}return{geometry:x.export(),noDataValue:i}}attach(e){const i=()=>this._onChange();return qu([super.attach(e),K(()=>this.queryElevationDependencies,i),Ys(()=>e.elevationProvider,"elevation-change",i,{onListenerAdd:i,onListenerRemove:i})])}};function $It({view:t,inputGraphicUid:e,maxIntersectionDistance:i},r){for(const s of r){if(!s.withinDistance(i))continue;const n=Gbt(s,t);if(n==null||lze(n)!==e)return s}return null}function lze(t){if(t.layer&&"objectIdField"in t.layer){const e=t.attributes[t.layer.objectIdField];if(e)return`o-${t.layer.id}-${e}`}return`u-${t.uid}`}d([m({type:mt,nonNullable:!0})],Ml.prototype,"color",void 0),d([m()],Ml.prototype,"viewVisualizationEnabled",void 0),d([m()],Ml.prototype,"include",void 0),d([m()],Ml.prototype,"exclude",void 0),d([m({readOnly:!0})],Ml.prototype,"minDemResolution",null),d([m()],Ml.prototype,"queryElevationDependencies",null),d([m()],Ml.prototype,"_visibleLayers",null),d([m()],Ml.prototype,"_intersectOptions",null),d([m()],Ml.prototype,"_pointCloudLayers",null),d([m()],Ml.prototype,"_view",null),d([m()],Ml.prototype,"_maxIntersectionDistance",null),d([m()],Ml.prototype,"_intersector",null),Ml=d([k("esri.widgets.ElevationProfile.ElevationProfileLineView")],Ml);const CIt=Ml,MIt={base:N4,key:"type",typeMap:{ground:oze,input:xIt,query:SIt,view:CIt},errorContext:"elevation-profile-line"},EIt=He.ofType(MIt),OJ=(t=>t)(["operational-layers","basemap-base-layers","basemap-ground-layers","ground"]);let h1e=class extends SyntaxError{constructor(e,i,r,s){super(e),this.expected=i,this.found=r,this.location=s,this.name="SyntaxError"}format(e){let i="Error: "+this.message;if(this.location){let r=null;const s=e.find(l=>l.source===this.location.source);s&&(r=s.text.split(/\r\n|\n|\r/g));const n=this.location.start,a=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(n):n,o=this.location.source+":"+a.line+":"+a.column;if(r){const l=this.location.end,c="".padEnd(a.line.toString().length," "),h=r[n.line-1],f=(n.line===l.line?l.column:h.length+1)-n.column||1;i+=`
 --> `+o+`
`+c+` |
`+a.line+" | "+h+`
`+c+" | "+"".padEnd(n.column-1," ")+"".padEnd(f,"^")}else i+=`
 at `+o}return i}static buildMessage(e,i){function r(y){return y.codePointAt(0).toString(16).toUpperCase()}const s=Object.prototype.hasOwnProperty.call(RegExp.prototype,"unicode")?new RegExp("[\\p{C}\\p{Mn}\\p{Mc}]","gu"):null;function n(y){return s?y.replace(s,_=>"\\u{"+r(_)+"}"):y}function a(y){return n(y.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,_=>"\\x0"+r(_)).replace(/[\x10-\x1F\x7F-\x9F]/g,_=>"\\x"+r(_)))}function o(y){return n(y.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,_=>"\\x0"+r(_)).replace(/[\x10-\x1F\x7F-\x9F]/g,_=>"\\x"+r(_)))}const l={literal:y=>'"'+a(y.text)+'"',class(y){const _=y.parts.map(w=>Array.isArray(w)?o(w[0])+"-"+o(w[1]):o(w));return"["+(y.inverted?"^":"")+_.join("")+"]"+(y.unicode?"u":"")},any:()=>"any character",end:()=>"end of input",other:y=>y.description};function c(y){return l[y.type](y)}function h(y){const _=y.map(c);if(_.sort(),_.length>0){let w=1;for(let x=1;x<_.length;x++)_[x-1]!==_[x]&&(_[w]=_[x],w++);_.length=w}switch(_.length){case 1:return _[0];case 2:return _[0]+" or "+_[1];default:return _.slice(0,-1).join(", ")+", or "+_[_.length-1]}}function f(y){return y?'"'+a(y)+'"':"end of input"}return"Expected "+h(e)+" but "+f(i)+" found."}};function AIt(t,e){const i={},r=(e=e!==void 0?e:{}).grammarSource,s={start:ad};let n=ad;const a="none",o=")",l=",",c="(",h="%",f="px",y="cm",_="mm",w="in",x="pt",S="pc",$="deg",A="rad",M="grad",P="turn",O="#",D=".",L="e",F=/^[ \t\n\r]/,U=/^[a-z\-]/,N=/^[0-9a-fA-F]/,j=/^[+\-]/,B=/^[0-9]/,Y=vi("none"),G=er("none",!1),Z=er(")",!1),H=er(",",!1),Q=ra([" ","	",`
`,"\r"],!1,!1,!1),X=vi("function"),ye=er("(",!1),De=vi("identifier"),q=ra([["a","z"],"-"],!1,!1,!1),ne=vi("percentage"),ce=er("%",!1),be=vi("length"),ze=er("px",!1),Ne=er("cm",!1),at=er("mm",!1),Tt=er("in",!1),et=er("pt",!1),It=er("pc",!1),$t=vi("angle"),Ct=er("deg",!1),jt=er("rad",!1),Ue=er("grad",!1),Ft=er("turn",!1),qe=vi("number"),je=vi("color"),gt=er("#",!1),ct=ra([["0","9"],["a","f"],["A","F"]],!1,!1,!1),Ot=ra(["+","-"],!1,!1,!1),Xe=ra([["0","9"]],!1,!1,!1),We=er(".",!1),Ye=er("e",!1);function rt(){return[]}function Zt(W,he){return{type:"function",name:W,parameters:he||[]}}function Li(W,he){return he.length>0?Ip(W,he,3):[W]}function Ci(W){return{type:"quantity",value:W.value,unit:W.unit}}function ei(W){return{type:"color",colorType:W.type,value:W.value}}function Gi(W){return W}function Ui(){return Ha()}function gi(W){return{value:W,unit:"%"}}function yi(W){return{value:W,unit:"px"}}function ti(W){return{value:W,unit:"cm"}}function wt(W){return{value:W,unit:"mm"}}function Nt(W){return{value:W,unit:"in"}}function Vt(W){return{value:W,unit:"pt"}}function Mi(W){return{value:W,unit:"pc"}}function Mr(W){return{value:W,unit:"deg"}}function Bi(W){return{value:W,unit:"rad"}}function Ei(W){return{value:W,unit:"grad"}}function Er(W){return{value:W,unit:"turn"}}function Fr(W){return{value:W,unit:null}}function gs(){return{type:"hex",value:Ha()}}function ia(W){return{type:"function",value:W}}function ln(){return{type:"named",value:Ha()}}function fo(){return parseFloat(Ha())}let ue=0|e.peg$currPos,ii=ue;const Jt=[{line:1,column:1}];let Nr,Hi=ue,Ss=e.peg$maxFailExpected||[],Je=0|e.peg$silentFails;if(e.startRule){if(!(e.startRule in s))throw new Error(`Can't start parsing from rule "`+e.startRule+'".');n=s[e.startRule]}function Ha(){return t.substring(ii,ue)}function mo(W=ue){const he=t.codePointAt(W);return he===void 0?"":String.fromCodePoint(he)}function er(W,he){return{type:"literal",text:W,ignoreCase:he}}function ra(W,he,Ve,Pt){return{type:"class",parts:W,inverted:he,ignoreCase:Ve,unicode:Pt}}function Rs(){return{type:"end"}}function vi(W){return{type:"other",description:W}}function Pa(W){let he,Ve=Jt[W];if(Ve)return Ve;if(W>=Jt.length)he=Jt.length-1;else for(he=W;!Jt[--he];);for(Ve=Jt[he],Ve={line:Ve.line,column:Ve.column};he<W;)t.charCodeAt(he)===10?(Ve.line++,Ve.column=1):Ve.column++,he++;return Jt[W]=Ve,Ve}function nd(W,he,Ve){const Pt=Pa(W),ki=Pa(he);return{source:r,start:{offset:W,line:Pt.line,column:Pt.column},end:{offset:he,line:ki.line,column:ki.column}}}function qt(W){ue<Hi||(ue>Hi&&(Hi=ue,Ss=[]),Ss.push(W))}function om(W,he,Ve){return new h1e(h1e.buildMessage(W,he),W,he,Ve)}function ad(){let W;return W=lm(),W===i&&(W=Rp()),W}function lm(){let W,he;return Je++,W=ue,ji(),t.substr(ue,4)===a?(he=a,ue+=4):(he=i,Je===0&&qt(G)),he!==i?(ji(),ii=W,W=rt()):(ue=W,W=i),Je--,W===i&&Je===0&&qt(Y),W}function Rp(){let W,he;if(W=[],he=Jl(),he!==i)for(;he!==i;)W.push(he),he=Jl();else W=i;return W}function Jl(){let W,he,Ve,Pt;return W=ue,ji(),he=Ra(),he!==i?(ji(),Ve=hl(),Ve===i&&(Ve=null),ji(),t.charCodeAt(ue)===41?(Pt=o,ue++):(Pt=i,Je===0&&qt(Z)),Pt!==i?(ji(),ii=W,W=Zt(he,Ve)):(ue=W,W=i)):(ue=W,W=i),W}function hl(){let W,he,Ve,Pt,ki,is,ys,In;if(W=ue,he=go(),he!==i){for(Ve=[],Pt=ue,ki=ji(),t.charCodeAt(ue)===44?(is=l,ue++):(is=i,Je===0&&qt(H)),is===i&&(is=null),ys=ji(),In=go(),In!==i?(ki=[ki,is,ys,In],Pt=ki):(ue=Pt,Pt=i);Pt!==i;)Ve.push(Pt),Pt=ue,ki=ji(),t.charCodeAt(ue)===44?(is=l,ue++):(is=i,Je===0&&qt(H)),is===i&&(is=null),ys=ji(),In=go(),In!==i?(ki=[ki,is,ys,In],Pt=ki):(ue=Pt,Pt=i);ii=W,W=Li(he,Ve)}else ue=W,W=i;return W}function go(){let W,he;return W=ue,he=Dn(),he===i&&(he=qc(),he===i&&(he=No(),he===i&&(he=dl()))),he!==i&&(ii=W,he=Ci(he)),W=he,W===i&&(W=ue,he=od(),he!==i&&(ii=W,he=ei(he)),W=he),W}function ji(){let W,he;for(Je++,W=[],he=t.charAt(ue),F.test(he)?ue++:(he=i,Je===0&&qt(Q));he!==i;)W.push(he),he=t.charAt(ue),F.test(he)?ue++:(he=i,Je===0&&qt(Q));return Je--,W}function Ra(){let W,he,Ve;return Je++,W=ue,he=Vr(),he!==i?(t.charCodeAt(ue)===40?(Ve=c,ue++):(Ve=i,Je===0&&qt(ye)),Ve!==i?(ii=W,W=he):(ue=W,W=i)):(ue=W,W=i),Je--,W===i&&(he=i,Je===0&&qt(X)),W}function Vr(){let W,he,Ve;if(Je++,W=ue,he=[],Ve=t.charAt(ue),U.test(Ve)?ue++:(Ve=i,Je===0&&qt(q)),Ve!==i)for(;Ve!==i;)he.push(Ve),Ve=t.charAt(ue),U.test(Ve)?ue++:(Ve=i,Je===0&&qt(q));else he=i;return he!==i&&(ii=W,he=Ui()),W=he,Je--,W===i&&(he=i,Je===0&&qt(De)),W}function Dn(){let W,he,Ve;return Je++,W=ue,ji(),he=sa(),he!==i?(t.charCodeAt(ue)===37?(Ve=h,ue++):(Ve=i,Je===0&&qt(ce)),Ve!==i?(ii=W,W=gi(he)):(ue=W,W=i)):(ue=W,W=i),Je--,W===i&&Je===0&&qt(ne),W}function qc(){let W,he,Ve;return Je++,W=ue,ji(),he=sa(),he!==i?(t.substr(ue,2)===f?(Ve=f,ue+=2):(Ve=i,Je===0&&qt(ze)),Ve!==i?(ii=W,W=yi(he)):(ue=W,W=i)):(ue=W,W=i),W===i&&(W=ue,ji(),he=sa(),he!==i?(t.substr(ue,2)===y?(Ve=y,ue+=2):(Ve=i,Je===0&&qt(Ne)),Ve!==i?(ii=W,W=ti(he)):(ue=W,W=i)):(ue=W,W=i),W===i&&(W=ue,ji(),he=sa(),he!==i?(t.substr(ue,2)===_?(Ve=_,ue+=2):(Ve=i,Je===0&&qt(at)),Ve!==i?(ii=W,W=wt(he)):(ue=W,W=i)):(ue=W,W=i),W===i&&(W=ue,ji(),he=sa(),he!==i?(t.substr(ue,2)===w?(Ve=w,ue+=2):(Ve=i,Je===0&&qt(Tt)),Ve!==i?(ii=W,W=Nt(he)):(ue=W,W=i)):(ue=W,W=i),W===i&&(W=ue,ji(),he=sa(),he!==i?(t.substr(ue,2)===x?(Ve=x,ue+=2):(Ve=i,Je===0&&qt(et)),Ve!==i?(ii=W,W=Vt(he)):(ue=W,W=i)):(ue=W,W=i),W===i&&(W=ue,ji(),he=sa(),he!==i?(t.substr(ue,2)===S?(Ve=S,ue+=2):(Ve=i,Je===0&&qt(It)),Ve!==i?(ii=W,W=Mi(he)):(ue=W,W=i)):(ue=W,W=i)))))),Je--,W===i&&Je===0&&qt(be),W}function No(){let W,he,Ve;return Je++,W=ue,he=sa(),he!==i?(t.substr(ue,3)===$?(Ve=$,ue+=3):(Ve=i,Je===0&&qt(Ct)),Ve!==i?(ii=W,W=Mr(he)):(ue=W,W=i)):(ue=W,W=i),W===i&&(W=ue,he=sa(),he!==i?(t.substr(ue,3)===A?(Ve=A,ue+=3):(Ve=i,Je===0&&qt(jt)),Ve!==i?(ii=W,W=Bi(he)):(ue=W,W=i)):(ue=W,W=i),W===i&&(W=ue,he=sa(),he!==i?(t.substr(ue,4)===M?(Ve=M,ue+=4):(Ve=i,Je===0&&qt(Ue)),Ve!==i?(ii=W,W=Ei(he)):(ue=W,W=i)):(ue=W,W=i),W===i&&(W=ue,he=sa(),he!==i?(t.substr(ue,4)===P?(Ve=P,ue+=4):(Ve=i,Je===0&&qt(Ft)),Ve!==i?(ii=W,W=Er(he)):(ue=W,W=i)):(ue=W,W=i)))),Je--,W===i&&(he=i,Je===0&&qt($t)),W}function dl(){let W,he;return Je++,W=ue,ji(),he=sa(),he!==i?(ii=W,W=Fr(he)):(ue=W,W=i),Je--,W===i&&Je===0&&qt(qe),W}function od(){let W,he,Ve,Pt;if(Je++,W=ue,t.charCodeAt(ue)===35?(he=O,ue++):(he=i,Je===0&&qt(gt)),he!==i){if(Ve=[],Pt=t.charAt(ue),N.test(Pt)?ue++:(Pt=i,Je===0&&qt(ct)),Pt!==i)for(;Pt!==i;)Ve.push(Pt),Pt=t.charAt(ue),N.test(Pt)?ue++:(Pt=i,Je===0&&qt(ct));else Ve=i;Ve!==i?(ii=W,W=gs()):(ue=W,W=i)}else ue=W,W=i;return W===i&&(W=ue,he=Jl(),he!==i&&(ii=W,he=ia(he)),W=he,W===i&&(W=ue,he=Vr(),he!==i&&(ii=W,he=ln()),W=he)),Je--,W===i&&(he=i,Je===0&&qt(je)),W}function sa(){let W,he,Ve,Pt,ki,is,ys,In;for(W=ue,he=t.charAt(ue),j.test(he)?ue++:(he=i,Je===0&&qt(Ot)),he===i&&(he=null),Ve=ue,Pt=[],ki=t.charAt(ue),B.test(ki)?ue++:(ki=i,Je===0&&qt(Xe));ki!==i;)Pt.push(ki),ki=t.charAt(ue),B.test(ki)?ue++:(ki=i,Je===0&&qt(Xe));if(t.charCodeAt(ue)===46?(ki=D,ue++):(ki=i,Je===0&&qt(We)),ki!==i){if(is=[],ys=t.charAt(ue),B.test(ys)?ue++:(ys=i,Je===0&&qt(Xe)),ys!==i)for(;ys!==i;)is.push(ys),ys=t.charAt(ue),B.test(ys)?ue++:(ys=i,Je===0&&qt(Xe));else is=i;is!==i?(Pt=[Pt,ki,is],Ve=Pt):(ue=Ve,Ve=i)}else ue=Ve,Ve=i;if(Ve===i)if(Ve=[],Pt=t.charAt(ue),B.test(Pt)?ue++:(Pt=i,Je===0&&qt(Xe)),Pt!==i)for(;Pt!==i;)Ve.push(Pt),Pt=t.charAt(ue),B.test(Pt)?ue++:(Pt=i,Je===0&&qt(Xe));else Ve=i;if(Ve!==i){if(Pt=ue,t.charCodeAt(ue)===101?(ki=L,ue++):(ki=i,Je===0&&qt(Ye)),ki!==i){if(is=t.charAt(ue),j.test(is)?ue++:(is=i,Je===0&&qt(Ot)),is===i&&(is=null),ys=[],In=t.charAt(ue),B.test(In)?ue++:(In=i,Je===0&&qt(Xe)),In!==i)for(;In!==i;)ys.push(In),In=t.charAt(ue),B.test(In)?ue++:(In=i,Je===0&&qt(Xe));else ys=i;ys!==i?(ki=[ki,is,ys],Pt=ki):(ue=Pt,Pt=i)}else ue=Pt,Pt=i;Pt===i&&(Pt=null),ii=W,W=fo()}else ue=W,W=i;return W}function Dp(W,he){return W.map(function(Ve){return Ve[he]})}function Ip(W,he,Ve){return[W].concat(Dp(he,Ve))}Nr=n();const ld=Nr!==i&&ue===t.length;function Lp(){throw Nr!==i&&ue<t.length&&qt(Rs()),om(Ss,Hi<t.length?mo(Hi):null,Hi<t.length?nd(Hi,Hi+1):nd(Hi,Hi))}return e.peg$library?{peg$result:Nr,peg$currPos:ue,peg$FAILED:i,peg$maxFailExpected:Ss,peg$maxFailPos:Hi,peg$success:ld,peg$throw:ld?void 0:Lp}:ld?Nr:void Lp()}function cze(t){if(!t||t.length===0)return null;if(typeof t=="string"){const i=d1e(t);return i&&i.length!==0?i:null}const e=t.map(i=>{if(!Number.isFinite(i.scale)||i.scale<=0)throw new ee("effect:invalid-scale","scale must be finite and greater than 0",{stop:i});return{scale:i.scale,effects:d1e(i.value)}});e.sort((i,r)=>r.effects.length-i.effects.length);for(let i=0;i<e.length-1;i++){if(!xtt(e[i].effects,e[i+1].effects))throw new ee("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:e[i].effects,b:e[i+1].effects});Stt(e[i].effects,e[i+1].effects)}return e.sort((i,r)=>r.scale-i.scale),e}function d1e(t){let e;if(!t)return[];try{e=AIt(t)}catch(i){throw new ee("effect:invalid-syntax","Invalid effect syntax",{value:t,error:i})}return e.map(i=>OIt(i))}function OIt(t){try{switch(t.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return PIt(t);case"opacity":return RIt(t);case"hue-rotate":return DIt(t);case"blur":return IIt(t);case"drop-shadow":return LIt(t);case"bloom":return kIt(t)}}catch(e){throw e.details.filter=t,e}throw new ee("effect:unknown-effect",`Effect '${t.name}' is not supported`,{effect:t})}function PIt(t){let e=1;return DM(t.parameters,1),t.parameters.length===1&&(e=Gd(t.parameters[0])),new kZ(t.name,e)}function RIt(t){let e=1;return DM(t.parameters,1),t.parameters.length===1&&(e=Gd(t.parameters[0])),new MCe(e)}function DIt(t){let e=0;return DM(t.parameters,1),t.parameters.length===1&&(e=BIt(t.parameters[0])),new $Ce(e)}function IIt(t){let e=0;return DM(t.parameters,1),t.parameters.length===1&&(e=Zse(t.parameters[0]),V4(e,t.parameters[0])),new bCe(e)}function LIt(t){const e=[];let i=null;for(const r of t.parameters)if(r.type==="color"){if(e.length&&Object.freeze(e),i)throw new ee("effect:type-error","Accepts only one color",{});i=jIt(r)}else{const s=Zse(r);if(Object.isFrozen(e))throw new ee("effect:type-error","<length> parameters not consecutive",{lengths:e});e.push(s),e.length===3&&V4(s,r)}if(e.length<2||e.length>3)throw new ee("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${e.length}}`,{lengths:e});return new SCe(e[0],e[1],e[2]||0,i||uze("black"))}function kIt(t){let e=1,i=0,r=0;return DM(t.parameters,3),t.parameters[0]&&(e=Gd(t.parameters[0])),t.parameters[1]&&(i=Zse(t.parameters[1]),V4(i,t.parameters[1])),t.parameters[2]&&(r=Gd(t.parameters[2])),new _Ce(e,i,r)}function DM(t,e){if(t.length>e)throw new ee("effect:type-error",`Function supports up to ${e} parameters, Actual: ${t.length}`,{parameters:t})}function rB(t){if(t.type==="color")return"<color>";if(t.unit){if(t.unit in Wse)return"<length>";if(t.unit in Hse)return"<angle>";if(t.unit==="%")return"<percentage>"}return"<double>"}function V4(t,e){if(t<0)throw new ee("effect:type-error",`Negative values are not allowed, Actual: ${t}`,{term:e})}function zIt(t){if(t.type!=="quantity"||t.unit!==null)throw new ee("effect:type-error",`Expected <double>, Actual: ${rB(t)}`,{term:t})}function FIt(t){if(t.type!=="quantity"||t.unit!==null&&t.unit!=="%")throw new ee("effect:type-error",`Expected <double> or <percentage>, Actual: ${rB(t)}`,{term:t})}const Hse={deg:1,grad:.9,rad:180/Math.PI,turn:360};function NIt(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&Hse[t.unit]!=null))throw new ee("effect:type-error",`Expected <angle>, Actual: ${rB(t)}`,{term:t})}const Wse={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function VIt(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&Wse[t.unit]!=null))throw new ee("effect:type-error",`Expected <length>, Actual: ${rB(t)}`,{term:t})}function Gd(t){FIt(t);const e=t.value;return V4(e,t),t.unit==="%"?.01*e:e}function UIt(t){return zIt(t),V4(t.value,t),t.value}function BIt(t){return NIt(t),t.value*Hse[t.unit]||0}function Zse(t){return VIt(t),t.value*Wse[t.unit]||0}function jIt(t){switch(t.colorType){case"hex":return Uet(t.value);case"named":return uze(t.value);case"function":return HIt(t.value)}}function uze(t){if(!rCe(t))throw new ee("effect:unknown-color",`color '${t}' isn't valid`,{namedColor:t});return Vet(t)}const qIt=/^rgba?/i,GIt=/^hsla?/i;function HIt(t){if(DM(t.parameters,4),qIt.test(t.name))return[Gd(t.parameters[0]),Gd(t.parameters[1]),Gd(t.parameters[2]),t.parameters[3]?Gd(t.parameters[3]):1];if(GIt.test(t.name))return sCe(UIt(t.parameters[0]),Gd(t.parameters[1]),Gd(t.parameters[2]),t.parameters[3]?Gd(t.parameters[3]):1);throw new ee("effect:syntax-error",`Invalid color function '${t.name}'`,{colorFunction:t})}function WIt(t,e,i){try{return QIt(t)}catch(r){i?.messages?.push(r)}return null}function ZIt(t,e,i,r){try{const s=YIt(t);Uf(i,s,e)}catch(s){r.messages&&r.messages.push(s)}}function YIt(t){const e=cze(t);return e?Ttt(e)?e.map(i=>i.toJSON()):e.map(({scale:i,effects:r})=>({scale:i,value:r.map(s=>s.toJSON())})):null}function QIt(t){if(!t||t.length===0)return null;if(XIt(t)){const e=[];for(const i of t)e.push({scale:i.scale,value:p1e(i.value)});return e}return p1e(t)}function XIt(t){const e=t[0];return!!e&&"scale"in e}function p1e(t){if(!t?.length)return"";const e=[];for(const i of t){let r=[];switch(i.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":r=[Gm(i,"amount")];break;case"blur":r=[Gm(i,"radius","pt")];break;case"hue-rotate":r=[Gm(i,"angle","deg")];break;case"drop-shadow":r=[Gm(i,"xoffset","pt"),Gm(i,"yoffset","pt"),Gm(i,"blurRadius","pt"),JIt(i,"color")];break;case"bloom":r=[Gm(i,"strength"),Gm(i,"radius","pt"),Gm(i,"threshold")]}const s=`${i.type}(${r.filter(Boolean).join(" ")})`;cze(s),e.push(s)}return e.join(" ")}function Gm(t,e,i){if(t[e]==null)throw new ee("effect:missing-parameter",`Missing parameter '${e}' in ${t.type} effect`,{effect:t});return i?t[e]+i:""+t[e]}function JIt(t,e){if(t[e]==null)throw new ee("effect:missing-parameter",`Missing parameter '${e}' in ${t.type} effect`,{effect:t});const i=t[e];return`rgba(${i[0]||0}, ${i[1]||0}, ${i[2]||0}, ${i[3]/255||0})`}const KIt={type:["average","color-burn","color-dodge","color","darken","destination-atop","destination-in","destination-out","destination-over","difference","exclusion","hard-light","hue","invert","lighten","lighter","luminosity","minus","multiply","normal","overlay","plus","reflect","saturation","screen","soft-light","source-atop","source-in","source-out","vivid-light","xor"],nonNullable:!0,json:{read:!1,write:!1,origins:{"web-map":{read:!0,write:{layerContainerTypes:OJ}},"portal-item":{read:!0,write:{layerContainerTypes:OJ}}}}},f1e={read:{reader:WIt},write:{allowNull:!0,writer:ZIt,layerContainerTypes:OJ}},e5t={json:{read:!1,write:!1,origins:{"web-map":f1e,"portal-item":f1e}}},t5t=t=>{const e=t;let i=class extends e{constructor(){super(...arguments),this.blendMode="normal",this.effect=null}};return d([m(KIt)],i.prototype,"blendMode",void 0),d([m(e5t)],i.prototype,"effect",void 0),i=d([k("esri.layers.mixins.BlendLayer")],i),i},i5t=t=>{const e=t;let i=class extends e{constructor(){super(...arguments),this.minScale=0,this.maxScale=0}get effectiveScaleRange(){const r={minScale:this.minScale,maxScale:this.maxScale},s=this.parent;s?.effectiveScaleRange!==void 0&&r5t(r,s.effectiveScaleRange);const n=this._get("effectiveScaleRange");return n&&n.minScale===r.minScale&&n.maxScale===r.maxScale?n:r}};return d([m({type:Number,nonNullable:!0,json:{write:!0}})],i.prototype,"minScale",void 0),d([m({type:Number,nonNullable:!0,json:{write:!0}})],i.prototype,"maxScale",void 0),d([m({readOnly:!0})],i.prototype,"effectiveScaleRange",null),i=d([k("esri.layers.mixins.ScaleRangeLayer")],i),i};function r5t(t,e){return t.minScale=t.minScale>0?e.minScale>0?Math.min(t.minScale,e.minScale):t.minScale:e.minScale,t.maxScale=t.maxScale>0?e.maxScale>0?Math.max(t.maxScale,e.maxScale):t.maxScale:e.maxScale,t}var PJ;let bP=PJ=class extends ke{constructor(t){super(t),this.expression=void 0,this.title=void 0}async collectRequiredFields(t,e){return Ev(t,e,null,this.expression)}clone(){return new PJ({expression:this.expression,title:this.title})}equals(t){return this.expression===t.expression&&this.title===t.title}};d([m({type:String,json:{write:{isRequired:!0}}})],bP.prototype,"expression",void 0),d([m({type:String,json:{write:!0}})],bP.prototype,"title",void 0),bP=PJ=d([k("esri.symbols.support.FeatureExpressionInfo")],bP);const m1e=bP,Ek=cl()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),g1e=new ta({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let mg=class extends ur(ke){constructor(e){super(e),this.featureExpressionInfo=void 0,this.offset=null}readFeatureExpressionInfo(e,i){return e!=null?e.expression?e:void 0:i.featureExpression&&i.featureExpression.value===0?{expression:"0"}:void 0}writeFeatureExpressionInfo(e,i,r,s){i[r]=e.write({},s),e.expression==="0"&&(i.featureExpression={value:0})}get mode(){const{offset:e,featureExpressionInfo:i}=this;return this._isOverridden("mode")?this._get("mode"):e!=null||i?"relative-to-ground":"on-the-ground"}set mode(e){this._override("mode",e)}set unit(e){this._set("unit",e)}write(e,i){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(e,i):null}equals(e){return this.mode===e.mode&&this.offset===e.offset&&this.unit===e.unit&&sBe(this.featureExpressionInfo,e.featureExpressionInfo)}};d([m({type:m1e,json:{write:!0}})],mg.prototype,"featureExpressionInfo",void 0),d([di("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],mg.prototype,"readFeatureExpressionInfo",null),d([Ht("featureExpressionInfo",{featureExpressionInfo:{type:m1e},"featureExpression.value":{type:[0]}})],mg.prototype,"writeFeatureExpressionInfo",null),d([m({type:Ek.apiValues,nonNullable:!0,json:{type:Ek.jsonValues,read:Ek.read,write:{writer:Ek.write,isRequired:!0}}})],mg.prototype,"mode",null),d([m({type:Number,json:{write:!0}})],mg.prototype,"offset",void 0),d([m({type:N_t,json:{type:String,read:g1e.read,write:g1e.write}})],mg.prototype,"unit",null),mg=d([k("esri.symbols.support.ElevationInfo")],mg);let vf=class extends t5t(i5t(Ms)){constructor(e){super(e),this.elevationInfo=null,this.graphics=new Ew,this.screenSizePerspectiveEnabled=!0,this.type="graphics",this.internal=!1}destroy(){this.removeAll(),this.graphics.destroy()}get loaded(){return super.loaded}add(e){return this.graphics.add(e),this}addMany(e){return this.graphics.addMany(e),this}removeAll(){return this.graphics.removeAll(),this}remove(e){this.graphics.remove(e)}removeMany(e){this.graphics.removeMany(e)}graphicChanged(e){this.emit("graphic-update",e)}};d([m({type:mg})],vf.prototype,"elevationInfo",void 0),d([m(o6(Ew,"graphics"))],vf.prototype,"graphics",void 0),d([m({type:["show","hide"]})],vf.prototype,"listMode",void 0),d([m()],vf.prototype,"screenSizePerspectiveEnabled",void 0),d([m({readOnly:!0})],vf.prototype,"type",void 0),d([m({constructOnly:!0})],vf.prototype,"internal",void 0),vf=d([k("esri.layers.GraphicsLayer")],vf);function y1e(t){switch(t){case 0:break;case 1:return"not owned by a graphics layer";case 2:return"no geometry";case 3:return"the geometry type is not supported";case 4:return"the symbol type is not supported"}return""}function s5t(t){if(t.graphic&&t.graphic.layer?.type!=="graphics")return 1;const e=t.operations?.data.type;if(!e)return 3;switch(e){case"polygon":case"point":case"polyline":case"mesh":break;default:return 3}return 0}function n5t(t){return a5t(t).result}function a5t(t){if(t.graphic&&t.graphic.layer?.type!=="graphics")return{result:1};if(!t.operations)return{result:2};const e=t.operations.data.type,i=t.operations.data.geometry;return e==="point"||e==="mesh"||e==="polyline"||e==="polygon"?{result:0,geometry:i}:{result:3}}function o5t(t){if(t.layer?.type!=="graphics")return 1;if(t.geometry==null)return 2;switch(t.geometry.type){case"point":break;case"polygon":case"polyline":case"multipoint":case"extent":case"mesh":return 0;default:return 3}const e=t.symbol!=null&&t.symbol.type==="point-3d"&&t.symbol.symbolLayers;return e&&e.some(i=>i.type==="object")?0:4}function _1e(t,e,i){if(!e||!t?.map)return;const{map:r}=t;r.layers.find(n=>n===e)||r.add(e,i)}function Ini(t,e){const i=e?.type==="subtype-sublayer"?e.parent:e;return t.allLayerViews.find(r=>{const s=r.layer;return s===i||"sublayers"in s&&s.sublayers!=null&&s.sublayers.includes(i)})}function Lni(t){return yCe(t)||kb(t)||bJe(t)||SJe(t)}let hN=class extends Me{constructor(e){super(e),this.enabled=!1}};d([m({type:Boolean,nonNullable:!0})],hN.prototype,"enabled",void 0),hN=d([k("esri.views.interactive.sketch.SketchLabelOptions")],hN);const Yse=hN;let vR=class extends Me{constructor(e){super(e),this.mode="absolute-height"}toJSON(){return{mode:this.mode}}};d([m({type:String,nonNullable:!0})],vR.prototype,"mode",void 0),vR=d([k("esri.views.interactive.sketch.SketchTooltipElevationOptions")],vR);let Qo=class extends Me{constructor(e){super(e),this.area=!0,this.coordinates=!0,this.direction=!0,this.distance=!0,this.elevation=!0,this.header=!0,this.helpMessage=!1,this.orientation=!0,this.radius=!0,this.rotation=!0,this.scale=!0,this.size=!0,this.totalLength=!0}};d([m({type:Boolean,nonNullable:!0})],Qo.prototype,"area",void 0),d([m({type:Boolean,nonNullable:!0})],Qo.prototype,"coordinates",void 0),d([m({type:Boolean,nonNullable:!0})],Qo.prototype,"direction",void 0),d([m({type:Boolean,nonNullable:!0})],Qo.prototype,"distance",void 0),d([m({type:Boolean,nonNullable:!0})],Qo.prototype,"elevation",void 0),d([m({type:Boolean,nonNullable:!0})],Qo.prototype,"header",void 0),d([m({type:Boolean,nonNullable:!0})],Qo.prototype,"helpMessage",void 0),d([m({type:Boolean,nonNullable:!0})],Qo.prototype,"orientation",void 0),d([m({type:Boolean,nonNullable:!0})],Qo.prototype,"radius",void 0),d([m({type:Boolean,nonNullable:!0})],Qo.prototype,"rotation",void 0),d([m({type:Boolean,nonNullable:!0})],Qo.prototype,"scale",void 0),d([m({type:Boolean,nonNullable:!0})],Qo.prototype,"size",void 0),d([m({type:Boolean,nonNullable:!0})],Qo.prototype,"totalLength",void 0),Qo=d([k("esri.views.interactive.sketch.SketchTooltipVisibleElements")],Qo);const hze=Qo;let El=class extends Me{constructor(e){super(e),this.enabled=!1,this.forceEnabled=!1,this.helpMessage=null,this.helpMessageIcon=null,this.inputEnabled=!0,this.elevation=new vR,this.placement="auto",this.offset=null,this.visibleElements=new hze,this.visualVariables=null,this.xyMode="auto"}get effectiveEnabled(){return this.forceEnabled||this.enabled}};d([m({type:Boolean,nonNullable:!0})],El.prototype,"enabled",void 0),d([m()],El.prototype,"forceEnabled",void 0),d([m()],El.prototype,"effectiveEnabled",null),d([m()],El.prototype,"helpMessage",void 0),d([m()],El.prototype,"helpMessageIcon",void 0),d([m({type:Boolean,nonNullable:!0})],El.prototype,"inputEnabled",void 0),d([m({type:vR,nonNullable:!0})],El.prototype,"elevation",void 0),d([m()],El.prototype,"placement",void 0),d([m()],El.prototype,"offset",void 0),d([m({type:hze,nonNullable:!0})],El.prototype,"visibleElements",void 0),d([m()],El.prototype,"visualVariables",void 0),d([m()],El.prototype,"xyMode",void 0),El=d([k("esri.views.interactive.sketch.SketchTooltipOptions")],El);const Qse=El;let t3=class extends Me{constructor(e){super(e),this.length=null,this.verticalLength=null,this.area=null}};d([m()],t3.prototype,"length",void 0),d([m()],t3.prototype,"verticalLength",void 0),d([m()],t3.prototype,"area",void 0),t3=d([k("esri.views.interactive.sketch.Units")],t3);const AV=t3;let a_=class extends Me{constructor(e){super(e),this.directionMode="relative",this.relativeDirectionIsBilateral=!1}get effectiveDirectionMode(){switch(this.directionMode){case"relative":return this.relativeDirectionIsBilateral?"relative-bilateral":"relative";case"absolute":return"absolute"}}get displayUnits(){return this._get("displayUnits")??new AV}set displayUnits(e){this._set("displayUnits",e)}get inputUnits(){return this._get("inputUnits")??new AV}set inputUnits(e){this._set("inputUnits",e)}};d([m({type:String,nonNullable:!0})],a_.prototype,"directionMode",void 0),d([m({type:Boolean,nonNullable:!0})],a_.prototype,"relativeDirectionIsBilateral",void 0),d([m()],a_.prototype,"effectiveDirectionMode",null),d([m({type:AV,nonNullable:!0})],a_.prototype,"displayUnits",null),d([m({type:AV,nonNullable:!0})],a_.prototype,"inputUnits",null),a_=d([k("esri.views.interactive.sketch.SketchValueOptions")],a_);const Xse=a_;let i3=class extends Me{constructor(e){super(e),this.labels=new Yse,this.tooltips=new Qse,this.values=new Xse}};d([m({nonNullable:!0,type:Yse})],i3.prototype,"labels",void 0),d([m({nonNullable:!0,type:Qse})],i3.prototype,"tooltips",void 0),d([m({nonNullable:!0,type:Xse})],i3.prototype,"values",void 0),i3=d([k("esri.views.interactive.sketch.SketchOptions")],i3);const dze=i3;function pze(t,e,i){return ju(t,e,i)}function ju(t=0,e=0,i=0){return Ge(t,e,i)}function jni(t){return t}function qni(t){return t}function Lv(t,e,i){return Ge(t,e,i)}function XC(t){const[e,i,r]=t;return t.length>3?[e,i,r,t[3]]:[e,i,r]}function CH(t){return t[3]=1|((t.length>3?t[3]:void 0)??0),t}function Gni(t){return!!(1&((t.length>3?t[3]:void 0)??0))}function v1e(t,e,{coordinateHelper:i,elevationInfo:r},s){return t?wP(i.vectorToDehydratedPoint(t,l5t),e,r,s):null}function wP(t,e,i,r=ju()){return r[0]=t.x,r[1]=t.y,r[2]=t.z??0,e==null||(e.type==="2d"?r[2]=0:r[2]=Lbt(e,t,i,Jx)??0),r}function Hni(t,e,i){return i?(cEe(i,t[0],t[1],t[2],e),i):Ep(t[0],t[1],t[2],e)}function b1e(t,e,{z:i,m:r},s,n){const{spatialReference:a,elevationInfo:o}=s;let l;i==null&&r==null?l=void 0:e==null||e.type==="2d"?l=i??void 0:l=$4e(e,t,a,Jx,o)??0;const[c,h]=t;return n?cEe(n,c,h,l,a):n=Ep(c,h,l,a),r!=null&&(n.m=r,n.hasM=!0),n}function Wni(t,e,i,r,s=ju()){const[n,a]=t;return s[0]=n,s[1]=a,t.length>3&&(s[3]=t[3]??0),i?.type!=="3d"?(s[2]=e.value,s):(s[2]=Ire(i,n,a,e.value,r,e.elevationInfo,Jx)??0,s)}const l5t=Ep(0,0,0,null);let up=class extends ke{constructor(){super(...arguments),this.enabled=!0}};d([m({type:Boolean})],up.prototype,"enabled",void 0),up=d([k("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],up);let $s=class extends ke{constructor(e){super(e),this.lineSnapper=new up,this.parallelLineSnapper=new up,this.rightAngleSnapper=new up,this.rightAngleTriangleSnapper=new up,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.verticalLineThresholdMeters=.3,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new mt([255,127,0]),this.orangeTransparent=new mt([255,127,0,.5]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5,this.satisfiesConstraintScreenThreshold=1}};d([m({type:up,constructOnly:!0,nonNullable:!0,json:{write:!0}})],$s.prototype,"lineSnapper",void 0),d([m({type:up,constructOnly:!0,nonNullable:!0,json:{write:!0}})],$s.prototype,"parallelLineSnapper",void 0),d([m({type:up,constructOnly:!0,nonNullable:!0,json:{write:!0}})],$s.prototype,"rightAngleSnapper",void 0),d([m({type:up,constructOnly:!0,nonNullable:!0,json:{write:!0}})],$s.prototype,"rightAngleTriangleSnapper",void 0),d([m({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],$s.prototype,"shortLineThreshold",void 0),d([m({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],$s.prototype,"distance",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],$s.prototype,"pointThreshold",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],$s.prototype,"intersectionParallelLineThreshold",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],$s.prototype,"parallelLineThreshold",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],$s.prototype,"verticalLineThresholdMeters",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],$s.prototype,"touchSensitivityMultiplier",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],$s.prototype,"pointOnLineThreshold",void 0),d([m({type:mt,nonNullable:!0})],$s.prototype,"orange",void 0),d([m({type:mt,nonNullable:!0})],$s.prototype,"orangeTransparent",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],$s.prototype,"lineHintWidthReference",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],$s.prototype,"lineHintWidthTarget",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],$s.prototype,"lineHintFadedExtensions",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],$s.prototype,"parallelLineHintWidth",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],$s.prototype,"parallelLineHintLength",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],$s.prototype,"parallelLineHintOffset",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],$s.prototype,"rightAngleHintSize",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],$s.prototype,"rightAngleHintOutlineSize",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],$s.prototype,"satisfiesConstraintScreenThreshold",void 0),$s=d([k("esri.views.interactive.snapping.Settings.Defaults")],$s);const OV=new $s;let Ag=class extends Me{constructor(e){super(e),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1,this.sublayerSources=new He}};d([m({constructOnly:!0})],Ag.prototype,"layer",void 0),d([m()],Ag.prototype,"enabled",void 0),d([m()],Ag.prototype,"updating",void 0),d([m()],Ag.prototype,"availability",void 0),d([m()],Ag.prototype,"sublayerSources",void 0),Ag=d([k("esri.views.interactive.snapping.FeatureSnappingLayerSource")],Ag);let ma=class extends Me{constructor(e){super(e),this.enabled=!1,this.enabledToggled=!1,this.forceDisabled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.gridEnabled=!1,this.attributeRulesEnabled=!1,this.featureSources=new He,this.distance=OV.distance,this.touchSensitivityMultiplier=OV.touchSensitivityMultiplier}get effectiveEnabled(){return!this.forceDisabled&&(this.enabledToggled?!this.enabled:this.enabled)}get effectiveGridEnabled(){return this.effectiveEnabled&&this.gridEnabled}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}get _effectiveFeatureSources(){const e=this.featureSources;e.some(w1e)&&fe.getLogger(this).warnOnce("Do not configure SubtypeGroupLayer sources in SnappingOptions.featureSources directly. Create a FeatureSnappingLayerSource for each SubtypeSublayer.");const i=e.filter(u5t),r=this._get("_effectiveFeatureSources")?.filter(w1e)??new He;for(const l of i){const c=r.find(h=>h.layer===l.layer.parent);if(c)c.sublayerSources.includes(l)||c.sublayerSources.add(l);else if(l.layer.parent){const h=new Ag({layer:l.layer.parent});h.sublayerSources.add(l),r.add(h)}}for(const l of r){const c=l.sublayerSources.filter(h=>!i.includes(h));l.sublayerSources.removeMany(c)}r.removeMany(r.filter(l=>l.sublayerSources.length===0));const s=e.filter(c5t),n=this._get("_effectiveFeatureSources")??new He,{added:a,removed:o}=$N(n.toArray(),[...s,...r]);return n.removeMany(o),n.addMany(a),n}};function w1e(t){return t.layer.type==="subtype-group"}function c5t(t){return t.layer.type!=="subtype-group"}function u5t(t){return t.layer.type==="subtype-sublayer"}d([m()],ma.prototype,"enabled",void 0),d([m()],ma.prototype,"enabledToggled",void 0),d([m()],ma.prototype,"forceDisabled",void 0),d([m()],ma.prototype,"selfEnabled",void 0),d([m()],ma.prototype,"featureEnabled",void 0),d([m()],ma.prototype,"gridEnabled",void 0),d([m()],ma.prototype,"attributeRulesEnabled",void 0),d([m({type:He.ofType(Ag)})],ma.prototype,"featureSources",void 0),d([m()],ma.prototype,"distance",void 0),d([m()],ma.prototype,"touchSensitivityMultiplier",void 0),d([m({readOnly:!0})],ma.prototype,"effectiveEnabled",null),d([m({readOnly:!0})],ma.prototype,"effectiveGridEnabled",null),d([m({readOnly:!0})],ma.prototype,"effectiveSelfEnabled",null),d([m({readOnly:!0})],ma.prototype,"effectiveFeatureEnabled",null),d([m({readOnly:!0})],ma.prototype,"_effectiveFeatureSources",null),ma=d([k("esri.views.interactive.snapping.SnappingOptions")],ma);let h5t=class extends q8{constructor(e,i){super(e,i,"webmap")}};function d5t(t){return t!=null&&typeof t=="object"&&"declaredClass"in t&&t.declaredClass==="esri.WebMap"}new h5t(2,35);const Kni=Symbol("grid-placement-graphic");function fze(t,e){const i=t.x-e.x,r=t.y-e.y;return i*i+r*r}function eai(t,e){return Math.sqrt(fze(t,e))}function p5t(t,e){e.sort((i,r)=>on(i.targetPoint,t)-on(r.targetPoint,t))}function tai({parameters:{point:t,distance:e,returnEdge:i,vertexMode:r,coordinateHelper:{spatialReference:s},filter:n},mode:a,returnZ:o,filter:l}){const c=l?.clone()??new kt({where:"1=1"});return c.returnZ=o??a==="3d",n&&(c.geometry=n.geometry,c.distance=n.distance,c.spatialRelationship=n.spatialRelationship,c.where=aHe(c.where,n.where),c.timeExtent=mJe(c.timeExtent,n.timeExtent),c.objectIds=f5t(c.objectIds,n.objectIds)),{point:Ep(t[0],t[1],t[2],s.toJSON()),mode:a,distance:e,returnEdge:i,vertexMode:r,query:c.toJSON()}}function f5t(t,e){return t||e?e?t?Array.from(Mwe(new Set(t),new Set(e))):e:t:null}function iai(t,e,i){return{left:v1e(t.leftVertex.pos,e,i),right:v1e(t.rightVertex.pos,e,i)}}const x1e=Symbol("snapping-toggle");function m5t(t,e=()=>{}){const i=K(()=>({view:t.view,snappingOptions:t.snappingOptions}),({view:r,snappingOptions:s})=>{if(t.removeHandles(x1e),!r||!s)return;const n=Br.TOOL,a=[r.on("key-down",o=>{o.key!==Spe.toggle||o.repeat||(s.enabledToggled=!0,e())},n),r.on("key-up",o=>{o.key===Spe.toggle&&(s.enabledToggled=!1,e())},n),r.on("pointer-move",o=>{const l=o.native.ctrlKey;s.enabledToggled!==l&&(s.enabledToggled=l,e())},n)];t.addHandles(a,x1e)},At);t.addHandles(i)}function rai(t){return d5t(t)&&"utilityNetworks"in t&&!!t.utilityNetworks?.length}function sai(t){return t?.type==="line"}function MH(t,e){return t[0]*e[1]-t[1]*e[0]}function g5t(t,e,i){const r=en(i,e)/uy(i);return zg(t,i,r)}function nai(t,e,i,r,s=i){return qs(zw,r,i),qs(PV,e,s),g5t(JC,PV,zw),wg(t,s,JC)}function aai(t,e,i,r){qs(zw,e,i);const s=r/gU(zw);return fp(t,i,zw,s)}function oai(t,e){const i=t.start,r=t.end,s=e.start,n=e.end,a=qs(zw,r,i),o=qs(mze,n,s),l=MH(a,o);if(Math.abs(l)<=_5t)return[];const c=qs(PV,i,s),h=MH(o,c)/l;return MH(a,c)/l,h>=0?[fp(JC,i,a,h)]:[fp(JC,i,a,h)]}function y5t(t,e,i){const r=[],s=qs(zw,t.end,t.start),n=qs(mze,t.start,e),a=uy(s),o=2*en(s,n),l=o*o-4*a*(uy(n)-i*i);if(l===0){const c=-o/(2*a);r.push(fp(JC,t.start,s,c))}else if(l>0){const c=Math.sqrt(l),h=(-o+c)/(2*a);r.push(fp(JC,t.start,s,h));const f=(-o-c)/(2*a);r.push(fp(PV,t.start,s,f))}return r}const _5t=1e-6,zw=pt(),mze=pt(),PV=pt(),JC=pt();function Jse({start:t,end:e,type:i},r,s){const n=[],a=qs(U4,e,t),o=qs(sB,t,r),l=uy(a),c=2*en(a,o),h=c*c-4*l*(uy(o)-s*s);if(h===0){const f=-c/(2*l);(i===0||f>=0)&&n.push(fp(pt(),t,a,f))}else if(h>0){const f=Math.sqrt(h),y=(-c+f)/(2*l);(i===0||y>=0)&&n.push(fp(pt(),t,a,y));const _=(-c-f)/(2*l);(i===0||_>=0)&&n.push(fp(pt(),t,a,_))}return n}function gze(t,e){const i=t.start,r=t.end,s=qs(U4,r,i),n=ve(aB,-s[1],s[0],0),a=e.start,o=e.end,l=ui(ene,o,a),c=Oe(l,n),h=ve(Tze,i[0],i[1],0),f=ui($ze,h,a),y=Oe(f,n),_=nn();if(Math.abs(c)<_)return[];const w=Tr(Cze,a,l,y/c);if(e.type===0){const x=ui(RJ,w,a);if(Oe(x,l)<-_)return[]}if(t.type===1){const x=g2e(sB,w,i);if(en(x,s)<-_)return[]}return[cr(w)]}function v5t(t,e){return w5t(RV(tne,e[2],t),e)}function yze(t,e){return xze(RV(tne,0,t),RV($5t,0,e)).map(([r,s])=>vs(r,s))}function _ze(t,e,i){return bze(t,RV(tne,t[2],e),i)}function vze(t,e,i,r=R()){const s=qs(U4,t,e),n=gU(s);return fp(r,e,s,n===0?1:i/n),r[2]=t[2],r}function bze(t,{start:e,end:i,type:r},s=R()){const n=ui(nB,t,e),a=ui(aB,i,e),o=Oe(n,a)/Oe(a,a);return Tr(s,e,a,r===0?Math.max(o,0):o)}const b5t=(()=>{const t=R(),e=R(),i=R();return({start:r,end:s},{center:n,radius:a,normal:o,slicePlane:l})=>{const c=Qf(n,o,T5t);if(xs(dZ(c,r),0)&&xs(dZ(c,s),0)){Hee(o,t,e);const f=(w,x)=>(Ce(i,x,n),Cr(w,Oe(i,t),Oe(i,e)),w),y=y5t({start:f(U4,r),end:f(sB,s)},$v,a),_=[];for(const[w,x]of y){const S=de(R(),n);Tr(S,S,t,w),Tr(S,S,e,x),l&&!X_(l,S)||_.push(S)}return _}const h=R();return j3e(c,r,s,h)?!xs(Ri(h,n),a)||l&&!X_(l,h)?[]:[h]:[]}})();function wze({start:t,end:e,type:i},r,s){const n=[],a=Ce(nB,e,t),o=qs(sB,t,r),l=uy(a),c=2*en(a,o),h=c*c-4*l*(uy(o)-s*s);if(h===0){const f=-c/(2*l);(i===1||f>=0)&&n.push(Tr(R(),t,a,f))}else if(h>0){const f=Math.sqrt(h),y=(-c+f)/(2*l);(i===1||y>=0)&&n.push(Tr(R(),t,a,y));const _=(-c-f)/(2*l);(i===1||_>=0)&&n.push(Tr(R(),t,a,_))}return n}function xze(t,e){const i=t.start,r=t.end,s=e.start,n=e.end,a=ui(nB,r,i),o=ui(aB,n,s),l=ui(ene,s,i),c=bt(Tze,a,o);if(!xs(Oe(l,c),0))return[];const h=Gx(c);if(xs(h,0))return[];const f=bt($ze,l,o),y=Oe(f,c)/h,_=Tr(Cze,i,a,y);if(t.type===0){const w=ui(RJ,_,i);if(Oe(a,w)<-nn())return[]}if(e.type===0){const w=ui(RJ,_,s);if(Oe(o,w)<-nn())return[]}return[cr(_)]}function w5t({start:t,end:e,type:i},r){const s=ui(nB,r,t),n=ui(aB,e,t),a=bt(ene,n,s),o=Gx(a)/Gx(n),l=nn();if(o<l)switch(i){case 1:return[cr(r)];case 0:return Oe(n,s)<-l?[]:[cr(r)]}return[]}function Kse(t,e,i,r){const[s,n]=t,[a,o]=i,l=a-s,c=o-n,h=l*l+c*c,f=Math.sqrt(h);if(f>e+r)return[];if(f<Math.abs(e-r))return[];if(xs(f,0)&&xs(e,r))return[];const y=(e*e-r*r+h)/(2*f),_=Math.sqrt(e*e-y*y),w=_*c/f,x=_*l/f,[S,$]=Ec(U4,t,i,y/f);return xs(w,x)?[vs(S,$)]:[vs(S+w,$-x),vs(S-w,$+x)]}function RV(t,e,{start:i,end:r,type:s}){return ve(t.start,i[0],i[1],e),ve(t.end,r[0],r[1],e),t.type=S5t[s],t}function Sze(t,e){return xs(t[2],e[2])}function xs(t,e){return Gl(Math.abs(t-e),0,nn())}function x5t(t,e){return e.filter(i=>X_(t,i))}function X_(t,e){return WR(t,e)}const S5t={0:1,1:0},U4=pt(),sB=pt(),nB=R(),aB=R(),ene=R(),Tze=R(),$ze=R(),Cze=R(),RJ=R(),T5t=Oi(),tne={start:R(),end:R(),type:1},$5t={start:R(),end:R(),type:1};class sd{intersect(e){return gg(this,e)}closestPoints(e){return[this.closestTo(e)]}}class IM extends sd{constructor(e){super(),this.point=e}equals(e){return this===e||Ud(e)&&si(this.point,e.point)}closestTo(){return XC(this.point)}}class ine extends sd{constructor(e,i,r){super(),this.start=e,this.end=i,this.lineLike={start:e,end:i,type:r}}equals(e){return this===e||bf(e)&&this.lineLike.type===e.lineLike.type&&si(this.start,e.start)&&si(this.end,e.end)}closestTo(e){const i=ju();return bze(e,this.lineLike,i),i}}class rne extends ine{constructor(e,i){super(e,i,1)}}class C5t extends ine{constructor(e,i){super(e,i,0)}}class Mze extends sd{constructor(e){super(),this.constraints=e}equals(e){return this===e||DJ(e)&&sy(this.constraints,e.constraints,(i,r)=>i.equals(r))}closestTo(e){let i,r=1/0;for(const s of this.constraints){const n=s.closestTo(e),a=on(e,n);a<r&&(r=a,i=n)}return XC(i??e)}closestPoints(e){return this.constraints.flatMap(i=>i===this?[]:i.closestPoints(e))}}class Eze extends sd{constructor(e,i){super(),this.center=e,this.radius=i}equals(e){return this===e||xf(e)&&this.center[0]===e.center[0]&&this.center[1]===e.center[1]&&this.radius===e.radius}closestTo(e){const i=ju();return vze(e,this.center,this.radius,i),i}}class sne extends sd{constructor(e,i){super(),this.center=e,this.radius=i}equals(e){return this===e||_g(e)&&si(this.center,e.center)&&this.radius===e.radius}closestTo(e){const i=ju();return vze(e,this.center,this.radius,i),i[2]=this.center[2],i}asCircle(){return new nne(XC(this.center),this.radius,Lv(0,0,1))}}class nne extends sd{constructor(e,i,r,s=void 0){super(),this.center=e,this.radius=i,this.normal=r,this.slicePlane=s}equals(e){return this===e||o_(e)&&si(this.center,e.center)&&si(this.normal,e.normal)&&this.radius===e.radius}closestTo(e){const{center:i,radius:r}=this;Yee(this.getPlane(M5t),e,EH);const s=ui(EH,EH,i),n=On(s);if(xs(n,0))return XC(e);const a=r/Math.sqrt(n),o=ju();Tr(o,i,s,a);const{slicePlane:l}=this;return l&&!X_(l,o)?one(l,this)?.closestTo(e)??XC(e):o}getPlane(e=Oi()){return Qf(this.center,this.normal,e)}}const EH=R(),M5t=Oi();class E5t extends sd{constructor(e){super(),this.z=e}equals(e){return this===e||yg(e)&&this.z===e.z}closestTo(e){return Lv(e[0],e[1],this.z)}getPlane(e=Oi()){return ve(S1e,0,0,this.z),Qf(S1e,py,e)}}const S1e=R();class ane extends sd{constructor(e,i,r){super(),this.start=e,this.end=i,this.planeLike={start:e,end:i,type:r}}equals(e){return this===e||wf(e)&&this.planeLike.type===e.planeLike.type&&si(this.start,e.start)&&si(this.end,e.end)}closestTo(e){const i=ju();return _ze(e,this.planeLike,i),i}closestEndTo(e){const{start:i,end:r}=this.planeLike;return Math.sign(en(qs(A5t,r,i),qs(O5t,e,i)))>0?this.end:this.start}getPlane(e=Oi()){const i=de(T1e,this.end);return i[2]+=1,Su(this.start,this.end,i,e)}getSlicePlane(e=Oi()){const{start:i,end:r,type:s}=this.planeLike;if(s===0)return;const n=ve(T1e,i[0],i[1],0),a=ve($1e,r[0],r[1],0),o=Ce($1e,a,n);return Qf(n,o,e),e}}const A5t=pt(),O5t=pt(),T1e=R(),$1e=R();class lai extends ane{constructor(e,i){super(e,i,1)}}class Aze extends ane{constructor(e,i){super(e,i,0)}}class P5t extends sd{constructor(e,i){super(),this.sphere=nte(e,i),this._center=cr(e)}equals(e){return this===e||vg(e)&&n$e(this.sphere,e.sphere)}closestTo(e){const i=ju();return qU(this.sphere,e,i),i}get center(){return this._center}get radius(){return this.sphere[3]}}class Oze extends sd{constructor(e,i,r){super(),this.start=e,this.end=i,this.getZ=r,this.planeLike={start:e,end:i,type:0}}equals(e){return this===e||DV(e)&&si(this.start,e.start)&&si(this.end,e.end)&&this.getZ===e.getZ}closestTo(e){return z5t(this,e)}addIfOnTheGround(e,i){for(const r of i){const s=this.getZ(r[0],r[1])??0;xs(r[2],s)&&(r[2]=s,e.push(r))}}}class R5t extends sd{constructor(e,i,r){super(),this._x=e,this._y=i,this._z=r}equals(e){return this===e||K5t(e)&&this._x===e._x&&this._y===e._y&&this._z===e._z}closestTo([e,i,r]){return pze(this._x??e,this._y??i,this._z??r)}}class D5t extends sd{constructor(e,i,r,s,n){super(),this._origin=e,this._spatialReference=i,this._distanceMeters=r,this._z=s,this._directionDegrees=n}equals(e){return this===e||J5t(e)&&e6(this._origin,e._origin)&&this._spatialReference===e._spatialReference&&this._distanceMeters===e._distanceMeters&&this._z===e._z&&this._directionDegrees===e._directionDegrees}closestTo([e,i,r]){return Cr(NA,e,i),e6(NA,this._origin)||this._applyDirectionAndDistance(NA),pze(NA[0],NA[1],this._z??r)}_applyDirectionAndDistance(e){if(this._directionDegrees!=null&&this._distanceMeters!=null)Q_(e,this._origin,this._directionDegrees,this._distanceMeters,this._spatialReference);else if(this._directionDegrees!=null)L5t(e,this._origin,this._directionDegrees,e,this._spatialReference);else if(this._distanceMeters!=null){const{azimuth:i}=RM(I5t,this._origin,e,this._spatialReference);Q_(e,this._origin,i??0,this._distanceMeters,this._spatialReference)}}}const NA=[0,0],I5t=new z4;function L5t(t,e,i,r,s){let{azimuth:n,distance:a}=RM(k5t,e,r,s);n??=0;let o=a*Math.cos((n-i)*Il);o=Math.max(0,o),Q_(t,e,i,o,s)}const k5t=new z4;function z5t(t,e){const i=ju();return _ze(e,t.planeLike,i),i[2]=t.getZ(i[0],i[1])??Rze,i}function gg(t,e){if(DJ(t)){const i=[];for(const r of t.constraints){const s=r.intersect(e);s&&i.push(s)}return lne(i)}if(DJ(e))return gg(e,t);if(DV(t))return C1e(t,e);if(DV(e))return C1e(e,t);if(Ud(t)){const{point:i}=t;if(Ud(e))return si(i,e.point)?t:void 0;const r=e.closestTo(i);return Tv(r,i)?t:void 0}if(bf(t)){if(Ud(e))return gg(e,t);if(bf(e))return hp(xze(t.lineLike,e.lineLike));if(yg(e))return F5t(t,e);if(wf(e))return hp(gze(e.planeLike,t.lineLike));if(xf(e))return hp(wze(t.lineLike,e.center,e.radius));if(o_(e))return hp(b5t(t.lineLike,e));if(_g(e))return N5t(t,e);if(vg(e))return V5t(t,e)}else if(yg(t)){if(Ud(e)||bf(e))return gg(e,t);if(yg(e))return U5t(t,e);if(wf(e))return B5t(t,e);if(xf(e))return j5t(t,e);if(o_(e))return G5t(t,e);if(_g(e))return q5t(t,e);if(vg(e))return H5t(t,e)}else if(wf(t)){if(Ud(e)||bf(e)||yg(e))return gg(e,t);if(wf(e))return AH(yze(t.planeLike,e.planeLike));if(xf(e))return AH(Jse(t.planeLike,e.center,e.radius));if(o_(e))return Z5t(t,e);if(_g(e))return W5t(t,e);if(vg(e))return Y5t(t,e)}else if(xf(t)){if(Ud(e)||bf(e)||yg(e)||wf(e))return gg(e,t);if(xf(e))return AH(Kse(t.center,t.radius,e.center,e.radius));if(o_(e))return void 0;if(_g(e))return Q5t(t,e);if(vg(e))return void 0}else if(o_(t)){if(Ud(e)||bf(e)||yg(e)||wf(e)||xf(e))return gg(e,t);if(o_(e))return void 0;if(_g(e))return e.asCircle(),void 0;if(vg(e))return void 0}else if(_g(t)){if(Ud(e)||bf(e)||yg(e)||wf(e)||xf(e)||o_(e))return gg(e,t);if(_g(e))return X5t(e,t);if(vg(e))return void 0}else if(vg(t)){if(Ud(e)||bf(e)||yg(e)||wf(e)||xf(e)||_g(e))return gg(e,t);if(vg(e))return void 0}}const F5t=(()=>{const t=Oi();return(e,i)=>{const{start:r,end:s}=e;if(Sze(r,s)&&xs(r[2],i.z))return e;const n=ju();return j3e(i.getPlane(t),r,s,n)?new IM(n):void 0}})();function N5t({lineLike:t},{center:e,radius:i}){const r=e[2];return hp(wze(t,e,i).filter(s=>xs(s[2],r)))}function V5t({lineLike:t},{sphere:e}){return hp(c$e(e,t.start,t.end))}const one=(()=>{const t=ri(),e=R(),i=R();return(r,s,n)=>{const{normal:a,center:o,radius:l}=s;Hee(a,e,i);const c=r,h=l*Oe(c,e),f=l*Oe(c,i);yr(t,o[0],o[1],o[2],1);const y=jee(r,t),_=Math.hypot(h,f),w=xs(_,0);if(xs(dZ(r,o),0)){if(w)return s;if(xs(l,0))return!n||X_(n,o)?new IM(XC(o)):void 0;bt(e,c,a),Ee(e,e);const D=new Array,L=cr(o);Tr(L,L,e,l),n&&!X_(n,L)||D.push(L);const F=cr(o);return Tr(F,F,e,-l),n&&!X_(n,F)||D.push(F),hp(D)}if(w)return;const x=-y/_;if(Math.abs(x)>1||xs(x,1))return;const S=Math.atan(h/f),$=zu(x)-S,A=Math.PI-$,M=new Array,P=R();Tr(P,o,e,l*Math.cos($)),Tr(P,P,i,l*Math.sin($)),M.push(P);const O=R();return Tr(O,o,e,l*Math.cos(A)),Tr(O,O,i,l*Math.sin(A)),M.push(O),hp(n?x5t(n,M):M)}})();function U5t(t,e){return xs(t.z,e.z)?t:void 0}function B5t({z:t},{planeLike:e}){const[i,r]=e.start,[s,n]=e.end,a=Lv(i,r,t),o=Lv(s,n,t);return e.type===0?new rne(a,o):new C5t(a,o)}function j5t(t,e){const[i,r]=e.center;return new sne(Lv(i,r,t.z),e.radius)}function q5t(t,e){return xs(e.center[2],t.z)?e:void 0}const G5t=(()=>{const t=Oi();return(e,i)=>one(e.getPlane(t),i,i.slicePlane)})();function H5t(t,{center:e,radius:i}){const r=Math.abs(e[2]-t.z);if(r>i&&!xs(r,i))return;const s=Lv(e[0],e[1],t.z),n=Math.sqrt(i**2-r**2);return xs(n,0)?void 0:new sne(s,n)}const W5t=(()=>{const t=Oi();return(e,{center:i,radius:r})=>{const s=Jse(e.planeLike,i,r),n=i[2];e.getSlicePlane(t);const a=new Array;for(const[o,l]of s){const c=[o,l,n];X_(t,c)&&a.push(c)}return hp(a)}})(),Z5t=(()=>{const t=Oi(),e=Oi();return(i,r)=>one(i.getPlane(t),r,i.getSlicePlane(e))})(),Y5t=(()=>{const t=Oi();return(e,{center:i,radius:r})=>{const s=e.getPlane(t),n=va(s,i),a=Math.abs(n);if(a>r&&!xs(a,r))return;const o=Math.sqrt(r**2-n**2);if(xs(o,0)){const h=ju();return Yee(s,i,h),new IM(h)}const l=ju(),c=cr(s);return Tr(l,i,c,n),new nne(l,o,c,e.getSlicePlane())}})();function Q5t(t,e){const i=Ux(t.center,e.center);return xs(i,0)&&xs(t.radius,e.radius)?e:Pze(Kse(t.center,t.radius,e.center,e.radius),e.center[2])}function X5t(t,e){if(!Sze(t.center,e.center))return;const i=Ux(t.center,e.center);return xs(i,0)&&xs(t.radius,e.radius)?t:Pze(Kse(t.center,t.radius,e.center,e.radius),t.center[2])}function C1e(t,e){const{planeLike:i,getZ:r}=t,s=new Array;if(Ud(e))t.addIfOnTheGround(s,v5t(i,e.point));else if(bf(e))t.addIfOnTheGround(s,gze(i,e.lineLike));else if(xf(e))for(const[n,a]of Jse(i,e.center,e.radius)){const o=r(n,a);o!=null&&s.push(Ge(n,a,o))}else if(wf(e)||DV(e))for(const[n,a]of yze(i,e.planeLike)){const o=r(n,a)??Rze;s.push(Ge(n,a,o))}return hp(s)}function AH(t){return lne(t.map(([e,i])=>{const r=Lv(e,i,0),s=Lv(e,i,1);return new rne(r,s)}))}function hp(t){return lne(t.map(e=>e?new IM(e):void 0))}function Pze(t,e){return hp(t.map(([i,r])=>[i,r,e]))}function lne(t){if(t.length!==0)return t.length===1?t[0]??void 0:new Mze(t.filter(qf))}function DJ(t){return t instanceof Mze}function Ud(t){return t instanceof IM}function bf(t){return t instanceof ine}function yg(t){return t instanceof E5t}function wf(t){return t instanceof ane}function xf(t){return t instanceof Eze}function _g(t){return t instanceof sne}function o_(t){return t instanceof nne}function vg(t){return t instanceof P5t}function DV(t){return t instanceof Oze}function J5t(t){return t instanceof D5t}function K5t(t){return t instanceof R5t}const Rze=0;let LM=class{constructor(e,i,r,s){this.targetPoint=e,this.constraint=i,this.isDraped=r,this.domain=s}},Dze=class extends LM{constructor({targetPoint:e,objectId:i,constraint:r,isDraped:s}){super(e,r,s,1),this.objectId=i}},oB=class{constructor(e,i){this.isDraped=e,this.domain=i}},im=class Ize extends oB{constructor(e,i,r,s,n=3,a=!0,o=!0){super(s,n),this.type=e,this.lineStart=i,this.lineEnd=r,this.fadeLeft=a,this.fadeRight=o}equals(e){return e instanceof Ize&&this.type===e.type&&si(this.lineStart,e.lineStart)&&si(this.lineEnd,e.lineEnd)&&this.fadeLeft===e.fadeLeft&&this.fadeRight===e.fadeRight}get length(){return Ri(this.lineStart,this.lineEnd)}},eLt=class extends Dze{constructor(e){super({...e,isDraped:!0,constraint:new Oze(e.edgeStart,e.edgeEnd,e.getGroundElevation)})}get hints(){return[new im(1,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}},tLt=class extends Dze{constructor(e){super({...e,constraint:new rne(e.edgeStart,e.edgeEnd)})}get hints(){return[new im(1,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}},iLt=class Lze extends oB{constructor(e,i,r=3){super(i,r),this.intersectionPoint=e}equals(e){return e instanceof Lze&&si(this.intersectionPoint,e.intersectionPoint)}},dN=class extends LM{constructor(e,i,r,s){super(e,new IM(e),s,3),this.first=i,this.second=r}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new iLt(this.targetPoint,this.isDraped,this.domain)]}},rLt=class extends LM{constructor({lineStart:e,lineEnd:i,targetPoint:r,isDraped:s}){super(r,new Aze(e,i),s,2),this._referenceLineHint=new im(2,e,i,s,this.domain)}get hints(){return[this._referenceLineHint,new im(0,this._lineEndClosestToTarget(),this.targetPoint,this.isDraped,this.domain)]}_lineEndClosestToTarget(){return this.constraint.closestEndTo(this.targetPoint)}},sLt=class kze extends oB{constructor(e,i,r,s=3){super(r,s),this.lineStart=e,this.lineEnd=i}equals(e){return e instanceof kze&&si(this.lineStart,e.lineStart)&&si(this.lineEnd,e.lineEnd)}},nLt=class extends LM{constructor({referenceLine:e,lineStart:i,targetPoint:r,isDraped:s}){const n=cr(i),{left:a,right:o}=e;Ce(n,xe(n,n,o),a),super(r,new Aze(i,n),s,2),this._referenceLines=[{edge:e,fadeLeft:!0,fadeRight:!0}]}get hints(){return[new im(0,this.constraint.start,this.targetPoint,this.isDraped,this.domain),new sLt(this.constraint.start,this.targetPoint,this.isDraped,this.domain),...this._referenceLines.map(e=>new im(1,e.edge.left,e.edge.right,this.isDraped,this.domain,e.fadeLeft,e.fadeRight))]}addReferenceLine(e){const i={edge:e,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach(r=>{si(e.right,r.edge.left)&&(r.fadeLeft=!1,i.fadeRight=!1),si(e.right,r.edge.right)&&(r.fadeRight=!1,i.fadeRight=!1),si(e.left,r.edge.right)&&(r.fadeRight=!1,i.fadeLeft=!1),si(e.left,r.edge.left)&&(r.fadeLeft=!1,i.fadeLeft=!1)}),this._referenceLines.push(i)}},zze=class Fze extends oB{constructor(e,i,r,s,n=3){super(s,n),this.previousVertex=e,this.centerVertex=i,this.nextVertex=r}equals(e){return e instanceof Fze&&si(this.previousVertex,e.previousVertex)&&si(this.centerVertex,e.centerVertex)&&si(this.nextVertex,e.nextVertex)}},aLt=class extends LM{constructor({targetPoint:e,constraint:i,previousVertex:r,otherVertex:s,otherVertexType:n,isDraped:a,selfSnappingType:o,objectId:l,domain:c}){super(e,i,a,c??2),this.previousVertex=r,this.otherVertex=s,this.otherVertexType=n,this.selfSnappingType=o??0,this.objectId=l??null}get hints(){const e=this.previousVertex,i=this.otherVertexType===1?this.otherVertex:this.targetPoint,r=this.otherVertexType===1?this.targetPoint:this.otherVertex;return[new im(0,i,r,this.isDraped,this.domain),new im(1,e,i,this.isDraped,this.domain),new zze(this.previousVertex,i,r,this.isDraped,this.domain)]}},oLt=class extends LM{constructor({targetPoint:e,point1:i,point2:r,isDraped:s}){super(e,new Eze(Wi(R(),i,r,.5),.5*Zf(i,r)),s,2),this._p1=i,this._p2=r}get hints(){return[new im(1,this.targetPoint,this._p1,this.isDraped,this.domain),new im(1,this.targetPoint,this._p2,this.isDraped,this.domain),new zze(this._p1,this.targetPoint,this._p2,this.isDraped,this.domain)]}};function vai(t,e,i,r){const s=i.projectToRenderScreen(t,uLt),n=i.projectToRenderScreen(e,hLt);return s==null||n==null?null:(qs(r,n,s),KN(r,r),r)}function lLt(t,e,i,r,s=R()){const n=de(cLt,t);return n[2]=$4e(r,n,e,i)||0,r.renderCoordsHelper.toRenderCoords(n,e,s),s}const cLt=R(),uLt=CU(),hLt=CU();function dLt(t,e,i,r){return r.type==="2d"?(Ak.x=t[0],Ak.y=t[1],Ak.spatialReference=e,r.toScreen(Ak)):(lLt(t,e,i,r,M1e),r.state.camera.projectToScreen(M1e,OH),Zl(OH[0],OH[1]))}const Ak=Ep(0,0,0,null),M1e=R(),OH=Gs();let lB;function Nze(){return!!lB&&Dxe()}async function pLt(){if(!Nze()){const[t,e]=await Promise.all([te(()=>import("./OperatorGeodeticLength-DfoIzJ_S.js"),__vite__mapDeps([385,328,386,330,331,332,64,333])),te(async()=>{const{injectPe:i}=await import("./ProjectionTransformation-ySeecDBA.js").then(r=>r.b5);return{injectPe:i}},__vite__mapDeps([330,331,328,332,64,333])).then(({injectPe:i})=>i),Ixe()]);lB=new t.OperatorGeodeticLength,e(y7e)}}function fLt(t,e,i){return lB.execute(t,e,i,null)}function mLt(){return lB.supportsCurves()}const gLt={geodesic:0,loxodrome:1,"great-elliptic":2,"normal-section":3,"shape-preserving":4};let cne,Vze,Uze,une;function hne(){return!!cne&&Nze()}async function dne(){if(!hne()){const[t]=await Promise.all([te(()=>import("./apiConverter-CjKzmSWX.js"),__vite__mapDeps([334,328,331,330,332,64,333,335])),pLt()]);cne=t.fromGeometry,Vze=t.fromSpatialReference,Uze=t.getSpatialReference,une=mLt()}}function cB(t,e={}){const{curveType:i="geodesic",unit:r}=e,s=Uze(t);let n=fLt(cne(t),Vze(s),gLt[i]);return n&&r&&(n=hi(n,"meters",r)),n}const bai=Object.freeze(Object.defineProperty({__proto__:null,execute:cB,isLoaded:hne,load:dne,get supportsCurves(){return une}},Symbol.toStringTag,{value:"Module"}));function wai(t){return b2(t)||Fu(t)}function pne(t,e,i,...r){return b2(t)?e.apply(void 0,r):t.isWebMercator?i.apply(void 0,r):null}const xai=1e5;function yLt(t){const{spatialReference:e}=t;return pne(e,xLt,SLt,t)}function _Lt(t,e){if(!fs(t.spatialReference,e.spatialReference))return null;const{spatialReference:i}=t;return Ok[0]=t.x,Ok[1]=t.y,Ok[2]=t.hasZ?t.z:0,Pk[0]=e.x,Pk[1]=e.y,Pk[2]=e.hasZ?e.z:0,Bze(Ok,Pk,i)}function Bze(t,e,i){return pne(i,bLt,wLt,t,e,i)}const vLt={geodesicLength:yLt,geodesicDistanceBetweenPoints:_Lt,geodesicDistance:Bze};async function jze(){return await dne(),vLt}function bLt(t,e,i){return Iu(RM($Lt,t,e,i).distance,"meters")}function wLt(t,e,i){return Iu(cB(TLt(t,e,i),{unit:"meters"}),"meters")}function xLt(t){return Iu(Kke([t],"meters")[0],"meters")}function SLt(t){return Iu(cB(t,{unit:"meters"}),"meters")}function TLt(t,e,i){return new Ps({spatialReference:i,paths:[[[...t],[...e]]]})}const $Lt=new z4,Ok=R(),Pk=R();let Bd=class extends Uc{constructor(e){super(e),this.options=new ma,this._engineCache=new Map,this._loadTask=null,this._engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=0}initialize(){this.addHandles([K(()=>{const{distance:e,touchSensitivityMultiplier:i,effectiveSelfEnabled:r,effectiveFeatureEnabled:s,effectiveGridEnabled:n}=this.options;return{selfEnabled:r,featureEnabled:s,gridEnabled:this.view.type==="2d"&&n,viewReady:this.view.ready,viewSpatialReference:this.view.spatialReference,distance:e,touchSensitivityMultiplier:i}},(e,i)=>{i&&(this.doneSnapping(),this.emit("changed")),this._loadTask?.abort(),this._loadTask=Bc(r=>this._updateEngines(e,i,r))},At),K(()=>this.options,e=>{for(const i of this._engines)i.options=e},Yt)])}destroy(){this._loadTask?.abort(),this._destroyEngines()}get updating(){return this._engines.some(e=>e.updating)||!this._loadTask?.finished}_destroyEngines(){this._engineCache.forEach(e=>e.destroy()),this._engineCache.clear(),this._engines=[]}async _updateEngines(e,i,r){if(!e.viewReady)return void this._destroyEngines();i?.viewSpatialReference!==e.viewSpatialReference&&this._destroyEngines();const s=this._engineCache,n=await Promise.allSettled([e.featureEnabled&&!s.has("feature")?this._createFeatureSnappingEngine(r):void 0,e.selfEnabled&&!s.has("self")?this._createSelfSnappingEngine(r):void 0,e.gridEnabled&&!s.has("grid")?this._createGridSnappingEngine(r):void 0]);if(r.aborted)for(const a of n)a.status==="fulfilled"&&a.value?.engine.destroy();else{for(const a of n)a.status==="fulfilled"&&a.value&&s.set(a.value.type,a.value.engine);this._engines=Array.from(s.values())}}async _createSelfSnappingEngine(e){const[{SelfSnappingEngine:i},r]=await Promise.all([te(()=>import("./SelfSnappingEngine-CNTZE1Lj.js"),__vite__mapDeps([387,355])),jze()]);return st(e),{type:"self",engine:new i({view:this.view,options:this.options,geodesicLengthMeasurementUtils:r})}}async _createGridSnappingEngine(e){const{view:i}=this;if(i.type!=="2d")return;const{GridSnappingEngine:r}=await te(()=>import("./GridSnappingEngine-CW29N1UA.js"),[]);return st(e),{type:"grid",engine:new r({view:i,options:this.options})}}async _createFeatureSnappingEngine(e){const{FeatureSnappingEngine:i}=await te(()=>import("./FeatureSnappingEngine-Cy08axzf.js"),__vite__mapDeps([388,145,197]));st(e);const{view:r,options:s}=this,{spatialReference:n}=r;return{type:"feature",engine:new i({view:r,options:s,spatialReference:n})}}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:i}=this.options,r=e*i;return r*r}snap(e){return ELt(e)?this._snapMultiPoint(e):this._snapSinglePoint(e)}update(e){const{point:i,context:r}=e;this._removeVisualization();const s=this._currentMainCandidate;if(s==null)return i;const n=this._selectUpdateInput(e);if(n==null)return i;const{spatialReference:a}=r,o=zo(n,a);if(o==null)return i;const{view:l}=this,{elevationInfo:c,visualizer:h}=r,f=[],y=wP(o,l,c),_=s.constraint.closestTo(y);if(!this._arePointsWithinScreenThreshold(y,_,r)||!RH(s,r.drawConstraints))return this._resetSnappingState(),i;s.targetPoint=CH(_),f.push(...s.hints);for(const w of this._currentOtherActiveCandidates)RH(w,r.drawConstraints)&&(w.targetPoint=CH(_),f.push(...w.hints));return h!=null&&this.addHandles(h.draw(f,{spatialReference:a,elevationInfo:ALt(r),view:l,selfSnappingZ:r.selfSnappingZ}),PH),b1e(_,l,i,r)}doneSnapping(){this._removeVisualization(),this._resetSnappingState()}_selectUpdateInput({point:e,scenePoint:i}){switch(this._currentSnappedType){case 0:return e;case 1:return i}}_resetSnappingState(){this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=0}_removeVisualization(){this.removeHandles(PH)}async _snapSinglePoint({point:e,context:i,signal:r}){const{view:s}=this,{elevationInfo:n}=i,a=wP(e,s,n),o=await this._fetchCandidates(a,3,i,r);return this._createSnapResult(a,0,o,s,e,i,r)}async _snapMultiPoint({point:e,scenePoint:i,context:r,signal:s}){const{view:n}=this,{coordinateHelper:a,elevationInfo:o,spatialReference:l}=r;await wp(i.spatialReference,l);const c=zo(i,l),h=wP(c,n,o),f=await this._fetchCandidates(h,1,r,s);if(f.length>0){const w=await this._fetchCandidates(h,2,r,s);return this._createSnapResult(h,1,[...f,...w],n,c,r,s)}const y=wP(e,n,o),_=await this._fetchCandidates(y,2,r,s);return this._createSnapResult(y,0,_,n,{z:a.hasZ()&&e.hasZ?e.z??0:void 0,m:a.hasM()&&e.hasM?e.m??0:void 0},r,s)}async _fetchCandidates(e,i,r,s){return(await Promise.all(this._engines.map(n=>n.fetchCandidates(e,i,r,s)))).flat()}_createSnapResult(e,i,r,s,n,a,o){return{get valid(){return!Rn(o)},apply:()=>{const{spatialReference:l}=a,{snappedPoint:c,hints:h}=this._processCandidates(e,i,r,a);return this._removeVisualization(),a.visualizer!=null&&this.addHandles(a.visualizer.draw(h,{spatialReference:l,elevationInfo:Jx,view:s,selfSnappingZ:a.selfSnappingZ}),PH),b1e(c,s,n,a)}}}_processCandidates(e,i,r,s){if(r.length<1)return this.doneSnapping(),{snappedPoint:e,hints:[]};this._currentSnappedType!==i&&this._resetSnappingState(),p5t(e,r);const n=this._currentMainCandidate;if(n!=null){const a=MLt(n,r);if(a>=0){if(!(r[a]instanceof dN))return this._intersectWithOtherCandidates(a,r,e,i,s);if(this._arePointsWithinScreenThreshold(e,n.targetPoint,s))return this._updateSnappingCandidate(n,i,r,s)}}return this._intersectWithOtherCandidates(0,r,e,i,s)}_intersectWithOtherCandidates(e,i,r,s,n){const{coordinateHelper:a}=n,o=i[e],l=[];for(let c=0;c<i.length;++c){if(c===e)continue;const h=i[c],f=o.constraint.intersect(h.constraint);if(f)for(const y of f.closestPoints(o.targetPoint))l.push([new dN(CH(y),o,h,h.isDraped),this._squaredScreenDistance(r,y,a)])}return l.length>0&&(l.sort((c,h)=>c[1]-h[1]),l[0][1]<this._squaredPointProximityThreshold(n.pointer))?this._updateSnappingCandidate(l[0][0],s,i,n):RH(o,n.drawConstraints)?this._updateSnappingCandidate(o,s,i,n):{snappedPoint:r,hints:[]}}_updateSnappingCandidate(e,i,r,s){this.doneSnapping(),this._currentMainCandidate=e,this._currentSnappedType=i;const n=this._currentMainCandidate.targetPoint,a=[];a.push(...e.hints);for(const o of r){if(e instanceof dN){if(o.constraint.equals(e.first.constraint)||o.constraint.equals(e.second.constraint))continue}else if(o.constraint.equals(e.constraint))continue;const l=o.constraint.closestTo(n);this._squaredScreenDistance(l,n,s.coordinateHelper)<CLt()&&(o.targetPoint=n,this._currentOtherActiveCandidates.push(o),a.push(...o.hints))}return{snappedPoint:n,hints:a}}_squaredPointProximityThreshold(e){return e==="touch"?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}_arePointsWithinScreenThreshold(e,i,r){return this._squaredScreenDistance(e,i,r.coordinateHelper)<this._squaredPointProximityThreshold(r.pointer)}_squaredScreenDistance(e,i,r){return fze(this._toScreen(e,r),this._toScreen(i,r))}_toScreen(e,i){return dLt(e,i.spatialReference,Jx,this.view)}get test(){}};d([m({constructOnly:!0})],Bd.prototype,"view",void 0),d([m()],Bd.prototype,"options",void 0),d([m({readOnly:!0})],Bd.prototype,"updating",null),d([m()],Bd.prototype,"_loadTask",void 0),d([m()],Bd.prototype,"_engines",void 0),d([m()],Bd.prototype,"_squaredMouseProximityThreshold",null),d([m()],Bd.prototype,"_squaredTouchProximityThreshold",null),Bd=d([k("esri.views.interactive.snapping.SnappingManager")],Bd);const PH="visualization-handle";function CLt(){return OV.satisfiesConstraintScreenThreshold*OV.satisfiesConstraintScreenThreshold}function RH(t,e){return!e||e.direction==null&&e.distance==null||!(t instanceof eLt||t instanceof tLt||t instanceof rLt||t instanceof nLt||t instanceof oLt)&&(!(t instanceof aLt)||e.direction==null&&t.selfSnappingType===1)}function MLt(t,e){return t instanceof dN?DH(e,t.first)>=0&&DH(e,t.second)>=0?0:-1:DH(e,t)}function DH(t,e){let i=-1;for(let r=0;r<t.length;++r)if(e.constraint.equals(t[r].constraint)){i=r;break}return i}function ELt(t){return t.scenePoint!=null}function ALt({coordinateHelper:t,elevationInfo:e}){return t.hasZ()?Jx:e}function IJ(t,e,i){i=i||2;var r,s,n,a,o,l,c,h=e&&e.length,f=h?e[0]*i:t.length,y=qze(t,0,f,i,!0),_=[];if(!y||y.next===y.prev)return _;if(h&&(y=ILt(t,e,y,i)),t.length>80*i){r=n=t[0],s=a=t[1];for(var w=i;w<f;w+=i)(o=t[w])<r&&(r=o),(l=t[w+1])<s&&(s=l),o>n&&(n=o),l>a&&(a=l);c=(c=Math.max(n-r,a-s))!==0?1/c:0}return AD(y,_,i,r,s,c),_}function qze(t,e,i,r,s){var n,a;if(s===zJ(t,e,i,r)>0)for(n=e;n<i;n+=r)a=E1e(n,t[n],t[n+1],a);else for(n=i-r;n>=e;n-=r)a=E1e(n,t[n],t[n+1],a);if(a&&uB(a,a.next)){var o=a.next;PD(a),a=o}return a}function kv(t,e){if(!t)return t;e||(e=t);var i,r=t;do if(i=!1,r.steiner||!uB(r,r.next)&&dn(r.prev,r,r.next)!==0)r=r.next;else{var s=r.prev;if(PD(r),(r=e=s)===r.next)break;i=!0}while(i||r!==e);return e}function AD(t,e,i,r,s,n,a){if(t){!a&&n&&NLt(t,r,s,n);for(var o,l,c=t;t.prev!==t.next;)if(o=t.prev,l=t.next,n?PLt(t,r,s,n):OLt(t))e.push(o.i/i),e.push(t.i/i),e.push(l.i/i),PD(t),t=l.next,c=l.next;else if((t=l)===c){a?a===1?AD(t=RLt(kv(t),e,i),e,i,r,s,n,2):a===2&&DLt(t,e,i,r,s,n):AD(kv(t),e,i,r,s,n,1);break}}}function OLt(t){var e=t.prev,i=t,r=t.next;if(dn(e,i,r)>=0)return!1;for(var s=t.next.next;s!==t.prev;){if(B3(e.x,e.y,i.x,i.y,r.x,r.y,s.x,s.y)&&dn(s.prev,s,s.next)>=0)return!1;s=s.next}return!0}function PLt(t,e,i,r){var s=t.prev,n=t,a=t.next;if(dn(s,n,a)>=0)return!1;for(var o=s.x<n.x?s.x<a.x?s.x:a.x:n.x<a.x?n.x:a.x,l=s.y<n.y?s.y<a.y?s.y:a.y:n.y<a.y?n.y:a.y,c=s.x>n.x?s.x>a.x?s.x:a.x:n.x>a.x?n.x:a.x,h=s.y>n.y?s.y>a.y?s.y:a.y:n.y>a.y?n.y:a.y,f=LJ(o,l,e,i,r),y=LJ(c,h,e,i,r),_=t.prevZ,w=t.nextZ;_&&_.z>=f&&w&&w.z<=y;){if(_!==t.prev&&_!==t.next&&B3(s.x,s.y,n.x,n.y,a.x,a.y,_.x,_.y)&&dn(_.prev,_,_.next)>=0||(_=_.prevZ,w!==t.prev&&w!==t.next&&B3(s.x,s.y,n.x,n.y,a.x,a.y,w.x,w.y)&&dn(w.prev,w,w.next)>=0))return!1;w=w.nextZ}for(;_&&_.z>=f;){if(_!==t.prev&&_!==t.next&&B3(s.x,s.y,n.x,n.y,a.x,a.y,_.x,_.y)&&dn(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;w&&w.z<=y;){if(w!==t.prev&&w!==t.next&&B3(s.x,s.y,n.x,n.y,a.x,a.y,w.x,w.y)&&dn(w.prev,w,w.next)>=0)return!1;w=w.nextZ}return!0}function RLt(t,e,i){var r=t;do{var s=r.prev,n=r.next.next;!uB(s,n)&&Gze(s,r,r.next,n)&&OD(s,n)&&OD(n,s)&&(e.push(s.i/i),e.push(r.i/i),e.push(n.i/i),PD(r),PD(r.next),r=t=n),r=r.next}while(r!==t);return kv(r)}function DLt(t,e,i,r,s,n){var a=t;do{for(var o=a.next.next;o!==a.prev;){if(a.i!==o.i&&BLt(a,o)){var l=Hze(a,o);return a=kv(a,a.next),l=kv(l,l.next),AD(a,e,i,r,s,n),void AD(l,e,i,r,s,n)}o=o.next}a=a.next}while(a!==t)}function ILt(t,e,i,r){var s,n,a,o=[];for(s=0,n=e.length;s<n;s++)(a=qze(t,e[s]*r,s<n-1?e[s+1]*r:t.length,r,!1))===a.next&&(a.steiner=!0),o.push(ULt(a));for(o.sort(LLt),s=0;s<o.length;s++)i=kv(i=kLt(o[s],i),i.next);return i}function LLt(t,e){return t.x-e.x}function IH(t){if(t.next.prev===t)return t;let e=t;for(;;){const i=e.next;if(i.prev===e||i===e||i===t)break;e=i}return e}function kLt(t,e){var i=zLt(t,e);if(!i)return e;var r=Hze(i,t),s=kv(i,i.next);let n=IH(r);return kv(n,n.next),s=IH(s),IH(e===i?s:e)}function zLt(t,e){var i,r=e,s=t.x,n=t.y,a=-1/0;do{if(n<=r.y&&n>=r.next.y&&r.next.y!==r.y){var o=r.x+(n-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(o<=s&&o>a){if(a=o,o===s){if(n===r.y)return r;if(n===r.next.y)return r.next}i=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!i)return null;if(s===a)return i;var l,c=i,h=i.x,f=i.y,y=1/0;r=i;do s>=r.x&&r.x>=h&&s!==r.x&&B3(n<f?s:a,n,h,f,n<f?a:s,n,r.x,r.y)&&(l=Math.abs(n-r.y)/(s-r.x),OD(r,t)&&(l<y||l===y&&(r.x>i.x||r.x===i.x&&FLt(i,r)))&&(i=r,y=l)),r=r.next;while(r!==c);return i}function FLt(t,e){return dn(t.prev,t,e.prev)<0&&dn(e.next,t,t.next)<0}function NLt(t,e,i,r){var s=t;do s.z===null&&(s.z=LJ(s.x,s.y,e,i,r)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==t);s.prevZ.nextZ=null,s.prevZ=null,VLt(s)}function VLt(t){var e,i,r,s,n,a,o,l,c=1;do{for(i=t,t=null,n=null,a=0;i;){for(a++,r=i,o=0,e=0;e<c&&(o++,r=r.nextZ);e++);for(l=c;o>0||l>0&&r;)o!==0&&(l===0||!r||i.z<=r.z)?(s=i,i=i.nextZ,o--):(s=r,r=r.nextZ,l--),n?n.nextZ=s:t=s,s.prevZ=n,n=s;i=r}n.nextZ=null,c*=2}while(a>1);return t}function LJ(t,e,i,r,s){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*s)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*s)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function ULt(t){var e=t,i=t;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==t);return i}function B3(t,e,i,r,s,n,a,o){return(s-a)*(e-o)-(t-a)*(n-o)>=0&&(t-a)*(r-o)-(i-a)*(e-o)>=0&&(i-a)*(n-o)-(s-a)*(r-o)>=0}function BLt(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!jLt(t,e)&&(OD(t,e)&&OD(e,t)&&qLt(t,e)&&(dn(t.prev,t,e.prev)||dn(t,e.prev,e))||uB(t,e)&&dn(t.prev,t,t.next)>0&&dn(e.prev,e,e.next)>0)}function dn(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function uB(t,e){return t.x===e.x&&t.y===e.y}function Gze(t,e,i,r){var s=Dk(dn(t,e,i)),n=Dk(dn(t,e,r)),a=Dk(dn(i,r,t)),o=Dk(dn(i,r,e));return s!==n&&a!==o||!(s!==0||!Rk(t,i,e))||!(n!==0||!Rk(t,r,e))||!(a!==0||!Rk(i,t,r))||!(o!==0||!Rk(i,e,r))}function Rk(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function Dk(t){return t>0?1:t<0?-1:0}function jLt(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&Gze(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}function OD(t,e){return dn(t.prev,t,t.next)<0?dn(t,e,t.next)>=0&&dn(t,t.prev,e)>=0:dn(t,e,t.prev)<0||dn(t,t.next,e)<0}function qLt(t,e){var i=t,r=!1,s=(t.x+e.x)/2,n=(t.y+e.y)/2;do i.y>n!=i.next.y>n&&i.next.y!==i.y&&s<(i.next.x-i.x)*(n-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next;while(i!==t);return r}function Hze(t,e){var i=new kJ(t.i,t.x,t.y),r=new kJ(e.i,e.x,e.y),s=t.next,n=e.prev;return t.next=e,e.prev=t,i.next=s,s.prev=i,r.next=i,i.prev=r,n.next=r,r.prev=n,r}function E1e(t,e,i,r){var s=new kJ(t,e,i);return r?(s.next=r.next,s.prev=r,r.next.prev=s,r.next=s):(s.prev=s,s.next=s),s}function PD(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function kJ(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function zJ(t,e,i,r){for(var s=0,n=e,a=i-r;n<i;n+=r)s+=(t[a]-t[n])*(t[n+1]+t[a+1]),a=n;return s}IJ.deviation=function(t,e,i,r){var s=e&&e.length,n=s?e[0]*i:t.length,a=Math.abs(zJ(t,0,n,i));if(s)for(var o=0,l=e.length;o<l;o++){var c=e[o]*i,h=o<l-1?e[o+1]*i:t.length;a-=Math.abs(zJ(t,c,h,i))}var f=0;for(o=0;o<r.length;o+=3){var y=r[o]*i,_=r[o+1]*i,w=r[o+2]*i;f+=Math.abs((t[y]-t[w])*(t[_+1]-t[y+1])-(t[y]-t[_])*(t[w+1]-t[y+1]))}return a===0&&f===0?0:Math.abs((f-a)/a)},IJ.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},r=0,s=0;s<t.length;s++){for(var n=0;n<t[s].length;n++)for(var a=0;a<e;a++)i.vertices.push(t[s][n][a]);s>0&&(r+=t[s-1].length,i.holes.push(r))}return i};function fne(t){return WD(t)?ly(t)||Fu(t)||RR(t)||IR(t)?UYe:t:Sv(t)}function GLt(t,e=IV()){return Wze(t,e)}function HLt(t,e=IV()){return Wze(t,e,!1)}function Wze(t,e,i=t.hasZ){const r=fne(t.spatialReference),s=B7e(r);if(s==null)return null;const n=(o,l)=>!(l.length<2)&&(ve(o,l[0],l[1],i&&l[2]||0),!0);let a=0;for(const o of t.rings){const l=o.length;if(l<3)continue;const{positionsWorldCoords:c}=e;for(;c.length<l;)c.push(R());const h=WLt,f=ve(ZLt,0,0,0),y=1/l;for(let x=0;x<l;x++){if(!n(h,o[x])||!ja(h,t.spatialReference,c[x],r))return null;Tr(f,f,c[x],y)}const _=Su(c[0],c[1],f,V3e());if(On(_)===0)continue;for(let x=0;x<l;x++)hXe(_,f,c[x],c[x]);const w=YLt(c);for(let x=0;x<w.length;x+=3)a+=Ggt(c[w[x]],c[w[x+1]],c[w[x+2]])}return y8(a,s)}const WLt=R(),ZLt=R();function IV(){return{positionsWorldCoords:[]}}function YLt(t){return IJ(QLt(t),[],2)}function QLt(t){const e=new Float64Array(2*t.length);for(let i=0;i<t.length;++i){const r=t[i],s=2*i;e[s]=r[0],e[s+1]=r[1]}return e}const XLt=t=>({geodesicArea(e){const{spatialReference:i}=e;return pne(i,KLt,r=>ekt(t,r),e)}});async function JLt(){const t=await te(()=>import("./geometryEngine-CezsK1kp.js"),__vite__mapDeps([389,10,11]));return XLt(t)}function KLt(t){return y8(Math.abs(j4t([t],"square-meters")[0]),"square-meters")}function ekt(t,e){try{return y8(Math.abs(t.geodesicArea(e,"square-meters")),"square-meters")}catch{return null}}const tkt=t=>({autoAreaByElevationMode(e,i,r=IV()){if(i==="on-the-ground"){const s=t.geodesicArea(e);return s??HLt(e,r)}return GLt(e,r)},autoArea2D(e,i=IV()){return this.autoAreaByElevationMode(e,"on-the-ground",i)}});let LH=null;async function Ik(){return LH||(LH=tkt(await JLt())),LH}function ikt(t){return rkt(t)}function rkt(t,e){const{hasZ:i,spatialReference:r}=t,s=fne(r);let n=0;const a=e2e(s);if(a==null)return null;const o=mne;for(const l of t.paths){if(l.length<2)continue;const c=l.length-1;for(let h=0;h<c;++h){const f=l[h];Sa[0]=f[0],Sa[1]=f[1],Sa[2]=i?f[2]:0;const y=l[h+1];Ta[0]=y[0],Ta[1]=y[1],Ta[2]=i?y[2]:0;const _=o(Sa,Ta,r);if(_==null)return null;n+=_.value}}return Iu(n,a)}function Tai(t,e){const{spatialReference:i}=t;return fs(i,e.spatialReference)?(Sa[0]=t.x,Sa[1]=t.y,Sa[2]=t.hasZ?t.z:0,Ta[0]=e.x,Ta[1]=e.y,Ta[2]=e.hasZ?e.z:0,akt(Sa,Ta,i)):null}function $ai(t,e){const{spatialReference:i}=t;return fs(i,e.spatialReference)?(Sa[0]=t.x,Sa[1]=t.y,Sa[2]=t.hasZ?t.z:0,Ta[0]=e.x,Ta[1]=e.y,Ta[2]=e.hasZ?e.z:0,okt(Sa,Ta,i)):null}function skt(t,e){const{spatialReference:i}=t;return fs(i,e.spatialReference)?(Sa[0]=t.x,Sa[1]=t.y,Sa[2]=t.hasZ?t.z:0,Ta[0]=e.x,Ta[1]=e.y,Ta[2]=e.hasZ?e.z:0,mne(Sa,Ta,i)):null}function Cai(t,e){const{spatialReference:i}=t;return fs(i,e.spatialReference)?(Sa[0]=t.x,Sa[1]=t.y,Sa[2]=t.hasZ?t.z:0,Ta[0]=e.x,Ta[1]=e.y,Ta[2]=e.hasZ?e.z:0,lkt(Sa,Ta,i)):null}function Mai(t){return t!=null?nkt(t.hasZ?t.z:0,t.spatialReference):null}function nkt(t,e){const i=t2e(e);return i!=null?Iu(t??0,i):null}function akt(t,e,i){const r=hB(t,e,i);return r!=null?{direct:Iu(r.direct,r.unit),horizontal:Iu(r.horizontal,r.unit),vertical:Iu(r.vertical,r.unit)}:null}function okt(t,e,i){const r=hB(t,e,i,0);return r!=null?Iu(r.direct,r.unit):null}function mne(t,e,i){const r=hB(t,e,i,1);return r!=null?Iu(r.horizontal,r.unit):null}function lkt(t,e,i){const r=hB(t,e,i,2);return r!=null?Iu(r.verticalSigned,r.unit):null}function hB(t,e,i,r){const s=fne(i),n=e2e(s);if(n==null)return null;const a=e[2]-t[2];if(r===2)return{verticalSigned:a,unit:n};if(!ja(t,i,kH,s)||!ja(e,i,Lk,s))return null;if(r===0)return{direct:Ri(Lk,kH),unit:n};if(ve(kk,t[0],t[1],e[2]),!ja(kk,i,kk,s))return null;const o=Ri(kk,Lk);return r===1?{horizontal:o,unit:n}:{direct:Ri(Lk,kH),horizontal:o,vertical:Math.abs(a),unit:n}}const Sa=R(),Ta=R(),kH=R(),Lk=R(),kk=R();function ckt(t){return{autoLength2D:e=>t.geodesicLength(e)??ikt(e),autoDistanceBetweenPoints2D:(e,i)=>t.geodesicDistanceBetweenPoints(e,i)??skt(e,i),autoDistance2D:(e,i,r)=>(VA[0]=e[0],VA[1]=e[1],VA[2]=e.length===3?e[2]:0,UA[0]=i[0],UA[1]=i[1],UA[2]=i.length===3?i[2]:0,t.geodesicDistance(VA,UA,r)??mne(VA,UA,r))}}async function W1(){return ckt(await jze())}const VA=R(),UA=R();class Zze{constructor(e){this.layer=e}get elevationInfo(){return this.layer.elevationInfo}add(e){this.layer.add(e)}addMany(e){this.layer.addMany(e)}onGraphicsChange(e){const{layer:i}=this;return Ys(()=>i.graphics,"change",r=>e(r))}has(e){return e.layer===this.layer}remove(e){this.layer.remove(e)}removeMany(e){this.layer.removeMany(e)}removeAll(){this.layer.removeAll()}}d([m()],Zze.prototype,"elevationInfo",null);let Yze=class{constructor(e){this.layer=e}get elevationInfo(){}add(e,i){(this._getSublayerForCreateTool(i)??this._getSublayerForGraphic(e))?.add(e)}addMany(e,i){if(i){const r=this._getSublayerForCreateTool(i);if(r)return void r.addMany(e)}e.forEach(r=>this._getSublayerForGraphic(r)?.add(r))}onGraphicsChange(e){const{layer:i}=this;if(i.sublayers?.length)return qu(i.sublayers?.toArray().map(r=>Ys(()=>r.graphics,"change",s=>e(s))))}has(e){const{layer:i}=this;return e.layer===i||e.sourceLayer===i||!!i.sublayers?.some(r=>e.layer===r||e.sourceLayer===r)}remove(e){this._getSublayerForGraphic(e)?.remove(e)}removeMany(e){e.forEach(i=>this._getSublayerForGraphic(i)?.remove(i))}removeAll(){this.layer.sublayers?.forEach(e=>e.removeAll())}_getSublayerForCreateTool(e){const{layer:i}=this;switch(e){case"point":return i.pointLayer;case"polyline":return i.polylineLayer;case"polygon":return i.polygonLayer;case"multipoint":return i.multipointLayer;case"text":return i.textLayer}}_getSublayerForGraphic(e){const{layer:i}=this;if(e?.geometry)switch(e.geometry.type){case"point":return e.symbol?.type==="text"?i.textLayer:i.pointLayer;case"polyline":return i.polylineLayer;case"polygon":return i.polygonLayer;case"multipoint":return i.multipointLayer}}};d([m()],Yze.prototype,"elevationInfo",null);let $o=class extends Uc{constructor(e){super(e),this.cancelled=!1,this.history={undo:[],redo:[]},this.type=null}get tool(){const{activeComponent:e}=this;if(!e)return null;switch(e.type){case"graphic-mover":case"move-3d":return"move";case"box":case"transform-3d":return"transform";case"reshape":case"reshape-3d":return"reshape";case"draw-2d":return e.graphicSymbol?.type==="text"?"text":e.geometryType;case"draw-3d":return e.geometryType}return null}addToHistory(e){this.history.redo=[],this.history.undo.push(e)}resetHistory(){this.history.redo=[],this.history.undo=[]}canUndo(){return this.history.undo.length>0}canRedo(){return this.history.redo.length>0}complete(){this._reset(),this.onEnd(),this.emit("complete")}cancel(){this.cancelled=!0,this.complete()}_reset(){this.activeComponent?.reset()}refreshComponent(){const e=this.activeComponent;e&&(e.type!=="box"&&e.type!=="reshape"&&e.type!=="graphic-mover"||e.refresh())}set undo(e){this._set("undo",()=>{this.canUndo()&&e()})}set redo(e){this._set("redo",()=>{this.canRedo()&&e()})}};d([m()],$o.prototype,"activeComponent",void 0),d([m()],$o.prototype,"cancelled",void 0),d([m()],$o.prototype,"history",void 0),d([m()],$o.prototype,"tool",null),d([m()],$o.prototype,"type",void 0),d([m()],$o.prototype,"canUndo",null),d([m()],$o.prototype,"canRedo",null),d([m()],$o.prototype,"onEnd",void 0),d([m()],$o.prototype,"undo",null),d([m()],$o.prototype,"redo",null),d([m()],$o.prototype,"toggleTool",void 0),d([m()],$o.prototype,"addToSelection",void 0),d([m()],$o.prototype,"removeFromSelection",void 0),$o=d([k("esri.widgets.Sketch.support.OperationHandle")],$o);let pN=class extends $o{};d([m()],pN.prototype,"activeComponent",void 0),pN=d([k("esri.widgets.Sketch.support.OperationHandle.CreateOperationHandle")],pN);let Lg=class extends $o{};d([m()],Lg.prototype,"activeComponent",void 0),Lg=d([k("esri.widgets.Sketch.support.OperationHandle.UpdateOperationHandle")],Lg);function ukt(t,e){return e==="freehandPolygon"||e==="freehandPolyline"?"freehand":t??(e==="rectangle"||e==="circle"?"hybrid":"click")}function hkt(t){switch(t){case"freehandPolygon":return"polygon";case"freehandPolyline":return"polyline";case"text":return"point";default:return t}}function A1e(t){if(t.length>1)return!1;const e=t.at(0)?.geometry;return e?.type==="point"||e?.type==="multipoint"&&e.points.length<2}const O1e={defaultZ:0},BA={reshapeOptions:{edgeOperation:"split",shapeOperation:"move",vertexOperation:"move"},enableMoveAllGraphics:!0,enableRotation:!0,enableScaling:!0,multipleSelectionEnabled:!0,preserveAspectRatio:!1,toggleToolOnClick:!0,enableZ:!0,highlightOptions:{enabled:!0,name:Tp},tool:"transform"},zH=Symbol(),P1e=Symbol();let rr=class extends Uc{constructor(t){super(t),this._defaultSnappingManager=null,this._internalGraphicsLayer=new vf({listMode:"hide",internal:!0,title:"SVM Internal"}),this._operationHandle=null,this._updatingHandles=new mp,this._viewHandlesKey="viewHandles",this.activeFillSymbol=null,this.activeLineSymbol=null,this.activeVertexSymbol=null,this.allowDeleteKey=!0,this.layer=null,this.pointSymbol=new Rl({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.polygonSymbol=new Mf({color:[150,150,150,.2],outline:{color:[50,50,50],width:2}}),this.polylineSymbol=new Oo({color:[130,130,130,1],width:2}),this.meshSymbol=new O_({symbolLayers:new He([new Sc])}),this.textSymbol=new Kr({text:"text"}),this.updateGraphics=new He,this.updateOnGraphicClick=!0,this.creationMode="single",this.vertexSymbol=new Rl({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.sketchOptions=new dze,this._moduleLoaderAbortController=null,this._viewReadyAbortController=null,this._sketchContinuationFlag=!1,this._onLayerAdapterChange=async()=>{const{_layerAdapter:e}=this;if(this.removeHandles(P1e),!e)return;const i=[e.onGraphicsChange(r=>this._onLayerGraphicsChangeCallback(r)),K(()=>e.elevationInfo,r=>{r!==this._internalGraphicsLayer.elevationInfo&&(this.cancel(),this._internalGraphicsLayer.elevationInfo=r)},At)].filter(qf);this.addHandles(i,P1e)},this._originalPopupEnabled=null,this.defaultCreateOptions=O1e,this.defaultUpdateOptions=BA,this.snappingOptions=t?.snappingManager?.options??t?.snappingOptions??new ma}initialize(){this.addHandles([Ys(()=>this.view?.map?.layers,"change",t=>{this.layer&&t.removed.includes(this.layer)&&this.cancel()}),K(()=>this._layerAdapter,()=>this._onLayerAdapterChange(),At),K(()=>this.view,t=>{this._defaultSnappingManager=Re(this._defaultSnappingManager),t&&(this.snappingManager||(this._defaultSnappingManager=new Bd({view:t,options:this.snappingOptions})),t.type==="2d"?te(()=>import("./editingTools-BwzpzWIp.js"),__vite__mapDeps([390,391,307,308,392,353,354,125,298,355,238,326,327,328,329,330,331,332,64,333,334,335,336,337,55,266,356,310,267,268,269,47,313,314,127,54,393,57,25,394])):t.type==="3d"&&(te(()=>import("./editingTools-WbUUs8iX.js"),__vite__mapDeps([395,298,300,302,303,304,296,305,306,295,258,297,207,307,308,322,301,323,324,325,30,318,396,392,353,354,125,355,238,326,327,328,329,330,331,332,64,333,334,335,336,337,55,266,356,310,267,268,269,47,313,314,342,350,309,397,398,126,127,54,345,346,344,208,317,347,206,399,393,57,25])),te(()=>import("./GraphicsLayerView3D-CQLAnRDF.js"),__vite__mapDeps([253,192,239,254,47,241,99,224,98,81,74,100,101,57,25,102,21,199,242,226,200,227]))))},At),K(()=>this.view?.spatialReference,(t,e)=>{t&&e&&!t.equals(e)&&this.cancel()})]),m5t(this)}destroy(){this.cancel(),this._removeDefaultLayer(),this._defaultSnappingManager=Re(this._defaultSnappingManager),this._set("snappingManager",null),this._set("view",null),this._updatingHandles.destroy(),this.emit("destroy")}get _layerAdapter(){const{layer:t}=this;switch(t?.type){case"graphics":return new Zze(t);case"map-notes":return new Yze(t);default:return null}}get activeTool(){return this._operationHandle?.tool??null}get activeCreateToolDrawMode(){return this._operationHandle?.type==="create"&&this._operationHandle.activeComponent&&"mode"in this._operationHandle.activeComponent?this._operationHandle.activeComponent.mode:null}get activeTooltip(){const{activeComponent:t,destroyed:e}=this,i=!e&&t&&"tooltip"in t?t.tooltip:null;return i?.visible?i:null}get activeComponent(){return this._operationHandle?.activeComponent??null}get createGraphic(){return this.activeComponent==null||this.activeComponent.type!=="draw-3d"&&this.activeComponent.type!=="draw-2d"?this._get("createGraphic"):this.activeComponent.graphic}get defaultCreateOptions(){return this._get("defaultCreateOptions")}set defaultCreateOptions(t){this._set("defaultCreateOptions",{...O1e,...t})}get defaultUpdateOptions(){return this._get("defaultUpdateOptions")}set defaultUpdateOptions(t){this._set("defaultUpdateOptions",{...BA,...t,reshapeOptions:{...BA.reshapeOptions,...t?.reshapeOptions},highlightOptions:{...BA.highlightOptions,...t?.highlightOptions}})}get labelOptions(){return this.sketchOptions.labels}set labelOptions(t){this.sketchOptions.labels=t}get snappingOptions(){return this.snappingManager?.options??this._get("snappingOptions")}set snappingOptions(t){this._defaultSnappingManager!=null&&(this._defaultSnappingManager.options=t),this._set("snappingOptions",t)}get snappingManager(){return this._isOverridden("snappingManager")&&this._get("snappingManager"),this._defaultSnappingManager}set snappingManager(t){if(t)this._isOverridden("snappingManager")||(this._defaultSnappingManager=Re(this._defaultSnappingManager)),this._override("snappingManager",t);else{const{view:e}=this;!this._defaultSnappingManager&&e&&(this._defaultSnappingManager=new Bd({options:this.snappingOptions,view:e})),this._clearOverride("snappingManager")}}get state(){const t=!(!this.view?.ready||!this.layer),e=this._operationHandle;return t&&e?"active":t?"ready":"disabled"}get tooltipOptions(){return this.sketchOptions.tooltips}set tooltipOptions(t){this.sketchOptions.tooltips=t}get updating(){return!(!this._updatingHandles.updating&&!this.snappingManager?.updating)}get valueOptions(){return this.sketchOptions.values}set valueOptions(t){this.sketchOptions.values=t}get view(){return this._get("view")}set view(t){const e=this._get("view");if(e){const{container:r,map:s}=e;r&&this._clearCursor(),s?.remove(this._internalGraphicsLayer),this.removeHandles(this._viewHandlesKey),this.cancel()}const i="view-ready";this.removeHandles(i),t&&this.addHandles(Zs(()=>t.ready,r=>{this.removeHandles(this._viewHandlesKey),r&&this.addHandles(this._generateViewHandles(t),this._viewHandlesKey)},At),i),this._set("view",t)}addGraphic(t){this._layerAdapter?.add(t)}addGraphics(t){this._layerAdapter?.addMany(t)}hasGraphic(t){return!!this._layerAdapter?.has(t)}removeGraphic(t){this._layerAdapter?.remove(t)}removeGraphics(t){this._layerAdapter?.removeMany(t)}removeAllGraphics(){this._layerAdapter?.removeAll()}cancel(){this._moduleLoaderAbortController=ps(this._moduleLoaderAbortController),this._viewReadyAbortController=ps(this._viewReadyAbortController),this._sketchContinuationFlag=!0,this._operationHandle&&this._operationHandle.cancel()}complete(){this._operationHandle?.complete()}delete(){const{state:t,updateGraphics:e}=this;if(t==="active"&&e.length){const{activeTool:i}=this,r=e.toArray();this.removeGraphics(r),this.cancel(),this._emitDeleteEvent({graphics:r,tool:i})}}duplicate(){if(this.state==="active"&&this.updateGraphics.length){const t=this.updateGraphics.map(e=>e.clone()).toArray();return this.addGraphics(t),this.emit("duplicate",{graphics:t,type:"duplicate"}),t}return[]}async create(t,e){this.cancel(),await this._waitViewReady();const{view:i,layer:r}=this;if(!i||this.state==="disabled")throw r||this._logMissingLayer(),Xt();if(i.activeTool!=null&&(i.activeTool=null),!t)return void this._logError("sketch:missing-parameter","Missing parameter 'tool'.");_1e(i,this._internalGraphicsLayer);const s=await this._updatingHandles.addPromise(this._setupCreateOperation(t,e));if(s==null||this.destroyed)return void i.map?.remove(this._internalGraphicsLayer);const n=()=>{if(s===this._operationHandle){const a=this.createGraphic,o=this._operationHandle.cancelled;if(this._operationHandle.destroy(),this._operationHandle=null,this._set("createGraphic",null),this.view?.map?.remove(this._internalGraphicsLayer),s.cancelled||a==null||this.addGraphic(a),this._sketchContinuationFlag=!1,this.emit("create",{graphic:a,state:o?"cancel":"complete",tool:t,toolEventInfo:null,type:"create"}),o||this._sketchContinuationFlag)return;const{creationMode:l}=this;if(l==="continuous"){if(e?.geometryToPlace)return;this._updatingHandles.addPromise(Hf(this.create(t,e)))}else l==="update"&&a&&this._updatingHandles.addPromise(Hf(this.update([a])))}};s.on("complete",n),this._operationHandle=s,i.ready&&i.focus()}async place(t,e){return await t.load(),this.create("mesh",{mode:"click",hasZ:t.hasZ,geometryToPlace:t,...e})}async update(t,e){this.cancel(),await this._waitViewReady();const{layer:i,view:r,state:s}=this;if(!r||s==="disabled")throw i||this._logMissingLayer(),Xt();r.activeTool!=null&&(r.activeTool=null);const n=Array.isArray(t)?t:[t];if(t==null||!n?.length)return void this._logError("sketch:missing-parameter","Missing parameter 'graphics'.");if(n.some(o=>this.hasGraphic(o)?o.geometry==null&&(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with an unsupported geometry."),!0):(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics missing from the supplied GraphicsLayer."),!0)))return;const a=await this._updatingHandles.addPromise(this._setupUpdateOperation(n,e));this.destroyed||a==null||ha(a)||(_1e(r,this._internalGraphicsLayer),this._setUpdateOperationHandle(a,e),this.emit("update",{graphics:n,state:"start",aborted:!1,tool:a.tool,toolEventInfo:null,type:"update"}))}async _updateSpatialReference(t){const e=this.view;if(e){t=Array.isArray(t)?t:[t];for(const i of t)i.geometry==null||i.geometry.type==="mesh"||fs(i.geometry.spatialReference,e.spatialReference)||(Nu(i.geometry.spatialReference,e.spatialReference)||Gv()||await qx(),i.geometry=zo(i.geometry,e.spatialReference))}else this._logMissingView()}undo(){this.canUndo()&&this._operationHandle?.undo()}redo(){this.canRedo()&&this._operationHandle?.redo()}canUndo(){return!!this._operationHandle?.canUndo()}canRedo(){return!!this._operationHandle?.canRedo()}toggleUpdateTool(){this._operationHandle?.toggleTool()}async _getFirstHit(t){const e=this.view;if(!e)return this._logMissingView(),null;if(e.type==="2d"){const s=[];e.map.allLayers.forEach(a=>{a.type!=="vector-tile"&&a.type!=="imagery"||s.push(a)});const n=await e.hitTest(t,{exclude:s});return hwt(n.results)}const i=[e.map.ground];e.map.allLayers.forEach(s=>{Hx(s)&&i.push(s)});const r=await e.hitTest(t,{exclude:i});if(r.results.length>0){const s=r.results[0];if(s!=null&&s.type==="graphic"&&s.graphic&&(!r.ground.mapPoint||e.map.ground.opacity<1||r.ground.distance-(s.distance??0)>-Math.min(3*r.ground.distance,e.viewingMode==="global"?or(e.renderCoordsHelper.spatialReference).radius/e.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY)))return s}return null}_generateViewHandles(t){return[t.on("immediate-click",async e=>{const i=this.state==="active"&&this._operationHandle?.type==="create";this.state!=="disabled"&&!i&&this.updateOnGraphicClick&&await this._updatingHandles.addPromise(this._handleImmediateClick(e))},Br.WIDGET)]}async _handleImmediateClick(t){const e=await t.defer(()=>this._getFirstHit(Th(t)));let i=null;if(e!=null){const r=e.graphic;this.updateGraphics.includes(r)||this.hasGraphic(r)?(t.stopPropagation(),i=r):this.view?.type!=="2d"||this._isComponentGraphic(r)||this.state!=="active"||this.cancel()}else this.state==="active"&&this.cancel();i==null||this.updateGraphics.includes(i)||await this.update([i],{...this.defaultUpdateOptions,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions}})}async _setupCreateOperation(t,e){const i=this.view;if(!i)return this._logMissingView(),null;const r={hasZ:i.type==="3d",...this.defaultCreateOptions,...e},s=await this._setupDrawGraphicTool(t,i,r);return s==null?null:(i.tools.add(s),i.activeTool=s,this._setupCreateOperationHandle(s,t))}async _setupDrawGraphicTool(t,e,i){if(t==="multipoint"&&e.type==="3d")return this._logError("sketch:create","Multipoint geometries are not supported in SceneView."),null;if(!e)return this._logMissingView(),null;const{cursor:r,defaultZ:s,hasZ:n,geometryToPlace:a,graphicProperties:o,mode:l,preserveAspectRatio:c}=i,h=ukt(l,t),f=hkt(t),y=i?.optionsPerTool?.has(t)?i.optionsPerTool.get(t):{},_=y?.preserveAspectRatio??c??t!=="rectangle",w={centered:t!=="rectangle"&&!(t==="circle"&&!_),cursor:r,defaultZ:s,forceUniformSize:_,graphicProperties:{...o,attributes:{...o?.attributes}},geometryToPlace:a,geometryType:f,mode:h,graphicSymbol:this._getGraphicSymbolFromTool(t),hasZ:n,snappingManager:this.snappingManager,snapToScene:!1,view:e,...y};return e.type==="2d"?this._makeDrawGraphicTool2D(w):this._makeDrawGraphicTool3D(w)}async _makeDrawGraphicTool2D(t){const[e,i,r]=await Promise.all([this._requireModule(te(()=>import("./editingTools-BwzpzWIp.js"),__vite__mapDeps([390,391,307,308,392,353,354,125,298,355,238,326,327,328,329,330,331,332,64,333,334,335,336,337,55,266,356,310,267,268,269,47,313,314,127,54,393,57,25,394]))),Ik(),W1()]);return ha(e)||this.destroyed?null:new e.module.DrawGraphicTool2D({...t,activeVertexSymbol:this.activeVertexSymbol,regularVerticesSymbol:this.vertexSymbol,activeLineSymbol:this.activeLineSymbol,activeFillSymbol:pkt(t.geometryType)?this.activeFillSymbol:null,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:i,automaticLengthMeasurementUtils:r})}async _makeDrawGraphicTool3D(t){const[e,i,r]=await Promise.all([this._requireModule(te(()=>import("./editingTools-WbUUs8iX.js"),__vite__mapDeps([395,298,300,302,303,304,296,305,306,295,258,297,207,307,308,322,301,323,324,325,30,318,396,392,353,354,125,355,238,326,327,328,329,330,331,332,64,333,334,335,336,337,55,266,356,310,267,268,269,47,313,314,342,350,309,397,398,126,127,54,345,346,344,208,317,347,206,399,393,57,25]))),Ik(),W1()]);return ha(e)||this.destroyed?null:new e.module.DrawGraphicTool3D({...t,elevationInfo:this._layerAdapter?.elevationInfo,snapToScene:!0,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:i,automaticLengthMeasurementUtils:r})}_setupCreateOperationHandle(t,e){const i=this.view;if(!i)return this._logMissingView(),null;let r=null;const s=t.forceUniformSize,n=t.centered,a=[i.on("key-down",l=>{if(l.key===yn.pan)l.stopPropagation(),l.repeat||(t.enabled=!1);else if(l.key===yn.complete)l.stopPropagation(),t.completeCreateOperation();else if(l.key!==yn.vertexAdd||l.repeat)l.key===yn.undo?(l.stopPropagation(),o.undo()):l.key===yn.redo?(l.stopPropagation(),o.redo()):l.key!==yn.constraint||t.geometryType!=="rectangle"&&t.geometryType!=="circle"||l.repeat?l.key===yn.center&&(l.repeat||(t.centered=!n,l.stopPropagation())):(t.forceUniformSize=!s,l.stopPropagation());else{const c=t.drawOperation.geometryType;c!=="polyline"&&c!=="polygon"&&c!=="multipoint"||(l.stopPropagation(),t.drawOperation.commitStagedVertex())}},Br.WIDGET),i.on("key-up",l=>{l.key===yn.pan?t.enabled=!0:l.key!==yn.constraint||t.geometryType!=="rectangle"&&t.geometryType!=="circle"?l.key===yn.center&&(t.centered=n,l.stopPropagation()):(t.forceUniformSize=s,l.stopPropagation())},Br.WIDGET),t.on("vertex-add",l=>{switch(r=r==null?"start":"active",l.operation){case"apply":this.emit("create",{graphic:t.graphic,state:r,tool:this.activeTool,toolEventInfo:l,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[t.graphic],tool:t.geometryType});break;case"redo":this._emitRedoEvent({graphics:[t.graphic],tool:t.geometryType})}}),t.on("cursor-update",l=>{t.drawOperation.numCommittedVertices>0&&this.emit("create",{graphic:t.graphic,state:"active",tool:this.activeTool,toolEventInfo:{coordinates:l.vertices[0].coordinates,type:"cursor-update"},type:"create"})}),t.on("vertex-remove",l=>{switch(l.operation){case"apply":this.emit("create",{graphic:t.graphic,state:"active",tool:this.activeTool,toolEventInfo:l,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[t.graphic],tool:t.geometryType});break;case"redo":this._emitRedoEvent({graphics:[t.graphic],tool:t.geometryType})}}),t.on("complete",l=>{this._set("createGraphic",l.graphic),r="complete",l.aborted?o&&o.cancel():o&&o.complete()}),K(()=>this._getGraphicSymbolFromTool(e),l=>{t.graphicSymbol=l})],o=new pN({activeComponent:t,type:"create",onEnd:()=>{Up(a),i.tools?.remove(t)},undo:()=>{t.canUndo&&t.undo()},redo:()=>{t.canRedo&&t.redo()},canUndo:()=>t.canUndo,canRedo:()=>t.canRedo});return o}_getGraphicSymbolFromTool(t){switch(t){case"point":case"multipoint":return this.pointSymbol;case"polyline":case"freehandPolyline":return this.polylineSymbol;case"circle":case"rectangle":case"polygon":case"freehandPolygon":return this.polygonSymbol;case"mesh":return this.meshSymbol;case"text":return this.textSymbol}}async _setupUpdateOperation(t,e){const{view:i}=this;if(!i)return this._logMissingView(),null;const r={...this.defaultUpdateOptions,...e,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions,...e?.reshapeOptions},highlightOptions:{...this.defaultUpdateOptions.highlightOptions,...e?.highlightOptions}};let s=r.tool??BA.tool;if(this.removeGraphics(t),this.addGraphics(t),i.type==="3d"){if(t.length===0)return null;switch(s){case"move":return this._setupMove3DOperation(t,r,i,s);case"reshape":return t.length>1?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupReshape3DOperation(t[0],r,i);case"transform":return this._setupGraphicTransform3DOperation(t,r,i)}}switch(s){case"move":return this._setupMove2DOperation(t,r,i);case"reshape":return t.length>1?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupTransformOrReshape2DOperation(t,s,r,i);case"transform":return A1e(t)&&(s="reshape"),this._setupTransformOrReshape2DOperation(t,s,r,i)}}async _setupMove3DOperation(t,e,i,r,s=!1){const[n,a]=await Promise.all([this._requireModule(te(()=>import("./editingTools-WbUUs8iX.js"),__vite__mapDeps([395,298,300,302,303,304,296,305,306,295,258,297,207,307,308,322,301,323,324,325,30,318,396,392,353,354,125,355,238,326,327,328,329,330,331,332,64,333,334,335,336,337,55,266,356,310,267,268,269,47,313,314,342,350,309,397,398,126,127,54,345,346,344,208,317,347,206,399,393,57,25]))),W1()]);if(ha(n))return n;const{ManipulatedObject3DGraphic:o,MoveTool3D:l}=n.module,c=new Map,h=()=>{c.forEach(w=>w.destroy()),c.clear()};for(const w of t){const x=new o({view:i,graphic:w}),S=s5t(x);if(S!==0)return h(),this._logError("sketch:move",`Move operation not supported for provided graphic(s) (${y1e(S)}).`),null;c.set(w,x)}const f=new l({view:i,enableZ:e.enableZ,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,autoLengthMeasurementUtils:a});i.tools.add(f),f.objects.addMany(Array.from(c.values())),s||this.updateGraphics.addMany(t);const y=[],_=new Lg({activeComponent:f,tool:r,type:"update",onEnd:()=>{Up(y),Nk(i,f),h()},undo:()=>{D1e(this.view,f),zk(_,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:r})},redo:()=>{Fk(_,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:r})},addToSelection:w=>{this.updateGraphics.push(w);const x=new o({view:i,graphic:w});c.set(w,x),f.objects.push(x),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[w],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:w=>{const x=this.updateGraphics.indexOf(w);if(_.history.undo.forEach($=>$.updates.splice(x,1)),_.history.redo.forEach($=>$.updates.splice(x,1)),this.updateGraphics.remove(w),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[w],type:"selection-change"},type:"update"}),this.updateGraphics.length===0)return void _.complete();const S=c.get(w);S&&(f.objects.remove(S),S.destroy(),c.delete(w))},toggleTool:async()=>{if(this.updateGraphics.length!==1||e.toggleToolOnClick===!1||r!=="transform")return;const w=this.updateGraphics.at(0),x=await this._setupReshape3DOperation(w,e,i,!0);x&&!ha(x)&&(_.onEnd(),_.destroy(),this._setUpdateOperationHandle(x,e))}});return y.push(...this._getHandlesForComponent(_,e),i.on("immediate-click",w=>this._getCommonUpdateOperationClickHandlers(_,w,e),Br.WIDGET),i.on("key-down",w=>{this._getCommonUpdateOperationKeyDownHandlers(_,w)},Br.WIDGET)),_}_setupGraphicTransform3DOperation(t,e,i,r=!1){if(t.length===1&&o5t(t[0])===0){const s=t[0],n=s.geometry;if(n!=null&&(n.type==="point"||n.type==="mesh"))return this._setupPointTransform3DOperation(s,e,i);if(n!=null&&(n.type==="polygon"||n.type==="polyline"))return this._setupPolyTransform3DOperation(s,e,i,r)}return this._setupMove3DOperation(t,e,i,"transform",r)}async _setupPointTransform3DOperation(t,e,i){const r="transform",{enableRotation:s,enableScaling:n,enableZ:a}=e,o=await this._requireModule(te(()=>import("./editingTools-WbUUs8iX.js"),__vite__mapDeps([395,298,300,302,303,304,296,305,306,295,258,297,207,307,308,322,301,323,324,325,30,318,396,392,353,354,125,355,238,326,327,328,329,330,331,332,64,333,334,335,336,337,55,266,356,310,267,268,269,47,313,314,342,350,309,397,398,126,127,54,345,346,344,208,317,347,206,399,393,57,25])));if(ha(o))return o;const{TransformTool3D:l,ManipulatedObject3DGraphic:c}=o.module,h=new c({graphic:t,view:i}),f=new l({object:h,view:i,enableRotation:s,enableScaling:n,enableZ:a,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions});i.tools.add(f),this.updateGraphics.add(t);const y=[],_=new Lg({activeComponent:f,tool:r,type:"update",onEnd:()=>{Up(y),Nk(i,f),h.destroy()},undo:()=>{D1e(this.view,f),zk(_,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:r})},redo:()=>{Fk(_,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:r})},addToSelection:async w=>{this.updateGraphics.add(w),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[w],removed:[],type:"selection-change"},type:"update"}),_.onEnd(),_.destroy();const x=await this._setupMove3DOperation(this.updateGraphics.toArray(),e,i,"transform",!0);ha(x)||this._setUpdateOperationHandle(x,e)},removeFromSelection:w=>{this.updateGraphics.remove(w),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[w],type:"selection-change"},type:"update"}),_.complete()},toggleTool:()=>{}});return y.push(...this._getHandlesForComponent(_,e),i.on("immediate-click",w=>this._getCommonUpdateOperationClickHandlers(_,w,e),Br.WIDGET),i.on("key-down",w=>{this._getCommonUpdateOperationKeyDownHandlers(_,w)},Br.WIDGET)),_}async _setupPolyTransform3DOperation(t,e,i,r=!1){const s="transform",{enableRotation:n,enableScaling:a,enableZ:o,preserveAspectRatio:l}=e,[c,h]=await Promise.all([this._requireModule(te(()=>import("./editingTools-WbUUs8iX.js"),__vite__mapDeps([395,298,300,302,303,304,296,305,306,295,258,297,207,307,308,322,301,323,324,325,30,318,396,392,353,354,125,355,238,326,327,328,329,330,331,332,64,333,334,335,336,337,55,266,356,310,267,268,269,47,313,314,342,350,309,397,398,126,127,54,345,346,344,208,317,347,206,399,393,57,25]))),W1()]);if(ha(c))return c;const{ManipulatedObject3DGraphic:f,ExtentTransformTool:y}=c.module,_=this.view?.inputManager?.isModifierKeyDown(yn.constraint),w=new f({view:i,graphic:t}),x=new y({object:w,view:i,enableRotation:n,enableScaling:a,enableZ:o,preserveAspectRatio:!!l!=!!_,sketchOptions:this.sketchOptions,automaticLengthMeasurementUtils:h});i.tools.add(x),r||this.updateGraphics.add(t);const S=[],$=new Lg({activeComponent:x,tool:s,type:"update",onEnd:()=>{Up(S),Nk(i,x),w.destroy()},canUndo:()=>!x.destroyed&&x.canUndo,undo:()=>{x.destroyed||(x.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:s}))},canRedo:()=>!x.destroyed&&x.canRedo,redo:()=>{x.destroyed||(x.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:s}))},addToSelection:async A=>{this.updateGraphics.add(A),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[A],removed:[],type:"selection-change"},type:"update"}),$.onEnd(),$.destroy();const M=await this._setupMove3DOperation(this.updateGraphics.toArray(),e,i,"transform",!0);ha(M)||this._setUpdateOperationHandle(M,e)},removeFromSelection:A=>{this.updateGraphics.remove(A),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[A],type:"selection-change"},type:"update"}),$.complete()},toggleTool:async()=>{if(this.updateGraphics.length!==1||e.toggleToolOnClick===!1)return;const A=await this._setupReshape3DOperation(t,e,i,!0);A&&!ha(A)&&($.onEnd(),$.destroy(),this._setUpdateOperationHandle(A,e))}});return S.push(...this._getHandlesForComponent($,e),i.on("immediate-click",A=>this._getCommonUpdateOperationClickHandlers($,A,e),Br.WIDGET),i.on("key-down",A=>this._getCommonUpdateOperationKeyDownHandlers($,A),Br.WIDGET),i.on("key-down",A=>{A.key!==yn.constraint||A.repeat||(x.preserveAspectRatio=!x.preserveAspectRatio,A.stopPropagation())},Br.WIDGET),i.on("key-up",A=>{A.key===yn.constraint&&(x.preserveAspectRatio=!x.preserveAspectRatio,A.stopPropagation())},Br.WIDGET)),$}async _setupMove2DOperation(t,e,i){const r="move";this.updateGraphics.addMany(t),await this._updatingHandles.addPromise(this._updateSpatialReference(t));const s=await this._getGraphicMover(t,e,i);if(ha(s))return s;const n=new Lg({activeComponent:s,tool:r,type:"update",onEnd:()=>{this._clearCursor(),Up(l),Up(o),s.destroy(),this._internalGraphicsLayer?.removeMany([...this.updateGraphics.toArray()])},undo:()=>{const c=this.updateGraphics.toArray();zk(n,c),n.refreshComponent(),this._emitUndoEvent({graphics:c,tool:r})},redo:()=>{const c=this.updateGraphics.toArray();Fk(n,c),n.refreshComponent(),this._emitRedoEvent({graphics:c,tool:r})},addToSelection:async c=>{await this._updatingHandles.addPromise(this._updateSpatialReference(c)),this.updateGraphics.push(c),s.graphics=this.updateGraphics.toArray(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[c],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:c=>{const h=this.updateGraphics.indexOf(c);n.history.undo.forEach(y=>y.updates.splice(h,1)),n.history.redo.forEach(y=>y.updates.splice(h,1)),this.updateGraphics.remove(c);const f=this.updateGraphics.toArray();this.emit("update",{graphics:f,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[c],type:"selection-change"},type:"update"}),this.updateGraphics.length!==0?s.graphics=f:n.complete()}});let a=!1;const o=[i.on("immediate-click",c=>this._getCommonUpdateOperationClickHandlers(n,c,e),Br.WIDGET),i.on("key-down",c=>{this._getCommonUpdateOperationKeyDownHandlers(n,c),c.key!==yn.constraint||c.repeat||(a=!0,s.enableMoveAllGraphics=!s.enableMoveAllGraphics)},Br.WIDGET),i.on("key-up",c=>{c.key===yn.constraint&&a&&(a=!1,s.enableMoveAllGraphics=!s.enableMoveAllGraphics)},Br.WIDGET)],l=this._getHandlesForComponent(n,e);return n}async _setupReshape3DOperation(t,e,i,r=!1){const s="reshape",[n,a,o]=await Promise.all([this._requireModule(te(()=>import("./editingTools-WbUUs8iX.js"),__vite__mapDeps([395,298,300,302,303,304,296,305,306,295,258,297,207,307,308,322,301,323,324,325,30,318,396,392,353,354,125,355,238,326,327,328,329,330,331,332,64,333,334,335,336,337,55,266,356,310,267,268,269,47,313,314,342,350,309,397,398,126,127,54,345,346,344,208,317,347,206,399,393,57,25]))),Ik(),W1()]);if(ha(n))return n;const{ManipulatedObject3DGraphic:l,ReshapeTool3D:c}=n.module,h=new l({view:i,graphic:t}),f=n5t(h);if(f!==0)return h.destroy(),this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${y1e(f)}).`),null;const y=e.reshapeOptions,_=new c({view:i,object:h,enableZVertex:e.enableZ&&y?.vertexOperation==="move",enableZShape:e.enableZ&&y?.shapeOperation==="move",enableMoveObject:y?.shapeOperation==="move"||y?.shapeOperation==="move-xy",enableMidpoints:y?.edgeOperation==="split",enableEdgeOffset:y?.edgeOperation==="offset",snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:a,automaticLengthMeasurementUtils:o});i.tools.add(_),r||this.updateGraphics.add(h.graphic);const w=[],x=new Lg({activeComponent:_,tool:s,type:"update",onEnd:()=>{Up(w),Nk(i,_),h.destroy()},canUndo:()=>!_.destroyed&&_.canUndo,undo:()=>{_.destroyed||(_.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:s}))},canRedo:()=>!_.destroyed&&_.canRedo,redo:()=>{_.destroyed||(_.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:s}))},addToSelection:async S=>{this.updateGraphics.add(S),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[S],removed:[],type:"selection-change"},type:"update"}),x.onEnd(),x.destroy();const $=await this._setupMove3DOperation(this.updateGraphics.toArray(),e,i,"transform",!0);ha($)||this._setUpdateOperationHandle($,e)},removeFromSelection:S=>{this.updateGraphics.remove(S),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[S],type:"selection-change"},type:"update"}),x.complete()},toggleTool:async()=>{if(e.toggleToolOnClick===!1)return;x.onEnd(),x.destroy();const S=await this._setupGraphicTransform3DOperation(this.updateGraphics.toArray(),e,i,!0);ha(S)||this._setUpdateOperationHandle(S,e)}});return w.push(...this._getHandlesForComponent(x,e),i.on("immediate-click",S=>this._getCommonUpdateOperationClickHandlers(x,S,e),Br.WIDGET),i.on("key-down",S=>{this._getCommonUpdateOperationKeyDownHandlers(x,S)},Br.WIDGET)),x}async _setupTransformOrReshape2DOperation(t,e,i,r){this.updateGraphics.addMany(t),await this._updatingHandles.addPromise(this._updateSpatialReference(t));const s=e==="transform"?await this._getBox(t,i,r):await this._getReshape(t,i,r);if(ha(s))return s;const n=new Lg({activeComponent:s,type:"update",onEnd:()=>{Up(o),Up(a),n.activeComponent&&!n.activeComponent.destroyed&&n.activeComponent.destroy(),this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray())},undo:()=>{zk(n,this.updateGraphics.toArray()),n.refreshComponent(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:n.tool})},redo:()=>{Fk(n,this.updateGraphics.toArray()),n.refreshComponent(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:n.tool})},addToSelection:async l=>{let c=n.activeComponent;if(c?.type==="reshape"){const h=[...this.updateGraphics,l];this.updateGraphics.removeAll(),n.onEnd(),n.destroy();const f=await this._setupTransformOrReshape2DOperation(h,"transform",i,r);if(ha(f))return;this._setUpdateOperationHandle(f,i)}else this.updateGraphics.add(l),c.graphics=this.updateGraphics.toArray(),c.refresh(),n.resetHistory();this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[l],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:l=>{const c=this.updateGraphics.indexOf(l);n.history.undo.forEach(f=>f.updates.splice(c,1)),n.history.redo.forEach(f=>f.updates.splice(c,1)),this.updateGraphics.remove(l);const h=this.updateGraphics.toArray();h.length===0?n.complete():A1e(h)?n.toggleTool():n.activeComponent.graphics=h,this.emit("update",{graphics:h,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[l],type:"selection-change"},type:"update"})},toggleTool:async()=>{if(this.updateGraphics.length>1)return;const l=this.updateGraphics.at(0),c=l.geometry;if(c!=null&&(n.tool==="reshape"&&c.type==="point"||n.tool==="transform"&&c.type==="extent"))return;let h=null;n.tool==="transform"?h=await this._getReshape([l],i,r):n.tool==="reshape"&&(h=await this._getBox([l],i,r)),ha(h)||(n.activeComponent?.destroy(),n.activeComponent=h,n.activeComponent&&(Up(o),o=this._getHandlesForComponent(n,i)))}}),a=[r.on("immediate-click",l=>this._getCommonUpdateOperationClickHandlers(n,l,i),Br.WIDGET),r.on("key-down",l=>{if(this._getCommonUpdateOperationKeyDownHandlers(n,l),l.key===yn.constraint&&!l.repeat&&n){const c=n.activeComponent;c&&c.type==="box"&&(c.preserveAspectRatio=!c.preserveAspectRatio)}},Br.WIDGET),r.on("key-up",l=>{if(l.key===yn.constraint&&n){const c=n.activeComponent;c&&c.type==="box"&&(c.preserveAspectRatio=!c.preserveAspectRatio)}},Br.WIDGET)];let o=this._getHandlesForComponent(n,i);return n}async _getGraphicMover(t,e,i){const{enableMoveAllGraphics:r,highlightOptions:s}=e,n=await this._requireModule(te(()=>import("./GraphicMover-BHQMTlBr.js").then(a=>a.G),__vite__mapDeps([400,394,269,393,57,25])));return ha(n)?n:new n.module.default({enableMoveAllGraphics:r,highlightName:s?.name,highlightsEnabled:!!s?.enabled,indicatorsEnabled:!1,graphics:t,view:i,callbacks:{onGraphicMoveStart:({dx:a,dy:o,graphic:l})=>{this._displayCursor("grabbing"),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:a,dy:o,mover:l,type:"move-start"},type:"update"})},onGraphicMove:({dx:a,dy:o,graphic:l})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:a,dy:o,mover:l,type:"move"},type:"update"}),onGraphicMoveStop:({dx:a,dy:o,graphic:l})=>{this._displayCursor("pointer"),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:a,dy:o,mover:l,type:"move-stop"},type:"update"})},onGraphicPointerOver:()=>this._displayCursor("move"),onGraphicPointerOut:()=>this._clearCursor()}})}async _getBox(t,e,i){const{enableRotation:r,enableScaling:s,highlightOptions:n,preserveAspectRatio:a}=e,[o,l]=await Promise.all([this._requireModule(te(()=>import("./Box-DNuWVAPS.js"),__vite__mapDeps([401,268,394,269,400,393,57,25,402,353,354,125,298,355,399,398]))),W1()]);if(ha(o))return o;const c=this.view?.inputManager?.isModifierKeyDown(yn.constraint);return new o.module.default({graphics:t,enableRotation:r,enableScaling:s,highlightName:n?.name,highlightsEnabled:!!n?.enabled,preserveAspectRatio:!!a!=!!c,layer:this._internalGraphicsLayer,view:i,sketchOptions:this.sketchOptions,automaticLengthMeasurementUtils:l,callbacks:{onMoveStart:h=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...h},type:"update"}),onMove:h=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...h},type:"update"}),onMoveStop:h=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...h},type:"update"}),onScaleStart:h=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...h},type:"update"}),onScale:h=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...h},type:"update"}),onScaleStop:h=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...h},type:"update"}),onRotateStart:h=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...h},type:"update"}),onRotate:h=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...h},type:"update"}),onRotateStop:h=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...h},type:"update"})}})}async _getReshape(t,e,i){const{highlightOptions:r,reshapeOptions:s}=e,n=s?.edgeOperation==="split",a=s?.shapeOperation==="move",o=!!s?.enableCreateCurveFromStraightEdge,[l,c,h]=await Promise.all([this._requireModule(te(()=>import("./Reshape-DcThRwVo.js"),__vite__mapDeps([403,334,328,331,330,332,64,333,335,391,307,308,171,126,127,54,56,55,101,57,25,396,394,269,400,393,353,354,125,298,355,397,356,398,402,267,268]))),Ik(),W1()]);return ha(l)?l:new l.module.default({enableMidpoints:n,enableMovement:a,enableCurveOnMidpoint:o,graphic:t[0],highlightName:r?.name,highlightsEnabled:!!r?.enabled,layer:this._internalGraphicsLayer,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:c,automaticLengthMeasurementUtils:h,view:i,callbacks:{onReshapeStart:f=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...f},type:"update"}),onReshape:f=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...f},type:"update"}),onReshapeStop:({mover:f,type:y})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:f,type:y},type:"update"}),onMoveStart:({dx:f,dy:y,mover:_,type:w})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:f,dy:y,mover:_,type:w},type:"update"}),onMove:({dx:f,dy:y,mover:_,type:w})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:f,dy:y,mover:_,type:w},type:"update"}),onMoveStop:({dx:f,dy:y,mover:_,type:w})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:f,dy:y,mover:_,type:w},type:"update"}),onVertexAdd:({added:f,type:y,vertices:_})=>{const w=f.map(x=>Jue(x.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:w,vertices:_,type:y},type:"update"})},onVertexRemove:({removed:f,type:y,vertices:_})=>{const w=f.map(x=>Jue(x.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{removed:w,vertices:_,type:y},type:"update"})}}})}_getHandlesForComponent(t,e){const i=t.activeComponent;if(!i)return[];switch(i.type){case"graphic-mover":return[i.on("graphic-click",({graphic:r,viewEvent:s})=>{s.native?.shiftKey&&e.multipleSelectionEnabled&&(s.stopPropagation(),t.removeFromSelection(r))}),i.on("graphic-move-start",r=>t.addToHistory(N0(r.allGraphics)))];case"box":return[i.on("graphic-click",r=>this._onTransformOrReshape2DGraphicClick(t,e,r)),i.on("move-start",r=>t.addToHistory(N0(r.graphics))),i.on("rotate-start",r=>t.addToHistory(N0(r.graphics))),i.on("scale-start",r=>t.addToHistory(N0(r.graphics)))];case"reshape":return[i.on("graphic-click",r=>this._onTransformOrReshape2DGraphicClick(t,e,r)),i.on("move-start",r=>t.addToHistory(N0([r.mover]))),i.on("reshape-start",r=>t.addToHistory(N0([r.graphic]))),i.on("vertex-add",r=>t.addToHistory(N0([r.oldGraphic]))),i.on("vertex-remove",r=>t.addToHistory(N0([r.oldGraphic])))];case"move-3d":return[i.events.on("record-undo",({updates:r})=>{t.addToHistory({updates:r})}),i.events.on("move-start",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:r.objects.length>0?r.objects[0].graphic:null,type:"move-start"},type:"update"})}),i.events.on("move",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:r.dx,dy:r.dy,mover:r.objects.length>0?r.objects[0].graphic:null,type:"move"},type:"update"})}),i.events.on("move-stop",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:r.objects.length>0?r.objects[0].graphic:null,type:"move-stop"},type:"update"})}),i.events.on("immediate-click",r=>{r.shiftKey?this._toggleSelection([r.object.graphic],t,e):t.toggleTool()})];case"transform-3d":return[i.events.on("record-undo",({updates:r})=>{t.addToHistory({updates:r})}),i.events.on("translate-start",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:r.object.graphic,dx:r.dxScreen,dy:r.dyScreen,type:"move-start"},type:"update"})}),i.events.on("translate-stop",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:r.object.graphic,dx:r.dxScreen,dy:r.dyScreen,type:"move-stop"},type:"update"})}),i.events.on("rotate-start",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:r.object.graphic,angle:r.angle,type:"rotate-start"},type:"update"})}),i.events.on("rotate-stop",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:r.object.graphic,angle:r.angle,type:"rotate-stop"},type:"update"})}),i.events.on("scale-start",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:r.object.graphic,xScale:r.xScale,yScale:r.yScale,type:"scale-start"},type:"update"})}),i.events.on("scale-stop",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:r.object.graphic,xScale:r.xScale,yScale:r.yScale,type:"scale-stop"},type:"update"})}),i.events.on("translate",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:r.object.graphic,dx:r.dxScreen,dy:r.dyScreen,type:"move"},type:"update"})}),i.events.on("rotate",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:r.object.graphic,angle:r.angle,type:"rotate"},type:"update"})}),i.events.on("scale",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:r.object.graphic,xScale:r.xScale,yScale:r.yScale,type:"scale"},type:"update"})}),i.events.on("immediate-click",r=>{r.shiftKey?this._toggleSelection([r.object.graphic],t,e):t.toggleTool()})];case"reshape-3d":return[i.events.on("reshape",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...r,mover:r.object.graphic},type:"update"})}),i.events.on("move",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...r,mover:r.object.graphic},type:"update"})}),i.events.on("vertex-add",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:r,type:"update"})}),i.events.on("vertex-remove",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:r,type:"update"})}),i.events.on("immediate-click",r=>{r.shiftKey?this._toggleSelection([r.object.graphic],t,e):t.toggleTool()})]}}_onTransformOrReshape2DGraphicClick(t,e,i){const{graphic:r,viewEvent:s}=i;return s.native?.shiftKey&&this.hasGraphic(r)?(s.stopPropagation(),t.removeFromSelection(r)):e.toggleToolOnClick?(s.stopPropagation(),t.toggleTool()):void 0}_setUpdateOperationHandle(t,e){this._operationHandle=t;const i=this.view?.map;this._disablePopup(e);const r=()=>{if(t===this._operationHandle){const s=this.updateGraphics.toArray(),n=this._operationHandle.tool;this._operationHandle.destroy(),this._operationHandle=null,this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray()),this.updateGraphics.removeAll(),i&&i.remove(this._internalGraphicsLayer),this._restorePopup(e),this.emit("update",{graphics:s,state:"complete",aborted:t.cancelled,tool:n,toolEventInfo:null,type:"update"})}};t.on("complete",r)}async _getCommonUpdateOperationClickHandlers(t,e,i){const r=Th(e),s=await e.defer(()=>this._getFirstHit(r));if(s==null)return void t.complete();if(e.native.shiftKey&&this._toggleSelection([s.graphic],t,i))return void e.stopPropagation();this.updateGraphics.includes(s.graphic)?e.stopPropagation():t.complete()}_toggleSelection(t,e,i){const r=!!i.multipleSelectionEnabled;return t.some(s=>s!=null&&!(!r||!this.hasGraphic(s))&&(this.updateGraphics.includes(s)?e.removeFromSelection(s):e.addToSelection(s),!0))}_getCommonUpdateOperationKeyDownHandlers(t,e){if(!t)return;const i=e.key;i===yn.undo&&t.canUndo()?(e.stopPropagation(),t.undo()):i===yn.redo&&t.canRedo()?(e.stopPropagation(),t.redo()):i===yn.cancel?(e.stopPropagation(),t.cancel()):this.allowDeleteKey&&yn.delete.includes(i)&&this._onDeleteKey(e)}_onDeleteKey(t){if(!this._operationHandle||this._operationHandle.type!=="update")return;const e=this.activeComponent,i=this.updateGraphics.toArray();e!=null&&(e.type!=="reshape"||i.length===1&&i[0].geometry?.type==="point")&&(t.stopPropagation(),this.delete())}_removeDefaultLayer(){this._internalGraphicsLayer&&(this.view?.map?.remove(this._internalGraphicsLayer),this._internalGraphicsLayer=Re(this._internalGraphicsLayer))}_isComponentGraphic(t){const{activeComponent:e}=this;return!(!t||e==null)&&(t.attributes?.esriSketchTool||e.type==="draw-2d"&&e.graphic===t||(e.type==="box"||e.type==="reshape")&&e.isUIGraphic(t))}_clearCursor(){this.removeHandles(zH)}_displayCursor(t){this.removeHandles(zH),this.view?.container&&t!=null&&this.addHandles(this.view.acquireCursor(t,"high"),zH)}_logError(t,e,i){fe.getLogger(this).error(new ee(t,e,i))}async _requireModule(t){const e=new AbortController;this._moduleLoaderAbortController=e;const i=await t;return this._moduleLoaderAbortController!==e||e.signal.aborted?{requireError:"aborted"}:{module:i}}_emitUndoEvent(t){this.emit("undo",{...t,type:"undo"})}_emitRedoEvent(t){this.emit("redo",{...t,type:"redo"})}_emitDeleteEvent(t){this.emit("delete",{...t,type:"delete"})}_onLayerGraphicsChangeCallback(t){if(this._operationHandle!=null){const{updateGraphics:e}=this;for(const i of t.removed)if(e.includes(i)){if(!(e.length>1)){this._operationHandle.cancel();break}this._operationHandle.removeFromSelection(i)}}}get test(){}wait(){return mv(()=>!this.updating)}_disablePopupEnabled(t){return this.view?.type!=="3d"||this.updateOnGraphicClick||(t?.toggleToolOnClick??!1)}_disablePopup(t){this._disablePopupEnabled(t)&&this.view&&this._originalPopupEnabled==null&&(this._originalPopupEnabled=this.view.popupEnabled,this.view.popupEnabled=!1)}_restorePopup(t){this._disablePopupEnabled(t)&&this.view&&this._originalPopupEnabled!=null&&(this.view.popupEnabled=this._originalPopupEnabled,this._originalPopupEnabled=null)}async _waitViewReady(){const t=this.view;t?(ps(this._viewReadyAbortController),this._viewReadyAbortController=new AbortController,await Px(mv(()=>t?.ready),this._viewReadyAbortController.signal)):this._logMissingView()}_logMissingView(){this._logError("sketch:missing-property",R1e("view"))}_logMissingLayer(){this._logError(dkt,R1e("layer"))}};d([m()],rr.prototype,"_defaultSnappingManager",void 0),d([m()],rr.prototype,"_layerAdapter",null),d([m()],rr.prototype,"_operationHandle",void 0),d([m({readOnly:!0})],rr.prototype,"_updatingHandles",void 0),d([m({readOnly:!0})],rr.prototype,"activeTool",null),d([m({readOnly:!0})],rr.prototype,"activeCreateToolDrawMode",null),d([m()],rr.prototype,"activeTooltip",null),d([m({types:w_})],rr.prototype,"activeFillSymbol",void 0),d([m()],rr.prototype,"activeLineSymbol",void 0),d([m()],rr.prototype,"activeVertexSymbol",void 0),d([m()],rr.prototype,"allowDeleteKey",void 0),d([m({readOnly:!0})],rr.prototype,"createGraphic",null),d([m()],rr.prototype,"defaultCreateOptions",null),d([m()],rr.prototype,"defaultUpdateOptions",null),d([m({type:Yse,nonNullable:!0})],rr.prototype,"labelOptions",null),d([m()],rr.prototype,"layer",void 0),d([m({types:w_})],rr.prototype,"pointSymbol",void 0),d([m({types:w_})],rr.prototype,"polygonSymbol",void 0),d([m({types:w_})],rr.prototype,"polylineSymbol",void 0),d([m()],rr.prototype,"meshSymbol",void 0),d([m()],rr.prototype,"textSymbol",void 0),d([m({type:ma,nonNullable:!0})],rr.prototype,"snappingOptions",null),d([m()],rr.prototype,"snappingManager",null),d([m({readOnly:!0})],rr.prototype,"state",null),d([m({type:Qse,nonNullable:!0})],rr.prototype,"tooltipOptions",null),d([m({readOnly:!0})],rr.prototype,"updateGraphics",void 0),d([m()],rr.prototype,"updateOnGraphicClick",void 0),d([m()],rr.prototype,"updating",null),d([m()],rr.prototype,"creationMode",void 0),d([m({type:Xse,nonNullable:!0})],rr.prototype,"valueOptions",null),d([m({types:w_})],rr.prototype,"vertexSymbol",void 0),d([m({value:null})],rr.prototype,"view",null),d([m({constructOnly:!0,type:dze})],rr.prototype,"sketchOptions",void 0),rr=d([k("esri.widgets.Sketch.SketchViewModel")],rr);const dkt="sketch:missing-property",R1e=t=>`Property '${t}' is missing on SketchViewModel.`;function pkt(t){return t==="polygon"||t==="rectangle"||t==="circle"}function zk(t,e){Qze("undo",t.history.undo,t.history.redo,e)}function Fk(t,e){Qze("redo",t.history.redo,t.history.undo,e)}function Qze(t,e,i,r){const s=e.pop();if(!s)return;const n=s.updates,a=[];r.forEach((o,l)=>{const c=n[l];c!=null&&("geometry"in c&&c.geometry!=null&&(a.push({geometry:o.geometry}),o.geometry=c.geometry),"symbol"in c&&c.symbol!=null&&(a.push({symbol:o.symbol}),o.symbol=c.symbol),"undo"in c&&(a.push(c),c[t](o)))}),i.push({updates:a})}function D1e(t,e){t!=null&&e.hasGrabbedManipulators&&(t.activeTool=null)}function N0(t){return{updates:t.map(({geometry:e})=>e?.type==="mesh"?{geometry:e.cloneShallow()}:{geometry:e})}}function Nk(t,e){t.tools?.remove(e),e.destroyed||e.destroy()}function ha(t){return"requireError"in t&&t.requireError==="aborted"}function fkt(t){return t==="2d"?new Ll({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",effects:[{type:"CIMGeometricEffectDashes",dashTemplate:[5,4],lineDashEnding:"FullGap",controlPointEnding:"NoConstraint"}],enable:!0,capStyle:"Butt",joinStyle:"Round",width:1.5,color:[0,0,0,255]},{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",width:1.5,color:[255,255,255,255]}]}}}):new Oo({color:[0,0,0,0]})}let mu=class extends Me{constructor(e){super(e),this.state="ready",this._pendingStartOptions=null,this._previousInputInfo=null,this._shouldRemoveLastPoint=!1,this._sketchedGraphics=new WeakSet,this._creationToolPromise=null,this._updateToolPromise=null,this._updateDisabled=!1}initialize(){this.addHandles(K(()=>({view:this.tool.viewModel.view,visible:this.tool.visible}),({view:e,visible:i})=>{e!=null&&i?this._attach(e):this._detach()},At),"view")}destroy(){this._detach()}get canStopCreating(){const e=this._geometry,i=this._shouldRemoveLastPoint?3:2;return F4(e)&&e.paths.length>0&&e.paths[0].length>=i}get _input(){return this.tool.viewModel.input}set _input(e){this.tool.viewModel.input=e}get _geometry(){return this._input?.geometry}get _visibleAndEditable(){return this.tool.visible&&this.tool.editable}get _view(){return this.tool.viewModel.view}get test(){}start(e={mode:"sketch"}){if(!this.tool.editable)return;const i=this._view;if(i!=null&&i.ready)switch(this._pendingStartOptions=null,this._stopInteraction(),this._previousInputInfo==null&&this._storePreviousInput(this._input),this._setSketchedGraphic(null),e.mode){case"sketch":this._set("state","creating"),this._startCreationInteraction();break;case"select":this._set("state","selecting"),this._startSelectionInteraction()}else this._pendingStartOptions=e}stop(){this._pendingStartOptions=null,this._stopInteractionAndUpdate(),this._clearPreviousInput()}cancel(){this._pendingStartOptions=null,this._stopInteractionAndUpdate(),this._restorePreviousInput()}clear(){this._stopInteractionAndUpdate(),this._set("state","ready"),this._clearPreviousInput(),this._input=null,this._pendingStartOptions=null}isSketchedGraphic(e){return e!=null&&this._sketchedGraphics.has(e)}_attach(e){this._detach();const i={mode:e.type==="3d"?"relative-to-ground":"on-the-ground",offset:null};this._graphicsLayer=new vf({listMode:"hide",internal:!0,elevationInfo:i,title:"Elevation info"});const r=fkt(e.type);this._sketchVM=new rr({layer:this._graphicsLayer,view:e,defaultCreateOptions:{mode:"click",hasZ:!1},updateOnGraphicClick:!1,defaultUpdateOptions:{reshapeOptions:{shapeOperation:"none"},enableRotation:!1,enableScaling:!1,enableMoveAllGraphics:!1,enableZ:!1,multipleSelectionEnabled:!1,toggleToolOnClick:!1,tool:"reshape"},polylineSymbol:r,activeLineSymbol:r}),this.addHandles([Zs(()=>e.ready,()=>{const s=this._pendingStartOptions;s&&this.start(s)},At),K(()=>[this._input,this._visibleAndEditable],()=>this._update(),At),K(()=>({map:e.map,graphicsLayer:this._graphicsLayer}),({map:s,graphicsLayer:n})=>{s!=null&&n!=null&&s.add(n),this._update()},At)],"main")}_detach(){this.removeHandles("main"),this._sketchVM=Re(this._sketchVM),this._creationToolPromise=null,this._updateToolPromise=null;const e=this._view?.map,i=this._graphicsLayer;e!=null&&i!=null&&e.remove(i),this._graphicsLayer=Re(this._graphicsLayer),this._shouldRemoveLastPoint=!1,this._set("state","ready")}_startCreationInteraction(){this._stopInteractionAndUpdate();const e=this._view,i=this._sketchVM;if(e==null||i==null)return;this._shouldRemoveLastPoint=!1;const r=i.on("create",n=>{const a=n.graphic;switch(n.state){case"complete":this._shouldRemoveLastPoint=!1,this._setSketchedGraphic(a),this._stopInteractionAndUpdate(),this._clearPreviousInput();break;case"cancel":this.cancel();break;case"active":this._setSketchedGraphic(a),n.toolEventInfo?.type==="cursor-update"&&(this._shouldRemoveLastPoint=!0);break;case"start":this._setSketchedGraphic(a)}}),s=()=>{r.remove();const n=this.canStopCreating,a=this._geometry?.clone();i.cancel(),this._creationToolPromise=null,a!=null&&n?this._shouldRemoveLastPoint&&this._setSketchedGraphic(new Gn({geometry:mkt(a)})):this._input=null};this.removeHandles("interaction"),this.addHandles(ci(s),"interaction"),this._creationToolPromise=Hf(i.create("polyline"))}_startReshapeInteraction(){this._stopInteraction();const e=this._view,i=this._sketchVM;if(e==null||i==null)return;const r=i.on("update",a=>{const o=a.graphics[0];switch(a.state){case"complete":this._setSketchedGraphic(o),this._stopInteractionAndUpdate(),this._clearPreviousInput();break;case"active":case"start":this._setSketchedGraphic(o)}}),s=()=>{r.remove(),i.cancel(),this._updateToolPromise=null};this.removeHandles("interaction"),this.addHandles(ci(s),"interaction");const n=this._input;n&&(n.visible=!0,this._updateToolPromise=Hf(i.update(n,{tool:"reshape"})))}_startSelectionInteraction(){this._stopInteraction();const e=this._view;if(e==null)return;const i=e.acquireCursor("crosshair","high");e.closePopup();let r=null;const s=ci(()=>ps(r)),n=e.on("immediate-click",o=>{o.defer(async()=>{ps(r),r=Bc(async l=>{const{results:c}=await e.hitTest(o);st(l);const h=c.filter(f=>f.type==="graphic").map(f=>f.graphic).find(f=>f.geometry!=null&&f.geometry.type==="polyline");h&&(o.preventDefault(),o.stopPropagation(),this._input=h,this._clearPreviousInput(),this._stopInteractionAndUpdate())}),await r.promise})},Br.TOOL),a=e.on("key-down",o=>{o.key==="Escape"&&this.cancel()});this.removeHandles("interaction"),this.addHandles([n,a,s,i],"interaction"),e.ready&&e.focus()}_stopInteraction(){this.removeHandles("interaction")}_stopInteractionAndUpdate(){this.hasHandles("interaction")&&(this._updateDisabled=!0,this._stopInteraction(),this._updateDisabled=!1,this._triggerUpdate())}_triggerUpdate(){this._set("state","ready"),this._update()}_update(){if(this._updateDisabled)return;const e=this.state;if(e!=="selecting"){if(this._visibleAndEditable){if(e==="creating"||e==="reshaping"&&this.isSketchedGraphic(this._input))return}else this.cancel();this._set("state",this._getNextState()),this._updateVisuals()}else this.stop()}_getNextState(){return this._input==null?"ready":this.isSketchedGraphic(this._input)?this.state==="creating"?"creating":this._visibleAndEditable?"reshaping":"reshaping-disabled":"selected"}_updateVisuals(){switch(this.state){case"creating":break;case"reshaping":this._startReshapeInteraction();break;case"reshaping-disabled":{this._stopInteractionAndUpdate();const e=this._input;e!=null&&this.isSketchedGraphic(e)&&(e.visible=!1);break}case"ready":case"selected":this._stopInteractionAndUpdate()}this._updateSketchedGraphic()}_storePreviousInput(e){this._previousInputInfo={graphic:e}}_restorePreviousInput(){const e=this._previousInputInfo;e!=null&&(this._clearPreviousInput(),this._input=e.graphic,this._triggerUpdate())}_clearPreviousInput(){this._previousInputInfo=null}_updateSketchedGraphic(){const e=this._graphicsLayer;if(e==null)return;const i=e.graphics,r=this._input;if(r==null||!this.isSketchedGraphic(r))return void i.removeAll();if(i.indexOf(r)===-1)i.removeAll(),i.add(r);else if(i.length!==1){const s=i.filter(n=>n!==r);i.removeMany(s)}}_setSketchedGraphic(e){e!=null&&this._sketchedGraphics.add(e),this._input=e,this._updateSketchedGraphic()}};function mkt(t){if(F4(t)){const e=t.clone();return e.paths=[e.paths[0].slice(0,-1)],e}return t}d([m({nonNullable:!0})],mu.prototype,"state",void 0),d([m({nonNullable:!0})],mu.prototype,"tool",void 0),d([m()],mu.prototype,"canStopCreating",null),d([m()],mu.prototype,"_graphicsLayer",void 0),d([m()],mu.prototype,"_sketchVM",void 0),d([m()],mu.prototype,"_input",null),d([m()],mu.prototype,"_geometry",null),d([m()],mu.prototype,"_visibleAndEditable",null),d([m()],mu.prototype,"_view",null),d([m()],mu.prototype,"_shouldRemoveLastPoint",void 0),mu=d([k("esri.widgets.ElevationProfile.ElevationProfileInteraction")],mu);let fN=class extends Me{constructor(e){super(e),this._implementation=null,this._loadingTask=null}initialize(){this.addHandles(K(()=>({tool:this.tool,view:this.tool.viewModel.view,visible:this.tool.visible&&!!this.tool.viewModel.view?.ready}),({tool:e,view:i,visible:r})=>{i!=null&&r?this._show(i,e):this._hide()},At))}destroy(){this._hide()}_show(e,i){this._loadingTask=ps(this._loadingTask),this._loadingTask=Bc(async r=>{if(e.type==="2d"){const s=te(()=>import("./ElevationProfileView2D-D9X7LvBw.js"),__vite__mapDeps([404,405,170,326,327,328,329,330,331,332,64,333,334,335,336,337,55,266])),n=(await Px(s,r)).ElevationProfileView2D;this._implementation=new n(e,i)}else if(e.type==="3d"){const s=te(()=>import("./ElevationProfileView3D-DtJed9v8.js"),__vite__mapDeps([406,405,170,326,327,328,329,330,331,332,64,333,334,335,336,337,55,266,322,301,323,304,296,305,258,324,325,30,396])),n=(await Px(s,r)).ElevationProfileView3D;this._implementation=new n(e,i)}})}_hide(){this._loadingTask=ps(this._loadingTask),this._implementation=Re(this._implementation)}};d([m()],fN.prototype,"tool",void 0),fN=d([k("esri.widgets.ElevationProfile.support.ElevationProfileView")],fN);let bg=class extends Me{constructor(e){super(e),this.editable=!0,this.visible=!0,this.highlightEnabled=!0}initialize(){this.view=new fN({tool:this}),this.interaction=new mu({tool:this})}destroy(){this.interaction.destroy(),this.view.destroy()}get state(){switch(this.interaction?.state){case"ready":return"ready";case"creating":return"creating";case"selecting":return"selecting";case"selected":return"selected";case"reshaping":case"reshaping-disabled":return"created"}}};d([m({nonNullable:!0})],bg.prototype,"viewModel",void 0),d([m()],bg.prototype,"view",void 0),d([m()],bg.prototype,"interaction",void 0),d([m()],bg.prototype,"editable",void 0),d([m()],bg.prototype,"visible",void 0),d([m()],bg.prototype,"highlightEnabled",void 0),bg=d([k("esri.widgets.ElevationProfile.ElevationProfileTool")],bg);let pr=class extends Me{constructor(t){super(t),this.view=null,this.input=null,this._getEffectiveUnitsMemoized=qh((e,i)=>({distance:e,elevation:i})),this.hoveredChartPosition=null,this.uniformChartScaling=!1,this.defaultUnit=null,this.queue=null,this._currentTileCache=null,this.error=null,this._defaultProfileLineGround=new oze,this._userUnitOptions=null,this._userUnit=null,t?.profiles||(this.profiles=new He([this._defaultProfileLineGround]))}initialize(){this.addHandles(K(()=>this.view,t=>{if(t==null)return void fe.getLogger(this).warnOnce("no view. Widget will be disabled until a view is provided.");this.removeHandles(I1e);const e=t.type==="3d"?t.resourceController:void 0;this.queue?.destroy(),this.queue=uIt(e?.scheduler);const i=e?.addUpdatingObject(this);i&&this.addHandles(i,I1e)},At)),this.tool=new bg({viewModel:this}),this._controller=new s_({viewModel:this})}destroy(){this._defaultProfileLineGround=Re(this._defaultProfileLineGround),this._controller=Re(this._controller),this._currentTileCache=Re(this._currentTileCache),this.tool=Re(this.tool),this.queue=Re(this.queue)}get profiles(){return this._get("profiles")}set profiles(t){const e=this._get("profiles"),i=t??new He;this._set("profiles",kc(i,e))}get state(){const t=this.view;return t!=null&&t.ready?this.tool.state:"disabled"}get progress(){let t=0,e=0;for(const i of this.visibleProfiles)t++,e+=i.progress;return t>0?e/t:0}set unitOptions(t){this._userUnitOptions=t,this._set("unitOptions",this._filteredOrAllUnits(this._userUnitOptions))}get unitOptions(){return this._filteredOrAllUnits(this._userUnitOptions)}set unit(t){this._userUnit=t?this._findSelectableUnit(t,this._userUnit):null,this.notifyChange("unit")}get unit(){return this._userUnit?(this._userUnit=this._findSelectableUnit(this._userUnit,this.defaultUnit),this._userUnit):this._findSelectableUnit(this.defaultUnit)}get effectiveUnits(){const t=aIt(this.visibleProfiles.map(r=>r.result)),e=k7e(t.maxDistance,"meters",this.unit),i=z7e(t.maxElevation,"meters",this.unit);return this._getEffectiveUnitsMemoized(e,i)}get highlightEnabled(){return this.tool.highlightEnabled}set highlightEnabled(t){this.tool.highlightEnabled=t}get hasVertices(){const t=this.input?.geometry;return F4(t)&&t.paths.reduce((e,i)=>e+i.length,0)>0}get hoveredPoints(){return this.input!=null&&this.visible&&this.tool.editable?this.visibleProfiles.map(t=>{const e=t.hoveredPoint;return e!=null?{hoveredPoint:e,color:t.color}:null}).filter(qf):[]}get statistics(){return nIt(this.visibleProfiles.map(t=>t.statistics))}get chartData(){if(this.input==null)return null;const{effectiveUnits:t,progress:e,statistics:i,visibleProfiles:r,uniformChartScaling:s}=this,n=r.filter(a=>a.hasZ).map(a=>({id:a.id,type:a.type,title:a.title,color:a.color,samples:a.samples,progress:a.progress,chartFillEnabled:a.chartFillEnabled,chartStrokeWidth:a.chartStrokeWidth,chartStrokeOffsetY:a.chartStrokeOffsetY,viewVisualizationEnabled:a.viewVisualizationEnabled}));return n.length===0?null:{lines:n,effectiveUnits:t,statistics:i,refined:e===1,dynamicElevationRange:r.some(a=>a.type==="view"),uniformScaling:s}}get visibleProfiles(){return this.profiles.toArray().filter(t=>t.available&&t.visible)}get minDemResolutions(){const t=[];for(const{minDemResolution:e}of this.visibleProfiles)e!=null&&t.push(e);return t}get minDemResolution(){return Vbe(this.minDemResolutions)}get errorState(){const t=this.input?.geometry;if(!qse(t))return"no-valid-input";if(this.error!=null){if(G4t(this.error))switch(this.error.cause){case"too-complex":return"too-complex";case"invalid-geometry":return"invalid-geometry";case"invalid-elevation-info":return"invalid-elevation-info";case"elevation-query-error":return"no-valid-input"}return"unknown-error"}return this.visibleProfiles.length===0?"no-visible-profiles":this.chartData==null&&this.progress===1?"refined-but-no-chart-data":"none"}get tileCache(){this._currentTileCache=Re(this._currentTileCache);const t=this.view;if(t!=null&&t?.type==="3d"){const e=t.basemapTerrain?.elevationQueryCache;if(e!=null)return e}return this._currentTileCache==null&&(this._currentTileCache=new tIe(new C$e(20971520))),this._currentTileCache}get visible(){return this.tool.visible}set visible(t){this.tool.visible=t}get selectAvailable(){for(const t of this.view?.map?.allLayers??[])if(t.type==="graphics"&&!t.internal&&t.graphics.some(e=>e.geometry?.type==="polyline")||"geometryType"in t&&t.geometryType==="polyline")return!0;return!!this.view?.graphics?.some(t=>t.geometry?.type==="polyline")}get inputIsSketched(){return this.tool.interaction.isSketchedGraphic(this.input)}get elevationProvider(){const t=this.view;return t!=null&&t.type==="3d"?t.elevationProvider:null}get updating(){const{progress:t}=this,e=!!this.queue?.updating;return t>0&&t<1||e}start(t){this.tool.interaction.start(t)}stop(){this.tool.interaction.stop()}cancel(){this.tool.interaction.cancel()}clear(){this.tool.interaction.clear()}_findSelectableUnit(t,e){const i=this.unitOptions;return t!=null&&i.includes(t)?t:e?this._findSelectableUnit(e):i[0]}_filteredOrAllUnits(t){const e=(t??[]).filter(i=>YN.includes(i));return e.length===0?YN.slice():e}};d([m()],pr.prototype,"view",void 0),d([m({type:Gn})],pr.prototype,"input",void 0),d([m({type:EIt,nonNullable:!0})],pr.prototype,"profiles",null),d([m({readOnly:!0})],pr.prototype,"state",null),d([m({readOnly:!0})],pr.prototype,"progress",null),d([m()],pr.prototype,"unitOptions",null),d([m()],pr.prototype,"unit",null),d([m({readOnly:!0})],pr.prototype,"effectiveUnits",null),d([m()],pr.prototype,"hoveredChartPosition",void 0),d([m()],pr.prototype,"uniformChartScaling",void 0),d([m()],pr.prototype,"highlightEnabled",null),d([m({readOnly:!0})],pr.prototype,"hoveredPoints",null),d([m({readOnly:!0})],pr.prototype,"statistics",null),d([m()],pr.prototype,"chartData",null),d([m()],pr.prototype,"visibleProfiles",null),d([m()],pr.prototype,"minDemResolutions",null),d([m({readOnly:!0})],pr.prototype,"minDemResolution",null),d([m({readOnly:!0})],pr.prototype,"errorState",null),d([m(F4t)],pr.prototype,"defaultUnit",void 0),d([m()],pr.prototype,"queue",void 0),d([m()],pr.prototype,"tileCache",null),d([m()],pr.prototype,"tool",void 0),d([m()],pr.prototype,"visible",null),d([m()],pr.prototype,"error",void 0),d([m()],pr.prototype,"selectAvailable",null),d([m()],pr.prototype,"inputIsSketched",null),d([m()],pr.prototype,"elevationProvider",null),d([m()],pr.prototype,"updating",null),d([m()],pr.prototype,"_defaultProfileLineGround",void 0),d([m()],pr.prototype,"_userUnitOptions",void 0),d([m()],pr.prototype,"_controller",void 0),d([m()],pr.prototype,"_userUnit",void 0),pr=d([k("esri.widgets.ElevationProfile.ElevationProfileViewModel")],pr);const I1e=Symbol("updating-object"),Xze=pr;let zd=class extends Me{constructor(){super(...arguments),this.legend=!0,this.chart=!0,this.clearButton=!0,this.settingsButton=!0,this.sketchButton=!0,this.selectButton=!0,this.unitSelector=!0,this.uniformChartScalingToggle=!0}};d([m()],zd.prototype,"legend",void 0),d([m()],zd.prototype,"chart",void 0),d([m()],zd.prototype,"clearButton",void 0),d([m()],zd.prototype,"settingsButton",void 0),d([m()],zd.prototype,"sketchButton",void 0),d([m()],zd.prototype,"selectButton",void 0),d([m()],zd.prototype,"unitSelector",void 0),d([m()],zd.prototype,"uniformChartScalingToggle",void 0),zd=d([k("esri.widgets.ElevationProfile.ElevationProfileVisibleElements")],zd);const Jze=zd,gkt=100;let Rb=class extends Pp{constructor(t,e){super(t,e),this._updateLayout=i=>{const r=i.parentElement,s=i.style.display;r?.removeChild(i),document.body.appendChild(i),i.style.display="block";let n=80;for(const a of i.childNodes)a instanceof HTMLElement&&(n=Math.max(n,a.offsetWidth));document.body.removeChild(i),r?.appendChild(i),i.style.display=s,i.style.setProperty("--max-width",`${n}px`)},this._updateLayoutThrottled=Qke(this._updateLayout,gkt)}loadDependencies(){return Jv({icon:()=>te(()=>Promise.resolve().then(()=>vbe),void 0)})}initialize(){this.addHandles(this._updateLayoutThrottled)}render(){return St("div",{afterCreate:this._updateLayout,afterUpdate:this._updateLayoutThrottled,bind:this,class:FA.base},this._renderStatistics())}_renderStatistics(){const t=this._messages?.statistics;return t?[this._renderDistanceStatistic("maxDistance",t.maxDistance),this._renderElevationStatistic("elevationGain",t.gain),this._renderElevationStatistic("elevationLoss",t.loss),this._renderElevationStatistic("minElevation",t.minElevation),this._renderElevationStatistic("maxElevation",t.maxElevation),this._renderElevationStatistic("avgElevation",t.avgElevation),this._renderSlopeStatistic("maxPositiveSlope","maxNegativeSlope",t.maxSlope),this._renderSlopeStatistic("avgPositiveSlope","avgNegativeSlope",t.avgSlope)]:[]}_renderDistanceStatistic(t,e){const i=yp().formatPrecision,r=this._renderValue(t,s=>{const n=this.effectiveUnits.distance;return wy(this._messagesUnits,s,n,i)});return this._renderStatistic(e,r)}_renderElevationStatistic(t,e){const i=yp().formatPrecision,r=this._renderValue(t,s=>{const n=this.effectiveUnits.elevation;return wy(this._messagesUnits,s,n,i)});return this._renderStatistic(e,r)}_renderSlopeStatistic(t,e,i){const r=yp().formatPrecision,s=St("div",{class:FA.slopeValue,key:"slope-up"},St("calcite-icon",{icon:"arrow-up",scale:"s"}),this._renderValue(t,n=>tX(n,"degrees","geographic","geographic",r)),St("calcite-icon",{icon:"arrow-down",scale:"s"}),this._renderValue(e,n=>tX(n,"degrees","geographic","geographic",r)));return this._renderStatistic(i,s)}_renderStatistic(t,e){return St("div",{class:FA.statistic},St("label",{class:FA.statisticLabel},t),St("div",{class:FA.statisticValue},e))}_renderValue(t,e){const i=this.line,r=i.progress===1?i.statistics:null,s=r?.[t];return s!=null?e(s):N4t}};d([m()],Rb.prototype,"effectiveUnits",void 0),d([m()],Rb.prototype,"line",void 0),d([m(),Wh("esri/widgets/ElevationProfile/t9n/ElevationProfile")],Rb.prototype,"_messages",void 0),d([m(),Wh("esri/core/t9n/Units")],Rb.prototype,"_messagesUnits",void 0),Rb=d([k("esri.widgets.ElevationProfile.components.Statistics")],Rb);function L1e(t,{profiles:e}){const i=t.title;if(i!=null)return i;switch(t.type){case"ground":return e.ground;case"input":return e.input;case"query":return e.query;case"view":return e.view;default:return""}}let Fd=class extends Pp{constructor(t,e){super(t,e),this.checkboxVisible=!0,this.expanded=!1}loadDependencies(){return Jv({action:()=>te(()=>import("./index-C5dSpmXR.js"),__vite__mapDeps([407,373,374,375])),checkbox:()=>te(()=>import("./index-C-J18bUg.js"),__vite__mapDeps([408,375,376,409])),label:()=>te(()=>import("./index-CzpEcA6h.js"),__vite__mapDeps([410,376]))})}initialize(){this._statistics=new Rb(this._statisticsProps),this.addHandles(K(()=>this._statisticsProps,t=>this._statistics.set(t)))}destroy(){this._statistics=Re(this._statistics)}render(){const t=this.expanded;return St("div",{class:this.classes(qm.base,{[qm.disabled]:this.disabled,[qm.expanded]:t}),key:this},this._renderColorIndicator(),St("div",{class:qm.header,key:"header"},this._renderLabelWithCheckbox(),this._renderCollapseToggleButton()),t?St("div",{class:qm.content,key:"content"},this._statistics.render()):null)}get disabled(){return!this.line.available}get _statisticsProps(){return{line:this.line,effectiveUnits:this.effectiveUnits}}_renderColorIndicator(){return St("div",{class:qm.colorIndicator,key:"color-indicator",styles:{backgroundColor:this.line.color.toCss()}})}_renderCollapseToggleButton(){const{expanded:t,messages:e}=this,i=t?e.hideDetails:e.showDetails;return St("calcite-action",{appearance:"transparent",bind:this,class:qm.collapseToggle,"data-testid":"legend-toggle",icon:t?"chevron-up":"chevron-down",key:"collapse-toggle",onclick:this._onCollapseToggleClick,scale:"s",text:i,title:i})}_onCollapseToggleClick(){this.onExpandedToggle()}_renderLabelWithCheckbox(){const{line:t,checkboxVisible:e,disabled:i,messages:r}=this;return St("calcite-label",{class:qm.label,disabled:i,key:`label-${t.id}`,layout:"inline"},e?this._renderCheckbox():null,L1e(t,r))}_renderCheckbox(){const{disabled:t,line:e,messages:i}=this,r=e.visible,s=r?i.hideProfile:i.showProfile,n=kZe(s,{name:L1e(e,i)});return St("calcite-checkbox",{checked:r,class:qm.checkbox,disabled:t,title:n,onCalciteCheckboxChange:()=>e.toggleVisibility()})}};d([m()],Fd.prototype,"checkboxVisible",void 0),d([m()],Fd.prototype,"disabled",null),d([m({nonNullable:!0})],Fd.prototype,"effectiveUnits",void 0),d([m()],Fd.prototype,"expanded",void 0),d([m({nonNullable:!0})],Fd.prototype,"line",void 0),d([m()],Fd.prototype,"messages",void 0),d([m()],Fd.prototype,"onExpandedToggle",void 0),d([m()],Fd.prototype,"_statistics",void 0),Fd=d([k("esri.widgets.ElevationProfile.components.LegendItem")],Fd);let Db=class extends Pp{constructor(){super(...arguments),this._expandedLine=null}render(){const{profiles:e,messages:i,effectiveUnits:r,_expandedLine:s}=this;return St("div",{class:k4t.base},e.map(n=>St(Fd,{checkboxVisible:e.length>1,effectiveUnits:r,expanded:n===s,line:n,messages:i,onExpandedToggle:()=>this._onExpandedToggle(n)})))}_onExpandedToggle(e){this._expandedLine=e===this._expandedLine?null:e}};d([m()],Db.prototype,"effectiveUnits",void 0),d([m()],Db.prototype,"messages",void 0),d([m()],Db.prototype,"profiles",void 0),d([m()],Db.prototype,"_expandedLine",void 0),Db=d([k("esri.widgets.ElevationProfile.components.Legend")],Db);const FH="esri-unit-select",NH={base:FH,label:`${FH}__label`,select:`${FH}__select`};let l_=class extends Pp{constructor(t,e){super(t,e),this._onSelectChange=i=>{this.onChange(i.currentTarget.value)}}loadDependencies(){return Jv({label:()=>te(()=>import("./index-CzpEcA6h.js"),__vite__mapDeps([410,376])),option:()=>te(()=>import("./index-BPOW5x6u.js"),[]),select:()=>te(()=>import("./index-rtBdrGAc.js"),__vite__mapDeps([411,412,375,376,409,413]))})}render(){const{messages:t,options:e,selectLabel:i,value:r,_onSelectChange:s}=this;return St("div",{class:NH.base,key:"units"},St("calcite-label",{class:NH.label},i,St("calcite-select",{class:NH.select,label:i,onCalciteSelectChange:s},e.map(n=>St("calcite-option",{key:n,selected:n===r,value:n},I7e(n)?t.systems[n]:t.units[n]?.pluralCapitalized)))))}};d([m()],l_.prototype,"options",void 0),d([m()],l_.prototype,"onChange",void 0),d([m()],l_.prototype,"selectLabel",void 0),d([m()],l_.prototype,"value",void 0),d([m(),Wh("esri/core/t9n/Units")],l_.prototype,"messages",void 0),l_=d([k("esri.widgets.support.UnitSelect")],l_);let wh=class extends Pp{constructor(){super(...arguments),this.messages=null,this._popoverIsOpen=!1,this._referenceElement=null,this._onUniformChartScalingChange=t=>{this.onUniformChartScalingChange(t.currentTarget.checked)}}loadDependencies(){return Jv({action:()=>te(()=>import("./index-C5dSpmXR.js"),__vite__mapDeps([407,373,374,375])),checkbox:()=>te(()=>import("./index-C-J18bUg.js"),__vite__mapDeps([408,375,376,409])),label:()=>te(()=>import("./index-CzpEcA6h.js"),__vite__mapDeps([410,376])),popover:()=>te(()=>import("./index-Dos8U69S.js").then(t=>t.i),__vite__mapDeps([414,373,374,407,375,415,416,417]))})}render(){const{id:t,messages:e,visibleElements:i}=this,{unitSelector:r,uniformChartScalingToggle:s}=i;if(!e||!r&&!s)return St("div",{key:`${t}-empty`});const n=this._popoverIsOpen?e.hideSettings:e.showSettings;return St("div",{class:Ck.base,key:this},St("calcite-action",{afterCreate:a=>{this._referenceElement=a},appearance:"transparent","data-testid":"settings-button",icon:"gear",scale:"s",text:n,title:n}),this._referenceElement?St("calcite-popover",{autoClose:!0,label:n,placement:"bottom-end",referenceElement:this._referenceElement,onCalcitePopoverClose:()=>{this._popoverIsOpen=!1},onCalcitePopoverOpen:()=>{this._popoverIsOpen=!0}},this._renderPopoverContent()):null)}_renderPopoverContent(){const{unitSelector:t,uniformChartScalingToggle:e}=this.visibleElements;return St("div",{class:Ck.popoverContent},t?this._renderUnitSelector():null,e?this._renderUniformChartScalingToggle():null)}_renderUnitSelector(){const{messages:t}=this;return St(l_,{key:"unit-selector-label",options:this.unitOptions,selectLabel:t?.unitSelectLabel??"",value:this.unit,onChange:this.onUnitChange})}_renderUniformChartScalingToggle(){const{messages:t}=this,e=this.uniformChartScaling,i=t?.[e?"uniformChartScalingDisable":"uniformChartScalingEnable"]??"";return St("calcite-label",{class:Ck.uniformChartScalingLabel,key:"uniform-chart-scaling-label",layout:"inline"},St("calcite-checkbox",{checked:e,class:Ck.uniformChartScalingCheckbox,title:i,onCalciteCheckboxChange:this._onUniformChartScalingChange}),t?.uniformChartScalingLabel)}};d([m()],wh.prototype,"messages",void 0),d([m()],wh.prototype,"onUniformChartScalingChange",void 0),d([m()],wh.prototype,"onUnitChange",void 0),d([m()],wh.prototype,"uniformChartScaling",void 0),d([m()],wh.prototype,"unit",void 0),d([m()],wh.prototype,"unitOptions",void 0),d([m()],wh.prototype,"visibleElements",void 0),d([m()],wh.prototype,"_popoverIsOpen",void 0),d([m()],wh.prototype,"_referenceElement",void 0),wh=d([k("esri.widgets.ElevationProfile.components.SettingsButton")],wh);const jA=[{type:"select"},{type:"sketch"}],ykt={none:null,"no-valid-input":"noProfile","no-visible-profiles":"noProfile","refined-but-no-chart-data":"noProfile","too-complex":"tooComplex","unknown-error":"unknown","invalid-geometry":"invalidGeometry","invalid-elevation-info":"invalidElevationInfo"};let Fs=class extends Pp{constructor(t,e){super(t,e),this.viewModel=null,this.visibleElements=new Jze,this.messages=null,this.messagesCommon=null,this.messagesUnits=null,this._chartContainer=null,this._chart=null,this._chartInitTask=null,this._chartIsRefined=!1,this._zoomOutButtonVisible=!1,this._getChartUpdateParamsMemoized=qh((i,r,s,n)=>({chart:i,data:r,stationary:s,messages:n})),this._onZoomOutButtonClick=()=>{this._chart?.zoomOut()},this._onClearButtonClick=()=>{this.viewModel.clear()},t?.viewModel||(this._defaultViewModel=new Xze({view:t?.view}),this.viewModel=this._defaultViewModel)}loadDependencies(){return Jv({action:()=>te(()=>import("./index-C5dSpmXR.js"),__vite__mapDeps([407,373,374,375])),button:()=>te(()=>import("./index-Bqoy6DTr.js"),__vite__mapDeps([372,373,374,375,376])),loader:()=>te(()=>import("./index-Fus-u8VC.js"),__vite__mapDeps([373,374]))})}postInitialize(){this.addHandles([K(()=>({container:this._chartContainer}),({container:t})=>{this._destroyChart(),t!=null&&this._initializeChart(t)},Wt),K(()=>this._chartUpdateParams,()=>this._updateChart(this._chartUpdateParams),Wt)])}destroy(){this._destroyChart(),this._defaultViewModel!=null&&this.viewModel!==this._defaultViewModel&&this._defaultViewModel.destroy()}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}get input(){return this.viewModel.input}set input(t){this.viewModel.input=t}get profiles(){return this.viewModel.profiles}set profiles(t){this.viewModel.profiles=t}get unitOptions(){return this.viewModel.unitOptions}set unitOptions(t){this.viewModel.unitOptions=t}get unit(){return this.viewModel.unit}set unit(t){this.viewModel.unit=t}get icon(){return"altitude"}set icon(t){this._overrideIfSome("icon",t)}get label(){return this.messages?.widgetLabel??""}set label(t){this._overrideIfSome("label",t)}get visible(){return this.viewModel.visible}set visible(t){this.viewModel.visible=t}get test(){return{chart:this._chart}}get _selectButtonVisible(){return this.visibleElements.selectButton===!0&&this.viewModel.selectAvailable}get _chartUpdateParams(){const t=this.view;return this._getChartUpdateParamsMemoized(this._chart,this.viewModel.chartData,t==null||t.stationary,this._chartMessages)}get _chartMessages(){return{...this.messagesUnits,...this.messages}}get _profilesArray(){return this.profiles.toArray()}render(){const{viewModel:t,visible:e}=this;return St("div",{"aria-label":this.messages.widgetLabel,class:this.classes({[ua.base]:e,[ku.widget]:e,[ku.panel]:e,[ku.widgetDisabled]:e&&t.state==="disabled",[ua.refined]:t.progress===1}),key:this},St("div",{bind:this,key:"content-wrapper"},e?this._renderContentForState():null))}_renderContentForState(){switch(this.viewModel.state){case"ready":case"disabled":return this._renderContentForReadyState();case"selecting":return this._renderContentForSelectingState();case"creating":return this._renderContentForCreatingState();case"selected":return this._renderContentForSelectedState();case"created":return this._renderContentForCreatedState()}}_renderContentForReadyState(){const{messages:t,visibleElements:e,_selectButtonVisible:i}=this,{sketchButton:r}=e;let s;return s=r&&i?t.readyPrompt:r?t.readyPromptCreateOnly:i?t.readyPromptSelectOnly:t.errors?.noProfile,this._renderContent({prompt:s,chart:!1,actions:jA})}_renderContentForSelectingState(){const{view:t}=this;if(t==null)return null;const e=this.messages[`selectingPrompt-${t.type}`];return this._renderContent({prompt:e,chart:!1,actions:[{type:"select-cancel"}]})}_renderContentForCreatingState(){const{view:t,viewModel:e}=this;if(t==null)return null;const i=e.hasVertices?[{type:"sketch-cancel"},{type:"sketch-done",disabled:!e.tool.interaction.canStopCreating}]:[{type:"select"},{type:"sketch",disabled:!0}];if(e.errorState==="no-valid-input"){const s=this.messages[`creatingPrompt-${t.type}`];return this._renderContent({chart:!1,actions:i,prompt:s})}const r=this._getErrorMessage();return r?this._renderContent({chart:!1,actions:i,prompt:r}):this._renderContent({chart:!0,actions:i})}_renderContentForSelectedState(){const t=this._getErrorMessage();return t?this._renderContent({chart:!1,actions:jA,prompt:t}):this._renderContent({chart:!0,actions:jA})}_renderContentForCreatedState(){const t=this._getErrorMessage();return t?this._renderContent({chart:!1,actions:jA,prompt:t}):this._renderContent({chart:!0,actions:jA})}_getErrorMessage(){const t=ykt[this.viewModel.errorState];return t?this.messages?.errors?.[t]:null}_renderContent(t){const e=t.prompt!=null?this._renderPrompt(t.prompt):t.chart&&this._renderChart(),{viewModel:i}=this,r=i.input!=null;return St(Sq,null,St("header",{class:ua.header,key:"header"},this._zoomOutButtonVisible?this._renderZoomOutButton():null,this.visibleElements.clearButton&&r?this._renderClearButton():null,this.visibleElements.settingsButton?St(wh,{messages:this.messages,uniformChartScaling:i.uniformChartScaling,unit:i.unit,unitOptions:i.unitOptions,visibleElements:this.visibleElements,onUniformChartScalingChange:s=>i.uniformChartScaling=s,onUnitChange:s=>i.unit=s}):null),St("div",{class:ua.mainContainer,key:"main-container"},e),this.visibleElements.legend?St(Db,{effectiveUnits:i.effectiveUnits,messages:this.messages,profiles:this._profilesArray}):null,this._renderActions(t))}_renderZoomOutButton(){const t=this.messages.zoomOut;return St("calcite-action",{appearance:"transparent",class:ua.zoomOutButton,"data-testid":"zoom-out-button",icon:"magnifying-glass-minus",key:"zoom-out",onclick:this._onZoomOutButtonClick,scale:"s",text:t,title:t})}_renderClearButton(){const t=this.messages.clearProfile;return St("calcite-action",{appearance:"transparent",class:ua.clearButton,"data-testid":"clear-button",icon:"trash",key:"clear-profile",onclick:this._onClearButtonClick,scale:"s",text:t,title:t})}_renderPrompt(t){return[St("div",{bind:this,class:ua.promptContainer,key:"prompt-container"},St("p",null,t))]}_renderChart(){if(!this.visibleElements.chart)return St("div",{class:ua.chartContainer,key:"empty-chart-container"});const{chartData:t,progress:e}=this.viewModel,i=this._chartIsRefined||this._canRenderChart(),r=t!=null&&e<1;return i?St(Sq,null,this._renderSpinner({size:i?"small":"large",visible:r}),St("div",{afterCreate:this._onChartContainerUpdate,afterRemoved:this._onChartContainerRemoved,afterUpdate:this._onChartContainerUpdate,bind:this,class:ua.chartContainer,key:"chart-container"})):St(Sq,null,this._renderSpinner({size:"large",visible:r}),St("div",{class:ua.chartContainer,key:"chart-container-empty"}))}_renderSpinner(t){const e=t.size==="small",i=t.visible??!0;return St("calcite-loader",{class:this.classes(ua.chartSpinner,e&&ua.chartSpinnerSmall,i&&ua.chartSpinnerVisible),"data-testid":"chart-spinner",inline:e,key:"spinner",label:"",scale:"s"})}_canRenderChart(){const t=this.viewModel.chartData;if(t==null)return!1;if(!this.viewModel.inputIsSketched)return t.refined;let e=0;for(const{samples:i}of t.lines)e+=i!=null?i.length:0;return t.refined||e<=yp().largeChartSamples}_renderActions({actions:t}){const e=t.map(i=>{switch(i.type){case"sketch":return this.visibleElements.sketchButton&&this._renderAction({action:i,className:ua.sketchButton,label:this.messages.sketchButtonLabel,onClick:this._onSketchButtonClick,primary:!0});case"sketch-cancel":return this.visibleElements.sketchButton&&this._renderAction({action:i,onClick:this._onCancelButtonClick,className:ua.sketchCancelButton,label:this.messagesCommon.cancel,primary:!1});case"sketch-done":return this.visibleElements.sketchButton&&this._renderAction({action:i,onClick:this._onDoneButtonClick,className:ua.sketchDoneButton,label:this.messagesCommon.done,primary:!0});case"select":return this._selectButtonVisible&&this._renderAction({action:i,onClick:this._onSelectButtonClick,className:ua.selectButton,label:this.messages.selectButtonLabel,primary:!1});case"select-cancel":return this._selectButtonVisible&&this._renderAction({action:i,onClick:this._onCancelButtonClick,className:ua.selectCancelButton,label:this.messagesCommon.cancel,primary:!1})}}).filter(Boolean);return e.length?St("footer",{class:ua.footer,key:"footer"},e):null}_renderAction({action:t,className:e,label:i,onClick:r,primary:s}){return St("calcite-button",{appearance:s?"solid":"outline-fill",bind:this,class:this.classes(ua.actionButton,e),disabled:t.disabled,key:`action-${t.type}`,onclick:r},i)}_onSketchButtonClick(){this.viewModel.start({mode:"sketch"})}_onSelectButtonClick(){this.viewModel.start({mode:"select"})}_onCancelButtonClick(){this.viewModel.cancel()}_onDoneButtonClick(){this.viewModel.stop()}_updateChart(t){const{data:e,chart:i,messages:r,stationary:s}=t;i!=null&&r!=null&&s&&this._canRenderChart()&&(i.update(t),this._chartIsRefined=e!=null&&e.refined)}_onChartContainerUpdate(t){this._chartContainer=t}_onChartContainerRemoved(t){this._chartContainer===t&&(this._chartContainer=null)}_initializeChart(t){ps(this._chartInitTask),this._chartInitTask=Bc(async e=>{const{createChart:i}=await te(()=>import("./chartUtils-CAqnrRRA.js"),__vite__mapDeps([418,419,420,421,422,423,424,425,426,427]));st(e);const r=await i({container:t,abortOptions:{signal:e},onRangeChange:(s,n)=>{this._zoomOutButtonVisible=s!==1||n!==1},onCursorPositionChange:s=>{this.viewModel.hoveredChartPosition=s}});if(e.aborted)throw Re(r),Xt();this._chart=r,this._updateChart(this._chartUpdateParams)})}_destroyChart(){this._chartInitTask=ps(this._chartInitTask),this._chart=Re(this._chart),this._chartIsRefined=!1}};d([m({type:Xze})],Fs.prototype,"viewModel",void 0),d([m()],Fs.prototype,"view",null),d([m()],Fs.prototype,"input",null),d([m()],Fs.prototype,"profiles",null),d([m()],Fs.prototype,"unitOptions",null),d([m()],Fs.prototype,"unit",null),d([m({type:Jze,nonNullable:!0})],Fs.prototype,"visibleElements",void 0),d([m()],Fs.prototype,"icon",null),d([m()],Fs.prototype,"label",null),d([m()],Fs.prototype,"visible",null),d([m(),Wh("esri/widgets/ElevationProfile/t9n/ElevationProfile")],Fs.prototype,"messages",void 0),d([m(),Wh("esri/t9n/common")],Fs.prototype,"messagesCommon",void 0),d([m(),Wh("esri/core/t9n/Units")],Fs.prototype,"messagesUnits",void 0),d([m()],Fs.prototype,"_chartContainer",void 0),d([m()],Fs.prototype,"_chart",void 0),d([m()],Fs.prototype,"_chartInitTask",void 0),d([m()],Fs.prototype,"_chartIsRefined",void 0),d([m()],Fs.prototype,"_zoomOutButtonVisible",void 0),d([m()],Fs.prototype,"_selectButtonVisible",null),d([m()],Fs.prototype,"_chartUpdateParams",null),d([m()],Fs.prototype,"_chartMessages",null),d([m()],Fs.prototype,"_profilesArray",null),Fs=d([k("esri.widgets.ElevationProfile")],Fs);const _kt=Fs;let vkt=class extends jV{#e;constructor(e){super(e),this.setProvisionalExports(void 0)}hostConnected(){this.component.manager.loadedCalled&&Tk(this.component)}hostLoad(){this.component.manager.destroyed}hostLoaded(){const{el:e}=this.component,i=e.shadowRoot?.firstElementChild??e.firstElementChild??void 0;e.childElem??=i,this.#e=Zs(()=>this.component.view!=null,()=>{this.component.arcgisReady.emit()},{once:!0,initial:!0,sync:!0}),e.isConnected&&Tk(this.component)}hostDisconnected(){typeof this.component.el.childElem=="object"&&this.component.view?.ui?.remove(this.component.el.childElem),this.#e?.remove()}hostUpdate(e){e.has("position")&&this.component.el.childElem!=null&&typeof this.component.position=="string"&&Tk(this.component),e.has("referenceElement")&&Tk(this.component)}};const bkt=(t,e)=>i=>xkt(i,t);class wkt extends Wke{#e=new Map;#t;#i;constructor(e,i){super(e,i),new vkt(e);const r=this,s=r.instance;let n=s.viewModel,a=s.visibleElements;const o=new Proxy(this.exports,{get(l,c,h){return c==="viewModel"?n:c==="visibleElements"?a:Reflect.get(l,c,h)}});if(r.#i=s,r.instance=o,r.exports=o,n){const l={component:e,get exports(){return r.instance.viewModel}};m4t(r).set("viewModel","viewModel"),e.addController(l),n=Zke(e,new WeakRef(l),_6e(e)-1,n,r.#e)}r.instance.visibleElements&&(a=r.#a(s))}hostConnected(){this.instance=this.#i,super.hostConnected()}hostLoad(){this.#t=K(()=>this.component.el.view,e=>{const i=this.instance;!("view"in i)&&typeof i.viewModel=="object"?i.viewModel.view=e:i.view=e,!("map"in i)&&typeof i.viewModel=="object"?i.viewModel.map=e?.map:i.map=e?.map},{sync:!0,initial:!0})}hostUpdate(e){e.has("closed")&&(this.instance.visible=!this.component.closed)}hostLoaded(){const{el:e}=this.component;e.childElem??=document.createElement("div"),this.instance.container=e.childElem,(this.component.el.shadowRoot??this.component.el).appendChild(this.instance.container),this.component.closed!==void 0&&this.onLifecycle(()=>K(()=>this.instance.visible,i=>this.component.closed=!i,{initial:!0}))}#a(e){return new Proxy(e.visibleElements,{get:(i,r)=>{if(typeof r=="symbol"||r in Promise.prototype)return i[r];const s=[r],n=this.#o(s);return YJ(this.component,a=>{const o=a;this.component[o]=!1;let l=e.visibleElements??{},c;for(const f of s.slice(0,-1))if(typeof l[f]=="object"&&l[f]!==null)l=l[f];else{c=!!l[f];break}c===void 0&&(c=!!(l[s.slice(-1)[0]]??!0));const h=o.startsWith("hide")||o.startsWith("show")?o.startsWith("hide"):c;this.onUpdate(f=>{if(f.has(o)){const y=this.component[o];this.#l(s,y,h)}})},n)}})}#o(e){const i=new Proxy({},{get:(r,s)=>{const n=Reflect.get(r,s);return typeof s=="symbol"||s in Promise.prototype?n:(e.push(s),i)}});return i}#l(e,i,r){let s=this.instance.visibleElements??{};for(const a of e.slice(0,-1))(typeof s[a]!="object"||s[a]===null)&&(s[a]={}),s=s[a];const n=!!(r?!i:i);s[e.at(-1)]=n}hostDestroy(){this.#t?.remove(),super.hostDestroy()}}const xkt=rK(wkt);const Skt=zv`.esri-widget__heading{color:var(--calcite-color-text-2);margin:0 0 .5rem;font-weight:var(--calcite-font-weight-semibold)}h1.esri-widget__heading{font-size:var(--calcite-font-size-xl)}h2.esri-widget__heading{font-size:var(--calcite-font-size-md)}h3.esri-widget__heading,h4.esri-widget__heading,h5.esri-widget__heading,h6.esri-widget__heading{font-size:var(--calcite-font-size)}.esri-widget{--esri-widget-padding-x: 15px;--esri-widget-padding-y: var(--calcite-spacing-md);--esri-widget-padding: var(--esri-widget-padding-y) var(--esri-widget-padding-x);box-sizing:border-box;color:var(--calcite-color-text-2);background-color:var(--calcite-color-foreground-1);font-size:var(--calcite-font-size);line-height:var(--calcite-font-line-height-relative-tight)}.esri-widget *,.esri-widget :before,.esri-widget :after{box-sizing:inherit}.esri-widget.esri-widget--disabled>*{opacity:.4;pointer-events:none}.esri-widget.esri-widget--compact{--esri-widget-padding-y: 0;--esri-widget-padding-x: 0}.esri-widget__anchor{color:var(--calcite-color-text-2)}.esri-widget__anchor:hover{color:var(--calcite-color-text-3)}.esri-widget__anchor:hover,.esri-widget__anchor:focus{text-decoration:underline}.esri-widget__anchor--disabled{opacity:.4;pointer-events:none}.esri-widget__header{background-color:var(--calcite-color-foreground-1);flex:1 0 100%;justify-content:space-between;align-items:center;width:100%;min-height:48px;padding:12px 0 12px 15px;display:flex}.esri-widget__header .esri-widget__heading{width:calc(100% - 48px);text-align:initial;color:var(--calcite-color-text-1);align-items:center;margin:0;padding:0;display:flex}.esri-widget__header-button{appearance:none;cursor:pointer;color:var(--calcite-color-text-2);background-color:var(--calcite-color-foreground-1);border:none;flex:0 0 48px;justify-content:center;align-self:stretch;align-items:center;width:48px;padding:0;display:flex}.esri-widget__footer{background-color:var(--calcite-color-foreground-1);justify-content:center;align-items:center;width:100%;min-height:48px;display:flex}.esri-widget__footer-pagination{color:var(--calcite-color-text-2);justify-content:space-between;align-items:center;display:flex}.esri-widget__footer-pagination-previous-button,.esri-widget__footer-pagination-next-button{cursor:pointer;background-color:var(--calcite-color-foreground-1);border:0;margin:0 7px;padding:12px 15px;transition:background-color .125s ease-in-out}.esri-widget__footer-pagination-previous-button:hover,.esri-widget__footer-pagination-previous-button:focus,.esri-widget__footer-pagination-next-button:hover,.esri-widget__footer-pagination-next-button:focus{color:var(--calcite-color-text-1);background-color:var(--calcite-color-foreground-1)}.esri-menu{visibility:hidden;z-index:1;background-clip:padding;background-color:var(--calcite-color-foreground-1);background-clip:padding-box;width:100%;max-height:0;margin:2px 0 0;padding:0;font-size:var(--calcite-font-size);line-height:var(--calcite-spacing-xl);position:absolute;top:100%;left:0;overflow:hidden;box-shadow:0 1px 2px #0000004d}.esri-menu .esri-menu__header{color:var(--calcite-color-text-inverse);background-color:var(--calcite-color-inverse);padding:6px 12px}.esri-menu__list{margin:0;padding:0;list-style:none}.esri-menu__list-item{cursor:pointer;border-top:1px solid #adadad4d;border-left:3px solid #0000;padding:.8em 1em}.esri-menu__list-item [class^=esri-icon-],.esri-menu__list-item [class*=" esri-icon-"]{padding-right:2.8px}.esri-menu__list-item:first-child{border-top:none}.esri-menu__list-item--focus,.esri-menu__list-item:hover,.esri-menu__list-item:focus{background-color:var(--calcite-color-foreground-1)}.esri-menu__list-item:active{background-color:var(--calcite-color-foreground-current)}.esri-menu__list-item--active,.esri-menu__list-item--active:hover,.esri-menu__list-item--active:focus{background-color:var(--calcite-color-foreground-1);border-left-color:var(--calcite-color-brand)}.esri-widget__table{border-collapse:collapse;color:var(--calcite-color-text-1);border:none;width:100%;line-height:var(--calcite-font-line-height-relative-tight)}.esri-widget__table tr:nth-child(odd){background-color:var(--calcite-color-transparent)}.esri-widget__table tr:nth-child(2n){background-color:var(--calcite-color-transparent-press)}.esri-widget__table tr a{color:var(--calcite-color-text-2)}.esri-widget__table tr a:hover,.esri-widget__table tr a:focus{color:var(--calcite-color-text-1)}.esri-widget__table tr td,.esri-widget__table tr th{vertical-align:top;word-break:break-word;padding:.5em .7em;font-size:var(--calcite-font-size-sm);font-weight:var(--calcite-font-weight-regular)}.esri-widget__table tr th{text-align:left;border-right:3px solid #0000000d;width:50%}.esri-widget__table tr td{width:50%}.esri-input{color:var(--calcite-color-text-1);background-color:var(--calcite-color-foreground-1);border:1px solid #959595;font-size:var(--calcite-font-size)}.esri-input::-ms-clear{display:none}.esri-input::placeholder{opacity:1;color:var(--calcite-color-text-2)}.esri-input:placeholder-shown{text-overflow:ellipsis}.esri-input[type=text],.esri-input[type=password],.esri-input[type=number]{height:32px;padding:0 .5em}calcite-combobox.esri-input{border:none}.esri-widget__content--empty{text-align:center;color:var(--calcite-color-border-input);flex-flow:column wrap;align-items:center;padding:18px 22px;display:flex}.esri-widget__content--empty h1.esri-widget__heading,.esri-widget__content--empty h2.esri-widget__heading,.esri-widget__content--empty h3.esri-widget__heading,.esri-widget__content--empty h4.esri-widget__heading,.esri-widget__content--empty h5.esri-widget__heading{font-weight:var(--calcite-font-weight-regular)}.esri-widget__content-illustration--empty{width:128px;padding:1rem 0}.esri-widget__content-icon--empty{width:32px;padding:.5rem 0}.esri-select{appearance:none;cursor:pointer;color:var(--calcite-color-text-2);background:var(--calcite-color-foreground-1) url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='-8 -8 32 32' width='32' height='32'%3E%3Cpath d='M8 11.207l-4-4V5.793l4 4 4-4v1.414z' fill='%23adadad' fillrule='nonzero'/%3E%3C/svg%3E") 100% no-repeat;border:1px solid #959595;border-radius:0;width:100%;height:32px;margin:0;padding:0 .5em;font-family:inherit;font-size:.85em;display:block}.esri-select[disabled]{cursor:auto}.esri-select::-ms-expand{display:none}.esri-disabled a,.esri-disabled [role=menu],.esri-disabled [role=checkbox],.esri-disabled [class^=esri-icon-],.esri-disabled [class*=" esri-icon-"]{color:var(--calcite-color-text-3)}.keynav-mode .esri-widget:focus,.keynav-mode .esri-widget :focus{z-index:1;outline-offset:2px;outline:2px solid #adadad}.esri-widget__loader-animation{border:.15em solid #adadad4d;border-top-color:var(--calcite-color-border-input);border-radius:100%;width:1em;height:1em;font-size:var(--calcite-font-size-md);animation:1.25s linear infinite esri-rotate;display:block;transform:translateZ(0)}:dir(rtl) .esri-widget__table th{text-align:right;border-left:3px solid #0000000d;border-right:none}:dir(rtl) .esri-select{background-position:0}:dir(rtl) .esri-menu__list-item{border-left:none;border-right:3px solid #0000}:dir(rtl) .esri-menu__list-item [class^=esri-icon-],:dir(rtl) .esri-menu__list-item [class*=" esri-icon-"]{padding-left:2px;padding-right:0}:dir(rtl) .esri-menu__list-item--active{border-right-color:var(--calcite-color-brand)}.esri-icon-font-fallback-text{clip:rect(0 0 0 0);width:1px;height:1px;position:absolute;overflow:hidden}.esri-rotating{animation:1.25s linear infinite esri-rotate;transform:translateZ(0)}.esri-clearfix:before,.esri-clearfix:after{content:" ";display:table}.esri-clearfix:after{clear:both}.esri-interactive{cursor:pointer}.esri-hidden{display:none!important}.esri-invisible{visibility:hidden!important}.esri-offscreen{position:absolute;top:-999em;left:-999em}.esri-match-height{flex-direction:column;flex:auto;display:flex;overflow:hidden}.esri-widget--panel{min-width:300px;min-height:32px;padding:var(--esri-widget-padding);transition:max-height .25s ease-in-out;overflow-y:auto}:host{display:flex;width:550px}.esri-elevation-profile{--popover-padding: 12px 15px;--chart-height: 180px;--calcite-label-margin-bottom: 0;--actions-spacing-h: 7px;--actions-spacing-v: 6px;isolation:isolate;padding:var(--esri-widget-padding);position:relative;container-type:inline-size}.esri-widget--panel{width:100%}.esri-elevation-profile__header{flex-direction:row;justify-content:flex-end;align-items:center;display:flex}.esri-elevation-profile__footer{flex-wrap:wrap;justify-content:flex-end;align-items:center;margin-top:var(--calcite-spacing-md);display:flex}.esri-elevation-profile__footer calcite-button{min-height:var(--calcite-spacing-xxxl)}.esri-elevation-profile__action-button{width:auto;margin-inline-start:var(--actions-spacing-h)}.esri-elevation-profile__main-container{width:100%;height:var(--chart-height);flex-flow:column;display:flex;position:relative}.esri-elevation-profile__chart-container{width:100%;height:100%;position:relative}.esri-elevation-profile__prompt-container{box-sizing:border-box;text-align:center;justify-content:center;align-items:center;height:100%;margin-bottom:0;padding:var(--popover-padding);display:flex}.esri-elevation-profile__prompt-container>p{width:100%;margin:0}.esri-elevation-profile__chart-spinner{transition:opacity .15s ease-in-out;transition-delay:0;opacity:0;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)}.esri-elevation-profile__chart-spinner--visible{opacity:1;transition-delay:50ms}.esri-elevation-profile__chart-spinner--small{inset-inline-start:0;top:-22px;left:unset;color:var(--calcite-color-brand);transform:none}@container (width<=400px){.esri-elevation-profile .esri-component.esri-widget--panel{height:auto}.esri-elevation-profile .esri-elevation-profile__footer{flex-direction:column}.esri-elevation-profile .esri-elevation-profile__action-button{align-self:stretch;margin-inline-start:0}.esri-elevation-profile .esri-elevation-profile__action-button:not(:last-of-type){margin-bottom:var(--actions-spacing-v)}}.esri-elevation-profile-settings calcite-popover[calcite-hydrated-hidden]{inset-block-start:-999999px;inset-inline-start:-999999px}.esri-elevation-profile-settings__popover-content{padding:var(--popover-padding);color:var(--calcite-color-text-1);flex-direction:column;gap:var(--calcite-spacing-md);min-width:180px;font-size:var(--calcite-font-size-sm);display:flex}.esri-elevation-profile-legend{margin-top:6px}.esri-elevation-profile-legend-item{background:var(--calcite-color-foreground-3);position:relative}.esri-elevation-profile-legend-item:not(:last-of-type){margin-bottom:2px}.esri-elevation-profile-legend-item--disabled{filter:grayscale();opacity:.4}.esri-elevation-profile-legend-item__color-indicator{inset-inline-start:0;width:3px;height:100%;position:absolute;top:0}.esri-elevation-profile-legend-item__header{flex-direction:row;justify-content:flex-start;align-items:center;display:flex}.esri-elevation-profile-legend-item__content{padding:0 15px 12px;display:block}.esri-elevation-profile-legend-item__collapse-toggle{flex-shrink:0;width:var(--calcite-spacing-xxxl);height:var(--calcite-spacing-xxxl)}.esri-elevation-profile-legend-item__label{flex-grow:1;flex-shrink:1;min-width:0;padding-inline-start:15px}.esri-elevation-profile-statistics{--max-width: 1px;grid-template-columns:repeat(auto-fit,minmax(var(--max-width),1fr));contain:layout paint style;gap:2px 22px;width:100%;display:grid}.esri-elevation-profile-statistics__statistic{text-align:start;white-space:nowrap;width:max-content;display:block}.esri-elevation-profile-statistics__statistic__label{font-size:var(--calcite-font-size-xs);font-weight:var(--calcite-font-weight-regular)}.esri-elevation-profile-statistics__statistic__value{margin-top:-.15em;font-size:var(--calcite-font-size-xs);font-weight:var(--calcite-font-weight-semibold)}.esri-elevation-profile-statistics__slope-value{align-items:center;display:flex}.esri-elevation-profile-statistics__slope-value calcite-icon{width:var(--calcite-spacing-xl);height:var(--calcite-spacing-xl)}.esri-view-height-xsmall .esri-elevation-profile{--chart-height: 68px}.esri-elevation-profile--portrait .esri-elevation-profile-statistics{gap:6px 22px;margin-bottom:var(--calcite-spacing-md)}.esri-elevation-profile--portrait .esri-elevation-profile-statistics__statistic__value{margin-top:var(--calcite-spacing-base)}`,Tkt=bkt(_kt),NV=class NV extends lv{constructor(){super(...arguments),this.widget=Tkt(this),this.viewModel=this.widget.viewModel,this.view=this.widget.view,this.autoDestroyDisabled=!1,this.effectiveUnits=this.viewModel.effectiveUnits,this.hideChart=this.widget.visibleElements.chart,this.hideClearButton=this.widget.visibleElements.clearButton,this.hideLegend=this.widget.visibleElements.legend,this.hideSelectButton=this.widget.visibleElements.selectButton,this.hideSettingsButton=this.widget.visibleElements.settingsButton,this.hideSketchButton=this.widget.visibleElements.sketchButton,this.hideUniformChartScalingToggle=this.widget.visibleElements.uniformChartScalingToggle,this.hideUnitSelector=this.widget.visibleElements.unitSelector,this.highlightEnabled=this.viewModel.highlightEnabled,this.hoveredChartPosition=this.viewModel.hoveredChartPosition,this.icon=this.widget.icon,this.input=this.widget.input,this.label=this.widget.label,this.profiles=this.widget.profiles,this.progress=this.viewModel.progress,this.state=this.viewModel.state,this.uniformChartScaling=this.viewModel.uniformChartScaling,this.unit=this.widget.unit,this.unitOptions=this.widget.unitOptions,this.arcgisPropertyChange=NUe()("input","effectiveUnits","progress","state"),this.arcgisReady=Pc()}async destroy(){await this.manager.destroy()}async start(){this.widget.viewModel.start()}async stop(){this.widget.viewModel.stop()}};NV.properties={view:0,autoDestroyDisabled:5,effectiveUnits:0,hideChart:5,hideClearButton:5,hideLegend:5,hideSelectButton:5,hideSettingsButton:5,hideSketchButton:5,hideUniformChartScalingToggle:5,hideUnitSelector:5,highlightEnabled:5,hoveredChartPosition:9,icon:1,input:0,label:1,position:1,profiles:0,progress:8,referenceElement:1,state:3,uniformChartScaling:5,unit:1,unitOptions:0},NV.styles=Skt;let FJ=NV;cwe("arcgis-elevation-profile",FJ);function $kt(){const[t,e]=z1e.useState();return document.querySelector("arcgis-scene"),fw.jsx("arcgis-scene",{basemap:"dark-gray-vector",viewingMode:"local",ground:"world-elevation",id:"arcgis-scene-id",onarcgisViewReadyChange:i=>{e(i.target)},children:fw.jsx("arcgis-elevation-profile",{referenceElement:"arcgis-scene-id",slot:"bottom-right",unit:"millimeters"})})}function Ckt(){return fw.jsx(fw.Fragment,{children:fw.jsx($kt,{})})}m6e.createRoot(document.getElementById("root")).render(fw.jsx(z1e.StrictMode,{children:fw.jsx(Ckt,{})}));const Mkt=Object.freeze(Object.defineProperty({__proto__:null,CloudsPassParameters:tie,build:SAe,cubeMapSize:c$},Symbol.toStringTag,{value:"Module"})),Ekt=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:cie,build:zAe},Symbol.toStringTag,{value:"Module"})),Akt=Object.freeze(Object.defineProperty({__proto__:null,build:GAe},Symbol.toStringTag,{value:"Module"})),Okt=Object.freeze(Object.defineProperty({__proto__:null,build:lRe,calculateAnchorPosition:qC,fullUV:_D},Symbol.toStringTag,{value:"Module"})),Pkt=Object.freeze(Object.defineProperty({__proto__:null,build:yDe},Symbol.toStringTag,{value:"Module"})),Rkt=Object.freeze(Object.defineProperty({__proto__:null,build:_De,getRadius:L8},Symbol.toStringTag,{value:"Module"})),Dkt=Object.freeze(Object.defineProperty({__proto__:null,build:CDe},Symbol.toStringTag,{value:"Module"})),Ikt=Object.freeze(Object.defineProperty({__proto__:null,build:ADe},Symbol.toStringTag,{value:"Module"})),Lkt=Object.freeze(Object.defineProperty({__proto__:null,build:GDe},Symbol.toStringTag,{value:"Module"})),kkt=Object.freeze(Object.defineProperty({__proto__:null,build:cIe},Symbol.toStringTag,{value:"Module"})),zkt=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:Xre,build:uIe},Symbol.toStringTag,{value:"Module"})),Fkt=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:Zre,blurSize:Yre,build:lIe,gridCellPixelSize:N_,outlineSize:TD},Symbol.toStringTag,{value:"Module"})),Nkt=Object.freeze(Object.defineProperty({__proto__:null,build:hIe},Symbol.toStringTag,{value:"Module"})),Vkt=Object.freeze(Object.defineProperty({__proto__:null,build:$Ie,ribbonlineNumRoundJoinSubdivisions:$D},Symbol.toStringTag,{value:"Module"})),Ukt=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:Wre,build:oIe},Symbol.toStringTag,{value:"Module"})),Bkt=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:ise,build:PIe},Symbol.toStringTag,{value:"Module"})),jkt=Object.freeze(Object.defineProperty({__proto__:null,build:o5e},Symbol.toStringTag,{value:"Module"})),qkt=Object.freeze(Object.defineProperty({__proto__:null,ColorizerHillshadeUniforms:w5e,ColorizerStretchUniforms:b5e,ColorizerUniforms:Q8,build:x5e},Symbol.toStringTag,{value:"Module"})),Gkt=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:yse,build:P5e},Symbol.toStringTag,{value:"Module"})),Hkt=Object.freeze(Object.defineProperty({__proto__:null,build:q5e},Symbol.toStringTag,{value:"Module"})),Wkt=Object.freeze(Object.defineProperty({__proto__:null,AtmosphereCompositingPassParameters:xse,build:H5e},Symbol.toStringTag,{value:"Module"})),Zkt=Object.freeze(Object.defineProperty({__proto__:null,build:W5e},Symbol.toStringTag,{value:"Module"})),Ykt=Object.freeze(Object.defineProperty({__proto__:null,FogPassParameters:Sse,build:Q5e},Symbol.toStringTag,{value:"Module"})),Qkt=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:X8,build:K5e},Symbol.toStringTag,{value:"Module"})),Xkt=Object.freeze(Object.defineProperty({__proto__:null,SilhouetteCircle:$se,SimpleAtmospherePassParameters:J8,build:eLe},Symbol.toStringTag,{value:"Module"})),Jkt=Object.freeze(Object.defineProperty({__proto__:null,build:gLe},Symbol.toStringTag,{value:"Module"})),Kkt=Object.freeze(Object.defineProperty({__proto__:null,GlowBlurPassParameters:Ase,build:ELe},Symbol.toStringTag,{value:"Module"})),ezt=Object.freeze(Object.defineProperty({__proto__:null,GlowCompositionPassParameters:Ose,build:ALe},Symbol.toStringTag,{value:"Module"})),tzt=Object.freeze(Object.defineProperty({__proto__:null,HazeCompositingPassParameters:Pse,build:OLe},Symbol.toStringTag,{value:"Module"})),izt=Object.freeze(Object.defineProperty({__proto__:null,build:PLe},Symbol.toStringTag,{value:"Module"})),rzt=Object.freeze(Object.defineProperty({__proto__:null,build:DLe},Symbol.toStringTag,{value:"Module"})),szt=Object.freeze(Object.defineProperty({__proto__:null,MagnifierPassParameters:Rse,build:ILe},Symbol.toStringTag,{value:"Module"})),nzt=Object.freeze(Object.defineProperty({__proto__:null,build:LLe},Symbol.toStringTag,{value:"Module"})),azt=Object.freeze(Object.defineProperty({__proto__:null,build:kLe},Symbol.toStringTag,{value:"Module"})),ozt=Object.freeze(Object.defineProperty({__proto__:null,build:zLe},Symbol.toStringTag,{value:"Module"})),lzt=Object.freeze(Object.defineProperty({__proto__:null,build:FLe},Symbol.toStringTag,{value:"Module"})),czt=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:Dse,build:VLe},Symbol.toStringTag,{value:"Module"})),uzt=Object.freeze(Object.defineProperty({__proto__:null,OITBlendPassParameters:Ise,build:GLe},Symbol.toStringTag,{value:"Module"})),hzt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastVisualizePassParameters:Lse,build:ZLe},Symbol.toStringTag,{value:"Module"})),dzt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastMaxSamples:k4,build:WLe},Symbol.toStringTag,{value:"Module"})),pzt=Object.freeze(Object.defineProperty({__proto__:null,build:JLe},Symbol.toStringTag,{value:"Module"})),Fai=Object.freeze(Object.defineProperty({__proto__:null,execute:cB,isLoaded:hne,load:dne,get supportsCurves(){return une}},Symbol.toStringTag,{value:"Module"}));export{b_ as $,cs as A,YYe as A$,YLt as A0,Ggt as A1,Tai as A2,Ff as A3,xv as A4,zNt as A5,Xn as A6,eNt as A7,hti as A8,JLt as A9,S4 as AA,U2t as AB,xV as AC,kX as AD,SIe as AE,UXt as AF,S0t as AG,Rge as AH,em as AI,x0t as AJ,v0t as AK,Pge as AL,$Q as AM,nge as AN,dti as AO,Pot as AP,Wte as AQ,WK as AR,Qv as AS,emt as AT,MXe as AU,F3e as AV,F6t as AW,fdt as AX,Kee as AY,LQe as AZ,_3e as A_,jze as Aa,P8 as Ab,Rw as Ac,Jh as Ad,Wjt as Ae,Elt as Af,_mt as Ag,O3e as Ah,z6t as Ai,bVt as Aj,sm as Ak,Aee as Al,gEe as Am,xy as An,ws as Ao,Nie as Ap,_r as Aq,Yie as Ar,F8t as As,amt as At,Bie as Au,pti as Av,V2t as Aw,nSt as Ax,Sy as Ay,ao as Az,ee as B,jbe as B$,cQe as B0,Ba as B1,Iv as B2,VAe as B3,Hh as B4,wv as B5,I8 as B6,cre as B7,Oa as B8,rd as B9,J5e as BA,C4 as BB,Dv as BC,pLe as BD,tDe as BE,eDe as BF,R8 as BG,Ni as BH,Ly as BI,_Le as BJ,FEt as BK,Mse as BL,bEt as BM,act as BN,es as BO,kjt as BP,MOt as BQ,co as BR,Dc as BS,Fo as BT,Tse as BU,yVt as BV,ige as BW,kQe as BX,SZt as BY,bHt as BZ,KNt as B_,M4 as Ba,po as Bb,u_t as Bc,e1 as Bd,Rc as Be,Qs as Bf,Nl as Bg,ht as Bh,vqe as Bi,qV as Bj,GV as Bk,KJ as Bl,cVe as Bm,ov as Bn,hVe as Bo,aK as Bp,CR as Bq,qzt as Br,iK as Bs,Gzt as Bt,Hzt as Bu,zzt as Bv,aUe as Bw,y0t as Bx,_0t as By,Ap as Bz,JV as C,T9t as C$,TZt as C0,jvt as C1,Zd as C2,df as C3,Xv as C4,i1 as C5,Ilt as C6,LRe as C7,dte as C8,ZV as C9,vge as CA,iGt as CB,svt as CC,Kgt as CD,VPe as CE,Kre as CF,Fee as CG,Aq as CH,eZt as CI,pHt as CJ,XP as CK,eut as CL,Su as CM,zQe as CN,I_t as CO,Wyt as CP,Oh as CQ,vUt as CR,w8t as CS,gHt as CT,SMe as CU,Fyt as CV,Byt as CW,sGt as CX,k_t as CY,dHt as CZ,$Ht as C_,AM as Ca,aRe as Cb,M6 as Cc,f3e as Cd,IYt as Ce,jst as Cf,yde as Cg,O7t as Ch,FNt as Ci,dre as Cj,Kjt as Ck,c3e as Cl,x_t as Cm,zi as Cn,MDe as Co,AV as Cp,lyt as Cq,THt as Cr,f3 as Cs,cGt as Ct,HZt as Cu,tGt as Cv,nZt as Cw,ovt as Cx,nvt as Cy,Lgt as Cz,ci as D,pTt as D0,PHt as D1,fTt as D2,i0t as D3,Age as D4,u6 as D5,pyt as D6,Ga as D7,iNt as D8,kqe as D9,TX as DA,Y1t as DB,DMe as DC,Brt as DD,rYt as DE,P1t as DF,R1t as DG,iYt as DH,U1t as DI,D1t as DJ,uyt as DK,KZt as DL,tYt as DM,Vei as DN,vDe as DO,rCt as DP,$p as DQ,Cv as DR,vbe as DS,jzt as DT,dVt as DU,fVt as DV,Fye as DW,Fai as DX,Oq as Da,ymt as Db,vre as Dc,uCt as Dd,hre as De,mre as Df,HC as Dg,k8 as Dh,o_t as Di,z8 as Dj,GC as Dk,wre as Dl,Ty as Dm,klt as Dn,QP as Do,Y7 as Dp,hyt as Dq,dyt as Dr,oyt as Ds,frt as Dt,MVt as Du,eOe as Dv,gD as Dw,hHt as Dx,z1t as Dy,M3 as Dz,zBt as E,y7e as F,MJe as G,Zs as H,Tbe as I,Nu as J,Re as K,lv as L,mbt as M,xF as N,SQt as O,os as P,ie as Q,t2t as R,Me as S,Mf as T,Gn as U,mt as V,ft as W,Hd as X,He as Y,Tg as Z,d as _,Wt as a,st as a$,jn as a0,Urt as a1,Kr as a2,Hr as a3,K as a4,Yt as a5,Ms as a6,Kmt as a7,At as a8,wHt as a9,K3 as aA,ve as aB,R as aC,xe as aD,le as aE,hSt as aF,ACt as aG,iD as aH,Aa as aI,mrt as aJ,Gge as aK,mg as aL,x4e as aM,S9t as aN,x9t as aO,Nje as aP,rHt as aQ,mJt as aR,C8t as aS,Pi as aT,or as aU,Kt as aV,FVt as aW,Ake as aX,qVt as aY,jVt as aZ,Xf as a_,GZt as aa,Tp as ab,al as ac,Igt as ad,DUt as ae,P_ as af,A_ as ag,O_ as ah,Sc as ai,gv as aj,vc as ak,ort as al,HUt as am,Ate as an,Rl as ao,Oo as ap,WC as aq,Bt as ar,Po as as,Qe as at,Ps as au,Ep as av,Ey as aw,fi as ax,ey as ay,jl as az,k as b,zUt as b$,ay as b0,HD as b1,Fe as b2,My as b3,$r as b4,hs as b5,GVe as b6,pbe as b7,Fzt as b8,C$e as b9,Y6t as bA,Pte as bB,bit as bC,wit as bD,_v as bE,dEe as bF,kt as bG,ke as bH,ta as bI,hy as bJ,Ie as bK,Te as bL,TU as bM,di as bN,Ht as bO,hee as bP,CNt as bQ,BVt as bR,S9e as bS,Wsi as bT,T9e as bU,Jg as bV,Xr as bW,Mn as bX,F3 as bY,OJ as bZ,Oke as b_,Uc as ba,DYe as bb,W6t as bc,IZe as bd,vv as be,UVt as bf,i8t as bg,K6t as bh,J6t as bi,dy as bj,u8t as bk,fe as bl,t8t as bm,Cy as bn,qCe as bo,Ete as bp,fr as bq,nn as br,So as bs,lt as bt,wgt as bu,qg as bv,bgt as bw,Z6t as bx,X6t as by,Q6t as bz,oUe as c,KK as c$,ur as c0,Krt as c1,Cgt as c2,H6t as c3,Bc as c4,XVt as c5,qf as c6,Oit as c7,$ue as c8,TK as c9,ri as cA,qee as cB,Se as cC,q8 as cD,eHt as cE,Agt as cF,Wx as cG,Wl as cH,Gst as cI,mv as cJ,kBt as cK,lXt as cL,v4e as cM,hYt as cN,Gre as cO,hXt as cP,Rn as cQ,Xt as cR,lte as cS,cte as cT,Ys as cU,T8 as cV,e0t as cW,tWt as cX,jc as cY,ul as cZ,Qzt as c_,Kit as ca,lMe as cb,YUt as cc,ZUt as cd,VUt as ce,JR as cf,XR as cg,bM as ch,_p as ci,fs as cj,CYe as ck,Uf as cl,ZIt as cm,WIt as cn,Ma as co,Mp as cp,ENt as cq,MNt as cr,Et as cs,cl as ct,rNt as cu,sNt as cv,V6t as cw,Gl as cx,nNt as cy,Bx as cz,nK as d,hEe as d$,Fte as d0,gM as d1,FUt as d2,aHe as d3,LTe as d4,Cs as d5,tO as d6,Ti as d7,ww as d8,mi as d9,Ce as dA,Mt as dB,de as dC,Hxe as dD,g3e as dE,y3e as dF,ui as dG,Eo as dH,g8e as dI,Gje as dJ,lo as dK,Wr as dL,nT as dM,hn as dN,Nxe as dO,zP as dP,Wk as dQ,h7e as dR,PVt as dS,OR as dT,Fu as dU,F5 as dV,cee as dW,lee as dX,K2e as dY,uee as dZ,g6t as d_,yM as da,Lt as db,JTe as dc,ttt as dd,_i as de,L$t as df,ja as dg,w7e as dh,Ru as di,mZt as dj,vde as dk,sst as dl,MZe as dm,Rd as dn,nst as dp,Ca as dq,tSe as dr,Pn as ds,V8t as dt,LZt as du,sVt as dv,cy as dw,ps as dx,Ea as dy,Ge as dz,TR as e,Le as e$,rw as e0,Z2e as e1,Bd as e2,rC as e3,eIe as e4,Ag as e5,ma as e6,OV as e7,m6t as e8,m2e as e9,tX as eA,v8 as eB,U7t as eC,G7t as eD,N7t as eE,j7t as eF,H7t as eG,W7t as eH,TVt as eI,Oe as eJ,on as eK,EYt as eL,Gs as eM,ZTe as eN,Xd as eO,N6t as eP,gVt as eQ,Mie as eR,mM as eS,rn as eT,Vc as eU,Av as eV,pt as eW,AVt as eX,Oi as eY,CVt as eZ,Qf as e_,C2e as ea,Ir as eb,gGe as ec,ree as ed,o6t as ee,Ait as ef,dYt as eg,f7t as eh,fD as ei,m7t as ej,Nc as ek,LC as el,bt as em,Ee as en,Jd as eo,tHe as ep,fS as eq,yt as er,$Je as es,wy as et,P7t as eu,q7t as ev,B7t as ew,V7t as ex,F7t as ey,nU as ez,Ibe as f,Q_ as f$,wVt as f0,Jx as f1,Ki as f2,W_ as f3,igt as f4,Hf as f5,wwe as f6,Qee as f7,si as f8,kHt as f9,Tr as fA,Gbt as fB,WYt as fC,HYt as fD,sBe as fE,qr as fF,xu as fG,Vv as fH,Nv as fI,VR as fJ,bSt as fK,$G as fL,cr as fM,XXt as fN,JXt as fO,it as fP,S6 as fQ,a0e as fR,KYe as fS,Kh as fT,nl as fU,d3e as fV,upt as fW,hi as fX,_8 as fY,sU as fZ,xni as f_,Oy as fa,dz as fb,ynt as fc,r8 as fd,Gh as fe,YBt as ff,WBt as fg,ZBt as fh,vVt as fi,FXt as fj,NXt as fk,uw as fl,VXt as fm,Xie as fn,sHt as fo,Ze as fp,DHt as fq,oB as fr,qa as fs,Kbe as ft,oti as fu,cti as fv,uti as fw,wse as fx,bFt as fy,wFt as fz,Sbe as g,REe as g$,RM as g0,z4 as g1,Nqe as g2,OQe as g3,fU as g4,Mke as g5,Sr as g6,nC as g7,to as g8,B0 as g9,c8 as gA,FO as gB,jxe as gC,Ute as gD,cit as gE,XUt as gF,g1t as gG,y1t as gH,e4 as gI,r4e as gJ,AZt as gK,EZt as gL,ly as gM,l4 as gN,zc as gO,xit as gP,e8t as gQ,KUt as gR,jCe as gS,ip as gT,qje as gU,OZt as gV,Tu as gW,z9 as gX,QD as gY,Kvt as gZ,GA as g_,nue as ga,Pb as gb,tni as gc,Pc as gd,xUe as ge,hbe as gf,wVe as gg,XI as gh,wce as gi,zce as gj,s$ as gk,bC as gl,jD as gm,oM as gn,$a as go,OJe as gp,B9e as gq,vNt as gr,Yve as gs,Lc as gt,nFt as gu,Xtt as gv,xsi as gw,R9t as gx,mut as gy,Lo as gz,mp as h,cM as h$,TQ as h0,H_ as h1,Ac as h2,Tc as h3,rBe as h4,SFt as h5,hxe as h6,Ix as h7,kK as h8,wp as h9,$Nt as hA,Mxe as hB,Hve as hC,RDt as hD,Gve as hE,DDt as hF,LDt as hG,fnt as hH,AJe as hI,xUt as hJ,aC as hK,JUt as hL,Uv as hM,i5t as hN,DYt as hO,OYt as hP,RYt as hQ,t5t as hR,Qn as hS,gc as hT,ztt as hU,Ltt as hV,Dtt as hW,P$e as hX,x7 as hY,Ksi as hZ,xte as h_,zo as ha,TNt as hb,eSe as hc,Es as hd,ql as he,jx as hf,iM as hg,pK as hh,mgt as hi,kFt as hj,Cu as hk,zFt as hl,qD as hm,qs as hn,qni as ho,Iqe as hp,Ll as hq,Jue as hr,_C as hs,h2e as ht,sy as hu,W9 as hv,l6t as hw,wU as hx,iee as hy,I7t as hz,Izt as i,Dze as i$,_Je as i0,ON as i1,Ug as i2,oC as i3,Ic as i4,u2 as i5,OVt as i6,ZN as i7,qK as i8,qi as i9,Lvt as iA,Fvt as iB,zvt as iC,kvt as iD,tQe as iE,rLe as iF,xMt as iG,P8t as iH,gLt as iI,DNt as iJ,INt as iK,PUt as iL,GGt as iM,Wv as iN,so as iO,RUt as iP,nYe as iQ,QGt as iR,l3 as iS,Gv as iT,qx as iU,IUt as iV,U_ as iW,CH as iX,eLt as iY,tLt as iZ,Lv as i_,wa as ia,sK as ib,Nzt as ic,Dzt as id,JVe as ie,o8e as ig,a8e as ih,tK as ii,I8t as ij,q8t as ik,cv as il,Hsi as im,VVt as io,Wve as ip,hJ as iq,yDt as ir,$N as is,gDt as it,qsi as iu,PJe as iv,rnt as iw,snt as ix,KGt as iy,LCt as iz,Uzt as j,h4 as j$,IM as j0,Px as j1,AYt as j2,qh as j3,tai as j4,ABe as j5,p5t as j6,Ul as j7,mNt as j8,SNt as j9,r2e as jA,B3e as jB,IJ as jC,$8t as jD,SU as jE,WAe as jF,Hl as jG,mie as jH,Xl as jI,Si as jJ,FU as jK,vYe as jL,Lu as jM,Cr as jN,Gqe as jO,tBt as jP,Au as jQ,vte as jR,$ee as jS,SUt as jT,WBe as jU,aje as jV,dBt as jW,Ev as jX,QR as jY,Ew as jZ,wet as j_,Ezt as ja,Rzt as jb,IVt as jc,Msi as jd,Opt as je,qu as jf,yp as jg,gPe as jh,_It as ji,kZe as jj,N4t as jk,L1e as jl,Kte as jm,kc as jn,DU as jo,Yzt as jp,mD as jq,iBt as jr,Sf as js,yc as jt,oBt as ju,NVt as jv,_Nt as jw,Hn as jx,U7e as jy,C7e as jz,Nce as k,gZt as k$,Xzt as k0,Qyt as k1,JWt as k2,__t as k3,Yyt as k4,$u as k5,yat as k6,E8t as k7,M8t as k8,NO as k9,MYt as kA,Ybe as kB,o3 as kC,oZ as kD,Z_ as kE,aOe as kF,CW as kG,S2e as kH,jv as kI,RR as kJ,BRe as kK,vHt as kL,Ro as kM,jje as kN,r3e as kO,pn as kP,an as kQ,Yl as kR,Sv as kS,zue as kT,UYe as kU,WD as kV,tLe as kW,DC as kX,vZt as kY,Gvt as kZ,eye as k_,aNt as ka,aLe as kb,g7 as kc,ZD as kd,YD as ke,QWt as kf,YWt as kg,$Yt as kh,c6 as ki,rre as kj,RRe as kk,Bl as kl,JK as km,mC as kn,oo as ko,rl as kp,qv as kq,gC as kr,tGe as ks,B_ as kt,iLt as ku,im as kv,sLt as kw,zze as kx,qR as ky,RHt as kz,gr as l,Q2e as l$,b6t as l0,y6t as l1,$Ge as l2,C6t as l3,w6t as l4,EW as l5,sei as l6,Ri as l7,nte as l8,rbt as l9,Asi as lA,C4e as lB,z as lC,CYt as lD,Ux as lE,$si as lF,dze as lG,_1e as lH,xde as lI,CX as lJ,rai as lK,vJe as lL,JQt as lM,v1e as lN,aLt as lO,lai as lP,dLt as lQ,eai as lR,pC as lS,o4 as lT,xFt as lU,kYe as lV,wNt as lW,a4 as lX,tM as lY,iU as lZ,IC as l_,gy as la,_Vt as lb,qXe as lc,t8 as ld,yY as le,D8t as lf,bMe as lg,Ote as lh,tFt as li,iFt as lj,eFt as lk,lr as ll,xM as lm,mw as ln,HP as lo,Dg as lp,_4 as lq,v$e as lr,gwt as ls,nJe as lt,jEe as lu,G_ as lv,VYt as lw,Rx as lx,HRt as ly,ORt as lz,m,HFt as m$,_$e as m0,hqe as m1,_w as m2,R9e as m3,Wf as m4,HTe as m5,rUe as m6,Azt as m7,gsi as m8,q1t as m9,vit as mA,lBt as mB,CJe as mC,RVt as mD,lgt as mE,NGt as mF,bRe as mG,ere as mH,VGt as mI,UGt as mJ,sn as mK,hBt as mL,cBt as mM,CZt as mN,IHt as mO,vw as mP,Bv as mQ,Vre as mR,OW as mS,t2 as mT,pU as mU,H9 as mV,H3 as mW,MR as mX,lK as mY,Nbt as mZ,Hvt as m_,XGt as ma,X_t as mb,ODe as mc,W_t as md,nHt as me,jRe as mf,A8t as mg,k8t as mh,jJt as mi,zDe as mj,KHt as mk,CHt as ml,qRe as mm,Kx as mn,i3e as mo,NRe as mp,Eot as mq,Ws as mr,_4e as ms,kde as mt,Cg as mu,vO as mv,_3 as mw,nSe as mx,KVt as my,TUt as mz,En as n,Ini as n$,Qd as n0,EUt as n1,d4 as n2,Kn as n3,rqe as n4,fC as n5,jBt as n6,xZt as n7,OCt as n8,Fv as n9,Jbe as nA,Lx as nB,Vs as nC,cvt as nD,uvt as nE,dxt as nF,OQt as nG,zwt as nH,p3e as nI,Yx as nJ,bUt as nK,mWt as nL,S3e as nM,yWt as nN,Bu as nO,hOe as nP,nLe as nQ,iut as nR,rut as nS,_Wt as nT,nDe as nU,uYt as nV,vf as nW,Qke as nX,Dre as nY,fF as nZ,R7t as n_,wg as na,CU as nb,zg as nc,f2e as nd,KN as ne,zf as nf,vai as ng,gU as nh,SVt as ni,N3e as nj,Wi as nk,LU as nl,Fbt as nm,Hni as nn,Wni as no,Gni as np,lLt as nq,FGt as nr,yHt as ns,Zl as nt,V7e as nu,Xnt as nv,Fnt as nw,kGe as nx,S6t as ny,Sre as nz,$P as o,aR as o$,Br as o0,Th as o1,b2 as o2,dnt as o3,Kke as o4,Ib as o5,HBt as o6,pze as o7,aJe as o8,Kni as o9,xEe as oA,e2t as oB,sl as oC,yMe as oD,gMe as oE,hK as oF,rFt as oG,dK as oH,sFt as oI,ide as oJ,b4e as oK,mV as oL,M8 as oM,h0t as oN,JRe as oO,BYt as oP,TCt as oQ,Osi as oR,Psi as oS,WRt as oT,Gxe as oU,i2 as oV,r2 as oW,iii as oX,dLe as oY,omt as oZ,E6 as o_,rLt as oa,dN as ob,ju as oc,wQe as od,RW as oe,fDt as of,xa as og,ANt as oh,W$e as oi,uNt as oj,KVe as ok,uUe as ol,WVe as om,vFt as on,hb as oo,Ozt as op,Vzt as oq,jni as or,s4 as os,Zee as ot,gu as ou,va as ov,bv as ow,nr as ox,JNt as oy,Xee as oz,iC as p,HR as p$,eii as p0,qJt as p1,cut as p2,dOe as p3,cOe as p4,Gr as p5,CQe as p6,ea as p7,lC as p8,oU as p9,$v as pA,Rt as pB,Q8 as pC,ERt as pD,DRt as pE,Py as pF,nM as pG,o2 as pH,d7t as pI,my as pJ,Jee as pK,Xh as pL,Vee as pM,WYe as pN,tn as pO,_K as pP,qFt as pQ,jFt as pR,RZt as pS,PZt as pT,qBe as pU,Mwe as pV,WNt as pW,msi as pX,DXe as pY,ms as pZ,OC as p_,rM as pa,kUt as pb,E6t as pc,tU as pd,xwe as pe,FFt as pf,NNt as pg,VNt as ph,bNt as pi,k9e as pj,$Bt as pk,TBt as pl,Ik as pm,W1 as pn,zqe as po,zRe as pp,AN as pq,QUt as pr,qUt as ps,KH as pt,P4e as pu,HNt as pv,tt as pw,Zi as px,bs as py,Fi as pz,p8e as q,zyt as q$,kXe as q0,QSt as q1,Hs as q2,Op as q3,zte as q4,yrt as q5,B9t as q6,fA as q7,O0t as q8,pWt as q9,Xqe as qA,c6t as qB,vGe as qC,qNt as qD,x6t as qE,A6t as qF,yn as qG,Lni as qH,bw as qI,ixe as qJ,_6t as qK,U8t as qL,s2 as qM,aFt as qN,gti as qO,RNt as qP,zD as qQ,Pp as qR,Jv as qS,St as qT,Wh as qU,Sq as qV,ku as qW,ute as qX,IIe as qY,Zge as qZ,EP as q_,Ua as qa,FWt as qb,ed as qc,jR as qd,nR as qe,dt as qf,FAe as qg,tZt as qh,BFt as qi,kb as qj,SJe as qk,Mai as ql,E2e as qm,M2e as qn,wGe as qo,Jk as qp,q2e as qq,e6t as qr,see as qs,oT as qt,O6t as qu,P6t as qv,R6t as qw,d6t as qx,u6t as qy,a6t as qz,zv as r,Tte as r$,Nyt as r0,Vyt as r1,Uyt as r2,fy as r3,Sfe as r4,_Ht as r5,vMt as r6,iLe as r7,SMt as r8,CMt as r9,gNt as rA,aM as rB,txe as rC,aU as rD,xNt as rE,fze as rF,Zf as rG,sai as rH,iai as rI,hv as rJ,Hje as rK,cpt as rL,bze as rM,nai as rN,nLt as rO,en as rP,uy as rQ,fp as rR,Ec as rS,aai as rT,oLt as rU,iSe as rV,Iit as rW,JU as rX,Sz as rY,zit as rZ,w_ as r_,wMt as ra,Hv as rb,hZ as rc,oXe as rd,Wee as re,Sp as rf,e7t as rg,Pee as rh,MRt as ri,YR as rj,O$e as rk,Pg as rl,DFt as rm,LUt as rn,Yk as ro,Iu as rp,A7t as rq,L7t as rr,k7t as rs,y8 as rt,wai as ru,s2e as rv,VRt as rw,Rpt as rx,C8e as ry,PK as rz,ibe as s,Nwt as s$,OUt as s0,vxe as s1,$f as s2,Gsi as s3,wK as s4,fT as s5,XH as s6,WGt as s7,SXe as s8,H3e as s9,A6 as sA,wZt as sB,yRe as sC,U6t as sD,irt as sE,UUt as sF,BUt as sG,GUt as sH,jUt as sI,WUt as sJ,NUt as sK,qvt as sL,zHt as sM,FHt as sN,s3e as sO,Dyt as sP,CC as sQ,LHt as sR,Ege as sS,lti as sT,vs as sU,tNt as sV,tee as sW,DVt as sX,bxe as sY,yNt as sZ,RZ as s_,Cct as sa,aBt as sb,Xet as sc,zPe as sd,Jqt as se,kbt as sf,y6 as sg,To as sh,qqt as si,mU as sj,gK as sk,QJt as sl,rm as sm,cxe as sn,ar as so,P8e as sp,ZYe as sq,v3e as sr,Qh as ss,qte as st,Eu as su,sut as sv,uOe as sw,O6 as sx,lOe as sy,fOe as sz,HV as t,IZt as t$,NP as t0,z8e as t1,PYt as t2,$te as t3,qbe as t4,v2 as t5,fNt as t6,dxe as t7,qxe as t8,xue as t9,QXt as tA,TMe as tB,Ynt as tC,$Qe as tD,Nnt as tE,E1t as tF,Tvt as tG,xvt as tH,WWt as tI,HWt as tJ,_y as tK,Mct as tL,VZt as tM,JYt as tN,MIe as tO,kDe as tP,$Zt as tQ,rde as tR,LS as tS,avt as tT,_Zt as tU,_8t as tV,iyt as tW,A1t as tX,_Z as tY,GD as tZ,Kje as t_,xxe as ta,dne as tb,bai as tc,YGt as td,a2 as te,Ef as tf,ygt as tg,oNt as th,dU as ti,v6t as tj,eCe as tk,hwt as tl,AQe as tm,Hit as tn,ONt as to,e5t as tp,O8t as tq,IK as tr,eQe as ts,a3e as tt,fQe as tu,YXt as tv,JYe as tw,Vy as tx,kee as ty,ryt as tz,Bzt as u,bEe as u$,XDe as u0,t4e as u1,KDe as u2,MZt as u3,Kge as u4,kZt as u5,fZt as u6,U2e as u7,zGe as u8,$6t as u9,okt as uA,z7e as uB,k7e as uC,On as uD,AC as uE,z4t as uF,xp as uG,rSt as uH,m5t as uI,fK as uJ,MBt as uK,PM as uL,HEt as uM,fSe as uN,TTe as uO,_Me as uP,Exe as uQ,Mv as uR,GXe as uS,fti as uT,gWt as uU,QCt as uV,eUt as uW,LFt as uX,jte as uY,DR as uZ,ZWt as u_,lqe as ua,mqe as ub,i4e as uc,XK as ud,GNt as ue,BD as uf,Tv as ug,EVt as uh,Bbt as ui,p6 as uj,qYt as uk,z8t as ul,QNt as um,YNt as un,mti as uo,Lbt as up,Ogt as uq,dee as ur,PNt as us,WV as ut,Wzt as uu,pS as uv,Ube as uw,yZ as ux,$ai as uy,xai as uz,te as v,wC as v$,_Ee as v0,DEe as v1,D_ as v2,wbt as v3,uQ as v4,_wt as v5,Rye as v6,S8e as v7,zJe as v8,E$e as v9,Ao as vA,RKt as vB,gse as vC,TKt as vD,OKt as vE,d5e as vF,DKt as vG,PKt as vH,MD as vI,Mc as vJ,LKt as vK,zKt as vL,CKt as vM,EKt as vN,GR as vO,EQe as vP,ko as vQ,yU as vR,Gee as vS,oai as vT,q_ as vU,j3e as vV,WR as vW,Yee as vX,Uqe as vY,Xk as vZ,T6t as v_,Ov as va,kKt as vb,ati as vc,I4 as vd,ZCt as ve,aA as vf,_Ut as vg,SKt as vh,UKt as vi,VKt as vj,NKt as vk,FKt as vl,YV as vm,Bpe as vn,FYt as vo,U8 as vp,VL as vq,I4e as vr,hVt as vs,d8 as vt,OHt as vu,njt as vv,GFt as vw,yr as vx,xHt as vy,Bf as vz,Ixe as w,y2t as w$,KIt as w0,rBt as w1,sBt as w2,nBt as w3,tp as w4,wP as w5,b1e as w6,R5t as w7,e2e as w8,Eze as w9,A_t as wA,Drt as wB,WHt as wC,j8t as wD,SHt as wE,VBe as wF,cFt as wG,pYe as wH,E4 as wI,DRe as wJ,Ql as wK,QFt as wL,uBt as wM,O8e as wN,_Kt as wO,r$t as wP,Y0e as wQ,R3t as wR,Lw as wS,nei as wT,by as wU,oei as wV,KFt as wW,VDe as wX,UX as wY,Af as wZ,aei as w_,lne as wa,E5t as wb,t2e as wc,Ire as wd,D5t as we,nkt as wf,z7t as wg,Yse as wh,Pbt as wi,Ud as wj,Oqe as wk,Pqe as wl,BU as wm,xee as wn,IFt as wo,Kzt as wp,Fa as wq,Ka as wr,Y2t as ws,eYt as wt,Nq as wu,G8t as wv,jgt as ww,HRe as wx,Ryt as wy,E_t as wz,Dxe as x,ZNt as x$,_2t as x0,Cqe as x1,n8 as x2,kVt as x3,Iee as x4,wrt as x5,FZt as x6,Mvt as x7,Evt as x8,vp as x9,eVt as xA,SBt as xB,kNt as xC,LNt as xD,L7e as xE,Apt as xF,UBe as xG,URt as xH,k6t as xI,py as xJ,$4e as xK,lFt as xL,Dbt as xM,N8t as xN,s5t as xO,Cai as xP,D7t as xQ,Lee as xR,Iyt as xS,mXe as xT,MC as xU,lkt as xV,DGe as xW,G2e as xX,NGe as xY,M6t as xZ,Z8t as x_,yv as xa,zZt as xb,tG as xc,iG as xd,eei as xe,aYe as xf,l1t as xg,fW as xh,WCt as xi,u5e as xj,Y2e as xk,ZC as xl,Fre as xm,E4e as xn,Obt as xo,tIe as xp,Vbe as xq,jet as xr,rr as xs,Mst as xt,ny as xu,Jrt as xv,fMe as xw,jit as xx,aue as xy,f7e as xz,LP as y,Di as y$,o4e as y0,Mh as y1,hei as y2,UNt as y3,lje as y4,uwe as y5,Pit as y6,Y7t as y7,Q7t as y8,Z7t as y9,m1t as yA,dei as yB,s$t as yC,qce as yD,DZt as yE,_He as yF,Mzt as yG,Zzt as yH,Pzt as yI,ube as yJ,eK as yK,Lzt as yL,kzt as yM,GBt as yN,jGt as yO,Kqe as yP,t6t as yQ,s6t as yR,p6t as yS,i6t as yT,n6t as yU,Mu as yV,f6t as yW,bGe as yX,qGt as yY,HGt as yZ,hr as y_,q3 as ya,Vit as yb,KR as yc,tD as yd,Dit as ye,oFt as yf,Zit as yg,Yit as yh,Lte as yi,rDt as yj,j6t as yk,uei as yl,lei as ym,IKt as yn,cei as yo,rei as yp,fei as yq,pei as yr,tei as ys,iei as yt,WFt as yu,g2e as yv,JGt as yw,ogt as yx,Dgt as yy,XNt as yz,lT as z,Hee as z$,jg as z0,k_ as z1,T4 as z2,I_ as z3,Gie as z4,F8 as z5,_e as z6,E as z7,MM as z8,ut as z9,L8t as zA,vrt as zB,B8t as zC,bGt as zD,KPe as zE,Fie as zF,Io as zG,pre as zH,ll as zI,Zh as zJ,CM as zK,sw as zL,m4 as zM,rie as zN,brt as zO,Ry as zP,_rt as zQ,kYt as zR,oXt as zS,MX as zT,R8t as zU,U3e as zV,A$e as zW,fne as zX,B7e as zY,$Vt as zZ,xVt as z_,zt as za,Vi as zb,Ii as zc,li as zd,Tmt as ze,vX as zf,ure as zg,lV as zh,$i as zi,Dw as zj,cRe as zk,Qie as zl,MAe as zm,C8 as zn,ds as zo,op as zp,oe as zq,iie as zr,TAe as zs,Smt as zt,imt as zu,Vie as zv,Eve as zw,m0t as zx,oD as zy,rmt as zz};
