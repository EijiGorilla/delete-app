import{dx as _,f2 as c,c4 as u,a$ as m,nV as g,S as y,U as f,nW as v,hq as w,fu as $,nX as P,jg as b,a4 as n,a8 as o,_ as p,m as d,b as D,n9 as M,K as l}from"./index-DftRe4XB.js";import{e as R,a as L}from"./visualizationUtils-D-DQnipl.js";import"./AnchorElementViewModel-C3NmDNbA.js";import"./createUtils-CDOaIXup.js";import"./distanceOperator-CbHLvseF.js";import"./Point2D-CITflfBj.js";import"./Distance2DCalculator-CXhBP-8I-Dkm6fs0N.js";import"./ProjectionTransformation-DTolWA8D.js";import"./Envelope2D-DxAWzC7Q.js";import"./Transformation2D-1iR8LGx8.js";import"./SimpleGeometryCursor-B92kdZ15.js";import"./OperatorDefinitions-DP7_WWTp.js";import"./apiConverter-CX8wEzPg.js";import"./jsonConverter-BeD7ymI3.js";import"./simplifyOperator-DUWW6rHF.js";import"./operatorSimplify-BIHbDD25.js";import"./mat2d-CO0Vvpll.js";import"./mat2df64-DFLy2zOC.js";class E{constructor(t){this._params=t,this._highlightTask=null,this._highlightHandle=null}destroy(){this.remove()}remove(){this._highlightTask=_(this._highlightTask),this._highlightHandle=c(this._highlightHandle)}update(t){if(this.remove(),t==null||!S(t))return;const i=t.layer;this._highlightTask=u(async e=>{const a=await this._params.view.whenLayerView(i);m(e);const r=g(a)?a:null;r&&(this._highlightHandle=r.highlight(t))})}}function S(s){return s.geometry!=null&&s.geometry.type==="polyline"}let h=class extends y{constructor(s){super(s),this._chartData=null,this._graphic=new f,this._layer=new v({listMode:"hide",internal:!0,title:"Profile line"}),this._update=t=>{const{chartData:i}=t;if(i==null)return this.remove();if(!i.refined)return;const e=i.lines.find(r=>r.viewVisualizationEnabled);if(!e)return;this._graphic.geometry=R(e,t.spatialReference),this._graphic.symbol=new w({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",effects:[{type:"CIMGeometricEffectDashes",dashTemplate:[5,10],lineDashEnding:"HalfPattern",controlPointEnding:"HalfPattern"}],capStyle:"Butt",width:1.5,color:e.color.toArray()},{type:"CIMSolidStroke",capStyle:"Butt",width:2,color:$(e.color).toArray()}]}}});const a=this.view?.map?.layers;a&&!a.includes(this._layer)&&a.add(this._layer)}}initialize(){this._layer.add(this._graphic);const s=b().profileLinesUpdateThrottleMillis;let t=this._update;{const i=P(this._update,s);this.addHandles(i),t=i}this.addHandles(n(()=>({spatialReference:this.view.spatialReference,chartData:this._chartData}),t,o))}destroy(){this.remove()}remove(){this.view?.map?.remove(this._layer)}update(s){this._chartData=s}};p([d()],h.prototype,"view",void 0),p([d()],h.prototype,"_chartData",void 0),h=p([D("esri.widgets.ElevationProfile.support.ProfileLine2D")],h);class J{constructor(t,i){this._handles=new M,this._inputRepresentation=new E({view:t}),this._hoveredPoints=new L({view:t}),this._profileLine=new h({view:t}),this._handles.add([n(()=>i.viewModel.hoveredPoints,e=>this._hoveredPoints.update(e),o),n(()=>{const{state:e,highlightEnabled:a,viewModel:r}=i;return{input:r.input,state:e,highlightEnabled:a}},e=>this._updateInputRepresentation(e),o),n(()=>i.viewModel.chartData,e=>this._profileLine.update(e),o),n(()=>i.viewModel.input?.geometry,()=>{this._profileLine.remove()},o)])}destroy(){this._handles=l(this._handles),this._inputRepresentation=l(this._inputRepresentation),this._hoveredPoints=l(this._hoveredPoints),this._profileLine=l(this._profileLine)}_updateInputRepresentation({input:t,state:i,highlightEnabled:e}){i==="selected"&&e?this._inputRepresentation.update(t):this._inputRepresentation.remove()}}export{J as ElevationProfileView2D};
