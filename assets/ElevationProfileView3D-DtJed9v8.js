import{dx as E,f2 as v,c4 as $,a$ as D,nV as b,nY as R,a4 as h,C as H,jf as P,S as L,jg as f,ky as V,V as k,nX as T,a8 as p,_ as u,m as w,b as M,n9 as O,K as m}from"./index-CKCoitmB.js";import{e as I,a as j}from"./visualizationUtils-DHi7t-ZE.js";import{b as x}from"./settings-BcfJ2aRT.js";import{R as y}from"./OutlineVisualElement-BF3UskRL.js";import{e as C}from"./GraphicState-BLszFnu-.js";import"./AnchorElementViewModel-CtA1N9zC.js";import"./createUtils-Ch_oOgx5.js";import"./distanceOperator-Db1TULc-.js";import"./Point2D-CITflfBj.js";import"./Distance2DCalculator-CXhBP-8I-COm7yLCO.js";import"./ProjectionTransformation-ySeecDBA.js";import"./Envelope2D-DxAWzC7Q.js";import"./Transformation2D-1iR8LGx8.js";import"./SimpleGeometryCursor-B92kdZ15.js";import"./OperatorDefinitions-DP7_WWTp.js";import"./apiConverter-CjKzmSWX.js";import"./jsonConverter-Bk6Zhxnv.js";import"./simplifyOperator-DQdSMC-C.js";import"./operatorSimplify-BpJRPqv-.js";import"./mat2d-DtyqYgD7.js";import"./mat2df64-DFLy2zOC.js";import"./lineStippleUtils-CCavR4OV.js";import"./EngineVisualElement-C-orlapT.js";import"./VisualElement-BLlgHkJ9.js";import"./LaserlinePath.glsl-Dqs7aO_w.js";import"./line-Dm9lPQ28.js";import"./line-D3il1QUT.js";import"./triangulationUtils-BHzqTKh0.js";import"./deduplicate-CYXSu8lG.js";class S{constructor(e){this._params=e,this._highlightTask=null,this._highlightHandle=null,this._visualElementHandle=null,this._settings=new x({getTheme:()=>this._params.view.effectiveTheme})}destroy(){this.remove()}remove(){this._highlightTask=E(this._highlightTask),this._highlightHandle=v(this._highlightHandle),this._visualElementHandle=v(this._visualElementHandle)}showHighlight(e){if(this.remove(),e==null||!c(e))return;const i=e.layer;this._highlightTask=$(async t=>{const s=await this._params.view.whenLayerView(i);D(t),b(s)&&(this._highlightHandle=s.highlight(e))})}showReshaping(e){if(this.remove(),e==null)return;const i=this._params.view,t=new y({view:i,geometry:c(e)?e.geometry:null,attached:!1,elevationInfo:R(e),renderOccluded:8,isDecoration:!0}),s=new C({graphic:e}),o=[h(()=>s.isDraped,r=>{t.isDraped=r}),s.on("changed",()=>{t.geometry=c(e)?e.geometry:null}),i.trackGraphicState(s),i.maskOccludee(e),H(t)];this._settings.visualElements.lineObjects.outline.apply(t),t.attached=!0,this._visualElementHandle=P(o)}}function c(a){return a.geometry!=null&&a.geometry.type==="polyline"}let d=class extends L{constructor(a){super(a),this._chartData=null,this._visualElements=[],this._update=e=>{const{chartData:i}=e;if(i==null)return this.remove();if(!i.refined)return;const t=this._visualElements,s=i.lines.filter(n=>n.viewVisualizationEnabled),o=s.length;for(;t.length>o;)t.pop().destroy();const r=f().profileLinesStyle3D;for(;t.length<o;){const n=new y({view:this.view,elevationInfo:{mode:"absolute-height",offset:0},innerWidth:r.innerWidth,innerColor:r.innerColor,width:r.width,falloff:r.falloff,renderOccluded:r.renderOccluded,isDecoration:!0});t.push(n)}const l=e.spatialReference;for(let n=0;n<o;++n){const _=t[n],g=s[o-1-n];_.geometry=I(g,l),_.color=V(k.toUnitRGBA(g.color))}}}initialize(){const a=f().profileLinesUpdateThrottleMillis;let e=this._update;{const i=T(this._update,a);this.addHandles(i),e=i}this.addHandles([h(()=>({spatialReference:this.view.spatialReference,chartData:this._chartData}),e,p)])}destroy(){this._destroyVisualElements()}remove(){this._destroyVisualElements()}update(a){this._chartData=a}_destroyVisualElements(){this._visualElements.forEach(a=>a.destroy()),this._visualElements.length=0}};u([w()],d.prototype,"view",void 0),u([w()],d.prototype,"_chartData",void 0),d=u([M("esri.widgets.ElevationProfile.support.ProfileLines3D")],d);class ce{constructor(e,i){this._handles=new O,this._inputRepresentation=new S({view:e}),this._hoveredPoints=new j({view:e}),this._profileLines=new d({view:e}),this._handles.add([h(()=>i.viewModel.hoveredPoints,t=>this._hoveredPoints.update(t),p),h(()=>{const{state:t,editable:s,highlightEnabled:o,viewModel:r}=i,l=r.input;return l&&(l.commitProperty("geometry"),l.commitProperty("layer")),{input:l,state:t,editable:s,highlightEnabled:o}},t=>this._updateInputRepresentation(t),p),h(()=>i.viewModel.chartData,t=>this._profileLines.update(t),p),h(()=>i.viewModel.input?.geometry,()=>{this._profileLines.remove()},p)])}destroy(){this._handles=m(this._handles),this._inputRepresentation=m(this._inputRepresentation),this._hoveredPoints=m(this._hoveredPoints),this._profileLines=m(this._profileLines)}_updateInputRepresentation({input:e,state:i,editable:t,highlightEnabled:s}){const o=this._inputRepresentation;if(!s)return o.remove();i==="selected"?o.showHighlight(e):i!=="created"||t?o.remove():o.showReshaping(e)}}export{ce as ElevationProfileView3D};
